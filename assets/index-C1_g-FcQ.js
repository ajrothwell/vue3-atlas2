(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))u(d);new MutationObserver(d=>{for(const y of d)if(y.type==="childList")for(const m of y.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&u(m)}).observe(document,{childList:!0,subtree:!0});function a(d){const y={};return d.integrity&&(y.integrity=d.integrity),d.referrerPolicy&&(y.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?y.credentials="include":d.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function u(d){if(d.ep)return;d.ep=!0;const y=a(d);fetch(d.href,y)}})();/**
* @vue/shared v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Em(e,r){const a=new Set(e.split(","));return r?u=>a.has(u.toLowerCase()):u=>a.has(u)}const Or={},eu=[],ha=()=>{},Hb=()=>!1,ff=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&(e.charCodeAt(2)>122||e.charCodeAt(2)<97),Tm=e=>e.startsWith("onUpdate:"),Vn=Object.assign,Im=(e,r)=>{const a=e.indexOf(r);a>-1&&e.splice(a,1)},Zb=Object.prototype.hasOwnProperty,Gi=(e,r)=>Zb.call(e,r),yi=Array.isArray,tu=e=>pf(e)==="[object Map]",w0=e=>pf(e)==="[object Set]",Ti=e=>typeof e=="function",Tn=e=>typeof e=="string",pu=e=>typeof e=="symbol",Ur=e=>e!==null&&typeof e=="object",M0=e=>(Ur(e)||Ti(e))&&Ti(e.then)&&Ti(e.catch),S0=Object.prototype.toString,pf=e=>S0.call(e),Wb=e=>pf(e).slice(8,-1),E0=e=>pf(e)==="[object Object]",Cm=e=>Tn(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,hh=Em(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),mf=e=>{const r=Object.create(null);return a=>r[a]||(r[a]=e(a))},Xb=/-(\w)/g,so=mf(e=>e.replace(Xb,(r,a)=>a?a.toUpperCase():"")),Kb=/\B([A-Z])/g,hc=mf(e=>e.replace(Kb,"-$1").toLowerCase()),gf=mf(e=>e.charAt(0).toUpperCase()+e.slice(1)),Ip=mf(e=>e?`on${gf(e)}`:""),Ml=(e,r)=>!Object.is(e,r),Fd=(e,r)=>{for(let a=0;a<e.length;a++)e[a](r)},Xd=(e,r,a)=>{Object.defineProperty(e,r,{configurable:!0,enumerable:!1,value:a})},Kp=e=>{const r=parseFloat(e);return isNaN(r)?e:r};let Fy;const T0=()=>Fy||(Fy=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Am(e){if(yi(e)){const r={};for(let a=0;a<e.length;a++){const u=e[a],d=Tn(u)?ew(u):Am(u);if(d)for(const y in d)r[y]=d[y]}return r}else if(Tn(e)||Ur(e))return e}const Yb=/;(?![^(]*\))/g,Jb=/:([^]+)/,Qb=/\/\*[^]*?\*\//g;function ew(e){const r={};return e.replace(Qb,"").split(Yb).forEach(a=>{if(a){const u=a.split(Jb);u.length>1&&(r[u[0].trim()]=u[1].trim())}}),r}function As(e){let r="";if(Tn(e))r=e;else if(yi(e))for(let a=0;a<e.length;a++){const u=As(e[a]);u&&(r+=u+" ")}else if(Ur(e))for(const a in e)e[a]&&(r+=a+" ");return r.trim()}const tw="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",iw=Em(tw);function I0(e){return!!e||e===""}const ii=e=>Tn(e)?e:e==null?"":yi(e)||Ur(e)&&(e.toString===S0||!Ti(e.toString))?JSON.stringify(e,C0,2):String(e),C0=(e,r)=>r&&r.__v_isRef?C0(e,r.value):tu(r)?{[`Map(${r.size})`]:[...r.entries()].reduce((a,[u,d],y)=>(a[Cp(u,y)+" =>"]=d,a),{})}:w0(r)?{[`Set(${r.size})`]:[...r.values()].map(a=>Cp(a))}:pu(r)?Cp(r):Ur(r)&&!yi(r)&&!E0(r)?String(r):r,Cp=(e,r="")=>{var a;return pu(e)?`Symbol(${(a=e.description)!=null?a:r})`:e};/**
* @vue/reactivity v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Ws;class A0{constructor(r=!1){this.detached=r,this._active=!0,this.effects=[],this.cleanups=[],this.parent=Ws,!r&&Ws&&(this.index=(Ws.scopes||(Ws.scopes=[])).push(this)-1)}get active(){return this._active}run(r){if(this._active){const a=Ws;try{return Ws=this,r()}finally{Ws=a}}}on(){Ws=this}off(){Ws=this.parent}stop(r){if(this._active){let a,u;for(a=0,u=this.effects.length;a<u;a++)this.effects[a].stop();for(a=0,u=this.cleanups.length;a<u;a++)this.cleanups[a]();if(this.scopes)for(a=0,u=this.scopes.length;a<u;a++)this.scopes[a].stop(!0);if(!this.detached&&this.parent&&!r){const d=this.parent.scopes.pop();d&&d!==this&&(this.parent.scopes[this.index]=d,d.index=this.index)}this.parent=void 0,this._active=!1}}}function P0(e){return new A0(e)}function rw(e,r=Ws){r&&r.active&&r.effects.push(e)}function k0(){return Ws}function nw(e){Ws&&Ws.cleanups.push(e)}let oc;class Pm{constructor(r,a,u,d){this.fn=r,this.trigger=a,this.scheduler=u,this.active=!0,this.deps=[],this._dirtyLevel=4,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,rw(this,d)}get dirty(){if(this._dirtyLevel===2||this._dirtyLevel===3){this._dirtyLevel=1,dc();for(let r=0;r<this._depsLength;r++){const a=this.deps[r];if(a.computed&&(sw(a.computed),this._dirtyLevel>=4))break}this._dirtyLevel===1&&(this._dirtyLevel=0),fc()}return this._dirtyLevel>=4}set dirty(r){this._dirtyLevel=r?4:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let r=vl,a=oc;try{return vl=!0,oc=this,this._runnings++,By(this),this.fn()}finally{Ny(this),this._runnings--,oc=a,vl=r}}stop(){var r;this.active&&(By(this),Ny(this),(r=this.onStop)==null||r.call(this),this.active=!1)}}function sw(e){return e.value}function By(e){e._trackId++,e._depsLength=0}function Ny(e){if(e.deps.length>e._depsLength){for(let r=e._depsLength;r<e.deps.length;r++)D0(e.deps[r],e);e.deps.length=e._depsLength}}function D0(e,r){const a=e.get(r);a!==void 0&&r._trackId!==a&&(e.delete(r),e.size===0&&e.cleanup())}let vl=!0,Yp=0;const L0=[];function dc(){L0.push(vl),vl=!1}function fc(){const e=L0.pop();vl=e===void 0?!0:e}function km(){Yp++}function Dm(){for(Yp--;!Yp&&Jp.length;)Jp.shift()()}function R0(e,r,a){if(r.get(e)!==e._trackId){r.set(e,e._trackId);const u=e.deps[e._depsLength];u!==r?(u&&D0(u,e),e.deps[e._depsLength++]=r):e._depsLength++}}const Jp=[];function z0(e,r,a){km();for(const u of e.keys()){let d;u._dirtyLevel<r&&(d??(d=e.get(u)===u._trackId))&&(u._shouldSchedule||(u._shouldSchedule=u._dirtyLevel===0),u._dirtyLevel=r),u._shouldSchedule&&(d??(d=e.get(u)===u._trackId))&&(u.trigger(),(!u._runnings||u.allowRecurse)&&u._dirtyLevel!==2&&(u._shouldSchedule=!1,u.scheduler&&Jp.push(u.scheduler)))}Dm()}const O0=(e,r)=>{const a=new Map;return a.cleanup=e,a.computed=r,a},Kd=new WeakMap,lc=Symbol(""),Qp=Symbol("");function Ds(e,r,a){if(vl&&oc){let u=Kd.get(e);u||Kd.set(e,u=new Map);let d=u.get(a);d||u.set(a,d=O0(()=>u.delete(a))),R0(oc,d)}}function Po(e,r,a,u,d,y){const m=Kd.get(e);if(!m)return;let l=[];if(r==="clear")l=[...m.values()];else if(a==="length"&&yi(e)){const T=Number(u);m.forEach((P,z)=>{(z==="length"||!pu(z)&&z>=T)&&l.push(P)})}else switch(a!==void 0&&l.push(m.get(a)),r){case"add":yi(e)?Cm(a)&&l.push(m.get("length")):(l.push(m.get(lc)),tu(e)&&l.push(m.get(Qp)));break;case"delete":yi(e)||(l.push(m.get(lc)),tu(e)&&l.push(m.get(Qp)));break;case"set":tu(e)&&l.push(m.get(lc));break}km();for(const T of l)T&&z0(T,4);Dm()}function aw(e,r){var a;return(a=Kd.get(e))==null?void 0:a.get(r)}const ow=Em("__proto__,__v_isRef,__isVue"),F0=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(pu)),$y=lw();function lw(){const e={};return["includes","indexOf","lastIndexOf"].forEach(r=>{e[r]=function(...a){const u=Hi(this);for(let y=0,m=this.length;y<m;y++)Ds(u,"get",y+"");const d=u[r](...a);return d===-1||d===!1?u[r](...a.map(Hi)):d}}),["push","pop","shift","unshift","splice"].forEach(r=>{e[r]=function(...a){dc(),km();const u=Hi(this)[r].apply(this,a);return Dm(),fc(),u}}),e}function cw(e){const r=Hi(this);return Ds(r,"has",e),r.hasOwnProperty(e)}class B0{constructor(r=!1,a=!1){this._isReadonly=r,this._isShallow=a}get(r,a,u){const d=this._isReadonly,y=this._isShallow;if(a==="__v_isReactive")return!d;if(a==="__v_isReadonly")return d;if(a==="__v_isShallow")return y;if(a==="__v_raw")return u===(d?y?ww:V0:y?U0:$0).get(r)||Object.getPrototypeOf(r)===Object.getPrototypeOf(u)?r:void 0;const m=yi(r);if(!d){if(m&&Gi($y,a))return Reflect.get($y,a,u);if(a==="hasOwnProperty")return cw}const l=Reflect.get(r,a,u);return(pu(a)?F0.has(a):ow(a))||(d||Ds(r,"get",a),y)?l:In(l)?m&&Cm(a)?l:l.value:Ur(l)?d?q0(l):Oh(l):l}}class N0 extends B0{constructor(r=!1){super(!1,r)}set(r,a,u,d){let y=r[a];if(!this._isShallow){const T=au(y);if(!Yd(u)&&!au(u)&&(y=Hi(y),u=Hi(u)),!yi(r)&&In(y)&&!In(u))return T?!1:(y.value=u,!0)}const m=yi(r)&&Cm(a)?Number(a)<r.length:Gi(r,a),l=Reflect.set(r,a,u,d);return r===Hi(d)&&(m?Ml(u,y)&&Po(r,"set",a,u):Po(r,"add",a,u)),l}deleteProperty(r,a){const u=Gi(r,a);r[a];const d=Reflect.deleteProperty(r,a);return d&&u&&Po(r,"delete",a,void 0),d}has(r,a){const u=Reflect.has(r,a);return(!pu(a)||!F0.has(a))&&Ds(r,"has",a),u}ownKeys(r){return Ds(r,"iterate",yi(r)?"length":lc),Reflect.ownKeys(r)}}class uw extends B0{constructor(r=!1){super(!0,r)}set(r,a){return!0}deleteProperty(r,a){return!0}}const hw=new N0,dw=new uw,fw=new N0(!0),Lm=e=>e,yf=e=>Reflect.getPrototypeOf(e);function Id(e,r,a=!1,u=!1){e=e.__v_raw;const d=Hi(e),y=Hi(r);a||(Ml(r,y)&&Ds(d,"get",r),Ds(d,"get",y));const{has:m}=yf(d),l=u?Lm:a?Om:Mh;if(m.call(d,r))return l(e.get(r));if(m.call(d,y))return l(e.get(y));e!==d&&e.get(r)}function Cd(e,r=!1){const a=this.__v_raw,u=Hi(a),d=Hi(e);return r||(Ml(e,d)&&Ds(u,"has",e),Ds(u,"has",d)),e===d?a.has(e):a.has(e)||a.has(d)}function Ad(e,r=!1){return e=e.__v_raw,!r&&Ds(Hi(e),"iterate",lc),Reflect.get(e,"size",e)}function Uy(e){e=Hi(e);const r=Hi(this);return yf(r).has.call(r,e)||(r.add(e),Po(r,"add",e,e)),this}function Vy(e,r){r=Hi(r);const a=Hi(this),{has:u,get:d}=yf(a);let y=u.call(a,e);y||(e=Hi(e),y=u.call(a,e));const m=d.call(a,e);return a.set(e,r),y?Ml(r,m)&&Po(a,"set",e,r):Po(a,"add",e,r),this}function jy(e){const r=Hi(this),{has:a,get:u}=yf(r);let d=a.call(r,e);d||(e=Hi(e),d=a.call(r,e)),u&&u.call(r,e);const y=r.delete(e);return d&&Po(r,"delete",e,void 0),y}function qy(){const e=Hi(this),r=e.size!==0,a=e.clear();return r&&Po(e,"clear",void 0,void 0),a}function Pd(e,r){return function(u,d){const y=this,m=y.__v_raw,l=Hi(m),T=r?Lm:e?Om:Mh;return!e&&Ds(l,"iterate",lc),m.forEach((P,z)=>u.call(d,T(P),T(z),y))}}function kd(e,r,a){return function(...u){const d=this.__v_raw,y=Hi(d),m=tu(y),l=e==="entries"||e===Symbol.iterator&&m,T=e==="keys"&&m,P=d[e](...u),z=a?Lm:r?Om:Mh;return!r&&Ds(y,"iterate",T?Qp:lc),{next(){const{value:k,done:R}=P.next();return R?{value:k,done:R}:{value:l?[z(k[0]),z(k[1])]:z(k),done:R}},[Symbol.iterator](){return this}}}}function ul(e){return function(...r){return e==="delete"?!1:e==="clear"?void 0:this}}function pw(){const e={get(y){return Id(this,y)},get size(){return Ad(this)},has:Cd,add:Uy,set:Vy,delete:jy,clear:qy,forEach:Pd(!1,!1)},r={get(y){return Id(this,y,!1,!0)},get size(){return Ad(this)},has:Cd,add:Uy,set:Vy,delete:jy,clear:qy,forEach:Pd(!1,!0)},a={get(y){return Id(this,y,!0)},get size(){return Ad(this,!0)},has(y){return Cd.call(this,y,!0)},add:ul("add"),set:ul("set"),delete:ul("delete"),clear:ul("clear"),forEach:Pd(!0,!1)},u={get(y){return Id(this,y,!0,!0)},get size(){return Ad(this,!0)},has(y){return Cd.call(this,y,!0)},add:ul("add"),set:ul("set"),delete:ul("delete"),clear:ul("clear"),forEach:Pd(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(y=>{e[y]=kd(y,!1,!1),a[y]=kd(y,!0,!1),r[y]=kd(y,!1,!0),u[y]=kd(y,!0,!0)}),[e,a,r,u]}const[mw,gw,yw,_w]=pw();function Rm(e,r){const a=r?e?_w:yw:e?gw:mw;return(u,d,y)=>d==="__v_isReactive"?!e:d==="__v_isReadonly"?e:d==="__v_raw"?u:Reflect.get(Gi(a,d)&&d in u?a:u,d,y)}const vw={get:Rm(!1,!1)},xw={get:Rm(!1,!0)},bw={get:Rm(!0,!1)},$0=new WeakMap,U0=new WeakMap,V0=new WeakMap,ww=new WeakMap;function Mw(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Sw(e){return e.__v_skip||!Object.isExtensible(e)?0:Mw(Wb(e))}function Oh(e){return au(e)?e:zm(e,!1,hw,vw,$0)}function j0(e){return zm(e,!1,fw,xw,U0)}function q0(e){return zm(e,!0,dw,bw,V0)}function zm(e,r,a,u,d){if(!Ur(e)||e.__v_raw&&!(r&&e.__v_isReactive))return e;const y=d.get(e);if(y)return y;const m=Sw(e);if(m===0)return e;const l=new Proxy(e,m===2?u:a);return d.set(e,l),l}function xl(e){return au(e)?xl(e.__v_raw):!!(e&&e.__v_isReactive)}function au(e){return!!(e&&e.__v_isReadonly)}function Yd(e){return!!(e&&e.__v_isShallow)}function G0(e){return xl(e)||au(e)}function Hi(e){const r=e&&e.__v_raw;return r?Hi(r):e}function _f(e){return Object.isExtensible(e)&&Xd(e,"__v_skip",!0),e}const Mh=e=>Ur(e)?Oh(e):e,Om=e=>Ur(e)?q0(e):e;class H0{constructor(r,a,u,d){this.getter=r,this._setter=a,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this.effect=new Pm(()=>r(this._value),()=>Bd(this,this.effect._dirtyLevel===2?2:3)),this.effect.computed=this,this.effect.active=this._cacheable=!d,this.__v_isReadonly=u}get value(){const r=Hi(this);return(!r._cacheable||r.effect.dirty)&&Ml(r._value,r._value=r.effect.run())&&Bd(r,4),Z0(r),r.effect._dirtyLevel>=2&&Bd(r,2),r._value}set value(r){this._setter(r)}get _dirty(){return this.effect.dirty}set _dirty(r){this.effect.dirty=r}}function Ew(e,r,a=!1){let u,d;const y=Ti(e);return y?(u=e,d=ha):(u=e.get,d=e.set),new H0(u,d,y||!d,a)}function Z0(e){var r;vl&&oc&&(e=Hi(e),R0(oc,(r=e.dep)!=null?r:e.dep=O0(()=>e.dep=void 0,e instanceof H0?e:void 0)))}function Bd(e,r=4,a){e=Hi(e);const u=e.dep;u&&z0(u,r)}function In(e){return!!(e&&e.__v_isRef===!0)}function Ps(e){return W0(e,!1)}function Tw(e){return W0(e,!0)}function W0(e,r){return In(e)?e:new Iw(e,r)}class Iw{constructor(r,a){this.__v_isShallow=a,this.dep=void 0,this.__v_isRef=!0,this._rawValue=a?r:Hi(r),this._value=a?r:Mh(r)}get value(){return Z0(this),this._value}set value(r){const a=this.__v_isShallow||Yd(r)||au(r);r=a?r:Hi(r),Ml(r,this._rawValue)&&(this._rawValue=r,this._value=a?r:Mh(r),Bd(this,4))}}function er(e){return In(e)?e.value:e}const Cw={get:(e,r,a)=>er(Reflect.get(e,r,a)),set:(e,r,a,u)=>{const d=e[r];return In(d)&&!In(a)?(d.value=a,!0):Reflect.set(e,r,a,u)}};function X0(e){return xl(e)?e:new Proxy(e,Cw)}function Aw(e){const r=yi(e)?new Array(e.length):{};for(const a in e)r[a]=kw(e,a);return r}class Pw{constructor(r,a,u){this._object=r,this._key=a,this._defaultValue=u,this.__v_isRef=!0}get value(){const r=this._object[this._key];return r===void 0?this._defaultValue:r}set value(r){this._object[this._key]=r}get dep(){return aw(Hi(this._object),this._key)}}function kw(e,r,a){const u=e[r];return In(u)?u:new Pw(e,r,a)}/**
* @vue/runtime-core v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function bl(e,r,a,u){try{return u?e(...u):e()}catch(d){vf(d,r,a)}}function La(e,r,a,u){if(Ti(e)){const y=bl(e,r,a,u);return y&&M0(y)&&y.catch(m=>{vf(m,r,a)}),y}const d=[];for(let y=0;y<e.length;y++)d.push(La(e[y],r,a,u));return d}function vf(e,r,a,u=!0){const d=r?r.vnode:null;if(r){let y=r.parent;const m=r.proxy,l=`https://vuejs.org/error-reference/#runtime-${a}`;for(;y;){const P=y.ec;if(P){for(let z=0;z<P.length;z++)if(P[z](e,m,l)===!1)return}y=y.parent}const T=r.appContext.config.errorHandler;if(T){bl(T,null,10,[e,m,l]);return}}Dw(e,a,d,u)}function Dw(e,r,a,u=!0){console.error(e)}let Sh=!1,em=!1;const ts=[];let to=0;const iu=[];let ml=null,sc=0;const K0=Promise.resolve();let Fm=null;function Bm(e){const r=Fm||K0;return e?r.then(this?e.bind(this):e):r}function Lw(e){let r=to+1,a=ts.length;for(;r<a;){const u=r+a>>>1,d=ts[u],y=Eh(d);y<e||y===e&&d.pre?r=u+1:a=u}return r}function Nm(e){(!ts.length||!ts.includes(e,Sh&&e.allowRecurse?to+1:to))&&(e.id==null?ts.push(e):ts.splice(Lw(e.id),0,e),Y0())}function Y0(){!Sh&&!em&&(em=!0,Fm=K0.then(Q0))}function Rw(e){const r=ts.indexOf(e);r>to&&ts.splice(r,1)}function zw(e){yi(e)?iu.push(...e):(!ml||!ml.includes(e,e.allowRecurse?sc+1:sc))&&iu.push(e),Y0()}function Gy(e,r,a=Sh?to+1:0){for(;a<ts.length;a++){const u=ts[a];if(u&&u.pre){if(e&&u.id!==e.uid)continue;ts.splice(a,1),a--,u()}}}function J0(e){if(iu.length){const r=[...new Set(iu)].sort((a,u)=>Eh(a)-Eh(u));if(iu.length=0,ml){ml.push(...r);return}for(ml=r,sc=0;sc<ml.length;sc++)ml[sc]();ml=null,sc=0}}const Eh=e=>e.id==null?1/0:e.id,Ow=(e,r)=>{const a=Eh(e)-Eh(r);if(a===0){if(e.pre&&!r.pre)return-1;if(r.pre&&!e.pre)return 1}return a};function Q0(e){em=!1,Sh=!0,ts.sort(Ow);try{for(to=0;to<ts.length;to++){const r=ts[to];r&&r.active!==!1&&bl(r,null,14)}}finally{to=0,ts.length=0,J0(),Sh=!1,Fm=null,(ts.length||iu.length)&&Q0()}}function Fw(e,r,...a){if(e.isUnmounted)return;const u=e.vnode.props||Or;let d=a;const y=r.startsWith("update:"),m=y&&r.slice(7);if(m&&m in u){const z=`${m==="modelValue"?"model":m}Modifiers`,{number:k,trim:R}=u[z]||Or;R&&(d=a.map(Z=>Tn(Z)?Z.trim():Z)),k&&(d=a.map(Kp))}let l,T=u[l=Ip(r)]||u[l=Ip(so(r))];!T&&y&&(T=u[l=Ip(hc(r))]),T&&La(T,e,6,d);const P=u[l+"Once"];if(P){if(!e.emitted)e.emitted={};else if(e.emitted[l])return;e.emitted[l]=!0,La(P,e,6,d)}}function ev(e,r,a=!1){const u=r.emitsCache,d=u.get(e);if(d!==void 0)return d;const y=e.emits;let m={},l=!1;if(!Ti(e)){const T=P=>{const z=ev(P,r,!0);z&&(l=!0,Vn(m,z))};!a&&r.mixins.length&&r.mixins.forEach(T),e.extends&&T(e.extends),e.mixins&&e.mixins.forEach(T)}return!y&&!l?(Ur(e)&&u.set(e,null),null):(yi(y)?y.forEach(T=>m[T]=null):Vn(m,y),Ur(e)&&u.set(e,m),m)}function xf(e,r){return!e||!ff(r)?!1:(r=r.slice(2).replace(/Once$/,""),Gi(e,r[0].toLowerCase()+r.slice(1))||Gi(e,hc(r))||Gi(e,r))}let En=null,bf=null;function Jd(e){const r=En;return En=e,bf=e&&e.type.__scopeId||null,r}function Fh(e){bf=e}function Bh(){bf=null}function Ao(e,r=En,a){if(!r||e._n)return e;const u=(...d)=>{u._d&&i_(-1);const y=Jd(r);let m;try{m=e(...d)}finally{Jd(y),u._d&&i_(1)}return m};return u._n=!0,u._c=!0,u._d=!0,u}function Ap(e){const{type:r,vnode:a,proxy:u,withProxy:d,props:y,propsOptions:[m],slots:l,attrs:T,emit:P,render:z,renderCache:k,data:R,setupState:Z,ctx:K,inheritAttrs:Y}=e;let ge,Te;const Fe=Jd(e);try{if(a.shapeFlag&4){const Le=d||u,We=Le;ge=eo(z.call(We,Le,k,y,Z,R,K)),Te=T}else{const Le=r;ge=eo(Le.length>1?Le(y,{attrs:T,slots:l,emit:P}):Le(y,null)),Te=r.props?T:Bw(T)}}catch(Le){ph.length=0,vf(Le,e,1),ge=tr(Sl)}let he=ge;if(Te&&Y!==!1){const Le=Object.keys(Te),{shapeFlag:We}=he;Le.length&&We&7&&(m&&Le.some(Tm)&&(Te=Nw(Te,m)),he=ou(he,Te))}return a.dirs&&(he=ou(he),he.dirs=he.dirs?he.dirs.concat(a.dirs):a.dirs),a.transition&&(he.transition=a.transition),ge=he,Jd(Fe),ge}const Bw=e=>{let r;for(const a in e)(a==="class"||a==="style"||ff(a))&&((r||(r={}))[a]=e[a]);return r},Nw=(e,r)=>{const a={};for(const u in e)(!Tm(u)||!(u.slice(9)in r))&&(a[u]=e[u]);return a};function $w(e,r,a){const{props:u,children:d,component:y}=e,{props:m,children:l,patchFlag:T}=r,P=y.emitsOptions;if(r.dirs||r.transition)return!0;if(a&&T>=0){if(T&1024)return!0;if(T&16)return u?Hy(u,m,P):!!m;if(T&8){const z=r.dynamicProps;for(let k=0;k<z.length;k++){const R=z[k];if(m[R]!==u[R]&&!xf(P,R))return!0}}}else return(d||l)&&(!l||!l.$stable)?!0:u===m?!1:u?m?Hy(u,m,P):!0:!!m;return!1}function Hy(e,r,a){const u=Object.keys(r);if(u.length!==Object.keys(e).length)return!0;for(let d=0;d<u.length;d++){const y=u[d];if(r[y]!==e[y]&&!xf(a,y))return!0}return!1}function Uw({vnode:e,parent:r},a){for(;r;){const u=r.subTree;if(u.suspense&&u.suspense.activeBranch===e&&(u.el=e.el),u===e)(e=r.vnode).el=a,r=r.parent;else break}}const tv="components";function lz(e,r){return jw(tv,e,!0,r)||e}const Vw=Symbol.for("v-ndc");function jw(e,r,a=!0,u=!1){const d=En||Un;if(d){const y=d.type;if(e===tv){const l=F2(y,!1);if(l&&(l===r||l===so(r)||l===gf(so(r))))return y}const m=Zy(d[e]||y[e],r)||Zy(d.appContext[e],r);return!m&&u?y:m}}function Zy(e,r){return e&&(e[r]||e[so(r)]||e[gf(so(r))])}const qw=e=>e.__isSuspense;function Gw(e,r){r&&r.pendingBranch?yi(e)?r.effects.push(...e):r.effects.push(e):zw(e)}const Hw=Symbol.for("v-scx"),Zw=()=>da(Hw),Dd={};function ks(e,r,a){return iv(e,r,a)}function iv(e,r,{immediate:a,deep:u,flush:d,once:y,onTrack:m,onTrigger:l}=Or){if(r&&y){const Qe=r;r=(...bt)=>{Qe(...bt),We()}}const T=Un,P=Qe=>u===!0?Qe:ac(Qe,u===!1?1:void 0);let z,k=!1,R=!1;if(In(e)?(z=()=>e.value,k=Yd(e)):xl(e)?(z=()=>P(e),k=!0):yi(e)?(R=!0,k=e.some(Qe=>xl(Qe)||Yd(Qe)),z=()=>e.map(Qe=>{if(In(Qe))return Qe.value;if(xl(Qe))return P(Qe);if(Ti(Qe))return bl(Qe,T,2)})):Ti(e)?r?z=()=>bl(e,T,2):z=()=>(Z&&Z(),La(e,T,3,[K])):z=ha,r&&u){const Qe=z;z=()=>ac(Qe())}let Z,K=Qe=>{Z=he.onStop=()=>{bl(Qe,T,4),Z=he.onStop=void 0}},Y;if(Ef)if(K=ha,r?a&&La(r,T,3,[z(),R?[]:void 0,K]):z(),d==="sync"){const Qe=Zw();Y=Qe.__watcherHandles||(Qe.__watcherHandles=[])}else return ha;let ge=R?new Array(e.length).fill(Dd):Dd;const Te=()=>{if(!(!he.active||!he.dirty))if(r){const Qe=he.run();(u||k||(R?Qe.some((bt,He)=>Ml(bt,ge[He])):Ml(Qe,ge)))&&(Z&&Z(),La(r,T,3,[Qe,ge===Dd?void 0:R&&ge[0]===Dd?[]:ge,K]),ge=Qe)}else he.run()};Te.allowRecurse=!!r;let Fe;d==="sync"?Fe=Te:d==="post"?Fe=()=>Cs(Te,T&&T.suspense):(Te.pre=!0,T&&(Te.id=T.uid),Fe=()=>Nm(Te));const he=new Pm(z,ha,Fe),Le=k0(),We=()=>{he.stop(),Le&&Im(Le.effects,he)};return r?a?Te():ge=he.run():d==="post"?Cs(he.run.bind(he),T&&T.suspense):he.run(),Y&&Y.push(We),We}function Ww(e,r,a){const u=this.proxy,d=Tn(e)?e.includes(".")?rv(u,e):()=>u[e]:e.bind(u,u);let y;Ti(r)?y=r:(y=r.handler,a=r);const m=$h(this),l=iv(d,y.bind(u),a);return m(),l}function rv(e,r){const a=r.split(".");return()=>{let u=e;for(let d=0;d<a.length&&u;d++)u=u[a[d]];return u}}function ac(e,r,a=0,u){if(!Ur(e)||e.__v_skip)return e;if(r&&r>0){if(a>=r)return e;a++}if(u=u||new Set,u.has(e))return e;if(u.add(e),In(e))ac(e.value,r,a,u);else if(yi(e))for(let d=0;d<e.length;d++)ac(e[d],r,a,u);else if(w0(e)||tu(e))e.forEach(d=>{ac(d,r,a,u)});else if(E0(e))for(const d in e)ac(e[d],r,a,u);return e}function nv(e,r){if(En===null)return e;const a=Tf(En)||En.proxy,u=e.dirs||(e.dirs=[]);for(let d=0;d<r.length;d++){let[y,m,l,T=Or]=r[d];y&&(Ti(y)&&(y={mounted:y,updated:y}),y.deep&&ac(m),u.push({dir:y,instance:a,value:m,oldValue:void 0,arg:l,modifiers:T}))}return e}function ec(e,r,a,u){const d=e.dirs,y=r&&r.dirs;for(let m=0;m<d.length;m++){const l=d[m];y&&(l.oldValue=y[m].value);let T=l.dir[u];T&&(dc(),La(T,a,8,[e.el,l,e,r]),fc())}}/*! #__NO_SIDE_EFFECTS__ */function sv(e,r){return Ti(e)?Vn({name:e.name},r,{setup:e}):e}const dh=e=>!!e.type.__asyncLoader,av=e=>e.type.__isKeepAlive;function Xw(e,r){ov(e,"a",r)}function Kw(e,r){ov(e,"da",r)}function ov(e,r,a=Un){const u=e.__wdc||(e.__wdc=()=>{let d=a;for(;d;){if(d.isDeactivated)return;d=d.parent}return e()});if(wf(r,u,a),a){let d=a.parent;for(;d&&d.parent;)av(d.parent.vnode)&&Yw(u,r,a,d),d=d.parent}}function Yw(e,r,a,u){const d=wf(r,e,u,!0);cv(()=>{Im(u[r],d)},a)}function wf(e,r,a=Un,u=!1){if(a){const d=a[e]||(a[e]=[]),y=r.__weh||(r.__weh=(...m)=>{if(a.isUnmounted)return;dc();const l=$h(a),T=La(r,a,e,m);return l(),fc(),T});return u?d.unshift(y):d.push(y),y}}const Do=e=>(r,a=Un)=>(!Ef||e==="sp")&&wf(e,(...u)=>r(...u),a),lv=Do("bm"),Nh=Do("m"),Jw=Do("bu"),Qw=Do("u"),e2=Do("bum"),cv=Do("um"),t2=Do("sp"),i2=Do("rtg"),r2=Do("rtc");function n2(e,r=Un){wf("ec",e,r)}function Pa(e,r,a,u){let d;const y=a&&a[u];if(yi(e)||Tn(e)){d=new Array(e.length);for(let m=0,l=e.length;m<l;m++)d[m]=r(e[m],m,void 0,y&&y[m])}else if(typeof e=="number"){d=new Array(e);for(let m=0;m<e;m++)d[m]=r(m+1,m,void 0,y&&y[m])}else if(Ur(e))if(e[Symbol.iterator])d=Array.from(e,(m,l)=>r(m,l,void 0,y&&y[l]));else{const m=Object.keys(e);d=new Array(m.length);for(let l=0,T=m.length;l<T;l++){const P=m[l];d[l]=r(e[P],P,l,y&&y[l])}}else d=[];return a&&(a[u]=d),d}function s2(e,r,a={},u,d){if(En.isCE||En.parent&&dh(En.parent)&&En.parent.isCE)return r!=="default"&&(a.name=r),tr("slot",a,u&&u());let y=e[r];y&&y._c&&(y._d=!1),Dt();const m=y&&uv(y(a)),l=Qa($r,{key:a.key||m&&m.key||`_${r}`},m||(u?u():[]),m&&e._===1?64:-2);return!d&&l.scopeId&&(l.slotScopeIds=[l.scopeId+"-s"]),y&&y._c&&(y._d=!0),l}function uv(e){return e.some(r=>ef(r)?!(r.type===Sl||r.type===$r&&!uv(r.children)):!0)?e:null}const tm=e=>e?wv(e)?Tf(e)||e.proxy:tm(e.parent):null,fh=Vn(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>tm(e.parent),$root:e=>tm(e.root),$emit:e=>e.emit,$options:e=>$m(e),$forceUpdate:e=>e.f||(e.f=()=>{e.effect.dirty=!0,Nm(e.update)}),$nextTick:e=>e.n||(e.n=Bm.bind(e.proxy)),$watch:e=>Ww.bind(e)}),Pp=(e,r)=>e!==Or&&!e.__isScriptSetup&&Gi(e,r),a2={get({_:e},r){const{ctx:a,setupState:u,data:d,props:y,accessCache:m,type:l,appContext:T}=e;let P;if(r[0]!=="$"){const Z=m[r];if(Z!==void 0)switch(Z){case 1:return u[r];case 2:return d[r];case 4:return a[r];case 3:return y[r]}else{if(Pp(u,r))return m[r]=1,u[r];if(d!==Or&&Gi(d,r))return m[r]=2,d[r];if((P=e.propsOptions[0])&&Gi(P,r))return m[r]=3,y[r];if(a!==Or&&Gi(a,r))return m[r]=4,a[r];im&&(m[r]=0)}}const z=fh[r];let k,R;if(z)return r==="$attrs"&&Ds(e,"get",r),z(e);if((k=l.__cssModules)&&(k=k[r]))return k;if(a!==Or&&Gi(a,r))return m[r]=4,a[r];if(R=T.config.globalProperties,Gi(R,r))return R[r]},set({_:e},r,a){const{data:u,setupState:d,ctx:y}=e;return Pp(d,r)?(d[r]=a,!0):u!==Or&&Gi(u,r)?(u[r]=a,!0):Gi(e.props,r)||r[0]==="$"&&r.slice(1)in e?!1:(y[r]=a,!0)},has({_:{data:e,setupState:r,accessCache:a,ctx:u,appContext:d,propsOptions:y}},m){let l;return!!a[m]||e!==Or&&Gi(e,m)||Pp(r,m)||(l=y[0])&&Gi(l,m)||Gi(u,m)||Gi(fh,m)||Gi(d.config.globalProperties,m)},defineProperty(e,r,a){return a.get!=null?e._.accessCache[r]=0:Gi(a,"value")&&this.set(e,r,a.value,null),Reflect.defineProperty(e,r,a)}};function Wy(e){return yi(e)?e.reduce((r,a)=>(r[a]=null,r),{}):e}let im=!0;function o2(e){const r=$m(e),a=e.proxy,u=e.ctx;im=!1,r.beforeCreate&&Xy(r.beforeCreate,e,"bc");const{data:d,computed:y,methods:m,watch:l,provide:T,inject:P,created:z,beforeMount:k,mounted:R,beforeUpdate:Z,updated:K,activated:Y,deactivated:ge,beforeDestroy:Te,beforeUnmount:Fe,destroyed:he,unmounted:Le,render:We,renderTracked:Qe,renderTriggered:bt,errorCaptured:He,serverPrefetch:lt,expose:Rt,inheritAttrs:Pt,components:oi,directives:pi,filters:Yt}=r;if(P&&l2(P,u,null),m)for(const Qt in m){const gi=m[Qt];Ti(gi)&&(u[Qt]=gi.bind(a))}if(d){const Qt=d.call(a,a);Ur(Qt)&&(e.data=Oh(Qt))}if(im=!0,y)for(const Qt in y){const gi=y[Qt],ur=Ti(gi)?gi.bind(a,a):Ti(gi.get)?gi.get.bind(a,a):ha,Ar=!Ti(gi)&&Ti(gi.set)?gi.set.bind(a):ha,ut=Ai({get:ur,set:Ar});Object.defineProperty(u,Qt,{enumerable:!0,configurable:!0,get:()=>ut.value,set:rt=>ut.value=rt})}if(l)for(const Qt in l)hv(l[Qt],u,a,Qt);if(T){const Qt=Ti(T)?T.call(a):T;Reflect.ownKeys(Qt).forEach(gi=>{Nd(gi,Qt[gi])})}z&&Xy(z,e,"c");function si(Qt,gi){yi(gi)?gi.forEach(ur=>Qt(ur.bind(a))):gi&&Qt(gi.bind(a))}if(si(lv,k),si(Nh,R),si(Jw,Z),si(Qw,K),si(Xw,Y),si(Kw,ge),si(n2,He),si(r2,Qe),si(i2,bt),si(e2,Fe),si(cv,Le),si(t2,lt),yi(Rt))if(Rt.length){const Qt=e.exposed||(e.exposed={});Rt.forEach(gi=>{Object.defineProperty(Qt,gi,{get:()=>a[gi],set:ur=>a[gi]=ur})})}else e.exposed||(e.exposed={});We&&e.render===ha&&(e.render=We),Pt!=null&&(e.inheritAttrs=Pt),oi&&(e.components=oi),pi&&(e.directives=pi)}function l2(e,r,a=ha){yi(e)&&(e=rm(e));for(const u in e){const d=e[u];let y;Ur(d)?"default"in d?y=da(d.from||u,d.default,!0):y=da(d.from||u):y=da(d),In(y)?Object.defineProperty(r,u,{enumerable:!0,configurable:!0,get:()=>y.value,set:m=>y.value=m}):r[u]=y}}function Xy(e,r,a){La(yi(e)?e.map(u=>u.bind(r.proxy)):e.bind(r.proxy),r,a)}function hv(e,r,a,u){const d=u.includes(".")?rv(a,u):()=>a[u];if(Tn(e)){const y=r[e];Ti(y)&&ks(d,y)}else if(Ti(e))ks(d,e.bind(a));else if(Ur(e))if(yi(e))e.forEach(y=>hv(y,r,a,u));else{const y=Ti(e.handler)?e.handler.bind(a):r[e.handler];Ti(y)&&ks(d,y,e)}}function $m(e){const r=e.type,{mixins:a,extends:u}=r,{mixins:d,optionsCache:y,config:{optionMergeStrategies:m}}=e.appContext,l=y.get(r);let T;return l?T=l:!d.length&&!a&&!u?T=r:(T={},d.length&&d.forEach(P=>Qd(T,P,m,!0)),Qd(T,r,m)),Ur(r)&&y.set(r,T),T}function Qd(e,r,a,u=!1){const{mixins:d,extends:y}=r;y&&Qd(e,y,a,!0),d&&d.forEach(m=>Qd(e,m,a,!0));for(const m in r)if(!(u&&m==="expose")){const l=c2[m]||a&&a[m];e[m]=l?l(e[m],r[m]):r[m]}return e}const c2={data:Ky,props:Yy,emits:Yy,methods:oh,computed:oh,beforeCreate:ds,created:ds,beforeMount:ds,mounted:ds,beforeUpdate:ds,updated:ds,beforeDestroy:ds,beforeUnmount:ds,destroyed:ds,unmounted:ds,activated:ds,deactivated:ds,errorCaptured:ds,serverPrefetch:ds,components:oh,directives:oh,watch:h2,provide:Ky,inject:u2};function Ky(e,r){return r?e?function(){return Vn(Ti(e)?e.call(this,this):e,Ti(r)?r.call(this,this):r)}:r:e}function u2(e,r){return oh(rm(e),rm(r))}function rm(e){if(yi(e)){const r={};for(let a=0;a<e.length;a++)r[e[a]]=e[a];return r}return e}function ds(e,r){return e?[...new Set([].concat(e,r))]:r}function oh(e,r){return e?Vn(Object.create(null),e,r):r}function Yy(e,r){return e?yi(e)&&yi(r)?[...new Set([...e,...r])]:Vn(Object.create(null),Wy(e),Wy(r??{})):r}function h2(e,r){if(!e)return r;if(!r)return e;const a=Vn(Object.create(null),e);for(const u in r)a[u]=ds(e[u],r[u]);return a}function dv(){return{app:null,config:{isNativeTag:Hb,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let d2=0;function f2(e,r){return function(u,d=null){Ti(u)||(u=Vn({},u)),d!=null&&!Ur(d)&&(d=null);const y=dv(),m=new WeakSet;let l=!1;const T=y.app={_uid:d2++,_component:u,_props:d,_container:null,_context:y,_instance:null,version:N2,get config(){return y.config},set config(P){},use(P,...z){return m.has(P)||(P&&Ti(P.install)?(m.add(P),P.install(T,...z)):Ti(P)&&(m.add(P),P(T,...z))),T},mixin(P){return y.mixins.includes(P)||y.mixins.push(P),T},component(P,z){return z?(y.components[P]=z,T):y.components[P]},directive(P,z){return z?(y.directives[P]=z,T):y.directives[P]},mount(P,z,k){if(!l){const R=tr(u,d);return R.appContext=y,k===!0?k="svg":k===!1&&(k=void 0),z&&r?r(R,P):e(R,P,k),l=!0,T._container=P,P.__vue_app__=T,Tf(R.component)||R.component.proxy}},unmount(){l&&(e(null,T._container),delete T._container.__vue_app__)},provide(P,z){return y.provides[P]=z,T},runWithContext(P){const z=ru;ru=T;try{return P()}finally{ru=z}}};return T}}let ru=null;function Nd(e,r){if(Un){let a=Un.provides;const u=Un.parent&&Un.parent.provides;u===a&&(a=Un.provides=Object.create(u)),a[e]=r}}function da(e,r,a=!1){const u=Un||En;if(u||ru){const d=u?u.parent==null?u.vnode.appContext&&u.vnode.appContext.provides:u.parent.provides:ru._context.provides;if(d&&e in d)return d[e];if(arguments.length>1)return a&&Ti(r)?r.call(u&&u.proxy):r}}function p2(){return!!(Un||En||ru)}function m2(e,r,a,u=!1){const d={},y={};Xd(y,Sf,1),e.propsDefaults=Object.create(null),fv(e,r,d,y);for(const m in e.propsOptions[0])m in d||(d[m]=void 0);a?e.props=u?d:j0(d):e.type.props?e.props=d:e.props=y,e.attrs=y}function g2(e,r,a,u){const{props:d,attrs:y,vnode:{patchFlag:m}}=e,l=Hi(d),[T]=e.propsOptions;let P=!1;if((u||m>0)&&!(m&16)){if(m&8){const z=e.vnode.dynamicProps;for(let k=0;k<z.length;k++){let R=z[k];if(xf(e.emitsOptions,R))continue;const Z=r[R];if(T)if(Gi(y,R))Z!==y[R]&&(y[R]=Z,P=!0);else{const K=so(R);d[K]=nm(T,l,K,Z,e,!1)}else Z!==y[R]&&(y[R]=Z,P=!0)}}}else{fv(e,r,d,y)&&(P=!0);let z;for(const k in l)(!r||!Gi(r,k)&&((z=hc(k))===k||!Gi(r,z)))&&(T?a&&(a[k]!==void 0||a[z]!==void 0)&&(d[k]=nm(T,l,k,void 0,e,!0)):delete d[k]);if(y!==l)for(const k in y)(!r||!Gi(r,k))&&(delete y[k],P=!0)}P&&Po(e,"set","$attrs")}function fv(e,r,a,u){const[d,y]=e.propsOptions;let m=!1,l;if(r)for(let T in r){if(hh(T))continue;const P=r[T];let z;d&&Gi(d,z=so(T))?!y||!y.includes(z)?a[z]=P:(l||(l={}))[z]=P:xf(e.emitsOptions,T)||(!(T in u)||P!==u[T])&&(u[T]=P,m=!0)}if(y){const T=Hi(a),P=l||Or;for(let z=0;z<y.length;z++){const k=y[z];a[k]=nm(d,T,k,P[k],e,!Gi(P,k))}}return m}function nm(e,r,a,u,d,y){const m=e[a];if(m!=null){const l=Gi(m,"default");if(l&&u===void 0){const T=m.default;if(m.type!==Function&&!m.skipFactory&&Ti(T)){const{propsDefaults:P}=d;if(a in P)u=P[a];else{const z=$h(d);u=P[a]=T.call(null,r),z()}}else u=T}m[0]&&(y&&!l?u=!1:m[1]&&(u===""||u===hc(a))&&(u=!0))}return u}function pv(e,r,a=!1){const u=r.propsCache,d=u.get(e);if(d)return d;const y=e.props,m={},l=[];let T=!1;if(!Ti(e)){const z=k=>{T=!0;const[R,Z]=pv(k,r,!0);Vn(m,R),Z&&l.push(...Z)};!a&&r.mixins.length&&r.mixins.forEach(z),e.extends&&z(e.extends),e.mixins&&e.mixins.forEach(z)}if(!y&&!T)return Ur(e)&&u.set(e,eu),eu;if(yi(y))for(let z=0;z<y.length;z++){const k=so(y[z]);Jy(k)&&(m[k]=Or)}else if(y)for(const z in y){const k=so(z);if(Jy(k)){const R=y[z],Z=m[k]=yi(R)||Ti(R)?{type:R}:Vn({},R);if(Z){const K=t_(Boolean,Z.type),Y=t_(String,Z.type);Z[0]=K>-1,Z[1]=Y<0||K<Y,(K>-1||Gi(Z,"default"))&&l.push(k)}}}const P=[m,l];return Ur(e)&&u.set(e,P),P}function Jy(e){return e[0]!=="$"&&!hh(e)}function Qy(e){return e===null?"null":typeof e=="function"?e.name||"":typeof e=="object"&&e.constructor&&e.constructor.name||""}function e_(e,r){return Qy(e)===Qy(r)}function t_(e,r){return yi(r)?r.findIndex(a=>e_(a,e)):Ti(r)&&e_(r,e)?0:-1}const mv=e=>e[0]==="_"||e==="$stable",Um=e=>yi(e)?e.map(eo):[eo(e)],y2=(e,r,a)=>{if(r._n)return r;const u=Ao((...d)=>Um(r(...d)),a);return u._c=!1,u},gv=(e,r,a)=>{const u=e._ctx;for(const d in e){if(mv(d))continue;const y=e[d];if(Ti(y))r[d]=y2(d,y,u);else if(y!=null){const m=Um(y);r[d]=()=>m}}},yv=(e,r)=>{const a=Um(r);e.slots.default=()=>a},_2=(e,r)=>{if(e.vnode.shapeFlag&32){const a=r._;a?(e.slots=Hi(r),Xd(r,"_",a)):gv(r,e.slots={})}else e.slots={},r&&yv(e,r);Xd(e.slots,Sf,1)},v2=(e,r,a)=>{const{vnode:u,slots:d}=e;let y=!0,m=Or;if(u.shapeFlag&32){const l=r._;l?a&&l===1?y=!1:(Vn(d,r),!a&&l===1&&delete d._):(y=!r.$stable,gv(r,d)),m=r}else r&&(yv(e,r),m={default:1});if(y)for(const l in d)!mv(l)&&m[l]==null&&delete d[l]};function sm(e,r,a,u,d=!1){if(yi(e)){e.forEach((R,Z)=>sm(R,r&&(yi(r)?r[Z]:r),a,u,d));return}if(dh(u)&&!d)return;const y=u.shapeFlag&4?Tf(u.component)||u.component.proxy:u.el,m=d?null:y,{i:l,r:T}=e,P=r&&r.r,z=l.refs===Or?l.refs={}:l.refs,k=l.setupState;if(P!=null&&P!==T&&(Tn(P)?(z[P]=null,Gi(k,P)&&(k[P]=null)):In(P)&&(P.value=null)),Ti(T))bl(T,l,12,[m,z]);else{const R=Tn(T),Z=In(T);if(R||Z){const K=()=>{if(e.f){const Y=R?Gi(k,T)?k[T]:z[T]:T.value;d?yi(Y)&&Im(Y,y):yi(Y)?Y.includes(y)||Y.push(y):R?(z[T]=[y],Gi(k,T)&&(k[T]=z[T])):(T.value=[y],e.k&&(z[e.k]=T.value))}else R?(z[T]=m,Gi(k,T)&&(k[T]=m)):Z&&(T.value=m,e.k&&(z[e.k]=m))};m?(K.id=-1,Cs(K,a)):K()}}}const Cs=Gw;function x2(e){return b2(e)}function b2(e,r){const a=T0();a.__VUE__=!0;const{insert:u,remove:d,patchProp:y,createElement:m,createText:l,createComment:T,setText:P,setElementText:z,parentNode:k,nextSibling:R,setScopeId:Z=ha,insertStaticContent:K}=e,Y=(se,ce,Pe,Oe=null,le=null,ft=null,Ct=void 0,Be=null,nt=!!ce.dynamicChildren)=>{if(se===ce)return;se&&!Qu(se,ce)&&(Oe=Ve(se),rt(se,le,ft,!0),se=null),ce.patchFlag===-2&&(nt=!1,ce.dynamicChildren=null);const{type:it,ref:At,shapeFlag:Gt}=ce;switch(it){case Mf:ge(se,ce,Pe,Oe);break;case Sl:Te(se,ce,Pe,Oe);break;case $d:se==null&&Fe(ce,Pe,Oe,Ct);break;case $r:oi(se,ce,Pe,Oe,le,ft,Ct,Be,nt);break;default:Gt&1?We(se,ce,Pe,Oe,le,ft,Ct,Be,nt):Gt&6?pi(se,ce,Pe,Oe,le,ft,Ct,Be,nt):(Gt&64||Gt&128)&&it.process(se,ce,Pe,Oe,le,ft,Ct,Be,nt,Je)}At!=null&&le&&sm(At,se&&se.ref,ft,ce||se,!ce)},ge=(se,ce,Pe,Oe)=>{if(se==null)u(ce.el=l(ce.children),Pe,Oe);else{const le=ce.el=se.el;ce.children!==se.children&&P(le,ce.children)}},Te=(se,ce,Pe,Oe)=>{se==null?u(ce.el=T(ce.children||""),Pe,Oe):ce.el=se.el},Fe=(se,ce,Pe,Oe)=>{[se.el,se.anchor]=K(se.children,ce,Pe,Oe,se.el,se.anchor)},he=({el:se,anchor:ce},Pe,Oe)=>{let le;for(;se&&se!==ce;)le=R(se),u(se,Pe,Oe),se=le;u(ce,Pe,Oe)},Le=({el:se,anchor:ce})=>{let Pe;for(;se&&se!==ce;)Pe=R(se),d(se),se=Pe;d(ce)},We=(se,ce,Pe,Oe,le,ft,Ct,Be,nt)=>{ce.type==="svg"?Ct="svg":ce.type==="math"&&(Ct="mathml"),se==null?Qe(ce,Pe,Oe,le,ft,Ct,Be,nt):lt(se,ce,le,ft,Ct,Be,nt)},Qe=(se,ce,Pe,Oe,le,ft,Ct,Be)=>{let nt,it;const{props:At,shapeFlag:Gt,transition:jt,dirs:Wt}=se;if(nt=se.el=m(se.type,ft,At&&At.is,At),Gt&8?z(nt,se.children):Gt&16&&He(se.children,nt,null,Oe,le,kp(se,ft),Ct,Be),Wt&&ec(se,null,Oe,"created"),bt(nt,se,se.scopeId,Ct,Oe),At){for(const Si in At)Si!=="value"&&!hh(Si)&&y(nt,Si,null,At[Si],ft,se.children,Oe,le,wi);"value"in At&&y(nt,"value",null,At.value,ft),(it=At.onVnodeBeforeMount)&&Ya(it,Oe,se)}Wt&&ec(se,null,Oe,"beforeMount");const mi=w2(le,jt);mi&&jt.beforeEnter(nt),u(nt,ce,Pe),((it=At&&At.onVnodeMounted)||mi||Wt)&&Cs(()=>{it&&Ya(it,Oe,se),mi&&jt.enter(nt),Wt&&ec(se,null,Oe,"mounted")},le)},bt=(se,ce,Pe,Oe,le)=>{if(Pe&&Z(se,Pe),Oe)for(let ft=0;ft<Oe.length;ft++)Z(se,Oe[ft]);if(le){let ft=le.subTree;if(ce===ft){const Ct=le.vnode;bt(se,Ct,Ct.scopeId,Ct.slotScopeIds,le.parent)}}},He=(se,ce,Pe,Oe,le,ft,Ct,Be,nt=0)=>{for(let it=nt;it<se.length;it++){const At=se[it]=Be?gl(se[it]):eo(se[it]);Y(null,At,ce,Pe,Oe,le,ft,Ct,Be)}},lt=(se,ce,Pe,Oe,le,ft,Ct)=>{const Be=ce.el=se.el;let{patchFlag:nt,dynamicChildren:it,dirs:At}=ce;nt|=se.patchFlag&16;const Gt=se.props||Or,jt=ce.props||Or;let Wt;if(Pe&&tc(Pe,!1),(Wt=jt.onVnodeBeforeUpdate)&&Ya(Wt,Pe,ce,se),At&&ec(ce,se,Pe,"beforeUpdate"),Pe&&tc(Pe,!0),it?Rt(se.dynamicChildren,it,Be,Pe,Oe,kp(ce,le),ft):Ct||gi(se,ce,Be,null,Pe,Oe,kp(ce,le),ft,!1),nt>0){if(nt&16)Pt(Be,ce,Gt,jt,Pe,Oe,le);else if(nt&2&&Gt.class!==jt.class&&y(Be,"class",null,jt.class,le),nt&4&&y(Be,"style",Gt.style,jt.style,le),nt&8){const mi=ce.dynamicProps;for(let Si=0;Si<mi.length;Si++){const Ue=mi[Si],Oi=Gt[Ue],Zi=jt[Ue];(Zi!==Oi||Ue==="value")&&y(Be,Ue,Oi,Zi,le,se.children,Pe,Oe,wi)}}nt&1&&se.children!==ce.children&&z(Be,ce.children)}else!Ct&&it==null&&Pt(Be,ce,Gt,jt,Pe,Oe,le);((Wt=jt.onVnodeUpdated)||At)&&Cs(()=>{Wt&&Ya(Wt,Pe,ce,se),At&&ec(ce,se,Pe,"updated")},Oe)},Rt=(se,ce,Pe,Oe,le,ft,Ct)=>{for(let Be=0;Be<ce.length;Be++){const nt=se[Be],it=ce[Be],At=nt.el&&(nt.type===$r||!Qu(nt,it)||nt.shapeFlag&70)?k(nt.el):Pe;Y(nt,it,At,null,Oe,le,ft,Ct,!0)}},Pt=(se,ce,Pe,Oe,le,ft,Ct)=>{if(Pe!==Oe){if(Pe!==Or)for(const Be in Pe)!hh(Be)&&!(Be in Oe)&&y(se,Be,Pe[Be],null,Ct,ce.children,le,ft,wi);for(const Be in Oe){if(hh(Be))continue;const nt=Oe[Be],it=Pe[Be];nt!==it&&Be!=="value"&&y(se,Be,it,nt,Ct,ce.children,le,ft,wi)}"value"in Oe&&y(se,"value",Pe.value,Oe.value,Ct)}},oi=(se,ce,Pe,Oe,le,ft,Ct,Be,nt)=>{const it=ce.el=se?se.el:l(""),At=ce.anchor=se?se.anchor:l("");let{patchFlag:Gt,dynamicChildren:jt,slotScopeIds:Wt}=ce;Wt&&(Be=Be?Be.concat(Wt):Wt),se==null?(u(it,Pe,Oe),u(At,Pe,Oe),He(ce.children||[],Pe,At,le,ft,Ct,Be,nt)):Gt>0&&Gt&64&&jt&&se.dynamicChildren?(Rt(se.dynamicChildren,jt,Pe,le,ft,Ct,Be),(ce.key!=null||le&&ce===le.subTree)&&_v(se,ce,!0)):gi(se,ce,Pe,At,le,ft,Ct,Be,nt)},pi=(se,ce,Pe,Oe,le,ft,Ct,Be,nt)=>{ce.slotScopeIds=Be,se==null?ce.shapeFlag&512?le.ctx.activate(ce,Pe,Oe,Ct,nt):Yt(ce,Pe,Oe,le,ft,Ct,nt):cr(se,ce,nt)},Yt=(se,ce,Pe,Oe,le,ft,Ct)=>{const Be=se.component=D2(se,Oe,le);if(av(se)&&(Be.ctx.renderer=Je),L2(Be),Be.asyncDep){if(le&&le.registerDep(Be,si),!se.el){const nt=Be.subTree=tr(Sl);Te(null,nt,ce,Pe)}}else si(Be,se,ce,Pe,le,ft,Ct)},cr=(se,ce,Pe)=>{const Oe=ce.component=se.component;if($w(se,ce,Pe))if(Oe.asyncDep&&!Oe.asyncResolved){Qt(Oe,ce,Pe);return}else Oe.next=ce,Rw(Oe.update),Oe.effect.dirty=!0,Oe.update();else ce.el=se.el,Oe.vnode=ce},si=(se,ce,Pe,Oe,le,ft,Ct)=>{const Be=()=>{if(se.isMounted){let{next:At,bu:Gt,u:jt,parent:Wt,vnode:mi}=se;{const pn=vv(se);if(pn){At&&(At.el=mi.el,Qt(se,At,Ct)),pn.asyncDep.then(()=>{se.isUnmounted||Be()});return}}let Si=At,Ue;tc(se,!1),At?(At.el=mi.el,Qt(se,At,Ct)):At=mi,Gt&&Fd(Gt),(Ue=At.props&&At.props.onVnodeBeforeUpdate)&&Ya(Ue,Wt,At,mi),tc(se,!0);const Oi=Ap(se),Zi=se.subTree;se.subTree=Oi,Y(Zi,Oi,k(Zi.el),Ve(Zi),se,le,ft),At.el=Oi.el,Si===null&&Uw(se,Oi.el),jt&&Cs(jt,le),(Ue=At.props&&At.props.onVnodeUpdated)&&Cs(()=>Ya(Ue,Wt,At,mi),le)}else{let At;const{el:Gt,props:jt}=ce,{bm:Wt,m:mi,parent:Si}=se,Ue=dh(ce);if(tc(se,!1),Wt&&Fd(Wt),!Ue&&(At=jt&&jt.onVnodeBeforeMount)&&Ya(At,Si,ce),tc(se,!0),Gt&&Ri){const Oi=()=>{se.subTree=Ap(se),Ri(Gt,se.subTree,se,le,null)};Ue?ce.type.__asyncLoader().then(()=>!se.isUnmounted&&Oi()):Oi()}else{const Oi=se.subTree=Ap(se);Y(null,Oi,Pe,Oe,se,le,ft),ce.el=Oi.el}if(mi&&Cs(mi,le),!Ue&&(At=jt&&jt.onVnodeMounted)){const Oi=ce;Cs(()=>Ya(At,Si,Oi),le)}(ce.shapeFlag&256||Si&&dh(Si.vnode)&&Si.vnode.shapeFlag&256)&&se.a&&Cs(se.a,le),se.isMounted=!0,ce=Pe=Oe=null}},nt=se.effect=new Pm(Be,ha,()=>Nm(it),se.scope),it=se.update=()=>{nt.dirty&&nt.run()};it.id=se.uid,tc(se,!0),it()},Qt=(se,ce,Pe)=>{ce.component=se;const Oe=se.vnode.props;se.vnode=ce,se.next=null,g2(se,ce.props,Oe,Pe),v2(se,ce.children,Pe),dc(),Gy(se),fc()},gi=(se,ce,Pe,Oe,le,ft,Ct,Be,nt=!1)=>{const it=se&&se.children,At=se?se.shapeFlag:0,Gt=ce.children,{patchFlag:jt,shapeFlag:Wt}=ce;if(jt>0){if(jt&128){Ar(it,Gt,Pe,Oe,le,ft,Ct,Be,nt);return}else if(jt&256){ur(it,Gt,Pe,Oe,le,ft,Ct,Be,nt);return}}Wt&8?(At&16&&wi(it,le,ft),Gt!==it&&z(Pe,Gt)):At&16?Wt&16?Ar(it,Gt,Pe,Oe,le,ft,Ct,Be,nt):wi(it,le,ft,!0):(At&8&&z(Pe,""),Wt&16&&He(Gt,Pe,Oe,le,ft,Ct,Be,nt))},ur=(se,ce,Pe,Oe,le,ft,Ct,Be,nt)=>{se=se||eu,ce=ce||eu;const it=se.length,At=ce.length,Gt=Math.min(it,At);let jt;for(jt=0;jt<Gt;jt++){const Wt=ce[jt]=nt?gl(ce[jt]):eo(ce[jt]);Y(se[jt],Wt,Pe,null,le,ft,Ct,Be,nt)}it>At?wi(se,le,ft,!0,!1,Gt):He(ce,Pe,Oe,le,ft,Ct,Be,nt,Gt)},Ar=(se,ce,Pe,Oe,le,ft,Ct,Be,nt)=>{let it=0;const At=ce.length;let Gt=se.length-1,jt=At-1;for(;it<=Gt&&it<=jt;){const Wt=se[it],mi=ce[it]=nt?gl(ce[it]):eo(ce[it]);if(Qu(Wt,mi))Y(Wt,mi,Pe,null,le,ft,Ct,Be,nt);else break;it++}for(;it<=Gt&&it<=jt;){const Wt=se[Gt],mi=ce[jt]=nt?gl(ce[jt]):eo(ce[jt]);if(Qu(Wt,mi))Y(Wt,mi,Pe,null,le,ft,Ct,Be,nt);else break;Gt--,jt--}if(it>Gt){if(it<=jt){const Wt=jt+1,mi=Wt<At?ce[Wt].el:Oe;for(;it<=jt;)Y(null,ce[it]=nt?gl(ce[it]):eo(ce[it]),Pe,mi,le,ft,Ct,Be,nt),it++}}else if(it>jt)for(;it<=Gt;)rt(se[it],le,ft,!0),it++;else{const Wt=it,mi=it,Si=new Map;for(it=mi;it<=jt;it++){const Ft=ce[it]=nt?gl(ce[it]):eo(ce[it]);Ft.key!=null&&Si.set(Ft.key,it)}let Ue,Oi=0;const Zi=jt-mi+1;let pn=!1,wr=0;const st=new Array(Zi);for(it=0;it<Zi;it++)st[it]=0;for(it=Wt;it<=Gt;it++){const Ft=se[it];if(Oi>=Zi){rt(Ft,le,ft,!0);continue}let $i;if(Ft.key!=null)$i=Si.get(Ft.key);else for(Ue=mi;Ue<=jt;Ue++)if(st[Ue-mi]===0&&Qu(Ft,ce[Ue])){$i=Ue;break}$i===void 0?rt(Ft,le,ft,!0):(st[$i-mi]=it+1,$i>=wr?wr=$i:pn=!0,Y(Ft,ce[$i],Pe,null,le,ft,Ct,Be,nt),Oi++)}const li=pn?M2(st):eu;for(Ue=li.length-1,it=Zi-1;it>=0;it--){const Ft=mi+it,$i=ce[Ft],mn=Ft+1<At?ce[Ft+1].el:Oe;st[it]===0?Y(null,$i,Pe,mn,le,ft,Ct,Be,nt):pn&&(Ue<0||it!==li[Ue]?ut($i,Pe,mn,2):Ue--)}}},ut=(se,ce,Pe,Oe,le=null)=>{const{el:ft,type:Ct,transition:Be,children:nt,shapeFlag:it}=se;if(it&6){ut(se.component.subTree,ce,Pe,Oe);return}if(it&128){se.suspense.move(ce,Pe,Oe);return}if(it&64){Ct.move(se,ce,Pe,Je);return}if(Ct===$r){u(ft,ce,Pe);for(let Gt=0;Gt<nt.length;Gt++)ut(nt[Gt],ce,Pe,Oe);u(se.anchor,ce,Pe);return}if(Ct===$d){he(se,ce,Pe);return}if(Oe!==2&&it&1&&Be)if(Oe===0)Be.beforeEnter(ft),u(ft,ce,Pe),Cs(()=>Be.enter(ft),le);else{const{leave:Gt,delayLeave:jt,afterLeave:Wt}=Be,mi=()=>u(ft,ce,Pe),Si=()=>{Gt(ft,()=>{mi(),Wt&&Wt()})};jt?jt(ft,mi,Si):Si()}else u(ft,ce,Pe)},rt=(se,ce,Pe,Oe=!1,le=!1)=>{const{type:ft,props:Ct,ref:Be,children:nt,dynamicChildren:it,shapeFlag:At,patchFlag:Gt,dirs:jt}=se;if(Be!=null&&sm(Be,null,Pe,se,!0),At&256){ce.ctx.deactivate(se);return}const Wt=At&1&&jt,mi=!dh(se);let Si;if(mi&&(Si=Ct&&Ct.onVnodeBeforeUnmount)&&Ya(Si,ce,se),At&6)ji(se.component,Pe,Oe);else{if(At&128){se.suspense.unmount(Pe,Oe);return}Wt&&ec(se,null,ce,"beforeUnmount"),At&64?se.type.remove(se,ce,Pe,le,Je,Oe):it&&(ft!==$r||Gt>0&&Gt&64)?wi(it,ce,Pe,!1,!0):(ft===$r&&Gt&384||!le&&At&16)&&wi(nt,ce,Pe),Oe&&et(se)}(mi&&(Si=Ct&&Ct.onVnodeUnmounted)||Wt)&&Cs(()=>{Si&&Ya(Si,ce,se),Wt&&ec(se,null,ce,"unmounted")},Pe)},et=se=>{const{type:ce,el:Pe,anchor:Oe,transition:le}=se;if(ce===$r){ir(Pe,Oe);return}if(ce===$d){Le(se);return}const ft=()=>{d(Pe),le&&!le.persisted&&le.afterLeave&&le.afterLeave()};if(se.shapeFlag&1&&le&&!le.persisted){const{leave:Ct,delayLeave:Be}=le,nt=()=>Ct(Pe,ft);Be?Be(se.el,ft,nt):nt()}else ft()},ir=(se,ce)=>{let Pe;for(;se!==ce;)Pe=R(se),d(se),se=Pe;d(ce)},ji=(se,ce,Pe)=>{const{bum:Oe,scope:le,update:ft,subTree:Ct,um:Be}=se;Oe&&Fd(Oe),le.stop(),ft&&(ft.active=!1,rt(Ct,se,ce,Pe)),Be&&Cs(Be,ce),Cs(()=>{se.isUnmounted=!0},ce),ce&&ce.pendingBranch&&!ce.isUnmounted&&se.asyncDep&&!se.asyncResolved&&se.suspenseId===ce.pendingId&&(ce.deps--,ce.deps===0&&ce.resolve())},wi=(se,ce,Pe,Oe=!1,le=!1,ft=0)=>{for(let Ct=ft;Ct<se.length;Ct++)rt(se[Ct],ce,Pe,Oe,le)},Ve=se=>se.shapeFlag&6?Ve(se.component.subTree):se.shapeFlag&128?se.suspense.next():R(se.anchor||se.el);let Et=!1;const ht=(se,ce,Pe)=>{se==null?ce._vnode&&rt(ce._vnode,null,null,!0):Y(ce._vnode||null,se,ce,null,null,null,Pe),Et||(Et=!0,Gy(),J0(),Et=!1),ce._vnode=se},Je={p:Y,um:rt,m:ut,r:et,mt:Yt,mc:He,pc:gi,pbc:Rt,n:Ve,o:e};let Pi,Ri;return r&&([Pi,Ri]=r(Je)),{render:ht,hydrate:Pi,createApp:f2(ht,Pi)}}function kp({type:e,props:r},a){return a==="svg"&&e==="foreignObject"||a==="mathml"&&e==="annotation-xml"&&r&&r.encoding&&r.encoding.includes("html")?void 0:a}function tc({effect:e,update:r},a){e.allowRecurse=r.allowRecurse=a}function w2(e,r){return(!e||e&&!e.pendingBranch)&&r&&!r.persisted}function _v(e,r,a=!1){const u=e.children,d=r.children;if(yi(u)&&yi(d))for(let y=0;y<u.length;y++){const m=u[y];let l=d[y];l.shapeFlag&1&&!l.dynamicChildren&&((l.patchFlag<=0||l.patchFlag===32)&&(l=d[y]=gl(d[y]),l.el=m.el),a||_v(m,l)),l.type===Mf&&(l.el=m.el)}}function M2(e){const r=e.slice(),a=[0];let u,d,y,m,l;const T=e.length;for(u=0;u<T;u++){const P=e[u];if(P!==0){if(d=a[a.length-1],e[d]<P){r[u]=d,a.push(u);continue}for(y=0,m=a.length-1;y<m;)l=y+m>>1,e[a[l]]<P?y=l+1:m=l;P<e[a[y]]&&(y>0&&(r[u]=a[y-1]),a[y]=u)}}for(y=a.length,m=a[y-1];y-- >0;)a[y]=m,m=r[m];return a}function vv(e){const r=e.subTree.component;if(r)return r.asyncDep&&!r.asyncResolved?r:vv(r)}const S2=e=>e.__isTeleport,$r=Symbol.for("v-fgt"),Mf=Symbol.for("v-txt"),Sl=Symbol.for("v-cmt"),$d=Symbol.for("v-stc"),ph=[];let ka=null;function Dt(e=!1){ph.push(ka=e?null:[])}function E2(){ph.pop(),ka=ph[ph.length-1]||null}let Th=1;function i_(e){Th+=e}function xv(e){return e.dynamicChildren=Th>0?ka||eu:null,E2(),Th>0&&ka&&ka.push(e),e}function Ht(e,r,a,u,d,y){return xv(ne(e,r,a,u,d,y,!0))}function Qa(e,r,a,u,d){return xv(tr(e,r,a,u,d,!0))}function ef(e){return e?e.__v_isVNode===!0:!1}function Qu(e,r){return e.type===r.type&&e.key===r.key}const Sf="__vInternal",bv=({key:e})=>e??null,Ud=({ref:e,ref_key:r,ref_for:a})=>(typeof e=="number"&&(e=""+e),e!=null?Tn(e)||In(e)||Ti(e)?{i:En,r:e,k:r,f:!!a}:e:null);function ne(e,r=null,a=null,u=0,d=null,y=e===$r?0:1,m=!1,l=!1){const T={__v_isVNode:!0,__v_skip:!0,type:e,props:r,key:r&&bv(r),ref:r&&Ud(r),scopeId:bf,slotScopeIds:null,children:a,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:y,patchFlag:u,dynamicProps:d,dynamicChildren:null,appContext:null,ctx:En};return l?(Vm(T,a),y&128&&e.normalize(T)):a&&(T.shapeFlag|=Tn(a)?8:16),Th>0&&!m&&ka&&(T.patchFlag>0||y&6)&&T.patchFlag!==32&&ka.push(T),T}const tr=T2;function T2(e,r=null,a=null,u=0,d=null,y=!1){if((!e||e===Vw)&&(e=Sl),ef(e)){const l=ou(e,r,!0);return a&&Vm(l,a),Th>0&&!y&&ka&&(l.shapeFlag&6?ka[ka.indexOf(e)]=l:ka.push(l)),l.patchFlag|=-2,l}if(B2(e)&&(e=e.__vccOpts),r){r=I2(r);let{class:l,style:T}=r;l&&!Tn(l)&&(r.class=As(l)),Ur(T)&&(G0(T)&&!yi(T)&&(T=Vn({},T)),r.style=Am(T))}const m=Tn(e)?1:qw(e)?128:S2(e)?64:Ur(e)?4:Ti(e)?2:0;return ne(e,r,a,u,d,m,y,!0)}function I2(e){return e?G0(e)||Sf in e?Vn({},e):e:null}function ou(e,r,a=!1){const{props:u,ref:d,patchFlag:y,children:m}=e,l=r?A2(u||{},r):u;return{__v_isVNode:!0,__v_skip:!0,type:e.type,props:l,key:l&&bv(l),ref:r&&r.ref?a&&d?yi(d)?d.concat(Ud(r)):[d,Ud(r)]:Ud(r):d,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:m,target:e.target,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:r&&e.type!==$r?y===-1?16:y|16:y,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:e.transition,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&ou(e.ssContent),ssFallback:e.ssFallback&&ou(e.ssFallback),el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce}}function tf(e=" ",r=0){return tr(Mf,null,e,r)}function C2(e,r){const a=tr($d,null,e);return a.staticCount=r,a}function Ki(e="",r=!1){return r?(Dt(),Qa(Sl,null,e)):tr(Sl,null,e)}function eo(e){return e==null||typeof e=="boolean"?tr(Sl):yi(e)?tr($r,null,e.slice()):typeof e=="object"?gl(e):tr(Mf,null,String(e))}function gl(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:ou(e)}function Vm(e,r){let a=0;const{shapeFlag:u}=e;if(r==null)r=null;else if(yi(r))a=16;else if(typeof r=="object")if(u&65){const d=r.default;d&&(d._c&&(d._d=!1),Vm(e,d()),d._c&&(d._d=!0));return}else{a=32;const d=r._;!d&&!(Sf in r)?r._ctx=En:d===3&&En&&(En.slots._===1?r._=1:(r._=2,e.patchFlag|=1024))}else Ti(r)?(r={default:r,_ctx:En},a=32):(r=String(r),u&64?(a=16,r=[tf(r)]):a=8);e.children=r,e.shapeFlag|=a}function A2(...e){const r={};for(let a=0;a<e.length;a++){const u=e[a];for(const d in u)if(d==="class")r.class!==u.class&&(r.class=As([r.class,u.class]));else if(d==="style")r.style=Am([r.style,u.style]);else if(ff(d)){const y=r[d],m=u[d];m&&y!==m&&!(yi(y)&&y.includes(m))&&(r[d]=y?[].concat(y,m):m)}else d!==""&&(r[d]=u[d])}return r}function Ya(e,r,a,u=null){La(e,r,7,[a,u])}const P2=dv();let k2=0;function D2(e,r,a){const u=e.type,d=(r?r.appContext:e.appContext)||P2,y={uid:k2++,vnode:e,type:u,parent:r,appContext:d,root:null,next:null,subTree:null,effect:null,update:null,scope:new A0(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:r?r.provides:Object.create(d.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:pv(u,d),emitsOptions:ev(u,d),emit:null,emitted:null,propsDefaults:Or,inheritAttrs:u.inheritAttrs,ctx:Or,data:Or,props:Or,attrs:Or,slots:Or,refs:Or,setupState:Or,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:a,suspenseId:a?a.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return y.ctx={_:y},y.root=r?r.root:y,y.emit=Fw.bind(null,y),e.ce&&e.ce(y),y}let Un=null,rf,am;{const e=T0(),r=(a,u)=>{let d;return(d=e[a])||(d=e[a]=[]),d.push(u),y=>{d.length>1?d.forEach(m=>m(y)):d[0](y)}};rf=r("__VUE_INSTANCE_SETTERS__",a=>Un=a),am=r("__VUE_SSR_SETTERS__",a=>Ef=a)}const $h=e=>{const r=Un;return rf(e),e.scope.on(),()=>{e.scope.off(),rf(r)}},r_=()=>{Un&&Un.scope.off(),rf(null)};function wv(e){return e.vnode.shapeFlag&4}let Ef=!1;function L2(e,r=!1){r&&am(r);const{props:a,children:u}=e.vnode,d=wv(e);m2(e,a,d,r),_2(e,u);const y=d?R2(e,r):void 0;return r&&am(!1),y}function R2(e,r){const a=e.type;e.accessCache=Object.create(null),e.proxy=_f(new Proxy(e.ctx,a2));const{setup:u}=a;if(u){const d=e.setupContext=u.length>1?O2(e):null,y=$h(e);dc();const m=bl(u,e,0,[e.props,d]);if(fc(),y(),M0(m)){if(m.then(r_,r_),r)return m.then(l=>{n_(e,l,r)}).catch(l=>{vf(l,e,0)});e.asyncDep=m}else n_(e,m,r)}else Mv(e,r)}function n_(e,r,a){Ti(r)?e.type.__ssrInlineRender?e.ssrRender=r:e.render=r:Ur(r)&&(e.setupState=X0(r)),Mv(e,a)}let s_;function Mv(e,r,a){const u=e.type;if(!e.render){if(!r&&s_&&!u.render){const d=u.template||$m(e).template;if(d){const{isCustomElement:y,compilerOptions:m}=e.appContext.config,{delimiters:l,compilerOptions:T}=u,P=Vn(Vn({isCustomElement:y,delimiters:l},m),T);u.render=s_(d,P)}}e.render=u.render||ha}{const d=$h(e);dc();try{o2(e)}finally{fc(),d()}}}function z2(e){return e.attrsProxy||(e.attrsProxy=new Proxy(e.attrs,{get(r,a){return Ds(e,"get","$attrs"),r[a]}}))}function O2(e){const r=a=>{e.exposed=a||{}};return{get attrs(){return z2(e)},slots:e.slots,emit:e.emit,expose:r}}function Tf(e){if(e.exposed)return e.exposeProxy||(e.exposeProxy=new Proxy(X0(_f(e.exposed)),{get(r,a){if(a in r)return r[a];if(a in fh)return fh[a](e)},has(r,a){return a in r||a in fh}}))}function F2(e,r=!0){return Ti(e)?e.displayName||e.name:e.name||r&&e.__name}function B2(e){return Ti(e)&&"__vccOpts"in e}const Ai=(e,r)=>Ew(e,r,Ef);function Sv(e,r,a){const u=arguments.length;return u===2?Ur(r)&&!yi(r)?ef(r)?tr(e,null,[r]):tr(e,r):tr(e,null,r):(u>3?a=Array.prototype.slice.call(arguments,2):u===3&&ef(a)&&(a=[a]),tr(e,r,a))}const N2="3.4.21";/**
* @vue/runtime-dom v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const $2="http://www.w3.org/2000/svg",U2="http://www.w3.org/1998/Math/MathML",yl=typeof document<"u"?document:null,a_=yl&&yl.createElement("template"),V2={insert:(e,r,a)=>{r.insertBefore(e,a||null)},remove:e=>{const r=e.parentNode;r&&r.removeChild(e)},createElement:(e,r,a,u)=>{const d=r==="svg"?yl.createElementNS($2,e):r==="mathml"?yl.createElementNS(U2,e):yl.createElement(e,a?{is:a}:void 0);return e==="select"&&u&&u.multiple!=null&&d.setAttribute("multiple",u.multiple),d},createText:e=>yl.createTextNode(e),createComment:e=>yl.createComment(e),setText:(e,r)=>{e.nodeValue=r},setElementText:(e,r)=>{e.textContent=r},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>yl.querySelector(e),setScopeId(e,r){e.setAttribute(r,"")},insertStaticContent(e,r,a,u,d,y){const m=a?a.previousSibling:r.lastChild;if(d&&(d===y||d.nextSibling))for(;r.insertBefore(d.cloneNode(!0),a),!(d===y||!(d=d.nextSibling)););else{a_.innerHTML=u==="svg"?`<svg>${e}</svg>`:u==="mathml"?`<math>${e}</math>`:e;const l=a_.content;if(u==="svg"||u==="mathml"){const T=l.firstChild;for(;T.firstChild;)l.appendChild(T.firstChild);l.removeChild(T)}r.insertBefore(l,a)}return[m?m.nextSibling:r.firstChild,a?a.previousSibling:r.lastChild]}},j2=Symbol("_vtc");function q2(e,r,a){const u=e[j2];u&&(r=(r?[r,...u]:[...u]).join(" ")),r==null?e.removeAttribute("class"):a?e.setAttribute("class",r):e.className=r}const nf=Symbol("_vod"),Ev=Symbol("_vsh"),G2={beforeMount(e,{value:r},{transition:a}){e[nf]=e.style.display==="none"?"":e.style.display,a&&r?a.beforeEnter(e):eh(e,r)},mounted(e,{value:r},{transition:a}){a&&r&&a.enter(e)},updated(e,{value:r,oldValue:a},{transition:u}){!r!=!a&&(u?r?(u.beforeEnter(e),eh(e,!0),u.enter(e)):u.leave(e,()=>{eh(e,!1)}):eh(e,r))},beforeUnmount(e,{value:r}){eh(e,r)}};function eh(e,r){e.style.display=r?e[nf]:"none",e[Ev]=!r}const H2=Symbol(""),Z2=/(^|;)\s*display\s*:/;function W2(e,r,a){const u=e.style,d=Tn(a);let y=!1;if(a&&!d){if(r)if(Tn(r))for(const m of r.split(";")){const l=m.slice(0,m.indexOf(":")).trim();a[l]==null&&Vd(u,l,"")}else for(const m in r)a[m]==null&&Vd(u,m,"");for(const m in a)m==="display"&&(y=!0),Vd(u,m,a[m])}else if(d){if(r!==a){const m=u[H2];m&&(a+=";"+m),u.cssText=a,y=Z2.test(a)}}else r&&e.removeAttribute("style");nf in e&&(e[nf]=y?u.display:"",e[Ev]&&(u.display="none"))}const o_=/\s*!important$/;function Vd(e,r,a){if(yi(a))a.forEach(u=>Vd(e,r,u));else if(a==null&&(a=""),r.startsWith("--"))e.setProperty(r,a);else{const u=X2(e,r);o_.test(a)?e.setProperty(hc(u),a.replace(o_,""),"important"):e[u]=a}}const l_=["Webkit","Moz","ms"],Dp={};function X2(e,r){const a=Dp[r];if(a)return a;let u=so(r);if(u!=="filter"&&u in e)return Dp[r]=u;u=gf(u);for(let d=0;d<l_.length;d++){const y=l_[d]+u;if(y in e)return Dp[r]=y}return r}const c_="http://www.w3.org/1999/xlink";function K2(e,r,a,u,d){if(u&&r.startsWith("xlink:"))a==null?e.removeAttributeNS(c_,r.slice(6,r.length)):e.setAttributeNS(c_,r,a);else{const y=iw(r);a==null||y&&!I0(a)?e.removeAttribute(r):e.setAttribute(r,y?"":a)}}function Y2(e,r,a,u,d,y,m){if(r==="innerHTML"||r==="textContent"){u&&m(u,d,y),e[r]=a??"";return}const l=e.tagName;if(r==="value"&&l!=="PROGRESS"&&!l.includes("-")){const P=l==="OPTION"?e.getAttribute("value")||"":e.value,z=a??"";(P!==z||!("_value"in e))&&(e.value=z),a==null&&e.removeAttribute(r),e._value=a;return}let T=!1;if(a===""||a==null){const P=typeof e[r];P==="boolean"?a=I0(a):a==null&&P==="string"?(a="",T=!0):P==="number"&&(a=0,T=!0)}try{e[r]=a}catch{}T&&e.removeAttribute(r)}function Gc(e,r,a,u){e.addEventListener(r,a,u)}function J2(e,r,a,u){e.removeEventListener(r,a,u)}const u_=Symbol("_vei");function Q2(e,r,a,u,d=null){const y=e[u_]||(e[u_]={}),m=y[r];if(u&&m)m.value=u;else{const[l,T]=eM(r);if(u){const P=y[r]=rM(u,d);Gc(e,l,P,T)}else m&&(J2(e,l,m,T),y[r]=void 0)}}const h_=/(?:Once|Passive|Capture)$/;function eM(e){let r;if(h_.test(e)){r={};let u;for(;u=e.match(h_);)e=e.slice(0,e.length-u[0].length),r[u[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):hc(e.slice(2)),r]}let Lp=0;const tM=Promise.resolve(),iM=()=>Lp||(tM.then(()=>Lp=0),Lp=Date.now());function rM(e,r){const a=u=>{if(!u._vts)u._vts=Date.now();else if(u._vts<=a.attached)return;La(nM(u,a.value),r,5,[u])};return a.value=e,a.attached=iM(),a}function nM(e,r){if(yi(r)){const a=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{a.call(e),e._stopped=!0},r.map(u=>d=>!d._stopped&&u&&u(d))}else return r}const d_=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&e.charCodeAt(2)>96&&e.charCodeAt(2)<123,sM=(e,r,a,u,d,y,m,l,T)=>{const P=d==="svg";r==="class"?q2(e,u,P):r==="style"?W2(e,a,u):ff(r)?Tm(r)||Q2(e,r,a,u,m):(r[0]==="."?(r=r.slice(1),!0):r[0]==="^"?(r=r.slice(1),!1):aM(e,r,u,P))?Y2(e,r,u,y,m,l,T):(r==="true-value"?e._trueValue=u:r==="false-value"&&(e._falseValue=u),K2(e,r,u,P))};function aM(e,r,a,u){if(u)return!!(r==="innerHTML"||r==="textContent"||r in e&&d_(r)&&Ti(a));if(r==="spellcheck"||r==="draggable"||r==="translate"||r==="form"||r==="list"&&e.tagName==="INPUT"||r==="type"&&e.tagName==="TEXTAREA")return!1;if(r==="width"||r==="height"){const d=e.tagName;if(d==="IMG"||d==="VIDEO"||d==="CANVAS"||d==="SOURCE")return!1}return d_(r)&&Tn(a)?!1:r in e}const f_=e=>{const r=e.props["onUpdate:modelValue"]||!1;return yi(r)?a=>Fd(r,a):r};function oM(e){e.target.composing=!0}function p_(e){const r=e.target;r.composing&&(r.composing=!1,r.dispatchEvent(new Event("input")))}const Rp=Symbol("_assign"),lM={created(e,{modifiers:{lazy:r,trim:a,number:u}},d){e[Rp]=f_(d);const y=u||d.props&&d.props.type==="number";Gc(e,r?"change":"input",m=>{if(m.target.composing)return;let l=e.value;a&&(l=l.trim()),y&&(l=Kp(l)),e[Rp](l)}),a&&Gc(e,"change",()=>{e.value=e.value.trim()}),r||(Gc(e,"compositionstart",oM),Gc(e,"compositionend",p_),Gc(e,"change",p_))},mounted(e,{value:r}){e.value=r??""},beforeUpdate(e,{value:r,modifiers:{lazy:a,trim:u,number:d}},y){if(e[Rp]=f_(y),e.composing)return;const m=d||e.type==="number"?Kp(e.value):e.value,l=r??"";m!==l&&(document.activeElement===e&&e.type!=="range"&&(a||u&&e.value.trim()===l)||(e.value=l))}},cM={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},uM=(e,r)=>{const a=e._withKeys||(e._withKeys={}),u=r.join(".");return a[u]||(a[u]=d=>{if(!("key"in d))return;const y=hc(d.key);if(r.some(m=>m===y||cM[m]===y))return e(d)})},hM=Vn({patchProp:sM},V2);let m_;function dM(){return m_||(m_=x2(hM))}const fM=(...e)=>{const r=dM().createApp(...e),{mount:a}=r;return r.mount=u=>{const d=mM(u);if(!d)return;const y=r._component;!Ti(y)&&!y.render&&!y.template&&(y.template=d.innerHTML),d.innerHTML="";const m=a(d,!1,pM(d));return d instanceof Element&&(d.removeAttribute("v-cloak"),d.setAttribute("data-v-app","")),m},r};function pM(e){if(e instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&e instanceof MathMLElement)return"mathml"}function mM(e){return Tn(e)?document.querySelector(e):e}var gM=!1;/*!
 * pinia v2.1.7
 * (c) 2023 Eduardo San Martin Morote
 * @license MIT
 */let Tv;const If=e=>Tv=e,Iv=Symbol();function om(e){return e&&typeof e=="object"&&Object.prototype.toString.call(e)==="[object Object]"&&typeof e.toJSON!="function"}var mh;(function(e){e.direct="direct",e.patchObject="patch object",e.patchFunction="patch function"})(mh||(mh={}));function yM(){const e=P0(!0),r=e.run(()=>Ps({}));let a=[],u=[];const d=_f({install(y){If(d),d._a=y,y.provide(Iv,d),y.config.globalProperties.$pinia=d,u.forEach(m=>a.push(m)),u=[]},use(y){return!this._a&&!gM?u.push(y):a.push(y),this},_p:a,_a:null,_e:e,_s:new Map,state:r});return d}const Cv=()=>{};function g_(e,r,a,u=Cv){e.push(r);const d=()=>{const y=e.indexOf(r);y>-1&&(e.splice(y,1),u())};return!a&&k0()&&nw(d),d}function jc(e,...r){e.slice().forEach(a=>{a(...r)})}const _M=e=>e();function lm(e,r){e instanceof Map&&r instanceof Map&&r.forEach((a,u)=>e.set(u,a)),e instanceof Set&&r instanceof Set&&r.forEach(e.add,e);for(const a in r){if(!r.hasOwnProperty(a))continue;const u=r[a],d=e[a];om(d)&&om(u)&&e.hasOwnProperty(a)&&!In(u)&&!xl(u)?e[a]=lm(d,u):e[a]=u}return e}const vM=Symbol();function xM(e){return!om(e)||!e.hasOwnProperty(vM)}const{assign:pl}=Object;function bM(e){return!!(In(e)&&e.effect)}function wM(e,r,a,u){const{state:d,actions:y,getters:m}=r,l=a.state.value[e];let T;function P(){l||(a.state.value[e]=d?d():{});const z=Aw(a.state.value[e]);return pl(z,y,Object.keys(m||{}).reduce((k,R)=>(k[R]=_f(Ai(()=>{If(a);const Z=a._s.get(e);return m[R].call(Z,Z)})),k),{}))}return T=Av(e,P,r,a,u,!0),T}function Av(e,r,a={},u,d,y){let m;const l=pl({actions:{}},a),T={deep:!0};let P,z,k=[],R=[],Z;const K=u.state.value[e];!y&&!K&&(u.state.value[e]={}),Ps({});let Y;function ge(He){let lt;P=z=!1,typeof He=="function"?(He(u.state.value[e]),lt={type:mh.patchFunction,storeId:e,events:Z}):(lm(u.state.value[e],He),lt={type:mh.patchObject,payload:He,storeId:e,events:Z});const Rt=Y=Symbol();Bm().then(()=>{Y===Rt&&(P=!0)}),z=!0,jc(k,lt,u.state.value[e])}const Te=y?function(){const{state:lt}=a,Rt=lt?lt():{};this.$patch(Pt=>{pl(Pt,Rt)})}:Cv;function Fe(){m.stop(),k=[],R=[],u._s.delete(e)}function he(He,lt){return function(){If(u);const Rt=Array.from(arguments),Pt=[],oi=[];function pi(si){Pt.push(si)}function Yt(si){oi.push(si)}jc(R,{args:Rt,name:He,store:We,after:pi,onError:Yt});let cr;try{cr=lt.apply(this&&this.$id===e?this:We,Rt)}catch(si){throw jc(oi,si),si}return cr instanceof Promise?cr.then(si=>(jc(Pt,si),si)).catch(si=>(jc(oi,si),Promise.reject(si))):(jc(Pt,cr),cr)}}const Le={_p:u,$id:e,$onAction:g_.bind(null,R),$patch:ge,$reset:Te,$subscribe(He,lt={}){const Rt=g_(k,He,lt.detached,()=>Pt()),Pt=m.run(()=>ks(()=>u.state.value[e],oi=>{(lt.flush==="sync"?z:P)&&He({storeId:e,type:mh.direct,events:Z},oi)},pl({},T,lt)));return Rt},$dispose:Fe},We=Oh(Le);u._s.set(e,We);const bt=(u._a&&u._a.runWithContext||_M)(()=>u._e.run(()=>(m=P0()).run(r)));for(const He in bt){const lt=bt[He];if(In(lt)&&!bM(lt)||xl(lt))y||(K&&xM(lt)&&(In(lt)?lt.value=K[He]:lm(lt,K[He])),u.state.value[e][He]=lt);else if(typeof lt=="function"){const Rt=he(He,lt);bt[He]=Rt,l.actions[He]=lt}}return pl(We,bt),pl(Hi(We),bt),Object.defineProperty(We,"$state",{get:()=>u.state.value[e],set:He=>{ge(lt=>{pl(lt,He)})}}),u._p.forEach(He=>{pl(We,m.run(()=>He({store:We,app:u._a,pinia:u,options:l})))}),K&&y&&a.hydrate&&a.hydrate(We.$state,K),P=!0,z=!0,We}function Lo(e,r,a){let u,d;const y=typeof r=="function";typeof e=="string"?(u=e,d=y?a:r):(d=e,u=e.id);function m(l,T){const P=p2();return l=l||(P?da(Iv,null):null),l&&If(l),l=Tv,l._s.has(u)||(y?Av(u,r,d,l):wM(u,d,l)),l._s.get(u)}return m.$id=u,m}const Ys=Lo("MainStore",{state:()=>({lastSearchMethod:"address",currentAddress:"",currentTopic:"Property",currentNearbyDataType:"nearby311",dataSourcesLoadedArray:[],hoveredStateId:null,selectedParcelId:null}),actions:{setCurrentAddress(e){this.currentAddress=e},setLastSearchMethod(e){this.lastSearchMethod=e},setCurrentNearbyDataType(e){this.currentNearbyDataType=e},clearDataSourcesLoadedArray(){this.dataSourcesLoadedArray=[]},addToDataSourcesLoadedArray(e){this.dataSourcesLoadedArray.push(e)}}});/*!
  * vue-router v4.3.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const Hc=typeof document<"u";function MM(e){return e.__esModule||e[Symbol.toStringTag]==="Module"}const lr=Object.assign;function zp(e,r){const a={};for(const u in r){const d=r[u];a[u]=za(d)?d.map(e):e(d)}return a}const gh=()=>{},za=Array.isArray,Pv=/#/g,SM=/&/g,EM=/\//g,TM=/=/g,IM=/\?/g,kv=/\+/g,CM=/%5B/g,AM=/%5D/g,Dv=/%5E/g,PM=/%60/g,Lv=/%7B/g,kM=/%7C/g,Rv=/%7D/g,DM=/%20/g;function jm(e){return encodeURI(""+e).replace(kM,"|").replace(CM,"[").replace(AM,"]")}function LM(e){return jm(e).replace(Lv,"{").replace(Rv,"}").replace(Dv,"^")}function cm(e){return jm(e).replace(kv,"%2B").replace(DM,"+").replace(Pv,"%23").replace(SM,"%26").replace(PM,"`").replace(Lv,"{").replace(Rv,"}").replace(Dv,"^")}function RM(e){return cm(e).replace(TM,"%3D")}function zM(e){return jm(e).replace(Pv,"%23").replace(IM,"%3F")}function OM(e){return e==null?"":zM(e).replace(EM,"%2F")}function Ih(e){try{return decodeURIComponent(""+e)}catch{}return""+e}const FM=/\/$/,BM=e=>e.replace(FM,"");function Op(e,r,a="/"){let u,d={},y="",m="";const l=r.indexOf("#");let T=r.indexOf("?");return l<T&&l>=0&&(T=-1),T>-1&&(u=r.slice(0,T),y=r.slice(T+1,l>-1?l:r.length),d=e(y)),l>-1&&(u=u||r.slice(0,l),m=r.slice(l,r.length)),u=VM(u??r,a),{fullPath:u+(y&&"?")+y+m,path:u,query:d,hash:Ih(m)}}function NM(e,r){const a=r.query?e(r.query):"";return r.path+(a&&"?")+a+(r.hash||"")}function y_(e,r){return!r||!e.toLowerCase().startsWith(r.toLowerCase())?e:e.slice(r.length)||"/"}function $M(e,r,a){const u=r.matched.length-1,d=a.matched.length-1;return u>-1&&u===d&&lu(r.matched[u],a.matched[d])&&zv(r.params,a.params)&&e(r.query)===e(a.query)&&r.hash===a.hash}function lu(e,r){return(e.aliasOf||e)===(r.aliasOf||r)}function zv(e,r){if(Object.keys(e).length!==Object.keys(r).length)return!1;for(const a in e)if(!UM(e[a],r[a]))return!1;return!0}function UM(e,r){return za(e)?__(e,r):za(r)?__(r,e):e===r}function __(e,r){return za(r)?e.length===r.length&&e.every((a,u)=>a===r[u]):e.length===1&&e[0]===r}function VM(e,r){if(e.startsWith("/"))return e;if(!e)return r;const a=r.split("/"),u=e.split("/"),d=u[u.length-1];(d===".."||d===".")&&u.push("");let y=a.length-1,m,l;for(m=0;m<u.length;m++)if(l=u[m],l!==".")if(l==="..")y>1&&y--;else break;return a.slice(0,y).join("/")+"/"+u.slice(m).join("/")}var Ch;(function(e){e.pop="pop",e.push="push"})(Ch||(Ch={}));var yh;(function(e){e.back="back",e.forward="forward",e.unknown=""})(yh||(yh={}));function jM(e){if(!e)if(Hc){const r=document.querySelector("base");e=r&&r.getAttribute("href")||"/",e=e.replace(/^\w+:\/\/[^\/]+/,"")}else e="/";return e[0]!=="/"&&e[0]!=="#"&&(e="/"+e),BM(e)}const qM=/^[^#]+#/;function GM(e,r){return e.replace(qM,"#")+r}function HM(e,r){const a=document.documentElement.getBoundingClientRect(),u=e.getBoundingClientRect();return{behavior:r.behavior,left:u.left-a.left-(r.left||0),top:u.top-a.top-(r.top||0)}}const Cf=()=>({left:window.scrollX,top:window.scrollY});function ZM(e){let r;if("el"in e){const a=e.el,u=typeof a=="string"&&a.startsWith("#"),d=typeof a=="string"?u?document.getElementById(a.slice(1)):document.querySelector(a):a;if(!d)return;r=HM(d,e)}else r=e;"scrollBehavior"in document.documentElement.style?window.scrollTo(r):window.scrollTo(r.left!=null?r.left:window.scrollX,r.top!=null?r.top:window.scrollY)}function v_(e,r){return(history.state?history.state.position-r:-1)+e}const um=new Map;function WM(e,r){um.set(e,r)}function XM(e){const r=um.get(e);return um.delete(e),r}let KM=()=>location.protocol+"//"+location.host;function Ov(e,r){const{pathname:a,search:u,hash:d}=r,y=e.indexOf("#");if(y>-1){let l=d.includes(e.slice(y))?e.slice(y).length:1,T=d.slice(l);return T[0]!=="/"&&(T="/"+T),y_(T,"")}return y_(a,e)+u+d}function YM(e,r,a,u){let d=[],y=[],m=null;const l=({state:R})=>{const Z=Ov(e,location),K=a.value,Y=r.value;let ge=0;if(R){if(a.value=Z,r.value=R,m&&m===K){m=null;return}ge=Y?R.position-Y.position:0}else u(Z);d.forEach(Te=>{Te(a.value,K,{delta:ge,type:Ch.pop,direction:ge?ge>0?yh.forward:yh.back:yh.unknown})})};function T(){m=a.value}function P(R){d.push(R);const Z=()=>{const K=d.indexOf(R);K>-1&&d.splice(K,1)};return y.push(Z),Z}function z(){const{history:R}=window;R.state&&R.replaceState(lr({},R.state,{scroll:Cf()}),"")}function k(){for(const R of y)R();y=[],window.removeEventListener("popstate",l),window.removeEventListener("beforeunload",z)}return window.addEventListener("popstate",l),window.addEventListener("beforeunload",z,{passive:!0}),{pauseListeners:T,listen:P,destroy:k}}function x_(e,r,a,u=!1,d=!1){return{back:e,current:r,forward:a,replaced:u,position:window.history.length,scroll:d?Cf():null}}function JM(e){const{history:r,location:a}=window,u={value:Ov(e,a)},d={value:r.state};d.value||y(u.value,{back:null,current:u.value,forward:null,position:r.length-1,replaced:!0,scroll:null},!0);function y(T,P,z){const k=e.indexOf("#"),R=k>-1?(a.host&&document.querySelector("base")?e:e.slice(k))+T:KM()+e+T;try{r[z?"replaceState":"pushState"](P,"",R),d.value=P}catch(Z){console.error(Z),a[z?"replace":"assign"](R)}}function m(T,P){const z=lr({},r.state,x_(d.value.back,T,d.value.forward,!0),P,{position:d.value.position});y(T,z,!0),u.value=T}function l(T,P){const z=lr({},d.value,r.state,{forward:T,scroll:Cf()});y(z.current,z,!0);const k=lr({},x_(u.value,T,null),{position:z.position+1},P);y(T,k,!1),u.value=T}return{location:u,state:d,push:l,replace:m}}function QM(e){e=jM(e);const r=JM(e),a=YM(e,r.state,r.location,r.replace);function u(y,m=!0){m||a.pauseListeners(),history.go(y)}const d=lr({location:"",base:e,go:u,createHref:GM.bind(null,e)},r,a);return Object.defineProperty(d,"location",{enumerable:!0,get:()=>r.location.value}),Object.defineProperty(d,"state",{enumerable:!0,get:()=>r.state.value}),d}function eS(e){return e=location.host?e||location.pathname+location.search:"",e.includes("#")||(e+="#"),QM(e)}function tS(e){return typeof e=="string"||e&&typeof e=="object"}function Fv(e){return typeof e=="string"||typeof e=="symbol"}const hl={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},Bv=Symbol("");var b_;(function(e){e[e.aborted=4]="aborted",e[e.cancelled=8]="cancelled",e[e.duplicated=16]="duplicated"})(b_||(b_={}));function cu(e,r){return lr(new Error,{type:e,[Bv]:!0},r)}function Co(e,r){return e instanceof Error&&Bv in e&&(r==null||!!(e.type&r))}const w_="[^/]+?",iS={sensitive:!1,strict:!1,start:!0,end:!0},rS=/[.+*?^${}()[\]/\\]/g;function nS(e,r){const a=lr({},iS,r),u=[];let d=a.start?"^":"";const y=[];for(const P of e){const z=P.length?[]:[90];a.strict&&!P.length&&(d+="/");for(let k=0;k<P.length;k++){const R=P[k];let Z=40+(a.sensitive?.25:0);if(R.type===0)k||(d+="/"),d+=R.value.replace(rS,"\\$&"),Z+=40;else if(R.type===1){const{value:K,repeatable:Y,optional:ge,regexp:Te}=R;y.push({name:K,repeatable:Y,optional:ge});const Fe=Te||w_;if(Fe!==w_){Z+=10;try{new RegExp(`(${Fe})`)}catch(Le){throw new Error(`Invalid custom RegExp for param "${K}" (${Fe}): `+Le.message)}}let he=Y?`((?:${Fe})(?:/(?:${Fe}))*)`:`(${Fe})`;k||(he=ge&&P.length<2?`(?:/${he})`:"/"+he),ge&&(he+="?"),d+=he,Z+=20,ge&&(Z+=-8),Y&&(Z+=-20),Fe===".*"&&(Z+=-50)}z.push(Z)}u.push(z)}if(a.strict&&a.end){const P=u.length-1;u[P][u[P].length-1]+=.7000000000000001}a.strict||(d+="/?"),a.end?d+="$":a.strict&&(d+="(?:/|$)");const m=new RegExp(d,a.sensitive?"":"i");function l(P){const z=P.match(m),k={};if(!z)return null;for(let R=1;R<z.length;R++){const Z=z[R]||"",K=y[R-1];k[K.name]=Z&&K.repeatable?Z.split("/"):Z}return k}function T(P){let z="",k=!1;for(const R of e){(!k||!z.endsWith("/"))&&(z+="/"),k=!1;for(const Z of R)if(Z.type===0)z+=Z.value;else if(Z.type===1){const{value:K,repeatable:Y,optional:ge}=Z,Te=K in P?P[K]:"";if(za(Te)&&!Y)throw new Error(`Provided param "${K}" is an array but it is not repeatable (* or + modifiers)`);const Fe=za(Te)?Te.join("/"):Te;if(!Fe)if(ge)R.length<2&&(z.endsWith("/")?z=z.slice(0,-1):k=!0);else throw new Error(`Missing required param "${K}"`);z+=Fe}}return z||"/"}return{re:m,score:u,keys:y,parse:l,stringify:T}}function sS(e,r){let a=0;for(;a<e.length&&a<r.length;){const u=r[a]-e[a];if(u)return u;a++}return e.length<r.length?e.length===1&&e[0]===80?-1:1:e.length>r.length?r.length===1&&r[0]===80?1:-1:0}function aS(e,r){let a=0;const u=e.score,d=r.score;for(;a<u.length&&a<d.length;){const y=sS(u[a],d[a]);if(y)return y;a++}if(Math.abs(d.length-u.length)===1){if(M_(u))return 1;if(M_(d))return-1}return d.length-u.length}function M_(e){const r=e[e.length-1];return e.length>0&&r[r.length-1]<0}const oS={type:0,value:""},lS=/[a-zA-Z0-9_]/;function cS(e){if(!e)return[[]];if(e==="/")return[[oS]];if(!e.startsWith("/"))throw new Error(`Invalid path "${e}"`);function r(Z){throw new Error(`ERR (${a})/"${P}": ${Z}`)}let a=0,u=a;const d=[];let y;function m(){y&&d.push(y),y=[]}let l=0,T,P="",z="";function k(){P&&(a===0?y.push({type:0,value:P}):a===1||a===2||a===3?(y.length>1&&(T==="*"||T==="+")&&r(`A repeatable param (${P}) must be alone in its segment. eg: '/:ids+.`),y.push({type:1,value:P,regexp:z,repeatable:T==="*"||T==="+",optional:T==="*"||T==="?"})):r("Invalid state to consume buffer"),P="")}function R(){P+=T}for(;l<e.length;){if(T=e[l++],T==="\\"&&a!==2){u=a,a=4;continue}switch(a){case 0:T==="/"?(P&&k(),m()):T===":"?(k(),a=1):R();break;case 4:R(),a=u;break;case 1:T==="("?a=2:lS.test(T)?R():(k(),a=0,T!=="*"&&T!=="?"&&T!=="+"&&l--);break;case 2:T===")"?z[z.length-1]=="\\"?z=z.slice(0,-1)+T:a=3:z+=T;break;case 3:k(),a=0,T!=="*"&&T!=="?"&&T!=="+"&&l--,z="";break;default:r("Unknown state");break}}return a===2&&r(`Unfinished custom RegExp for param "${P}"`),k(),m(),d}function uS(e,r,a){const u=nS(cS(e.path),a),d=lr(u,{record:e,parent:r,children:[],alias:[]});return r&&!d.record.aliasOf==!r.record.aliasOf&&r.children.push(d),d}function hS(e,r){const a=[],u=new Map;r=T_({strict:!1,end:!0,sensitive:!1},r);function d(z){return u.get(z)}function y(z,k,R){const Z=!R,K=dS(z);K.aliasOf=R&&R.record;const Y=T_(r,z),ge=[K];if("alias"in z){const he=typeof z.alias=="string"?[z.alias]:z.alias;for(const Le of he)ge.push(lr({},K,{components:R?R.record.components:K.components,path:Le,aliasOf:R?R.record:K}))}let Te,Fe;for(const he of ge){const{path:Le}=he;if(k&&Le[0]!=="/"){const We=k.record.path,Qe=We[We.length-1]==="/"?"":"/";he.path=k.record.path+(Le&&Qe+Le)}if(Te=uS(he,k,Y),R?R.alias.push(Te):(Fe=Fe||Te,Fe!==Te&&Fe.alias.push(Te),Z&&z.name&&!E_(Te)&&m(z.name)),K.children){const We=K.children;for(let Qe=0;Qe<We.length;Qe++)y(We[Qe],Te,R&&R.children[Qe])}R=R||Te,(Te.record.components&&Object.keys(Te.record.components).length||Te.record.name||Te.record.redirect)&&T(Te)}return Fe?()=>{m(Fe)}:gh}function m(z){if(Fv(z)){const k=u.get(z);k&&(u.delete(z),a.splice(a.indexOf(k),1),k.children.forEach(m),k.alias.forEach(m))}else{const k=a.indexOf(z);k>-1&&(a.splice(k,1),z.record.name&&u.delete(z.record.name),z.children.forEach(m),z.alias.forEach(m))}}function l(){return a}function T(z){let k=0;for(;k<a.length&&aS(z,a[k])>=0&&(z.record.path!==a[k].record.path||!Nv(z,a[k]));)k++;a.splice(k,0,z),z.record.name&&!E_(z)&&u.set(z.record.name,z)}function P(z,k){let R,Z={},K,Y;if("name"in z&&z.name){if(R=u.get(z.name),!R)throw cu(1,{location:z});Y=R.record.name,Z=lr(S_(k.params,R.keys.filter(Fe=>!Fe.optional).concat(R.parent?R.parent.keys.filter(Fe=>Fe.optional):[]).map(Fe=>Fe.name)),z.params&&S_(z.params,R.keys.map(Fe=>Fe.name))),K=R.stringify(Z)}else if(z.path!=null)K=z.path,R=a.find(Fe=>Fe.re.test(K)),R&&(Z=R.parse(K),Y=R.record.name);else{if(R=k.name?u.get(k.name):a.find(Fe=>Fe.re.test(k.path)),!R)throw cu(1,{location:z,currentLocation:k});Y=R.record.name,Z=lr({},k.params,z.params),K=R.stringify(Z)}const ge=[];let Te=R;for(;Te;)ge.unshift(Te.record),Te=Te.parent;return{name:Y,path:K,params:Z,matched:ge,meta:pS(ge)}}return e.forEach(z=>y(z)),{addRoute:y,resolve:P,removeRoute:m,getRoutes:l,getRecordMatcher:d}}function S_(e,r){const a={};for(const u of r)u in e&&(a[u]=e[u]);return a}function dS(e){return{path:e.path,redirect:e.redirect,name:e.name,meta:e.meta||{},aliasOf:void 0,beforeEnter:e.beforeEnter,props:fS(e),children:e.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in e?e.components||null:e.component&&{default:e.component}}}function fS(e){const r={},a=e.props||!1;if("component"in e)r.default=a;else for(const u in e.components)r[u]=typeof a=="object"?a[u]:a;return r}function E_(e){for(;e;){if(e.record.aliasOf)return!0;e=e.parent}return!1}function pS(e){return e.reduce((r,a)=>lr(r,a.meta),{})}function T_(e,r){const a={};for(const u in e)a[u]=u in r?r[u]:e[u];return a}function Nv(e,r){return r.children.some(a=>a===e||Nv(e,a))}function mS(e){const r={};if(e===""||e==="?")return r;const u=(e[0]==="?"?e.slice(1):e).split("&");for(let d=0;d<u.length;++d){const y=u[d].replace(kv," "),m=y.indexOf("="),l=Ih(m<0?y:y.slice(0,m)),T=m<0?null:Ih(y.slice(m+1));if(l in r){let P=r[l];za(P)||(P=r[l]=[P]),P.push(T)}else r[l]=T}return r}function I_(e){let r="";for(let a in e){const u=e[a];if(a=RM(a),u==null){u!==void 0&&(r+=(r.length?"&":"")+a);continue}(za(u)?u.map(y=>y&&cm(y)):[u&&cm(u)]).forEach(y=>{y!==void 0&&(r+=(r.length?"&":"")+a,y!=null&&(r+="="+y))})}return r}function gS(e){const r={};for(const a in e){const u=e[a];u!==void 0&&(r[a]=za(u)?u.map(d=>d==null?null:""+d):u==null?u:""+u)}return r}const yS=Symbol(""),C_=Symbol(""),Af=Symbol(""),qm=Symbol(""),hm=Symbol("");function th(){let e=[];function r(u){return e.push(u),()=>{const d=e.indexOf(u);d>-1&&e.splice(d,1)}}function a(){e=[]}return{add:r,list:()=>e.slice(),reset:a}}function _l(e,r,a,u,d,y=m=>m()){const m=u&&(u.enterCallbacks[d]=u.enterCallbacks[d]||[]);return()=>new Promise((l,T)=>{const P=R=>{R===!1?T(cu(4,{from:a,to:r})):R instanceof Error?T(R):tS(R)?T(cu(2,{from:r,to:R})):(m&&u.enterCallbacks[d]===m&&typeof R=="function"&&m.push(R),l())},z=y(()=>e.call(u&&u.instances[d],r,a,P));let k=Promise.resolve(z);e.length<3&&(k=k.then(P)),k.catch(R=>T(R))})}function Fp(e,r,a,u,d=y=>y()){const y=[];for(const m of e)for(const l in m.components){let T=m.components[l];if(!(r!=="beforeRouteEnter"&&!m.instances[l]))if(_S(T)){const z=(T.__vccOpts||T)[r];z&&y.push(_l(z,a,u,m,l,d))}else{let P=T();y.push(()=>P.then(z=>{if(!z)return Promise.reject(new Error(`Couldn't resolve component "${l}" at "${m.path}"`));const k=MM(z)?z.default:z;m.components[l]=k;const Z=(k.__vccOpts||k)[r];return Z&&_l(Z,a,u,m,l,d)()}))}}return y}function _S(e){return typeof e=="object"||"displayName"in e||"props"in e||"__vccOpts"in e}function A_(e){const r=da(Af),a=da(qm),u=Ai(()=>r.resolve(er(e.to))),d=Ai(()=>{const{matched:T}=u.value,{length:P}=T,z=T[P-1],k=a.matched;if(!z||!k.length)return-1;const R=k.findIndex(lu.bind(null,z));if(R>-1)return R;const Z=P_(T[P-2]);return P>1&&P_(z)===Z&&k[k.length-1].path!==Z?k.findIndex(lu.bind(null,T[P-2])):R}),y=Ai(()=>d.value>-1&&bS(a.params,u.value.params)),m=Ai(()=>d.value>-1&&d.value===a.matched.length-1&&zv(a.params,u.value.params));function l(T={}){return xS(T)?r[er(e.replace)?"replace":"push"](er(e.to)).catch(gh):Promise.resolve()}return{route:u,href:Ai(()=>u.value.href),isActive:y,isExactActive:m,navigate:l}}const vS=sv({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:A_,setup(e,{slots:r}){const a=Oh(A_(e)),{options:u}=da(Af),d=Ai(()=>({[k_(e.activeClass,u.linkActiveClass,"router-link-active")]:a.isActive,[k_(e.exactActiveClass,u.linkExactActiveClass,"router-link-exact-active")]:a.isExactActive}));return()=>{const y=r.default&&r.default(a);return e.custom?y:Sv("a",{"aria-current":a.isExactActive?e.ariaCurrentValue:null,href:a.href,onClick:a.navigate,class:d.value},y)}}}),$v=vS;function xS(e){if(!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)&&!e.defaultPrevented&&!(e.button!==void 0&&e.button!==0)){if(e.currentTarget&&e.currentTarget.getAttribute){const r=e.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(r))return}return e.preventDefault&&e.preventDefault(),!0}}function bS(e,r){for(const a in r){const u=r[a],d=e[a];if(typeof u=="string"){if(u!==d)return!1}else if(!za(d)||d.length!==u.length||u.some((y,m)=>y!==d[m]))return!1}return!0}function P_(e){return e?e.aliasOf?e.aliasOf.path:e.path:""}const k_=(e,r,a)=>e??r??a,wS=sv({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(e,{attrs:r,slots:a}){const u=da(hm),d=Ai(()=>e.route||u.value),y=da(C_,0),m=Ai(()=>{let P=er(y);const{matched:z}=d.value;let k;for(;(k=z[P])&&!k.components;)P++;return P}),l=Ai(()=>d.value.matched[m.value]);Nd(C_,Ai(()=>m.value+1)),Nd(yS,l),Nd(hm,d);const T=Ps();return ks(()=>[T.value,l.value,e.name],([P,z,k],[R,Z,K])=>{z&&(z.instances[k]=P,Z&&Z!==z&&P&&P===R&&(z.leaveGuards.size||(z.leaveGuards=Z.leaveGuards),z.updateGuards.size||(z.updateGuards=Z.updateGuards))),P&&z&&(!Z||!lu(z,Z)||!R)&&(z.enterCallbacks[k]||[]).forEach(Y=>Y(P))},{flush:"post"}),()=>{const P=d.value,z=e.name,k=l.value,R=k&&k.components[z];if(!R)return D_(a.default,{Component:R,route:P});const Z=k.props[z],K=Z?Z===!0?P.params:typeof Z=="function"?Z(P):Z:null,ge=Sv(R,lr({},K,r,{onVnodeUnmounted:Te=>{Te.component.isUnmounted&&(k.instances[z]=null)},ref:T}));return D_(a.default,{Component:ge,route:P})||ge}}});function D_(e,r){if(!e)return null;const a=e(r);return a.length===1?a[0]:a}const MS=wS;function SS(e){const r=hS(e.routes,e),a=e.parseQuery||mS,u=e.stringifyQuery||I_,d=e.history,y=th(),m=th(),l=th(),T=Tw(hl);let P=hl;Hc&&e.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const z=zp.bind(null,Ve=>""+Ve),k=zp.bind(null,OM),R=zp.bind(null,Ih);function Z(Ve,Et){let ht,Je;return Fv(Ve)?(ht=r.getRecordMatcher(Ve),Je=Et):Je=Ve,r.addRoute(Je,ht)}function K(Ve){const Et=r.getRecordMatcher(Ve);Et&&r.removeRoute(Et)}function Y(){return r.getRoutes().map(Ve=>Ve.record)}function ge(Ve){return!!r.getRecordMatcher(Ve)}function Te(Ve,Et){if(Et=lr({},Et||T.value),typeof Ve=="string"){const ce=Op(a,Ve,Et.path),Pe=r.resolve({path:ce.path},Et),Oe=d.createHref(ce.fullPath);return lr(ce,Pe,{params:R(Pe.params),hash:Ih(ce.hash),redirectedFrom:void 0,href:Oe})}let ht;if(Ve.path!=null)ht=lr({},Ve,{path:Op(a,Ve.path,Et.path).path});else{const ce=lr({},Ve.params);for(const Pe in ce)ce[Pe]==null&&delete ce[Pe];ht=lr({},Ve,{params:k(ce)}),Et.params=k(Et.params)}const Je=r.resolve(ht,Et),Pi=Ve.hash||"";Je.params=z(R(Je.params));const Ri=NM(u,lr({},Ve,{hash:LM(Pi),path:Je.path})),se=d.createHref(Ri);return lr({fullPath:Ri,hash:Pi,query:u===I_?gS(Ve.query):Ve.query||{}},Je,{redirectedFrom:void 0,href:se})}function Fe(Ve){return typeof Ve=="string"?Op(a,Ve,T.value.path):lr({},Ve)}function he(Ve,Et){if(P!==Ve)return cu(8,{from:Et,to:Ve})}function Le(Ve){return bt(Ve)}function We(Ve){return Le(lr(Fe(Ve),{replace:!0}))}function Qe(Ve){const Et=Ve.matched[Ve.matched.length-1];if(Et&&Et.redirect){const{redirect:ht}=Et;let Je=typeof ht=="function"?ht(Ve):ht;return typeof Je=="string"&&(Je=Je.includes("?")||Je.includes("#")?Je=Fe(Je):{path:Je},Je.params={}),lr({query:Ve.query,hash:Ve.hash,params:Je.path!=null?{}:Ve.params},Je)}}function bt(Ve,Et){const ht=P=Te(Ve),Je=T.value,Pi=Ve.state,Ri=Ve.force,se=Ve.replace===!0,ce=Qe(ht);if(ce)return bt(lr(Fe(ce),{state:typeof ce=="object"?lr({},Pi,ce.state):Pi,force:Ri,replace:se}),Et||ht);const Pe=ht;Pe.redirectedFrom=Et;let Oe;return!Ri&&$M(u,Je,ht)&&(Oe=cu(16,{to:Pe,from:Je}),ut(Je,Je,!0,!1)),(Oe?Promise.resolve(Oe):Rt(Pe,Je)).catch(le=>Co(le)?Co(le,2)?le:Ar(le):gi(le,Pe,Je)).then(le=>{if(le){if(Co(le,2))return bt(lr({replace:se},Fe(le.to),{state:typeof le.to=="object"?lr({},Pi,le.to.state):Pi,force:Ri}),Et||Pe)}else le=oi(Pe,Je,!0,se,Pi);return Pt(Pe,Je,le),le})}function He(Ve,Et){const ht=he(Ve,Et);return ht?Promise.reject(ht):Promise.resolve()}function lt(Ve){const Et=ir.values().next().value;return Et&&typeof Et.runWithContext=="function"?Et.runWithContext(Ve):Ve()}function Rt(Ve,Et){let ht;const[Je,Pi,Ri]=ES(Ve,Et);ht=Fp(Je.reverse(),"beforeRouteLeave",Ve,Et);for(const ce of Je)ce.leaveGuards.forEach(Pe=>{ht.push(_l(Pe,Ve,Et))});const se=He.bind(null,Ve,Et);return ht.push(se),wi(ht).then(()=>{ht=[];for(const ce of y.list())ht.push(_l(ce,Ve,Et));return ht.push(se),wi(ht)}).then(()=>{ht=Fp(Pi,"beforeRouteUpdate",Ve,Et);for(const ce of Pi)ce.updateGuards.forEach(Pe=>{ht.push(_l(Pe,Ve,Et))});return ht.push(se),wi(ht)}).then(()=>{ht=[];for(const ce of Ri)if(ce.beforeEnter)if(za(ce.beforeEnter))for(const Pe of ce.beforeEnter)ht.push(_l(Pe,Ve,Et));else ht.push(_l(ce.beforeEnter,Ve,Et));return ht.push(se),wi(ht)}).then(()=>(Ve.matched.forEach(ce=>ce.enterCallbacks={}),ht=Fp(Ri,"beforeRouteEnter",Ve,Et,lt),ht.push(se),wi(ht))).then(()=>{ht=[];for(const ce of m.list())ht.push(_l(ce,Ve,Et));return ht.push(se),wi(ht)}).catch(ce=>Co(ce,8)?ce:Promise.reject(ce))}function Pt(Ve,Et,ht){l.list().forEach(Je=>lt(()=>Je(Ve,Et,ht)))}function oi(Ve,Et,ht,Je,Pi){const Ri=he(Ve,Et);if(Ri)return Ri;const se=Et===hl,ce=Hc?history.state:{};ht&&(Je||se?d.replace(Ve.fullPath,lr({scroll:se&&ce&&ce.scroll},Pi)):d.push(Ve.fullPath,Pi)),T.value=Ve,ut(Ve,Et,ht,se),Ar()}let pi;function Yt(){pi||(pi=d.listen((Ve,Et,ht)=>{if(!ji.listening)return;const Je=Te(Ve),Pi=Qe(Je);if(Pi){bt(lr(Pi,{replace:!0}),Je).catch(gh);return}P=Je;const Ri=T.value;Hc&&WM(v_(Ri.fullPath,ht.delta),Cf()),Rt(Je,Ri).catch(se=>Co(se,12)?se:Co(se,2)?(bt(se.to,Je).then(ce=>{Co(ce,20)&&!ht.delta&&ht.type===Ch.pop&&d.go(-1,!1)}).catch(gh),Promise.reject()):(ht.delta&&d.go(-ht.delta,!1),gi(se,Je,Ri))).then(se=>{se=se||oi(Je,Ri,!1),se&&(ht.delta&&!Co(se,8)?d.go(-ht.delta,!1):ht.type===Ch.pop&&Co(se,20)&&d.go(-1,!1)),Pt(Je,Ri,se)}).catch(gh)}))}let cr=th(),si=th(),Qt;function gi(Ve,Et,ht){Ar(Ve);const Je=si.list();return Je.length?Je.forEach(Pi=>Pi(Ve,Et,ht)):console.error(Ve),Promise.reject(Ve)}function ur(){return Qt&&T.value!==hl?Promise.resolve():new Promise((Ve,Et)=>{cr.add([Ve,Et])})}function Ar(Ve){return Qt||(Qt=!Ve,Yt(),cr.list().forEach(([Et,ht])=>Ve?ht(Ve):Et()),cr.reset()),Ve}function ut(Ve,Et,ht,Je){const{scrollBehavior:Pi}=e;if(!Hc||!Pi)return Promise.resolve();const Ri=!ht&&XM(v_(Ve.fullPath,0))||(Je||!ht)&&history.state&&history.state.scroll||null;return Bm().then(()=>Pi(Ve,Et,Ri)).then(se=>se&&ZM(se)).catch(se=>gi(se,Ve,Et))}const rt=Ve=>d.go(Ve);let et;const ir=new Set,ji={currentRoute:T,listening:!0,addRoute:Z,removeRoute:K,hasRoute:ge,getRoutes:Y,resolve:Te,options:e,push:Le,replace:We,go:rt,back:()=>rt(-1),forward:()=>rt(1),beforeEach:y.add,beforeResolve:m.add,afterEach:l.add,onError:si.add,isReady:ur,install(Ve){const Et=this;Ve.component("RouterLink",$v),Ve.component("RouterView",MS),Ve.config.globalProperties.$router=Et,Object.defineProperty(Ve.config.globalProperties,"$route",{enumerable:!0,get:()=>er(T)}),Hc&&!et&&T.value===hl&&(et=!0,Le(d.location).catch(Pi=>{}));const ht={};for(const Pi in hl)Object.defineProperty(ht,Pi,{get:()=>T.value[Pi],enumerable:!0});Ve.provide(Af,Et),Ve.provide(qm,j0(ht)),Ve.provide(hm,T);const Je=Ve.unmount;ir.add(Ve),Ve.unmount=function(){ir.delete(Ve),ir.size<1&&(P=hl,pi&&pi(),pi=null,T.value=hl,et=!1,Qt=!1),Je()}}};function wi(Ve){return Ve.reduce((Et,ht)=>Et.then(()=>lt(ht)),Promise.resolve())}return ji}function ES(e,r){const a=[],u=[],d=[],y=Math.max(r.matched.length,e.matched.length);for(let m=0;m<y;m++){const l=r.matched[m];l&&(e.matched.find(P=>lu(P,l))?u.push(l):a.push(l));const T=e.matched[m];T&&(r.matched.find(P=>lu(P,T))||d.push(T))}return[a,u,d]}function Uh(){return da(Af)}function Vh(){return da(qm)}const Ln=Lo("AddressStore",{state:()=>({addressData:{}}),actions:{async fillAddressData(e){try{console.log("Address - fillAddressData is running, address:",e);const r=await fetch(`https://api.phila.gov/ais/v1/search/${e}?include_units=false`);if(r.ok)console.log("Address - await resolved and HTTP status is successful"),this.addressData=await r.json();else{console.log("Address - await resolved but HTTP status was not successful"),this.addressData={};const a=Ys();a.currentAddress=""}}catch{console.error("Address - await never resolved, failed to fetch address data")}}},getters:{getOpaOwners:e=>e.addressData.features[0].properties.opa_owners.join(", ")}});function Uv(e,r){return function(){return e.apply(r,arguments)}}const{toString:TS}=Object.prototype,{getPrototypeOf:Gm}=Object,Pf=(e=>r=>{const a=TS.call(r);return e[a]||(e[a]=a.slice(8,-1).toLowerCase())})(Object.create(null)),oo=e=>(e=e.toLowerCase(),r=>Pf(r)===e),kf=e=>r=>typeof r===e,{isArray:mu}=Array,Ah=kf("undefined");function IS(e){return e!==null&&!Ah(e)&&e.constructor!==null&&!Ah(e.constructor)&&fa(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const Vv=oo("ArrayBuffer");function CS(e){let r;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?r=ArrayBuffer.isView(e):r=e&&e.buffer&&Vv(e.buffer),r}const AS=kf("string"),fa=kf("function"),jv=kf("number"),Df=e=>e!==null&&typeof e=="object",PS=e=>e===!0||e===!1,jd=e=>{if(Pf(e)!=="object")return!1;const r=Gm(e);return(r===null||r===Object.prototype||Object.getPrototypeOf(r)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},kS=oo("Date"),DS=oo("File"),LS=oo("Blob"),RS=oo("FileList"),zS=e=>Df(e)&&fa(e.pipe),OS=e=>{let r;return e&&(typeof FormData=="function"&&e instanceof FormData||fa(e.append)&&((r=Pf(e))==="formdata"||r==="object"&&fa(e.toString)&&e.toString()==="[object FormData]"))},FS=oo("URLSearchParams"),BS=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function jh(e,r,{allOwnKeys:a=!1}={}){if(e===null||typeof e>"u")return;let u,d;if(typeof e!="object"&&(e=[e]),mu(e))for(u=0,d=e.length;u<d;u++)r.call(null,e[u],u,e);else{const y=a?Object.getOwnPropertyNames(e):Object.keys(e),m=y.length;let l;for(u=0;u<m;u++)l=y[u],r.call(null,e[l],l,e)}}function qv(e,r){r=r.toLowerCase();const a=Object.keys(e);let u=a.length,d;for(;u-- >0;)if(d=a[u],r===d.toLowerCase())return d;return null}const Gv=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Hv=e=>!Ah(e)&&e!==Gv;function dm(){const{caseless:e}=Hv(this)&&this||{},r={},a=(u,d)=>{const y=e&&qv(r,d)||d;jd(r[y])&&jd(u)?r[y]=dm(r[y],u):jd(u)?r[y]=dm({},u):mu(u)?r[y]=u.slice():r[y]=u};for(let u=0,d=arguments.length;u<d;u++)arguments[u]&&jh(arguments[u],a);return r}const NS=(e,r,a,{allOwnKeys:u}={})=>(jh(r,(d,y)=>{a&&fa(d)?e[y]=Uv(d,a):e[y]=d},{allOwnKeys:u}),e),$S=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),US=(e,r,a,u)=>{e.prototype=Object.create(r.prototype,u),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:r.prototype}),a&&Object.assign(e.prototype,a)},VS=(e,r,a,u)=>{let d,y,m;const l={};if(r=r||{},e==null)return r;do{for(d=Object.getOwnPropertyNames(e),y=d.length;y-- >0;)m=d[y],(!u||u(m,e,r))&&!l[m]&&(r[m]=e[m],l[m]=!0);e=a!==!1&&Gm(e)}while(e&&(!a||a(e,r))&&e!==Object.prototype);return r},jS=(e,r,a)=>{e=String(e),(a===void 0||a>e.length)&&(a=e.length),a-=r.length;const u=e.indexOf(r,a);return u!==-1&&u===a},qS=e=>{if(!e)return null;if(mu(e))return e;let r=e.length;if(!jv(r))return null;const a=new Array(r);for(;r-- >0;)a[r]=e[r];return a},GS=(e=>r=>e&&r instanceof e)(typeof Uint8Array<"u"&&Gm(Uint8Array)),HS=(e,r)=>{const u=(e&&e[Symbol.iterator]).call(e);let d;for(;(d=u.next())&&!d.done;){const y=d.value;r.call(e,y[0],y[1])}},ZS=(e,r)=>{let a;const u=[];for(;(a=e.exec(r))!==null;)u.push(a);return u},WS=oo("HTMLFormElement"),XS=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(a,u,d){return u.toUpperCase()+d}),L_=(({hasOwnProperty:e})=>(r,a)=>e.call(r,a))(Object.prototype),KS=oo("RegExp"),Zv=(e,r)=>{const a=Object.getOwnPropertyDescriptors(e),u={};jh(a,(d,y)=>{let m;(m=r(d,y,e))!==!1&&(u[y]=m||d)}),Object.defineProperties(e,u)},YS=e=>{Zv(e,(r,a)=>{if(fa(e)&&["arguments","caller","callee"].indexOf(a)!==-1)return!1;const u=e[a];if(fa(u)){if(r.enumerable=!1,"writable"in r){r.writable=!1;return}r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+a+"'")})}})},JS=(e,r)=>{const a={},u=d=>{d.forEach(y=>{a[y]=!0})};return mu(e)?u(e):u(String(e).split(r)),a},QS=()=>{},eE=(e,r)=>(e=+e,Number.isFinite(e)?e:r),Bp="abcdefghijklmnopqrstuvwxyz",R_="0123456789",Wv={DIGIT:R_,ALPHA:Bp,ALPHA_DIGIT:Bp+Bp.toUpperCase()+R_},tE=(e=16,r=Wv.ALPHA_DIGIT)=>{let a="";const{length:u}=r;for(;e--;)a+=r[Math.random()*u|0];return a};function iE(e){return!!(e&&fa(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])}const rE=e=>{const r=new Array(10),a=(u,d)=>{if(Df(u)){if(r.indexOf(u)>=0)return;if(!("toJSON"in u)){r[d]=u;const y=mu(u)?[]:{};return jh(u,(m,l)=>{const T=a(m,d+1);!Ah(T)&&(y[l]=T)}),r[d]=void 0,y}}return u};return a(e,0)},nE=oo("AsyncFunction"),sE=e=>e&&(Df(e)||fa(e))&&fa(e.then)&&fa(e.catch),Ke={isArray:mu,isArrayBuffer:Vv,isBuffer:IS,isFormData:OS,isArrayBufferView:CS,isString:AS,isNumber:jv,isBoolean:PS,isObject:Df,isPlainObject:jd,isUndefined:Ah,isDate:kS,isFile:DS,isBlob:LS,isRegExp:KS,isFunction:fa,isStream:zS,isURLSearchParams:FS,isTypedArray:GS,isFileList:RS,forEach:jh,merge:dm,extend:NS,trim:BS,stripBOM:$S,inherits:US,toFlatObject:VS,kindOf:Pf,kindOfTest:oo,endsWith:jS,toArray:qS,forEachEntry:HS,matchAll:ZS,isHTMLForm:WS,hasOwnProperty:L_,hasOwnProp:L_,reduceDescriptors:Zv,freezeMethods:YS,toObjectSet:JS,toCamelCase:XS,noop:QS,toFiniteNumber:eE,findKey:qv,global:Gv,isContextDefined:Hv,ALPHABET:Wv,generateString:tE,isSpecCompliantForm:iE,toJSONObject:rE,isAsyncFn:nE,isThenable:sE};function Vi(e,r,a,u,d){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",r&&(this.code=r),a&&(this.config=a),u&&(this.request=u),d&&(this.response=d)}Ke.inherits(Vi,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ke.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const Xv=Vi.prototype,Kv={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{Kv[e]={value:e}});Object.defineProperties(Vi,Kv);Object.defineProperty(Xv,"isAxiosError",{value:!0});Vi.from=(e,r,a,u,d,y)=>{const m=Object.create(Xv);return Ke.toFlatObject(e,m,function(T){return T!==Error.prototype},l=>l!=="isAxiosError"),Vi.call(m,e.message,r,a,u,d),m.cause=e,m.name=e.name,y&&Object.assign(m,y),m};const aE=null;function fm(e){return Ke.isPlainObject(e)||Ke.isArray(e)}function Yv(e){return Ke.endsWith(e,"[]")?e.slice(0,-2):e}function z_(e,r,a){return e?e.concat(r).map(function(d,y){return d=Yv(d),!a&&y?"["+d+"]":d}).join(a?".":""):r}function oE(e){return Ke.isArray(e)&&!e.some(fm)}const lE=Ke.toFlatObject(Ke,{},null,function(r){return/^is[A-Z]/.test(r)});function Lf(e,r,a){if(!Ke.isObject(e))throw new TypeError("target must be an object");r=r||new FormData,a=Ke.toFlatObject(a,{metaTokens:!0,dots:!1,indexes:!1},!1,function(Y,ge){return!Ke.isUndefined(ge[Y])});const u=a.metaTokens,d=a.visitor||z,y=a.dots,m=a.indexes,T=(a.Blob||typeof Blob<"u"&&Blob)&&Ke.isSpecCompliantForm(r);if(!Ke.isFunction(d))throw new TypeError("visitor must be a function");function P(K){if(K===null)return"";if(Ke.isDate(K))return K.toISOString();if(!T&&Ke.isBlob(K))throw new Vi("Blob is not supported. Use a Buffer instead.");return Ke.isArrayBuffer(K)||Ke.isTypedArray(K)?T&&typeof Blob=="function"?new Blob([K]):Buffer.from(K):K}function z(K,Y,ge){let Te=K;if(K&&!ge&&typeof K=="object"){if(Ke.endsWith(Y,"{}"))Y=u?Y:Y.slice(0,-2),K=JSON.stringify(K);else if(Ke.isArray(K)&&oE(K)||(Ke.isFileList(K)||Ke.endsWith(Y,"[]"))&&(Te=Ke.toArray(K)))return Y=Yv(Y),Te.forEach(function(he,Le){!(Ke.isUndefined(he)||he===null)&&r.append(m===!0?z_([Y],Le,y):m===null?Y:Y+"[]",P(he))}),!1}return fm(K)?!0:(r.append(z_(ge,Y,y),P(K)),!1)}const k=[],R=Object.assign(lE,{defaultVisitor:z,convertValue:P,isVisitable:fm});function Z(K,Y){if(!Ke.isUndefined(K)){if(k.indexOf(K)!==-1)throw Error("Circular reference detected in "+Y.join("."));k.push(K),Ke.forEach(K,function(Te,Fe){(!(Ke.isUndefined(Te)||Te===null)&&d.call(r,Te,Ke.isString(Fe)?Fe.trim():Fe,Y,R))===!0&&Z(Te,Y?Y.concat(Fe):[Fe])}),k.pop()}}if(!Ke.isObject(e))throw new TypeError("data must be an object");return Z(e),r}function O_(e){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(u){return r[u]})}function Hm(e,r){this._pairs=[],e&&Lf(e,this,r)}const Jv=Hm.prototype;Jv.append=function(r,a){this._pairs.push([r,a])};Jv.toString=function(r){const a=r?function(u){return r.call(this,u,O_)}:O_;return this._pairs.map(function(d){return a(d[0])+"="+a(d[1])},"").join("&")};function cE(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Qv(e,r,a){if(!r)return e;const u=a&&a.encode||cE,d=a&&a.serialize;let y;if(d?y=d(r,a):y=Ke.isURLSearchParams(r)?r.toString():new Hm(r,a).toString(u),y){const m=e.indexOf("#");m!==-1&&(e=e.slice(0,m)),e+=(e.indexOf("?")===-1?"?":"&")+y}return e}class F_{constructor(){this.handlers=[]}use(r,a,u){return this.handlers.push({fulfilled:r,rejected:a,synchronous:u?u.synchronous:!1,runWhen:u?u.runWhen:null}),this.handlers.length-1}eject(r){this.handlers[r]&&(this.handlers[r]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(r){Ke.forEach(this.handlers,function(u){u!==null&&r(u)})}}const ex={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},uE=typeof URLSearchParams<"u"?URLSearchParams:Hm,hE=typeof FormData<"u"?FormData:null,dE=typeof Blob<"u"?Blob:null,fE={isBrowser:!0,classes:{URLSearchParams:uE,FormData:hE,Blob:dE},protocols:["http","https","file","blob","url","data"]},tx=typeof window<"u"&&typeof document<"u",pE=(e=>tx&&["ReactNative","NativeScript","NS"].indexOf(e)<0)(typeof navigator<"u"&&navigator.product),mE=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",gE=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:tx,hasStandardBrowserEnv:pE,hasStandardBrowserWebWorkerEnv:mE},Symbol.toStringTag,{value:"Module"})),io={...gE,...fE};function yE(e,r){return Lf(e,new io.classes.URLSearchParams,Object.assign({visitor:function(a,u,d,y){return io.isNode&&Ke.isBuffer(a)?(this.append(u,a.toString("base64")),!1):y.defaultVisitor.apply(this,arguments)}},r))}function _E(e){return Ke.matchAll(/\w+|\[(\w*)]/g,e).map(r=>r[0]==="[]"?"":r[1]||r[0])}function vE(e){const r={},a=Object.keys(e);let u;const d=a.length;let y;for(u=0;u<d;u++)y=a[u],r[y]=e[y];return r}function ix(e){function r(a,u,d,y){let m=a[y++];if(m==="__proto__")return!0;const l=Number.isFinite(+m),T=y>=a.length;return m=!m&&Ke.isArray(d)?d.length:m,T?(Ke.hasOwnProp(d,m)?d[m]=[d[m],u]:d[m]=u,!l):((!d[m]||!Ke.isObject(d[m]))&&(d[m]=[]),r(a,u,d[m],y)&&Ke.isArray(d[m])&&(d[m]=vE(d[m])),!l)}if(Ke.isFormData(e)&&Ke.isFunction(e.entries)){const a={};return Ke.forEachEntry(e,(u,d)=>{r(_E(u),d,a,0)}),a}return null}function xE(e,r,a){if(Ke.isString(e))try{return(r||JSON.parse)(e),Ke.trim(e)}catch(u){if(u.name!=="SyntaxError")throw u}return(a||JSON.stringify)(e)}const Zm={transitional:ex,adapter:["xhr","http"],transformRequest:[function(r,a){const u=a.getContentType()||"",d=u.indexOf("application/json")>-1,y=Ke.isObject(r);if(y&&Ke.isHTMLForm(r)&&(r=new FormData(r)),Ke.isFormData(r))return d?JSON.stringify(ix(r)):r;if(Ke.isArrayBuffer(r)||Ke.isBuffer(r)||Ke.isStream(r)||Ke.isFile(r)||Ke.isBlob(r))return r;if(Ke.isArrayBufferView(r))return r.buffer;if(Ke.isURLSearchParams(r))return a.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),r.toString();let l;if(y){if(u.indexOf("application/x-www-form-urlencoded")>-1)return yE(r,this.formSerializer).toString();if((l=Ke.isFileList(r))||u.indexOf("multipart/form-data")>-1){const T=this.env&&this.env.FormData;return Lf(l?{"files[]":r}:r,T&&new T,this.formSerializer)}}return y||d?(a.setContentType("application/json",!1),xE(r)):r}],transformResponse:[function(r){const a=this.transitional||Zm.transitional,u=a&&a.forcedJSONParsing,d=this.responseType==="json";if(r&&Ke.isString(r)&&(u&&!this.responseType||d)){const m=!(a&&a.silentJSONParsing)&&d;try{return JSON.parse(r)}catch(l){if(m)throw l.name==="SyntaxError"?Vi.from(l,Vi.ERR_BAD_RESPONSE,this,null,this.response):l}}return r}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:io.classes.FormData,Blob:io.classes.Blob},validateStatus:function(r){return r>=200&&r<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ke.forEach(["delete","get","head","post","put","patch"],e=>{Zm.headers[e]={}});const Wm=Zm,bE=Ke.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),wE=e=>{const r={};let a,u,d;return e&&e.split(`
`).forEach(function(m){d=m.indexOf(":"),a=m.substring(0,d).trim().toLowerCase(),u=m.substring(d+1).trim(),!(!a||r[a]&&bE[a])&&(a==="set-cookie"?r[a]?r[a].push(u):r[a]=[u]:r[a]=r[a]?r[a]+", "+u:u)}),r},B_=Symbol("internals");function ih(e){return e&&String(e).trim().toLowerCase()}function qd(e){return e===!1||e==null?e:Ke.isArray(e)?e.map(qd):String(e)}function ME(e){const r=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let u;for(;u=a.exec(e);)r[u[1]]=u[2];return r}const SE=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function Np(e,r,a,u,d){if(Ke.isFunction(u))return u.call(this,r,a);if(d&&(r=a),!!Ke.isString(r)){if(Ke.isString(u))return r.indexOf(u)!==-1;if(Ke.isRegExp(u))return u.test(r)}}function EE(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(r,a,u)=>a.toUpperCase()+u)}function TE(e,r){const a=Ke.toCamelCase(" "+r);["get","set","has"].forEach(u=>{Object.defineProperty(e,u+a,{value:function(d,y,m){return this[u].call(this,r,d,y,m)},configurable:!0})})}class Rf{constructor(r){r&&this.set(r)}set(r,a,u){const d=this;function y(l,T,P){const z=ih(T);if(!z)throw new Error("header name must be a non-empty string");const k=Ke.findKey(d,z);(!k||d[k]===void 0||P===!0||P===void 0&&d[k]!==!1)&&(d[k||T]=qd(l))}const m=(l,T)=>Ke.forEach(l,(P,z)=>y(P,z,T));return Ke.isPlainObject(r)||r instanceof this.constructor?m(r,a):Ke.isString(r)&&(r=r.trim())&&!SE(r)?m(wE(r),a):r!=null&&y(a,r,u),this}get(r,a){if(r=ih(r),r){const u=Ke.findKey(this,r);if(u){const d=this[u];if(!a)return d;if(a===!0)return ME(d);if(Ke.isFunction(a))return a.call(this,d,u);if(Ke.isRegExp(a))return a.exec(d);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,a){if(r=ih(r),r){const u=Ke.findKey(this,r);return!!(u&&this[u]!==void 0&&(!a||Np(this,this[u],u,a)))}return!1}delete(r,a){const u=this;let d=!1;function y(m){if(m=ih(m),m){const l=Ke.findKey(u,m);l&&(!a||Np(u,u[l],l,a))&&(delete u[l],d=!0)}}return Ke.isArray(r)?r.forEach(y):y(r),d}clear(r){const a=Object.keys(this);let u=a.length,d=!1;for(;u--;){const y=a[u];(!r||Np(this,this[y],y,r,!0))&&(delete this[y],d=!0)}return d}normalize(r){const a=this,u={};return Ke.forEach(this,(d,y)=>{const m=Ke.findKey(u,y);if(m){a[m]=qd(d),delete a[y];return}const l=r?EE(y):String(y).trim();l!==y&&delete a[y],a[l]=qd(d),u[l]=!0}),this}concat(...r){return this.constructor.concat(this,...r)}toJSON(r){const a=Object.create(null);return Ke.forEach(this,(u,d)=>{u!=null&&u!==!1&&(a[d]=r&&Ke.isArray(u)?u.join(", "):u)}),a}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([r,a])=>r+": "+a).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r,...a){const u=new this(r);return a.forEach(d=>u.set(d)),u}static accessor(r){const u=(this[B_]=this[B_]={accessors:{}}).accessors,d=this.prototype;function y(m){const l=ih(m);u[l]||(TE(d,m),u[l]=!0)}return Ke.isArray(r)?r.forEach(y):y(r),this}}Rf.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Ke.reduceDescriptors(Rf.prototype,({value:e},r)=>{let a=r[0].toUpperCase()+r.slice(1);return{get:()=>e,set(u){this[a]=u}}});Ke.freezeMethods(Rf);const ko=Rf;function $p(e,r){const a=this||Wm,u=r||a,d=ko.from(u.headers);let y=u.data;return Ke.forEach(e,function(l){y=l.call(a,y,d.normalize(),r?r.status:void 0)}),d.normalize(),y}function rx(e){return!!(e&&e.__CANCEL__)}function qh(e,r,a){Vi.call(this,e??"canceled",Vi.ERR_CANCELED,r,a),this.name="CanceledError"}Ke.inherits(qh,Vi,{__CANCEL__:!0});function IE(e,r,a){const u=a.config.validateStatus;!a.status||!u||u(a.status)?e(a):r(new Vi("Request failed with status code "+a.status,[Vi.ERR_BAD_REQUEST,Vi.ERR_BAD_RESPONSE][Math.floor(a.status/100)-4],a.config,a.request,a))}const CE=io.hasStandardBrowserEnv?{write(e,r,a,u,d,y){const m=[e+"="+encodeURIComponent(r)];Ke.isNumber(a)&&m.push("expires="+new Date(a).toGMTString()),Ke.isString(u)&&m.push("path="+u),Ke.isString(d)&&m.push("domain="+d),y===!0&&m.push("secure"),document.cookie=m.join("; ")},read(e){const r=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function AE(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function PE(e,r){return r?e.replace(/\/?\/$/,"")+"/"+r.replace(/^\/+/,""):e}function nx(e,r){return e&&!AE(r)?PE(e,r):r}const kE=io.hasStandardBrowserEnv?function(){const r=/(msie|trident)/i.test(navigator.userAgent),a=document.createElement("a");let u;function d(y){let m=y;return r&&(a.setAttribute("href",m),m=a.href),a.setAttribute("href",m),{href:a.href,protocol:a.protocol?a.protocol.replace(/:$/,""):"",host:a.host,search:a.search?a.search.replace(/^\?/,""):"",hash:a.hash?a.hash.replace(/^#/,""):"",hostname:a.hostname,port:a.port,pathname:a.pathname.charAt(0)==="/"?a.pathname:"/"+a.pathname}}return u=d(window.location.href),function(m){const l=Ke.isString(m)?d(m):m;return l.protocol===u.protocol&&l.host===u.host}}():function(){return function(){return!0}}();function DE(e){const r=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return r&&r[1]||""}function LE(e,r){e=e||10;const a=new Array(e),u=new Array(e);let d=0,y=0,m;return r=r!==void 0?r:1e3,function(T){const P=Date.now(),z=u[y];m||(m=P),a[d]=T,u[d]=P;let k=y,R=0;for(;k!==d;)R+=a[k++],k=k%e;if(d=(d+1)%e,d===y&&(y=(y+1)%e),P-m<r)return;const Z=z&&P-z;return Z?Math.round(R*1e3/Z):void 0}}function N_(e,r){let a=0;const u=LE(50,250);return d=>{const y=d.loaded,m=d.lengthComputable?d.total:void 0,l=y-a,T=u(l),P=y<=m;a=y;const z={loaded:y,total:m,progress:m?y/m:void 0,bytes:l,rate:T||void 0,estimated:T&&m&&P?(m-y)/T:void 0,event:d};z[r?"download":"upload"]=!0,e(z)}}const RE=typeof XMLHttpRequest<"u",zE=RE&&function(e){return new Promise(function(a,u){let d=e.data;const y=ko.from(e.headers).normalize();let{responseType:m,withXSRFToken:l}=e,T;function P(){e.cancelToken&&e.cancelToken.unsubscribe(T),e.signal&&e.signal.removeEventListener("abort",T)}let z;if(Ke.isFormData(d)){if(io.hasStandardBrowserEnv||io.hasStandardBrowserWebWorkerEnv)y.setContentType(!1);else if((z=y.getContentType())!==!1){const[Y,...ge]=z?z.split(";").map(Te=>Te.trim()).filter(Boolean):[];y.setContentType([Y||"multipart/form-data",...ge].join("; "))}}let k=new XMLHttpRequest;if(e.auth){const Y=e.auth.username||"",ge=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";y.set("Authorization","Basic "+btoa(Y+":"+ge))}const R=nx(e.baseURL,e.url);k.open(e.method.toUpperCase(),Qv(R,e.params,e.paramsSerializer),!0),k.timeout=e.timeout;function Z(){if(!k)return;const Y=ko.from("getAllResponseHeaders"in k&&k.getAllResponseHeaders()),Te={data:!m||m==="text"||m==="json"?k.responseText:k.response,status:k.status,statusText:k.statusText,headers:Y,config:e,request:k};IE(function(he){a(he),P()},function(he){u(he),P()},Te),k=null}if("onloadend"in k?k.onloadend=Z:k.onreadystatechange=function(){!k||k.readyState!==4||k.status===0&&!(k.responseURL&&k.responseURL.indexOf("file:")===0)||setTimeout(Z)},k.onabort=function(){k&&(u(new Vi("Request aborted",Vi.ECONNABORTED,e,k)),k=null)},k.onerror=function(){u(new Vi("Network Error",Vi.ERR_NETWORK,e,k)),k=null},k.ontimeout=function(){let ge=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";const Te=e.transitional||ex;e.timeoutErrorMessage&&(ge=e.timeoutErrorMessage),u(new Vi(ge,Te.clarifyTimeoutError?Vi.ETIMEDOUT:Vi.ECONNABORTED,e,k)),k=null},io.hasStandardBrowserEnv&&(l&&Ke.isFunction(l)&&(l=l(e)),l||l!==!1&&kE(R))){const Y=e.xsrfHeaderName&&e.xsrfCookieName&&CE.read(e.xsrfCookieName);Y&&y.set(e.xsrfHeaderName,Y)}d===void 0&&y.setContentType(null),"setRequestHeader"in k&&Ke.forEach(y.toJSON(),function(ge,Te){k.setRequestHeader(Te,ge)}),Ke.isUndefined(e.withCredentials)||(k.withCredentials=!!e.withCredentials),m&&m!=="json"&&(k.responseType=e.responseType),typeof e.onDownloadProgress=="function"&&k.addEventListener("progress",N_(e.onDownloadProgress,!0)),typeof e.onUploadProgress=="function"&&k.upload&&k.upload.addEventListener("progress",N_(e.onUploadProgress)),(e.cancelToken||e.signal)&&(T=Y=>{k&&(u(!Y||Y.type?new qh(null,e,k):Y),k.abort(),k=null)},e.cancelToken&&e.cancelToken.subscribe(T),e.signal&&(e.signal.aborted?T():e.signal.addEventListener("abort",T)));const K=DE(R);if(K&&io.protocols.indexOf(K)===-1){u(new Vi("Unsupported protocol "+K+":",Vi.ERR_BAD_REQUEST,e));return}k.send(d||null)})},pm={http:aE,xhr:zE};Ke.forEach(pm,(e,r)=>{if(e){try{Object.defineProperty(e,"name",{value:r})}catch{}Object.defineProperty(e,"adapterName",{value:r})}});const $_=e=>`- ${e}`,OE=e=>Ke.isFunction(e)||e===null||e===!1,sx={getAdapter:e=>{e=Ke.isArray(e)?e:[e];const{length:r}=e;let a,u;const d={};for(let y=0;y<r;y++){a=e[y];let m;if(u=a,!OE(a)&&(u=pm[(m=String(a)).toLowerCase()],u===void 0))throw new Vi(`Unknown adapter '${m}'`);if(u)break;d[m||"#"+y]=u}if(!u){const y=Object.entries(d).map(([l,T])=>`adapter ${l} `+(T===!1?"is not supported by the environment":"is not available in the build"));let m=r?y.length>1?`since :
`+y.map($_).join(`
`):" "+$_(y[0]):"as no adapter specified";throw new Vi("There is no suitable adapter to dispatch the request "+m,"ERR_NOT_SUPPORT")}return u},adapters:pm};function Up(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new qh(null,e)}function U_(e){return Up(e),e.headers=ko.from(e.headers),e.data=$p.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),sx.getAdapter(e.adapter||Wm.adapter)(e).then(function(u){return Up(e),u.data=$p.call(e,e.transformResponse,u),u.headers=ko.from(u.headers),u},function(u){return rx(u)||(Up(e),u&&u.response&&(u.response.data=$p.call(e,e.transformResponse,u.response),u.response.headers=ko.from(u.response.headers))),Promise.reject(u)})}const V_=e=>e instanceof ko?{...e}:e;function uu(e,r){r=r||{};const a={};function u(P,z,k){return Ke.isPlainObject(P)&&Ke.isPlainObject(z)?Ke.merge.call({caseless:k},P,z):Ke.isPlainObject(z)?Ke.merge({},z):Ke.isArray(z)?z.slice():z}function d(P,z,k){if(Ke.isUndefined(z)){if(!Ke.isUndefined(P))return u(void 0,P,k)}else return u(P,z,k)}function y(P,z){if(!Ke.isUndefined(z))return u(void 0,z)}function m(P,z){if(Ke.isUndefined(z)){if(!Ke.isUndefined(P))return u(void 0,P)}else return u(void 0,z)}function l(P,z,k){if(k in r)return u(P,z);if(k in e)return u(void 0,P)}const T={url:y,method:y,data:y,baseURL:m,transformRequest:m,transformResponse:m,paramsSerializer:m,timeout:m,timeoutMessage:m,withCredentials:m,withXSRFToken:m,adapter:m,responseType:m,xsrfCookieName:m,xsrfHeaderName:m,onUploadProgress:m,onDownloadProgress:m,decompress:m,maxContentLength:m,maxBodyLength:m,beforeRedirect:m,transport:m,httpAgent:m,httpsAgent:m,cancelToken:m,socketPath:m,responseEncoding:m,validateStatus:l,headers:(P,z)=>d(V_(P),V_(z),!0)};return Ke.forEach(Object.keys(Object.assign({},e,r)),function(z){const k=T[z]||d,R=k(e[z],r[z],z);Ke.isUndefined(R)&&k!==l||(a[z]=R)}),a}const ax="1.6.8",Xm={};["object","boolean","number","function","string","symbol"].forEach((e,r)=>{Xm[e]=function(u){return typeof u===e||"a"+(r<1?"n ":" ")+e}});const j_={};Xm.transitional=function(r,a,u){function d(y,m){return"[Axios v"+ax+"] Transitional option '"+y+"'"+m+(u?". "+u:"")}return(y,m,l)=>{if(r===!1)throw new Vi(d(m," has been removed"+(a?" in "+a:"")),Vi.ERR_DEPRECATED);return a&&!j_[m]&&(j_[m]=!0,console.warn(d(m," has been deprecated since v"+a+" and will be removed in the near future"))),r?r(y,m,l):!0}};function FE(e,r,a){if(typeof e!="object")throw new Vi("options must be an object",Vi.ERR_BAD_OPTION_VALUE);const u=Object.keys(e);let d=u.length;for(;d-- >0;){const y=u[d],m=r[y];if(m){const l=e[y],T=l===void 0||m(l,y,e);if(T!==!0)throw new Vi("option "+y+" must be "+T,Vi.ERR_BAD_OPTION_VALUE);continue}if(a!==!0)throw new Vi("Unknown option "+y,Vi.ERR_BAD_OPTION)}}const mm={assertOptions:FE,validators:Xm},dl=mm.validators;class sf{constructor(r){this.defaults=r,this.interceptors={request:new F_,response:new F_}}async request(r,a){try{return await this._request(r,a)}catch(u){if(u instanceof Error){let d;Error.captureStackTrace?Error.captureStackTrace(d={}):d=new Error;const y=d.stack?d.stack.replace(/^.+\n/,""):"";u.stack?y&&!String(u.stack).endsWith(y.replace(/^.+\n.+\n/,""))&&(u.stack+=`
`+y):u.stack=y}throw u}}_request(r,a){typeof r=="string"?(a=a||{},a.url=r):a=r||{},a=uu(this.defaults,a);const{transitional:u,paramsSerializer:d,headers:y}=a;u!==void 0&&mm.assertOptions(u,{silentJSONParsing:dl.transitional(dl.boolean),forcedJSONParsing:dl.transitional(dl.boolean),clarifyTimeoutError:dl.transitional(dl.boolean)},!1),d!=null&&(Ke.isFunction(d)?a.paramsSerializer={serialize:d}:mm.assertOptions(d,{encode:dl.function,serialize:dl.function},!0)),a.method=(a.method||this.defaults.method||"get").toLowerCase();let m=y&&Ke.merge(y.common,y[a.method]);y&&Ke.forEach(["delete","get","head","post","put","patch","common"],K=>{delete y[K]}),a.headers=ko.concat(m,y);const l=[];let T=!0;this.interceptors.request.forEach(function(Y){typeof Y.runWhen=="function"&&Y.runWhen(a)===!1||(T=T&&Y.synchronous,l.unshift(Y.fulfilled,Y.rejected))});const P=[];this.interceptors.response.forEach(function(Y){P.push(Y.fulfilled,Y.rejected)});let z,k=0,R;if(!T){const K=[U_.bind(this),void 0];for(K.unshift.apply(K,l),K.push.apply(K,P),R=K.length,z=Promise.resolve(a);k<R;)z=z.then(K[k++],K[k++]);return z}R=l.length;let Z=a;for(k=0;k<R;){const K=l[k++],Y=l[k++];try{Z=K(Z)}catch(ge){Y.call(this,ge);break}}try{z=U_.call(this,Z)}catch(K){return Promise.reject(K)}for(k=0,R=P.length;k<R;)z=z.then(P[k++],P[k++]);return z}getUri(r){r=uu(this.defaults,r);const a=nx(r.baseURL,r.url);return Qv(a,r.params,r.paramsSerializer)}}Ke.forEach(["delete","get","head","options"],function(r){sf.prototype[r]=function(a,u){return this.request(uu(u||{},{method:r,url:a,data:(u||{}).data}))}});Ke.forEach(["post","put","patch"],function(r){function a(u){return function(y,m,l){return this.request(uu(l||{},{method:r,headers:u?{"Content-Type":"multipart/form-data"}:{},url:y,data:m}))}}sf.prototype[r]=a(),sf.prototype[r+"Form"]=a(!0)});const Gd=sf;class Km{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let a;this.promise=new Promise(function(y){a=y});const u=this;this.promise.then(d=>{if(!u._listeners)return;let y=u._listeners.length;for(;y-- >0;)u._listeners[y](d);u._listeners=null}),this.promise.then=d=>{let y;const m=new Promise(l=>{u.subscribe(l),y=l}).then(d);return m.cancel=function(){u.unsubscribe(y)},m},r(function(y,m,l){u.reason||(u.reason=new qh(y,m,l),a(u.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){if(this.reason){r(this.reason);return}this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const a=this._listeners.indexOf(r);a!==-1&&this._listeners.splice(a,1)}static source(){let r;return{token:new Km(function(d){r=d}),cancel:r}}}const BE=Km;function NE(e){return function(a){return e.apply(null,a)}}function $E(e){return Ke.isObject(e)&&e.isAxiosError===!0}const gm={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(gm).forEach(([e,r])=>{gm[r]=e});const UE=gm;function ox(e){const r=new Gd(e),a=Uv(Gd.prototype.request,r);return Ke.extend(a,Gd.prototype,r,{allOwnKeys:!0}),Ke.extend(a,r,null,{allOwnKeys:!0}),a.create=function(d){return ox(uu(e,d))},a}const gr=ox(Wm);gr.Axios=Gd;gr.CanceledError=qh;gr.CancelToken=BE;gr.isCancel=rx;gr.VERSION=ax;gr.toFormData=Lf;gr.AxiosError=Vi;gr.Cancel=gr.CanceledError;gr.all=function(r){return Promise.all(r)};gr.spread=NE;gr.isAxiosError=$E;gr.mergeConfig=uu;gr.AxiosHeaders=ko;gr.formToJSON=e=>ix(Ke.isHTMLForm(e)?new FormData(e):e);gr.getAdapter=sx.getAdapter;gr.HttpStatusCode=UE;gr.default=gr;const zf=Lo("CondosStore",{state:()=>({condosData:{}}),actions:{async fillCondoData(e){const a=Ln().addressData.features;if(!a)return;const u=a[0];let d={include_units:!0,opa_only:!0,page:1};const y=await gr(`//api.phila.gov/ais/v1/search/${e}`,{params:d});if(y.data.features.length>0){let m=[];for(let l of y.data.features)l.properties.address_low_frac!==u.properties.address_low_frac||l.properties.street_address===u.properties.street_address?y.data.total_size=y.data.total_size-1:m.push(l);this.condosData=m}}}});function lx(){return{routeApp:r=>{const a=Ys();a.currentAddress&&a.currentTopic=="Nearby Activity"?r.push({name:"address-topic-and-data",params:{address:a.currentAddress,topic:"Nearby Activity",data:a.currentNearbyDataType}}):a.currentAddress&&a.currentTopic?r.push({name:"address-and-topic",params:{address:a.currentAddress,topic:a.currentTopic}}):a.currentAddress&&r.push({name:"address",params:{address:a.currentAddress}})}}}const pa=(e,r)=>{const a=e.__vccOpts||e;for(const[u,d]of r)a[u]=d;return a},VE={class:"topic-name has-text-left"},jE={key:0,class:"topic-loading has-text-right"},qE={key:0},GE={class:"inside-topic"},HE={__name:"Topic",props:{topicName:String,loading:Boolean},setup(e){const r=Ys(),a=e,u=Vh(),d=Uh(),{routeApp:y}=lx(),m=Ai(()=>u.params.topic==a.topicName),l=()=>{a.topicName==u.params.topic?r.currentTopic="":r.currentTopic=a.topicName,console.log("topic clicked:",a.topicName),y(d)};return(T,P)=>(Dt(),Ht("section",null,[ne("div",{class:"topic",onClick:l},[ne("span",VE,ii(e.topicName),1),m.value&&e.loading?(Dt(),Ht("span",jE,"Loading...")):Ki("",!0)]),m.value?(Dt(),Ht("div",qE,[ne("div",GE,[s2(T.$slots,"default",{},void 0,!0)])])):Ki("",!0)]))}},ic=pa(HE,[["__scopeId","data-v-ed149146"]]);var Zc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ym(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ym={exports:{}};/*!
 * accounting.js v0.4.1
 * Copyright 2014 Open Exchange Rates
 *
 * Freely distributable under the MIT license.
 * Portions of accounting.js are inspired or borrowed from underscore.js
 *
 * Full details and documentation:
 * http://openexchangerates.github.io/accounting.js/
 */(function(e,r){(function(a,u){var d={};d.version="0.4.1",d.settings={currency:{symbol:"$",format:"%s%v",decimal:".",thousand:",",precision:2,grouping:3},number:{precision:0,grouping:3,thousand:",",decimal:"."}};var y=Array.prototype.map,m=Array.isArray,l=Object.prototype.toString;function T(he){return!!(he===""||he&&he.charCodeAt&&he.substr)}function P(he){return m?m(he):l.call(he)==="[object Array]"}function z(he){return he&&l.call(he)==="[object Object]"}function k(he,Le){var We;he=he||{},Le=Le||{};for(We in Le)Le.hasOwnProperty(We)&&he[We]==null&&(he[We]=Le[We]);return he}function R(he,Le,We){var Qe=[],bt,He;if(!he)return Qe;if(y&&he.map===y)return he.map(Le,We);for(bt=0,He=he.length;bt<He;bt++)Qe[bt]=Le.call(We,he[bt],bt,he);return Qe}function Z(he,Le){return he=Math.round(Math.abs(he)),isNaN(he)?Le:he}function K(he){var Le=d.settings.currency.format;return typeof he=="function"&&(he=he()),T(he)&&he.match("%v")?{pos:he,neg:he.replace("-","").replace("%v","-%v"),zero:he}:!he||!he.pos||!he.pos.match("%v")?T(Le)?d.settings.currency.format={pos:Le,neg:Le.replace("%v","-%v"),zero:Le}:Le:he}var Y=d.unformat=d.parse=function(he,Le){if(P(he))return R(he,function(bt){return Y(bt,Le)});if(he=he||0,typeof he=="number")return he;Le=Le||d.settings.number.decimal;var We=new RegExp("[^0-9-"+Le+"]",["g"]),Qe=parseFloat((""+he).replace(/\((.*)\)/,"-$1").replace(We,"").replace(Le,"."));return isNaN(Qe)?0:Qe},ge=d.toFixed=function(he,Le){Le=Z(Le,d.settings.number.precision);var We=Math.pow(10,Le);return(Math.round(d.unformat(he)*We)/We).toFixed(Le)},Te=d.formatNumber=d.format=function(he,Le,We,Qe){if(P(he))return R(he,function(oi){return Te(oi,Le,We,Qe)});he=Y(he);var bt=k(z(Le)?Le:{precision:Le,thousand:We,decimal:Qe},d.settings.number),He=Z(bt.precision),lt=he<0?"-":"",Rt=parseInt(ge(Math.abs(he||0),He),10)+"",Pt=Rt.length>3?Rt.length%3:0;return lt+(Pt?Rt.substr(0,Pt)+bt.thousand:"")+Rt.substr(Pt).replace(/(\d{3})(?=\d)/g,"$1"+bt.thousand)+(He?bt.decimal+ge(Math.abs(he),He).split(".")[1]:"")},Fe=d.formatMoney=function(he,Le,We,Qe,bt,He){if(P(he))return R(he,function(oi){return Fe(oi,Le,We,Qe,bt,He)});he=Y(he);var lt=k(z(Le)?Le:{symbol:Le,precision:We,thousand:Qe,decimal:bt,format:He},d.settings.currency),Rt=K(lt.format),Pt=he>0?Rt.pos:he<0?Rt.neg:Rt.zero;return Pt.replace("%s",lt.symbol).replace("%v",Te(Math.abs(he),Z(lt.precision),lt.thousand,lt.decimal))};d.formatColumn=function(he,Le,We,Qe,bt,He){if(!he)return[];var lt=k(z(Le)?Le:{symbol:Le,precision:We,thousand:Qe,decimal:bt,format:He},d.settings.currency),Rt=K(lt.format),Pt=Rt.pos.indexOf("%s")<Rt.pos.indexOf("%v"),oi=0,pi=R(he,function(Yt,cr){if(P(Yt))return d.formatColumn(Yt,lt);Yt=Y(Yt);var si=Yt>0?Rt.pos:Yt<0?Rt.neg:Rt.zero,Qt=si.replace("%s",lt.symbol).replace("%v",Te(Math.abs(Yt),Z(lt.precision),lt.thousand,lt.decimal));return Qt.length>oi&&(oi=Qt.length),Qt});return R(pi,function(Yt,cr){return T(Yt)&&Yt.length<oi?Pt?Yt.replace(lt.symbol,lt.symbol+new Array(oi-Yt.length+1).join(" ")):new Array(oi-Yt.length+1).join(" ")+Yt:Yt})},e.exports&&(r=e.exports=d),r.accounting=d})()})(ym,ym.exports);var ZE=ym.exports;const cx=Ym(ZE);function Ls(e){const r=Object.prototype.toString.call(e);return e instanceof Date||typeof e=="object"&&r==="[object Date]"?new e.constructor(+e):typeof e=="number"||r==="[object Number]"||typeof e=="string"||r==="[object String]"?new Date(e):new Date(NaN)}function Oa(e,r){return e instanceof Date?new e.constructor(r):new Date(r)}function ux(e,r){const a=Ls(e);return isNaN(r)?Oa(e,NaN):(r&&a.setDate(a.getDate()+r),a)}function hx(e,r){const a=Ls(e);if(isNaN(r))return Oa(e,NaN);if(!r)return a;const u=a.getDate(),d=Oa(e,a.getTime());d.setMonth(a.getMonth()+r+1,0);const y=d.getDate();return u>=y?d:(a.setFullYear(d.getFullYear(),d.getMonth(),u),a)}function WE(e,r){const a=+Ls(e);return Oa(e,a+r)}const dx=6048e5,XE=864e5,fx=6e4,Jm=36e5;function KE(e,r){return WE(e,r*Jm)}let YE={};function Of(){return YE}function Ph(e,r){var l,T,P,z;const a=Of(),u=(r==null?void 0:r.weekStartsOn)??((T=(l=r==null?void 0:r.locale)==null?void 0:l.options)==null?void 0:T.weekStartsOn)??a.weekStartsOn??((z=(P=a.locale)==null?void 0:P.options)==null?void 0:z.weekStartsOn)??0,d=Ls(e),y=d.getDay(),m=(y<u?7:0)+y-u;return d.setDate(d.getDate()-m),d.setHours(0,0,0,0),d}function af(e){return Ph(e,{weekStartsOn:1})}function px(e){const r=Ls(e),a=r.getFullYear(),u=Oa(e,0);u.setFullYear(a+1,0,4),u.setHours(0,0,0,0);const d=af(u),y=Oa(e,0);y.setFullYear(a,0,4),y.setHours(0,0,0,0);const m=af(y);return r.getTime()>=d.getTime()?a+1:r.getTime()>=m.getTime()?a:a-1}function q_(e){const r=Ls(e);return r.setHours(0,0,0,0),r}function G_(e){const r=Ls(e),a=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return a.setUTCFullYear(r.getFullYear()),+e-+a}function JE(e,r){const a=q_(e),u=q_(r),d=+a-G_(a),y=+u-G_(u);return Math.round((d-y)/XE)}function QE(e){const r=px(e),a=Oa(e,0);return a.setFullYear(r,0,4),a.setHours(0,0,0,0),af(a)}function eT(e,r){const a=r*7;return ux(e,a)}function tT(e,r){return hx(e,r*12)}function iT(e){return e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}function rT(e){if(!iT(e)&&typeof e!="number")return!1;const r=Ls(e);return!isNaN(Number(r))}function nT(e){const r=Ls(e),a=Oa(e,0);return a.setFullYear(r.getFullYear(),0,1),a.setHours(0,0,0,0),a}const sT={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},aT=(e,r,a)=>{let u;const d=sT[e];return typeof d=="string"?u=d:r===1?u=d.one:u=d.other.replace("{{count}}",r.toString()),a!=null&&a.addSuffix?a.comparison&&a.comparison>0?"in "+u:u+" ago":u};function Vp(e){return(r={})=>{const a=r.width?String(r.width):e.defaultWidth;return e.formats[a]||e.formats[e.defaultWidth]}}const oT={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},lT={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},cT={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},uT={date:Vp({formats:oT,defaultWidth:"full"}),time:Vp({formats:lT,defaultWidth:"full"}),dateTime:Vp({formats:cT,defaultWidth:"full"})},hT={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},dT=(e,r,a,u)=>hT[e];function rh(e){return(r,a)=>{const u=a!=null&&a.context?String(a.context):"standalone";let d;if(u==="formatting"&&e.formattingValues){const m=e.defaultFormattingWidth||e.defaultWidth,l=a!=null&&a.width?String(a.width):m;d=e.formattingValues[l]||e.formattingValues[m]}else{const m=e.defaultWidth,l=a!=null&&a.width?String(a.width):e.defaultWidth;d=e.values[l]||e.values[m]}const y=e.argumentCallback?e.argumentCallback(r):r;return d[y]}}const fT={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},pT={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},mT={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},gT={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},yT={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},_T={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},vT=(e,r)=>{const a=Number(e),u=a%100;if(u>20||u<10)switch(u%10){case 1:return a+"st";case 2:return a+"nd";case 3:return a+"rd"}return a+"th"},xT={ordinalNumber:vT,era:rh({values:fT,defaultWidth:"wide"}),quarter:rh({values:pT,defaultWidth:"wide",argumentCallback:e=>e-1}),month:rh({values:mT,defaultWidth:"wide"}),day:rh({values:gT,defaultWidth:"wide"}),dayPeriod:rh({values:yT,defaultWidth:"wide",formattingValues:_T,defaultFormattingWidth:"wide"})};function nh(e){return(r,a={})=>{const u=a.width,d=u&&e.matchPatterns[u]||e.matchPatterns[e.defaultMatchWidth],y=r.match(d);if(!y)return null;const m=y[0],l=u&&e.parsePatterns[u]||e.parsePatterns[e.defaultParseWidth],T=Array.isArray(l)?wT(l,k=>k.test(m)):bT(l,k=>k.test(m));let P;P=e.valueCallback?e.valueCallback(T):T,P=a.valueCallback?a.valueCallback(P):P;const z=r.slice(m.length);return{value:P,rest:z}}}function bT(e,r){for(const a in e)if(Object.prototype.hasOwnProperty.call(e,a)&&r(e[a]))return a}function wT(e,r){for(let a=0;a<e.length;a++)if(r(e[a]))return a}function MT(e){return(r,a={})=>{const u=r.match(e.matchPattern);if(!u)return null;const d=u[0],y=r.match(e.parsePattern);if(!y)return null;let m=e.valueCallback?e.valueCallback(y[0]):y[0];m=a.valueCallback?a.valueCallback(m):m;const l=r.slice(d.length);return{value:m,rest:l}}}const ST=/^(\d+)(th|st|nd|rd)?/i,ET=/\d+/i,TT={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},IT={any:[/^b/i,/^(a|c)/i]},CT={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},AT={any:[/1/i,/2/i,/3/i,/4/i]},PT={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},kT={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},DT={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},LT={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},RT={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},zT={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},OT={ordinalNumber:MT({matchPattern:ST,parsePattern:ET,valueCallback:e=>parseInt(e,10)}),era:nh({matchPatterns:TT,defaultMatchWidth:"wide",parsePatterns:IT,defaultParseWidth:"any"}),quarter:nh({matchPatterns:CT,defaultMatchWidth:"wide",parsePatterns:AT,defaultParseWidth:"any",valueCallback:e=>e+1}),month:nh({matchPatterns:PT,defaultMatchWidth:"wide",parsePatterns:kT,defaultParseWidth:"any"}),day:nh({matchPatterns:DT,defaultMatchWidth:"wide",parsePatterns:LT,defaultParseWidth:"any"}),dayPeriod:nh({matchPatterns:RT,defaultMatchWidth:"any",parsePatterns:zT,defaultParseWidth:"any"})},FT={code:"en-US",formatDistance:aT,formatLong:uT,formatRelative:dT,localize:xT,match:OT,options:{weekStartsOn:0,firstWeekContainsDate:1}};function BT(e){const r=Ls(e);return JE(r,nT(r))+1}function NT(e){const r=Ls(e),a=+af(r)-+QE(r);return Math.round(a/dx)+1}function mx(e,r){var z,k,R,Z;const a=Ls(e),u=a.getFullYear(),d=Of(),y=(r==null?void 0:r.firstWeekContainsDate)??((k=(z=r==null?void 0:r.locale)==null?void 0:z.options)==null?void 0:k.firstWeekContainsDate)??d.firstWeekContainsDate??((Z=(R=d.locale)==null?void 0:R.options)==null?void 0:Z.firstWeekContainsDate)??1,m=Oa(e,0);m.setFullYear(u+1,0,y),m.setHours(0,0,0,0);const l=Ph(m,r),T=Oa(e,0);T.setFullYear(u,0,y),T.setHours(0,0,0,0);const P=Ph(T,r);return a.getTime()>=l.getTime()?u+1:a.getTime()>=P.getTime()?u:u-1}function $T(e,r){var l,T,P,z;const a=Of(),u=(r==null?void 0:r.firstWeekContainsDate)??((T=(l=r==null?void 0:r.locale)==null?void 0:l.options)==null?void 0:T.firstWeekContainsDate)??a.firstWeekContainsDate??((z=(P=a.locale)==null?void 0:P.options)==null?void 0:z.firstWeekContainsDate)??1,d=mx(e,r),y=Oa(e,0);return y.setFullYear(d,0,u),y.setHours(0,0,0,0),Ph(y,r)}function UT(e,r){const a=Ls(e),u=+Ph(a,r)-+$T(a,r);return Math.round(u/dx)+1}function or(e,r){const a=e<0?"-":"",u=Math.abs(e).toString().padStart(r,"0");return a+u}const fl={y(e,r){const a=e.getFullYear(),u=a>0?a:1-a;return or(r==="yy"?u%100:u,r.length)},M(e,r){const a=e.getMonth();return r==="M"?String(a+1):or(a+1,2)},d(e,r){return or(e.getDate(),r.length)},a(e,r){const a=e.getHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return a.toUpperCase();case"aaa":return a;case"aaaaa":return a[0];case"aaaa":default:return a==="am"?"a.m.":"p.m."}},h(e,r){return or(e.getHours()%12||12,r.length)},H(e,r){return or(e.getHours(),r.length)},m(e,r){return or(e.getMinutes(),r.length)},s(e,r){return or(e.getSeconds(),r.length)},S(e,r){const a=r.length,u=e.getMilliseconds(),d=Math.trunc(u*Math.pow(10,a-3));return or(d,r.length)}},qc={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},H_={G:function(e,r,a){const u=e.getFullYear()>0?1:0;switch(r){case"G":case"GG":case"GGG":return a.era(u,{width:"abbreviated"});case"GGGGG":return a.era(u,{width:"narrow"});case"GGGG":default:return a.era(u,{width:"wide"})}},y:function(e,r,a){if(r==="yo"){const u=e.getFullYear(),d=u>0?u:1-u;return a.ordinalNumber(d,{unit:"year"})}return fl.y(e,r)},Y:function(e,r,a,u){const d=mx(e,u),y=d>0?d:1-d;if(r==="YY"){const m=y%100;return or(m,2)}return r==="Yo"?a.ordinalNumber(y,{unit:"year"}):or(y,r.length)},R:function(e,r){const a=px(e);return or(a,r.length)},u:function(e,r){const a=e.getFullYear();return or(a,r.length)},Q:function(e,r,a){const u=Math.ceil((e.getMonth()+1)/3);switch(r){case"Q":return String(u);case"QQ":return or(u,2);case"Qo":return a.ordinalNumber(u,{unit:"quarter"});case"QQQ":return a.quarter(u,{width:"abbreviated",context:"formatting"});case"QQQQQ":return a.quarter(u,{width:"narrow",context:"formatting"});case"QQQQ":default:return a.quarter(u,{width:"wide",context:"formatting"})}},q:function(e,r,a){const u=Math.ceil((e.getMonth()+1)/3);switch(r){case"q":return String(u);case"qq":return or(u,2);case"qo":return a.ordinalNumber(u,{unit:"quarter"});case"qqq":return a.quarter(u,{width:"abbreviated",context:"standalone"});case"qqqqq":return a.quarter(u,{width:"narrow",context:"standalone"});case"qqqq":default:return a.quarter(u,{width:"wide",context:"standalone"})}},M:function(e,r,a){const u=e.getMonth();switch(r){case"M":case"MM":return fl.M(e,r);case"Mo":return a.ordinalNumber(u+1,{unit:"month"});case"MMM":return a.month(u,{width:"abbreviated",context:"formatting"});case"MMMMM":return a.month(u,{width:"narrow",context:"formatting"});case"MMMM":default:return a.month(u,{width:"wide",context:"formatting"})}},L:function(e,r,a){const u=e.getMonth();switch(r){case"L":return String(u+1);case"LL":return or(u+1,2);case"Lo":return a.ordinalNumber(u+1,{unit:"month"});case"LLL":return a.month(u,{width:"abbreviated",context:"standalone"});case"LLLLL":return a.month(u,{width:"narrow",context:"standalone"});case"LLLL":default:return a.month(u,{width:"wide",context:"standalone"})}},w:function(e,r,a,u){const d=UT(e,u);return r==="wo"?a.ordinalNumber(d,{unit:"week"}):or(d,r.length)},I:function(e,r,a){const u=NT(e);return r==="Io"?a.ordinalNumber(u,{unit:"week"}):or(u,r.length)},d:function(e,r,a){return r==="do"?a.ordinalNumber(e.getDate(),{unit:"date"}):fl.d(e,r)},D:function(e,r,a){const u=BT(e);return r==="Do"?a.ordinalNumber(u,{unit:"dayOfYear"}):or(u,r.length)},E:function(e,r,a){const u=e.getDay();switch(r){case"E":case"EE":case"EEE":return a.day(u,{width:"abbreviated",context:"formatting"});case"EEEEE":return a.day(u,{width:"narrow",context:"formatting"});case"EEEEEE":return a.day(u,{width:"short",context:"formatting"});case"EEEE":default:return a.day(u,{width:"wide",context:"formatting"})}},e:function(e,r,a,u){const d=e.getDay(),y=(d-u.weekStartsOn+8)%7||7;switch(r){case"e":return String(y);case"ee":return or(y,2);case"eo":return a.ordinalNumber(y,{unit:"day"});case"eee":return a.day(d,{width:"abbreviated",context:"formatting"});case"eeeee":return a.day(d,{width:"narrow",context:"formatting"});case"eeeeee":return a.day(d,{width:"short",context:"formatting"});case"eeee":default:return a.day(d,{width:"wide",context:"formatting"})}},c:function(e,r,a,u){const d=e.getDay(),y=(d-u.weekStartsOn+8)%7||7;switch(r){case"c":return String(y);case"cc":return or(y,r.length);case"co":return a.ordinalNumber(y,{unit:"day"});case"ccc":return a.day(d,{width:"abbreviated",context:"standalone"});case"ccccc":return a.day(d,{width:"narrow",context:"standalone"});case"cccccc":return a.day(d,{width:"short",context:"standalone"});case"cccc":default:return a.day(d,{width:"wide",context:"standalone"})}},i:function(e,r,a){const u=e.getDay(),d=u===0?7:u;switch(r){case"i":return String(d);case"ii":return or(d,r.length);case"io":return a.ordinalNumber(d,{unit:"day"});case"iii":return a.day(u,{width:"abbreviated",context:"formatting"});case"iiiii":return a.day(u,{width:"narrow",context:"formatting"});case"iiiiii":return a.day(u,{width:"short",context:"formatting"});case"iiii":default:return a.day(u,{width:"wide",context:"formatting"})}},a:function(e,r,a){const d=e.getHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return a.dayPeriod(d,{width:"abbreviated",context:"formatting"});case"aaa":return a.dayPeriod(d,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return a.dayPeriod(d,{width:"narrow",context:"formatting"});case"aaaa":default:return a.dayPeriod(d,{width:"wide",context:"formatting"})}},b:function(e,r,a){const u=e.getHours();let d;switch(u===12?d=qc.noon:u===0?d=qc.midnight:d=u/12>=1?"pm":"am",r){case"b":case"bb":return a.dayPeriod(d,{width:"abbreviated",context:"formatting"});case"bbb":return a.dayPeriod(d,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return a.dayPeriod(d,{width:"narrow",context:"formatting"});case"bbbb":default:return a.dayPeriod(d,{width:"wide",context:"formatting"})}},B:function(e,r,a){const u=e.getHours();let d;switch(u>=17?d=qc.evening:u>=12?d=qc.afternoon:u>=4?d=qc.morning:d=qc.night,r){case"B":case"BB":case"BBB":return a.dayPeriod(d,{width:"abbreviated",context:"formatting"});case"BBBBB":return a.dayPeriod(d,{width:"narrow",context:"formatting"});case"BBBB":default:return a.dayPeriod(d,{width:"wide",context:"formatting"})}},h:function(e,r,a){if(r==="ho"){let u=e.getHours()%12;return u===0&&(u=12),a.ordinalNumber(u,{unit:"hour"})}return fl.h(e,r)},H:function(e,r,a){return r==="Ho"?a.ordinalNumber(e.getHours(),{unit:"hour"}):fl.H(e,r)},K:function(e,r,a){const u=e.getHours()%12;return r==="Ko"?a.ordinalNumber(u,{unit:"hour"}):or(u,r.length)},k:function(e,r,a){let u=e.getHours();return u===0&&(u=24),r==="ko"?a.ordinalNumber(u,{unit:"hour"}):or(u,r.length)},m:function(e,r,a){return r==="mo"?a.ordinalNumber(e.getMinutes(),{unit:"minute"}):fl.m(e,r)},s:function(e,r,a){return r==="so"?a.ordinalNumber(e.getSeconds(),{unit:"second"}):fl.s(e,r)},S:function(e,r){return fl.S(e,r)},X:function(e,r,a){const u=e.getTimezoneOffset();if(u===0)return"Z";switch(r){case"X":return W_(u);case"XXXX":case"XX":return rc(u);case"XXXXX":case"XXX":default:return rc(u,":")}},x:function(e,r,a){const u=e.getTimezoneOffset();switch(r){case"x":return W_(u);case"xxxx":case"xx":return rc(u);case"xxxxx":case"xxx":default:return rc(u,":")}},O:function(e,r,a){const u=e.getTimezoneOffset();switch(r){case"O":case"OO":case"OOO":return"GMT"+Z_(u,":");case"OOOO":default:return"GMT"+rc(u,":")}},z:function(e,r,a){const u=e.getTimezoneOffset();switch(r){case"z":case"zz":case"zzz":return"GMT"+Z_(u,":");case"zzzz":default:return"GMT"+rc(u,":")}},t:function(e,r,a){const u=Math.trunc(e.getTime()/1e3);return or(u,r.length)},T:function(e,r,a){const u=e.getTime();return or(u,r.length)}};function Z_(e,r=""){const a=e>0?"-":"+",u=Math.abs(e),d=Math.trunc(u/60),y=u%60;return y===0?a+String(d):a+String(d)+r+or(y,2)}function W_(e,r){return e%60===0?(e>0?"-":"+")+or(Math.abs(e)/60,2):rc(e,r)}function rc(e,r=""){const a=e>0?"-":"+",u=Math.abs(e),d=or(Math.trunc(u/60),2),y=or(u%60,2);return a+d+r+y}const X_=(e,r)=>{switch(e){case"P":return r.date({width:"short"});case"PP":return r.date({width:"medium"});case"PPP":return r.date({width:"long"});case"PPPP":default:return r.date({width:"full"})}},gx=(e,r)=>{switch(e){case"p":return r.time({width:"short"});case"pp":return r.time({width:"medium"});case"ppp":return r.time({width:"long"});case"pppp":default:return r.time({width:"full"})}},VT=(e,r)=>{const a=e.match(/(P+)(p+)?/)||[],u=a[1],d=a[2];if(!d)return X_(e,r);let y;switch(u){case"P":y=r.dateTime({width:"short"});break;case"PP":y=r.dateTime({width:"medium"});break;case"PPP":y=r.dateTime({width:"long"});break;case"PPPP":default:y=r.dateTime({width:"full"});break}return y.replace("{{date}}",X_(u,r)).replace("{{time}}",gx(d,r))},jT={p:gx,P:VT},qT=/^D+$/,GT=/^Y+$/,HT=["D","DD","YY","YYYY"];function ZT(e){return qT.test(e)}function WT(e){return GT.test(e)}function XT(e,r,a){const u=KT(e,r,a);if(console.warn(u),HT.includes(e))throw new RangeError(u)}function KT(e,r,a){const u=e[0]==="Y"?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${r}\`) for formatting ${u} to the input \`${a}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const YT=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,JT=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,QT=/^'([^]*?)'?$/,eI=/''/g,tI=/[a-zA-Z]/;function _m(e,r,a){var z,k,R,Z,K,Y,ge,Te;const u=Of(),d=(a==null?void 0:a.locale)??u.locale??FT,y=(a==null?void 0:a.firstWeekContainsDate)??((k=(z=a==null?void 0:a.locale)==null?void 0:z.options)==null?void 0:k.firstWeekContainsDate)??u.firstWeekContainsDate??((Z=(R=u.locale)==null?void 0:R.options)==null?void 0:Z.firstWeekContainsDate)??1,m=(a==null?void 0:a.weekStartsOn)??((Y=(K=a==null?void 0:a.locale)==null?void 0:K.options)==null?void 0:Y.weekStartsOn)??u.weekStartsOn??((Te=(ge=u.locale)==null?void 0:ge.options)==null?void 0:Te.weekStartsOn)??0,l=Ls(e);if(!rT(l))throw new RangeError("Invalid time value");let T=r.match(JT).map(Fe=>{const he=Fe[0];if(he==="p"||he==="P"){const Le=jT[he];return Le(Fe,d.formatLong)}return Fe}).join("").match(YT).map(Fe=>{if(Fe==="''")return{isToken:!1,value:"'"};const he=Fe[0];if(he==="'")return{isToken:!1,value:iI(Fe)};if(H_[he])return{isToken:!0,value:Fe};if(he.match(tI))throw new RangeError("Format string contains an unescaped latin alphabet character `"+he+"`");return{isToken:!1,value:Fe}});d.localize.preprocessor&&(T=d.localize.preprocessor(l,T));const P={firstWeekContainsDate:y,weekStartsOn:m,locale:d};return T.map(Fe=>{if(!Fe.isToken)return Fe.value;const he=Fe.value;(!(a!=null&&a.useAdditionalWeekYearTokens)&&WT(he)||!(a!=null&&a.useAdditionalDayOfYearTokens)&&ZT(he))&&XT(he,r,String(e));const Le=H_[he[0]];return Le(l,he,d.localize,P)}).join("")}function iI(e){const r=e.match(QT);return r?r[1].replace(eI,"'"):e}function rI(e,r){return ux(e,-r)}function nI(e,r){const a=(r==null?void 0:r.additionalDigits)??2,u=lI(e);let d;if(u.date){const T=cI(u.date,a);d=uI(T.restDateString,T.year)}if(!d||isNaN(d.getTime()))return new Date(NaN);const y=d.getTime();let m=0,l;if(u.time&&(m=hI(u.time),isNaN(m)))return new Date(NaN);if(u.timezone){if(l=dI(u.timezone),isNaN(l))return new Date(NaN)}else{const T=new Date(y+m),P=new Date(0);return P.setFullYear(T.getUTCFullYear(),T.getUTCMonth(),T.getUTCDate()),P.setHours(T.getUTCHours(),T.getUTCMinutes(),T.getUTCSeconds(),T.getUTCMilliseconds()),P}return new Date(y+m+l)}const Ld={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},sI=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,aI=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,oI=/^([+-])(\d{2})(?::?(\d{2}))?$/;function lI(e){const r={},a=e.split(Ld.dateTimeDelimiter);let u;if(a.length>2)return r;if(/:/.test(a[0])?u=a[0]:(r.date=a[0],u=a[1],Ld.timeZoneDelimiter.test(r.date)&&(r.date=e.split(Ld.timeZoneDelimiter)[0],u=e.substr(r.date.length,e.length))),u){const d=Ld.timezone.exec(u);d?(r.time=u.replace(d[1],""),r.timezone=d[1]):r.time=u}return r}function cI(e,r){const a=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+r)+"})|(\\d{2}|[+-]\\d{"+(2+r)+"})$)"),u=e.match(a);if(!u)return{year:NaN,restDateString:""};const d=u[1]?parseInt(u[1]):null,y=u[2]?parseInt(u[2]):null;return{year:y===null?d:y*100,restDateString:e.slice((u[1]||u[2]).length)}}function uI(e,r){if(r===null)return new Date(NaN);const a=e.match(sI);if(!a)return new Date(NaN);const u=!!a[4],d=sh(a[1]),y=sh(a[2])-1,m=sh(a[3]),l=sh(a[4]),T=sh(a[5])-1;if(u)return yI(r,l,T)?fI(r,l,T):new Date(NaN);{const P=new Date(0);return!mI(r,y,m)||!gI(r,d)?new Date(NaN):(P.setUTCFullYear(r,y,Math.max(d,m)),P)}}function sh(e){return e?parseInt(e):1}function hI(e){const r=e.match(aI);if(!r)return NaN;const a=jp(r[1]),u=jp(r[2]),d=jp(r[3]);return _I(a,u,d)?a*Jm+u*fx+d*1e3:NaN}function jp(e){return e&&parseFloat(e.replace(",","."))||0}function dI(e){if(e==="Z")return 0;const r=e.match(oI);if(!r)return 0;const a=r[1]==="+"?-1:1,u=parseInt(r[2]),d=r[3]&&parseInt(r[3])||0;return vI(u,d)?a*(u*Jm+d*fx):NaN}function fI(e,r,a){const u=new Date(0);u.setUTCFullYear(e,0,4);const d=u.getUTCDay()||7,y=(r-1)*7+a+1-d;return u.setUTCDate(u.getUTCDate()+y),u}const pI=[31,null,31,30,31,30,31,31,30,31,30,31];function yx(e){return e%400===0||e%4===0&&e%100!==0}function mI(e,r,a){return r>=0&&r<=11&&a>=1&&a<=(pI[r]||(yx(e)?29:28))}function gI(e,r){return r>=1&&r<=(yx(e)?366:365)}function yI(e,r,a){return r>=1&&r<=53&&a>=0&&a<=6}function _I(e,r,a){return e===24?r===0&&a===0:a>=0&&a<60&&r>=0&&r<60&&e>=0&&e<25}function vI(e,r){return r>=0&&r<=59}function xI(e,r){return hx(e,-r)}function bI(e,r){return KE(e,-r)}function wI(e,r){return eT(e,-r)}function MI(e,r){return tT(e,-r)}cx.settings.currency.precision=0;function Qm(){return{bold:u=>"<strong>"+u+"</strong>",currency:u=>cx.formatMoney(u),date:u=>{let d;return typeof u=="string"?d=_m(nI(u),"MM/dd/yyyy"):d=_m(u,"MM/dd/yyyy"),d}}}const{currency:K_,date:SI}=Qm(),_x=Lo("OpaStore",{state:()=>({opaData:{}}),actions:{async fillOpaData(){const r=Ln().addressData.features[0].properties.opa_account_num,a=await fetch(`https://phl.carto.com/api/v2/sql?q=select+*+from+opa_properties_public+where+parcel_number+%3D+%27${r}%27`);this.opaData=await a.json()}},getters:{getMarketValue:e=>K_(e.opaData.rows[0].market_value||null),getSaleDate:e=>SI(e.opaData.rows[0].sale_date),getSalePrice:e=>K_(e.opaData.rows[0].sale_price)}}),Il=e=>(Fh("data-v-c822a1b7"),e=e(),Bh(),e),EI={key:0,class:"box"},TI={key:1,class:"vert-table"},II={class:"columns"},CI=Il(()=>ne("div",{class:"column is-4"},"OPA Account #",-1)),AI={class:"column is-8"},PI={class:"columns"},kI=Il(()=>ne("div",{class:"column is-4"},"OPA Address",-1)),DI={class:"column is-8"},LI={class:"columns"},RI=Il(()=>ne("div",{class:"column is-4"},"Owners",-1)),zI={class:"column is-8"},OI={class:"columns"},FI=Il(()=>ne("div",{class:"column is-4"},"Assessed Value",-1)),BI={class:"column is-8"},NI={class:"columns"},$I=Il(()=>ne("div",{class:"column is-4"},"Sale Date",-1)),UI={class:"column is-8"},VI={class:"columns"},jI=Il(()=>ne("div",{class:"column is-4"},"Sale Price",-1)),qI={class:"column is-8"},GI={key:2},HI={class:"title is-5"},ZI=Il(()=>ne("p",null,"You can use the Condominiums tab below to see information for an individual unit.",-1)),WI={key:3},XI=Il(()=>ne("p",null,"There is no property assessment record for this address.",-1)),KI=[XI],YI={__name:"Property",setup(e){console.log("Property.vue setup");const r=Ln(),a=_x(),u=zf();return(d,y)=>(Dt(),Ht("section",null,[er(a).opaData.rows.length?(Dt(),Ht("div",EI," Property assessment and sale information for this address. Source: Office of Property Assessments (OPA). OPA was formerly a part of the Bureau of Revision of Taxes (BRT) and some City records may still use that name. ")):Ki("",!0),er(a).opaData.rows.length?(Dt(),Ht("div",TI,[ne("div",II,[CI,ne("div",AI,ii(er(r).addressData.features[0].properties.opa_account_num),1)]),ne("div",PI,[kI,ne("div",DI,ii(er(r).addressData.features[0].properties.opa_address),1)]),ne("div",LI,[RI,ne("div",zI,ii(er(r).getOpaOwners),1)]),ne("div",OI,[FI,ne("div",BI,ii(er(a).getMarketValue),1)]),ne("div",NI,[$I,ne("div",UI,ii(er(a).getSaleDate),1)]),ne("div",VI,[jI,ne("div",qI,ii(er(a).getSalePrice),1)])])):Ki("",!0),!er(a).opaData.rows.length&&er(u).condosData.length?(Dt(),Ht("div",GI,[ne("h5",HI,"There are "+ii(er(u).condosData.length)+" condominium units at this address.",1),ZI])):er(a).opaData.rows.length?Ki("",!0):(Dt(),Ht("div",WI,KI))]))}},JI=pa(YI,[["__scopeId","data-v-c822a1b7"]]),QI=ne("div",{class:"box"}," Condominium units at your search address, as recorded for property assessment purposes. Click one of the addresses below to see information for that unit. Use the back button to return to this list. Source: Office of Property Assessment ",-1),eC=ne("h5",{class:"subtitle is-5"},"Condominiums",-1),tC={class:"table is-fullwidth is-striped"},iC=ne("thead",null,[ne("tr",null,[ne("th",null,"Address"),ne("th",null,"OPA Account #")])],-1),rC={__name:"Condos",setup(e){console.log("Condos.vue setup");const r=zf(),a=Ai(()=>r.condosData);return(u,d)=>(Dt(),Ht("section",null,[QI,eC,ne("table",tC,[iC,ne("tbody",null,[(Dt(!0),Ht($r,null,Pa(a.value,y=>(Dt(),Ht("tr",null,[ne("td",null,[tr(er($v),{to:{name:"address-and-topic",params:{address:y.properties.opa_address,topic:"Property"}}},{default:Ao(()=>[tf(ii(y.properties.opa_address),1)]),_:2},1032,["to"])]),ne("td",null,ii(y.properties.opa_account_num),1)]))),256))])])]))}},Gh=Lo("ParcelsStore",{state:()=>({pwd:{},dor:{}}),actions:{async fillPwdParcelData(){const r=Ln().addressData.features;if(!r)return;const a=r[0],u=a.properties.pwd_parcel_id;if(!u){console.log("no pwd parcel in AIS"),await this.fillParcelDataByLngLat(a.geometry.coordinates[0],a.geometry.coordinates[1],"pwd");return}try{const d=await fetch(`https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/PWD_PARCELS/FeatureServer/0/query?where=PARCELID=%27${u}%27&outSR=4326&f=geojson&outFields=*&returnGeometry=true`);d.ok?this.pwd=await d.json():console.error("Failed to fetch pwd parcel data")}catch{console.error("Failed to fetch pwd parcel data")}},async fillDorParcelData(){const r=Ln().addressData.features;if(!r)return;const a=r[0],u=a.properties.dor_parcel_id;if(!u){console.log("no dor parcel in AIS"),await this.fillParcelDataByLngLat(a.geometry.coordinates[0],a.geometry.coordinates[1],"dor");return}const d="https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/DOR_Parcel/FeatureServer/0/query";let y;if(u.includes("|")){const l=u.split("|");let T="MAPREG = '",P;for(P=0;P<l.length;P++)T=T+l[P]+"'",P<l.length-1&&(T=T+" or MAPREG = '");y=d+"?where="+T}else Array.isArray(u)?y=d+"?where=MAPREG IN ("+u+")":y=d+"?where=MAPREG='"+u+"'";let m={outSR:4326,f:"geojson",outFields:"*",returnGeometry:!0};try{const l=await gr(y,{params:m});if(l.status===200){console.log("response",l);const T=await l.data,P=T.features.filter(R=>R.properties.STATUS===1),z=T.features.filter(R=>R.properties.STATUS===2),k=T.features.filter(R=>R.properties.STATUS===3);T.features=P.concat(z).concat(k),this.dor=T}else console.error("Failed to fetch dor parcel data 1")}catch{console.error("Failed to fetch dor parcel data 2")}},async fillParcelDataByLngLat(e,r,a){console.log("fillParcelDataByLngLat, lng:",e,"lat:",r,"parcelLayer:",a);let u=a==="pwd"?"PWD_PARCELS":"DOR_Parcel",d={where:"1=1",outSR:4326,f:"geojson",outFields:"*",returnGeometry:!0,geometry:`{ "x": ${e}, "y": ${r}, "spatialReference":{ "wkid":4326 }}`,geometryType:"esriGeometryPoint",spatialRel:"esriSpatialRelWithin"};const y=await gr(`https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/${u}/FeatureServer/0/query`,{params:d});console.log("response",y),y.data.features.length>0&&(this[a]=await y.data)}}}),Wc=function(e){var r=e?String(e):"";return r=r.replace(/\s+/g,""),[null,"0"].indexOf(r)>-1?"":r},nC=function(e,r){console.log("concatDorAddress is running, parcel:",e),r=!!r;var a=["STDIR","STNAM","STDES","STDESSUF"],u=e.properties,d=Wc(u.HOUSE),y=Wc(u.STEX),m=Wc(u.SUF),l=d;l=l+(y?"-"+y:""),l=l+(m||"");var T=Wc(u.UNIT);T&&(T="# "+T);var P=a.map(function(z){return u[z]});return P=P.map(Wc),P=[l].concat(P),r&&(P=P.concat([T])),l=P.filter(Boolean).join(" "),l===""&&(l="Parcel has no address"),console.log("concatDorAddress address result:",l),l},vx=Lo("DorStore",{state:()=>({dorDocuments:{}}),actions:{async fillDorDocuments(){this.dorDocuments={};const e=Gh(),r=Ln(),a="//services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/RTT_SUMMARY/FeatureServer/0/query",u=function(d){console.log("where function is running, feature:",d);var y=nC(d),m=r.addressData.features[0].properties,l;if(!y||y==="null")l="MATCHED_REGMAP = '"+e.dor.features[0].properties.BASEREG+"'";else{var T=r.addressData.features[0].properties,P=T.address_low,z=Math.floor(P/100,1)*100,k=P-z,R=T.address_high,Z=R||P;l="(((ADDRESS_LOW >= "+P+" AND ADDRESS_LOW <= "+Z+") OR (ADDRESS_LOW >= "+z+" AND ADDRESS_LOW <= "+Z+" AND ADDRESS_HIGH >= "+k+" )) AND STREET_NAME = '"+m.street_name+"' AND STREET_SUFFIX = '"+m.street_suffix+"' AND (MOD(ADDRESS_LOW,2) = MOD( "+P+",2))",m.street_predir!=""&&(l+=" AND STREET_PREDIR = '"+m.street_predir+"'"),m.address_low_suffix!=""&&(l+=" AND ADDRESS_LOW_SUFFIX = '"+m.address_low_suffix+"'"),m.address_low_suffix==""&&(l+=" AND ADDRESS_LOW_SUFFIX = ''"),m.address_low_frac==="1/2"&&(l+=" AND ADDRESS_LOW_SUFFIX = '2'"),m.street_postdir!=""&&(l+=" AND STREET_POSTDIR = '"+m.street_postdir+"'");var K=Wc(d.properties.UNIT),Y=m.unit_num;K?l+=" AND UNIT_NUM = '"+K+"'":Y!==""&&(l+=" AND UNIT_NUM = '"+Y+"'"),l+=") or MATCHED_REGMAP = '"+e.dor.features[0].properties.BASEREG+"'",l+=" or REG_MAP_ID = '"+e.dor.features[0].properties.BASEREG+"'"}return l};for(let d of e.dor.features){const m={where:u(d),outFields:"DOCUMENT_ID, DISPLAY_DATE, DOCUMENT_TYPE, GRANTORS, GRANTEES",returnDistinctValues:"true",returnGeometry:"false",f:"json",sqlFormat:"standard"};console.log("params:",m);const l=await gr(a,{params:m});this.dorDocuments[d.properties.OBJECTID]=l}}}});function sC(e){e("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),e("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),e("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),e.WGS84=e["EPSG:4326"],e["EPSG:3785"]=e["EPSG:3857"],e.GOOGLE=e["EPSG:3857"],e["EPSG:900913"]=e["EPSG:3857"],e["EPSG:102113"]=e["EPSG:3857"]}var cc=1,uc=2,nu=3,aC=4,vm=5,Y_=6378137,oC=6356752314e-3,J_=.0066943799901413165,_h=484813681109536e-20,gt=Math.PI/2,lC=.16666666666666666,cC=.04722222222222222,uC=.022156084656084655,Lt=1e-10,$n=.017453292519943295,ro=57.29577951308232,rr=Math.PI/4,kh=Math.PI*2,hn=3.14159265359,Rs={};Rs.greenwich=0;Rs.lisbon=-9.131906111111;Rs.paris=2.337229166667;Rs.bogota=-74.080916666667;Rs.madrid=-3.687938888889;Rs.rome=12.452333333333;Rs.bern=7.439583333333;Rs.jakarta=106.807719444444;Rs.ferro=-17.666666666667;Rs.brussels=4.367975;Rs.stockholm=18.058277777778;Rs.athens=23.7163375;Rs.oslo=10.722916666667;const hC={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var Q_=/[\s_\-\/\(\)]/g;function El(e,r){if(e[r])return e[r];for(var a=Object.keys(e),u=r.toLowerCase().replace(Q_,""),d=-1,y,m;++d<a.length;)if(y=a[d],m=y.toLowerCase().replace(Q_,""),m===u)return e[y]}function xm(e){var r={},a=e.split("+").map(function(l){return l.trim()}).filter(function(l){return l}).reduce(function(l,T){var P=T.split("=");return P.push(!0),l[P[0].toLowerCase()]=P[1],l},{}),u,d,y,m={proj:"projName",datum:"datumCode",rf:function(l){r.rf=parseFloat(l)},lat_0:function(l){r.lat0=l*$n},lat_1:function(l){r.lat1=l*$n},lat_2:function(l){r.lat2=l*$n},lat_ts:function(l){r.lat_ts=l*$n},lon_0:function(l){r.long0=l*$n},lon_1:function(l){r.long1=l*$n},lon_2:function(l){r.long2=l*$n},alpha:function(l){r.alpha=parseFloat(l)*$n},gamma:function(l){r.rectified_grid_angle=parseFloat(l)},lonc:function(l){r.longc=l*$n},x_0:function(l){r.x0=parseFloat(l)},y_0:function(l){r.y0=parseFloat(l)},k_0:function(l){r.k0=parseFloat(l)},k:function(l){r.k0=parseFloat(l)},a:function(l){r.a=parseFloat(l)},b:function(l){r.b=parseFloat(l)},r:function(l){r.a=r.b=parseFloat(l)},r_a:function(){r.R_A=!0},zone:function(l){r.zone=parseInt(l,10)},south:function(){r.utmSouth=!0},towgs84:function(l){r.datum_params=l.split(",").map(function(T){return parseFloat(T)})},to_meter:function(l){r.to_meter=parseFloat(l)},units:function(l){r.units=l;var T=El(hC,l);T&&(r.to_meter=T.to_meter)},from_greenwich:function(l){r.from_greenwich=l*$n},pm:function(l){var T=El(Rs,l);r.from_greenwich=(T||parseFloat(l))*$n},nadgrids:function(l){l==="@null"?r.datumCode="none":r.nadgrids=l},axis:function(l){var T="ewnsud";l.length===3&&T.indexOf(l.substr(0,1))!==-1&&T.indexOf(l.substr(1,1))!==-1&&T.indexOf(l.substr(2,1))!==-1&&(r.axis=l)},approx:function(){r.approx=!0}};for(u in a)d=a[u],u in m?(y=m[u],typeof y=="function"?y(d):r[y]=d):r[u]=d;return typeof r.datumCode=="string"&&r.datumCode!=="WGS84"&&(r.datumCode=r.datumCode.toLowerCase()),r}var Dh=1,xx=2,bx=3,of=4,wx=5,eg=-1,dC=/\s/,fC=/[A-Za-z]/,pC=/[A-Za-z84_]/,Ff=/[,\]]/,Mx=/[\d\.E\-\+]/;function Ro(e){if(typeof e!="string")throw new Error("not a string");this.text=e.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=Dh}Ro.prototype.readCharicter=function(){var e=this.text[this.place++];if(this.state!==of)for(;dC.test(e);){if(this.place>=this.text.length)return;e=this.text[this.place++]}switch(this.state){case Dh:return this.neutral(e);case xx:return this.keyword(e);case of:return this.quoted(e);case wx:return this.afterquote(e);case bx:return this.number(e);case eg:return}};Ro.prototype.afterquote=function(e){if(e==='"'){this.word+='"',this.state=of;return}if(Ff.test(e)){this.word=this.word.trim(),this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in afterquote yet, index '+this.place)};Ro.prototype.afterItem=function(e){if(e===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=Dh;return}if(e==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=Dh,this.currentObject=this.stack.pop(),this.currentObject||(this.state=eg);return}};Ro.prototype.number=function(e){if(Mx.test(e)){this.word+=e;return}if(Ff.test(e)){this.word=parseFloat(this.word),this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in number yet, index '+this.place)};Ro.prototype.quoted=function(e){if(e==='"'){this.state=wx;return}this.word+=e};Ro.prototype.keyword=function(e){if(pC.test(e)){this.word+=e;return}if(e==="["){var r=[];r.push(this.word),this.level++,this.root===null?this.root=r:this.currentObject.push(r),this.stack.push(this.currentObject),this.currentObject=r,this.state=Dh;return}if(Ff.test(e)){this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in keyword yet, index '+this.place)};Ro.prototype.neutral=function(e){if(fC.test(e)){this.word=e,this.state=xx;return}if(e==='"'){this.word="",this.state=of;return}if(Mx.test(e)){this.word=e,this.state=bx;return}if(Ff.test(e)){this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in neutral yet, index '+this.place)};Ro.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===eg)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function mC(e){var r=new Ro(e);return r.output()}function e0(e,r,a){Array.isArray(r)&&(a.unshift(r),r=null);var u=r?{}:e,d=a.reduce(function(y,m){return Kc(m,y),y},u);r&&(e[r]=d)}function Kc(e,r){if(!Array.isArray(e)){r[e]=!0;return}var a=e.shift();if(a==="PARAMETER"&&(a=e.shift()),e.length===1){if(Array.isArray(e[0])){r[a]={},Kc(e[0],r[a]);return}r[a]=e[0];return}if(!e.length){r[a]=!0;return}if(a==="TOWGS84"){r[a]=e;return}if(a==="AXIS"){a in r||(r[a]=[]),r[a].push(e);return}Array.isArray(a)||(r[a]={});var u;switch(a){case"UNIT":case"PRIMEM":case"VERT_DATUM":r[a]={name:e[0].toLowerCase(),convert:e[1]},e.length===3&&Kc(e[2],r[a]);return;case"SPHEROID":case"ELLIPSOID":r[a]={name:e[0],a:e[1],rf:e[2]},e.length===4&&Kc(e[3],r[a]);return;case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":e[0]=["name",e[0]],e0(r,a,e);return;default:for(u=-1;++u<e.length;)if(!Array.isArray(e[u]))return Kc(e,r[a]);return e0(r,a,e)}}var gC=.017453292519943295;function yC(e,r){var a=r[0],u=r[1];!(a in e)&&u in e&&(e[a]=e[u],r.length===3&&(e[a]=r[2](e[a])))}function Ja(e){return e*gC}function _C(e){if(e.type==="GEOGCS"?e.projName="longlat":e.type==="LOCAL_CS"?(e.projName="identity",e.local=!0):typeof e.PROJECTION=="object"?e.projName=Object.keys(e.PROJECTION)[0]:e.projName=e.PROJECTION,e.AXIS){for(var r="",a=0,u=e.AXIS.length;a<u;++a){var d=[e.AXIS[a][0].toLowerCase(),e.AXIS[a][1].toLowerCase()];d[0].indexOf("north")!==-1||(d[0]==="y"||d[0]==="lat")&&d[1]==="north"?r+="n":d[0].indexOf("south")!==-1||(d[0]==="y"||d[0]==="lat")&&d[1]==="south"?r+="s":d[0].indexOf("east")!==-1||(d[0]==="x"||d[0]==="lon")&&d[1]==="east"?r+="e":(d[0].indexOf("west")!==-1||(d[0]==="x"||d[0]==="lon")&&d[1]==="west")&&(r+="w")}r.length===2&&(r+="u"),r.length===3&&(e.axis=r)}e.UNIT&&(e.units=e.UNIT.name.toLowerCase(),e.units==="metre"&&(e.units="meter"),e.UNIT.convert&&(e.type==="GEOGCS"?e.DATUM&&e.DATUM.SPHEROID&&(e.to_meter=e.UNIT.convert*e.DATUM.SPHEROID.a):e.to_meter=e.UNIT.convert));var y=e.GEOGCS;e.type==="GEOGCS"&&(y=e),y&&(y.DATUM?e.datumCode=y.DATUM.name.toLowerCase():e.datumCode=y.name.toLowerCase(),e.datumCode.slice(0,2)==="d_"&&(e.datumCode=e.datumCode.slice(2)),(e.datumCode==="new_zealand_geodetic_datum_1949"||e.datumCode==="new_zealand_1949")&&(e.datumCode="nzgd49"),(e.datumCode==="wgs_1984"||e.datumCode==="world_geodetic_system_1984")&&(e.PROJECTION==="Mercator_Auxiliary_Sphere"&&(e.sphere=!0),e.datumCode="wgs84"),e.datumCode.slice(-6)==="_ferro"&&(e.datumCode=e.datumCode.slice(0,-6)),e.datumCode.slice(-8)==="_jakarta"&&(e.datumCode=e.datumCode.slice(0,-8)),~e.datumCode.indexOf("belge")&&(e.datumCode="rnb72"),y.DATUM&&y.DATUM.SPHEROID&&(e.ellps=y.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),e.ellps.toLowerCase().slice(0,13)==="international"&&(e.ellps="intl"),e.a=y.DATUM.SPHEROID.a,e.rf=parseFloat(y.DATUM.SPHEROID.rf,10)),y.DATUM&&y.DATUM.TOWGS84&&(e.datum_params=y.DATUM.TOWGS84),~e.datumCode.indexOf("osgb_1936")&&(e.datumCode="osgb36"),~e.datumCode.indexOf("osni_1952")&&(e.datumCode="osni52"),(~e.datumCode.indexOf("tm65")||~e.datumCode.indexOf("geodetic_datum_of_1965"))&&(e.datumCode="ire65"),e.datumCode==="ch1903+"&&(e.datumCode="ch1903"),~e.datumCode.indexOf("israel")&&(e.datumCode="isr93")),e.b&&!isFinite(e.b)&&(e.b=e.a);function m(P){var z=e.to_meter||1;return P*z}var l=function(P){return yC(e,P)},T=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Ja],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Ja],["x0","false_easting",m],["y0","false_northing",m],["long0","central_meridian",Ja],["lat0","latitude_of_origin",Ja],["lat0","standard_parallel_1",Ja],["lat1","standard_parallel_1",Ja],["lat2","standard_parallel_2",Ja],["azimuth","Azimuth"],["alpha","azimuth",Ja],["srsCode","name"]];T.forEach(l),!e.long0&&e.longc&&(e.projName==="Albers_Conic_Equal_Area"||e.projName==="Lambert_Azimuthal_Equal_Area")&&(e.long0=e.longc),!e.lat_ts&&e.lat1&&(e.projName==="Stereographic_South_Pole"||e.projName==="Polar Stereographic (variant B)")?(e.lat0=Ja(e.lat1>0?90:-90),e.lat_ts=e.lat1):!e.lat_ts&&e.lat0&&e.projName==="Polar_Stereographic"&&(e.lat_ts=e.lat0,e.lat0=Ja(e.lat0>0?90:-90))}function Sx(e){var r=mC(e),a=r.shift(),u=r.shift();r.unshift(["name",u]),r.unshift(["type",a]);var d={};return Kc(r,d),_C(d),d}function fs(e){var r=this;if(arguments.length===2){var a=arguments[1];typeof a=="string"?a.charAt(0)==="+"?fs[e]=xm(arguments[1]):fs[e]=Sx(arguments[1]):fs[e]=a}else if(arguments.length===1){if(Array.isArray(e))return e.map(function(u){Array.isArray(u)?fs.apply(r,u):fs(u)});if(typeof e=="string"){if(e in fs)return fs[e]}else"EPSG"in e?fs["EPSG:"+e.EPSG]=e:"ESRI"in e?fs["ESRI:"+e.ESRI]=e:"IAU2000"in e?fs["IAU2000:"+e.IAU2000]=e:console.log(e);return}}sC(fs);function vC(e){return typeof e=="string"}function xC(e){return e in fs}var bC=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function wC(e){return bC.some(function(r){return e.indexOf(r)>-1})}var MC=["3857","900913","3785","102113"];function SC(e){var r=El(e,"authority");if(r){var a=El(r,"epsg");return a&&MC.indexOf(a)>-1}}function EC(e){var r=El(e,"extension");if(r)return El(r,"proj4")}function TC(e){return e[0]==="+"}function IC(e){if(vC(e)){if(xC(e))return fs[e];if(wC(e)){var r=Sx(e);if(SC(r))return fs["EPSG:3857"];var a=EC(r);return a?xm(a):r}if(TC(e))return xm(e)}else return e}function t0(e,r){e=e||{};var a,u;if(!r)return e;for(u in r)a=r[u],a!==void 0&&(e[u]=a);return e}function ao(e,r,a){var u=e*r;return a/Math.sqrt(1-u*u)}function Hh(e){return e<0?-1:1}function $t(e){return Math.abs(e)<=hn?e:e-Hh(e)*kh}function Ra(e,r,a){var u=e*a,d=.5*e;return u=Math.pow((1-u)/(1+u),d),Math.tan(.5*(gt-r))/u}function Lh(e,r){for(var a=.5*e,u,d,y=gt-2*Math.atan(r),m=0;m<=15;m++)if(u=e*Math.sin(y),d=gt-2*Math.atan(r*Math.pow((1-u)/(1+u),a))-y,y+=d,Math.abs(d)<=1e-10)return y;return-9999}function CC(){var e=this.b/this.a;this.es=1-e*e,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=ao(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function AC(e){var r=e.x,a=e.y;if(a*ro>90&&a*ro<-90&&r*ro>180&&r*ro<-180)return null;var u,d;if(Math.abs(Math.abs(a)-gt)<=Lt)return null;if(this.sphere)u=this.x0+this.a*this.k0*$t(r-this.long0),d=this.y0+this.a*this.k0*Math.log(Math.tan(rr+.5*a));else{var y=Math.sin(a),m=Ra(this.e,a,y);u=this.x0+this.a*this.k0*$t(r-this.long0),d=this.y0-this.a*this.k0*Math.log(m)}return e.x=u,e.y=d,e}function PC(e){var r=e.x-this.x0,a=e.y-this.y0,u,d;if(this.sphere)d=gt-2*Math.atan(Math.exp(-a/(this.a*this.k0)));else{var y=Math.exp(-a/(this.a*this.k0));if(d=Lh(this.e,y),d===-9999)return null}return u=$t(this.long0+r/(this.a*this.k0)),e.x=u,e.y=d,e}var kC=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];const DC={init:CC,forward:AC,inverse:PC,names:kC};function LC(){}function i0(e){return e}var RC=["longlat","identity"];const zC={init:LC,forward:i0,inverse:i0,names:RC};var OC=[DC,zC],Hd={},lf=[];function Ex(e,r){var a=lf.length;return e.names?(lf[a]=e,e.names.forEach(function(u){Hd[u.toLowerCase()]=a}),this):(console.log(r),!0)}function FC(e){if(!e)return!1;var r=e.toLowerCase();if(typeof Hd[r]<"u"&&lf[Hd[r]])return lf[Hd[r]]}function BC(){OC.forEach(Ex)}const NC={start:BC,add:Ex,get:FC};var bi={};bi.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};bi.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};bi.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};bi.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};bi.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"};bi.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};bi.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};bi.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"};bi.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};bi.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};bi.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};bi.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"};bi.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};bi.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"};bi.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."};bi.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"};bi.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"};bi.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};bi.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};bi.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"};bi.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"};bi.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"};bi.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"};bi.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"};bi.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};bi.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};bi.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};bi.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};bi.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};bi.hough={a:6378270,rf:297,ellipseName:"Hough"};bi.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};bi.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};bi.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};bi.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};bi.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"};bi.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};bi.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};bi.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"};bi.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"};bi.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};bi.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};bi.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var $C=bi.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};bi.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function UC(e,r,a,u){var d=e*e,y=r*r,m=(d-y)/d,l=0;u?(e*=1-m*(lC+m*(cC+m*uC)),d=e*e,m=0):l=Math.sqrt(m);var T=(d-y)/y;return{es:m,e:l,ep2:T}}function VC(e,r,a,u,d){if(!e){var y=El(bi,u);y||(y=$C),e=y.a,r=y.b,a=y.rf}return a&&!r&&(r=(1-1/a)*e),(a===0||Math.abs(e-r)<Lt)&&(d=!0,r=e),{a:e,b:r,rf:a,sphere:d}}var Cn={};Cn.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"};Cn.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"};Cn.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"};Cn.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"};Cn.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"};Cn.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"};Cn.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"};Cn.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"};Cn.militargeographische_institut={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"};Cn.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"};Cn.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"};Cn.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"};Cn.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"};Cn.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"};Cn.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"};Cn.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"};Cn.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"};Cn.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};function jC(e,r,a,u,d,y,m){var l={};return e===void 0||e==="none"?l.datum_type=vm:l.datum_type=aC,r&&(l.datum_params=r.map(parseFloat),(l.datum_params[0]!==0||l.datum_params[1]!==0||l.datum_params[2]!==0)&&(l.datum_type=cc),l.datum_params.length>3&&(l.datum_params[3]!==0||l.datum_params[4]!==0||l.datum_params[5]!==0||l.datum_params[6]!==0)&&(l.datum_type=uc,l.datum_params[3]*=_h,l.datum_params[4]*=_h,l.datum_params[5]*=_h,l.datum_params[6]=l.datum_params[6]/1e6+1)),m&&(l.datum_type=nu,l.grids=m),l.a=a,l.b=u,l.es=d,l.ep2=y,l}var Tx={};function qC(e,r){var a=new DataView(r),u=ZC(a),d=WC(a,u),y=XC(a,d,u),m={header:d,subgrids:y};return Tx[e]=m,m}function GC(e){if(e===void 0)return null;var r=e.split(",");return r.map(HC)}function HC(e){if(e.length===0)return null;var r=e[0]==="@";return r&&(e=e.slice(1)),e==="null"?{name:"null",mandatory:!r,grid:null,isNull:!0}:{name:e,mandatory:!r,grid:Tx[e]||null,isNull:!1}}function Yc(e){return e/3600*Math.PI/180}function ZC(e){var r=e.getInt32(8,!1);return r===11?!1:(r=e.getInt32(8,!0),r!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function WC(e,r){return{nFields:e.getInt32(8,r),nSubgridFields:e.getInt32(24,r),nSubgrids:e.getInt32(40,r),shiftType:bm(e,56,64).trim(),fromSemiMajorAxis:e.getFloat64(120,r),fromSemiMinorAxis:e.getFloat64(136,r),toSemiMajorAxis:e.getFloat64(152,r),toSemiMinorAxis:e.getFloat64(168,r)}}function bm(e,r,a){return String.fromCharCode.apply(null,new Uint8Array(e.buffer.slice(r,a)))}function XC(e,r,a){for(var u=176,d=[],y=0;y<r.nSubgrids;y++){var m=YC(e,u,a),l=JC(e,u,m,a),T=Math.round(1+(m.upperLongitude-m.lowerLongitude)/m.longitudeInterval),P=Math.round(1+(m.upperLatitude-m.lowerLatitude)/m.latitudeInterval);d.push({ll:[Yc(m.lowerLongitude),Yc(m.lowerLatitude)],del:[Yc(m.longitudeInterval),Yc(m.latitudeInterval)],lim:[T,P],count:m.gridNodeCount,cvs:KC(l)}),u+=176+m.gridNodeCount*16}return d}function KC(e){return e.map(function(r){return[Yc(r.longitudeShift),Yc(r.latitudeShift)]})}function YC(e,r,a){return{name:bm(e,r+8,r+16).trim(),parent:bm(e,r+24,r+24+8).trim(),lowerLatitude:e.getFloat64(r+72,a),upperLatitude:e.getFloat64(r+88,a),lowerLongitude:e.getFloat64(r+104,a),upperLongitude:e.getFloat64(r+120,a),latitudeInterval:e.getFloat64(r+136,a),longitudeInterval:e.getFloat64(r+152,a),gridNodeCount:e.getInt32(r+168,a)}}function JC(e,r,a,u){for(var d=r+176,y=16,m=[],l=0;l<a.gridNodeCount;l++){var T={latitudeShift:e.getFloat32(d+l*y,u),longitudeShift:e.getFloat32(d+l*y+4,u),latitudeAccuracy:e.getFloat32(d+l*y+8,u),longitudeAccuracy:e.getFloat32(d+l*y+12,u)};m.push(T)}return m}function no(e,r){if(!(this instanceof no))return new no(e);r=r||function(P){if(P)throw P};var a=IC(e);if(typeof a!="object"){r(e);return}var u=no.projections.get(a.projName);if(!u){r(e);return}if(a.datumCode&&a.datumCode!=="none"){var d=El(Cn,a.datumCode);d&&(a.datum_params=a.datum_params||(d.towgs84?d.towgs84.split(","):null),a.ellps=d.ellipse,a.datumName=d.datumName?d.datumName:a.datumCode)}a.k0=a.k0||1,a.axis=a.axis||"enu",a.ellps=a.ellps||"wgs84",a.lat1=a.lat1||a.lat0;var y=VC(a.a,a.b,a.rf,a.ellps,a.sphere),m=UC(y.a,y.b,y.rf,a.R_A),l=GC(a.nadgrids),T=a.datum||jC(a.datumCode,a.datum_params,y.a,y.b,m.es,m.ep2,l);t0(this,a),t0(this,u),this.a=y.a,this.b=y.b,this.rf=y.rf,this.sphere=y.sphere,this.es=m.es,this.e=m.e,this.ep2=m.ep2,this.datum=T,this.init(),r(null,this)}no.projections=NC;no.projections.start();function QC(e,r){return e.datum_type!==r.datum_type||e.a!==r.a||Math.abs(e.es-r.es)>5e-11?!1:e.datum_type===cc?e.datum_params[0]===r.datum_params[0]&&e.datum_params[1]===r.datum_params[1]&&e.datum_params[2]===r.datum_params[2]:e.datum_type===uc?e.datum_params[0]===r.datum_params[0]&&e.datum_params[1]===r.datum_params[1]&&e.datum_params[2]===r.datum_params[2]&&e.datum_params[3]===r.datum_params[3]&&e.datum_params[4]===r.datum_params[4]&&e.datum_params[5]===r.datum_params[5]&&e.datum_params[6]===r.datum_params[6]:!0}function Ix(e,r,a){var u=e.x,d=e.y,y=e.z?e.z:0,m,l,T,P;if(d<-gt&&d>-1.001*gt)d=-gt;else if(d>gt&&d<1.001*gt)d=gt;else{if(d<-gt)return{x:-1/0,y:-1/0,z:e.z};if(d>gt)return{x:1/0,y:1/0,z:e.z}}return u>Math.PI&&(u-=2*Math.PI),l=Math.sin(d),P=Math.cos(d),T=l*l,m=a/Math.sqrt(1-r*T),{x:(m+y)*P*Math.cos(u),y:(m+y)*P*Math.sin(u),z:(m*(1-r)+y)*l}}function Cx(e,r,a,u){var d=1e-12,y=d*d,m=30,l,T,P,z,k,R,Z,K,Y,ge,Te,Fe,he,Le=e.x,We=e.y,Qe=e.z?e.z:0,bt,He,lt;if(l=Math.sqrt(Le*Le+We*We),T=Math.sqrt(Le*Le+We*We+Qe*Qe),l/a<d){if(bt=0,T/a<d)return He=gt,lt=-u,{x:e.x,y:e.y,z:e.z}}else bt=Math.atan2(We,Le);P=Qe/T,z=l/T,k=1/Math.sqrt(1-r*(2-r)*z*z),K=z*(1-r)*k,Y=P*k,he=0;do he++,Z=a/Math.sqrt(1-r*Y*Y),lt=l*K+Qe*Y-Z*(1-r*Y*Y),R=r*Z/(Z+lt),k=1/Math.sqrt(1-R*(2-R)*z*z),ge=z*(1-R)*k,Te=P*k,Fe=Te*K-ge*Y,K=ge,Y=Te;while(Fe*Fe>y&&he<m);return He=Math.atan(Te/Math.abs(ge)),{x:bt,y:He,z:lt}}function eA(e,r,a){if(r===cc)return{x:e.x+a[0],y:e.y+a[1],z:e.z+a[2]};if(r===uc){var u=a[0],d=a[1],y=a[2],m=a[3],l=a[4],T=a[5],P=a[6];return{x:P*(e.x-T*e.y+l*e.z)+u,y:P*(T*e.x+e.y-m*e.z)+d,z:P*(-l*e.x+m*e.y+e.z)+y}}}function tA(e,r,a){if(r===cc)return{x:e.x-a[0],y:e.y-a[1],z:e.z-a[2]};if(r===uc){var u=a[0],d=a[1],y=a[2],m=a[3],l=a[4],T=a[5],P=a[6],z=(e.x-u)/P,k=(e.y-d)/P,R=(e.z-y)/P;return{x:z+T*k-l*R,y:-T*z+k+m*R,z:l*z-m*k+R}}}function Rd(e){return e===cc||e===uc}function iA(e,r,a){if(QC(e,r)||e.datum_type===vm||r.datum_type===vm)return a;var u=e.a,d=e.es;if(e.datum_type===nu){var y=r0(e,!1,a);if(y!==0)return;u=Y_,d=J_}var m=r.a,l=r.b,T=r.es;if(r.datum_type===nu&&(m=Y_,l=oC,T=J_),d===T&&u===m&&!Rd(e.datum_type)&&!Rd(r.datum_type))return a;if(a=Ix(a,d,u),Rd(e.datum_type)&&(a=eA(a,e.datum_type,e.datum_params)),Rd(r.datum_type)&&(a=tA(a,r.datum_type,r.datum_params)),a=Cx(a,T,m,l),r.datum_type===nu){var P=r0(r,!0,a);if(P!==0)return}return a}function r0(e,r,a){if(e.grids===null||e.grids.length===0)return console.log("Grid shift grids not found"),-1;var u={x:-a.x,y:a.y},d={x:Number.NaN,y:Number.NaN},y=[];e:for(var m=0;m<e.grids.length;m++){var l=e.grids[m];if(y.push(l.name),l.isNull){d=u;break}if(l.mandatory,l.grid===null){if(l.mandatory)return console.log("Unable to find mandatory grid '"+l.name+"'"),-1;continue}for(var T=l.grid.subgrids,P=0,z=T.length;P<z;P++){var k=T[P],R=(Math.abs(k.del[1])+Math.abs(k.del[0]))/1e4,Z=k.ll[0]-R,K=k.ll[1]-R,Y=k.ll[0]+(k.lim[0]-1)*k.del[0]+R,ge=k.ll[1]+(k.lim[1]-1)*k.del[1]+R;if(!(K>u.y||Z>u.x||ge<u.y||Y<u.x)&&(d=rA(u,r,k),!isNaN(d.x)))break e}}return isNaN(d.x)?(console.log("Failed to find a grid shift table for location '"+-u.x*ro+" "+u.y*ro+" tried: '"+y+"'"),-1):(a.x=-d.x,a.y=d.y,0)}function rA(e,r,a){var u={x:Number.NaN,y:Number.NaN};if(isNaN(e.x))return u;var d={x:e.x,y:e.y};d.x-=a.ll[0],d.y-=a.ll[1],d.x=$t(d.x-Math.PI)+Math.PI;var y=n0(d,a);if(r){if(isNaN(y.x))return u;y.x=d.x-y.x,y.y=d.y-y.y;var m=9,l=1e-12,T,P;do{if(P=n0(y,a),isNaN(P.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}T={x:d.x-(P.x+y.x),y:d.y-(P.y+y.y)},y.x+=T.x,y.y+=T.y}while(m--&&Math.abs(T.x)>l&&Math.abs(T.y)>l);if(m<0)return console.log("Inverse grid shift iterator failed to converge."),u;u.x=$t(y.x+a.ll[0]),u.y=y.y+a.ll[1]}else isNaN(y.x)||(u.x=e.x+y.x,u.y=e.y+y.y);return u}function n0(e,r){var a={x:e.x/r.del[0],y:e.y/r.del[1]},u={x:Math.floor(a.x),y:Math.floor(a.y)},d={x:a.x-1*u.x,y:a.y-1*u.y},y={x:Number.NaN,y:Number.NaN},m;if(u.x<0||u.x>=r.lim[0]||u.y<0||u.y>=r.lim[1])return y;m=u.y*r.lim[0]+u.x;var l={x:r.cvs[m][0],y:r.cvs[m][1]};m++;var T={x:r.cvs[m][0],y:r.cvs[m][1]};m+=r.lim[0];var P={x:r.cvs[m][0],y:r.cvs[m][1]};m--;var z={x:r.cvs[m][0],y:r.cvs[m][1]},k=d.x*d.y,R=d.x*(1-d.y),Z=(1-d.x)*(1-d.y),K=(1-d.x)*d.y;return y.x=Z*l.x+R*T.x+K*z.x+k*P.x,y.y=Z*l.y+R*T.y+K*z.y+k*P.y,y}function s0(e,r,a){var u=a.x,d=a.y,y=a.z||0,m,l,T,P={};for(T=0;T<3;T++)if(!(r&&T===2&&a.z===void 0))switch(T===0?(m=u,"ew".indexOf(e.axis[T])!==-1?l="x":l="y"):T===1?(m=d,"ns".indexOf(e.axis[T])!==-1?l="y":l="x"):(m=y,l="z"),e.axis[T]){case"e":P[l]=m;break;case"w":P[l]=-m;break;case"n":P[l]=m;break;case"s":P[l]=-m;break;case"u":a[l]!==void 0&&(P.z=m);break;case"d":a[l]!==void 0&&(P.z=-m);break;default:return null}return P}function Ax(e){var r={x:e[0],y:e[1]};return e.length>2&&(r.z=e[2]),e.length>3&&(r.m=e[3]),r}function nA(e){a0(e.x),a0(e.y)}function a0(e){if(typeof Number.isFinite=="function"){if(Number.isFinite(e))return;throw new TypeError("coordinates must be finite numbers")}if(typeof e!="number"||e!==e||!isFinite(e))throw new TypeError("coordinates must be finite numbers")}function sA(e,r){return(e.datum.datum_type===cc||e.datum.datum_type===uc||e.datum.datum_type===nu)&&r.datumCode!=="WGS84"||(r.datum.datum_type===cc||r.datum.datum_type===uc||r.datum.datum_type===nu)&&e.datumCode!=="WGS84"}function cf(e,r,a,u){var d;Array.isArray(a)?a=Ax(a):a={x:a.x,y:a.y,z:a.z,m:a.m};var y=a.z!==void 0;if(nA(a),e.datum&&r.datum&&sA(e,r)&&(d=new no("WGS84"),a=cf(e,d,a,u),e=d),u&&e.axis!=="enu"&&(a=s0(e,!1,a)),e.projName==="longlat")a={x:a.x*$n,y:a.y*$n,z:a.z||0};else if(e.to_meter&&(a={x:a.x*e.to_meter,y:a.y*e.to_meter,z:a.z||0}),a=e.inverse(a),!a)return;if(e.from_greenwich&&(a.x+=e.from_greenwich),a=iA(e.datum,r.datum,a),!!a)return r.from_greenwich&&(a={x:a.x-r.from_greenwich,y:a.y,z:a.z||0}),r.projName==="longlat"?a={x:a.x*ro,y:a.y*ro,z:a.z||0}:(a=r.forward(a),r.to_meter&&(a={x:a.x/r.to_meter,y:a.y/r.to_meter,z:a.z||0})),u&&r.axis!=="enu"?s0(r,!0,a):(a&&!y&&delete a.z,a)}var o0=no("WGS84");function qp(e,r,a,u){var d,y,m;return Array.isArray(a)?(d=cf(e,r,a,u)||{x:NaN,y:NaN},a.length>2?typeof e.name<"u"&&e.name==="geocent"||typeof r.name<"u"&&r.name==="geocent"?typeof d.z=="number"?[d.x,d.y,d.z].concat(a.splice(3)):[d.x,d.y,a[2]].concat(a.splice(3)):[d.x,d.y].concat(a.splice(2)):[d.x,d.y]):(y=cf(e,r,a,u),m=Object.keys(a),m.length===2||m.forEach(function(l){if(typeof e.name<"u"&&e.name==="geocent"||typeof r.name<"u"&&r.name==="geocent"){if(l==="x"||l==="y"||l==="z")return}else if(l==="x"||l==="y")return;y[l]=a[l]}),y)}function l0(e){return e instanceof no?e:e.oProj?e.oProj:no(e)}function Ks(e,r,a){e=l0(e);var u=!1,d;return typeof r>"u"?(r=e,e=o0,u=!0):(typeof r.x<"u"||Array.isArray(r))&&(a=r,r=e,e=o0,u=!0),r=l0(r),a?qp(e,r,a):(d={forward:function(y,m){return qp(e,r,y,m)},inverse:function(y,m){return qp(r,e,y,m)}},u&&(d.oProj=r),d)}var c0=6,Px="AJSAJS",kx="AFAFAF",Jc=65,Is=73,ca=79,lh=86,ch=90;const aA={forward:Dx,inverse:oA,toPoint:Lx};function Dx(e,r){return r=r||5,uA(lA({lat:e[1],lon:e[0]}),r)}function oA(e){var r=tg(zx(e.toUpperCase()));return r.lat&&r.lon?[r.lon,r.lat,r.lon,r.lat]:[r.left,r.bottom,r.right,r.top]}function Lx(e){var r=tg(zx(e.toUpperCase()));return r.lat&&r.lon?[r.lon,r.lat]:[(r.left+r.right)/2,(r.top+r.bottom)/2]}function Gp(e){return e*(Math.PI/180)}function u0(e){return 180*(e/Math.PI)}function lA(e){var r=e.lat,a=e.lon,u=6378137,d=.00669438,y=.9996,m,l,T,P,z,k,R,Z=Gp(r),K=Gp(a),Y,ge;ge=Math.floor((a+180)/6)+1,a===180&&(ge=60),r>=56&&r<64&&a>=3&&a<12&&(ge=32),r>=72&&r<84&&(a>=0&&a<9?ge=31:a>=9&&a<21?ge=33:a>=21&&a<33?ge=35:a>=33&&a<42&&(ge=37)),m=(ge-1)*6-180+3,Y=Gp(m),l=d/(1-d),T=u/Math.sqrt(1-d*Math.sin(Z)*Math.sin(Z)),P=Math.tan(Z)*Math.tan(Z),z=l*Math.cos(Z)*Math.cos(Z),k=Math.cos(Z)*(K-Y),R=u*((1-d/4-3*d*d/64-5*d*d*d/256)*Z-(3*d/8+3*d*d/32+45*d*d*d/1024)*Math.sin(2*Z)+(15*d*d/256+45*d*d*d/1024)*Math.sin(4*Z)-35*d*d*d/3072*Math.sin(6*Z));var Te=y*T*(k+(1-P+z)*k*k*k/6+(5-18*P+P*P+72*z-58*l)*k*k*k*k*k/120)+5e5,Fe=y*(R+T*Math.tan(Z)*(k*k/2+(5-P+9*z+4*z*z)*k*k*k*k/24+(61-58*P+P*P+600*z-330*l)*k*k*k*k*k*k/720));return r<0&&(Fe+=1e7),{northing:Math.round(Fe),easting:Math.round(Te),zoneNumber:ge,zoneLetter:cA(r)}}function tg(e){var r=e.northing,a=e.easting,u=e.zoneLetter,d=e.zoneNumber;if(d<0||d>60)return null;var y=.9996,m=6378137,l=.00669438,T,P=(1-Math.sqrt(1-l))/(1+Math.sqrt(1-l)),z,k,R,Z,K,Y,ge,Te,Fe,he=a-5e5,Le=r;u<"N"&&(Le-=1e7),ge=(d-1)*6-180+3,T=l/(1-l),Y=Le/y,Te=Y/(m*(1-l/4-3*l*l/64-5*l*l*l/256)),Fe=Te+(3*P/2-27*P*P*P/32)*Math.sin(2*Te)+(21*P*P/16-55*P*P*P*P/32)*Math.sin(4*Te)+151*P*P*P/96*Math.sin(6*Te),z=m/Math.sqrt(1-l*Math.sin(Fe)*Math.sin(Fe)),k=Math.tan(Fe)*Math.tan(Fe),R=T*Math.cos(Fe)*Math.cos(Fe),Z=m*(1-l)/Math.pow(1-l*Math.sin(Fe)*Math.sin(Fe),1.5),K=he/(z*y);var We=Fe-z*Math.tan(Fe)/Z*(K*K/2-(5+3*k+10*R-4*R*R-9*T)*K*K*K*K/24+(61+90*k+298*R+45*k*k-252*T-3*R*R)*K*K*K*K*K*K/720);We=u0(We);var Qe=(K-(1+2*k+R)*K*K*K/6+(5-2*R+28*k-3*R*R+8*T+24*k*k)*K*K*K*K*K/120)/Math.cos(Fe);Qe=ge+u0(Qe);var bt;if(e.accuracy){var He=tg({northing:e.northing+e.accuracy,easting:e.easting+e.accuracy,zoneLetter:e.zoneLetter,zoneNumber:e.zoneNumber});bt={top:He.lat,right:He.lon,bottom:We,left:Qe}}else bt={lat:We,lon:Qe};return bt}function cA(e){var r="Z";return 84>=e&&e>=72?r="X":72>e&&e>=64?r="W":64>e&&e>=56?r="V":56>e&&e>=48?r="U":48>e&&e>=40?r="T":40>e&&e>=32?r="S":32>e&&e>=24?r="R":24>e&&e>=16?r="Q":16>e&&e>=8?r="P":8>e&&e>=0?r="N":0>e&&e>=-8?r="M":-8>e&&e>=-16?r="L":-16>e&&e>=-24?r="K":-24>e&&e>=-32?r="J":-32>e&&e>=-40?r="H":-40>e&&e>=-48?r="G":-48>e&&e>=-56?r="F":-56>e&&e>=-64?r="E":-64>e&&e>=-72?r="D":-72>e&&e>=-80&&(r="C"),r}function uA(e,r){var a="00000"+e.easting,u="00000"+e.northing;return e.zoneNumber+e.zoneLetter+hA(e.easting,e.northing,e.zoneNumber)+a.substr(a.length-5,r)+u.substr(u.length-5,r)}function hA(e,r,a){var u=Rx(a),d=Math.floor(e/1e5),y=Math.floor(r/1e5)%20;return dA(d,y,u)}function Rx(e){var r=e%c0;return r===0&&(r=c0),r}function dA(e,r,a){var u=a-1,d=Px.charCodeAt(u),y=kx.charCodeAt(u),m=d+e-1,l=y+r,T=!1;m>ch&&(m=m-ch+Jc-1,T=!0),(m===Is||d<Is&&m>Is||(m>Is||d<Is)&&T)&&m++,(m===ca||d<ca&&m>ca||(m>ca||d<ca)&&T)&&(m++,m===Is&&m++),m>ch&&(m=m-ch+Jc-1),l>lh?(l=l-lh+Jc-1,T=!0):T=!1,(l===Is||y<Is&&l>Is||(l>Is||y<Is)&&T)&&l++,(l===ca||y<ca&&l>ca||(l>ca||y<ca)&&T)&&(l++,l===Is&&l++),l>lh&&(l=l-lh+Jc-1);var P=String.fromCharCode(m)+String.fromCharCode(l);return P}function zx(e){if(e&&e.length===0)throw"MGRSPoint coverting from nothing";for(var r=e.length,a=null,u="",d,y=0;!/[A-Z]/.test(d=e.charAt(y));){if(y>=2)throw"MGRSPoint bad conversion from: "+e;u+=d,y++}var m=parseInt(u,10);if(y===0||y+3>r)throw"MGRSPoint bad conversion from: "+e;var l=e.charAt(y++);if(l<="A"||l==="B"||l==="Y"||l>="Z"||l==="I"||l==="O")throw"MGRSPoint zone letter "+l+" not handled: "+e;a=e.substring(y,y+=2);for(var T=Rx(m),P=fA(a.charAt(0),T),z=pA(a.charAt(1),T);z<mA(l);)z+=2e6;var k=r-y;if(k%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+e;var R=k/2,Z=0,K=0,Y,ge,Te,Fe,he;return R>0&&(Y=1e5/Math.pow(10,R),ge=e.substring(y,y+R),Z=parseFloat(ge)*Y,Te=e.substring(y+R),K=parseFloat(Te)*Y),Fe=Z+P,he=K+z,{easting:Fe,northing:he,zoneLetter:l,zoneNumber:m,accuracy:Y}}function fA(e,r){for(var a=Px.charCodeAt(r-1),u=1e5,d=!1;a!==e.charCodeAt(0);){if(a++,a===Is&&a++,a===ca&&a++,a>ch){if(d)throw"Bad character: "+e;a=Jc,d=!0}u+=1e5}return u}function pA(e,r){if(e>"V")throw"MGRSPoint given invalid Northing "+e;for(var a=kx.charCodeAt(r-1),u=0,d=!1;a!==e.charCodeAt(0);){if(a++,a===Is&&a++,a===ca&&a++,a>lh){if(d)throw"Bad character: "+e;a=Jc,d=!0}u+=1e5}return u}function mA(e){var r;switch(e){case"C":r=11e5;break;case"D":r=2e6;break;case"E":r=28e5;break;case"F":r=37e5;break;case"G":r=46e5;break;case"H":r=55e5;break;case"J":r=64e5;break;case"K":r=73e5;break;case"L":r=82e5;break;case"M":r=91e5;break;case"N":r=0;break;case"P":r=8e5;break;case"Q":r=17e5;break;case"R":r=26e5;break;case"S":r=35e5;break;case"T":r=44e5;break;case"U":r=53e5;break;case"V":r=62e5;break;case"W":r=7e6;break;case"X":r=79e5;break;default:r=-1}if(r>=0)return r;throw"Invalid zone letter: "+e}function hu(e,r,a){if(!(this instanceof hu))return new hu(e,r,a);if(Array.isArray(e))this.x=e[0],this.y=e[1],this.z=e[2]||0;else if(typeof e=="object")this.x=e.x,this.y=e.y,this.z=e.z||0;else if(typeof e=="string"&&typeof r>"u"){var u=e.split(",");this.x=parseFloat(u[0],10),this.y=parseFloat(u[1],10),this.z=parseFloat(u[2],10)||0}else this.x=e,this.y=r,this.z=a||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}hu.fromMGRS=function(e){return new hu(Lx(e))};hu.prototype.toMGRS=function(e){return Dx([this.x,this.y],e)};var gA=1,yA=.25,h0=.046875,d0=.01953125,f0=.01068115234375,_A=.75,vA=.46875,xA=.013020833333333334,bA=.007120768229166667,wA=.3645833333333333,MA=.005696614583333333,SA=.3076171875;function Ox(e){var r=[];r[0]=gA-e*(yA+e*(h0+e*(d0+e*f0))),r[1]=e*(_A-e*(h0+e*(d0+e*f0)));var a=e*e;return r[2]=a*(vA-e*(xA+e*bA)),a*=e,r[3]=a*(wA-e*MA),r[4]=a*e*SA,r}function Bf(e,r,a,u){return a*=r,r*=r,u[0]*e-a*(u[1]+r*(u[2]+r*(u[3]+r*u[4])))}var EA=20;function Fx(e,r,a){for(var u=1/(1-r),d=e,y=EA;y;--y){var m=Math.sin(d),l=1-r*m*m;if(l=(Bf(d,m,Math.cos(d),a)-e)*(l*Math.sqrt(l))*u,d-=l,Math.abs(l)<Lt)return d}return d}function TA(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=Ox(this.es),this.ml0=Bf(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function IA(e){var r=e.x,a=e.y,u=$t(r-this.long0),d,y,m,l=Math.sin(a),T=Math.cos(a);if(this.es){var z=T*u,k=Math.pow(z,2),R=this.ep2*Math.pow(T,2),Z=Math.pow(R,2),K=Math.abs(T)>Lt?Math.tan(a):0,Y=Math.pow(K,2),ge=Math.pow(Y,2);d=1-this.es*Math.pow(l,2),z=z/Math.sqrt(d);var Te=Bf(a,l,T,this.en);y=this.a*(this.k0*z*(1+k/6*(1-Y+R+k/20*(5-18*Y+ge+14*R-58*Y*R+k/42*(61+179*ge-ge*Y-479*Y)))))+this.x0,m=this.a*(this.k0*(Te-this.ml0+l*u*z/2*(1+k/12*(5-Y+9*R+4*Z+k/30*(61+ge-58*Y+270*R-330*Y*R+k/56*(1385+543*ge-ge*Y-3111*Y))))))+this.y0}else{var P=T*Math.sin(u);if(Math.abs(Math.abs(P)-1)<Lt)return 93;if(y=.5*this.a*this.k0*Math.log((1+P)/(1-P))+this.x0,m=T*Math.cos(u)/Math.sqrt(1-Math.pow(P,2)),P=Math.abs(m),P>=1){if(P-1>Lt)return 93;m=0}else m=Math.acos(m);a<0&&(m=-m),m=this.a*this.k0*(m-this.lat0)+this.y0}return e.x=y,e.y=m,e}function CA(e){var r,a,u,d,y=(e.x-this.x0)*(1/this.a),m=(e.y-this.y0)*(1/this.a);if(this.es)if(r=this.ml0+m/this.k0,a=Fx(r,this.es,this.en),Math.abs(a)<gt){var k=Math.sin(a),R=Math.cos(a),Z=Math.abs(R)>Lt?Math.tan(a):0,K=this.ep2*Math.pow(R,2),Y=Math.pow(K,2),ge=Math.pow(Z,2),Te=Math.pow(ge,2);r=1-this.es*Math.pow(k,2);var Fe=y*Math.sqrt(r)/this.k0,he=Math.pow(Fe,2);r=r*Z,u=a-r*he/(1-this.es)*.5*(1-he/12*(5+3*ge-9*K*ge+K-4*Y-he/30*(61+90*ge-252*K*ge+45*Te+46*K-he/56*(1385+3633*ge+4095*Te+1574*Te*ge)))),d=$t(this.long0+Fe*(1-he/6*(1+2*ge+K-he/20*(5+28*ge+24*Te+8*K*ge+6*K-he/42*(61+662*ge+1320*Te+720*Te*ge))))/R)}else u=gt*Hh(m),d=0;else{var l=Math.exp(y/this.k0),T=.5*(l-1/l),P=this.lat0+m/this.k0,z=Math.cos(P);r=Math.sqrt((1-Math.pow(z,2))/(1+Math.pow(T,2))),u=Math.asin(r),m<0&&(u=-u),T===0&&z===0?d=0:d=$t(Math.atan2(T,z)+this.long0)}return e.x=d,e.y=u,e}var AA=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const Zd={init:TA,forward:IA,inverse:CA,names:AA};function Bx(e){var r=Math.exp(e);return r=(r-1/r)/2,r}function ua(e,r){e=Math.abs(e),r=Math.abs(r);var a=Math.max(e,r),u=Math.min(e,r)/(a||1);return a*Math.sqrt(1+Math.pow(u,2))}function PA(e){var r=1+e,a=r-1;return a===0?e:e*Math.log(r)/a}function kA(e){var r=Math.abs(e);return r=PA(r*(1+r/(ua(1,r)+1))),e<0?-r:r}function ig(e,r){for(var a=2*Math.cos(2*r),u=e.length-1,d=e[u],y=0,m;--u>=0;)m=-y+a*d+e[u],y=d,d=m;return r+m*Math.sin(2*r)}function DA(e,r){for(var a=2*Math.cos(r),u=e.length-1,d=e[u],y=0,m;--u>=0;)m=-y+a*d+e[u],y=d,d=m;return Math.sin(r)*m}function LA(e){var r=Math.exp(e);return r=(r+1/r)/2,r}function Nx(e,r,a){for(var u=Math.sin(r),d=Math.cos(r),y=Bx(a),m=LA(a),l=2*d*m,T=-2*u*y,P=e.length-1,z=e[P],k=0,R=0,Z=0,K,Y;--P>=0;)K=R,Y=k,R=z,k=Z,z=-K+l*R-T*k+e[P],Z=-Y+T*R+l*k;return l=u*m,T=d*y,[l*z-T*Z,l*Z+T*z]}function RA(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(Zd.init.apply(this),this.forward=Zd.forward,this.inverse=Zd.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var e=this.es/(1+Math.sqrt(1-this.es)),r=e/(2-e),a=r;this.cgb[0]=r*(2+r*(-2/3+r*(-2+r*(116/45+r*(26/45+r*(-2854/675)))))),this.cbg[0]=r*(-2+r*(2/3+r*(4/3+r*(-82/45+r*(32/45+r*(4642/4725)))))),a=a*r,this.cgb[1]=a*(7/3+r*(-8/5+r*(-227/45+r*(2704/315+r*(2323/945))))),this.cbg[1]=a*(5/3+r*(-16/15+r*(-13/9+r*(904/315+r*(-1522/945))))),a=a*r,this.cgb[2]=a*(56/15+r*(-136/35+r*(-1262/105+r*(73814/2835)))),this.cbg[2]=a*(-26/15+r*(34/21+r*(8/5+r*(-12686/2835)))),a=a*r,this.cgb[3]=a*(4279/630+r*(-332/35+r*(-399572/14175))),this.cbg[3]=a*(1237/630+r*(-12/5+r*(-24832/14175))),a=a*r,this.cgb[4]=a*(4174/315+r*(-144838/6237)),this.cbg[4]=a*(-734/315+r*(109598/31185)),a=a*r,this.cgb[5]=a*(601676/22275),this.cbg[5]=a*(444337/155925),a=Math.pow(r,2),this.Qn=this.k0/(1+r)*(1+a*(1/4+a*(1/64+a/256))),this.utg[0]=r*(-.5+r*(2/3+r*(-37/96+r*(1/360+r*(81/512+r*(-96199/604800)))))),this.gtu[0]=r*(.5+r*(-2/3+r*(5/16+r*(41/180+r*(-127/288+r*(7891/37800)))))),this.utg[1]=a*(-1/48+r*(-1/15+r*(437/1440+r*(-46/105+r*(1118711/3870720))))),this.gtu[1]=a*(13/48+r*(-3/5+r*(557/1440+r*(281/630+r*(-1983433/1935360))))),a=a*r,this.utg[2]=a*(-17/480+r*(37/840+r*(209/4480+r*(-5569/90720)))),this.gtu[2]=a*(61/240+r*(-103/140+r*(15061/26880+r*(167603/181440)))),a=a*r,this.utg[3]=a*(-4397/161280+r*(11/504+r*(830251/7257600))),this.gtu[3]=a*(49561/161280+r*(-179/168+r*(6601661/7257600))),a=a*r,this.utg[4]=a*(-4583/161280+r*(108847/3991680)),this.gtu[4]=a*(34729/80640+r*(-3418889/1995840)),a=a*r,this.utg[5]=a*(-20648693/638668800),this.gtu[5]=a*(212378941/319334400);var u=ig(this.cbg,this.lat0);this.Zb=-this.Qn*(u+DA(this.gtu,2*u))}function zA(e){var r=$t(e.x-this.long0),a=e.y;a=ig(this.cbg,a);var u=Math.sin(a),d=Math.cos(a),y=Math.sin(r),m=Math.cos(r);a=Math.atan2(u,m*d),r=Math.atan2(y*d,ua(u,d*m)),r=kA(Math.tan(r));var l=Nx(this.gtu,2*a,2*r);a=a+l[0],r=r+l[1];var T,P;return Math.abs(r)<=2.623395162778?(T=this.a*(this.Qn*r)+this.x0,P=this.a*(this.Qn*a+this.Zb)+this.y0):(T=1/0,P=1/0),e.x=T,e.y=P,e}function OA(e){var r=(e.x-this.x0)*(1/this.a),a=(e.y-this.y0)*(1/this.a);a=(a-this.Zb)/this.Qn,r=r/this.Qn;var u,d;if(Math.abs(r)<=2.623395162778){var y=Nx(this.utg,2*a,2*r);a=a+y[0],r=r+y[1],r=Math.atan(Bx(r));var m=Math.sin(a),l=Math.cos(a),T=Math.sin(r),P=Math.cos(r);a=Math.atan2(m*P,ua(T,P*l)),r=Math.atan2(T,P*l),u=$t(r+this.long0),d=ig(this.cgb,a)}else u=1/0,d=1/0;return e.x=u,e.y=d,e}var FA=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const Wd={init:RA,forward:zA,inverse:OA,names:FA};function BA(e,r){if(e===void 0){if(e=Math.floor(($t(r)+Math.PI)*30/Math.PI)+1,e<0)return 0;if(e>60)return 60}return e}var NA="etmerc";function $A(){var e=BA(this.zone,this.long0);if(e===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(e)-183)*$n,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Wd.init.apply(this),this.forward=Wd.forward,this.inverse=Wd.inverse}var UA=["Universal Transverse Mercator System","utm"];const VA={init:$A,names:UA,dependsOn:NA};function rg(e,r){return Math.pow((1-e)/(1+e),r)}var jA=20;function qA(){var e=Math.sin(this.lat0),r=Math.cos(this.lat0);r*=r,this.rc=Math.sqrt(1-this.es)/(1-this.es*e*e),this.C=Math.sqrt(1+this.es*r*r/(1-this.es)),this.phic0=Math.asin(e/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+rr)/(Math.pow(Math.tan(.5*this.lat0+rr),this.C)*rg(this.e*e,this.ratexp))}function GA(e){var r=e.x,a=e.y;return e.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*a+rr),this.C)*rg(this.e*Math.sin(a),this.ratexp))-gt,e.x=this.C*r,e}function HA(e){for(var r=1e-14,a=e.x/this.C,u=e.y,d=Math.pow(Math.tan(.5*u+rr)/this.K,1/this.C),y=jA;y>0&&(u=2*Math.atan(d*rg(this.e*Math.sin(e.y),-.5*this.e))-gt,!(Math.abs(u-e.y)<r));--y)e.y=u;return y?(e.x=a,e.y=u,e):null}var ZA=["gauss"];const ng={init:qA,forward:GA,inverse:HA,names:ZA};function WA(){ng.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function XA(e){var r,a,u,d;return e.x=$t(e.x-this.long0),ng.forward.apply(this,[e]),r=Math.sin(e.y),a=Math.cos(e.y),u=Math.cos(e.x),d=this.k0*this.R2/(1+this.sinc0*r+this.cosc0*a*u),e.x=d*a*Math.sin(e.x),e.y=d*(this.cosc0*r-this.sinc0*a*u),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function KA(e){var r,a,u,d,y;if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,y=ua(e.x,e.y)){var m=2*Math.atan2(y,this.R2);r=Math.sin(m),a=Math.cos(m),d=Math.asin(a*this.sinc0+e.y*r*this.cosc0/y),u=Math.atan2(e.x*r,y*this.cosc0*a-e.y*this.sinc0*r)}else d=this.phic0,u=0;return e.x=u,e.y=d,ng.inverse.apply(this,[e]),e.x=$t(e.x+this.long0),e}var YA=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const JA={init:WA,forward:XA,inverse:KA,names:YA};function QA(e,r,a){return r*=a,Math.tan(.5*(gt+e))*Math.pow((1-r)/(1+r),.5*a)}function eP(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Lt&&(this.k0=.5*(1+Hh(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=Lt&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Lt&&Math.abs(Math.cos(this.lat_ts))>Lt&&(this.k0=.5*this.cons*ao(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Ra(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=ao(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-gt,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function tP(e){var r=e.x,a=e.y,u=Math.sin(a),d=Math.cos(a),y,m,l,T,P,z,k=$t(r-this.long0);return Math.abs(Math.abs(r-this.long0)-Math.PI)<=Lt&&Math.abs(a+this.lat0)<=Lt?(e.x=NaN,e.y=NaN,e):this.sphere?(y=2*this.k0/(1+this.sinlat0*u+this.coslat0*d*Math.cos(k)),e.x=this.a*y*d*Math.sin(k)+this.x0,e.y=this.a*y*(this.coslat0*u-this.sinlat0*d*Math.cos(k))+this.y0,e):(m=2*Math.atan(this.ssfn_(a,u,this.e))-gt,T=Math.cos(m),l=Math.sin(m),Math.abs(this.coslat0)<=Lt?(P=Ra(this.e,a*this.con,this.con*u),z=2*this.a*this.k0*P/this.cons,e.x=this.x0+z*Math.sin(r-this.long0),e.y=this.y0-this.con*z*Math.cos(r-this.long0),e):(Math.abs(this.sinlat0)<Lt?(y=2*this.a*this.k0/(1+T*Math.cos(k)),e.y=y*l):(y=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*l+this.cosX0*T*Math.cos(k))),e.y=y*(this.cosX0*l-this.sinX0*T*Math.cos(k))+this.y0),e.x=y*T*Math.sin(k)+this.x0,e))}function iP(e){e.x-=this.x0,e.y-=this.y0;var r,a,u,d,y,m=Math.sqrt(e.x*e.x+e.y*e.y);if(this.sphere){var l=2*Math.atan(m/(2*this.a*this.k0));return r=this.long0,a=this.lat0,m<=Lt?(e.x=r,e.y=a,e):(a=Math.asin(Math.cos(l)*this.sinlat0+e.y*Math.sin(l)*this.coslat0/m),Math.abs(this.coslat0)<Lt?this.lat0>0?r=$t(this.long0+Math.atan2(e.x,-1*e.y)):r=$t(this.long0+Math.atan2(e.x,e.y)):r=$t(this.long0+Math.atan2(e.x*Math.sin(l),m*this.coslat0*Math.cos(l)-e.y*this.sinlat0*Math.sin(l))),e.x=r,e.y=a,e)}else if(Math.abs(this.coslat0)<=Lt){if(m<=Lt)return a=this.lat0,r=this.long0,e.x=r,e.y=a,e;e.x*=this.con,e.y*=this.con,u=m*this.cons/(2*this.a*this.k0),a=this.con*Lh(this.e,u),r=this.con*$t(this.con*this.long0+Math.atan2(e.x,-1*e.y))}else d=2*Math.atan(m*this.cosX0/(2*this.a*this.k0*this.ms1)),r=this.long0,m<=Lt?y=this.X0:(y=Math.asin(Math.cos(d)*this.sinX0+e.y*Math.sin(d)*this.cosX0/m),r=$t(this.long0+Math.atan2(e.x*Math.sin(d),m*this.cosX0*Math.cos(d)-e.y*this.sinX0*Math.sin(d)))),a=-1*Lh(this.e,Math.tan(.5*(gt+y)));return e.x=r,e.y=a,e}var rP=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"];const nP={init:eP,forward:tP,inverse:iP,names:rP,ssfn_:QA};function sP(){var e=this.lat0;this.lambda0=this.long0;var r=Math.sin(e),a=this.a,u=this.rf,d=1/u,y=2*d-Math.pow(d,2),m=this.e=Math.sqrt(y);this.R=this.k0*a*Math.sqrt(1-y)/(1-y*Math.pow(r,2)),this.alpha=Math.sqrt(1+y/(1-y)*Math.pow(Math.cos(e),4)),this.b0=Math.asin(r/this.alpha);var l=Math.log(Math.tan(Math.PI/4+this.b0/2)),T=Math.log(Math.tan(Math.PI/4+e/2)),P=Math.log((1+m*r)/(1-m*r));this.K=l-this.alpha*T+this.alpha*m/2*P}function aP(e){var r=Math.log(Math.tan(Math.PI/4-e.y/2)),a=this.e/2*Math.log((1+this.e*Math.sin(e.y))/(1-this.e*Math.sin(e.y))),u=-this.alpha*(r+a)+this.K,d=2*(Math.atan(Math.exp(u))-Math.PI/4),y=this.alpha*(e.x-this.lambda0),m=Math.atan(Math.sin(y)/(Math.sin(this.b0)*Math.tan(d)+Math.cos(this.b0)*Math.cos(y))),l=Math.asin(Math.cos(this.b0)*Math.sin(d)-Math.sin(this.b0)*Math.cos(d)*Math.cos(y));return e.y=this.R/2*Math.log((1+Math.sin(l))/(1-Math.sin(l)))+this.y0,e.x=this.R*m+this.x0,e}function oP(e){for(var r=e.x-this.x0,a=e.y-this.y0,u=r/this.R,d=2*(Math.atan(Math.exp(a/this.R))-Math.PI/4),y=Math.asin(Math.cos(this.b0)*Math.sin(d)+Math.sin(this.b0)*Math.cos(d)*Math.cos(u)),m=Math.atan(Math.sin(u)/(Math.cos(this.b0)*Math.cos(u)-Math.sin(this.b0)*Math.tan(d))),l=this.lambda0+m/this.alpha,T=0,P=y,z=-1e3,k=0;Math.abs(P-z)>1e-7;){if(++k>20)return;T=1/this.alpha*(Math.log(Math.tan(Math.PI/4+y/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(P))/2)),z=P,P=2*Math.atan(Math.exp(T))-Math.PI/2}return e.x=l,e.y=P,e}var lP=["somerc"];const cP={init:sP,forward:aP,inverse:oP,names:lP};var Xc=1e-7;function uP(e){var r=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],a=typeof e.PROJECTION=="object"?Object.keys(e.PROJECTION)[0]:e.PROJECTION;return"no_uoff"in e||"no_off"in e||r.indexOf(a)!==-1}function hP(){var e,r,a,u,d,y,m,l,T,P,z=0,k,R=0,Z=0,K=0,Y=0,ge=0,Te=0;this.no_off=uP(this),this.no_rot="no_rot"in this;var Fe=!1;"alpha"in this&&(Fe=!0);var he=!1;if("rectified_grid_angle"in this&&(he=!0),Fe&&(Te=this.alpha),he&&(z=this.rectified_grid_angle*$n),Fe||he)R=this.longc;else if(Z=this.long1,Y=this.lat1,K=this.long2,ge=this.lat2,Math.abs(Y-ge)<=Xc||(e=Math.abs(Y))<=Xc||Math.abs(e-gt)<=Xc||Math.abs(Math.abs(this.lat0)-gt)<=Xc||Math.abs(Math.abs(ge)-gt)<=Xc)throw new Error;var Le=1-this.es;r=Math.sqrt(Le),Math.abs(this.lat0)>Lt?(l=Math.sin(this.lat0),a=Math.cos(this.lat0),e=1-this.es*l*l,this.B=a*a,this.B=Math.sqrt(1+this.es*this.B*this.B/Le),this.A=this.B*this.k0*r/e,u=this.B*r/(a*Math.sqrt(e)),d=u*u-1,d<=0?d=0:(d=Math.sqrt(d),this.lat0<0&&(d=-d)),this.E=d+=u,this.E*=Math.pow(Ra(this.e,this.lat0,l),this.B)):(this.B=1/r,this.A=this.k0,this.E=u=d=1),Fe||he?(Fe?(k=Math.asin(Math.sin(Te)/u),he||(z=Te)):(k=z,Te=Math.asin(u*Math.sin(k))),this.lam0=R-Math.asin(.5*(d-1/d)*Math.tan(k))/this.B):(y=Math.pow(Ra(this.e,Y,Math.sin(Y)),this.B),m=Math.pow(Ra(this.e,ge,Math.sin(ge)),this.B),d=this.E/y,T=(m-y)/(m+y),P=this.E*this.E,P=(P-m*y)/(P+m*y),e=Z-K,e<-Math.pi?K-=kh:e>Math.pi&&(K+=kh),this.lam0=$t(.5*(Z+K)-Math.atan(P*Math.tan(.5*this.B*(Z-K))/T)/this.B),k=Math.atan(2*Math.sin(this.B*$t(Z-this.lam0))/(d-1/d)),z=Te=Math.asin(u*Math.sin(k))),this.singam=Math.sin(k),this.cosgam=Math.cos(k),this.sinrot=Math.sin(z),this.cosrot=Math.cos(z),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(u*u-1)/Math.cos(Te))),this.lat0<0&&(this.u_0=-this.u_0)),d=.5*k,this.v_pole_n=this.ArB*Math.log(Math.tan(rr-d)),this.v_pole_s=this.ArB*Math.log(Math.tan(rr+d))}function dP(e){var r={},a,u,d,y,m,l,T,P;if(e.x=e.x-this.lam0,Math.abs(Math.abs(e.y)-gt)>Lt){if(m=this.E/Math.pow(Ra(this.e,e.y,Math.sin(e.y)),this.B),l=1/m,a=.5*(m-l),u=.5*(m+l),y=Math.sin(this.B*e.x),d=(a*this.singam-y*this.cosgam)/u,Math.abs(Math.abs(d)-1)<Lt)throw new Error;P=.5*this.ArB*Math.log((1-d)/(1+d)),l=Math.cos(this.B*e.x),Math.abs(l)<Xc?T=this.A*e.x:T=this.ArB*Math.atan2(a*this.cosgam+y*this.singam,l)}else P=e.y>0?this.v_pole_n:this.v_pole_s,T=this.ArB*e.y;return this.no_rot?(r.x=T,r.y=P):(T-=this.u_0,r.x=P*this.cosrot+T*this.sinrot,r.y=T*this.cosrot-P*this.sinrot),r.x=this.a*r.x+this.x0,r.y=this.a*r.y+this.y0,r}function fP(e){var r,a,u,d,y,m,l,T={};if(e.x=(e.x-this.x0)*(1/this.a),e.y=(e.y-this.y0)*(1/this.a),this.no_rot?(a=e.y,r=e.x):(a=e.x*this.cosrot-e.y*this.sinrot,r=e.y*this.cosrot+e.x*this.sinrot+this.u_0),u=Math.exp(-this.BrA*a),d=.5*(u-1/u),y=.5*(u+1/u),m=Math.sin(this.BrA*r),l=(m*this.cosgam+d*this.singam)/y,Math.abs(Math.abs(l)-1)<Lt)T.x=0,T.y=l<0?-gt:gt;else{if(T.y=this.E/Math.sqrt((1+l)/(1-l)),T.y=Lh(this.e,Math.pow(T.y,1/this.B)),T.y===1/0)throw new Error;T.x=-this.rB*Math.atan2(d*this.cosgam-m*this.singam,Math.cos(this.BrA*r))}return T.x+=this.lam0,T}var pP=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const mP={init:hP,forward:dP,inverse:fP,names:pP};function gP(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<Lt)){var e=this.b/this.a;this.e=Math.sqrt(1-e*e);var r=Math.sin(this.lat1),a=Math.cos(this.lat1),u=ao(this.e,r,a),d=Ra(this.e,this.lat1,r),y=Math.sin(this.lat2),m=Math.cos(this.lat2),l=ao(this.e,y,m),T=Ra(this.e,this.lat2,y),P=Ra(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>Lt?this.ns=Math.log(u/l)/Math.log(d/T):this.ns=r,isNaN(this.ns)&&(this.ns=r),this.f0=u/(this.ns*Math.pow(d,this.ns)),this.rh=this.a*this.f0*Math.pow(P,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function yP(e){var r=e.x,a=e.y;Math.abs(2*Math.abs(a)-Math.PI)<=Lt&&(a=Hh(a)*(gt-2*Lt));var u=Math.abs(Math.abs(a)-gt),d,y;if(u>Lt)d=Ra(this.e,a,Math.sin(a)),y=this.a*this.f0*Math.pow(d,this.ns);else{if(u=a*this.ns,u<=0)return null;y=0}var m=this.ns*$t(r-this.long0);return e.x=this.k0*(y*Math.sin(m))+this.x0,e.y=this.k0*(this.rh-y*Math.cos(m))+this.y0,e}function _P(e){var r,a,u,d,y,m=(e.x-this.x0)/this.k0,l=this.rh-(e.y-this.y0)/this.k0;this.ns>0?(r=Math.sqrt(m*m+l*l),a=1):(r=-Math.sqrt(m*m+l*l),a=-1);var T=0;if(r!==0&&(T=Math.atan2(a*m,a*l)),r!==0||this.ns>0){if(a=1/this.ns,u=Math.pow(r/(this.a*this.f0),a),d=Lh(this.e,u),d===-9999)return null}else d=-gt;return y=$t(T/this.ns+this.long0),e.x=y,e.y=d,e}var vP=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const xP={init:gP,forward:yP,inverse:_P,names:vP};function bP(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function wP(e){var r,a,u,d,y,m,l,T=e.x,P=e.y,z=$t(T-this.long0);return r=Math.pow((1+this.e*Math.sin(P))/(1-this.e*Math.sin(P)),this.alfa*this.e/2),a=2*(Math.atan(this.k*Math.pow(Math.tan(P/2+this.s45),this.alfa)/r)-this.s45),u=-z*this.alfa,d=Math.asin(Math.cos(this.ad)*Math.sin(a)+Math.sin(this.ad)*Math.cos(a)*Math.cos(u)),y=Math.asin(Math.cos(a)*Math.sin(u)/Math.cos(d)),m=this.n*y,l=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(d/2+this.s45),this.n),e.y=l*Math.cos(m)/1,e.x=l*Math.sin(m)/1,this.czech||(e.y*=-1,e.x*=-1),e}function MP(e){var r,a,u,d,y,m,l,T,P=e.x;e.x=e.y,e.y=P,this.czech||(e.y*=-1,e.x*=-1),m=Math.sqrt(e.x*e.x+e.y*e.y),y=Math.atan2(e.y,e.x),d=y/Math.sin(this.s0),u=2*(Math.atan(Math.pow(this.ro0/m,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),r=Math.asin(Math.cos(this.ad)*Math.sin(u)-Math.sin(this.ad)*Math.cos(u)*Math.cos(d)),a=Math.asin(Math.cos(u)*Math.sin(d)/Math.cos(r)),e.x=this.long0-a/this.alfa,l=r,T=0;var z=0;do e.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(r/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(l))/(1-this.e*Math.sin(l)),this.e/2))-this.s45),Math.abs(l-e.y)<1e-10&&(T=1),l=e.y,z+=1;while(T===0&&z<15);return z>=15?null:e}var SP=["Krovak","krovak"];const EP={init:bP,forward:wP,inverse:MP,names:SP};function ms(e,r,a,u,d){return e*d-r*Math.sin(2*d)+a*Math.sin(4*d)-u*Math.sin(6*d)}function Zh(e){return 1-.25*e*(1+e/16*(3+1.25*e))}function Wh(e){return .375*e*(1+.25*e*(1+.46875*e))}function Xh(e){return .05859375*e*e*(1+.75*e)}function Kh(e){return e*e*e*(35/3072)}function du(e,r,a){var u=r*a;return e/Math.sqrt(1-u*u)}function gu(e){return Math.abs(e)<gt?e:e-Hh(e)*Math.PI}function uf(e,r,a,u,d){var y,m;y=e/r;for(var l=0;l<15;l++)if(m=(e-(r*y-a*Math.sin(2*y)+u*Math.sin(4*y)-d*Math.sin(6*y)))/(r-2*a*Math.cos(2*y)+4*u*Math.cos(4*y)-6*d*Math.cos(6*y)),y+=m,Math.abs(m)<=1e-10)return y;return NaN}function TP(){this.sphere||(this.e0=Zh(this.es),this.e1=Wh(this.es),this.e2=Xh(this.es),this.e3=Kh(this.es),this.ml0=this.a*ms(this.e0,this.e1,this.e2,this.e3,this.lat0))}function IP(e){var r,a,u=e.x,d=e.y;if(u=$t(u-this.long0),this.sphere)r=this.a*Math.asin(Math.cos(d)*Math.sin(u)),a=this.a*(Math.atan2(Math.tan(d),Math.cos(u))-this.lat0);else{var y=Math.sin(d),m=Math.cos(d),l=du(this.a,this.e,y),T=Math.tan(d)*Math.tan(d),P=u*Math.cos(d),z=P*P,k=this.es*m*m/(1-this.es),R=this.a*ms(this.e0,this.e1,this.e2,this.e3,d);r=l*P*(1-z*T*(1/6-(8-T+8*k)*z/120)),a=R-this.ml0+l*y/m*z*(.5+(5-T+6*k)*z/24)}return e.x=r+this.x0,e.y=a+this.y0,e}function CP(e){e.x-=this.x0,e.y-=this.y0;var r=e.x/this.a,a=e.y/this.a,u,d;if(this.sphere){var y=a+this.lat0;u=Math.asin(Math.sin(y)*Math.cos(r)),d=Math.atan2(Math.tan(r),Math.cos(y))}else{var m=this.ml0/this.a+a,l=uf(m,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(l)-gt)<=Lt)return e.x=this.long0,e.y=gt,a<0&&(e.y*=-1),e;var T=du(this.a,this.e,Math.sin(l)),P=T*T*T/this.a/this.a*(1-this.es),z=Math.pow(Math.tan(l),2),k=r*this.a/T,R=k*k;u=l-T*Math.tan(l)/P*k*k*(.5-(1+3*z)*k*k/24),d=k*(1-R*(z/3+(1+3*z)*z*R/15))/Math.cos(l)}return e.x=$t(d+this.long0),e.y=gu(u),e}var AP=["Cassini","Cassini_Soldner","cass"];const PP={init:TP,forward:IP,inverse:CP,names:AP};function wl(e,r){var a;return e>1e-7?(a=e*r,(1-e*e)*(r/(1-a*a)-.5/e*Math.log((1-a)/(1+a)))):2*r}var kP=1,DP=2,LP=3,RP=4;function zP(){var e=Math.abs(this.lat0);if(Math.abs(e-gt)<Lt?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<Lt?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var r;switch(this.qp=wl(this.e,1),this.mmf=.5/(1-this.es),this.apa=qP(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),r=Math.sin(this.lat0),this.sinb1=wl(this.e,r)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*r*r)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function OP(e){var r,a,u,d,y,m,l,T,P,z,k=e.x,R=e.y;if(k=$t(k-this.long0),this.sphere){if(y=Math.sin(R),z=Math.cos(R),u=Math.cos(k),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(a=this.mode===this.EQUIT?1+z*u:1+this.sinph0*y+this.cosph0*z*u,a<=Lt)return null;a=Math.sqrt(2/a),r=a*z*Math.sin(k),a*=this.mode===this.EQUIT?y:this.cosph0*y-this.sinph0*z*u}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(u=-u),Math.abs(R+this.lat0)<Lt)return null;a=rr-R*.5,a=2*(this.mode===this.S_POLE?Math.cos(a):Math.sin(a)),r=a*Math.sin(k),a*=u}}else{switch(l=0,T=0,P=0,u=Math.cos(k),d=Math.sin(k),y=Math.sin(R),m=wl(this.e,y),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(l=m/this.qp,T=Math.sqrt(1-l*l)),this.mode){case this.OBLIQ:P=1+this.sinb1*l+this.cosb1*T*u;break;case this.EQUIT:P=1+T*u;break;case this.N_POLE:P=gt+R,m=this.qp-m;break;case this.S_POLE:P=R-gt,m=this.qp+m;break}if(Math.abs(P)<Lt)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:P=Math.sqrt(2/P),this.mode===this.OBLIQ?a=this.ymf*P*(this.cosb1*l-this.sinb1*T*u):a=(P=Math.sqrt(2/(1+T*u)))*l*this.ymf,r=this.xmf*P*T*d;break;case this.N_POLE:case this.S_POLE:m>=0?(r=(P=Math.sqrt(m))*d,a=u*(this.mode===this.S_POLE?P:-P)):r=a=0;break}}return e.x=this.a*r+this.x0,e.y=this.a*a+this.y0,e}function FP(e){e.x-=this.x0,e.y-=this.y0;var r=e.x/this.a,a=e.y/this.a,u,d,y,m,l,T,P;if(this.sphere){var z=0,k,R=0;if(k=Math.sqrt(r*r+a*a),d=k*.5,d>1)return null;switch(d=2*Math.asin(d),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(R=Math.sin(d),z=Math.cos(d)),this.mode){case this.EQUIT:d=Math.abs(k)<=Lt?0:Math.asin(a*R/k),r*=R,a=z*k;break;case this.OBLIQ:d=Math.abs(k)<=Lt?this.lat0:Math.asin(z*this.sinph0+a*R*this.cosph0/k),r*=R*this.cosph0,a=(z-Math.sin(d)*this.sinph0)*k;break;case this.N_POLE:a=-a,d=gt-d;break;case this.S_POLE:d-=gt;break}u=a===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(r,a)}else{if(P=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(r/=this.dd,a*=this.dd,T=Math.sqrt(r*r+a*a),T<Lt)return e.x=this.long0,e.y=this.lat0,e;m=2*Math.asin(.5*T/this.rq),y=Math.cos(m),r*=m=Math.sin(m),this.mode===this.OBLIQ?(P=y*this.sinb1+a*m*this.cosb1/T,l=this.qp*P,a=T*this.cosb1*y-a*this.sinb1*m):(P=a*m/T,l=this.qp*P,a=T*y)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(a=-a),l=r*r+a*a,!l)return e.x=this.long0,e.y=this.lat0,e;P=1-l/this.qp,this.mode===this.S_POLE&&(P=-P)}u=Math.atan2(r,a),d=GP(Math.asin(P),this.apa)}return e.x=$t(this.long0+u),e.y=d,e}var BP=.3333333333333333,NP=.17222222222222222,$P=.10257936507936508,UP=.06388888888888888,VP=.0664021164021164,jP=.016415012942191543;function qP(e){var r,a=[];return a[0]=e*BP,r=e*e,a[0]+=r*NP,a[1]=r*UP,r*=e,a[0]+=r*$P,a[1]+=r*VP,a[2]=r*jP,a}function GP(e,r){var a=e+e;return e+r[0]*Math.sin(a)+r[1]*Math.sin(a+a)+r[2]*Math.sin(a+a+a)}var HP=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const ZP={init:zP,forward:OP,inverse:FP,names:HP,S_POLE:kP,N_POLE:DP,EQUIT:LP,OBLIQ:RP};function Tl(e){return Math.abs(e)>1&&(e=e>1?1:-1),Math.asin(e)}function WP(){Math.abs(this.lat1+this.lat2)<Lt||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=ao(this.e3,this.sin_po,this.cos_po),this.qs1=wl(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=ao(this.e3,this.sin_po,this.cos_po),this.qs2=wl(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=wl(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>Lt?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function XP(e){var r=e.x,a=e.y;this.sin_phi=Math.sin(a),this.cos_phi=Math.cos(a);var u=wl(this.e3,this.sin_phi),d=this.a*Math.sqrt(this.c-this.ns0*u)/this.ns0,y=this.ns0*$t(r-this.long0),m=d*Math.sin(y)+this.x0,l=this.rh-d*Math.cos(y)+this.y0;return e.x=m,e.y=l,e}function KP(e){var r,a,u,d,y,m;return e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns0>=0?(r=Math.sqrt(e.x*e.x+e.y*e.y),u=1):(r=-Math.sqrt(e.x*e.x+e.y*e.y),u=-1),d=0,r!==0&&(d=Math.atan2(u*e.x,u*e.y)),u=r*this.ns0/this.a,this.sphere?m=Math.asin((this.c-u*u)/(2*this.ns0)):(a=(this.c-u*u)/this.ns0,m=this.phi1z(this.e3,a)),y=$t(d/this.ns0+this.long0),e.x=y,e.y=m,e}function YP(e,r){var a,u,d,y,m,l=Tl(.5*r);if(e<Lt)return l;for(var T=e*e,P=1;P<=25;P++)if(a=Math.sin(l),u=Math.cos(l),d=e*a,y=1-d*d,m=.5*y*y/u*(r/(1-T)-a/y+.5/e*Math.log((1-d)/(1+d))),l=l+m,Math.abs(m)<=1e-7)return l;return null}var JP=["Albers_Conic_Equal_Area","Albers","aea"];const QP={init:WP,forward:XP,inverse:KP,names:JP,phi1z:YP};function ek(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function tk(e){var r,a,u,d,y,m,l,T,P=e.x,z=e.y;return u=$t(P-this.long0),r=Math.sin(z),a=Math.cos(z),d=Math.cos(u),m=this.sin_p14*r+this.cos_p14*a*d,y=1,m>0||Math.abs(m)<=Lt?(l=this.x0+this.a*y*a*Math.sin(u)/m,T=this.y0+this.a*y*(this.cos_p14*r-this.sin_p14*a*d)/m):(l=this.x0+this.infinity_dist*a*Math.sin(u),T=this.y0+this.infinity_dist*(this.cos_p14*r-this.sin_p14*a*d)),e.x=l,e.y=T,e}function ik(e){var r,a,u,d,y,m;return e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,(r=Math.sqrt(e.x*e.x+e.y*e.y))?(d=Math.atan2(r,this.rc),a=Math.sin(d),u=Math.cos(d),m=Tl(u*this.sin_p14+e.y*a*this.cos_p14/r),y=Math.atan2(e.x*a,r*this.cos_p14*u-e.y*this.sin_p14*a),y=$t(this.long0+y)):(m=this.phic0,y=0),e.x=y,e.y=m,e}var rk=["gnom"];const nk={init:ek,forward:tk,inverse:ik,names:rk};function sk(e,r){var a=1-(1-e*e)/(2*e)*Math.log((1-e)/(1+e));if(Math.abs(Math.abs(r)-a)<1e-6)return r<0?-1*gt:gt;for(var u=Math.asin(.5*r),d,y,m,l,T=0;T<30;T++)if(y=Math.sin(u),m=Math.cos(u),l=e*y,d=Math.pow(1-l*l,2)/(2*m)*(r/(1-e*e)-y/(1-l*l)+.5/e*Math.log((1-l)/(1+l))),u+=d,Math.abs(d)<=1e-10)return u;return NaN}function ak(){this.sphere||(this.k0=ao(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function ok(e){var r=e.x,a=e.y,u,d,y=$t(r-this.long0);if(this.sphere)u=this.x0+this.a*y*Math.cos(this.lat_ts),d=this.y0+this.a*Math.sin(a)/Math.cos(this.lat_ts);else{var m=wl(this.e,Math.sin(a));u=this.x0+this.a*this.k0*y,d=this.y0+this.a*m*.5/this.k0}return e.x=u,e.y=d,e}function lk(e){e.x-=this.x0,e.y-=this.y0;var r,a;return this.sphere?(r=$t(this.long0+e.x/this.a/Math.cos(this.lat_ts)),a=Math.asin(e.y/this.a*Math.cos(this.lat_ts))):(a=sk(this.e,2*e.y*this.k0/this.a),r=$t(this.long0+e.x/(this.a*this.k0))),e.x=r,e.y=a,e}var ck=["cea"];const uk={init:ak,forward:ok,inverse:lk,names:ck};function hk(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function dk(e){var r=e.x,a=e.y,u=$t(r-this.long0),d=gu(a-this.lat0);return e.x=this.x0+this.a*u*this.rc,e.y=this.y0+this.a*d,e}function fk(e){var r=e.x,a=e.y;return e.x=$t(this.long0+(r-this.x0)/(this.a*this.rc)),e.y=gu(this.lat0+(a-this.y0)/this.a),e}var pk=["Equirectangular","Equidistant_Cylindrical","eqc"];const mk={init:hk,forward:dk,inverse:fk,names:pk};var p0=20;function gk(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Zh(this.es),this.e1=Wh(this.es),this.e2=Xh(this.es),this.e3=Kh(this.es),this.ml0=this.a*ms(this.e0,this.e1,this.e2,this.e3,this.lat0)}function yk(e){var r=e.x,a=e.y,u,d,y,m=$t(r-this.long0);if(y=m*Math.sin(a),this.sphere)Math.abs(a)<=Lt?(u=this.a*m,d=-1*this.a*this.lat0):(u=this.a*Math.sin(y)/Math.tan(a),d=this.a*(gu(a-this.lat0)+(1-Math.cos(y))/Math.tan(a)));else if(Math.abs(a)<=Lt)u=this.a*m,d=-1*this.ml0;else{var l=du(this.a,this.e,Math.sin(a))/Math.tan(a);u=l*Math.sin(y),d=this.a*ms(this.e0,this.e1,this.e2,this.e3,a)-this.ml0+l*(1-Math.cos(y))}return e.x=u+this.x0,e.y=d+this.y0,e}function _k(e){var r,a,u,d,y,m,l,T,P;if(u=e.x-this.x0,d=e.y-this.y0,this.sphere)if(Math.abs(d+this.a*this.lat0)<=Lt)r=$t(u/this.a+this.long0),a=0;else{m=this.lat0+d/this.a,l=u*u/this.a/this.a+m*m,T=m;var z;for(y=p0;y;--y)if(z=Math.tan(T),P=-1*(m*(T*z+1)-T-.5*(T*T+l)*z)/((T-m)/z-1),T+=P,Math.abs(P)<=Lt){a=T;break}r=$t(this.long0+Math.asin(u*Math.tan(T)/this.a)/Math.sin(a))}else if(Math.abs(d+this.ml0)<=Lt)a=0,r=$t(this.long0+u/this.a);else{m=(this.ml0+d)/this.a,l=u*u/this.a/this.a+m*m,T=m;var k,R,Z,K,Y;for(y=p0;y;--y)if(Y=this.e*Math.sin(T),k=Math.sqrt(1-Y*Y)*Math.tan(T),R=this.a*ms(this.e0,this.e1,this.e2,this.e3,T),Z=this.e0-2*this.e1*Math.cos(2*T)+4*this.e2*Math.cos(4*T)-6*this.e3*Math.cos(6*T),K=R/this.a,P=(m*(k*K+1)-K-.5*k*(K*K+l))/(this.es*Math.sin(2*T)*(K*K+l-2*m*K)/(4*k)+(m-K)*(k*Z-2/Math.sin(2*T))-Z),T-=P,Math.abs(P)<=Lt){a=T;break}k=Math.sqrt(1-this.es*Math.pow(Math.sin(a),2))*Math.tan(a),r=$t(this.long0+Math.asin(u*k/this.a)/Math.sin(a))}return e.x=r,e.y=a,e}var vk=["Polyconic","poly"];const xk={init:gk,forward:yk,inverse:_k,names:vk};function bk(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function wk(e){var r,a=e.x,u=e.y,d=u-this.lat0,y=a-this.long0,m=d/_h*1e-5,l=y,T=1,P=0;for(r=1;r<=10;r++)T=T*m,P=P+this.A[r]*T;var z=P,k=l,R=1,Z=0,K,Y,ge=0,Te=0;for(r=1;r<=6;r++)K=R*z-Z*k,Y=Z*z+R*k,R=K,Z=Y,ge=ge+this.B_re[r]*R-this.B_im[r]*Z,Te=Te+this.B_im[r]*R+this.B_re[r]*Z;return e.x=Te*this.a+this.x0,e.y=ge*this.a+this.y0,e}function Mk(e){var r,a=e.x,u=e.y,d=a-this.x0,y=u-this.y0,m=y/this.a,l=d/this.a,T=1,P=0,z,k,R=0,Z=0;for(r=1;r<=6;r++)z=T*m-P*l,k=P*m+T*l,T=z,P=k,R=R+this.C_re[r]*T-this.C_im[r]*P,Z=Z+this.C_im[r]*T+this.C_re[r]*P;for(var K=0;K<this.iterations;K++){var Y=R,ge=Z,Te,Fe,he=m,Le=l;for(r=2;r<=6;r++)Te=Y*R-ge*Z,Fe=ge*R+Y*Z,Y=Te,ge=Fe,he=he+(r-1)*(this.B_re[r]*Y-this.B_im[r]*ge),Le=Le+(r-1)*(this.B_im[r]*Y+this.B_re[r]*ge);Y=1,ge=0;var We=this.B_re[1],Qe=this.B_im[1];for(r=2;r<=6;r++)Te=Y*R-ge*Z,Fe=ge*R+Y*Z,Y=Te,ge=Fe,We=We+r*(this.B_re[r]*Y-this.B_im[r]*ge),Qe=Qe+r*(this.B_im[r]*Y+this.B_re[r]*ge);var bt=We*We+Qe*Qe;R=(he*We+Le*Qe)/bt,Z=(Le*We-he*Qe)/bt}var He=R,lt=Z,Rt=1,Pt=0;for(r=1;r<=9;r++)Rt=Rt*He,Pt=Pt+this.D[r]*Rt;var oi=this.lat0+Pt*_h*1e5,pi=this.long0+lt;return e.x=pi,e.y=oi,e}var Sk=["New_Zealand_Map_Grid","nzmg"];const Ek={init:bk,forward:wk,inverse:Mk,names:Sk};function Tk(){}function Ik(e){var r=e.x,a=e.y,u=$t(r-this.long0),d=this.x0+this.a*u,y=this.y0+this.a*Math.log(Math.tan(Math.PI/4+a/2.5))*1.25;return e.x=d,e.y=y,e}function Ck(e){e.x-=this.x0,e.y-=this.y0;var r=$t(this.long0+e.x/this.a),a=2.5*(Math.atan(Math.exp(.8*e.y/this.a))-Math.PI/4);return e.x=r,e.y=a,e}var Ak=["Miller_Cylindrical","mill"];const Pk={init:Tk,forward:Ik,inverse:Ck,names:Ak};var kk=20;function Dk(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=Ox(this.es)}function Lk(e){var r,a,u=e.x,d=e.y;if(u=$t(u-this.long0),this.sphere){if(!this.m)d=this.n!==1?Math.asin(this.n*Math.sin(d)):d;else for(var y=this.n*Math.sin(d),m=kk;m;--m){var l=(this.m*d+Math.sin(d)-y)/(this.m+Math.cos(d));if(d-=l,Math.abs(l)<Lt)break}r=this.a*this.C_x*u*(this.m+Math.cos(d)),a=this.a*this.C_y*d}else{var T=Math.sin(d),P=Math.cos(d);a=this.a*Bf(d,T,P,this.en),r=this.a*u*P/Math.sqrt(1-this.es*T*T)}return e.x=r,e.y=a,e}function Rk(e){var r,a,u,d;return e.x-=this.x0,u=e.x/this.a,e.y-=this.y0,r=e.y/this.a,this.sphere?(r/=this.C_y,u=u/(this.C_x*(this.m+Math.cos(r))),this.m?r=Tl((this.m*r+Math.sin(r))/this.n):this.n!==1&&(r=Tl(Math.sin(r)/this.n)),u=$t(u+this.long0),r=gu(r)):(r=Fx(e.y/this.a,this.es,this.en),d=Math.abs(r),d<gt?(d=Math.sin(r),a=this.long0+e.x*Math.sqrt(1-this.es*d*d)/(this.a*Math.cos(r)),u=$t(a)):d-Lt<gt&&(u=this.long0)),e.x=u,e.y=r,e}var zk=["Sinusoidal","sinu"];const Ok={init:Dk,forward:Lk,inverse:Rk,names:zk};function Fk(){}function Bk(e){for(var r=e.x,a=e.y,u=$t(r-this.long0),d=a,y=Math.PI*Math.sin(a);;){var m=-(d+Math.sin(d)-y)/(1+Math.cos(d));if(d+=m,Math.abs(m)<Lt)break}d/=2,Math.PI/2-Math.abs(a)<Lt&&(u=0);var l=.900316316158*this.a*u*Math.cos(d)+this.x0,T=1.4142135623731*this.a*Math.sin(d)+this.y0;return e.x=l,e.y=T,e}function Nk(e){var r,a;e.x-=this.x0,e.y-=this.y0,a=e.y/(1.4142135623731*this.a),Math.abs(a)>.999999999999&&(a=.999999999999),r=Math.asin(a);var u=$t(this.long0+e.x/(.900316316158*this.a*Math.cos(r)));u<-Math.PI&&(u=-Math.PI),u>Math.PI&&(u=Math.PI),a=(2*r+Math.sin(2*r))/Math.PI,Math.abs(a)>1&&(a=1);var d=Math.asin(a);return e.x=u,e.y=d,e}var $k=["Mollweide","moll"];const Uk={init:Fk,forward:Bk,inverse:Nk,names:$k};function Vk(){Math.abs(this.lat1+this.lat2)<Lt||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Zh(this.es),this.e1=Wh(this.es),this.e2=Xh(this.es),this.e3=Kh(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=ao(this.e,this.sinphi,this.cosphi),this.ml1=ms(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<Lt?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=ao(this.e,this.sinphi,this.cosphi),this.ml2=ms(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=ms(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function jk(e){var r=e.x,a=e.y,u;if(this.sphere)u=this.a*(this.g-a);else{var d=ms(this.e0,this.e1,this.e2,this.e3,a);u=this.a*(this.g-d)}var y=this.ns*$t(r-this.long0),m=this.x0+u*Math.sin(y),l=this.y0+this.rh-u*Math.cos(y);return e.x=m,e.y=l,e}function qk(e){e.x-=this.x0,e.y=this.rh-e.y+this.y0;var r,a,u,d;this.ns>=0?(a=Math.sqrt(e.x*e.x+e.y*e.y),r=1):(a=-Math.sqrt(e.x*e.x+e.y*e.y),r=-1);var y=0;if(a!==0&&(y=Math.atan2(r*e.x,r*e.y)),this.sphere)return d=$t(this.long0+y/this.ns),u=gu(this.g-a/this.a),e.x=d,e.y=u,e;var m=this.g-a/this.a;return u=uf(m,this.e0,this.e1,this.e2,this.e3),d=$t(this.long0+y/this.ns),e.x=d,e.y=u,e}var Gk=["Equidistant_Conic","eqdc"];const Hk={init:Vk,forward:jk,inverse:qk,names:Gk};function Zk(){this.R=this.a}function Wk(e){var r=e.x,a=e.y,u=$t(r-this.long0),d,y;Math.abs(a)<=Lt&&(d=this.x0+this.R*u,y=this.y0);var m=Tl(2*Math.abs(a/Math.PI));(Math.abs(u)<=Lt||Math.abs(Math.abs(a)-gt)<=Lt)&&(d=this.x0,a>=0?y=this.y0+Math.PI*this.R*Math.tan(.5*m):y=this.y0+Math.PI*this.R*-Math.tan(.5*m));var l=.5*Math.abs(Math.PI/u-u/Math.PI),T=l*l,P=Math.sin(m),z=Math.cos(m),k=z/(P+z-1),R=k*k,Z=k*(2/P-1),K=Z*Z,Y=Math.PI*this.R*(l*(k-K)+Math.sqrt(T*(k-K)*(k-K)-(K+T)*(R-K)))/(K+T);u<0&&(Y=-Y),d=this.x0+Y;var ge=T+k;return Y=Math.PI*this.R*(Z*ge-l*Math.sqrt((K+T)*(T+1)-ge*ge))/(K+T),a>=0?y=this.y0+Y:y=this.y0-Y,e.x=d,e.y=y,e}function Xk(e){var r,a,u,d,y,m,l,T,P,z,k,R,Z;return e.x-=this.x0,e.y-=this.y0,k=Math.PI*this.R,u=e.x/k,d=e.y/k,y=u*u+d*d,m=-Math.abs(d)*(1+y),l=m-2*d*d+u*u,T=-2*m+1+2*d*d+y*y,Z=d*d/T+(2*l*l*l/T/T/T-9*m*l/T/T)/27,P=(m-l*l/3/T)/T,z=2*Math.sqrt(-P/3),k=3*Z/P/z,Math.abs(k)>1&&(k>=0?k=1:k=-1),R=Math.acos(k)/3,e.y>=0?a=(-z*Math.cos(R+Math.PI/3)-l/3/T)*Math.PI:a=-(-z*Math.cos(R+Math.PI/3)-l/3/T)*Math.PI,Math.abs(u)<Lt?r=this.long0:r=$t(this.long0+Math.PI*(y-1+Math.sqrt(1+2*(u*u-d*d)+y*y))/2/u),e.x=r,e.y=a,e}var Kk=["Van_der_Grinten_I","VanDerGrinten","vandg"];const Yk={init:Zk,forward:Wk,inverse:Xk,names:Kk};function Jk(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function Qk(e){var r=e.x,a=e.y,u=Math.sin(e.y),d=Math.cos(e.y),y=$t(r-this.long0),m,l,T,P,z,k,R,Z,K,Y,ge,Te,Fe,he,Le,We,Qe,bt,He,lt,Rt,Pt,oi;return this.sphere?Math.abs(this.sin_p12-1)<=Lt?(e.x=this.x0+this.a*(gt-a)*Math.sin(y),e.y=this.y0-this.a*(gt-a)*Math.cos(y),e):Math.abs(this.sin_p12+1)<=Lt?(e.x=this.x0+this.a*(gt+a)*Math.sin(y),e.y=this.y0+this.a*(gt+a)*Math.cos(y),e):(bt=this.sin_p12*u+this.cos_p12*d*Math.cos(y),We=Math.acos(bt),Qe=We?We/Math.sin(We):1,e.x=this.x0+this.a*Qe*d*Math.sin(y),e.y=this.y0+this.a*Qe*(this.cos_p12*u-this.sin_p12*d*Math.cos(y)),e):(m=Zh(this.es),l=Wh(this.es),T=Xh(this.es),P=Kh(this.es),Math.abs(this.sin_p12-1)<=Lt?(z=this.a*ms(m,l,T,P,gt),k=this.a*ms(m,l,T,P,a),e.x=this.x0+(z-k)*Math.sin(y),e.y=this.y0-(z-k)*Math.cos(y),e):Math.abs(this.sin_p12+1)<=Lt?(z=this.a*ms(m,l,T,P,gt),k=this.a*ms(m,l,T,P,a),e.x=this.x0+(z+k)*Math.sin(y),e.y=this.y0+(z+k)*Math.cos(y),e):(R=u/d,Z=du(this.a,this.e,this.sin_p12),K=du(this.a,this.e,u),Y=Math.atan((1-this.es)*R+this.es*Z*this.sin_p12/(K*d)),ge=Math.atan2(Math.sin(y),this.cos_p12*Math.tan(Y)-this.sin_p12*Math.cos(y)),ge===0?He=Math.asin(this.cos_p12*Math.sin(Y)-this.sin_p12*Math.cos(Y)):Math.abs(Math.abs(ge)-Math.PI)<=Lt?He=-Math.asin(this.cos_p12*Math.sin(Y)-this.sin_p12*Math.cos(Y)):He=Math.asin(Math.sin(y)*Math.cos(Y)/Math.sin(ge)),Te=this.e*this.sin_p12/Math.sqrt(1-this.es),Fe=this.e*this.cos_p12*Math.cos(ge)/Math.sqrt(1-this.es),he=Te*Fe,Le=Fe*Fe,lt=He*He,Rt=lt*He,Pt=Rt*He,oi=Pt*He,We=Z*He*(1-lt*Le*(1-Le)/6+Rt/8*he*(1-2*Le)+Pt/120*(Le*(4-7*Le)-3*Te*Te*(1-7*Le))-oi/48*he),e.x=this.x0+We*Math.sin(ge),e.y=this.y0+We*Math.cos(ge),e))}function eD(e){e.x-=this.x0,e.y-=this.y0;var r,a,u,d,y,m,l,T,P,z,k,R,Z,K,Y,ge,Te,Fe,he,Le,We,Qe,bt,He;return this.sphere?(r=Math.sqrt(e.x*e.x+e.y*e.y),r>2*gt*this.a?void 0:(a=r/this.a,u=Math.sin(a),d=Math.cos(a),y=this.long0,Math.abs(r)<=Lt?m=this.lat0:(m=Tl(d*this.sin_p12+e.y*u*this.cos_p12/r),l=Math.abs(this.lat0)-gt,Math.abs(l)<=Lt?this.lat0>=0?y=$t(this.long0+Math.atan2(e.x,-e.y)):y=$t(this.long0-Math.atan2(-e.x,e.y)):y=$t(this.long0+Math.atan2(e.x*u,r*this.cos_p12*d-e.y*this.sin_p12*u))),e.x=y,e.y=m,e)):(T=Zh(this.es),P=Wh(this.es),z=Xh(this.es),k=Kh(this.es),Math.abs(this.sin_p12-1)<=Lt?(R=this.a*ms(T,P,z,k,gt),r=Math.sqrt(e.x*e.x+e.y*e.y),Z=R-r,m=uf(Z/this.a,T,P,z,k),y=$t(this.long0+Math.atan2(e.x,-1*e.y)),e.x=y,e.y=m,e):Math.abs(this.sin_p12+1)<=Lt?(R=this.a*ms(T,P,z,k,gt),r=Math.sqrt(e.x*e.x+e.y*e.y),Z=r-R,m=uf(Z/this.a,T,P,z,k),y=$t(this.long0+Math.atan2(e.x,e.y)),e.x=y,e.y=m,e):(r=Math.sqrt(e.x*e.x+e.y*e.y),ge=Math.atan2(e.x,e.y),K=du(this.a,this.e,this.sin_p12),Te=Math.cos(ge),Fe=this.e*this.cos_p12*Te,he=-Fe*Fe/(1-this.es),Le=3*this.es*(1-he)*this.sin_p12*this.cos_p12*Te/(1-this.es),We=r/K,Qe=We-he*(1+he)*Math.pow(We,3)/6-Le*(1+3*he)*Math.pow(We,4)/24,bt=1-he*Qe*Qe/2-We*Qe*Qe*Qe/6,Y=Math.asin(this.sin_p12*Math.cos(Qe)+this.cos_p12*Math.sin(Qe)*Te),y=$t(this.long0+Math.asin(Math.sin(ge)*Math.sin(Qe)/Math.cos(Y))),He=Math.sin(Y),m=Math.atan2((He-this.es*bt*this.sin_p12)*Math.tan(Y),He*(1-this.es)),e.x=y,e.y=m,e))}var tD=["Azimuthal_Equidistant","aeqd"];const iD={init:Jk,forward:Qk,inverse:eD,names:tD};function rD(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function nD(e){var r,a,u,d,y,m,l,T,P=e.x,z=e.y;return u=$t(P-this.long0),r=Math.sin(z),a=Math.cos(z),d=Math.cos(u),m=this.sin_p14*r+this.cos_p14*a*d,y=1,(m>0||Math.abs(m)<=Lt)&&(l=this.a*y*a*Math.sin(u),T=this.y0+this.a*y*(this.cos_p14*r-this.sin_p14*a*d)),e.x=l,e.y=T,e}function sD(e){var r,a,u,d,y,m,l;return e.x-=this.x0,e.y-=this.y0,r=Math.sqrt(e.x*e.x+e.y*e.y),a=Tl(r/this.a),u=Math.sin(a),d=Math.cos(a),m=this.long0,Math.abs(r)<=Lt?(l=this.lat0,e.x=m,e.y=l,e):(l=Tl(d*this.sin_p14+e.y*u*this.cos_p14/r),y=Math.abs(this.lat0)-gt,Math.abs(y)<=Lt?(this.lat0>=0?m=$t(this.long0+Math.atan2(e.x,-e.y)):m=$t(this.long0-Math.atan2(-e.x,e.y)),e.x=m,e.y=l,e):(m=$t(this.long0+Math.atan2(e.x*u,r*this.cos_p14*d-e.y*this.sin_p14*u)),e.x=m,e.y=l,e))}var aD=["ortho"];const oD={init:rD,forward:nD,inverse:sD,names:aD};var Hr={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},nr={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function lD(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=gt-rr/2?this.face=Hr.TOP:this.lat0<=-(gt-rr/2)?this.face=Hr.BOTTOM:Math.abs(this.long0)<=rr?this.face=Hr.FRONT:Math.abs(this.long0)<=gt+rr?this.face=this.long0>0?Hr.RIGHT:Hr.LEFT:this.face=Hr.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function cD(e){var r={x:0,y:0},a,u,d,y,m,l,T={value:0};if(e.x-=this.long0,this.es!==0?a=Math.atan(this.one_minus_f_squared*Math.tan(e.y)):a=e.y,u=e.x,this.face===Hr.TOP)y=gt-a,u>=rr&&u<=gt+rr?(T.value=nr.AREA_0,d=u-gt):u>gt+rr||u<=-(gt+rr)?(T.value=nr.AREA_1,d=u>0?u-hn:u+hn):u>-(gt+rr)&&u<=-rr?(T.value=nr.AREA_2,d=u+gt):(T.value=nr.AREA_3,d=u);else if(this.face===Hr.BOTTOM)y=gt+a,u>=rr&&u<=gt+rr?(T.value=nr.AREA_0,d=-u+gt):u<rr&&u>=-rr?(T.value=nr.AREA_1,d=-u):u<-rr&&u>=-(gt+rr)?(T.value=nr.AREA_2,d=-u-gt):(T.value=nr.AREA_3,d=u>0?-u+hn:-u-hn);else{var P,z,k,R,Z,K,Y;this.face===Hr.RIGHT?u=su(u,+gt):this.face===Hr.BACK?u=su(u,+hn):this.face===Hr.LEFT&&(u=su(u,-gt)),R=Math.sin(a),Z=Math.cos(a),K=Math.sin(u),Y=Math.cos(u),P=Z*Y,z=Z*K,k=R,this.face===Hr.FRONT?(y=Math.acos(P),d=zd(y,k,z,T)):this.face===Hr.RIGHT?(y=Math.acos(z),d=zd(y,k,-P,T)):this.face===Hr.BACK?(y=Math.acos(-P),d=zd(y,k,-z,T)):this.face===Hr.LEFT?(y=Math.acos(-z),d=zd(y,k,P,T)):(y=d=0,T.value=nr.AREA_0)}return l=Math.atan(12/hn*(d+Math.acos(Math.sin(d)*Math.cos(rr))-gt)),m=Math.sqrt((1-Math.cos(y))/(Math.cos(l)*Math.cos(l))/(1-Math.cos(Math.atan(1/Math.cos(d))))),T.value===nr.AREA_1?l+=gt:T.value===nr.AREA_2?l+=hn:T.value===nr.AREA_3&&(l+=1.5*hn),r.x=m*Math.cos(l),r.y=m*Math.sin(l),r.x=r.x*this.a+this.x0,r.y=r.y*this.a+this.y0,e.x=r.x,e.y=r.y,e}function uD(e){var r={lam:0,phi:0},a,u,d,y,m,l,T,P,z,k={value:0};if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,u=Math.atan(Math.sqrt(e.x*e.x+e.y*e.y)),a=Math.atan2(e.y,e.x),e.x>=0&&e.x>=Math.abs(e.y)?k.value=nr.AREA_0:e.y>=0&&e.y>=Math.abs(e.x)?(k.value=nr.AREA_1,a-=gt):e.x<0&&-e.x>=Math.abs(e.y)?(k.value=nr.AREA_2,a=a<0?a+hn:a-hn):(k.value=nr.AREA_3,a+=gt),z=hn/12*Math.tan(a),m=Math.sin(z)/(Math.cos(z)-1/Math.sqrt(2)),l=Math.atan(m),d=Math.cos(a),y=Math.tan(u),T=1-d*d*y*y*(1-Math.cos(Math.atan(1/Math.cos(l)))),T<-1?T=-1:T>1&&(T=1),this.face===Hr.TOP)P=Math.acos(T),r.phi=gt-P,k.value===nr.AREA_0?r.lam=l+gt:k.value===nr.AREA_1?r.lam=l<0?l+hn:l-hn:k.value===nr.AREA_2?r.lam=l-gt:r.lam=l;else if(this.face===Hr.BOTTOM)P=Math.acos(T),r.phi=P-gt,k.value===nr.AREA_0?r.lam=-l+gt:k.value===nr.AREA_1?r.lam=-l:k.value===nr.AREA_2?r.lam=-l-gt:r.lam=l<0?-l-hn:-l+hn;else{var R,Z,K;R=T,z=R*R,z>=1?K=0:K=Math.sqrt(1-z)*Math.sin(l),z+=K*K,z>=1?Z=0:Z=Math.sqrt(1-z),k.value===nr.AREA_1?(z=Z,Z=-K,K=z):k.value===nr.AREA_2?(Z=-Z,K=-K):k.value===nr.AREA_3&&(z=Z,Z=K,K=-z),this.face===Hr.RIGHT?(z=R,R=-Z,Z=z):this.face===Hr.BACK?(R=-R,Z=-Z):this.face===Hr.LEFT&&(z=R,R=Z,Z=-z),r.phi=Math.acos(-K)-gt,r.lam=Math.atan2(Z,R),this.face===Hr.RIGHT?r.lam=su(r.lam,-gt):this.face===Hr.BACK?r.lam=su(r.lam,-hn):this.face===Hr.LEFT&&(r.lam=su(r.lam,+gt))}if(this.es!==0){var Y,ge,Te;Y=r.phi<0?1:0,ge=Math.tan(r.phi),Te=this.b/Math.sqrt(ge*ge+this.one_minus_f_squared),r.phi=Math.atan(Math.sqrt(this.a*this.a-Te*Te)/(this.one_minus_f*Te)),Y&&(r.phi=-r.phi)}return r.lam+=this.long0,e.x=r.lam,e.y=r.phi,e}function zd(e,r,a,u){var d;return e<Lt?(u.value=nr.AREA_0,d=0):(d=Math.atan2(r,a),Math.abs(d)<=rr?u.value=nr.AREA_0:d>rr&&d<=gt+rr?(u.value=nr.AREA_1,d-=gt):d>gt+rr||d<=-(gt+rr)?(u.value=nr.AREA_2,d=d>=0?d-hn:d+hn):(u.value=nr.AREA_3,d+=gt)),d}function su(e,r){var a=e+r;return a<-hn?a+=kh:a>+hn&&(a-=kh),a}var hD=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const dD={init:lD,forward:cD,inverse:uD,names:hD};var wm=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],uh=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],$x=.8487,Ux=1.3523,Vx=ro/5,fD=1/Vx,Qc=18,hf=function(e,r){return e[0]+r*(e[1]+r*(e[2]+r*e[3]))},pD=function(e,r){return e[1]+r*(2*e[2]+r*3*e[3])};function mD(e,r,a,u){for(var d=r;u;--u){var y=e(d);if(d-=y,Math.abs(y)<a)break}return d}function gD(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function yD(e){var r=$t(e.x-this.long0),a=Math.abs(e.y),u=Math.floor(a*Vx);u<0?u=0:u>=Qc&&(u=Qc-1),a=ro*(a-fD*u);var d={x:hf(wm[u],a)*r,y:hf(uh[u],a)};return e.y<0&&(d.y=-d.y),d.x=d.x*this.a*$x+this.x0,d.y=d.y*this.a*Ux+this.y0,d}function _D(e){var r={x:(e.x-this.x0)/(this.a*$x),y:Math.abs(e.y-this.y0)/(this.a*Ux)};if(r.y>=1)r.x/=wm[Qc][0],r.y=e.y<0?-gt:gt;else{var a=Math.floor(r.y*Qc);for(a<0?a=0:a>=Qc&&(a=Qc-1);;)if(uh[a][0]>r.y)--a;else if(uh[a+1][0]<=r.y)++a;else break;var u=uh[a],d=5*(r.y-u[0])/(uh[a+1][0]-u[0]);d=mD(function(y){return(hf(u,y)-r.y)/pD(u,y)},d,Lt,100),r.x/=hf(wm[a],d),r.y=(5*a+d)*$n,e.y<0&&(r.y=-r.y)}return r.x=$t(r.x+this.long0),r}var vD=["Robinson","robin"];const xD={init:gD,forward:yD,inverse:_D,names:vD};function bD(){this.name="geocent"}function wD(e){var r=Ix(e,this.es,this.a);return r}function MD(e){var r=Cx(e,this.es,this.a,this.b);return r}var SD=["Geocentric","geocentric","geocent","Geocent"];const ED={init:bD,forward:wD,inverse:MD,names:SD};var es={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},ah={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function TD(){if(Object.keys(ah).forEach((function(a){if(typeof this[a]>"u")this[a]=ah[a].def;else{if(ah[a].num&&isNaN(this[a]))throw new Error("Invalid parameter value, must be numeric "+a+" = "+this[a]);ah[a].num&&(this[a]=parseFloat(this[a]))}ah[a].degrees&&(this[a]=this[a]*$n)}).bind(this)),Math.abs(Math.abs(this.lat0)-gt)<Lt?this.mode=this.lat0<0?es.S_POLE:es.N_POLE:Math.abs(this.lat0)<Lt?this.mode=es.EQUIT:(this.mode=es.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var e=this.tilt,r=this.azi;this.cg=Math.cos(r),this.sg=Math.sin(r),this.cw=Math.cos(e),this.sw=Math.sin(e)}function ID(e){e.x-=this.long0;var r=Math.sin(e.y),a=Math.cos(e.y),u=Math.cos(e.x),d,y;switch(this.mode){case es.OBLIQ:y=this.sinph0*r+this.cosph0*a*u;break;case es.EQUIT:y=a*u;break;case es.S_POLE:y=-r;break;case es.N_POLE:y=r;break}switch(y=this.pn1/(this.p-y),d=y*a*Math.sin(e.x),this.mode){case es.OBLIQ:y*=this.cosph0*r-this.sinph0*a*u;break;case es.EQUIT:y*=r;break;case es.N_POLE:y*=-(a*u);break;case es.S_POLE:y*=a*u;break}var m,l;return m=y*this.cg+d*this.sg,l=1/(m*this.sw*this.h1+this.cw),d=(d*this.cg-y*this.sg)*this.cw*l,y=m*l,e.x=d*this.a,e.y=y*this.a,e}function CD(e){e.x/=this.a,e.y/=this.a;var r={x:e.x,y:e.y},a,u,d;d=1/(this.pn1-e.y*this.sw),a=this.pn1*e.x*d,u=this.pn1*e.y*this.cw*d,e.x=a*this.cg+u*this.sg,e.y=u*this.cg-a*this.sg;var y=ua(e.x,e.y);if(Math.abs(y)<Lt)r.x=0,r.y=e.y;else{var m,l;switch(l=1-y*y*this.pfact,l=(this.p-Math.sqrt(l))/(this.pn1/y+y/this.pn1),m=Math.sqrt(1-l*l),this.mode){case es.OBLIQ:r.y=Math.asin(m*this.sinph0+e.y*l*this.cosph0/y),e.y=(m-this.sinph0*Math.sin(r.y))*y,e.x*=l*this.cosph0;break;case es.EQUIT:r.y=Math.asin(e.y*l/y),e.y=m*y,e.x*=l;break;case es.N_POLE:r.y=Math.asin(m),e.y=-e.y;break;case es.S_POLE:r.y=-Math.asin(m);break}r.x=Math.atan2(e.x,e.y)}return e.x=r.x+this.long0,e.y=r.y,e}var AD=["Tilted_Perspective","tpers"];const PD={init:TD,forward:ID,inverse:CD,names:AD};function kD(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var e=1-this.es,r=1/e;this.radius_p=Math.sqrt(e),this.radius_p2=e,this.radius_p_inv2=r,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function DD(e){var r=e.x,a=e.y,u,d,y,m;if(r=r-this.long0,this.shape==="ellipse"){a=Math.atan(this.radius_p2*Math.tan(a));var l=this.radius_p/ua(this.radius_p*Math.cos(a),Math.sin(a));if(d=l*Math.cos(r)*Math.cos(a),y=l*Math.sin(r)*Math.cos(a),m=l*Math.sin(a),(this.radius_g-d)*d-y*y-m*m*this.radius_p_inv2<0)return e.x=Number.NaN,e.y=Number.NaN,e;u=this.radius_g-d,this.flip_axis?(e.x=this.radius_g_1*Math.atan(y/ua(m,u)),e.y=this.radius_g_1*Math.atan(m/u)):(e.x=this.radius_g_1*Math.atan(y/u),e.y=this.radius_g_1*Math.atan(m/ua(y,u)))}else this.shape==="sphere"&&(u=Math.cos(a),d=Math.cos(r)*u,y=Math.sin(r)*u,m=Math.sin(a),u=this.radius_g-d,this.flip_axis?(e.x=this.radius_g_1*Math.atan(y/ua(m,u)),e.y=this.radius_g_1*Math.atan(m/u)):(e.x=this.radius_g_1*Math.atan(y/u),e.y=this.radius_g_1*Math.atan(m/ua(y,u))));return e.x=e.x*this.a,e.y=e.y*this.a,e}function LD(e){var r=-1,a=0,u=0,d,y,m,l;if(e.x=e.x/this.a,e.y=e.y/this.a,this.shape==="ellipse"){this.flip_axis?(u=Math.tan(e.y/this.radius_g_1),a=Math.tan(e.x/this.radius_g_1)*ua(1,u)):(a=Math.tan(e.x/this.radius_g_1),u=Math.tan(e.y/this.radius_g_1)*ua(1,a));var T=u/this.radius_p;if(d=a*a+T*T+r*r,y=2*this.radius_g*r,m=y*y-4*d*this.C,m<0)return e.x=Number.NaN,e.y=Number.NaN,e;l=(-y-Math.sqrt(m))/(2*d),r=this.radius_g+l*r,a*=l,u*=l,e.x=Math.atan2(a,r),e.y=Math.atan(u*Math.cos(e.x)/r),e.y=Math.atan(this.radius_p_inv2*Math.tan(e.y))}else if(this.shape==="sphere"){if(this.flip_axis?(u=Math.tan(e.y/this.radius_g_1),a=Math.tan(e.x/this.radius_g_1)*Math.sqrt(1+u*u)):(a=Math.tan(e.x/this.radius_g_1),u=Math.tan(e.y/this.radius_g_1)*Math.sqrt(1+a*a)),d=a*a+u*u+r*r,y=2*this.radius_g*r,m=y*y-4*d*this.C,m<0)return e.x=Number.NaN,e.y=Number.NaN,e;l=(-y-Math.sqrt(m))/(2*d),r=this.radius_g+l*r,a*=l,u*=l,e.x=Math.atan2(a,r),e.y=Math.atan(u*Math.cos(e.x)/r)}return e.x=e.x+this.long0,e}var RD=["Geostationary Satellite View","Geostationary_Satellite","geos"];const zD={init:kD,forward:DD,inverse:LD,names:RD};var vh=1.340264,xh=-.081106,bh=893e-6,wh=.003796,df=Math.sqrt(3)/2;function OD(){this.es=0,this.long0=this.long0!==void 0?this.long0:0}function FD(e){var r=$t(e.x-this.long0),a=e.y,u=Math.asin(df*Math.sin(a)),d=u*u,y=d*d*d;return e.x=r*Math.cos(u)/(df*(vh+3*xh*d+y*(7*bh+9*wh*d))),e.y=u*(vh+xh*d+y*(bh+wh*d)),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function BD(e){e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a;var r=1e-9,a=12,u=e.y,d,y,m,l,T,P;for(P=0;P<a&&(d=u*u,y=d*d*d,m=u*(vh+xh*d+y*(bh+wh*d))-e.y,l=vh+3*xh*d+y*(7*bh+9*wh*d),u-=T=m/l,!(Math.abs(T)<r));++P);return d=u*u,y=d*d*d,e.x=df*e.x*(vh+3*xh*d+y*(7*bh+9*wh*d))/Math.cos(u),e.y=Math.asin(Math.sin(u)/df),e.x=$t(e.x+this.long0),e}var ND=["eqearth","Equal Earth","Equal_Earth"];const $D={init:OD,forward:FD,inverse:BD,names:ND};function UD(e){e.Proj.projections.add(Zd),e.Proj.projections.add(Wd),e.Proj.projections.add(VA),e.Proj.projections.add(JA),e.Proj.projections.add(nP),e.Proj.projections.add(cP),e.Proj.projections.add(mP),e.Proj.projections.add(xP),e.Proj.projections.add(EP),e.Proj.projections.add(PP),e.Proj.projections.add(ZP),e.Proj.projections.add(QP),e.Proj.projections.add(nk),e.Proj.projections.add(uk),e.Proj.projections.add(mk),e.Proj.projections.add(xk),e.Proj.projections.add(Ek),e.Proj.projections.add(Pk),e.Proj.projections.add(Ok),e.Proj.projections.add(Uk),e.Proj.projections.add(Hk),e.Proj.projections.add(Yk),e.Proj.projections.add(iD),e.Proj.projections.add(oD),e.Proj.projections.add(dD),e.Proj.projections.add(xD),e.Proj.projections.add(ED),e.Proj.projections.add(PD),e.Proj.projections.add(zD),e.Proj.projections.add($D)}Ks.defaultDatum="WGS84";Ks.Proj=no;Ks.WGS84=new Ks.Proj("WGS84");Ks.Point=hu;Ks.toPoint=Ax;Ks.defs=fs;Ks.nadgrid=qC;Ks.transform=cf;Ks.mgrs=aA;Ks.version="__VERSION__";UD(Ks);const Xs=Lo("MapStore",{state:()=>({map:{},currentMapStyle:"pwdDrawnMapStyle",bufferForAddress:{},currentMarkersForTopic:[],addressMarker:null,addressParcel:null,initialized:!1,draw:null,imageryOn:!1,imagerySelected:"2023",cyclomediaOn:!1,pictometryOn:!1}),actions:{setMap(e){this.map=e},setMapStyle(e){this.currentMapStyle=e},async fillBufferForAddress(e,r){const y=Ks("+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs","+proj=lcc +lat_1=40.96666666666667 +lat_2=39.93333333333333 +lat_0=39.33333333333334 +lon_0=-77.75 +x_0=600000 +y_0=0 +ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 +no_defs",[e,r]);console.log("fillBufferForAddress is running, lng:",e,"lat:",r);const m="https://citygeo-geocoder-pub.databridge.phila.gov/arcgis/rest/services/Utilities/Geometry/GeometryServer/buffer",l={geometries:`${y.join(", ")}`,inSR:2272,outSR:4326,bufferSR:2272,distances:500,unionResults:!0,geodesic:!1,f:"json"};let T=await gr.get(m,{params:l});this.bufferForAddress=T.data}}}),Fa=e=>(Fh("data-v-a07c46c0"),e=e(),Bh(),e),VD=Fa(()=>ne("div",{class:"box"},"Deed information and document transactions for this address. The map faithfully reflects property boundaries as described in recorded deeds including multiple types of easements. The property boundaries displayed on the map are for reference only and should not be used in place of the recorded deeds or land surveys. Source: Department of Records",-1)),jD={class:"columns is-multiline"},qD=["onClick"],GD=Fa(()=>ne("h5",{class:"title is-5"},"Parcel Details",-1)),HD={key:0,class:"vert-table"},ZD={class:"columns"},WD=Fa(()=>ne("div",{class:"column is-4"},"Map Registry #",-1)),XD={class:"column is-8"},KD={class:"columns"},YD=Fa(()=>ne("div",{class:"column is-4"},"Parcel Address",-1)),JD={class:"column is-8"},QD={class:"columns"},e3=Fa(()=>ne("div",{class:"column is-4"},"Status",-1)),t3={class:"column is-8"},i3={class:"columns"},r3=Fa(()=>ne("div",{class:"column is-4"},"Origination Date",-1)),n3={class:"column is-8"},s3={class:"columns"},a3=Fa(()=>ne("div",{class:"column is-4"},"Inactive Date",-1)),o3={class:"column is-8"},l3={class:"columns"},c3=Fa(()=>ne("div",{class:"column is-4"},"Has Air Rights",-1)),u3={class:"column is-8"},h3={class:"columns"},d3=Fa(()=>ne("div",{class:"column is-4"},"Is Condo",-1)),f3={class:"column is-8"},p3={class:"mt-6"},m3=Fa(()=>ne("h5",{class:"subtitle is-5"},"Documents",-1)),g3={class:"table is-fullwidth is-striped"},y3=Fa(()=>ne("thead",null,[ne("tr",null,[ne("th",null,"ID"),ne("th",null,"Date"),ne("th",null,"Type"),ne("th",null,"Grantor"),ne("th",null,"Grantee")])],-1)),_3={__name:"Deeds",setup(e){Ln();const r=Gh(),a=vx(),u=Ys(),y=Xs().map;let m=Ai(()=>u.selectedParcelId);const l=Ai(()=>r.dor.features.filter(z=>z.id===m.value)[0]),T=Ai(()=>m.value?(console.log("selected.value:",m.value),a.dorDocuments[m.value].data.features):null);lv(()=>{console.log("Deeds.vue onBeforeMount"),r.dor.features.length>0&&(u.selectedParcelId=r.dor.features[0].properties.OBJECTID)}),Nh(()=>{console.log("Deeds.vue onMounted, map.getStyle().sources:",y.getStyle().sources,"map.getStyle.layers:",y.getStyle().layers)});const P={1:"Active",2:"Inactive",3:"Remainder"};return(z,k)=>(Dt(),Ht($r,null,[VD,ne("div",jD,[(Dt(!0),Ht($r,null,Pa(er(r).dor.features,R=>(Dt(),Ht("div",{key:R.properties.OBJECTID,onClick:Z=>er(u).selectedParcelId=R.properties.OBJECTID,class:As(["column is-3 add-borders",{"is-selected":R.properties.OBJECTID===er(m)}])},ii(R.properties.MAPREG),11,qD))),128))]),GD,l.value?(Dt(),Ht("div",HD,[ne("div",ZD,[WD,ne("div",XD,ii(l.value.properties.MAPREG),1)]),ne("div",KD,[YD,ne("div",JD,ii(l.value.properties.ADDR_SOURCE),1)]),ne("div",QD,[e3,ne("div",t3,ii(P[l.value.properties.STATUS]),1)]),ne("div",i3,[r3,ne("div",n3,ii(l.value.properties.ORIG_DATE),1)]),ne("div",s3,[a3,ne("div",o3,ii(l.value.properties.INACTDATE||"None"),1)]),ne("div",l3,[c3,ne("div",u3,ii(l.value.properties.SUFFIX?"Yes":"No"),1)]),ne("div",h3,[d3,ne("div",f3,ii(l.value.properties.CONDOFLAG?"Yes":"No"),1)])])):Ki("",!0),ne("div",p3,[m3,ne("table",g3,[y3,ne("tbody",null,[(Dt(!0),Ht($r,null,Pa(T.value,R=>(Dt(),Ht("tr",null,[ne("td",null,ii(R.attributes.DOCUMENT_ID),1),ne("td",null,ii(R.attributes.DISPLAY_DATE),1),ne("td",null,ii(R.attributes.DOCUMENT_TYPE),1),ne("td",null,ii(R.attributes.GRANTORS),1),ne("td",null,ii(R.attributes.GRANTEES),1)]))),256))])])])],64))}},v3=pa(_3,[["__scopeId","data-v-a07c46c0"]]),jx=Lo("LiStore",{state:()=>({liInspections:{},liPermits:{}}),actions:{async fillLiInspections(){const r=Ln().addressData.features[0];let a="https://phl.carto.com/api/v2/sql?q=";const u=r.properties.eclipse_location_id.replace(/\|/g,"', '"),d=r.properties.street_address,y=r.properties.opa_account_num?` AND opa_account_num IN ('${r.properties.opa_account_num}')`:"",m=r.properties.pwd_parcel_id,l=r.properties.li_address_key.replace(/\|/g,"', '"),T=a+=`SELECT * FROM case_investigations WHERE (address = '${d}' or addressobjectid IN ('${l}'))           AND systemofrecord IN ('HANSEN') ${y} UNION SELECT * FROM case_investigations WHERE           addressobjectid IN ('${u}') OR parcel_id_num IN ( '${m}' )           AND systemofrecord IN ('ECLIPSE') ${y}`,P=await fetch(T);this.liInspections=await P.json()},async fillLiPermits(){const r=Ln().addressData.features[0];let a="https://phl.carto.com/api/v2/sql?q=";const u=r.properties.eclipse_location_id.replace(/\|/g,"', '"),d=r.properties.street_address,y=r.properties.opa_account_num?` AND opa_account_num IN ('${r.properties.opa_account_num}')`:"",m=r.properties.pwd_parcel_id,l=r.properties.li_address_key.replace(/\|/g,"', '"),T=a+=`SELECT * FROM PERMITS WHERE address = '${d}' or addressobjectid IN ('${l}')       AND systemofrecord IN ('HANSEN') ${y}       UNION SELECT * FROM PERMITS WHERE addressobjectid IN ('${u}') OR parcel_id_num IN ( '${m}' )       AND systemofrecord IN ('ECLIPSE')${y}      ORDER BY permittype`,P=await fetch(T);this.liPermits=await P.json()}},getters:{}}),x3=ne("div",{class:"box"}," Licenses, inspections, permits, property maintenance violations, and zoning permit documents at your search address. Source: Department of Licenses & Inspections ",-1),b3=ne("h5",{class:"subtitle is-5"},"Permits",-1),w3={class:"table is-fullwidth is-striped"},M3=ne("thead",null,[ne("tr",null,[ne("th",null,"Date"),ne("th",null,"ID"),ne("th",null,"Description"),ne("th",null,"Status")])],-1),S3=ne("h5",{class:"subtitle is-5"},"Inspections",-1),E3={class:"table is-fullwidth is-striped"},T3=ne("thead",null,[ne("tr",null,[ne("th",null,"Date"),ne("th",null,"ID"),ne("th",null,"Description"),ne("th",null,"Status")])],-1),I3=["innerHTML"],C3={__name:"LI",setup(e){console.log("LI.vue setup");const r=Ln(),a=jx(),{currency:u,date:d}=Qm(),y=(z,k)=>new Date(k.permitissuedate)-new Date(z.permitissuedate),m=Ai(()=>a.liPermits.rows.sort(y).slice(0,5)),l=(z,k)=>new Date(k.investigationcompleted)-new Date(z.investigationcompleted),T=Ai(()=>a.liInspections.rows.sort(l).slice(0,5)),P=z=>{let k=r.addressData.features[0].properties.street_address;return z.unit_num&&z.unit_num!=null&&(k+=" Unit "+z.unit_num),"<a target='_blank' href='https://li.phila.gov/Property-History/search/Violation-Detail?address="+encodeURIComponent(k)+"&Id="+z.casenumber+"'>"+z.casenumber+" <i class='fa fa-external-link-alt'></i></a>"};return(z,k)=>(Dt(),Ht("section",null,[x3,b3,ne("table",w3,[M3,ne("tbody",null,[(Dt(!0),Ht($r,null,Pa(m.value,R=>(Dt(),Ht("tr",null,[ne("td",null,ii(er(d)(R.permitissuedate)),1),ne("td",null,ii(R.permitnumber),1),ne("td",null,ii(R.permitdescription),1),ne("td",null,ii(R.status),1)]))),256))])]),S3,ne("table",E3,[T3,ne("tbody",null,[(Dt(!0),Ht($r,null,Pa(T.value,R=>(Dt(),Ht("tr",null,[ne("td",null,ii(er(d)(R.investigationcompleted)),1),ne("td",{innerHTML:P(R)},null,8,I3),ne("td",null,ii(R.investigationtype),1),ne("td",null,ii(R.investigationstatus),1)]))),256))])])]))}},A3=ne("h1",null,"Zoning Content",-1),P3=[A3],k3={__name:"Zoning",setup(e){return console.log("Zoning.vue setup"),(r,a)=>(Dt(),Ht("section",null,P3))}},D3=ne("h1",null,"Voting Content",-1),L3=[D3],R3={__name:"Voting",setup(e){return console.log("Voting.vue setup"),(r,a)=>(Dt(),Ht("section",null,L3))}};function Hp(e){return e&&typeof e=="object"&&!Array.isArray(e)&&e!==null}function Yh(e,r){let a=Object.assign({},e);return Hp(e)&&Hp(r)&&Object.keys(r).forEach(u=>{Hp(r[u])?u in e?a[u]=Yh(e[u],r[u]):Object.assign(a,{[u]:r[u]}):Object.assign(a,{[u]:r[u]})}),a}const Nf={sources:{imageryLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2023:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2023/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2022:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2022_2in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2020:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2020_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2019:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2019_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2018:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2018_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2017:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2017_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2016:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2016_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2015:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2015_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2012:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2012_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2010:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2010_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2008:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2008_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2004:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2004_6in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},1996:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_1996_6in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},1962:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/HistoricLandUse_1962/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},1942:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/HistoricLandUse_1942/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},1910:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/HistoricBromleyAtlas_1910/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},1895:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/HistoricBromleyAtlas_1895/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},1875:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/HistoricGMHopkinsAtlas_1875/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},1860:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/HistoricHexamerLocherAtlas_1860/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256}}},z3=Yh(Nf,{version:8,name:"pwdDrawnMap",sources:{pwd:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityBasemap/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},pwdLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityBasemap_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},addressMarker:{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[]}}},dorParcel:{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[]]]}}}},layers:[{id:"pwd",source:"pwd",type:"raster"},{id:"pwdLabels",source:"pwdLabels",type:"raster"},{id:"addressMarker",source:"addressMarker",type:"symbol",layout:{"icon-image":"marker-blue","icon-anchor":"bottom","icon-size":.05},paint:{"icon-color":"#ff0000","icon-opacity":1}}]}),O3=Yh(Nf,{version:8,name:"dorDrawnMap",sources:{dor:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/DORBasemap/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},dorLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/DORBasemap_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},addressMarker:{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[]}}},dorParcel:{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[]]]}}}},layers:[{id:"dor",source:"dor",type:"raster"},{id:"dorLabels",source:"dorLabels",type:"raster"},{id:"dorParcel",type:"fill",source:"dorParcel",layout:{},paint:{"fill-color":"#088","fill-opacity":.4}}]}),F3=Yh(Nf,{version:8,name:"dorDrawnMap",sources:{dor:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/DORBasemap/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},dorLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/DORBasemap_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},zoning:{tiles:["https://citygeo-geoserver.databridge.phila.gov/geoserver/wms?service=WMS&version=1.1.0&request=GetMap&layers=atlas_zoning_grouped&bbox={bbox-epsg-3857}&width=256&height=256&srs=EPSG%3A3857&styles=&format=image/png&transparent=true"],type:"raster",tileSize:256},addressMarker:{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[]}}},dorParcel:{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[]]]}}}},layers:[{id:"dor",source:"dor",type:"raster"},{id:"dorLabels",source:"dorLabels",type:"raster"},{id:"zoning",source:"zoning",type:"raster"},{id:"dorParcel",type:"fill",source:"dorParcel",layout:{},paint:{"fill-color":"#088","fill-opacity":.4}}]}),B3=Yh(Nf,{version:8,name:"pwdDrawnMap",sources:{pwd:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityBasemap/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},pwdLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityBasemap_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},addressMarker:{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[]}}},dorParcel:{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[]]]}}},nearby:{type:"geojson",data:{type:"FeatureCollection",features:[]}}},layers:[{id:"pwd",source:"pwd",type:"raster"},{id:"pwdLabels",source:"pwdLabels",type:"raster"},{id:"nearby",source:"nearby",type:"circle",paint:{"circle-radius":7,"circle-color":["match",["get","type"],"nearby311","#FF0000","nearbyCrimeIncidents","#0096FF","#000000"],"circle-stroke-width":1,"circle-stroke-color":"white"}},{id:"addressMarker",source:"addressMarker",type:"symbol",layout:{"icon-image":"marker-blue","icon-anchor":"bottom","icon-size":.05}}]}),ps={topicStyles:{Property:"pwdDrawnMapStyle",Condos:"pwdDrawnMapStyle",Deeds:"dorDrawnMapStyle","Licenses & Inspections":"pwdDrawnMapStyle",Zoning:"zoningDrawnMapStyle",Voting:"pwdDrawnMapStyle","Nearby Activity":"nearbyDrawnMapStyle"},parcelLayerForTopic:{undefined:"pwd",Property:"pwd",Condos:"pwd",Deeds:"dor","Licenses & Inspections":"pwd",Zoning:"dor",Voting:"pwd","Nearby Activity":"pwd"},mapLayers:{pwdBasemap:{id:"pwdBasemap",source:"pwdBasemap",type:"raster"},pwdLabels:{id:"pwdLabels",source:"pwdLabels",type:"raster"},dorBasemap:{id:"dorBasemap",source:"dorBasemap",type:"raster"},dorLabels:{id:"dorLabels",source:"dorLabels",type:"raster"},zoning:{id:"zoning",source:"zoning",type:"raster"},addressMarker:{id:"addressMarker",source:"addressMarker",type:"circle"},dorParcel:{id:"dorParcel",type:"fill",source:"dorParcel",layout:{},paint:{"fill-color":"#088","fill-opacity":.4}},imageryLabels:{id:"imageryLabels",source:"imageryLabels",type:"raster"},2023:{id:"2023",source:"2023",type:"raster"},2022:{id:"2022",source:"2022",type:"raster"},2020:{id:"2020",source:"2020",type:"raster"},2019:{id:"2019",source:"2019",type:"raster"},2018:{id:"2018",source:"2018",type:"raster"},2017:{id:"2017",source:"2017",type:"raster"},2016:{id:"2016",source:"2016",type:"raster"},2015:{id:"2015",source:"2015",type:"raster"},2012:{id:"2012",source:"2012",type:"raster"},2010:{id:"2010",source:"2010",type:"raster"},2008:{id:"2008",source:"2008",type:"raster"},2004:{id:"2004",source:"2004",type:"raster"},1996:{id:"1996",source:"1996",type:"raster"},1962:{id:"1962",source:"1962",type:"raster"},1942:{id:"1942",source:"1942",type:"raster"},1910:{id:"1910",source:"1910",type:"raster"},1895:{id:"1895",source:"1895",type:"raster"},1875:{id:"1875",source:"1875",type:"raster"},1860:{id:"1860",source:"1860",type:"raster"}}};ps.pwdDrawnMapStyle=z3;ps.dorDrawnMapStyle=O3;ps.zoningDrawnMapStyle=F3;ps.nearbyDrawnMapStyle=B3;var Ts=63710088e-1,qx={centimeters:Ts*100,centimetres:Ts*100,degrees:Ts/111325,feet:Ts*3.28084,inches:Ts*39.37,kilometers:Ts/1e3,kilometres:Ts/1e3,meters:Ts,metres:Ts,miles:Ts/1609.344,millimeters:Ts*1e3,millimetres:Ts*1e3,nauticalmiles:Ts/1852,radians:1,yards:Ts*1.0936},m0={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function sg(e,r,a){a===void 0&&(a={});var u={type:"Feature"};return(a.id===0||a.id)&&(u.id=a.id),a.bbox&&(u.bbox=a.bbox),u.properties=r||{},u.geometry=e,u}function Rh(e,r,a){if(a===void 0&&(a={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!g0(e[0])||!g0(e[1]))throw new Error("coordinates must contain numbers");var u={type:"Point",coordinates:e};return sg(u,r,a)}function Gx(e,r,a){a===void 0&&(a={});for(var u=0,d=e;u<d.length;u++){var y=d[u];if(y.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var m=0;m<y[y.length-1].length;m++)if(y[y.length-1][m]!==y[0][m])throw new Error("First and last Position are not equivalent.")}var l={type:"Polygon",coordinates:e};return sg(l,r,a)}function N3(e,r,a){if(a===void 0&&(a={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var u={type:"LineString",coordinates:e};return sg(u,r,a)}function $3(e,r){r===void 0&&(r={});var a={type:"FeatureCollection"};return r.id&&(a.id=r.id),r.bbox&&(a.bbox=r.bbox),a.features=e,a}function U3(e,r){r===void 0&&(r="kilometers");var a=qx[r];if(!a)throw new Error(r+" units is invalid");return e*a}function V3(e,r){r===void 0&&(r="kilometers");var a=qx[r];if(!a)throw new Error(r+" units is invalid");return e/a}function Mm(e){var r=e%(2*Math.PI);return r*180/Math.PI}function Da(e){var r=e%360;return r*Math.PI/180}function j3(e,r,a){if(r===void 0&&(r="meters"),a===void 0&&(a="kilometers"),!(e>=0))throw new Error("area must be a positive number");var u=m0[r];if(!u)throw new Error("invalid original units");var d=m0[a];if(!d)throw new Error("invalid final units");return e/u*d}function g0(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function zh(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function fu(e,r,a){a===void 0&&(a={});var u=zh(e),d=zh(r),y=Da(d[1]-u[1]),m=Da(d[0]-u[0]),l=Da(u[1]),T=Da(d[1]),P=Math.pow(Math.sin(y/2),2)+Math.pow(Math.sin(m/2),2)*Math.cos(l)*Math.cos(T);return U3(2*Math.atan2(Math.sqrt(P),Math.sqrt(1-P)),a.units)}function Sm(e,r,a){if(e!==null)for(var u,d,y,m,l,T,P,z=0,k=0,R,Z=e.type,K=Z==="FeatureCollection",Y=Z==="Feature",ge=K?e.features.length:1,Te=0;Te<ge;Te++){P=K?e.features[Te].geometry:Y?e.geometry:e,R=P?P.type==="GeometryCollection":!1,l=R?P.geometries.length:1;for(var Fe=0;Fe<l;Fe++){var he=0,Le=0;if(m=R?P.geometries[Fe]:P,m!==null){T=m.coordinates;var We=m.type;switch(z=a&&(We==="Polygon"||We==="MultiPolygon")?1:0,We){case null:break;case"Point":if(r(T,k,Te,he,Le)===!1)return!1;k++,he++;break;case"LineString":case"MultiPoint":for(u=0;u<T.length;u++){if(r(T[u],k,Te,he,Le)===!1)return!1;k++,We==="MultiPoint"&&he++}We==="LineString"&&he++;break;case"Polygon":case"MultiLineString":for(u=0;u<T.length;u++){for(d=0;d<T[u].length-z;d++){if(r(T[u][d],k,Te,he,Le)===!1)return!1;k++}We==="MultiLineString"&&he++,We==="Polygon"&&Le++}We==="Polygon"&&he++;break;case"MultiPolygon":for(u=0;u<T.length;u++){for(Le=0,d=0;d<T[u].length;d++){for(y=0;y<T[u][d].length-z;y++){if(r(T[u][d][y],k,Te,he,Le)===!1)return!1;k++}Le++}he++}break;case"GeometryCollection":for(u=0;u<m.geometries.length;u++)if(Sm(m.geometries[u],r,a)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Hx(e,r){if(e.type==="Feature")r(e,0);else if(e.type==="FeatureCollection")for(var a=0;a<e.features.length&&r(e.features[a],a)!==!1;a++);}function q3(e,r){var a,u,d,y,m,l,T,P,z,k,R=0,Z=e.type==="FeatureCollection",K=e.type==="Feature",Y=Z?e.features.length:1;for(a=0;a<Y;a++){for(l=Z?e.features[a].geometry:K?e.geometry:e,P=Z?e.features[a].properties:K?e.properties:{},z=Z?e.features[a].bbox:K?e.bbox:void 0,k=Z?e.features[a].id:K?e.id:void 0,T=l?l.type==="GeometryCollection":!1,m=T?l.geometries.length:1,d=0;d<m;d++){if(y=T?l.geometries[d]:l,y===null){if(r(null,R,P,z,k)===!1)return!1;continue}switch(y.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(r(y,R,P,z,k)===!1)return!1;break}case"GeometryCollection":{for(u=0;u<y.geometries.length;u++)if(r(y.geometries[u],R,P,z,k)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}R++}}function G3(e,r,a){var u=a;return q3(e,function(d,y,m,l,T){y===0&&a===void 0?u=d:u=r(u,d,y,m,l,T)}),u}function H3(e){var r=[];return e.type==="FeatureCollection"?Hx(e,function(a){Sm(a,function(u){r.push(Rh(u,a.properties))})}):Sm(e,function(a){r.push(Rh(a,e.properties))}),$3(r)}function Z3(e){if(!e)throw new Error("geojson is required");switch(e.type){case"Feature":return Zx(e);case"FeatureCollection":return W3(e);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return ag(e);default:throw new Error("unknown GeoJSON type")}}function Zx(e){var r={type:"Feature"};return Object.keys(e).forEach(function(a){switch(a){case"type":case"properties":case"geometry":return;default:r[a]=e[a]}}),r.properties=Wx(e.properties),r.geometry=ag(e.geometry),r}function Wx(e){var r={};return e&&Object.keys(e).forEach(function(a){var u=e[a];typeof u=="object"?u===null?r[a]=null:Array.isArray(u)?r[a]=u.map(function(d){return d}):r[a]=Wx(u):r[a]=u}),r}function W3(e){var r={type:"FeatureCollection"};return Object.keys(e).forEach(function(a){switch(a){case"type":case"features":return;default:r[a]=e[a]}}),r.features=e.features.map(function(a){return Zx(a)}),r}function ag(e){var r={type:e.type};return e.bbox&&(r.bbox=e.bbox),e.type==="GeometryCollection"?(r.geometries=e.geometries.map(function(a){return ag(a)}),r):(r.coordinates=Xx(e.coordinates),r)}function Xx(e){var r=e;return typeof r[0]!="object"?r.slice():r.map(function(a){return Xx(a)})}function X3(e,r){if(!e)throw new Error("targetPoint is required");if(!r)throw new Error("points is required");var a,u=1/0,d=0;return Hx(r,function(y,m){var l=fu(e,y);l<u&&(d=m,u=l)}),a=Z3(r.features[d]),a.properties.featureIndex=d,a.properties.distanceToPoint=u,a}const K3=(e,r)=>{const a={};if(!r.options.params)return a;const u=Object.entries(r.options.params);(void 0).store.state;for(let[d,y]of u){let m;typeof y=="function"?m=y(e):m=y,a[d]=m}return a},Zp=(e,r)=>{const a=K3(e,r);r.url;const u=r.options,d=u.table,y=u.dateMinNum||null,m=u.dateMinType||null,l=u.dateField||null;u.success;const T=u.distances||250,P=u.groupby||null,z="ST_Distance(the_geom::geography, ST_SetSRID(ST_Point("+e.geometry.coordinates[0]+","+e.geometry.coordinates[1]+"),4326)::geography)",k="ST_Y(the_geom)",R="ST_X(the_geom)";let Z;P?Z=P+", the_geom":Z="*",Z=Z+", "+z+"as distance,"+k+"as lat, "+R+"as lng",a.q="select "+Z+" from "+d+" where "+z+" < "+T;let K;if(y){switch(m){case"hour":K=bI;break;case"day":K=rI;break;case"week":K=wI;break;case"month":K=xI;break;case"year":K=MI;break}a.q=a.q+" and "+l+" > '"+_m(K(new Date,y),"yyyy-MM-dd")+"'"}return P&&(a.q=a.q+" group by "+P+", the_geom"),a},Kx=Lo("NearbyActivityStore",{state:()=>({loadingData:!1,nearby311:{},nearbyCrimeIncidents:null,nearbyZoningAppeals:null,nearbyVacantIndicatorPoints:null,nearbyConstructionPermits:null,nearbyDemolitionPermits:null,nearbyImminentlyDangerous:null}),actions:{setLoadingData(e){this.loadingData=e},async fetchData(e){console.log("fetchData is runnning, dataType:",e),e==="nearby311"?await this.fillNearby311():e==="nearbyCrimeIncidents"?await this.fillNearbyCrimeIncidents():e==="nearbyZoningAppeals"?await this.fillNearbyZoningAppeals():e==="nearbyVacantIndicatorPoints"&&await this.fillNearbyVacantIndicatorPoints()},async fillNearby311(){const e=Ln();this.setLoadingData(!0);const r=e.addressData.features[0];let a={url:"https://phl.carto.com/api/v2/sql?",options:{table:"public_cases_fc",dateMinNum:365,dateMinType:"day",dateField:"requested_datetime"}},u=Zp(r,a);const d=await gr.get(a.url,{params:u});this.nearby311=d,this.setLoadingData(!1)},async fillNearbyCrimeIncidents(){const e=Ln();this.setLoadingData(!0);const r=e.addressData.features[0];let a={url:"https://phl.carto.com/api/v2/sql?",options:{table:"incidents_part1_part2",dateMinNum:90,dateMinType:"day",dateField:"dispatch_date"}},u=Zp(r,a);const d=await gr.get(a.url,{params:u});this.nearbyCrimeIncidents=d,this.setLoadingData(!1)},async fillNearbyZoningAppeals(){const e=Ln();this.setLoadingData(!0);const r=e.addressData.features[0];let a={url:"https://phl.carto.com/api/v2/sql?",options:{table:"appeals",dateMinNum:1,dateMinType:"year",dateField:"scheduleddate"}},u=Zp(r,a);const d=await gr.get(a.url,{params:u});this.nearbyZoningAppeals=d,this.setLoadingData(!1)},async fillNearbyVacantIndicatorPoints(){this.setLoadingData(!0);const r=Xs().bufferForAddress,a="https://services.arcgis.com/fLeGjb7u4uXqeF9q/arcgis/rest/services/Vacant_Indicators_Points/FeatureServer/0/query?",u=r.geometries[0].rings[0];let d=[[parseFloat(u[0][0].toFixed(6)),parseFloat(u[0][1].toFixed(6))]];var y;for(y=0;y<u.length;y++)if(y%3==0){let Z=[parseFloat(u[y][0].toFixed(6)),parseFloat(u[y][1].toFixed(6))];d.push(Z)}d.push([parseFloat(u[0][0].toFixed(6)),parseFloat(u[0][1].toFixed(6))]);const m={returnGeometry:!0,where:"1=1",outSR:4326,outFields:"*",inSr:4326,geometryType:"esriGeometryPolygon",spatialRel:"esriSpatialRelContains",f:"geojson",geometry:JSON.stringify({rings:[d],spatialReference:{wkid:4326}})};let P=(await(await gr.get(a,{params:m})).data||{}).features;const k=Ln().addressData.features[0],R=Rh(k.geometry.coordinates);P=P.map(Z=>{const K=Z.geometry.coordinates;let Y;if(Array.isArray(K[0])){let Te;Z.geometry.type==="LineString"?Te=N3([K[0],K[1]],{name:"line 1"}):Te=Gx([K[0]]);const Fe=H3(Te),he=X3(R,Fe);Y=fu(R,he,{units:"miles"})}else{const Te=Rh(K);Y=fu(R,Te,{units:"miles"})}const ge=parseInt(Y*5280);return Z._distance=ge,Z}),this.nearbyVacantIndicatorPoints=P,this.setLoadingData(!1)}}}),zs=e=>(Fh("data-v-660430e9"),e=e(),Bh(),e),Y3=zs(()=>ne("div",{class:"box"}," See recent activity near your search address including 311 service requests, crimes, zoning appeals, and more. Hover over a record below to highlight it on the map. ",-1)),J3=zs(()=>ne("div",{class:"dropdown-trigger"},[ne("button",{class:"button","aria-haspopup":"true","aria-controls":"dropdown-menu"},[ne("span",null,"What nearby activity would you like to see?"),ne("span",{class:"icon is-small"},[ne("i",{class:"fas fa-angle-down","aria-hidden":"true"})])])],-1)),Q3={class:"dropdown-menu",id:"dropdown-menu",role:"menu"},eL={class:"dropdown-content"},tL=zs(()=>ne("br",null,null,-1)),iL=zs(()=>ne("div",{class:"dropdown-trigger"},[ne("button",{class:"button","aria-haspopup":"true","aria-controls":"dropdown-menu"},[ne("span",null,"From"),ne("span",{class:"icon is-small"},[ne("i",{class:"fas fa-angle-down","aria-hidden":"true"})])])],-1)),rL={class:"dropdown-menu",id:"dropdown-menu",role:"menu"},nL={class:"dropdown-content"},sL=["onClick"],aL=zs(()=>ne("div",{class:"dropdown-trigger"},[ne("button",{class:"button","aria-haspopup":"true","aria-controls":"dropdown-menu"},[ne("span",null,"Sort by"),ne("span",{class:"icon is-small"},[ne("i",{class:"fas fa-angle-down","aria-hidden":"true"})])])],-1)),oL={class:"dropdown-menu",id:"dropdown-menu",role:"menu"},lL={class:"dropdown-content"},cL=zs(()=>ne("br",null,null,-1)),uL={key:0,class:"mt-5"},hL=zs(()=>ne("h5",{class:"subtitle is-5"},"311 Requests",-1)),dL={key:0},fL={class:"table is-fullwidth is-striped"},pL=zs(()=>ne("thead",null,[ne("tr",null,[ne("th",null,"Date"),ne("th",null,"Location"),ne("th",null,"Type"),ne("th",null,"Distance")])],-1)),mL=["id"],gL={key:1,class:"mt-5"},yL=zs(()=>ne("h5",{class:"subtitle is-5"},"Crime Incidents",-1)),_L={key:0},vL={class:"table is-fullwidth is-striped"},xL=zs(()=>ne("thead",null,[ne("tr",null,[ne("th",null,"Date"),ne("th",null,"Location"),ne("th",null,"Description"),ne("th",null,"Distance")])],-1)),bL=["id"],wL={key:2,class:"mt-5"},ML=zs(()=>ne("h5",{class:"subtitle is-5"},"Zoning Appeals",-1)),SL={key:0},EL={class:"table is-fullwidth is-striped"},TL=zs(()=>ne("thead",null,[ne("tr",null,[ne("th",null,"Date"),ne("th",null,"Location"),ne("th",null,"Description"),ne("th",null,"Distance")])],-1)),IL=["id"],CL={key:3,class:"mt-5"},AL=zs(()=>ne("h5",{class:"subtitle is-5"},"Likely Vacant Properties",-1)),PL={key:0},kL={class:"table is-fullwidth is-striped"},DL=zs(()=>ne("thead",null,[ne("tr",null,[ne("th",null,"Address"),ne("th",null,"Property Type"),ne("th",null,"Distance")])],-1)),LL=["id"],RL={__name:"NearbyActivity",setup(e){console.log("Nearby.vue setup");const r=Kx(),a=Ys(),d=Xs().map,{currency:y,date:m}=Qm(),l=Vh(),T=Uh(),P=(ut,rt,et)=>new Date(rt[et])-new Date(ut[et]),z={nearby311:"311 Requests",nearbyCrimeIncidents:"Crime Incidents",nearbyZoningAppeals:"Zoning Appeals",nearbyVacantIndicatorPoints:"Vacant Properties",nearbyConstructionPermits:"Construction Permits",nearbyDemolitionPermits:"Demolition Permits",nearbyImminentlyDangerous:"Imminently Dangerous"},k=Ps(!1),R=()=>k.value=!k.value,Z=Ai(()=>a.currentNearbyDataType),K=Ai(()=>r.loadingData),Y=ut=>{T.push({name:"address-topic-and-data",params:{address:a.currentAddress,topic:l.params.topic,data:ut}})};ks(()=>l.params.data,async ut=>{ut&&(a.setCurrentNearbyDataType(ut),await ge(ut))});const ge=async ut=>{r[ut]===null&&(console.log("fetching new data"),await r.fetchData(ut)),lt(Rt[ut].values[0])},Te=Ps(!1),Fe=()=>Te.value=!Te.value,he=Ps("distance"),Le=ut=>{he.value=ut},We=Ps(!1),Qe=()=>We.value=!We.value,bt=Ps(null);Nh(()=>{bt.value=Rt[Z.value].values[0]});const He=Ai(()=>Rt[Z.value].labels[Rt[Z.value].values.indexOf(bt.value)]),lt=ut=>{bt.value=ut},Rt={nearby311:{labels:["the last 30 days","the last 90 days","1 year"],values:[30,90,365]},nearbyCrimeIncidents:{labels:["the last 30 days","the last 90 days"],values:[30,90]},nearbyZoningAppeals:{labels:["any time","the last 90 days","the next 90 days"],values:[0,-90,90]},nearbyVacantIndicatorPoints:{labels:[],values:[]},nearbyConstructionPermits:{labels:["the last 30 days","the last 90 days","1 year"],values:[30,90,365]},nearbyDemolitionPermits:{labels:["the last 30 days","the last 90 days","1 year"],values:[30,90,365]},nearbyImminentlyDangerous:{labels:["the last 30 days","the last 90 days","1 year"],values:[30,90,365]}},Pt=Ai(()=>{if(r.nearby311){let ut=[...r.nearby311.data.rows].filter(rt=>{let et=new Date(rt.requested_datetime);return(new Date-et)/(1e3*60*60*24)<=bt.value});return he.value==="distance"?ut.sort((rt,et)=>rt.distance-et.distance):he.value==="time"&&ut.sort((rt,et)=>P(rt,et,"requested_datetime")),ut}}),oi=Ai(()=>{let ut=[];if(!Pt.value)return ut;for(let rt of Pt.value)ut.push({type:"Feature",geometry:{type:"Point",coordinates:[rt.lng,rt.lat]},properties:{id:rt.service_request_id,type:"nearby311"}});return ut});ks(()=>oi.value,ut=>{if(console.log("nearby311Geojson watch, newGeojson:",ut),ut.length>0){console.log("$config:",ps,"map.getStyle().sources:",d.getStyle().sources,"map.getStyle().layers:",d.getStyle().layers);let rt={type:"FeatureCollection",features:ut};console.log("geojson:",rt,"map.getSource(nearby):",d.getSource("nearby")),d.getSource("nearby").setData(rt)}});const pi=Ai(()=>{if(r.nearbyCrimeIncidents){let ut=[...r.nearbyCrimeIncidents.data.rows].filter(rt=>{let et=new Date(rt.dispatch_date);return(new Date-et)/(1e3*60*60*24)<=bt.value});return he.value==="distance"?ut.sort((rt,et)=>rt.distance-et.distance):he.value==="time"&&ut.sort((rt,et)=>P(rt,et,"dispatch_date")),ut}}),Yt=Ai(()=>{let ut=[];if(!pi.value)return ut;for(let rt of pi.value)ut.push({type:"Feature",geometry:{type:"Point",coordinates:[rt.lng,rt.lat]},properties:{id:rt.objectid,type:"nearbyCrimeIncidents"}});return ut});ks(()=>Yt.value,async ut=>{if(console.log("nearbyCrimeIncidents watch, newGeojson:",ut),ut.length>0){console.log("$config:",ps,"map.getStyle().sources:",d.getStyle().sources,"map.getStyle().layers:",d.getStyle().layers);let rt={type:"FeatureCollection",features:ut};await d.getSource("nearby").setData(rt)}});const cr=Ai(()=>{if(r.nearbyZoningAppeals){let ut=[...r.nearbyZoningAppeals.data.rows];return console.log(new Date(ut[0].scheduleddate)),bt.value<0?ut=ut.filter(rt=>{let et=new Date(rt.scheduleddate);return(new Date-et)/(1e3*60*60*24)>=bt.value}):bt.value>0&&(ut=ut.filter(rt=>{let et=new Date(rt.scheduleddate);return(new Date-et)/(1e3*60*60*24)<=bt.value})),he.value==="distance"?ut.sort((rt,et)=>rt.distance-et.distance):he.value==="time"&&ut.sort((rt,et)=>P(rt,et,"dispatch_date")),ut}}),si=Ai(()=>{if(r.nearbyVacantIndicatorPoints){let ut=[...r.nearbyVacantIndicatorPoints];return he.value==="distance"?ut.sort((rt,et)=>rt._distance-et._distance):he.value==="type"&&ut.sort((rt,et)=>rt.distance-et.distance),ut}}),Qt=Ai(()=>a.hoveredStateId),gi=ut=>{const rt=ut.getBoundingClientRect(),et={top:rt.top>=108,left:rt.left>=0,bottom:rt.bottom<=(window.innerHeight||document.documentElement.clientHeight),right:rt.right<=(window.innerWidth||document.documentElement.clientWidth)};return Object.values(et).every(ir=>ir)};ks(()=>Qt.value,ut=>{if(console.log("hoveredStateId watch, newHoveredStateId:",ut),ut){const rt=document.getElementById(ut);gi(rt)||rt.scrollIntoView({block:"center"})}});const ur=ut=>{console.log("handleRowMouseover, e.target.parentElement.id:",ut.target.parentElement.id),a.hoveredStateId=parseInt(ut.target.parentElement.id)},Ar=ut=>{console.log("handleRowMouseleave, e.target.id:",ut.target.id),a.hoveredStateId=""};return(ut,rt)=>(Dt(),Ht("section",null,[Y3,ne("div",{class:As(k.value?"dropdown is-active":"dropdown"),onClick:R},[J3,ne("div",Q3,[ne("div",eL,[ne("a",{class:"dropdown-item",onClick:rt[0]||(rt[0]=et=>Y("nearby311"))},"311 Requests"),ne("a",{class:"dropdown-item",onClick:rt[1]||(rt[1]=et=>Y("nearbyCrimeIncidents"))},"Crime Incidents"),ne("a",{class:"dropdown-item",onClick:rt[2]||(rt[2]=et=>Y("nearbyZoningAppeals"))},"Zoning Appeals"),ne("a",{class:"dropdown-item",onClick:rt[3]||(rt[3]=et=>Y("nearbyVacantIndicatorPoints"))},"Vacant Properties"),ne("a",{class:"dropdown-item",onClick:rt[4]||(rt[4]=et=>Y("nearbyConstructionPermits"))},"Construction Permits"),ne("a",{class:"dropdown-item",onClick:rt[5]||(rt[5]=et=>Y("nearbyDemolitionPermits"))},"Demolition Permits"),ne("a",{class:"dropdown-item",onClick:rt[6]||(rt[6]=et=>Y("nearbyImminentlyDangerous"))},"Imminently Dangerous")])])],2),ne("span",null,ii(z[Z.value]),1),tL,ne("div",{class:As(We.value?"dropdown is-active":"dropdown"),onClick:Qe},[iL,ne("div",rL,[ne("div",nL,[(Dt(!0),Ht($r,null,Pa(Rt[Z.value].values,(et,ir)=>(Dt(),Ht("a",{class:"dropdown-item",onClick:ji=>lt(et)},ii(Rt[Z.value].labels[ir]),9,sL))),256))])])],2),ne("span",null,ii(He.value),1),ne("div",{class:As(Te.value?"dropdown is-active":"dropdown"),onClick:Fe},[aL,ne("div",oL,[ne("div",lL,[ne("a",{class:"dropdown-item",onClick:rt[7]||(rt[7]=et=>Le("distance"))},"distance"),ne("a",{class:"dropdown-item",onClick:rt[8]||(rt[8]=et=>Le("time"))},"time")])])],2),ne("span",null,ii(he.value),1),cL,Z.value=="nearby311"?(Dt(),Ht("div",uL,[hL,K.value?(Dt(),Ht("div",dL,"Loading...")):Ki("",!0),ne("table",fL,[pL,ne("tbody",null,[(Dt(!0),Ht($r,null,Pa(Pt.value,et=>(Dt(),Ht("tr",{key:et.service_request_id,id:et.service_request_id,onMouseover:ur,onMouseleave:Ar,class:As(Qt.value==et.service_request_id?"active":"inactive")},[ne("td",null,ii(er(m)(et.requested_datetime)),1),ne("td",null,ii(et.address),1),ne("td",null,ii(et.service_name),1),ne("td",null,ii((et.distance*3.28084).toFixed(0))+" ft",1)],42,mL))),128))])])])):Ki("",!0),Z.value=="nearbyCrimeIncidents"?(Dt(),Ht("div",gL,[yL,K.value?(Dt(),Ht("div",_L,"Loading...")):Ki("",!0),ne("table",vL,[xL,ne("tbody",null,[(Dt(!0),Ht($r,null,Pa(pi.value,et=>(Dt(),Ht("tr",{key:et.objectid,id:et.objectid,onMouseover:ur,onMouseleave:Ar,class:As(Qt.value==et.objectid?"active":"inactive")},[ne("td",null,ii(et.dispatch_date),1),ne("td",null,ii(et.location_block),1),ne("td",null,ii(et.text_general_code),1),ne("td",null,ii((et.distance*3.28084).toFixed(0))+" ft",1)],42,bL))),128))])])])):Ki("",!0),Z.value=="nearbyZoningAppeals"?(Dt(),Ht("div",wL,[ML,K.value?(Dt(),Ht("div",SL,"Loading...")):Ki("",!0),ne("table",EL,[TL,ne("tbody",null,[(Dt(!0),Ht($r,null,Pa(cr.value,et=>(Dt(),Ht("tr",{key:et.objectid,id:et.objectid,onMouseover:ur,onMouseleave:Ar,class:As(Qt.value==et.objectid?"active":"inactive")},[ne("td",null,ii(et.scheduleddate),1),ne("td",null,ii(et.address),1),ne("td",null,ii(et.appeal_grounds),1),ne("td",null,ii((et.distance*3.28084).toFixed(0))+" ft",1)],42,IL))),128))])])])):Ki("",!0),Z.value=="nearbyVacantIndicatorPoints"?(Dt(),Ht("div",CL,[AL,K.value?(Dt(),Ht("div",PL,"Loading...")):Ki("",!0),ne("table",kL,[DL,ne("tbody",null,[(Dt(!0),Ht($r,null,Pa(si.value,et=>(Dt(),Ht("tr",{key:et.OBJECTID,id:et.OBJECTID,onMouseover:ur,onMouseleave:Ar,class:As(Qt.value==et.OBJECTID?"active":"inactive")},[ne("td",null,ii(et.properties.ADDRESS),1),ne("td",null,ii(et.properties.VACANT_FLAG),1),ne("td",null,ii((et._distance*3.28084).toFixed(0))+" ft",1)],42,LL))),128))])])])):Ki("",!0)]))}},zL=pa(RL,[["__scopeId","data-v-660430e9"]]),OL=e=>(Fh("data-v-8b6a956f"),e=e(),Bh(),e),FL={key:0,class:"columns"},BL=C2('<div class="column is-12" data-v-8b6a956f><h3 class="subtitle is-3" data-v-8b6a956f>Atlas is your front door to the City of Philadelphia.</h3><p class="subtitle is-5" data-v-8b6a956f>Here are some things you can do with Atlas:</p><ul data-v-8b6a956f><li data-v-8b6a956f>Find your polling place</li><li data-v-8b6a956f>Get the history of permits, licenses, and inspections at any address</li><li data-v-8b6a956f>Research real estate information including property values, zoning, and document archives</li><li data-v-8b6a956f>Get easy access to a variety of hard-to-find City resources</li><li data-v-8b6a956f>View recent activity around your address, such as crimes, 311 service requests, and more</li><li data-v-8b6a956f>Explore historical imagery and maps</li></ul><p data-v-8b6a956f>To get started, click anywhere on the map, or type an address, intersection, property assessment account number, or Department of Records Map Registry number into the search box.</p></div>',1),NL=[BL],$L={key:1,class:"columns"},UL=OL(()=>ne("div",{class:"column is-12"},[ne("p",null,"We couldn't find that address. Are you sure everything was spelled correctly?"),ne("p",null,"Here are some examples of things you can search for:"),ne("ul",null,[ne("li",null,"1234 Market St"),ne("li",null,"1001 Pine Street #201"),ne("li",null,"12th & Market"),ne("li",null,"12th & Market"),ne("li",null,"883309050 (an OPA number with no hyphens or other characters)")])],-1)),VL=[UL],jL={key:2},qL={class:"columns"},GL={class:"column is-12"},HL={class:"subtitle is-3"},ZL={class:"topics pr-4"},WL={__name:"TopicPanel",setup(e){const r=Ys(),a=zf(),u=Vh(),d=Ai(()=>r.currentAddress),y=Ai(()=>r.dataSourcesLoadedArray);return(m,l)=>(Dt(),Ht("section",null,[er(u).name=="home"?(Dt(),Ht("div",FL,NL)):Ki("",!0),er(u).name=="not-found"?(Dt(),Ht("div",$L,VL)):Ki("",!0),d.value?(Dt(),Ht("div",jL,[ne("div",qL,[ne("div",GL,[ne("h3",HL,ii(d.value),1)])]),ne("div",ZL,[tr(ic,{"topic-name":"Property",loading:!y.value.includes("Property")},{default:Ao(()=>[y.value.includes("Property")?(Dt(),Qa(JI,{key:0})):Ki("",!0)]),_:1},8,["loading"]),nv(tr(ic,{"topic-name":"Condominiums",loading:!y.value.includes("Condominiums")},{default:Ao(()=>[y.value.includes("Condominiums")?(Dt(),Qa(rC,{key:0})):Ki("",!0)]),_:1},8,["loading"]),[[G2,er(a).condosData.length>0]]),tr(ic,{"topic-name":"Deeds",loading:!y.value.includes("Deeds")},{default:Ao(()=>[y.value.includes("Deeds")?(Dt(),Qa(v3,{key:0})):Ki("",!0)]),_:1},8,["loading"]),tr(ic,{"topic-name":"Licenses & Inspections",loading:!y.value.includes("Licenses & Inspections")},{default:Ao(()=>[y.value.includes("Licenses & Inspections")?(Dt(),Qa(C3,{key:0})):Ki("",!0)]),_:1},8,["loading"]),tr(ic,{"topic-name":"Zoning",loading:!y.value.includes("Zoning")},{default:Ao(()=>[y.value.includes("Zoning")?(Dt(),Qa(k3,{key:0})):Ki("",!0)]),_:1},8,["loading"]),tr(ic,{"topic-name":"Voting",loading:!y.value.includes("Voting")},{default:Ao(()=>[y.value.includes("Voting")?(Dt(),Qa(R3,{key:0})):Ki("",!0)]),_:1},8,["loading"]),tr(ic,{"topic-name":"Nearby Activity",loading:!y.value.includes("Nearby Activity")},{default:Ao(()=>[y.value.includes("Nearby Activity")?(Dt(),Qa(zL,{key:0})):Ki("",!0)]),_:1},8,["loading"])])])):Ki("",!0)]))}},XL=pa(WL,[["__scopeId","data-v-8b6a956f"]]);var Yx={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.3/LICENSE.txt
 */(function(e,r){(function(a,u){e.exports=u()})(Zc,function(){var a={},u={};function d(m,l,T){if(u[m]=T,m==="index"){var P="var sharedModule = {}; ("+u.shared+")(sharedModule); ("+u.worker+")(sharedModule);",z={};return u.shared(z),u.index(a,z),typeof window<"u"&&a.setWorkerUrl(window.URL.createObjectURL(new Blob([P],{type:"text/javascript"}))),a}}d("shared",["exports"],function(m){function l(n,t,s,c){return new(s||(s=Promise))(function(p,v){function x(C){try{E(c.next(C))}catch(L){v(L)}}function w(C){try{E(c.throw(C))}catch(L){v(L)}}function E(C){var L;C.done?p(C.value):(L=C.value,L instanceof s?L:new s(function(O){O(L)})).then(x,w)}E((c=c.apply(n,t||[])).next())})}function T(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}typeof SuppressedError=="function"&&SuppressedError;var P=z;function z(n,t){this.x=n,this.y=t}z.prototype={clone:function(){return new z(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,t){return this.clone()._rotateAround(n,t)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var t=n.x-this.x,s=n.y-this.y;return t*t+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,t){return Math.atan2(this.x*t-this.y*n,this.x*n+this.y*t)},_matMult:function(n){var t=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=t,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var t=Math.cos(n),s=Math.sin(n),c=s*this.x+t*this.y;return this.x=t*this.x-s*this.y,this.y=c,this},_rotateAround:function(n,t){var s=Math.cos(n),c=Math.sin(n),p=t.y+c*(this.x-t.x)+s*(this.y-t.y);return this.x=t.x+s*(this.x-t.x)-c*(this.y-t.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},z.convert=function(n){return n instanceof z?n:Array.isArray(n)?new z(n[0],n[1]):n};var k=T(P),R=Z;function Z(n,t,s,c){this.cx=3*n,this.bx=3*(s-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(c-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=t,this.p2x=s,this.p2y=c}Z.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,t){if(t===void 0&&(t=1e-6),n<0)return 0;if(n>1)return 1;for(var s=n,c=0;c<8;c++){var p=this.sampleCurveX(s)-n;if(Math.abs(p)<t)return s;var v=this.sampleCurveDerivativeX(s);if(Math.abs(v)<1e-6)break;s-=p/v}var x=0,w=1;for(s=n,c=0;c<20&&(p=this.sampleCurveX(s),!(Math.abs(p-n)<t));c++)n>p?x=s:w=s,s=.5*(w-x)+x;return s},solve:function(n,t){return this.sampleCurveY(this.solveCurveX(n,t))}};var K=T(R);let Y,ge;function Te(){return Y==null&&(Y=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Y}function Fe(){if(ge==null&&(ge=!1,Te())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let c=0;c<5*5;c++){const p=4*c;t.fillStyle=`rgb(${p},${p+1},${p+2})`,t.fillRect(c%5,Math.floor(c/5),1,1)}const s=t.getImageData(0,0,5,5).data;for(let c=0;c<5*5*4;c++)if(c%4!=3&&s[c]!==c){ge=!0;break}}}return ge||!1}function he(n,t,s,c){const p=new K(n,t,s,c);return function(v){return p.solve(v)}}const Le=he(.25,.1,.25,1);function We(n,t,s){return Math.min(s,Math.max(t,n))}function Qe(n,t,s){const c=s-t,p=((n-t)%c+c)%c+t;return p===t?s:p}function bt(n,...t){for(const s of t)for(const c in s)n[c]=s[c];return n}let He=1;function lt(n,t,s){const c={};for(const p in n)c[p]=t.call(s||this,n[p],p,n);return c}function Rt(n,t,s){const c={};for(const p in n)t.call(s||this,n[p],p,n)&&(c[p]=n[p]);return c}function Pt(n){return Array.isArray(n)?n.map(Pt):typeof n=="object"&&n?lt(n,Pt):n}const oi={};function pi(n){oi[n]||(typeof console<"u"&&console.warn(n),oi[n]=!0)}function Yt(n,t,s){return(s.y-n.y)*(t.x-n.x)>(t.y-n.y)*(s.x-n.x)}function cr(n){let t=0;for(let s,c,p=0,v=n.length,x=v-1;p<v;x=p++)s=n[p],c=n[x],t+=(c.x-s.x)*(s.y+c.y);return t}function si(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let Qt=null;function gi(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const ur="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ar(n,t,s,c,p){return l(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const v=new VideoFrame(n,{timestamp:0});try{const x=v==null?void 0:v.format;if(!x||!x.startsWith("BGR")&&!x.startsWith("RGB"))throw new Error(`Unrecognized format ${x}`);const w=x.startsWith("BGR"),E=new Uint8ClampedArray(c*p*4);if(yield v.copyTo(E,function(C,L,O,$,j){const G=4*Math.max(-L,0),X=(Math.max(0,O)-O)*$*4+G,ie=4*$,ue=Math.max(0,L),Ee=Math.max(0,O);return{rect:{x:ue,y:Ee,width:Math.min(C.width,L+$)-ue,height:Math.min(C.height,O+j)-Ee},layout:[{offset:X,stride:ie}]}}(n,t,s,c,p)),w)for(let C=0;C<E.length;C+=4){const L=E[C];E[C]=E[C+2],E[C+2]=L}return E}finally{v.close()}})}let ut,rt;const et="AbortError";function ir(){return new Error(et)}const ji={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function wi(n){return ji.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const Ve="global-dispatcher";class Et extends Error{constructor(t,s,c,p){super(`AJAXError: ${s} (${t}): ${c}`),this.status=t,this.statusText=s,this.url=c,this.body=p}}const ht=()=>si(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Je=function(n,t){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const c=wi(n.url);if(c)return c(n,t);if(si(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:Ve},t)}if(!(/^file:/.test(s=n.url)||/^file:/.test(ht())&&!/^\w+:/.test(s))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(c,p){return l(this,void 0,void 0,function*(){const v=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,cache:c.cache,referrer:ht(),signal:p.signal});c.type==="json"&&v.headers.set("Accept","application/json");const x=yield fetch(v);if(!x.ok){const C=yield x.blob();throw new Et(x.status,x.statusText,c.url,C)}let w;w=c.type==="arrayBuffer"||c.type==="image"?x.arrayBuffer():c.type==="json"?x.json():x.text();const E=yield w;if(p.signal.aborted)throw ir();return{data:E,cacheControl:x.headers.get("Cache-Control"),expires:x.headers.get("Expires")}})}(n,t);if(si(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:Ve},t)}var s;return function(c,p){return new Promise((v,x)=>{const w=new XMLHttpRequest;w.open(c.method||"GET",c.url,!0),c.type!=="arrayBuffer"&&c.type!=="image"||(w.responseType="arraybuffer");for(const E in c.headers)w.setRequestHeader(E,c.headers[E]);c.type==="json"&&(w.responseType="text",w.setRequestHeader("Accept","application/json")),w.withCredentials=c.credentials==="include",w.onerror=()=>{x(new Error(w.statusText))},w.onload=()=>{if(!p.signal.aborted)if((w.status>=200&&w.status<300||w.status===0)&&w.response!==null){let E=w.response;if(c.type==="json")try{E=JSON.parse(w.response)}catch(C){return void x(C)}v({data:E,cacheControl:w.getResponseHeader("Cache-Control"),expires:w.getResponseHeader("Expires")})}else{const E=new Blob([w.response],{type:w.getResponseHeader("Content-Type")});x(new Et(w.status,w.statusText,c.url,E))}},p.signal.addEventListener("abort",()=>{w.abort(),x(ir())}),w.send(c.body)})}(n,t)};function Pi(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const t=new URL(n),s=window.location;return t.protocol===s.protocol&&t.host===s.host}function Ri(n,t,s){s[n]&&s[n].indexOf(t)!==-1||(s[n]=s[n]||[],s[n].push(t))}function se(n,t,s){if(s&&s[n]){const c=s[n].indexOf(t);c!==-1&&s[n].splice(c,1)}}class ce{constructor(t,s={}){bt(this,s),this.type=t}}class Pe extends ce{constructor(t,s={}){super("error",bt({error:t},s))}}class Oe{on(t,s){return this._listeners=this._listeners||{},Ri(t,s,this._listeners),this}off(t,s){return se(t,s,this._listeners),se(t,s,this._oneTimeListeners),this}once(t,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},Ri(t,s,this._oneTimeListeners),this):new Promise(c=>this.once(t,c))}fire(t,s){typeof t=="string"&&(t=new ce(t,s||{}));const c=t.type;if(this.listens(c)){t.target=this;const p=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const w of p)w.call(this,t);const v=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const w of v)se(c,w,this._oneTimeListeners),w.call(this,t);const x=this._eventedParent;x&&(bt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(t))}else t instanceof Pe&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,s){return this._eventedParent=t,this._eventedParentData=s,this}}var le={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const ft=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ct(n,t){const s={};for(const c in n)c!=="ref"&&(s[c]=n[c]);return ft.forEach(c=>{c in t&&(s[c]=t[c])}),s}function Be(n,t){if(Array.isArray(n)){if(!Array.isArray(t)||n.length!==t.length)return!1;for(let s=0;s<n.length;s++)if(!Be(n[s],t[s]))return!1;return!0}if(typeof n=="object"&&n!==null&&t!==null){if(typeof t!="object"||Object.keys(n).length!==Object.keys(t).length)return!1;for(const s in n)if(!Be(n[s],t[s]))return!1;return!0}return n===t}function nt(n,t){n.push(t)}function it(n,t,s){nt(s,{command:"addSource",args:[n,t[n]]})}function At(n,t,s){nt(t,{command:"removeSource",args:[n]}),s[n]=!0}function Gt(n,t,s,c){At(n,s,c),it(n,t,s)}function jt(n,t,s){let c;for(c in n[s])if(Object.prototype.hasOwnProperty.call(n[s],c)&&c!=="data"&&!Be(n[s][c],t[s][c]))return!1;for(c in t[s])if(Object.prototype.hasOwnProperty.call(t[s],c)&&c!=="data"&&!Be(n[s][c],t[s][c]))return!1;return!0}function Wt(n,t,s,c,p,v){n=n||{},t=t||{};for(const x in n)Object.prototype.hasOwnProperty.call(n,x)&&(Be(n[x],t[x])||s.push({command:v,args:[c,x,t[x],p]}));for(const x in t)Object.prototype.hasOwnProperty.call(t,x)&&!Object.prototype.hasOwnProperty.call(n,x)&&(Be(n[x],t[x])||s.push({command:v,args:[c,x,t[x],p]}))}function mi(n){return n.id}function Si(n,t){return n[t.id]=t,n}class Ue{constructor(t,s,c,p){this.message=(t?`${t}: `:"")+c,p&&(this.identifier=p),s!=null&&s.__line__&&(this.line=s.__line__)}}function Oi(n,...t){for(const s of t)for(const c in s)n[c]=s[c];return n}class Zi extends Error{constructor(t,s){super(s),this.message=s,this.key=t}}class pn{constructor(t,s=[]){this.parent=t,this.bindings={};for(const[c,p]of s)this.bindings[c]=p}concat(t){return new pn(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const wr={kind:"null"},st={kind:"number"},li={kind:"string"},Ft={kind:"boolean"},$i={kind:"color"},mn={kind:"object"},ei={kind:"value"},Js={kind:"collator"},Mr={kind:"formatted"},ee={kind:"padding"},N={kind:"resolvedImage"},U={kind:"variableAnchorOffsetCollection"};function H(n,t){return{kind:"array",itemType:n,N:t}}function J(n){if(n.kind==="array"){const t=J(n.itemType);return typeof n.N=="number"?`array<${t}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${t}>`}return n.kind}const _e=[wr,st,li,Ft,$i,Mr,mn,H(ei),ee,N,U];function ve(n,t){if(t.kind==="error")return null;if(n.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!ve(n.itemType,t.itemType))&&(typeof n.N!="number"||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if(n.kind==="value"){for(const s of _e)if(!ve(s,t))return null}}return`Expected ${J(n)} but found ${J(t)} instead.`}function we(n,t){return t.some(s=>s.kind===n.kind)}function de(n,t){return t.some(s=>s==="null"?n===null:s==="array"?Array.isArray(n):s==="object"?n&&!Array.isArray(n)&&typeof n=="object":s===typeof n)}function Ie(n,t){return n.kind==="array"&&t.kind==="array"?n.itemType.kind===t.itemType.kind&&typeof n.N=="number":n.kind===t.kind}const qe=.96422,Re=.82521,Ne=4/29,Bt=6/29,Vt=3*Bt*Bt,ti=Bt*Bt*Bt,ri=Math.PI/180,_i=180/Math.PI;function Bi(n){return(n%=360)<0&&(n+=360),n}function sr([n,t,s,c]){let p,v;const x=Zt((.2225045*(n=Fr(n))+.7168786*(t=Fr(t))+.0606169*(s=Fr(s)))/1);n===t&&t===s?p=v=x:(p=Zt((.4360747*n+.3850649*t+.1430804*s)/qe),v=Zt((.0139322*n+.0971045*t+.7141733*s)/Re));const w=116*x-16;return[w<0?0:w,500*(p-x),200*(x-v),c]}function Fr(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Zt(n){return n>ti?Math.pow(n,1/3):n/Vt+Ne}function yr([n,t,s,c]){let p=(n+16)/116,v=isNaN(t)?p:p+t/500,x=isNaN(s)?p:p-s/200;return p=1*gn(p),v=qe*gn(v),x=Re*gn(x),[Vr(3.1338561*v-1.6168667*p-.4906146*x),Vr(-.9787684*v+1.9161415*p+.033454*x),Vr(.0719453*v-.2289914*p+1.4052427*x),c]}function Vr(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function gn(n){return n>Bt?n*n*n:Vt*(n-Ne)}function yn(n){return parseInt(n.padEnd(2,n),16)/255}function Zr(n,t){return jn(t?n/100:n,0,1)}function jn(n,t,s){return Math.min(Math.max(t,n),s)}function pc(n){return!n.some(Number.isNaN)}const zo={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Ni{constructor(t,s,c,p=1,v=!0){this.r=t,this.g=s,this.b=c,this.a=p,v||(this.r*=p,this.g*=p,this.b*=p,p||this.overwriteGetter("rgb",[t,s,c,p]))}static parse(t){if(t instanceof Ni)return t;if(typeof t!="string")return;const s=function(c){if((c=c.toLowerCase().trim())==="transparent")return[0,0,0,0];const p=zo[c];if(p){const[x,w,E]=p;return[x/255,w/255,E/255,1]}if(c.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(c)){const x=c.length<6?1:2;let w=1;return[yn(c.slice(w,w+=x)),yn(c.slice(w,w+=x)),yn(c.slice(w,w+=x)),yn(c.slice(w,w+x)||"ff")]}if(c.startsWith("rgb")){const x=c.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[w,E,C,L,O,$,j,G,X,ie,ue,Ee]=x,fe=[L||" ",j||" ",ie].join("");if(fe==="  "||fe==="  /"||fe===",,"||fe===",,,"){const xe=[C,$,X].join(""),$e=xe==="%%%"?100:xe===""?255:0;if($e){const Ge=[jn(+E/$e,0,1),jn(+O/$e,0,1),jn(+G/$e,0,1),ue?Zr(+ue,Ee):1];if(pc(Ge))return Ge}}return}}const v=c.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[x,w,E,C,L,O,$,j,G]=v,X=[E||" ",L||" ",$].join("");if(X==="  "||X==="  /"||X===",,"||X===",,,"){const ie=[+w,jn(+C,0,100),jn(+O,0,100),j?Zr(+j,G):1];if(pc(ie))return function([ue,Ee,fe,xe]){function $e(Ge){const It=(Ge+ue/30)%12,Ot=Ee*Math.min(fe,1-fe);return fe-Ot*Math.max(-1,Math.min(It-3,9-It,1))}return ue=Bi(ue),Ee/=100,fe/=100,[$e(0),$e(8),$e(4),xe]}(ie)}}}(t);return s?new Ni(...s,!1):void 0}get rgb(){const{r:t,g:s,b:c,a:p}=this,v=p||1/0;return this.overwriteGetter("rgb",[t/v,s/v,c/v,p])}get hcl(){return this.overwriteGetter("hcl",function(t){const[s,c,p,v]=sr(t),x=Math.sqrt(c*c+p*p);return[Math.round(1e4*x)?Bi(Math.atan2(p,c)*_i):NaN,x,s,v]}(this.rgb))}get lab(){return this.overwriteGetter("lab",sr(this.rgb))}overwriteGetter(t,s){return Object.defineProperty(this,t,{value:s}),s}toString(){const[t,s,c,p]=this.rgb;return`rgba(${[t,s,c].map(v=>Math.round(255*v)).join(",")},${p})`}}Ni.black=new Ni(0,0,0,1),Ni.white=new Ni(1,1,1,1),Ni.transparent=new Ni(0,0,0,0),Ni.red=new Ni(1,0,0,1);class lo{constructor(t,s,c){this.sensitivity=t?s?"variant":"case":s?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,s){return this.collator.compare(t,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Pr{constructor(t,s,c,p,v){this.text=t,this.image=s,this.scale=c,this.fontStack=p,this.textColor=v}}class An{constructor(t){this.sections=t}static fromString(t){return new An([new Pr(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof An?t:An.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class _n{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof _n)return t;if(typeof t=="number")return new _n([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const s of t)if(typeof s!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new _n(t)}}toString(){return JSON.stringify(this.values)}}const qn=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class kr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof kr)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let s=0;s<t.length;s+=2){const c=t[s],p=t[s+1];if(typeof c!="string"||!qn.has(c)||!Array.isArray(p)||p.length!==2||typeof p[0]!="number"||typeof p[1]!="number")return}return new kr(t)}}toString(){return JSON.stringify(this.values)}}class vn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new vn({name:t,available:!1}):null}}function Gn(n,t,s,c){return typeof n=="number"&&n>=0&&n<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof s=="number"&&s>=0&&s<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[n,t,s,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[n,t,s,c]:[n,t,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function gs(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Ni||n instanceof lo||n instanceof An||n instanceof _n||n instanceof kr||n instanceof vn)return!0;if(Array.isArray(n)){for(const t of n)if(!gs(t))return!1;return!0}if(typeof n=="object"){for(const t in n)if(!gs(n[t]))return!1;return!0}return!1}function Dr(n){if(n===null)return wr;if(typeof n=="string")return li;if(typeof n=="boolean")return Ft;if(typeof n=="number")return st;if(n instanceof Ni)return $i;if(n instanceof lo)return Js;if(n instanceof An)return Mr;if(n instanceof _n)return ee;if(n instanceof kr)return U;if(n instanceof vn)return N;if(Array.isArray(n)){const t=n.length;let s;for(const c of n){const p=Dr(c);if(s){if(s===p)continue;s=ei;break}s=p}return H(s||ei,t)}return mn}function co(n){const t=typeof n;return n===null?"":t==="string"||t==="number"||t==="boolean"?String(n):n instanceof Ni||n instanceof An||n instanceof _n||n instanceof kr||n instanceof vn?n.toString():JSON.stringify(n)}class Qs{constructor(t,s){this.type=t,this.value=s}static parse(t,s){if(t.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!gs(t[1]))return s.error("invalid value");const c=t[1];let p=Dr(c);const v=s.expectedType;return p.kind!=="array"||p.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(p=v),new Qs(p,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class hr{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const uo={string:li,number:st,boolean:Ft,object:mn};class xn{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");let c,p=1;const v=t[0];if(v==="array"){let w,E;if(t.length>2){const C=t[1];if(typeof C!="string"||!(C in uo)||C==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);w=uo[C],p++}else w=ei;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return s.error('The length argument to "array" must be a positive integer literal',2);E=t[2],p++}c=H(w,E)}else{if(!uo[v])throw new Error(`Types doesn't contain name = ${v}`);c=uo[v]}const x=[];for(;p<t.length;p++){const w=s.parse(t[p],p,ei);if(!w)return null;x.push(w)}return new xn(c,x)}evaluate(t){for(let s=0;s<this.args.length;s++){const c=this.args[s].evaluate(t);if(!ve(this.type,Dr(c)))return c;if(s===this.args.length-1)throw new hr(`Expected value to be of type ${J(this.type)}, but found ${J(Dr(c))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const ho={"to-boolean":Ft,"to-color":$i,"to-number":st,"to-string":li};class is{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const c=t[0];if(!ho[c])throw new Error(`Can't parse ${c} as it is not part of the known types`);if((c==="to-boolean"||c==="to-string")&&t.length!==2)return s.error("Expected one argument.");const p=ho[c],v=[];for(let x=1;x<t.length;x++){const w=s.parse(t[x],x,ei);if(!w)return null;v.push(w)}return new is(p,v)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let s,c;for(const p of this.args){if(s=p.evaluate(t),c=null,s instanceof Ni)return s;if(typeof s=="string"){const v=t.parseColor(s);if(v)return v}else if(Array.isArray(s)&&(c=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Gn(s[0],s[1],s[2],s[3]),!c))return new Ni(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new hr(c||`Could not parse color from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"padding":{let s;for(const c of this.args){s=c.evaluate(t);const p=_n.parse(s);if(p)return p}throw new hr(`Could not parse padding from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"variableAnchorOffsetCollection":{let s;for(const c of this.args){s=c.evaluate(t);const p=kr.parse(s);if(p)return p}throw new hr(`Could not parse variableAnchorOffsetCollection from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"number":{let s=null;for(const c of this.args){if(s=c.evaluate(t),s===null)return 0;const p=Number(s);if(!isNaN(p))return p}throw new hr(`Could not convert ${JSON.stringify(s)} to number.`)}case"formatted":return An.fromString(co(this.args[0].evaluate(t)));case"resolvedImage":return vn.fromString(co(this.args[0].evaluate(t)));default:return co(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const fo=["Unknown","Point","LineString","Polygon"];class Ui{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?fo[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let s=this._parseColorCache[t];return s||(s=this._parseColorCache[t]=Ni.parse(t)),s}}class Oo{constructor(t,s,c=[],p,v=new pn,x=[]){this.registry=t,this.path=c,this.key=c.map(w=>`[${w}]`).join(""),this.scope=v,this.errors=x,this.expectedType=p,this._isConstant=s}parse(t,s,c,p,v={}){return s?this.concat(s,c,p)._parse(t,v):this._parse(t,v)}_parse(t,s){function c(p,v,x){return x==="assert"?new xn(v,[p]):x==="coerce"?new is(v,[p]):p}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=t[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[p];if(v){let x=v.parse(t,this);if(!x)return null;if(this.expectedType){const w=this.expectedType,E=x.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||E.kind!=="value")if(w.kind!=="color"&&w.kind!=="formatted"&&w.kind!=="resolvedImage"||E.kind!=="value"&&E.kind!=="string")if(w.kind!=="padding"||E.kind!=="value"&&E.kind!=="number"&&E.kind!=="array")if(w.kind!=="variableAnchorOffsetCollection"||E.kind!=="value"&&E.kind!=="array"){if(this.checkSubtype(w,E))return null}else x=c(x,w,s.typeAnnotation||"coerce");else x=c(x,w,s.typeAnnotation||"coerce");else x=c(x,w,s.typeAnnotation||"coerce");else x=c(x,w,s.typeAnnotation||"assert")}if(!(x instanceof Qs)&&x.type.kind!=="resolvedImage"&&this._isConstant(x)){const w=new Ui;try{x=new Qs(x.type,x.evaluate(w))}catch(E){return this.error(E.message),null}}return x}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,s,c){const p=typeof t=="number"?this.path.concat(t):this.path,v=c?this.scope.concat(c):this.scope;return new Oo(this.registry,this._isConstant,p,s||null,v,this.errors)}error(t,...s){const c=`${this.key}${s.map(p=>`[${p}]`).join("")}`;this.errors.push(new Zi(c,t))}checkSubtype(t,s){const c=ve(t,s);return c&&this.error(c),c}}class Os{constructor(t,s,c){this.type=Js,this.locale=c,this.caseSensitive=t,this.diacriticSensitive=s}static parse(t,s){if(t.length!==2)return s.error("Expected one argument.");const c=t[1];if(typeof c!="object"||Array.isArray(c))return s.error("Collator options argument must be an object.");const p=s.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,Ft);if(!p)return null;const v=s.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,Ft);if(!v)return null;let x=null;return c.locale&&(x=s.parse(c.locale,1,li),!x)?null:new Os(p,v,x)}evaluate(t){return new lo(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}const b=8192;function A(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function V(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function ae(n,t){const s=(180+n[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,p=Math.pow(2,t.z);return[Math.round(s*p*b),Math.round(c*p*b)]}function me(n,t,s){const c=n[0]-t[0],p=n[1]-t[1],v=n[0]-s[0],x=n[1]-s[1];return c*x-v*p==0&&c*v<=0&&p*x<=0}function ye(n,t){let s=!1;for(let x=0,w=t.length;x<w;x++){const E=t[x];for(let C=0,L=E.length;C<L-1;C++){if(me(n,E[C],E[C+1]))return!1;(p=E[C])[1]>(c=n)[1]!=(v=E[C+1])[1]>c[1]&&c[0]<(v[0]-p[0])*(c[1]-p[1])/(v[1]-p[1])+p[0]&&(s=!s)}}var c,p,v;return s}function Me(n,t){for(let s=0;s<t.length;s++)if(ye(n,t[s]))return!0;return!1}function Ye(n,t,s,c){const p=c[0]-s[0],v=c[1]-s[1],x=(n[0]-s[0])*v-p*(n[1]-s[1]),w=(t[0]-s[0])*v-p*(t[1]-s[1]);return x>0&&w<0||x<0&&w>0}function ot(n,t,s){for(const C of s)for(let L=0;L<C.length-1;++L)if((w=[(x=C[L+1])[0]-(v=C[L])[0],x[1]-v[1]])[0]*(E=[(p=t)[0]-(c=n)[0],p[1]-c[1]])[1]-w[1]*E[0]!=0&&Ye(c,p,v,x)&&Ye(v,x,c,p))return!0;var c,p,v,x,w,E;return!1}function wt(n,t){for(let s=0;s<n.length;++s)if(!ye(n[s],t))return!1;for(let s=0;s<n.length-1;++s)if(ot(n[s],n[s+1],t))return!1;return!0}function Mt(n,t){for(let s=0;s<t.length;s++)if(wt(n,t[s]))return!0;return!1}function pt(n,t,s){const c=[];for(let p=0;p<n.length;p++){const v=[];for(let x=0;x<n[p].length;x++){const w=ae(n[p][x],s);A(t,w),v.push(w)}c.push(v)}return c}function ai(n,t,s){const c=[];for(let p=0;p<n.length;p++){const v=pt(n[p],t,s);c.push(v)}return c}function dr(n,t,s,c){if(n[0]<s[0]||n[0]>s[2]){const p=.5*c;let v=n[0]-s[0]>p?-c:s[0]-n[0]>p?c:0;v===0&&(v=n[0]-s[2]>p?-c:s[2]-n[0]>p?c:0),n[0]+=v}A(t,n)}function ci(n,t,s,c){const p=Math.pow(2,c.z)*b,v=[c.x*b,c.y*b],x=[];for(const w of n)for(const E of w){const C=[E.x+v[0],E.y+v[1]];dr(C,t,s,p),x.push(C)}return x}function Lr(n,t,s,c){const p=Math.pow(2,c.z)*b,v=[c.x*b,c.y*b],x=[];for(const E of n){const C=[];for(const L of E){const O=[L.x+v[0],L.y+v[1]];A(t,O),C.push(O)}x.push(C)}if(t[2]-t[0]<=p/2){(w=t)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const E of x)for(const C of E)dr(C,t,s,p)}var w;return x}class je{constructor(t,s){this.type=Ft,this.geojson=t,this.geometries=s}static parse(t,s){if(t.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(gs(t[1])){const c=t[1];if(c.type==="FeatureCollection"){const p=[];for(const v of c.features){const{type:x,coordinates:w}=v.geometry;x==="Polygon"&&p.push(w),x==="MultiPolygon"&&p.push(...w)}if(p.length)return new je(c,{type:"MultiPolygon",coordinates:p})}else if(c.type==="Feature"){const p=c.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new je(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new je(c,c)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(s,c){const p=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=s.canonicalID();if(c.type==="Polygon"){const w=pt(c.coordinates,v,x),E=ci(s.geometry(),p,v,x);if(!V(p,v))return!1;for(const C of E)if(!ye(C,w))return!1}if(c.type==="MultiPolygon"){const w=ai(c.coordinates,v,x),E=ci(s.geometry(),p,v,x);if(!V(p,v))return!1;for(const C of E)if(!Me(C,w))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(s,c){const p=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=s.canonicalID();if(c.type==="Polygon"){const w=pt(c.coordinates,v,x),E=Lr(s.geometry(),p,v,x);if(!V(p,v))return!1;for(const C of E)if(!wt(C,w))return!1}if(c.type==="MultiPolygon"){const w=ai(c.coordinates,v,x),E=Lr(s.geometry(),p,v,x);if(!V(p,v))return!1;for(const C of E)if(!Mt(C,w))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class zt{constructor(t,s){this.type=s.type,this.name=t,this.boundExpression=s}static parse(t,s){if(t.length!==2||typeof t[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const c=t[1];return s.scope.has(c)?new zt(c,s.scope.get(c)):s.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class vi{constructor(t,s,c,p){this.name=t,this.type=s,this._evaluate=c,this.args=p}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,s){const c=t[0],p=vi.definitions[c];if(!p)return s.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(p)?p[0]:p.type,x=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,w=x.filter(([C])=>!Array.isArray(C)||C.length===t.length-1);let E=null;for(const[C,L]of w){E=new Oo(s.registry,Sr,s.path,null,s.scope);const O=[];let $=!1;for(let j=1;j<t.length;j++){const G=t[j],X=Array.isArray(C)?C[j-1]:C.type,ie=E.parse(G,1+O.length,X);if(!ie){$=!0;break}O.push(ie)}if(!$)if(Array.isArray(C)&&C.length!==O.length)E.error(`Expected ${C.length} arguments, but found ${O.length} instead.`);else{for(let j=0;j<O.length;j++){const G=Array.isArray(C)?C[j]:C.type,X=O[j];E.concat(j+1).checkSubtype(G,X.type)}if(E.errors.length===0)return new vi(c,v,L,O)}}if(w.length===1)s.errors.push(...E.errors);else{const C=(w.length?w:x).map(([O])=>{return $=O,Array.isArray($)?`(${$.map(J).join(", ")})`:`(${J($.type)}...)`;var $}).join(" | "),L=[];for(let O=1;O<t.length;O++){const $=s.parse(t[O],1+L.length);if(!$)return null;L.push(J($.type))}s.error(`Expected arguments of type ${C}, but found (${L.join(", ")}) instead.`)}return null}static register(t,s){vi.definitions=s;for(const c in s)t[c]=vi}}function Sr(n){if(n instanceof zt)return Sr(n.boundExpression);if(n instanceof vi&&n.name==="error"||n instanceof Os||n instanceof je)return!1;const t=n instanceof is||n instanceof xn;let s=!0;return n.eachChild(c=>{s=t?s&&Sr(c):s&&c instanceof Qs}),!!s&&_r(n)&&po(n,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function _r(n){if(n instanceof vi&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof je)return!1;let t=!0;return n.eachChild(s=>{t&&!_r(s)&&(t=!1)}),t}function ma(n){if(n instanceof vi&&n.name==="feature-state")return!1;let t=!0;return n.eachChild(s=>{t&&!ma(s)&&(t=!1)}),t}function po(n,t){if(n instanceof vi&&t.indexOf(n.name)>=0)return!1;let s=!0;return n.eachChild(c=>{s&&!po(c,t)&&(s=!1)}),s}function qi(n,t){const s=n.length-1;let c,p,v=0,x=s,w=0;for(;v<=x;)if(w=Math.floor((v+x)/2),c=n[w],p=n[w+1],c<=t){if(w===s||t<p)return w;v=w+1}else{if(!(c>t))throw new hr("Input is not a number.");x=w-1}return 0}class Ba{constructor(t,s,c){this.type=t,this.input=s,this.labels=[],this.outputs=[];for(const[p,v]of c)this.labels.push(p),this.outputs.push(v)}static parse(t,s){if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");const c=s.parse(t[1],1,st);if(!c)return null;const p=[];let v=null;s.expectedType&&s.expectedType.kind!=="value"&&(v=s.expectedType);for(let x=1;x<t.length;x+=2){const w=x===1?-1/0:t[x],E=t[x+1],C=x,L=x+1;if(typeof w!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(p.length&&p[p.length-1][0]>=w)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);const O=s.parse(E,L,v);if(!O)return null;v=v||O.type,p.push([w,O])}return new Ba(v,c,p)}evaluate(t){const s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(t);const p=this.input.evaluate(t);if(p<=s[0])return c[0].evaluate(t);const v=s.length;return p>=s[v-1]?c[v-1].evaluate(t):c[qi(s,p)].evaluate(t)}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function _u(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Fs=Cl;function Cl(n,t,s,c){this.cx=3*n,this.bx=3*(s-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(c-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=t,this.p2x=s,this.p2y=c}Cl.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,t){if(t===void 0&&(t=1e-6),n<0)return 0;if(n>1)return 1;for(var s=n,c=0;c<8;c++){var p=this.sampleCurveX(s)-n;if(Math.abs(p)<t)return s;var v=this.sampleCurveDerivativeX(s);if(Math.abs(v)<1e-6)break;s-=p/v}var x=0,w=1;for(s=n,c=0;c<20&&(p=this.sampleCurveX(s),!(Math.abs(p-n)<t));c++)n>p?x=s:w=s,s=.5*(w-x)+x;return s},solve:function(n,t){return this.sampleCurveY(this.solveCurveX(n,t))}};var mc=_u(Fs);function ea(n,t,s){return n+s*(t-n)}function Na(n,t,s){return n.map((c,p)=>ea(c,t[p],s))}const dn={number:ea,color:function(n,t,s,c="rgb"){switch(c){case"rgb":{const[p,v,x,w]=Na(n.rgb,t.rgb,s);return new Ni(p,v,x,w,!1)}case"hcl":{const[p,v,x,w]=n.hcl,[E,C,L,O]=t.hcl;let $,j;if(isNaN(p)||isNaN(E))isNaN(p)?isNaN(E)?$=NaN:($=E,x!==1&&x!==0||(j=C)):($=p,L!==1&&L!==0||(j=v));else{let Ee=E-p;E>p&&Ee>180?Ee-=360:E<p&&p-E>180&&(Ee+=360),$=p+s*Ee}const[G,X,ie,ue]=function([Ee,fe,xe,$e]){return Ee=isNaN(Ee)?0:Ee*ri,yr([xe,Math.cos(Ee)*fe,Math.sin(Ee)*fe,$e])}([$,j??ea(v,C,s),ea(x,L,s),ea(w,O,s)]);return new Ni(G,X,ie,ue,!1)}case"lab":{const[p,v,x,w]=yr(Na(n.lab,t.lab,s));return new Ni(p,v,x,w,!1)}}},array:Na,padding:function(n,t,s){return new _n(Na(n.values,t.values,s))},variableAnchorOffsetCollection:function(n,t,s){const c=n.values,p=t.values;if(c.length!==p.length)throw new hr(`Cannot interpolate values of different length. from: ${n.toString()}, to: ${t.toString()}`);const v=[];for(let x=0;x<c.length;x+=2){if(c[x]!==p[x])throw new hr(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${c[x]}, to[${x}]: ${p[x]}`);v.push(c[x]);const[w,E]=c[x+1],[C,L]=p[x+1];v.push([ea(w,C,s),ea(E,L,s)])}return new kr(v)}};class Jr{constructor(t,s,c,p,v){this.type=t,this.operator=s,this.interpolation=c,this.input=p,this.labels=[],this.outputs=[];for(const[x,w]of v)this.labels.push(x),this.outputs.push(w)}static interpolationFactor(t,s,c,p){let v=0;if(t.name==="exponential")v=zi(s,t.base,c,p);else if(t.name==="linear")v=zi(s,1,c,p);else if(t.name==="cubic-bezier"){const x=t.controlPoints;v=new mc(x[0],x[1],x[2],x[3]).solve(zi(s,1,c,p))}return v}static parse(t,s){let[c,p,v,...x]=t;if(!Array.isArray(p)||p.length===0)return s.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const C=p[1];if(typeof C!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:C}}else{if(p[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const C=p.slice(1);if(C.length!==4||C.some(L=>typeof L!="number"||L<0||L>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:C}}}if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(v=s.parse(v,2,st),!v)return null;const w=[];let E=null;c==="interpolate-hcl"||c==="interpolate-lab"?E=$i:s.expectedType&&s.expectedType.kind!=="value"&&(E=s.expectedType);for(let C=0;C<x.length;C+=2){const L=x[C],O=x[C+1],$=C+3,j=C+4;if(typeof L!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',$);if(w.length&&w[w.length-1][0]>=L)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',$);const G=s.parse(O,j,E);if(!G)return null;E=E||G.type,w.push([L,G])}return Ie(E,st)||Ie(E,$i)||Ie(E,ee)||Ie(E,U)||Ie(E,H(st))?new Jr(E,c,p,v,w):s.error(`Type ${J(E)} is not interpolatable.`)}evaluate(t){const s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(t);const p=this.input.evaluate(t);if(p<=s[0])return c[0].evaluate(t);const v=s.length;if(p>=s[v-1])return c[v-1].evaluate(t);const x=qi(s,p),w=Jr.interpolationFactor(this.interpolation,p,s[x],s[x+1]),E=c[x].evaluate(t),C=c[x+1].evaluate(t);switch(this.operator){case"interpolate":return dn[this.type.kind](E,C,w);case"interpolate-hcl":return dn.color(E,C,w,"hcl");case"interpolate-lab":return dn.color(E,C,w,"lab")}}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function zi(n,t,s,c){const p=c-s,v=n-s;return p===0?0:t===1?v/p:(Math.pow(t,v)-1)/(Math.pow(t,p)-1)}class Fo{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expectected at least one argument.");let c=null;const p=s.expectedType;p&&p.kind!=="value"&&(c=p);const v=[];for(const w of t.slice(1)){const E=s.parse(w,1+v.length,c,void 0,{typeAnnotation:"omit"});if(!E)return null;c=c||E.type,v.push(E)}if(!c)throw new Error("No output type");const x=p&&v.some(w=>ve(p,w.type));return new Fo(x?ei:c,v)}evaluate(t){let s,c=null,p=0;for(const v of this.args)if(p++,c=v.evaluate(t),c&&c instanceof vn&&!c.available&&(s||(s=c.name),c=null,p===this.args.length&&(c=s)),c!==null)break;return c}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}class Bo{constructor(t,s){this.type=s.type,this.bindings=[].concat(t),this.result=s}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const s of this.bindings)t(s[1]);t(this.result)}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const c=[];for(let v=1;v<t.length-1;v+=2){const x=t[v];if(typeof x!="string")return s.error(`Expected string, but found ${typeof x} instead.`,v);if(/[^a-zA-Z0-9_]/.test(x))return s.error("Variable names must contain only alphanumeric characters or '_'.",v);const w=s.parse(t[v+1],v+1);if(!w)return null;c.push([x,w])}const p=s.parse(t[t.length-1],t.length-1,s.expectedType,c);return p?new Bo(c,p):null}outputDefined(){return this.result.outputDefined()}}class No{constructor(t,s,c){this.type=t,this.index=s,this.input=c}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,st),p=s.parse(t[2],2,H(s.expectedType||ei));return c&&p?new No(p.type.itemType,c,p):null}evaluate(t){const s=this.index.evaluate(t),c=this.input.evaluate(t);if(s<0)throw new hr(`Array index out of bounds: ${s} < 0.`);if(s>=c.length)throw new hr(`Array index out of bounds: ${s} > ${c.length-1}.`);if(s!==Math.floor(s))throw new hr(`Array index must be an integer, but found ${s} instead.`);return c[s]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class $o{constructor(t,s){this.type=Ft,this.needle=t,this.haystack=s}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,ei),p=s.parse(t[2],2,ei);return c&&p?we(c.type,[Ft,li,st,wr,ei])?new $o(c,p):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${J(c.type)} instead`):null}evaluate(t){const s=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(!c)return!1;if(!de(s,["boolean","string","number","null"]))throw new hr(`Expected first argument to be of type boolean, string, number or null, but found ${J(Dr(s))} instead.`);if(!de(c,["string","array"]))throw new hr(`Expected second argument to be of type array or string, but found ${J(Dr(c))} instead.`);return c.indexOf(s)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class mo{constructor(t,s,c){this.type=st,this.needle=t,this.haystack=s,this.fromIndex=c}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,ei),p=s.parse(t[2],2,ei);if(!c||!p)return null;if(!we(c.type,[Ft,li,st,wr,ei]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${J(c.type)} instead`);if(t.length===4){const v=s.parse(t[3],3,st);return v?new mo(c,p,v):null}return new mo(c,p)}evaluate(t){const s=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(!de(s,["boolean","string","number","null"]))throw new hr(`Expected first argument to be of type boolean, string, number or null, but found ${J(Dr(s))} instead.`);if(!de(c,["string","array"]))throw new hr(`Expected second argument to be of type array or string, but found ${J(Dr(c))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(t);return c.indexOf(s,p)}return c.indexOf(s)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Al{constructor(t,s,c,p,v,x){this.inputType=t,this.type=s,this.input=c,this.cases=p,this.outputs=v,this.otherwise=x}static parse(t,s){if(t.length<5)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return s.error("Expected an even number of arguments.");let c,p;s.expectedType&&s.expectedType.kind!=="value"&&(p=s.expectedType);const v={},x=[];for(let C=2;C<t.length-1;C+=2){let L=t[C];const O=t[C+1];Array.isArray(L)||(L=[L]);const $=s.concat(C);if(L.length===0)return $.error("Expected at least one branch label.");for(const G of L){if(typeof G!="number"&&typeof G!="string")return $.error("Branch labels must be numbers or strings.");if(typeof G=="number"&&Math.abs(G)>Number.MAX_SAFE_INTEGER)return $.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof G=="number"&&Math.floor(G)!==G)return $.error("Numeric branch labels must be integer values.");if(c){if($.checkSubtype(c,Dr(G)))return null}else c=Dr(G);if(v[String(G)]!==void 0)return $.error("Branch labels must be unique.");v[String(G)]=x.length}const j=s.parse(O,C,p);if(!j)return null;p=p||j.type,x.push(j)}const w=s.parse(t[1],1,ei);if(!w)return null;const E=s.parse(t[t.length-1],t.length-1,p);return E?w.type.kind!=="value"&&s.concat(1).checkSubtype(c,w.type)?null:new Al(c,p,w,v,x,E):null}evaluate(t){const s=this.input.evaluate(t);return(Dr(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Pl{constructor(t,s,c){this.type=t,this.branches=s,this.otherwise=c}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return s.error("Expected an odd number of arguments.");let c;s.expectedType&&s.expectedType.kind!=="value"&&(c=s.expectedType);const p=[];for(let x=1;x<t.length-1;x+=2){const w=s.parse(t[x],x,Ft);if(!w)return null;const E=s.parse(t[x+1],x+1,c);if(!E)return null;p.push([w,E]),c=c||E.type}const v=s.parse(t[t.length-1],t.length-1,c);if(!v)return null;if(!c)throw new Error("Can't infer output type");return new Pl(c,p,v)}evaluate(t){for(const[s,c]of this.branches)if(s.evaluate(t))return c.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[s,c]of this.branches)t(s),t(c);t(this.otherwise)}outputDefined(){return this.branches.every(([t,s])=>s.outputDefined())&&this.otherwise.outputDefined()}}class ga{constructor(t,s,c,p){this.type=t,this.input=s,this.beginIndex=c,this.endIndex=p}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,ei),p=s.parse(t[2],2,st);if(!c||!p)return null;if(!we(c.type,[H(ei),li,ei]))return s.error(`Expected first argument to be of type array or string, but found ${J(c.type)} instead`);if(t.length===4){const v=s.parse(t[3],3,st);return v?new ga(c.type,c,p,v):null}return new ga(c.type,c,p)}evaluate(t){const s=this.input.evaluate(t),c=this.beginIndex.evaluate(t);if(!de(s,["string","array"]))throw new hr(`Expected first argument to be of type array or string, but found ${J(Dr(s))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(t);return s.slice(c,p)}return s.slice(c)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Uo(n,t){return n==="=="||n==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function kl(n,t,s,c){return c.compare(t,s)===0}function bn(n,t,s){const c=n!=="=="&&n!=="!=";return class Jx{constructor(v,x,w){this.type=Ft,this.lhs=v,this.rhs=x,this.collator=w,this.hasUntypedArgument=v.type.kind==="value"||x.type.kind==="value"}static parse(v,x){if(v.length!==3&&v.length!==4)return x.error("Expected two or three arguments.");const w=v[0];let E=x.parse(v[1],1,ei);if(!E)return null;if(!Uo(w,E.type))return x.concat(1).error(`"${w}" comparisons are not supported for type '${J(E.type)}'.`);let C=x.parse(v[2],2,ei);if(!C)return null;if(!Uo(w,C.type))return x.concat(2).error(`"${w}" comparisons are not supported for type '${J(C.type)}'.`);if(E.type.kind!==C.type.kind&&E.type.kind!=="value"&&C.type.kind!=="value")return x.error(`Cannot compare types '${J(E.type)}' and '${J(C.type)}'.`);c&&(E.type.kind==="value"&&C.type.kind!=="value"?E=new xn(C.type,[E]):E.type.kind!=="value"&&C.type.kind==="value"&&(C=new xn(E.type,[C])));let L=null;if(v.length===4){if(E.type.kind!=="string"&&C.type.kind!=="string"&&E.type.kind!=="value"&&C.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(L=x.parse(v[3],3,Js),!L)return null}return new Jx(E,C,L)}evaluate(v){const x=this.lhs.evaluate(v),w=this.rhs.evaluate(v);if(c&&this.hasUntypedArgument){const E=Dr(x),C=Dr(w);if(E.kind!==C.kind||E.kind!=="string"&&E.kind!=="number")throw new hr(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${E.kind}, ${C.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const E=Dr(x),C=Dr(w);if(E.kind!=="string"||C.kind!=="string")return t(v,x,w)}return this.collator?s(v,x,w,this.collator.evaluate(v)):t(v,x,w)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}}}const gc=bn("==",function(n,t,s){return t===s},kl),yc=bn("!=",function(n,t,s){return t!==s},function(n,t,s,c){return!kl(0,t,s,c)}),vu=bn("<",function(n,t,s){return t<s},function(n,t,s,c){return c.compare(t,s)<0}),_c=bn(">",function(n,t,s){return t>s},function(n,t,s,c){return c.compare(t,s)>0}),Vo=bn("<=",function(n,t,s){return t<=s},function(n,t,s,c){return c.compare(t,s)<=0}),vc=bn(">=",function(n,t,s){return t>=s},function(n,t,s,c){return c.compare(t,s)>=0});class jo{constructor(t,s,c,p,v){this.type=li,this.number=t,this.locale=s,this.currency=c,this.minFractionDigits=p,this.maxFractionDigits=v}static parse(t,s){if(t.length!==3)return s.error("Expected two arguments.");const c=s.parse(t[1],1,st);if(!c)return null;const p=t[2];if(typeof p!="object"||Array.isArray(p))return s.error("NumberFormat options argument must be an object.");let v=null;if(p.locale&&(v=s.parse(p.locale,1,li),!v))return null;let x=null;if(p.currency&&(x=s.parse(p.currency,1,li),!x))return null;let w=null;if(p["min-fraction-digits"]&&(w=s.parse(p["min-fraction-digits"],1,st),!w))return null;let E=null;return p["max-fraction-digits"]&&(E=s.parse(p["max-fraction-digits"],1,st),!E)?null:new jo(c,v,x,w,E)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class qo{constructor(t){this.type=Mr,this.sections=t}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const c=t[1];if(!Array.isArray(c)&&typeof c=="object")return s.error("First argument must be an image or text section.");const p=[];let v=!1;for(let x=1;x<=t.length-1;++x){const w=t[x];if(v&&typeof w=="object"&&!Array.isArray(w)){v=!1;let E=null;if(w["font-scale"]&&(E=s.parse(w["font-scale"],1,st),!E))return null;let C=null;if(w["text-font"]&&(C=s.parse(w["text-font"],1,H(li)),!C))return null;let L=null;if(w["text-color"]&&(L=s.parse(w["text-color"],1,$i),!L))return null;const O=p[p.length-1];O.scale=E,O.font=C,O.textColor=L}else{const E=s.parse(t[x],1,ei);if(!E)return null;const C=E.type.kind;if(C!=="string"&&C!=="value"&&C!=="null"&&C!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,p.push({content:E,scale:null,font:null,textColor:null})}}return new qo(p)}evaluate(t){return new An(this.sections.map(s=>{const c=s.content.evaluate(t);return Dr(c)===N?new Pr("",c,null,null,null):new Pr(co(c),null,s.scale?s.scale.evaluate(t):null,s.font?s.font.evaluate(t).join(","):null,s.textColor?s.textColor.evaluate(t):null)}))}eachChild(t){for(const s of this.sections)t(s.content),s.scale&&t(s.scale),s.font&&t(s.font),s.textColor&&t(s.textColor)}outputDefined(){return!1}}class Bs{constructor(t){this.type=N,this.input=t}static parse(t,s){if(t.length!==2)return s.error("Expected two arguments.");const c=s.parse(t[1],1,li);return c?new Bs(c):s.error("No image name provided.")}evaluate(t){const s=this.input.evaluate(t),c=vn.fromString(s);return c&&t.availableImages&&(c.available=t.availableImages.indexOf(s)>-1),c}eachChild(t){t(this.input)}outputDefined(){return!1}}class Go{constructor(t){this.type=st,this.input=t}static parse(t,s){if(t.length!==2)return s.error(`Expected 1 argument, but found ${t.length-1} instead.`);const c=s.parse(t[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${J(c.type)} instead.`):new Go(c):null}evaluate(t){const s=this.input.evaluate(t);if(typeof s=="string"||Array.isArray(s))return s.length;throw new hr(`Expected value to be of type string or array, but found ${J(Dr(s))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const $a={"==":gc,"!=":yc,">":_c,"<":vu,">=":vc,"<=":Vo,array:xn,at:No,boolean:xn,case:Pl,coalesce:Fo,collator:Os,format:qo,image:Bs,in:$o,"index-of":mo,interpolate:Jr,"interpolate-hcl":Jr,"interpolate-lab":Jr,length:Go,let:Bo,literal:Qs,match:Al,number:xn,"number-format":jo,object:xn,slice:ga,step:Ba,string:xn,"to-boolean":is,"to-color":is,"to-number":is,"to-string":is,var:zt,within:je};function xc(n,[t,s,c,p]){t=t.evaluate(n),s=s.evaluate(n),c=c.evaluate(n);const v=p?p.evaluate(n):1,x=Gn(t,s,c,v);if(x)throw new hr(x);return new Ni(t/255,s/255,c/255,v,!1)}function Ho(n,t){return n in t}function ya(n,t){const s=t[n];return s===void 0?null:s}function Ns(n){return{type:n}}function Zo(n){return{result:"success",value:n}}function ta(n){return{result:"error",value:n}}function ys(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function bc(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Dl(n){return!!n.expression&&n.expression.interpolated}function ki(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function Wo(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function xu(n){return n}function Ll(n,t){const s=t.type==="color",c=n.stops&&typeof n.stops[0][0]=="object",p=c||!(c||n.property!==void 0),v=n.type||(Dl(t)?"exponential":"interval");if(s||t.type==="padding"){const L=s?Ni.parse:_n.parse;(n=Oi({},n)).stops&&(n.stops=n.stops.map(O=>[O[0],L(O[1])])),n.default=L(n.default?n.default:t.default)}if(n.colorSpace&&(x=n.colorSpace)!=="rgb"&&x!=="hcl"&&x!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var x;let w,E,C;if(v==="exponential")w=di;else if(v==="interval")w=$s;else if(v==="categorical"){w=Yi,E=Object.create(null);for(const L of n.stops)E[L[0]]=L[1];C=typeof n.stops[0][0]}else{if(v!=="identity")throw new Error(`Unknown function type "${v}"`);w=Ua}if(c){const L={},O=[];for(let G=0;G<n.stops.length;G++){const X=n.stops[G],ie=X[0].zoom;L[ie]===void 0&&(L[ie]={zoom:ie,type:n.type,property:n.property,default:n.default,stops:[]},O.push(ie)),L[ie].stops.push([X[0].value,X[1]])}const $=[];for(const G of O)$.push([L[G].zoom,Ll(L[G],t)]);const j={name:"linear"};return{kind:"composite",interpolationType:j,interpolationFactor:Jr.interpolationFactor.bind(void 0,j),zoomStops:$.map(G=>G[0]),evaluate:({zoom:G},X)=>di({stops:$,base:n.base},t,G).evaluate(G,X)}}if(p){const L=v==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:L,interpolationFactor:Jr.interpolationFactor.bind(void 0,L),zoomStops:n.stops.map(O=>O[0]),evaluate:({zoom:O})=>w(n,t,O,E,C)}}return{kind:"source",evaluate(L,O){const $=O&&O.properties?O.properties[n.property]:void 0;return $===void 0?_a(n.default,t.default):w(n,t,$,E,C)}}}function _a(n,t,s){return n!==void 0?n:t!==void 0?t:s!==void 0?s:void 0}function Yi(n,t,s,c,p){return _a(typeof s===p?c[s]:void 0,n.default,t.default)}function $s(n,t,s){if(ki(s)!=="number")return _a(n.default,t.default);const c=n.stops.length;if(c===1||s<=n.stops[0][0])return n.stops[0][1];if(s>=n.stops[c-1][0])return n.stops[c-1][1];const p=qi(n.stops.map(v=>v[0]),s);return n.stops[p][1]}function di(n,t,s){const c=n.base!==void 0?n.base:1;if(ki(s)!=="number")return _a(n.default,t.default);const p=n.stops.length;if(p===1||s<=n.stops[0][0])return n.stops[0][1];if(s>=n.stops[p-1][0])return n.stops[p-1][1];const v=qi(n.stops.map(L=>L[0]),s),x=function(L,O,$,j){const G=j-$,X=L-$;return G===0?0:O===1?X/G:(Math.pow(O,X)-1)/(Math.pow(O,G)-1)}(s,c,n.stops[v][0],n.stops[v+1][0]),w=n.stops[v][1],E=n.stops[v+1][1],C=dn[t.type]||xu;return typeof w.evaluate=="function"?{evaluate(...L){const O=w.evaluate.apply(void 0,L),$=E.evaluate.apply(void 0,L);if(O!==void 0&&$!==void 0)return C(O,$,x,n.colorSpace)}}:C(w,E,x,n.colorSpace)}function Ua(n,t,s){switch(t.type){case"color":s=Ni.parse(s);break;case"formatted":s=An.fromString(s.toString());break;case"resolvedImage":s=vn.fromString(s.toString());break;case"padding":s=_n.parse(s);break;default:ki(s)===t.type||t.type==="enum"&&t.values[s]||(s=void 0)}return _a(s,n.default,t.default)}vi.register($a,{error:[{kind:"error"},[li],(n,[t])=>{throw new hr(t.evaluate(n))}],typeof:[li,[ei],(n,[t])=>J(Dr(t.evaluate(n)))],"to-rgba":[H(st,4),[$i],(n,[t])=>{const[s,c,p,v]=t.evaluate(n).rgb;return[255*s,255*c,255*p,v]}],rgb:[$i,[st,st,st],xc],rgba:[$i,[st,st,st,st],xc],has:{type:Ft,overloads:[[[li],(n,[t])=>Ho(t.evaluate(n),n.properties())],[[li,mn],(n,[t,s])=>Ho(t.evaluate(n),s.evaluate(n))]]},get:{type:ei,overloads:[[[li],(n,[t])=>ya(t.evaluate(n),n.properties())],[[li,mn],(n,[t,s])=>ya(t.evaluate(n),s.evaluate(n))]]},"feature-state":[ei,[li],(n,[t])=>ya(t.evaluate(n),n.featureState||{})],properties:[mn,[],n=>n.properties()],"geometry-type":[li,[],n=>n.geometryType()],id:[ei,[],n=>n.id()],zoom:[st,[],n=>n.globals.zoom],"heatmap-density":[st,[],n=>n.globals.heatmapDensity||0],"line-progress":[st,[],n=>n.globals.lineProgress||0],accumulated:[ei,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[st,Ns(st),(n,t)=>{let s=0;for(const c of t)s+=c.evaluate(n);return s}],"*":[st,Ns(st),(n,t)=>{let s=1;for(const c of t)s*=c.evaluate(n);return s}],"-":{type:st,overloads:[[[st,st],(n,[t,s])=>t.evaluate(n)-s.evaluate(n)],[[st],(n,[t])=>-t.evaluate(n)]]},"/":[st,[st,st],(n,[t,s])=>t.evaluate(n)/s.evaluate(n)],"%":[st,[st,st],(n,[t,s])=>t.evaluate(n)%s.evaluate(n)],ln2:[st,[],()=>Math.LN2],pi:[st,[],()=>Math.PI],e:[st,[],()=>Math.E],"^":[st,[st,st],(n,[t,s])=>Math.pow(t.evaluate(n),s.evaluate(n))],sqrt:[st,[st],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[st,[st],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[st,[st],(n,[t])=>Math.log(t.evaluate(n))],log2:[st,[st],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[st,[st],(n,[t])=>Math.sin(t.evaluate(n))],cos:[st,[st],(n,[t])=>Math.cos(t.evaluate(n))],tan:[st,[st],(n,[t])=>Math.tan(t.evaluate(n))],asin:[st,[st],(n,[t])=>Math.asin(t.evaluate(n))],acos:[st,[st],(n,[t])=>Math.acos(t.evaluate(n))],atan:[st,[st],(n,[t])=>Math.atan(t.evaluate(n))],min:[st,Ns(st),(n,t)=>Math.min(...t.map(s=>s.evaluate(n)))],max:[st,Ns(st),(n,t)=>Math.max(...t.map(s=>s.evaluate(n)))],abs:[st,[st],(n,[t])=>Math.abs(t.evaluate(n))],round:[st,[st],(n,[t])=>{const s=t.evaluate(n);return s<0?-Math.round(-s):Math.round(s)}],floor:[st,[st],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[st,[st],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[Ft,[li,ei],(n,[t,s])=>n.properties()[t.value]===s.value],"filter-id-==":[Ft,[ei],(n,[t])=>n.id()===t.value],"filter-type-==":[Ft,[li],(n,[t])=>n.geometryType()===t.value],"filter-<":[Ft,[li,ei],(n,[t,s])=>{const c=n.properties()[t.value],p=s.value;return typeof c==typeof p&&c<p}],"filter-id-<":[Ft,[ei],(n,[t])=>{const s=n.id(),c=t.value;return typeof s==typeof c&&s<c}],"filter->":[Ft,[li,ei],(n,[t,s])=>{const c=n.properties()[t.value],p=s.value;return typeof c==typeof p&&c>p}],"filter-id->":[Ft,[ei],(n,[t])=>{const s=n.id(),c=t.value;return typeof s==typeof c&&s>c}],"filter-<=":[Ft,[li,ei],(n,[t,s])=>{const c=n.properties()[t.value],p=s.value;return typeof c==typeof p&&c<=p}],"filter-id-<=":[Ft,[ei],(n,[t])=>{const s=n.id(),c=t.value;return typeof s==typeof c&&s<=c}],"filter->=":[Ft,[li,ei],(n,[t,s])=>{const c=n.properties()[t.value],p=s.value;return typeof c==typeof p&&c>=p}],"filter-id->=":[Ft,[ei],(n,[t])=>{const s=n.id(),c=t.value;return typeof s==typeof c&&s>=c}],"filter-has":[Ft,[ei],(n,[t])=>t.value in n.properties()],"filter-has-id":[Ft,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Ft,[H(li)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[Ft,[H(ei)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[Ft,[li,H(ei)],(n,[t,s])=>s.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[Ft,[li,H(ei)],(n,[t,s])=>function(c,p,v,x){for(;v<=x;){const w=v+x>>1;if(p[w]===c)return!0;p[w]>c?x=w-1:v=w+1}return!1}(n.properties()[t.value],s.value,0,s.value.length-1)],all:{type:Ft,overloads:[[[Ft,Ft],(n,[t,s])=>t.evaluate(n)&&s.evaluate(n)],[Ns(Ft),(n,t)=>{for(const s of t)if(!s.evaluate(n))return!1;return!0}]]},any:{type:Ft,overloads:[[[Ft,Ft],(n,[t,s])=>t.evaluate(n)||s.evaluate(n)],[Ns(Ft),(n,t)=>{for(const s of t)if(s.evaluate(n))return!0;return!1}]]},"!":[Ft,[Ft],(n,[t])=>!t.evaluate(n)],"is-supported-script":[Ft,[li],(n,[t])=>{const s=n.globals&&n.globals.isSupportedScript;return!s||s(t.evaluate(n))}],upcase:[li,[li],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[li,[li],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[li,Ns(ei),(n,t)=>t.map(s=>co(s.evaluate(n))).join("")],"resolved-locale":[li,[Js],(n,[t])=>t.evaluate(n).resolvedLocale()]});class Fi{constructor(t,s){var c;this.expression=t,this._warningHistory={},this._evaluator=new Ui,this._defaultValue=s?(c=s).type==="color"&&Wo(c.default)?new Ni(0,0,0,0):c.type==="color"?Ni.parse(c.default)||null:c.type==="padding"?_n.parse(c.default)||null:c.type==="variableAnchorOffsetCollection"?kr.parse(c.default)||null:c.default===void 0?null:c.default:null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(t,s,c,p,v,x){return this._evaluator.globals=t,this._evaluator.feature=s,this._evaluator.featureState=c,this._evaluator.canonical=p,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(t,s,c,p,v,x){this._evaluator.globals=t,this._evaluator.feature=s||null,this._evaluator.featureState=c||null,this._evaluator.canonical=p,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new hr(`Expected value to be one of ${Object.keys(this._enumValues).map(E=>JSON.stringify(E)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function Wi(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in $a}function _s(n,t){const s=new Oo($a,Sr,[],t?function(p){const v={color:$i,string:li,number:st,enum:li,boolean:Ft,formatted:Mr,padding:ee,resolvedImage:N,variableAnchorOffsetCollection:U};return p.type==="array"?H(v[p.value]||ei,p.length):v[p.type]}(t):void 0),c=s.parse(n,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?Zo(new Fi(c,t)):ta(s.errors)}class ia{constructor(t,s){this.kind=t,this._styleExpression=s,this.isStateDependent=t!=="constant"&&!ma(s.expression)}evaluateWithoutErrorHandling(t,s,c,p,v,x){return this._styleExpression.evaluateWithoutErrorHandling(t,s,c,p,v,x)}evaluate(t,s,c,p,v,x){return this._styleExpression.evaluate(t,s,c,p,v,x)}}class Xo{constructor(t,s,c,p){this.kind=t,this.zoomStops=c,this._styleExpression=s,this.isStateDependent=t!=="camera"&&!ma(s.expression),this.interpolationType=p}evaluateWithoutErrorHandling(t,s,c,p,v,x){return this._styleExpression.evaluateWithoutErrorHandling(t,s,c,p,v,x)}evaluate(t,s,c,p,v,x){return this._styleExpression.evaluate(t,s,c,p,v,x)}interpolationFactor(t,s,c){return this.interpolationType?Jr.interpolationFactor(this.interpolationType,t,s,c):0}}function Rl(n,t){const s=_s(n,t);if(s.result==="error")return s;const c=s.value.expression,p=_r(c);if(!p&&!ys(t))return ta([new Zi("","data expressions not supported")]);const v=po(c,["zoom"]);if(!v&&!bc(t))return ta([new Zi("","zoom expressions not supported")]);const x=Yo(c);return x||v?x instanceof Zi?ta([x]):x instanceof Jr&&!Dl(t)?ta([new Zi("",'"interpolate" expressions cannot be used with this property')]):Zo(x?new Xo(p?"camera":"composite",s.value,x.labels,x instanceof Jr?x.interpolation:void 0):new ia(p?"constant":"source",s.value)):ta([new Zi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ko{constructor(t,s){this._parameters=t,this._specification=s,Oi(this,Ll(this._parameters,this._specification))}static deserialize(t){return new Ko(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Yo(n){let t=null;if(n instanceof Bo)t=Yo(n.result);else if(n instanceof Fo){for(const s of n.args)if(t=Yo(s),t)break}else(n instanceof Ba||n instanceof Jr)&&n.input instanceof vi&&n.input.name==="zoom"&&(t=n);return t instanceof Zi||n.eachChild(s=>{const c=Yo(s);c instanceof Zi?t=c:!t&&c?t=new Zi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&c&&t!==c&&(t=new Zi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function go(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const t of n.slice(1))if(!go(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const zl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function va(n){if(n==null)return{filter:()=>!0,needGeometry:!1};go(n)||(n=rs(n));const t=_s(n,zl);if(t.result==="error")throw new Error(t.value.map(s=>`${s.key}: ${s.message}`).join(", "));return{filter:(s,c,p)=>t.value.evaluate(s,c,{},p),needGeometry:Jo(n)}}function xa(n,t){return n<t?-1:n>t?1:0}function Jo(n){if(!Array.isArray(n))return!1;if(n[0]==="within")return!0;for(let t=1;t<n.length;t++)if(Jo(n[t]))return!0;return!1}function rs(n){if(!n)return!0;const t=n[0];return n.length<=1?t!=="any":t==="=="?Ol(n[1],n[2],"=="):t==="!="?Qo(Ol(n[1],n[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Ol(n[1],n[2],t):t==="any"?(s=n.slice(1),["any"].concat(s.map(rs))):t==="all"?["all"].concat(n.slice(1).map(rs)):t==="none"?["all"].concat(n.slice(1).map(rs).map(Qo)):t==="in"?ra(n[1],n.slice(2)):t==="!in"?Qo(ra(n[1],n.slice(2))):t==="has"?Fl(n[1]):t==="!has"?Qo(Fl(n[1])):t!=="within"||n;var s}function Ol(n,t,s){switch(n){case"$type":return[`filter-type-${s}`,t];case"$id":return[`filter-id-${s}`,t];default:return[`filter-${s}`,n,t]}}function ra(n,t){if(t.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(s=>typeof s!=typeof t[0])?["filter-in-large",n,["literal",t.sort(xa)]]:["filter-in-small",n,["literal",t]]}}function Fl(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Qo(n){return["!",n]}function Va(n){const t=typeof n;if(t==="number"||t==="boolean"||t==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let p="[";for(const v of n)p+=`${Va(v)},`;return`${p}]`}const s=Object.keys(n).sort();let c="{";for(let p=0;p<s.length;p++)c+=`${JSON.stringify(s[p])}:${Va(n[s[p]])},`;return`${c}}`}function Bl(n){let t="";for(const s of ft)t+=`/${Va(n[s])}`;return t}function Nl(n){const t=n.value;return t?[new Ue(n.key,t,"constants have been deprecated as of v8")]:[]}function fr(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Us(n){if(Array.isArray(n))return n.map(Us);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const t={};for(const s in n)t[s]=Us(n[s]);return t}return fr(n)}function jr(n){const t=n.key,s=n.value,c=n.valueSpec||{},p=n.objectElementValidators||{},v=n.style,x=n.styleSpec,w=n.validateSpec;let E=[];const C=ki(s);if(C!=="object")return[new Ue(t,s,`object expected, ${C} found`)];for(const L in s){const O=L.split(".")[0],$=c[O]||c["*"];let j;if(p[O])j=p[O];else if(c[O])j=w;else if(p["*"])j=p["*"];else{if(!c["*"]){E.push(new Ue(t,s[L],`unknown property "${L}"`));continue}j=w}E=E.concat(j({key:(t&&`${t}.`)+L,value:s[L],valueSpec:$,style:v,styleSpec:x,object:s,objectKey:L,validateSpec:w},s))}for(const L in c)p[L]||c[L].required&&c[L].default===void 0&&s[L]===void 0&&E.push(new Ue(t,s,`missing required property "${L}"`));return E}function el(n){const t=n.value,s=n.valueSpec,c=n.style,p=n.styleSpec,v=n.key,x=n.arrayElementValidator||n.validateSpec;if(ki(t)!=="array")return[new Ue(v,t,`array expected, ${ki(t)} found`)];if(s.length&&t.length!==s.length)return[new Ue(v,t,`array length ${s.length} expected, length ${t.length} found`)];if(s["min-length"]&&t.length<s["min-length"])return[new Ue(v,t,`array length at least ${s["min-length"]} expected, length ${t.length} found`)];let w={type:s.value,values:s.values};p.$version<7&&(w.function=s.function),ki(s.value)==="object"&&(w=s.value);let E=[];for(let C=0;C<t.length;C++)E=E.concat(x({array:t,arrayIndex:C,value:t[C],valueSpec:w,validateSpec:n.validateSpec,style:c,styleSpec:p,key:`${v}[${C}]`}));return E}function tl(n){const t=n.key,s=n.value,c=n.valueSpec;let p=ki(s);return p==="number"&&s!=s&&(p="NaN"),p!=="number"?[new Ue(t,s,`number expected, ${p} found`)]:"minimum"in c&&s<c.minimum?[new Ue(t,s,`${s} is less than the minimum value ${c.minimum}`)]:"maximum"in c&&s>c.maximum?[new Ue(t,s,`${s} is greater than the maximum value ${c.maximum}`)]:[]}function Se(n){const t=n.valueSpec,s=fr(n.value.type);let c,p,v,x={};const w=s!=="categorical"&&n.value.property===void 0,E=!w,C=ki(n.value.stops)==="array"&&ki(n.value.stops[0])==="array"&&ki(n.value.stops[0][0])==="object",L=jr({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(j){if(s==="identity")return[new Ue(j.key,j.value,'identity function may not have a "stops" property')];let G=[];const X=j.value;return G=G.concat(el({key:j.key,value:X,valueSpec:j.valueSpec,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:O})),ki(X)==="array"&&X.length===0&&G.push(new Ue(j.key,X,"array must have at least one stop")),G},default:function(j){return j.validateSpec({key:j.key,value:j.value,valueSpec:t,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec})}}});return s==="identity"&&w&&L.push(new Ue(n.key,n.value,'missing required property "property"')),s==="identity"||n.value.stops||L.push(new Ue(n.key,n.value,'missing required property "stops"')),s==="exponential"&&n.valueSpec.expression&&!Dl(n.valueSpec)&&L.push(new Ue(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(E&&!ys(n.valueSpec)?L.push(new Ue(n.key,n.value,"property functions not supported")):w&&!bc(n.valueSpec)&&L.push(new Ue(n.key,n.value,"zoom functions not supported"))),s!=="categorical"&&!C||n.value.property!==void 0||L.push(new Ue(n.key,n.value,'"property" property is required')),L;function O(j){let G=[];const X=j.value,ie=j.key;if(ki(X)!=="array")return[new Ue(ie,X,`array expected, ${ki(X)} found`)];if(X.length!==2)return[new Ue(ie,X,`array length 2 expected, length ${X.length} found`)];if(C){if(ki(X[0])!=="object")return[new Ue(ie,X,`object expected, ${ki(X[0])} found`)];if(X[0].zoom===void 0)return[new Ue(ie,X,"object stop key must have zoom")];if(X[0].value===void 0)return[new Ue(ie,X,"object stop key must have value")];if(v&&v>fr(X[0].zoom))return[new Ue(ie,X[0].zoom,"stop zoom values must appear in ascending order")];fr(X[0].zoom)!==v&&(v=fr(X[0].zoom),p=void 0,x={}),G=G.concat(jr({key:`${ie}[0]`,value:X[0],valueSpec:{zoom:{}},validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:tl,value:$}}))}else G=G.concat($({key:`${ie}[0]`,value:X[0],valueSpec:{},validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec},X));return Wi(Us(X[1]))?G.concat([new Ue(`${ie}[1]`,X[1],"expressions are not allowed in function stops.")]):G.concat(j.validateSpec({key:`${ie}[1]`,value:X[1],valueSpec:t,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec}))}function $(j,G){const X=ki(j.value),ie=fr(j.value),ue=j.value!==null?j.value:G;if(c){if(X!==c)return[new Ue(j.key,ue,`${X} stop domain type must match previous stop domain type ${c}`)]}else c=X;if(X!=="number"&&X!=="string"&&X!=="boolean")return[new Ue(j.key,ue,"stop domain value must be a number, string, or boolean")];if(X!=="number"&&s!=="categorical"){let Ee=`number expected, ${X} found`;return ys(t)&&s===void 0&&(Ee+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ue(j.key,ue,Ee)]}return s!=="categorical"||X!=="number"||isFinite(ie)&&Math.floor(ie)===ie?s!=="categorical"&&X==="number"&&p!==void 0&&ie<p?[new Ue(j.key,ue,"stop domain values must appear in ascending order")]:(p=ie,s==="categorical"&&ie in x?[new Ue(j.key,ue,"stop domain values must be unique")]:(x[ie]=!0,[])):[new Ue(j.key,ue,`integer expected, found ${ie}`)]}}function De(n){const t=(n.expressionContext==="property"?Rl:_s)(Us(n.value),n.valueSpec);if(t.result==="error")return t.value.map(c=>new Ue(`${n.key}${c.key}`,n.value,c.message));const s=t.value.expression||t.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!s.outputDefined())return[new Ue(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!ma(s))return[new Ue(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!ma(s))return[new Ue(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!po(s,["zoom","feature-state"]))return[new Ue(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!_r(s))return[new Ue(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function mt(n){const t=n.key,s=n.value,c=n.valueSpec,p=[];return Array.isArray(c.values)?c.values.indexOf(fr(s))===-1&&p.push(new Ue(t,s,`expected one of [${c.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(c.values).indexOf(fr(s))===-1&&p.push(new Ue(t,s,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(s)} found`)),p}function qt(n){return go(Us(n.value))?De(Oi({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ji(n)}function Ji(n){const t=n.value,s=n.key;if(ki(t)!=="array")return[new Ue(s,t,`array expected, ${ki(t)} found`)];const c=n.styleSpec;let p,v=[];if(t.length<1)return[new Ue(s,t,"filter array must have at least 1 element")];switch(v=v.concat(mt({key:`${s}[0]`,value:t[0],valueSpec:c.filter_operator,style:n.style,styleSpec:n.styleSpec})),fr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&fr(t[1])==="$type"&&v.push(new Ue(s,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&v.push(new Ue(s,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(p=ki(t[1]),p!=="string"&&v.push(new Ue(`${s}[1]`,t[1],`string expected, ${p} found`)));for(let x=2;x<t.length;x++)p=ki(t[x]),fr(t[1])==="$type"?v=v.concat(mt({key:`${s}[${x}]`,value:t[x],valueSpec:c.geometry_type,style:n.style,styleSpec:n.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&v.push(new Ue(`${s}[${x}]`,t[x],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let x=1;x<t.length;x++)v=v.concat(Ji({key:`${s}[${x}]`,value:t[x],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":p=ki(t[1]),t.length!==2?v.push(new Ue(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):p!=="string"&&v.push(new Ue(`${s}[1]`,t[1],`string expected, ${p} found`));break;case"within":p=ki(t[1]),t.length!==2?v.push(new Ue(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):p!=="object"&&v.push(new Ue(`${s}[1]`,t[1],`object expected, ${p} found`))}return v}function Ei(n,t){const s=n.key,c=n.validateSpec,p=n.style,v=n.styleSpec,x=n.value,w=n.objectKey,E=v[`${t}_${n.layerType}`];if(!E)return[];const C=w.match(/^(.*)-transition$/);if(t==="paint"&&C&&E[C[1]]&&E[C[1]].transition)return c({key:s,value:x,valueSpec:v.transition,style:p,styleSpec:v});const L=n.valueSpec||E[w];if(!L)return[new Ue(s,x,`unknown property "${w}"`)];let O;if(ki(x)==="string"&&ys(L)&&!L.tokens&&(O=/^{([^}]+)}$/.exec(x)))return[new Ue(s,x,`"${w}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(O[1])} }\`.`)];const $=[];return n.layerType==="symbol"&&(w==="text-field"&&p&&!p.glyphs&&$.push(new Ue(s,x,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&Wo(Us(x))&&fr(x.type)==="identity"&&$.push(new Ue(s,x,'"text-font" does not support identity functions'))),$.concat(c({key:n.key,value:x,valueSpec:L,style:p,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:w}))}function pr(n){return Ei(n,"paint")}function Er(n){return Ei(n,"layout")}function wn(n){let t=[];const s=n.value,c=n.key,p=n.style,v=n.styleSpec;s.type||s.ref||t.push(new Ue(c,s,'either "type" or "ref" is required'));let x=fr(s.type);const w=fr(s.ref);if(s.id){const E=fr(s.id);for(let C=0;C<n.arrayIndex;C++){const L=p.layers[C];fr(L.id)===E&&t.push(new Ue(c,s.id,`duplicate layer id "${s.id}", previously used at line ${L.id.__line__}`))}}if("ref"in s){let E;["type","source","source-layer","filter","layout"].forEach(C=>{C in s&&t.push(new Ue(c,s[C],`"${C}" is prohibited for ref layers`))}),p.layers.forEach(C=>{fr(C.id)===w&&(E=C)}),E?E.ref?t.push(new Ue(c,s.ref,"ref cannot reference another ref layer")):x=fr(E.type):t.push(new Ue(c,s.ref,`ref layer "${w}" not found`))}else if(x!=="background")if(s.source){const E=p.sources&&p.sources[s.source],C=E&&fr(E.type);E?C==="vector"&&x==="raster"?t.push(new Ue(c,s.source,`layer "${s.id}" requires a raster source`)):C!=="raster-dem"&&x==="hillshade"?t.push(new Ue(c,s.source,`layer "${s.id}" requires a raster-dem source`)):C==="raster"&&x!=="raster"?t.push(new Ue(c,s.source,`layer "${s.id}" requires a vector source`)):C!=="vector"||s["source-layer"]?C==="raster-dem"&&x!=="hillshade"?t.push(new Ue(c,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!s.paint||!s.paint["line-gradient"]||C==="geojson"&&E.lineMetrics||t.push(new Ue(c,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Ue(c,s,`layer "${s.id}" must specify a "source-layer"`)):t.push(new Ue(c,s.source,`source "${s.source}" not found`))}else t.push(new Ue(c,s,'missing required property "source"'));return t=t.concat(jr({key:c,value:s,valueSpec:v.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${c}.type`,value:s.type,valueSpec:v.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:s,objectKey:"type"}),filter:qt,layout:E=>jr({layer:s,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,validateSpec:E.validateSpec,objectElementValidators:{"*":C=>Er(Oi({layerType:x},C))}}),paint:E=>jr({layer:s,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,validateSpec:E.validateSpec,objectElementValidators:{"*":C=>pr(Oi({layerType:x},C))}})}})),t}function ar(n){const t=n.value,s=n.key,c=ki(t);return c!=="string"?[new Ue(s,t,`string expected, ${c} found`)]:[]}const Br={promoteId:function({key:n,value:t}){if(ki(t)==="string")return ar({key:n,value:t});{const s=[];for(const c in t)s.push(...ar({key:`${n}.${c}`,value:t[c]}));return s}}};function ns(n){const t=n.value,s=n.key,c=n.styleSpec,p=n.style,v=n.validateSpec;if(!t.type)return[new Ue(s,t,'"type" is required')];const x=fr(t.type);let w;switch(x){case"vector":case"raster":return w=jr({key:s,value:t,valueSpec:c[`source_${x.replace("-","_")}`],style:n.style,styleSpec:c,objectElementValidators:Br,validateSpec:v}),w;case"raster-dem":return w=function(E){var C;const L=(C=E.sourceName)!==null&&C!==void 0?C:"",O=E.value,$=E.styleSpec,j=$.source_raster_dem,G=E.style;let X=[];const ie=ki(O);if(O===void 0)return X;if(ie!=="object")return X.push(new Ue("source_raster_dem",O,`object expected, ${ie} found`)),X;const ue=fr(O.encoding)==="custom",Ee=["redFactor","greenFactor","blueFactor","baseShift"],fe=E.value.encoding?`"${E.value.encoding}"`:"Default";for(const xe in O)!ue&&Ee.includes(xe)?X.push(new Ue(xe,O[xe],`In "${L}": "${xe}" is only valid when "encoding" is set to "custom". ${fe} encoding found`)):j[xe]?X=X.concat(E.validateSpec({key:xe,value:O[xe],valueSpec:j[xe],validateSpec:E.validateSpec,style:G,styleSpec:$})):X.push(new Ue(xe,O[xe],`unknown property "${xe}"`));return X}({sourceName:s,value:t,style:n.style,styleSpec:c,validateSpec:v}),w;case"geojson":if(w=jr({key:s,value:t,valueSpec:c.source_geojson,style:p,styleSpec:c,validateSpec:v,objectElementValidators:Br}),t.cluster)for(const E in t.clusterProperties){const[C,L]=t.clusterProperties[E],O=typeof C=="string"?[C,["accumulated"],["get",E]]:C;w.push(...De({key:`${s}.${E}.map`,value:L,validateSpec:v,expressionContext:"cluster-map"})),w.push(...De({key:`${s}.${E}.reduce`,value:O,validateSpec:v,expressionContext:"cluster-reduce"}))}return w;case"video":return jr({key:s,value:t,valueSpec:c.source_video,style:p,validateSpec:v,styleSpec:c});case"image":return jr({key:s,value:t,valueSpec:c.source_image,style:p,validateSpec:v,styleSpec:c});case"canvas":return[new Ue(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return mt({key:`${s}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:p,validateSpec:v,styleSpec:c})}}function vs(n){const t=n.value,s=n.styleSpec,c=s.light,p=n.style;let v=[];const x=ki(t);if(t===void 0)return v;if(x!=="object")return v=v.concat([new Ue("light",t,`object expected, ${x} found`)]),v;for(const w in t){const E=w.match(/^(.*)-transition$/);v=v.concat(E&&c[E[1]]&&c[E[1]].transition?n.validateSpec({key:w,value:t[w],valueSpec:s.transition,validateSpec:n.validateSpec,style:p,styleSpec:s}):c[w]?n.validateSpec({key:w,value:t[w],valueSpec:c[w],validateSpec:n.validateSpec,style:p,styleSpec:s}):[new Ue(w,t[w],`unknown property "${w}"`)])}return v}function fn(n){const t=n.value,s=n.styleSpec,c=s.sky,p=n.style,v=ki(t);if(t===void 0)return[];if(v!=="object")return[new Ue("sky",t,`object expected, ${v} found`)];let x=[];for(const w in t)x=x.concat(c[w]?Mn({key:w,value:t[w],valueSpec:c[w],style:p,styleSpec:s}):[new Ue(w,t[w],`unknown property "${w}"`)]);return x}function Rn(n){const t=n.value,s=n.styleSpec,c=s.terrain,p=n.style;let v=[];const x=ki(t);if(t===void 0)return v;if(x!=="object")return v=v.concat([new Ue("terrain",t,`object expected, ${x} found`)]),v;for(const w in t)v=v.concat(c[w]?n.validateSpec({key:w,value:t[w],valueSpec:c[w],validateSpec:n.validateSpec,style:p,styleSpec:s}):[new Ue(w,t[w],`unknown property "${w}"`)]);return v}function xs(n){let t=[];const s=n.value,c=n.key;if(Array.isArray(s)){const p=[],v=[];for(const x in s)s[x].id&&p.includes(s[x].id)&&t.push(new Ue(c,s,`all the sprites' ids must be unique, but ${s[x].id} is duplicated`)),p.push(s[x].id),s[x].url&&v.includes(s[x].url)&&t.push(new Ue(c,s,`all the sprites' URLs must be unique, but ${s[x].url} is duplicated`)),v.push(s[x].url),t=t.concat(jr({key:`${c}[${x}]`,value:s[x],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return t}return ar({key:c,value:s})}const Qr={"*":()=>[],array:el,boolean:function(n){const t=n.value,s=n.key,c=ki(t);return c!=="boolean"?[new Ue(s,t,`boolean expected, ${c} found`)]:[]},number:tl,color:function(n){const t=n.key,s=n.value,c=ki(s);return c!=="string"?[new Ue(t,s,`color expected, ${c} found`)]:Ni.parse(String(s))?[]:[new Ue(t,s,`color expected, "${s}" found`)]},constants:Nl,enum:mt,filter:qt,function:Se,layer:wn,object:jr,source:ns,light:vs,sky:fn,terrain:Rn,string:ar,formatted:function(n){return ar(n).length===0?[]:De(n)},resolvedImage:function(n){return ar(n).length===0?[]:De(n)},padding:function(n){const t=n.key,s=n.value;if(ki(s)==="array"){if(s.length<1||s.length>4)return[new Ue(t,s,`padding requires 1 to 4 values; ${s.length} values found`)];const c={type:"number"};let p=[];for(let v=0;v<s.length;v++)p=p.concat(n.validateSpec({key:`${t}[${v}]`,value:s[v],validateSpec:n.validateSpec,valueSpec:c}));return p}return tl({key:t,value:s,valueSpec:{}})},variableAnchorOffsetCollection:function(n){const t=n.key,s=n.value,c=ki(s),p=n.styleSpec;if(c!=="array"||s.length<1||s.length%2!=0)return[new Ue(t,s,"variableAnchorOffsetCollection requires a non-empty array of even length")];let v=[];for(let x=0;x<s.length;x+=2)v=v.concat(mt({key:`${t}[${x}]`,value:s[x],valueSpec:p.layout_symbol["text-anchor"]})),v=v.concat(el({key:`${t}[${x+1}]`,value:s[x+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:p}));return v},sprite:xs};function Mn(n){const t=n.value,s=n.valueSpec,c=n.styleSpec;return n.validateSpec=Mn,s.expression&&Wo(fr(t))?Se(n):s.expression&&Wi(Us(t))?De(n):s.type&&Qr[s.type]?Qr[s.type](n):jr(Oi({},n,{valueSpec:s.type?c[s.type]:s}))}function ba(n){const t=n.value,s=n.key,c=ar(n);return c.length||(t.indexOf("{fontstack}")===-1&&c.push(new Ue(s,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&c.push(new Ue(s,t,'"glyphs" url must include a "{range}" token'))),c}function Hn(n,t=le){let s=[];return s=s.concat(Mn({key:"",value:n,valueSpec:t.$root,styleSpec:t,style:n,validateSpec:Mn,objectElementValidators:{glyphs:ba,"*":()=>[]}})),n.constants&&(s=s.concat(Nl({key:"constants",value:n.constants,style:n,styleSpec:t,validateSpec:Mn}))),ja(s)}function bs(n){return function(t){return n({...t,validateSpec:Mn})}}function ja(n){return[].concat(n).sort((t,s)=>t.line-s.line)}function Ii(n){return function(...t){return ja(n.apply(this,t))}}Hn.source=Ii(bs(ns)),Hn.sprite=Ii(bs(xs)),Hn.glyphs=Ii(bs(ba)),Hn.light=Ii(bs(vs)),Hn.sky=Ii(bs(fn)),Hn.terrain=Ii(bs(Rn)),Hn.layer=Ii(bs(wn)),Hn.filter=Ii(bs(qt)),Hn.paintProperty=Ii(bs(pr)),Hn.layoutProperty=Ii(bs(Er));const Li=Hn,il=Li.light,ws=Li.paintProperty,$l=Li.layoutProperty;function en(n,t){let s=!1;if(t&&t.length)for(const c of t)n.fire(new Pe(new Error(c.message))),s=!0;return s}class zn{constructor(t,s,c){const p=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const x=new Int32Array(this.arrayBuffer);t=x[0],this.d=(s=x[1])+2*(c=x[2]);for(let E=0;E<this.d*this.d;E++){const C=x[3+E],L=x[3+E+1];p.push(C===L?null:x.subarray(C,L))}const w=x[3+p.length+1];this.keys=x.subarray(x[3+p.length],w),this.bboxes=x.subarray(w),this.insert=this._insertReadonly}else{this.d=s+2*c;for(let x=0;x<this.d*this.d;x++)p.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=t,this.padding=c,this.scale=s/t,this.uid=0;const v=c/s*t;this.min=-v,this.max=t+v}insert(t,s,c,p,v){this._forEachCell(s,c,p,v,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(v)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,s,c,p,v,x){this.cells[v].push(x)}query(t,s,c,p,v){const x=this.min,w=this.max;if(t<=x&&s<=x&&w<=c&&w<=p&&!v)return Array.prototype.slice.call(this.keys);{const E=[];return this._forEachCell(t,s,c,p,this._queryCell,E,{},v),E}}_queryCell(t,s,c,p,v,x,w,E){const C=this.cells[v];if(C!==null){const L=this.keys,O=this.bboxes;for(let $=0;$<C.length;$++){const j=C[$];if(w[j]===void 0){const G=4*j;(E?E(O[G+0],O[G+1],O[G+2],O[G+3]):t<=O[G+2]&&s<=O[G+3]&&c>=O[G+0]&&p>=O[G+1])?(w[j]=!0,x.push(L[j])):w[j]=!1}}}}_forEachCell(t,s,c,p,v,x,w,E){const C=this._convertToCellCoord(t),L=this._convertToCellCoord(s),O=this._convertToCellCoord(c),$=this._convertToCellCoord(p);for(let j=C;j<=O;j++)for(let G=L;G<=$;G++){const X=this.d*G+j;if((!E||E(this._convertFromCellCoord(j),this._convertFromCellCoord(G),this._convertFromCellCoord(j+1),this._convertFromCellCoord(G+1)))&&v.call(this,t,s,c,p,X,x,w,E))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,s=3+this.cells.length+1+1;let c=0;for(let x=0;x<this.cells.length;x++)c+=this.cells[x].length;const p=new Int32Array(s+c+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;let v=s;for(let x=0;x<t.length;x++){const w=t[x];p[3+x]=v,p.set(w,v),v+=w.length}return p[3+t.length]=v,p.set(this.keys,v),v+=this.keys.length,p[3+t.length+1]=v,p.set(this.bboxes,v),v+=this.bboxes.length,p.buffer}static serialize(t,s){const c=t.toArrayBuffer();return s&&s.push(c),{buffer:c}}static deserialize(t){return new zn(t.buffer)}}const tn={};function Tt(n,t,s={}){if(tn[n])throw new Error(`${n} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:n,writeable:!1}),tn[n]={klass:t,omit:s.omit||[],shallow:s.shallow||[]}}Tt("Object",Object),Tt("TransferableGridIndex",zn),Tt("Color",Ni),Tt("Error",Error),Tt("AJAXError",Et),Tt("ResolvedImage",vn),Tt("StylePropertyFunction",Ko),Tt("StyleExpression",Fi,{omit:["_evaluator"]}),Tt("ZoomDependentExpression",Xo),Tt("ZoomConstantExpression",ia),Tt("CompoundExpression",vi,{omit:["_evaluate"]});for(const n in $a)$a[n]._classRegistryKey||Tt(`Expression_${n}`,$a[n]);function wa(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function ss(n,t){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error)return n;if(wa(n)||gi(n))return t&&t.push(n),n;if(ArrayBuffer.isView(n)){const s=n;return t&&t.push(s.buffer),s}if(n instanceof ImageData)return t&&t.push(n.data.buffer),n;if(Array.isArray(n)){const s=[];for(const c of n)s.push(ss(c,t));return s}if(typeof n=="object"){const s=n.constructor,c=s._classRegistryKey;if(!c)throw new Error(`can't serialize object of unregistered class ${s.name}`);if(!tn[c])throw new Error(`${c} is not registered.`);const p=s.serialize?s.serialize(n,t):{};if(s.serialize){if(t&&p===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const v in n){if(!n.hasOwnProperty(v)||tn[c].omit.indexOf(v)>=0)continue;const x=n[v];p[v]=tn[c].shallow.indexOf(v)>=0?x:ss(x,t)}n instanceof Error&&(p.message=n.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(p.$name=c),p}throw new Error("can't serialize object of type "+typeof n)}function Zn(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||wa(n)||gi(n)||ArrayBuffer.isView(n)||n instanceof ImageData)return n;if(Array.isArray(n))return n.map(Zn);if(typeof n=="object"){const t=n.$name||"Object";if(!tn[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:s}=tn[t];if(!s)throw new Error(`can't deserialize unregistered class ${t}`);if(s.deserialize)return s.deserialize(n);const c=Object.create(s.prototype);for(const p of Object.keys(n)){if(p==="$name")continue;const v=n[p];c[p]=tn[t].shallow.indexOf(p)>=0?v:Zn(v)}return c}throw new Error("can't deserialize object of type "+typeof n)}class Ul{constructor(){this.first=!0}update(t,s){const c=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=s),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=c,!0))}}const vt={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function na(n){for(const t of n)if(vo(t.charCodeAt(0)))return!0;return!1}function yo(n){for(const t of n)if(!_o(t.charCodeAt(0)))return!1;return!0}function _o(n){return!(vt.Arabic(n)||vt["Arabic Supplement"](n)||vt["Arabic Extended-A"](n)||vt["Arabic Presentation Forms-A"](n)||vt["Arabic Presentation Forms-B"](n))}function vo(n){return!(n!==746&&n!==747&&(n<4352||!(vt["Bopomofo Extended"](n)||vt.Bopomofo(n)||vt["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||vt["CJK Compatibility Ideographs"](n)||vt["CJK Compatibility"](n)||vt["CJK Radicals Supplement"](n)||vt["CJK Strokes"](n)||!(!vt["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||vt["CJK Unified Ideographs Extension A"](n)||vt["CJK Unified Ideographs"](n)||vt["Enclosed CJK Letters and Months"](n)||vt["Hangul Compatibility Jamo"](n)||vt["Hangul Jamo Extended-A"](n)||vt["Hangul Jamo Extended-B"](n)||vt["Hangul Jamo"](n)||vt["Hangul Syllables"](n)||vt.Hiragana(n)||vt["Ideographic Description Characters"](n)||vt.Kanbun(n)||vt["Kangxi Radicals"](n)||vt["Katakana Phonetic Extensions"](n)||vt.Katakana(n)&&n!==12540||!(!vt["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!vt["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||vt["Unified Canadian Aboriginal Syllabics"](n)||vt["Unified Canadian Aboriginal Syllabics Extended"](n)||vt["Vertical Forms"](n)||vt["Yijing Hexagram Symbols"](n)||vt["Yi Syllables"](n)||vt["Yi Radicals"](n))))}function qa(n){return!(vo(n)||function(t){return!!(vt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||vt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||vt["Letterlike Symbols"](t)||vt["Number Forms"](t)||vt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||vt["Control Pictures"](t)&&t!==9251||vt["Optical Character Recognition"](t)||vt["Enclosed Alphanumerics"](t)||vt["Geometric Shapes"](t)||vt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||vt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||vt["CJK Symbols and Punctuation"](t)||vt.Katakana(t)||vt["Private Use Area"](t)||vt["CJK Compatibility Forms"](t)||vt["Small Form Variants"](t)||vt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(n))}function Ma(n){return n>=1424&&n<=2303||vt["Arabic Presentation Forms-A"](n)||vt["Arabic Presentation Forms-B"](n)}function Jh(n,t){return!(!t&&Ma(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||vt.Khmer(n))}function $f(n){for(const t of n)if(Ma(t.charCodeAt(0)))return!0;return!1}const Ga=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class vr{constructor(t,s){this.zoom=t,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ul,this.transition={})}isSupportedScript(t){return function(s,c){for(const p of s)if(!Jh(p.charCodeAt(0),c))return!1;return!0}(t,Ga.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,s=t-Math.floor(t),c=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*s}}}class Vl{constructor(t,s){this.property=t,this.value=s,this.expression=function(c,p){if(Wo(c))return new Ko(c,p);if(Wi(c)){const v=Rl(c,p);if(v.result==="error")throw new Error(v.value.map(x=>`${x.key}: ${x.message}`).join(", "));return v.value}{let v=c;return p.type==="color"&&typeof c=="string"?v=Ni.parse(c):p.type!=="padding"||typeof c!="number"&&!Array.isArray(c)?p.type==="variableAnchorOffsetCollection"&&Array.isArray(c)&&(v=kr.parse(c)):v=_n.parse(c),{kind:"constant",evaluate:()=>v}}}(s===void 0?t.specification.default:s,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,s,c){return this.property.possiblyEvaluate(this,t,s,c)}}class wc{constructor(t){this.property=t,this.value=new Vl(t,void 0)}transitioned(t,s){return new Qh(this.property,this.value,s,bt({},t.transition,this.transition),t.now)}untransitioned(){return new Qh(this.property,this.value,null,{},0)}}class bu{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Pt(this._values[t].value.value)}setValue(t,s){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new wc(this._values[t].property)),this._values[t].value=new Vl(this._values[t].property,s===null?void 0:Pt(s))}getTransition(t){return Pt(this._values[t].transition)}setTransition(t,s){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new wc(this._values[t].property)),this._values[t].transition=Pt(s)||void 0}serialize(){const t={};for(const s of Object.keys(this._values)){const c=this.getValue(s);c!==void 0&&(t[s]=c);const p=this.getTransition(s);p!==void 0&&(t[`${s}-transition`]=p)}return t}transitioned(t,s){const c=new ed(this._properties);for(const p of Object.keys(this._values))c._values[p]=this._values[p].transitioned(t,s._values[p]);return c}untransitioned(){const t=new ed(this._properties);for(const s of Object.keys(this._values))t._values[s]=this._values[s].untransitioned();return t}}class Qh{constructor(t,s,c,p,v){this.property=t,this.value=s,this.begin=v+p.delay||0,this.end=this.begin+p.duration||0,t.specification.transition&&(p.delay||p.duration)&&(this.prior=c)}possiblyEvaluate(t,s,c){const p=t.now||0,v=this.value.possiblyEvaluate(t,s,c),x=this.prior;if(x){if(p>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(p<this.begin)return x.possiblyEvaluate(t,s,c);{const w=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(t,s,c),v,function(E){if(E<=0)return 0;if(E>=1)return 1;const C=E*E,L=C*E;return 4*(E<.5?L:3*(E-C)+L-.75)}(w))}}return v}}class ed{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,s,c){const p=new jl(this._properties);for(const v of Object.keys(this._values))p._values[v]=this._values[v].possiblyEvaluate(t,s,c);return p}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class td{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Pt(this._values[t].value)}setValue(t,s){this._values[t]=new Vl(this._values[t].property,s===null?void 0:Pt(s))}serialize(){const t={};for(const s of Object.keys(this._values)){const c=this.getValue(s);c!==void 0&&(t[s]=c)}return t}possiblyEvaluate(t,s,c){const p=new jl(this._properties);for(const v of Object.keys(this._values))p._values[v]=this._values[v].possiblyEvaluate(t,s,c);return p}}class Vs{constructor(t,s,c){this.property=t,this.value=s,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,s,c,p){return this.property.evaluate(this.value,this.parameters,t,s,c,p)}}class jl{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Ut{constructor(t){this.specification=t}possiblyEvaluate(t,s){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(s)}interpolate(t,s,c){const p=dn[this.specification.type];return p?p(t,s,c):t}}class Kt{constructor(t,s){this.specification=t,this.overrides=s}possiblyEvaluate(t,s,c,p){return new Vs(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(s,null,{},c,p)}:t.expression,s)}interpolate(t,s,c){if(t.value.kind!=="constant"||s.value.kind!=="constant")return t;if(t.value.value===void 0||s.value.value===void 0)return new Vs(this,{kind:"constant",value:void 0},t.parameters);const p=dn[this.specification.type];if(p){const v=p(t.value.value,s.value.value,c);return new Vs(this,{kind:"constant",value:v},t.parameters)}return t}evaluate(t,s,c,p,v,x){return t.kind==="constant"?t.value:t.evaluate(s,c,p,v,x)}}class Mc extends Kt{possiblyEvaluate(t,s,c,p){if(t.value===void 0)return new Vs(this,{kind:"constant",value:void 0},s);if(t.expression.kind==="constant"){const v=t.expression.evaluate(s,null,{},c,p),x=t.property.specification.type==="resolvedImage"&&typeof v!="string"?v.name:v,w=this._calculate(x,x,x,s);return new Vs(this,{kind:"constant",value:w},s)}if(t.expression.kind==="camera"){const v=this._calculate(t.expression.evaluate({zoom:s.zoom-1}),t.expression.evaluate({zoom:s.zoom}),t.expression.evaluate({zoom:s.zoom+1}),s);return new Vs(this,{kind:"constant",value:v},s)}return new Vs(this,t.expression,s)}evaluate(t,s,c,p,v,x){if(t.kind==="source"){const w=t.evaluate(s,c,p,v,x);return this._calculate(w,w,w,s)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(s.zoom)-1},c,p),t.evaluate({zoom:Math.floor(s.zoom)},c,p),t.evaluate({zoom:Math.floor(s.zoom)+1},c,p),s):t.value}_calculate(t,s,c,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:c,to:s}}interpolate(t){return t}}class ql{constructor(t){this.specification=t}possiblyEvaluate(t,s,c,p){if(t.value!==void 0){if(t.expression.kind==="constant"){const v=t.expression.evaluate(s,null,{},c,p);return this._calculate(v,v,v,s)}return this._calculate(t.expression.evaluate(new vr(Math.floor(s.zoom-1),s)),t.expression.evaluate(new vr(Math.floor(s.zoom),s)),t.expression.evaluate(new vr(Math.floor(s.zoom+1),s)),s)}}_calculate(t,s,c,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:c,to:s}}interpolate(t){return t}}class wu{constructor(t){this.specification=t}possiblyEvaluate(t,s,c,p){return!!t.expression.evaluate(s,null,{},c,p)}interpolate(){return!1}}class Wn{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in t){const c=t[s];c.specification.overridable&&this.overridableProperties.push(s);const p=this.defaultPropertyValues[s]=new Vl(c,void 0),v=this.defaultTransitionablePropertyValues[s]=new wc(c);this.defaultTransitioningPropertyValues[s]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=p.possiblyEvaluate({})}}}Tt("DataDrivenProperty",Kt),Tt("DataConstantProperty",Ut),Tt("CrossFadedDataDrivenProperty",Mc),Tt("CrossFadedProperty",ql),Tt("ColorRampProperty",wu);const Mu="-transition";class js extends Oe{constructor(t,s){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),s.layout&&(this._unevaluatedLayout=new td(s.layout)),s.paint)){this._transitionablePaint=new bu(s.paint);for(const c in t.paint)this.setPaintProperty(c,t.paint[c],{validate:!1});for(const c in t.layout)this.setLayoutProperty(c,t.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new jl(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,s,c={}){s!=null&&this._validate($l,`layers.${this.id}.layout.${t}`,t,s,c)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,s):this.visibility=s)}getPaintProperty(t){return t.endsWith(Mu)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,s,c={}){if(s!=null&&this._validate(ws,`layers.${this.id}.paint.${t}`,t,s,c))return!1;if(t.endsWith(Mu))return this._transitionablePaint.setTransition(t.slice(0,-11),s||void 0),!1;{const p=this._transitionablePaint._values[t],v=p.property.specification["property-type"]==="cross-faded-data-driven",x=p.value.isDataDriven(),w=p.value;this._transitionablePaint.setValue(t,s),this._handleSpecialPaintPropertyUpdate(t);const E=this._transitionablePaint._values[t].value;return E.isDataDriven()||x||v||this._handleOverridablePaintPropertyUpdate(t,w,E)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,s,c){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,s){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,s)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Rt(t,(s,c)=>!(s===void 0||c==="layout"&&!Object.keys(s).length||c==="paint"&&!Object.keys(s).length))}_validate(t,s,c,p,v={}){return(!v||v.validate!==!1)&&en(this,t.call(Li,{key:s,layerType:this.type,objectKey:c,value:p,styleSpec:le,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const s=this.paint.get(t);if(s instanceof Vs&&ys(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}}const id={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Gl{constructor(t,s){this._structArray=t,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Rr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,s){return t._trim(),s&&(t.isTransferred=!0,s.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const s=Object.create(this.prototype);return s.arrayBuffer=t.arrayBuffer,s.length=t.length,s.capacity=t.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function qr(n,t=1){let s=0,c=0;return{members:n.map(p=>{const v=id[p.type].BYTES_PER_ELEMENT,x=s=rd(s,Math.max(t,v)),w=p.components||1;return c=Math.max(c,v),s+=v*w,{name:p.name,type:p.type,components:w,offset:x}}),size:rd(s,Math.max(c,t)),alignment:t}}function rd(n,t){return Math.ceil(n/t)*t}class Hl extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,s)}emplace(t,s,c){const p=2*t;return this.int16[p+0]=s,this.int16[p+1]=c,t}}Hl.prototype.bytesPerElement=4,Tt("StructArrayLayout2i4",Hl);class Sa extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,c)}emplace(t,s,c,p){const v=3*t;return this.int16[v+0]=s,this.int16[v+1]=c,this.int16[v+2]=p,t}}Sa.prototype.bytesPerElement=6,Tt("StructArrayLayout3i6",Sa);class Su extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,p){const v=this.length;return this.resize(v+1),this.emplace(v,t,s,c,p)}emplace(t,s,c,p,v){const x=4*t;return this.int16[x+0]=s,this.int16[x+1]=c,this.int16[x+2]=p,this.int16[x+3]=v,t}}Su.prototype.bytesPerElement=8,Tt("StructArrayLayout4i8",Su);class Eu extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,p,v,x){const w=this.length;return this.resize(w+1),this.emplace(w,t,s,c,p,v,x)}emplace(t,s,c,p,v,x,w){const E=6*t;return this.int16[E+0]=s,this.int16[E+1]=c,this.int16[E+2]=p,this.int16[E+3]=v,this.int16[E+4]=x,this.int16[E+5]=w,t}}Eu.prototype.bytesPerElement=12,Tt("StructArrayLayout2i4i12",Eu);class Tu extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,p,v,x){const w=this.length;return this.resize(w+1),this.emplace(w,t,s,c,p,v,x)}emplace(t,s,c,p,v,x,w){const E=4*t,C=8*t;return this.int16[E+0]=s,this.int16[E+1]=c,this.uint8[C+4]=p,this.uint8[C+5]=v,this.uint8[C+6]=x,this.uint8[C+7]=w,t}}Tu.prototype.bytesPerElement=8,Tt("StructArrayLayout2i4ub8",Tu);class Zl extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,s)}emplace(t,s,c){const p=2*t;return this.float32[p+0]=s,this.float32[p+1]=c,t}}Zl.prototype.bytesPerElement=8,Tt("StructArrayLayout2f8",Zl);class Sc extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,p,v,x,w,E,C,L){const O=this.length;return this.resize(O+1),this.emplace(O,t,s,c,p,v,x,w,E,C,L)}emplace(t,s,c,p,v,x,w,E,C,L,O){const $=10*t;return this.uint16[$+0]=s,this.uint16[$+1]=c,this.uint16[$+2]=p,this.uint16[$+3]=v,this.uint16[$+4]=x,this.uint16[$+5]=w,this.uint16[$+6]=E,this.uint16[$+7]=C,this.uint16[$+8]=L,this.uint16[$+9]=O,t}}Sc.prototype.bytesPerElement=20,Tt("StructArrayLayout10ui20",Sc);class Iu extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,p,v,x,w,E,C,L,O,$){const j=this.length;return this.resize(j+1),this.emplace(j,t,s,c,p,v,x,w,E,C,L,O,$)}emplace(t,s,c,p,v,x,w,E,C,L,O,$,j){const G=12*t;return this.int16[G+0]=s,this.int16[G+1]=c,this.int16[G+2]=p,this.int16[G+3]=v,this.uint16[G+4]=x,this.uint16[G+5]=w,this.uint16[G+6]=E,this.uint16[G+7]=C,this.int16[G+8]=L,this.int16[G+9]=O,this.int16[G+10]=$,this.int16[G+11]=j,t}}Iu.prototype.bytesPerElement=24,Tt("StructArrayLayout4i4ui4i24",Iu);class Cu extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,c)}emplace(t,s,c,p){const v=3*t;return this.float32[v+0]=s,this.float32[v+1]=c,this.float32[v+2]=p,t}}Cu.prototype.bytesPerElement=12,Tt("StructArrayLayout3f12",Cu);class Ea extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint32[1*t+0]=s,t}}Ea.prototype.bytesPerElement=4,Tt("StructArrayLayout1ul4",Ea);class Ec extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,p,v,x,w,E,C){const L=this.length;return this.resize(L+1),this.emplace(L,t,s,c,p,v,x,w,E,C)}emplace(t,s,c,p,v,x,w,E,C,L){const O=10*t,$=5*t;return this.int16[O+0]=s,this.int16[O+1]=c,this.int16[O+2]=p,this.int16[O+3]=v,this.int16[O+4]=x,this.int16[O+5]=w,this.uint32[$+3]=E,this.uint16[O+8]=C,this.uint16[O+9]=L,t}}Ec.prototype.bytesPerElement=20,Tt("StructArrayLayout6i1ul2ui20",Ec);class Wl extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,p,v,x){const w=this.length;return this.resize(w+1),this.emplace(w,t,s,c,p,v,x)}emplace(t,s,c,p,v,x,w){const E=6*t;return this.int16[E+0]=s,this.int16[E+1]=c,this.int16[E+2]=p,this.int16[E+3]=v,this.int16[E+4]=x,this.int16[E+5]=w,t}}Wl.prototype.bytesPerElement=12,Tt("StructArrayLayout2i2i2i12",Wl);class Tc extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,p,v){const x=this.length;return this.resize(x+1),this.emplace(x,t,s,c,p,v)}emplace(t,s,c,p,v,x){const w=4*t,E=8*t;return this.float32[w+0]=s,this.float32[w+1]=c,this.float32[w+2]=p,this.int16[E+6]=v,this.int16[E+7]=x,t}}Tc.prototype.bytesPerElement=16,Tt("StructArrayLayout2f1f2i16",Tc);class Xl extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,p){const v=this.length;return this.resize(v+1),this.emplace(v,t,s,c,p)}emplace(t,s,c,p,v){const x=12*t,w=3*t;return this.uint8[x+0]=s,this.uint8[x+1]=c,this.float32[w+1]=p,this.float32[w+2]=v,t}}Xl.prototype.bytesPerElement=12,Tt("StructArrayLayout2ub2f12",Xl);class Ic extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,c)}emplace(t,s,c,p){const v=3*t;return this.uint16[v+0]=s,this.uint16[v+1]=c,this.uint16[v+2]=p,t}}Ic.prototype.bytesPerElement=6,Tt("StructArrayLayout3ui6",Ic);class rl extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,p,v,x,w,E,C,L,O,$,j,G,X,ie,ue){const Ee=this.length;return this.resize(Ee+1),this.emplace(Ee,t,s,c,p,v,x,w,E,C,L,O,$,j,G,X,ie,ue)}emplace(t,s,c,p,v,x,w,E,C,L,O,$,j,G,X,ie,ue,Ee){const fe=24*t,xe=12*t,$e=48*t;return this.int16[fe+0]=s,this.int16[fe+1]=c,this.uint16[fe+2]=p,this.uint16[fe+3]=v,this.uint32[xe+2]=x,this.uint32[xe+3]=w,this.uint32[xe+4]=E,this.uint16[fe+10]=C,this.uint16[fe+11]=L,this.uint16[fe+12]=O,this.float32[xe+7]=$,this.float32[xe+8]=j,this.uint8[$e+36]=G,this.uint8[$e+37]=X,this.uint8[$e+38]=ie,this.uint32[xe+10]=ue,this.int16[fe+22]=Ee,t}}rl.prototype.bytesPerElement=48,Tt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",rl);class xo extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,p,v,x,w,E,C,L,O,$,j,G,X,ie,ue,Ee,fe,xe,$e,Ge,It,Ot,St,xt,ct,kt){const _t=this.length;return this.resize(_t+1),this.emplace(_t,t,s,c,p,v,x,w,E,C,L,O,$,j,G,X,ie,ue,Ee,fe,xe,$e,Ge,It,Ot,St,xt,ct,kt)}emplace(t,s,c,p,v,x,w,E,C,L,O,$,j,G,X,ie,ue,Ee,fe,xe,$e,Ge,It,Ot,St,xt,ct,kt,_t){const tt=32*t,Xt=16*t;return this.int16[tt+0]=s,this.int16[tt+1]=c,this.int16[tt+2]=p,this.int16[tt+3]=v,this.int16[tt+4]=x,this.int16[tt+5]=w,this.int16[tt+6]=E,this.int16[tt+7]=C,this.uint16[tt+8]=L,this.uint16[tt+9]=O,this.uint16[tt+10]=$,this.uint16[tt+11]=j,this.uint16[tt+12]=G,this.uint16[tt+13]=X,this.uint16[tt+14]=ie,this.uint16[tt+15]=ue,this.uint16[tt+16]=Ee,this.uint16[tt+17]=fe,this.uint16[tt+18]=xe,this.uint16[tt+19]=$e,this.uint16[tt+20]=Ge,this.uint16[tt+21]=It,this.uint16[tt+22]=Ot,this.uint32[Xt+12]=St,this.float32[Xt+13]=xt,this.float32[Xt+14]=ct,this.uint16[tt+30]=kt,this.uint16[tt+31]=_t,t}}xo.prototype.bytesPerElement=64,Tt("StructArrayLayout8i15ui1ul2f2ui64",xo);class Cc extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.float32[1*t+0]=s,t}}Cc.prototype.bytesPerElement=4,Tt("StructArrayLayout1f4",Cc);class Ac extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,c)}emplace(t,s,c,p){const v=3*t;return this.uint16[6*t+0]=s,this.float32[v+1]=c,this.float32[v+2]=p,t}}Ac.prototype.bytesPerElement=12,Tt("StructArrayLayout1ui2f12",Ac);class bo extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,c)}emplace(t,s,c,p){const v=4*t;return this.uint32[2*t+0]=s,this.uint16[v+2]=c,this.uint16[v+3]=p,t}}bo.prototype.bytesPerElement=8,Tt("StructArrayLayout1ul2ui8",bo);class Au extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,s)}emplace(t,s,c){const p=2*t;return this.uint16[p+0]=s,this.uint16[p+1]=c,t}}Au.prototype.bytesPerElement=4,Tt("StructArrayLayout2ui4",Au);class Pu extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint16[1*t+0]=s,t}}Pu.prototype.bytesPerElement=2,Tt("StructArrayLayout1ui2",Pu);class Pc extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,p){const v=this.length;return this.resize(v+1),this.emplace(v,t,s,c,p)}emplace(t,s,c,p,v){const x=4*t;return this.float32[x+0]=s,this.float32[x+1]=c,this.float32[x+2]=p,this.float32[x+3]=v,t}}Pc.prototype.bytesPerElement=16,Tt("StructArrayLayout4f16",Pc);class nd extends Gl{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new k(this.anchorPointX,this.anchorPointY)}}nd.prototype.size=20;class g extends Ec{get(t){return new nd(this,t)}}Tt("CollisionBoxArray",g);class i extends Gl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}i.prototype.size=48;class o extends rl{get(t){return new i(this,t)}}Tt("PlacedSymbolArray",o);class h extends Gl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}h.prototype.size=64;class f extends xo{get(t){return new h(this,t)}}Tt("SymbolInstanceArray",f);class _ extends Cc{getoffsetX(t){return this.float32[1*t+0]}}Tt("GlyphOffsetArray",_);class M extends Sa{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Tt("SymbolLineVertexArray",M);class S extends Gl{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}S.prototype.size=12;class I extends Ac{get(t){return new S(this,t)}}Tt("TextAnchorOffsetArray",I);class D extends Gl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}D.prototype.size=8;class F extends bo{get(t){return new D(this,t)}}Tt("FeatureIndexArray",F);class B extends Hl{}class q extends Hl{}class te extends Hl{}class Q extends Eu{}class re extends Tu{}class W extends Zl{}class pe extends Sc{}class Ce extends Iu{}class oe extends Cu{}class be extends Ea{}class Ae extends Wl{}class ke extends Xl{}class ze extends Ic{}class Xe extends Au{}const Ze=qr([{name:"a_pos",components:2,type:"Int16"}],4),{members:at}=Ze;class dt{constructor(t=[]){this.segments=t}prepareSegment(t,s,c,p){let v=this.segments[this.segments.length-1];return t>dt.MAX_VERTEX_ARRAY_LENGTH&&pi(`Max vertices per segment is ${dt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!v||v.vertexLength+t>dt.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==p)&&(v={vertexOffset:s.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},p!==void 0&&(v.sortKey=p),this.segments.push(v)),v}get(){return this.segments}destroy(){for(const t of this.segments)for(const s in t.vaos)t.vaos[s].destroy()}static simpleSegment(t,s,c,p){return new dt([{vertexOffset:t,primitiveOffset:s,vertexLength:c,primitiveLength:p,vaos:{},sortKey:0}])}}function ui(n,t){return 256*(n=We(Math.floor(n),0,255))+We(Math.floor(t),0,255)}dt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Tt("SegmentVector",dt);const yt=qr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Jt={exports:{}},hi={exports:{}};hi.exports=function(n,t){var s,c,p,v,x,w,E,C;for(c=n.length-(s=3&n.length),p=t,x=3432918353,w=461845907,C=0;C<c;)E=255&n.charCodeAt(C)|(255&n.charCodeAt(++C))<<8|(255&n.charCodeAt(++C))<<16|(255&n.charCodeAt(++C))<<24,++C,p=27492+(65535&(v=5*(65535&(p=(p^=E=(65535&(E=(E=(65535&E)*x+(((E>>>16)*x&65535)<<16)&4294967295)<<15|E>>>17))*w+(((E>>>16)*w&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(E=0,s){case 3:E^=(255&n.charCodeAt(C+2))<<16;case 2:E^=(255&n.charCodeAt(C+1))<<8;case 1:p^=E=(65535&(E=(E=(65535&(E^=255&n.charCodeAt(C)))*x+(((E>>>16)*x&65535)<<16)&4294967295)<<15|E>>>17))*w+(((E>>>16)*w&65535)<<16)&4294967295}return p^=n.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0};var Di=hi.exports,ni={exports:{}};ni.exports=function(n,t){for(var s,c=n.length,p=t^c,v=0;c>=4;)s=1540483477*(65535&(s=255&n.charCodeAt(v)|(255&n.charCodeAt(++v))<<8|(255&n.charCodeAt(++v))<<16|(255&n.charCodeAt(++v))<<24))+((1540483477*(s>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),c-=4,++v;switch(c){case 3:p^=(255&n.charCodeAt(v+2))<<16;case 2:p^=(255&n.charCodeAt(v+1))<<8;case 1:p=1540483477*(65535&(p^=255&n.charCodeAt(v)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0};var fi=Di,xi=ni.exports;Jt.exports=fi,Jt.exports.murmur3=fi,Jt.exports.murmur2=xi;var zr=T(Jt.exports);class Xi{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,s,c,p){this.ids.push(as(t)),this.positions.push(s,c,p)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const s=as(t);let c=0,p=this.ids.length-1;for(;c<p;){const x=c+p>>1;this.ids[x]>=s?p=x:c=x+1}const v=[];for(;this.ids[c]===s;)v.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return v}static serialize(t,s){const c=new Float64Array(t.ids),p=new Uint32Array(t.positions);return rn(c,p,0,c.length-1),s&&s.push(c.buffer,p.buffer),{ids:c,positions:p}}static deserialize(t){const s=new Xi;return s.ids=t.ids,s.positions=t.positions,s.indexed=!0,s}}function as(n){const t=+n;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:zr(String(n))}function rn(n,t,s,c){for(;s<c;){const p=n[s+c>>1];let v=s-1,x=c+1;for(;;){do v++;while(n[v]<p);do x--;while(n[x]>p);if(v>=x)break;Tr(n,v,x),Tr(t,3*v,3*x),Tr(t,3*v+1,3*x+1),Tr(t,3*v+2,3*x+2)}x-s<c-x?(rn(n,t,s,x),s=x+1):(rn(n,t,x+1,c),c=x)}}function Tr(n,t,s){const c=n[t];n[t]=n[s],n[s]=c}Tt("FeaturePositionMap",Xi);class nn{constructor(t,s){this.gl=t.gl,this.location=s}}class os extends nn{constructor(t,s){super(t,s),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class sa extends nn{constructor(t,s){super(t,s),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Ha extends nn{constructor(t,s){super(t,s),this.current=Ni.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Kl=new Float32Array(16);function Za(n){return[ui(255*n.r,255*n.g),ui(255*n.b,255*n.a)]}class aa{constructor(t,s,c){this.value=t,this.uniformNames=s.map(p=>`u_${p}`),this.type=c}setUniform(t,s,c){t.set(c.constantOr(this.value))}getBinding(t,s,c){return this.type==="color"?new Ha(t,s):new os(t,s)}}class Wr{constructor(t,s){this.uniformNames=s.map(c=>`u_${c}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=t.tlbr}setUniform(t,s,c,p){const v=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&t.set(v)}getBinding(t,s,c){return c.substr(0,9)==="u_pattern"?new sa(t,s):new os(t,s)}}class Ir{constructor(t,s,c,p){this.expression=t,this.type=c,this.maxValue=0,this.paintVertexAttributes=s.map(v=>({name:`a_${v}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(t,s,c,p,v){const x=this.paintVertexArray.length,w=this.expression.evaluate(new vr(0),s,{},p,[],v);this.paintVertexArray.resize(t),this._setPaintValue(x,t,w)}updatePaintArray(t,s,c,p){const v=this.expression.evaluate({zoom:0},c,p);this._setPaintValue(t,s,v)}_setPaintValue(t,s,c){if(this.type==="color"){const p=Za(c);for(let v=t;v<s;v++)this.paintVertexArray.emplace(v,p[0],p[1])}else{for(let p=t;p<s;p++)this.paintVertexArray.emplace(p,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class xr{constructor(t,s,c,p,v,x){this.expression=t,this.uniformNames=s.map(w=>`u_${w}_t`),this.type=c,this.useIntegerZoom=p,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=s.map(w=>({name:`a_${w}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(t,s,c,p,v){const x=this.expression.evaluate(new vr(this.zoom),s,{},p,[],v),w=this.expression.evaluate(new vr(this.zoom+1),s,{},p,[],v),E=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(E,t,x,w)}updatePaintArray(t,s,c,p){const v=this.expression.evaluate({zoom:this.zoom},c,p),x=this.expression.evaluate({zoom:this.zoom+1},c,p);this._setPaintValue(t,s,v,x)}_setPaintValue(t,s,c,p){if(this.type==="color"){const v=Za(c),x=Za(p);for(let w=t;w<s;w++)this.paintVertexArray.emplace(w,v[0],v[1],x[0],x[1])}else{for(let v=t;v<s;v++)this.paintVertexArray.emplace(v,c,p);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(p))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,s){const c=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,p=We(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);t.set(p)}getBinding(t,s,c){return new os(t,s)}}class Ms{constructor(t,s,c,p,v,x){this.expression=t,this.type=s,this.useIntegerZoom=c,this.zoom=p,this.layerId=x,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v}populatePaintArray(t,s,c){const p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(p,t,s.patterns&&s.patterns[this.layerId],c)}updatePaintArray(t,s,c,p,v){this._setPaintValues(t,s,c.patterns&&c.patterns[this.layerId],v)}_setPaintValues(t,s,c,p){if(!p||!c)return;const{min:v,mid:x,max:w}=c,E=p[v],C=p[x],L=p[w];if(E&&C&&L)for(let O=t;O<s;O++)this.zoomInPaintVertexArray.emplace(O,C.tl[0],C.tl[1],C.br[0],C.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],C.pixelRatio,E.pixelRatio),this.zoomOutPaintVertexArray.emplace(O,C.tl[0],C.tl[1],C.br[0],C.br[1],L.tl[0],L.tl[1],L.br[0],L.br[1],C.pixelRatio,L.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,yt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,yt.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Xr{constructor(t,s,c){this.binders={},this._buffers=[];const p=[];for(const v in t.paint._values){if(!c(v))continue;const x=t.paint.get(v);if(!(x instanceof Vs&&ys(x.property.specification)))continue;const w=Ss(v,t.type),E=x.value,C=x.property.specification.type,L=x.property.useIntegerZoom,O=x.property.specification["property-type"],$=O==="cross-faded"||O==="cross-faded-data-driven";if(E.kind==="constant")this.binders[v]=$?new Wr(E.value,w):new aa(E.value,w,C),p.push(`/u_${v}`);else if(E.kind==="source"||$){const j=Kr(v,C,"source");this.binders[v]=$?new Ms(E,C,L,s,j,t.id):new Ir(E,w,C,j),p.push(`/a_${v}`)}else{const j=Kr(v,C,"composite");this.binders[v]=new xr(E,w,C,L,s,j),p.push(`/z_${v}`)}}this.cacheKey=p.sort().join("")}getMaxValue(t){const s=this.binders[t];return s instanceof Ir||s instanceof xr?s.maxValue:0}populatePaintArrays(t,s,c,p,v){for(const x in this.binders){const w=this.binders[x];(w instanceof Ir||w instanceof xr||w instanceof Ms)&&w.populatePaintArray(t,s,c,p,v)}}setConstantPatternPositions(t,s){for(const c in this.binders){const p=this.binders[c];p instanceof Wr&&p.setConstantPatternPositions(t,s)}}updatePaintArrays(t,s,c,p,v){let x=!1;for(const w in t){const E=s.getPositions(w);for(const C of E){const L=c.feature(C.index);for(const O in this.binders){const $=this.binders[O];if(($ instanceof Ir||$ instanceof xr||$ instanceof Ms)&&$.expression.isStateDependent===!0){const j=p.paint.get(O);$.expression=j.value,$.updatePaintArray(C.start,C.end,L,t[w],v),x=!0}}}}return x}defines(){const t=[];for(const s in this.binders){const c=this.binders[s];(c instanceof aa||c instanceof Wr)&&t.push(...c.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return t}getBinderAttributes(){const t=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof Ir||c instanceof xr)for(let p=0;p<c.paintVertexAttributes.length;p++)t.push(c.paintVertexAttributes[p].name);else if(c instanceof Ms)for(let p=0;p<yt.members.length;p++)t.push(yt.members[p].name)}return t}getBinderUniforms(){const t=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof aa||c instanceof Wr||c instanceof xr)for(const p of c.uniformNames)t.push(p)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,s){const c=[];for(const p in this.binders){const v=this.binders[p];if(v instanceof aa||v instanceof Wr||v instanceof xr){for(const x of v.uniformNames)if(s[x]){const w=v.getBinding(t,s[x],x);c.push({name:x,property:p,binding:w})}}}return c}setUniforms(t,s,c,p){for(const{name:v,property:x,binding:w}of s)this.binders[x].setUniform(w,p,c.get(x),v)}updatePaintBuffers(t){this._buffers=[];for(const s in this.binders){const c=this.binders[s];if(t&&c instanceof Ms){const p=t.fromScale===2?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(c instanceof Ir||c instanceof xr)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}}upload(t){for(const s in this.binders){const c=this.binders[s];(c instanceof Ir||c instanceof xr||c instanceof Ms)&&c.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const s=this.binders[t];(s instanceof Ir||s instanceof xr||s instanceof Ms)&&s.destroy()}}}class Cr{constructor(t,s,c=()=>!0){this.programConfigurations={};for(const p of t)this.programConfigurations[p.id]=new Xr(p,s,c);this.needsUpload=!1,this._featureMap=new Xi,this._bufferOffset=0}populatePaintArrays(t,s,c,p,v,x){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(t,s,p,v,x);s.id!==void 0&&this._featureMap.add(s.id,c,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,s,c,p){for(const v of c)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(t,this._featureMap,s,v,p)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Ss(n,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}function Kr(n,t,s){const c={color:{source:Zl,composite:Pc},number:{source:Cc,composite:Zl}},p=function(v){return{"line-pattern":{source:pe,composite:pe},"fill-pattern":{source:pe,composite:pe},"fill-extrusion-pattern":{source:pe,composite:pe}}[v]}(n);return p&&p[s]||c[t][s]}Tt("ConstantBinder",aa),Tt("CrossFadedConstantBinder",Wr),Tt("SourceExpressionBinder",Ir),Tt("CrossFadedCompositeBinder",Ms),Tt("CompositeExpressionBinder",xr),Tt("ProgramConfiguration",Xr,{omit:["_buffers"]}),Tt("ProgramConfigurationSet",Cr);const Nr=8192,ku=Math.pow(2,14)-1,sd=-ku-1;function wo(n){const t=Nr/n.extent,s=n.loadGeometry();for(let c=0;c<s.length;c++){const p=s[c];for(let v=0;v<p.length;v++){const x=p[v],w=Math.round(x.x*t),E=Math.round(x.y*t);x.x=We(w,sd,ku),x.y=We(E,sd,ku),(w<x.x||w>x.x+1||E<x.y||E>x.y+1)&&pi("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return s}function Mo(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?wo(n):[]}}function kc(n,t,s,c,p){n.emplaceBack(2*t+(c+1)/2,2*s+(p+1)/2)}class Wa{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new q,this.indexArray=new ze,this.segments=new dt,this.programConfigurations=new Cr(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,c){const p=this.layers[0],v=[];let x=null,w=!1;p.type==="circle"&&(x=p.layout.get("circle-sort-key"),w=!x.isConstant());for(const{feature:E,id:C,index:L,sourceLayerIndex:O}of t){const $=this.layers[0]._featureFilter.needGeometry,j=Mo(E,$);if(!this.layers[0]._featureFilter.filter(new vr(this.zoom),j,c))continue;const G=w?x.evaluate(j,{},c):void 0,X={id:C,properties:E.properties,type:E.type,sourceLayerIndex:O,index:L,geometry:$?j.geometry:wo(E),patterns:{},sortKey:G};v.push(X)}w&&v.sort((E,C)=>E.sortKey-C.sortKey);for(const E of v){const{geometry:C,index:L,sourceLayerIndex:O}=E,$=t[L].feature;this.addFeature(E,C,L,c),s.featureIndex.insert($,C,L,O,this.index)}}update(t,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,at),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,s,c,p){for(const v of s)for(const x of v){const w=x.x,E=x.y;if(w<0||w>=Nr||E<0||E>=Nr)continue;const C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),L=C.vertexLength;kc(this.layoutVertexArray,w,E,-1,-1),kc(this.layoutVertexArray,w,E,1,-1),kc(this.layoutVertexArray,w,E,1,1),kc(this.layoutVertexArray,w,E,-1,1),this.indexArray.emplaceBack(L,L+1,L+2),this.indexArray.emplaceBack(L,L+3,L+2),C.vertexLength+=4,C.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,{},p)}}function Du(n,t){for(let s=0;s<n.length;s++)if(Lc(t,n[s]))return!0;for(let s=0;s<t.length;s++)if(Lc(n,t[s]))return!0;return!!Dc(n,t)}function ad(n,t,s){return!!Lc(n,t)||!!Uf(t,n,s)}function Lu(n,t){if(n.length===1)return cg(t,n[0]);for(let s=0;s<t.length;s++){const c=t[s];for(let p=0;p<c.length;p++)if(Lc(n,c[p]))return!0}for(let s=0;s<n.length;s++)if(cg(t,n[s]))return!0;for(let s=0;s<t.length;s++)if(Dc(n,t[s]))return!0;return!1}function Ru(n,t,s){if(n.length>1){if(Dc(n,t))return!0;for(let c=0;c<t.length;c++)if(Uf(t[c],n,s))return!0}for(let c=0;c<n.length;c++)if(Uf(n[c],t,s))return!0;return!1}function Dc(n,t){if(n.length===0||t.length===0)return!1;for(let s=0;s<n.length-1;s++){const c=n[s],p=n[s+1];for(let v=0;v<t.length-1;v++)if(zu(c,p,t[v],t[v+1]))return!0}return!1}function zu(n,t,s,c){return Yt(n,s,c)!==Yt(t,s,c)&&Yt(n,t,s)!==Yt(n,t,c)}function Uf(n,t,s){const c=s*s;if(t.length===1)return n.distSqr(t[0])<c;for(let p=1;p<t.length;p++)if(lg(n,t[p-1],t[p])<c)return!0;return!1}function lg(n,t,s){const c=t.distSqr(s);if(c===0)return n.distSqr(t);const p=((n.x-t.x)*(s.x-t.x)+(n.y-t.y)*(s.y-t.y))/c;return n.distSqr(p<0?t:p>1?s:s.sub(t)._mult(p)._add(t))}function cg(n,t){let s,c,p,v=!1;for(let x=0;x<n.length;x++){s=n[x];for(let w=0,E=s.length-1;w<s.length;E=w++)c=s[w],p=s[E],c.y>t.y!=p.y>t.y&&t.x<(p.x-c.x)*(t.y-c.y)/(p.y-c.y)+c.x&&(v=!v)}return v}function Lc(n,t){let s=!1;for(let c=0,p=n.length-1;c<n.length;p=c++){const v=n[c],x=n[p];v.y>t.y!=x.y>t.y&&t.x<(x.x-v.x)*(t.y-v.y)/(x.y-v.y)+v.x&&(s=!s)}return s}function i1(n,t,s){const c=s[0],p=s[2];if(n.x<c.x&&t.x<c.x||n.x>p.x&&t.x>p.x||n.y<c.y&&t.y<c.y||n.y>p.y&&t.y>p.y)return!1;const v=Yt(n,t,s[0]);return v!==Yt(n,t,s[1])||v!==Yt(n,t,s[2])||v!==Yt(n,t,s[3])}function Ou(n,t,s){const c=t.paint.get(n).value;return c.kind==="constant"?c.value:s.programConfigurations.get(t.id).getMaxValue(n)}function od(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function ld(n,t,s,c,p){if(!t[0]&&!t[1])return n;const v=k.convert(t)._mult(p);s==="viewport"&&v._rotate(-c);const x=[];for(let w=0;w<n.length;w++)x.push(n[w].sub(v));return x}let ug,hg;Tt("CircleBucket",Wa,{omit:["layers"]});var r1={get paint(){return hg=hg||new Wn({"circle-radius":new Kt(le.paint_circle["circle-radius"]),"circle-color":new Kt(le.paint_circle["circle-color"]),"circle-blur":new Kt(le.paint_circle["circle-blur"]),"circle-opacity":new Kt(le.paint_circle["circle-opacity"]),"circle-translate":new Ut(le.paint_circle["circle-translate"]),"circle-translate-anchor":new Ut(le.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ut(le.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ut(le.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Kt(le.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Kt(le.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Kt(le.paint_circle["circle-stroke-opacity"])})},get layout(){return ug=ug||new Wn({"circle-sort-key":new Kt(le.layout_circle["circle-sort-key"])})}},Xn=1e-6,Rc=typeof Float32Array<"u"?Float32Array:Array;function Vf(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function dg(n,t,s){var c=t[0],p=t[1],v=t[2],x=t[3],w=t[4],E=t[5],C=t[6],L=t[7],O=t[8],$=t[9],j=t[10],G=t[11],X=t[12],ie=t[13],ue=t[14],Ee=t[15],fe=s[0],xe=s[1],$e=s[2],Ge=s[3];return n[0]=fe*c+xe*w+$e*O+Ge*X,n[1]=fe*p+xe*E+$e*$+Ge*ie,n[2]=fe*v+xe*C+$e*j+Ge*ue,n[3]=fe*x+xe*L+$e*G+Ge*Ee,n[4]=(fe=s[4])*c+(xe=s[5])*w+($e=s[6])*O+(Ge=s[7])*X,n[5]=fe*p+xe*E+$e*$+Ge*ie,n[6]=fe*v+xe*C+$e*j+Ge*ue,n[7]=fe*x+xe*L+$e*G+Ge*Ee,n[8]=(fe=s[8])*c+(xe=s[9])*w+($e=s[10])*O+(Ge=s[11])*X,n[9]=fe*p+xe*E+$e*$+Ge*ie,n[10]=fe*v+xe*C+$e*j+Ge*ue,n[11]=fe*x+xe*L+$e*G+Ge*Ee,n[12]=(fe=s[12])*c+(xe=s[13])*w+($e=s[14])*O+(Ge=s[15])*X,n[13]=fe*p+xe*E+$e*$+Ge*ie,n[14]=fe*v+xe*C+$e*j+Ge*ue,n[15]=fe*x+xe*L+$e*G+Ge*Ee,n}Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var Fu,n1=dg;function cd(n,t,s){var c=t[0],p=t[1],v=t[2],x=t[3];return n[0]=s[0]*c+s[4]*p+s[8]*v+s[12]*x,n[1]=s[1]*c+s[5]*p+s[9]*v+s[13]*x,n[2]=s[2]*c+s[6]*p+s[10]*v+s[14]*x,n[3]=s[3]*c+s[7]*p+s[11]*v+s[15]*x,n}Fu=new Rc(4),Rc!=Float32Array&&(Fu[0]=0,Fu[1]=0,Fu[2]=0,Fu[3]=0);class s1 extends js{constructor(t){super(t,r1)}createBucket(t){return new Wa(t)}queryRadius(t){const s=t;return Ou("circle-radius",this,s)+Ou("circle-stroke-width",this,s)+od(this.paint.get("circle-translate"))}queryIntersectsFeature(t,s,c,p,v,x,w,E){const C=ld(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,w),L=this.paint.get("circle-radius").evaluate(s,c)+this.paint.get("circle-stroke-width").evaluate(s,c),O=this.paint.get("circle-pitch-alignment")==="map",$=O?C:function(G,X){return G.map(ie=>fg(ie,X))}(C,E),j=O?L*w:L;for(const G of p)for(const X of G){const ie=O?X:fg(X,E);let ue=j;const Ee=cd([],[X.x,X.y,0,1],E);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ue*=Ee[3]/x.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ue*=x.cameraToCenterDistance/Ee[3]),ad($,ie,ue))return!0}return!1}}function fg(n,t){const s=cd([],[n.x,n.y,0,1],t);return new k(s[0]/s[3],s[1]/s[3])}class pg extends Wa{}let mg;Tt("HeatmapBucket",pg,{omit:["layers"]});var a1={get paint(){return mg=mg||new Wn({"heatmap-radius":new Kt(le.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Kt(le.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ut(le.paint_heatmap["heatmap-intensity"]),"heatmap-color":new wu(le.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ut(le.paint_heatmap["heatmap-opacity"])})}};function jf(n,{width:t,height:s},c,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==t*s*c)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${t*s*c}`)}else p=new Uint8Array(t*s*c);return n.width=t,n.height=s,n.data=p,n}function gg(n,{width:t,height:s},c){if(t===n.width&&s===n.height)return;const p=jf({},{width:t,height:s},c);qf(n,p,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,t),height:Math.min(n.height,s)},c),n.width=t,n.height=s,n.data=p.data}function qf(n,t,s,c,p,v){if(p.width===0||p.height===0)return t;if(p.width>n.width||p.height>n.height||s.x>n.width-p.width||s.y>n.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>t.width||p.height>t.height||c.x>t.width-p.width||c.y>t.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const x=n.data,w=t.data;if(x===w)throw new Error("srcData equals dstData, so image is already copied");for(let E=0;E<p.height;E++){const C=((s.y+E)*n.width+s.x)*v,L=((c.y+E)*t.width+c.x)*v;for(let O=0;O<p.width*v;O++)w[L+O]=x[C+O]}return t}class Bu{constructor(t,s){jf(this,t,1,s)}resize(t){gg(this,t,1)}clone(){return new Bu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,c,p,v){qf(t,s,c,p,v,1)}}class qs{constructor(t,s){jf(this,t,4,s)}resize(t){gg(this,t,4)}replace(t,s){s?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new qs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,c,p,v){qf(t,s,c,p,v,4)}}function yg(n){const t={},s=n.resolution||256,c=n.clips?n.clips.length:1,p=n.image||new qs({width:s,height:c});if(Math.log(s)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${s}`);const v=(x,w,E)=>{t[n.evaluationKey]=E;const C=n.expression.evaluate(t);p.data[x+w+0]=Math.floor(255*C.r/C.a),p.data[x+w+1]=Math.floor(255*C.g/C.a),p.data[x+w+2]=Math.floor(255*C.b/C.a),p.data[x+w+3]=Math.floor(255*C.a)};if(n.clips)for(let x=0,w=0;x<c;++x,w+=4*s)for(let E=0,C=0;E<s;E++,C+=4){const L=E/(s-1),{start:O,end:$}=n.clips[x];v(w,C,O*(1-L)+$*L)}else for(let x=0,w=0;x<s;x++,w+=4)v(0,w,x/(s-1));return p}Tt("AlphaImage",Bu),Tt("RGBAImage",qs);class o1 extends js{createBucket(t){return new pg(t)}constructor(t){super(t,a1),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=yg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let _g;var l1={get paint(){return _g=_g||new Wn({"hillshade-illumination-direction":new Ut(le.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ut(le.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ut(le.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ut(le.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ut(le.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ut(le.paint_hillshade["hillshade-accent-color"])})}};class c1 extends js{constructor(t){super(t,l1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const u1=qr([{name:"a_pos",components:2,type:"Int16"}],4),{members:h1}=u1;var Gf={exports:{}};function ud(n,t,s){s=s||2;var c,p,v,x,w,E,C,L=t&&t.length,O=L?t[0]*s:n.length,$=vg(n,0,O,s,!0),j=[];if(!$||$.next===$.prev)return j;if(L&&($=function(X,ie,ue,Ee){var fe,xe,$e,Ge=[];for(fe=0,xe=ie.length;fe<xe;fe++)($e=vg(X,ie[fe]*Ee,fe<xe-1?ie[fe+1]*Ee:X.length,Ee,!1))===$e.next&&($e.steiner=!0),Ge.push(v1($e));for(Ge.sort(g1),fe=0;fe<Ge.length;fe++)ue=y1(Ge[fe],ue);return ue}(n,t,$,s)),n.length>80*s){c=v=n[0],p=x=n[1];for(var G=s;G<O;G+=s)(w=n[G])<c&&(c=w),(E=n[G+1])<p&&(p=E),w>v&&(v=w),E>x&&(x=E);C=(C=Math.max(v-c,x-p))!==0?32767/C:0}return Nu($,j,s,c,p,C,0),j}function vg(n,t,s,c,p){var v,x;if(p===Wf(n,t,s,c)>0)for(v=t;v<s;v+=c)x=wg(v,n[v],n[v+1],x);else for(v=s-c;v>=t;v-=c)x=wg(v,n[v],n[v+1],x);return x&&hd(x,x.next)&&(Uu(x),x=x.next),x}function Yl(n,t){if(!n)return n;t||(t=n);var s,c=n;do if(s=!1,c.steiner||!hd(c,c.next)&&Gr(c.prev,c,c.next)!==0)c=c.next;else{if(Uu(c),(c=t=c.prev)===c.next)break;s=!0}while(s||c!==t);return t}function Nu(n,t,s,c,p,v,x){if(n){!x&&v&&function(L,O,$,j){var G=L;do G.z===0&&(G.z=Hf(G.x,G.y,O,$,j)),G.prevZ=G.prev,G.nextZ=G.next,G=G.next;while(G!==L);G.prevZ.nextZ=null,G.prevZ=null,function(X){var ie,ue,Ee,fe,xe,$e,Ge,It,Ot=1;do{for(ue=X,X=null,xe=null,$e=0;ue;){for($e++,Ee=ue,Ge=0,ie=0;ie<Ot&&(Ge++,Ee=Ee.nextZ);ie++);for(It=Ot;Ge>0||It>0&&Ee;)Ge!==0&&(It===0||!Ee||ue.z<=Ee.z)?(fe=ue,ue=ue.nextZ,Ge--):(fe=Ee,Ee=Ee.nextZ,It--),xe?xe.nextZ=fe:X=fe,fe.prevZ=xe,xe=fe;ue=Ee}xe.nextZ=null,Ot*=2}while($e>1)}(G)}(n,c,p,v);for(var w,E,C=n;n.prev!==n.next;)if(w=n.prev,E=n.next,v?f1(n,c,p,v):d1(n))t.push(w.i/s|0),t.push(n.i/s|0),t.push(E.i/s|0),Uu(n),n=E.next,C=E.next;else if((n=E)===C){x?x===1?Nu(n=p1(Yl(n),t,s),t,s,c,p,v,2):x===2&&m1(n,t,s,c,p,v):Nu(Yl(n),t,s,c,p,v,1);break}}}function d1(n){var t=n.prev,s=n,c=n.next;if(Gr(t,s,c)>=0)return!1;for(var p=t.x,v=s.x,x=c.x,w=t.y,E=s.y,C=c.y,L=p<v?p<x?p:x:v<x?v:x,O=w<E?w<C?w:C:E<C?E:C,$=p>v?p>x?p:x:v>x?v:x,j=w>E?w>C?w:C:E>C?E:C,G=c.next;G!==t;){if(G.x>=L&&G.x<=$&&G.y>=O&&G.y<=j&&zc(p,w,v,E,x,C,G.x,G.y)&&Gr(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function f1(n,t,s,c){var p=n.prev,v=n,x=n.next;if(Gr(p,v,x)>=0)return!1;for(var w=p.x,E=v.x,C=x.x,L=p.y,O=v.y,$=x.y,j=w<E?w<C?w:C:E<C?E:C,G=L<O?L<$?L:$:O<$?O:$,X=w>E?w>C?w:C:E>C?E:C,ie=L>O?L>$?L:$:O>$?O:$,ue=Hf(j,G,t,s,c),Ee=Hf(X,ie,t,s,c),fe=n.prevZ,xe=n.nextZ;fe&&fe.z>=ue&&xe&&xe.z<=Ee;){if(fe.x>=j&&fe.x<=X&&fe.y>=G&&fe.y<=ie&&fe!==p&&fe!==x&&zc(w,L,E,O,C,$,fe.x,fe.y)&&Gr(fe.prev,fe,fe.next)>=0||(fe=fe.prevZ,xe.x>=j&&xe.x<=X&&xe.y>=G&&xe.y<=ie&&xe!==p&&xe!==x&&zc(w,L,E,O,C,$,xe.x,xe.y)&&Gr(xe.prev,xe,xe.next)>=0))return!1;xe=xe.nextZ}for(;fe&&fe.z>=ue;){if(fe.x>=j&&fe.x<=X&&fe.y>=G&&fe.y<=ie&&fe!==p&&fe!==x&&zc(w,L,E,O,C,$,fe.x,fe.y)&&Gr(fe.prev,fe,fe.next)>=0)return!1;fe=fe.prevZ}for(;xe&&xe.z<=Ee;){if(xe.x>=j&&xe.x<=X&&xe.y>=G&&xe.y<=ie&&xe!==p&&xe!==x&&zc(w,L,E,O,C,$,xe.x,xe.y)&&Gr(xe.prev,xe,xe.next)>=0)return!1;xe=xe.nextZ}return!0}function p1(n,t,s){var c=n;do{var p=c.prev,v=c.next.next;!hd(p,v)&&xg(p,c,c.next,v)&&$u(p,v)&&$u(v,p)&&(t.push(p.i/s|0),t.push(c.i/s|0),t.push(v.i/s|0),Uu(c),Uu(c.next),c=n=v),c=c.next}while(c!==n);return Yl(c)}function m1(n,t,s,c,p,v){var x=n;do{for(var w=x.next.next;w!==x.prev;){if(x.i!==w.i&&x1(x,w)){var E=bg(x,w);return x=Yl(x,x.next),E=Yl(E,E.next),Nu(x,t,s,c,p,v,0),void Nu(E,t,s,c,p,v,0)}w=w.next}x=x.next}while(x!==n)}function g1(n,t){return n.x-t.x}function y1(n,t){var s=function(p,v){var x,w=v,E=p.x,C=p.y,L=-1/0;do{if(C<=w.y&&C>=w.next.y&&w.next.y!==w.y){var O=w.x+(C-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(O<=E&&O>L&&(L=O,x=w.x<w.next.x?w:w.next,O===E))return x}w=w.next}while(w!==v);if(!x)return null;var $,j=x,G=x.x,X=x.y,ie=1/0;w=x;do E>=w.x&&w.x>=G&&E!==w.x&&zc(C<X?E:L,C,G,X,C<X?L:E,C,w.x,w.y)&&($=Math.abs(C-w.y)/(E-w.x),$u(w,p)&&($<ie||$===ie&&(w.x>x.x||w.x===x.x&&_1(x,w)))&&(x=w,ie=$)),w=w.next;while(w!==j);return x}(n,t);if(!s)return t;var c=bg(s,n);return Yl(c,c.next),Yl(s,s.next)}function _1(n,t){return Gr(n.prev,n,t.prev)<0&&Gr(t.next,n,n.next)<0}function Hf(n,t,s,c,p){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-s)*p|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-c)*p|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function v1(n){var t=n,s=n;do(t.x<s.x||t.x===s.x&&t.y<s.y)&&(s=t),t=t.next;while(t!==n);return s}function zc(n,t,s,c,p,v,x,w){return(p-x)*(t-w)>=(n-x)*(v-w)&&(n-x)*(c-w)>=(s-x)*(t-w)&&(s-x)*(v-w)>=(p-x)*(c-w)}function x1(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!function(s,c){var p=s;do{if(p.i!==s.i&&p.next.i!==s.i&&p.i!==c.i&&p.next.i!==c.i&&xg(p,p.next,s,c))return!0;p=p.next}while(p!==s);return!1}(n,t)&&($u(n,t)&&$u(t,n)&&function(s,c){var p=s,v=!1,x=(s.x+c.x)/2,w=(s.y+c.y)/2;do p.y>w!=p.next.y>w&&p.next.y!==p.y&&x<(p.next.x-p.x)*(w-p.y)/(p.next.y-p.y)+p.x&&(v=!v),p=p.next;while(p!==s);return v}(n,t)&&(Gr(n.prev,n,t.prev)||Gr(n,t.prev,t))||hd(n,t)&&Gr(n.prev,n,n.next)>0&&Gr(t.prev,t,t.next)>0)}function Gr(n,t,s){return(t.y-n.y)*(s.x-t.x)-(t.x-n.x)*(s.y-t.y)}function hd(n,t){return n.x===t.x&&n.y===t.y}function xg(n,t,s,c){var p=fd(Gr(n,t,s)),v=fd(Gr(n,t,c)),x=fd(Gr(s,c,n)),w=fd(Gr(s,c,t));return p!==v&&x!==w||!(p!==0||!dd(n,s,t))||!(v!==0||!dd(n,c,t))||!(x!==0||!dd(s,n,c))||!(w!==0||!dd(s,t,c))}function dd(n,t,s){return t.x<=Math.max(n.x,s.x)&&t.x>=Math.min(n.x,s.x)&&t.y<=Math.max(n.y,s.y)&&t.y>=Math.min(n.y,s.y)}function fd(n){return n>0?1:n<0?-1:0}function $u(n,t){return Gr(n.prev,n,n.next)<0?Gr(n,t,n.next)>=0&&Gr(n,n.prev,t)>=0:Gr(n,t,n.prev)<0||Gr(n,n.next,t)<0}function bg(n,t){var s=new Zf(n.i,n.x,n.y),c=new Zf(t.i,t.x,t.y),p=n.next,v=t.prev;return n.next=t,t.prev=n,s.next=p,p.prev=s,c.next=s,s.prev=c,v.next=c,c.prev=v,c}function wg(n,t,s,c){var p=new Zf(n,t,s);return c?(p.next=c.next,p.prev=c,c.next.prev=p,c.next=p):(p.prev=p,p.next=p),p}function Uu(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Zf(n,t,s){this.i=n,this.x=t,this.y=s,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Wf(n,t,s,c){for(var p=0,v=t,x=s-c;v<s;v+=c)p+=(n[x]-n[v])*(n[v+1]+n[x+1]),x=v;return p}Gf.exports=ud,Gf.exports.default=ud,ud.deviation=function(n,t,s,c){var p=t&&t.length,v=Math.abs(Wf(n,0,p?t[0]*s:n.length,s));if(p)for(var x=0,w=t.length;x<w;x++)v-=Math.abs(Wf(n,t[x]*s,x<w-1?t[x+1]*s:n.length,s));var E=0;for(x=0;x<c.length;x+=3){var C=c[x]*s,L=c[x+1]*s,O=c[x+2]*s;E+=Math.abs((n[C]-n[O])*(n[L+1]-n[C+1])-(n[C]-n[L])*(n[O+1]-n[C+1]))}return v===0&&E===0?0:Math.abs((E-v)/v)},ud.flatten=function(n){for(var t=n[0][0].length,s={vertices:[],holes:[],dimensions:t},c=0,p=0;p<n.length;p++){for(var v=0;v<n[p].length;v++)for(var x=0;x<t;x++)s.vertices.push(n[p][v][x]);p>0&&s.holes.push(c+=n[p-1].length)}return s};var Mg=T(Gf.exports);function b1(n,t,s,c,p){Sg(n,t,s||0,c||n.length-1,p||w1)}function Sg(n,t,s,c,p){for(;c>s;){if(c-s>600){var v=c-s+1,x=t-s+1,w=Math.log(v),E=.5*Math.exp(2*w/3),C=.5*Math.sqrt(w*E*(v-E)/v)*(x-v/2<0?-1:1);Sg(n,t,Math.max(s,Math.floor(t-x*E/v+C)),Math.min(c,Math.floor(t+(v-x)*E/v+C)),p)}var L=n[t],O=s,$=c;for(Vu(n,s,t),p(n[c],L)>0&&Vu(n,s,c);O<$;){for(Vu(n,O,$),O++,$--;p(n[O],L)<0;)O++;for(;p(n[$],L)>0;)$--}p(n[s],L)===0?Vu(n,s,$):Vu(n,++$,c),$<=t&&(s=$+1),t<=$&&(c=$-1)}}function Vu(n,t,s){var c=n[t];n[t]=n[s],n[s]=c}function w1(n,t){return n<t?-1:n>t?1:0}function Xf(n,t){const s=n.length;if(s<=1)return[n];const c=[];let p,v;for(let x=0;x<s;x++){const w=cr(n[x]);w!==0&&(n[x].area=Math.abs(w),v===void 0&&(v=w<0),v===w<0?(p&&c.push(p),p=[n[x]]):p.push(n[x]))}if(p&&c.push(p),t>1)for(let x=0;x<c.length;x++)c[x].length<=t||(b1(c[x],t,1,c[x].length-1,M1),c[x]=c[x].slice(0,t));return c}function M1(n,t){return t.area-n.area}function Kf(n,t,s){const c=s.patternDependencies;let p=!1;for(const v of t){const x=v.paint.get(`${n}-pattern`);x.isConstant()||(p=!0);const w=x.constantOr(null);w&&(p=!0,c[w.to]=!0,c[w.from]=!0)}return p}function Yf(n,t,s,c,p){const v=p.patternDependencies;for(const x of t){const w=x.paint.get(`${n}-pattern`).value;if(w.kind!=="constant"){let E=w.evaluate({zoom:c-1},s,{},p.availableImages),C=w.evaluate({zoom:c},s,{},p.availableImages),L=w.evaluate({zoom:c+1},s,{},p.availableImages);E=E&&E.name?E.name:E,C=C&&C.name?C.name:C,L=L&&L.name?L.name:L,v[E]=!0,v[C]=!0,v[L]=!0,s.patterns[x.id]={min:E,mid:C,max:L}}}return s}class Jf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new te,this.indexArray=new ze,this.indexArray2=new Xe,this.programConfigurations=new Cr(t.layers,t.zoom),this.segments=new dt,this.segments2=new dt,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,c){this.hasPattern=Kf("fill",this.layers,s);const p=this.layers[0].layout.get("fill-sort-key"),v=!p.isConstant(),x=[];for(const{feature:w,id:E,index:C,sourceLayerIndex:L}of t){const O=this.layers[0]._featureFilter.needGeometry,$=Mo(w,O);if(!this.layers[0]._featureFilter.filter(new vr(this.zoom),$,c))continue;const j=v?p.evaluate($,{},c,s.availableImages):void 0,G={id:E,properties:w.properties,type:w.type,sourceLayerIndex:L,index:C,geometry:O?$.geometry:wo(w),patterns:{},sortKey:j};x.push(G)}v&&x.sort((w,E)=>w.sortKey-E.sortKey);for(const w of x){const{geometry:E,index:C,sourceLayerIndex:L}=w;if(this.hasPattern){const O=Yf("fill",this.layers,w,this.zoom,s);this.patternFeatures.push(O)}else this.addFeature(w,E,C,c,{});s.featureIndex.insert(t[C].feature,E,C,L,this.index)}}update(t,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,c)}addFeatures(t,s,c){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,s,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,h1),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,s,c,p,v){for(const x of Xf(s,500)){let w=0;for(const j of x)w+=j.length;const E=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),C=E.vertexLength,L=[],O=[];for(const j of x){if(j.length===0)continue;j!==x[0]&&O.push(L.length/2);const G=this.segments2.prepareSegment(j.length,this.layoutVertexArray,this.indexArray2),X=G.vertexLength;this.layoutVertexArray.emplaceBack(j[0].x,j[0].y),this.indexArray2.emplaceBack(X+j.length-1,X),L.push(j[0].x),L.push(j[0].y);for(let ie=1;ie<j.length;ie++)this.layoutVertexArray.emplaceBack(j[ie].x,j[ie].y),this.indexArray2.emplaceBack(X+ie-1,X+ie),L.push(j[ie].x),L.push(j[ie].y);G.vertexLength+=j.length,G.primitiveLength+=j.length}const $=Mg(L,O);for(let j=0;j<$.length;j+=3)this.indexArray.emplaceBack(C+$[j],C+$[j+1],C+$[j+2]);E.vertexLength+=w,E.primitiveLength+=$.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,v,p)}}let Eg,Tg;Tt("FillBucket",Jf,{omit:["layers","patternFeatures"]});var S1={get paint(){return Tg=Tg||new Wn({"fill-antialias":new Ut(le.paint_fill["fill-antialias"]),"fill-opacity":new Kt(le.paint_fill["fill-opacity"]),"fill-color":new Kt(le.paint_fill["fill-color"]),"fill-outline-color":new Kt(le.paint_fill["fill-outline-color"]),"fill-translate":new Ut(le.paint_fill["fill-translate"]),"fill-translate-anchor":new Ut(le.paint_fill["fill-translate-anchor"]),"fill-pattern":new Mc(le.paint_fill["fill-pattern"])})},get layout(){return Eg=Eg||new Wn({"fill-sort-key":new Kt(le.layout_fill["fill-sort-key"])})}};class E1 extends js{constructor(t){super(t,S1)}recalculate(t,s){super.recalculate(t,s);const c=this.paint._values["fill-outline-color"];c.value.kind==="constant"&&c.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Jf(t)}queryRadius(){return od(this.paint.get("fill-translate"))}queryIntersectsFeature(t,s,c,p,v,x,w){return Lu(ld(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,w),p)}isTileClipped(){return!0}}const T1=qr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),I1=qr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:C1}=T1;var nl={},A1=P,Ig=Oc;function Oc(n,t,s,c,p){this.properties={},this.extent=s,this.type=0,this._pbf=n,this._geometry=-1,this._keys=c,this._values=p,n.readFields(P1,this,t)}function P1(n,t,s){n==1?t.id=s.readVarint():n==2?function(c,p){for(var v=c.readVarint()+c.pos;c.pos<v;){var x=p._keys[c.readVarint()],w=p._values[c.readVarint()];p.properties[x]=w}}(s,t):n==3?t.type=s.readVarint():n==4&&(t._geometry=s.pos)}function k1(n){for(var t,s,c=0,p=0,v=n.length,x=v-1;p<v;x=p++)c+=((s=n[x]).x-(t=n[p]).x)*(t.y+s.y);return c}Oc.types=["Unknown","Point","LineString","Polygon"],Oc.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var t,s=n.readVarint()+n.pos,c=1,p=0,v=0,x=0,w=[];n.pos<s;){if(p<=0){var E=n.readVarint();c=7&E,p=E>>3}if(p--,c===1||c===2)v+=n.readSVarint(),x+=n.readSVarint(),c===1&&(t&&w.push(t),t=[]),t.push(new A1(v,x));else{if(c!==7)throw new Error("unknown command "+c);t&&t.push(t[0].clone())}}return t&&w.push(t),w},Oc.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var t=n.readVarint()+n.pos,s=1,c=0,p=0,v=0,x=1/0,w=-1/0,E=1/0,C=-1/0;n.pos<t;){if(c<=0){var L=n.readVarint();s=7&L,c=L>>3}if(c--,s===1||s===2)(p+=n.readSVarint())<x&&(x=p),p>w&&(w=p),(v+=n.readSVarint())<E&&(E=v),v>C&&(C=v);else if(s!==7)throw new Error("unknown command "+s)}return[x,E,w,C]},Oc.prototype.toGeoJSON=function(n,t,s){var c,p,v=this.extent*Math.pow(2,s),x=this.extent*n,w=this.extent*t,E=this.loadGeometry(),C=Oc.types[this.type];function L(j){for(var G=0;G<j.length;G++){var X=j[G];j[G]=[360*(X.x+x)/v-180,360/Math.PI*Math.atan(Math.exp((180-360*(X.y+w)/v)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(c=0;c<E.length;c++)O[c]=E[c][0];L(E=O);break;case 2:for(c=0;c<E.length;c++)L(E[c]);break;case 3:for(E=function(j){var G=j.length;if(G<=1)return[j];for(var X,ie,ue=[],Ee=0;Ee<G;Ee++){var fe=k1(j[Ee]);fe!==0&&(ie===void 0&&(ie=fe<0),ie===fe<0?(X&&ue.push(X),X=[j[Ee]]):X.push(j[Ee]))}return X&&ue.push(X),ue}(E),c=0;c<E.length;c++)for(p=0;p<E[c].length;p++)L(E[c][p])}E.length===1?E=E[0]:C="Multi"+C;var $={type:"Feature",geometry:{type:C,coordinates:E},properties:this.properties};return"id"in this&&($.id=this.id),$};var D1=Ig,Cg=Ag;function Ag(n,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(L1,this,t),this.length=this._features.length}function L1(n,t,s){n===15?t.version=s.readVarint():n===1?t.name=s.readString():n===5?t.extent=s.readVarint():n===2?t._features.push(s.pos):n===3?t._keys.push(s.readString()):n===4&&t._values.push(function(c){for(var p=null,v=c.readVarint()+c.pos;c.pos<v;){var x=c.readVarint()>>3;p=x===1?c.readString():x===2?c.readFloat():x===3?c.readDouble():x===4?c.readVarint64():x===5?c.readVarint():x===6?c.readSVarint():x===7?c.readBoolean():null}return p}(s))}Ag.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var t=this._pbf.readVarint()+this._pbf.pos;return new D1(this._pbf,t,this.extent,this._keys,this._values)};var R1=Cg;function z1(n,t,s){if(n===3){var c=new R1(s,s.readVarint()+s.pos);c.length&&(t[c.name]=c)}}nl.VectorTile=function(n,t){this.layers=n.readFields(z1,{},t)},nl.VectorTileFeature=Ig,nl.VectorTileLayer=Cg;const O1=nl.VectorTileFeature.types,Qf=Math.pow(2,13);function ju(n,t,s,c,p,v,x,w){n.emplaceBack(t,s,2*Math.floor(c*Qf)+x,p*Qf*2,v*Qf*2,Math.round(w))}class ep{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Q,this.centroidVertexArray=new B,this.indexArray=new ze,this.programConfigurations=new Cr(t.layers,t.zoom),this.segments=new dt,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,c){this.features=[],this.hasPattern=Kf("fill-extrusion",this.layers,s);for(const{feature:p,id:v,index:x,sourceLayerIndex:w}of t){const E=this.layers[0]._featureFilter.needGeometry,C=Mo(p,E);if(!this.layers[0]._featureFilter.filter(new vr(this.zoom),C,c))continue;const L={id:v,sourceLayerIndex:w,index:x,geometry:E?C.geometry:wo(p),properties:p.properties,type:p.type,patterns:{}};this.hasPattern?this.features.push(Yf("fill-extrusion",this.layers,L,this.zoom,s)):this.addFeature(L,L.geometry,x,c,{}),s.featureIndex.insert(p,L.geometry,x,w,this.index,!0)}}addFeatures(t,s,c){for(const p of this.features){const{geometry:v}=p;this.addFeature(p,v,p.index,s,c)}}update(t,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,c)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,C1),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,I1.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,s,c,p,v){const x={x:0,y:0,vertexCount:0};for(const w of Xf(s,500)){let E=0;for(const G of w)E+=G.length;let C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const G of w){if(G.length===0||B1(G))continue;let X=0;for(let ie=0;ie<G.length;ie++){const ue=G[ie];if(ie>=1){const Ee=G[ie-1];if(!F1(ue,Ee)){C.vertexLength+4>dt.MAX_VERTEX_ARRAY_LENGTH&&(C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const fe=ue.sub(Ee)._perp()._unit(),xe=Ee.dist(ue);X+xe>32768&&(X=0),ju(this.layoutVertexArray,ue.x,ue.y,fe.x,fe.y,0,0,X),ju(this.layoutVertexArray,ue.x,ue.y,fe.x,fe.y,0,1,X),x.x+=2*ue.x,x.y+=2*ue.y,x.vertexCount+=2,X+=xe,ju(this.layoutVertexArray,Ee.x,Ee.y,fe.x,fe.y,0,0,X),ju(this.layoutVertexArray,Ee.x,Ee.y,fe.x,fe.y,0,1,X),x.x+=2*Ee.x,x.y+=2*Ee.y,x.vertexCount+=2;const $e=C.vertexLength;this.indexArray.emplaceBack($e,$e+2,$e+1),this.indexArray.emplaceBack($e+1,$e+2,$e+3),C.vertexLength+=4,C.primitiveLength+=2}}}}if(C.vertexLength+E>dt.MAX_VERTEX_ARRAY_LENGTH&&(C=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray)),O1[t.type]!=="Polygon")continue;const L=[],O=[],$=C.vertexLength;for(const G of w)if(G.length!==0){G!==w[0]&&O.push(L.length/2);for(let X=0;X<G.length;X++){const ie=G[X];ju(this.layoutVertexArray,ie.x,ie.y,0,0,1,1,0),x.x+=ie.x,x.y+=ie.y,x.vertexCount+=1,L.push(ie.x),L.push(ie.y)}}const j=Mg(L,O);for(let G=0;G<j.length;G+=3)this.indexArray.emplaceBack($+j[G],$+j[G+2],$+j[G+1]);C.primitiveLength+=j.length/3,C.vertexLength+=E}for(let w=0;w<x.vertexCount;w++)this.centroidVertexArray.emplaceBack(Math.floor(x.x/x.vertexCount),Math.floor(x.y/x.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,v,p)}}function F1(n,t){return n.x===t.x&&(n.x<0||n.x>Nr)||n.y===t.y&&(n.y<0||n.y>Nr)}function B1(n){return n.every(t=>t.x<0)||n.every(t=>t.x>Nr)||n.every(t=>t.y<0)||n.every(t=>t.y>Nr)}let Pg;Tt("FillExtrusionBucket",ep,{omit:["layers","features"]});var N1={get paint(){return Pg=Pg||new Wn({"fill-extrusion-opacity":new Ut(le["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Kt(le["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ut(le["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ut(le["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Mc(le["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Kt(le["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Kt(le["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ut(le["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class $1 extends js{constructor(t){super(t,N1)}createBucket(t){return new ep(t)}queryRadius(){return od(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,s,c,p,v,x,w,E){const C=ld(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,w),L=this.paint.get("fill-extrusion-height").evaluate(s,c),O=this.paint.get("fill-extrusion-base").evaluate(s,c),$=function(G,X,ie,ue){const Ee=[];for(const fe of G){const xe=[fe.x,fe.y,0,1];cd(xe,xe,X),Ee.push(new k(xe[0]/xe[3],xe[1]/xe[3]))}return Ee}(C,E),j=function(G,X,ie,ue){const Ee=[],fe=[],xe=ue[8]*X,$e=ue[9]*X,Ge=ue[10]*X,It=ue[11]*X,Ot=ue[8]*ie,St=ue[9]*ie,xt=ue[10]*ie,ct=ue[11]*ie;for(const kt of G){const _t=[],tt=[];for(const Xt of kt){const Nt=Xt.x,Mi=Xt.y,mr=ue[0]*Nt+ue[4]*Mi+ue[12],br=ue[1]*Nt+ue[5]*Mi+ue[13],an=ue[2]*Nt+ue[6]*Mi+ue[14],Es=ue[3]*Nt+ue[7]*Mi+ue[15],Kn=an+Ge,Yr=Es+It,Sn=mr+Ot,kn=br+St,Yn=an+xt,Jn=Es+ct,on=new k((mr+xe)/Yr,(br+$e)/Yr);on.z=Kn/Yr,_t.push(on);const ln=new k(Sn/Jn,kn/Jn);ln.z=Yn/Jn,tt.push(ln)}Ee.push(_t),fe.push(tt)}return[Ee,fe]}(p,O,L,E);return function(G,X,ie){let ue=1/0;Lu(ie,X)&&(ue=kg(ie,X[0]));for(let Ee=0;Ee<X.length;Ee++){const fe=X[Ee],xe=G[Ee];for(let $e=0;$e<fe.length-1;$e++){const Ge=fe[$e],It=[Ge,fe[$e+1],xe[$e+1],xe[$e],Ge];Du(ie,It)&&(ue=Math.min(ue,kg(ie,It)))}}return ue!==1/0&&ue}(j[0],j[1],$)}}function qu(n,t){return n.x*t.x+n.y*t.y}function kg(n,t){if(n.length===1){let s=0;const c=t[s++];let p;for(;!p||c.equals(p);)if(p=t[s++],!p)return 1/0;for(;s<t.length;s++){const v=t[s],x=n[0],w=p.sub(c),E=v.sub(c),C=x.sub(c),L=qu(w,w),O=qu(w,E),$=qu(E,E),j=qu(C,w),G=qu(C,E),X=L*$-O*O,ie=($*j-O*G)/X,ue=(L*G-O*j)/X,Ee=c.z*(1-ie-ue)+p.z*ie+v.z*ue;if(isFinite(Ee))return Ee}return 1/0}{let s=1/0;for(const c of t)s=Math.min(s,c.z);return s}}const U1=qr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:V1}=U1,j1=qr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:q1}=j1,G1=nl.VectorTileFeature.types,H1=Math.cos(Math.PI/180*37.5),Dg=Math.pow(2,14)/.5;class tp{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new re,this.layoutVertexArray2=new W,this.indexArray=new ze,this.programConfigurations=new Cr(t.layers,t.zoom),this.segments=new dt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,c){this.hasPattern=Kf("line",this.layers,s);const p=this.layers[0].layout.get("line-sort-key"),v=!p.isConstant(),x=[];for(const{feature:w,id:E,index:C,sourceLayerIndex:L}of t){const O=this.layers[0]._featureFilter.needGeometry,$=Mo(w,O);if(!this.layers[0]._featureFilter.filter(new vr(this.zoom),$,c))continue;const j=v?p.evaluate($,{},c):void 0,G={id:E,properties:w.properties,type:w.type,sourceLayerIndex:L,index:C,geometry:O?$.geometry:wo(w),patterns:{},sortKey:j};x.push(G)}v&&x.sort((w,E)=>w.sortKey-E.sortKey);for(const w of x){const{geometry:E,index:C,sourceLayerIndex:L}=w;if(this.hasPattern){const O=Yf("line",this.layers,w,this.zoom,s);this.patternFeatures.push(O)}else this.addFeature(w,E,C,c,{});s.featureIndex.insert(t[C].feature,E,C,L,this.index)}}update(t,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,c)}addFeatures(t,s,c){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,s,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,q1)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,V1),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,s,c,p,v){const x=this.layers[0].layout,w=x.get("line-join").evaluate(t,{}),E=x.get("line-cap"),C=x.get("line-miter-limit"),L=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const O of s)this.addLine(O,t,w,E,C,L);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,v,p)}addLine(t,s,c,p,v,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ue=0;ue<t.length-1;ue++)this.totalDistance+=t[ue].dist(t[ue+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w=G1[s.type]==="Polygon";let E=t.length;for(;E>=2&&t[E-1].equals(t[E-2]);)E--;let C=0;for(;C<E-1&&t[C].equals(t[C+1]);)C++;if(E<(w?3:2))return;c==="bevel"&&(v=1.05);const L=this.overscaling<=16?15*Nr/(512*this.overscaling):0,O=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let $,j,G,X,ie;this.e1=this.e2=-1,w&&($=t[E-2],ie=t[C].sub($)._unit()._perp());for(let ue=C;ue<E;ue++){if(G=ue===E-1?w?t[C+1]:void 0:t[ue+1],G&&t[ue].equals(G))continue;ie&&(X=ie),$&&(j=$),$=t[ue],ie=G?G.sub($)._unit()._perp():X,X=X||ie;let Ee=X.add(ie);Ee.x===0&&Ee.y===0||Ee._unit();const fe=X.x*ie.x+X.y*ie.y,xe=Ee.x*ie.x+Ee.y*ie.y,$e=xe!==0?1/xe:1/0,Ge=2*Math.sqrt(2-2*xe),It=xe<H1&&j&&G,Ot=X.x*ie.y-X.y*ie.x>0;if(It&&ue>C){const ct=$.dist(j);if(ct>2*L){const kt=$.sub($.sub(j)._mult(L/ct)._round());this.updateDistance(j,kt),this.addCurrentVertex(kt,X,0,0,O),j=kt}}const St=j&&G;let xt=St?c:w?"butt":p;if(St&&xt==="round"&&($e<x?xt="miter":$e<=2&&(xt="fakeround")),xt==="miter"&&$e>v&&(xt="bevel"),xt==="bevel"&&($e>2&&(xt="flipbevel"),$e<v&&(xt="miter")),j&&this.updateDistance(j,$),xt==="miter")Ee._mult($e),this.addCurrentVertex($,Ee,0,0,O);else if(xt==="flipbevel"){if($e>100)Ee=ie.mult(-1);else{const ct=$e*X.add(ie).mag()/X.sub(ie).mag();Ee._perp()._mult(ct*(Ot?-1:1))}this.addCurrentVertex($,Ee,0,0,O),this.addCurrentVertex($,Ee.mult(-1),0,0,O)}else if(xt==="bevel"||xt==="fakeround"){const ct=-Math.sqrt($e*$e-1),kt=Ot?ct:0,_t=Ot?0:ct;if(j&&this.addCurrentVertex($,X,kt,_t,O),xt==="fakeround"){const tt=Math.round(180*Ge/Math.PI/20);for(let Xt=1;Xt<tt;Xt++){let Nt=Xt/tt;if(Nt!==.5){const mr=Nt-.5;Nt+=Nt*mr*(Nt-1)*((1.0904+fe*(fe*(3.55645-1.43519*fe)-3.2452))*mr*mr+(.848013+fe*(.215638*fe-1.06021)))}const Mi=ie.sub(X)._mult(Nt)._add(X)._unit()._mult(Ot?-1:1);this.addHalfVertex($,Mi.x,Mi.y,!1,Ot,0,O)}}G&&this.addCurrentVertex($,ie,-kt,-_t,O)}else if(xt==="butt")this.addCurrentVertex($,Ee,0,0,O);else if(xt==="square"){const ct=j?1:-1;this.addCurrentVertex($,Ee,ct,ct,O)}else xt==="round"&&(j&&(this.addCurrentVertex($,X,0,0,O),this.addCurrentVertex($,X,1,1,O,!0)),G&&(this.addCurrentVertex($,ie,-1,-1,O,!0),this.addCurrentVertex($,ie,0,0,O)));if(It&&ue<E-1){const ct=$.dist(G);if(ct>2*L){const kt=$.add(G.sub($)._mult(L/ct)._round());this.updateDistance($,kt),this.addCurrentVertex(kt,ie,0,0,O),$=kt}}}}addCurrentVertex(t,s,c,p,v,x=!1){const w=s.y*p-s.x,E=-s.y-s.x*p;this.addHalfVertex(t,s.x+s.y*c,s.y-s.x*c,x,!1,c,v),this.addHalfVertex(t,w,E,x,!0,-p,v),this.distance>Dg/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,s,c,p,v,x))}addHalfVertex({x:t,y:s},c,p,v,x,w,E){const C=.5*(this.lineClips?this.scaledDistance*(Dg-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(v?1:0),(s<<1)+(x?1:0),Math.round(63*c)+128,Math.round(63*p)+128,1+(w===0?0:w<0?-1:1)|(63&C)<<2,C>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const L=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,L),E.primitiveLength++),x?this.e2=L:this.e1=L}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,s){this.distance+=t.dist(s),this.updateScaledDistance()}}let Lg,Rg;Tt("LineBucket",tp,{omit:["layers","patternFeatures"]});var zg={get paint(){return Rg=Rg||new Wn({"line-opacity":new Kt(le.paint_line["line-opacity"]),"line-color":new Kt(le.paint_line["line-color"]),"line-translate":new Ut(le.paint_line["line-translate"]),"line-translate-anchor":new Ut(le.paint_line["line-translate-anchor"]),"line-width":new Kt(le.paint_line["line-width"]),"line-gap-width":new Kt(le.paint_line["line-gap-width"]),"line-offset":new Kt(le.paint_line["line-offset"]),"line-blur":new Kt(le.paint_line["line-blur"]),"line-dasharray":new ql(le.paint_line["line-dasharray"]),"line-pattern":new Mc(le.paint_line["line-pattern"]),"line-gradient":new wu(le.paint_line["line-gradient"])})},get layout(){return Lg=Lg||new Wn({"line-cap":new Ut(le.layout_line["line-cap"]),"line-join":new Kt(le.layout_line["line-join"]),"line-miter-limit":new Ut(le.layout_line["line-miter-limit"]),"line-round-limit":new Ut(le.layout_line["line-round-limit"]),"line-sort-key":new Kt(le.layout_line["line-sort-key"])})}};class Z1 extends Kt{possiblyEvaluate(t,s){return s=new vr(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,zoomHistory:s.zoomHistory,transition:s.transition}),super.possiblyEvaluate(t,s)}evaluate(t,s,c,p){return s=bt({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(t,s,c,p)}}let pd;class W1 extends js{constructor(t){super(t,zg),this.gradientVersion=0,pd||(pd=new Z1(zg.paint.properties["line-width"].specification),pd.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const s=this.gradientExpression();this.stepInterpolant=!!function(c){return c._styleExpression!==void 0}(s)&&s._styleExpression.expression instanceof Ba,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,s){super.recalculate(t,s),this.paint._values["line-floorwidth"]=pd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new tp(t)}queryRadius(t){const s=t,c=Og(Ou("line-width",this,s),Ou("line-gap-width",this,s)),p=Ou("line-offset",this,s);return c/2+Math.abs(p)+od(this.paint.get("line-translate"))}queryIntersectsFeature(t,s,c,p,v,x,w){const E=ld(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,w),C=w/2*Og(this.paint.get("line-width").evaluate(s,c),this.paint.get("line-gap-width").evaluate(s,c)),L=this.paint.get("line-offset").evaluate(s,c);return L&&(p=function(O,$){const j=[];for(let G=0;G<O.length;G++){const X=O[G],ie=[];for(let ue=0;ue<X.length;ue++){const Ee=X[ue-1],fe=X[ue],xe=X[ue+1],$e=ue===0?new k(0,0):fe.sub(Ee)._unit()._perp(),Ge=ue===X.length-1?new k(0,0):xe.sub(fe)._unit()._perp(),It=$e._add(Ge)._unit(),Ot=It.x*Ge.x+It.y*Ge.y;Ot!==0&&It._mult(1/Ot),ie.push(It._mult($)._add(fe))}j.push(ie)}return j}(p,L*w)),function(O,$,j){for(let G=0;G<$.length;G++){const X=$[G];if(O.length>=3){for(let ie=0;ie<X.length;ie++)if(Lc(O,X[ie]))return!0}if(Ru(O,X,j))return!0}return!1}(E,p,C)}isTileClipped(){return!0}}function Og(n,t){return t>0?t+2*n:n}const X1=qr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),K1=qr([{name:"a_projected_pos",components:3,type:"Float32"}],4);qr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Y1=qr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);qr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Fg=qr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),J1=qr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Q1(n,t,s){return n.sections.forEach(c=>{c.text=function(p,v,x){const w=v.layout.get("text-transform").evaluate(x,{});return w==="uppercase"?p=p.toLocaleUpperCase():w==="lowercase"&&(p=p.toLocaleLowerCase()),Ga.applyArabicShaping&&(p=Ga.applyArabicShaping(p)),p}(c.text,t,s)}),n}qr([{name:"triangle",components:3,type:"Uint16"}]),qr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),qr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),qr([{type:"Float32",name:"offsetX"}]),qr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),qr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Gu={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var sn=24,Bg=Qi,Ng=function(n,t,s,c,p){var v,x,w=8*p-c-1,E=(1<<w)-1,C=E>>1,L=-7,O=s?p-1:0,$=s?-1:1,j=n[t+O];for(O+=$,v=j&(1<<-L)-1,j>>=-L,L+=w;L>0;v=256*v+n[t+O],O+=$,L-=8);for(x=v&(1<<-L)-1,v>>=-L,L+=c;L>0;x=256*x+n[t+O],O+=$,L-=8);if(v===0)v=1-C;else{if(v===E)return x?NaN:1/0*(j?-1:1);x+=Math.pow(2,c),v-=C}return(j?-1:1)*x*Math.pow(2,v-c)},$g=function(n,t,s,c,p,v){var x,w,E,C=8*v-p-1,L=(1<<C)-1,O=L>>1,$=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,j=c?0:v-1,G=c?1:-1,X=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(w=isNaN(t)?1:0,x=L):(x=Math.floor(Math.log(t)/Math.LN2),t*(E=Math.pow(2,-x))<1&&(x--,E*=2),(t+=x+O>=1?$/E:$*Math.pow(2,1-O))*E>=2&&(x++,E/=2),x+O>=L?(w=0,x=L):x+O>=1?(w=(t*E-1)*Math.pow(2,p),x+=O):(w=t*Math.pow(2,O-1)*Math.pow(2,p),x=0));p>=8;n[s+j]=255&w,j+=G,w/=256,p-=8);for(x=x<<p|w,C+=p;C>0;n[s+j]=255&x,j+=G,x/=256,C-=8);n[s+j-G]|=128*X};function Qi(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}Qi.Varint=0,Qi.Fixed64=1,Qi.Bytes=2,Qi.Fixed32=5;var ip=4294967296,Ug=1/ip,Vg=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function So(n){return n.type===Qi.Bytes?n.readVarint()+n.pos:n.pos+1}function Fc(n,t,s){return s?4294967296*t+(n>>>0):4294967296*(t>>>0)+(n>>>0)}function jg(n,t,s){var c=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));s.realloc(c);for(var p=s.pos-1;p>=n;p--)s.buf[p+c]=s.buf[p]}function eb(n,t){for(var s=0;s<n.length;s++)t.writeVarint(n[s])}function tb(n,t){for(var s=0;s<n.length;s++)t.writeSVarint(n[s])}function ib(n,t){for(var s=0;s<n.length;s++)t.writeFloat(n[s])}function rb(n,t){for(var s=0;s<n.length;s++)t.writeDouble(n[s])}function nb(n,t){for(var s=0;s<n.length;s++)t.writeBoolean(n[s])}function sb(n,t){for(var s=0;s<n.length;s++)t.writeFixed32(n[s])}function ab(n,t){for(var s=0;s<n.length;s++)t.writeSFixed32(n[s])}function ob(n,t){for(var s=0;s<n.length;s++)t.writeFixed64(n[s])}function lb(n,t){for(var s=0;s<n.length;s++)t.writeSFixed64(n[s])}function md(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+16777216*n[t+3]}function Bc(n,t,s){n[s]=t,n[s+1]=t>>>8,n[s+2]=t>>>16,n[s+3]=t>>>24}function qg(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+(n[t+3]<<24)}Qi.prototype={destroy:function(){this.buf=null},readFields:function(n,t,s){for(s=s||this.length;this.pos<s;){var c=this.readVarint(),p=c>>3,v=this.pos;this.type=7&c,n(p,t,this),this.pos===v&&this.skip(c)}return t},readMessage:function(n,t){return this.readFields(n,t,this.readVarint()+this.pos)},readFixed32:function(){var n=md(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=qg(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=md(this.buf,this.pos)+md(this.buf,this.pos+4)*ip;return this.pos+=8,n},readSFixed64:function(){var n=md(this.buf,this.pos)+qg(this.buf,this.pos+4)*ip;return this.pos+=8,n},readFloat:function(){var n=Ng(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=Ng(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var t,s,c=this.buf;return t=127&(s=c[this.pos++]),s<128?t:(t|=(127&(s=c[this.pos++]))<<7,s<128?t:(t|=(127&(s=c[this.pos++]))<<14,s<128?t:(t|=(127&(s=c[this.pos++]))<<21,s<128?t:function(p,v,x){var w,E,C=x.buf;if(w=(112&(E=C[x.pos++]))>>4,E<128||(w|=(127&(E=C[x.pos++]))<<3,E<128)||(w|=(127&(E=C[x.pos++]))<<10,E<128)||(w|=(127&(E=C[x.pos++]))<<17,E<128)||(w|=(127&(E=C[x.pos++]))<<24,E<128)||(w|=(1&(E=C[x.pos++]))<<31,E<128))return Fc(p,w,v);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(s=c[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,t=this.pos;return this.pos=n,n-t>=12&&Vg?function(s,c,p){return Vg.decode(s.subarray(c,p))}(this.buf,t,n):function(s,c,p){for(var v="",x=c;x<p;){var w,E,C,L=s[x],O=null,$=L>239?4:L>223?3:L>191?2:1;if(x+$>p)break;$===1?L<128&&(O=L):$===2?(192&(w=s[x+1]))==128&&(O=(31&L)<<6|63&w)<=127&&(O=null):$===3?(E=s[x+2],(192&(w=s[x+1]))==128&&(192&E)==128&&((O=(15&L)<<12|(63&w)<<6|63&E)<=2047||O>=55296&&O<=57343)&&(O=null)):$===4&&(E=s[x+2],C=s[x+3],(192&(w=s[x+1]))==128&&(192&E)==128&&(192&C)==128&&((O=(15&L)<<18|(63&w)<<12|(63&E)<<6|63&C)<=65535||O>=1114112)&&(O=null)),O===null?(O=65533,$=1):O>65535&&(O-=65536,v+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),v+=String.fromCharCode(O),x+=$}return v}(this.buf,t,n)},readBytes:function(){var n=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,n);return this.pos=n,t},readPackedVarint:function(n,t){if(this.type!==Qi.Bytes)return n.push(this.readVarint(t));var s=So(this);for(n=n||[];this.pos<s;)n.push(this.readVarint(t));return n},readPackedSVarint:function(n){if(this.type!==Qi.Bytes)return n.push(this.readSVarint());var t=So(this);for(n=n||[];this.pos<t;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==Qi.Bytes)return n.push(this.readBoolean());var t=So(this);for(n=n||[];this.pos<t;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==Qi.Bytes)return n.push(this.readFloat());var t=So(this);for(n=n||[];this.pos<t;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==Qi.Bytes)return n.push(this.readDouble());var t=So(this);for(n=n||[];this.pos<t;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==Qi.Bytes)return n.push(this.readFixed32());var t=So(this);for(n=n||[];this.pos<t;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==Qi.Bytes)return n.push(this.readSFixed32());var t=So(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==Qi.Bytes)return n.push(this.readFixed64());var t=So(this);for(n=n||[];this.pos<t;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==Qi.Bytes)return n.push(this.readSFixed64());var t=So(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed64());return n},skip:function(n){var t=7&n;if(t===Qi.Varint)for(;this.buf[this.pos++]>127;);else if(t===Qi.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Qi.Fixed32)this.pos+=4;else{if(t!==Qi.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(n,t){this.writeVarint(n<<3|t)},realloc:function(n){for(var t=this.length||16;t<this.pos+n;)t*=2;if(t!==this.length){var s=new Uint8Array(t);s.set(this.buf),this.buf=s,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),Bc(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),Bc(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),Bc(this.buf,-1&n,this.pos),Bc(this.buf,Math.floor(n*Ug),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),Bc(this.buf,-1&n,this.pos),Bc(this.buf,Math.floor(n*Ug),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(t,s){var c,p;if(t>=0?(c=t%4294967296|0,p=t/4294967296|0):(p=~(-t/4294967296),4294967295^(c=~(-t%4294967296))?c=c+1|0:(c=0,p=p+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(v,x,w){w.buf[w.pos++]=127&v|128,v>>>=7,w.buf[w.pos++]=127&v|128,v>>>=7,w.buf[w.pos++]=127&v|128,v>>>=7,w.buf[w.pos++]=127&v|128,w.buf[w.pos]=127&(v>>>=7)}(c,0,s),function(v,x){var w=(7&v)<<4;x.buf[x.pos++]|=w|((v>>>=3)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v)))))}(p,s)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var t=this.pos;this.pos=function(c,p,v){for(var x,w,E=0;E<p.length;E++){if((x=p.charCodeAt(E))>55295&&x<57344){if(!w){x>56319||E+1===p.length?(c[v++]=239,c[v++]=191,c[v++]=189):w=x;continue}if(x<56320){c[v++]=239,c[v++]=191,c[v++]=189,w=x;continue}x=w-55296<<10|x-56320|65536,w=null}else w&&(c[v++]=239,c[v++]=191,c[v++]=189,w=null);x<128?c[v++]=x:(x<2048?c[v++]=x>>6|192:(x<65536?c[v++]=x>>12|224:(c[v++]=x>>18|240,c[v++]=x>>12&63|128),c[v++]=x>>6&63|128),c[v++]=63&x|128)}return v}(this.buf,n,this.pos);var s=this.pos-t;s>=128&&jg(t,s,this),this.pos=t-1,this.writeVarint(s),this.pos+=s},writeFloat:function(n){this.realloc(4),$g(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),$g(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var t=n.length;this.writeVarint(t),this.realloc(t);for(var s=0;s<t;s++)this.buf[this.pos++]=n[s]},writeRawMessage:function(n,t){this.pos++;var s=this.pos;n(t,this);var c=this.pos-s;c>=128&&jg(s,c,this),this.pos=s-1,this.writeVarint(c),this.pos+=c},writeMessage:function(n,t,s){this.writeTag(n,Qi.Bytes),this.writeRawMessage(t,s)},writePackedVarint:function(n,t){t.length&&this.writeMessage(n,eb,t)},writePackedSVarint:function(n,t){t.length&&this.writeMessage(n,tb,t)},writePackedBoolean:function(n,t){t.length&&this.writeMessage(n,nb,t)},writePackedFloat:function(n,t){t.length&&this.writeMessage(n,ib,t)},writePackedDouble:function(n,t){t.length&&this.writeMessage(n,rb,t)},writePackedFixed32:function(n,t){t.length&&this.writeMessage(n,sb,t)},writePackedSFixed32:function(n,t){t.length&&this.writeMessage(n,ab,t)},writePackedFixed64:function(n,t){t.length&&this.writeMessage(n,ob,t)},writePackedSFixed64:function(n,t){t.length&&this.writeMessage(n,lb,t)},writeBytesField:function(n,t){this.writeTag(n,Qi.Bytes),this.writeBytes(t)},writeFixed32Field:function(n,t){this.writeTag(n,Qi.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(n,t){this.writeTag(n,Qi.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(n,t){this.writeTag(n,Qi.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(n,t){this.writeTag(n,Qi.Fixed64),this.writeSFixed64(t)},writeVarintField:function(n,t){this.writeTag(n,Qi.Varint),this.writeVarint(t)},writeSVarintField:function(n,t){this.writeTag(n,Qi.Varint),this.writeSVarint(t)},writeStringField:function(n,t){this.writeTag(n,Qi.Bytes),this.writeString(t)},writeFloatField:function(n,t){this.writeTag(n,Qi.Fixed32),this.writeFloat(t)},writeDoubleField:function(n,t){this.writeTag(n,Qi.Fixed64),this.writeDouble(t)},writeBooleanField:function(n,t){this.writeVarintField(n,!!t)}};var rp=T(Bg);const np=3;function cb(n,t,s){n===1&&s.readMessage(ub,t)}function ub(n,t,s){if(n===3){const{id:c,bitmap:p,width:v,height:x,left:w,top:E,advance:C}=s.readMessage(hb,{});t.push({id:c,bitmap:new Bu({width:v+2*np,height:x+2*np},p),metrics:{width:v,height:x,left:w,top:E,advance:C}})}}function hb(n,t,s){n===1?t.id=s.readVarint():n===2?t.bitmap=s.readBytes():n===3?t.width=s.readVarint():n===4?t.height=s.readVarint():n===5?t.left=s.readSVarint():n===6?t.top=s.readSVarint():n===7&&(t.advance=s.readVarint())}const Gg=np;function Hg(n){let t=0,s=0;for(const x of n)t+=x.w*x.h,s=Math.max(s,x.w);n.sort((x,w)=>w.h-x.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),s),h:1/0}];let p=0,v=0;for(const x of n)for(let w=c.length-1;w>=0;w--){const E=c[w];if(!(x.w>E.w||x.h>E.h)){if(x.x=E.x,x.y=E.y,v=Math.max(v,x.y+x.h),p=Math.max(p,x.x+x.w),x.w===E.w&&x.h===E.h){const C=c.pop();w<c.length&&(c[w]=C)}else x.h===E.h?(E.x+=x.w,E.w-=x.w):x.w===E.w?(E.y+=x.h,E.h-=x.h):(c.push({x:E.x+x.w,y:E.y,w:E.w-x.w,h:x.h}),E.y+=x.h,E.h-=x.h);break}}return{w:p,h:v,fill:t/(p*v)||0}}const ls=1;class sp{constructor(t,{pixelRatio:s,version:c,stretchX:p,stretchY:v,content:x}){this.paddedRect=t,this.pixelRatio=s,this.stretchX=p,this.stretchY=v,this.content=x,this.version=c}get tl(){return[this.paddedRect.x+ls,this.paddedRect.y+ls]}get br(){return[this.paddedRect.x+this.paddedRect.w-ls,this.paddedRect.y+this.paddedRect.h-ls]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*ls)/this.pixelRatio,(this.paddedRect.h-2*ls)/this.pixelRatio]}}class Zg{constructor(t,s){const c={},p={};this.haveRenderCallbacks=[];const v=[];this.addImages(t,c,v),this.addImages(s,p,v);const{w:x,h:w}=Hg(v),E=new qs({width:x||1,height:w||1});for(const C in t){const L=t[C],O=c[C].paddedRect;qs.copy(L.data,E,{x:0,y:0},{x:O.x+ls,y:O.y+ls},L.data)}for(const C in s){const L=s[C],O=p[C].paddedRect,$=O.x+ls,j=O.y+ls,G=L.data.width,X=L.data.height;qs.copy(L.data,E,{x:0,y:0},{x:$,y:j},L.data),qs.copy(L.data,E,{x:0,y:X-1},{x:$,y:j-1},{width:G,height:1}),qs.copy(L.data,E,{x:0,y:0},{x:$,y:j+X},{width:G,height:1}),qs.copy(L.data,E,{x:G-1,y:0},{x:$-1,y:j},{width:1,height:X}),qs.copy(L.data,E,{x:0,y:0},{x:$+G,y:j},{width:1,height:X})}this.image=E,this.iconPositions=c,this.patternPositions=p}addImages(t,s,c){for(const p in t){const v=t[p],x={x:0,y:0,w:v.data.width+2*ls,h:v.data.height+2*ls};c.push(x),s[p]=new sp(x,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(t,s){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in t.updatedImages)this.patchUpdatedImage(this.iconPositions[c],t.getImage(c),s),this.patchUpdatedImage(this.patternPositions[c],t.getImage(c),s)}patchUpdatedImage(t,s,c){if(!t||!s||t.version===s.version)return;t.version=s.version;const[p,v]=t.tl;c.update(s.data,void 0,{x:p,y:v})}}var sl;Tt("ImagePosition",sp),Tt("ImageAtlas",Zg),m.ah=void 0,(sl=m.ah||(m.ah={}))[sl.none=0]="none",sl[sl.horizontal=1]="horizontal",sl[sl.vertical=2]="vertical",sl[sl.horizontalOnly=3]="horizontalOnly";const Hu=-17;class Zu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,s){const c=new Zu;return c.scale=t||1,c.fontStack=s,c}static forImage(t){const s=new Zu;return s.imageName=t,s}}class Nc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,s){const c=new Nc;for(let p=0;p<t.sections.length;p++){const v=t.sections[p];v.image?c.addImageSection(v):c.addTextSection(v,s)}return c}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let s="";for(let c=0;c<t.length;c++){const p=t.charCodeAt(c+1)||null,v=t.charCodeAt(c-1)||null;s+=p&&qa(p)&&!Gu[t[c+1]]||v&&qa(v)&&!Gu[t[c-1]]||!Gu[t[c]]?t[c]:Gu[t[c]]}return s}(this.text)}trim(){let t=0;for(let c=0;c<this.text.length&&yd[this.text.charCodeAt(c)];c++)t++;let s=this.text.length;for(let c=this.text.length-1;c>=0&&c>=t&&yd[this.text.charCodeAt(c)];c--)s--;this.text=this.text.substring(t,s),this.sectionIndex=this.sectionIndex.slice(t,s)}substring(t,s){const c=new Nc;return c.text=this.text.substring(t,s),c.sectionIndex=this.sectionIndex.slice(t,s),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,s)=>Math.max(t,this.sections[s].scale),0)}addTextSection(t,s){this.text+=t.text,this.sections.push(Zu.forText(t.scale,t.fontStack||s));const c=this.sections.length-1;for(let p=0;p<t.text.length;++p)this.sectionIndex.push(c)}addImageSection(t){const s=t.image?t.image.name:"";if(s.length===0)return void pi("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Zu.forImage(s)),this.sectionIndex.push(this.sections.length-1)):pi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function gd(n,t,s,c,p,v,x,w,E,C,L,O,$,j,G,X){const ie=Nc.fromFeature(n,p);let ue;O===m.ah.vertical&&ie.verticalizePunctuation();const{processBidirectionalText:Ee,processStyledBidirectionalText:fe}=Ga;if(Ee&&ie.sections.length===1){ue=[];const Ge=Ee(ie.toString(),ap(ie,C,v,t,c,j,G));for(const It of Ge){const Ot=new Nc;Ot.text=It,Ot.sections=ie.sections;for(let St=0;St<It.length;St++)Ot.sectionIndex.push(0);ue.push(Ot)}}else if(fe){ue=[];const Ge=fe(ie.text,ie.sectionIndex,ap(ie,C,v,t,c,j,G));for(const It of Ge){const Ot=new Nc;Ot.text=It[0],Ot.sectionIndex=It[1],Ot.sections=ie.sections,ue.push(Ot)}}else ue=function(Ge,It){const Ot=[],St=Ge.text;let xt=0;for(const ct of It)Ot.push(Ge.substring(xt,ct)),xt=ct;return xt<St.length&&Ot.push(Ge.substring(xt,St.length)),Ot}(ie,ap(ie,C,v,t,c,j,G));const xe=[],$e={positionedLines:xe,text:ie.toString(),top:L[1],bottom:L[1],left:L[0],right:L[0],writingMode:O,iconsInText:!1,verticalizable:!1};return function(Ge,It,Ot,St,xt,ct,kt,_t,tt,Xt,Nt,Mi){let mr=0,br=Hu,an=0,Es=0;const Kn=_t==="right"?1:_t==="left"?0:.5;let Yr=0;for(const on of xt){on.trim();const ln=on.getMaxScale(),On=(ln-1)*sn,Qn={positionedGlyphs:[],lineOffset:0};Ge.positionedLines[Yr]=Qn;const Fn=Qn.positionedGlyphs;let cs=0;if(!on.length()){br+=ct,++Yr;continue}for(let cn=0;cn<on.length();cn++){const Ci=on.getSection(cn),Bn=on.getSectionIndex(cn),Dn=on.getCharCode(cn);let un=0,oa=null,Ta=null,Ia=null,Eo=sn;const la=!(tt===m.ah.horizontal||!Nt&&!vo(Dn)||Nt&&(yd[Dn]||(Sn=Dn,vt.Arabic(Sn)||vt["Arabic Supplement"](Sn)||vt["Arabic Extended-A"](Sn)||vt["Arabic Presentation Forms-A"](Sn)||vt["Arabic Presentation Forms-B"](Sn))));if(Ci.imageName){const Hs=St[Ci.imageName];if(!Hs)continue;Ia=Ci.imageName,Ge.iconsInText=Ge.iconsInText||!0,Ta=Hs.paddedRect;const hs=Hs.displaySize;Ci.scale=Ci.scale*sn/Mi,oa={width:hs[0],height:hs[1],left:ls,top:-Gg,advance:la?hs[1]:hs[0]},un=On+(sn-hs[1]*Ci.scale),Eo=oa.advance;const To=la?hs[0]*Ci.scale-sn*ln:hs[1]*Ci.scale-sn*ln;To>0&&To>cs&&(cs=To)}else{const Hs=Ot[Ci.fontStack],hs=Hs&&Hs[Dn];if(hs&&hs.rect)Ta=hs.rect,oa=hs.metrics;else{const To=It[Ci.fontStack],Ju=To&&To[Dn];if(!Ju)continue;oa=Ju.metrics}un=(ln-Ci.scale)*sn}la?(Ge.verticalizable=!0,Fn.push({glyph:Dn,imageName:Ia,x:mr,y:br+un,vertical:la,scale:Ci.scale,fontStack:Ci.fontStack,sectionIndex:Bn,metrics:oa,rect:Ta}),mr+=Eo*Ci.scale+Xt):(Fn.push({glyph:Dn,imageName:Ia,x:mr,y:br+un,vertical:la,scale:Ci.scale,fontStack:Ci.fontStack,sectionIndex:Bn,metrics:oa,rect:Ta}),mr+=oa.advance*Ci.scale+Xt)}Fn.length!==0&&(an=Math.max(mr-Xt,an),pb(Fn,0,Fn.length-1,Kn,cs)),mr=0;const us=ct*ln+cs;Qn.lineOffset=Math.max(cs,On),br+=us,Es=Math.max(us,Es),++Yr}var Sn;const kn=br-Hu,{horizontalAlign:Yn,verticalAlign:Jn}=op(kt);(function(on,ln,On,Qn,Fn,cs,us,cn,Ci){const Bn=(ln-On)*Fn;let Dn=0;Dn=cs!==us?-cn*Qn-Hu:(-Qn*Ci+.5)*us;for(const un of on)for(const oa of un.positionedGlyphs)oa.x+=Bn,oa.y+=Dn})(Ge.positionedLines,Kn,Yn,Jn,an,Es,ct,kn,xt.length),Ge.top+=-Jn*kn,Ge.bottom=Ge.top+kn,Ge.left+=-Yn*an,Ge.right=Ge.left+an}($e,t,s,c,ue,x,w,E,O,C,$,X),!function(Ge){for(const It of Ge)if(It.positionedGlyphs.length!==0)return!1;return!0}(xe)&&$e}const yd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},db={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Wg(n,t,s,c,p,v){if(t.imageName){const x=c[t.imageName];return x?x.displaySize[0]*t.scale*sn/v+p:0}{const x=s[t.fontStack],w=x&&x[n];return w?w.metrics.advance*t.scale+p:0}}function Xg(n,t,s,c){const p=Math.pow(n-t,2);return c?n<t?p/2:2*p:p+Math.abs(s)*s}function fb(n,t,s){let c=0;return n===10&&(c-=1e4),s&&(c+=150),n!==40&&n!==65288||(c+=50),t!==41&&t!==65289||(c+=50),c}function Kg(n,t,s,c,p,v){let x=null,w=Xg(t,s,p,v);for(const E of c){const C=Xg(t-E.x,s,p,v)+E.badness;C<=w&&(x=E,w=C)}return{index:n,x:t,priorBreak:x,badness:w}}function Yg(n){return n?Yg(n.priorBreak).concat(n.index):[]}function ap(n,t,s,c,p,v,x){if(v!=="point")return[];if(!n)return[];const w=[],E=function($,j,G,X,ie,ue){let Ee=0;for(let fe=0;fe<$.length();fe++){const xe=$.getSection(fe);Ee+=Wg($.getCharCode(fe),xe,X,ie,j,ue)}return Ee/Math.max(1,Math.ceil(Ee/G))}(n,t,s,c,p,x),C=n.text.indexOf("")>=0;let L=0;for(let $=0;$<n.length();$++){const j=n.getSection($),G=n.getCharCode($);if(yd[G]||(L+=Wg(G,j,c,p,t,x)),$<n.length()-1){const X=!((O=G)<11904||!(vt["Bopomofo Extended"](O)||vt.Bopomofo(O)||vt["CJK Compatibility Forms"](O)||vt["CJK Compatibility Ideographs"](O)||vt["CJK Compatibility"](O)||vt["CJK Radicals Supplement"](O)||vt["CJK Strokes"](O)||vt["CJK Symbols and Punctuation"](O)||vt["CJK Unified Ideographs Extension A"](O)||vt["CJK Unified Ideographs"](O)||vt["Enclosed CJK Letters and Months"](O)||vt["Halfwidth and Fullwidth Forms"](O)||vt.Hiragana(O)||vt["Ideographic Description Characters"](O)||vt["Kangxi Radicals"](O)||vt["Katakana Phonetic Extensions"](O)||vt.Katakana(O)||vt["Vertical Forms"](O)||vt["Yi Radicals"](O)||vt["Yi Syllables"](O)));(db[G]||X||j.imageName)&&w.push(Kg($+1,L,E,w,fb(G,n.getCharCode($+1),X&&C),!1))}}var O;return Yg(Kg(n.length(),L,E,w,0,!0))}function op(n){let t=.5,s=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:t,verticalAlign:s}}function pb(n,t,s,c,p){if(!c&&!p)return;const v=n[s],x=(n[s].x+v.metrics.advance*v.scale)*c;for(let w=t;w<=s;w++)n[w].x-=x,n[w].y+=p}function mb(n,t,s){const{horizontalAlign:c,verticalAlign:p}=op(s),v=t[0]-n.displaySize[0]*c,x=t[1]-n.displaySize[1]*p;return{image:n,top:x,bottom:x+n.displaySize[1],left:v,right:v+n.displaySize[0]}}function Jg(n,t,s,c,p,v){const x=n.image;let w;if(x.content){const ie=x.content,ue=x.pixelRatio||1;w=[ie[0]/ue,ie[1]/ue,x.displaySize[0]-ie[2]/ue,x.displaySize[1]-ie[3]/ue]}const E=t.left*v,C=t.right*v;let L,O,$,j;s==="width"||s==="both"?(j=p[0]+E-c[3],O=p[0]+C+c[1]):(j=p[0]+(E+C-x.displaySize[0])/2,O=j+x.displaySize[0]);const G=t.top*v,X=t.bottom*v;return s==="height"||s==="both"?(L=p[1]+G-c[0],$=p[1]+X+c[2]):(L=p[1]+(G+X-x.displaySize[1])/2,$=L+x.displaySize[1]),{image:x,top:L,right:O,bottom:$,left:j,collisionPadding:w}}const Wu=255,Xa=128,al=Wu*Xa;function Qg(n,t){const{expression:s}=t;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new vr(n+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:p}=s;let v=0;for(;v<c.length&&c[v]<=n;)v++;v=Math.max(0,v-1);let x=v;for(;x<c.length&&c[x]<n+1;)x++;x=Math.min(c.length-1,x);const w=c[v],E=c[x];return s.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:E,interpolationType:p}:{kind:"camera",minZoom:w,maxZoom:E,minSize:s.evaluate(new vr(w)),maxSize:s.evaluate(new vr(E)),interpolationType:p}}}function lp(n,t,s){let c="never";const p=n.get(t);return p?c=p:n.get(s)&&(c="always"),c}const gb=nl.VectorTileFeature.types,yb=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function _d(n,t,s,c,p,v,x,w,E,C,L,O,$){const j=w?Math.min(al,Math.round(w[0])):0,G=w?Math.min(al,Math.round(w[1])):0;n.emplaceBack(t,s,Math.round(32*c),Math.round(32*p),v,x,(j<<1)+(E?1:0),G,16*C,16*L,256*O,256*$)}function cp(n,t,s){n.emplaceBack(t.x,t.y,s),n.emplaceBack(t.x,t.y,s),n.emplaceBack(t.x,t.y,s),n.emplaceBack(t.x,t.y,s)}function _b(n){for(const t of n.sections)if($f(t.text))return!0;return!1}class up{constructor(t){this.layoutVertexArray=new Ce,this.indexArray=new ze,this.programConfigurations=t,this.segments=new dt,this.dynamicLayoutVertexArray=new oe,this.opacityVertexArray=new be,this.hasVisibleVertices=!1,this.placedSymbolArray=new o}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,s,c,p){this.isEmpty()||(c&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,X1.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,K1.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,yb,!0),this.opacityVertexBuffer.itemSize=1),(c||p)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Tt("SymbolBuffers",up);class hp{constructor(t,s,c){this.layoutVertexArray=new t,this.layoutAttributes=s,this.indexArray=new c,this.segments=new dt,this.collisionVertexArray=new ke}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Y1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Tt("CollisionBuffers",hp);class $c{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(x=>x.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Vf([]),this.placementViewportMatrix=Vf([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Qg(this.zoom,s["text-size"]),this.iconSizeData=Qg(this.zoom,s["icon-size"]);const c=this.layers[0].layout,p=c.get("symbol-sort-key"),v=c.get("symbol-z-order");this.canOverlap=lp(c,"text-overlap","text-allow-overlap")!=="never"||lp(c,"icon-overlap","icon-allow-overlap")!=="never"||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&!p.isConstant(),this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,c.get("symbol-placement")==="point"&&(this.writingModes=c.get("text-writing-mode").map(x=>m.ah[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=t.sourceID}createArrays(){this.text=new up(new Cr(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new up(new Cr(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new _,this.lineVertexArray=new M,this.symbolInstances=new f,this.textAnchorOffsets=new I}calculateGlyphDependencies(t,s,c,p,v){for(let x=0;x<t.length;x++)if(s[t.charCodeAt(x)]=!0,(c||p)&&v){const w=Gu[t.charAt(x)];w&&(s[w.charCodeAt(0)]=!0)}}populate(t,s,c){const p=this.layers[0],v=p.layout,x=v.get("text-font"),w=v.get("text-field"),E=v.get("icon-image"),C=(w.value.kind!=="constant"||w.value.value instanceof An&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),L=E.value.kind!=="constant"||!!E.value.value||Object.keys(E.parameters).length>0,O=v.get("symbol-sort-key");if(this.features=[],!C&&!L)return;const $=s.iconDependencies,j=s.glyphDependencies,G=s.availableImages,X=new vr(this.zoom);for(const{feature:ie,id:ue,index:Ee,sourceLayerIndex:fe}of t){const xe=p._featureFilter.needGeometry,$e=Mo(ie,xe);if(!p._featureFilter.filter(X,$e,c))continue;let Ge,It;if(xe||($e.geometry=wo(ie)),C){const St=p.getValueAndResolveTokens("text-field",$e,c,G),xt=An.factory(St),ct=this.hasRTLText=this.hasRTLText||_b(xt);(!ct||Ga.getRTLTextPluginStatus()==="unavailable"||ct&&Ga.isParsed())&&(Ge=Q1(xt,p,$e))}if(L){const St=p.getValueAndResolveTokens("icon-image",$e,c,G);It=St instanceof vn?St:vn.fromString(St)}if(!Ge&&!It)continue;const Ot=this.sortFeaturesByKey?O.evaluate($e,{},c):void 0;if(this.features.push({id:ue,text:Ge,icon:It,index:Ee,sourceLayerIndex:fe,geometry:$e.geometry,properties:ie.properties,type:gb[ie.type],sortKey:Ot}),It&&($[It.name]=!0),Ge){const St=x.evaluate($e,{},c).join(","),xt=v.get("text-rotation-alignment")!=="viewport"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(m.ah.vertical)>=0;for(const ct of Ge.sections)if(ct.image)$[ct.image.name]=!0;else{const kt=na(Ge.toString()),_t=ct.fontStack||St,tt=j[_t]=j[_t]||{};this.calculateGlyphDependencies(ct.text,tt,xt,this.allowVerticalPlacement,kt)}}}v.get("symbol-placement")==="line"&&(this.features=function(ie){const ue={},Ee={},fe=[];let xe=0;function $e(St){fe.push(ie[St]),xe++}function Ge(St,xt,ct){const kt=Ee[St];return delete Ee[St],Ee[xt]=kt,fe[kt].geometry[0].pop(),fe[kt].geometry[0]=fe[kt].geometry[0].concat(ct[0]),kt}function It(St,xt,ct){const kt=ue[xt];return delete ue[xt],ue[St]=kt,fe[kt].geometry[0].shift(),fe[kt].geometry[0]=ct[0].concat(fe[kt].geometry[0]),kt}function Ot(St,xt,ct){const kt=ct?xt[0][xt[0].length-1]:xt[0][0];return`${St}:${kt.x}:${kt.y}`}for(let St=0;St<ie.length;St++){const xt=ie[St],ct=xt.geometry,kt=xt.text?xt.text.toString():null;if(!kt){$e(St);continue}const _t=Ot(kt,ct),tt=Ot(kt,ct,!0);if(_t in Ee&&tt in ue&&Ee[_t]!==ue[tt]){const Xt=It(_t,tt,ct),Nt=Ge(_t,tt,fe[Xt].geometry);delete ue[_t],delete Ee[tt],Ee[Ot(kt,fe[Nt].geometry,!0)]=Nt,fe[Xt].geometry=null}else _t in Ee?Ge(_t,tt,ct):tt in ue?It(_t,tt,ct):($e(St),ue[_t]=xe-1,Ee[tt]=xe-1)}return fe.filter(St=>St.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ie,ue)=>ie.sortKey-ue.sortKey)}update(t,s,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,s,this.layers,c),this.icon.programConfigurations.updatePaintArrays(t,s,this.layers,c))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,s){const c=this.lineVertexArray.length;if(t.segment!==void 0){let p=t.dist(s[t.segment+1]),v=t.dist(s[t.segment]);const x={};for(let w=t.segment+1;w<s.length;w++)x[w]={x:s[w].x,y:s[w].y,tileUnitDistanceFromAnchor:p},w<s.length-1&&(p+=s[w+1].dist(s[w]));for(let w=t.segment||0;w>=0;w--)x[w]={x:s[w].x,y:s[w].y,tileUnitDistanceFromAnchor:v},w>0&&(v+=s[w-1].dist(s[w]));for(let w=0;w<s.length;w++){const E=x[w];this.lineVertexArray.emplaceBack(E.x,E.y,E.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(t,s,c,p,v,x,w,E,C,L,O,$){const j=t.indexArray,G=t.layoutVertexArray,X=t.segments.prepareSegment(4*s.length,G,j,this.canOverlap?x.sortKey:void 0),ie=this.glyphOffsetArray.length,ue=X.vertexLength,Ee=this.allowVerticalPlacement&&w===m.ah.vertical?Math.PI/2:0,fe=x.text&&x.text.sections;for(let xe=0;xe<s.length;xe++){const{tl:$e,tr:Ge,bl:It,br:Ot,tex:St,pixelOffsetTL:xt,pixelOffsetBR:ct,minFontScaleX:kt,minFontScaleY:_t,glyphOffset:tt,isSDF:Xt,sectionIndex:Nt}=s[xe],Mi=X.vertexLength,mr=tt[1];_d(G,E.x,E.y,$e.x,mr+$e.y,St.x,St.y,c,Xt,xt.x,xt.y,kt,_t),_d(G,E.x,E.y,Ge.x,mr+Ge.y,St.x+St.w,St.y,c,Xt,ct.x,xt.y,kt,_t),_d(G,E.x,E.y,It.x,mr+It.y,St.x,St.y+St.h,c,Xt,xt.x,ct.y,kt,_t),_d(G,E.x,E.y,Ot.x,mr+Ot.y,St.x+St.w,St.y+St.h,c,Xt,ct.x,ct.y,kt,_t),cp(t.dynamicLayoutVertexArray,E,Ee),j.emplaceBack(Mi,Mi+1,Mi+2),j.emplaceBack(Mi+1,Mi+2,Mi+3),X.vertexLength+=4,X.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(tt[0]),xe!==s.length-1&&Nt===s[xe+1].sectionIndex||t.programConfigurations.populatePaintArrays(G.length,x,x.index,{},$,fe&&fe[Nt])}t.placedSymbolArray.emplaceBack(E.x,E.y,ie,this.glyphOffsetArray.length-ie,ue,C,L,E.segment,c?c[0]:0,c?c[1]:0,p[0],p[1],w,0,!1,0,O)}_addCollisionDebugVertex(t,s,c,p,v,x){return s.emplaceBack(0,0),t.emplaceBack(c.x,c.y,p,v,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(t,s,c,p,v,x,w){const E=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),C=E.vertexLength,L=v.layoutVertexArray,O=v.collisionVertexArray,$=w.anchorX,j=w.anchorY;this._addCollisionDebugVertex(L,O,x,$,j,new k(t,s)),this._addCollisionDebugVertex(L,O,x,$,j,new k(c,s)),this._addCollisionDebugVertex(L,O,x,$,j,new k(c,p)),this._addCollisionDebugVertex(L,O,x,$,j,new k(t,p)),E.vertexLength+=4;const G=v.indexArray;G.emplaceBack(C,C+1),G.emplaceBack(C+1,C+2),G.emplaceBack(C+2,C+3),G.emplaceBack(C+3,C),E.primitiveLength+=4}addDebugCollisionBoxes(t,s,c,p){for(let v=t;v<s;v++){const x=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,p?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,c)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new hp(Ae,Fg.members,Xe),this.iconCollisionBox=new hp(Ae,Fg.members,Xe);for(let t=0;t<this.symbolInstances.length;t++){const s=this.symbolInstances.get(t);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}}_deserializeCollisionBoxesForSymbol(t,s,c,p,v,x,w,E,C){const L={};for(let O=s;O<c;O++){const $=t.get(O);L.textBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},L.textFeatureIndex=$.featureIndex;break}for(let O=p;O<v;O++){const $=t.get(O);L.verticalTextBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},L.verticalTextFeatureIndex=$.featureIndex;break}for(let O=x;O<w;O++){const $=t.get(O);L.iconBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},L.iconFeatureIndex=$.featureIndex;break}for(let O=E;O<C;O++){const $=t.get(O);L.verticalIconBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},L.verticalIconFeatureIndex=$.featureIndex;break}return L}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const c=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,s){const c=t.placedSymbolArray.get(s),p=c.vertexStartIndex+4*c.numGlyphs;for(let v=c.vertexStartIndex;v<p;v+=4)t.indexArray.emplaceBack(v,v+1,v+2),t.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(t),c=Math.cos(t),p=[],v=[],x=[];for(let w=0;w<this.symbolInstances.length;++w){x.push(w);const E=this.symbolInstances.get(w);p.push(0|Math.round(s*E.anchorX+c*E.anchorY)),v.push(E.featureIndex)}return x.sort((w,E)=>p[w]-p[E]||v[E]-v[w]),x}addToSortKeyRanges(t,s){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===s?c.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const c=this.symbolInstances.get(s);this.featureSortOrder.push(c.featureIndex),[c.rightJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.leftJustifiedTextSymbolIndex].forEach((p,v,x)=>{p>=0&&x.indexOf(p)===v&&this.addIndicesForPlacedSymbol(this.text,p)}),c.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,c.verticalPlacedTextSymbolIndex),c.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.placedIconSymbolIndex),c.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let ey,ty;Tt("SymbolBucket",$c,{omit:["layers","collisionBoxArray","features","compareText"]}),$c.MAX_GLYPHS=65535,$c.addDynamicAttributes=cp;var dp={get paint(){return ty=ty||new Wn({"icon-opacity":new Kt(le.paint_symbol["icon-opacity"]),"icon-color":new Kt(le.paint_symbol["icon-color"]),"icon-halo-color":new Kt(le.paint_symbol["icon-halo-color"]),"icon-halo-width":new Kt(le.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Kt(le.paint_symbol["icon-halo-blur"]),"icon-translate":new Ut(le.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ut(le.paint_symbol["icon-translate-anchor"]),"text-opacity":new Kt(le.paint_symbol["text-opacity"]),"text-color":new Kt(le.paint_symbol["text-color"],{runtimeType:$i,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new Kt(le.paint_symbol["text-halo-color"]),"text-halo-width":new Kt(le.paint_symbol["text-halo-width"]),"text-halo-blur":new Kt(le.paint_symbol["text-halo-blur"]),"text-translate":new Ut(le.paint_symbol["text-translate"]),"text-translate-anchor":new Ut(le.paint_symbol["text-translate-anchor"])})},get layout(){return ey=ey||new Wn({"symbol-placement":new Ut(le.layout_symbol["symbol-placement"]),"symbol-spacing":new Ut(le.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ut(le.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Kt(le.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ut(le.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ut(le.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ut(le.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ut(le.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ut(le.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ut(le.layout_symbol["icon-rotation-alignment"]),"icon-size":new Kt(le.layout_symbol["icon-size"]),"icon-text-fit":new Ut(le.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ut(le.layout_symbol["icon-text-fit-padding"]),"icon-image":new Kt(le.layout_symbol["icon-image"]),"icon-rotate":new Kt(le.layout_symbol["icon-rotate"]),"icon-padding":new Kt(le.layout_symbol["icon-padding"]),"icon-keep-upright":new Ut(le.layout_symbol["icon-keep-upright"]),"icon-offset":new Kt(le.layout_symbol["icon-offset"]),"icon-anchor":new Kt(le.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ut(le.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ut(le.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ut(le.layout_symbol["text-rotation-alignment"]),"text-field":new Kt(le.layout_symbol["text-field"]),"text-font":new Kt(le.layout_symbol["text-font"]),"text-size":new Kt(le.layout_symbol["text-size"]),"text-max-width":new Kt(le.layout_symbol["text-max-width"]),"text-line-height":new Ut(le.layout_symbol["text-line-height"]),"text-letter-spacing":new Kt(le.layout_symbol["text-letter-spacing"]),"text-justify":new Kt(le.layout_symbol["text-justify"]),"text-radial-offset":new Kt(le.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ut(le.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Kt(le.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Kt(le.layout_symbol["text-anchor"]),"text-max-angle":new Ut(le.layout_symbol["text-max-angle"]),"text-writing-mode":new Ut(le.layout_symbol["text-writing-mode"]),"text-rotate":new Kt(le.layout_symbol["text-rotate"]),"text-padding":new Ut(le.layout_symbol["text-padding"]),"text-keep-upright":new Ut(le.layout_symbol["text-keep-upright"]),"text-transform":new Kt(le.layout_symbol["text-transform"]),"text-offset":new Kt(le.layout_symbol["text-offset"]),"text-allow-overlap":new Ut(le.layout_symbol["text-allow-overlap"]),"text-overlap":new Ut(le.layout_symbol["text-overlap"]),"text-ignore-placement":new Ut(le.layout_symbol["text-ignore-placement"]),"text-optional":new Ut(le.layout_symbol["text-optional"])})}};class iy{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:wr,this.defaultValue=t}evaluate(t){if(t.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(t.formattedSection))return s.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Tt("FormatSectionOverride",iy,{omit:["defaultValue"]});class vd extends js{constructor(t){super(t,dp)}recalculate(t,s){if(super.recalculate(t,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const c=this.layout.get("text-writing-mode");if(c){const p=[];for(const v of c)p.indexOf(v)<0&&p.push(v);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,s,c,p){const v=this.layout.get(t).evaluate(s,{},c,p),x=this._unevaluatedLayout._values[t];return x.isDataDriven()||Wi(x.value)||!v?v:function(w,E){return E.replace(/{([^{}]+)}/g,(C,L)=>w&&L in w?String(w[L]):"")}(s.properties,v)}createBucket(t){return new $c(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of dp.paint.overridableProperties){if(!vd.hasPaintOverride(this.layout,t))continue;const s=this.paint.get(t),c=new iy(s),p=new Fi(c,s.property.specification);let v=null;v=s.value.kind==="constant"||s.value.kind==="source"?new ia("source",p):new Xo("composite",p,s.value.zoomStops),this.paint._values[t]=new Vs(s.property,v,s.parameters)}}_handleOverridablePaintPropertyUpdate(t,s,c){return!(!this.layout||s.isDataDriven()||c.isDataDriven())&&vd.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,s){const c=t.get("text-field"),p=dp.paint.properties[s];let v=!1;const x=w=>{for(const E of w)if(p.overrides&&p.overrides.hasOverride(E))return void(v=!0)};if(c.value.kind==="constant"&&c.value.value instanceof An)x(c.value.value.sections);else if(c.value.kind==="source"){const w=C=>{v||(C instanceof Qs&&Dr(C.value)===Mr?x(C.value.sections):C instanceof qo?x(C.sections):C.eachChild(w))},E=c.value;E._styleExpression&&w(E._styleExpression.expression)}return v}}let ry;var vb={get paint(){return ry=ry||new Wn({"background-color":new Ut(le.paint_background["background-color"]),"background-pattern":new ql(le.paint_background["background-pattern"]),"background-opacity":new Ut(le.paint_background["background-opacity"])})}};class xb extends js{constructor(t){super(t,vb)}}let ny;var bb={get paint(){return ny=ny||new Wn({"raster-opacity":new Ut(le.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ut(le.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ut(le.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ut(le.paint_raster["raster-brightness-max"]),"raster-saturation":new Ut(le.paint_raster["raster-saturation"]),"raster-contrast":new Ut(le.paint_raster["raster-contrast"]),"raster-resampling":new Ut(le.paint_raster["raster-resampling"]),"raster-fade-duration":new Ut(le.paint_raster["raster-fade-duration"])})}};class wb extends js{constructor(t){super(t,bb)}}class Mb extends js{constructor(t){super(t,{}),this.onAdd=s=>{this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},this.onRemove=s=>{this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Sb{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const fp=63710088e-1;class ol{constructor(t,s){if(isNaN(t)||isNaN(s))throw new Error(`Invalid LngLat object: (${t}, ${s})`);if(this.lng=+t,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ol(Qe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const s=Math.PI/180,c=this.lat*s,p=t.lat*s,v=Math.sin(c)*Math.sin(p)+Math.cos(c)*Math.cos(p)*Math.cos((t.lng-this.lng)*s);return fp*Math.acos(Math.min(v,1))}static convert(t){if(t instanceof ol)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new ol(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new ol(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const sy=2*Math.PI*fp;function ay(n){return sy*Math.cos(n*Math.PI/180)}function oy(n){return(180+n)/360}function ly(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function cy(n,t){return n/ay(t)}function pp(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}class xd{constructor(t,s,c=0){this.x=+t,this.y=+s,this.z=+c}static fromLngLat(t,s=0){const c=ol.convert(t);return new xd(oy(c.lng),ly(c.lat),cy(s,c.lat))}toLngLat(){return new ol(360*this.x-180,pp(this.y))}toAltitude(){return this.z*ay(pp(this.y))}meterInMercatorCoordinateUnits(){return 1/sy*(t=pp(this.y),1/Math.cos(t*Math.PI/180));var t}}function uy(n,t,s){var c=2*Math.PI*6378137/256/Math.pow(2,s);return[n*c-2*Math.PI*6378137/2,t*c-2*Math.PI*6378137/2]}class mp{constructor(t,s,c){if(t<0||t>25||c<0||c>=Math.pow(2,t)||s<0||s>=Math.pow(2,t))throw new Error(`x=${s}, y=${c}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=s,this.y=c,this.key=Xu(0,t,t,s,c)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,s,c){const p=(x=this.y,w=this.z,E=uy(256*(v=this.x),256*(x=Math.pow(2,w)-x-1),w),C=uy(256*(v+1),256*(x+1),w),E[0]+","+E[1]+","+C[0]+","+C[1]);var v,x,w,E,C;const L=function(O,$,j){let G,X="";for(let ie=O;ie>0;ie--)G=1<<ie-1,X+=($&G?1:0)+(j&G?2:0);return X}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(c==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,s>1?"@2x":"").replace(/{quadkey}/g,L).replace(/{bbox-epsg-3857}/g,p)}isChildOf(t){const s=this.z-t.z;return s>0&&t.x===this.x>>s&&t.y===this.y>>s}getTilePoint(t){const s=Math.pow(2,this.z);return new k((t.x*s-this.x)*Nr,(t.y*s-this.y)*Nr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class hy{constructor(t,s){this.wrap=t,this.canonical=s,this.key=Xu(t,s.z,s.z,s.x,s.y)}}class Gs{constructor(t,s,c,p,v){if(t<c)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${c}`);this.overscaledZ=t,this.wrap=s,this.canonical=new mp(c,+p,+v),this.key=Xu(s,t,c,p,v)}clone(){return new Gs(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-t;return t>this.canonical.z?new Gs(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Gs(t,this.wrap,t,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(t,s){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-t;return t>this.canonical.z?Xu(this.wrap*+s,t,this.canonical.z,this.canonical.x,this.canonical.y):Xu(this.wrap*+s,t,t,this.canonical.x>>c,this.canonical.y>>c)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const s=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>s&&t.canonical.y===this.canonical.y>>s}children(t){if(this.overscaledZ>=t)return[new Gs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,c=2*this.canonical.x,p=2*this.canonical.y;return[new Gs(s,this.wrap,s,c,p),new Gs(s,this.wrap,s,c+1,p),new Gs(s,this.wrap,s,c,p+1),new Gs(s,this.wrap,s,c+1,p+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Gs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Gs(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new hy(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new xd(t.x-this.wrap,t.y))}}function Xu(n,t,s,c,p){(n*=2)<0&&(n=-1*n-1);const v=1<<s;return(v*v*n+v*p+c).toString(36)+s.toString(36)+t.toString(36)}Tt("CanonicalTileID",mp),Tt("OverscaledTileID",Gs,{omit:["posMatrix"]});class dy{constructor(t,s,c,p=1,v=1,x=1,w=0){if(this.uid=t,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(c&&!["mapbox","terrarium","custom"].includes(c))return void pi(`"${c}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=s.height;const E=this.dim=s.height-2;switch(this.data=new Uint32Array(s.data.buffer),c){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=p,this.greenFactor=v,this.blueFactor=x,this.baseShift=w;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let C=0;C<E;C++)this.data[this._idx(-1,C)]=this.data[this._idx(0,C)],this.data[this._idx(E,C)]=this.data[this._idx(E-1,C)],this.data[this._idx(C,-1)]=this.data[this._idx(C,0)],this.data[this._idx(C,E)]=this.data[this._idx(C,E-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(E,-1)]=this.data[this._idx(E-1,0)],this.data[this._idx(-1,E)]=this.data[this._idx(0,E-1)],this.data[this._idx(E,E)]=this.data[this._idx(E-1,E-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let C=0;C<E;C++)for(let L=0;L<E;L++){const O=this.get(C,L);O>this.max&&(this.max=O),O<this.min&&(this.min=O)}}get(t,s){const c=new Uint8Array(this.data.buffer),p=4*this._idx(t,s);return this.unpack(c[p],c[p+1],c[p+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,s){if(t<-1||t>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(t+1)}unpack(t,s,c){return t*this.redFactor+s*this.greenFactor+c*this.blueFactor-this.baseShift}getPixels(){return new qs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,s,c){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let p=s*this.dim,v=s*this.dim+this.dim,x=c*this.dim,w=c*this.dim+this.dim;switch(s){case-1:p=v-1;break;case 1:v=p+1}switch(c){case-1:x=w-1;break;case 1:w=x+1}const E=-s*this.dim,C=-c*this.dim;for(let L=x;L<w;L++)for(let O=p;O<v;O++)this.data[this._idx(O,L)]=t.data[this._idx(O+E,L+C)]}}Tt("DEMData",dy);class fy{constructor(t){this._stringToNumber={},this._numberToString=[];for(let s=0;s<t.length;s++){const c=t[s];this._stringToNumber[c]=s,this._numberToString[s]=c}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class py{constructor(t,s,c,p,v){this.type="Feature",this._vectorTileFeature=t,t._z=s,t._x=c,t._y=p,this.properties=t.properties,this.id=v}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(t[s]=this[s]);return t}}class my{constructor(t,s){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new zn(Nr,16,0),this.grid3D=new zn(Nr,16,0),this.featureIndexArray=new F,this.promoteId=s}insert(t,s,c,p,v,x){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,p,v);const E=x?this.grid3D:this.grid;for(let C=0;C<s.length;C++){const L=s[C],O=[1/0,1/0,-1/0,-1/0];for(let $=0;$<L.length;$++){const j=L[$];O[0]=Math.min(O[0],j.x),O[1]=Math.min(O[1],j.y),O[2]=Math.max(O[2],j.x),O[3]=Math.max(O[3],j.y)}O[0]<Nr&&O[1]<Nr&&O[2]>=0&&O[3]>=0&&E.insert(w,O[0],O[1],O[2],O[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new nl.VectorTile(new rp(this.rawTileData)).layers,this.sourceLayerCoder=new fy(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,s,c,p){this.loadVTLayers();const v=t.params||{},x=Nr/t.tileSize/t.scale,w=va(v.filter),E=t.queryGeometry,C=t.queryPadding*x,L=yy(E),O=this.grid.query(L.minX-C,L.minY-C,L.maxX+C,L.maxY+C),$=yy(t.cameraQueryGeometry),j=this.grid3D.query($.minX-C,$.minY-C,$.maxX+C,$.maxY+C,(ie,ue,Ee,fe)=>function(xe,$e,Ge,It,Ot){for(const xt of xe)if($e<=xt.x&&Ge<=xt.y&&It>=xt.x&&Ot>=xt.y)return!0;const St=[new k($e,Ge),new k($e,Ot),new k(It,Ot),new k(It,Ge)];if(xe.length>2){for(const xt of St)if(Lc(xe,xt))return!0}for(let xt=0;xt<xe.length-1;xt++)if(i1(xe[xt],xe[xt+1],St))return!0;return!1}(t.cameraQueryGeometry,ie-C,ue-C,Ee+C,fe+C));for(const ie of j)O.push(ie);O.sort(Eb);const G={};let X;for(let ie=0;ie<O.length;ie++){const ue=O[ie];if(ue===X)continue;X=ue;const Ee=this.featureIndexArray.get(ue);let fe=null;this.loadMatchingFeature(G,Ee.bucketIndex,Ee.sourceLayerIndex,Ee.featureIndex,w,v.layers,v.availableImages,s,c,p,(xe,$e,Ge)=>(fe||(fe=wo(xe)),$e.queryIntersectsFeature(E,xe,Ge,fe,this.z,t.transform,x,t.pixelPosMatrix)))}return G}loadMatchingFeature(t,s,c,p,v,x,w,E,C,L,O){const $=this.bucketLayerIDs[s];if(x&&!function(ie,ue){for(let Ee=0;Ee<ie.length;Ee++)if(ue.indexOf(ie[Ee])>=0)return!0;return!1}(x,$))return;const j=this.sourceLayerCoder.decode(c),G=this.vtLayers[j].feature(p);if(v.needGeometry){const ie=Mo(G,!0);if(!v.filter(new vr(this.tileID.overscaledZ),ie,this.tileID.canonical))return}else if(!v.filter(new vr(this.tileID.overscaledZ),G))return;const X=this.getId(G,j);for(let ie=0;ie<$.length;ie++){const ue=$[ie];if(x&&x.indexOf(ue)<0)continue;const Ee=E[ue];if(!Ee)continue;let fe={};X&&L&&(fe=L.getState(Ee.sourceLayer||"_geojsonTileLayer",X));const xe=bt({},C[ue]);xe.paint=gy(xe.paint,Ee.paint,G,fe,w),xe.layout=gy(xe.layout,Ee.layout,G,fe,w);const $e=!O||O(G,Ee,fe);if(!$e)continue;const Ge=new py(G,this.z,this.x,this.y,X);Ge.layer=xe;let It=t[ue];It===void 0&&(It=t[ue]=[]),It.push({featureIndex:p,feature:Ge,intersectionZ:$e})}}lookupSymbolFeatures(t,s,c,p,v,x,w,E){const C={};this.loadVTLayers();const L=va(v);for(const O of t)this.loadMatchingFeature(C,c,p,O,L,x,w,E,s);return C}hasLayer(t){for(const s of this.bucketLayerIDs)for(const c of s)if(t===c)return!0;return!1}getId(t,s){let c=t.id;return this.promoteId&&(c=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]],typeof c=="boolean"&&(c=Number(c))),c}}function gy(n,t,s,c,p){return lt(n,(v,x)=>{const w=t instanceof jl?t.get(x):null;return w&&w.evaluate?w.evaluate(s,c,p):w})}function yy(n){let t=1/0,s=1/0,c=-1/0,p=-1/0;for(const v of n)t=Math.min(t,v.x),s=Math.min(s,v.y),c=Math.max(c,v.x),p=Math.max(p,v.y);return{minX:t,minY:s,maxX:c,maxY:p}}function Eb(n,t){return t-n}function _y(n,t,s,c,p){const v=[];for(let x=0;x<n.length;x++){const w=n[x];let E;for(let C=0;C<w.length-1;C++){let L=w[C],O=w[C+1];L.x<t&&O.x<t||(L.x<t?L=new k(t,L.y+(t-L.x)/(O.x-L.x)*(O.y-L.y))._round():O.x<t&&(O=new k(t,L.y+(t-L.x)/(O.x-L.x)*(O.y-L.y))._round()),L.y<s&&O.y<s||(L.y<s?L=new k(L.x+(s-L.y)/(O.y-L.y)*(O.x-L.x),s)._round():O.y<s&&(O=new k(L.x+(s-L.y)/(O.y-L.y)*(O.x-L.x),s)._round()),L.x>=c&&O.x>=c||(L.x>=c?L=new k(c,L.y+(c-L.x)/(O.x-L.x)*(O.y-L.y))._round():O.x>=c&&(O=new k(c,L.y+(c-L.x)/(O.x-L.x)*(O.y-L.y))._round()),L.y>=p&&O.y>=p||(L.y>=p?L=new k(L.x+(p-L.y)/(O.y-L.y)*(O.x-L.x),p)._round():O.y>=p&&(O=new k(L.x+(p-L.y)/(O.y-L.y)*(O.x-L.x),p)._round()),E&&L.equals(E[E.length-1])||(E=[L],v.push(E)),E.push(O)))))}}return v}Tt("FeatureIndex",my,{omit:["rawTileData","sourceLayerCoder"]});class ll extends k{constructor(t,s,c,p){super(t,s),this.angle=c,p!==void 0&&(this.segment=p)}clone(){return new ll(this.x,this.y,this.angle,this.segment)}}function vy(n,t,s,c,p){if(t.segment===void 0||s===0)return!0;let v=t,x=t.segment+1,w=0;for(;w>-s/2;){if(x--,x<0)return!1;w-=n[x].dist(v),v=n[x]}w+=n[x].dist(n[x+1]),x++;const E=[];let C=0;for(;w<s/2;){const L=n[x],O=n[x+1];if(!O)return!1;let $=n[x-1].angleTo(L)-L.angleTo(O);for($=Math.abs(($+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:w,angleDelta:$}),C+=$;w-E[0].distance>c;)C-=E.shift().angleDelta;if(C>p)return!1;x++,w+=L.dist(O)}return!0}function xy(n){let t=0;for(let s=0;s<n.length-1;s++)t+=n[s].dist(n[s+1]);return t}function by(n,t,s){return n?.6*t*s:0}function wy(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function Tb(n,t,s,c,p,v){const x=by(s,p,v),w=wy(s,c)*v;let E=0;const C=xy(n)/2;for(let L=0;L<n.length-1;L++){const O=n[L],$=n[L+1],j=O.dist($);if(E+j>C){const G=(C-E)/j,X=dn.number(O.x,$.x,G),ie=dn.number(O.y,$.y,G),ue=new ll(X,ie,$.angleTo(O),L);return ue._round(),!x||vy(n,ue,w,x,t)?ue:void 0}E+=j}}function Ib(n,t,s,c,p,v,x,w,E){const C=by(c,v,x),L=wy(c,p),O=L*x,$=n[0].x===0||n[0].x===E||n[0].y===0||n[0].y===E;return t-O<t/4&&(t=O+t/4),My(n,$?t/2*w%t:(L/2+2*v)*x*w%t,t,C,s,O,$,!1,E)}function My(n,t,s,c,p,v,x,w,E){const C=v/2,L=xy(n);let O=0,$=t-s,j=[];for(let G=0;G<n.length-1;G++){const X=n[G],ie=n[G+1],ue=X.dist(ie),Ee=ie.angleTo(X);for(;$+s<O+ue;){$+=s;const fe=($-O)/ue,xe=dn.number(X.x,ie.x,fe),$e=dn.number(X.y,ie.y,fe);if(xe>=0&&xe<E&&$e>=0&&$e<E&&$-C>=0&&$+C<=L){const Ge=new ll(xe,$e,Ee,G);Ge._round(),c&&!vy(n,Ge,v,c,p)||j.push(Ge)}}O+=ue}return w||j.length||x||(j=My(n,O/2,s,c,p,v,x,!0,E)),j}Tt("Anchor",ll);const Uc=ls;function Sy(n,t,s,c){const p=[],v=n.image,x=v.pixelRatio,w=v.paddedRect.w-2*Uc,E=v.paddedRect.h-2*Uc,C=n.right-n.left,L=n.bottom-n.top,O=v.stretchX||[[0,w]],$=v.stretchY||[[0,E]],j=(ct,kt)=>ct+kt[1]-kt[0],G=O.reduce(j,0),X=$.reduce(j,0),ie=w-G,ue=E-X;let Ee=0,fe=G,xe=0,$e=X,Ge=0,It=ie,Ot=0,St=ue;if(v.content&&c){const ct=v.content;Ee=bd(O,0,ct[0]),xe=bd($,0,ct[1]),fe=bd(O,ct[0],ct[2]),$e=bd($,ct[1],ct[3]),Ge=ct[0]-Ee,Ot=ct[1]-xe,It=ct[2]-ct[0]-fe,St=ct[3]-ct[1]-$e}const xt=(ct,kt,_t,tt)=>{const Xt=wd(ct.stretch-Ee,fe,C,n.left),Nt=Md(ct.fixed-Ge,It,ct.stretch,G),Mi=wd(kt.stretch-xe,$e,L,n.top),mr=Md(kt.fixed-Ot,St,kt.stretch,X),br=wd(_t.stretch-Ee,fe,C,n.left),an=Md(_t.fixed-Ge,It,_t.stretch,G),Es=wd(tt.stretch-xe,$e,L,n.top),Kn=Md(tt.fixed-Ot,St,tt.stretch,X),Yr=new k(Xt,Mi),Sn=new k(br,Mi),kn=new k(br,Es),Yn=new k(Xt,Es),Jn=new k(Nt/x,mr/x),on=new k(an/x,Kn/x),ln=t*Math.PI/180;if(ln){const Fn=Math.sin(ln),cs=Math.cos(ln),us=[cs,-Fn,Fn,cs];Yr._matMult(us),Sn._matMult(us),Yn._matMult(us),kn._matMult(us)}const On=ct.stretch+ct.fixed,Qn=kt.stretch+kt.fixed;return{tl:Yr,tr:Sn,bl:Yn,br:kn,tex:{x:v.paddedRect.x+Uc+On,y:v.paddedRect.y+Uc+Qn,w:_t.stretch+_t.fixed-On,h:tt.stretch+tt.fixed-Qn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Jn,pixelOffsetBR:on,minFontScaleX:It/x/C,minFontScaleY:St/x/L,isSDF:s}};if(c&&(v.stretchX||v.stretchY)){const ct=Ey(O,ie,G),kt=Ey($,ue,X);for(let _t=0;_t<ct.length-1;_t++){const tt=ct[_t],Xt=ct[_t+1];for(let Nt=0;Nt<kt.length-1;Nt++)p.push(xt(tt,kt[Nt],Xt,kt[Nt+1]))}}else p.push(xt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:E+1}));return p}function bd(n,t,s){let c=0;for(const p of n)c+=Math.max(t,Math.min(s,p[1]))-Math.max(t,Math.min(s,p[0]));return c}function Ey(n,t,s){const c=[{fixed:-Uc,stretch:0}];for(const[p,v]of n){const x=c[c.length-1];c.push({fixed:p-x.stretch,stretch:x.stretch}),c.push({fixed:p-x.stretch,stretch:x.stretch+(v-p)})}return c.push({fixed:t+Uc,stretch:s}),c}function wd(n,t,s,c){return n/t*s+c}function Md(n,t,s,c){return n-t*s/c}class Sd{constructor(t,s,c,p,v,x,w,E,C,L){if(this.boxStartIndex=t.length,C){let O=x.top,$=x.bottom;const j=x.collisionPadding;j&&(O-=j[1],$+=j[3]);let G=$-O;G>0&&(G=Math.max(10,G),this.circleDiameter=G)}else{let O=x.top*w-E[0],$=x.bottom*w+E[2],j=x.left*w-E[3],G=x.right*w+E[1];const X=x.collisionPadding;if(X&&(j-=X[0]*w,O-=X[1]*w,G+=X[2]*w,$+=X[3]*w),L){const ie=new k(j,O),ue=new k(G,O),Ee=new k(j,$),fe=new k(G,$),xe=L*Math.PI/180;ie._rotate(xe),ue._rotate(xe),Ee._rotate(xe),fe._rotate(xe),j=Math.min(ie.x,ue.x,Ee.x,fe.x),G=Math.max(ie.x,ue.x,Ee.x,fe.x),O=Math.min(ie.y,ue.y,Ee.y,fe.y),$=Math.max(ie.y,ue.y,Ee.y,fe.y)}t.emplaceBack(s.x,s.y,j,O,G,$,c,p,v)}this.boxEndIndex=t.length}}class Cb{constructor(t=[],s=Ab){if(this.data=t,this.length=this.data.length,this.compare=s,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:s,compare:c}=this,p=s[t];for(;t>0;){const v=t-1>>1,x=s[v];if(c(p,x)>=0)break;s[t]=x,t=v}s[t]=p}_down(t){const{data:s,compare:c}=this,p=this.length>>1,v=s[t];for(;t<p;){let x=1+(t<<1),w=s[x];const E=x+1;if(E<this.length&&c(s[E],w)<0&&(x=E,w=s[E]),c(w,v)>=0)break;s[t]=w,t=x}s[t]=v}}function Ab(n,t){return n<t?-1:n>t?1:0}function Pb(n,t=1,s=!1){let c=1/0,p=1/0,v=-1/0,x=-1/0;const w=n[0];for(let j=0;j<w.length;j++){const G=w[j];(!j||G.x<c)&&(c=G.x),(!j||G.y<p)&&(p=G.y),(!j||G.x>v)&&(v=G.x),(!j||G.y>x)&&(x=G.y)}const E=Math.min(v-c,x-p);let C=E/2;const L=new Cb([],kb);if(E===0)return new k(c,p);for(let j=c;j<v;j+=E)for(let G=p;G<x;G+=E)L.push(new Vc(j+C,G+C,C,n));let O=function(j){let G=0,X=0,ie=0;const ue=j[0];for(let Ee=0,fe=ue.length,xe=fe-1;Ee<fe;xe=Ee++){const $e=ue[Ee],Ge=ue[xe],It=$e.x*Ge.y-Ge.x*$e.y;X+=($e.x+Ge.x)*It,ie+=($e.y+Ge.y)*It,G+=3*It}return new Vc(X/G,ie/G,0,j)}(n),$=L.length;for(;L.length;){const j=L.pop();(j.d>O.d||!O.d)&&(O=j,s&&console.log("found best %d after %d probes",Math.round(1e4*j.d)/1e4,$)),j.max-O.d<=t||(C=j.h/2,L.push(new Vc(j.p.x-C,j.p.y-C,C,n)),L.push(new Vc(j.p.x+C,j.p.y-C,C,n)),L.push(new Vc(j.p.x-C,j.p.y+C,C,n)),L.push(new Vc(j.p.x+C,j.p.y+C,C,n)),$+=4)}return s&&(console.log(`num probes: ${$}`),console.log(`best distance: ${O.d}`)),O.p}function kb(n,t){return t.max-n.max}function Vc(n,t,s,c){this.p=new k(n,t),this.h=s,this.d=function(p,v){let x=!1,w=1/0;for(let E=0;E<v.length;E++){const C=v[E];for(let L=0,O=C.length,$=O-1;L<O;$=L++){const j=C[L],G=C[$];j.y>p.y!=G.y>p.y&&p.x<(G.x-j.x)*(p.y-j.y)/(G.y-j.y)+j.x&&(x=!x),w=Math.min(w,lg(p,j,G))}}return(x?1:-1)*Math.sqrt(w)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}var Pn;m.ap=void 0,(Pn=m.ap||(m.ap={}))[Pn.center=1]="center",Pn[Pn.left=2]="left",Pn[Pn.right=3]="right",Pn[Pn.top=4]="top",Pn[Pn.bottom=5]="bottom",Pn[Pn["top-left"]=6]="top-left",Pn[Pn["top-right"]=7]="top-right",Pn[Pn["bottom-left"]=8]="bottom-left",Pn[Pn["bottom-right"]=9]="bottom-right";const cl=7,gp=Number.POSITIVE_INFINITY;function Ty(n,t){return t[1]!==gp?function(s,c,p){let v=0,x=0;switch(c=Math.abs(c),p=Math.abs(p),s){case"top-right":case"top-left":case"top":x=p-cl;break;case"bottom-right":case"bottom-left":case"bottom":x=-p+cl}switch(s){case"top-right":case"bottom-right":case"right":v=-c;break;case"top-left":case"bottom-left":case"left":v=c}return[v,x]}(n,t[0],t[1]):function(s,c){let p=0,v=0;c<0&&(c=0);const x=c/Math.SQRT2;switch(s){case"top-right":case"top-left":v=x-cl;break;case"bottom-right":case"bottom-left":v=-x+cl;break;case"bottom":v=-c+cl;break;case"top":v=c-cl}switch(s){case"top-right":case"bottom-right":p=-x;break;case"top-left":case"bottom-left":p=x;break;case"left":p=c;break;case"right":p=-c}return[p,v]}(n,t[0])}function Iy(n,t,s){var c;const p=n.layout,v=(c=p.get("text-variable-anchor-offset"))===null||c===void 0?void 0:c.evaluate(t,{},s);if(v){const w=v.values,E=[];for(let C=0;C<w.length;C+=2){const L=E[C]=w[C],O=w[C+1].map($=>$*sn);L.startsWith("top")?O[1]-=cl:L.startsWith("bottom")&&(O[1]+=cl),E[C+1]=O}return new kr(E)}const x=p.get("text-variable-anchor");if(x){let w;w=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[p.get("text-radial-offset").evaluate(t,{},s)*sn,gp]:p.get("text-offset").evaluate(t,{},s).map(C=>C*sn);const E=[];for(const C of x)E.push(C,Ty(C,w));return new kr(E)}return null}function yp(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Db(n,t,s,c,p,v,x,w,E,C,L){let O=v.textMaxSize.evaluate(t,{});O===void 0&&(O=x);const $=n.layers[0].layout,j=$.get("icon-offset").evaluate(t,{},L),G=Ay(s.horizontal),X=x/24,ie=n.tilePixelRatio*X,ue=n.tilePixelRatio*O/24,Ee=n.tilePixelRatio*w,fe=n.tilePixelRatio*$.get("symbol-spacing"),xe=$.get("text-padding")*n.tilePixelRatio,$e=function(tt,Xt,Nt,Mi=1){const mr=tt.get("icon-padding").evaluate(Xt,{},Nt),br=mr&&mr.values;return[br[0]*Mi,br[1]*Mi,br[2]*Mi,br[3]*Mi]}($,t,L,n.tilePixelRatio),Ge=$.get("text-max-angle")/180*Math.PI,It=$.get("text-rotation-alignment")!=="viewport"&&$.get("symbol-placement")!=="point",Ot=$.get("icon-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",St=$.get("symbol-placement"),xt=fe/2,ct=$.get("icon-text-fit");let kt;c&&ct!=="none"&&(n.allowVerticalPlacement&&s.vertical&&(kt=Jg(c,s.vertical,ct,$.get("icon-text-fit-padding"),j,X)),G&&(c=Jg(c,G,ct,$.get("icon-text-fit-padding"),j,X)));const _t=(tt,Xt)=>{Xt.x<0||Xt.x>=Nr||Xt.y<0||Xt.y>=Nr||function(Nt,Mi,mr,br,an,Es,Kn,Yr,Sn,kn,Yn,Jn,on,ln,On,Qn,Fn,cs,us,cn,Ci,Bn,Dn,un,oa){const Ta=Nt.addToLineVertexArray(Mi,mr);let Ia,Eo,la,Hs,hs=0,To=0,Ju=0,Ly=0,Ep=-1,Tp=-1;const Io={};let Ry=zr("");if(Nt.allowVerticalPlacement&&br.vertical){const Nn=Yr.layout.get("text-rotate").evaluate(Ci,{},un)+90;la=new Sd(Sn,Mi,kn,Yn,Jn,br.vertical,on,ln,On,Nn),Kn&&(Hs=new Sd(Sn,Mi,kn,Yn,Jn,Kn,Fn,cs,On,Nn))}if(an){const Nn=Yr.layout.get("icon-rotate").evaluate(Ci,{}),Zs=Yr.layout.get("icon-text-fit")!=="none",Jl=Sy(an,Nn,Dn,Zs),Aa=Kn?Sy(Kn,Nn,Dn,Zs):void 0;Eo=new Sd(Sn,Mi,kn,Yn,Jn,an,Fn,cs,!1,Nn),hs=4*Jl.length;const Ql=Nt.iconSizeData;let Ka=null;Ql.kind==="source"?(Ka=[Xa*Yr.layout.get("icon-size").evaluate(Ci,{})],Ka[0]>al&&pi(`${Nt.layerIds[0]}: Value for "icon-size" is >= ${Wu}. Reduce your "icon-size".`)):Ql.kind==="composite"&&(Ka=[Xa*Bn.compositeIconSizes[0].evaluate(Ci,{},un),Xa*Bn.compositeIconSizes[1].evaluate(Ci,{},un)],(Ka[0]>al||Ka[1]>al)&&pi(`${Nt.layerIds[0]}: Value for "icon-size" is >= ${Wu}. Reduce your "icon-size".`)),Nt.addSymbols(Nt.icon,Jl,Ka,cn,us,Ci,m.ah.none,Mi,Ta.lineStartIndex,Ta.lineLength,-1,un),Ep=Nt.icon.placedSymbolArray.length-1,Aa&&(To=4*Aa.length,Nt.addSymbols(Nt.icon,Aa,Ka,cn,us,Ci,m.ah.vertical,Mi,Ta.lineStartIndex,Ta.lineLength,-1,un),Tp=Nt.icon.placedSymbolArray.length-1)}const zy=Object.keys(br.horizontal);for(const Nn of zy){const Zs=br.horizontal[Nn];if(!Ia){Ry=zr(Zs.text);const Aa=Yr.layout.get("text-rotate").evaluate(Ci,{},un);Ia=new Sd(Sn,Mi,kn,Yn,Jn,Zs,on,ln,On,Aa)}const Jl=Zs.positionedLines.length===1;if(Ju+=Cy(Nt,Mi,Zs,Es,Yr,On,Ci,Qn,Ta,br.vertical?m.ah.horizontal:m.ah.horizontalOnly,Jl?zy:[Nn],Io,Ep,Bn,un),Jl)break}br.vertical&&(Ly+=Cy(Nt,Mi,br.vertical,Es,Yr,On,Ci,Qn,Ta,m.ah.vertical,["vertical"],Io,Tp,Bn,un));const zb=Ia?Ia.boxStartIndex:Nt.collisionBoxArray.length,Ob=Ia?Ia.boxEndIndex:Nt.collisionBoxArray.length,Fb=la?la.boxStartIndex:Nt.collisionBoxArray.length,Bb=la?la.boxEndIndex:Nt.collisionBoxArray.length,Nb=Eo?Eo.boxStartIndex:Nt.collisionBoxArray.length,$b=Eo?Eo.boxEndIndex:Nt.collisionBoxArray.length,Ub=Hs?Hs.boxStartIndex:Nt.collisionBoxArray.length,Vb=Hs?Hs.boxEndIndex:Nt.collisionBoxArray.length;let Ca=-1;const Td=(Nn,Zs)=>Nn&&Nn.circleDiameter?Math.max(Nn.circleDiameter,Zs):Zs;Ca=Td(Ia,Ca),Ca=Td(la,Ca),Ca=Td(Eo,Ca),Ca=Td(Hs,Ca);const Oy=Ca>-1?1:0;Oy&&(Ca*=oa/sn),Nt.glyphOffsetArray.length>=$c.MAX_GLYPHS&&pi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ci.sortKey!==void 0&&Nt.addToSortKeyRanges(Nt.symbolInstances.length,Ci.sortKey);const jb=Iy(Yr,Ci,un),[qb,Gb]=function(Nn,Zs){const Jl=Nn.length,Aa=Zs==null?void 0:Zs.values;if((Aa==null?void 0:Aa.length)>0)for(let Ql=0;Ql<Aa.length;Ql+=2){const Ka=Aa[Ql+1];Nn.emplaceBack(m.ap[Aa[Ql]],Ka[0],Ka[1])}return[Jl,Nn.length]}(Nt.textAnchorOffsets,jb);Nt.symbolInstances.emplaceBack(Mi.x,Mi.y,Io.right>=0?Io.right:-1,Io.center>=0?Io.center:-1,Io.left>=0?Io.left:-1,Io.vertical||-1,Ep,Tp,Ry,zb,Ob,Fb,Bb,Nb,$b,Ub,Vb,kn,Ju,Ly,hs,To,Oy,0,on,Ca,qb,Gb)}(n,Xt,tt,s,c,p,kt,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,ie,[xe,xe,xe,xe],It,E,Ee,$e,Ot,j,t,v,C,L,x)};if(St==="line")for(const tt of _y(t.geometry,0,0,Nr,Nr)){const Xt=Ib(tt,fe,Ge,s.vertical||G,c,24,ue,n.overscaling,Nr);for(const Nt of Xt)G&&Lb(n,G.text,xt,Nt)||_t(tt,Nt)}else if(St==="line-center"){for(const tt of t.geometry)if(tt.length>1){const Xt=Tb(tt,Ge,s.vertical||G,c,24,ue);Xt&&_t(tt,Xt)}}else if(t.type==="Polygon")for(const tt of Xf(t.geometry,0)){const Xt=Pb(tt,16);_t(tt[0],new ll(Xt.x,Xt.y,0))}else if(t.type==="LineString")for(const tt of t.geometry)_t(tt,new ll(tt[0].x,tt[0].y,0));else if(t.type==="Point")for(const tt of t.geometry)for(const Xt of tt)_t([Xt],new ll(Xt.x,Xt.y,0))}function Cy(n,t,s,c,p,v,x,w,E,C,L,O,$,j,G){const X=function(Ee,fe,xe,$e,Ge,It,Ot,St){const xt=$e.layout.get("text-rotate").evaluate(It,{})*Math.PI/180,ct=[];for(const kt of fe.positionedLines)for(const _t of kt.positionedGlyphs){if(!_t.rect)continue;const tt=_t.rect||{};let Xt=Gg+1,Nt=!0,Mi=1,mr=0;const br=(Ge||St)&&_t.vertical,an=_t.metrics.advance*_t.scale/2;if(St&&fe.verticalizable&&(mr=kt.lineOffset/2-(_t.imageName?-(sn-_t.metrics.width*_t.scale)/2:(_t.scale-1)*sn)),_t.imageName){const cn=Ot[_t.imageName];Nt=cn.sdf,Mi=cn.pixelRatio,Xt=ls/Mi}const Es=Ge?[_t.x+an,_t.y]:[0,0];let Kn=Ge?[0,0]:[_t.x+an+xe[0],_t.y+xe[1]-mr],Yr=[0,0];br&&(Yr=Kn,Kn=[0,0]);const Sn=_t.metrics.isDoubleResolution?2:1,kn=(_t.metrics.left-Xt)*_t.scale-an+Kn[0],Yn=(-_t.metrics.top-Xt)*_t.scale+Kn[1],Jn=kn+tt.w/Sn*_t.scale/Mi,on=Yn+tt.h/Sn*_t.scale/Mi,ln=new k(kn,Yn),On=new k(Jn,Yn),Qn=new k(kn,on),Fn=new k(Jn,on);if(br){const cn=new k(-an,an-Hu),Ci=-Math.PI/2,Bn=sn/2-an,Dn=new k(5-Hu-Bn,-(_t.imageName?Bn:0)),un=new k(...Yr);ln._rotateAround(Ci,cn)._add(Dn)._add(un),On._rotateAround(Ci,cn)._add(Dn)._add(un),Qn._rotateAround(Ci,cn)._add(Dn)._add(un),Fn._rotateAround(Ci,cn)._add(Dn)._add(un)}if(xt){const cn=Math.sin(xt),Ci=Math.cos(xt),Bn=[Ci,-cn,cn,Ci];ln._matMult(Bn),On._matMult(Bn),Qn._matMult(Bn),Fn._matMult(Bn)}const cs=new k(0,0),us=new k(0,0);ct.push({tl:ln,tr:On,bl:Qn,br:Fn,tex:tt,writingMode:fe.writingMode,glyphOffset:Es,sectionIndex:_t.sectionIndex,isSDF:Nt,pixelOffsetTL:cs,pixelOffsetBR:us,minFontScaleX:0,minFontScaleY:0})}return ct}(0,s,w,p,v,x,c,n.allowVerticalPlacement),ie=n.textSizeData;let ue=null;ie.kind==="source"?(ue=[Xa*p.layout.get("text-size").evaluate(x,{})],ue[0]>al&&pi(`${n.layerIds[0]}: Value for "text-size" is >= ${Wu}. Reduce your "text-size".`)):ie.kind==="composite"&&(ue=[Xa*j.compositeTextSizes[0].evaluate(x,{},G),Xa*j.compositeTextSizes[1].evaluate(x,{},G)],(ue[0]>al||ue[1]>al)&&pi(`${n.layerIds[0]}: Value for "text-size" is >= ${Wu}. Reduce your "text-size".`)),n.addSymbols(n.text,X,ue,w,v,x,C,t,E.lineStartIndex,E.lineLength,$,G);for(const Ee of L)O[Ee]=n.text.placedSymbolArray.length-1;return 4*X.length}function Ay(n){for(const t in n)return n[t];return null}function Lb(n,t,s,c){const p=n.compareText;if(t in p){const v=p[t];for(let x=v.length-1;x>=0;x--)if(c.dist(v[x])<s)return!0}else p[t]=[];return p[t].push(c),!1}const Py=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class _p{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,c]=new Uint8Array(t,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=c>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const v=Py[15&c];if(!v)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(t,2,1),[w]=new Uint32Array(t,4,1);return new _p(w,x,v,t)}constructor(t,s=64,c=Float64Array,p){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=c,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const v=Py.indexOf(this.ArrayType),x=2*t*this.ArrayType.BYTES_PER_ELEMENT,w=t*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-w%8)%8;if(v<0)throw new Error(`Unexpected typed array class: ${c}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+w+E,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+x+w+E),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+w+E,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+v]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=t)}add(t,s){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=t,this.coords[this._pos++]=s,c}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return vp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,s,c,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:x,nodeSize:w}=this,E=[0,v.length-1,0],C=[];for(;E.length;){const L=E.pop()||0,O=E.pop()||0,$=E.pop()||0;if(O-$<=w){for(let ie=$;ie<=O;ie++){const ue=x[2*ie],Ee=x[2*ie+1];ue>=t&&ue<=c&&Ee>=s&&Ee<=p&&C.push(v[ie])}continue}const j=$+O>>1,G=x[2*j],X=x[2*j+1];G>=t&&G<=c&&X>=s&&X<=p&&C.push(v[j]),(L===0?t<=G:s<=X)&&(E.push($),E.push(j-1),E.push(1-L)),(L===0?c>=G:p>=X)&&(E.push(j+1),E.push(O),E.push(1-L))}return C}within(t,s,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:v,nodeSize:x}=this,w=[0,p.length-1,0],E=[],C=c*c;for(;w.length;){const L=w.pop()||0,O=w.pop()||0,$=w.pop()||0;if(O-$<=x){for(let ie=$;ie<=O;ie++)Dy(v[2*ie],v[2*ie+1],t,s)<=C&&E.push(p[ie]);continue}const j=$+O>>1,G=v[2*j],X=v[2*j+1];Dy(G,X,t,s)<=C&&E.push(p[j]),(L===0?t-c<=G:s-c<=X)&&(w.push($),w.push(j-1),w.push(1-L)),(L===0?t+c>=G:s+c>=X)&&(w.push(j+1),w.push(O),w.push(1-L))}return E}}function vp(n,t,s,c,p,v){if(p-c<=s)return;const x=c+p>>1;ky(n,t,x,c,p,v),vp(n,t,s,c,x-1,1-v),vp(n,t,s,x+1,p,1-v)}function ky(n,t,s,c,p,v){for(;p>c;){if(p-c>600){const C=p-c+1,L=s-c+1,O=Math.log(C),$=.5*Math.exp(2*O/3),j=.5*Math.sqrt(O*$*(C-$)/C)*(L-C/2<0?-1:1);ky(n,t,s,Math.max(c,Math.floor(s-L*$/C+j)),Math.min(p,Math.floor(s+(C-L)*$/C+j)),v)}const x=t[2*s+v];let w=c,E=p;for(Ku(n,t,c,s),t[2*p+v]>x&&Ku(n,t,c,p);w<E;){for(Ku(n,t,w,E),w++,E--;t[2*w+v]<x;)w++;for(;t[2*E+v]>x;)E--}t[2*c+v]===x?Ku(n,t,c,E):(E++,Ku(n,t,E,p)),E<=s&&(c=E+1),s<=E&&(p=E-1)}}function Ku(n,t,s,c){xp(n,s,c),xp(t,2*s,2*c),xp(t,2*s+1,2*c+1)}function xp(n,t,s){const c=n[t];n[t]=n[s],n[s]=c}function Dy(n,t,s,c){const p=n-s,v=t-c;return p*p+v*v}var bp;m.bd=void 0,(bp=m.bd||(m.bd={})).create="create",bp.load="load",bp.fullLoad="fullLoad";let Ed=null,Yu=[];const wp=1e3/60,Mp="loadTime",Sp="fullLoadTime",Rb={mark(n){performance.mark(n)},frame(n){const t=n;Ed!=null&&Yu.push(t-Ed),Ed=t},clearMetrics(){Ed=null,Yu=[],performance.clearMeasures(Mp),performance.clearMeasures(Sp);for(const n in m.bd)performance.clearMarks(m.bd[n])},getPerformanceMetrics(){performance.measure(Mp,m.bd.create,m.bd.load),performance.measure(Sp,m.bd.create,m.bd.fullLoad);const n=performance.getEntriesByName(Mp)[0].duration,t=performance.getEntriesByName(Sp)[0].duration,s=Yu.length,c=1/(Yu.reduce((v,x)=>v+x,0)/s/1e3),p=Yu.filter(v=>v>wp).reduce((v,x)=>v+(x-wp)/wp,0);return{loadTime:n,fullLoadTime:t,fps:c,percentDroppedFrames:p/(s+p)*100,totalFrames:s}}};m.$=dt,m.A=Rc,m.B=function(n){if(Qt==null){const t=n.navigator?n.navigator.userAgent:null;Qt=!!n.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Qt},m.C=class{constructor(n,t){this.target=n,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Sb(()=>this.process()),this.subscription=function(s,c,p,v){return s.addEventListener(c,p,!1),{unsubscribe:()=>{s.removeEventListener(c,p,!1)}}}(this.target,"message",s=>this.receive(s)),this.globalScope=si(self)?n:window}registerMessageHandler(n,t){this.messageHandlers[n]=t}sendAsync(n,t){return new Promise((s,c)=>{const p=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[p]={resolve:s,reject:c},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[p];const w={id:p,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(w)},{once:!0});const v=[],x=Object.assign(Object.assign({},n),{id:p,sourceMapId:this.mapId,origin:location.origin,data:ss(n.data,v)});this.target.postMessage(x,{transfer:v})})}receive(n){const t=n.data,s=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[s];const c=this.abortControllers[s];return delete this.abortControllers[s],void(c&&c.abort())}if(si(self)||t.mustQueue)return this.tasks[s]=t,this.taskQueue.push(s),void this.invoker.trigger();this.processTask(s,t)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),t=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(n,t)}processTask(n,t){return l(this,void 0,void 0,function*(){if(t.type==="<response>"){const p=this.resolveRejects[n];return delete this.resolveRejects[n],p?void(t.error?p.reject(Zn(t.error)):p.resolve(Zn(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const s=Zn(t.data),c=new AbortController;this.abortControllers[n]=c;try{const p=yield this.messageHandlers[t.type](t.sourceMapId,s,c);this.completeTask(n,null,p)}catch(p){this.completeTask(n,p)}})}completeTask(n,t,s){const c=[];delete this.abortControllers[n];const p={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?ss(t):null,data:ss(s,c)};this.target.postMessage(p,{transfer:c})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},m.D=Ut,m.E=Oe,m.F=function(){var n=new Rc(16);return Rc!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},m.G=Ve,m.H=function(n,t,s){var c,p,v,x,w,E,C,L,O,$,j,G,X=s[0],ie=s[1],ue=s[2];return t===n?(n[12]=t[0]*X+t[4]*ie+t[8]*ue+t[12],n[13]=t[1]*X+t[5]*ie+t[9]*ue+t[13],n[14]=t[2]*X+t[6]*ie+t[10]*ue+t[14],n[15]=t[3]*X+t[7]*ie+t[11]*ue+t[15]):(p=t[1],v=t[2],x=t[3],w=t[4],E=t[5],C=t[6],L=t[7],O=t[8],$=t[9],j=t[10],G=t[11],n[0]=c=t[0],n[1]=p,n[2]=v,n[3]=x,n[4]=w,n[5]=E,n[6]=C,n[7]=L,n[8]=O,n[9]=$,n[10]=j,n[11]=G,n[12]=c*X+w*ie+O*ue+t[12],n[13]=p*X+E*ie+$*ue+t[13],n[14]=v*X+C*ie+j*ue+t[14],n[15]=x*X+L*ie+G*ue+t[15]),n},m.I=sp,m.J=function(n,t,s){var c=s[0],p=s[1],v=s[2];return n[0]=t[0]*c,n[1]=t[1]*c,n[2]=t[2]*c,n[3]=t[3]*c,n[4]=t[4]*p,n[5]=t[5]*p,n[6]=t[6]*p,n[7]=t[7]*p,n[8]=t[8]*v,n[9]=t[9]*v,n[10]=t[10]*v,n[11]=t[11]*v,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},m.K=dg,m.L=function(n,t){const s={};for(let c=0;c<t.length;c++){const p=t[c];p in n&&(s[p]=n[p])}return s},m.M=ol,m.N=oy,m.O=ly,m.P=k,m.Q=Gs,m.R=qs,m.S=Te,m.T=bu,m.U=Fe,m.V=Ar,m.W=Nr,m.X=qr,m.Y=xd,m.Z=class extends Su{},m._=l,m.a=ji,m.a$=function(n,t,s){return n[0]=t[0]*s[0],n[1]=t[1]*s[1],n[2]=t[2]*s[2],n[3]=t[3]*s[3],n},m.a0=mp,m.a1=Ue,m.a2=n=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(s=>{t.onloadstart=()=>{s(t)};for(const c of n){const p=window.document.createElement("source");Pi(c)||(t.crossOrigin="Anonymous"),p.src=c,t.appendChild(p)}})},m.a3=function(){return He++},m.a4=g,m.a5=$c,m.a6=va,m.a7=Mo,m.a8=vr,m.a9=py,m.aA=Pt,m.aB=function(n,t){if(!n)return[{command:"setStyle",args:[t]}];let s=[];try{if(!Be(n.version,t.version))return[{command:"setStyle",args:[t]}];Be(n.center,t.center)||s.push({command:"setCenter",args:[t.center]}),Be(n.zoom,t.zoom)||s.push({command:"setZoom",args:[t.zoom]}),Be(n.bearing,t.bearing)||s.push({command:"setBearing",args:[t.bearing]}),Be(n.pitch,t.pitch)||s.push({command:"setPitch",args:[t.pitch]}),Be(n.sprite,t.sprite)||s.push({command:"setSprite",args:[t.sprite]}),Be(n.glyphs,t.glyphs)||s.push({command:"setGlyphs",args:[t.glyphs]}),Be(n.transition,t.transition)||s.push({command:"setTransition",args:[t.transition]}),Be(n.light,t.light)||s.push({command:"setLight",args:[t.light]}),Be(n.terrain,t.terrain)||s.push({command:"setTerrain",args:[t.terrain]}),Be(n.sky,t.sky)||s.push({command:"setSky",args:[t.sky]});const c={},p=[];(function(x,w,E,C){let L;for(L in w=w||{},x=x||{})Object.prototype.hasOwnProperty.call(x,L)&&(Object.prototype.hasOwnProperty.call(w,L)||At(L,E,C));for(L in w)Object.prototype.hasOwnProperty.call(w,L)&&(Object.prototype.hasOwnProperty.call(x,L)?Be(x[L],w[L])||(x[L].type==="geojson"&&w[L].type==="geojson"&&jt(x,w,L)?nt(E,{command:"setGeoJSONSourceData",args:[L,w[L].data]}):Gt(L,w,E,C)):it(L,w,E))})(n.sources,t.sources,p,c);const v=[];n.layers&&n.layers.forEach(x=>{"source"in x&&c[x.source]?s.push({command:"removeLayer",args:[x.id]}):v.push(x)}),s=s.concat(p),function(x,w,E){w=w||[];const C=(x=x||[]).map(mi),L=w.map(mi),O=x.reduce(Si,{}),$=w.reduce(Si,{}),j=C.slice(),G=Object.create(null);let X,ie,ue,Ee,fe;for(let xe=0,$e=0;xe<C.length;xe++)X=C[xe],Object.prototype.hasOwnProperty.call($,X)?$e++:(nt(E,{command:"removeLayer",args:[X]}),j.splice(j.indexOf(X,$e),1));for(let xe=0,$e=0;xe<L.length;xe++)X=L[L.length-1-xe],j[j.length-1-xe]!==X&&(Object.prototype.hasOwnProperty.call(O,X)?(nt(E,{command:"removeLayer",args:[X]}),j.splice(j.lastIndexOf(X,j.length-$e),1)):$e++,Ee=j[j.length-xe],nt(E,{command:"addLayer",args:[$[X],Ee]}),j.splice(j.length-xe,0,X),G[X]=!0);for(let xe=0;xe<L.length;xe++)if(X=L[xe],ie=O[X],ue=$[X],!G[X]&&!Be(ie,ue))if(Be(ie.source,ue.source)&&Be(ie["source-layer"],ue["source-layer"])&&Be(ie.type,ue.type)){for(fe in Wt(ie.layout,ue.layout,E,X,null,"setLayoutProperty"),Wt(ie.paint,ue.paint,E,X,null,"setPaintProperty"),Be(ie.filter,ue.filter)||nt(E,{command:"setFilter",args:[X,ue.filter]}),Be(ie.minzoom,ue.minzoom)&&Be(ie.maxzoom,ue.maxzoom)||nt(E,{command:"setLayerZoomRange",args:[X,ue.minzoom,ue.maxzoom]}),ie)Object.prototype.hasOwnProperty.call(ie,fe)&&fe!=="layout"&&fe!=="paint"&&fe!=="filter"&&fe!=="metadata"&&fe!=="minzoom"&&fe!=="maxzoom"&&(fe.indexOf("paint.")===0?Wt(ie[fe],ue[fe],E,X,fe.slice(6),"setPaintProperty"):Be(ie[fe],ue[fe])||nt(E,{command:"setLayerProperty",args:[X,fe,ue[fe]]}));for(fe in ue)Object.prototype.hasOwnProperty.call(ue,fe)&&!Object.prototype.hasOwnProperty.call(ie,fe)&&fe!=="layout"&&fe!=="paint"&&fe!=="filter"&&fe!=="metadata"&&fe!=="minzoom"&&fe!=="maxzoom"&&(fe.indexOf("paint.")===0?Wt(ie[fe],ue[fe],E,X,fe.slice(6),"setPaintProperty"):Be(ie[fe],ue[fe])||nt(E,{command:"setLayerProperty",args:[X,fe,ue[fe]]}))}else nt(E,{command:"removeLayer",args:[X]}),Ee=j[j.lastIndexOf(X)+1],nt(E,{command:"addLayer",args:[ue,Ee]})}(v,t.layers,s)}catch(c){console.warn("Unable to compute style diff:",c),s=[{command:"setStyle",args:[t]}]}return s},m.aC=function(n){const t=[],s=n.id;return s===void 0&&t.push({message:`layers.${s}: missing required property "id"`}),n.render===void 0&&t.push({message:`layers.${s}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&t.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),t},m.aD=function n(t,s){if(Array.isArray(t)){if(!Array.isArray(s)||t.length!==s.length)return!1;for(let c=0;c<t.length;c++)if(!n(t[c],s[c]))return!1;return!0}if(typeof t=="object"&&t!==null&&s!==null){if(typeof s!="object"||Object.keys(t).length!==Object.keys(s).length)return!1;for(const c in t)if(!n(t[c],s[c]))return!1;return!0}return t===s},m.aE=lt,m.aF=Rt,m.aG=class extends nn{constructor(n,t){super(n,t),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},m.aH=os,m.aI=class extends nn{constructor(n,t){super(n,t),this.current=Kl}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let t=1;t<16;t++)if(n[t]!==this.current[t]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},m.aJ=sa,m.aK=class extends nn{constructor(n,t){super(n,t),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},m.aL=class extends nn{constructor(n,t){super(n,t),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},m.aM=Ha,m.aN=function(n,t,s,c,p,v,x){var w=1/(t-s),E=1/(c-p),C=1/(v-x);return n[0]=-2*w,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*E,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*C,n[11]=0,n[12]=(t+s)*w,n[13]=(p+c)*E,n[14]=(x+v)*C,n[15]=1,n},m.aO=Ni,m.aP=n1,m.aQ=class extends Tc{},m.aR=J1,m.aS=class extends Ic{},m.aT=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},m.aU=yg,m.aV=B,m.aW=class extends Pu{},m.aX=ze,m.aY=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]&&n[9]===t[9]&&n[10]===t[10]&&n[11]===t[11]&&n[12]===t[12]&&n[13]===t[13]&&n[14]===t[14]&&n[15]===t[15]},m.aZ=function(n,t){var s=n[0],c=n[1],p=n[2],v=n[3],x=n[4],w=n[5],E=n[6],C=n[7],L=n[8],O=n[9],$=n[10],j=n[11],G=n[12],X=n[13],ie=n[14],ue=n[15],Ee=t[0],fe=t[1],xe=t[2],$e=t[3],Ge=t[4],It=t[5],Ot=t[6],St=t[7],xt=t[8],ct=t[9],kt=t[10],_t=t[11],tt=t[12],Xt=t[13],Nt=t[14],Mi=t[15];return Math.abs(s-Ee)<=Xn*Math.max(1,Math.abs(s),Math.abs(Ee))&&Math.abs(c-fe)<=Xn*Math.max(1,Math.abs(c),Math.abs(fe))&&Math.abs(p-xe)<=Xn*Math.max(1,Math.abs(p),Math.abs(xe))&&Math.abs(v-$e)<=Xn*Math.max(1,Math.abs(v),Math.abs($e))&&Math.abs(x-Ge)<=Xn*Math.max(1,Math.abs(x),Math.abs(Ge))&&Math.abs(w-It)<=Xn*Math.max(1,Math.abs(w),Math.abs(It))&&Math.abs(E-Ot)<=Xn*Math.max(1,Math.abs(E),Math.abs(Ot))&&Math.abs(C-St)<=Xn*Math.max(1,Math.abs(C),Math.abs(St))&&Math.abs(L-xt)<=Xn*Math.max(1,Math.abs(L),Math.abs(xt))&&Math.abs(O-ct)<=Xn*Math.max(1,Math.abs(O),Math.abs(ct))&&Math.abs($-kt)<=Xn*Math.max(1,Math.abs($),Math.abs(kt))&&Math.abs(j-_t)<=Xn*Math.max(1,Math.abs(j),Math.abs(_t))&&Math.abs(G-tt)<=Xn*Math.max(1,Math.abs(G),Math.abs(tt))&&Math.abs(X-Xt)<=Xn*Math.max(1,Math.abs(X),Math.abs(Xt))&&Math.abs(ie-Nt)<=Xn*Math.max(1,Math.abs(ie),Math.abs(Nt))&&Math.abs(ue-Mi)<=Xn*Math.max(1,Math.abs(ue),Math.abs(Mi))},m.a_=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},m.aa=function(n){const t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,c,p,v)=>{const x=p||v;return t[c]=!x||x.toLowerCase(),""}),t["max-age"]){const s=parseInt(t["max-age"],10);isNaN(s)?delete t["max-age"]:t["max-age"]=s}return t},m.ab=function(n,t){const s=[];for(const c in n)c in t||s.push(c);return s},m.ac=We,m.ad=function(n,t,s){var c=Math.sin(s),p=Math.cos(s),v=t[0],x=t[1],w=t[2],E=t[3],C=t[4],L=t[5],O=t[6],$=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=v*p+C*c,n[1]=x*p+L*c,n[2]=w*p+O*c,n[3]=E*p+$*c,n[4]=C*p-v*c,n[5]=L*p-x*c,n[6]=O*p-w*c,n[7]=$*p-E*c,n},m.ae=function(n){var t=new Rc(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},m.af=cd,m.ag=function(n,t){let s=0,c=0;if(n.kind==="constant")c=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:p,minZoom:v,maxZoom:x}=n,w=p?We(Jr.interpolationFactor(p,t,v,x),0,1):0;n.kind==="camera"?c=dn.number(n.minSize,n.maxSize,w):s=w}return{uSizeT:s,uSize:c}},m.ai=function(n,{uSize:t,uSizeT:s},{lowerSize:c,upperSize:p}){return n.kind==="source"?c/Xa:n.kind==="composite"?dn.number(c/Xa,p/Xa,s):t},m.aj=cp,m.ak=function(n,t,s,c){const p=t.y-n.y,v=t.x-n.x,x=c.y-s.y,w=c.x-s.x,E=x*v-w*p;if(E===0)return null;const C=(w*(n.y-s.y)-x*(n.x-s.x))/E;return new k(n.x+C*v,n.y+C*p)},m.al=_y,m.am=Du,m.an=Vf,m.ao=sn,m.aq=lp,m.ar=function(n,t){var s=t[0],c=t[1],p=t[2],v=t[3],x=t[4],w=t[5],E=t[6],C=t[7],L=t[8],O=t[9],$=t[10],j=t[11],G=t[12],X=t[13],ie=t[14],ue=t[15],Ee=s*w-c*x,fe=s*E-p*x,xe=s*C-v*x,$e=c*E-p*w,Ge=c*C-v*w,It=p*C-v*E,Ot=L*X-O*G,St=L*ie-$*G,xt=L*ue-j*G,ct=O*ie-$*X,kt=O*ue-j*X,_t=$*ue-j*ie,tt=Ee*_t-fe*kt+xe*ct+$e*xt-Ge*St+It*Ot;return tt?(n[0]=(w*_t-E*kt+C*ct)*(tt=1/tt),n[1]=(p*kt-c*_t-v*ct)*tt,n[2]=(X*It-ie*Ge+ue*$e)*tt,n[3]=($*Ge-O*It-j*$e)*tt,n[4]=(E*xt-x*_t-C*St)*tt,n[5]=(s*_t-p*xt+v*St)*tt,n[6]=(ie*xe-G*It-ue*fe)*tt,n[7]=(L*It-$*xe+j*fe)*tt,n[8]=(x*kt-w*xt+C*Ot)*tt,n[9]=(c*xt-s*kt-v*Ot)*tt,n[10]=(G*Ge-X*xe+ue*Ee)*tt,n[11]=(O*xe-L*Ge-j*Ee)*tt,n[12]=(w*St-x*ct-E*Ot)*tt,n[13]=(s*ct-c*St+p*Ot)*tt,n[14]=(X*fe-G*$e-ie*Ee)*tt,n[15]=(L*$e-O*fe+$*Ee)*tt,n):null},m.as=yp,m.at=op,m.au=_p,m.av=function(){const n={},t=le.$version;for(const s in le.$root){const c=le.$root[s];if(c.required){let p=null;p=s==="version"?t:c.type==="array"?[]:{},p!=null&&(n[s]=p)}}return n},m.aw=Ul,m.ax=ht,m.ay=function(n){n=n.slice();const t=Object.create(null);for(let s=0;s<n.length;s++)t[n[s].id]=n[s];for(let s=0;s<n.length;s++)"ref"in n[s]&&(n[s]=Ct(n[s],t[n[s].ref]));return n},m.az=function(n){if(n.type==="custom")return new Mb(n);switch(n.type){case"background":return new xb(n);case"circle":return new s1(n);case"fill":return new E1(n);case"fill-extrusion":return new $1(n);case"heatmap":return new o1(n);case"hillshade":return new c1(n);case"line":return new W1(n);case"raster":return new wb(n);case"symbol":return new vd(n)}},m.b=gi,m.b0=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]},m.b1=Qe,m.b2=hy,m.b3=cy,m.b4=function(n,t,s,c,p){var v,x=1/Math.tan(t/2);return n[0]=x/s,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=x,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,p!=null&&p!==1/0?(n[10]=(p+c)*(v=1/(c-p)),n[14]=2*p*c*v):(n[10]=-1,n[14]=-2*c),n},m.b5=function(n,t,s){var c=Math.sin(s),p=Math.cos(s),v=t[4],x=t[5],w=t[6],E=t[7],C=t[8],L=t[9],O=t[10],$=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=v*p+C*c,n[5]=x*p+L*c,n[6]=w*p+O*c,n[7]=E*p+$*c,n[8]=C*p-v*c,n[9]=L*p-x*c,n[10]=O*p-w*c,n[11]=$*p-E*c,n},m.b6=he,m.b7=Le,m.b8=function(n){return n*Math.PI/180},m.b9=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},m.bA=Ga,m.ba=class extends Sa{},m.bb=fp,m.bc=Rb,m.be=Et,m.bf=function(n,t){ji.REGISTERED_PROTOCOLS[n]=t},m.bg=function(n){delete ji.REGISTERED_PROTOCOLS[n]},m.bh=function(n,t){const s={};for(let p=0;p<n.length;p++){const v=t&&t[n[p].id]||Bl(n[p]);t&&(t[n[p].id]=v);let x=s[v];x||(x=s[v]=[]),x.push(n[p])}const c=[];for(const p in s)c.push(s[p]);return c},m.bi=Tt,m.bj=fy,m.bk=my,m.bl=Zg,m.bm=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=Nr/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const t=n.bucket.layers[0],s=t.layout,c=t._unevaluatedLayout._values,p={layoutIconSize:c["icon-size"].possiblyEvaluate(new vr(n.bucket.zoom+1),n.canonical),layoutTextSize:c["text-size"].possiblyEvaluate(new vr(n.bucket.zoom+1),n.canonical),textMaxSize:c["text-size"].possiblyEvaluate(new vr(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:C,maxZoom:L}=n.bucket.textSizeData;p.compositeTextSizes=[c["text-size"].possiblyEvaluate(new vr(C),n.canonical),c["text-size"].possiblyEvaluate(new vr(L),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:C,maxZoom:L}=n.bucket.iconSizeData;p.compositeIconSizes=[c["icon-size"].possiblyEvaluate(new vr(C),n.canonical),c["icon-size"].possiblyEvaluate(new vr(L),n.canonical)]}const v=s.get("text-line-height")*sn,x=s.get("text-rotation-alignment")!=="viewport"&&s.get("symbol-placement")!=="point",w=s.get("text-keep-upright"),E=s.get("text-size");for(const C of n.bucket.features){const L=s.get("text-font").evaluate(C,{},n.canonical).join(","),O=E.evaluate(C,{},n.canonical),$=p.layoutTextSize.evaluate(C,{},n.canonical),j=p.layoutIconSize.evaluate(C,{},n.canonical),G={horizontal:{},vertical:void 0},X=C.text;let ie,ue=[0,0];if(X){const xe=X.toString(),$e=s.get("text-letter-spacing").evaluate(C,{},n.canonical)*sn,Ge=yo(xe)?$e:0,It=s.get("text-anchor").evaluate(C,{},n.canonical),Ot=Iy(t,C,n.canonical);if(!Ot){const _t=s.get("text-radial-offset").evaluate(C,{},n.canonical);ue=_t?Ty(It,[_t*sn,gp]):s.get("text-offset").evaluate(C,{},n.canonical).map(tt=>tt*sn)}let St=x?"center":s.get("text-justify").evaluate(C,{},n.canonical);const xt=s.get("symbol-placement"),ct=xt==="point"?s.get("text-max-width").evaluate(C,{},n.canonical)*sn:0,kt=()=>{n.bucket.allowVerticalPlacement&&na(xe)&&(G.vertical=gd(X,n.glyphMap,n.glyphPositions,n.imagePositions,L,ct,v,It,"left",Ge,ue,m.ah.vertical,!0,xt,$,O))};if(!x&&Ot){const _t=new Set;if(St==="auto")for(let Xt=0;Xt<Ot.values.length;Xt+=2)_t.add(yp(Ot.values[Xt]));else _t.add(St);let tt=!1;for(const Xt of _t)if(!G.horizontal[Xt])if(tt)G.horizontal[Xt]=G.horizontal[0];else{const Nt=gd(X,n.glyphMap,n.glyphPositions,n.imagePositions,L,ct,v,"center",Xt,Ge,ue,m.ah.horizontal,!1,xt,$,O);Nt&&(G.horizontal[Xt]=Nt,tt=Nt.positionedLines.length===1)}kt()}else{St==="auto"&&(St=yp(It));const _t=gd(X,n.glyphMap,n.glyphPositions,n.imagePositions,L,ct,v,It,St,Ge,ue,m.ah.horizontal,!1,xt,$,O);_t&&(G.horizontal[St]=_t),kt(),na(xe)&&x&&w&&(G.vertical=gd(X,n.glyphMap,n.glyphPositions,n.imagePositions,L,ct,v,It,St,Ge,ue,m.ah.vertical,!1,xt,$,O))}}let Ee=!1;if(C.icon&&C.icon.name){const xe=n.imageMap[C.icon.name];xe&&(ie=mb(n.imagePositions[C.icon.name],s.get("icon-offset").evaluate(C,{},n.canonical),s.get("icon-anchor").evaluate(C,{},n.canonical)),Ee=!!xe.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=Ee:n.bucket.sdfIcons!==Ee&&pi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(xe.pixelRatio!==n.bucket.pixelRatio||s.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const fe=Ay(G.horizontal)||G.vertical;n.bucket.iconsInText=!!fe&&fe.iconsInText,(fe||ie)&&Db(n.bucket,C,G,ie,n.imageMap,p,$,j,ue,Ee,n.canonical)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},m.bn=tp,m.bo=Jf,m.bp=ep,m.bq=nl,m.br=rp,m.bs=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},m.bt=function(n,t,s,c,p){return l(this,void 0,void 0,function*(){if(Fe())try{return yield Ar(n,t,s,c,p)}catch{}return function(v,x,w,E,C){const L=v.width,O=v.height;ut&&rt||(ut=new OffscreenCanvas(L,O),rt=ut.getContext("2d",{willReadFrequently:!0})),ut.width=L,ut.height=O,rt.drawImage(v,0,0,L,O);const $=rt.getImageData(x,w,E,C);return rt.clearRect(0,0,L,O),$.data}(n,t,s,c,p)})},m.bu=dy,m.bv=T,m.bw=P,m.bx=Bg,m.by=_s,m.bz=function(n){return n.message===et},m.c=ir,m.d=n=>l(void 0,void 0,void 0,function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(t)}catch(s){throw new Error(`Could not load image because of ${s.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),m.e=bt,m.f=n=>new Promise((t,s)=>{const c=new Image;c.onload=()=>{t(c),URL.revokeObjectURL(c.src),c.onload=null,window.requestAnimationFrame(()=>{c.src=ur})},c.onerror=()=>s(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const p=new Blob([new Uint8Array(n)],{type:"image/png"});c.src=n.byteLength?URL.createObjectURL(p):ur}),m.g=wi,m.h=(n,t)=>Je(bt(n,{type:"json"}),t),m.i=si,m.j=Pe,m.k=ce,m.l=(n,t)=>Je(bt(n,{type:"arrayBuffer"}),t),m.m=Je,m.n=function(n){return new rp(n).readFields(cb,[])},m.o=Bu,m.p=Hg,m.q=Wn,m.r=il,m.s=Pi,m.t=en,m.u=vt,m.v=le,m.w=pi,m.x=Li,m.y=function([n,t,s]){return t+=90,t*=Math.PI/180,s*=Math.PI/180,{x:n*Math.cos(t)*Math.sin(s),y:n*Math.sin(t)*Math.sin(s),z:n*Math.cos(s)}},m.z=dn}),d("worker",["./shared"],function(m){class l{constructor(N){this.keyCache={},N&&this.replace(N)}replace(N){this._layerConfigs={},this._layers={},this.update(N,[])}update(N,U){for(const J of N){this._layerConfigs[J.id]=J;const _e=this._layers[J.id]=m.az(J);_e._featureFilter=m.a6(_e.filter),this.keyCache[J.id]&&delete this.keyCache[J.id]}for(const J of U)delete this.keyCache[J],delete this._layerConfigs[J],delete this._layers[J];this.familiesBySource={};const H=m.bh(Object.values(this._layerConfigs),this.keyCache);for(const J of H){const _e=J.map(Re=>this._layers[Re.id]),ve=_e[0];if(ve.visibility==="none")continue;const we=ve.source||"";let de=this.familiesBySource[we];de||(de=this.familiesBySource[we]={});const Ie=ve.sourceLayer||"_geojsonTileLayer";let qe=de[Ie];qe||(qe=de[Ie]=[]),qe.push(_e)}}}class T{constructor(N){const U={},H=[];for(const we in N){const de=N[we],Ie=U[we]={};for(const qe in de){const Re=de[+qe];if(!Re||Re.bitmap.width===0||Re.bitmap.height===0)continue;const Ne={x:0,y:0,w:Re.bitmap.width+2,h:Re.bitmap.height+2};H.push(Ne),Ie[qe]={rect:Ne,metrics:Re.metrics}}}const{w:J,h:_e}=m.p(H),ve=new m.o({width:J||1,height:_e||1});for(const we in N){const de=N[we];for(const Ie in de){const qe=de[+Ie];if(!qe||qe.bitmap.width===0||qe.bitmap.height===0)continue;const Re=U[we][Ie].rect;m.o.copy(qe.bitmap,ve,{x:0,y:0},{x:Re.x+1,y:Re.y+1},qe.bitmap)}}this.image=ve,this.positions=U}}m.bi("GlyphAtlas",T);class P{constructor(N){this.tileID=new m.Q(N.tileID.overscaledZ,N.tileID.wrap,N.tileID.canonical.z,N.tileID.canonical.x,N.tileID.canonical.y),this.uid=N.uid,this.zoom=N.zoom,this.pixelRatio=N.pixelRatio,this.tileSize=N.tileSize,this.source=N.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=N.showCollisionBoxes,this.collectResourceTiming=!!N.collectResourceTiming,this.returnDependencies=!!N.returnDependencies,this.promoteId=N.promoteId,this.inFlightDependencies=[]}parse(N,U,H,J){return m._(this,void 0,void 0,function*(){this.status="parsing",this.data=N,this.collisionBoxArray=new m.a4;const _e=new m.bj(Object.keys(N.layers).sort()),ve=new m.bk(this.tileID,this.promoteId);ve.bucketLayerIDs=[];const we={},de={featureIndex:ve,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:H},Ie=U.familiesBySource[this.source];for(const Zt in Ie){const yr=N.layers[Zt];if(!yr)continue;yr.version===1&&m.w(`Vector tile source "${this.source}" layer "${Zt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Vr=_e.encode(Zt),gn=[];for(let yn=0;yn<yr.length;yn++){const Zr=yr.feature(yn),jn=ve.getId(Zr,Zt);gn.push({feature:Zr,id:jn,index:yn,sourceLayerIndex:Vr})}for(const yn of Ie[Zt]){const Zr=yn[0];Zr.source!==this.source&&m.w(`layer.source = ${Zr.source} does not equal this.source = ${this.source}`),Zr.minzoom&&this.zoom<Math.floor(Zr.minzoom)||Zr.maxzoom&&this.zoom>=Zr.maxzoom||Zr.visibility!=="none"&&(z(yn,this.zoom,H),(we[Zr.id]=Zr.createBucket({index:ve.bucketLayerIDs.length,layers:yn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Vr,sourceID:this.source})).populate(gn,de,this.tileID.canonical),ve.bucketLayerIDs.push(yn.map(jn=>jn.id)))}}const qe=m.aE(de.glyphDependencies,Zt=>Object.keys(Zt).map(Number));this.inFlightDependencies.forEach(Zt=>Zt==null?void 0:Zt.abort()),this.inFlightDependencies=[];let Re=Promise.resolve({});if(Object.keys(qe).length){const Zt=new AbortController;this.inFlightDependencies.push(Zt),Re=J.sendAsync({type:"GG",data:{stacks:qe,source:this.source,tileID:this.tileID,type:"glyphs"}},Zt)}const Ne=Object.keys(de.iconDependencies);let Bt=Promise.resolve({});if(Ne.length){const Zt=new AbortController;this.inFlightDependencies.push(Zt),Bt=J.sendAsync({type:"GI",data:{icons:Ne,source:this.source,tileID:this.tileID,type:"icons"}},Zt)}const Vt=Object.keys(de.patternDependencies);let ti=Promise.resolve({});if(Vt.length){const Zt=new AbortController;this.inFlightDependencies.push(Zt),ti=J.sendAsync({type:"GI",data:{icons:Vt,source:this.source,tileID:this.tileID,type:"patterns"}},Zt)}const[ri,_i,Bi]=yield Promise.all([Re,Bt,ti]),sr=new T(ri),Fr=new m.bl(_i,Bi);for(const Zt in we){const yr=we[Zt];yr instanceof m.a5?(z(yr.layers,this.zoom,H),m.bm({bucket:yr,glyphMap:ri,glyphPositions:sr.positions,imageMap:_i,imagePositions:Fr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):yr.hasPattern&&(yr instanceof m.bn||yr instanceof m.bo||yr instanceof m.bp)&&(z(yr.layers,this.zoom,H),yr.addFeatures(de,this.tileID.canonical,Fr.patternPositions))}return this.status="done",{buckets:Object.values(we).filter(Zt=>!Zt.isEmpty()),featureIndex:ve,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:sr.image,imageAtlas:Fr,glyphMap:this.returnDependencies?ri:null,iconMap:this.returnDependencies?_i:null,glyphPositions:this.returnDependencies?sr.positions:null}})}}function z(ee,N,U){const H=new m.a8(N);for(const J of ee)J.recalculate(H,U)}class k{constructor(N,U,H){this.actor=N,this.layerIndex=U,this.availableImages=H,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(N,U){return m._(this,void 0,void 0,function*(){const H=yield m.l(N.request,U);try{return{vectorTile:new m.bq.VectorTile(new m.br(H.data)),rawData:H.data,cacheControl:H.cacheControl,expires:H.expires}}catch(J){const _e=new Uint8Array(H.data);let ve=`Unable to parse the tile at ${N.request.url}, `;throw ve+=_e[0]===31&&_e[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${J.messge}`,new Error(ve)}})}loadTile(N){return m._(this,void 0,void 0,function*(){const U=N.uid,H=!!(N&&N.request&&N.request.collectResourceTiming)&&new m.bs(N.request),J=new P(N);this.loading[U]=J;const _e=new AbortController;J.abort=_e;try{const ve=yield this.loadVectorTile(N,_e);if(delete this.loading[U],!ve)return null;const we=ve.rawData,de={};ve.expires&&(de.expires=ve.expires),ve.cacheControl&&(de.cacheControl=ve.cacheControl);const Ie={};if(H){const Re=H.finish();Re&&(Ie.resourceTiming=JSON.parse(JSON.stringify(Re)))}J.vectorTile=ve.vectorTile;const qe=J.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[U]=J,this.fetching[U]={rawTileData:we,cacheControl:de,resourceTiming:Ie};try{const Re=yield qe;return m.e({rawTileData:we.slice(0)},Re,de,Ie)}finally{delete this.fetching[U]}}catch(ve){throw delete this.loading[U],J.status="done",this.loaded[U]=J,ve}})}reloadTile(N){return m._(this,void 0,void 0,function*(){const U=N.uid;if(!this.loaded||!this.loaded[U])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const H=this.loaded[U];if(H.showCollisionBoxes=N.showCollisionBoxes,H.status==="parsing"){const J=yield H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor);let _e;if(this.fetching[U]){const{rawTileData:ve,cacheControl:we,resourceTiming:de}=this.fetching[U];delete this.fetching[U],_e=m.e({rawTileData:ve.slice(0)},J,we,de)}else _e=J;return _e}if(H.status==="done"&&H.vectorTile)return H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(N){return m._(this,void 0,void 0,function*(){const U=this.loading,H=N.uid;U&&U[H]&&U[H].abort&&(U[H].abort.abort(),delete U[H])})}removeTile(N){return m._(this,void 0,void 0,function*(){this.loaded&&this.loaded[N.uid]&&delete this.loaded[N.uid]})}}class R{constructor(){this.loaded={}}loadTile(N){return m._(this,void 0,void 0,function*(){const{uid:U,encoding:H,rawImageData:J,redFactor:_e,greenFactor:ve,blueFactor:we,baseShift:de}=N,Ie=J.width+2,qe=J.height+2,Re=m.b(J)?new m.R({width:Ie,height:qe},yield m.bt(J,-1,-1,Ie,qe)):J,Ne=new m.bu(U,Re,H,_e,ve,we,de);return this.loaded=this.loaded||{},this.loaded[U]=Ne,Ne})}removeTile(N){const U=this.loaded,H=N.uid;U&&U[H]&&delete U[H]}}function Z(ee,N){if(ee.length!==0){K(ee[0],N);for(var U=1;U<ee.length;U++)K(ee[U],!N)}}function K(ee,N){for(var U=0,H=0,J=0,_e=ee.length,ve=_e-1;J<_e;ve=J++){var we=(ee[J][0]-ee[ve][0])*(ee[ve][1]+ee[J][1]),de=U+we;H+=Math.abs(U)>=Math.abs(we)?U-de+we:we-de+U,U=de}U+H>=0!=!!N&&ee.reverse()}var Y=m.bv(function ee(N,U){var H,J=N&&N.type;if(J==="FeatureCollection")for(H=0;H<N.features.length;H++)ee(N.features[H],U);else if(J==="GeometryCollection")for(H=0;H<N.geometries.length;H++)ee(N.geometries[H],U);else if(J==="Feature")ee(N.geometry,U);else if(J==="Polygon")Z(N.coordinates,U);else if(J==="MultiPolygon")for(H=0;H<N.coordinates.length;H++)Z(N.coordinates[H],U);return N});const ge=m.bq.VectorTileFeature.prototype.toGeoJSON;var Te={exports:{}},Fe=m.bw,he=m.bq.VectorTileFeature,Le=We;function We(ee,N){this.options=N||{},this.features=ee,this.length=ee.length}function Qe(ee,N){this.id=typeof ee.id=="number"?ee.id:void 0,this.type=ee.type,this.rawGeometry=ee.type===1?[ee.geometry]:ee.geometry,this.properties=ee.tags,this.extent=N||4096}We.prototype.feature=function(ee){return new Qe(this.features[ee],this.options.extent)},Qe.prototype.loadGeometry=function(){var ee=this.rawGeometry;this.geometry=[];for(var N=0;N<ee.length;N++){for(var U=ee[N],H=[],J=0;J<U.length;J++)H.push(new Fe(U[J][0],U[J][1]));this.geometry.push(H)}return this.geometry},Qe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ee=this.geometry,N=1/0,U=-1/0,H=1/0,J=-1/0,_e=0;_e<ee.length;_e++)for(var ve=ee[_e],we=0;we<ve.length;we++){var de=ve[we];N=Math.min(N,de.x),U=Math.max(U,de.x),H=Math.min(H,de.y),J=Math.max(J,de.y)}return[N,H,U,J]},Qe.prototype.toGeoJSON=he.prototype.toGeoJSON;var bt=m.bx,He=Le;function lt(ee){var N=new bt;return function(U,H){for(var J in U.layers)H.writeMessage(3,Rt,U.layers[J])}(ee,N),N.finish()}function Rt(ee,N){var U;N.writeVarintField(15,ee.version||1),N.writeStringField(1,ee.name||""),N.writeVarintField(5,ee.extent||4096);var H={keys:[],values:[],keycache:{},valuecache:{}};for(U=0;U<ee.length;U++)H.feature=ee.feature(U),N.writeMessage(2,Pt,H);var J=H.keys;for(U=0;U<J.length;U++)N.writeStringField(3,J[U]);var _e=H.values;for(U=0;U<_e.length;U++)N.writeMessage(4,si,_e[U])}function Pt(ee,N){var U=ee.feature;U.id!==void 0&&N.writeVarintField(1,U.id),N.writeMessage(2,oi,ee),N.writeVarintField(3,U.type),N.writeMessage(4,cr,U)}function oi(ee,N){var U=ee.feature,H=ee.keys,J=ee.values,_e=ee.keycache,ve=ee.valuecache;for(var we in U.properties){var de=U.properties[we],Ie=_e[we];if(de!==null){Ie===void 0&&(H.push(we),_e[we]=Ie=H.length-1),N.writeVarint(Ie);var qe=typeof de;qe!=="string"&&qe!=="boolean"&&qe!=="number"&&(de=JSON.stringify(de));var Re=qe+":"+de,Ne=ve[Re];Ne===void 0&&(J.push(de),ve[Re]=Ne=J.length-1),N.writeVarint(Ne)}}}function pi(ee,N){return(N<<3)+(7&ee)}function Yt(ee){return ee<<1^ee>>31}function cr(ee,N){for(var U=ee.loadGeometry(),H=ee.type,J=0,_e=0,ve=U.length,we=0;we<ve;we++){var de=U[we],Ie=1;H===1&&(Ie=de.length),N.writeVarint(pi(1,Ie));for(var qe=H===3?de.length-1:de.length,Re=0;Re<qe;Re++){Re===1&&H!==1&&N.writeVarint(pi(2,qe-1));var Ne=de[Re].x-J,Bt=de[Re].y-_e;N.writeVarint(Yt(Ne)),N.writeVarint(Yt(Bt)),J+=Ne,_e+=Bt}H===3&&N.writeVarint(pi(7,1))}}function si(ee,N){var U=typeof ee;U==="string"?N.writeStringField(1,ee):U==="boolean"?N.writeBooleanField(7,ee):U==="number"&&(ee%1!=0?N.writeDoubleField(3,ee):ee<0?N.writeSVarintField(6,ee):N.writeVarintField(5,ee))}Te.exports=lt,Te.exports.fromVectorTileJs=lt,Te.exports.fromGeojsonVt=function(ee,N){N=N||{};var U={};for(var H in ee)U[H]=new He(ee[H].features,N),U[H].name=H,U[H].version=N.version,U[H].extent=N.extent;return lt({layers:U})},Te.exports.GeoJSONWrapper=He;var Qt=m.bv(Te.exports);const gi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ee=>ee},ur=Math.fround||(Ar=new Float32Array(1),ee=>(Ar[0]=+ee,Ar[0]));var Ar;const ut=3,rt=5,et=6;class ir{constructor(N){this.options=Object.assign(Object.create(gi),N),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(N){const{log:U,minZoom:H,maxZoom:J}=this.options;U&&console.time("total time");const _e=`prepare ${N.length} points`;U&&console.time(_e),this.points=N;const ve=[];for(let de=0;de<N.length;de++){const Ie=N[de];if(!Ie.geometry)continue;const[qe,Re]=Ie.geometry.coordinates,Ne=ur(Ve(qe)),Bt=ur(Et(Re));ve.push(Ne,Bt,1/0,de,-1,1),this.options.reduce&&ve.push(0)}let we=this.trees[J+1]=this._createTree(ve);U&&console.timeEnd(_e);for(let de=J;de>=H;de--){const Ie=+Date.now();we=this.trees[de]=this._createTree(this._cluster(we,de)),U&&console.log("z%d: %d clusters in %dms",de,we.numItems,+Date.now()-Ie)}return U&&console.timeEnd("total time"),this}getClusters(N,U){let H=((N[0]+180)%360+360)%360-180;const J=Math.max(-90,Math.min(90,N[1]));let _e=N[2]===180?180:((N[2]+180)%360+360)%360-180;const ve=Math.max(-90,Math.min(90,N[3]));if(N[2]-N[0]>=360)H=-180,_e=180;else if(H>_e){const Re=this.getClusters([H,J,180,ve],U),Ne=this.getClusters([-180,J,_e,ve],U);return Re.concat(Ne)}const we=this.trees[this._limitZoom(U)],de=we.range(Ve(H),Et(ve),Ve(_e),Et(J)),Ie=we.data,qe=[];for(const Re of de){const Ne=this.stride*Re;qe.push(Ie[Ne+rt]>1?ji(Ie,Ne,this.clusterProps):this.points[Ie[Ne+ut]])}return qe}getChildren(N){const U=this._getOriginId(N),H=this._getOriginZoom(N),J="No cluster with the specified id.",_e=this.trees[H];if(!_e)throw new Error(J);const ve=_e.data;if(U*this.stride>=ve.length)throw new Error(J);const we=this.options.radius/(this.options.extent*Math.pow(2,H-1)),de=_e.within(ve[U*this.stride],ve[U*this.stride+1],we),Ie=[];for(const qe of de){const Re=qe*this.stride;ve[Re+4]===N&&Ie.push(ve[Re+rt]>1?ji(ve,Re,this.clusterProps):this.points[ve[Re+ut]])}if(Ie.length===0)throw new Error(J);return Ie}getLeaves(N,U,H){const J=[];return this._appendLeaves(J,N,U=U||10,H=H||0,0),J}getTile(N,U,H){const J=this.trees[this._limitZoom(N)],_e=Math.pow(2,N),{extent:ve,radius:we}=this.options,de=we/ve,Ie=(H-de)/_e,qe=(H+1+de)/_e,Re={features:[]};return this._addTileFeatures(J.range((U-de)/_e,Ie,(U+1+de)/_e,qe),J.data,U,H,_e,Re),U===0&&this._addTileFeatures(J.range(1-de/_e,Ie,1,qe),J.data,_e,H,_e,Re),U===_e-1&&this._addTileFeatures(J.range(0,Ie,de/_e,qe),J.data,-1,H,_e,Re),Re.features.length?Re:null}getClusterExpansionZoom(N){let U=this._getOriginZoom(N)-1;for(;U<=this.options.maxZoom;){const H=this.getChildren(N);if(U++,H.length!==1)break;N=H[0].properties.cluster_id}return U}_appendLeaves(N,U,H,J,_e){const ve=this.getChildren(U);for(const we of ve){const de=we.properties;if(de&&de.cluster?_e+de.point_count<=J?_e+=de.point_count:_e=this._appendLeaves(N,de.cluster_id,H,J,_e):_e<J?_e++:N.push(we),N.length===H)break}return _e}_createTree(N){const U=new m.au(N.length/this.stride|0,this.options.nodeSize,Float32Array);for(let H=0;H<N.length;H+=this.stride)U.add(N[H],N[H+1]);return U.finish(),U.data=N,U}_addTileFeatures(N,U,H,J,_e,ve){for(const we of N){const de=we*this.stride,Ie=U[de+rt]>1;let qe,Re,Ne;if(Ie)qe=wi(U,de,this.clusterProps),Re=U[de],Ne=U[de+1];else{const ti=this.points[U[de+ut]];qe=ti.properties;const[ri,_i]=ti.geometry.coordinates;Re=Ve(ri),Ne=Et(_i)}const Bt={type:1,geometry:[[Math.round(this.options.extent*(Re*_e-H)),Math.round(this.options.extent*(Ne*_e-J))]],tags:qe};let Vt;Vt=Ie||this.options.generateId?U[de+ut]:this.points[U[de+ut]].id,Vt!==void 0&&(Bt.id=Vt),ve.features.push(Bt)}}_limitZoom(N){return Math.max(this.options.minZoom,Math.min(Math.floor(+N),this.options.maxZoom+1))}_cluster(N,U){const{radius:H,extent:J,reduce:_e,minPoints:ve}=this.options,we=H/(J*Math.pow(2,U)),de=N.data,Ie=[],qe=this.stride;for(let Re=0;Re<de.length;Re+=qe){if(de[Re+2]<=U)continue;de[Re+2]=U;const Ne=de[Re],Bt=de[Re+1],Vt=N.within(de[Re],de[Re+1],we),ti=de[Re+rt];let ri=ti;for(const _i of Vt){const Bi=_i*qe;de[Bi+2]>U&&(ri+=de[Bi+rt])}if(ri>ti&&ri>=ve){let _i,Bi=Ne*ti,sr=Bt*ti,Fr=-1;const Zt=((Re/qe|0)<<5)+(U+1)+this.points.length;for(const yr of Vt){const Vr=yr*qe;if(de[Vr+2]<=U)continue;de[Vr+2]=U;const gn=de[Vr+rt];Bi+=de[Vr]*gn,sr+=de[Vr+1]*gn,de[Vr+4]=Zt,_e&&(_i||(_i=this._map(de,Re,!0),Fr=this.clusterProps.length,this.clusterProps.push(_i)),_e(_i,this._map(de,Vr)))}de[Re+4]=Zt,Ie.push(Bi/ri,sr/ri,1/0,Zt,-1,ri),_e&&Ie.push(Fr)}else{for(let _i=0;_i<qe;_i++)Ie.push(de[Re+_i]);if(ri>1)for(const _i of Vt){const Bi=_i*qe;if(!(de[Bi+2]<=U)){de[Bi+2]=U;for(let sr=0;sr<qe;sr++)Ie.push(de[Bi+sr])}}}}return Ie}_getOriginId(N){return N-this.points.length>>5}_getOriginZoom(N){return(N-this.points.length)%32}_map(N,U,H){if(N[U+rt]>1){const ve=this.clusterProps[N[U+et]];return H?Object.assign({},ve):ve}const J=this.points[N[U+ut]].properties,_e=this.options.map(J);return H&&_e===J?Object.assign({},_e):_e}}function ji(ee,N,U){return{type:"Feature",id:ee[N+ut],properties:wi(ee,N,U),geometry:{type:"Point",coordinates:[(H=ee[N],360*(H-.5)),ht(ee[N+1])]}};var H}function wi(ee,N,U){const H=ee[N+rt],J=H>=1e4?`${Math.round(H/1e3)}k`:H>=1e3?Math.round(H/100)/10+"k":H,_e=ee[N+et],ve=_e===-1?{}:Object.assign({},U[_e]);return Object.assign(ve,{cluster:!0,cluster_id:ee[N+ut],point_count:H,point_count_abbreviated:J})}function Ve(ee){return ee/360+.5}function Et(ee){const N=Math.sin(ee*Math.PI/180),U=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return U<0?0:U>1?1:U}function ht(ee){const N=(180-360*ee)*Math.PI/180;return 360*Math.atan(Math.exp(N))/Math.PI-90}function Je(ee,N,U,H){for(var J,_e=H,ve=U-N>>1,we=U-N,de=ee[N],Ie=ee[N+1],qe=ee[U],Re=ee[U+1],Ne=N+3;Ne<U;Ne+=3){var Bt=Pi(ee[Ne],ee[Ne+1],de,Ie,qe,Re);if(Bt>_e)J=Ne,_e=Bt;else if(Bt===_e){var Vt=Math.abs(Ne-ve);Vt<we&&(J=Ne,we=Vt)}}_e>H&&(J-N>3&&Je(ee,N,J,H),ee[J+2]=_e,U-J>3&&Je(ee,J,U,H))}function Pi(ee,N,U,H,J,_e){var ve=J-U,we=_e-H;if(ve!==0||we!==0){var de=((ee-U)*ve+(N-H)*we)/(ve*ve+we*we);de>1?(U=J,H=_e):de>0&&(U+=ve*de,H+=we*de)}return(ve=ee-U)*ve+(we=N-H)*we}function Ri(ee,N,U,H){var J={id:ee===void 0?null:ee,type:N,geometry:U,tags:H,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(_e){var ve=_e.geometry,we=_e.type;if(we==="Point"||we==="MultiPoint"||we==="LineString")se(_e,ve);else if(we==="Polygon"||we==="MultiLineString")for(var de=0;de<ve.length;de++)se(_e,ve[de]);else if(we==="MultiPolygon")for(de=0;de<ve.length;de++)for(var Ie=0;Ie<ve[de].length;Ie++)se(_e,ve[de][Ie])}(J),J}function se(ee,N){for(var U=0;U<N.length;U+=3)ee.minX=Math.min(ee.minX,N[U]),ee.minY=Math.min(ee.minY,N[U+1]),ee.maxX=Math.max(ee.maxX,N[U]),ee.maxY=Math.max(ee.maxY,N[U+1])}function ce(ee,N,U,H){if(N.geometry){var J=N.geometry.coordinates,_e=N.geometry.type,ve=Math.pow(U.tolerance/((1<<U.maxZoom)*U.extent),2),we=[],de=N.id;if(U.promoteId?de=N.properties[U.promoteId]:U.generateId&&(de=H||0),_e==="Point")Pe(J,we);else if(_e==="MultiPoint")for(var Ie=0;Ie<J.length;Ie++)Pe(J[Ie],we);else if(_e==="LineString")Oe(J,we,ve,!1);else if(_e==="MultiLineString"){if(U.lineMetrics){for(Ie=0;Ie<J.length;Ie++)Oe(J[Ie],we=[],ve,!1),ee.push(Ri(de,"LineString",we,N.properties));return}le(J,we,ve,!1)}else if(_e==="Polygon")le(J,we,ve,!0);else{if(_e!=="MultiPolygon"){if(_e==="GeometryCollection"){for(Ie=0;Ie<N.geometry.geometries.length;Ie++)ce(ee,{id:de,geometry:N.geometry.geometries[Ie],properties:N.properties},U,H);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ie=0;Ie<J.length;Ie++){var qe=[];le(J[Ie],qe,ve,!0),we.push(qe)}}ee.push(Ri(de,_e,we,N.properties))}}function Pe(ee,N){N.push(ft(ee[0])),N.push(Ct(ee[1])),N.push(0)}function Oe(ee,N,U,H){for(var J,_e,ve=0,we=0;we<ee.length;we++){var de=ft(ee[we][0]),Ie=Ct(ee[we][1]);N.push(de),N.push(Ie),N.push(0),we>0&&(ve+=H?(J*Ie-de*_e)/2:Math.sqrt(Math.pow(de-J,2)+Math.pow(Ie-_e,2))),J=de,_e=Ie}var qe=N.length-3;N[2]=1,Je(N,0,qe,U),N[qe+2]=1,N.size=Math.abs(ve),N.start=0,N.end=N.size}function le(ee,N,U,H){for(var J=0;J<ee.length;J++){var _e=[];Oe(ee[J],_e,U,H),N.push(_e)}}function ft(ee){return ee/360+.5}function Ct(ee){var N=Math.sin(ee*Math.PI/180),U=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return U<0?0:U>1?1:U}function Be(ee,N,U,H,J,_e,ve,we){if(H/=N,_e>=(U/=N)&&ve<H)return ee;if(ve<U||_e>=H)return null;for(var de=[],Ie=0;Ie<ee.length;Ie++){var qe=ee[Ie],Re=qe.geometry,Ne=qe.type,Bt=J===0?qe.minX:qe.minY,Vt=J===0?qe.maxX:qe.maxY;if(Bt>=U&&Vt<H)de.push(qe);else if(!(Vt<U||Bt>=H)){var ti=[];if(Ne==="Point"||Ne==="MultiPoint")nt(Re,ti,U,H,J);else if(Ne==="LineString")it(Re,ti,U,H,J,!1,we.lineMetrics);else if(Ne==="MultiLineString")Gt(Re,ti,U,H,J,!1);else if(Ne==="Polygon")Gt(Re,ti,U,H,J,!0);else if(Ne==="MultiPolygon")for(var ri=0;ri<Re.length;ri++){var _i=[];Gt(Re[ri],_i,U,H,J,!0),_i.length&&ti.push(_i)}if(ti.length){if(we.lineMetrics&&Ne==="LineString"){for(ri=0;ri<ti.length;ri++)de.push(Ri(qe.id,Ne,ti[ri],qe.tags));continue}Ne!=="LineString"&&Ne!=="MultiLineString"||(ti.length===1?(Ne="LineString",ti=ti[0]):Ne="MultiLineString"),Ne!=="Point"&&Ne!=="MultiPoint"||(Ne=ti.length===3?"Point":"MultiPoint"),de.push(Ri(qe.id,Ne,ti,qe.tags))}}}return de.length?de:null}function nt(ee,N,U,H,J){for(var _e=0;_e<ee.length;_e+=3){var ve=ee[_e+J];ve>=U&&ve<=H&&(N.push(ee[_e]),N.push(ee[_e+1]),N.push(ee[_e+2]))}}function it(ee,N,U,H,J,_e,ve){for(var we,de,Ie=At(ee),qe=J===0?Wt:mi,Re=ee.start,Ne=0;Ne<ee.length-3;Ne+=3){var Bt=ee[Ne],Vt=ee[Ne+1],ti=ee[Ne+2],ri=ee[Ne+3],_i=ee[Ne+4],Bi=J===0?Bt:Vt,sr=J===0?ri:_i,Fr=!1;ve&&(we=Math.sqrt(Math.pow(Bt-ri,2)+Math.pow(Vt-_i,2))),Bi<U?sr>U&&(de=qe(Ie,Bt,Vt,ri,_i,U),ve&&(Ie.start=Re+we*de)):Bi>H?sr<H&&(de=qe(Ie,Bt,Vt,ri,_i,H),ve&&(Ie.start=Re+we*de)):jt(Ie,Bt,Vt,ti),sr<U&&Bi>=U&&(de=qe(Ie,Bt,Vt,ri,_i,U),Fr=!0),sr>H&&Bi<=H&&(de=qe(Ie,Bt,Vt,ri,_i,H),Fr=!0),!_e&&Fr&&(ve&&(Ie.end=Re+we*de),N.push(Ie),Ie=At(ee)),ve&&(Re+=we)}var Zt=ee.length-3;Bt=ee[Zt],Vt=ee[Zt+1],ti=ee[Zt+2],(Bi=J===0?Bt:Vt)>=U&&Bi<=H&&jt(Ie,Bt,Vt,ti),Zt=Ie.length-3,_e&&Zt>=3&&(Ie[Zt]!==Ie[0]||Ie[Zt+1]!==Ie[1])&&jt(Ie,Ie[0],Ie[1],Ie[2]),Ie.length&&N.push(Ie)}function At(ee){var N=[];return N.size=ee.size,N.start=ee.start,N.end=ee.end,N}function Gt(ee,N,U,H,J,_e){for(var ve=0;ve<ee.length;ve++)it(ee[ve],N,U,H,J,_e,!1)}function jt(ee,N,U,H){ee.push(N),ee.push(U),ee.push(H)}function Wt(ee,N,U,H,J,_e){var ve=(_e-N)/(H-N);return ee.push(_e),ee.push(U+(J-U)*ve),ee.push(1),ve}function mi(ee,N,U,H,J,_e){var ve=(_e-U)/(J-U);return ee.push(N+(H-N)*ve),ee.push(_e),ee.push(1),ve}function Si(ee,N){for(var U=[],H=0;H<ee.length;H++){var J,_e=ee[H],ve=_e.type;if(ve==="Point"||ve==="MultiPoint"||ve==="LineString")J=Ue(_e.geometry,N);else if(ve==="MultiLineString"||ve==="Polygon"){J=[];for(var we=0;we<_e.geometry.length;we++)J.push(Ue(_e.geometry[we],N))}else if(ve==="MultiPolygon")for(J=[],we=0;we<_e.geometry.length;we++){for(var de=[],Ie=0;Ie<_e.geometry[we].length;Ie++)de.push(Ue(_e.geometry[we][Ie],N));J.push(de)}U.push(Ri(_e.id,ve,J,_e.tags))}return U}function Ue(ee,N){var U=[];U.size=ee.size,ee.start!==void 0&&(U.start=ee.start,U.end=ee.end);for(var H=0;H<ee.length;H+=3)U.push(ee[H]+N,ee[H+1],ee[H+2]);return U}function Oi(ee,N){if(ee.transformed)return ee;var U,H,J,_e=1<<ee.z,ve=ee.x,we=ee.y;for(U=0;U<ee.features.length;U++){var de=ee.features[U],Ie=de.geometry,qe=de.type;if(de.geometry=[],qe===1)for(H=0;H<Ie.length;H+=2)de.geometry.push(Zi(Ie[H],Ie[H+1],N,_e,ve,we));else for(H=0;H<Ie.length;H++){var Re=[];for(J=0;J<Ie[H].length;J+=2)Re.push(Zi(Ie[H][J],Ie[H][J+1],N,_e,ve,we));de.geometry.push(Re)}}return ee.transformed=!0,ee}function Zi(ee,N,U,H,J,_e){return[Math.round(U*(ee*H-J)),Math.round(U*(N*H-_e))]}function pn(ee,N,U,H,J){for(var _e=N===J.maxZoom?0:J.tolerance/((1<<N)*J.extent),ve={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:U,y:H,z:N,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},we=0;we<ee.length;we++){ve.numFeatures++,wr(ve,ee[we],_e,J);var de=ee[we].minX,Ie=ee[we].minY,qe=ee[we].maxX,Re=ee[we].maxY;de<ve.minX&&(ve.minX=de),Ie<ve.minY&&(ve.minY=Ie),qe>ve.maxX&&(ve.maxX=qe),Re>ve.maxY&&(ve.maxY=Re)}return ve}function wr(ee,N,U,H){var J=N.geometry,_e=N.type,ve=[];if(_e==="Point"||_e==="MultiPoint")for(var we=0;we<J.length;we+=3)ve.push(J[we]),ve.push(J[we+1]),ee.numPoints++,ee.numSimplified++;else if(_e==="LineString")st(ve,J,ee,U,!1,!1);else if(_e==="MultiLineString"||_e==="Polygon")for(we=0;we<J.length;we++)st(ve,J[we],ee,U,_e==="Polygon",we===0);else if(_e==="MultiPolygon")for(var de=0;de<J.length;de++){var Ie=J[de];for(we=0;we<Ie.length;we++)st(ve,Ie[we],ee,U,!0,we===0)}if(ve.length){var qe=N.tags||null;if(_e==="LineString"&&H.lineMetrics){for(var Re in qe={},N.tags)qe[Re]=N.tags[Re];qe.mapbox_clip_start=J.start/J.size,qe.mapbox_clip_end=J.end/J.size}var Ne={geometry:ve,type:_e==="Polygon"||_e==="MultiPolygon"?3:_e==="LineString"||_e==="MultiLineString"?2:1,tags:qe};N.id!==null&&(Ne.id=N.id),ee.features.push(Ne)}}function st(ee,N,U,H,J,_e){var ve=H*H;if(H>0&&N.size<(J?ve:H))U.numPoints+=N.length/3;else{for(var we=[],de=0;de<N.length;de+=3)(H===0||N[de+2]>ve)&&(U.numSimplified++,we.push(N[de]),we.push(N[de+1])),U.numPoints++;J&&function(Ie,qe){for(var Re=0,Ne=0,Bt=Ie.length,Vt=Bt-2;Ne<Bt;Vt=Ne,Ne+=2)Re+=(Ie[Ne]-Ie[Vt])*(Ie[Ne+1]+Ie[Vt+1]);if(Re>0===qe)for(Ne=0,Bt=Ie.length;Ne<Bt/2;Ne+=2){var ti=Ie[Ne],ri=Ie[Ne+1];Ie[Ne]=Ie[Bt-2-Ne],Ie[Ne+1]=Ie[Bt-1-Ne],Ie[Bt-2-Ne]=ti,Ie[Bt-1-Ne]=ri}}(we,_e),ee.push(we)}}function li(ee,N){var U=(N=this.options=function(J,_e){for(var ve in _e)J[ve]=_e[ve];return J}(Object.create(this.options),N)).debug;if(U&&console.time("preprocess data"),N.maxZoom<0||N.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(N.promoteId&&N.generateId)throw new Error("promoteId and generateId cannot be used together.");var H=function(J,_e){var ve=[];if(J.type==="FeatureCollection")for(var we=0;we<J.features.length;we++)ce(ve,J.features[we],_e,we);else ce(ve,J.type==="Feature"?J:{geometry:J},_e);return ve}(ee,N);this.tiles={},this.tileCoords=[],U&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",N.indexMaxZoom,N.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),H=function(J,_e){var ve=_e.buffer/_e.extent,we=J,de=Be(J,1,-1-ve,ve,0,-1,2,_e),Ie=Be(J,1,1-ve,2+ve,0,-1,2,_e);return(de||Ie)&&(we=Be(J,1,-ve,1+ve,0,-1,2,_e)||[],de&&(we=Si(de,1).concat(we)),Ie&&(we=we.concat(Si(Ie,-1)))),we}(H,N),H.length&&this.splitTile(H,0,0,0),U&&(H.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ft(ee,N,U){return 32*((1<<ee)*U+N)+ee}function $i(ee,N){return N?ee.properties[N]:ee.id}function mn(ee,N){if(ee==null)return!0;if(ee.type==="Feature")return $i(ee,N)!=null;if(ee.type==="FeatureCollection"){const U=new Set;for(const H of ee.features){const J=$i(H,N);if(J==null||U.has(J))return!1;U.add(J)}return!0}return!1}function ei(ee,N){const U=new Map;if(ee!=null)if(ee.type==="Feature")U.set($i(ee,N),ee);else for(const H of ee.features)U.set($i(H,N),H);return U}li.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},li.prototype.splitTile=function(ee,N,U,H,J,_e,ve){for(var we=[ee,N,U,H],de=this.options,Ie=de.debug;we.length;){H=we.pop(),U=we.pop(),N=we.pop(),ee=we.pop();var qe=1<<N,Re=Ft(N,U,H),Ne=this.tiles[Re];if(!Ne&&(Ie>1&&console.time("creation"),Ne=this.tiles[Re]=pn(ee,N,U,H,de),this.tileCoords.push({z:N,x:U,y:H}),Ie)){Ie>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",N,U,H,Ne.numFeatures,Ne.numPoints,Ne.numSimplified),console.timeEnd("creation"));var Bt="z"+N;this.stats[Bt]=(this.stats[Bt]||0)+1,this.total++}if(Ne.source=ee,J){if(N===de.maxZoom||N===J)continue;var Vt=1<<J-N;if(U!==Math.floor(_e/Vt)||H!==Math.floor(ve/Vt))continue}else if(N===de.indexMaxZoom||Ne.numPoints<=de.indexMaxPoints)continue;if(Ne.source=null,ee.length!==0){Ie>1&&console.time("clipping");var ti,ri,_i,Bi,sr,Fr,Zt=.5*de.buffer/de.extent,yr=.5-Zt,Vr=.5+Zt,gn=1+Zt;ti=ri=_i=Bi=null,sr=Be(ee,qe,U-Zt,U+Vr,0,Ne.minX,Ne.maxX,de),Fr=Be(ee,qe,U+yr,U+gn,0,Ne.minX,Ne.maxX,de),ee=null,sr&&(ti=Be(sr,qe,H-Zt,H+Vr,1,Ne.minY,Ne.maxY,de),ri=Be(sr,qe,H+yr,H+gn,1,Ne.minY,Ne.maxY,de),sr=null),Fr&&(_i=Be(Fr,qe,H-Zt,H+Vr,1,Ne.minY,Ne.maxY,de),Bi=Be(Fr,qe,H+yr,H+gn,1,Ne.minY,Ne.maxY,de),Fr=null),Ie>1&&console.timeEnd("clipping"),we.push(ti||[],N+1,2*U,2*H),we.push(ri||[],N+1,2*U,2*H+1),we.push(_i||[],N+1,2*U+1,2*H),we.push(Bi||[],N+1,2*U+1,2*H+1)}}},li.prototype.getTile=function(ee,N,U){var H=this.options,J=H.extent,_e=H.debug;if(ee<0||ee>24)return null;var ve=1<<ee,we=Ft(ee,N=(N%ve+ve)%ve,U);if(this.tiles[we])return Oi(this.tiles[we],J);_e>1&&console.log("drilling down to z%d-%d-%d",ee,N,U);for(var de,Ie=ee,qe=N,Re=U;!de&&Ie>0;)Ie--,qe=Math.floor(qe/2),Re=Math.floor(Re/2),de=this.tiles[Ft(Ie,qe,Re)];return de&&de.source?(_e>1&&console.log("found parent tile z%d-%d-%d",Ie,qe,Re),_e>1&&console.time("drilling down"),this.splitTile(de.source,Ie,qe,Re,ee,N,U),_e>1&&console.timeEnd("drilling down"),this.tiles[we]?Oi(this.tiles[we],J):null):null};class Js extends k{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(N,U){return m._(this,void 0,void 0,function*(){const H=N.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const J=this._geoJSONIndex.getTile(H.z,H.x,H.y);if(!J)return null;const _e=new class{constructor(we){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.W,this.length=we.length,this._features=we}feature(we){return new class{constructor(de){this._feature=de,this.extent=m.W,this.type=de.type,this.properties=de.tags,"id"in de&&!isNaN(de.id)&&(this.id=parseInt(de.id,10))}loadGeometry(){if(this._feature.type===1){const de=[];for(const Ie of this._feature.geometry)de.push([new m.P(Ie[0],Ie[1])]);return de}{const de=[];for(const Ie of this._feature.geometry){const qe=[];for(const Re of Ie)qe.push(new m.P(Re[0],Re[1]));de.push(qe)}return de}}toGeoJSON(de,Ie,qe){return ge.call(this,de,Ie,qe)}}(this._features[we])}}(J.features);let ve=Qt(_e);return ve.byteOffset===0&&ve.byteLength===ve.buffer.byteLength||(ve=new Uint8Array(ve)),{vectorTile:_e,rawData:ve.buffer}})}loadData(N){return m._(this,void 0,void 0,function*(){var U;(U=this._pendingRequest)===null||U===void 0||U.abort();const H=!!(N&&N.request&&N.request.collectResourceTiming)&&new m.bs(N.request);this._pendingRequest=new AbortController;try{let J=yield this.loadGeoJSON(N,this._pendingRequest);if(delete this._pendingRequest,typeof J!="object")throw new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`);if(Y(J,!0),N.filter){const ve=m.by(N.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ve.result==="error")throw new Error(ve.value.map(de=>`${de.key}: ${de.message}`).join(", "));J={type:"FeatureCollection",features:J.features.filter(de=>ve.value.evaluate({zoom:0},de))}}this._geoJSONIndex=N.cluster?new ir(function({superclusterOptions:ve,clusterProperties:we}){if(!we||!ve)return ve;const de={},Ie={},qe={accumulated:null,zoom:0},Re={properties:null},Ne=Object.keys(we);for(const Bt of Ne){const[Vt,ti]=we[Bt],ri=m.by(ti),_i=m.by(typeof Vt=="string"?[Vt,["accumulated"],["get",Bt]]:Vt);de[Bt]=ri.value,Ie[Bt]=_i.value}return ve.map=Bt=>{Re.properties=Bt;const Vt={};for(const ti of Ne)Vt[ti]=de[ti].evaluate(qe,Re);return Vt},ve.reduce=(Bt,Vt)=>{Re.properties=Vt;for(const ti of Ne)qe.accumulated=Bt[ti],Bt[ti]=Ie[ti].evaluate(qe,Re)},ve}(N)).load(J.features):function(ve,we){return new li(ve,we)}(J,N.geojsonVtOptions),this.loaded={};const _e={};if(H){const ve=H.finish();ve&&(_e.resourceTiming={},_e.resourceTiming[N.source]=JSON.parse(JSON.stringify(ve)))}return _e}catch(J){if(delete this._pendingRequest,m.bz(J))return{abandoned:!0};throw J}})}reloadTile(N){const U=this.loaded;return U&&U[N.uid]?super.reloadTile(N):this.loadTile(N)}loadGeoJSON(N,U){return m._(this,void 0,void 0,function*(){const{promoteId:H}=N;if(N.request){const J=yield m.h(N.request,U);return this._dataUpdateable=mn(J.data,H)?ei(J.data,H):void 0,J.data}if(typeof N.data=="string")try{const J=JSON.parse(N.data);return this._dataUpdateable=mn(J,H)?ei(J,H):void 0,J}catch{throw new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`)}if(!N.dataDiff)throw new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${N.source}`);return function(J,_e,ve){var we,de,Ie,qe;if(_e.removeAll&&J.clear(),_e.remove)for(const Re of _e.remove)J.delete(Re);if(_e.add)for(const Re of _e.add){const Ne=$i(Re,ve);Ne!=null&&J.set(Ne,Re)}if(_e.update)for(const Re of _e.update){let Ne=J.get(Re.id);if(Ne==null)continue;const Bt=!Re.removeAllProperties&&(((we=Re.removeProperties)===null||we===void 0?void 0:we.length)>0||((de=Re.addOrUpdateProperties)===null||de===void 0?void 0:de.length)>0);if((Re.newGeometry||Re.removeAllProperties||Bt)&&(Ne=Object.assign({},Ne),J.set(Re.id,Ne),Bt&&(Ne.properties=Object.assign({},Ne.properties))),Re.newGeometry&&(Ne.geometry=Re.newGeometry),Re.removeAllProperties)Ne.properties={};else if(((Ie=Re.removeProperties)===null||Ie===void 0?void 0:Ie.length)>0)for(const Vt of Re.removeProperties)Object.prototype.hasOwnProperty.call(Ne.properties,Vt)&&delete Ne.properties[Vt];if(((qe=Re.addOrUpdateProperties)===null||qe===void 0?void 0:qe.length)>0)for(const{key:Vt,value:ti}of Re.addOrUpdateProperties)Ne.properties[Vt]=ti}}(this._dataUpdateable,N.dataDiff,H),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(N){return m._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(N){return this._geoJSONIndex.getClusterExpansionZoom(N.clusterId)}getClusterChildren(N){return this._geoJSONIndex.getChildren(N.clusterId)}getClusterLeaves(N){return this._geoJSONIndex.getLeaves(N.clusterId,N.limit,N.offset)}}class Mr{constructor(N){this.self=N,this.actor=new m.C(N),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(U,H)=>{if(this.externalWorkerSourceTypes[U])throw new Error(`Worker source with name "${U}" already registered.`);this.externalWorkerSourceTypes[U]=H},this.self.addProtocol=m.bf,this.self.removeProtocol=m.bg,this.self.registerRTLTextPlugin=U=>{if(m.bA.isParsed())throw new Error("RTL text plugin already registered.");m.bA.setMethods(U)},this.actor.registerMessageHandler("LDT",(U,H)=>this._getDEMWorkerSource(U,H.source).loadTile(H)),this.actor.registerMessageHandler("RDT",(U,H)=>m._(this,void 0,void 0,function*(){this._getDEMWorkerSource(U,H.source).removeTile(H)})),this.actor.registerMessageHandler("GCEZ",(U,H)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(U,H.type,H.source).getClusterExpansionZoom(H)})),this.actor.registerMessageHandler("GCC",(U,H)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(U,H.type,H.source).getClusterChildren(H)})),this.actor.registerMessageHandler("GCL",(U,H)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(U,H.type,H.source).getClusterLeaves(H)})),this.actor.registerMessageHandler("LD",(U,H)=>this._getWorkerSource(U,H.type,H.source).loadData(H)),this.actor.registerMessageHandler("LT",(U,H)=>this._getWorkerSource(U,H.type,H.source).loadTile(H)),this.actor.registerMessageHandler("RT",(U,H)=>this._getWorkerSource(U,H.type,H.source).reloadTile(H)),this.actor.registerMessageHandler("AT",(U,H)=>this._getWorkerSource(U,H.type,H.source).abortTile(H)),this.actor.registerMessageHandler("RMT",(U,H)=>this._getWorkerSource(U,H.type,H.source).removeTile(H)),this.actor.registerMessageHandler("RS",(U,H)=>m._(this,void 0,void 0,function*(){if(!this.workerSources[U]||!this.workerSources[U][H.type]||!this.workerSources[U][H.type][H.source])return;const J=this.workerSources[U][H.type][H.source];delete this.workerSources[U][H.type][H.source],J.removeSource!==void 0&&J.removeSource(H)})),this.actor.registerMessageHandler("RM",U=>m._(this,void 0,void 0,function*(){delete this.layerIndexes[U],delete this.availableImages[U],delete this.workerSources[U],delete this.demWorkerSources[U]})),this.actor.registerMessageHandler("SR",(U,H)=>m._(this,void 0,void 0,function*(){this.referrer=H})),this.actor.registerMessageHandler("SRPS",(U,H)=>this._syncRTLPluginState(U,H)),this.actor.registerMessageHandler("IS",(U,H)=>m._(this,void 0,void 0,function*(){this.self.importScripts(H)})),this.actor.registerMessageHandler("SI",(U,H)=>this._setImages(U,H)),this.actor.registerMessageHandler("UL",(U,H)=>m._(this,void 0,void 0,function*(){this._getLayerIndex(U).update(H.layers,H.removedIds)})),this.actor.registerMessageHandler("SL",(U,H)=>m._(this,void 0,void 0,function*(){this._getLayerIndex(U).replace(H)}))}_setImages(N,U){return m._(this,void 0,void 0,function*(){this.availableImages[N]=U;for(const H in this.workerSources[N]){const J=this.workerSources[N][H];for(const _e in J)J[_e].availableImages=U}})}_syncRTLPluginState(N,U){return m._(this,void 0,void 0,function*(){if(m.bA.isParsed())return m.bA.getState();if(U.pluginStatus!=="loading")return m.bA.setState(U),U;const H=U.pluginURL;if(this.self.importScripts(H),m.bA.isParsed()){const J={pluginStatus:"loaded",pluginURL:H};return m.bA.setState(J),J}throw m.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${H}`)})}_getAvailableImages(N){let U=this.availableImages[N];return U||(U=[]),U}_getLayerIndex(N){let U=this.layerIndexes[N];return U||(U=this.layerIndexes[N]=new l),U}_getWorkerSource(N,U,H){if(this.workerSources[N]||(this.workerSources[N]={}),this.workerSources[N][U]||(this.workerSources[N][U]={}),!this.workerSources[N][U][H]){const J={sendAsync:(_e,ve)=>(_e.targetMapId=N,this.actor.sendAsync(_e,ve))};switch(U){case"vector":this.workerSources[N][U][H]=new k(J,this._getLayerIndex(N),this._getAvailableImages(N));break;case"geojson":this.workerSources[N][U][H]=new Js(J,this._getLayerIndex(N),this._getAvailableImages(N));break;default:this.workerSources[N][U][H]=new this.externalWorkerSourceTypes[U](J,this._getLayerIndex(N),this._getAvailableImages(N))}}return this.workerSources[N][U][H]}_getDEMWorkerSource(N,U){return this.demWorkerSources[N]||(this.demWorkerSources[N]={}),this.demWorkerSources[N][U]||(this.demWorkerSources[N][U]=new R),this.demWorkerSources[N][U]}}return m.i(self)&&(self.worker=new Mr(self)),Mr}),d("index",["exports","./shared"],function(m,l){var T="4.1.3";let P,z;const k={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:g=>new Promise((i,o)=>{const h=requestAnimationFrame(i);g.signal.addEventListener("abort",()=>{cancelAnimationFrame(h),o(l.c())})}),getImageData(g,i=0){return this.getImageCanvasContext(g).getImageData(-i,-i,g.width+2*i,g.height+2*i)},getImageCanvasContext(g){const i=window.document.createElement("canvas"),o=i.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return i.width=g.width,i.height=g.height,o.drawImage(g,0,0,g.width,g.height),o},resolveURL:g=>(P||(P=document.createElement("a")),P.href=g,P.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(z==null&&(z=matchMedia("(prefers-reduced-motion: reduce)")),z.matches)}};class R{static testProp(i){if(!R.docStyle)return i[0];for(let o=0;o<i.length;o++)if(i[o]in R.docStyle)return i[o];return i[0]}static create(i,o,h){const f=window.document.createElement(i);return o!==void 0&&(f.className=o),h&&h.appendChild(f),f}static createNS(i,o){return window.document.createElementNS(i,o)}static disableDrag(){R.docStyle&&R.selectProp&&(R.userSelect=R.docStyle[R.selectProp],R.docStyle[R.selectProp]="none")}static enableDrag(){R.docStyle&&R.selectProp&&(R.docStyle[R.selectProp]=R.userSelect)}static setTransform(i,o){i.style[R.transformProp]=o}static addEventListener(i,o,h,f={}){i.addEventListener(o,h,"passive"in f?f:f.capture)}static removeEventListener(i,o,h,f={}){i.removeEventListener(o,h,"passive"in f?f:f.capture)}static suppressClickInternal(i){i.preventDefault(),i.stopPropagation(),window.removeEventListener("click",R.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",R.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",R.suppressClickInternal,!0)},0)}static getScale(i){const o=i.getBoundingClientRect();return{x:o.width/i.offsetWidth||1,y:o.height/i.offsetHeight||1,boundingClientRect:o}}static getPoint(i,o,h){const f=o.boundingClientRect;return new l.P((h.clientX-f.left)/o.x-i.clientLeft,(h.clientY-f.top)/o.y-i.clientTop)}static mousePos(i,o){const h=R.getScale(i);return R.getPoint(i,h,o)}static touchPos(i,o){const h=[],f=R.getScale(i);for(let _=0;_<o.length;_++)h.push(R.getPoint(i,f,o[_]));return h}static mouseButton(i){return i.button}static remove(i){i.parentNode&&i.parentNode.removeChild(i)}}R.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,R.selectProp=R.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),R.transformProp=R.testProp(["transform","WebkitTransform"]);const Z={supported:!1,testSupport:function(g){!ge&&Y&&(Te?Fe(g):K=g)}};let K,Y,ge=!1,Te=!1;function Fe(g){const i=g.createTexture();g.bindTexture(g.TEXTURE_2D,i);try{if(g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,Y),g.isContextLost())return;Z.supported=!0}catch{}g.deleteTexture(i),ge=!0}var he;typeof document<"u"&&(Y=document.createElement("img"),Y.onload=function(){K&&Fe(K),K=null,Te=!0},Y.onerror=function(){ge=!0,K=null},Y.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(g){let i,o,h,f;g.resetRequestQueue=()=>{i=[],o=0,h=0,f={}},g.addThrottleControl=I=>{const D=h++;return f[D]=I,D},g.removeThrottleControl=I=>{delete f[I],M()},g.getImage=(I,D,F=!0)=>new Promise((B,q)=>{Z.supported&&(I.headers||(I.headers={}),I.headers.accept="image/webp,*/*"),l.e(I,{type:"image"}),i.push({abortController:D,requestParameters:I,supportImageRefresh:F,state:"queued",onError:te=>{q(te)},onSuccess:te=>{B(te)}}),M()});const _=I=>l._(this,void 0,void 0,function*(){I.state="running";const{requestParameters:D,supportImageRefresh:F,onError:B,onSuccess:q,abortController:te}=I,Q=F===!1&&!l.i(self)&&!l.g(D.url)&&(!D.headers||Object.keys(D.headers).reduce((pe,Ce)=>pe&&Ce==="accept",!0));o++;const re=Q?S(D,te):l.m(D,te);try{const pe=yield re;delete I.abortController,I.state="completed",pe.data instanceof HTMLImageElement||l.b(pe.data)?q(pe):pe.data&&q({data:yield(W=pe.data,typeof createImageBitmap=="function"?l.d(W):l.f(W)),cacheControl:pe.cacheControl,expires:pe.expires})}catch(pe){delete I.abortController,B(pe)}finally{o--,M()}var W}),M=()=>{const I=(()=>{for(const D of Object.keys(f))if(f[D]())return!0;return!1})()?l.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let D=o;D<I&&i.length>0;D++){const F=i.shift();F.abortController.signal.aborted?D--:_(F)}},S=(I,D)=>new Promise((F,B)=>{const q=new Image,te=I.url,Q=I.credentials;Q&&Q==="include"?q.crossOrigin="use-credentials":(Q&&Q==="same-origin"||!l.s(te))&&(q.crossOrigin="anonymous"),D.signal.addEventListener("abort",()=>{q.src="",B(l.c())}),q.fetchPriority="high",q.onload=()=>{q.onerror=q.onload=null,F({data:q})},q.onerror=()=>{q.onerror=q.onload=null,D.signal.aborted||B(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},q.src=te})}(he||(he={})),he.resetRequestQueue();class Le{constructor(i){this._transformRequestFn=i}transformRequest(i,o){return this._transformRequestFn&&this._transformRequestFn(i,o)||{url:i}}normalizeSpriteURL(i,o,h){const f=function(_){const M=_.match(We);if(!M)throw new Error(`Unable to parse URL "${_}"`);return{protocol:M[1],authority:M[2],path:M[3]||"/",params:M[4]?M[4].split("&"):[]}}(i);return f.path+=`${o}${h}`,function(_){const M=_.params.length?`?${_.params.join("&")}`:"";return`${_.protocol}://${_.authority}${_.path}${M}`}(f)}setTransformRequest(i){this._transformRequestFn=i}}const We=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Qe(g){var i=new l.A(3);return i[0]=g[0],i[1]=g[1],i[2]=g[2],i}var bt,He=function(g,i,o){return g[0]=i[0]-o[0],g[1]=i[1]-o[1],g[2]=i[2]-o[2],g};bt=new l.A(3),l.A!=Float32Array&&(bt[0]=0,bt[1]=0,bt[2]=0);var lt=function(g){var i=g[0],o=g[1];return i*i+o*o};function Rt(g){const i=[];if(typeof g=="string")i.push({id:"default",url:g});else if(g&&g.length>0){const o=[];for(const{id:h,url:f}of g){const _=`${h}${f}`;o.indexOf(_)===-1&&(o.push(_),i.push({id:h,url:f}))}}return i}(function(){var g=new l.A(2);l.A!=Float32Array&&(g[0]=0,g[1]=0)})();class Pt{constructor(i,o,h,f){this.context=i,this.format=h,this.texture=i.gl.createTexture(),this.update(o,f)}update(i,o,h){const{width:f,height:_}=i,M=!(this.size&&this.size[0]===f&&this.size[1]===_||h),{context:S}=this,{gl:I}=S;if(this.useMipmap=!!(o&&o.useMipmap),I.bindTexture(I.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===I.RGBA&&(!o||o.premultiply!==!1)),M)this.size=[f,_],i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||l.b(i)?I.texImage2D(I.TEXTURE_2D,0,this.format,this.format,I.UNSIGNED_BYTE,i):I.texImage2D(I.TEXTURE_2D,0,this.format,f,_,0,this.format,I.UNSIGNED_BYTE,i.data);else{const{x:D,y:F}=h||{x:0,y:0};i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||l.b(i)?I.texSubImage2D(I.TEXTURE_2D,0,D,F,I.RGBA,I.UNSIGNED_BYTE,i):I.texSubImage2D(I.TEXTURE_2D,0,D,F,f,_,I.RGBA,I.UNSIGNED_BYTE,i.data)}this.useMipmap&&this.isSizePowerOfTwo()&&I.generateMipmap(I.TEXTURE_2D)}bind(i,o,h){const{context:f}=this,{gl:_}=f;_.bindTexture(_.TEXTURE_2D,this.texture),h!==_.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(h=_.LINEAR),i!==this.filter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,i),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,h||i),this.filter=i),o!==this.wrap&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,o),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}function oi(g){const{userImage:i}=g;return!!(i&&i.render&&i.render())&&(g.data.replace(new Uint8Array(i.data.buffer)),!0)}class pi extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:o,promiseResolve:h}of this.requestors)h(this._getImagesForIds(o));this.requestors=[]}}getImage(i){const o=this.images[i];if(o&&!o.data&&o.spriteData){const h=o.spriteData;o.data=new l.R({width:h.width,height:h.height},h.context.getImageData(h.x,h.y,h.width,h.height).data),o.spriteData=null}return o}addImage(i,o){if(this.images[i])throw new Error(`Image id ${i} already exist, use updateImage instead`);this._validate(i,o)&&(this.images[i]=o)}_validate(i,o){let h=!0;const f=o.data||o.spriteData;return this._validateStretch(o.stretchX,f&&f.width)||(this.fire(new l.j(new Error(`Image "${i}" has invalid "stretchX" value`))),h=!1),this._validateStretch(o.stretchY,f&&f.height)||(this.fire(new l.j(new Error(`Image "${i}" has invalid "stretchY" value`))),h=!1),this._validateContent(o.content,o)||(this.fire(new l.j(new Error(`Image "${i}" has invalid "content" value`))),h=!1),h}_validateStretch(i,o){if(!i)return!0;let h=0;for(const f of i){if(f[0]<h||f[1]<f[0]||o<f[1])return!1;h=f[1]}return!0}_validateContent(i,o){if(!i)return!0;if(i.length!==4)return!1;const h=o.spriteData,f=h&&h.width||o.data.width,_=h&&h.height||o.data.height;return!(i[0]<0||f<i[0]||i[1]<0||_<i[1]||i[2]<0||f<i[2]||i[3]<0||_<i[3]||i[2]<i[0]||i[3]<i[1])}updateImage(i,o,h=!0){const f=this.getImage(i);if(h&&(f.data.width!==o.data.width||f.data.height!==o.data.height))throw new Error(`size mismatch between old image (${f.data.width}x${f.data.height}) and new image (${o.data.width}x${o.data.height}).`);o.version=f.version+1,this.images[i]=o,this.updatedImages[i]=!0}removeImage(i){const o=this.images[i];delete this.images[i],delete this.patterns[i],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i){return new Promise((o,h)=>{let f=!0;if(!this.isLoaded())for(const _ of i)this.images[_]||(f=!1);this.isLoaded()||f?o(this._getImagesForIds(i)):this.requestors.push({ids:i,promiseResolve:o})})}_getImagesForIds(i){const o={};for(const h of i){let f=this.getImage(h);f||(this.fire(new l.k("styleimagemissing",{id:h})),f=this.getImage(h)),f?o[h]={data:f.data.clone(),pixelRatio:f.pixelRatio,sdf:f.sdf,version:f.version,stretchX:f.stretchX,stretchY:f.stretchY,content:f.content,hasRenderCallback:!!(f.userImage&&f.userImage.render)}:l.w(`Image "${h}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return o}getPixelSize(){const{width:i,height:o}=this.atlasImage;return{width:i,height:o}}getPattern(i){const o=this.patterns[i],h=this.getImage(i);if(!h)return null;if(o&&o.position.version===h.version)return o.position;if(o)o.position.version=h.version;else{const f={w:h.data.width+2,h:h.data.height+2,x:0,y:0},_=new l.I(f,h);this.patterns[i]={bin:f,position:_}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const o=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Pt(i,this.atlasImage,o.RGBA),this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const _ in this.patterns)i.push(this.patterns[_].bin);const{w:o,h}=l.p(i),f=this.atlasImage;f.resize({width:o||1,height:h||1});for(const _ in this.patterns){const{bin:M}=this.patterns[_],S=M.x+1,I=M.y+1,D=this.getImage(_).data,F=D.width,B=D.height;l.R.copy(D,f,{x:0,y:0},{x:S,y:I},{width:F,height:B}),l.R.copy(D,f,{x:0,y:B-1},{x:S,y:I-1},{width:F,height:1}),l.R.copy(D,f,{x:0,y:0},{x:S,y:I+B},{width:F,height:1}),l.R.copy(D,f,{x:F-1,y:0},{x:S-1,y:I},{width:1,height:B}),l.R.copy(D,f,{x:0,y:0},{x:S+F,y:I},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const o of i){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;const h=this.getImage(o);h||l.w(`Image with ID: "${o}" was not found`),oi(h)&&this.updateImage(o,h)}}}const Yt=1e20;function cr(g,i,o,h,f,_,M,S,I){for(let D=i;D<i+h;D++)si(g,o*_+D,_,f,M,S,I);for(let D=o;D<o+f;D++)si(g,D*_+i,1,h,M,S,I)}function si(g,i,o,h,f,_,M){_[0]=0,M[0]=-Yt,M[1]=Yt,f[0]=g[i];for(let S=1,I=0,D=0;S<h;S++){f[S]=g[i+S*o];const F=S*S;do{const B=_[I];D=(f[S]-f[B]+F-B*B)/(S-B)/2}while(D<=M[I]&&--I>-1);I++,_[I]=S,M[I]=D,M[I+1]=Yt}for(let S=0,I=0;S<h;S++){for(;M[I+1]<S;)I++;const D=_[I],F=S-D;g[i+S*o]=f[D]+F*F}}class Qt{constructor(i,o){this.requestManager=i,this.localIdeographFontFamily=o,this.entries={}}setURL(i){this.url=i}getGlyphs(i){return l._(this,void 0,void 0,function*(){const o=[];for(const _ in i)for(const M of i[_])o.push(this._getAndCacheGlyphsPromise(_,M));const h=yield Promise.all(o),f={};for(const{stack:_,id:M,glyph:S}of h)f[_]||(f[_]={}),f[_][M]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics};return f})}_getAndCacheGlyphsPromise(i,o){return l._(this,void 0,void 0,function*(){let h=this.entries[i];h||(h=this.entries[i]={glyphs:{},requests:{},ranges:{}});let f=h.glyphs[o];if(f!==void 0)return{stack:i,id:o,glyph:f};if(f=this._tinySDF(h,i,o),f)return h.glyphs[o]=f,{stack:i,id:o,glyph:f};const _=Math.floor(o/256);if(256*_>65535)throw new Error("glyphs > 65535 not supported");if(h.ranges[_])return{stack:i,id:o,glyph:f};if(!this.url)throw new Error("glyphsUrl is not set");if(!h.requests[_]){const S=Qt.loadGlyphRange(i,_,this.url,this.requestManager);h.requests[_]=S}const M=yield h.requests[_];for(const S in M)this._doesCharSupportLocalGlyph(+S)||(h.glyphs[+S]=M[+S]);return h.ranges[_]=!0,{stack:i,id:o,glyph:M[o]||null}})}_doesCharSupportLocalGlyph(i){return!!this.localIdeographFontFamily&&(l.u["CJK Unified Ideographs"](i)||l.u["Hangul Syllables"](i)||l.u.Hiragana(i)||l.u.Katakana(i))}_tinySDF(i,o,h){const f=this.localIdeographFontFamily;if(!f||!this._doesCharSupportLocalGlyph(h))return;let _=i.tinySDF;if(!_){let S="400";/bold/i.test(o)?S="900":/medium/i.test(o)?S="500":/light/i.test(o)&&(S="200"),_=i.tinySDF=new Qt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:f,fontWeight:S})}const M=_.draw(String.fromCharCode(h));return{id:h,bitmap:new l.o({width:M.width||60,height:M.height||60},M.data),metrics:{width:M.glyphWidth/2||24,height:M.glyphHeight/2||24,left:M.glyphLeft/2+.5||0,top:M.glyphTop/2-27.5||-8,advance:M.glyphAdvance/2||24,isDoubleResolution:!0}}}}Qt.loadGlyphRange=function(g,i,o,h){return l._(this,void 0,void 0,function*(){const f=256*i,_=f+255,M=h.transformRequest(o.replace("{fontstack}",g).replace("{range}",`${f}-${_}`),"Glyphs"),S=yield l.l(M,new AbortController);if(!S||!S.data)throw new Error(`Could not load glyph range. range: ${i}, ${f}-${_}`);const I={};for(const D of l.n(S.data))I[D.id]=D;return I})},Qt.TinySDF=class{constructor({fontSize:g=24,buffer:i=3,radius:o=8,cutoff:h=.25,fontFamily:f="sans-serif",fontWeight:_="normal",fontStyle:M="normal"}={}){this.buffer=i,this.cutoff=h,this.radius=o;const S=this.size=g+4*i,I=this._createCanvas(S),D=this.ctx=I.getContext("2d",{willReadFrequently:!0});D.font=`${M} ${_} ${g}px ${f}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(g){const i=document.createElement("canvas");return i.width=i.height=g,i}draw(g){const{width:i,actualBoundingBoxAscent:o,actualBoundingBoxDescent:h,actualBoundingBoxLeft:f,actualBoundingBoxRight:_}=this.ctx.measureText(g),M=Math.ceil(o),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-f))),I=Math.min(this.size-this.buffer,M+Math.ceil(h)),D=S+2*this.buffer,F=I+2*this.buffer,B=Math.max(D*F,0),q=new Uint8ClampedArray(B),te={data:q,width:D,height:F,glyphWidth:S,glyphHeight:I,glyphTop:M,glyphLeft:0,glyphAdvance:i};if(S===0||I===0)return te;const{ctx:Q,buffer:re,gridInner:W,gridOuter:pe}=this;Q.clearRect(re,re,S,I),Q.fillText(g,re,re+M);const Ce=Q.getImageData(re,re,S,I);pe.fill(Yt,0,B),W.fill(0,0,B);for(let oe=0;oe<I;oe++)for(let be=0;be<S;be++){const Ae=Ce.data[4*(oe*S+be)+3]/255;if(Ae===0)continue;const ke=(oe+re)*D+be+re;if(Ae===1)pe[ke]=0,W[ke]=Yt;else{const ze=.5-Ae;pe[ke]=ze>0?ze*ze:0,W[ke]=ze<0?ze*ze:0}}cr(pe,0,0,D,F,D,this.f,this.v,this.z),cr(W,re,re,S,I,D,this.f,this.v,this.z);for(let oe=0;oe<B;oe++){const be=Math.sqrt(pe[oe])-Math.sqrt(W[oe]);q[oe]=Math.round(255-255*(be/this.radius+this.cutoff))}return te}};class gi{constructor(){this.specification=l.v.light.position}possiblyEvaluate(i,o){return l.y(i.expression.evaluate(o))}interpolate(i,o,h){return{x:l.z.number(i.x,o.x,h),y:l.z.number(i.y,o.y,h),z:l.z.number(i.z,o.z,h)}}}let ur;class Ar extends l.E{constructor(i){super(),ur=ur||new l.q({anchor:new l.D(l.v.light.anchor),position:new gi,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.T(ur),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,o={}){if(!this._validate(l.r,i,o))for(const h in i){const f=i[h];h.endsWith("-transition")?this._transitionable.setTransition(h.slice(0,-11),f):this._transitionable.setValue(h,f)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,o,h){return(!h||h.validate!==!1)&&l.t(this,i.call(l.x,{value:o,style:{glyphs:!0,sprite:!0},styleSpec:l.v}))}}class ut{constructor(i,o){this.width=i,this.height=o,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(i,o){const h=i.join(",")+String(o);return this.dashEntry[h]||(this.dashEntry[h]=this.addDash(i,o)),this.dashEntry[h]}getDashRanges(i,o,h){const f=[];let _=i.length%2==1?-i[i.length-1]*h:0,M=i[0]*h,S=!0;f.push({left:_,right:M,isDash:S,zeroLength:i[0]===0});let I=i[0];for(let D=1;D<i.length;D++){S=!S;const F=i[D];_=I*h,I+=F,M=I*h,f.push({left:_,right:M,isDash:S,zeroLength:F===0})}return f}addRoundDash(i,o,h){const f=o/2;for(let _=-h;_<=h;_++){const M=this.width*(this.nextRow+h+_);let S=0,I=i[S];for(let D=0;D<this.width;D++){D/I.right>1&&(I=i[++S]);const F=Math.abs(D-I.left),B=Math.abs(D-I.right),q=Math.min(F,B);let te;const Q=_/h*(f+1);if(I.isDash){const re=f-Math.abs(Q);te=Math.sqrt(q*q+re*re)}else te=f-Math.sqrt(q*q+Q*Q);this.data[M+D]=Math.max(0,Math.min(255,te+128))}}}addRegularDash(i){for(let S=i.length-1;S>=0;--S){const I=i[S],D=i[S+1];I.zeroLength?i.splice(S,1):D&&D.isDash===I.isDash&&(D.left=I.left,i.splice(S,1))}const o=i[0],h=i[i.length-1];o.isDash===h.isDash&&(o.left=h.left-this.width,h.right=o.right+this.width);const f=this.width*this.nextRow;let _=0,M=i[_];for(let S=0;S<this.width;S++){S/M.right>1&&(M=i[++_]);const I=Math.abs(S-M.left),D=Math.abs(S-M.right),F=Math.min(I,D);this.data[f+S]=Math.max(0,Math.min(255,(M.isDash?F:-F)+128))}}addDash(i,o){const h=o?7:0,f=2*h+1;if(this.nextRow+f>this.height)return l.w("LineAtlas out of space"),null;let _=0;for(let S=0;S<i.length;S++)_+=i[S];if(_!==0){const S=this.width/_,I=this.getDashRanges(i,this.width,S);o?this.addRoundDash(I,S,h):this.addRegularDash(I)}const M={y:(this.nextRow+h+.5)/this.height,height:2*h/this.height,width:_};return this.nextRow+=f,this.dirty=!0,M}bind(i){const o=i.gl;this.texture?(o.bindTexture(o.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,o.texSubImage2D(o.TEXTURE_2D,0,0,0,this.width,this.height,o.ALPHA,o.UNSIGNED_BYTE,this.data))):(this.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.ALPHA,this.width,this.height,0,o.ALPHA,o.UNSIGNED_BYTE,this.data))}}const rt="maplibre_preloaded_worker_pool";class et{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<et.workerCount;)this.workers.push(new Worker(l.a.WORKER_URL));return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[rt]}numActive(){return Object.keys(this.active).length}}const ir=Math.floor(k.hardwareConcurrency/2);let ji,wi;function Ve(){return ji||(ji=new et),ji}et.workerCount=l.B(globalThis)?Math.max(Math.min(ir,3),1):1;class Et{constructor(i,o){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=o;const h=this.workerPool.acquire(o);for(let f=0;f<h.length;f++){const _=new l.C(h[f],o);_.name=`Worker ${f}`,this.actors.push(_)}if(!this.actors.length)throw new Error("No actors found")}broadcast(i,o){const h=[];for(const f of this.actors)h.push(f.sendAsync({type:i,data:o}));return Promise.all(h)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(i=!0){this.actors.forEach(o=>{o.remove()}),this.actors=[],i&&this.workerPool.release(this.id)}registerMessageHandler(i,o){for(const h of this.actors)h.registerMessageHandler(i,o)}}function ht(){return wi||(wi=new Et(Ve(),l.G),wi.registerMessageHandler("GR",(g,i,o)=>l.m(i,o))),wi}function Je(g,i){const o=l.F();return l.H(o,o,[1,1,0]),l.J(o,o,[.5*g.width,.5*g.height,1]),l.K(o,o,g.calculatePosMatrix(i.toUnwrapped()))}function Pi(g,i,o,h,f,_){const M=function(B,q,te){if(B)for(const Q of B){const re=q[Q];if(re&&re.source===te&&re.type==="fill-extrusion")return!0}else for(const Q in q){const re=q[Q];if(re.source===te&&re.type==="fill-extrusion")return!0}return!1}(f&&f.layers,i,g.id),S=_.maxPitchScaleFactor(),I=g.tilesIn(h,S,M);I.sort(Ri);const D=[];for(const B of I)D.push({wrappedTileID:B.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(i,o,g._state,B.queryGeometry,B.cameraQueryGeometry,B.scale,f,_,S,Je(g.transform,B.tileID))});const F=function(B){const q={},te={};for(const Q of B){const re=Q.queryResults,W=Q.wrappedTileID,pe=te[W]=te[W]||{};for(const Ce in re){const oe=re[Ce],be=pe[Ce]=pe[Ce]||{},Ae=q[Ce]=q[Ce]||[];for(const ke of oe)be[ke.featureIndex]||(be[ke.featureIndex]=!0,Ae.push(ke))}}return q}(D);for(const B in F)F[B].forEach(q=>{const te=q.feature,Q=g.getFeatureState(te.layer["source-layer"],te.id);te.source=te.layer.source,te.layer["source-layer"]&&(te.sourceLayer=te.layer["source-layer"]),te.state=Q});return F}function Ri(g,i){const o=g.tileID,h=i.tileID;return o.overscaledZ-h.overscaledZ||o.canonical.y-h.canonical.y||o.wrap-h.wrap||o.canonical.x-h.canonical.x}function se(g,i,o){return l._(this,void 0,void 0,function*(){let h=g;if(g.url?h=(yield l.h(i.transformRequest(g.url,"Source"),o)).data:yield k.frameAsync(o),!h)return null;const f=l.L(l.e(h,g),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in h&&h.vector_layers&&(f.vectorLayerIds=h.vector_layers.map(_=>_.id)),f})}class ce{constructor(i,o){i&&(o?this.setSouthWest(i).setNorthEast(o):Array.isArray(i)&&(i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1])))}setNorthEast(i){return this._ne=i instanceof l.M?new l.M(i.lng,i.lat):l.M.convert(i),this}setSouthWest(i){return this._sw=i instanceof l.M?new l.M(i.lng,i.lat):l.M.convert(i),this}extend(i){const o=this._sw,h=this._ne;let f,_;if(i instanceof l.M)f=i,_=i;else{if(!(i instanceof ce))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(ce.convert(i)):this.extend(l.M.convert(i)):i&&("lng"in i||"lon"in i)&&"lat"in i?this.extend(l.M.convert(i)):this;if(f=i._sw,_=i._ne,!f||!_)return this}return o||h?(o.lng=Math.min(f.lng,o.lng),o.lat=Math.min(f.lat,o.lat),h.lng=Math.max(_.lng,h.lng),h.lat=Math.max(_.lat,h.lat)):(this._sw=new l.M(f.lng,f.lat),this._ne=new l.M(_.lng,_.lat)),this}getCenter(){return new l.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.M(this.getWest(),this.getNorth())}getSouthEast(){return new l.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:o,lat:h}=l.M.convert(i);let f=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&f}static convert(i){return i instanceof ce?i:i&&new ce(i)}static fromLngLat(i,o=0){const h=360*o/40075017,f=h/Math.cos(Math.PI/180*i.lat);return new ce(new l.M(i.lng-f,i.lat-h),new l.M(i.lng+f,i.lat+h))}}class Pe{constructor(i,o,h){this.bounds=ce.convert(this.validateBounds(i)),this.minzoom=o||0,this.maxzoom=h||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const o=Math.pow(2,i.z),h=Math.floor(l.N(this.bounds.getWest())*o),f=Math.floor(l.O(this.bounds.getNorth())*o),_=Math.ceil(l.N(this.bounds.getEast())*o),M=Math.ceil(l.O(this.bounds.getSouth())*o);return i.x>=h&&i.x<_&&i.y>=f&&i.y<M}}class Oe extends l.E{constructor(i,o,h,f){if(super(),this.id=i,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.L(o,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f)}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield se(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),i&&(l.e(this,i),i.bounds&&(this.tileBounds=new Pe(i.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(i){this._tileJSONRequest=null,this.fire(new l.j(i))}})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}setSourceProperty(i){this._tileJSONRequest&&this._tileJSONRequest.abort(),i(),this.load()}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}setUrl(i){return this.setSourceProperty(()=>{this.url=i,this._options.url=i}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(i){return l._(this,void 0,void 0,function*(){const o=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),h={request:this.map._requestManager.transformRequest(o,"Tile"),uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};h.request.collectResourceTiming=this._collectResourceTiming;let f="RT";if(i.actor&&i.state!=="expired"){if(i.state==="loading")return new Promise((_,M)=>{i.reloadPromise={resolve:_,reject:M}})}else i.actor=this.dispatcher.getActor(),f="LT";i.abortController=new AbortController;try{const _=yield i.actor.sendAsync({type:f,data:h},i.abortController);if(delete i.abortController,i.aborted)return;this._afterTileLoadWorkerResponse(i,_)}catch(_){if(delete i.abortController,i.aborted)return;if(_&&_.status!==404)throw _;this._afterTileLoadWorkerResponse(i,null)}})}_afterTileLoadWorkerResponse(i,o){if(o&&o.resourceTiming&&(i.resourceTiming=o.resourceTiming),o&&this.map._refreshExpiredTiles&&i.setExpiryData(o),i.loadVectorData(o,this.map.painter),i.reloadPromise){const h=i.reloadPromise;i.reloadPromise=null,this.loadTile(i).then(h.resolve).catch(h.reject)}}abortTile(i){return l._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.actor&&(yield i.actor.sendAsync({type:"AT",data:{uid:i.uid,type:this.type,source:this.id}}))})}unloadTile(i){return l._(this,void 0,void 0,function*(){i.unloadVectorData(),i.actor&&(yield i.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class le extends l.E{constructor(i,o,h,f){super(),this.id=i,this.dispatcher=h,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},o),l.e(this,l.L(o,["url","scheme","tileSize"]))}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield se(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,i&&(l.e(this,i),i.bounds&&(this.tileBounds=new Pe(i.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(i){this._tileJSONRequest=null,this.fire(new l.j(i))}})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(i){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),i(),this.load()}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}setUrl(i){return this.setSourceProperty(()=>{this.url=i,this._options.url=i}),this}serialize(){return l.e({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i){return l._(this,void 0,void 0,function*(){const o=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);i.abortController=new AbortController;try{const h=yield he.getImage(this.map._requestManager.transformRequest(o,"Tile"),i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(h&&h.data){this.map._refreshExpiredTiles&&h.cacheControl&&h.expires&&i.setExpiryData({cacheControl:h.cacheControl,expires:h.expires});const f=this.map.painter.context,_=f.gl,M=h.data;i.texture=this.map.painter.getTileTexture(M.width),i.texture?i.texture.update(M,{useMipmap:!0}):(i.texture=new Pt(f,M,_.RGBA,{useMipmap:!0}),i.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST),f.extTextureFilterAnisotropic&&_.texParameterf(_.TEXTURE_2D,f.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,f.extTextureFilterAnisotropicMax)),i.state="loaded"}}catch(h){if(delete i.abortController,i.aborted)i.state="unloaded";else if(h)throw i.state="errored",h}})}abortTile(i){return l._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController)})}unloadTile(i){return l._(this,void 0,void 0,function*(){i.texture&&this.map.painter.saveTileTexture(i.texture)})}hasTransition(){return!1}}class ft extends le{constructor(i,o,h,f){super(i,o,h,f),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox",this.redFactor=o.redFactor,this.greenFactor=o.greenFactor,this.blueFactor=o.blueFactor,this.baseShift=o.baseShift}loadTile(i){return l._(this,void 0,void 0,function*(){const o=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),h=this.map._requestManager.transformRequest(o,"Tile");i.neighboringTiles=this._getNeighboringTiles(i.tileID),i.abortController=new AbortController;try{const f=yield he.getImage(h,i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(f&&f.data){const _=f.data;this.map._refreshExpiredTiles&&f.cacheControl&&f.expires&&i.setExpiryData({cacheControl:f.cacheControl,expires:f.expires});const M=l.b(_)&&l.S()?_:yield this.readImageNow(_),S={type:this.type,uid:i.uid,source:this.id,rawImageData:M,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!i.actor||i.state==="expired"){i.actor=this.dispatcher.getActor();const I=yield i.actor.sendAsync({type:"LDT",data:S});i.dem=I,i.needsHillshadePrepare=!0,i.needsTerrainPrepare=!0,i.state="loaded"}}}catch(f){if(delete i.abortController,i.aborted)i.state="unloaded";else if(f)throw i.state="errored",f}})}readImageNow(i){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.U()){const o=i.width+2,h=i.height+2;try{return new l.R({width:o,height:h},yield l.V(i,-1,-1,o,h))}catch{}}return k.getImageData(i,1)})}_getNeighboringTiles(i){const o=i.canonical,h=Math.pow(2,o.z),f=(o.x-1+h)%h,_=o.x===0?i.wrap-1:i.wrap,M=(o.x+1+h)%h,S=o.x+1===h?i.wrap+1:i.wrap,I={};return I[new l.Q(i.overscaledZ,_,o.z,f,o.y).key]={backfilled:!1},I[new l.Q(i.overscaledZ,S,o.z,M,o.y).key]={backfilled:!1},o.y>0&&(I[new l.Q(i.overscaledZ,_,o.z,f,o.y-1).key]={backfilled:!1},I[new l.Q(i.overscaledZ,i.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},I[new l.Q(i.overscaledZ,S,o.z,M,o.y-1).key]={backfilled:!1}),o.y+1<h&&(I[new l.Q(i.overscaledZ,_,o.z,f,o.y+1).key]={backfilled:!1},I[new l.Q(i.overscaledZ,i.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},I[new l.Q(i.overscaledZ,S,o.z,M,o.y+1).key]={backfilled:!1}),I}unloadTile(i){return l._(this,void 0,void 0,function*(){i.demTexture&&this.map.painter.saveTileTexture(i.demTexture),i.fbo&&(i.fbo.destroy(),delete i.fbo),i.dem&&delete i.dem,delete i.neighboringTiles,i.state="unloaded",i.actor&&(yield i.actor.sendAsync({type:"RDT",data:{type:this.type,uid:i.uid,source:this.id}}))})}}class Ct extends l.E{constructor(i,o,h,f){super(),this.id=i,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=h.getActor(),this.setEventedParent(f),this._data=o.data,this._options=l.e({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const _=l.W/this.tileSize;this.workerOptions=l.e({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*_,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*_,extent:l.W,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:l.W,radius:(o.clusterRadius||50)*_,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return l._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(i){this.map=i,this.load()}setData(i){return this._data=i,this._updateWorkerData(),this}updateData(i){return this._updateWorkerData(i),this}setClusterOptions(i){return this.workerOptions.cluster=i.cluster,i&&(i.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=i.clusterRadius),i.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=i.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(i){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:i,source:this.id}})}getClusterChildren(i){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:i,source:this.id}})}getClusterLeaves(i,o,h){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:i,limit:o,offset:h}})}_updateWorkerData(i){return l._(this,void 0,void 0,function*(){const o=l.e({type:this.type},this.workerOptions);i?o.dataDiff=i:typeof this._data=="string"?(o.request=this.map._requestManager.transformRequest(k.resolveURL(this._data),"Source"),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.k("dataloading",{dataType:"source"}));try{const h=yield this.actor.sendAsync({type:"LD",data:o});if(this._pendingLoads--,this._removed||h.abandoned)return void this.fire(new l.k("dataabort",{dataType:"source"}));let f=null;h.resourceTiming&&h.resourceTiming[this.id]&&(f=h.resourceTiming[this.id].slice(0));const _={dataType:"source"};this._collectResourceTiming&&f&&f.length>0&&l.e(_,{resourceTiming:f}),this.fire(new l.k("data",Object.assign(Object.assign({},_),{sourceDataType:"metadata"}))),this.fire(new l.k("data",Object.assign(Object.assign({},_),{sourceDataType:"content"})))}catch(h){if(this._pendingLoads--,this._removed)return void this.fire(new l.k("dataabort",{dataType:"source"}));this.fire(new l.j(h))}})}loaded(){return this._pendingLoads===0}loadTile(i){return l._(this,void 0,void 0,function*(){const o=i.actor?"RT":"LT";i.actor=this.actor;const h={type:this.type,uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};i.abortController=new AbortController;const f=yield this.actor.sendAsync({type:o,data:h},i.abortController);delete i.abortController,i.unloadVectorData(),i.aborted||i.loadVectorData(f,this.map.painter,o==="RT")})}abortTile(i){return l._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.aborted=!0})}unloadTile(i){return l._(this,void 0,void 0,function*(){i.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Be=l.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class nt extends l.E{constructor(i,o,h,f){super(),this.id=i,this.dispatcher=h,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(f),this.options=o}load(i){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const o=yield he.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,o&&o.data&&(this.image=o.data,i&&(this.coordinates=i),this._finishLoading())}catch(o){this._request=null,this._loaded=!0,this.fire(new l.j(o))}})}loaded(){return this._loaded}updateImage(i){return i.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=i.url,this.load(i.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(i){this.coordinates=i;const o=i.map(l.Y.fromLngLat);this.tileID=function(f){let _=1/0,M=1/0,S=-1/0,I=-1/0;for(const q of f)_=Math.min(_,q.x),M=Math.min(M,q.y),S=Math.max(S,q.x),I=Math.max(I,q.y);const D=Math.max(S-_,I-M),F=Math.max(0,Math.floor(-Math.log(D)/Math.LN2)),B=Math.pow(2,F);return new l.a0(F,Math.floor((_+S)/2*B),Math.floor((M+I)/2*B))}(o),this.minzoom=this.maxzoom=this.tileID.z;const h=o.map(f=>this.tileID.getTilePoint(f)._round());return this._boundsArray=new l.Z,this._boundsArray.emplaceBack(h[0].x,h[0].y,0,0),this._boundsArray.emplaceBack(h[1].x,h[1].y,l.W,0),this._boundsArray.emplaceBack(h[3].x,h[3].y,0,l.W),this._boundsArray.emplaceBack(h[2].x,h[2].y,l.W,l.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const i=this.map.painter.context,o=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,Be.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Pt(i,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let h=!1;for(const f in this.tiles){const _=this.tiles[f];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,h=!0)}h&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(i){return l._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={}):i.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class it extends nt{constructor(i,o,h,f){super(i,o,h,f),this.roundZoom=!0,this.type="video",this.options=o}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1;const i=this.options;this.urls=[];for(const o of i.urls)this.urls.push(this.map._requestManager.transformRequest(o,"Source").url);try{const o=yield l.a2(this.urls);if(this._loaded=!0,!o)return;this.video=o,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(o){this.fire(new l.j(o))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(i){if(this.video){const o=this.video.seekable;i<o.start(0)||i>o.end(0)?this.fire(new l.j(new l.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=i}}getVideo(){return this.video}onAdd(i){this.map||(this.map=i,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const i=this.map.painter.context,o=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,Be.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new Pt(i,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let h=!1;for(const f in this.tiles){const _=this.tiles[f];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,h=!0)}h&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class At extends nt{constructor(i,o,h,f){super(i,o,h,f),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(M=>typeof M!="number"))||this.fire(new l.j(new l.a1(`sources.${i}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.j(new l.a1(`sources.${i}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new l.j(new l.a1(`sources.${i}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new l.j(new l.a1(`sources.${i}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.j(new l.a1(`sources.${i}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){return l._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(i){this.map=i,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let i=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,i=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,i=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context,h=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Be.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture?(i||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Pt(o,this.canvas,h.RGBA,{premultiply:!0});let f=!1;for(const _ in this.tiles){const M=this.tiles[_];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture,f=!0)}f&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const i of[this.canvas.width,this.canvas.height])if(isNaN(i)||i<=0)return!0;return!1}}const Gt={},jt=g=>{switch(g){case"geojson":return Ct;case"image":return nt;case"raster":return le;case"raster-dem":return ft;case"vector":return Oe;case"video":return it;case"canvas":return At}return Gt[g]},Wt="RTLPluginLoaded";class mi extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=ht()}_syncState(i){return this.status=i,this.dispatcher.broadcast("SRPS",{pluginStatus:i,pluginURL:this.url}).catch(o=>{throw this.status="error",o})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(i){return l._(this,arguments,void 0,function*(o,h=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=k.resolveURL(o),!this.url)throw new Error(`requested url ${o} is invalid`);if(this.status==="unavailable"){if(!h)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return l._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.k(Wt))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Si=null;function Ue(){return Si||(Si=new mi),Si}class Oi{constructor(i,o){this.timeAdded=0,this.fadeEndTime=0,this.tileID=i,this.uid=l.a3(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(i){const o=i+this.timeAdded;o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(i){this.demTexture&&i.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(i,o,h){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(f,_){const M={};if(!_)return M;for(const S of f){const I=S.layerIds.map(D=>_.getLayer(D)).filter(Boolean);if(I.length!==0){S.layers=I,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(D=>I.filter(F=>F.id===D)[0]));for(const D of I)M[D.id]=S}}return M}(i.buckets,o.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const _=this.buckets[f];if(_ instanceof l.a5){if(this.hasSymbolBuckets=!0,!h)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const _=this.buckets[f];if(_ instanceof l.a5&&_.hasRTLText){this.hasRTLText=!0,Ue().lazyLoad();break}}this.queryPadding=0;for(const f in this.buckets){const _=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(f).queryRadius(_))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage)}else this.collisionBoxArray=new l.a4}unloadVectorData(){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(i){return this.buckets[i.id]}upload(i){for(const h in this.buckets){const f=this.buckets[h];f.uploadPending()&&f.upload(i)}const o=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Pt(i,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Pt(i,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,o,h,f,_,M,S,I,D,F){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:f,cameraQueryGeometry:_,scale:M,tileSize:this.tileSize,pixelPosMatrix:F,transform:I,params:S,queryPadding:this.queryPadding*D},i,o,h):{}}querySourceFeatures(i,o){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const f=h.loadVTLayers(),_=o&&o.sourceLayer?o.sourceLayer:"",M=f._geojsonTileLayer||f[_];if(!M)return;const S=l.a6(o&&o.filter),{z:I,x:D,y:F}=this.tileID.canonical,B={z:I,x:D,y:F};for(let q=0;q<M.length;q++){const te=M.feature(q);if(S.needGeometry){const W=l.a7(te,!0);if(!S.filter(new l.a8(this.tileID.overscaledZ),W,this.tileID.canonical))continue}else if(!S.filter(new l.a8(this.tileID.overscaledZ),te))continue;const Q=h.getId(te,_),re=new l.a9(te,I,D,F,Q);re.tile=B,i.push(re)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const o=this.expirationTime;if(i.cacheControl){const h=l.aa(i.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const h=Date.now();let f=!1;if(this.expirationTime>h)f=!1;else if(o)if(this.expirationTime<o)f=!0;else{const _=this.expirationTime-o;_?this.expirationTime=h+Math.max(_,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(i,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(i).length===0)return;const h=this.latestFeatureIndex.loadVTLayers();for(const f in this.buckets){if(!o.style.hasLayer(f))continue;const _=this.buckets[f],M=_.layers[0].sourceLayer||"_geojsonTileLayer",S=h[M],I=i[M];if(!S||!I||Object.keys(I).length===0)continue;_.update(I,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});const D=o&&o.style&&o.style.getLayer(f);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<k.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=k.now()+i}setDependencies(i,o){const h={};for(const f of o)h[f]=!0;this.dependencies[i]=h}hasDependency(i,o){for(const h of i){const f=this.dependencies[h];if(f){for(const _ of o)if(f[_])return!0}}return!1}}class Zi{constructor(i,o){this.max=i,this.onRemove=o,this.reset()}reset(){for(const i in this.data)for(const o of this.data[i])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(i,o,h){const f=i.wrapped().key;this.data[f]===void 0&&(this.data[f]=[]);const _={value:o,timeout:void 0};if(h!==void 0&&(_.timeout=setTimeout(()=>{this.remove(i,_)},h)),this.data[f].push(_),this.order.push(f),this.order.length>this.max){const M=this._getAndRemoveByKey(this.order[0]);M&&this.onRemove(M)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const o=this.data[i].shift();return o.timeout&&clearTimeout(o.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),o.value}getByKey(i){const o=this.data[i];return o?o[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,o){if(!this.has(i))return this;const h=i.wrapped().key,f=o===void 0?0:this.data[h].indexOf(o),_=this.data[h][f];return this.data[h].splice(f,1),_.timeout&&clearTimeout(_.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(_.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(i){const o=[];for(const h in this.data)for(const f of this.data[h])i(f.value)||o.push(f);for(const h of o)this.remove(h.value.tileID,h)}}class pn{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,o,h){const f=String(o);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][f]=this.stateChanges[i][f]||{},l.e(this.stateChanges[i][f],h),this.deletedStates[i]===null){this.deletedStates[i]={};for(const _ in this.state[i])_!==f&&(this.deletedStates[i][_]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][f]===null){this.deletedStates[i][f]={};for(const _ in this.state[i][f])h[_]||(this.deletedStates[i][f][_]=null)}else for(const _ in h)this.deletedStates[i]&&this.deletedStates[i][f]&&this.deletedStates[i][f][_]===null&&delete this.deletedStates[i][f][_]}removeFeatureState(i,o,h){if(this.deletedStates[i]===null)return;const f=String(o);if(this.deletedStates[i]=this.deletedStates[i]||{},h&&o!==void 0)this.deletedStates[i][f]!==null&&(this.deletedStates[i][f]=this.deletedStates[i][f]||{},this.deletedStates[i][f][h]=null);else if(o!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][f])for(h in this.deletedStates[i][f]={},this.stateChanges[i][f])this.deletedStates[i][f][h]=null;else this.deletedStates[i][f]=null;else this.deletedStates[i]=null}getState(i,o){const h=String(o),f=l.e({},(this.state[i]||{})[h],(this.stateChanges[i]||{})[h]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){const _=this.deletedStates[i][o];if(_===null)return{};for(const M in _)delete f[M]}return f}initializeTileState(i,o){i.setFeatureState(this.state,o)}coalesceChanges(i,o){const h={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const _={};for(const M in this.stateChanges[f])this.state[f][M]||(this.state[f][M]={}),l.e(this.state[f][M],this.stateChanges[f][M]),_[M]=this.state[f][M];h[f]=_}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const _={};if(this.deletedStates[f]===null)for(const M in this.state[f])_[M]={},this.state[f][M]={};else for(const M in this.deletedStates[f]){if(this.deletedStates[f][M]===null)this.state[f][M]={};else for(const S of Object.keys(this.deletedStates[f][M]))delete this.state[f][M][S];_[M]=this.state[f][M]}h[f]=h[f]||{},l.e(h[f],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(const f in i)i[f].setFeatureState(h,o)}}class wr extends l.E{constructor(i,o,h){super(),this.id=i,this.dispatcher=h,this.on("data",f=>this._dataHandler(f)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((f,_,M,S)=>{const I=new(jt(_.type))(f,_,M,S);if(I.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${I.id}`);return I})(i,o,h,this),this._tiles={},this._cache=new Zi(0,f=>this._unloadTile(f)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new pn,this._didEmitContent=!1,this._updated=!1}onAdd(i){this.map=i,this._maxTileCacheSize=i?i._maxTileCacheSize:null,this._maxTileCacheZoomLevels=i?i._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(i)}onRemove(i){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(i)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const i in this._tiles){const o=this._tiles[i];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(i,o,h){return l._(this,void 0,void 0,function*(){try{yield this._source.loadTile(i),this._tileLoaded(i,o,h)}catch(f){i.state="errored",f.status!==404?this._source.fire(new l.j(f,{tile:i})):this.update(this.transform,this.terrain)}})}_unloadTile(i){this._source.unloadTile&&this._source.unloadTile(i)}_abortTile(i){this._source.abortTile&&this._source.abortTile(i),this._source.fire(new l.k("dataabort",{tile:i,coord:i.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const h=this._tiles[o];h.upload(i),h.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(i=>i.tileID).sort(st).map(i=>i.key)}getRenderableIds(i){const o=[];for(const h in this._tiles)this._isIdRenderable(h,i)&&o.push(this._tiles[h]);return i?o.sort((h,f)=>{const _=h.tileID,M=f.tileID,S=new l.P(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),I=new l.P(M.canonical.x,M.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-M.overscaledZ||I.y-S.y||I.x-S.x}).map(h=>h.tileID.key):o.map(h=>h.tileID).sort(st).map(h=>h.key)}hasRenderableParent(i){const o=this.findLoadedParent(i,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(i,o){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(o||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(i,"reloading")}}_reloadTile(i,o){return l._(this,void 0,void 0,function*(){const h=this._tiles[i];h&&(h.state!=="loading"&&(h.state=o),yield this._loadTile(h,i,o))})}_tileLoaded(i,o,h){i.timeAdded=k.now(),h==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(o,i),this.getSource().type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),i.aborted||this._source.fire(new l.k("data",{dataType:"source",tile:i,coord:i.tileID}))}_backfillDEM(i){const o=this.getRenderableIds();for(let f=0;f<o.length;f++){const _=o[f];if(i.neighboringTiles&&i.neighboringTiles[_]){const M=this.getTileByID(_);h(i,M),h(M,i)}}function h(f,_){f.needsHillshadePrepare=!0,f.needsTerrainPrepare=!0;let M=_.tileID.canonical.x-f.tileID.canonical.x;const S=_.tileID.canonical.y-f.tileID.canonical.y,I=Math.pow(2,f.tileID.canonical.z),D=_.tileID.key;M===0&&S===0||Math.abs(S)>1||(Math.abs(M)>1&&(Math.abs(M+I)===1?M+=I:Math.abs(M-I)===1&&(M-=I)),_.dem&&f.dem&&(f.dem.backfillBorder(_.dem,M,S),f.neighboringTiles&&f.neighboringTiles[D]&&(f.neighboringTiles[D].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,o,h,f){for(const _ in this._tiles){let M=this._tiles[_];if(f[_]||!M.hasData()||M.tileID.overscaledZ<=o||M.tileID.overscaledZ>h)continue;let S=M.tileID;for(;M&&M.tileID.overscaledZ>o+1;){const D=M.tileID.scaledTo(M.tileID.overscaledZ-1);M=this._tiles[D.key],M&&M.hasData()&&(S=D)}let I=S;for(;I.overscaledZ>o;)if(I=I.scaledTo(I.overscaledZ-1),i[I.key]){f[S.key]=S;break}}}findLoadedParent(i,o){if(i.key in this._loadedParentTiles){const h=this._loadedParentTiles[i.key];return h&&h.tileID.overscaledZ>=o?h:null}for(let h=i.overscaledZ-1;h>=o;h--){const f=i.scaledTo(h),_=this._getLoadedTile(f);if(_)return _}}_getLoadedTile(i){const o=this._tiles[i.key];return o&&o.hasData()?o:this._cache.getByKey(i.wrapped().key)}updateCacheSize(i){const o=Math.ceil(i.width/this._source.tileSize)+1,h=Math.ceil(i.height/this._source.tileSize)+1,f=Math.floor(o*h*(this._maxTileCacheZoomLevels===null?l.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,f):f;this._cache.setMaxSize(_)}handleWrapJump(i){const o=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,o){const h={};for(const f in this._tiles){const _=this._tiles[f];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+o),h[_.tileID.key]=_}this._tiles=h;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(f,this._tiles[f])}}update(i,o){if(!this._sourceLoaded||this._paused)return;let h;this.transform=i,this.terrain=o,this.updateCacheSize(i),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(F=>new l.Q(F.canonical.z,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y)):(h=i.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:o}),this._source.hasTile&&(h=h.filter(F=>this._source.hasTile(F)))):h=[];const f=i.coveringZoomLevel(this._source),_=Math.max(f-wr.maxOverzooming,this._source.minzoom),M=Math.max(f+wr.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const F={};for(const B of h)if(B.canonical.z>this._source.minzoom){const q=B.scaledTo(B.canonical.z-1);F[q.key]=q;const te=B.scaledTo(Math.max(this._source.minzoom,Math.min(B.canonical.z,5)));F[te.key]=te}h=h.concat(Object.values(F))}const S=h.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,S&&this.fire(new l.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const I=this._updateRetainedTiles(h,f);if(li(this._source.type)){const F={},B={},q=Object.keys(I),te=k.now();for(const Q of q){const re=I[Q],W=this._tiles[Q];if(!W||W.fadeEndTime!==0&&W.fadeEndTime<=te)continue;const pe=this.findLoadedParent(re,_);pe&&(this._addTile(pe.tileID),F[pe.tileID.key]=pe.tileID),B[Q]=re}this._retainLoadedChildren(B,f,M,I);for(const Q in F)I[Q]||(this._coveredTiles[Q]=!0,I[Q]=F[Q]);if(o){const Q={},re={};for(const W of h)this._tiles[W.key].hasData()?Q[W.key]=W:re[W.key]=W;for(const W in re){const pe=re[W].children(this._source.maxzoom);this._tiles[pe[0].key]&&this._tiles[pe[1].key]&&this._tiles[pe[2].key]&&this._tiles[pe[3].key]&&(Q[pe[0].key]=I[pe[0].key]=pe[0],Q[pe[1].key]=I[pe[1].key]=pe[1],Q[pe[2].key]=I[pe[2].key]=pe[2],Q[pe[3].key]=I[pe[3].key]=pe[3],delete re[W])}for(const W in re){const pe=this.findLoadedParent(re[W],this._source.minzoom);if(pe){Q[pe.tileID.key]=I[pe.tileID.key]=pe.tileID;for(const Ce in Q)Q[Ce].isChildOf(pe.tileID)&&delete Q[Ce]}}for(const W in this._tiles)Q[W]||(this._coveredTiles[W]=!0)}}for(const F in I)this._tiles[F].clearFadeHold();const D=l.ab(this._tiles,I);for(const F of D){const B=this._tiles[F];B.hasSymbolBuckets&&!B.holdingForFade()?B.setHoldDuration(this.map._fadeDuration):B.hasSymbolBuckets&&!B.symbolFadeFinished()||this._removeTile(F)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(i)}_updateRetainedTiles(i,o){const h={},f={},_=Math.max(o-wr.maxOverzooming,this._source.minzoom),M=Math.max(o+wr.maxUnderzooming,this._source.minzoom),S={};for(const I of i){const D=this._addTile(I);h[I.key]=I,D.hasData()||o<this._source.maxzoom&&(S[I.key]=I)}this._retainLoadedChildren(S,o,M,h);for(const I of i){let D=this._tiles[I.key];if(D.hasData())continue;if(o+1>this._source.maxzoom){const B=I.children(this._source.maxzoom)[0],q=this.getTile(B);if(q&&q.hasData()){h[B.key]=B;continue}}else{const B=I.children(this._source.maxzoom);if(h[B[0].key]&&h[B[1].key]&&h[B[2].key]&&h[B[3].key])continue}let F=D.wasRequested();for(let B=I.overscaledZ-1;B>=_;--B){const q=I.scaledTo(B);if(f[q.key])break;if(f[q.key]=!0,D=this.getTile(q),!D&&F&&(D=this._addTile(q)),D){const te=D.hasData();if((F||te)&&(h[q.key]=q),F=D.wasRequested(),te)break}}}return h}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const o=[];let h,f=this._tiles[i].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){h=this._loadedParentTiles[f.key];break}o.push(f.key);const _=f.scaledTo(f.overscaledZ-1);if(h=this._getLoadedTile(_),h)break;f=_}for(const _ of o)this._loadedParentTiles[_]=h}}_addTile(i){let o=this._tiles[i.key];if(o)return o;o=this._cache.getAndRemove(i),o&&(this._setTileReloadTimer(i.key,o),o.tileID=i,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,o)));const h=o;return o||(o=new Oi(i,this._source.tileSize*i.overscaleFactor()),this._loadTile(o,i.key,o.state)),o.uses++,this._tiles[i.key]=o,h||this._source.fire(new l.k("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o}_setTileReloadTimer(i,o){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const h=o.getExpiryTimeout();h&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},h))}_removeTile(i){const o=this._tiles[i];o&&(o.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),o.uses>0||(o.hasData()&&o.state!=="reloading"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}_dataHandler(i){const o=i.sourceDataType;i.dataType==="source"&&o==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&i.dataType==="source"&&o==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(i);this._cache.reset()}tilesIn(i,o,h){const f=[],_=this.transform;if(!_)return f;const M=h?_.getCameraQueryGeometry(i):i,S=i.map(Q=>_.pointCoordinate(Q,this.terrain)),I=M.map(Q=>_.pointCoordinate(Q,this.terrain)),D=this.getIds();let F=1/0,B=1/0,q=-1/0,te=-1/0;for(const Q of I)F=Math.min(F,Q.x),B=Math.min(B,Q.y),q=Math.max(q,Q.x),te=Math.max(te,Q.y);for(let Q=0;Q<D.length;Q++){const re=this._tiles[D[Q]];if(re.holdingForFade())continue;const W=re.tileID,pe=Math.pow(2,_.zoom-re.tileID.overscaledZ),Ce=o*re.queryPadding*l.W/re.tileSize/pe,oe=[W.getTilePoint(new l.Y(F,B)),W.getTilePoint(new l.Y(q,te))];if(oe[0].x-Ce<l.W&&oe[0].y-Ce<l.W&&oe[1].x+Ce>=0&&oe[1].y+Ce>=0){const be=S.map(ke=>W.getTilePoint(ke)),Ae=I.map(ke=>W.getTilePoint(ke));f.push({tile:re,tileID:W,queryGeometry:be,cameraQueryGeometry:Ae,scale:pe})}}return f}getVisibleCoordinates(i){const o=this.getRenderableIds(i).map(h=>this._tiles[h].tileID);for(const h of o)h.posMatrix=this.transform.calculatePosMatrix(h.toUnwrapped());return o}hasTransition(){if(this._source.hasTransition())return!0;if(li(this._source.type)){const i=k.now();for(const o in this._tiles)if(this._tiles[o].fadeEndTime>=i)return!0}return!1}setFeatureState(i,o,h){this._state.updateState(i=i||"_geojsonTileLayer",o,h)}removeFeatureState(i,o,h){this._state.removeFeatureState(i=i||"_geojsonTileLayer",o,h)}getFeatureState(i,o){return this._state.getState(i=i||"_geojsonTileLayer",o)}setDependencies(i,o,h){const f=this._tiles[i];f&&f.setDependencies(o,h)}reloadTilesForDependencies(i,o){for(const h in this._tiles)this._tiles[h].hasDependency(i,o)&&this._reloadTile(h,"reloading");this._cache.filter(h=>!h.hasDependency(i,o))}}function st(g,i){const o=Math.abs(2*g.wrap)-+(g.wrap<0),h=Math.abs(2*i.wrap)-+(i.wrap<0);return g.overscaledZ-i.overscaledZ||h-o||i.canonical.y-g.canonical.y||i.canonical.x-g.canonical.x}function li(g){return g==="raster"||g==="image"||g==="video"}wr.maxOverzooming=10,wr.maxUnderzooming=3;class Ft{constructor(i,o){this.reset(i,o)}reset(i,o){this.points=i||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=l.ac(i,0,1);let o=1,h=this._distances[o];const f=i*this.paddedLength+this.padding;for(;h<f&&o<this._distances.length;)h=this._distances[++o];const _=o-1,M=this._distances[_],S=h-M,I=S>0?(f-M)/S:0;return this.points[_].mult(1-I).add(this.points[o].mult(I))}}function $i(g,i){let o=!0;return g==="always"||g!=="never"&&i!=="never"||(o=!1),o}class mn{constructor(i,o,h){const f=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(i/h),this.yCellCount=Math.ceil(o/h);for(let M=0;M<this.xCellCount*this.yCellCount;M++)f.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=o,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,o,h,f,_){this._forEachCell(o,h,f,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(f),this.bboxes.push(_)}insertCircle(i,o,h,f){this._forEachCell(o-f,h-f,o+f,h+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(o),this.circles.push(h),this.circles.push(f)}_insertBoxCell(i,o,h,f,_,M){this.boxCells[_].push(M)}_insertCircleCell(i,o,h,f,_,M){this.circleCells[_].push(M)}_query(i,o,h,f,_,M,S){if(h<0||i>this.width||f<0||o>this.height)return[];const I=[];if(i<=0&&o<=0&&this.width<=h&&this.height<=f){if(_)return[{key:null,x1:i,y1:o,x2:h,y2:f}];for(let D=0;D<this.boxKeys.length;D++)I.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){const F=this.circles[3*D],B=this.circles[3*D+1],q=this.circles[3*D+2];I.push({key:this.circleKeys[D],x1:F-q,y1:B-q,x2:F+q,y2:B+q})}}else this._forEachCell(i,o,h,f,this._queryCell,I,{hitTest:_,overlapMode:M,seenUids:{box:{},circle:{}}},S);return I}query(i,o,h,f){return this._query(i,o,h,f,!1,null)}hitTest(i,o,h,f,_,M){return this._query(i,o,h,f,!0,_,M).length>0}hitTestCircle(i,o,h,f,_){const M=i-h,S=i+h,I=o-h,D=o+h;if(S<0||M>this.width||D<0||I>this.height)return!1;const F=[];return this._forEachCell(M,I,S,D,this._queryCellCircle,F,{hitTest:!0,overlapMode:f,circle:{x:i,y:o,radius:h},seenUids:{box:{},circle:{}}},_),F.length>0}_queryCell(i,o,h,f,_,M,S,I){const{seenUids:D,hitTest:F,overlapMode:B}=S,q=this.boxCells[_];if(q!==null){const Q=this.bboxes;for(const re of q)if(!D.box[re]){D.box[re]=!0;const W=4*re,pe=this.boxKeys[re];if(i<=Q[W+2]&&o<=Q[W+3]&&h>=Q[W+0]&&f>=Q[W+1]&&(!I||I(pe))&&(!F||!$i(B,pe.overlapMode))&&(M.push({key:pe,x1:Q[W],y1:Q[W+1],x2:Q[W+2],y2:Q[W+3]}),F))return!0}}const te=this.circleCells[_];if(te!==null){const Q=this.circles;for(const re of te)if(!D.circle[re]){D.circle[re]=!0;const W=3*re,pe=this.circleKeys[re];if(this._circleAndRectCollide(Q[W],Q[W+1],Q[W+2],i,o,h,f)&&(!I||I(pe))&&(!F||!$i(B,pe.overlapMode))){const Ce=Q[W],oe=Q[W+1],be=Q[W+2];if(M.push({key:pe,x1:Ce-be,y1:oe-be,x2:Ce+be,y2:oe+be}),F)return!0}}}return!1}_queryCellCircle(i,o,h,f,_,M,S,I){const{circle:D,seenUids:F,overlapMode:B}=S,q=this.boxCells[_];if(q!==null){const Q=this.bboxes;for(const re of q)if(!F.box[re]){F.box[re]=!0;const W=4*re,pe=this.boxKeys[re];if(this._circleAndRectCollide(D.x,D.y,D.radius,Q[W+0],Q[W+1],Q[W+2],Q[W+3])&&(!I||I(pe))&&!$i(B,pe.overlapMode))return M.push(!0),!0}}const te=this.circleCells[_];if(te!==null){const Q=this.circles;for(const re of te)if(!F.circle[re]){F.circle[re]=!0;const W=3*re,pe=this.circleKeys[re];if(this._circlesCollide(Q[W],Q[W+1],Q[W+2],D.x,D.y,D.radius)&&(!I||I(pe))&&!$i(B,pe.overlapMode))return M.push(!0),!0}}}_forEachCell(i,o,h,f,_,M,S,I){const D=this._convertToXCellCoord(i),F=this._convertToYCellCoord(o),B=this._convertToXCellCoord(h),q=this._convertToYCellCoord(f);for(let te=D;te<=B;te++)for(let Q=F;Q<=q;Q++)if(_.call(this,i,o,h,f,this.xCellCount*Q+te,M,S,I))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,o,h,f,_,M){const S=f-i,I=_-o,D=h+M;return D*D>S*S+I*I}_circleAndRectCollide(i,o,h,f,_,M,S){const I=(M-f)/2,D=Math.abs(i-(f+I));if(D>I+h)return!1;const F=(S-_)/2,B=Math.abs(o-(_+F));if(B>F+h)return!1;if(D<=I||B<=F)return!0;const q=D-I,te=B-F;return q*q+te*te<=h*h}}function ei(g,i,o,h,f){const _=l.F();return i?(l.J(_,_,[1/f,1/f,1]),o||l.ad(_,_,h.angle)):l.K(_,h.labelPlaneMatrix,g),_}function Js(g,i,o,h,f){if(i){const _=l.ae(g);return l.J(_,_,[f,f,1]),o||l.ad(_,_,-h.angle),_}return h.glCoordMatrix}function Mr(g,i,o){let h;o?(h=[g.x,g.y,o(g.x,g.y),1],l.af(h,h,i)):(h=[g.x,g.y,0,1],Bt(h,h,i));const f=h[3];return{point:new l.P(h[0]/f,h[1]/f),signedDistanceFromCamera:f}}function ee(g,i){return .5+g/i*.5}function N(g,i){const o=g[0]/g[3],h=g[1]/g[3];return o>=-i[0]&&o<=i[0]&&h>=-i[1]&&h<=i[1]}function U(g,i,o,h,f,_,M,S,I,D){const F=h?g.textSizeData:g.iconSizeData,B=l.ag(F,o.transform.zoom),q=[256/o.width*2+1,256/o.height*2+1],te=h?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;te.clear();const Q=g.lineVertexArray,re=h?g.text.placedSymbolArray:g.icon.placedSymbolArray,W=o.transform.width/o.transform.height;let pe=!1;for(let Ce=0;Ce<re.length;Ce++){const oe=re.get(Ce);if(oe.hidden||oe.writingMode===l.ah.vertical&&!pe){Ne(oe.numGlyphs,te);continue}let be;if(pe=!1,D?(be=[oe.anchorX,oe.anchorY,D(oe.anchorX,oe.anchorY),1],l.af(be,be,i)):(be=[oe.anchorX,oe.anchorY,0,1],Bt(be,be,i)),!N(be,q)){Ne(oe.numGlyphs,te);continue}const Ae=ee(o.transform.cameraToCenterDistance,be[3]),ke=l.ai(F,B,oe),ze=M?ke/Ae:ke*Ae,Xe=new l.P(oe.anchorX,oe.anchorY),Ze=Mr(Xe,f,D).point,at={projections:{},offsets:{}},dt=_e(oe,ze,!1,S,i,f,_,g.glyphOffsetArray,Q,te,Ze,Xe,at,W,I,D);pe=dt.useVertical,(dt.notEnoughRoom||pe||dt.needsFlipping&&_e(oe,ze,!0,S,i,f,_,g.glyphOffsetArray,Q,te,Ze,Xe,at,W,I,D).notEnoughRoom)&&Ne(oe.numGlyphs,te)}h?g.text.dynamicLayoutVertexBuffer.updateData(te):g.icon.dynamicLayoutVertexBuffer.updateData(te)}function H(g,i,o,h,f,_,M,S,I,D,F,B,q){const te=S.glyphStartIndex+S.numGlyphs,Q=S.lineStartIndex,re=S.lineStartIndex+S.lineLength,W=i.getoffsetX(S.glyphStartIndex),pe=i.getoffsetX(te-1),Ce=qe(g*W,o,h,f,_,M,S.segment,Q,re,I,D,F,B,q);if(!Ce)return null;const oe=qe(g*pe,o,h,f,_,M,S.segment,Q,re,I,D,F,B,q);return oe?{first:Ce,last:oe}:null}function J(g,i,o,h){return g===l.ah.horizontal&&Math.abs(o.y-i.y)>Math.abs(o.x-i.x)*h?{useVertical:!0}:(g===l.ah.vertical?i.y<o.y:i.x>o.x)?{needsFlipping:!0}:null}function _e(g,i,o,h,f,_,M,S,I,D,F,B,q,te,Q,re){const W=i/24,pe=g.lineOffsetX*W,Ce=g.lineOffsetY*W;let oe;if(g.numGlyphs>1){const be=g.glyphStartIndex+g.numGlyphs,Ae=g.lineStartIndex,ke=g.lineStartIndex+g.lineLength,ze=H(W,S,pe,Ce,o,F,B,g,I,_,q,Q,re);if(!ze)return{notEnoughRoom:!0};const Xe=Mr(ze.first.point,M,re).point,Ze=Mr(ze.last.point,M,re).point;if(h&&!o){const at=J(g.writingMode,Xe,Ze,te);if(at)return at}oe=[ze.first];for(let at=g.glyphStartIndex+1;at<be-1;at++)oe.push(qe(W*S.getoffsetX(at),pe,Ce,o,F,B,g.segment,Ae,ke,I,_,q,Q,re));oe.push(ze.last)}else{if(h&&!o){const Ae=Mr(B,f,re).point,ke=g.lineStartIndex+g.segment+1,ze=new l.P(I.getx(ke),I.gety(ke)),Xe=Mr(ze,f,re),Ze=Xe.signedDistanceFromCamera>0?Xe.point:ve(B,ze,Ae,1,f,re),at=J(g.writingMode,Ae,Ze,te);if(at)return at}const be=qe(W*S.getoffsetX(g.glyphStartIndex),pe,Ce,o,F,B,g.segment,g.lineStartIndex,g.lineStartIndex+g.lineLength,I,_,q,Q,re);if(!be)return{notEnoughRoom:!0};oe=[be]}for(const be of oe)l.aj(D,be.point,be.angle);return{}}function ve(g,i,o,h,f,_){const M=Mr(g.add(g.sub(i)._unit()),f,_).point,S=o.sub(M);return o.add(S._mult(h/S.mag()))}function we(g,i){const{projectionCache:o,lineVertexArray:h,labelPlaneMatrix:f,tileAnchorPoint:_,distanceFromAnchor:M,getElevation:S,previousVertex:I,direction:D,absOffsetX:F}=i;if(o.projections[g])return o.projections[g];const B=new l.P(h.getx(g),h.gety(g)),q=Mr(B,f,S);if(q.signedDistanceFromCamera>0)return o.projections[g]=q.point,q.point;const te=g-D;return ve(M===0?_:new l.P(h.getx(te),h.gety(te)),B,I,F-M+1,f,S)}function de(g,i,o){return g._unit()._perp()._mult(i*o)}function Ie(g,i,o,h,f,_,M,S){const{projectionCache:I,direction:D}=S;if(I.offsets[g])return I.offsets[g];const F=o.add(i);if(g+D<h||g+D>=f)return I.offsets[g]=F,F;const B=we(g+D,S),q=de(B.sub(o),M,D),te=o.add(q),Q=B.add(q);return I.offsets[g]=l.ak(_,F,te,Q)||F,I.offsets[g]}function qe(g,i,o,h,f,_,M,S,I,D,F,B,q,te){const Q=h?g-i:g+i;let re=Q>0?1:-1,W=0;h&&(re*=-1,W=Math.PI),re<0&&(W+=Math.PI);let pe,Ce,oe=re>0?S+M:S+M+1,be=f,Ae=f,ke=0,ze=0;const Xe=Math.abs(Q),Ze=[];let at;for(;ke+ze<=Xe;){if(oe+=re,oe<S||oe>=I)return null;ke+=ze,Ae=be,Ce=pe;const yt={projectionCache:B,lineVertexArray:D,labelPlaneMatrix:F,tileAnchorPoint:_,distanceFromAnchor:ke,getElevation:te,previousVertex:Ae,direction:re,absOffsetX:Xe};if(be=we(oe,yt),o===0)Ze.push(Ae),at=be.sub(Ae);else{let Jt;const hi=be.sub(Ae);Jt=hi.mag()===0?de(we(oe+re,yt).sub(be),o,re):de(hi,o,re),Ce||(Ce=Ae.add(Jt)),pe=Ie(oe,Jt,be,S,I,Ce,o,yt),Ze.push(Ce),at=pe.sub(Ce)}ze=at.mag()}const dt=at._mult((Xe-ke)/ze)._add(Ce||Ae),ui=W+Math.atan2(be.y-Ae.y,be.x-Ae.x);return Ze.push(dt),{point:dt,angle:q?ui:0,path:Ze}}const Re=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ne(g,i){for(let o=0;o<g;o++){const h=i.length;i.resize(h+4),i.float32.set(Re,3*h)}}function Bt(g,i,o){const h=i[0],f=i[1];return g[0]=o[0]*h+o[4]*f+o[12],g[1]=o[1]*h+o[5]*f+o[13],g[3]=o[3]*h+o[7]*f+o[15],g}const Vt=100;class ti{constructor(i,o=new mn(i.width+200,i.height+200,25),h=new mn(i.width+200,i.height+200,25)){this.transform=i,this.grid=o,this.ignoredGrid=h,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Vt,this.screenBottomBoundary=i.height+Vt,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(i,o,h,f,_,M){const S=this.projectAndGetPerspectiveRatio(f,i.anchorPointX,i.anchorPointY,M),I=h*S.perspectiveRatio,D=i.x1*I+S.point.x,F=i.y1*I+S.point.y,B=i.x2*I+S.point.x,q=i.y2*I+S.point.y;return!this.isInsideGrid(D,F,B,q)||o!=="always"&&this.grid.hitTest(D,F,B,q,o,_)||S.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[D,F,B,q],offscreen:this.isOffscreen(D,F,B,q)}}placeCollisionCircles(i,o,h,f,_,M,S,I,D,F,B,q,te,Q){const re=[],W=new l.P(o.anchorX,o.anchorY),pe=Mr(W,M,Q),Ce=ee(this.transform.cameraToCenterDistance,pe.signedDistanceFromCamera),oe=(F?_/Ce:_*Ce)/l.ao,be=Mr(W,S,Q).point,Ae=H(oe,f,o.lineOffsetX*oe,o.lineOffsetY*oe,!1,be,W,o,h,S,{projections:{},offsets:{}},!1,Q);let ke=!1,ze=!1,Xe=!0;if(Ae){const Ze=.5*q*Ce+te,at=new l.P(-100,-100),dt=new l.P(this.screenRightBoundary,this.screenBottomBoundary),ui=new Ft,yt=Ae.first,Jt=Ae.last;let hi=[];for(let fi=yt.path.length-1;fi>=1;fi--)hi.push(yt.path[fi]);for(let fi=1;fi<Jt.path.length;fi++)hi.push(Jt.path[fi]);const Di=2.5*Ze;if(I){const fi=hi.map(xi=>Mr(xi,I,Q));hi=fi.some(xi=>xi.signedDistanceFromCamera<=0)?[]:fi.map(xi=>xi.point)}let ni=[];if(hi.length>0){const fi=hi[0].clone(),xi=hi[0].clone();for(let zr=1;zr<hi.length;zr++)fi.x=Math.min(fi.x,hi[zr].x),fi.y=Math.min(fi.y,hi[zr].y),xi.x=Math.max(xi.x,hi[zr].x),xi.y=Math.max(xi.y,hi[zr].y);ni=fi.x>=at.x&&xi.x<=dt.x&&fi.y>=at.y&&xi.y<=dt.y?[hi]:xi.x<at.x||fi.x>dt.x||xi.y<at.y||fi.y>dt.y?[]:l.al([hi],at.x,at.y,dt.x,dt.y)}for(const fi of ni){ui.reset(fi,.25*Ze);let xi=0;xi=ui.length<=.5*Ze?1:Math.ceil(ui.paddedLength/Di)+1;for(let zr=0;zr<xi;zr++){const Xi=zr/Math.max(xi-1,1),as=ui.lerp(Xi),rn=as.x+Vt,Tr=as.y+Vt;re.push(rn,Tr,Ze,0);const nn=rn-Ze,os=Tr-Ze,sa=rn+Ze,Ha=Tr+Ze;if(Xe=Xe&&this.isOffscreen(nn,os,sa,Ha),ze=ze||this.isInsideGrid(nn,os,sa,Ha),i!=="always"&&this.grid.hitTestCircle(rn,Tr,Ze,i,B)&&(ke=!0,!D))return{circles:[],offscreen:!1,collisionDetected:ke}}}}return{circles:!D&&ke||!ze||Ce<this.perspectiveRatioCutoff?[]:re,offscreen:Xe,collisionDetected:ke}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let h=1/0,f=1/0,_=-1/0,M=-1/0;for(const F of i){const B=new l.P(F.x+Vt,F.y+Vt);h=Math.min(h,B.x),f=Math.min(f,B.y),_=Math.max(_,B.x),M=Math.max(M,B.y),o.push(B)}const S=this.grid.query(h,f,_,M).concat(this.ignoredGrid.query(h,f,_,M)),I={},D={};for(const F of S){const B=F.key;if(I[B.bucketInstanceId]===void 0&&(I[B.bucketInstanceId]={}),I[B.bucketInstanceId][B.featureIndex])continue;const q=[new l.P(F.x1,F.y1),new l.P(F.x2,F.y1),new l.P(F.x2,F.y2),new l.P(F.x1,F.y2)];l.am(o,q)&&(I[B.bucketInstanceId][B.featureIndex]=!0,D[B.bucketInstanceId]===void 0&&(D[B.bucketInstanceId]=[]),D[B.bucketInstanceId].push(B.featureIndex))}return D}insertCollisionBox(i,o,h,f,_,M){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:_,collisionGroupID:M,overlapMode:o},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,o,h,f,_,M){const S=h?this.ignoredGrid:this.grid,I={bucketInstanceId:f,featureIndex:_,collisionGroupID:M,overlapMode:o};for(let D=0;D<i.length;D+=4)S.insertCircle(I,i[D],i[D+1],i[D+2])}projectAndGetPerspectiveRatio(i,o,h,f){let _;return f?(_=[o,h,f(o,h),1],l.af(_,_,i)):(_=[o,h,0,1],Bt(_,_,i)),{point:new l.P((_[0]/_[3]+1)/2*this.transform.width+Vt,(-_[1]/_[3]+1)/2*this.transform.height+Vt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/_[3]*.5}}isOffscreen(i,o,h,f){return h<Vt||i>=this.screenRightBoundary||f<Vt||o>this.screenBottomBoundary}isInsideGrid(i,o,h,f){return h>=0&&i<this.gridRightBoundary&&f>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const i=l.an([]);return l.H(i,i,[-100,-100,0]),i}}function ri(g,i,o){return i*(l.W/(g.tileSize*Math.pow(2,o-g.tileID.overscaledZ)))}class _i{constructor(i,o,h,f){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?o:-o))):f&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class Bi{constructor(i,o,h,f,_){this.text=new _i(i?i.text:null,o,h,_),this.icon=new _i(i?i.icon:null,o,f,_)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class sr{constructor(i,o,h){this.text=i,this.icon=o,this.skipFade=h}}class Fr{constructor(){this.invProjMatrix=l.F(),this.viewportMatrix=l.F(),this.circles=[]}}class Zt{constructor(i,o,h,f,_){this.bucketInstanceId=i,this.featureIndex=o,this.sourceLayerIndex=h,this.bucketIndex=f,this.tileID=_}}class yr{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const o=++this.maxGroupID;this.collisionGroups[i]={ID:o,predicate:h=>h.collisionGroupID===o}}return this.collisionGroups[i]}}function Vr(g,i,o,h,f){const{horizontalAlign:_,verticalAlign:M}=l.at(g);return new l.P(-(_-.5)*i+h[0]*f,-(M-.5)*o+h[1]*f)}function gn(g,i,o,h,f,_){const{x1:M,x2:S,y1:I,y2:D,anchorPointX:F,anchorPointY:B}=g,q=new l.P(i,o);return h&&q._rotate(f?_:-_),{x1:M+q.x,y1:I+q.y,x2:S+q.x,y2:D+q.y,anchorPointX:F,anchorPointY:B}}class yn{constructor(i,o,h,f,_){this.transform=i.clone(),this.terrain=o,this.collisionIndex=new ti(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new yr(f),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,o,h,f){const _=h.getBucket(o),M=h.latestFeatureIndex;if(!_||!M||o.id!==_.layerIds[0])return;const S=h.collisionBoxArray,I=_.layers[0].layout,D=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),F=h.tileSize/l.W,B=this.transform.calculatePosMatrix(h.tileID.toUnwrapped()),q=I.get("text-pitch-alignment")==="map",te=I.get("text-rotation-alignment")==="map",Q=ri(h,1,this.transform.zoom),re=ei(B,q,te,this.transform,Q);let W=null;if(q){const Ce=Js(B,q,te,this.transform,Q);W=l.K([],this.transform.labelPlaneMatrix,Ce)}this.retainedQueryData[_.bucketInstanceId]=new Zt(_.bucketInstanceId,M,_.sourceLayerIndex,_.index,h.tileID);const pe={bucket:_,layout:I,posMatrix:B,textLabelPlaneMatrix:re,labelToScreenMatrix:W,scale:D,textPixelRatio:F,holdingForFade:h.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:l.ag(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(f)for(const Ce of _.sortKeyRanges){const{sortKey:oe,symbolInstanceStart:be,symbolInstanceEnd:Ae}=Ce;i.push({sortKey:oe,symbolInstanceStart:be,symbolInstanceEnd:Ae,parameters:pe})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:pe})}attemptAnchorPlacement(i,o,h,f,_,M,S,I,D,F,B,q,te,Q,re,W){const pe=l.ap[i.textAnchor],Ce=[i.textOffset0,i.textOffset1],oe=Vr(pe,h,f,Ce,_),be=this.collisionIndex.placeCollisionBox(gn(o,oe.x,oe.y,M,S,this.transform.angle),B,I,D,F.predicate,W);if((!re||this.collisionIndex.placeCollisionBox(gn(re,oe.x,oe.y,M,S,this.transform.angle),B,I,D,F.predicate,W).box.length!==0)&&be.box.length>0){let Ae;if(this.prevPlacement&&this.prevPlacement.variableOffsets[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID].text&&(Ae=this.prevPlacement.variableOffsets[q.crossTileID].anchor),q.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[q.crossTileID]={textOffset:Ce,width:h,height:f,anchor:pe,textBoxScale:_,prevAnchor:Ae},this.markUsedJustification(te,pe,q,Q),te.allowVerticalPlacement&&(this.markUsedOrientation(te,Q,q),this.placedOrientations[q.crossTileID]=Q),{shift:oe,placedGlyphBoxes:be}}}placeLayerBucketPart(i,o,h){const{bucket:f,layout:_,posMatrix:M,textLabelPlaneMatrix:S,labelToScreenMatrix:I,textPixelRatio:D,holdingForFade:F,collisionBoxArray:B,partiallyEvaluatedTextSize:q,collisionGroup:te}=i.parameters,Q=_.get("text-optional"),re=_.get("icon-optional"),W=l.aq(_,"text-overlap","text-allow-overlap"),pe=W==="always",Ce=l.aq(_,"icon-overlap","icon-allow-overlap"),oe=Ce==="always",be=_.get("text-rotation-alignment")==="map",Ae=_.get("text-pitch-alignment")==="map",ke=_.get("icon-text-fit")!=="none",ze=_.get("symbol-z-order")==="viewport-y",Xe=pe&&(oe||!f.hasIconData()||re),Ze=oe&&(pe||!f.hasTextData()||Q);!f.collisionArrays&&B&&f.deserializeCollisionBoxes(B);const at=this.retainedQueryData[f.bucketInstanceId].tileID,dt=this.terrain?(yt,Jt)=>this.terrain.getElevation(at,yt,Jt):null,ui=(yt,Jt)=>{var hi,Di;if(o[yt.crossTileID])return;if(F)return void(this.placements[yt.crossTileID]=new sr(!1,!1,!1));let ni=!1,fi=!1,xi=!0,zr=null,Xi={box:null,offscreen:null},as={box:null,offscreen:null},rn=null,Tr=null,nn=null,os=0,sa=0,Ha=0;Jt.textFeatureIndex?os=Jt.textFeatureIndex:yt.useRuntimeCollisionCircles&&(os=yt.featureIndex),Jt.verticalTextFeatureIndex&&(sa=Jt.verticalTextFeatureIndex);const Kl=Jt.textBox;if(Kl){const Wr=Xr=>{let Cr=l.ah.horizontal;if(f.allowVerticalPlacement&&!Xr&&this.prevPlacement){const Ss=this.prevPlacement.placedOrientations[yt.crossTileID];Ss&&(this.placedOrientations[yt.crossTileID]=Ss,Cr=Ss,this.markUsedOrientation(f,Cr,yt))}return Cr},Ir=(Xr,Cr)=>{if(f.allowVerticalPlacement&&yt.numVerticalGlyphVertices>0&&Jt.verticalTextBox){for(const Ss of f.writingModes)if(Ss===l.ah.vertical?(Xi=Cr(),as=Xi):Xi=Xr(),Xi&&Xi.box&&Xi.box.length)break}else Xi=Xr()},xr=yt.textAnchorOffsetStartIndex,Ms=yt.textAnchorOffsetEndIndex;if(Ms===xr){const Xr=(Cr,Ss)=>{const Kr=this.collisionIndex.placeCollisionBox(Cr,W,D,M,te.predicate,dt);return Kr&&Kr.box&&Kr.box.length&&(this.markUsedOrientation(f,Ss,yt),this.placedOrientations[yt.crossTileID]=Ss),Kr};Ir(()=>Xr(Kl,l.ah.horizontal),()=>{const Cr=Jt.verticalTextBox;return f.allowVerticalPlacement&&yt.numVerticalGlyphVertices>0&&Cr?Xr(Cr,l.ah.vertical):{box:null,offscreen:null}}),Wr(Xi&&Xi.box&&Xi.box.length)}else{let Xr=l.ap[(Di=(hi=this.prevPlacement)===null||hi===void 0?void 0:hi.variableOffsets[yt.crossTileID])===null||Di===void 0?void 0:Di.anchor];const Cr=(Kr,Nr,ku)=>{const sd=Kr.x2-Kr.x1,wo=Kr.y2-Kr.y1,Mo=yt.textBoxScale,kc=ke&&Ce==="never"?Nr:null;let Wa={box:[],offscreen:!1},Du=W==="never"?1:2,ad="never";Xr&&Du++;for(let Lu=0;Lu<Du;Lu++){for(let Ru=xr;Ru<Ms;Ru++){const Dc=f.textAnchorOffsets.get(Ru);if(Xr&&Dc.textAnchor!==Xr)continue;const zu=this.attemptAnchorPlacement(Dc,Kr,sd,wo,Mo,be,Ae,D,M,te,ad,yt,f,ku,kc,dt);if(zu&&(Wa=zu.placedGlyphBoxes,Wa&&Wa.box&&Wa.box.length))return ni=!0,zr=zu.shift,Wa}Xr?Xr=null:ad=W}return Wa};Ir(()=>Cr(Kl,Jt.iconBox,l.ah.horizontal),()=>{const Kr=Jt.verticalTextBox;return f.allowVerticalPlacement&&!(Xi&&Xi.box&&Xi.box.length)&&yt.numVerticalGlyphVertices>0&&Kr?Cr(Kr,Jt.verticalIconBox,l.ah.vertical):{box:null,offscreen:null}}),Xi&&(ni=Xi.box,xi=Xi.offscreen);const Ss=Wr(Xi&&Xi.box);if(!ni&&this.prevPlacement){const Kr=this.prevPlacement.variableOffsets[yt.crossTileID];Kr&&(this.variableOffsets[yt.crossTileID]=Kr,this.markUsedJustification(f,Kr.anchor,yt,Ss))}}}if(rn=Xi,ni=rn&&rn.box&&rn.box.length>0,xi=rn&&rn.offscreen,yt.useRuntimeCollisionCircles){const Wr=f.text.placedSymbolArray.get(yt.centerJustifiedTextSymbolIndex),Ir=l.ai(f.textSizeData,q,Wr),xr=_.get("text-padding");Tr=this.collisionIndex.placeCollisionCircles(W,Wr,f.lineVertexArray,f.glyphOffsetArray,Ir,M,S,I,h,Ae,te.predicate,yt.collisionCircleDiameter,xr,dt),Tr.circles.length&&Tr.collisionDetected&&!h&&l.w("Collisions detected, but collision boxes are not shown"),ni=pe||Tr.circles.length>0&&!Tr.collisionDetected,xi=xi&&Tr.offscreen}if(Jt.iconFeatureIndex&&(Ha=Jt.iconFeatureIndex),Jt.iconBox){const Wr=Ir=>{const xr=ke&&zr?gn(Ir,zr.x,zr.y,be,Ae,this.transform.angle):Ir;return this.collisionIndex.placeCollisionBox(xr,Ce,D,M,te.predicate,dt)};as&&as.box&&as.box.length&&Jt.verticalIconBox?(nn=Wr(Jt.verticalIconBox),fi=nn.box.length>0):(nn=Wr(Jt.iconBox),fi=nn.box.length>0),xi=xi&&nn.offscreen}const Za=Q||yt.numHorizontalGlyphVertices===0&&yt.numVerticalGlyphVertices===0,aa=re||yt.numIconVertices===0;if(Za||aa?aa?Za||(fi=fi&&ni):ni=fi&&ni:fi=ni=fi&&ni,ni&&rn&&rn.box&&this.collisionIndex.insertCollisionBox(rn.box,W,_.get("text-ignore-placement"),f.bucketInstanceId,as&&as.box&&sa?sa:os,te.ID),fi&&nn&&this.collisionIndex.insertCollisionBox(nn.box,Ce,_.get("icon-ignore-placement"),f.bucketInstanceId,Ha,te.ID),Tr&&(ni&&this.collisionIndex.insertCollisionCircles(Tr.circles,W,_.get("text-ignore-placement"),f.bucketInstanceId,os,te.ID),h)){const Wr=f.bucketInstanceId;let Ir=this.collisionCircleArrays[Wr];Ir===void 0&&(Ir=this.collisionCircleArrays[Wr]=new Fr);for(let xr=0;xr<Tr.circles.length;xr+=4)Ir.circles.push(Tr.circles[xr+0]),Ir.circles.push(Tr.circles[xr+1]),Ir.circles.push(Tr.circles[xr+2]),Ir.circles.push(Tr.collisionDetected?1:0)}if(yt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(f.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[yt.crossTileID]=new sr(ni||Xe,fi||Ze,xi||f.justReloaded),o[yt.crossTileID]=!0};if(ze){if(i.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const yt=f.getSortedSymbolIndexes(this.transform.angle);for(let Jt=yt.length-1;Jt>=0;--Jt){const hi=yt[Jt];ui(f.symbolInstances.get(hi),f.collisionArrays[hi])}}else for(let yt=i.symbolInstanceStart;yt<i.symbolInstanceEnd;yt++)ui(f.symbolInstances.get(yt),f.collisionArrays[yt]);if(h&&f.bucketInstanceId in this.collisionCircleArrays){const yt=this.collisionCircleArrays[f.bucketInstanceId];l.ar(yt.invProjMatrix,M),yt.viewportMatrix=this.collisionIndex.getViewportMatrix()}f.justReloaded=!1}markUsedJustification(i,o,h,f){let _;_=f===l.ah.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[l.as(o)];const M=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];for(const S of M)S>=0&&(i.text.placedSymbolArray.get(S).crossTileID=_>=0&&S!==_?0:h.crossTileID)}markUsedOrientation(i,o,h){const f=o===l.ah.horizontal||o===l.ah.horizontalOnly?o:0,_=o===l.ah.vertical?o:0,M=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];for(const S of M)i.text.placedSymbolArray.get(S).placedOrientation=f;h.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let h=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const f=o?o.symbolFadeChange(i):1,_=o?o.opacities:{},M=o?o.variableOffsets:{},S=o?o.placedOrientations:{};for(const I in this.placements){const D=this.placements[I],F=_[I];F?(this.opacities[I]=new Bi(F,f,D.text,D.icon),h=h||D.text!==F.text.placed||D.icon!==F.icon.placed):(this.opacities[I]=new Bi(null,f,D.text,D.icon,D.skipFade),h=h||D.text||D.icon)}for(const I in _){const D=_[I];if(!this.opacities[I]){const F=new Bi(D,f,!1,!1);F.isHidden()||(this.opacities[I]=F,h=h||D.text.placed||D.icon.placed)}}for(const I in M)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=M[I]);for(const I in S)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=S[I]);if(o&&o.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");h?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:i)}updateLayerOpacities(i,o){const h={};for(const f of o){const _=f.getBucket(i);_&&f.latestFeatureIndex&&i.id===_.layerIds[0]&&this.updateBucketOpacities(_,h,f.collisionBoxArray)}}updateBucketOpacities(i,o,h){i.hasTextData()&&(i.text.opacityVertexArray.clear(),i.text.hasVisibleVertices=!1),i.hasIconData()&&(i.icon.opacityVertexArray.clear(),i.icon.hasVisibleVertices=!1),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const f=i.layers[0],_=f.layout,M=new Bi(null,0,!1,!1,!0),S=_.get("text-allow-overlap"),I=_.get("icon-allow-overlap"),D=f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset"),F=_.get("text-rotation-alignment")==="map",B=_.get("text-pitch-alignment")==="map",q=_.get("icon-text-fit")!=="none",te=new Bi(null,0,S&&(I||!i.hasIconData()||_.get("icon-optional")),I&&(S||!i.hasTextData()||_.get("text-optional")),!0);!i.collisionArrays&&h&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(h);const Q=(re,W,pe)=>{for(let Ce=0;Ce<W/4;Ce++)re.opacityVertexArray.emplaceBack(pe);re.hasVisibleVertices=re.hasVisibleVertices||pe!==qn};for(let re=0;re<i.symbolInstances.length;re++){const W=i.symbolInstances.get(re),{numHorizontalGlyphVertices:pe,numVerticalGlyphVertices:Ce,crossTileID:oe}=W;let be=this.opacities[oe];o[oe]?be=M:be||(be=te,this.opacities[oe]=be),o[oe]=!0;const Ae=W.numIconVertices>0,ke=this.placedOrientations[W.crossTileID],ze=ke===l.ah.vertical,Xe=ke===l.ah.horizontal||ke===l.ah.horizontalOnly;if(pe>0||Ce>0){const Ze=_n(be.text);Q(i.text,pe,ze?qn:Ze),Q(i.text,Ce,Xe?qn:Ze);const at=be.text.isHidden();[W.rightJustifiedTextSymbolIndex,W.centerJustifiedTextSymbolIndex,W.leftJustifiedTextSymbolIndex].forEach(yt=>{yt>=0&&(i.text.placedSymbolArray.get(yt).hidden=at||ze?1:0)}),W.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(W.verticalPlacedTextSymbolIndex).hidden=at||Xe?1:0);const dt=this.variableOffsets[W.crossTileID];dt&&this.markUsedJustification(i,dt.anchor,W,ke);const ui=this.placedOrientations[W.crossTileID];ui&&(this.markUsedJustification(i,"left",W,ui),this.markUsedOrientation(i,ui,W))}if(Ae){const Ze=_n(be.icon),at=!(q&&W.verticalPlacedIconSymbolIndex&&ze);W.placedIconSymbolIndex>=0&&(Q(i.icon,W.numIconVertices,at?Ze:qn),i.icon.placedSymbolArray.get(W.placedIconSymbolIndex).hidden=be.icon.isHidden()),W.verticalPlacedIconSymbolIndex>=0&&(Q(i.icon,W.numVerticalIconVertices,at?qn:Ze),i.icon.placedSymbolArray.get(W.verticalPlacedIconSymbolIndex).hidden=be.icon.isHidden())}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Ze=i.collisionArrays[re];if(Ze){let at=new l.P(0,0);if(Ze.textBox||Ze.verticalTextBox){let ui=!0;if(D){const yt=this.variableOffsets[oe];yt?(at=Vr(yt.anchor,yt.width,yt.height,yt.textOffset,yt.textBoxScale),F&&at._rotate(B?this.transform.angle:-this.transform.angle)):ui=!1}Ze.textBox&&Zr(i.textCollisionBox.collisionVertexArray,be.text.placed,!ui||ze,at.x,at.y),Ze.verticalTextBox&&Zr(i.textCollisionBox.collisionVertexArray,be.text.placed,!ui||Xe,at.x,at.y)}const dt=!!(!Xe&&Ze.verticalIconBox);Ze.iconBox&&Zr(i.iconCollisionBox.collisionVertexArray,be.icon.placed,dt,q?at.x:0,q?at.y:0),Ze.verticalIconBox&&Zr(i.iconCollisionBox.collisionVertexArray,be.icon.placed,!dt,q?at.x:0,q?at.y:0)}}}if(i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.text.opacityVertexArray.length!==i.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${i.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${i.text.layoutVertexArray.length}) / 4`);if(i.icon.opacityVertexArray.length!==i.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${i.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${i.icon.layoutVertexArray.length}) / 4`);if(i.bucketInstanceId in this.collisionCircleArrays){const re=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=re.invProjMatrix,i.placementViewportMatrix=re.viewportMatrix,i.collisionCircleArray=re.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,o){const h=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*h>i}setStale(){this.stale=!0}}function Zr(g,i,o,h,f){g.emplaceBack(i?1:0,o?1:0,h||0,f||0),g.emplaceBack(i?1:0,o?1:0,h||0,f||0),g.emplaceBack(i?1:0,o?1:0,h||0,f||0),g.emplaceBack(i?1:0,o?1:0,h||0,f||0)}const jn=Math.pow(2,25),pc=Math.pow(2,24),zo=Math.pow(2,17),Ni=Math.pow(2,16),lo=Math.pow(2,9),Pr=Math.pow(2,8),An=Math.pow(2,1);function _n(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const i=g.placed?1:0,o=Math.floor(127*g.opacity);return o*jn+i*pc+o*zo+i*Ni+o*lo+i*Pr+o*An+i}const qn=0;class kr{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&!i.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,o,h,f,_){const M=this._bucketParts;for(;this._currentTileIndex<i.length;)if(o.getBucketParts(M,f,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort((S,I)=>S.sortKey-I.sortKey));this._currentPartIndex<M.length;)if(o.placeLayerBucketPart(M[this._currentPartIndex],this._seenCrossTileIDs,h),this._currentPartIndex++,_())return!0;return!1}}class vn{constructor(i,o,h,f,_,M,S,I){this.placement=new yn(i,o,M,S,I),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(i,o,h){const f=k.now(),_=()=>!this._forceFullPlacement&&k.now()-f>2;for(;this._currentPlacementIndex>=0;){const M=o[i[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(M.type==="symbol"&&(!M.minzoom||M.minzoom<=S)&&(!M.maxzoom||M.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new kr(M)),this._inProgressLayer.continuePlacement(h[M.source],this.placement,this._showCollisionBoxes,M,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const Gn=512/l.W/2;class gs{constructor(i,o,h){this.tileID=i,this.bucketInstanceId=h,this._symbolsByKey={};const f=new Map;for(let _=0;_<o.length;_++){const M=o.get(_),S=M.key,I=f.get(S);I?I.push(M):f.set(S,[M])}for(const[_,M]of f){const S={positions:M.map(I=>({x:Math.floor(I.anchorX*Gn),y:Math.floor(I.anchorY*Gn)})),crossTileIDs:M.map(I=>I.crossTileID)};if(S.positions.length>128){const I=new l.au(S.positions.length,16,Uint16Array);for(const{x:D,y:F}of S.positions)I.add(D,F);I.finish(),delete S.positions,S.index=I}this._symbolsByKey[_]=S}}getScaledCoordinates(i,o){const{x:h,y:f,z:_}=this.tileID.canonical,{x:M,y:S,z:I}=o.canonical,D=Gn/Math.pow(2,I-_),F=(S*l.W+i.anchorY)*D,B=f*l.W*Gn;return{x:Math.floor((M*l.W+i.anchorX)*D-h*l.W*Gn),y:Math.floor(F-B)}}findMatches(i,o,h){const f=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z);for(let _=0;_<i.length;_++){const M=i.get(_);if(M.crossTileID)continue;const S=this._symbolsByKey[M.key];if(!S)continue;const I=this.getScaledCoordinates(M,o);if(S.index){const D=S.index.range(I.x-f,I.y-f,I.x+f,I.y+f).sort();for(const F of D){const B=S.crossTileIDs[F];if(!h[B]){h[B]=!0,M.crossTileID=B;break}}}else if(S.positions)for(let D=0;D<S.positions.length;D++){const F=S.positions[D],B=S.crossTileIDs[D];if(Math.abs(F.x-I.x)<=f&&Math.abs(F.y-I.y)<=f&&!h[B]){h[B]=!0,M.crossTileID=B;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:i})=>i)}}class Dr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class co{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const o=Math.round((i-this.lng)/360);if(o!==0)for(const h in this.indexes){const f=this.indexes[h],_={};for(const M in f){const S=f[M];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+o),_[S.tileID.key]=S}this.indexes[h]=_}this.lng=i}addBucket(i,o,h){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let _=0;_<o.symbolInstances.length;_++)o.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const f=this.usedCrossTileIDs[i.overscaledZ];for(const _ in this.indexes){const M=this.indexes[_];if(Number(_)>i.overscaledZ)for(const S in M){const I=M[S];I.tileID.isChildOf(i)&&I.findMatches(o.symbolInstances,i,f)}else{const S=M[i.scaledTo(Number(_)).key];S&&S.findMatches(o.symbolInstances,i,f)}}for(let _=0;_<o.symbolInstances.length;_++){const M=o.symbolInstances.get(_);M.crossTileID||(M.crossTileID=h.generate(),f[M.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new gs(i,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(i,o){for(const h of o.getCrossTileIDsLists())for(const f of h)delete this.usedCrossTileIDs[i][f]}removeStaleBuckets(i){let o=!1;for(const h in this.indexes){const f=this.indexes[h];for(const _ in f)i[f[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,f[_]),delete f[_],o=!0)}return o}}class Qs{constructor(){this.layerIndexes={},this.crossTileIDs=new Dr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,o,h){let f=this.layerIndexes[i.id];f===void 0&&(f=this.layerIndexes[i.id]=new co);let _=!1;const M={};f.handleWrapJump(h);for(const S of o){const I=S.getBucket(i);I&&i.id===I.layerIds[0]&&(I.bucketInstanceId||(I.bucketInstanceId=++this.maxBucketInstanceId),f.addBucket(S.tileID,I,this.crossTileIDs)&&(_=!0),M[I.bucketInstanceId]=!0)}return f.removeStaleBuckets(M)&&(_=!0),_}pruneUnusedLayers(i){const o={};i.forEach(h=>{o[h]=!0});for(const h in this.layerIndexes)o[h]||delete this.layerIndexes[h]}}const hr=(g,i)=>l.t(g,i&&i.filter(o=>o.identifier!=="source.canvas")),uo=l.av();class xn extends l.E{constructor(i,o={}){super(),this._rtlPluginLoaded=()=>{for(const h in this.sourceCaches){const f=this.sourceCaches[h].getSource().type;f!=="vector"&&f!=="geojson"||this.sourceCaches[h].reload()}},this.map=i,this.dispatcher=new Et(Ve(),i._getMapId()),this.dispatcher.registerMessageHandler("GG",(h,f)=>this.getGlyphs(h,f)),this.dispatcher.registerMessageHandler("GI",(h,f)=>this.getImages(h,f)),this.imageManager=new pi,this.imageManager.setEventedParent(this),this.glyphManager=new Qt(i._requestManager,o.localIdeographFontFamily),this.lineAtlas=new ut(256,512),this.crossTileSymbolIndex=new Qs,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",l.ax()),Ue().on(Wt,this._rtlPluginLoaded),this.on("data",h=>{if(h.dataType!=="source"||h.sourceDataType!=="metadata")return;const f=this.sourceCaches[h.sourceId];if(!f)return;const _=f.getSource();if(_&&_.vectorLayerIds)for(const M in this._layers){const S=this._layers[M];S.source===_.id&&this._validateLayer(S)}})}loadURL(i,o={},h){this.fire(new l.k("dataloading",{dataType:"style"})),o.validate=typeof o.validate!="boolean"||o.validate;const f=this.map._requestManager.transformRequest(i,"Style");this._loadStyleRequest=new AbortController,l.h(f,this._loadStyleRequest).then(_=>{this._loadStyleRequest=null,this._load(_.data,o,h)}).catch(_=>{this._loadStyleRequest=null,_&&this.fire(new l.j(_))})}loadJSON(i,o={},h){this.fire(new l.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,k.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,o.validate=o.validate!==!1,this._load(i,o,h)}).catch(()=>{})}loadEmpty(){this.fire(new l.k("dataloading",{dataType:"style"})),this._load(uo,{validate:!1})}_load(i,o,h){var f;const _=o.transformStyle?o.transformStyle(h,i):i;if(!o.validate||!hr(this,l.x(_))){this._loaded=!0,this.stylesheet=_;for(const M in _.sources)this.addSource(M,_.sources[M],{validate:!1});_.sprite?this._loadSprite(_.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(_.glyphs),this._createLayers(),this.light=new Ar(this.stylesheet.light),this.map.setTerrain((f=this.stylesheet.terrain)!==null&&f!==void 0?f:null),this.fire(new l.k("data",{dataType:"style"})),this.fire(new l.k("style.load"))}}_createLayers(){const i=l.ay(this.stylesheet.layers);this.dispatcher.broadcast("SL",i),this._order=i.map(o=>o.id),this._layers={},this._serializedLayers=null;for(const o of i){const h=l.az(o);h.setEventedParent(this,{layer:{id:o.id}}),this._layers[o.id]=h}}_loadSprite(i,o=!1,h=void 0){let f;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(_,M,S,I){return l._(this,void 0,void 0,function*(){const D=Rt(_),F=S>1?"@2x":"",B={},q={};for(const{id:te,url:Q}of D){const re=M.transformRequest(M.normalizeSpriteURL(Q,F,".json"),"SpriteJSON");B[te]=l.h(re,I);const W=M.transformRequest(M.normalizeSpriteURL(Q,F,".png"),"SpriteImage");q[te]=he.getImage(W,I)}return yield Promise.all([...Object.values(B),...Object.values(q)]),function(te,Q){return l._(this,void 0,void 0,function*(){const re={};for(const W in te){re[W]={};const pe=k.getImageCanvasContext((yield Q[W]).data),Ce=(yield te[W]).data;for(const oe in Ce){const{width:be,height:Ae,x:ke,y:ze,sdf:Xe,pixelRatio:Ze,stretchX:at,stretchY:dt,content:ui}=Ce[oe];re[W][oe]={data:null,pixelRatio:Ze,sdf:Xe,stretchX:at,stretchY:dt,content:ui,spriteData:{width:be,height:Ae,x:ke,y:ze,context:pe}}}}return re})}(B,q)})}(i,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(_=>{if(this._spriteRequest=null,_)for(const M in _){this._spritesImagesIds[M]=[];const S=this._spritesImagesIds[M]?this._spritesImagesIds[M].filter(I=>!(I in _)):[];for(const I of S)this.imageManager.removeImage(I),this._changedImages[I]=!0;for(const I in _[M]){const D=M==="default"?I:`${M}:${I}`;this._spritesImagesIds[M].push(D),D in this.imageManager.images?this.imageManager.updateImage(D,_[M][I],!1):this.imageManager.addImage(D,_[M][I]),o&&(this._changedImages[D]=!0)}}}).catch(_=>{this._spriteRequest=null,f=_,this.fire(new l.j(f))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),o&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"})),h&&h(f)})}_unloadSprite(){for(const i of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(i),this._changedImages[i]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}_validateLayer(i){const o=this.sourceCaches[i.source];if(!o)return;const h=i.sourceLayer;if(!h)return;const f=o.getSource();(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(h)===-1)&&this.fire(new l.j(new Error(`Source layer "${h}" does not exist on source "${f.id}" as specified by style layer "${i.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this.sourceCaches)if(!this.sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(i){const o=this._serializedAllLayers();if(!i||i.length===0)return Object.values(o);const h=[];for(const f of i)o[f]&&h.push(o[f]);return h}_serializedAllLayers(){let i=this._serializedLayers;if(i)return i;i=this._serializedLayers={};const o=Object.keys(this._layers);for(const h of o){const f=this._layers[h];f.type!=="custom"&&(i[h]=f.serialize())}return i}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const i in this.sourceCaches)if(this.sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(i){if(!this._loaded)return;const o=this._changed;if(o){const f=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(f.length||_.length)&&this._updateWorkerLayers(f,_);for(const M in this._updatedSources){const S=this._updatedSources[M];if(S==="reload")this._reloadSource(M);else{if(S!=="clear")throw new Error(`Invalid action ${S}`);this._clearSource(M)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const M in this._updatedPaintProps)this._layers[M].updateTransitions(i);this.light.updateTransitions(i),this._resetUpdates()}const h={};for(const f in this.sourceCaches){const _=this.sourceCaches[f];h[f]=_.used,_.used=!1}for(const f of this._order){const _=this._layers[f];_.recalculate(i,this._availableImages),!_.isHidden(i.zoom)&&_.source&&(this.sourceCaches[_.source].used=!0)}for(const f in h){const _=this.sourceCaches[f];!!h[f]!=!!_.used&&_.fire(new l.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:f}))}this.light.recalculate(i),this.z=i.zoom,o&&this.fire(new l.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const i in this.sourceCaches)this.sourceCaches[i].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(i,o){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(i),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(i,o={}){var h;this._checkLoaded();const f=this.serialize();if(i=o.transformStyle?o.transformStyle(f,i):i,((h=o.validate)===null||h===void 0||h)&&hr(this,l.x(i)))return!1;(i=l.aA(i)).layers=l.ay(i.layers);const _=l.aB(f,i),M=this._getOperationsToPerform(_);if(M.unimplemented.length>0)throw new Error(`Unimplemented: ${M.unimplemented.join(", ")}.`);if(M.operations.length===0)return!1;for(const S of M.operations)S();return this.stylesheet=i,this._serializedLayers=null,!0}_getOperationsToPerform(i){const o=[],h=[];for(const f of i)switch(f.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":o.push(()=>this.addLayer.apply(this,f.args));break;case"removeLayer":o.push(()=>this.removeLayer.apply(this,f.args));break;case"setPaintProperty":o.push(()=>this.setPaintProperty.apply(this,f.args));break;case"setLayoutProperty":o.push(()=>this.setLayoutProperty.apply(this,f.args));break;case"setFilter":o.push(()=>this.setFilter.apply(this,f.args));break;case"addSource":o.push(()=>this.addSource.apply(this,f.args));break;case"removeSource":o.push(()=>this.removeSource.apply(this,f.args));break;case"setLayerZoomRange":o.push(()=>this.setLayerZoomRange.apply(this,f.args));break;case"setLight":o.push(()=>this.setLight.apply(this,f.args));break;case"setGeoJSONSourceData":o.push(()=>this.setGeoJSONSourceData.apply(this,f.args));break;case"setGlyphs":o.push(()=>this.setGlyphs.apply(this,f.args));break;case"setSprite":o.push(()=>this.setSprite.apply(this,f.args));break;case"setTerrain":o.push(()=>this.map.setTerrain.apply(this,f.args));break;case"setTransition":o.push(()=>{});break;default:h.push(f.command)}return{operations:o,unimplemented:h}}addImage(i,o){if(this.getImage(i))return this.fire(new l.j(new Error(`An image named "${i}" already exists.`)));this.imageManager.addImage(i,o),this._afterImageUpdated(i)}updateImage(i,o){this.imageManager.updateImage(i,o)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){if(!this.getImage(i))return this.fire(new l.j(new Error(`An image named "${i}" does not exist.`)));this.imageManager.removeImage(i),this._afterImageUpdated(i)}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(i,o,h={}){if(this._checkLoaded(),this.sourceCaches[i]!==void 0)throw new Error(`Source "${i}" already exists.`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(l.x.source,`sources.${i}`,o,null,h))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const f=this.sourceCaches[i]=new wr(i,o,this.dispatcher);f.style=this,f.setEventedParent(this,()=>({isSourceLoaded:f.loaded(),source:f.serialize(),sourceId:i})),f.onAdd(this.map),this._changed=!0}removeSource(i){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error("There is no source with this ID");for(const h in this._layers)if(this._layers[h].source===i)return this.fire(new l.j(new Error(`Source "${i}" cannot be removed while layer "${h}" is using it.`)));const o=this.sourceCaches[i];delete this.sourceCaches[i],delete this._updatedSources[i],o.fire(new l.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:i})),o.setEventedParent(null),o.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(i,o){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error(`There is no source with this ID=${i}`);const h=this.sourceCaches[i].getSource();if(h.type!=="geojson")throw new Error(`geojsonSource.type is ${h.type}, which is !== 'geojson`);h.setData(o),this._changed=!0}getSource(i){return this.sourceCaches[i]&&this.sourceCaches[i].getSource()}addLayer(i,o,h={}){this._checkLoaded();const f=i.id;if(this.getLayer(f))return void this.fire(new l.j(new Error(`Layer "${f}" already exists on this map.`)));let _;if(i.type==="custom"){if(hr(this,l.aC(i)))return;_=l.az(i)}else{if("source"in i&&typeof i.source=="object"&&(this.addSource(f,i.source),i=l.aA(i),i=l.e(i,{source:f})),this._validate(l.x.layer,`layers.${f}`,i,{arrayIndex:-1},h))return;_=l.az(i),this._validateLayer(_),_.setEventedParent(this,{layer:{id:f}})}const M=o?this._order.indexOf(o):this._order.length;if(o&&M===-1)this.fire(new l.j(new Error(`Cannot add layer "${f}" before non-existing layer "${o}".`)));else{if(this._order.splice(M,0,f),this._layerOrderChanged=!0,this._layers[f]=_,this._removedLayers[f]&&_.source&&_.type!=="custom"){const S=this._removedLayers[f];delete this._removedLayers[f],S.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",this.sourceCaches[_.source].pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map)}}moveLayer(i,o){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new l.j(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===o)return;const h=this._order.indexOf(i);this._order.splice(h,1);const f=o?this._order.indexOf(o):this._order.length;o&&f===-1?this.fire(new l.j(new Error(`Cannot move layer "${i}" before non-existing layer "${o}".`))):(this._order.splice(f,0,i),this._layerOrderChanged=!0)}removeLayer(i){this._checkLoaded();const o=this._layers[i];if(!o)return void this.fire(new l.j(new Error(`Cannot remove non-existing layer "${i}".`)));o.setEventedParent(null);const h=this._order.indexOf(i);this._order.splice(h,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=o,delete this._layers[i],this._serializedLayers&&delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],o.onRemove&&o.onRemove(this.map)}getLayer(i){return this._layers[i]}getLayersOrder(){return[...this._order]}hasLayer(i){return i in this._layers}setLayerZoomRange(i,o,h){this._checkLoaded();const f=this.getLayer(i);f?f.minzoom===o&&f.maxzoom===h||(o!=null&&(f.minzoom=o),h!=null&&(f.maxzoom=h),this._updateLayer(f)):this.fire(new l.j(new Error(`Cannot set the zoom range of non-existing layer "${i}".`)))}setFilter(i,o,h={}){this._checkLoaded();const f=this.getLayer(i);if(f){if(!l.aD(f.filter,o))return o==null?(f.filter=void 0,void this._updateLayer(f)):void(this._validate(l.x.filter,`layers.${f.id}.filter`,o,null,h)||(f.filter=l.aA(o),this._updateLayer(f)))}else this.fire(new l.j(new Error(`Cannot filter non-existing layer "${i}".`)))}getFilter(i){return l.aA(this.getLayer(i).filter)}setLayoutProperty(i,o,h,f={}){this._checkLoaded();const _=this.getLayer(i);_?l.aD(_.getLayoutProperty(o),h)||(_.setLayoutProperty(o,h,f),this._updateLayer(_)):this.fire(new l.j(new Error(`Cannot style non-existing layer "${i}".`)))}getLayoutProperty(i,o){const h=this.getLayer(i);if(h)return h.getLayoutProperty(o);this.fire(new l.j(new Error(`Cannot get style of non-existing layer "${i}".`)))}setPaintProperty(i,o,h,f={}){this._checkLoaded();const _=this.getLayer(i);_?l.aD(_.getPaintProperty(o),h)||(_.setPaintProperty(o,h,f)&&this._updateLayer(_),this._changed=!0,this._updatedPaintProps[i]=!0,this._serializedLayers=null):this.fire(new l.j(new Error(`Cannot style non-existing layer "${i}".`)))}getPaintProperty(i,o){return this.getLayer(i).getPaintProperty(o)}setFeatureState(i,o){this._checkLoaded();const h=i.source,f=i.sourceLayer,_=this.sourceCaches[h];if(_===void 0)return void this.fire(new l.j(new Error(`The source '${h}' does not exist in the map's style.`)));const M=_.getSource().type;M==="geojson"&&f?this.fire(new l.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):M!=="vector"||f?(i.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),_.setFeatureState(f,i.id,o)):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(i,o){this._checkLoaded();const h=i.source,f=this.sourceCaches[h];if(f===void 0)return void this.fire(new l.j(new Error(`The source '${h}' does not exist in the map's style.`)));const _=f.getSource().type,M=_==="vector"?i.sourceLayer:void 0;_!=="vector"||M?o&&typeof i.id!="string"&&typeof i.id!="number"?this.fire(new l.j(new Error("A feature id is required to remove its specific state property."))):f.removeFeatureState(M,i.id,o):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(i){this._checkLoaded();const o=i.source,h=i.sourceLayer,f=this.sourceCaches[o];if(f!==void 0)return f.getSource().type!=="vector"||h?(i.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),f.getFeatureState(h,i.id)):void this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.j(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const i=l.aE(this.sourceCaches,_=>_.serialize()),o=this._serializeByIds(this._order),h=this.map.getTerrain()||void 0,f=this.stylesheet;return l.aF({version:f.version,name:f.name,metadata:f.metadata,light:f.light,center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch,sprite:f.sprite,glyphs:f.glyphs,transition:f.transition,sources:i,layers:o,terrain:h},_=>_!==void 0)}_updateLayer(i){this._updatedLayers[i.id]=!0,i.source&&!this._updatedSources[i.source]&&this.sourceCaches[i.source].getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",this.sourceCaches[i.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(i){const o=M=>this._layers[M].type==="fill-extrusion",h={},f=[];for(let M=this._order.length-1;M>=0;M--){const S=this._order[M];if(o(S)){h[S]=M;for(const I of i){const D=I[S];if(D)for(const F of D)f.push(F)}}}f.sort((M,S)=>S.intersectionZ-M.intersectionZ);const _=[];for(let M=this._order.length-1;M>=0;M--){const S=this._order[M];if(o(S))for(let I=f.length-1;I>=0;I--){const D=f[I].feature;if(h[D.layer.id]<M)break;_.push(D),f.pop()}else for(const I of i){const D=I[S];if(D)for(const F of D)_.push(F.feature)}}return _}queryRenderedFeatures(i,o,h){o&&o.filter&&this._validate(l.x.filter,"queryRenderedFeatures.filter",o.filter,null,o);const f={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new l.j(new Error("parameters.layers must be an Array."))),[];for(const S of o.layers){const I=this._layers[S];if(!I)return this.fire(new l.j(new Error(`The layer '${S}' does not exist in the map's style and cannot be queried for features.`))),[];f[I.source]=!0}}const _=[];o.availableImages=this._availableImages;const M=this._serializedAllLayers();for(const S in this.sourceCaches)o.layers&&!f[S]||_.push(Pi(this.sourceCaches[S],this._layers,M,i,o,h));return this.placement&&_.push(function(S,I,D,F,B,q,te){const Q={},re=q.queryRenderedSymbols(F),W=[];for(const pe of Object.keys(re).map(Number))W.push(te[pe]);W.sort(Ri);for(const pe of W){const Ce=pe.featureIndex.lookupSymbolFeatures(re[pe.bucketInstanceId],I,pe.bucketIndex,pe.sourceLayerIndex,B.filter,B.layers,B.availableImages,S);for(const oe in Ce){const be=Q[oe]=Q[oe]||[],Ae=Ce[oe];Ae.sort((ke,ze)=>{const Xe=pe.featureSortOrder;if(Xe){const Ze=Xe.indexOf(ke.featureIndex);return Xe.indexOf(ze.featureIndex)-Ze}return ze.featureIndex-ke.featureIndex});for(const ke of Ae)be.push(ke)}}for(const pe in Q)Q[pe].forEach(Ce=>{const oe=Ce.feature,be=D[S[pe].source].getFeatureState(oe.layer["source-layer"],oe.id);oe.source=oe.layer.source,oe.layer["source-layer"]&&(oe.sourceLayer=oe.layer["source-layer"]),oe.state=be});return Q}(this._layers,M,this.sourceCaches,i,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(i,o){o&&o.filter&&this._validate(l.x.filter,"querySourceFeatures.filter",o.filter,null,o);const h=this.sourceCaches[i];return h?function(f,_){const M=f.getRenderableIds().map(D=>f.getTileByID(D)),S=[],I={};for(let D=0;D<M.length;D++){const F=M[D],B=F.tileID.canonical.key;I[B]||(I[B]=!0,F.querySourceFeatures(S,_))}return S}(h,o):[]}getLight(){return this.light.getLight()}setLight(i,o={}){this._checkLoaded();const h=this.light.getLight();let f=!1;for(const M in i)if(!l.aD(i[M],h[M])){f=!0;break}if(!f)return;const _={now:k.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,o),this.light.updateTransitions(_)}_validate(i,o,h,f,_={}){return(!_||_.validate!==!1)&&hr(this,i.call(l.x,l.e({key:o,style:this.serialize(),value:h,styleSpec:l.v},f)))}_remove(i=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Ue().off(Wt,this._rtlPluginLoaded);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this.sourceCaches){const h=this.sourceCaches[o];h.setEventedParent(null),h.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),i&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(i)}_clearSource(i){this.sourceCaches[i].clearTiles()}_reloadSource(i){this.sourceCaches[i].resume(),this.sourceCaches[i].reload()}_updateSources(i){for(const o in this.sourceCaches)this.sourceCaches[o].update(i,this.map.terrain)}_generateCollisionBoxes(){for(const i in this.sourceCaches)this._reloadSource(i)}_updatePlacement(i,o,h,f,_=!1){let M=!1,S=!1;const I={};for(const D of this._order){const F=this._layers[D];if(F.type!=="symbol")continue;if(!I[F.source]){const q=this.sourceCaches[F.source];I[F.source]=q.getRenderableIds(!0).map(te=>q.getTileByID(te)).sort((te,Q)=>Q.tileID.overscaledZ-te.tileID.overscaledZ||(te.tileID.isLessThan(Q.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(F,I[F.source],i.center.lng);M=M||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((_=_||this._layerOrderChanged||h===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(k.now(),i.zoom))&&(this.pauseablePlacement=new vn(i,this.map.terrain,this._order,_,o,h,f,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(k.now()),S=!0),M&&this.pauseablePlacement.placement.setStale()),S||M)for(const D of this._order){const F=this._layers[D];F.type==="symbol"&&this.placement.updateLayerOpacities(F,I[F.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(k.now())}_releaseSymbolFadeTiles(){for(const i in this.sourceCaches)this.sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,o){return l._(this,void 0,void 0,function*(){const h=yield this.imageManager.getImages(o.icons);this._updateTilesForChangedImages();const f=this.sourceCaches[o.source];return f&&f.setDependencies(o.tileID.key,o.type,o.icons),h})}getGlyphs(i,o){return l._(this,void 0,void 0,function*(){const h=yield this.glyphManager.getGlyphs(o.stacks),f=this.sourceCaches[o.source];return f&&f.setDependencies(o.tileID.key,o.type,[""]),h})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(i,o={}){this._checkLoaded(),i&&this._validate(l.x.glyphs,"glyphs",i,null,o)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=i,this.glyphManager.entries={},this.glyphManager.setURL(i))}addSprite(i,o,h={},f){this._checkLoaded();const _=[{id:i,url:o}],M=[...Rt(this.stylesheet.sprite),..._];this._validate(l.x.sprite,"sprite",M,null,h)||(this.stylesheet.sprite=M,this._loadSprite(_,!0,f))}removeSprite(i){this._checkLoaded();const o=Rt(this.stylesheet.sprite);if(o.find(h=>h.id===i)){if(this._spritesImagesIds[i])for(const h of this._spritesImagesIds[i])this.imageManager.removeImage(h),this._changedImages[h]=!0;o.splice(o.findIndex(h=>h.id===i),1),this.stylesheet.sprite=o.length>0?o:void 0,delete this._spritesImagesIds[i],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}else this.fire(new l.j(new Error(`Sprite "${i}" doesn't exists on this map.`)))}getSprite(){return Rt(this.stylesheet.sprite)}setSprite(i,o={},h){this._checkLoaded(),i&&this._validate(l.x.sprite,"sprite",i,null,o)||(this.stylesheet.sprite=i,i?this._loadSprite(i,!0,h):(this._unloadSprite(),h&&h(null)))}}var ho=l.X([{name:"a_pos",type:"Int16",components:2}]),is="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const fo={prelude:Ui(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Ui(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Ui(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ui(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ui("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ui(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Ui(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ui("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ui("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ui("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Ui(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Ui(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Ui(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Ui(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ui(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ui(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ui(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ui(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Ui(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ui(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ui(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ui(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Ui(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Ui(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ui(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ui(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ui("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",is),terrainDepth:Ui("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",is),terrainCoords:Ui("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",is)};function Ui(g,i){const o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=i.match(/attribute ([\w]+) ([\w]+)/g),f=g.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=i.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),M=_?_.concat(f):f,S={};return{fragmentSource:g=g.replace(o,(I,D,F,B,q)=>(S[q]=!0,D==="define"?`
#ifndef HAS_UNIFORM_u_${q}
varying ${F} ${B} ${q};
#else
uniform ${F} ${B} u_${q};
#endif
`:`
#ifdef HAS_UNIFORM_u_${q}
    ${F} ${B} ${q} = u_${q};
#endif
`)),vertexSource:i=i.replace(o,(I,D,F,B,q)=>{const te=B==="float"?"vec2":"vec4",Q=q.match(/color/)?"color":te;return S[q]?D==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
attribute ${F} ${te} a_${q};
varying ${F} ${B} ${q};
#else
uniform ${F} ${B} u_${q};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = a_${q};
#else
    ${F} ${B} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = unpack_mix_${Q}(a_${q}, u_${q}_t);
#else
    ${F} ${B} ${q} = u_${q};
#endif
`:D==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
attribute ${F} ${te} a_${q};
#else
uniform ${F} ${B} u_${q};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${F} ${B} ${q} = a_${q};
#else
    ${F} ${B} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${F} ${B} ${q} = unpack_mix_${Q}(a_${q}, u_${q}_t);
#else
    ${F} ${B} ${q} = u_${q};
#endif
`}),staticAttributes:h,staticUniforms:M}}class Oo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(i,o,h,f,_,M,S,I,D){this.context=i;let F=this.boundPaintVertexBuffers.length!==f.length;for(let B=0;!F&&B<f.length;B++)this.boundPaintVertexBuffers[B]!==f[B]&&(F=!0);!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==h||F||this.boundIndexBuffer!==_||this.boundVertexOffset!==M||this.boundDynamicVertexBuffer!==S||this.boundDynamicVertexBuffer2!==I||this.boundDynamicVertexBuffer3!==D?this.freshBind(o,h,f,_,M,S,I,D):(i.bindVertexArray.set(this.vao),S&&S.bind(),_&&_.dynamicDraw&&_.bind(),I&&I.bind(),D&&D.bind())}freshBind(i,o,h,f,_,M,S,I){const D=i.numAttributes,F=this.context,B=F.gl;this.vao&&this.destroy(),this.vao=F.createVertexArray(),F.bindVertexArray.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=f,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=M,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=I,o.enableAttributes(B,i);for(const q of h)q.enableAttributes(B,i);M&&M.enableAttributes(B,i),S&&S.enableAttributes(B,i),I&&I.enableAttributes(B,i),o.bind(),o.setVertexAttribPointers(B,i,_);for(const q of h)q.bind(),q.setVertexAttribPointers(B,i,_);M&&(M.bind(),M.setVertexAttribPointers(B,i,_)),f&&f.bind(),S&&(S.bind(),S.setVertexAttribPointers(B,i,_)),I&&(I.bind(),I.setVertexAttribPointers(B,i,_)),F.currentNumAttributes=D}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Os(g){const i=[];for(let o=0;o<g.length;o++){if(g[o]===null)continue;const h=g[o].split(" ");i.push(h.pop())}return i}class b{constructor(i,o,h,f,_,M){const S=i.gl;this.program=S.createProgram();const I=Os(o.staticAttributes),D=h?h.getBinderAttributes():[],F=I.concat(D),B=fo.prelude.staticUniforms?Os(fo.prelude.staticUniforms):[],q=o.staticUniforms?Os(o.staticUniforms):[],te=h?h.getBinderUniforms():[],Q=B.concat(q).concat(te),re=[];for(const ke of Q)re.indexOf(ke)<0&&re.push(ke);const W=h?h.defines():[];_&&W.push("#define OVERDRAW_INSPECTOR;"),M&&W.push("#define TERRAIN3D;");const pe=W.concat(fo.prelude.fragmentSource,o.fragmentSource).join(`
`),Ce=W.concat(fo.prelude.vertexSource,o.vertexSource).join(`
`),oe=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);if(S.shaderSource(oe,pe),S.compileShader(oe),!S.getShaderParameter(oe,S.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${S.getShaderInfoLog(oe)}`);S.attachShader(this.program,oe);const be=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);if(S.shaderSource(be,Ce),S.compileShader(be),!S.getShaderParameter(be,S.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${S.getShaderInfoLog(be)}`);S.attachShader(this.program,be),this.attributes={};const Ae={};this.numAttributes=F.length;for(let ke=0;ke<this.numAttributes;ke++)F[ke]&&(S.bindAttribLocation(this.program,ke,F[ke]),this.attributes[F[ke]]=ke);if(S.linkProgram(this.program),!S.getProgramParameter(this.program,S.LINK_STATUS))throw new Error(`Program failed to link: ${S.getProgramInfoLog(this.program)}`);S.deleteShader(be),S.deleteShader(oe);for(let ke=0;ke<re.length;ke++){const ze=re[ke];if(ze&&!Ae[ze]){const Xe=S.getUniformLocation(this.program,ze);Xe&&(Ae[ze]=Xe)}}this.fixedUniforms=f(i,Ae),this.terrainUniforms=((ke,ze)=>({u_depth:new l.aG(ke,ze.u_depth),u_terrain:new l.aG(ke,ze.u_terrain),u_terrain_dim:new l.aH(ke,ze.u_terrain_dim),u_terrain_matrix:new l.aI(ke,ze.u_terrain_matrix),u_terrain_unpack:new l.aJ(ke,ze.u_terrain_unpack),u_terrain_exaggeration:new l.aH(ke,ze.u_terrain_exaggeration)}))(i,Ae),this.binderUniforms=h?h.getUniforms(i,Ae):[]}draw(i,o,h,f,_,M,S,I,D,F,B,q,te,Q,re,W,pe,Ce){const oe=i.gl;if(this.failedToCreate)return;if(i.program.set(this.program),i.setDepthMode(h),i.setStencilMode(f),i.setColorMode(_),i.setCullFace(M),I){i.activeTexture.set(oe.TEXTURE2),oe.bindTexture(oe.TEXTURE_2D,I.depthTexture),i.activeTexture.set(oe.TEXTURE3),oe.bindTexture(oe.TEXTURE_2D,I.texture);for(const Ae in this.terrainUniforms)this.terrainUniforms[Ae].set(I[Ae])}for(const Ae in this.fixedUniforms)this.fixedUniforms[Ae].set(S[Ae]);re&&re.setUniforms(i,this.binderUniforms,te,{zoom:Q});let be=0;switch(o){case oe.LINES:be=2;break;case oe.TRIANGLES:be=3;break;case oe.LINE_STRIP:be=1}for(const Ae of q.get()){const ke=Ae.vaos||(Ae.vaos={});(ke[D]||(ke[D]=new Oo)).bind(i,this,F,re?re.getPaintVertexBuffers():[],B,Ae.vertexOffset,W,pe,Ce),oe.drawElements(o,Ae.primitiveLength*be,oe.UNSIGNED_SHORT,Ae.primitiveOffset*be*2)}}}function A(g,i,o){const h=1/ri(o,1,i.transform.tileZoom),f=Math.pow(2,o.tileID.overscaledZ),_=o.tileSize*Math.pow(2,i.transform.tileZoom)/f,M=_*(o.tileID.canonical.x+o.tileID.wrap*f),S=_*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[h,g.fromScale,g.toScale],u_fade:g.t,u_pixel_coord_upper:[M>>16,S>>16],u_pixel_coord_lower:[65535&M,65535&S]}}const V=(g,i,o,h)=>{const f=i.style.light,_=f.properties.get("position"),M=[_.x,_.y,_.z],S=function(){var D=new l.A(9);return l.A!=Float32Array&&(D[1]=0,D[2]=0,D[3]=0,D[5]=0,D[6]=0,D[7]=0),D[0]=1,D[4]=1,D[8]=1,D}();f.properties.get("anchor")==="viewport"&&function(D,F){var B=Math.sin(F),q=Math.cos(F);D[0]=q,D[1]=B,D[2]=0,D[3]=-B,D[4]=q,D[5]=0,D[6]=0,D[7]=0,D[8]=1}(S,-i.transform.angle),function(D,F,B){var q=F[0],te=F[1],Q=F[2];D[0]=q*B[0]+te*B[3]+Q*B[6],D[1]=q*B[1]+te*B[4]+Q*B[7],D[2]=q*B[2]+te*B[5]+Q*B[8]}(M,M,S);const I=f.properties.get("color");return{u_matrix:g,u_lightpos:M,u_lightintensity:f.properties.get("intensity"),u_lightcolor:[I.r,I.g,I.b],u_vertical_gradient:+o,u_opacity:h}},ae=(g,i,o,h,f,_,M)=>l.e(V(g,i,o,h),A(_,i,M),{u_height_factor:-Math.pow(2,f.overscaledZ)/M.tileSize/8}),me=g=>({u_matrix:g}),ye=(g,i,o,h)=>l.e(me(g),A(o,i,h)),Me=(g,i)=>({u_matrix:g,u_world:i}),Ye=(g,i,o,h,f)=>l.e(ye(g,i,o,h),{u_world:f}),ot=(g,i,o,h)=>{const f=g.transform;let _,M;if(h.paint.get("circle-pitch-alignment")==="map"){const S=ri(o,1,f.zoom);_=!0,M=[S,S]}else _=!1,M=f.pixelsToGLUnits;return{u_camera_to_center_distance:f.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_matrix:g.translatePosMatrix(i.posMatrix,o,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_pitch_with_map:+_,u_device_pixel_ratio:g.pixelRatio,u_extrude_scale:M}},wt=(g,i,o)=>{const h=ri(o,1,i.zoom),f=Math.pow(2,i.zoom-o.tileID.overscaledZ),_=o.tileID.overscaleFactor();return{u_matrix:g,u_camera_to_center_distance:i.cameraToCenterDistance,u_pixels_to_tile_units:h,u_extrude_scale:[i.pixelsToGLUnits[0]/(h*f),i.pixelsToGLUnits[1]/(h*f)],u_overscale_factor:_}},Mt=(g,i,o=1)=>({u_matrix:g,u_color:i,u_overlay:0,u_overlay_scale:o}),pt=g=>({u_matrix:g}),ai=(g,i,o,h)=>({u_matrix:g,u_extrude_scale:ri(i,1,o),u_intensity:h});function dr(g,i){const o=Math.pow(2,i.canonical.z),h=i.canonical.y;return[new l.Y(0,h/o).toLngLat().lat,new l.Y(0,(h+1)/o).toLngLat().lat]}const ci=(g,i,o,h)=>{const f=g.transform;return{u_matrix:Sr(g,i,o,h),u_ratio:1/ri(i,1,f.zoom),u_device_pixel_ratio:g.pixelRatio,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},Lr=(g,i,o,h,f)=>l.e(ci(g,i,o,f),{u_image:0,u_image_height:h}),je=(g,i,o,h,f)=>{const _=g.transform,M=vi(i,_);return{u_matrix:Sr(g,i,o,f),u_texsize:i.imageAtlasTexture.size,u_ratio:1/ri(i,1,_.zoom),u_device_pixel_ratio:g.pixelRatio,u_image:0,u_scale:[M,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},zt=(g,i,o,h,f,_)=>{const M=g.lineAtlas,S=vi(i,g.transform),I=o.layout.get("line-cap")==="round",D=M.getDash(h.from,I),F=M.getDash(h.to,I),B=D.width*f.fromScale,q=F.width*f.toScale;return l.e(ci(g,i,o,_),{u_patternscale_a:[S/B,-D.height/2],u_patternscale_b:[S/q,-F.height/2],u_sdfgamma:M.width/(256*Math.min(B,q)*g.pixelRatio)/2,u_image:0,u_tex_y_a:D.y,u_tex_y_b:F.y,u_mix:f.t})};function vi(g,i){return 1/ri(g,1,i.tileZoom)}function Sr(g,i,o,h){return g.translatePosMatrix(h?h.posMatrix:i.tileID.posMatrix,i,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const _r=(g,i,o,h,f)=>{return{u_matrix:g,u_tl_parent:i,u_scale_parent:o,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*f.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:f.paint.get("raster-brightness-min"),u_brightness_high:f.paint.get("raster-brightness-max"),u_saturation_factor:(M=f.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(_=f.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:ma(f.paint.get("raster-hue-rotate"))};var _,M};function ma(g){g*=Math.PI/180;const i=Math.sin(g),o=Math.cos(g);return[(2*o+1)/3,(-Math.sqrt(3)*i-o+1)/3,(Math.sqrt(3)*i-o+1)/3]}const po=(g,i,o,h,f,_,M,S,I,D)=>{const F=f.transform;return{u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:F.cameraToCenterDistance,u_pitch:F.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:F.width/F.height,u_fade_change:f.options.fadeDuration?f.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:M,u_coord_matrix:S,u_is_text:+I,u_pitch_with_map:+h,u_texsize:D,u_texture:0}},qi=(g,i,o,h,f,_,M,S,I,D,F)=>{const B=f.transform;return l.e(po(g,i,o,h,f,_,M,S,I,D),{u_gamma_scale:h?Math.cos(B._pitch)*B.cameraToCenterDistance:1,u_device_pixel_ratio:f.pixelRatio,u_is_halo:+F})},Ba=(g,i,o,h,f,_,M,S,I,D)=>l.e(qi(g,i,o,h,f,_,M,S,!0,I,!0),{u_texsize_icon:D,u_texture_icon:1}),_u=(g,i,o)=>({u_matrix:g,u_opacity:i,u_color:o}),Fs=(g,i,o,h,f,_)=>l.e(function(M,S,I,D){const F=I.imageManager.getPattern(M.from.toString()),B=I.imageManager.getPattern(M.to.toString()),{width:q,height:te}=I.imageManager.getPixelSize(),Q=Math.pow(2,D.tileID.overscaledZ),re=D.tileSize*Math.pow(2,I.transform.tileZoom)/Q,W=re*(D.tileID.canonical.x+D.tileID.wrap*Q),pe=re*D.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:F.tl,u_pattern_br_a:F.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[q,te],u_mix:S.t,u_pattern_size_a:F.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/ri(D,1,I.transform.tileZoom),u_pixel_coord_upper:[W>>16,pe>>16],u_pixel_coord_lower:[65535&W,65535&pe]}}(h,_,o,f),{u_matrix:g,u_opacity:i}),Cl={fillExtrusion:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_lightpos:new l.aK(g,i.u_lightpos),u_lightintensity:new l.aH(g,i.u_lightintensity),u_lightcolor:new l.aK(g,i.u_lightcolor),u_vertical_gradient:new l.aH(g,i.u_vertical_gradient),u_opacity:new l.aH(g,i.u_opacity)}),fillExtrusionPattern:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_lightpos:new l.aK(g,i.u_lightpos),u_lightintensity:new l.aH(g,i.u_lightintensity),u_lightcolor:new l.aK(g,i.u_lightcolor),u_vertical_gradient:new l.aH(g,i.u_vertical_gradient),u_height_factor:new l.aH(g,i.u_height_factor),u_image:new l.aG(g,i.u_image),u_texsize:new l.aL(g,i.u_texsize),u_pixel_coord_upper:new l.aL(g,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(g,i.u_pixel_coord_lower),u_scale:new l.aK(g,i.u_scale),u_fade:new l.aH(g,i.u_fade),u_opacity:new l.aH(g,i.u_opacity)}),fill:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix)}),fillPattern:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_image:new l.aG(g,i.u_image),u_texsize:new l.aL(g,i.u_texsize),u_pixel_coord_upper:new l.aL(g,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(g,i.u_pixel_coord_lower),u_scale:new l.aK(g,i.u_scale),u_fade:new l.aH(g,i.u_fade)}),fillOutline:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_world:new l.aL(g,i.u_world)}),fillOutlinePattern:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_world:new l.aL(g,i.u_world),u_image:new l.aG(g,i.u_image),u_texsize:new l.aL(g,i.u_texsize),u_pixel_coord_upper:new l.aL(g,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(g,i.u_pixel_coord_lower),u_scale:new l.aK(g,i.u_scale),u_fade:new l.aH(g,i.u_fade)}),circle:(g,i)=>({u_camera_to_center_distance:new l.aH(g,i.u_camera_to_center_distance),u_scale_with_map:new l.aG(g,i.u_scale_with_map),u_pitch_with_map:new l.aG(g,i.u_pitch_with_map),u_extrude_scale:new l.aL(g,i.u_extrude_scale),u_device_pixel_ratio:new l.aH(g,i.u_device_pixel_ratio),u_matrix:new l.aI(g,i.u_matrix)}),collisionBox:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_camera_to_center_distance:new l.aH(g,i.u_camera_to_center_distance),u_pixels_to_tile_units:new l.aH(g,i.u_pixels_to_tile_units),u_extrude_scale:new l.aL(g,i.u_extrude_scale),u_overscale_factor:new l.aH(g,i.u_overscale_factor)}),collisionCircle:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_inv_matrix:new l.aI(g,i.u_inv_matrix),u_camera_to_center_distance:new l.aH(g,i.u_camera_to_center_distance),u_viewport_size:new l.aL(g,i.u_viewport_size)}),debug:(g,i)=>({u_color:new l.aM(g,i.u_color),u_matrix:new l.aI(g,i.u_matrix),u_overlay:new l.aG(g,i.u_overlay),u_overlay_scale:new l.aH(g,i.u_overlay_scale)}),clippingMask:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix)}),heatmap:(g,i)=>({u_extrude_scale:new l.aH(g,i.u_extrude_scale),u_intensity:new l.aH(g,i.u_intensity),u_matrix:new l.aI(g,i.u_matrix)}),heatmapTexture:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_world:new l.aL(g,i.u_world),u_image:new l.aG(g,i.u_image),u_color_ramp:new l.aG(g,i.u_color_ramp),u_opacity:new l.aH(g,i.u_opacity)}),hillshade:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_image:new l.aG(g,i.u_image),u_latrange:new l.aL(g,i.u_latrange),u_light:new l.aL(g,i.u_light),u_shadow:new l.aM(g,i.u_shadow),u_highlight:new l.aM(g,i.u_highlight),u_accent:new l.aM(g,i.u_accent)}),hillshadePrepare:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_image:new l.aG(g,i.u_image),u_dimension:new l.aL(g,i.u_dimension),u_zoom:new l.aH(g,i.u_zoom),u_unpack:new l.aJ(g,i.u_unpack)}),line:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_ratio:new l.aH(g,i.u_ratio),u_device_pixel_ratio:new l.aH(g,i.u_device_pixel_ratio),u_units_to_pixels:new l.aL(g,i.u_units_to_pixels)}),lineGradient:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_ratio:new l.aH(g,i.u_ratio),u_device_pixel_ratio:new l.aH(g,i.u_device_pixel_ratio),u_units_to_pixels:new l.aL(g,i.u_units_to_pixels),u_image:new l.aG(g,i.u_image),u_image_height:new l.aH(g,i.u_image_height)}),linePattern:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_texsize:new l.aL(g,i.u_texsize),u_ratio:new l.aH(g,i.u_ratio),u_device_pixel_ratio:new l.aH(g,i.u_device_pixel_ratio),u_image:new l.aG(g,i.u_image),u_units_to_pixels:new l.aL(g,i.u_units_to_pixels),u_scale:new l.aK(g,i.u_scale),u_fade:new l.aH(g,i.u_fade)}),lineSDF:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_ratio:new l.aH(g,i.u_ratio),u_device_pixel_ratio:new l.aH(g,i.u_device_pixel_ratio),u_units_to_pixels:new l.aL(g,i.u_units_to_pixels),u_patternscale_a:new l.aL(g,i.u_patternscale_a),u_patternscale_b:new l.aL(g,i.u_patternscale_b),u_sdfgamma:new l.aH(g,i.u_sdfgamma),u_image:new l.aG(g,i.u_image),u_tex_y_a:new l.aH(g,i.u_tex_y_a),u_tex_y_b:new l.aH(g,i.u_tex_y_b),u_mix:new l.aH(g,i.u_mix)}),raster:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_tl_parent:new l.aL(g,i.u_tl_parent),u_scale_parent:new l.aH(g,i.u_scale_parent),u_buffer_scale:new l.aH(g,i.u_buffer_scale),u_fade_t:new l.aH(g,i.u_fade_t),u_opacity:new l.aH(g,i.u_opacity),u_image0:new l.aG(g,i.u_image0),u_image1:new l.aG(g,i.u_image1),u_brightness_low:new l.aH(g,i.u_brightness_low),u_brightness_high:new l.aH(g,i.u_brightness_high),u_saturation_factor:new l.aH(g,i.u_saturation_factor),u_contrast_factor:new l.aH(g,i.u_contrast_factor),u_spin_weights:new l.aK(g,i.u_spin_weights)}),symbolIcon:(g,i)=>({u_is_size_zoom_constant:new l.aG(g,i.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(g,i.u_is_size_feature_constant),u_size_t:new l.aH(g,i.u_size_t),u_size:new l.aH(g,i.u_size),u_camera_to_center_distance:new l.aH(g,i.u_camera_to_center_distance),u_pitch:new l.aH(g,i.u_pitch),u_rotate_symbol:new l.aG(g,i.u_rotate_symbol),u_aspect_ratio:new l.aH(g,i.u_aspect_ratio),u_fade_change:new l.aH(g,i.u_fade_change),u_matrix:new l.aI(g,i.u_matrix),u_label_plane_matrix:new l.aI(g,i.u_label_plane_matrix),u_coord_matrix:new l.aI(g,i.u_coord_matrix),u_is_text:new l.aG(g,i.u_is_text),u_pitch_with_map:new l.aG(g,i.u_pitch_with_map),u_texsize:new l.aL(g,i.u_texsize),u_texture:new l.aG(g,i.u_texture)}),symbolSDF:(g,i)=>({u_is_size_zoom_constant:new l.aG(g,i.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(g,i.u_is_size_feature_constant),u_size_t:new l.aH(g,i.u_size_t),u_size:new l.aH(g,i.u_size),u_camera_to_center_distance:new l.aH(g,i.u_camera_to_center_distance),u_pitch:new l.aH(g,i.u_pitch),u_rotate_symbol:new l.aG(g,i.u_rotate_symbol),u_aspect_ratio:new l.aH(g,i.u_aspect_ratio),u_fade_change:new l.aH(g,i.u_fade_change),u_matrix:new l.aI(g,i.u_matrix),u_label_plane_matrix:new l.aI(g,i.u_label_plane_matrix),u_coord_matrix:new l.aI(g,i.u_coord_matrix),u_is_text:new l.aG(g,i.u_is_text),u_pitch_with_map:new l.aG(g,i.u_pitch_with_map),u_texsize:new l.aL(g,i.u_texsize),u_texture:new l.aG(g,i.u_texture),u_gamma_scale:new l.aH(g,i.u_gamma_scale),u_device_pixel_ratio:new l.aH(g,i.u_device_pixel_ratio),u_is_halo:new l.aG(g,i.u_is_halo)}),symbolTextAndIcon:(g,i)=>({u_is_size_zoom_constant:new l.aG(g,i.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(g,i.u_is_size_feature_constant),u_size_t:new l.aH(g,i.u_size_t),u_size:new l.aH(g,i.u_size),u_camera_to_center_distance:new l.aH(g,i.u_camera_to_center_distance),u_pitch:new l.aH(g,i.u_pitch),u_rotate_symbol:new l.aG(g,i.u_rotate_symbol),u_aspect_ratio:new l.aH(g,i.u_aspect_ratio),u_fade_change:new l.aH(g,i.u_fade_change),u_matrix:new l.aI(g,i.u_matrix),u_label_plane_matrix:new l.aI(g,i.u_label_plane_matrix),u_coord_matrix:new l.aI(g,i.u_coord_matrix),u_is_text:new l.aG(g,i.u_is_text),u_pitch_with_map:new l.aG(g,i.u_pitch_with_map),u_texsize:new l.aL(g,i.u_texsize),u_texsize_icon:new l.aL(g,i.u_texsize_icon),u_texture:new l.aG(g,i.u_texture),u_texture_icon:new l.aG(g,i.u_texture_icon),u_gamma_scale:new l.aH(g,i.u_gamma_scale),u_device_pixel_ratio:new l.aH(g,i.u_device_pixel_ratio),u_is_halo:new l.aG(g,i.u_is_halo)}),background:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_opacity:new l.aH(g,i.u_opacity),u_color:new l.aM(g,i.u_color)}),backgroundPattern:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_opacity:new l.aH(g,i.u_opacity),u_image:new l.aG(g,i.u_image),u_pattern_tl_a:new l.aL(g,i.u_pattern_tl_a),u_pattern_br_a:new l.aL(g,i.u_pattern_br_a),u_pattern_tl_b:new l.aL(g,i.u_pattern_tl_b),u_pattern_br_b:new l.aL(g,i.u_pattern_br_b),u_texsize:new l.aL(g,i.u_texsize),u_mix:new l.aH(g,i.u_mix),u_pattern_size_a:new l.aL(g,i.u_pattern_size_a),u_pattern_size_b:new l.aL(g,i.u_pattern_size_b),u_scale_a:new l.aH(g,i.u_scale_a),u_scale_b:new l.aH(g,i.u_scale_b),u_pixel_coord_upper:new l.aL(g,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(g,i.u_pixel_coord_lower),u_tile_units_to_pixels:new l.aH(g,i.u_tile_units_to_pixels)}),terrain:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_texture:new l.aG(g,i.u_texture),u_ele_delta:new l.aH(g,i.u_ele_delta)}),terrainDepth:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_ele_delta:new l.aH(g,i.u_ele_delta)}),terrainCoords:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_texture:new l.aG(g,i.u_texture),u_terrain_coords_id:new l.aH(g,i.u_terrain_coords_id),u_ele_delta:new l.aH(g,i.u_ele_delta)})};class mc{constructor(i,o,h){this.context=i;const f=i.gl;this.buffer=f.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const o=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ea={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Na{constructor(i,o,h,f){this.length=o.length,this.attributes=h,this.itemSize=o.bytesPerElement,this.dynamicDraw=f,this.context=i;const _=i.gl;this.buffer=_.createBuffer(),i.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){if(i.length!==this.length)throw new Error(`Length of new data is ${i.length}, which doesn't match current length of ${this.length}`);const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,o){for(let h=0;h<this.attributes.length;h++){const f=o.attributes[this.attributes[h].name];f!==void 0&&i.enableVertexAttribArray(f)}}setVertexAttribPointers(i,o,h){for(let f=0;f<this.attributes.length;f++){const _=this.attributes[f],M=o.attributes[_.name];M!==void 0&&i.vertexAttribPointer(M,_.components,i[ea[_.type]],!1,this.itemSize,_.offset+this.itemSize*(h||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const dn=new WeakMap;function Jr(g){var i;if(dn.has(g))return dn.get(g);{const o=(i=g.getParameter(g.VERSION))===null||i===void 0?void 0:i.startsWith("WebGL 2.0");return dn.set(g,o),o}}class zi{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Fo extends zi{getDefault(){return l.aO.transparent}set(i){const o=this.current;(i.r!==o.r||i.g!==o.g||i.b!==o.b||i.a!==o.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Bo extends zi{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class No extends zi{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class $o extends zi{getDefault(){return[!0,!0,!0,!0]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class mo extends zi{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class Al extends zi{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class Pl extends zi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const o=this.current;(i.func!==o.func||i.ref!==o.ref||i.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class ga extends zi{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Uo extends zi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=i,this.dirty=!1}}class kl extends zi{getDefault(){return[0,1]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class bn extends zi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=i,this.dirty=!1}}class gc extends zi{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class yc extends zi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.BLEND):o.disable(o.BLEND),this.current=i,this.dirty=!1}}class vu extends zi{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class _c extends zi{getDefault(){return l.aO.transparent}set(i){const o=this.current;(i.r!==o.r||i.g!==o.g||i.b!==o.b||i.a!==o.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Vo extends zi{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class vc extends zi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=i,this.dirty=!1}}class jo extends zi{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class qo extends zi{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class Bs extends zi{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class Go extends zi{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class $a extends zi{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class xc extends zi{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class Ho extends zi{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class ya extends zi{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class Ns extends zi{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Zo extends zi{getDefault(){return null}set(i){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class ta extends zi{getDefault(){return null}set(i){var o;if(i===this.current&&!this.dirty)return;const h=this.gl;Jr(h)?h.bindVertexArray(i):(o=h.getExtension("OES_vertex_array_object"))===null||o===void 0||o.bindVertexArrayOES(i),this.current=i,this.dirty=!1}}class ys extends zi{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class bc extends zi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class Dl extends zi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class ki extends zi{constructor(i,o){super(i),this.context=i,this.parent=o}getDefault(){return null}}class Wo extends ki{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class xu extends ki{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Ll extends ki{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class _a{constructor(i,o,h,f,_){this.context=i,this.width=o,this.height=h;const M=i.gl,S=this.framebuffer=M.createFramebuffer();if(this.colorAttachment=new Wo(i,S),f)this.depthAttachment=_?new Ll(i,S):new xu(i,S);else if(_)throw new Error("Stencil cannot be set without depth");if(M.checkFramebufferStatus(M.FRAMEBUFFER)!==M.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const i=this.context.gl,o=this.colorAttachment.get();if(o&&i.deleteTexture(o),this.depthAttachment){const h=this.depthAttachment.get();h&&i.deleteRenderbuffer(h)}i.deleteFramebuffer(this.framebuffer)}}class Yi{constructor(i,o,h){this.blendFunction=i,this.blendColor=o,this.mask=h}}Yi.Replace=[1,0],Yi.disabled=new Yi(Yi.Replace,l.aO.transparent,[!1,!1,!1,!1]),Yi.unblended=new Yi(Yi.Replace,l.aO.transparent,[!0,!0,!0,!0]),Yi.alphaBlended=new Yi([1,771],l.aO.transparent,[!0,!0,!0,!0]);class $s{constructor(i){var o,h;if(this.gl=i,this.clearColor=new Fo(this),this.clearDepth=new Bo(this),this.clearStencil=new No(this),this.colorMask=new $o(this),this.depthMask=new mo(this),this.stencilMask=new Al(this),this.stencilFunc=new Pl(this),this.stencilOp=new ga(this),this.stencilTest=new Uo(this),this.depthRange=new kl(this),this.depthTest=new bn(this),this.depthFunc=new gc(this),this.blend=new yc(this),this.blendFunc=new vu(this),this.blendColor=new _c(this),this.blendEquation=new Vo(this),this.cullFace=new vc(this),this.cullFaceSide=new jo(this),this.frontFace=new qo(this),this.program=new Bs(this),this.activeTexture=new Go(this),this.viewport=new $a(this),this.bindFramebuffer=new xc(this),this.bindRenderbuffer=new Ho(this),this.bindTexture=new ya(this),this.bindVertexBuffer=new Ns(this),this.bindElementBuffer=new Zo(this),this.bindVertexArray=new ta(this),this.pixelStoreUnpack=new ys(this),this.pixelStoreUnpackPremultiplyAlpha=new bc(this),this.pixelStoreUnpackFlipY=new Dl(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),Jr(i)){this.HALF_FLOAT=i.HALF_FLOAT;const f=i.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(o=i.RGBA16F)!==null&&o!==void 0?o:f==null?void 0:f.RGBA16F_EXT,this.RGB16F=(h=i.RGB16F)!==null&&h!==void 0?h:f==null?void 0:f.RGB16F_EXT,i.getExtension("EXT_color_buffer_float")}else{i.getExtension("EXT_color_buffer_half_float"),i.getExtension("OES_texture_half_float_linear");const f=i.getExtension("OES_texture_half_float");this.HALF_FLOAT=f==null?void 0:f.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,o){return new mc(this,i,o)}createVertexBuffer(i,o,h){return new Na(this,i,o,h)}createRenderbuffer(i,o,h){const f=this.gl,_=f.createRenderbuffer();return this.bindRenderbuffer.set(_),f.renderbufferStorage(f.RENDERBUFFER,i,o,h),this.bindRenderbuffer.set(null),_}createFramebuffer(i,o,h,f){return new _a(this,i,o,h,f)}clear({color:i,depth:o,stencil:h}){const f=this.gl;let _=0;i&&(_|=f.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(_|=f.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),h!==void 0&&(_|=f.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),f.clear(_)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){l.aD(i.blendFunction,Yi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}createVertexArray(){var i;return Jr(this.gl)?this.gl.createVertexArray():(i=this.gl.getExtension("OES_vertex_array_object"))===null||i===void 0?void 0:i.createVertexArrayOES()}deleteVertexArray(i){var o;return Jr(this.gl)?this.gl.deleteVertexArray(i):(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.deleteVertexArrayOES(i)}unbindVAO(){this.bindVertexArray.set(null)}}class di{constructor(i,o,h){this.func=i,this.mask=o,this.range=h}}di.ReadOnly=!1,di.ReadWrite=!0,di.disabled=new di(519,di.ReadOnly,[0,1]);const Ua=7680;class Fi{constructor(i,o,h,f,_,M){this.test=i,this.ref=o,this.mask=h,this.fail=f,this.depthFail=_,this.pass=M}}Fi.disabled=new Fi({func:519,mask:0},0,0,Ua,Ua,Ua);class Wi{constructor(i,o,h){this.enable=i,this.mode=o,this.frontFace=h}}let _s;function ia(g,i,o,h,f,_,M){const S=g.context,I=S.gl,D=g.useProgram("collisionBox"),F=[];let B=0,q=0;for(let oe=0;oe<h.length;oe++){const be=h[oe],Ae=i.getTile(be),ke=Ae.getBucket(o);if(!ke)continue;let ze=be.posMatrix;f[0]===0&&f[1]===0||(ze=g.translatePosMatrix(be.posMatrix,Ae,f,_));const Xe=M?ke.textCollisionBox:ke.iconCollisionBox,Ze=ke.collisionCircleArray;if(Ze.length>0){const at=l.F(),dt=ze;l.aP(at,ke.placementInvProjMatrix,g.transform.glCoordMatrix),l.aP(at,at,ke.placementViewportMatrix),F.push({circleArray:Ze,circleOffset:q,transform:dt,invTransform:at,coord:be}),B+=Ze.length/4,q=B}Xe&&D.draw(S,I.LINES,di.disabled,Fi.disabled,g.colorModeForRenderPass(),Wi.disabled,wt(ze,g.transform,Ae),g.style.map.terrain&&g.style.map.terrain.getTerrainData(be),o.id,Xe.layoutVertexBuffer,Xe.indexBuffer,Xe.segments,null,g.transform.zoom,null,null,Xe.collisionVertexBuffer)}if(!M||!F.length)return;const te=g.useProgram("collisionCircle"),Q=new l.aQ;Q.resize(4*B),Q._trim();let re=0;for(const oe of F)for(let be=0;be<oe.circleArray.length/4;be++){const Ae=4*be,ke=oe.circleArray[Ae+0],ze=oe.circleArray[Ae+1],Xe=oe.circleArray[Ae+2],Ze=oe.circleArray[Ae+3];Q.emplace(re++,ke,ze,Xe,Ze,0),Q.emplace(re++,ke,ze,Xe,Ze,1),Q.emplace(re++,ke,ze,Xe,Ze,2),Q.emplace(re++,ke,ze,Xe,Ze,3)}(!_s||_s.length<2*B)&&(_s=function(oe){const be=2*oe,Ae=new l.aS;Ae.resize(be),Ae._trim();for(let ke=0;ke<be;ke++){const ze=6*ke;Ae.uint16[ze+0]=4*ke+0,Ae.uint16[ze+1]=4*ke+1,Ae.uint16[ze+2]=4*ke+2,Ae.uint16[ze+3]=4*ke+2,Ae.uint16[ze+4]=4*ke+3,Ae.uint16[ze+5]=4*ke+0}return Ae}(B));const W=S.createIndexBuffer(_s,!0),pe=S.createVertexBuffer(Q,l.aR.members,!0);for(const oe of F){const be={u_matrix:oe.transform,u_inv_matrix:oe.invTransform,u_camera_to_center_distance:(Ce=g.transform).cameraToCenterDistance,u_viewport_size:[Ce.width,Ce.height]};te.draw(S,I.TRIANGLES,di.disabled,Fi.disabled,g.colorModeForRenderPass(),Wi.disabled,be,g.style.map.terrain&&g.style.map.terrain.getTerrainData(oe.coord),o.id,pe,W,l.$.simpleSegment(0,2*oe.circleOffset,oe.circleArray.length,oe.circleArray.length/2),null,g.transform.zoom,null,null,null)}var Ce;pe.destroy(),W.destroy()}Wi.disabled=new Wi(!1,1029,2305),Wi.backCCW=new Wi(!0,1029,2305);const Xo=l.an(new Float32Array(16));function Rl(g,i,o,h,f,_){const{horizontalAlign:M,verticalAlign:S}=l.at(g);return new l.P((-(M-.5)*i/f+h[0])*_,(-(S-.5)*o/f+h[1])*_)}function Ko(g,i,o,h,f,_,M,S,I,D,F){const B=g.text.placedSymbolArray,q=g.text.dynamicLayoutVertexArray,te=g.icon.dynamicLayoutVertexArray,Q={};q.clear();for(let re=0;re<B.length;re++){const W=B.get(re),pe=W.hidden||!W.crossTileID||g.allowVerticalPlacement&&!W.placedOrientation?null:h[W.crossTileID];if(pe){const Ce=new l.P(W.anchorX,W.anchorY),oe=Mr(Ce,o?M:_,F),be=ee(f.cameraToCenterDistance,oe.signedDistanceFromCamera);let Ae=l.ai(g.textSizeData,I,W)*be/l.ao;o&&(Ae*=g.tilePixelRatio/S);const{width:ke,height:ze,anchor:Xe,textOffset:Ze,textBoxScale:at}=pe,dt=Rl(Xe,ke,ze,Ze,at,Ae),ui=o?Mr(Ce.add(dt),_,F).point:oe.point.add(i?dt.rotate(-f.angle):dt),yt=g.allowVerticalPlacement&&W.placedOrientation===l.ah.vertical?Math.PI/2:0;for(let Jt=0;Jt<W.numGlyphs;Jt++)l.aj(q,ui,yt);D&&W.associatedIconIndex>=0&&(Q[W.associatedIconIndex]={shiftedAnchor:ui,angle:yt})}else Ne(W.numGlyphs,q)}if(D){te.clear();const re=g.icon.placedSymbolArray;for(let W=0;W<re.length;W++){const pe=re.get(W);if(pe.hidden)Ne(pe.numGlyphs,te);else{const Ce=Q[W];if(Ce)for(let oe=0;oe<pe.numGlyphs;oe++)l.aj(te,Ce.shiftedAnchor,Ce.angle);else Ne(pe.numGlyphs,te)}}g.icon.dynamicLayoutVertexBuffer.updateData(te)}g.text.dynamicLayoutVertexBuffer.updateData(q)}function Yo(g,i,o){return o.iconsInText&&i?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function go(g,i,o,h,f,_,M,S,I,D,F,B){const q=g.context,te=q.gl,Q=g.transform,re=S==="map",W=I==="map",pe=S!=="viewport"&&o.layout.get("symbol-placement")!=="point",Ce=re&&!W&&!pe,oe=!o.layout.get("symbol-sort-key").isConstant();let be=!1;const Ae=g.depthModeForSublayer(0,di.ReadOnly),ke=o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ze=[];for(const Xe of h){const Ze=i.getTile(Xe),at=Ze.getBucket(o);if(!at)continue;const dt=f?at.text:at.icon;if(!dt||!dt.segments.get().length||!dt.hasVisibleVertices)continue;const ui=dt.programConfigurations.get(o.id),yt=f||at.sdfIcons,Jt=f?at.textSizeData:at.iconSizeData,hi=W||Q.pitch!==0,Di=g.useProgram(Yo(yt,f,at),ui),ni=l.ag(Jt,Q.zoom),fi=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Xe);let xi,zr,Xi,as,rn=[0,0],Tr=null;if(f)zr=Ze.glyphAtlasTexture,Xi=te.LINEAR,xi=Ze.glyphAtlasTexture.size,at.iconsInText&&(rn=Ze.imageAtlasTexture.size,Tr=Ze.imageAtlasTexture,as=hi||g.options.rotating||g.options.zooming||Jt.kind==="composite"||Jt.kind==="camera"?te.LINEAR:te.NEAREST);else{const Xr=o.layout.get("icon-size").constantOr(0)!==1||at.iconsNeedLinear;zr=Ze.imageAtlasTexture,Xi=yt||g.options.rotating||g.options.zooming||Xr||hi?te.LINEAR:te.NEAREST,xi=Ze.imageAtlasTexture.size}const nn=ri(Ze,1,g.transform.zoom),os=ei(Xe.posMatrix,W,re,g.transform,nn),sa=Js(Xe.posMatrix,W,re,g.transform,nn),Ha=ke&&at.hasTextData(),Kl=o.layout.get("icon-text-fit")!=="none"&&Ha&&at.hasIconData();if(pe){const Xr=g.style.map.terrain?(Ss,Kr)=>g.style.map.terrain.getElevation(Xe,Ss,Kr):null,Cr=o.layout.get("text-rotation-alignment")==="map";U(at,Xe.posMatrix,g,f,os,sa,W,D,Cr,Xr)}const Za=g.translatePosMatrix(Xe.posMatrix,Ze,_,M),aa=pe||f&&ke||Kl?Xo:os,Wr=g.translatePosMatrix(sa,Ze,_,M,!0),Ir=yt&&o.paint.get(f?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let xr;xr=yt?at.iconsInText?Ba(Jt.kind,ni,Ce,W,g,Za,aa,Wr,xi,rn):qi(Jt.kind,ni,Ce,W,g,Za,aa,Wr,f,xi,!0):po(Jt.kind,ni,Ce,W,g,Za,aa,Wr,f,xi);const Ms={program:Di,buffers:dt,uniformValues:xr,atlasTexture:zr,atlasTextureIcon:Tr,atlasInterpolation:Xi,atlasInterpolationIcon:as,isSDF:yt,hasHalo:Ir};if(oe&&at.canOverlap){be=!0;const Xr=dt.segments.get();for(const Cr of Xr)ze.push({segments:new l.$([Cr]),sortKey:Cr.sortKey,state:Ms,terrainData:fi})}else ze.push({segments:dt.segments,sortKey:0,state:Ms,terrainData:fi})}be&&ze.sort((Xe,Ze)=>Xe.sortKey-Ze.sortKey);for(const Xe of ze){const Ze=Xe.state;if(q.activeTexture.set(te.TEXTURE0),Ze.atlasTexture.bind(Ze.atlasInterpolation,te.CLAMP_TO_EDGE),Ze.atlasTextureIcon&&(q.activeTexture.set(te.TEXTURE1),Ze.atlasTextureIcon&&Ze.atlasTextureIcon.bind(Ze.atlasInterpolationIcon,te.CLAMP_TO_EDGE)),Ze.isSDF){const at=Ze.uniformValues;Ze.hasHalo&&(at.u_is_halo=1,zl(Ze.buffers,Xe.segments,o,g,Ze.program,Ae,F,B,at,Xe.terrainData)),at.u_is_halo=0}zl(Ze.buffers,Xe.segments,o,g,Ze.program,Ae,F,B,Ze.uniformValues,Xe.terrainData)}}function zl(g,i,o,h,f,_,M,S,I,D){const F=h.context;f.draw(F,F.gl.TRIANGLES,_,M,S,Wi.disabled,I,D,o.id,g.layoutVertexBuffer,g.indexBuffer,i,o.paint,h.transform.zoom,g.programConfigurations.get(o.id),g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer)}function va(g,i,o,h,f){if(!o||!h||!h.imageAtlas)return;const _=h.imageAtlas.patternPositions;let M=_[o.to.toString()],S=_[o.from.toString()];if(!M&&S&&(M=S),!S&&M&&(S=M),!M||!S){const I=f.getPaintProperty(i);M=_[I],S=_[I]}M&&S&&g.setConstantPatternPositions(M,S)}function xa(g,i,o,h,f,_,M){const S=g.context.gl,I="fill-pattern",D=o.paint.get(I),F=D&&D.constantOr(1),B=o.getCrossfadeParameters();let q,te,Q,re,W;M?(te=F&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",q=S.LINES):(te=F?"fillPattern":"fill",q=S.TRIANGLES);const pe=D.constantOr(null);for(const Ce of h){const oe=i.getTile(Ce);if(F&&!oe.patternsLoaded())continue;const be=oe.getBucket(o);if(!be)continue;const Ae=be.programConfigurations.get(o.id),ke=g.useProgram(te,Ae),ze=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Ce);F&&(g.context.activeTexture.set(S.TEXTURE0),oe.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),Ae.updatePaintBuffers(B)),va(Ae,I,pe,oe,o);const Xe=ze?Ce:null,Ze=g.translatePosMatrix(Xe?Xe.posMatrix:Ce.posMatrix,oe,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(M){re=be.indexBuffer2,W=be.segments2;const at=[S.drawingBufferWidth,S.drawingBufferHeight];Q=te==="fillOutlinePattern"&&F?Ye(Ze,g,B,oe,at):Me(Ze,at)}else re=be.indexBuffer,W=be.segments,Q=F?ye(Ze,g,B,oe):me(Ze);ke.draw(g.context,q,f,g.stencilModeForClipping(Ce),_,Wi.disabled,Q,ze,o.id,be.layoutVertexBuffer,re,W,o.paint,g.transform.zoom,Ae)}}function Jo(g,i,o,h,f,_,M){const S=g.context,I=S.gl,D="fill-extrusion-pattern",F=o.paint.get(D),B=F.constantOr(1),q=o.getCrossfadeParameters(),te=o.paint.get("fill-extrusion-opacity"),Q=F.constantOr(null);for(const re of h){const W=i.getTile(re),pe=W.getBucket(o);if(!pe)continue;const Ce=g.style.map.terrain&&g.style.map.terrain.getTerrainData(re),oe=pe.programConfigurations.get(o.id),be=g.useProgram(B?"fillExtrusionPattern":"fillExtrusion",oe);B&&(g.context.activeTexture.set(I.TEXTURE0),W.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),oe.updatePaintBuffers(q)),va(oe,D,Q,W,o);const Ae=g.translatePosMatrix(re.posMatrix,W,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),ke=o.paint.get("fill-extrusion-vertical-gradient"),ze=B?ae(Ae,g,ke,te,re,q,W):V(Ae,g,ke,te);be.draw(S,S.gl.TRIANGLES,f,_,M,Wi.backCCW,ze,Ce,o.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,o.paint,g.transform.zoom,oe,g.style.map.terrain&&pe.centroidVertexBuffer)}}function rs(g,i,o,h,f,_,M){const S=g.context,I=S.gl,D=o.fbo;if(!D)return;const F=g.useProgram("hillshade"),B=g.style.map.terrain&&g.style.map.terrain.getTerrainData(i);S.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,D.colorAttachment.get()),F.draw(S,I.TRIANGLES,f,_,M,Wi.disabled,((q,te,Q,re)=>{const W=Q.paint.get("hillshade-shadow-color"),pe=Q.paint.get("hillshade-highlight-color"),Ce=Q.paint.get("hillshade-accent-color");let oe=Q.paint.get("hillshade-illumination-direction")*(Math.PI/180);Q.paint.get("hillshade-illumination-anchor")==="viewport"&&(oe-=q.transform.angle);const be=!q.options.moving;return{u_matrix:re?re.posMatrix:q.transform.calculatePosMatrix(te.tileID.toUnwrapped(),be),u_image:0,u_latrange:dr(0,te.tileID),u_light:[Q.paint.get("hillshade-exaggeration"),oe],u_shadow:W,u_highlight:pe,u_accent:Ce}})(g,o,h,B?i:null),B,h.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments)}function Ol(g,i,o,h,f,_){const M=g.context,S=M.gl,I=i.dem;if(I&&I.data){const D=I.dim,F=I.stride,B=I.getPixels();if(M.activeTexture.set(S.TEXTURE1),M.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||g.getTileTexture(F),i.demTexture){const te=i.demTexture;te.update(B,{premultiply:!1}),te.bind(S.NEAREST,S.CLAMP_TO_EDGE)}else i.demTexture=new Pt(M,B,S.RGBA,{premultiply:!1}),i.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);M.activeTexture.set(S.TEXTURE0);let q=i.fbo;if(!q){const te=new Pt(M,{width:D,height:D,data:null},S.RGBA);te.bind(S.LINEAR,S.CLAMP_TO_EDGE),q=i.fbo=M.createFramebuffer(D,D,!0,!1),q.colorAttachment.set(te.texture)}M.bindFramebuffer.set(q.framebuffer),M.viewport.set([0,0,D,D]),g.useProgram("hillshadePrepare").draw(M,S.TRIANGLES,h,f,_,Wi.disabled,((te,Q)=>{const re=Q.stride,W=l.F();return l.aN(W,0,l.W,-l.W,0,0,1),l.H(W,W,[0,-l.W,0]),{u_matrix:W,u_image:1,u_dimension:[re,re],u_zoom:te.overscaledZ,u_unpack:Q.getUnpackVector()}})(i.tileID,I),null,o.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments),i.needsHillshadePrepare=!1}}function ra(g,i,o,h,f,_){const M=h.paint.get("raster-fade-duration");if(!_&&M>0){const S=k.now(),I=(S-g.timeAdded)/M,D=i?(S-i.timeAdded)/M:-1,F=o.getSource(),B=f.coveringZoomLevel({tileSize:F.tileSize,roundZoom:F.roundZoom}),q=!i||Math.abs(i.tileID.overscaledZ-B)>Math.abs(g.tileID.overscaledZ-B),te=q&&g.refreshedUponExpiration?1:l.ac(q?I:1-D,0,1);return g.refreshedUponExpiration&&I>=1&&(g.refreshedUponExpiration=!1),i?{opacity:1,mix:1-te}:{opacity:te,mix:0}}return{opacity:1,mix:0}}const Fl=new l.aO(1,0,0,1),Qo=new l.aO(0,1,0,1),Va=new l.aO(0,0,1,1),Bl=new l.aO(1,0,1,1),Nl=new l.aO(0,1,1,1);function fr(g,i,o,h){jr(g,0,i+o/2,g.transform.width,o,h)}function Us(g,i,o,h){jr(g,i-o/2,0,o,g.transform.height,h)}function jr(g,i,o,h,f,_){const M=g.context,S=M.gl;S.enable(S.SCISSOR_TEST),S.scissor(i*g.pixelRatio,o*g.pixelRatio,h*g.pixelRatio,f*g.pixelRatio),M.clear({color:_}),S.disable(S.SCISSOR_TEST)}function el(g,i,o){const h=g.context,f=h.gl,_=o.posMatrix,M=g.useProgram("debug"),S=di.disabled,I=Fi.disabled,D=g.colorModeForRenderPass(),F="$debug",B=g.style.map.terrain&&g.style.map.terrain.getTerrainData(o);h.activeTexture.set(f.TEXTURE0);const q=i.getTileByID(o.key).latestRawTileData,te=Math.floor((q&&q.byteLength||0)/1024),Q=i.getTile(o).tileSize,re=512/Math.min(Q,512)*(o.overscaledZ/g.transform.zoom)*.5;let W=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(W+=` => ${o.overscaledZ}`),function(pe,Ce){pe.initDebugOverlayCanvas();const oe=pe.debugOverlayCanvas,be=pe.context.gl,Ae=pe.debugOverlayCanvas.getContext("2d");Ae.clearRect(0,0,oe.width,oe.height),Ae.shadowColor="white",Ae.shadowBlur=2,Ae.lineWidth=1.5,Ae.strokeStyle="white",Ae.textBaseline="top",Ae.font="bold 36px Open Sans, sans-serif",Ae.fillText(Ce,5,5),Ae.strokeText(Ce,5,5),pe.debugOverlayTexture.update(oe),pe.debugOverlayTexture.bind(be.LINEAR,be.CLAMP_TO_EDGE)}(g,`${W} ${te}kB`),M.draw(h,f.TRIANGLES,S,I,Yi.alphaBlended,Wi.disabled,Mt(_,l.aO.transparent,re),null,F,g.debugBuffer,g.quadTriangleIndexBuffer,g.debugSegments),M.draw(h,f.LINE_STRIP,S,I,D,Wi.disabled,Mt(_,l.aO.red),B,F,g.debugBuffer,g.tileBorderIndexBuffer,g.debugSegments)}function tl(g,i,o){const h=g.context,f=h.gl,_=g.colorModeForRenderPass(),M=new di(f.LEQUAL,di.ReadWrite,g.depthRangeFor3D),S=g.useProgram("terrain"),I=i.getTerrainMesh();h.bindFramebuffer.set(null),h.viewport.set([0,0,g.width,g.height]);for(const D of o){const F=g.renderToTexture.getTexture(D),B=i.getTerrainData(D.tileID);h.activeTexture.set(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,F.texture);const q={u_matrix:g.transform.calculatePosMatrix(D.tileID.toUnwrapped()),u_texture:0,u_ele_delta:i.getMeshFrameDelta(g.transform.zoom)};S.draw(h,f.TRIANGLES,M,Fi.disabled,_,Wi.backCCW,q,B,"terrain",I.vertexBuffer,I.indexBuffer,I.segments)}}class Se{constructor(i,o){this.context=new $s(i),this.transform=o,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=wr.maxUnderzooming+wr.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Qs}resize(i,o,h){if(this.width=Math.floor(i*h),this.height=Math.floor(o*h),this.pixelRatio=h,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style._order)this.style._layers[f].resize()}setup(){const i=this.context,o=new l.aV;o.emplaceBack(0,0),o.emplaceBack(l.W,0),o.emplaceBack(0,l.W),o.emplaceBack(l.W,l.W),this.tileExtentBuffer=i.createVertexBuffer(o,ho.members),this.tileExtentSegments=l.$.simpleSegment(0,0,4,2);const h=new l.aV;h.emplaceBack(0,0),h.emplaceBack(l.W,0),h.emplaceBack(0,l.W),h.emplaceBack(l.W,l.W),this.debugBuffer=i.createVertexBuffer(h,ho.members),this.debugSegments=l.$.simpleSegment(0,0,4,5);const f=new l.Z;f.emplaceBack(0,0,0,0),f.emplaceBack(l.W,0,l.W,0),f.emplaceBack(0,l.W,0,l.W),f.emplaceBack(l.W,l.W,l.W,l.W),this.rasterBoundsBuffer=i.createVertexBuffer(f,Be.members),this.rasterBoundsSegments=l.$.simpleSegment(0,0,4,2);const _=new l.aV;_.emplaceBack(0,0),_.emplaceBack(1,0),_.emplaceBack(0,1),_.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(_,ho.members),this.viewportSegments=l.$.simpleSegment(0,0,4,2);const M=new l.aW;M.emplaceBack(0),M.emplaceBack(1),M.emplaceBack(3),M.emplaceBack(2),M.emplaceBack(0),this.tileBorderIndexBuffer=i.createIndexBuffer(M);const S=new l.aX;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(S);const I=this.context.gl;this.stencilClearMode=new Fi({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO)}clearStencil(){const i=this.context,o=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const h=l.F();l.aN(h,0,this.width,this.height,0,0,1),l.J(h,h,[o.drawingBufferWidth,o.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(i,o.TRIANGLES,di.disabled,this.stencilClearMode,Yi.disabled,Wi.disabled,pt(h),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(i,o){if(this.currentStencilSource===i.source||!i.isTileClipped()||!o||!o.length)return;this.currentStencilSource=i.source;const h=this.context,f=h.gl;this.nextStencilID+o.length>256&&this.clearStencil(),h.setColorMode(Yi.disabled),h.setDepthMode(di.disabled);const _=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const M of o){const S=this._tileClippingMaskIDs[M.key]=this.nextStencilID++,I=this.style.map.terrain&&this.style.map.terrain.getTerrainData(M);_.draw(h,f.TRIANGLES,di.disabled,new Fi({func:f.ALWAYS,mask:0},S,255,f.KEEP,f.KEEP,f.REPLACE),Yi.disabled,Wi.disabled,pt(M.posMatrix),I,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,o=this.context.gl;return new Fi({func:o.NOTEQUAL,mask:255},i,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(i){const o=this.context.gl;return new Fi({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(i){const o=this.context.gl,h=i.sort((M,S)=>S.overscaledZ-M.overscaledZ),f=h[h.length-1].overscaledZ,_=h[0].overscaledZ-f+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const M={};for(let S=0;S<_;S++)M[S+f]=new Fi({func:o.GEQUAL,mask:255},S+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=_,[M,h]}return[{[f]:Fi.disabled},h]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new Yi([i.CONSTANT_COLOR,i.ONE],new l.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Yi.unblended:Yi.alphaBlended}depthModeForSublayer(i,o,h){if(!this.opaquePassEnabledForLayer())return di.disabled;const f=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new di(h||this.context.gl.LEQUAL,o,[f,f])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,o){this.style=i,this.options=o,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(k.now()),this.imageManager.beginFrame();const h=this.style._order,f=this.style.sourceCaches,_={},M={},S={};for(const I in f){const D=f[I];D.used&&D.prepare(this.context),_[I]=D.getVisibleCoordinates(),M[I]=_[I].slice().reverse(),S[I]=D.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let I=0;I<h.length;I++)if(this.style._layers[h[I]].is3D()){this.opaquePassCutoff=I;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const I of h){const D=this.style._layers[I];if(!D.hasOffscreenPass()||D.isHidden(this.transform.zoom))continue;const F=M[D.source];(D.type==="custom"||F.length)&&this.renderLayer(this,f[D.source],D,F)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:o.showOverdrawInspector?l.aO.black:l.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.depthRangeFor3D=[0,1-(i._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){const I=this.style._layers[h[this.currentLayer]],D=f[I.source],F=_[I.source];this._renderTileClippingMasks(I,F),this.renderLayer(this,D,I,F)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){const I=this.style._layers[h[this.currentLayer]],D=f[I.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(I))continue;const F=(I.type==="symbol"?S:M)[I.source];this._renderTileClippingMasks(I,_[I.source]),this.renderLayer(this,D,I,F)}if(this.options.showTileBoundaries){const I=function(D,F){let B=null;const q=Object.values(D._layers).flatMap(W=>W.source&&!W.isHidden(F)?[D.sourceCaches[W.source]]:[]),te=q.filter(W=>W.getSource().type==="vector"),Q=q.filter(W=>W.getSource().type!=="vector"),re=W=>{(!B||B.getSource().maxzoom<W.getSource().maxzoom)&&(B=W)};return te.forEach(W=>re(W)),B||Q.forEach(W=>re(W)),B}(this.style,this.transform.zoom);I&&function(D,F,B){for(let q=0;q<B.length;q++)el(D,F,B[q])}(this,I,I.getVisibleCoordinates())}this.options.showPadding&&function(I){const D=I.transform.padding;fr(I,I.transform.height-(D.top||0),3,Fl),fr(I,D.bottom||0,3,Qo),Us(I,D.left||0,3,Va),Us(I,I.transform.width-(D.right||0),3,Bl);const F=I.transform.centerPoint;(function(B,q,te,Q){jr(B,q-1,te-10,2,20,Q),jr(B,q-10,te-1,20,2,Q)})(I,F.x,I.transform.height-F.y,Nl)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(i){if(!this.style||!this.style.map||!this.style.map.terrain)return;const o=this.terrainFacilitator.matrix,h=this.transform.projMatrix;let f=this.terrainFacilitator.dirty;f||(f=i?!l.aY(o,h):!l.aZ(o,h)),f||(f=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),f&&(l.a_(o,h),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(_,M){const S=_.context,I=S.gl,D=Yi.unblended,F=new di(I.LEQUAL,di.ReadWrite,[0,1]),B=M.getTerrainMesh(),q=M.sourceCache.getRenderableTiles(),te=_.useProgram("terrainDepth");S.bindFramebuffer.set(M.getFramebuffer("depth").framebuffer),S.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),S.clear({color:l.aO.transparent,depth:1});for(const Q of q){const re=M.getTerrainData(Q.tileID),W={u_matrix:_.transform.calculatePosMatrix(Q.tileID.toUnwrapped()),u_ele_delta:M.getMeshFrameDelta(_.transform.zoom)};te.draw(S,I.TRIANGLES,F,Fi.disabled,D,Wi.backCCW,W,re,"terrain",B.vertexBuffer,B.indexBuffer,B.segments)}S.bindFramebuffer.set(null),S.viewport.set([0,0,_.width,_.height])}(this,this.style.map.terrain),function(_,M){const S=_.context,I=S.gl,D=Yi.unblended,F=new di(I.LEQUAL,di.ReadWrite,[0,1]),B=M.getTerrainMesh(),q=M.getCoordsTexture(),te=M.sourceCache.getRenderableTiles(),Q=_.useProgram("terrainCoords");S.bindFramebuffer.set(M.getFramebuffer("coords").framebuffer),S.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),S.clear({color:l.aO.transparent,depth:1}),M.coordsIndex=[];for(const re of te){const W=M.getTerrainData(re.tileID);S.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,q.texture);const pe={u_matrix:_.transform.calculatePosMatrix(re.tileID.toUnwrapped()),u_terrain_coords_id:(255-M.coordsIndex.length)/255,u_texture:0,u_ele_delta:M.getMeshFrameDelta(_.transform.zoom)};Q.draw(S,I.TRIANGLES,F,Fi.disabled,D,Wi.backCCW,pe,W,"terrain",B.vertexBuffer,B.indexBuffer,B.segments),M.coordsIndex.push(re.tileID.key)}S.bindFramebuffer.set(null),S.viewport.set([0,0,_.width,_.height])}(this,this.style.map.terrain))}renderLayer(i,o,h,f){if(!h.isHidden(this.transform.zoom)&&(h.type==="background"||h.type==="custom"||(f||[]).length))switch(this.id=h.id,h.type){case"symbol":(function(_,M,S,I,D){if(_.renderPass!=="translucent")return;const F=Fi.disabled,B=_.colorModeForRenderPass();(S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(q,te,Q,re,W,pe,Ce){const oe=te.transform,be=W==="map",Ae=pe==="map";for(const ke of q){const ze=re.getTile(ke),Xe=ze.getBucket(Q);if(!Xe||!Xe.text||!Xe.text.segments.get().length)continue;const Ze=l.ag(Xe.textSizeData,oe.zoom),at=ri(ze,1,te.transform.zoom),dt=ei(ke.posMatrix,Ae,be,te.transform,at),ui=Q.layout.get("icon-text-fit")!=="none"&&Xe.hasIconData();if(Ze){const yt=Math.pow(2,oe.zoom-ze.tileID.overscaledZ);Ko(Xe,be,Ae,Ce,oe,dt,ke.posMatrix,yt,Ze,ui,te.style.map.terrain?(Jt,hi)=>te.style.map.terrain.getElevation(ke,Jt,hi):null)}}}(I,_,S,M,S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),D),S.paint.get("icon-opacity").constantOr(1)!==0&&go(_,M,S,I,!1,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),S.layout.get("icon-rotation-alignment"),S.layout.get("icon-pitch-alignment"),S.layout.get("icon-keep-upright"),F,B),S.paint.get("text-opacity").constantOr(1)!==0&&go(_,M,S,I,!0,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.layout.get("text-keep-upright"),F,B),M.map.showCollisionBoxes&&(ia(_,M,S,I,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),!0),ia(_,M,S,I,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),!1))})(i,o,h,f,this.style.placement.variableOffsets);break;case"circle":(function(_,M,S,I){if(_.renderPass!=="translucent")return;const D=S.paint.get("circle-opacity"),F=S.paint.get("circle-stroke-width"),B=S.paint.get("circle-stroke-opacity"),q=!S.layout.get("circle-sort-key").isConstant();if(D.constantOr(1)===0&&(F.constantOr(1)===0||B.constantOr(1)===0))return;const te=_.context,Q=te.gl,re=_.depthModeForSublayer(0,di.ReadOnly),W=Fi.disabled,pe=_.colorModeForRenderPass(),Ce=[];for(let oe=0;oe<I.length;oe++){const be=I[oe],Ae=M.getTile(be),ke=Ae.getBucket(S);if(!ke)continue;const ze=ke.programConfigurations.get(S.id),Xe=_.useProgram("circle",ze),Ze=ke.layoutVertexBuffer,at=ke.indexBuffer,dt=_.style.map.terrain&&_.style.map.terrain.getTerrainData(be),ui={programConfiguration:ze,program:Xe,layoutVertexBuffer:Ze,indexBuffer:at,uniformValues:ot(_,be,Ae,S),terrainData:dt};if(q){const yt=ke.segments.get();for(const Jt of yt)Ce.push({segments:new l.$([Jt]),sortKey:Jt.sortKey,state:ui})}else Ce.push({segments:ke.segments,sortKey:0,state:ui})}q&&Ce.sort((oe,be)=>oe.sortKey-be.sortKey);for(const oe of Ce){const{programConfiguration:be,program:Ae,layoutVertexBuffer:ke,indexBuffer:ze,uniformValues:Xe,terrainData:Ze}=oe.state;Ae.draw(te,Q.TRIANGLES,re,W,pe,Wi.disabled,Xe,Ze,S.id,ke,ze,oe.segments,S.paint,_.transform.zoom,be)}})(i,o,h,f);break;case"heatmap":(function(_,M,S,I){if(S.paint.get("heatmap-opacity")!==0)if(_.renderPass==="offscreen"){const D=_.context,F=D.gl,B=Fi.disabled,q=new Yi([F.ONE,F.ONE],l.aO.transparent,[!0,!0,!0,!0]);(function(te,Q,re){const W=te.gl;te.activeTexture.set(W.TEXTURE1),te.viewport.set([0,0,Q.width/4,Q.height/4]);let pe=re.heatmapFbo;if(pe)W.bindTexture(W.TEXTURE_2D,pe.colorAttachment.get()),te.bindFramebuffer.set(pe.framebuffer);else{const Ce=W.createTexture();W.bindTexture(W.TEXTURE_2D,Ce),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MAG_FILTER,W.LINEAR),pe=re.heatmapFbo=te.createFramebuffer(Q.width/4,Q.height/4,!1,!1),function(oe,be,Ae,ke){var ze,Xe;const Ze=oe.gl,at=(ze=oe.HALF_FLOAT)!==null&&ze!==void 0?ze:Ze.UNSIGNED_BYTE,dt=(Xe=oe.RGBA16F)!==null&&Xe!==void 0?Xe:Ze.RGBA;Ze.texImage2D(Ze.TEXTURE_2D,0,dt,be.width/4,be.height/4,0,Ze.RGBA,at,null),ke.colorAttachment.set(Ae)}(te,Q,Ce,pe)}})(D,_,S),D.clear({color:l.aO.transparent});for(let te=0;te<I.length;te++){const Q=I[te];if(M.hasRenderableParent(Q))continue;const re=M.getTile(Q),W=re.getBucket(S);if(!W)continue;const pe=W.programConfigurations.get(S.id),Ce=_.useProgram("heatmap",pe),{zoom:oe}=_.transform;Ce.draw(D,F.TRIANGLES,di.disabled,B,q,Wi.disabled,ai(Q.posMatrix,re,oe,S.paint.get("heatmap-intensity")),null,S.id,W.layoutVertexBuffer,W.indexBuffer,W.segments,S.paint,_.transform.zoom,pe)}D.viewport.set([0,0,_.width,_.height])}else _.renderPass==="translucent"&&(_.context.setColorMode(_.colorModeForRenderPass()),function(D,F){const B=D.context,q=B.gl,te=F.heatmapFbo;if(!te)return;B.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_2D,te.colorAttachment.get()),B.activeTexture.set(q.TEXTURE1);let Q=F.colorRampTexture;Q||(Q=F.colorRampTexture=new Pt(B,F.colorRamp,q.RGBA)),Q.bind(q.LINEAR,q.CLAMP_TO_EDGE),D.useProgram("heatmapTexture").draw(B,q.TRIANGLES,di.disabled,Fi.disabled,D.colorModeForRenderPass(),Wi.disabled,((re,W,pe,Ce)=>{const oe=l.F();l.aN(oe,0,re.width,re.height,0,0,1);const be=re.context.gl;return{u_matrix:oe,u_world:[be.drawingBufferWidth,be.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:W.paint.get("heatmap-opacity")}})(D,F),null,F.id,D.viewportBuffer,D.quadTriangleIndexBuffer,D.viewportSegments,F.paint,D.transform.zoom)}(_,S))})(i,o,h,f);break;case"line":(function(_,M,S,I){if(_.renderPass!=="translucent")return;const D=S.paint.get("line-opacity"),F=S.paint.get("line-width");if(D.constantOr(1)===0||F.constantOr(1)===0)return;const B=_.depthModeForSublayer(0,di.ReadOnly),q=_.colorModeForRenderPass(),te=S.paint.get("line-dasharray"),Q=S.paint.get("line-pattern"),re=Q.constantOr(1),W=S.paint.get("line-gradient"),pe=S.getCrossfadeParameters(),Ce=re?"linePattern":te?"lineSDF":W?"lineGradient":"line",oe=_.context,be=oe.gl;let Ae=!0;for(const ke of I){const ze=M.getTile(ke);if(re&&!ze.patternsLoaded())continue;const Xe=ze.getBucket(S);if(!Xe)continue;const Ze=Xe.programConfigurations.get(S.id),at=_.context.program.get(),dt=_.useProgram(Ce,Ze),ui=Ae||dt.program!==at,yt=_.style.map.terrain&&_.style.map.terrain.getTerrainData(ke),Jt=Q.constantOr(null);if(Jt&&ze.imageAtlas){const ni=ze.imageAtlas,fi=ni.patternPositions[Jt.to.toString()],xi=ni.patternPositions[Jt.from.toString()];fi&&xi&&Ze.setConstantPatternPositions(fi,xi)}const hi=yt?ke:null,Di=re?je(_,ze,S,pe,hi):te?zt(_,ze,S,te,pe,hi):W?Lr(_,ze,S,Xe.lineClipsArray.length,hi):ci(_,ze,S,hi);if(re)oe.activeTexture.set(be.TEXTURE0),ze.imageAtlasTexture.bind(be.LINEAR,be.CLAMP_TO_EDGE),Ze.updatePaintBuffers(pe);else if(te&&(ui||_.lineAtlas.dirty))oe.activeTexture.set(be.TEXTURE0),_.lineAtlas.bind(oe);else if(W){const ni=Xe.gradients[S.id];let fi=ni.texture;if(S.gradientVersion!==ni.version){let xi=256;if(S.stepInterpolant){const zr=M.getSource().maxzoom,Xi=ke.canonical.z===zr?Math.ceil(1<<_.transform.maxZoom-ke.canonical.z):1;xi=l.ac(l.aT(Xe.maxLineLength/l.W*1024*Xi),256,oe.maxTextureSize)}ni.gradient=l.aU({expression:S.gradientExpression(),evaluationKey:"lineProgress",resolution:xi,image:ni.gradient||void 0,clips:Xe.lineClipsArray}),ni.texture?ni.texture.update(ni.gradient):ni.texture=new Pt(oe,ni.gradient,be.RGBA),ni.version=S.gradientVersion,fi=ni.texture}oe.activeTexture.set(be.TEXTURE0),fi.bind(S.stepInterpolant?be.NEAREST:be.LINEAR,be.CLAMP_TO_EDGE)}dt.draw(oe,be.TRIANGLES,B,_.stencilModeForClipping(ke),q,Wi.disabled,Di,yt,S.id,Xe.layoutVertexBuffer,Xe.indexBuffer,Xe.segments,S.paint,_.transform.zoom,Ze,Xe.layoutVertexBuffer2),Ae=!1}})(i,o,h,f);break;case"fill":(function(_,M,S,I){const D=S.paint.get("fill-color"),F=S.paint.get("fill-opacity");if(F.constantOr(1)===0)return;const B=_.colorModeForRenderPass(),q=S.paint.get("fill-pattern"),te=_.opaquePassEnabledForLayer()&&!q.constantOr(1)&&D.constantOr(l.aO.transparent).a===1&&F.constantOr(0)===1?"opaque":"translucent";if(_.renderPass===te){const Q=_.depthModeForSublayer(1,_.renderPass==="opaque"?di.ReadWrite:di.ReadOnly);xa(_,M,S,I,Q,B,!1)}if(_.renderPass==="translucent"&&S.paint.get("fill-antialias")){const Q=_.depthModeForSublayer(S.getPaintProperty("fill-outline-color")?2:0,di.ReadOnly);xa(_,M,S,I,Q,B,!0)}})(i,o,h,f);break;case"fill-extrusion":(function(_,M,S,I){const D=S.paint.get("fill-extrusion-opacity");if(D!==0&&_.renderPass==="translucent"){const F=new di(_.context.gl.LEQUAL,di.ReadWrite,_.depthRangeFor3D);if(D!==1||S.paint.get("fill-extrusion-pattern").constantOr(1))Jo(_,M,S,I,F,Fi.disabled,Yi.disabled),Jo(_,M,S,I,F,_.stencilModeFor3D(),_.colorModeForRenderPass());else{const B=_.colorModeForRenderPass();Jo(_,M,S,I,F,Fi.disabled,B)}}})(i,o,h,f);break;case"hillshade":(function(_,M,S,I){if(_.renderPass!=="offscreen"&&_.renderPass!=="translucent")return;const D=_.context,F=_.depthModeForSublayer(0,di.ReadOnly),B=_.colorModeForRenderPass(),[q,te]=_.renderPass==="translucent"?_.stencilConfigForOverlap(I):[{},I];for(const Q of te){const re=M.getTile(Q);re.needsHillshadePrepare!==void 0&&re.needsHillshadePrepare&&_.renderPass==="offscreen"?Ol(_,re,S,F,Fi.disabled,B):_.renderPass==="translucent"&&rs(_,Q,re,S,F,q[Q.overscaledZ],B)}D.viewport.set([0,0,_.width,_.height])})(i,o,h,f);break;case"raster":(function(_,M,S,I){if(_.renderPass!=="translucent"||S.paint.get("raster-opacity")===0||!I.length)return;const D=_.context,F=D.gl,B=M.getSource(),q=_.useProgram("raster"),te=_.colorModeForRenderPass(),[Q,re]=B instanceof nt?[{},I]:_.stencilConfigForOverlap(I),W=re[re.length-1].overscaledZ,pe=!_.options.moving;for(const Ce of re){const oe=_.depthModeForSublayer(Ce.overscaledZ-W,S.paint.get("raster-opacity")===1?di.ReadWrite:di.ReadOnly,F.LESS),be=M.getTile(Ce);be.registerFadeDuration(S.paint.get("raster-fade-duration"));const Ae=M.findLoadedParent(Ce,0),ke=ra(be,Ae,M,S,_.transform,_.style.map.terrain);let ze,Xe;const Ze=S.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;D.activeTexture.set(F.TEXTURE0),be.texture.bind(Ze,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),D.activeTexture.set(F.TEXTURE1),Ae?(Ae.texture.bind(Ze,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),ze=Math.pow(2,Ae.tileID.overscaledZ-be.tileID.overscaledZ),Xe=[be.tileID.canonical.x*ze%1,be.tileID.canonical.y*ze%1]):be.texture.bind(Ze,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST);const at=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Ce),dt=at?Ce:null,ui=dt?dt.posMatrix:_.transform.calculatePosMatrix(Ce.toUnwrapped(),pe),yt=_r(ui,Xe||[0,0],ze||1,ke,S);B instanceof nt?q.draw(D,F.TRIANGLES,oe,Fi.disabled,te,Wi.disabled,yt,at,S.id,B.boundsBuffer,_.quadTriangleIndexBuffer,B.boundsSegments):q.draw(D,F.TRIANGLES,oe,Q[Ce.overscaledZ],te,Wi.disabled,yt,at,S.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments)}})(i,o,h,f);break;case"background":(function(_,M,S,I){const D=S.paint.get("background-color"),F=S.paint.get("background-opacity");if(F===0)return;const B=_.context,q=B.gl,te=_.transform,Q=te.tileSize,re=S.paint.get("background-pattern");if(_.isPatternMissing(re))return;const W=!re&&D.a===1&&F===1&&_.opaquePassEnabledForLayer()?"opaque":"translucent";if(_.renderPass!==W)return;const pe=Fi.disabled,Ce=_.depthModeForSublayer(0,W==="opaque"?di.ReadWrite:di.ReadOnly),oe=_.colorModeForRenderPass(),be=_.useProgram(re?"backgroundPattern":"background"),Ae=I||te.coveringTiles({tileSize:Q,terrain:_.style.map.terrain});re&&(B.activeTexture.set(q.TEXTURE0),_.imageManager.bind(_.context));const ke=S.getCrossfadeParameters();for(const ze of Ae){const Xe=I?ze.posMatrix:_.transform.calculatePosMatrix(ze.toUnwrapped()),Ze=re?Fs(Xe,F,_,re,{tileID:ze,tileSize:Q},ke):_u(Xe,F,D),at=_.style.map.terrain&&_.style.map.terrain.getTerrainData(ze);be.draw(B,q.TRIANGLES,Ce,pe,oe,Wi.disabled,Ze,at,S.id,_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}})(i,0,h,f);break;case"custom":(function(_,M,S){const I=_.context,D=S.implementation;if(_.renderPass==="offscreen"){const F=D.prerender;F&&(_.setCustomLayerDefaults(),I.setColorMode(_.colorModeForRenderPass()),F.call(D,I.gl,_.transform.customLayerMatrix()),I.setDirty(),_.setBaseState())}else if(_.renderPass==="translucent"){_.setCustomLayerDefaults(),I.setColorMode(_.colorModeForRenderPass()),I.setStencilMode(Fi.disabled);const F=D.renderingMode==="3d"?new di(_.context.gl.LEQUAL,di.ReadWrite,_.depthRangeFor3D):_.depthModeForSublayer(0,di.ReadOnly);I.setDepthMode(F),D.render(I.gl,_.transform.customLayerMatrix()),I.setDirty(),_.setBaseState(),I.bindFramebuffer.set(null)}})(i,0,h)}}translatePosMatrix(i,o,h,f,_){if(!h[0]&&!h[1])return i;const M=_?f==="map"?this.transform.angle:0:f==="viewport"?-this.transform.angle:0;if(M){const D=Math.sin(M),F=Math.cos(M);h=[h[0]*F-h[1]*D,h[0]*D+h[1]*F]}const S=[_?h[0]:ri(o,h[0],this.transform.zoom),_?h[1]:ri(o,h[1],this.transform.zoom),0],I=new Float32Array(16);return l.H(I,i,S),I}saveTileTexture(i){const o=this._tileTextures[i.size[0]];o?o.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const o=this._tileTextures[i];return o&&o.length>0?o.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const o=this.imageManager.getPattern(i.from.toString()),h=this.imageManager.getPattern(i.to.toString());return!o||!h}useProgram(i,o){this.cache=this.cache||{};const h=i+(o?o.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[h]||(this.cache[h]=new b(this.context,fo[i],o,Cl[i],this._showOverdrawInspector,this.style.map.terrain)),this.cache[h]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Pt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:i,drawingBufferHeight:o}=this.context.gl;return this.width!==i||this.height!==o}}class De{constructor(i,o){this.points=i,this.planes=o}static fromInvProjectionMatrix(i,o,h){const f=Math.pow(2,h),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const I=1/(S=l.af([],S,i))[3]/o*f;return l.a$(S,S,[I,I,1/S[3],I])}),M=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const I=function(q,te){var Q=te[0],re=te[1],W=te[2],pe=Q*Q+re*re+W*W;return pe>0&&(pe=1/Math.sqrt(pe)),q[0]=te[0]*pe,q[1]=te[1]*pe,q[2]=te[2]*pe,q}([],function(q,te,Q){var re=te[0],W=te[1],pe=te[2],Ce=Q[0],oe=Q[1],be=Q[2];return q[0]=W*be-pe*oe,q[1]=pe*Ce-re*be,q[2]=re*oe-W*Ce,q}([],He([],_[S[0]],_[S[1]]),He([],_[S[2]],_[S[1]]))),D=-((F=I)[0]*(B=_[S[1]])[0]+F[1]*B[1]+F[2]*B[2]);var F,B;return I.concat(D)});return new De(_,M)}}class mt{constructor(i,o){this.min=i,this.max=o,this.center=function(h,f,_){return h[0]=.5*f[0],h[1]=.5*f[1],h[2]=.5*f[2],h}([],function(h,f,_){return h[0]=f[0]+_[0],h[1]=f[1]+_[1],h[2]=f[2]+_[2],h}([],this.min,this.max))}quadrant(i){const o=[i%2==0,i<2],h=Qe(this.min),f=Qe(this.max);for(let _=0;_<o.length;_++)h[_]=o[_]?this.min[_]:this.center[_],f[_]=o[_]?this.center[_]:this.max[_];return f[2]=this.max[2],new mt(h,f)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}intersects(i){const o=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let h=!0;for(let f=0;f<i.planes.length;f++){const _=i.planes[f];let M=0;for(let S=0;S<o.length;S++)l.b0(_,o[S])>=0&&M++;if(M===0)return 0;M!==o.length&&(h=!1)}if(h)return 2;for(let f=0;f<3;f++){let _=Number.MAX_VALUE,M=-Number.MAX_VALUE;for(let S=0;S<i.points.length;S++){const I=i.points[S][f]-this.min[f];_=Math.min(_,I),M=Math.max(M,I)}if(M<0||_>this.max[f]-this.min[f])return 0}return 1}}class qt{constructor(i=0,o=0,h=0,f=0){if(isNaN(i)||i<0||isNaN(o)||o<0||isNaN(h)||h<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=o,this.left=h,this.right=f}interpolate(i,o,h){return o.top!=null&&i.top!=null&&(this.top=l.z.number(i.top,o.top,h)),o.bottom!=null&&i.bottom!=null&&(this.bottom=l.z.number(i.bottom,o.bottom,h)),o.left!=null&&i.left!=null&&(this.left=l.z.number(i.left,o.left,h)),o.right!=null&&i.right!=null&&(this.right=l.z.number(i.right,o.right,h)),this}getCenter(i,o){const h=l.ac((this.left+i-this.right)/2,0,i),f=l.ac((this.top+o-this.bottom)/2,0,o);return new l.P(h,f)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new qt(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Ji=85.051129;class Ei{constructor(i,o,h,f,_){this.tileSize=512,this._renderWorldCopies=_===void 0||!!_,this._minZoom=i||0,this._maxZoom=o||22,this._minPitch=h??0,this._maxPitch=f??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new qt,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const i=new Ei(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return i.apply(this),i}apply(i){this.tileSize=i.tileSize,this.latRange=i.latRange,this.width=i.width,this.height=i.height,this._center=i._center,this._elevation=i._elevation,this.minElevationForCurrentTile=i.minElevationForCurrentTile,this.zoom=i.zoom,this.angle=i.angle,this._fov=i._fov,this._pitch=i._pitch,this._unmodified=i._unmodified,this._edgeInsets=i._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(i){const o=-l.b1(i,-180,180)*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=function(){var h=new l.A(4);return l.A!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h}(),function(h,f,_){var M=f[0],S=f[1],I=f[2],D=f[3],F=Math.sin(_),B=Math.cos(_);h[0]=M*B+I*F,h[1]=S*B+D*F,h[2]=M*-F+I*B,h[3]=S*-F+D*B}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const o=l.ac(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(i){const o=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._zoom=o,this.tileZoom=Math.max(0,Math.floor(o)),this.scale=this.zoomScale(o),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(i){i!==this._elevation&&(this._elevation=i,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,o,h){this._unmodified=!1,this._edgeInsets.interpolate(i,o,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const o=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(i){const o=[new l.b2(0,i)];if(this._renderWorldCopies){const h=this.pointCoordinate(new l.P(0,0)),f=this.pointCoordinate(new l.P(this.width,0)),_=this.pointCoordinate(new l.P(this.width,this.height)),M=this.pointCoordinate(new l.P(0,this.height)),S=Math.floor(Math.min(h.x,f.x,_.x,M.x)),I=Math.floor(Math.max(h.x,f.x,_.x,M.x)),D=1;for(let F=S-D;F<=I+D;F++)F!==0&&o.push(new l.b2(F,i))}return o}coveringTiles(i){var o,h;let f=this.coveringZoomLevel(i);const _=f;if(i.minzoom!==void 0&&f<i.minzoom)return[];i.maxzoom!==void 0&&f>i.maxzoom&&(f=i.maxzoom);const M=this.pointCoordinate(this.getCameraPoint()),S=l.Y.fromLngLat(this.center),I=Math.pow(2,f),D=[I*M.x,I*M.y,0],F=[I*S.x,I*S.y,0],B=De.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f);let q=i.minzoom||0;!i.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(q=f);const te=i.terrain?2/Math.min(this.tileSize,i.tileSize)*this.tileSize:3,Q=oe=>({aabb:new mt([oe*I,0,0],[(oe+1)*I,I,0]),zoom:0,x:0,y:0,wrap:oe,fullyVisible:!1}),re=[],W=[],pe=f,Ce=i.reparseOverscaled?_:f;if(this._renderWorldCopies)for(let oe=1;oe<=3;oe++)re.push(Q(-oe)),re.push(Q(oe));for(re.push(Q(0));re.length>0;){const oe=re.pop(),be=oe.x,Ae=oe.y;let ke=oe.fullyVisible;if(!ke){const dt=oe.aabb.intersects(B);if(dt===0)continue;ke=dt===2}const ze=i.terrain?D:F,Xe=oe.aabb.distanceX(ze),Ze=oe.aabb.distanceY(ze),at=Math.max(Math.abs(Xe),Math.abs(Ze));if(oe.zoom===pe||at>te+(1<<pe-oe.zoom)-2&&oe.zoom>=q){const dt=pe-oe.zoom,ui=D[0]-.5-(be<<dt),yt=D[1]-.5-(Ae<<dt);W.push({tileID:new l.Q(oe.zoom===pe?Ce:oe.zoom,oe.wrap,oe.zoom,be,Ae),distanceSq:lt([F[0]-.5-be,F[1]-.5-Ae]),tileDistanceToCamera:Math.sqrt(ui*ui+yt*yt)})}else for(let dt=0;dt<4;dt++){const ui=(be<<1)+dt%2,yt=(Ae<<1)+(dt>>1),Jt=oe.zoom+1;let hi=oe.aabb.quadrant(dt);if(i.terrain){const Di=new l.Q(Jt,oe.wrap,Jt,ui,yt),ni=i.terrain.getMinMaxElevation(Di),fi=(o=ni.minElevation)!==null&&o!==void 0?o:this.elevation,xi=(h=ni.maxElevation)!==null&&h!==void 0?h:this.elevation;hi=new mt([hi.min[0],hi.min[1],fi],[hi.max[0],hi.max[1],xi])}re.push({aabb:hi,zoom:Jt,x:ui,y:yt,wrap:oe.wrap,fullyVisible:ke})}}return W.sort((oe,be)=>oe.distanceSq-be.distanceSq).map(oe=>oe.tileID)}resize(i,o){this.width=i,this.height=o,this.pixelsToGLUnits=[2/i,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const o=l.ac(i.lat,-85.051129,Ji);return new l.P(l.N(i.lng)*this.worldSize,l.O(o)*this.worldSize)}unproject(i){return new l.Y(i.x/this.worldSize,i.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(i){const o=this.elevation,h=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,f=this.pointLocation(this.centerPoint,i),_=i.getElevationForLngLatZoom(f,this.tileZoom);if(!(this.elevation-_))return;const M=h+o-_,S=Math.cos(this._pitch)*this.cameraToCenterDistance/M/l.b3(1,f.lat),I=this.scaleZoom(S/this.tileSize);this._elevation=_,this._center=f,this.zoom=I}setLocationAtPoint(i,o){const h=this.pointCoordinate(o),f=this.pointCoordinate(this.centerPoint),_=this.locationCoordinate(i),M=new l.Y(_.x-(h.x-f.x),_.y-(h.y-f.y));this.center=this.coordinateLocation(M),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(i,o){return o?this.coordinatePoint(this.locationCoordinate(i),o.getElevationForLngLatZoom(i,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(i))}pointLocation(i,o){return this.coordinateLocation(this.pointCoordinate(i,o))}locationCoordinate(i){return l.Y.fromLngLat(i)}coordinateLocation(i){return i&&i.toLngLat()}pointCoordinate(i,o){if(o){const q=o.pointCoordinate(i);if(q!=null)return q}const h=[i.x,i.y,0,1],f=[i.x,i.y,1,1];l.af(h,h,this.pixelMatrixInverse),l.af(f,f,this.pixelMatrixInverse);const _=h[3],M=f[3],S=h[1]/_,I=f[1]/M,D=h[2]/_,F=f[2]/M,B=D===F?0:(0-D)/(F-D);return new l.Y(l.z.number(h[0]/_,f[0]/M,B)/this.worldSize,l.z.number(S,I,B)/this.worldSize)}coordinatePoint(i,o=0,h=this.pixelMatrix){const f=[i.x*this.worldSize,i.y*this.worldSize,o,1];return l.af(f,f,h),new l.P(f[0]/f[3],f[1]/f[3])}getBounds(){const i=Math.max(0,this.height/2-this.getHorizon());return new ce().extend(this.pointLocation(new l.P(0,i))).extend(this.pointLocation(new l.P(this.width,i))).extend(this.pointLocation(new l.P(this.width,this.height))).extend(this.pointLocation(new l.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new ce([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(i){i?(this.lngRange=[i.getWest(),i.getEast()],this.latRange=[i.getSouth(),i.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Ji])}calculatePosMatrix(i,o=!1){const h=i.key,f=o?this._alignedPosMatrixCache:this._posMatrixCache;if(f[h])return f[h];const _=i.canonical,M=this.worldSize/this.zoomScale(_.z),S=_.x+Math.pow(2,_.z)*i.wrap,I=l.an(new Float64Array(16));return l.H(I,I,[S*M,_.y*M,0]),l.J(I,I,[M/l.W,M/l.W,1]),l.K(I,o?this.alignedProjMatrix:this.projMatrix,I),f[h]=new Float32Array(I),f[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(i,o){o=l.ac(+o,this.minZoom,this.maxZoom);const h={center:new l.M(i.lng,i.lat),zoom:o};let f=this.lngRange;if(!this._renderWorldCopies&&f===null){const oe=179.9999999999;f=[-oe,oe]}const _=this.tileSize*this.zoomScale(h.zoom);let M=0,S=_,I=0,D=_,F=0,B=0;const{x:q,y:te}=this.size;if(this.latRange){const oe=this.latRange;M=l.O(oe[1])*_,S=l.O(oe[0])*_,S-M<te&&(F=te/(S-M))}f&&(I=l.b1(l.N(f[0])*_,0,_),D=l.b1(l.N(f[1])*_,0,_),D<I&&(D+=_),D-I<q&&(B=q/(D-I)));const{x:Q,y:re}=this.project.call({worldSize:_},i);let W,pe;const Ce=Math.max(B||0,F||0);if(Ce){const oe=new l.P(B?(D+I)/2:Q,F?(S+M)/2:re);return h.center=this.unproject.call({worldSize:_},oe).wrap(),h.zoom+=this.scaleZoom(Ce),h}if(this.latRange){const oe=te/2;re-oe<M&&(pe=M+oe),re+oe>S&&(pe=S-oe)}if(f){const oe=(I+D)/2;let be=Q;this._renderWorldCopies&&(be=l.b1(Q,oe-_/2,oe+_/2));const Ae=q/2;be-Ae<I&&(W=I+Ae),be+Ae>D&&(W=D-Ae)}if(W!==void 0||pe!==void 0){const oe=new l.P(W??Q,pe??re);h.center=this.unproject.call({worldSize:_},oe).wrap()}return h}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this._unmodified,{center:o,zoom:h}=this.getConstrained(this.center,this.zoom);this.center=o,this.zoom=h,this._unmodified=i,this._constraining=!1}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,o=this.point.x,h=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.b3(1,this.center.lat)*this.worldSize;let f=l.an(new Float64Array(16));l.J(f,f,[this.width/2,-this.height/2,1]),l.H(f,f,[1,-1,0]),this.labelPlaneMatrix=f,f=l.an(new Float64Array(16)),l.J(f,f,[1,-1,1]),l.H(f,f,[-1,-1,0]),l.J(f,f,[2/this.width,2/this.height,1]),this.glCoordMatrix=f;const _=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),M=Math.min(this.elevation,this.minElevationForCurrentTile),S=_-M*this._pixelPerMeter/Math.cos(this._pitch),I=M<0?S:_,D=Math.PI/2+this._pitch,F=this._fov*(.5+i.y/this.height),B=Math.sin(F)*I/Math.sin(l.ac(Math.PI-D-F,.01,Math.PI-.01)),q=this.getHorizon(),te=2*Math.atan(q/this.cameraToCenterDistance)*(.5+i.y/(2*q)),Q=Math.sin(te)*I/Math.sin(l.ac(Math.PI-D-te,.01,Math.PI-.01)),re=Math.min(B,Q),W=1.01*(Math.cos(Math.PI/2-this._pitch)*re+I),pe=this.height/50;f=new Float64Array(16),l.b4(f,this._fov,this.width/this.height,pe,W),f[8]=2*-i.x/this.width,f[9]=2*i.y/this.height,l.J(f,f,[1,-1,1]),l.H(f,f,[0,0,-this.cameraToCenterDistance]),l.b5(f,f,this._pitch),l.ad(f,f,this.angle),l.H(f,f,[-o,-h,0]),this.mercatorMatrix=l.J([],f,[this.worldSize,this.worldSize,this.worldSize]),l.J(f,f,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.K(new Float64Array(16),this.labelPlaneMatrix,f),l.H(f,f,[0,0,-this.elevation]),this.projMatrix=f,this.invProjMatrix=l.ar([],f),this.pixelMatrix3D=l.K(new Float64Array(16),this.labelPlaneMatrix,f);const Ce=this.width%2/2,oe=this.height%2/2,be=Math.cos(this.angle),Ae=Math.sin(this.angle),ke=o-Math.round(o)+be*Ce+Ae*oe,ze=h-Math.round(h)+be*oe+Ae*Ce,Xe=new Float64Array(f);if(l.H(Xe,Xe,[ke>.5?ke-1:ke,ze>.5?ze-1:ze,0]),this.alignedProjMatrix=Xe,f=l.ar(new Float64Array(16),this.pixelMatrix),!f)throw new Error("failed to invert matrix");this.pixelMatrixInverse=f,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const i=this.pointCoordinate(new l.P(0,0)),o=[i.x*this.worldSize,i.y*this.worldSize,0,1];return l.af(o,o,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(0,i))}getCameraQueryGeometry(i){const o=this.getCameraPoint();if(i.length===1)return[i[0],o];{let h=o.x,f=o.y,_=o.x,M=o.y;for(const S of i)h=Math.min(h,S.x),f=Math.min(f,S.y),_=Math.max(_,S.x),M=Math.max(M,S.y);return[new l.P(h,f),new l.P(_,f),new l.P(_,M),new l.P(h,M),new l.P(h,f)]}}lngLatToCameraDepth(i,o){const h=this.locationCoordinate(i),f=[h.x*this.worldSize,h.y*this.worldSize,o,1];return l.af(f,f,this.projMatrix),f[2]/f[3]}}function pr(g,i){let o,h=!1,f=null,_=null;const M=()=>{f=null,h&&(g.apply(_,o),f=setTimeout(M,i),h=!1)};return(...S)=>(h=!0,_=this,o=S,f||M(),f)}class Er{constructor(i){this._getCurrentHash=()=>{const o=window.location.hash.replace("#","");if(this._hashName){let h;return o.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(h=f)}),(h&&h[1]||"").split("/")}return o.split("/")},this._onHashChange=()=>{const o=this._getCurrentHash();if(o.length>=3&&!o.some(h=>isNaN(h))){const h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:h,pitch:+(o[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const o=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,o)}catch{}},this._updateHash=pr(this._updateHashUnthrottled,300),this._hashName=i&&encodeURIComponent(i)}addTo(i){return this._map=i,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(i){const o=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,f=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,f),M=Math.round(o.lng*_)/_,S=Math.round(o.lat*_)/_,I=this._map.getBearing(),D=this._map.getPitch();let F="";if(F+=i?`/${M}/${S}/${h}`:`${h}/${S}/${M}`,(I||D)&&(F+="/"+Math.round(10*I)/10),D&&(F+=`/${Math.round(D)}`),this._hashName){const B=this._hashName;let q=!1;const te=window.location.hash.slice(1).split("&").map(Q=>{const re=Q.split("=")[0];return re===B?(q=!0,`${re}=${F}`):Q}).filter(Q=>Q);return q||te.push(`${B}=${F}`),`#${te.join("&")}`}return`#${F}`}}const wn={linearity:.3,easing:l.b6(0,0,.3,1)},ar=l.e({deceleration:2500,maxSpeed:1400},wn),Br=l.e({deceleration:20,maxSpeed:1400},wn),ns=l.e({deceleration:1e3,maxSpeed:360},wn),vs=l.e({deceleration:1e3,maxSpeed:90},wn);class fn{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:k.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,o=k.now();for(;i.length>0&&o-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const o={zoom:0,bearing:0,pitch:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)o.zoom+=_.zoomDelta||0,o.bearing+=_.bearingDelta||0,o.pitch+=_.pitchDelta||0,_.panDelta&&o.pan._add(_.panDelta),_.around&&(o.around=_.around),_.pinchAround&&(o.pinchAround=_.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,f={};if(o.pan.mag()){const _=xs(o.pan.mag(),h,l.e({},ar,i||{}));f.offset=o.pan.mult(_.amount/o.pan.mag()),f.center=this._map.transform.center,Rn(f,_)}if(o.zoom){const _=xs(o.zoom,h,Br);f.zoom=this._map.transform.zoom+_.amount,Rn(f,_)}if(o.bearing){const _=xs(o.bearing,h,ns);f.bearing=this._map.transform.bearing+l.ac(_.amount,-179,179),Rn(f,_)}if(o.pitch){const _=xs(o.pitch,h,vs);f.pitch=this._map.transform.pitch+_.amount,Rn(f,_)}if(f.zoom||f.bearing){const _=o.pinchAround===void 0?o.around:o.pinchAround;f.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),l.e(f,{noMoveStart:!0})}}function Rn(g,i){(!g.duration||g.duration<i.duration)&&(g.duration=i.duration,g.easing=i.easing)}function xs(g,i,o){const{maxSpeed:h,linearity:f,deceleration:_}=o,M=l.ac(g*f/(i/1e3),-h,h),S=Math.abs(M)/(_*f);return{easing:o.easing,duration:1e3*S,amount:M*(S/2)}}class Qr extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,h,f={}){const _=R.mousePos(o.getCanvas(),h),M=o.unproject(_);super(i,l.e({point:_,lngLat:M,originalEvent:h},f)),this._defaultPrevented=!1,this.target=o}}class Mn extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,h){const f=i==="touchend"?h.changedTouches:h.touches,_=R.touchPos(o.getCanvasContainer(),f),M=_.map(I=>o.unproject(I)),S=_.reduce((I,D,F,B)=>I.add(D.div(B.length)),new l.P(0,0));super(i,{points:_,point:S,lngLats:M,lngLat:o.unproject(S),originalEvent:h}),this._defaultPrevented=!1}}class ba extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,h){super(i,{originalEvent:h}),this._defaultPrevented=!1}}class Hn{constructor(i,o){this._map=i,this._clickTolerance=o.clickTolerance}reset(){delete this._mousedownPos}wheel(i){return this._firePreventable(new ba(i.type,this._map,i))}mousedown(i,o){return this._mousedownPos=o,this._firePreventable(new Qr(i.type,this._map,i))}mouseup(i){this._map.fire(new Qr(i.type,this._map,i))}click(i,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||this._map.fire(new Qr(i.type,this._map,i))}dblclick(i){return this._firePreventable(new Qr(i.type,this._map,i))}mouseover(i){this._map.fire(new Qr(i.type,this._map,i))}mouseout(i){this._map.fire(new Qr(i.type,this._map,i))}touchstart(i){return this._firePreventable(new Mn(i.type,this._map,i))}touchmove(i){this._map.fire(new Mn(i.type,this._map,i))}touchend(i){this._map.fire(new Mn(i.type,this._map,i))}touchcancel(i){this._map.fire(new Mn(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class bs{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(i){this._map.fire(new Qr(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Qr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._ignoreContextMenu||this._map.fire(new Qr(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ja{constructor(i){this._map=i}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(i){return this.transform.pointLocation(l.P.convert(i),this._map.terrain)}}class Ii{constructor(i,o){this._map=i,this._tr=new ja(i),this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,o){this.isEnabled()&&i.shiftKey&&i.button===0&&(R.disableDrag(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(i,o){if(!this._active)return;const h=o;if(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)return;const f=this._startPos;this._lastPos=h,this._box||(this._box=R.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",i));const _=Math.min(f.x,h.x),M=Math.max(f.x,h.x),S=Math.min(f.y,h.y),I=Math.max(f.y,h.y);R.setTransform(this._box,`translate(${_}px,${S}px)`),this._box.style.width=M-_+"px",this._box.style.height=I-S+"px"}mouseupWindow(i,o){if(!this._active||i.button!==0)return;const h=this._startPos,f=o;if(this.reset(),R.suppressClick(),h.x!==f.x||h.y!==f.y)return this._map.fire(new l.k("boxzoomend",{originalEvent:i})),{cameraAnimation:_=>_.fitScreenCoordinates(h,f,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",i)}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(R.remove(this._box),this._box=null),R.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(i,o){return this._map.fire(new l.k(i,{originalEvent:o}))}}function Li(g,i){if(g.length!==i.length)throw new Error(`The number of touches and points are not equal - touches ${g.length}, points ${i.length}`);const o={};for(let h=0;h<g.length;h++)o[g[h].identifier]=i[h];return o}class il{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(i,o,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),h.length===this.numTouches&&(this.centroid=function(f){const _=new l.P(0,0);for(const M of f)_._add(M);return _.div(f.length)}(o),this.touches=Li(h,o)))}touchmove(i,o,h){if(this.aborted||!this.centroid)return;const f=Li(h,o);for(const _ in this.touches){const M=f[_];(!M||M.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(i,o,h){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const f=!this.aborted&&this.centroid;if(this.reset(),f)return f}}}class ws{constructor(i){this.singleTap=new il(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(i,o,h){this.singleTap.touchstart(i,o,h)}touchmove(i,o,h){this.singleTap.touchmove(i,o,h)}touchend(i,o,h){const f=this.singleTap.touchend(i,o,h);if(f){const _=i.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(f)<30;if(_&&M||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class $l{constructor(i){this._tr=new ja(i),this._zoomIn=new ws({numTouches:1,numTaps:2}),this._zoomOut=new ws({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,o,h){this._zoomIn.touchstart(i,o,h),this._zoomOut.touchstart(i,o,h)}touchmove(i,o,h){this._zoomIn.touchmove(i,o,h),this._zoomOut.touchmove(i,o,h)}touchend(i,o,h){const f=this._zoomIn.touchend(i,o,h),_=this._zoomOut.touchend(i,o,h),M=this._tr;return f?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:M.zoom+1,around:M.unproject(f)},{originalEvent:i})}):_?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:M.zoom-1,around:M.unproject(_)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class en{constructor(i){this._enabled=!!i.enable,this._moveStateManager=i.moveStateManager,this._clickTolerance=i.clickTolerance||1,this._moveFunction=i.move,this._activateOnStart=!!i.activateOnStart,i.assignEvents(this),this.reset()}reset(i){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(i)}_move(...i){const o=this._moveFunction(...i);if(o.bearingDelta||o.pitchDelta||o.around||o.panDelta)return this._active=!0,o}dragStart(i,o){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(i)&&(this._moveStateManager.startMove(i),this._lastPoint=o.length?o[0]:o,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(i,o){if(!this.isEnabled())return;const h=this._lastPoint;if(!h)return;if(i.preventDefault(),!this._moveStateManager.isValidMoveEvent(i))return void this.reset(i);const f=o.length?o[0]:o;return!this._moved&&f.dist(h)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=f,this._move(h,f))}dragEnd(i){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(i)&&(this._moved&&R.suppressClick(),this.reset(i))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const zn={0:1,2:2};class tn{constructor(i){this._correctEvent=i.checkCorrectEvent}startMove(i){const o=R.mouseButton(i);this._eventButton=o}endMove(i){delete this._eventButton}isValidStartEvent(i){return this._correctEvent(i)}isValidMoveEvent(i){return!function(o,h){const f=zn[h];return o.buttons===void 0||(o.buttons&f)!==f}(i,this._eventButton)}isValidEndEvent(i){return R.mouseButton(i)===this._eventButton}}class Tt{constructor(){this._firstTouch=void 0}_isOneFingerTouch(i){return i.targetTouches.length===1}_isSameTouchEvent(i){return i.targetTouches[0].identifier===this._firstTouch}startMove(i){this._firstTouch=i.targetTouches[0].identifier}endMove(i){delete this._firstTouch}isValidStartEvent(i){return this._isOneFingerTouch(i)}isValidMoveEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}isValidEndEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}}const wa=g=>{g.mousedown=g.dragStart,g.mousemoveWindow=g.dragMove,g.mouseup=g.dragEnd,g.contextmenu=function(i){i.preventDefault()}},ss=({enable:g,clickTolerance:i,bearingDegreesPerPixelMoved:o=.8})=>{const h=new tn({checkCorrectEvent:f=>R.mouseButton(f)===0&&f.ctrlKey||R.mouseButton(f)===2});return new en({clickTolerance:i,move:(f,_)=>({bearingDelta:(_.x-f.x)*o}),moveStateManager:h,enable:g,assignEvents:wa})},Zn=({enable:g,clickTolerance:i,pitchDegreesPerPixelMoved:o=-.5})=>{const h=new tn({checkCorrectEvent:f=>R.mouseButton(f)===0&&f.ctrlKey||R.mouseButton(f)===2});return new en({clickTolerance:i,move:(f,_)=>({pitchDelta:(_.y-f.y)*o}),moveStateManager:h,enable:g,assignEvents:wa})};class Ul{constructor(i,o){this._clickTolerance=i.clickTolerance||1,this._map=o,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(i,o,h){return this._calculateTransform(i,o,h)}touchmove(i,o,h){if(this._active&&!(h.length<this.minTouchs()))return i.preventDefault(),this._calculateTransform(i,o,h)}touchend(i,o,h){this._calculateTransform(i,o,h),this._active&&h.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,o,h){h.length>0&&(this._active=!0);const f=Li(h,o),_=new l.P(0,0),M=new l.P(0,0);let S=0;for(const D in f){const F=f[D],B=this._touches[D];B&&(_._add(F),M._add(F.sub(B)),S++,f[D]=F)}if(this._touches=f,S<this.minTouchs()||!M.mag())return;const I=M.div(S);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(S),panDelta:I}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vt{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(i,o,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([o[0],o[1]]))}touchmove(i,o,h){if(!this._firstTwoTouches)return;i.preventDefault();const[f,_]=this._firstTwoTouches,M=na(h,o,f),S=na(h,o,_);if(!M||!S)return;const I=this._aroundCenter?null:M.add(S).div(2);return this._move([M,S],I,i)}touchend(i,o,h){if(!this._firstTwoTouches)return;const[f,_]=this._firstTwoTouches,M=na(h,o,f),S=na(h,o,_);M&&S||(this._active&&R.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function na(g,i,o){for(let h=0;h<g.length;h++)if(g[h].identifier===o)return i[h]}function yo(g,i){return Math.log(g/i)/Math.LN2}class _o extends vt{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,o){const h=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(yo(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:yo(this._distance,h),pinchAround:o}}}function vo(g,i){return 180*g.angleWith(i)/Math.PI}class qa extends vt{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,o,h){const f=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:vo(this._vector,f),pinchAround:o}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const o=25/(Math.PI*this._minDiameter)*360,h=vo(i,this._startVector);return Math.abs(h)<o}}function Ma(g){return Math.abs(g.y)>Math.abs(g.x)}class Jh extends vt{constructor(i){super(),this._currentTouchCount=0,this._map=i}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(i,o,h){super.touchstart(i,o,h),this._currentTouchCount=h.length}_start(i){this._lastPoints=i,Ma(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,o,h){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const f=i[0].sub(this._lastPoints[0]),_=i[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(f,_,h.timeStamp),this._valid?(this._lastPoints=i,this._active=!0,{pitchDelta:(f.y+_.y)/2*-.5}):void 0}gestureBeginsVertically(i,o,h){if(this._valid!==void 0)return this._valid;const f=i.mag()>=2,_=o.mag()>=2;if(!f&&!_)return;if(!f||!_)return this._firstMove===void 0&&(this._firstMove=h),h-this._firstMove<100&&void 0;const M=i.y>0==o.y>0;return Ma(i)&&Ma(o)&&M}}const $f={panStep:100,bearingStep:15,pitchStep:10};class Ga{constructor(i){this._tr=new ja(i);const o=$f;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let o=0,h=0,f=0,_=0,M=0;switch(i.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:i.shiftKey?h=-1:(i.preventDefault(),_=-1);break;case 39:i.shiftKey?h=1:(i.preventDefault(),_=1);break;case 38:i.shiftKey?f=1:(i.preventDefault(),M=-1);break;case 40:i.shiftKey?f=-1:(i.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(h=0,f=0),{cameraAnimation:S=>{const I=this._tr;S.easeTo({duration:300,easeId:"keyboardHandler",easing:vr,zoom:o?Math.round(I.zoom)+o*(i.shiftKey?2:1):I.zoom,bearing:I.bearing+h*this._bearingStep,pitch:I.pitch+f*this._pitchStep,offset:[-_*this._panStep,-M*this._panStep],center:I.center},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function vr(g){return g*(2-g)}const Vl=4.000244140625;class wc{constructor(i,o){this._onTimeout=h=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(h)},this._map=i,this._tr=new ja(i),this._triggerRenderFrame=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(i){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!i[this._map.cooperativeGestures._bypassKey])return;let o=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const h=k.now(),f=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,o!==0&&o%Vl==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(f*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),i.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=i,this._delta-=o,this._active||this._start(i)),i.preventDefault()}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=R.mousePos(this._map.getCanvas(),i),h=this._tr;this._around=o.y>h.transform.height/2-h.transform.getHorizon()?l.M.convert(this._aroundCenter?h.center:h.unproject(o)):l.M.convert(h.center),this._aroundPoint=h.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._tr.transform;if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>Vl?this._wheelZoomRate:this._defaultZoomRate;let I=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&I!==0&&(I=1/I);const D=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):i.scale;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(D*I))),this._type==="wheel"&&(this._startZoom=i.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const o=typeof this._targetZoom=="number"?this._targetZoom:i.zoom,h=this._startZoom,f=this._easing;let _,M=!1;if(this._type==="wheel"&&h&&f){const S=Math.min((k.now()-this._lastWheelEventTime)/200,1),I=f(S);_=l.z.number(h,o,I),S<1?this._frameId||(this._frameId=!0):M=!0}else _=o,M=!0;return this._active=!0,M&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!M,zoomDelta:_-i.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let o=l.b7;if(this._prevEase){const h=this._prevEase,f=(k.now()-h.start)/h.duration,_=h.easing(f+.01)-h.easing(f),M=.27/Math.sqrt(_*_+1e-4)*.01,S=Math.sqrt(.0729-M*M);o=l.b6(M,S,.25,1)}return this._prevEase={start:k.now(),duration:i,easing:o},o}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class bu{constructor(i,o){this._clickZoom=i,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Qh{constructor(i){this._tr=new ja(i),this.reset()}reset(){this._active=!1}dblclick(i,o){return i.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:this._tr.zoom+(i.shiftKey?-1:1),around:this._tr.unproject(o)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ed{constructor(){this._tap=new ws({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(i,o,h){if(!this._swipePoint)if(this._tapTime){const f=o[0],_=i.timeStamp-this._tapTime<500,M=this._tapPoint.dist(f)<30;_&&M?h.length>0&&(this._swipePoint=f,this._swipeTouch=h[0].identifier):this.reset()}else this._tap.touchstart(i,o,h)}touchmove(i,o,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const f=o[0],_=f.y-this._swipePoint.y;return this._swipePoint=f,i.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(i,o,h)}touchend(i,o,h){if(this._tapTime)this._swipePoint&&h.length===0&&this.reset();else{const f=this._tap.touchend(i,o,h);f&&(this._tapTime=i.timeStamp,this._tapPoint=f)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class td{constructor(i,o,h){this._el=i,this._mousePan=o,this._touchPan=h}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Vs{constructor(i,o,h){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=o,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class jl{constructor(i,o,h,f){this._el=i,this._touchZoom=o,this._touchRotate=h,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Ut{constructor(i,o){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=i,this._options=o,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const i=this._map.getCanvasContainer();i.classList.add("maplibregl-cooperative-gestures"),this._container=R.create("div","maplibregl-cooperative-gesture-screen",i);let o=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(o=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const h=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),f=document.createElement("div");f.className="maplibregl-desktop-message",f.textContent=o,this._container.appendChild(f);const _=document.createElement("div");_.className="maplibregl-mobile-message",_.textContent=h,this._container.appendChild(_),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(R.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(i){this._onCooperativeGesture(i.touches.length===1)}wheel(i){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!i[this._bypassKey])}_onCooperativeGesture(i){this._enabled&&i&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Kt=g=>g.zoom||g.drag||g.pitch||g.rotate;class Mc extends l.k{}function ql(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class wu{constructor(i,o){this.handleWindowEvent=f=>{this.handleEvent(f,`${f.type}Window`)},this.handleEvent=(f,_)=>{if(f.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const M=f.type==="renderFrame"?void 0:f,S={needsRenderFrame:!1},I={},D={},F=f.touches,B=F?this._getMapTouches(F):void 0,q=B?R.touchPos(this._map.getCanvas(),B):R.mousePos(this._map.getCanvas(),f);for(const{handlerName:re,handler:W,allowed:pe}of this._handlers){if(!W.isEnabled())continue;let Ce;this._blockedByActive(D,pe,re)?W.reset():W[_||f.type]&&(Ce=W[_||f.type](f,q,B),this.mergeHandlerResult(S,I,Ce,re,M),Ce&&Ce.needsRenderFrame&&this._triggerRenderFrame()),(Ce||W.isActive())&&(D[re]=W)}const te={};for(const re in this._previousActiveHandlers)D[re]||(te[re]=M);this._previousActiveHandlers=D,(Object.keys(te).length||ql(S))&&(this._changes.push([S,I,te]),this._triggerRenderFrame()),(Object.keys(D).length||ql(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Q}=S;Q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Q(this._map))},this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new fn(i),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(o);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[window,"blur",void 0]];for(const[f,_,M]of this._listeners)R.addEventListener(f,_,f===document?this.handleWindowEvent:this.handleEvent,M)}destroy(){for(const[i,o,h]of this._listeners)R.removeEventListener(i,o,i===document?this.handleWindowEvent:this.handleEvent,h)}_addDefaultHandlers(i){const o=this._map,h=o.getCanvasContainer();this._add("mapEvent",new Hn(o,i));const f=o.boxZoom=new Ii(o,i);this._add("boxZoom",f),i.interactive&&i.boxZoom&&f.enable();const _=o.cooperativeGestures=new Ut(o,i.cooperativeGestures);this._add("cooperativeGestures",_),i.cooperativeGestures&&_.enable();const M=new $l(o),S=new Qh(o);o.doubleClickZoom=new bu(S,M),this._add("tapZoom",M),this._add("clickZoom",S),i.interactive&&i.doubleClickZoom&&o.doubleClickZoom.enable();const I=new ed;this._add("tapDragZoom",I);const D=o.touchPitch=new Jh(o);this._add("touchPitch",D),i.interactive&&i.touchPitch&&o.touchPitch.enable(i.touchPitch);const F=ss(i),B=Zn(i);o.dragRotate=new Vs(i,F,B),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",B,["mouseRotate"]),i.interactive&&i.dragRotate&&o.dragRotate.enable();const q=(({enable:Ce,clickTolerance:oe})=>{const be=new tn({checkCorrectEvent:Ae=>R.mouseButton(Ae)===0&&!Ae.ctrlKey});return new en({clickTolerance:oe,move:(Ae,ke)=>({around:ke,panDelta:ke.sub(Ae)}),activateOnStart:!0,moveStateManager:be,enable:Ce,assignEvents:wa})})(i),te=new Ul(i,o);o.dragPan=new td(h,q,te),this._add("mousePan",q),this._add("touchPan",te,["touchZoom","touchRotate"]),i.interactive&&i.dragPan&&o.dragPan.enable(i.dragPan);const Q=new qa,re=new _o;o.touchZoomRotate=new jl(h,re,Q,I),this._add("touchRotate",Q,["touchPan","touchZoom"]),this._add("touchZoom",re,["touchPan","touchRotate"]),i.interactive&&i.touchZoomRotate&&o.touchZoomRotate.enable(i.touchZoomRotate);const W=o.scrollZoom=new wc(o,()=>this._triggerRenderFrame());this._add("scrollZoom",W,["mousePan"]),i.interactive&&i.scrollZoom&&o.scrollZoom.enable(i.scrollZoom);const pe=o.keyboard=new Ga(o);this._add("keyboard",pe),i.interactive&&i.keyboard&&o.keyboard.enable(),this._add("blockableMapEvent",new bs(o))}_add(i,o,h){this._handlers.push({handlerName:i,handler:o,allowed:h}),this._handlersById[i]=o}stop(i){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Kt(this._eventsInProgress)||this.isZooming()}_blockedByActive(i,o,h){for(const f in i)if(f!==h&&(!o||o.indexOf(f)<0))return!0;return!1}_getMapTouches(i){const o=[];for(const h of i)this._el.contains(h.target)&&o.push(h);return o}mergeHandlerResult(i,o,h,f,_){if(!h)return;l.e(i,h);const M={handlerName:f,originalEvent:h.originalEvent||_};h.zoomDelta!==void 0&&(o.zoom=M),h.panDelta!==void 0&&(o.drag=M),h.pitchDelta!==void 0&&(o.pitch=M),h.bearingDelta!==void 0&&(o.rotate=M)}_applyChanges(){const i={},o={},h={};for(const[f,_,M]of this._changes)f.panDelta&&(i.panDelta=(i.panDelta||new l.P(0,0))._add(f.panDelta)),f.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+f.zoomDelta),f.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+f.bearingDelta),f.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+f.pitchDelta),f.around!==void 0&&(i.around=f.around),f.pinchAround!==void 0&&(i.pinchAround=f.pinchAround),f.noInertia&&(i.noInertia=f.noInertia),l.e(o,_),l.e(h,M);this._updateMapTransform(i,o,h),this._changes=[]}_updateMapTransform(i,o,h){const f=this._map,_=f._getTransformForUpdate(),M=f.terrain;if(!(ql(i)||M&&this._terrainMovement))return this._fireEvents(o,h,!0);let{panDelta:S,zoomDelta:I,bearingDelta:D,pitchDelta:F,around:B,pinchAround:q}=i;q!==void 0&&(B=q),f._stop(!0),B=B||f.transform.centerPoint;const te=_.pointLocation(S?B.sub(S):B);D&&(_.bearing+=D),F&&(_.pitch+=F),I&&(_.zoom+=I),M?this._terrainMovement||!o.drag&&!o.zoom?o.drag&&this._terrainMovement?_.center=_.pointLocation(_.centerPoint.sub(S)):_.setLocationAtPoint(te,B):(this._terrainMovement=!0,this._map._elevationFreeze=!0,_.setLocationAtPoint(te,B),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,_.recalculateZoom(f.terrain)})):_.setLocationAtPoint(te,B),f._applyUpdatedTransform(_),this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(o,h,!0)}_fireEvents(i,o,h){const f=Kt(this._eventsInProgress),_=Kt(i),M={};for(const F in i){const{originalEvent:B}=i[F];this._eventsInProgress[F]||(M[`${F}start`]=B),this._eventsInProgress[F]=i[F]}!f&&_&&this._fireEvent("movestart",_.originalEvent);for(const F in M)this._fireEvent(F,M[F]);_&&this._fireEvent("move",_.originalEvent);for(const F in i){const{originalEvent:B}=i[F];this._fireEvent(F,B)}const S={};let I;for(const F in this._eventsInProgress){const{handlerName:B,originalEvent:q}=this._eventsInProgress[F];this._handlersById[B].isActive()||(delete this._eventsInProgress[F],I=o[B]||q,S[`${F}end`]=I)}for(const F in S)this._fireEvent(F,S[F]);const D=Kt(this._eventsInProgress);if(h&&(f||_)&&!D){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=q=>q!==0&&-this._bearingSnap<q&&q<this._bearingSnap;!F||!F.essential&&k.prefersReducedMotion?(this._map.fire(new l.k("moveend",{originalEvent:I})),B(this._map.getBearing())&&this._map.resetNorth()):(B(F.bearing||this._map.getBearing())&&(F.bearing=0),F.freezeElevation=!0,this._map.easeTo(F,{originalEvent:I})),this._updatingCamera=!1}}_fireEvent(i,o){this._map.fire(new l.k(i,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{delete this._frameId,this.handleEvent(new Mc("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Wn extends l.E{constructor(i,o){super(),this._renderFrameCallback=()=>{const h=Math.min((k.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=o.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new l.M(this.transform.center.lng,this.transform.center.lat)}setCenter(i,o){return this.jumpTo({center:i},o)}panBy(i,o,h){return i=l.P.convert(i).mult(-1),this.panTo(this.transform.center,l.e({offset:i},o),h)}panTo(i,o,h){return this.easeTo(l.e({center:i},o),h)}getZoom(){return this.transform.zoom}setZoom(i,o){return this.jumpTo({zoom:i},o),this}zoomTo(i,o,h){return this.easeTo(l.e({zoom:i},o),h)}zoomIn(i,o){return this.zoomTo(this.getZoom()+1,i,o),this}zoomOut(i,o){return this.zoomTo(this.getZoom()-1,i,o),this}getBearing(){return this.transform.bearing}setBearing(i,o){return this.jumpTo({bearing:i},o),this}getPadding(){return this.transform.padding}setPadding(i,o){return this.jumpTo({padding:i},o),this}rotateTo(i,o,h){return this.easeTo(l.e({bearing:i},o),h)}resetNorth(i,o){return this.rotateTo(0,l.e({duration:1e3},i),o),this}resetNorthPitch(i,o){return this.easeTo(l.e({bearing:0,pitch:0,duration:1e3},i),o),this}snapToNorth(i,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,o):this}getPitch(){return this.transform.pitch}setPitch(i,o){return this.jumpTo({pitch:i},o),this}cameraForBounds(i,o){i=ce.convert(i);const h=o&&o.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),h,o)}_cameraForBoxAndBearing(i,o,h,f){const _={top:0,bottom:0,right:0,left:0};if(typeof(f=l.e({padding:_,offset:[0,0],maxZoom:this.transform.maxZoom},f)).padding=="number"){const dt=f.padding;f.padding={top:dt,bottom:dt,right:dt,left:dt}}f.padding=l.e(_,f.padding);const M=this.transform,S=M.padding,I=new ce(i,o),D=M.project(I.getNorthWest()),F=M.project(I.getNorthEast()),B=M.project(I.getSouthEast()),q=M.project(I.getSouthWest()),te=l.b8(-h),Q=D.rotate(te),re=F.rotate(te),W=B.rotate(te),pe=q.rotate(te),Ce=new l.P(Math.max(Q.x,re.x,pe.x,W.x),Math.max(Q.y,re.y,pe.y,W.y)),oe=new l.P(Math.min(Q.x,re.x,pe.x,W.x),Math.min(Q.y,re.y,pe.y,W.y)),be=Ce.sub(oe),Ae=(M.width-(S.left+S.right+f.padding.left+f.padding.right))/be.x,ke=(M.height-(S.top+S.bottom+f.padding.top+f.padding.bottom))/be.y;if(ke<0||Ae<0)return void l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ze=Math.min(M.scaleZoom(M.scale*Math.min(Ae,ke)),f.maxZoom),Xe=l.P.convert(f.offset),Ze=new l.P((f.padding.left-f.padding.right)/2,(f.padding.top-f.padding.bottom)/2).rotate(l.b8(h)),at=Xe.add(Ze).mult(M.scale/M.zoomScale(ze));return{center:M.unproject(D.add(B).div(2).sub(at)),zoom:ze,bearing:h}}fitBounds(i,o,h){return this._fitInternal(this.cameraForBounds(i,o),o,h)}fitScreenCoordinates(i,o,h,f,_){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.P.convert(i)),this.transform.pointLocation(l.P.convert(o)),h,f),f,_)}_fitInternal(i,o,h){return i?(delete(o=l.e(i,o)).padding,o.linear?this.easeTo(o,h):this.flyTo(o,h)):this}jumpTo(i,o){this.stop();const h=this._getTransformForUpdate();let f=!1,_=!1,M=!1;return"zoom"in i&&h.zoom!==+i.zoom&&(f=!0,h.zoom=+i.zoom),i.center!==void 0&&(h.center=l.M.convert(i.center)),"bearing"in i&&h.bearing!==+i.bearing&&(_=!0,h.bearing=+i.bearing),"pitch"in i&&h.pitch!==+i.pitch&&(M=!0,h.pitch=+i.pitch),i.padding==null||h.isPaddingEqual(i.padding)||(h.padding=i.padding),this._applyUpdatedTransform(h),this.fire(new l.k("movestart",o)).fire(new l.k("move",o)),f&&this.fire(new l.k("zoomstart",o)).fire(new l.k("zoom",o)).fire(new l.k("zoomend",o)),_&&this.fire(new l.k("rotatestart",o)).fire(new l.k("rotate",o)).fire(new l.k("rotateend",o)),M&&this.fire(new l.k("pitchstart",o)).fire(new l.k("pitch",o)).fire(new l.k("pitchend",o)),this.fire(new l.k("moveend",o))}calculateCameraOptionsFromTo(i,o,h,f=0){const _=l.Y.fromLngLat(i,o),M=l.Y.fromLngLat(h,f),S=M.x-_.x,I=M.y-_.y,D=M.z-_.z,F=Math.hypot(S,I,D);if(F===0)throw new Error("Can't calculate camera options with same From and To");const B=Math.hypot(S,I),q=this.transform.scaleZoom(this.transform.cameraToCenterDistance/F/this.transform.tileSize),te=180*Math.atan2(S,-I)/Math.PI;let Q=180*Math.acos(B/F)/Math.PI;return Q=D<0?90-Q:90+Q,{center:M.toLngLat(),zoom:q,pitch:Q,bearing:te}}easeTo(i,o){var h;this._stop(!1,i.easeId),((i=l.e({offset:[0,0],duration:500,easing:l.b7},i)).animate===!1||!i.essential&&k.prefersReducedMotion)&&(i.duration=0);const f=this._getTransformForUpdate(),_=this.getZoom(),M=this.getBearing(),S=this.getPitch(),I=this.getPadding(),D="bearing"in i?this._normalizeBearing(i.bearing,M):M,F="pitch"in i?+i.pitch:S,B="padding"in i?i.padding:f.padding,q=l.P.convert(i.offset);let te=f.centerPoint.add(q);const Q=f.pointLocation(te),{center:re,zoom:W}=f.getConstrained(l.M.convert(i.center||Q),(h=i.zoom)!==null&&h!==void 0?h:_);this._normalizeCenter(re);const pe=f.project(Q),Ce=f.project(re).sub(pe),oe=f.zoomScale(W-_);let be,Ae;i.around&&(be=l.M.convert(i.around),Ae=f.locationPoint(be));const ke={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||W!==_,this._rotating=this._rotating||M!==D,this._pitching=this._pitching||F!==S,this._padding=!f.isPaddingEqual(B),this._easeId=i.easeId,this._prepareEase(o,i.noMoveStart,ke),this.terrain&&this._prepareElevation(re),this._ease(ze=>{if(this._zooming&&(f.zoom=l.z.number(_,W,ze)),this._rotating&&(f.bearing=l.z.number(M,D,ze)),this._pitching&&(f.pitch=l.z.number(S,F,ze)),this._padding&&(f.interpolatePadding(I,B,ze),te=f.centerPoint.add(q)),this.terrain&&!i.freezeElevation&&this._updateElevation(ze),be)f.setLocationAtPoint(be,Ae);else{const Xe=f.zoomScale(f.zoom-_),Ze=W>_?Math.min(2,oe):Math.max(.5,oe),at=Math.pow(Ze,1-ze),dt=f.unproject(pe.add(Ce.mult(ze*at)).mult(Xe));f.setLocationAtPoint(f.renderWorldCopies?dt.wrap():dt,te)}this._applyUpdatedTransform(f),this._fireMoveEvents(o)},ze=>{this.terrain&&this._finalizeElevation(),this._afterEase(o,ze)},i),this}_prepareEase(i,o,h={}){this._moving=!0,o||h.moving||this.fire(new l.k("movestart",i)),this._zooming&&!h.zooming&&this.fire(new l.k("zoomstart",i)),this._rotating&&!h.rotating&&this.fire(new l.k("rotatestart",i)),this._pitching&&!h.pitching&&this.fire(new l.k("pitchstart",i))}_prepareElevation(i){this._elevationCenter=i,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(i){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const o=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(i<1&&o!==this._elevationTarget){const h=this._elevationTarget-this._elevationStart;this._elevationStart+=i*(h-(o-(h*i+this._elevationStart))/(1-i)),this._elevationTarget=o}this.transform.elevation=l.z.number(this._elevationStart,this._elevationTarget,i)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(i){if(!this.transformCameraUpdate)return;const o=i.clone(),{center:h,zoom:f,pitch:_,bearing:M,elevation:S}=this.transformCameraUpdate(o);h&&(o.center=h),f!==void 0&&(o.zoom=f),_!==void 0&&(o.pitch=_),M!==void 0&&(o.bearing=M),S!==void 0&&(o.elevation=S),this.transform.apply(o)}_fireMoveEvents(i){this.fire(new l.k("move",i)),this._zooming&&this.fire(new l.k("zoom",i)),this._rotating&&this.fire(new l.k("rotate",i)),this._pitching&&this.fire(new l.k("pitch",i))}_afterEase(i,o){if(this._easeId&&o&&this._easeId===o)return;delete this._easeId;const h=this._zooming,f=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,h&&this.fire(new l.k("zoomend",i)),f&&this.fire(new l.k("rotateend",i)),_&&this.fire(new l.k("pitchend",i)),this.fire(new l.k("moveend",i))}flyTo(i,o){var h;if(!i.essential&&k.prefersReducedMotion){const Di=l.L(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Di,o)}this.stop(),i=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.b7},i);const f=this._getTransformForUpdate(),_=this.getZoom(),M=this.getBearing(),S=this.getPitch(),I=this.getPadding(),D="bearing"in i?this._normalizeBearing(i.bearing,M):M,F="pitch"in i?+i.pitch:S,B="padding"in i?i.padding:f.padding,q=l.P.convert(i.offset);let te=f.centerPoint.add(q);const Q=f.pointLocation(te),{center:re,zoom:W}=f.getConstrained(l.M.convert(i.center||Q),(h=i.zoom)!==null&&h!==void 0?h:_);this._normalizeCenter(re);const pe=f.zoomScale(W-_),Ce=f.project(Q),oe=f.project(re).sub(Ce);let be=i.curve;const Ae=Math.max(f.width,f.height),ke=Ae/pe,ze=oe.mag();if("minZoom"in i){const Di=l.ac(Math.min(i.minZoom,_,W),f.minZoom,f.maxZoom),ni=Ae/f.zoomScale(Di-_);be=Math.sqrt(ni/ze*2)}const Xe=be*be;function Ze(Di){const ni=(ke*ke-Ae*Ae+(Di?-1:1)*Xe*Xe*ze*ze)/(2*(Di?ke:Ae)*Xe*ze);return Math.log(Math.sqrt(ni*ni+1)-ni)}function at(Di){return(Math.exp(Di)-Math.exp(-Di))/2}function dt(Di){return(Math.exp(Di)+Math.exp(-Di))/2}const ui=Ze(!1);let yt=function(Di){return dt(ui)/dt(ui+be*Di)},Jt=function(Di){return Ae*((dt(ui)*(at(ni=ui+be*Di)/dt(ni))-at(ui))/Xe)/ze;var ni},hi=(Ze(!0)-ui)/be;if(Math.abs(ze)<1e-6||!isFinite(hi)){if(Math.abs(Ae-ke)<1e-6)return this.easeTo(i,o);const Di=ke<Ae?-1:1;hi=Math.abs(Math.log(ke/Ae))/be,Jt=function(){return 0},yt=function(ni){return Math.exp(Di*be*ni)}}return i.duration="duration"in i?+i.duration:1e3*hi/("screenSpeed"in i?+i.screenSpeed/be:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0),this._zooming=!0,this._rotating=M!==D,this._pitching=F!==S,this._padding=!f.isPaddingEqual(B),this._prepareEase(o,!1),this.terrain&&this._prepareElevation(re),this._ease(Di=>{const ni=Di*hi,fi=1/yt(ni);f.zoom=Di===1?W:_+f.scaleZoom(fi),this._rotating&&(f.bearing=l.z.number(M,D,Di)),this._pitching&&(f.pitch=l.z.number(S,F,Di)),this._padding&&(f.interpolatePadding(I,B,Di),te=f.centerPoint.add(q)),this.terrain&&!i.freezeElevation&&this._updateElevation(Di);const xi=Di===1?re:f.unproject(Ce.add(oe.mult(Jt(ni))).mult(fi));f.setLocationAtPoint(f.renderWorldCopies?xi.wrap():xi,te),this._applyUpdatedTransform(f),this._fireMoveEvents(o)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(o)},i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const h=this._onEaseEnd;delete this._onEaseEnd,h.call(this,o)}if(!i){const h=this.handlers;h&&h.stop(!1)}return this}_ease(i,o,h){h.animate===!1||h.duration===0?(i(1),o()):(this._easeStart=k.now(),this._easeOptions=h,this._onEaseFrame=i,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(i,o){i=l.b1(i,-180,180);const h=Math.abs(i-o);return Math.abs(i-360-o)<h&&(i-=360),Math.abs(i+360-o)<h&&(i+=360),i}_normalizeCenter(i){const o=this.transform;if(!o.renderWorldCopies||o.lngRange)return;const h=i.lng-o.center.lng;i.lng+=h>180?-360:h<-180?360:0}queryTerrainElevation(i){return this.terrain?this.terrain.getElevationForLngLatZoom(l.M.convert(i),this.transform.tileZoom)-this.transform.elevation:null}}const Mu={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class js{constructor(i=Mu){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=o=>{!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"&&o.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=i}getDefaultPosition(){return"bottom-right"}onAdd(i){return this._map=i,this._compact=this.options.compact,this._container=R.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=R.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=R.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){R.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(i,o){const h=this._map._getUIString(`AttributionControl.${o}`);i.title=h,i.setAttribute("aria-label",h)}_updateAttributions(){if(!this._map.style)return;let i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map(f=>typeof f!="string"?"":f)):typeof this.options.customAttribution=="string"&&i.push(this.options.customAttribution)),this._map.style.stylesheet){const f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}const o=this._map.style.sourceCaches;for(const f in o){const _=o[f];if(_.used||_.usedForTerrain){const M=_.getSource();M.attribution&&i.indexOf(M.attribution)<0&&i.push(M.attribution)}}i=i.filter(f=>String(f).trim()),i.sort((f,_)=>f.length-_.length),i=i.filter((f,_)=>{for(let M=_+1;M<i.length;M++)if(i[M].indexOf(f)>=0)return!1;return!0});const h=i.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,i.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class id{constructor(i={}){this._updateCompact=()=>{const o=this._container.children;if(o.length){const h=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&h.classList.add("maplibregl-compact"):h.classList.remove("maplibregl-compact")}},this.options=i}getDefaultPosition(){return"bottom-left"}onAdd(i){this._map=i,this._compact=this.options&&this.options.compact,this._container=R.create("div","maplibregl-ctrl");const o=R.create("a","maplibregl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://maplibre.org/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){R.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Gl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const o=++this._id;return this._queue.push({callback:i,id:o,cancelled:!1}),o}remove(i){const o=this._currentlyRunning,h=o?this._queue.concat(o):this._queue;for(const f of h)if(f.id===i)return void(f.cancelled=!0)}run(i=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const o=this._currentlyRunning=this._queue;this._queue=[];for(const h of o)if(!h.cancelled&&(h.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Rr=l.X([{name:"a_pos3d",type:"Int16",components:3}]);class qr extends l.E{constructor(i){super(),this.sourceCache=i,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,i.usedForTerrain=!0,i.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(i,o){this.sourceCache.update(i,o),this._renderableTilesKeys=[];const h={};for(const f of i.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:o}))h[f.key]=!0,this._renderableTilesKeys.push(f.key),this._tiles[f.key]||(f.posMatrix=new Float64Array(16),l.aN(f.posMatrix,0,l.W,0,l.W,0,1),this._tiles[f.key]=new Oi(f,this.tileSize));for(const f in this._tiles)h[f]||delete this._tiles[f]}freeRtt(i){for(const o in this._tiles){const h=this._tiles[o];(!i||h.tileID.equals(i)||h.tileID.isChildOf(i)||i.isChildOf(h.tileID))&&(h.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(i=>this.getTileByID(i))}getTileByID(i){return this._tiles[i]}getTerrainCoords(i){const o={};for(const h of this._renderableTilesKeys){const f=this._tiles[h].tileID;if(f.canonical.equals(i.canonical)){const _=i.clone();_.posMatrix=new Float64Array(16),l.aN(_.posMatrix,0,l.W,0,l.W,0,1),o[h]=_}else if(f.canonical.isChildOf(i.canonical)){const _=i.clone();_.posMatrix=new Float64Array(16);const M=f.canonical.z-i.canonical.z,S=f.canonical.x-(f.canonical.x>>M<<M),I=f.canonical.y-(f.canonical.y>>M<<M),D=l.W>>M;l.aN(_.posMatrix,0,D,0,D,0,1),l.H(_.posMatrix,_.posMatrix,[-S*D,-I*D,0]),o[h]=_}else if(i.canonical.isChildOf(f.canonical)){const _=i.clone();_.posMatrix=new Float64Array(16);const M=i.canonical.z-f.canonical.z,S=i.canonical.x-(i.canonical.x>>M<<M),I=i.canonical.y-(i.canonical.y>>M<<M),D=l.W>>M;l.aN(_.posMatrix,0,l.W,0,l.W,0,1),l.H(_.posMatrix,_.posMatrix,[S*D,I*D,0]),l.J(_.posMatrix,_.posMatrix,[1/2**M,1/2**M,0]),o[h]=_}}return o}getSourceTile(i,o){const h=this.sourceCache._source;let f=i.overscaledZ-this.deltaZoom;if(f>h.maxzoom&&(f=h.maxzoom),f<h.minzoom)return null;this._sourceTileCache[i.key]||(this._sourceTileCache[i.key]=i.scaledTo(f).key);let _=this.sourceCache.getTileByID(this._sourceTileCache[i.key]);if((!_||!_.dem)&&o)for(;f>=h.minzoom&&(!_||!_.dem);)_=this.sourceCache.getTileByID(i.scaledTo(f--).key);return _}tilesAfterTime(i=Date.now()){return Object.values(this._tiles).filter(o=>o.timeAdded>=i)}}class rd{constructor(i,o,h){this.painter=i,this.sourceCache=new qr(o),this.options=h,this.exaggeration=typeof h.exaggeration=="number"?h.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(i,o,h,f=l.W){var _;if(!(o>=0&&o<f&&h>=0&&h<f))return 0;const M=this.getTerrainData(i),S=(_=M.tile)===null||_===void 0?void 0:_.dem;if(!S)return 0;const I=function(Q,re,W){var pe=re[0],Ce=re[1];return Q[0]=W[0]*pe+W[4]*Ce+W[12],Q[1]=W[1]*pe+W[5]*Ce+W[13],Q}([],[o/f*l.W,h/f*l.W],M.u_terrain_matrix),D=[I[0]*S.dim,I[1]*S.dim],F=Math.floor(D[0]),B=Math.floor(D[1]),q=D[0]-F,te=D[1]-B;return S.get(F,B)*(1-q)*(1-te)+S.get(F+1,B)*q*(1-te)+S.get(F,B+1)*(1-q)*te+S.get(F+1,B+1)*q*te}getElevationForLngLatZoom(i,o){const{tileID:h,mercatorX:f,mercatorY:_}=this._getOverscaledTileIDFromLngLatZoom(i,o);return this.getElevation(h,f%l.W,_%l.W,l.W)}getElevation(i,o,h,f=l.W){return this.getDEMElevation(i,o,h,f)*this.exaggeration}getTerrainData(i){if(!this._emptyDemTexture){const f=this.painter.context,_=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Pt(f,_,f.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Pt(f,new l.R({width:1,height:1}),f.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.an([])}const o=this.sourceCache.getSourceTile(i,!0);if(o&&o.dem&&(!o.demTexture||o.needsTerrainPrepare)){const f=this.painter.context;o.demTexture=this.painter.getTileTexture(o.dem.stride),o.demTexture?o.demTexture.update(o.dem.getPixels(),{premultiply:!1}):o.demTexture=new Pt(f,o.dem.getPixels(),f.gl.RGBA,{premultiply:!1}),o.demTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),o.needsTerrainPrepare=!1}const h=o&&o+o.tileID.key+i.key;if(h&&!this._demMatrixCache[h]){const f=this.sourceCache.sourceCache._source.maxzoom;let _=i.canonical.z-o.tileID.canonical.z;i.overscaledZ>i.canonical.z&&(i.canonical.z>=f?_=i.canonical.z-f:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const M=i.canonical.x-(i.canonical.x>>_<<_),S=i.canonical.y-(i.canonical.y>>_<<_),I=l.b9(new Float64Array(16),[1/(l.W<<_),1/(l.W<<_),0]);l.H(I,I,[M*l.W,S*l.W,0]),this._demMatrixCache[i.key]={matrix:I,coord:i}}return{u_depth:2,u_terrain:3,u_terrain_dim:o&&o.dem&&o.dem.dim||1,u_terrain_matrix:h?this._demMatrixCache[i.key].matrix:this._emptyDemMatrix,u_terrain_unpack:o&&o.dem&&o.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(o&&o.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:o}}getFramebuffer(i){const o=this.painter,h=o.width/devicePixelRatio,f=o.height/devicePixelRatio;return!this._fbo||this._fbo.width===h&&this._fbo.height===f||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Pt(o.context,{width:h,height:f,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Pt(o.context,{width:h,height:f,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=o.context.createFramebuffer(h,f,!0,!1),this._fbo.depthAttachment.set(o.context.createRenderbuffer(o.context.gl.DEPTH_COMPONENT16,h,f))),this._fbo.colorAttachment.set(i==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const i=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const o=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let _=0,M=0;_<this._coordsTextureSize;_++)for(let S=0;S<this._coordsTextureSize;S++,M+=4)o[M+0]=255&S,o[M+1]=255&_,o[M+2]=S>>8<<4|_>>8,o[M+3]=0;const h=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(o.buffer)),f=new Pt(i,h,i.gl.RGBA,{premultiply:!1});return f.bind(i.gl.NEAREST,i.gl.CLAMP_TO_EDGE),this._coordsTexture=f,f}pointCoordinate(i){this.painter.maybeDrawDepthAndCoords(!0);const o=new Uint8Array(4),h=this.painter.context,f=h.gl,_=Math.round(i.x*this.painter.pixelRatio/devicePixelRatio),M=Math.round(i.y*this.painter.pixelRatio/devicePixelRatio),S=Math.round(this.painter.height/devicePixelRatio);h.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),f.readPixels(_,S-M-1,1,1,f.RGBA,f.UNSIGNED_BYTE,o),h.bindFramebuffer.set(null);const I=o[0]+(o[2]>>4<<8),D=o[1]+((15&o[2])<<8),F=this.coordsIndex[255-o[3]],B=F&&this.sourceCache.getTileByID(F);if(!B)return null;const q=this._coordsTextureSize,te=(1<<B.tileID.canonical.z)*q;return new l.Y((B.tileID.canonical.x*q+I)/te+B.tileID.wrap,(B.tileID.canonical.y*q+D)/te,this.getElevation(B.tileID,I,D,q))}depthAtPoint(i){const o=new Uint8Array(4),h=this.painter.context,f=h.gl;return h.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),f.readPixels(i.x,this.painter.height/devicePixelRatio-i.y-1,1,1,f.RGBA,f.UNSIGNED_BYTE,o),h.bindFramebuffer.set(null),(o[0]/16777216+o[1]/65536+o[2]/256+o[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const i=this.painter.context,o=new l.ba,h=new l.aX,f=this.meshSize,_=l.W/f,M=f*f;for(let B=0;B<=f;B++)for(let q=0;q<=f;q++)o.emplaceBack(q*_,B*_,0);for(let B=0;B<M;B+=f+1)for(let q=0;q<f;q++)h.emplaceBack(q+B,f+q+B+1,f+q+B+2),h.emplaceBack(q+B,f+q+B+2,q+B+1);const S=o.length,I=S+2*(f+1);for(const B of[0,1])for(let q=0;q<=f;q++)for(const te of[0,1])o.emplaceBack(q*_,B*l.W,te);for(let B=0;B<2*f;B+=2)h.emplaceBack(I+B,I+B+1,I+B+3),h.emplaceBack(I+B,I+B+3,I+B+2),h.emplaceBack(S+B,S+B+3,S+B+1),h.emplaceBack(S+B,S+B+2,S+B+3);const D=o.length,F=D+2*(f+1);for(const B of[0,1])for(let q=0;q<=f;q++)for(const te of[0,1])o.emplaceBack(B*l.W,q*_,te);for(let B=0;B<2*f;B+=2)h.emplaceBack(D+B,D+B+1,D+B+3),h.emplaceBack(D+B,D+B+3,D+B+2),h.emplaceBack(F+B,F+B+3,F+B+1),h.emplaceBack(F+B,F+B+2,F+B+3);return this._mesh={indexBuffer:i.createIndexBuffer(h),vertexBuffer:i.createVertexBuffer(o,Rr.members),segments:l.$.simpleSegment(0,0,o.length,h.length)},this._mesh}getMeshFrameDelta(i){return 2*Math.PI*l.bb/Math.pow(2,i)/5}getMinTileElevationForLngLatZoom(i,o){var h;const{tileID:f}=this._getOverscaledTileIDFromLngLatZoom(i,o);return(h=this.getMinMaxElevation(f).minElevation)!==null&&h!==void 0?h:0}getMinMaxElevation(i){const o=this.getTerrainData(i).tile,h={minElevation:null,maxElevation:null};return o&&o.dem&&(h.minElevation=o.dem.min*this.exaggeration,h.maxElevation=o.dem.max*this.exaggeration),h}_getOverscaledTileIDFromLngLatZoom(i,o){const h=l.Y.fromLngLat(i.wrap()),f=(1<<o)*l.W,_=h.x*f,M=h.y*f,S=Math.floor(_/l.W),I=Math.floor(M/l.W);return{tileID:new l.Q(o,0,o,S,I),mercatorX:_,mercatorY:M}}}class Hl{constructor(i,o,h){this._context=i,this._size=o,this._tileSize=h,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const i of this._objects)i.texture.destroy(),i.fbo.destroy()}_createObject(i){const o=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),h=new Pt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return h.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),o.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),o.colorAttachment.set(h.texture),{id:i,fbo:o,texture:h,stamp:-1,inUse:!1}}getObjectForId(i){return this._objects[i]}useObject(i){i.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(o=>i.id!==o),this._recentlyUsed.push(i.id)}stampObject(i){i.stamp=++this._stamp}getOrCreateFreeObject(){for(const o of this._recentlyUsed)if(!this._objects[o].inUse)return this._objects[o];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const i=this._createObject(this._objects.length);return this._objects.push(i),i}freeObject(i){i.inUse=!1}freeAllObjects(){for(const i of this._objects)this.freeObject(i)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(i=>!i.inUse)===!1}}const Sa={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Su{constructor(i,o){this.painter=i,this.terrain=o,this.pool=new Hl(i.context,30,o.sourceCache.tileSize*o.qualityFactor)}destruct(){this.pool.destruct()}getTexture(i){return this.pool.getObjectForId(i.rtt[this._stacks.length-1].id).texture}prepareForRender(i,o){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=i._order.filter(h=>!i._layers[h].isHidden(o)),this._coordsDescendingInv={};for(const h in i.sourceCaches){this._coordsDescendingInv[h]={};const f=i.sourceCaches[h].getVisibleCoordinates();for(const _ of f){const M=this.terrain.sourceCache.getTerrainCoords(_);for(const S in M)this._coordsDescendingInv[h][S]||(this._coordsDescendingInv[h][S]=[]),this._coordsDescendingInv[h][S].push(M[S])}}this._coordsDescendingInvStr={};for(const h of i._order){const f=i._layers[h],_=f.source;if(Sa[f.type]&&!this._coordsDescendingInvStr[_]){this._coordsDescendingInvStr[_]={};for(const M in this._coordsDescendingInv[_])this._coordsDescendingInvStr[_][M]=this._coordsDescendingInv[_][M].map(S=>S.key).sort().join()}}for(const h of this._renderableTiles)for(const f in this._coordsDescendingInvStr){const _=this._coordsDescendingInvStr[f][h.tileID.key];_&&_!==h.rttCoords[f]&&(h.rtt=[])}}renderLayer(i){if(i.isHidden(this.painter.transform.zoom))return!1;const o=i.type,h=this.painter,f=this._renderableLayerIds[this._renderableLayerIds.length-1]===i.id;if(Sa[o]&&(this._prevType&&Sa[this._prevType]||this._stacks.push([]),this._prevType=o,this._stacks[this._stacks.length-1].push(i.id),!f))return!0;if(Sa[this._prevType]||Sa[o]&&f){this._prevType=o;const _=this._stacks.length-1,M=this._stacks[_]||[];for(const S of this._renderableTiles){if(this.pool.isFull()&&(tl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(S),S.rtt[_]){const D=this.pool.getObjectForId(S.rtt[_].id);if(D.stamp===S.rtt[_].stamp){this.pool.useObject(D);continue}}const I=this.pool.getOrCreateFreeObject();this.pool.useObject(I),this.pool.stampObject(I),S.rtt[_]={id:I.id,stamp:I.stamp},h.context.bindFramebuffer.set(I.fbo.framebuffer),h.context.clear({color:l.aO.transparent,stencil:0}),h.currentStencilSource=void 0;for(let D=0;D<M.length;D++){const F=h.style._layers[M[D]],B=F.source?this._coordsDescendingInv[F.source][S.tileID.key]:[S.tileID];h.context.viewport.set([0,0,I.fbo.width,I.fbo.height]),h._renderTileClippingMasks(F,B),h.renderLayer(h,h.style.sourceCaches[F.source],F,B),F.source&&(S.rttCoords[F.source]=this._coordsDescendingInvStr[F.source][S.tileID.key])}}return tl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Sa[o]}return!1}}const Eu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Tu=T,Zl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Mu,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Sc=g=>{g.touchstart=g.dragStart,g.touchmoveWindow=g.dragMove,g.touchend=g.dragEnd},Iu={showCompass:!0,showZoom:!0,visualizePitch:!1};class Cu{constructor(i,o,h=!1){this.mousedown=M=>{this.startMouse(l.e({},M,{ctrlKey:!0,preventDefault:()=>M.preventDefault()}),R.mousePos(this.element,M)),R.addEventListener(window,"mousemove",this.mousemove),R.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=M=>{this.moveMouse(M,R.mousePos(this.element,M))},this.mouseup=M=>{this.mouseRotate.dragEnd(M),this.mousePitch&&this.mousePitch.dragEnd(M),this.offTemp()},this.touchstart=M=>{M.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=R.touchPos(this.element,M.targetTouches)[0],this.startTouch(M,this._startPos),R.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.addEventListener(window,"touchend",this.touchend))},this.touchmove=M=>{M.targetTouches.length!==1?this.reset():(this._lastPos=R.touchPos(this.element,M.targetTouches)[0],this.moveTouch(M,this._lastPos))},this.touchend=M=>{M.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const f=i.dragRotate._mouseRotate.getClickTolerance(),_=i.dragRotate._mousePitch.getClickTolerance();this.element=o,this.mouseRotate=ss({clickTolerance:f,enable:!0}),this.touchRotate=(({enable:M,clickTolerance:S,bearingDegreesPerPixelMoved:I=.8})=>{const D=new Tt;return new en({clickTolerance:S,move:(F,B)=>({bearingDelta:(B.x-F.x)*I}),moveStateManager:D,enable:M,assignEvents:Sc})})({clickTolerance:f,enable:!0}),this.map=i,h&&(this.mousePitch=Zn({clickTolerance:_,enable:!0}),this.touchPitch=(({enable:M,clickTolerance:S,pitchDegreesPerPixelMoved:I=-.5})=>{const D=new Tt;return new en({clickTolerance:S,move:(F,B)=>({pitchDelta:(B.y-F.y)*I}),moveStateManager:D,enable:M,assignEvents:Sc})})({clickTolerance:_,enable:!0})),R.addEventListener(o,"mousedown",this.mousedown),R.addEventListener(o,"touchstart",this.touchstart,{passive:!1}),R.addEventListener(o,"touchcancel",this.reset)}startMouse(i,o){this.mouseRotate.dragStart(i,o),this.mousePitch&&this.mousePitch.dragStart(i,o),R.disableDrag()}startTouch(i,o){this.touchRotate.dragStart(i,o),this.touchPitch&&this.touchPitch.dragStart(i,o),R.disableDrag()}moveMouse(i,o){const h=this.map,{bearingDelta:f}=this.mouseRotate.dragMove(i,o)||{};if(f&&h.setBearing(h.getBearing()+f),this.mousePitch){const{pitchDelta:_}=this.mousePitch.dragMove(i,o)||{};_&&h.setPitch(h.getPitch()+_)}}moveTouch(i,o){const h=this.map,{bearingDelta:f}=this.touchRotate.dragMove(i,o)||{};if(f&&h.setBearing(h.getBearing()+f),this.touchPitch){const{pitchDelta:_}=this.touchPitch.dragMove(i,o)||{};_&&h.setPitch(h.getPitch()+_)}}off(){const i=this.element;R.removeEventListener(i,"mousedown",this.mousedown),R.removeEventListener(i,"touchstart",this.touchstart,{passive:!1}),R.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.removeEventListener(window,"touchend",this.touchend),R.removeEventListener(i,"touchcancel",this.reset),this.offTemp()}offTemp(){R.enableDrag(),R.removeEventListener(window,"mousemove",this.mousemove),R.removeEventListener(window,"mouseup",this.mouseup),R.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.removeEventListener(window,"touchend",this.touchend)}}let Ea;function Ec(g,i,o){const h=new l.M(g.lng,g.lat);if(g=new l.M(g.lng,g.lat),i){const f=new l.M(g.lng-360,g.lat),_=new l.M(g.lng+360,g.lat),M=o.locationPoint(g).distSqr(i);o.locationPoint(f).distSqr(i)<M?g=f:o.locationPoint(_).distSqr(i)<M&&(g=_)}for(;Math.abs(g.lng-o.center.lng)>180;){const f=o.locationPoint(g);if(f.x>=0&&f.y>=0&&f.x<=o.width&&f.y<=o.height)break;g.lng>o.center.lng?g.lng-=360:g.lng+=360}return g.lng!==h.lng&&o.locationPoint(g).y>o.height/2-o.getHorizon()?g:h}const Wl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Tc(g,i,o){const h=g.classList;for(const f in Wl)h.remove(`maplibregl-${o}-anchor-${f}`);h.add(`maplibregl-${o}-anchor-${i}`)}class Xl extends l.E{constructor(i){if(super(),this._onKeyPress=o=>{const h=o.code,f=o.charCode||o.keyCode;h!=="Space"&&h!=="Enter"&&f!==32&&f!==13||this.togglePopup()},this._onMapClick=o=>{const h=o.originalEvent.target,f=this._element;this._popup&&(h===f||f.contains(h))&&this.togglePopup()},this._update=o=>{var h;if(!this._map)return;const f=this._map.loaded()&&!this._map.isMoving();((o==null?void 0:o.type)==="terrain"||(o==null?void 0:o.type)==="render"&&!f)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Ec(this._lngLat,this._flatPos,this._map.transform):(h=this._lngLat)===null||h===void 0?void 0:h.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let _="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?_=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(_=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let M="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?M="rotateX(0deg)":this._pitchAlignment==="map"&&(M=`rotateX(${this._map.getPitch()}deg)`),o&&o.type!=="moveend"||(this._pos=this._pos.round()),R.setTransform(this._element,`${Wl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${M} ${_}`),k.frameAsync(new AbortController).then(()=>{this._updateOpacity(o&&o.type==="moveend")}).catch(()=>{})},this._onMove=o=>{if(!this._isDragging){const h=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.k("dragstart"))),this.fire(new l.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.k("dragend")),this._state="inactive"},this._addDragHandler=o=>{this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment!=="auto"?i.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(i==null?void 0:i.opacity,i==null?void 0:i.opacityWhenCovered),i&&i.element)this._element=i.element,this._offset=l.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=R.create("div"),this._element.setAttribute("aria-label","Map marker");const o=R.createNS("http://www.w3.org/2000/svg","svg"),h=41,f=27;o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height",`${h}px`),o.setAttributeNS(null,"width",`${f}px`),o.setAttributeNS(null,"viewBox",`0 0 ${f} ${h}`);const _=R.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"stroke","none"),_.setAttributeNS(null,"stroke-width","1"),_.setAttributeNS(null,"fill","none"),_.setAttributeNS(null,"fill-rule","evenodd");const M=R.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill-rule","nonzero");const S=R.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(3.0, 29.0)"),S.setAttributeNS(null,"fill","#000000");const I=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const pe of I){const Ce=R.createNS("http://www.w3.org/2000/svg","ellipse");Ce.setAttributeNS(null,"opacity","0.04"),Ce.setAttributeNS(null,"cx","10.5"),Ce.setAttributeNS(null,"cy","5.80029008"),Ce.setAttributeNS(null,"rx",pe.rx),Ce.setAttributeNS(null,"ry",pe.ry),S.appendChild(Ce)}const D=R.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"fill",this._color);const F=R.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),D.appendChild(F);const B=R.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"opacity","0.25"),B.setAttributeNS(null,"fill","#000000");const q=R.createNS("http://www.w3.org/2000/svg","path");q.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),B.appendChild(q);const te=R.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"transform","translate(6.0, 7.0)"),te.setAttributeNS(null,"fill","#FFFFFF");const Q=R.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"transform","translate(8.0, 8.0)");const re=R.createNS("http://www.w3.org/2000/svg","circle");re.setAttributeNS(null,"fill","#000000"),re.setAttributeNS(null,"opacity","0.25"),re.setAttributeNS(null,"cx","5.5"),re.setAttributeNS(null,"cy","5.5"),re.setAttributeNS(null,"r","5.4999962");const W=R.createNS("http://www.w3.org/2000/svg","circle");W.setAttributeNS(null,"fill","#FFFFFF"),W.setAttributeNS(null,"cx","5.5"),W.setAttributeNS(null,"cy","5.5"),W.setAttributeNS(null,"r","5.4999962"),Q.appendChild(re),Q.appendChild(W),M.appendChild(S),M.appendChild(D),M.appendChild(B),M.appendChild(te),M.appendChild(Q),o.appendChild(M),o.setAttributeNS(null,"height",h*this._scale+"px"),o.setAttributeNS(null,"width",f*this._scale+"px"),this._element.appendChild(o),this._offset=l.P.convert(i&&i.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",o=>{o.preventDefault()}),this._element.addEventListener("mousedown",o=>{o.preventDefault()}),Tc(this._element,this._anchor,"marker"),i&&i.className)for(const o of i.className.split(" "))this._element.classList.add(o);this._popup=null}addTo(i){return this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._update),i.on("moveend",this._update),i.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),R.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=l.M.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const f=Math.abs(13.5)/Math.SQRT2;i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(38.1-13.5+f)],"bottom-right":[-f,-1*(38.1-13.5+f)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const i=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:i?(i.isOpen()?i.remove():(i.setLngLat(this._lngLat),i.addTo(this._map)),this):this}_updateOpacity(i=!1){var o,h;if(!(!((o=this._map)===null||o===void 0)&&o.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(i)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const f=this._map,_=f.terrain.depthAtPoint(this._pos),M=f.terrain.getElevationForLngLatZoom(this._lngLat,f.transform.tileZoom);if(f.transform.lngLatToCameraDepth(this._lngLat,M)-_<.006)return void(this._element.style.opacity=this._opacity);const S=-this._offset.y/f.transform._pixelPerMeter,I=Math.sin(f.getPitch()*Math.PI/180)*S,D=f.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),F=f.transform.lngLatToCameraDepth(this._lngLat,M+I)-D>.006;!((h=this._popup)===null||h===void 0)&&h.isOpen()&&F&&this._popup.remove(),this._element.style.opacity=F?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(i){return this._offset=l.P.convert(i),this._update(),this}addClassName(i){this._element.classList.add(i)}removeClassName(i){this._element.classList.remove(i)}toggleClassName(i){return this._element.classList.toggle(i)}setDraggable(i){return this._draggable=!!i,this._map&&(i?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i&&i!=="auto"?i:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(i,o){return i===void 0&&o===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),i!==void 0&&(this._opacity=i),o!==void 0&&(this._opacityWhenCovered=o),this._map&&this._updateOpacity(!0),this}}const Ic={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let rl=0,xo=!1;const Cc={maxWidth:100,unit:"metric"};function Ac(g,i,o){const h=o&&o.maxWidth||100,f=g._container.clientHeight/2,_=g.unproject([0,f]),M=g.unproject([h,f]),S=_.distanceTo(M);if(o&&o.unit==="imperial"){const I=3.2808*S;I>5280?bo(i,h,I/5280,g._getUIString("ScaleControl.Miles")):bo(i,h,I,g._getUIString("ScaleControl.Feet"))}else o&&o.unit==="nautical"?bo(i,h,S/1852,g._getUIString("ScaleControl.NauticalMiles")):S>=1e3?bo(i,h,S/1e3,g._getUIString("ScaleControl.Kilometers")):bo(i,h,S,g._getUIString("ScaleControl.Meters"))}function bo(g,i,o,h){const f=function(_){const M=Math.pow(10,`${Math.floor(_)}`.length-1);let S=_/M;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(I){const D=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*D)/D}(S),M*S}(o);g.style.width=i*(f/o)+"px",g.innerHTML=`${f}&nbsp;${h}`}const Au={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Pu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Pc(g){if(g){if(typeof g=="number"){const i=Math.round(Math.abs(g)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,g),"top-left":new l.P(i,i),"top-right":new l.P(-i,i),bottom:new l.P(0,-g),"bottom-left":new l.P(i,-i),"bottom-right":new l.P(-i,-i),left:new l.P(g,0),right:new l.P(-g,0)}}if(g instanceof l.P||Array.isArray(g)){const i=l.P.convert(g);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:l.P.convert(g.center||[0,0]),top:l.P.convert(g.top||[0,0]),"top-left":l.P.convert(g["top-left"]||[0,0]),"top-right":l.P.convert(g["top-right"]||[0,0]),bottom:l.P.convert(g.bottom||[0,0]),"bottom-left":l.P.convert(g["bottom-left"]||[0,0]),"bottom-right":l.P.convert(g["bottom-right"]||[0,0]),left:l.P.convert(g.left||[0,0]),right:l.P.convert(g.right||[0,0])}}return Pc(new l.P(0,0))}const nd=T;m.AJAXError=l.be,m.Evented=l.E,m.LngLat=l.M,m.MercatorCoordinate=l.Y,m.Point=l.P,m.addProtocol=l.bf,m.config=l.a,m.removeProtocol=l.bg,m.AttributionControl=js,m.BoxZoomHandler=Ii,m.CanvasSource=At,m.CooperativeGesturesHandler=Ut,m.DoubleClickZoomHandler=bu,m.DragPanHandler=td,m.DragRotateHandler=Vs,m.EdgeInsets=qt,m.FullscreenControl=class extends l.E{constructor(g={}){super(),this._onFullscreenChange=()=>{var i;let o=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((i=o==null?void 0:o.shadowRoot)===null||i===void 0)&&i.fullscreenElement;)o=o.shadowRoot.fullscreenElement;o===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){R.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const g=this._fullscreenButton=R.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);R.create("span","maplibregl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.title=g}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},m.GeoJSONSource=Ct,m.GeolocateControl=class extends l.E{constructor(g){super(),this._onSuccess=i=>{if(this._map){if(this._isOutOfMapMaxBounds(i))return this._setErrorState(),this.fire(new l.k("outofmaxbounds",i)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=i,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(i),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(i),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.k("geolocate",i)),this._finish()}},this._updateCamera=i=>{const o=new l.M(i.coords.longitude,i.coords.latitude),h=i.coords.accuracy,f=this._map.getBearing(),_=l.e({bearing:f},this.options.fitBoundsOptions),M=ce.fromLngLat(o,h);this._map.fitBounds(M,_,{geolocateSource:!0})},this._updateMarker=i=>{if(i){const o=new l.M(i.coords.longitude,i.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=i.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=i=>{if(this._map){if(this.options.trackUserLocation)if(i.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(i.code===3&&xo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.k("error",i)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=i=>{if(this._map){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=R.create("button","maplibregl-ctrl-geolocate",this._container),R.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",i===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=R.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Xl({element:this._dotElement}),this._circleElement=R.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Xl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.k("trackuserlocationend")))})}},this.options=l.e({},Ic,g)}onAdd(g){return this._map=g,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return l._(this,arguments,void 0,function*(i=!1){if(Ea!==void 0&&!i)return Ea;if(window.navigator.permissions===void 0)return Ea=!!window.navigator.geolocation,Ea;try{Ea=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Ea=!!window.navigator.geolocation}return Ea})}().then(i=>this._setupUI(i)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),R.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,rl=0,xo=!1}_isOutOfMapMaxBounds(g){const i=this._map.getMaxBounds(),o=g.coords;return i&&(o.longitude<i.getWest()||o.longitude>i.getEast()||o.latitude<i.getSouth()||o.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const g=this._map.getBounds(),i=g.getSouthEast(),o=g.getNorthEast(),h=i.distanceTo(o),f=Math.ceil(this._accuracy/(h/this._map._container.clientHeight)*2);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":rl--,xo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),rl++,rl>1?(g={maximumAge:6e5,timeout:0},xo=!0):(g=this.options.positionOptions,xo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,g)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},m.Hash=Er,m.ImageSource=nt,m.KeyboardHandler=Ga,m.LngLatBounds=ce,m.LogoControl=id,m.Map=class extends Wn{constructor(g){if(l.bc.mark(l.bd.create),(g=l.e({},Zl,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Ei(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),{bearingSnap:g.bearingSnap}),this._contextLost=i=>{i.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new l.k("webglcontextlost",{originalEvent:i}))},this._contextRestored=i=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.k("webglcontextrestored",{originalEvent:i}))},this._onMapScroll=i=>{if(i.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=g.interactive,this._maxTileCacheSize=g.maxTileCacheSize,this._maxTileCacheZoomLevels=g.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._renderTaskQueue=new Gl,this._controls=[],this._mapId=l.a3(),this._locale=l.e({},Eu,g.locale),this._clickTolerance=g.clickTolerance,this._overridePixelRatio=g.pixelRatio,this._maxCanvasSize=g.maxCanvasSize,this.transformCameraUpdate=g.transformCameraUpdate,this._imageQueueHandle=he.addThrottleControl(()=>this.isMoving()),this._requestManager=new Le(g.transformRequest),typeof g.container=="string"){if(this._container=document.getElementById(g.container),!this._container)throw new Error(`Container '${g.container}' not found.`)}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(g.maxBounds&&this.setMaxBounds(g.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let i=!1;const o=pr(h=>{this._trackResize&&!this._removed&&this.resize(h)._update()},50);this._resizeObserver=new ResizeObserver(h=>{i?o(h):i=!0}),this._resizeObserver.observe(this._container)}this.handlers=new wu(this,g),this._hash=g.hash&&new Er(typeof g.hash=="string"&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,l.e({},g.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=g.localIdeographFontFamily,this._validateStyle=g.validateStyle,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new js(typeof g.attributionControl=="boolean"?void 0:g.attributionControl)),g.maplibreLogo&&this.addControl(new id,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update(i.dataType==="style"),this.fire(new l.k(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new l.k(`${i.dataType}dataloading`,i))}),this.on("dataabort",i=>{this.fire(new l.k("sourcedataabort",i))})}_getMapId(){return this._mapId}addControl(g,i){if(i===void 0&&(i=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new l.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=g.onAdd(this);this._controls.push(g);const h=this._controlPositions[i];return i.indexOf("bottom")!==-1?h.insertBefore(o,h.firstChild):h.appendChild(o),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new l.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(g);return i>-1&&this._controls.splice(i,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}calculateCameraOptionsFromTo(g,i,o,h){return h==null&&this.terrain&&(h=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(g,i,o,h)}resize(g){var i;const o=this._containerDimensions(),h=o[0],f=o[1],_=this._getClampedPixelRatio(h,f);if(this._resizeCanvas(h,f,_),this.painter.resize(h,f,_),this.painter.overLimit()){const S=this.painter.context.gl;this._maxCanvasSize=[S.drawingBufferWidth,S.drawingBufferHeight];const I=this._getClampedPixelRatio(h,f);this._resizeCanvas(h,f,I),this.painter.resize(h,f,I)}this.transform.resize(h,f),(i=this._requestedCameraState)===null||i===void 0||i.resize(h,f);const M=!this._moving;return M&&(this.stop(),this.fire(new l.k("movestart",g)).fire(new l.k("move",g))),this.fire(new l.k("resize",g)),M&&this.fire(new l.k("moveend",g)),this}_getClampedPixelRatio(g,i){const{0:o,1:h}=this._maxCanvasSize,f=this.getPixelRatio(),_=g*f,M=i*f;return Math.min(_>o?o/_:1,M>h?h/M:1)*f}getPixelRatio(){var g;return(g=this._overridePixelRatio)!==null&&g!==void 0?g:devicePixelRatio}setPixelRatio(g){this._overridePixelRatio=g,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(g){return this.transform.setMaxBounds(ce.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this._update()}project(g){return this.transform.locationPoint(l.M.convert(g),this.style&&this.terrain)}unproject(g){return this.transform.pointLocation(l.P.convert(g),this.terrain)}isMoving(){var g;return this._moving||((g=this.handlers)===null||g===void 0?void 0:g.isMoving())}isZooming(){var g;return this._zooming||((g=this.handlers)===null||g===void 0?void 0:g.isZooming())}isRotating(){var g;return this._rotating||((g=this.handlers)===null||g===void 0?void 0:g.isRotating())}_createDelegatedListener(g,i,o){if(g==="mouseenter"||g==="mouseover"){let h=!1;return{layer:i,listener:o,delegates:{mousemove:_=>{const M=this.getLayer(i)?this.queryRenderedFeatures(_.point,{layers:[i]}):[];M.length?h||(h=!0,o.call(this,new Qr(g,this,_.originalEvent,{features:M}))):h=!1},mouseout:()=>{h=!1}}}}if(g==="mouseleave"||g==="mouseout"){let h=!1;return{layer:i,listener:o,delegates:{mousemove:M=>{(this.getLayer(i)?this.queryRenderedFeatures(M.point,{layers:[i]}):[]).length?h=!0:h&&(h=!1,o.call(this,new Qr(g,this,M.originalEvent)))},mouseout:M=>{h&&(h=!1,o.call(this,new Qr(g,this,M.originalEvent)))}}}}{const h=f=>{const _=this.getLayer(i)?this.queryRenderedFeatures(f.point,{layers:[i]}):[];_.length&&(f.features=_,o.call(this,f),delete f.features)};return{layer:i,listener:o,delegates:{[g]:h}}}}on(g,i,o){if(o===void 0)return super.on(g,i);const h=this._createDelegatedListener(g,i,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(h);for(const f in h.delegates)this.on(f,h.delegates[f]);return this}once(g,i,o){if(o===void 0)return super.once(g,i);const h=this._createDelegatedListener(g,i,o);for(const f in h.delegates)this.once(f,h.delegates[f]);return this}off(g,i,o){return o===void 0?super.off(g,i):(this._delegatedListeners&&this._delegatedListeners[g]&&(h=>{const f=this._delegatedListeners[g];for(let _=0;_<f.length;_++){const M=f[_];if(M.layer===i&&M.listener===o){for(const S in M.delegates)this.off(S,M.delegates[S]);return f.splice(_,1),this}}})(),this)}queryRenderedFeatures(g,i){if(!this.style)return[];let o;const h=g instanceof l.P||Array.isArray(g),f=h?g:[[0,0],[this.transform.width,this.transform.height]];if(i=i||(h?{}:g)||{},f instanceof l.P||typeof f[0]=="number")o=[l.P.convert(f)];else{const _=l.P.convert(f[0]),M=l.P.convert(f[1]);o=[_,new l.P(M.x,_.y),M,new l.P(_.x,M.y),_]}return this.style.queryRenderedFeatures(o,i,this.transform)}querySourceFeatures(g,i){return this.style.querySourceFeatures(g,i)}setStyle(g,i){return(i=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},i)).diff!==!1&&i.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._updateStyle(g,i))}setTransformRequest(g){return this._requestManager.setTransformRequest(g),this}_getUIString(g){const i=this._locale[g];if(i==null)throw new Error(`Missing UI string '${g}'`);return i}_updateStyle(g,i){if(i.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(g,i));const o=this.style&&i.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!g)),g?(this.style=new xn(this,i||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g,i,o):this.style.loadJSON(g,i,o),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new xn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,i){if(typeof g=="string"){const o=this._requestManager.transformRequest(g,"Style");l.h(o,new AbortController).then(h=>{this._updateDiff(h.data,i)}).catch(h=>{h&&this.fire(new l.j(h))})}else typeof g=="object"&&this._updateDiff(g,i)}_updateDiff(g,i){try{this.style.setState(g,i)&&this._update(!0)}catch(o){l.w(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(g,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(g,i){return this._lazyInitEmptyStyle(),this.style.addSource(g,i),this._update(!0)}isSourceLoaded(g){const i=this.style&&this.style.sourceCaches[g];if(i!==void 0)return i.loaded();this.fire(new l.j(new Error(`There is no source with ID '${g}'`)))}setTerrain(g){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),g){const i=this.style.sourceCaches[g.source];if(!i)throw new Error(`cannot load terrain, because there exists no source with ID: ${g.source}`);this.terrain===null&&i.reload();for(const o in this.style._layers){const h=this.style._layers[o];h.type==="hillshade"&&h.source===g.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new rd(this.painter,i,g),this.painter.renderToTexture=new Su(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=o=>{o.dataType==="style"?this.terrain.sourceCache.freeRtt():o.dataType==="source"&&o.tile&&(o.sourceId!==g.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(o.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new l.k("terrain",{terrain:g})),this}getTerrain(){var g,i;return(i=(g=this.terrain)===null||g===void 0?void 0:g.options)!==null&&i!==void 0?i:null}areTilesLoaded(){const g=this.style&&this.style.sourceCaches;for(const i in g){const o=g[i]._tiles;for(const h in o){const f=o[h];if(f.state!=="loaded"&&f.state!=="errored")return!1}}return!0}removeSource(g){return this.style.removeSource(g),this._update(!0)}getSource(g){return this.style.getSource(g)}addImage(g,i,o={}){const{pixelRatio:h=1,sdf:f=!1,stretchX:_,stretchY:M,content:S}=o;if(this._lazyInitEmptyStyle(),!(i instanceof HTMLImageElement||l.b(i))){if(i.width===void 0||i.height===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:I,height:D,data:F}=i,B=i;return this.style.addImage(g,{data:new l.R({width:I,height:D},new Uint8Array(F)),pixelRatio:h,stretchX:_,stretchY:M,content:S,sdf:f,version:0,userImage:B}),B.onAdd&&B.onAdd(this,g),this}}{const{width:I,height:D,data:F}=k.getImageData(i);this.style.addImage(g,{data:new l.R({width:I,height:D},F),pixelRatio:h,stretchX:_,stretchY:M,content:S,sdf:f,version:0})}}updateImage(g,i){const o=this.style.getImage(g);if(!o)return this.fire(new l.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const h=i instanceof HTMLImageElement||l.b(i)?k.getImageData(i):i,{width:f,height:_,data:M}=h;if(f===void 0||_===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(f!==o.data.width||_!==o.data.height)return this.fire(new l.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const S=!(i instanceof HTMLImageElement||l.b(i));return o.data.replace(M,S),this.style.updateImage(g,o),this}getImage(g){return this.style.getImage(g)}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new l.j(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g){return he.getImage(this._requestManager.transformRequest(g,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(g,i){return this._lazyInitEmptyStyle(),this.style.addLayer(g,i),this._update(!0)}moveLayer(g,i){return this.style.moveLayer(g,i),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(g,i,o){return this.style.setLayerZoomRange(g,i,o),this._update(!0)}setFilter(g,i,o={}){return this.style.setFilter(g,i,o),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,i,o,h={}){return this.style.setPaintProperty(g,i,o,h),this._update(!0)}getPaintProperty(g,i){return this.style.getPaintProperty(g,i)}setLayoutProperty(g,i,o,h={}){return this.style.setLayoutProperty(g,i,o,h),this._update(!0)}getLayoutProperty(g,i){return this.style.getLayoutProperty(g,i)}setGlyphs(g,i={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(g,i),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(g,i,o={}){return this._lazyInitEmptyStyle(),this.style.addSprite(g,i,o,h=>{h||this._update(!0)}),this}removeSprite(g){return this._lazyInitEmptyStyle(),this.style.removeSprite(g),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(g,i={}){return this._lazyInitEmptyStyle(),this.style.setSprite(g,i,o=>{o||this._update(!0)}),this}setLight(g,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,i),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(g,i){return this.style.setFeatureState(g,i),this._update()}removeFeatureState(g,i){return this.style.removeFeatureState(g,i),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let g=0,i=0;return this._container&&(g=this._container.clientWidth||400,i=this._container.clientHeight||300),[g,i]}_setupContainer(){const g=this._container;g.classList.add("maplibregl-map");const i=this._canvasContainer=R.create("div","maplibregl-canvas-container",g);this._interactive&&i.classList.add("maplibregl-interactive"),this._canvas=R.create("canvas","maplibregl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const o=this._containerDimensions(),h=this._getClampedPixelRatio(o[0],o[1]);this._resizeCanvas(o[0],o[1],h);const f=this._controlContainer=R.create("div","maplibregl-control-container",g),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(M=>{_[M]=R.create("div",`maplibregl-ctrl-${M} `,f)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,i,o){this._canvas.width=Math.floor(o*g),this._canvas.height=Math.floor(o*i),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${i}px`}_setupPainter(){const g={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let i=null;this._canvas.addEventListener("webglcontextcreationerror",h=>{i={requestedAttributes:g},h&&(i.statusMessage=h.statusMessage,i.type=h.type)},{once:!0});const o=this._canvas.getContext("webgl2",g)||this._canvas.getContext("webgl",g);if(!o){const h="Failed to initialize WebGL";throw i?(i.message=h,new Error(JSON.stringify(i))):new Error(h)}this.painter=new Se(o,this.transform),Z.testSupport(o)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_render(g){const i=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),this._removed)return;let o=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const f=this.transform.zoom,_=k.now();this.style.zoomHistory.update(f,_);const M=new l.a8(f,{now:_,fadeDuration:i,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),S=M.crossFadingFactor();S===1&&S===this._crossFadingFactor||(o=!0,this._crossFadingFactor=S),this.style.update(M)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,i,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:i,showPadding:this.showPadding}),this.fire(new l.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.bc.mark(l.bd.load),this.fire(new l.k("load"))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const h=this._sourcesDirty||this._styleDirty||this._placementDirty;return h||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.k("idle")),!this._loaded||this._fullyLoaded||h||(this._fullyLoaded=!0,l.bc.mark(l.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var g;this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),he.removeThrottleControl(this._imageQueueHandle),(g=this._resizeObserver)===null||g===void 0||g.disconnect();const i=this.painter.context.gl.getExtension("WEBGL_lose_context");i&&i.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),R.remove(this._canvasContainer),R.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),l.bc.clearMetrics(),this._removed=!0,this.fire(new l.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,k.frameAsync(this._frameRequest).then(g=>{l.bc.frame(g),this._frameRequest=null,this._render(g)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get version(){return Tu}getCameraTargetElevation(){return this.transform.elevation}},m.MapMouseEvent=Qr,m.MapTouchEvent=Mn,m.MapWheelEvent=ba,m.Marker=Xl,m.NavigationControl=class{constructor(g){this._updateZoomButtons=()=>{const i=this._map.getZoom(),o=i===this._map.getMaxZoom(),h=i===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())},this._rotateCompassArrow=()=>{const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=i},this._setButtonTitle=(i,o)=>{const h=this._map._getUIString(`NavigationControl.${o}`);i.title=h,i.setAttribute("aria-label",h)},this.options=l.e({},Iu,g),this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",i=>this._map.zoomIn({},{originalEvent:i})),R.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",i=>this._map.zoomOut({},{originalEvent:i})),R.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",i=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:i}):this._map.resetNorth({},{originalEvent:i})}),this._compassIcon=R.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Cu(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){R.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(g,i){const o=R.create("button",g,this._container);return o.type="button",o.addEventListener("click",i),o}},m.Popup=class extends l.E{constructor(g){super(),this.remove=()=>(this._content&&R.remove(this._content),this._container&&(R.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.k("close"))),this),this._onMouseUp=i=>{this._update(i.point)},this._onMouseMove=i=>{this._update(i.point)},this._onDrag=i=>{this._update(i.point)},this._update=i=>{var o;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=R.create("div","maplibregl-popup",this._map.getContainer()),this._tip=R.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const S of this.options.className.split(" "))this._container.classList.add(S);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Ec(this._lngLat,this._flatPos,this._map.transform):(o=this._lngLat)===null||o===void 0?void 0:o.wrap(),this._trackPointer&&!i)return;const h=this._flatPos=this._pos=this._trackPointer&&i?i:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&i?i:this._map.transform.locationPoint(this._lngLat));let f=this.options.anchor;const _=Pc(this.options.offset);if(!f){const S=this._container.offsetWidth,I=this._container.offsetHeight;let D;D=h.y+_.bottom.y<I?["top"]:h.y>this._map.transform.height-I?["bottom"]:[],h.x<S/2?D.push("left"):h.x>this._map.transform.width-S/2&&D.push("right"),f=D.length===0?"bottom":D.join("-")}let M=h.add(_[f]);this.options.subpixelPositioning||(M=M.round()),R.setTransform(this._container,`${Wl[f]} translate(${M.x}px,${M.y}px)`),Tc(this._container,f,"popup")},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(Au),g)}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(g){return this._lngLat=l.M.convert(g),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const i=document.createDocumentFragment(),o=document.createElement("body");let h;for(o.innerHTML=g;h=o.firstChild,h;)i.appendChild(h);return this.setDOMContent(i)}getMaxWidth(){var g;return(g=this._container)===null||g===void 0?void 0:g.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=R.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(g),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(g){this._container&&this._container.classList.add(g)}removeClassName(g){this._container&&this._container.classList.remove(g)}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){if(this._container)return this._container.classList.toggle(g)}setSubpixelPositioning(g){this.options.subpixelPositioning=g}_createCloseButton(){this.options.closeButton&&(this._closeButton=R.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(Pu);g&&g.focus()}},m.RasterDEMTileSource=ft,m.RasterTileSource=le,m.ScaleControl=class{constructor(g){this._onMove=()=>{Ac(this._map,this._container,this.options)},this.setUnit=i=>{this.options.unit=i,Ac(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Cc),g)}getDefaultPosition(){return"bottom-left"}onAdd(g){return this._map=g,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-scale",g.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){R.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},m.ScrollZoomHandler=wc,m.Style=xn,m.TerrainControl=class{constructor(g){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=g}onAdd(g){return this._map=g,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=R.create("button","maplibregl-ctrl-terrain",this._container),R.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){R.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},m.TwoFingersTouchPitchHandler=Jh,m.TwoFingersTouchRotateHandler=qa,m.TwoFingersTouchZoomHandler=_o,m.TwoFingersTouchZoomRotateHandler=jl,m.VectorTileSource=Oe,m.VideoSource=it,m.addSourceType=(g,i)=>l._(void 0,void 0,void 0,function*(){if(jt(g))throw new Error(`A source type called "${g}" already exists.`);((o,h)=>{Gt[o]=h})(g,i)}),m.clearPrewarmedResources=function(){const g=ji;g&&(g.isPreloaded()&&g.numActive()===1?(g.release(rt),ji=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},m.getMaxParallelImageRequests=function(){return l.a.MAX_PARALLEL_IMAGE_REQUESTS},m.getRTLTextPluginStatus=function(){return Ue().getRTLTextPluginStatus()},m.getVersion=function(){return nd},m.getWorkerCount=function(){return et.workerCount},m.getWorkerUrl=function(){return l.a.WORKER_URL},m.importScriptInWorkers=function(g){return ht().broadcast("IS",g)},m.prewarm=function(){Ve().acquire(rt)},m.setMaxParallelImageRequests=function(g){l.a.MAX_PARALLEL_IMAGE_REQUESTS=g},m.setRTLTextPlugin=function(g,i){return Ue().setRTLTextPlugin(g,i)},m.setWorkerCount=function(g){et.workerCount=g},m.setWorkerUrl=function(g){l.a.WORKER_URL=g}});var y=a;return y})})(Yx);var KL=Yx.exports;const Wp=Ym(KL);var Qx={exports:{}};(function(e,r){(function(a,u){e.exports=u()})(Zc,function(){var a=function(b,A){var V={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},ae={on:function(ye,Me,Ye){if(V[ye]===void 0)throw new Error("Invalid event type: "+ye);V[ye].push({selector:Me,fn:Ye})},render:function(ye){A.store.featureChanged(ye)}},me=function(ye,Me){for(var Ye=V[ye],ot=Ye.length;ot--;){var wt=Ye[ot];if(wt.selector(Me)){wt.fn.call(ae,Me)||A.store.render(),A.ui.updateMapClasses();break}}};return b.start.call(ae),{render:b.render,stop:function(){b.stop&&b.stop()},trash:function(){b.trash&&(b.trash(),A.store.render())},combineFeatures:function(){b.combineFeatures&&b.combineFeatures()},uncombineFeatures:function(){b.uncombineFeatures&&b.uncombineFeatures()},drag:function(ye){me("drag",ye)},click:function(ye){me("click",ye)},mousemove:function(ye){me("mousemove",ye)},mousedown:function(ye){me("mousedown",ye)},mouseup:function(ye){me("mouseup",ye)},mouseout:function(ye){me("mouseout",ye)},keydown:function(ye){me("keydown",ye)},keyup:function(ye){me("keyup",ye)},touchstart:function(ye){me("touchstart",ye)},touchmove:function(ye){me("touchmove",ye)},touchend:function(ye){me("touchend",ye)},tap:function(ye){me("tap",ye)}}};function u(b){return b&&b.__esModule&&Object.prototype.hasOwnProperty.call(b,"default")?b.default:b}function d(b){if(b.__esModule)return b;var A=b.default;if(typeof A=="function"){var V=function ae(){if(this instanceof ae){var me=[null];me.push.apply(me,arguments);var ye=Function.bind.apply(A,me);return new ye}return A.apply(this,arguments)};V.prototype=A.prototype}else V={};return Object.defineProperty(V,"__esModule",{value:!0}),Object.keys(b).forEach(function(ae){var me=Object.getOwnPropertyDescriptor(b,ae);Object.defineProperty(V,ae,me.get?me:{enumerable:!0,get:function(){return b[ae]}})}),V}var y={},m={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:63567523142e-4},l=m;function T(b){var A=0;if(b&&b.length>0){A+=Math.abs(P(b[0]));for(var V=1;V<b.length;V++)A-=Math.abs(P(b[V]))}return A}function P(b){var A,V,ae,me,ye,Me,Ye=0,ot=b.length;if(ot>2){for(Me=0;Me<ot;Me++)Me===ot-2?(ae=ot-2,me=ot-1,ye=0):Me===ot-1?(ae=ot-1,me=0,ye=1):(ae=Me,me=Me+1,ye=Me+2),A=b[ae],V=b[me],Ye+=(z(b[ye][0])-z(A[0]))*Math.sin(z(V[1]));Ye=Ye*l.RADIUS*l.RADIUS/2}return Ye}function z(b){return b*Math.PI/180}y.geometry=function b(A){var V,ae=0;switch(A.type){case"Polygon":return T(A.coordinates);case"MultiPolygon":for(V=0;V<A.coordinates.length;V++)ae+=T(A.coordinates[V]);return ae;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(V=0;V<A.geometries.length;V++)ae+=b(A.geometries[V]);return ae}},y.ring=P;var k={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},R={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},Z={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},K={POLYGON:"polygon",LINE:"line_string",POINT:"point"},Y={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},ge={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},Te={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},Fe={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},he={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},Le={ACTIVE:"true",INACTIVE:"false"},We=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],Qe=-85,bt=Object.freeze({__proto__:null,classes:k,sources:R,cursors:Z,types:K,geojsonTypes:Y,modes:ge,events:Te,updateActions:Fe,meta:he,activeStates:Le,interactions:We,LAT_MIN:-90,LAT_RENDERED_MIN:Qe,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),He={Point:0,LineString:1,MultiLineString:1,Polygon:2};function lt(b,A){var V=He[b.geometry.type]-He[A.geometry.type];return V===0&&b.geometry.type===Y.POLYGON?b.area-A.area:V}function Rt(b){return b.map(function(A){return A.geometry.type===Y.POLYGON&&(A.area=y.geometry({type:Y.FEATURE,property:{},geometry:A.geometry})),A}).sort(lt).map(function(A){return delete A.area,A})}function Pt(b,A){return A===void 0&&(A=0),[[b.point.x-A,b.point.y-A],[b.point.x+A,b.point.y+A]]}function oi(b){if(this._items={},this._nums={},this._length=b?b.length:0,b)for(var A=0,V=b.length;A<V;A++)this.add(b[A]),b[A]!==void 0&&(typeof b[A]=="string"?this._items[b[A]]=A:this._nums[b[A]]=A)}oi.prototype.add=function(b){return this.has(b)||(this._length++,typeof b=="string"?this._items[b]=this._length:this._nums[b]=this._length),this},oi.prototype.delete=function(b){return this.has(b)===!1||(this._length--,delete this._items[b],delete this._nums[b]),this},oi.prototype.has=function(b){return(typeof b=="string"||typeof b=="number")&&(this._items[b]!==void 0||this._nums[b]!==void 0)},oi.prototype.values=function(){var b=this,A=[];return Object.keys(this._items).forEach(function(V){A.push({k:V,v:b._items[V]})}),Object.keys(this._nums).forEach(function(V){A.push({k:JSON.parse(V),v:b._nums[V]})}),A.sort(function(V,ae){return V.v-ae.v}).map(function(V){return V.k})},oi.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var pi=[he.FEATURE,he.MIDPOINT,he.VERTEX],Yt={click:function(b,A,V){return cr(b,A,V,V.options.clickBuffer)},touch:function(b,A,V){return cr(b,A,V,V.options.touchBuffer)}};function cr(b,A,V,ae){if(V.map===null)return[];var me=b?Pt(b,ae):A,ye={};V.options.styles&&(ye.layers=V.options.styles.map(function(wt){return wt.id}).filter(function(wt){return V.map.getLayer(wt)!=null}));var Me=V.map.queryRenderedFeatures(me,ye).filter(function(wt){return pi.indexOf(wt.properties.meta)!==-1}),Ye=new oi,ot=[];return Me.forEach(function(wt){var Mt=wt.properties.id;Ye.has(Mt)||(Ye.add(Mt),ot.push(wt))}),Rt(ot)}function si(b,A){var V=Yt.click(b,null,A),ae={mouse:Z.NONE};return V[0]&&(ae.mouse=V[0].properties.active===Le.ACTIVE?Z.MOVE:Z.POINTER,ae.feature=V[0].properties.meta),A.events.currentModeName().indexOf("draw")!==-1&&(ae.mouse=Z.ADD),A.ui.queueMapClasses(ae),A.ui.updateMapClasses(),V[0]}function Qt(b,A){var V=b.x-A.x,ae=b.y-A.y;return Math.sqrt(V*V+ae*ae)}function gi(b,A,V){V===void 0&&(V={});var ae=V.fineTolerance!=null?V.fineTolerance:4,me=V.grossTolerance!=null?V.grossTolerance:12,ye=V.interval!=null?V.interval:500;b.point=b.point||A.point,b.time=b.time||A.time;var Me=Qt(b.point,A.point);return Me<ae||Me<me&&A.time-b.time<ye}function ur(b,A,V){V===void 0&&(V={});var ae=V.tolerance!=null?V.tolerance:25,me=V.interval!=null?V.interval:250;return b.point=b.point||A.point,b.time=b.time||A.time,Qt(b.point,A.point)<ae&&A.time-b.time<me}var Ar={exports:{}},ut=Ar.exports=function(b,A){if(A||(A=16),b===void 0&&(b=128),b<=0)return"0";for(var V=Math.log(Math.pow(2,b))/Math.log(A),ae=2;V===1/0;ae*=2)V=Math.log(Math.pow(2,b/ae))/Math.log(A)*ae;var me=V-Math.floor(V),ye="";for(ae=0;ae<Math.floor(V);ae++)ye=Math.floor(Math.random()*A).toString(A)+ye;if(me){var Me=Math.pow(A,me);ye=Math.floor(Math.random()*Me).toString(A)+ye}var Ye=parseInt(ye,A);return Ye!==1/0&&Ye>=Math.pow(2,b)?ut(b,A):ye};ut.rack=function(b,A,V){var ae=function(ye){var Me=0;do{if(Me++>10){if(!V)throw new Error("too many ID collisions, use more bits");b+=V}var Ye=ut(b,A)}while(Object.hasOwnProperty.call(me,Ye));return me[Ye]=ye,Ye},me=ae.hats={};return ae.get=function(ye){return ae.hats[ye]},ae.set=function(ye,Me){return ae.hats[ye]=Me,ae},ae.bits=b||128,ae.base=A||16,ae};var rt=u(Ar.exports),et=function(b,A){this.ctx=b,this.properties=A.properties||{},this.coordinates=A.geometry.coordinates,this.id=A.id||rt(),this.type=A.geometry.type};et.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},et.prototype.incomingCoords=function(b){this.setCoordinates(b)},et.prototype.setCoordinates=function(b){this.coordinates=b,this.changed()},et.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},et.prototype.setProperty=function(b,A){this.properties[b]=A},et.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:Y.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},et.prototype.internal=function(b){var A={id:this.id,meta:he.FEATURE,"meta:type":this.type,active:Le.INACTIVE,mode:b};if(this.ctx.options.userProperties)for(var V in this.properties)A["user_"+V]=this.properties[V];return{type:Y.FEATURE,properties:A,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var ir=function(b,A){et.call(this,b,A)};(ir.prototype=Object.create(et.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},ir.prototype.updateCoordinate=function(b,A,V){this.coordinates=arguments.length===3?[A,V]:[b,A],this.changed()},ir.prototype.getCoordinate=function(){return this.getCoordinates()};var ji=function(b,A){et.call(this,b,A)};(ji.prototype=Object.create(et.prototype)).isValid=function(){return this.coordinates.length>1},ji.prototype.addCoordinate=function(b,A,V){this.changed();var ae=parseInt(b,10);this.coordinates.splice(ae,0,[A,V])},ji.prototype.getCoordinate=function(b){var A=parseInt(b,10);return JSON.parse(JSON.stringify(this.coordinates[A]))},ji.prototype.removeCoordinate=function(b){this.changed(),this.coordinates.splice(parseInt(b,10),1)},ji.prototype.updateCoordinate=function(b,A,V){var ae=parseInt(b,10);this.coordinates[ae]=[A,V],this.changed()};var wi=function(b,A){et.call(this,b,A),this.coordinates=this.coordinates.map(function(V){return V.slice(0,-1)})};(wi.prototype=Object.create(et.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(b){return b.length>2})},wi.prototype.incomingCoords=function(b){this.coordinates=b.map(function(A){return A.slice(0,-1)}),this.changed()},wi.prototype.setCoordinates=function(b){this.coordinates=b,this.changed()},wi.prototype.addCoordinate=function(b,A,V){this.changed();var ae=b.split(".").map(function(me){return parseInt(me,10)});this.coordinates[ae[0]].splice(ae[1],0,[A,V])},wi.prototype.removeCoordinate=function(b){this.changed();var A=b.split(".").map(function(ae){return parseInt(ae,10)}),V=this.coordinates[A[0]];V&&(V.splice(A[1],1),V.length<3&&this.coordinates.splice(A[0],1))},wi.prototype.getCoordinate=function(b){var A=b.split(".").map(function(ae){return parseInt(ae,10)}),V=this.coordinates[A[0]];return JSON.parse(JSON.stringify(V[A[1]]))},wi.prototype.getCoordinates=function(){return this.coordinates.map(function(b){return b.concat([b[0]])})},wi.prototype.updateCoordinate=function(b,A,V){this.changed();var ae=b.split("."),me=parseInt(ae[0],10),ye=parseInt(ae[1],10);this.coordinates[me]===void 0&&(this.coordinates[me]=[]),this.coordinates[me][ye]=[A,V]};var Ve={MultiPoint:ir,MultiLineString:ji,MultiPolygon:wi},Et=function(b,A,V,ae,me){var ye=V.split("."),Me=parseInt(ye[0],10),Ye=ye[1]?ye.slice(1).join("."):null;return b[Me][A](Ye,ae,me)},ht=function(b,A){if(et.call(this,b,A),delete this.coordinates,this.model=Ve[A.geometry.type],this.model===void 0)throw new TypeError(A.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(A.geometry.coordinates)};function Je(b){this.map=b.map,this.drawConfig=JSON.parse(JSON.stringify(b.options||{})),this._ctx=b}(ht.prototype=Object.create(et.prototype))._coordinatesToFeatures=function(b){var A=this,V=this.model.bind(this);return b.map(function(ae){return new V(A.ctx,{id:rt(),type:Y.FEATURE,properties:{},geometry:{coordinates:ae,type:A.type.replace("Multi","")}})})},ht.prototype.isValid=function(){return this.features.every(function(b){return b.isValid()})},ht.prototype.setCoordinates=function(b){this.features=this._coordinatesToFeatures(b),this.changed()},ht.prototype.getCoordinate=function(b){return Et(this.features,"getCoordinate",b)},ht.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(b){return b.type===Y.POLYGON?b.getCoordinates():b.coordinates})))},ht.prototype.updateCoordinate=function(b,A,V){Et(this.features,"updateCoordinate",b,A,V),this.changed()},ht.prototype.addCoordinate=function(b,A,V){Et(this.features,"addCoordinate",b,A,V),this.changed()},ht.prototype.removeCoordinate=function(b){Et(this.features,"removeCoordinate",b),this.changed()},ht.prototype.getFeatures=function(){return this.features},Je.prototype.setSelected=function(b){return this._ctx.store.setSelected(b)},Je.prototype.setSelectedCoordinates=function(b){var A=this;this._ctx.store.setSelectedCoordinates(b),b.reduce(function(V,ae){return V[ae.feature_id]===void 0&&(V[ae.feature_id]=!0,A._ctx.store.get(ae.feature_id).changed()),V},{})},Je.prototype.getSelected=function(){return this._ctx.store.getSelected()},Je.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},Je.prototype.isSelected=function(b){return this._ctx.store.isSelected(b)},Je.prototype.getFeature=function(b){return this._ctx.store.get(b)},Je.prototype.select=function(b){return this._ctx.store.select(b)},Je.prototype.deselect=function(b){return this._ctx.store.deselect(b)},Je.prototype.deleteFeature=function(b,A){return A===void 0&&(A={}),this._ctx.store.delete(b,A)},Je.prototype.addFeature=function(b){return this._ctx.store.add(b)},Je.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},Je.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},Je.prototype.setActionableState=function(b){b===void 0&&(b={});var A={trash:b.trash||!1,combineFeatures:b.combineFeatures||!1,uncombineFeatures:b.uncombineFeatures||!1};return this._ctx.events.actionable(A)},Je.prototype.changeMode=function(b,A,V){return A===void 0&&(A={}),V===void 0&&(V={}),this._ctx.events.changeMode(b,A,V)},Je.prototype.updateUIClasses=function(b){return this._ctx.ui.queueMapClasses(b)},Je.prototype.activateUIButton=function(b){return this._ctx.ui.setActiveButton(b)},Je.prototype.featuresAt=function(b,A,V){if(V===void 0&&(V="click"),V!=="click"&&V!=="touch")throw new Error("invalid buffer type");return Yt[V](b,A,this._ctx)},Je.prototype.newFeature=function(b){var A=b.geometry.type;return A===Y.POINT?new ir(this._ctx,b):A===Y.LINE_STRING?new ji(this._ctx,b):A===Y.POLYGON?new wi(this._ctx,b):new ht(this._ctx,b)},Je.prototype.isInstanceOf=function(b,A){if(b===Y.POINT)return A instanceof ir;if(b===Y.LINE_STRING)return A instanceof ji;if(b===Y.POLYGON)return A instanceof wi;if(b==="MultiFeature")return A instanceof ht;throw new Error("Unknown feature class: "+b)},Je.prototype.doRender=function(b){return this._ctx.store.featureChanged(b)},Je.prototype.onSetup=function(){},Je.prototype.onDrag=function(){},Je.prototype.onClick=function(){},Je.prototype.onMouseMove=function(){},Je.prototype.onMouseDown=function(){},Je.prototype.onMouseUp=function(){},Je.prototype.onMouseOut=function(){},Je.prototype.onKeyUp=function(){},Je.prototype.onKeyDown=function(){},Je.prototype.onTouchStart=function(){},Je.prototype.onTouchMove=function(){},Je.prototype.onTouchEnd=function(){},Je.prototype.onTap=function(){},Je.prototype.onStop=function(){},Je.prototype.onTrash=function(){},Je.prototype.onCombineFeature=function(){},Je.prototype.onUncombineFeature=function(){},Je.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var Pi={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},Ri=Object.keys(Pi);function se(b){var A=Object.keys(b);return function(V,ae){ae===void 0&&(ae={});var me={},ye=A.reduce(function(Me,Ye){return Me[Ye]=b[Ye],Me},new Je(V));return{start:function(){var Me=this;me=ye.onSetup(ae),Ri.forEach(function(Ye){var ot,wt=Pi[Ye],Mt=function(){return!1};b[wt]&&(Mt=function(){return!0}),Me.on(Ye,Mt,(ot=wt,function(pt){return ye[ot](me,pt)}))})},stop:function(){ye.onStop(me)},trash:function(){ye.onTrash(me)},combineFeatures:function(){ye.onCombineFeatures(me)},uncombineFeatures:function(){ye.onUncombineFeatures(me)},render:function(Me,Ye){ye.toDisplayFeatures(me,Me,Ye)}}}}function ce(b){return[].concat(b).filter(function(A){return A!==void 0})}function Pe(){var b=this;if(!(b.ctx.map&&b.ctx.map.getSource(R.HOT)!==void 0))return ot();var A=b.ctx.events.currentModeName();b.ctx.ui.queueMapClasses({mode:A});var V=[],ae=[];b.isDirty?ae=b.getAllIds():(V=b.getChangedIds().filter(function(wt){return b.get(wt)!==void 0}),ae=b.sources.hot.filter(function(wt){return wt.properties.id&&V.indexOf(wt.properties.id)===-1&&b.get(wt.properties.id)!==void 0}).map(function(wt){return wt.properties.id})),b.sources.hot=[];var me=b.sources.cold.length;b.sources.cold=b.isDirty?[]:b.sources.cold.filter(function(wt){var Mt=wt.properties.id||wt.properties.parent;return V.indexOf(Mt)===-1});var ye=me!==b.sources.cold.length||ae.length>0;function Me(wt,Mt){var pt=b.get(wt).internal(A);b.ctx.events.currentModeRender(pt,function(ai){b.sources[Mt].push(ai)})}if(V.forEach(function(wt){return Me(wt,"hot")}),ae.forEach(function(wt){return Me(wt,"cold")}),ye&&b.ctx.map.getSource(R.COLD).setData({type:Y.FEATURE_COLLECTION,features:b.sources.cold}),b.ctx.map.getSource(R.HOT).setData({type:Y.FEATURE_COLLECTION,features:b.sources.hot}),b._emitSelectionChange&&(b.ctx.map.fire(Te.SELECTION_CHANGE,{features:b.getSelected().map(function(wt){return wt.toGeoJSON()}),points:b.getSelectedCoordinates().map(function(wt){return{type:Y.FEATURE,properties:{},geometry:{type:Y.POINT,coordinates:wt.coordinates}}})}),b._emitSelectionChange=!1),b._deletedFeaturesToEmit.length){var Ye=b._deletedFeaturesToEmit.map(function(wt){return wt.toGeoJSON()});b._deletedFeaturesToEmit=[],b.ctx.map.fire(Te.DELETE,{features:Ye})}function ot(){b.isDirty=!1,b.clearChangedIds()}ot(),b.ctx.map.fire(Te.RENDER,{})}function Oe(b){var A,V=this;this._features={},this._featureIds=new oi,this._selectedFeatureIds=new oi,this._selectedCoordinates=[],this._changedFeatureIds=new oi,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=b,this.sources={hot:[],cold:[]},this.render=function(){A||(A=requestAnimationFrame(function(){A=null,Pe.call(V)}))},this.isDirty=!1}function le(b,A){var V=b._selectedCoordinates.filter(function(ae){return b._selectedFeatureIds.has(ae.feature_id)});b._selectedCoordinates.length===V.length||A.silent||(b._emitSelectionChange=!0),b._selectedCoordinates=V}Oe.prototype.createRenderBatch=function(){var b=this,A=this.render,V=0;return this.render=function(){V++},function(){b.render=A,V>0&&b.render()}},Oe.prototype.setDirty=function(){return this.isDirty=!0,this},Oe.prototype.featureChanged=function(b){return this._changedFeatureIds.add(b),this},Oe.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},Oe.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},Oe.prototype.getAllIds=function(){return this._featureIds.values()},Oe.prototype.add=function(b){return this.featureChanged(b.id),this._features[b.id]=b,this._featureIds.add(b.id),this},Oe.prototype.delete=function(b,A){var V=this;return A===void 0&&(A={}),ce(b).forEach(function(ae){V._featureIds.has(ae)&&(V._featureIds.delete(ae),V._selectedFeatureIds.delete(ae),A.silent||V._deletedFeaturesToEmit.indexOf(V._features[ae])===-1&&V._deletedFeaturesToEmit.push(V._features[ae]),delete V._features[ae],V.isDirty=!0)}),le(this,A),this},Oe.prototype.get=function(b){return this._features[b]},Oe.prototype.getAll=function(){var b=this;return Object.keys(this._features).map(function(A){return b._features[A]})},Oe.prototype.select=function(b,A){var V=this;return A===void 0&&(A={}),ce(b).forEach(function(ae){V._selectedFeatureIds.has(ae)||(V._selectedFeatureIds.add(ae),V._changedFeatureIds.add(ae),A.silent||(V._emitSelectionChange=!0))}),this},Oe.prototype.deselect=function(b,A){var V=this;return A===void 0&&(A={}),ce(b).forEach(function(ae){V._selectedFeatureIds.has(ae)&&(V._selectedFeatureIds.delete(ae),V._changedFeatureIds.add(ae),A.silent||(V._emitSelectionChange=!0))}),le(this,A),this},Oe.prototype.clearSelected=function(b){return b===void 0&&(b={}),this.deselect(this._selectedFeatureIds.values(),{silent:b.silent}),this},Oe.prototype.setSelected=function(b,A){var V=this;return A===void 0&&(A={}),b=ce(b),this.deselect(this._selectedFeatureIds.values().filter(function(ae){return b.indexOf(ae)===-1}),{silent:A.silent}),this.select(b.filter(function(ae){return!V._selectedFeatureIds.has(ae)}),{silent:A.silent}),this},Oe.prototype.setSelectedCoordinates=function(b){return this._selectedCoordinates=b,this._emitSelectionChange=!0,this},Oe.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},Oe.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},Oe.prototype.getSelected=function(){var b=this;return this._selectedFeatureIds.values().map(function(A){return b.get(A)})},Oe.prototype.getSelectedCoordinates=function(){var b=this;return this._selectedCoordinates.map(function(A){return{coordinates:b.get(A.feature_id).getCoordinate(A.coord_path)}})},Oe.prototype.isSelected=function(b){return this._selectedFeatureIds.has(b)},Oe.prototype.setFeatureProperty=function(b,A,V){this.get(b).setProperty(A,V),this.featureChanged(b)},Oe.prototype.storeMapConfig=function(){var b=this;We.forEach(function(A){b.ctx.map[A]&&(b._mapInitialConfig[A]=b.ctx.map[A].isEnabled())})},Oe.prototype.restoreMapConfig=function(){var b=this;Object.keys(this._mapInitialConfig).forEach(function(A){b._mapInitialConfig[A]?b.ctx.map[A].enable():b.ctx.map[A].disable()})},Oe.prototype.getInitialConfigValue=function(b){return this._mapInitialConfig[b]===void 0||this._mapInitialConfig[b]};var ft=function(){for(var b=arguments,A={},V=0;V<arguments.length;V++){var ae=b[V];for(var me in ae)Ct.call(ae,me)&&(A[me]=ae[me])}return A},Ct=Object.prototype.hasOwnProperty,Be=u(ft),nt=["mode","feature","mouse"];function it(b){var A=null,V=null,ae={onRemove:function(){return b.map.off("load",ae.connect),clearInterval(V),ae.removeLayers(),b.store.restoreMapConfig(),b.ui.removeButtons(),b.events.removeEventListeners(),b.ui.clearMapClasses(),b.boxZoomInitial&&b.map.boxZoom.enable(),b.map=null,b.container=null,b.store=null,A&&A.parentNode&&A.parentNode.removeChild(A),A=null,this},connect:function(){b.map.off("load",ae.connect),clearInterval(V),ae.addLayers(),b.store.storeMapConfig(),b.events.addEventListeners()},onAdd:function(me){var ye=me.fire;return me.fire=function(Me,Ye){var ot=arguments;return ye.length===1&&arguments.length!==1&&(ot=[Be({},{type:Me},Ye)]),ye.apply(me,ot)},b.map=me,b.events=function(Me){var Ye=Object.keys(Me.options.modes).reduce(function(je,zt){return je[zt]=se(Me.options.modes[zt]),je},{}),ot={},wt={},Mt={},pt=null,ai=null;Mt.drag=function(je,zt){zt({point:je.point,time:new Date().getTime()})?(Me.ui.queueMapClasses({mouse:Z.DRAG}),ai.drag(je)):je.originalEvent.stopPropagation()},Mt.mousedrag=function(je){Mt.drag(je,function(zt){return!gi(ot,zt)})},Mt.touchdrag=function(je){Mt.drag(je,function(zt){return!ur(wt,zt)})},Mt.mousemove=function(je){if((je.originalEvent.buttons!==void 0?je.originalEvent.buttons:je.originalEvent.which)===1)return Mt.mousedrag(je);var zt=si(je,Me);je.featureTarget=zt,ai.mousemove(je)},Mt.mousedown=function(je){ot={time:new Date().getTime(),point:je.point};var zt=si(je,Me);je.featureTarget=zt,ai.mousedown(je)},Mt.mouseup=function(je){var zt=si(je,Me);je.featureTarget=zt,gi(ot,{point:je.point,time:new Date().getTime()})?ai.click(je):ai.mouseup(je)},Mt.mouseout=function(je){ai.mouseout(je)},Mt.touchstart=function(je){if(Me.options.touchEnabled){wt={time:new Date().getTime(),point:je.point};var zt=Yt.touch(je,null,Me)[0];je.featureTarget=zt,ai.touchstart(je)}},Mt.touchmove=function(je){if(Me.options.touchEnabled)return ai.touchmove(je),Mt.touchdrag(je)},Mt.touchend=function(je){if(je.originalEvent.preventDefault(),Me.options.touchEnabled){var zt=Yt.touch(je,null,Me)[0];je.featureTarget=zt,ur(wt,{time:new Date().getTime(),point:je.point})?ai.tap(je):ai.touchend(je)}};var dr=function(je){return!(je===8||je===46||je>=48&&je<=57)};function ci(je,zt,vi){vi===void 0&&(vi={}),ai.stop();var Sr=Ye[je];if(Sr===void 0)throw new Error(je+" is not valid");pt=je;var _r=Sr(Me,zt);ai=a(_r,Me),vi.silent||Me.map.fire(Te.MODE_CHANGE,{mode:je}),Me.store.setDirty(),Me.store.render()}Mt.keydown=function(je){(je.srcElement||je.target).classList.contains("mapboxgl-canvas")&&(je.keyCode!==8&&je.keyCode!==46||!Me.options.controls.trash?dr(je.keyCode)?ai.keydown(je):je.keyCode===49&&Me.options.controls.point?ci(ge.DRAW_POINT):je.keyCode===50&&Me.options.controls.line_string?ci(ge.DRAW_LINE_STRING):je.keyCode===51&&Me.options.controls.polygon&&ci(ge.DRAW_POLYGON):(je.preventDefault(),ai.trash()))},Mt.keyup=function(je){dr(je.keyCode)&&ai.keyup(je)},Mt.zoomend=function(){Me.store.changeZoom()},Mt.data=function(je){if(je.dataType==="style"){var zt=Me.setup,vi=Me.map,Sr=Me.options,_r=Me.store;Sr.styles.some(function(ma){return vi.getLayer(ma.id)})||(zt.addLayers(),_r.setDirty(),_r.render())}};var Lr={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){pt=Me.options.defaultMode,ai=a(Ye[pt](Me),Me)},changeMode:ci,actionable:function(je){var zt=!1;Object.keys(je).forEach(function(vi){if(Lr[vi]===void 0)throw new Error("Invalid action type");Lr[vi]!==je[vi]&&(zt=!0),Lr[vi]=je[vi]}),zt&&Me.map.fire(Te.ACTIONABLE,{actions:Lr})},currentModeName:function(){return pt},currentModeRender:function(je,zt){return ai.render(je,zt)},fire:function(je,zt){Mt[je]&&Mt[je](zt)},addEventListeners:function(){Me.map.on("mousemove",Mt.mousemove),Me.map.on("mousedown",Mt.mousedown),Me.map.on("mouseup",Mt.mouseup),Me.map.on("data",Mt.data),Me.map.on("touchmove",Mt.touchmove),Me.map.on("touchstart",Mt.touchstart),Me.map.on("touchend",Mt.touchend),Me.container.addEventListener("mouseout",Mt.mouseout),Me.options.keybindings&&(Me.container.addEventListener("keydown",Mt.keydown),Me.container.addEventListener("keyup",Mt.keyup))},removeEventListeners:function(){Me.map.off("mousemove",Mt.mousemove),Me.map.off("mousedown",Mt.mousedown),Me.map.off("mouseup",Mt.mouseup),Me.map.off("data",Mt.data),Me.map.off("touchmove",Mt.touchmove),Me.map.off("touchstart",Mt.touchstart),Me.map.off("touchend",Mt.touchend),Me.container.removeEventListener("mouseout",Mt.mouseout),Me.options.keybindings&&(Me.container.removeEventListener("keydown",Mt.keydown),Me.container.removeEventListener("keyup",Mt.keyup))},trash:function(je){ai.trash(je)},combineFeatures:function(){ai.combineFeatures()},uncombineFeatures:function(){ai.uncombineFeatures()},getMode:function(){return pt}}}(b),b.ui=function(Me){var Ye={},ot=null,wt={mode:null,feature:null,mouse:null},Mt={mode:null,feature:null,mouse:null};function pt(je){Mt=Be(Mt,je)}function ai(){var je,zt;if(Me.container){var vi=[],Sr=[];nt.forEach(function(_r){Mt[_r]!==wt[_r]&&(vi.push(_r+"-"+wt[_r]),Mt[_r]!==null&&Sr.push(_r+"-"+Mt[_r]))}),vi.length>0&&(je=Me.container.classList).remove.apply(je,vi),Sr.length>0&&(zt=Me.container.classList).add.apply(zt,Sr),wt=Be(wt,Mt)}}function dr(je,zt){zt===void 0&&(zt={});var vi=document.createElement("button");return vi.className=k.CONTROL_BUTTON+" "+zt.className,vi.setAttribute("title",zt.title),zt.container.appendChild(vi),vi.addEventListener("click",function(Sr){if(Sr.preventDefault(),Sr.stopPropagation(),Sr.target===ot)return ci(),void zt.onDeactivate();Lr(je),zt.onActivate()},!0),vi}function ci(){ot&&(ot.classList.remove(k.ACTIVE_BUTTON),ot=null)}function Lr(je){ci();var zt=Ye[je];zt&&zt&&je!=="trash"&&(zt.classList.add(k.ACTIVE_BUTTON),ot=zt)}return{setActiveButton:Lr,queueMapClasses:pt,updateMapClasses:ai,clearMapClasses:function(){pt({mode:null,feature:null,mouse:null}),ai()},addButtons:function(){var je=Me.options.controls,zt=document.createElement("div");return zt.className=k.CONTROL_GROUP+" "+k.CONTROL_BASE,je&&(je[K.LINE]&&(Ye[K.LINE]=dr(K.LINE,{container:zt,className:k.CONTROL_BUTTON_LINE,title:"LineString tool "+(Me.options.keybindings?"(l)":""),onActivate:function(){return Me.events.changeMode(ge.DRAW_LINE_STRING)},onDeactivate:function(){return Me.events.trash()}})),je[K.POLYGON]&&(Ye[K.POLYGON]=dr(K.POLYGON,{container:zt,className:k.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(Me.options.keybindings?"(p)":""),onActivate:function(){return Me.events.changeMode(ge.DRAW_POLYGON)},onDeactivate:function(){return Me.events.trash()}})),je[K.POINT]&&(Ye[K.POINT]=dr(K.POINT,{container:zt,className:k.CONTROL_BUTTON_POINT,title:"Marker tool "+(Me.options.keybindings?"(m)":""),onActivate:function(){return Me.events.changeMode(ge.DRAW_POINT)},onDeactivate:function(){return Me.events.trash()}})),je.trash&&(Ye.trash=dr("trash",{container:zt,className:k.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){Me.events.trash()}})),je.combine_features&&(Ye.combine_features=dr("combineFeatures",{container:zt,className:k.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){Me.events.combineFeatures()}})),je.uncombine_features&&(Ye.uncombine_features=dr("uncombineFeatures",{container:zt,className:k.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){Me.events.uncombineFeatures()}}))),zt},removeButtons:function(){Object.keys(Ye).forEach(function(je){var zt=Ye[je];zt.parentNode&&zt.parentNode.removeChild(zt),delete Ye[je]})}}}(b),b.container=me.getContainer(),b.store=new Oe(b),A=b.ui.addButtons(),b.options.boxSelect&&(b.boxZoomInitial=me.boxZoom.isEnabled(),me.boxZoom.disable(),me.dragPan.disable(),me.dragPan.enable()),me.loaded()?ae.connect():(me.on("load",ae.connect),V=setInterval(function(){me.loaded()&&ae.connect()},16)),b.events.start(),A},addLayers:function(){b.map.addSource(R.COLD,{data:{type:Y.FEATURE_COLLECTION,features:[]},type:"geojson"}),b.map.addSource(R.HOT,{data:{type:Y.FEATURE_COLLECTION,features:[]},type:"geojson"}),b.options.styles.forEach(function(me){b.map.addLayer(me)}),b.store.setDirty(!0),b.store.render()},removeLayers:function(){b.options.styles.forEach(function(me){b.map.getLayer(me.id)&&b.map.removeLayer(me.id)}),b.map.getSource(R.COLD)&&b.map.removeSource(R.COLD),b.map.getSource(R.HOT)&&b.map.removeSource(R.HOT)}};return b.setup=ae,ae}var At=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function Gt(b){return function(A){var V=A.featureTarget;return!!V&&!!V.properties&&V.properties.meta===b}}function jt(b){return!!b.originalEvent&&!!b.originalEvent.shiftKey&&b.originalEvent.button===0}function Wt(b){return!!b.featureTarget&&!!b.featureTarget.properties&&b.featureTarget.properties.active===Le.ACTIVE&&b.featureTarget.properties.meta===he.FEATURE}function mi(b){return!!b.featureTarget&&!!b.featureTarget.properties&&b.featureTarget.properties.active===Le.INACTIVE&&b.featureTarget.properties.meta===he.FEATURE}function Si(b){return b.featureTarget===void 0}function Ue(b){return!!b.featureTarget&&!!b.featureTarget.properties&&b.featureTarget.properties.meta===he.FEATURE}function Oi(b){var A=b.featureTarget;return!!A&&!!A.properties&&A.properties.meta===he.VERTEX}function Zi(b){return!!b.originalEvent&&b.originalEvent.shiftKey===!0}function pn(b){return b.keyCode===27}function wr(b){return b.keyCode===13}var st=Object.freeze({__proto__:null,isOfMetaType:Gt,isShiftMousedown:jt,isActiveFeature:Wt,isInactiveFeature:mi,noTarget:Si,isFeature:Ue,isVertex:Oi,isShiftDown:Zi,isEscapeKey:pn,isEnterKey:wr,isTrue:function(){return!0}}),li=Ft;function Ft(b,A){this.x=b,this.y=A}Ft.prototype={clone:function(){return new Ft(this.x,this.y)},add:function(b){return this.clone()._add(b)},sub:function(b){return this.clone()._sub(b)},multByPoint:function(b){return this.clone()._multByPoint(b)},divByPoint:function(b){return this.clone()._divByPoint(b)},mult:function(b){return this.clone()._mult(b)},div:function(b){return this.clone()._div(b)},rotate:function(b){return this.clone()._rotate(b)},rotateAround:function(b,A){return this.clone()._rotateAround(b,A)},matMult:function(b){return this.clone()._matMult(b)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(b){return this.x===b.x&&this.y===b.y},dist:function(b){return Math.sqrt(this.distSqr(b))},distSqr:function(b){var A=b.x-this.x,V=b.y-this.y;return A*A+V*V},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(b){return Math.atan2(this.y-b.y,this.x-b.x)},angleWith:function(b){return this.angleWithSep(b.x,b.y)},angleWithSep:function(b,A){return Math.atan2(this.x*A-this.y*b,this.x*b+this.y*A)},_matMult:function(b){var A=b[0]*this.x+b[1]*this.y,V=b[2]*this.x+b[3]*this.y;return this.x=A,this.y=V,this},_add:function(b){return this.x+=b.x,this.y+=b.y,this},_sub:function(b){return this.x-=b.x,this.y-=b.y,this},_mult:function(b){return this.x*=b,this.y*=b,this},_div:function(b){return this.x/=b,this.y/=b,this},_multByPoint:function(b){return this.x*=b.x,this.y*=b.y,this},_divByPoint:function(b){return this.x/=b.x,this.y/=b.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var b=this.y;return this.y=this.x,this.x=-b,this},_rotate:function(b){var A=Math.cos(b),V=Math.sin(b),ae=A*this.x-V*this.y,me=V*this.x+A*this.y;return this.x=ae,this.y=me,this},_rotateAround:function(b,A){var V=Math.cos(b),ae=Math.sin(b),me=A.x+V*(this.x-A.x)-ae*(this.y-A.y),ye=A.y+ae*(this.x-A.x)+V*(this.y-A.y);return this.x=me,this.y=ye,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ft.convert=function(b){return b instanceof Ft?b:Array.isArray(b)?new Ft(b[0],b[1]):b};var $i=u(li);function mn(b,A){var V=A.getBoundingClientRect();return new $i(b.clientX-V.left-(A.clientLeft||0),b.clientY-V.top-(A.clientTop||0))}function ei(b,A,V,ae){return{type:Y.FEATURE,properties:{meta:he.VERTEX,parent:b,coord_path:V,active:ae?Le.ACTIVE:Le.INACTIVE},geometry:{type:Y.POINT,coordinates:A}}}function Js(b,A,V){var ae=A.geometry.coordinates,me=V.geometry.coordinates;if(ae[1]>85||ae[1]<Qe||me[1]>85||me[1]<Qe)return null;var ye={lng:(ae[0]+me[0])/2,lat:(ae[1]+me[1])/2};return{type:Y.FEATURE,properties:{meta:he.MIDPOINT,parent:b,lng:ye.lng,lat:ye.lat,coord_path:V.properties.coord_path},geometry:{type:Y.POINT,coordinates:[ye.lng,ye.lat]}}}function Mr(b,A,V){A===void 0&&(A={}),V===void 0&&(V=null);var ae,me=b.geometry,ye=me.type,Me=me.coordinates,Ye=b.properties&&b.properties.id,ot=[];function wt(pt,ai){var dr="",ci=null;pt.forEach(function(Lr,je){var zt=ai!=null?ai+"."+je:String(je),vi=ei(Ye,Lr,zt,Mt(zt));if(A.midpoints&&ci){var Sr=Js(Ye,ci,vi);Sr&&ot.push(Sr)}ci=vi;var _r=JSON.stringify(Lr);dr!==_r&&ot.push(vi),je===0&&(dr=_r)})}function Mt(pt){return!!A.selectedPaths&&A.selectedPaths.indexOf(pt)!==-1}return ye===Y.POINT?ot.push(ei(Ye,Me,V,Mt(V))):ye===Y.POLYGON?Me.forEach(function(pt,ai){wt(pt,V!==null?V+"."+ai:String(ai))}):ye===Y.LINE_STRING?wt(Me,V):ye.indexOf(Y.MULTI_PREFIX)===0&&(ae=ye.replace(Y.MULTI_PREFIX,""),Me.forEach(function(pt,ai){var dr={type:Y.FEATURE,properties:b.properties,geometry:{type:ae,coordinates:pt}};ot=ot.concat(Mr(dr,A,ai))})),ot}var ee={enable:function(b){setTimeout(function(){b.map&&b.map.doubleClickZoom&&b._ctx&&b._ctx.store&&b._ctx.store.getInitialConfigValue&&b._ctx.store.getInitialConfigValue("doubleClickZoom")&&b.map.doubleClickZoom.enable()},0)},disable:function(b){setTimeout(function(){b.map&&b.map.doubleClickZoom&&b.map.doubleClickZoom.disable()},0)}},N={exports:{}},U=function(b){if(!b||!b.type)return null;var A=H[b.type];if(!A)return null;if(A==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:b}]};if(A==="feature")return{type:"FeatureCollection",features:[b]};if(A==="featurecollection")return b},H={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},J=u(U),_e=Object.freeze({__proto__:null,default:function b(A){switch(A&&A.type||null){case"FeatureCollection":return A.features=A.features.reduce(function(V,ae){return V.concat(b(ae))},[]),A;case"Feature":return A.geometry?b(A.geometry).map(function(V){var ae={type:"Feature",properties:JSON.parse(JSON.stringify(A.properties)),geometry:V};return A.id!==void 0&&(ae.id=A.id),ae}):[A];case"MultiPoint":return A.coordinates.map(function(V){return{type:"Point",coordinates:V}});case"MultiPolygon":return A.coordinates.map(function(V){return{type:"Polygon",coordinates:V}});case"MultiLineString":return A.coordinates.map(function(V){return{type:"LineString",coordinates:V}});case"GeometryCollection":return A.geometries.map(b).reduce(function(V,ae){return V.concat(ae)},[]);case"Point":case"Polygon":case"LineString":return[A]}}}),ve=U,we=d(_e),de=function(b){return function A(V){return Array.isArray(V)&&V.length&&typeof V[0]=="number"?[V]:V.reduce(function(ae,me){return Array.isArray(me)&&Array.isArray(me[0])?ae.concat(A(me)):(ae.push(me),ae)},[])}(b)};we instanceof Function||(we=we.default);var Ie={exports:{}},qe=Ie.exports=function(b){return new Re(b)};function Re(b){this.value=b}function Ne(b,A,V){var ae=[],me=[],ye=!0;return function Me(Ye){var ot=V?Bt(Ye):Ye,wt={},Mt=!0,pt={node:ot,node_:Ye,path:[].concat(ae),parent:me[me.length-1],parents:me,key:ae.slice(-1)[0],isRoot:ae.length===0,level:ae.length,circular:null,update:function(ci,Lr){pt.isRoot||(pt.parent.node[pt.key]=ci),pt.node=ci,Lr&&(Mt=!1)},delete:function(ci){delete pt.parent.node[pt.key],ci&&(Mt=!1)},remove:function(ci){ri(pt.parent.node)?pt.parent.node.splice(pt.key,1):delete pt.parent.node[pt.key],ci&&(Mt=!1)},keys:null,before:function(ci){wt.before=ci},after:function(ci){wt.after=ci},pre:function(ci){wt.pre=ci},post:function(ci){wt.post=ci},stop:function(){ye=!1},block:function(){Mt=!1}};if(!ye)return pt;function ai(){if(typeof pt.node=="object"&&pt.node!==null){pt.keys&&pt.node_===pt.node||(pt.keys=Vt(pt.node)),pt.isLeaf=pt.keys.length==0;for(var ci=0;ci<me.length;ci++)if(me[ci].node_===Ye){pt.circular=me[ci];break}}else pt.isLeaf=!0,pt.keys=null;pt.notLeaf=!pt.isLeaf,pt.notRoot=!pt.isRoot}ai();var dr=A.call(pt,pt.node);return dr!==void 0&&pt.update&&pt.update(dr),wt.before&&wt.before.call(pt,pt.node),Mt&&(typeof pt.node!="object"||pt.node===null||pt.circular||(me.push(pt),ai(),_i(pt.keys,function(ci,Lr){ae.push(ci),wt.pre&&wt.pre.call(pt,pt.node[ci],ci);var je=Me(pt.node[ci]);V&&Bi.call(pt.node,ci)&&(pt.node[ci]=je.node),je.isLast=Lr==pt.keys.length-1,je.isFirst=Lr==0,wt.post&&wt.post.call(pt,je),ae.pop()}),me.pop()),wt.after&&wt.after.call(pt,pt.node)),pt}(b).node}function Bt(b){if(typeof b=="object"&&b!==null){var A;if(ri(b))A=[];else if(ti(b)==="[object Date]")A=new Date(b.getTime?b.getTime():b);else if(function(me){return ti(me)==="[object RegExp]"}(b))A=new RegExp(b);else if(function(me){return ti(me)==="[object Error]"}(b))A={message:b.message};else if(function(me){return ti(me)==="[object Boolean]"}(b))A=new Boolean(b);else if(function(me){return ti(me)==="[object Number]"}(b))A=new Number(b);else if(function(me){return ti(me)==="[object String]"}(b))A=new String(b);else if(Object.create&&Object.getPrototypeOf)A=Object.create(Object.getPrototypeOf(b));else if(b.constructor===Object)A={};else{var V=b.constructor&&b.constructor.prototype||b.__proto__||{},ae=function(){};ae.prototype=V,A=new ae}return _i(Vt(b),function(me){A[me]=b[me]}),A}return b}Re.prototype.get=function(b){for(var A=this.value,V=0;V<b.length;V++){var ae=b[V];if(!A||!Bi.call(A,ae)){A=void 0;break}A=A[ae]}return A},Re.prototype.has=function(b){for(var A=this.value,V=0;V<b.length;V++){var ae=b[V];if(!A||!Bi.call(A,ae))return!1;A=A[ae]}return!0},Re.prototype.set=function(b,A){for(var V=this.value,ae=0;ae<b.length-1;ae++){var me=b[ae];Bi.call(V,me)||(V[me]={}),V=V[me]}return V[b[ae]]=A,A},Re.prototype.map=function(b){return Ne(this.value,b,!0)},Re.prototype.forEach=function(b){return this.value=Ne(this.value,b,!1),this.value},Re.prototype.reduce=function(b,A){var V=arguments.length===1,ae=V?this.value:A;return this.forEach(function(me){this.isRoot&&V||(ae=b.call(this,ae,me))}),ae},Re.prototype.paths=function(){var b=[];return this.forEach(function(A){b.push(this.path)}),b},Re.prototype.nodes=function(){var b=[];return this.forEach(function(A){b.push(this.node)}),b},Re.prototype.clone=function(){var b=[],A=[];return function V(ae){for(var me=0;me<b.length;me++)if(b[me]===ae)return A[me];if(typeof ae=="object"&&ae!==null){var ye=Bt(ae);return b.push(ae),A.push(ye),_i(Vt(ae),function(Me){ye[Me]=V(ae[Me])}),b.pop(),A.pop(),ye}return ae}(this.value)};var Vt=Object.keys||function(b){var A=[];for(var V in b)A.push(V);return A};function ti(b){return Object.prototype.toString.call(b)}var ri=Array.isArray||function(b){return Object.prototype.toString.call(b)==="[object Array]"},_i=function(b,A){if(b.forEach)return b.forEach(A);for(var V=0;V<b.length;V++)A(b[V],V,b)};_i(Vt(Re.prototype),function(b){qe[b]=function(A){var V=[].slice.call(arguments,1),ae=new Re(A);return ae[b].apply(ae,V)}});var Bi=Object.hasOwnProperty||function(b,A){return A in b},sr=Ie.exports,Fr=Zt;function Zt(b){if(!(this instanceof Zt))return new Zt(b);this._bbox=b||[1/0,1/0,-1/0,-1/0],this._valid=!!b}Zt.prototype.include=function(b){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],b[0]),this._bbox[1]=Math.min(this._bbox[1],b[1]),this._bbox[2]=Math.max(this._bbox[2],b[0]),this._bbox[3]=Math.max(this._bbox[3],b[1]),this},Zt.prototype.equals=function(b){var A;return A=b instanceof Zt?b.bbox():b,this._bbox[0]==A[0]&&this._bbox[1]==A[1]&&this._bbox[2]==A[2]&&this._bbox[3]==A[3]},Zt.prototype.center=function(b){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},Zt.prototype.union=function(b){var A;return this._valid=!0,A=b instanceof Zt?b.bbox():b,this._bbox[0]=Math.min(this._bbox[0],A[0]),this._bbox[1]=Math.min(this._bbox[1],A[1]),this._bbox[2]=Math.max(this._bbox[2],A[2]),this._bbox[3]=Math.max(this._bbox[3],A[3]),this},Zt.prototype.bbox=function(){return this._valid?this._bbox:null},Zt.prototype.contains=function(b){if(!b)return this._fastContains();if(!this._valid)return null;var A=b[0],V=b[1];return this._bbox[0]<=A&&this._bbox[1]<=V&&this._bbox[2]>=A&&this._bbox[3]>=V},Zt.prototype.intersect=function(b){return this._valid?(A=b instanceof Zt?b.bbox():b,!(this._bbox[0]>A[2]||this._bbox[2]<A[0]||this._bbox[3]<A[1]||this._bbox[1]>A[3])):null;var A},Zt.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var b="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",b)},Zt.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var yr=function(b){if(!b)return[];var A=we(ve(b)),V=[];return A.features.forEach(function(ae){ae.geometry&&(V=V.concat(de(ae.geometry.coordinates)))}),V},Vr=sr,gn=Fr,yn={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},Zr=Object.keys(yn);function jn(b){for(var A=gn(),V=yr(b),ae=0;ae<V.length;ae++)A.include(V[ae]);return A}N.exports=function(b){return jn(b).bbox()},N.exports.polygon=function(b){return jn(b).polygon()},N.exports.bboxify=function(b){return Vr(b).map(function(A){A&&Zr.some(function(V){return!!A[V]&&yn[V].indexOf(A.type)!==-1})&&(A.bbox=jn(A).bbox(),this.update(A))})};var pc=u(N.exports),zo=-90;function Ni(b,A){var V=zo,ae=90,me=zo,ye=90,Me=270,Ye=-270;b.forEach(function(wt){var Mt=pc(wt),pt=Mt[1],ai=Mt[3],dr=Mt[0],ci=Mt[2];pt>V&&(V=pt),ai<ae&&(ae=ai),ai>me&&(me=ai),pt<ye&&(ye=pt),dr<Me&&(Me=dr),ci>Ye&&(Ye=ci)});var ot=A;return V+ot.lat>85&&(ot.lat=85-V),me+ot.lat>90&&(ot.lat=90-me),ae+ot.lat<-85&&(ot.lat=-85-ae),ye+ot.lat<zo&&(ot.lat=zo-ye),Me+ot.lng<=-270&&(ot.lng+=360*Math.ceil(Math.abs(ot.lng)/360)),Ye+ot.lng>=270&&(ot.lng-=360*Math.ceil(Math.abs(ot.lng)/360)),ot}function lo(b,A){var V=Ni(b.map(function(ae){return ae.toGeoJSON()}),A);b.forEach(function(ae){var me,ye=ae.getCoordinates(),Me=function(ot){var wt={lng:ot[0]+V.lng,lat:ot[1]+V.lat};return[wt.lng,wt.lat]},Ye=function(ot){return ot.map(function(wt){return Me(wt)})};ae.type===Y.POINT?me=Me(ye):ae.type===Y.LINE_STRING||ae.type===Y.MULTI_POINT?me=ye.map(Me):ae.type===Y.POLYGON||ae.type===Y.MULTI_LINE_STRING?me=ye.map(Ye):ae.type===Y.MULTI_POLYGON&&(me=ye.map(function(ot){return ot.map(function(wt){return Ye(wt)})})),ae.incomingCoords(me)})}var Pr={onSetup:function(b){var A=this,V={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:b.featureIds||[]};return this.setSelected(V.initiallySelectedFeatureIds.filter(function(ae){return A.getFeature(ae)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),V},fireUpdate:function(){this.map.fire(Te.UPDATE,{action:Fe.MOVE,features:this.getSelected().map(function(b){return b.toGeoJSON()})})},fireActionable:function(){var b=this,A=this.getSelected(),V=A.filter(function(Ye){return b.isInstanceOf("MultiFeature",Ye)}),ae=!1;if(A.length>1){ae=!0;var me=A[0].type.replace("Multi","");A.forEach(function(Ye){Ye.type.replace("Multi","")!==me&&(ae=!1)})}var ye=V.length>0,Me=A.length>0;this.setActionableState({combineFeatures:ae,uncombineFeatures:ye,trash:Me})},getUniqueIds:function(b){return b.length?b.map(function(A){return A.properties.id}).filter(function(A){return A!==void 0}).reduce(function(A,V){return A.add(V),A},new oi).values():[]},stopExtendedInteractions:function(b){b.boxSelectElement&&(b.boxSelectElement.parentNode&&b.boxSelectElement.parentNode.removeChild(b.boxSelectElement),b.boxSelectElement=null),this.map.dragPan.enable(),b.boxSelecting=!1,b.canBoxSelect=!1,b.dragMoving=!1,b.canDragMove=!1},onStop:function(){ee.enable(this)},onMouseMove:function(b,A){return Ue(A)&&b.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(b),!0},onMouseOut:function(b){return!b.dragMoving||this.fireUpdate()}};Pr.onTap=Pr.onClick=function(b,A){return Si(A)?this.clickAnywhere(b,A):Gt(he.VERTEX)(A)?this.clickOnVertex(b,A):Ue(A)?this.clickOnFeature(b,A):void 0},Pr.clickAnywhere=function(b){var A=this,V=this.getSelectedIds();V.length&&(this.clearSelectedFeatures(),V.forEach(function(ae){return A.doRender(ae)})),ee.enable(this),this.stopExtendedInteractions(b)},Pr.clickOnVertex=function(b,A){this.changeMode(ge.DIRECT_SELECT,{featureId:A.featureTarget.properties.parent,coordPath:A.featureTarget.properties.coord_path,startPos:A.lngLat}),this.updateUIClasses({mouse:Z.MOVE})},Pr.startOnActiveFeature=function(b,A){this.stopExtendedInteractions(b),this.map.dragPan.disable(),this.doRender(A.featureTarget.properties.id),b.canDragMove=!0,b.dragMoveLocation=A.lngLat},Pr.clickOnFeature=function(b,A){var V=this;ee.disable(this),this.stopExtendedInteractions(b);var ae=Zi(A),me=this.getSelectedIds(),ye=A.featureTarget.properties.id,Me=this.isSelected(ye);if(!ae&&Me&&this.getFeature(ye).type!==Y.POINT)return this.changeMode(ge.DIRECT_SELECT,{featureId:ye});Me&&ae?(this.deselect(ye),this.updateUIClasses({mouse:Z.POINTER}),me.length===1&&ee.enable(this)):!Me&&ae?(this.select(ye),this.updateUIClasses({mouse:Z.MOVE})):Me||ae||(me.forEach(function(Ye){return V.doRender(Ye)}),this.setSelected(ye),this.updateUIClasses({mouse:Z.MOVE})),this.doRender(ye)},Pr.onMouseDown=function(b,A){return Wt(A)?this.startOnActiveFeature(b,A):this.drawConfig.boxSelect&&jt(A)?this.startBoxSelect(b,A):void 0},Pr.startBoxSelect=function(b,A){this.stopExtendedInteractions(b),this.map.dragPan.disable(),b.boxSelectStartLocation=mn(A.originalEvent,this.map.getContainer()),b.canBoxSelect=!0},Pr.onTouchStart=function(b,A){if(Wt(A))return this.startOnActiveFeature(b,A)},Pr.onDrag=function(b,A){return b.canDragMove?this.dragMove(b,A):this.drawConfig.boxSelect&&b.canBoxSelect?this.whileBoxSelect(b,A):void 0},Pr.whileBoxSelect=function(b,A){b.boxSelecting=!0,this.updateUIClasses({mouse:Z.ADD}),b.boxSelectElement||(b.boxSelectElement=document.createElement("div"),b.boxSelectElement.classList.add(k.BOX_SELECT),this.map.getContainer().appendChild(b.boxSelectElement));var V=mn(A.originalEvent,this.map.getContainer()),ae=Math.min(b.boxSelectStartLocation.x,V.x),me=Math.max(b.boxSelectStartLocation.x,V.x),ye=Math.min(b.boxSelectStartLocation.y,V.y),Me=Math.max(b.boxSelectStartLocation.y,V.y),Ye="translate("+ae+"px, "+ye+"px)";b.boxSelectElement.style.transform=Ye,b.boxSelectElement.style.WebkitTransform=Ye,b.boxSelectElement.style.width=me-ae+"px",b.boxSelectElement.style.height=Me-ye+"px"},Pr.dragMove=function(b,A){b.dragMoving=!0,A.originalEvent.stopPropagation();var V={lng:A.lngLat.lng-b.dragMoveLocation.lng,lat:A.lngLat.lat-b.dragMoveLocation.lat};lo(this.getSelected(),V),b.dragMoveLocation=A.lngLat},Pr.onTouchEnd=Pr.onMouseUp=function(b,A){var V=this;if(b.dragMoving)this.fireUpdate();else if(b.boxSelecting){var ae=[b.boxSelectStartLocation,mn(A.originalEvent,this.map.getContainer())],me=this.featuresAt(null,ae,"click"),ye=this.getUniqueIds(me).filter(function(Me){return!V.isSelected(Me)});ye.length&&(this.select(ye),ye.forEach(function(Me){return V.doRender(Me)}),this.updateUIClasses({mouse:Z.MOVE}))}this.stopExtendedInteractions(b)},Pr.toDisplayFeatures=function(b,A,V){A.properties.active=this.isSelected(A.properties.id)?Le.ACTIVE:Le.INACTIVE,V(A),this.fireActionable(),A.properties.active===Le.ACTIVE&&A.geometry.type!==Y.POINT&&Mr(A).forEach(V)},Pr.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},Pr.onCombineFeatures=function(){var b=this.getSelected();if(!(b.length===0||b.length<2)){for(var A=[],V=[],ae=b[0].type.replace("Multi",""),me=0;me<b.length;me++){var ye=b[me];if(ye.type.replace("Multi","")!==ae)return;ye.type.includes("Multi")?ye.getCoordinates().forEach(function(Ye){A.push(Ye)}):A.push(ye.getCoordinates()),V.push(ye.toGeoJSON())}if(V.length>1){var Me=this.newFeature({type:Y.FEATURE,properties:V[0].properties,geometry:{type:"Multi"+ae,coordinates:A}});this.addFeature(Me),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([Me.id]),this.map.fire(Te.COMBINE_FEATURES,{createdFeatures:[Me.toGeoJSON()],deletedFeatures:V})}this.fireActionable()}},Pr.onUncombineFeatures=function(){var b=this,A=this.getSelected();if(A.length!==0){for(var V=[],ae=[],me=function(Me){var Ye=A[Me];b.isInstanceOf("MultiFeature",Ye)&&(Ye.getFeatures().forEach(function(ot){b.addFeature(ot),ot.properties=Ye.properties,V.push(ot.toGeoJSON()),b.select([ot.id])}),b.deleteFeature(Ye.id,{silent:!0}),ae.push(Ye.toGeoJSON()))},ye=0;ye<A.length;ye++)me(ye);V.length>1&&this.map.fire(Te.UNCOMBINE_FEATURES,{createdFeatures:V,deletedFeatures:ae}),this.fireActionable()}};var An=Gt(he.VERTEX),_n=Gt(he.MIDPOINT),qn={fireUpdate:function(){this.map.fire(Te.UPDATE,{action:Fe.CHANGE_COORDINATES,features:this.getSelected().map(function(b){return b.toGeoJSON()})})},fireActionable:function(b){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:b.selectedCoordPaths.length>0})},startDragging:function(b,A){this.map.dragPan.disable(),b.canDragMove=!0,b.dragMoveLocation=A.lngLat},stopDragging:function(b){this.map.dragPan.enable(),b.dragMoving=!1,b.canDragMove=!1,b.dragMoveLocation=null},onVertex:function(b,A){this.startDragging(b,A);var V=A.featureTarget.properties,ae=b.selectedCoordPaths.indexOf(V.coord_path);Zi(A)||ae!==-1?Zi(A)&&ae===-1&&b.selectedCoordPaths.push(V.coord_path):b.selectedCoordPaths=[V.coord_path];var me=this.pathsToCoordinates(b.featureId,b.selectedCoordPaths);this.setSelectedCoordinates(me)},onMidpoint:function(b,A){this.startDragging(b,A);var V=A.featureTarget.properties;b.feature.addCoordinate(V.coord_path,V.lng,V.lat),this.fireUpdate(),b.selectedCoordPaths=[V.coord_path]},pathsToCoordinates:function(b,A){return A.map(function(V){return{feature_id:b,coord_path:V}})},onFeature:function(b,A){b.selectedCoordPaths.length===0?this.startDragging(b,A):this.stopDragging(b)},dragFeature:function(b,A,V){lo(this.getSelected(),V),b.dragMoveLocation=A.lngLat},dragVertex:function(b,A,V){for(var ae=b.selectedCoordPaths.map(function(Ye){return b.feature.getCoordinate(Ye)}),me=Ni(ae.map(function(Ye){return{type:Y.FEATURE,properties:{},geometry:{type:Y.POINT,coordinates:Ye}}}),V),ye=0;ye<ae.length;ye++){var Me=ae[ye];b.feature.updateCoordinate(b.selectedCoordPaths[ye],Me[0]+me.lng,Me[1]+me.lat)}},clickNoTarget:function(){this.changeMode(ge.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(ge.SIMPLE_SELECT)},clickActiveFeature:function(b){b.selectedCoordPaths=[],this.clearSelectedCoordinates(),b.feature.changed()},onSetup:function(b){var A=b.featureId,V=this.getFeature(A);if(!V)throw new Error("You must provide a featureId to enter direct_select mode");if(V.type===Y.POINT)throw new TypeError("direct_select mode doesn't handle point features");var ae={featureId:A,feature:V,dragMoveLocation:b.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:b.coordPath?[b.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(A,ae.selectedCoordPaths)),this.setSelected(A),ee.disable(this),this.setActionableState({trash:!0}),ae},onStop:function(){ee.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(b,A,V){b.featureId===A.properties.id?(A.properties.active=Le.ACTIVE,V(A),Mr(A,{map:this.map,midpoints:!0,selectedPaths:b.selectedCoordPaths}).forEach(V)):(A.properties.active=Le.INACTIVE,V(A)),this.fireActionable(b)},onTrash:function(b){b.selectedCoordPaths.sort(function(A,V){return V.localeCompare(A,"en",{numeric:!0})}).forEach(function(A){return b.feature.removeCoordinate(A)}),this.fireUpdate(),b.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(b),b.feature.isValid()===!1&&(this.deleteFeature([b.featureId]),this.changeMode(ge.SIMPLE_SELECT,{}))},onMouseMove:function(b,A){var V=Wt(A),ae=An(A),me=_n(A),ye=b.selectedCoordPaths.length===0;return V&&ye||ae&&!ye?this.updateUIClasses({mouse:Z.MOVE}):this.updateUIClasses({mouse:Z.NONE}),(ae||V||me)&&b.dragMoving&&this.fireUpdate(),this.stopDragging(b),!0},onMouseOut:function(b){return b.dragMoving&&this.fireUpdate(),!0}};qn.onTouchStart=qn.onMouseDown=function(b,A){return An(A)?this.onVertex(b,A):Wt(A)?this.onFeature(b,A):_n(A)?this.onMidpoint(b,A):void 0},qn.onDrag=function(b,A){if(b.canDragMove===!0){b.dragMoving=!0,A.originalEvent.stopPropagation();var V={lng:A.lngLat.lng-b.dragMoveLocation.lng,lat:A.lngLat.lat-b.dragMoveLocation.lat};b.selectedCoordPaths.length>0?this.dragVertex(b,A,V):this.dragFeature(b,A,V),b.dragMoveLocation=A.lngLat}},qn.onClick=function(b,A){return Si(A)?this.clickNoTarget(b,A):Wt(A)?this.clickActiveFeature(b,A):mi(A)?this.clickInactive(b,A):void this.stopDragging(b)},qn.onTap=function(b,A){return Si(A)?this.clickNoTarget(b,A):Wt(A)?this.clickActiveFeature(b,A):mi(A)?this.clickInactive(b,A):void 0},qn.onTouchEnd=qn.onMouseUp=function(b){b.dragMoving&&this.fireUpdate(),this.stopDragging(b)};var kr={};function vn(b,A){return!!b.lngLat&&b.lngLat.lng===A[0]&&b.lngLat.lat===A[1]}kr.onSetup=function(){var b=this.newFeature({type:Y.FEATURE,properties:{},geometry:{type:Y.POINT,coordinates:[]}});return this.addFeature(b),this.clearSelectedFeatures(),this.updateUIClasses({mouse:Z.ADD}),this.activateUIButton(K.POINT),this.setActionableState({trash:!0}),{point:b}},kr.stopDrawingAndRemove=function(b){this.deleteFeature([b.point.id],{silent:!0}),this.changeMode(ge.SIMPLE_SELECT)},kr.onTap=kr.onClick=function(b,A){this.updateUIClasses({mouse:Z.MOVE}),b.point.updateCoordinate("",A.lngLat.lng,A.lngLat.lat),this.map.fire(Te.CREATE,{features:[b.point.toGeoJSON()]}),this.changeMode(ge.SIMPLE_SELECT,{featureIds:[b.point.id]})},kr.onStop=function(b){this.activateUIButton(),b.point.getCoordinate().length||this.deleteFeature([b.point.id],{silent:!0})},kr.toDisplayFeatures=function(b,A,V){var ae=A.properties.id===b.point.id;if(A.properties.active=ae?Le.ACTIVE:Le.INACTIVE,!ae)return V(A)},kr.onTrash=kr.stopDrawingAndRemove,kr.onKeyUp=function(b,A){if(pn(A)||wr(A))return this.stopDrawingAndRemove(b,A)};var Gn={onSetup:function(){var b=this.newFeature({type:Y.FEATURE,properties:{},geometry:{type:Y.POLYGON,coordinates:[[]]}});return this.addFeature(b),this.clearSelectedFeatures(),ee.disable(this),this.updateUIClasses({mouse:Z.ADD}),this.activateUIButton(K.POLYGON),this.setActionableState({trash:!0}),{polygon:b,currentVertexPosition:0}},clickAnywhere:function(b,A){if(b.currentVertexPosition>0&&vn(A,b.polygon.coordinates[0][b.currentVertexPosition-1]))return this.changeMode(ge.SIMPLE_SELECT,{featureIds:[b.polygon.id]});this.updateUIClasses({mouse:Z.ADD}),b.polygon.updateCoordinate("0."+b.currentVertexPosition,A.lngLat.lng,A.lngLat.lat),b.currentVertexPosition++,b.polygon.updateCoordinate("0."+b.currentVertexPosition,A.lngLat.lng,A.lngLat.lat)},clickOnVertex:function(b){return this.changeMode(ge.SIMPLE_SELECT,{featureIds:[b.polygon.id]})},onMouseMove:function(b,A){b.polygon.updateCoordinate("0."+b.currentVertexPosition,A.lngLat.lng,A.lngLat.lat),Oi(A)&&this.updateUIClasses({mouse:Z.POINTER})}};Gn.onTap=Gn.onClick=function(b,A){return Oi(A)?this.clickOnVertex(b,A):this.clickAnywhere(b,A)},Gn.onKeyUp=function(b,A){pn(A)?(this.deleteFeature([b.polygon.id],{silent:!0}),this.changeMode(ge.SIMPLE_SELECT)):wr(A)&&this.changeMode(ge.SIMPLE_SELECT,{featureIds:[b.polygon.id]})},Gn.onStop=function(b){this.updateUIClasses({mouse:Z.NONE}),ee.enable(this),this.activateUIButton(),this.getFeature(b.polygon.id)!==void 0&&(b.polygon.removeCoordinate("0."+b.currentVertexPosition),b.polygon.isValid()?this.map.fire(Te.CREATE,{features:[b.polygon.toGeoJSON()]}):(this.deleteFeature([b.polygon.id],{silent:!0}),this.changeMode(ge.SIMPLE_SELECT,{},{silent:!0})))},Gn.toDisplayFeatures=function(b,A,V){var ae=A.properties.id===b.polygon.id;if(A.properties.active=ae?Le.ACTIVE:Le.INACTIVE,!ae)return V(A);if(A.geometry.coordinates.length!==0){var me=A.geometry.coordinates[0].length;if(!(me<3)){if(A.properties.meta=he.FEATURE,V(ei(b.polygon.id,A.geometry.coordinates[0][0],"0.0",!1)),me>3){var ye=A.geometry.coordinates[0].length-3;V(ei(b.polygon.id,A.geometry.coordinates[0][ye],"0."+ye,!1))}if(me<=4){var Me=[[A.geometry.coordinates[0][0][0],A.geometry.coordinates[0][0][1]],[A.geometry.coordinates[0][1][0],A.geometry.coordinates[0][1][1]]];if(V({type:Y.FEATURE,properties:A.properties,geometry:{coordinates:Me,type:Y.LINE_STRING}}),me===3)return}return V(A)}}},Gn.onTrash=function(b){this.deleteFeature([b.polygon.id],{silent:!0}),this.changeMode(ge.SIMPLE_SELECT)};var gs={onSetup:function(b){var A,V,ae=(b=b||{}).featureId,me="forward";if(ae){if(!(A=this.getFeature(ae)))throw new Error("Could not find a feature with the provided featureId");var ye=b.from;if(ye&&ye.type==="Feature"&&ye.geometry&&ye.geometry.type==="Point"&&(ye=ye.geometry),ye&&ye.type==="Point"&&ye.coordinates&&ye.coordinates.length===2&&(ye=ye.coordinates),!ye||!Array.isArray(ye))throw new Error("Please use the `from` property to indicate which point to continue the line from");var Me=A.coordinates.length-1;if(A.coordinates[Me][0]===ye[0]&&A.coordinates[Me][1]===ye[1])V=Me+1,A.addCoordinate.apply(A,[V].concat(A.coordinates[Me]));else{if(A.coordinates[0][0]!==ye[0]||A.coordinates[0][1]!==ye[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");me="backwards",V=0,A.addCoordinate.apply(A,[V].concat(A.coordinates[0]))}}else A=this.newFeature({type:Y.FEATURE,properties:{},geometry:{type:Y.LINE_STRING,coordinates:[]}}),V=0,this.addFeature(A);return this.clearSelectedFeatures(),ee.disable(this),this.updateUIClasses({mouse:Z.ADD}),this.activateUIButton(K.LINE),this.setActionableState({trash:!0}),{line:A,currentVertexPosition:V,direction:me}},clickAnywhere:function(b,A){if(b.currentVertexPosition>0&&vn(A,b.line.coordinates[b.currentVertexPosition-1])||b.direction==="backwards"&&vn(A,b.line.coordinates[b.currentVertexPosition+1]))return this.changeMode(ge.SIMPLE_SELECT,{featureIds:[b.line.id]});this.updateUIClasses({mouse:Z.ADD}),b.line.updateCoordinate(b.currentVertexPosition,A.lngLat.lng,A.lngLat.lat),b.direction==="forward"?(b.currentVertexPosition++,b.line.updateCoordinate(b.currentVertexPosition,A.lngLat.lng,A.lngLat.lat)):b.line.addCoordinate(0,A.lngLat.lng,A.lngLat.lat)},clickOnVertex:function(b){return this.changeMode(ge.SIMPLE_SELECT,{featureIds:[b.line.id]})},onMouseMove:function(b,A){b.line.updateCoordinate(b.currentVertexPosition,A.lngLat.lng,A.lngLat.lat),Oi(A)&&this.updateUIClasses({mouse:Z.POINTER})}};gs.onTap=gs.onClick=function(b,A){if(Oi(A))return this.clickOnVertex(b,A);this.clickAnywhere(b,A)},gs.onKeyUp=function(b,A){wr(A)?this.changeMode(ge.SIMPLE_SELECT,{featureIds:[b.line.id]}):pn(A)&&(this.deleteFeature([b.line.id],{silent:!0}),this.changeMode(ge.SIMPLE_SELECT))},gs.onStop=function(b){ee.enable(this),this.activateUIButton(),this.getFeature(b.line.id)!==void 0&&(b.line.removeCoordinate(""+b.currentVertexPosition),b.line.isValid()?this.map.fire(Te.CREATE,{features:[b.line.toGeoJSON()]}):(this.deleteFeature([b.line.id],{silent:!0}),this.changeMode(ge.SIMPLE_SELECT,{},{silent:!0})))},gs.onTrash=function(b){this.deleteFeature([b.line.id],{silent:!0}),this.changeMode(ge.SIMPLE_SELECT)},gs.toDisplayFeatures=function(b,A,V){var ae=A.properties.id===b.line.id;if(A.properties.active=ae?Le.ACTIVE:Le.INACTIVE,!ae)return V(A);A.geometry.coordinates.length<2||(A.properties.meta=he.FEATURE,V(ei(b.line.id,A.geometry.coordinates[b.direction==="forward"?A.geometry.coordinates.length-2:1],""+(b.direction==="forward"?A.geometry.coordinates.length-2:1),!1)),V(A))};var Dr={simple_select:Pr,direct_select:qn,draw_point:kr,draw_polygon:Gn,draw_line_string:gs},co={defaultMode:ge.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:At,modes:Dr,controls:{},userProperties:!1},Qs={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},hr={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function uo(b,A){return b.map(function(V){return V.source?V:Be(V,{id:V.id+"."+A,source:A==="hot"?R.HOT:R.COLD})})}var xn={exports:{}};(function(b,A){var V="__lodash_hash_undefined__",ae=9007199254740991,me="[object Arguments]",ye="[object Array]",Me="[object Boolean]",Ye="[object Date]",ot="[object Error]",wt="[object Function]",Mt="[object Map]",pt="[object Number]",ai="[object Object]",dr="[object Promise]",ci="[object RegExp]",Lr="[object Set]",je="[object String]",zt="[object Symbol]",vi="[object WeakMap]",Sr="[object ArrayBuffer]",_r="[object DataView]",ma=/^\[object .+?Constructor\]$/,po=/^(?:0|[1-9]\d*)$/,qi={};qi["[object Float32Array]"]=qi["[object Float64Array]"]=qi["[object Int8Array]"]=qi["[object Int16Array]"]=qi["[object Int32Array]"]=qi["[object Uint8Array]"]=qi["[object Uint8ClampedArray]"]=qi["[object Uint16Array]"]=qi["[object Uint32Array]"]=!0,qi[me]=qi[ye]=qi[Sr]=qi[Me]=qi[_r]=qi[Ye]=qi[ot]=qi[wt]=qi[Mt]=qi[pt]=qi[ai]=qi[ci]=qi[Lr]=qi[je]=qi[vi]=!1;var Ba=typeof Zc=="object"&&Zc&&Zc.Object===Object&&Zc,_u=typeof self=="object"&&self&&self.Object===Object&&self,Fs=Ba||_u||Function("return this")(),Cl=A&&!A.nodeType&&A,mc=Cl&&b&&!b.nodeType&&b,ea=mc&&mc.exports===Cl,Na=ea&&Ba.process,dn=function(){try{return Na&&Na.binding&&Na.binding("util")}catch{}}(),Jr=dn&&dn.isTypedArray;function zi(Se,De){for(var mt=-1,qt=Se==null?0:Se.length;++mt<qt;)if(De(Se[mt],mt,Se))return!0;return!1}function Fo(Se){var De=-1,mt=Array(Se.size);return Se.forEach(function(qt,Ji){mt[++De]=[Ji,qt]}),mt}function Bo(Se){var De=-1,mt=Array(Se.size);return Se.forEach(function(qt){mt[++De]=qt}),mt}var No,$o,mo,Al=Array.prototype,Pl=Function.prototype,ga=Object.prototype,Uo=Fs["__core-js_shared__"],kl=Pl.toString,bn=ga.hasOwnProperty,gc=(No=/[^.]+$/.exec(Uo&&Uo.keys&&Uo.keys.IE_PROTO||""))?"Symbol(src)_1."+No:"",yc=ga.toString,vu=RegExp("^"+kl.call(bn).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),_c=ea?Fs.Buffer:void 0,Vo=Fs.Symbol,vc=Fs.Uint8Array,jo=ga.propertyIsEnumerable,qo=Al.splice,Bs=Vo?Vo.toStringTag:void 0,Go=Object.getOwnPropertySymbols,$a=_c?_c.isBuffer:void 0,xc=($o=Object.keys,mo=Object,function(Se){return $o(mo(Se))}),Ho=xa(Fs,"DataView"),ya=xa(Fs,"Map"),Ns=xa(Fs,"Promise"),Zo=xa(Fs,"Set"),ta=xa(Fs,"WeakMap"),ys=xa(Object,"create"),bc=ra(Ho),Dl=ra(ya),ki=ra(Ns),Wo=ra(Zo),xu=ra(ta),Ll=Vo?Vo.prototype:void 0,_a=Ll?Ll.valueOf:void 0;function Yi(Se){var De=-1,mt=Se==null?0:Se.length;for(this.clear();++De<mt;){var qt=Se[De];this.set(qt[0],qt[1])}}function $s(Se){var De=-1,mt=Se==null?0:Se.length;for(this.clear();++De<mt;){var qt=Se[De];this.set(qt[0],qt[1])}}function di(Se){var De=-1,mt=Se==null?0:Se.length;for(this.clear();++De<mt;){var qt=Se[De];this.set(qt[0],qt[1])}}function Ua(Se){var De=-1,mt=Se==null?0:Se.length;for(this.__data__=new di;++De<mt;)this.add(Se[De])}function Fi(Se){var De=this.__data__=new $s(Se);this.size=De.size}function Wi(Se,De){var mt=Va(Se),qt=!mt&&Qo(Se),Ji=!mt&&!qt&&Bl(Se),Ei=!mt&&!qt&&!Ji&&el(Se),pr=mt||qt||Ji||Ei,Er=pr?function(Br,ns){for(var vs=-1,fn=Array(Br);++vs<Br;)fn[vs]=ns(vs);return fn}(Se.length,String):[],wn=Er.length;for(var ar in Se)!De&&!bn.call(Se,ar)||pr&&(ar=="length"||Ji&&(ar=="offset"||ar=="parent")||Ei&&(ar=="buffer"||ar=="byteLength"||ar=="byteOffset")||Ol(ar,wn))||Er.push(ar);return Er}function _s(Se,De){for(var mt=Se.length;mt--;)if(Fl(Se[mt][0],De))return mt;return-1}function ia(Se){return Se==null?Se===void 0?"[object Undefined]":"[object Null]":Bs&&Bs in Object(Se)?function(De){var mt=bn.call(De,Bs),qt=De[Bs];try{De[Bs]=void 0;var Ji=!0}catch{}var Ei=yc.call(De);return Ji&&(mt?De[Bs]=qt:delete De[Bs]),Ei}(Se):function(De){return yc.call(De)}(Se)}function Xo(Se){return jr(Se)&&ia(Se)==me}function Rl(Se,De,mt,qt,Ji){return Se===De||(Se==null||De==null||!jr(Se)&&!jr(De)?Se!=Se&&De!=De:function(Ei,pr,Er,wn,ar,Br){var ns=Va(Ei),vs=Va(pr),fn=ns?ye:rs(Ei),Rn=vs?ye:rs(pr),xs=(fn=fn==me?ai:fn)==ai,Qr=(Rn=Rn==me?ai:Rn)==ai,Mn=fn==Rn;if(Mn&&Bl(Ei)){if(!Bl(pr))return!1;ns=!0,xs=!1}if(Mn&&!xs)return Br||(Br=new Fi),ns||el(Ei)?go(Ei,pr,Er,wn,ar,Br):function(Ii,Li,il,ws,$l,en,zn){switch(il){case _r:if(Ii.byteLength!=Li.byteLength||Ii.byteOffset!=Li.byteOffset)return!1;Ii=Ii.buffer,Li=Li.buffer;case Sr:return!(Ii.byteLength!=Li.byteLength||!en(new vc(Ii),new vc(Li)));case Me:case Ye:case pt:return Fl(+Ii,+Li);case ot:return Ii.name==Li.name&&Ii.message==Li.message;case ci:case je:return Ii==Li+"";case Mt:var tn=Fo;case Lr:var Tt=1&ws;if(tn||(tn=Bo),Ii.size!=Li.size&&!Tt)return!1;var wa=zn.get(Ii);if(wa)return wa==Li;ws|=2,zn.set(Ii,Li);var ss=go(tn(Ii),tn(Li),ws,$l,en,zn);return zn.delete(Ii),ss;case zt:if(_a)return _a.call(Ii)==_a.call(Li)}return!1}(Ei,pr,fn,Er,wn,ar,Br);if(!(1&Er)){var ba=xs&&bn.call(Ei,"__wrapped__"),Hn=Qr&&bn.call(pr,"__wrapped__");if(ba||Hn){var bs=ba?Ei.value():Ei,ja=Hn?pr.value():pr;return Br||(Br=new Fi),ar(bs,ja,Er,wn,Br)}}return Mn?(Br||(Br=new Fi),function(Ii,Li,il,ws,$l,en){var zn=1&il,tn=zl(Ii),Tt=tn.length,wa=zl(Li).length;if(Tt!=wa&&!zn)return!1;for(var ss=Tt;ss--;){var Zn=tn[ss];if(!(zn?Zn in Li:bn.call(Li,Zn)))return!1}var Ul=en.get(Ii);if(Ul&&en.get(Li))return Ul==Li;var vt=!0;en.set(Ii,Li),en.set(Li,Ii);for(var na=zn;++ss<Tt;){var yo=Ii[Zn=tn[ss]],_o=Li[Zn];if(ws)var vo=zn?ws(_o,yo,Zn,Li,Ii,en):ws(yo,_o,Zn,Ii,Li,en);if(!(vo===void 0?yo===_o||$l(yo,_o,il,ws,en):vo)){vt=!1;break}na||(na=Zn=="constructor")}if(vt&&!na){var qa=Ii.constructor,Ma=Li.constructor;qa==Ma||!("constructor"in Ii)||!("constructor"in Li)||typeof qa=="function"&&qa instanceof qa&&typeof Ma=="function"&&Ma instanceof Ma||(vt=!1)}return en.delete(Ii),en.delete(Li),vt}(Ei,pr,Er,wn,ar,Br)):!1}(Se,De,mt,qt,Rl,Ji))}function Ko(Se){return!(!Us(Se)||function(De){return!!gc&&gc in De}(Se))&&(Nl(Se)?vu:ma).test(ra(Se))}function Yo(Se){if(mt=(De=Se)&&De.constructor,qt=typeof mt=="function"&&mt.prototype||ga,De!==qt)return xc(Se);var De,mt,qt,Ji=[];for(var Ei in Object(Se))bn.call(Se,Ei)&&Ei!="constructor"&&Ji.push(Ei);return Ji}function go(Se,De,mt,qt,Ji,Ei){var pr=1&mt,Er=Se.length,wn=De.length;if(Er!=wn&&!(pr&&wn>Er))return!1;var ar=Ei.get(Se);if(ar&&Ei.get(De))return ar==De;var Br=-1,ns=!0,vs=2&mt?new Ua:void 0;for(Ei.set(Se,De),Ei.set(De,Se);++Br<Er;){var fn=Se[Br],Rn=De[Br];if(qt)var xs=pr?qt(Rn,fn,Br,De,Se,Ei):qt(fn,Rn,Br,Se,De,Ei);if(xs!==void 0){if(xs)continue;ns=!1;break}if(vs){if(!zi(De,function(Qr,Mn){if(ba=Mn,!vs.has(ba)&&(fn===Qr||Ji(fn,Qr,mt,qt,Ei)))return vs.push(Mn);var ba})){ns=!1;break}}else if(fn!==Rn&&!Ji(fn,Rn,mt,qt,Ei)){ns=!1;break}}return Ei.delete(Se),Ei.delete(De),ns}function zl(Se){return function(De,mt,qt){var Ji=mt(De);return Va(De)?Ji:function(Ei,pr){for(var Er=-1,wn=pr.length,ar=Ei.length;++Er<wn;)Ei[ar+Er]=pr[Er];return Ei}(Ji,qt(De))}(Se,tl,Jo)}function va(Se,De){var mt,qt,Ji=Se.__data__;return((qt=typeof(mt=De))=="string"||qt=="number"||qt=="symbol"||qt=="boolean"?mt!=="__proto__":mt===null)?Ji[typeof De=="string"?"string":"hash"]:Ji.map}function xa(Se,De){var mt=function(qt,Ji){return qt==null?void 0:qt[Ji]}(Se,De);return Ko(mt)?mt:void 0}Yi.prototype.clear=function(){this.__data__=ys?ys(null):{},this.size=0},Yi.prototype.delete=function(Se){var De=this.has(Se)&&delete this.__data__[Se];return this.size-=De?1:0,De},Yi.prototype.get=function(Se){var De=this.__data__;if(ys){var mt=De[Se];return mt===V?void 0:mt}return bn.call(De,Se)?De[Se]:void 0},Yi.prototype.has=function(Se){var De=this.__data__;return ys?De[Se]!==void 0:bn.call(De,Se)},Yi.prototype.set=function(Se,De){var mt=this.__data__;return this.size+=this.has(Se)?0:1,mt[Se]=ys&&De===void 0?V:De,this},$s.prototype.clear=function(){this.__data__=[],this.size=0},$s.prototype.delete=function(Se){var De=this.__data__,mt=_s(De,Se);return!(mt<0)&&(mt==De.length-1?De.pop():qo.call(De,mt,1),--this.size,!0)},$s.prototype.get=function(Se){var De=this.__data__,mt=_s(De,Se);return mt<0?void 0:De[mt][1]},$s.prototype.has=function(Se){return _s(this.__data__,Se)>-1},$s.prototype.set=function(Se,De){var mt=this.__data__,qt=_s(mt,Se);return qt<0?(++this.size,mt.push([Se,De])):mt[qt][1]=De,this},di.prototype.clear=function(){this.size=0,this.__data__={hash:new Yi,map:new(ya||$s),string:new Yi}},di.prototype.delete=function(Se){var De=va(this,Se).delete(Se);return this.size-=De?1:0,De},di.prototype.get=function(Se){return va(this,Se).get(Se)},di.prototype.has=function(Se){return va(this,Se).has(Se)},di.prototype.set=function(Se,De){var mt=va(this,Se),qt=mt.size;return mt.set(Se,De),this.size+=mt.size==qt?0:1,this},Ua.prototype.add=Ua.prototype.push=function(Se){return this.__data__.set(Se,V),this},Ua.prototype.has=function(Se){return this.__data__.has(Se)},Fi.prototype.clear=function(){this.__data__=new $s,this.size=0},Fi.prototype.delete=function(Se){var De=this.__data__,mt=De.delete(Se);return this.size=De.size,mt},Fi.prototype.get=function(Se){return this.__data__.get(Se)},Fi.prototype.has=function(Se){return this.__data__.has(Se)},Fi.prototype.set=function(Se,De){var mt=this.__data__;if(mt instanceof $s){var qt=mt.__data__;if(!ya||qt.length<199)return qt.push([Se,De]),this.size=++mt.size,this;mt=this.__data__=new di(qt)}return mt.set(Se,De),this.size=mt.size,this};var Jo=Go?function(Se){return Se==null?[]:(Se=Object(Se),function(De,mt){for(var qt=-1,Ji=De==null?0:De.length,Ei=0,pr=[];++qt<Ji;){var Er=De[qt];mt(Er,qt,De)&&(pr[Ei++]=Er)}return pr}(Go(Se),function(De){return jo.call(Se,De)}))}:function(){return[]},rs=ia;function Ol(Se,De){return!!(De=De??ae)&&(typeof Se=="number"||po.test(Se))&&Se>-1&&Se%1==0&&Se<De}function ra(Se){if(Se!=null){try{return kl.call(Se)}catch{}try{return Se+""}catch{}}return""}function Fl(Se,De){return Se===De||Se!=Se&&De!=De}(Ho&&rs(new Ho(new ArrayBuffer(1)))!=_r||ya&&rs(new ya)!=Mt||Ns&&rs(Ns.resolve())!=dr||Zo&&rs(new Zo)!=Lr||ta&&rs(new ta)!=vi)&&(rs=function(Se){var De=ia(Se),mt=De==ai?Se.constructor:void 0,qt=mt?ra(mt):"";if(qt)switch(qt){case bc:return _r;case Dl:return Mt;case ki:return dr;case Wo:return Lr;case xu:return vi}return De});var Qo=Xo(function(){return arguments}())?Xo:function(Se){return jr(Se)&&bn.call(Se,"callee")&&!jo.call(Se,"callee")},Va=Array.isArray,Bl=$a||function(){return!1};function Nl(Se){if(!Us(Se))return!1;var De=ia(Se);return De==wt||De=="[object GeneratorFunction]"||De=="[object AsyncFunction]"||De=="[object Proxy]"}function fr(Se){return typeof Se=="number"&&Se>-1&&Se%1==0&&Se<=ae}function Us(Se){var De=typeof Se;return Se!=null&&(De=="object"||De=="function")}function jr(Se){return Se!=null&&typeof Se=="object"}var el=Jr?function(Se){return function(De){return Se(De)}}(Jr):function(Se){return jr(Se)&&fr(Se.length)&&!!qi[ia(Se)]};function tl(Se){return(De=Se)!=null&&fr(De.length)&&!Nl(De)?Wi(Se):Yo(Se);var De}b.exports=function(Se,De){return Rl(Se,De)}})(xn,xn.exports);var ho=u(xn.exports);function is(b,A){return b.length===A.length&&JSON.stringify(b.map(function(V){return V}).sort())===JSON.stringify(A.map(function(V){return V}).sort())}var fo={Polygon:wi,LineString:ji,Point:ir,MultiPolygon:ht,MultiLineString:ht,MultiPoint:ht},Ui=Object.freeze({__proto__:null,CommonSelectors:st,constrainFeatureMovement:Ni,createMidPoint:Js,createSupplementaryPoints:Mr,createVertex:ei,doubleClickZoom:ee,euclideanDistance:Qt,featuresAt:Yt,getFeatureAtAndSetCursors:si,isClick:gi,isEventAtCoordinates:vn,isTap:ur,mapEventToBoundingBox:Pt,ModeHandler:a,moveFeatures:lo,sortFeatures:Rt,stringSetsAreEqual:is,StringSet:oi,theme:At,toDenseArray:ce}),Oo=function(b,A){var V={options:b=function(me){me===void 0&&(me={});var ye=Be(me);return me.controls||(ye.controls={}),me.displayControlsDefault===!1?ye.controls=Be(hr,me.controls):ye.controls=Be(Qs,me.controls),(ye=Be(co,ye)).styles=uo(ye.styles,"cold").concat(uo(ye.styles,"hot")),ye}(b)};A=function(me,ye){return ye.modes=ge,ye.getFeatureIdsAt=function(Me){return Yt.click({point:Me},null,me).map(function(Ye){return Ye.properties.id})},ye.getSelectedIds=function(){return me.store.getSelectedIds()},ye.getSelected=function(){return{type:Y.FEATURE_COLLECTION,features:me.store.getSelectedIds().map(function(Me){return me.store.get(Me)}).map(function(Me){return Me.toGeoJSON()})}},ye.getSelectedPoints=function(){return{type:Y.FEATURE_COLLECTION,features:me.store.getSelectedCoordinates().map(function(Me){return{type:Y.FEATURE,properties:{},geometry:{type:Y.POINT,coordinates:Me.coordinates}}})}},ye.set=function(Me){if(Me.type===void 0||Me.type!==Y.FEATURE_COLLECTION||!Array.isArray(Me.features))throw new Error("Invalid FeatureCollection");var Ye=me.store.createRenderBatch(),ot=me.store.getAllIds().slice(),wt=ye.add(Me),Mt=new oi(wt);return(ot=ot.filter(function(pt){return!Mt.has(pt)})).length&&ye.delete(ot),Ye(),wt},ye.add=function(Me){var Ye=JSON.parse(JSON.stringify(J(Me))).features.map(function(ot){if(ot.id=ot.id||rt(),ot.geometry===null)throw new Error("Invalid geometry: null");if(me.store.get(ot.id)===void 0||me.store.get(ot.id).type!==ot.geometry.type){var wt=fo[ot.geometry.type];if(wt===void 0)throw new Error("Invalid geometry type: "+ot.geometry.type+".");var Mt=new wt(me,ot);me.store.add(Mt)}else{var pt=me.store.get(ot.id);pt.properties=ot.properties,ho(pt.properties,ot.properties)||me.store.featureChanged(pt.id),ho(pt.getCoordinates(),ot.geometry.coordinates)||pt.incomingCoords(ot.geometry.coordinates)}return ot.id});return me.store.render(),Ye},ye.get=function(Me){var Ye=me.store.get(Me);if(Ye)return Ye.toGeoJSON()},ye.getAll=function(){return{type:Y.FEATURE_COLLECTION,features:me.store.getAll().map(function(Me){return Me.toGeoJSON()})}},ye.delete=function(Me){return me.store.delete(Me,{silent:!0}),ye.getMode()!==ge.DIRECT_SELECT||me.store.getSelectedIds().length?me.store.render():me.events.changeMode(ge.SIMPLE_SELECT,void 0,{silent:!0}),ye},ye.deleteAll=function(){return me.store.delete(me.store.getAllIds(),{silent:!0}),ye.getMode()===ge.DIRECT_SELECT?me.events.changeMode(ge.SIMPLE_SELECT,void 0,{silent:!0}):me.store.render(),ye},ye.changeMode=function(Me,Ye){return Ye===void 0&&(Ye={}),Me===ge.SIMPLE_SELECT&&ye.getMode()===ge.SIMPLE_SELECT?(is(Ye.featureIds||[],me.store.getSelectedIds())||(me.store.setSelected(Ye.featureIds,{silent:!0}),me.store.render()),ye):(Me===ge.DIRECT_SELECT&&ye.getMode()===ge.DIRECT_SELECT&&Ye.featureId===me.store.getSelectedIds()[0]||me.events.changeMode(Me,Ye,{silent:!0}),ye)},ye.getMode=function(){return me.events.getMode()},ye.trash=function(){return me.events.trash({silent:!0}),ye},ye.combineFeatures=function(){return me.events.combineFeatures({silent:!0}),ye},ye.uncombineFeatures=function(){return me.events.uncombineFeatures({silent:!0}),ye},ye.setFeatureProperty=function(Me,Ye,ot){return me.store.setFeatureProperty(Me,Ye,ot),ye},ye}(V,A),V.api=A;var ae=it(V);return A.onAdd=ae.onAdd,A.onRemove=ae.onRemove,A.types=K,A.options=b,A};function Os(b){Oo(b,this)}return Os.modes=Dr,Os.constants=bt,Os.lib=Ui,Os})})(Qx);var YL=Qx.exports;const Od=Ym(YL),JL=e=>(Fh("data-v-acefdfcb"),e=e(),Bh(),e),QL=JL(()=>ne("input",null,null,-1)),eR={__name:"AddressSearchControl",setup(e){const r=Uh(),a=Ps("");return(u,d)=>(Dt(),Ht($r,null,[nv(ne("input",{class:"input address-input",type:"text",placeholder:"Search an address","onUpdate:modelValue":d[0]||(d[0]=y=>a.value=y),onKeydown:d[1]||(d[1]=uM(y=>er(r).replace({name:"search",query:{address:a.value}}),["enter"]))},null,544),[[lM,a.value]]),QL,ne("button",{class:"button",onClick:d[2]||(d[2]=y=>er(r).replace({name:"search",query:{address:a.value}}))}," Search ")],64))}},tR=pa(eR,[["__scopeId","data-v-acefdfcb"]]);function iR(e,r,a,u){u===void 0&&(u={});var d=zh(e),y=Da(d[0]),m=Da(d[1]),l=Da(a),T=V3(r,u.units),P=Math.asin(Math.sin(m)*Math.cos(T)+Math.cos(m)*Math.sin(T)*Math.cos(l)),z=y+Math.atan2(Math.sin(l)*Math.sin(T)*Math.cos(m),Math.cos(T)-Math.sin(m)*Math.sin(P)),k=Mm(z),R=Mm(P);return Rh([k,R],u.properties)}function e1(e,r,a){if(a===void 0&&(a={}),a.final===!0)return rR(e,r);var u=zh(e),d=zh(r),y=Da(u[0]),m=Da(d[0]),l=Da(u[1]),T=Da(d[1]),P=Math.sin(m-y)*Math.cos(T),z=Math.cos(l)*Math.sin(T)-Math.sin(l)*Math.cos(T)*Math.cos(m-y);return Mm(Math.atan2(P,z))}function rR(e,r){var a=e1(r,e);return a=(a+180)%360,a}function y0(e,r){var a=fu(e,r),u=e1(e,r),d=iR(e,a/2,u);return d}var _0=6378137;function nR(e){return G3(e,function(r,a){return r+sR(a)},0)}function sR(e){var r=0,a;switch(e.type){case"Polygon":return v0(e.coordinates);case"MultiPolygon":for(a=0;a<e.coordinates.length;a++)r+=v0(e.coordinates[a]);return r;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function v0(e){var r=0;if(e&&e.length>0){r+=Math.abs(x0(e[0]));for(var a=1;a<e.length;a++)r-=Math.abs(x0(e[a]))}return r}function x0(e){var r,a,u,d,y,m,l,T=0,P=e.length;if(P>2){for(l=0;l<P;l++)l===P-2?(d=P-2,y=P-1,m=0):l===P-1?(d=P-1,y=0,m=1):(d=l,y=l+1,m=l+2),r=e[d],a=e[y],u=e[m],T+=(Xp(u[0])-Xp(r[0]))*Math.sin(Xp(a[1]));T=T*_0*_0/2}return T}function Xp(e){return e*Math.PI/180}const aR={name:"DistanceMeasureControl",props:{position:{type:String,default:"bottom-left"}},data(){return{mode:"simple_select",selected:null,toggledOn:!1,currentShape:null,currentArea:null,labelLayers:[]}},computed:{publicPath(){return"/vue3-atlas2/"},currentOrSelectedShape(){let e;return this.$data.selected?e=this.$data.selected:this.currentShape&&(e=this.currentShape),e},newArea(){let e=this.$data.labelLayers.filter(a=>a.id===this.currentOrSelectedShape);console.log("newArea is recalculating, shape:",e,"this.currentOrSelectedShape:",this.currentOrSelectedShape);let r;return e[0]&&(r=e[0].area),r},currentDistances(){console.log("currentDistances is recalculating");let e=this.$data.labelLayers.filter(a=>a.id===this.currentOrSelectedShape),r;return e[0]&&(r=e[0].distances),r},currentTotalLength(){let e=0;for(let r of this.currentDistances)e=e+r.distance;return e.toFixed(2)+" Ft"},shouldShowDistanceBox(){let e=this.$data.mode!=="simple_select",r=this.$data.selected!==null,a=this.$data.toggledOn,u;return e&&a||r&&a?u=!0:u=!1,u}},methods:{handleDeleteClick(e){const r=Xs();let a=this.labelLayers.indexOf(this.labelLayers.filter(u=>u.id===this.currentShape)[0]);this.labelLayers.splice(a,1),r.draw.delete(this.$data.selected),this.$data.selected=null},deleteDrawDistances(e){let r=this.currentShape.indexOf(this.currentShape.filter(a=>a.id===e)[0]);this.currentShape.splice(r,1),this.$data.selected=null},getDrawDistances(e){console.log("start of getDrawDistances, e:",e);let a=Xs().draw,u=a.getAll(),d,y,m;e&&e.point?(y=e.point,m=a.getFeatureIdsAt(y)[0],m||(m=u.features[u.features.length-1].id)):e&&e.features&&e.features.length&&(m=e.features[0].id),this.currentShape=m;let l,T;if(console.log("shapeId:",m,"draw.getSelectedIds():",a.getSelectedIds()),m?(l=u.features.filter(R=>R.id===m)[0],console.log("if shapeId:",m,"feature:",l,"feature,geometry.coordinates.length:",l.geometry.coordinates.length),l.geometry.type==="LineString"?(d=l.geometry.coordinates,console.log("its a linestring, coordinates.length:",d.length)):(console.log("its not a linestring"),d=l.geometry.coordinates[0])):(l=u.features[u.features.length-1],l&&l.geometry&&l.geometry.type==="LineString"?(console.log("its a linestring"),d=l.geometry.coordinates):l&&l.geometry&&(console.log("its not a linestring"),d=l.geometry.coordinates[0])),console.log("middle of getDrawDistances, draw:",a,"shapeId:",m,"e:",e,"mode is draw_polygon, data:",u,"coordinates:",d),e&&e.point&&(console.log("if e.point is running"),d.splice(d.length-2,1)),l&&l.geometry&&l.geometry.type==="LineString"&&(console.log("if feature.geometry.type === LineString is running"),d.splice(0,1)),d&&d.length>=4){const R=Gx([d]),Z=j3(nR(R),"meters","feet");console.log("calculating the area:",Z),T=Z.toFixed(2)+" Sq Feet"}let P,z=[],k=[];if(d)for(P=0;P<d.length;P++){let R=0,Z=null,K=[],Y=[],ge;if(d[P+1]?ge=d[P+1]:ge=d[0],R=parseFloat((fu(d[P],ge,{units:"miles"})*5280).toFixed(2)),d[P-1]&&(Z=parseFloat((fu(d[P-1],d[P],{units:"miles"})*5280).toFixed(2))),Y={firstPoint:[parseFloat(d[P][0].toFixed(5)),parseFloat(d[P][1].toFixed(5))],midPoint:K,distance:Z},z.push(Y),e.point&&d[P][0]!==ge[0]&&P<d.length-2&&(K=y0(d[P],ge).geometry.coordinates,k.push({type:"Feature",properties:{description:R},geometry:{type:"Point",coordinates:K}})),!e.point&&d[P][0]!==ge[0]&&P<d.length-1&&(K=y0(d[P],ge).geometry.coordinates,k.push({type:"Feature",properties:{description:R},geometry:{type:"Point",coordinates:K}})),e.point&&P===d.length-2)break}if(console.log("near end of getDrawDistances, currentArea:",T,"distancesArray.length:",z.length,"distancesArray:",z,"features:",k),z.length){let R={};if(m){console.log("if inside if is running, currentArea:",T,"distancesArray[distancesArray.length-1].distance:",z[z.length-1].distance,"distancesArray:",z),R={id:m,area:T,distances:z,source:{type:"geojson",data:{type:"FeatureCollection",features:[]}},layer:{id:m,type:"symbol",source:m,paint:{"text-color":"red"},layout:{"text-size":12,"text-font":["Open Sans Regular"],"text-field":["get","description"],"text-variable-anchor":["center"],"text-radial-offset":.5,"text-justify":"center"}}};let Z=this.labelLayers.filter(K=>K.id===m)[0];Z||(this.labelLayers.push(R),Z=this.labelLayers.filter(K=>K.id===m)[0]),Z.area=T,Z.distances=z,Z.source.data.features=k}}},handleDrawModeChange(e){console.log("handleDrawModeChange is running, e:",e,"e.mode:",e.mode),this.$data.mode=e.mode,e.mode==="draw_polygon"&&(this.$data.toggledOn=!0),this.currentShape},handleDrawCancel(e){console.log("handleDrawCancel is running, e:",e,"this.currentShape:",this.$data.currentShape);const r=Xs();let a=this.currentShape;if(console.log("handleDrawCancel is running, shapeId:",a),a){let u=this.$data.labelLayers.indexOf(this.$data.labelLayers.filter(d=>d.id===a)[0]);this.$data.labelLayers.splice(u,1),r.draw.delete(this.currentShape),this.$data.currentShape=null}r.draw.changeMode("simple_select"),this.$data.toggledOn=!1},handleDrawFinish(e){const r=Xs();let a=this.$data.currentShape,u=this.$data.labelLayers.filter(y=>y.id===this.currentShape)[0].distances;console.log("MapPanel.vue handleDrawFinish 1 is running, MapStore.draw.getMode():",r.draw.getMode(),"currentShape:",a,"fetchedPoints:",u);let d=[];for(let y of u)d.push(y.firstPoint);if(d.length>1&&d.push(u[0].firstPoint),u.length>2)r.draw.changeMode("simple_select"),this.$data.mode="simple_select";else if(u.length===2){r.draw.delete(this.currentShape),r.draw.changeMode("draw_line_string");let y={type:"Feature",geometry:{type:"LineString",coordinates:d},id:this.currentShape,properties:{}};r.draw.add(y),r.draw.changeMode("simple_select"),this.$data.mode="simple_select"}else if(u.length===1){r.draw.delete(this.currentShape),r.draw.changeMode("draw_point");let y={type:"Feature",geometry:{type:"Point",coordinates:d[0]},id:this.currentShape,properties:{}};r.draw.add(y),r.draw.changeMode("simple_select"),this.$data.mode="simple_select"}else r.draw.trash(),this.handleDrawCancel();console.log("MapPanel.vue handleDrawFinish 2 is running, MapStore.draw.getMode():",r.draw.getMode(),"currentShape:",a,"fetchedPoints:",u)},handleDrawSelectionChange(e){let u=Xs().draw.getSelectedIds();console.log("handleDrawSelectionChange, e:",e,"val:",u),e.features[0]?(console.log("there are features"),this.$data.selected=u[0]):(console.log("there are no features"),this.$data.selected=null)}}},oR={key:0,class:As("measure-tool-popup-bottom-right")},lR={key:0},cR=ne("div",{class:"measure-tool-header"}," Measure distances and areas ",-1),uR=ne("div",{class:"measure-tool-description"}," Start creating a measurement by adding points to the map. ",-1),hR=ne("hr",{class:"popup-line"},null,-1),dR=["src"],fR={key:1},pR=ne("tr",null,[ne("th",null,"lat"),ne("th",null,"lng"),ne("th",null,"distance (ft)")],-1),mR=ne("hr",{class:"popup-line"},null,-1),gR={key:0},yR=ne("hr",{class:"popup-line"},null,-1),_R={key:1},vR=ne("hr",{class:"popup-line"},null,-1),xR={key:2,class:"drawn-shape-actions"},bR=["src"],wR={key:3,class:"draw-actions"},MR=["src"],SR=["src"];function ER(e,r,a,u,d,y){return Dt(),Ht("div",null,[y.shouldShowDistanceBox?(Dt(),Ht("div",oR,[y.currentDistances?Ki("",!0):(Dt(),Ht("div",lR,[cR,uR,hR,ne("div",null,[ne("img",{src:y.publicPath+"images/cancel.png",class:"img-class",alt:"cancel",onClick:r[0]||(r[0]=(...m)=>y.handleDrawCancel&&y.handleDrawCancel(...m))},null,8,dR),ne("div",{class:"inline-block-div",onClick:r[1]||(r[1]=(...m)=>y.handleDrawCancel&&y.handleDrawCancel(...m))}," Cancel ")])])),y.currentDistances?(Dt(),Ht("div",fR,[ne("table",null,[pR,(Dt(!0),Ht($r,null,Pa(y.currentDistances,(m,l)=>(Dt(),Ht("tr",{key:l},[ne("td",null,ii(m.firstPoint[1]),1),ne("td",null,ii(m.firstPoint[0]),1),ne("td",null,ii(m.distance),1)]))),128))]),mR,y.currentDistances.length>=2?(Dt(),Ht("div",gR,[tf(" Total Length: "+ii(y.currentTotalLength)+" ",1),yR])):Ki("",!0),y.currentDistances.length>=3?(Dt(),Ht("div",_R,[tf(" Total Area: "+ii(y.newArea)+" ",1),vR])):Ki("",!0),e.mode==="simple_select"?(Dt(),Ht("div",xR,[ne("img",{src:y.publicPath+"images/trash.png",class:"img-class",alt:"trash",onClick:r[2]||(r[2]=(...m)=>y.handleDeleteClick&&y.handleDeleteClick(...m))},null,8,bR),ne("div",{class:"inline-block-div",onClick:r[3]||(r[3]=(...m)=>y.handleDeleteClick&&y.handleDeleteClick(...m))}," Delete ")])):Ki("",!0),e.mode!=="simple_select"?(Dt(),Ht("div",wR,[ne("img",{src:y.publicPath+"images/cancel.png",class:"img-class",alt:"cancel",onClick:r[4]||(r[4]=(...m)=>y.handleDrawCancel&&y.handleDrawCancel(...m))},null,8,MR),ne("div",{class:"inline-block-div",onClick:r[5]||(r[5]=(...m)=>y.handleDrawCancel&&y.handleDrawCancel(...m))}," Cancel "),ne("img",{src:y.publicPath+"images/check.png",class:"img-class",alt:"finish",onClick:r[6]||(r[6]=(...m)=>y.handleDrawFinish&&y.handleDrawFinish(...m))},null,8,SR),ne("div",{class:"inline-block-div",onClick:r[7]||(r[7]=(...m)=>y.handleDrawFinish&&y.handleDrawFinish(...m))}," Finish Measurement ")])):Ki("",!0)])):Ki("",!0)])):Ki("",!0)])}const TR=pa(aR,[["render",ER]]),IR={class:"imagery-toggle"},CR=["src"],AR={__name:"ImageryToggleControl",emits:["toggleImagery"],setup(e){const r=Xs(),a=Ai(()=>r.imageryOn?"/vue3-atlas2/images/basemap_small.png":"/vue3-atlas2/images/imagery_small.png");return(u,d)=>(Dt(),Ht("div",IR,[ne("button",{type:"button",onClick:d[0]||(d[0]=y=>u.$emit("toggleImagery"))},[ne("img",{class:"img-src",src:a.value},null,8,CR)])]))}},PR=pa(AR,[["__scopeId","data-v-0a98ea4d"]]),kR={class:"dropdown-trigger"},DR={class:"button","aria-haspopup":"true","aria-controls":"dropdown-menu"},LR=ne("span",{class:"icon is-small"},[ne("i",{class:"fas fa-angle-down","aria-hidden":"true"})],-1),RR={class:"dropdown-menu",id:"dropdown-menu",role:"menu"},zR={class:"dropdown-content"},OR={__name:"ImageryDropdownControl",emits:["setImagery"],setup(e,{emit:r}){Xs();const a=r,u=Ps("2023"),d=Ps(!1),y=()=>d.value=!d.value,m=l=>{u.value=l,a("setImagery",l),d.value=!1};return(l,T)=>(Dt(),Ht("div",{class:As([d.value?"is-active":"","imagery-dropdown dropdown"]),onClick:y},[ne("div",kR,[ne("button",DR,[ne("span",null,ii(u.value),1),LR])]),ne("div",RR,[ne("div",zR,[ne("a",{class:"dropdown-item",onClick:T[0]||(T[0]=P=>m("2023"))},"2023"),ne("a",{class:"dropdown-item",onClick:T[1]||(T[1]=P=>m("2022"))},"2022"),ne("a",{class:"dropdown-item",onClick:T[2]||(T[2]=P=>m("2020"))},"2020"),ne("a",{class:"dropdown-item",onClick:T[3]||(T[3]=P=>m("2019"))},"2019"),ne("a",{class:"dropdown-item",onClick:T[4]||(T[4]=P=>m("2018"))},"2018"),ne("a",{class:"dropdown-item",onClick:T[5]||(T[5]=P=>m("2017"))},"2017"),ne("a",{class:"dropdown-item",onClick:T[6]||(T[6]=P=>m("2016"))},"2016"),ne("a",{class:"dropdown-item",onClick:T[7]||(T[7]=P=>m("2015"))},"2015"),ne("a",{class:"dropdown-item",onClick:T[8]||(T[8]=P=>m("2012"))},"2012"),ne("a",{class:"dropdown-item",onClick:T[9]||(T[9]=P=>m("2010"))},"2010"),ne("a",{class:"dropdown-item",onClick:T[10]||(T[10]=P=>m("2008"))},"2008"),ne("a",{class:"dropdown-item",onClick:T[11]||(T[11]=P=>m("2004"))},"2004"),ne("a",{class:"dropdown-item",onClick:T[12]||(T[12]=P=>m("1996"))},"1996"),ne("a",{class:"dropdown-item",onClick:T[13]||(T[13]=P=>m("1962"))},"1962"),ne("a",{class:"dropdown-item",onClick:T[14]||(T[14]=P=>m("1942"))},"1942"),ne("a",{class:"dropdown-item",onClick:T[15]||(T[15]=P=>m("1910"))},"1910"),ne("a",{class:"dropdown-item",onClick:T[16]||(T[16]=P=>m("1895"))},"1895"),ne("a",{class:"dropdown-item",onClick:T[17]||(T[17]=P=>m("1875"))},"1875"),ne("a",{class:"dropdown-item",onClick:T[18]||(T[18]=P=>m("1860"))},"1860")])])],2))}},FR={class:"cyclomedia-toggle"},BR=["src"],NR={__name:"CyclomediaControl",emits:["toggleCyclomedia"],setup(e){const r=Ai(()=>"/vue3-atlas2/images/cyclomedia.png");return(a,u)=>(Dt(),Ht("div",FR,[ne("button",{type:"button",onClick:u[0]||(u[0]=d=>a.$emit("toggleCyclomedia"))},[ne("img",{class:"img-src",src:r.value},null,8,BR)])]))}},$R=pa(NR,[["__scopeId","data-v-4c09b360"]]),UR={class:"pictometry-toggle"},VR=["src"],jR={__name:"PictometryControl",emits:["togglePictometry"],setup(e){const r=Ai(()=>"/vue3-atlas2/images/pictometry.png");return(a,u)=>(Dt(),Ht("div",UR,[ne("button",{type:"button",onClick:u[0]||(u[0]=d=>a.$emit("togglePictometry"))},[ne("img",{class:"img-src",src:r.value},null,8,VR)])]))}},qR=pa(jR,[["__scopeId","data-v-321bbe13"]]),GR={id:"map",class:"map-class"},HR={__name:"Map",setup(e){console.log("Map.vue $config:",ps);const r=Xs(),a=Ys(),u=Ln(),d=Gh(),y=Vh(),m=Uh();let l;const T=Ai(()=>u.addressData.features?u.addressData.features[0].geometry.coordinates:[]),P=Ai(()=>a.selectedParcelId),z=Ai(()=>P.value&&d.dor.features?(console.log("selectedParcelId.value:",P.value,"ParcelsStore.dor.features.filter(parcel => parcel.id === selectedParcelId.value)[0]:",d.dor.features.filter(He=>He.id===P.value)[0]),d.dor.features.filter(He=>He.id===P.value)[0].geometry.coordinates[0]):[]);ks(()=>T.value,He=>{console.log("Map pwdCoordinates watch, newCoords:",He,"MapStore.addressMarker:",r.addressMarker);const lt={type:"Feature",geometry:{type:"Point",coordinates:He}};l.getSource("addressMarker").setData(lt)}),ks(()=>z.value,He=>{console.log("Map dorCoordinates watch, newCoords:",He);const lt={type:"Feature",geometry:{type:"Polygon",coordinates:[He]}};l.getSource("dorParcel").setData(lt)}),ks(()=>y.params.topic,async He=>{if(console.log("Map route.params.topic watch, newTopic:",He),He){l.setStyle(ps[ps.topicStyles[He]]);const lt=l.getSource("addressMarker"),Rt=l.getSource("dorParcel");lt&&Rt&&(lt.setData({type:"Feature",geometry:{type:"Point",coordinates:T.value}}),Rt.setData({type:"Feature",geometry:{type:"Polygon",coordinates:[z.value]}}))}}),ks(()=>u.addressData,async He=>{console.log("MapStore route.params.address watch, newAddress:",He);const lt=He.features[0].geometry.coordinates;a.lastSearchMethod==="address"&&(l.setCenter(lt),l.setZoom(17))});const k=Ai(()=>a.hoveredStateId);ks(()=>k.value,He=>{if(console.log("Map.vue hoveredStateId watch, newHoveredStateId:",He),He){const lt=l.getStyle().sources.nearby.data.features.filter(Pt=>Pt.properties.id===He)[0],Rt=l.getStyle().sources.nearby.data.features.indexOf(lt);console.log("index:",Rt,"map.getStyle().sources.nearby.data.features:",l.getStyle().sources.nearby.data.features.filter(Pt=>Pt.properties.id===He)[0]),l.getStyle().sources.nearby.data.features.splice(Rt,1),l.getStyle().sources.nearby.data.features.push(lt),l.getSource("nearby").setData(l.getStyle().sources.nearby.data),console.log("there is a new hoveredStateId, setting paint property"),l.setPaintProperty("nearby","circle-color",["match",["get","id"],He,"#FFFF00",["match",["get","type"],"nearby311","#FF0000","nearbyCrimeIncidents","#0096FF","#000000"]])}else l.setPaintProperty("nearby","circle-color",["match",["get","type"],"nearby311","#FF0000","nearbyCrimeIncidents","#0096FF","#000000"])});const R=Ps({mode:null,selection:null,currentShape:null,labelLayers:[],currentArea:null}),Z=Ps(null),K=Ai(()=>"/vue3-atlas2/images/marker_blue.png");Nh(async()=>{console.log("Map.vue onMounted route.params.topic:",y.params.topic,"route.params.address:",y.params.address);let He;y.params.topic?He=ps.topicStyles[y.params.topic]:He="pwdDrawnMapStyle";let lt;y.params.address?lt=17:lt=12,l=new Wp.Map({container:"map",style:ps[He],center:[-75.163471,39.953338],zoom:lt,minZoom:6,maxZoom:22,attributionControl:!1}),l.addControl(new Wp.NavigationControl,"bottom-left"),l.addControl(new Wp.GeolocateControl,"bottom-left");const Pt=await l.loadImage("https://docs.mapbox.com/mapbox-gl-js/assets/custom_marker.png");l.addImage("custom-marker",Pt.data);const oi=await l.loadImage(K.value);l.addImage("marker-blue",oi.data),l.on("click",(Yt,cr)=>{console.log("e:",Yt,"data:",cr,"drawInfo.mode:",R.mode,pi.getMode());let si=R.mode,Qt=r.map.queryRenderedFeatures(Yt.point).filter(gi=>["mapbox-gl-draw-cold","mapbox-gl-draw-hot"].includes(gi.source));console.log("Map.vue handleMapClick, e:",Yt,"drawLayers:",Qt,"drawMode:",si,"e:",Yt,"MapStore.map.getStyle():",r.map.getStyle(),"MapStore.drawStart:",r.drawStart),!Qt.length&&pi.getMode()!=="draw_polygon"&&m.push({name:"search",query:{lng:Yt.lngLat.lng,lat:Yt.lngLat.lat}}),pi.getMode()==="draw_polygon"&&Z.value.getDrawDistances(Yt)}),l.on("mouseenter","nearby",Yt=>{Yt.features.length>0&&(console.log("map.getSource(nearby):",l.getSource("nearby"),"map.getStyle().sources:",l.getStyle().sources),a.hoveredStateId=Yt.features[0].properties.id)}),l.on("mouseleave","nearby",()=>{k&&(a.hoveredStateId=null)}),Od.constants.classes.CONTROL_BASE="maplibregl-ctrl",Od.constants.classes.CONTROL_PREFIX="maplibregl-ctrl-",Od.constants.classes.CONTROL_GROUP="maplibregl-ctrl-group";const pi=new Od({displayControlsDefault:!1,controls:{polygon:!0}});r.draw=pi,l.addControl(pi,"bottom-right"),l.on("draw.create",Y),l.on("draw.selectionchange",ge),l.on("draw.finish",Te),l.on("draw.modechange",Fe),r.setMap(l)});const Y=He=>{console.log("drawCreate is running, e",He),Z.value.getDrawDistances(He)},ge=He=>{console.log("drawSelectionChange is running, e:",He),Z.value.handleDrawSelectionChange(He)},Te=()=>{console.log("drawFinish is running"),R.mode="simple_select"},Fe=He=>{console.log("drawModeChange is running, e",He),R.mode=He.mode,Z.value.handleDrawModeChange(He)},he=Ai(()=>r.imagerySelected),Le=()=>{console.log("toggleImagery, map.getStyle:",l.getStyle()),l.getStyle(),r.imageryOn?(console.log("map.getStyle().layers:",l.getStyle().layers),r.imageryOn=!1,l.removeLayer(he.value),l.removeLayer("imageryLabels")):(r.imageryOn=!0,l.addLayer(ps.mapLayers[he.value],"addressMarker"),l.addLayer(ps.mapLayers.imageryLabels,"addressMarker"))},We=async He=>{const lt=he.value;console.log("setImagery, newImagery:",He,"oldLayer:",lt,"imagerySelected.value:",he.value),r.imagerySelected=He,await l.addLayer(ps.mapLayers[he.value],"addressMarker"),l.removeLayer(lt)},Qe=()=>{console.log("toggleCyclomedia"),r.cyclomediaOn=!r.cyclomediaOn},bt=()=>{console.log("togglePictometry"),r.pictometryOn=!r.pictometryOn};return(He,lt)=>(Dt(),Ht("div",GR,[tr(tR),tr(PR,{onToggleImagery:Le}),er(r).imageryOn?(Dt(),Qa(OR,{key:0,onSetImagery:We})):Ki("",!0),tr($R,{onToggleCyclomedia:Qe}),tr(qR,{onTogglePictometry:bt}),tr(TR,{ref_key:"distanceMeasureControlRef",ref:Z},null,512)]))}},ZR=pa(HR,[["__scopeId","data-v-068a3084"]]),WR={__name:"MapPanel",setup(e){const r=Xs(),a=Ai(()=>r.cyclomediaOn||r.pictometryOn?"map-panel cyclomedia-pictometry":"map-panel");return(u,d)=>(Dt(),Ht("div",{id:"map-panel",class:As(a.value)},[tr(ZR)],2))}},XR=pa(WR,[["__scopeId","data-v-82cdbafd"]]),KR=ne("div",{class:"container"},[ne("h1",{class:"title is-1"},"Vue3 Atlas")],-1),YR={class:"small-container"},JR={class:"columns"},QR={class:"column is-6 pr-0 pb-0"},ez={class:"column is-6 p-0 p-0"},nc={__name:"App",setup(e){console.log("import.meta.env.VITE_PUBLICPATH:","/vue3-atlas2/");const r=Ys(),a=Vh(),u=Uh();return Ps(""),Nh(async()=>{await u.isReady(),console.log("App onMounted, route.params.topic:",a.params.topic,"route.params.address:",a.params.address),a.name==="not-found"&&u.push({name:"home"}),a.params.topic&&(r.currentTopic=a.params.topic)}),(d,y)=>(Dt(),Ht("main",null,[KR,ne("div",YR,[ne("div",JR,[ne("div",QR,[tr(XL)]),ne("div",ez,[tr(XR)])])])]))}},tz="modulepreload",iz=function(e){return"/vue3-atlas2/"+e},b0={},rz=function(r,a,u){let d=Promise.resolve();if(a&&a.length>0){const y=document.getElementsByTagName("link"),m=document.querySelector("meta[property=csp-nonce]"),l=(m==null?void 0:m.nonce)||(m==null?void 0:m.getAttribute("nonce"));d=Promise.all(a.map(T=>{if(T=iz(T),T in b0)return;b0[T]=!0;const P=T.endsWith(".css"),z=P?'[rel="stylesheet"]':"";if(!!u)for(let Z=y.length-1;Z>=0;Z--){const K=y[Z];if(K.href===T&&(!P||K.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${T}"]${z}`))return;const R=document.createElement("link");if(R.rel=P?"stylesheet":tz,P||(R.as="script",R.crossOrigin=""),R.href=T,l&&R.setAttribute("nonce",l),document.head.appendChild(R),P)return new Promise((Z,K)=>{R.addEventListener("load",Z),R.addEventListener("error",()=>K(new Error(`Unable to preload CSS for ${T}`)))})}))}return d.then(()=>r()).catch(y=>{const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=y,window.dispatchEvent(m),!m.defaultPrevented)throw y})},{routeApp:nz}=lx(),t1=async e=>{console.log("getAddressAndPutInStore is running, address:",e);const r=Ys();r.clearDataSourcesLoadedArray();const a=Ln();if(await a.fillAddressData(e),!a.addressData.features){yu.push({name:"not-found"});return}const u=a.addressData.features[0].properties.street_address;r.setCurrentAddress(u)},sz=async(e,r)=>{let a;const u=Ys();u.selectedParcelId=null;let d=u.currentTopic;const y=ps.parcelLayerForTopic[d],m=Gh();if(await m.fillParcelDataByLngLat(e,r,y),!m[y].features[0]){yu.push({name:"not-found"});return}const l=y==="pwd"?"ADDRESS":"ADDR_SOURCE";a=m[y].features[0].properties[l],console.log("getParcelAndPutInStore, currentAddress:",a,"parcelLayer:",y,"addressField",l,"ParcelsStore[parcelLayer].features[0].properties:",m[y].features[0].properties,"ParcelsStore[parcelLayer].features[0].properties[addressField]:",m[y].features[0].properties[l]),u.setCurrentAddress(a)},az=async(e,r)=>{const a=Ys(),u=Ln(),d=a.dataSourcesLoadedArray;if(e.name==="not-found")return;let y,m;if(e.params.address?y=e.params.address:e.query.address&&(y=e.query.address),e.params.topic&&(m=e.params.topic),y!==u.addressData.normalized)await t1(y);else if(d.includes(m))return;const l=Gh();await l.fillPwdParcelData(),await l.fillDorParcelData();const T=zf();if(await T.fillCondoData(y),e.params.topic=="Condominiums"&&!T.condosData.length){a.currentTopic="Property",yu.push({name:"address-and-topic",params:{address:e.params.address,topic:"Property"}});return}await oz(e.params.topic),a.addToDataSourcesLoadedArray(e.params.topic)},oz=async e=>{if(console.log("topicDataFetch is running, topic:",e),e==="Property"&&await _x().fillOpaData(),e==="Licenses & Inspections"){const r=jx();await r.fillLiInspections(),await r.fillLiPermits()}if(e==="Deeds"&&await vx().fillDorDocuments(),e==="Nearby Activity"){const a=Ys().currentNearbyDataType;await Kx().fetchData(a);const y=Ln().addressData.features[0].geometry.coordinates;await Xs().fillBufferForAddress(y[0],y[1])}},yu=SS({history:eS("/vue3-atlas2"),routes:[{path:"/:pathMatch(.*)*",name:"NotFound",component:()=>rz(()=>import("./NotFound-BmCgFMFJ.js"),[])},{path:"/",name:"home",component:nc,props:!0},{path:"/:address",name:"address",component:nc},{path:"/:address/:topic",name:"address-and-topic",component:nc},{path:"/:address/:topic/:data",name:"address-topic-and-data",component:nc},{path:"/not-found",name:"not-found",component:nc},{path:"/search",name:"search",component:nc,beforeEnter:async(e,r)=>{console.log("search route beforeEnter, to.query:",e.query,"from:",r);const{address:a,lat:u,lng:d}=e.query,y=Ys();a?(y.setLastSearchMethod("address"),await t1(a)):u&&d&&(y.setLastSearchMethod("mapClick"),await sz(d,u)),nz(yu)}}]});yu.afterEach(async(e,r)=>{console.log("router afterEach to:",e,"from:",r),e.name!=="not-found"&&e.name!=="search"&&await az(e)});const og=fM(nc);og.use(yM());og.use(yu);og.mount("#app");export{pa as _,ne as a,tf as b,Ht as c,tr as d,Dt as o,lz as r,Ao as w};
