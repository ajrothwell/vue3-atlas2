(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))u(d);new MutationObserver(d=>{for(const y of d)if(y.type==="childList")for(const m of y.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&u(m)}).observe(document,{childList:!0,subtree:!0});function a(d){const y={};return d.integrity&&(y.integrity=d.integrity),d.referrerPolicy&&(y.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?y.credentials="include":d.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function u(d){if(d.ep)return;d.ep=!0;const y=a(d);fetch(d.href,y)}})();/**
* @vue/shared v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Mm(e,r){const a=new Set(e.split(","));return r?u=>a.has(u.toLowerCase()):u=>a.has(u)}const zr={},Qc=[],oa=()=>{},qb=()=>!1,uf=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&(e.charCodeAt(2)>122||e.charCodeAt(2)<97),Sm=e=>e.startsWith("onUpdate:"),Vn=Object.assign,Em=(e,r)=>{const a=e.indexOf(r);a>-1&&e.splice(a,1)},Gb=Object.prototype.hasOwnProperty,qi=(e,r)=>Gb.call(e,r),pi=Array.isArray,eu=e=>hf(e)==="[object Map]",x0=e=>hf(e)==="[object Set]",Mi=e=>typeof e=="function",Tn=e=>typeof e=="string",fu=e=>typeof e=="symbol",$r=e=>e!==null&&typeof e=="object",b0=e=>($r(e)||Mi(e))&&Mi(e.then)&&Mi(e.catch),w0=Object.prototype.toString,hf=e=>w0.call(e),Hb=e=>hf(e).slice(8,-1),M0=e=>hf(e)==="[object Object]",Tm=e=>Tn(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,uh=Mm(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),df=e=>{const r=Object.create(null);return a=>r[a]||(r[a]=e(a))},Zb=/-(\w)/g,io=df(e=>e.replace(Zb,(r,a)=>a?a.toUpperCase():"")),Wb=/\B([A-Z])/g,uc=df(e=>e.replace(Wb,"-$1").toLowerCase()),ff=df(e=>e.charAt(0).toUpperCase()+e.slice(1)),Tp=df(e=>e?`on${ff(e)}`:""),bl=(e,r)=>!Object.is(e,r),Rd=(e,r)=>{for(let a=0;a<e.length;a++)e[a](r)},Hd=(e,r,a)=>{Object.defineProperty(e,r,{configurable:!0,enumerable:!1,value:a})},Wp=e=>{const r=parseFloat(e);return isNaN(r)?e:r};let zy;const S0=()=>zy||(zy=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Cm(e){if(pi(e)){const r={};for(let a=0;a<e.length;a++){const u=e[a],d=Tn(u)?Jb(u):Cm(u);if(d)for(const y in d)r[y]=d[y]}return r}else if(Tn(e)||$r(e))return e}const Xb=/;(?![^(]*\))/g,Kb=/:([^]+)/,Yb=/\/\*[^]*?\*\//g;function Jb(e){const r={};return e.replace(Yb,"").split(Xb).forEach(a=>{if(a){const u=a.split(Kb);u.length>1&&(r[u[0].trim()]=u[1].trim())}}),r}function Co(e){let r="";if(Tn(e))r=e;else if(pi(e))for(let a=0;a<e.length;a++){const u=Co(e[a]);u&&(r+=u+" ")}else if($r(e))for(const a in e)e[a]&&(r+=a+" ");return r.trim()}const Qb="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",ew=Mm(Qb);function E0(e){return!!e||e===""}const ei=e=>Tn(e)?e:e==null?"":pi(e)||$r(e)&&(e.toString===w0||!Mi(e.toString))?JSON.stringify(e,T0,2):String(e),T0=(e,r)=>r&&r.__v_isRef?T0(e,r.value):eu(r)?{[`Map(${r.size})`]:[...r.entries()].reduce((a,[u,d],y)=>(a[Cp(u,y)+" =>"]=d,a),{})}:x0(r)?{[`Set(${r.size})`]:[...r.values()].map(a=>Cp(a))}:fu(r)?Cp(r):$r(r)&&!pi(r)&&!M0(r)?String(r):r,Cp=(e,r="")=>{var a;return fu(e)?`Symbol(${(a=e.description)!=null?a:r})`:e};/**
* @vue/reactivity v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Gs;class C0{constructor(r=!1){this.detached=r,this._active=!0,this.effects=[],this.cleanups=[],this.parent=Gs,!r&&Gs&&(this.index=(Gs.scopes||(Gs.scopes=[])).push(this)-1)}get active(){return this._active}run(r){if(this._active){const a=Gs;try{return Gs=this,r()}finally{Gs=a}}}on(){Gs=this}off(){Gs=this.parent}stop(r){if(this._active){let a,u;for(a=0,u=this.effects.length;a<u;a++)this.effects[a].stop();for(a=0,u=this.cleanups.length;a<u;a++)this.cleanups[a]();if(this.scopes)for(a=0,u=this.scopes.length;a<u;a++)this.scopes[a].stop(!0);if(!this.detached&&this.parent&&!r){const d=this.parent.scopes.pop();d&&d!==this&&(this.parent.scopes[this.index]=d,d.index=this.index)}this.parent=void 0,this._active=!1}}}function I0(e){return new C0(e)}function tw(e,r=Gs){r&&r.active&&r.effects.push(e)}function A0(){return Gs}function iw(e){Gs&&Gs.cleanups.push(e)}let ac;class Im{constructor(r,a,u,d){this.fn=r,this.trigger=a,this.scheduler=u,this.active=!0,this.deps=[],this._dirtyLevel=4,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,tw(this,d)}get dirty(){if(this._dirtyLevel===2||this._dirtyLevel===3){this._dirtyLevel=1,hc();for(let r=0;r<this._depsLength;r++){const a=this.deps[r];if(a.computed&&(rw(a.computed),this._dirtyLevel>=4))break}this._dirtyLevel===1&&(this._dirtyLevel=0),dc()}return this._dirtyLevel>=4}set dirty(r){this._dirtyLevel=r?4:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let r=yl,a=ac;try{return yl=!0,ac=this,this._runnings++,Oy(this),this.fn()}finally{Fy(this),this._runnings--,ac=a,yl=r}}stop(){var r;this.active&&(Oy(this),Fy(this),(r=this.onStop)==null||r.call(this),this.active=!1)}}function rw(e){return e.value}function Oy(e){e._trackId++,e._depsLength=0}function Fy(e){if(e.deps.length>e._depsLength){for(let r=e._depsLength;r<e.deps.length;r++)P0(e.deps[r],e);e.deps.length=e._depsLength}}function P0(e,r){const a=e.get(r);a!==void 0&&r._trackId!==a&&(e.delete(r),e.size===0&&e.cleanup())}let yl=!0,Xp=0;const D0=[];function hc(){D0.push(yl),yl=!1}function dc(){const e=D0.pop();yl=e===void 0?!0:e}function Am(){Xp++}function Pm(){for(Xp--;!Xp&&Kp.length;)Kp.shift()()}function k0(e,r,a){if(r.get(e)!==e._trackId){r.set(e,e._trackId);const u=e.deps[e._depsLength];u!==r?(u&&P0(u,e),e.deps[e._depsLength++]=r):e._depsLength++}}const Kp=[];function L0(e,r,a){Am();for(const u of e.keys()){let d;u._dirtyLevel<r&&(d??(d=e.get(u)===u._trackId))&&(u._shouldSchedule||(u._shouldSchedule=u._dirtyLevel===0),u._dirtyLevel=r),u._shouldSchedule&&(d??(d=e.get(u)===u._trackId))&&(u.trigger(),(!u._runnings||u.allowRecurse)&&u._dirtyLevel!==2&&(u._shouldSchedule=!1,u.scheduler&&Kp.push(u.scheduler)))}Pm()}const R0=(e,r)=>{const a=new Map;return a.cleanup=e,a.computed=r,a},Zd=new WeakMap,oc=Symbol(""),Yp=Symbol("");function Ps(e,r,a){if(yl&&ac){let u=Zd.get(e);u||Zd.set(e,u=new Map);let d=u.get(a);d||u.set(a,d=R0(()=>u.delete(a))),k0(ac,d)}}function Io(e,r,a,u,d,y){const m=Zd.get(e);if(!m)return;let l=[];if(r==="clear")l=[...m.values()];else if(a==="length"&&pi(e)){const T=Number(u);m.forEach((P,R)=>{(R==="length"||!fu(R)&&R>=T)&&l.push(P)})}else switch(a!==void 0&&l.push(m.get(a)),r){case"add":pi(e)?Tm(a)&&l.push(m.get("length")):(l.push(m.get(oc)),eu(e)&&l.push(m.get(Yp)));break;case"delete":pi(e)||(l.push(m.get(oc)),eu(e)&&l.push(m.get(Yp)));break;case"set":eu(e)&&l.push(m.get(oc));break}Am();for(const T of l)T&&L0(T,4);Pm()}function nw(e,r){var a;return(a=Zd.get(e))==null?void 0:a.get(r)}const sw=Mm("__proto__,__v_isRef,__isVue"),z0=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(fu)),By=aw();function aw(){const e={};return["includes","indexOf","lastIndexOf"].forEach(r=>{e[r]=function(...a){const u=Hi(this);for(let y=0,m=this.length;y<m;y++)Ps(u,"get",y+"");const d=u[r](...a);return d===-1||d===!1?u[r](...a.map(Hi)):d}}),["push","pop","shift","unshift","splice"].forEach(r=>{e[r]=function(...a){hc(),Am();const u=Hi(this)[r].apply(this,a);return Pm(),dc(),u}}),e}function ow(e){const r=Hi(this);return Ps(r,"has",e),r.hasOwnProperty(e)}class O0{constructor(r=!1,a=!1){this._isReadonly=r,this._isShallow=a}get(r,a,u){const d=this._isReadonly,y=this._isShallow;if(a==="__v_isReactive")return!d;if(a==="__v_isReadonly")return d;if(a==="__v_isShallow")return y;if(a==="__v_raw")return u===(d?y?xw:$0:y?N0:B0).get(r)||Object.getPrototypeOf(r)===Object.getPrototypeOf(u)?r:void 0;const m=pi(r);if(!d){if(m&&qi(By,a))return Reflect.get(By,a,u);if(a==="hasOwnProperty")return ow}const l=Reflect.get(r,a,u);return(fu(a)?z0.has(a):sw(a))||(d||Ps(r,"get",a),y)?l:Cn(l)?m&&Tm(a)?l:l.value:$r(l)?d?V0(l):zh(l):l}}class F0 extends O0{constructor(r=!1){super(!1,r)}set(r,a,u,d){let y=r[a];if(!this._isShallow){const T=su(y);if(!Wd(u)&&!su(u)&&(y=Hi(y),u=Hi(u)),!pi(r)&&Cn(y)&&!Cn(u))return T?!1:(y.value=u,!0)}const m=pi(r)&&Tm(a)?Number(a)<r.length:qi(r,a),l=Reflect.set(r,a,u,d);return r===Hi(d)&&(m?bl(u,y)&&Io(r,"set",a,u):Io(r,"add",a,u)),l}deleteProperty(r,a){const u=qi(r,a);r[a];const d=Reflect.deleteProperty(r,a);return d&&u&&Io(r,"delete",a,void 0),d}has(r,a){const u=Reflect.has(r,a);return(!fu(a)||!z0.has(a))&&Ps(r,"has",a),u}ownKeys(r){return Ps(r,"iterate",pi(r)?"length":oc),Reflect.ownKeys(r)}}class lw extends O0{constructor(r=!1){super(!0,r)}set(r,a){return!0}deleteProperty(r,a){return!0}}const cw=new F0,uw=new lw,hw=new F0(!0),Dm=e=>e,pf=e=>Reflect.getPrototypeOf(e);function Sd(e,r,a=!1,u=!1){e=e.__v_raw;const d=Hi(e),y=Hi(r);a||(bl(r,y)&&Ps(d,"get",r),Ps(d,"get",y));const{has:m}=pf(d),l=u?Dm:a?Rm:wh;if(m.call(d,r))return l(e.get(r));if(m.call(d,y))return l(e.get(y));e!==d&&e.get(r)}function Ed(e,r=!1){const a=this.__v_raw,u=Hi(a),d=Hi(e);return r||(bl(e,d)&&Ps(u,"has",e),Ps(u,"has",d)),e===d?a.has(e):a.has(e)||a.has(d)}function Td(e,r=!1){return e=e.__v_raw,!r&&Ps(Hi(e),"iterate",oc),Reflect.get(e,"size",e)}function Ny(e){e=Hi(e);const r=Hi(this);return pf(r).has.call(r,e)||(r.add(e),Io(r,"add",e,e)),this}function $y(e,r){r=Hi(r);const a=Hi(this),{has:u,get:d}=pf(a);let y=u.call(a,e);y||(e=Hi(e),y=u.call(a,e));const m=d.call(a,e);return a.set(e,r),y?bl(r,m)&&Io(a,"set",e,r):Io(a,"add",e,r),this}function Uy(e){const r=Hi(this),{has:a,get:u}=pf(r);let d=a.call(r,e);d||(e=Hi(e),d=a.call(r,e)),u&&u.call(r,e);const y=r.delete(e);return d&&Io(r,"delete",e,void 0),y}function Vy(){const e=Hi(this),r=e.size!==0,a=e.clear();return r&&Io(e,"clear",void 0,void 0),a}function Cd(e,r){return function(u,d){const y=this,m=y.__v_raw,l=Hi(m),T=r?Dm:e?Rm:wh;return!e&&Ps(l,"iterate",oc),m.forEach((P,R)=>u.call(d,T(P),T(R),y))}}function Id(e,r,a){return function(...u){const d=this.__v_raw,y=Hi(d),m=eu(y),l=e==="entries"||e===Symbol.iterator&&m,T=e==="keys"&&m,P=d[e](...u),R=a?Dm:r?Rm:wh;return!r&&Ps(y,"iterate",T?Yp:oc),{next(){const{value:D,done:z}=P.next();return z?{value:D,done:z}:{value:l?[R(D[0]),R(D[1])]:R(D),done:z}},[Symbol.iterator](){return this}}}}function ll(e){return function(...r){return e==="delete"?!1:e==="clear"?void 0:this}}function dw(){const e={get(y){return Sd(this,y)},get size(){return Td(this)},has:Ed,add:Ny,set:$y,delete:Uy,clear:Vy,forEach:Cd(!1,!1)},r={get(y){return Sd(this,y,!1,!0)},get size(){return Td(this)},has:Ed,add:Ny,set:$y,delete:Uy,clear:Vy,forEach:Cd(!1,!0)},a={get(y){return Sd(this,y,!0)},get size(){return Td(this,!0)},has(y){return Ed.call(this,y,!0)},add:ll("add"),set:ll("set"),delete:ll("delete"),clear:ll("clear"),forEach:Cd(!0,!1)},u={get(y){return Sd(this,y,!0,!0)},get size(){return Td(this,!0)},has(y){return Ed.call(this,y,!0)},add:ll("add"),set:ll("set"),delete:ll("delete"),clear:ll("clear"),forEach:Cd(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(y=>{e[y]=Id(y,!1,!1),a[y]=Id(y,!0,!1),r[y]=Id(y,!1,!0),u[y]=Id(y,!0,!0)}),[e,a,r,u]}const[fw,pw,mw,gw]=dw();function km(e,r){const a=r?e?gw:mw:e?pw:fw;return(u,d,y)=>d==="__v_isReactive"?!e:d==="__v_isReadonly"?e:d==="__v_raw"?u:Reflect.get(qi(a,d)&&d in u?a:u,d,y)}const yw={get:km(!1,!1)},_w={get:km(!1,!0)},vw={get:km(!0,!1)},B0=new WeakMap,N0=new WeakMap,$0=new WeakMap,xw=new WeakMap;function bw(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function ww(e){return e.__v_skip||!Object.isExtensible(e)?0:bw(Hb(e))}function zh(e){return su(e)?e:Lm(e,!1,cw,yw,B0)}function U0(e){return Lm(e,!1,hw,_w,N0)}function V0(e){return Lm(e,!0,uw,vw,$0)}function Lm(e,r,a,u,d){if(!$r(e)||e.__v_raw&&!(r&&e.__v_isReactive))return e;const y=d.get(e);if(y)return y;const m=ww(e);if(m===0)return e;const l=new Proxy(e,m===2?u:a);return d.set(e,l),l}function _l(e){return su(e)?_l(e.__v_raw):!!(e&&e.__v_isReactive)}function su(e){return!!(e&&e.__v_isReadonly)}function Wd(e){return!!(e&&e.__v_isShallow)}function j0(e){return _l(e)||su(e)}function Hi(e){const r=e&&e.__v_raw;return r?Hi(r):e}function mf(e){return Object.isExtensible(e)&&Hd(e,"__v_skip",!0),e}const wh=e=>$r(e)?zh(e):e,Rm=e=>$r(e)?V0(e):e;class q0{constructor(r,a,u,d){this.getter=r,this._setter=a,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this.effect=new Im(()=>r(this._value),()=>zd(this,this.effect._dirtyLevel===2?2:3)),this.effect.computed=this,this.effect.active=this._cacheable=!d,this.__v_isReadonly=u}get value(){const r=Hi(this);return(!r._cacheable||r.effect.dirty)&&bl(r._value,r._value=r.effect.run())&&zd(r,4),G0(r),r.effect._dirtyLevel>=2&&zd(r,2),r._value}set value(r){this._setter(r)}get _dirty(){return this.effect.dirty}set _dirty(r){this.effect.dirty=r}}function Mw(e,r,a=!1){let u,d;const y=Mi(e);return y?(u=e,d=oa):(u=e.get,d=e.set),new q0(u,d,y||!d,a)}function G0(e){var r;yl&&ac&&(e=Hi(e),k0(ac,(r=e.dep)!=null?r:e.dep=R0(()=>e.dep=void 0,e instanceof q0?e:void 0)))}function zd(e,r=4,a){e=Hi(e);const u=e.dep;u&&L0(u,r)}function Cn(e){return!!(e&&e.__v_isRef===!0)}function ms(e){return H0(e,!1)}function Sw(e){return H0(e,!0)}function H0(e,r){return Cn(e)?e:new Ew(e,r)}class Ew{constructor(r,a){this.__v_isShallow=a,this.dep=void 0,this.__v_isRef=!0,this._rawValue=a?r:Hi(r),this._value=a?r:wh(r)}get value(){return G0(this),this._value}set value(r){const a=this.__v_isShallow||Wd(r)||su(r);r=a?r:Hi(r),bl(r,this._rawValue)&&(this._rawValue=r,this._value=a?r:wh(r),zd(this,4))}}function ar(e){return Cn(e)?e.value:e}const Tw={get:(e,r,a)=>ar(Reflect.get(e,r,a)),set:(e,r,a,u)=>{const d=e[r];return Cn(d)&&!Cn(a)?(d.value=a,!0):Reflect.set(e,r,a,u)}};function Z0(e){return _l(e)?e:new Proxy(e,Tw)}function Cw(e){const r=pi(e)?new Array(e.length):{};for(const a in e)r[a]=Aw(e,a);return r}class Iw{constructor(r,a,u){this._object=r,this._key=a,this._defaultValue=u,this.__v_isRef=!0}get value(){const r=this._object[this._key];return r===void 0?this._defaultValue:r}set value(r){this._object[this._key]=r}get dep(){return nw(Hi(this._object),this._key)}}function Aw(e,r,a){const u=e[r];return Cn(u)?u:new Iw(e,r,a)}/**
* @vue/runtime-core v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function vl(e,r,a,u){try{return u?e(...u):e()}catch(d){gf(d,r,a)}}function Pa(e,r,a,u){if(Mi(e)){const y=vl(e,r,a,u);return y&&b0(y)&&y.catch(m=>{gf(m,r,a)}),y}const d=[];for(let y=0;y<e.length;y++)d.push(Pa(e[y],r,a,u));return d}function gf(e,r,a,u=!0){const d=r?r.vnode:null;if(r){let y=r.parent;const m=r.proxy,l=`https://vuejs.org/error-reference/#runtime-${a}`;for(;y;){const P=y.ec;if(P){for(let R=0;R<P.length;R++)if(P[R](e,m,l)===!1)return}y=y.parent}const T=r.appContext.config.errorHandler;if(T){vl(T,null,10,[e,m,l]);return}}Pw(e,a,d,u)}function Pw(e,r,a,u=!0){console.error(e)}let Mh=!1,Jp=!1;const ts=[];let Ja=0;const tu=[];let fl=null,nc=0;const W0=Promise.resolve();let zm=null;function Om(e){const r=zm||W0;return e?r.then(this?e.bind(this):e):r}function Dw(e){let r=Ja+1,a=ts.length;for(;r<a;){const u=r+a>>>1,d=ts[u],y=Sh(d);y<e||y===e&&d.pre?r=u+1:a=u}return r}function Fm(e){(!ts.length||!ts.includes(e,Mh&&e.allowRecurse?Ja+1:Ja))&&(e.id==null?ts.push(e):ts.splice(Dw(e.id),0,e),X0())}function X0(){!Mh&&!Jp&&(Jp=!0,zm=W0.then(Y0))}function kw(e){const r=ts.indexOf(e);r>Ja&&ts.splice(r,1)}function Lw(e){pi(e)?tu.push(...e):(!fl||!fl.includes(e,e.allowRecurse?nc+1:nc))&&tu.push(e),X0()}function jy(e,r,a=Mh?Ja+1:0){for(;a<ts.length;a++){const u=ts[a];if(u&&u.pre){if(e&&u.id!==e.uid)continue;ts.splice(a,1),a--,u()}}}function K0(e){if(tu.length){const r=[...new Set(tu)].sort((a,u)=>Sh(a)-Sh(u));if(tu.length=0,fl){fl.push(...r);return}for(fl=r,nc=0;nc<fl.length;nc++)fl[nc]();fl=null,nc=0}}const Sh=e=>e.id==null?1/0:e.id,Rw=(e,r)=>{const a=Sh(e)-Sh(r);if(a===0){if(e.pre&&!r.pre)return-1;if(r.pre&&!e.pre)return 1}return a};function Y0(e){Jp=!1,Mh=!0,ts.sort(Rw);try{for(Ja=0;Ja<ts.length;Ja++){const r=ts[Ja];r&&r.active!==!1&&vl(r,null,14)}}finally{Ja=0,ts.length=0,K0(),Mh=!1,zm=null,(ts.length||tu.length)&&Y0()}}function zw(e,r,...a){if(e.isUnmounted)return;const u=e.vnode.props||zr;let d=a;const y=r.startsWith("update:"),m=y&&r.slice(7);if(m&&m in u){const R=`${m==="modelValue"?"model":m}Modifiers`,{number:D,trim:z}=u[R]||zr;z&&(d=a.map(Z=>Tn(Z)?Z.trim():Z)),D&&(d=a.map(Wp))}let l,T=u[l=Tp(r)]||u[l=Tp(io(r))];!T&&y&&(T=u[l=Tp(uc(r))]),T&&Pa(T,e,6,d);const P=u[l+"Once"];if(P){if(!e.emitted)e.emitted={};else if(e.emitted[l])return;e.emitted[l]=!0,Pa(P,e,6,d)}}function J0(e,r,a=!1){const u=r.emitsCache,d=u.get(e);if(d!==void 0)return d;const y=e.emits;let m={},l=!1;if(!Mi(e)){const T=P=>{const R=J0(P,r,!0);R&&(l=!0,Vn(m,R))};!a&&r.mixins.length&&r.mixins.forEach(T),e.extends&&T(e.extends),e.mixins&&e.mixins.forEach(T)}return!y&&!l?($r(e)&&u.set(e,null),null):(pi(y)?y.forEach(T=>m[T]=null):Vn(m,y),$r(e)&&u.set(e,m),m)}function yf(e,r){return!e||!uf(r)?!1:(r=r.slice(2).replace(/Once$/,""),qi(e,r[0].toLowerCase()+r.slice(1))||qi(e,uc(r))||qi(e,r))}let En=null,_f=null;function Xd(e){const r=En;return En=e,_f=e&&e.type.__scopeId||null,r}function vf(e){_f=e}function xf(){_f=null}function To(e,r=En,a){if(!r||e._n)return e;const u=(...d)=>{u._d&&e_(-1);const y=Xd(r);let m;try{m=e(...d)}finally{Xd(y),u._d&&e_(1)}return m};return u._n=!0,u._c=!0,u._d=!0,u}function Ip(e){const{type:r,vnode:a,proxy:u,withProxy:d,props:y,propsOptions:[m],slots:l,attrs:T,emit:P,render:R,renderCache:D,data:z,setupState:Z,ctx:K,inheritAttrs:Y}=e;let me,Te;const Fe=Xd(e);try{if(a.shapeFlag&4){const Pe=d||u,Ze=Pe;me=Ya(R.call(Ze,Pe,D,y,Z,z,K)),Te=T}else{const Pe=r;me=Ya(Pe.length>1?Pe(y,{attrs:T,slots:l,emit:P}):Pe(y,null)),Te=r.props?T:Ow(T)}}catch(Pe){fh.length=0,gf(Pe,e,1),me=or(wl)}let ae=me;if(Te&&Y!==!1){const Pe=Object.keys(Te),{shapeFlag:Ze}=ae;Pe.length&&Ze&7&&(m&&Pe.some(Sm)&&(Te=Fw(Te,m)),ae=au(ae,Te))}return a.dirs&&(ae=au(ae),ae.dirs=ae.dirs?ae.dirs.concat(a.dirs):a.dirs),a.transition&&(ae.transition=a.transition),me=ae,Xd(Fe),me}const Ow=e=>{let r;for(const a in e)(a==="class"||a==="style"||uf(a))&&((r||(r={}))[a]=e[a]);return r},Fw=(e,r)=>{const a={};for(const u in e)(!Sm(u)||!(u.slice(9)in r))&&(a[u]=e[u]);return a};function Bw(e,r,a){const{props:u,children:d,component:y}=e,{props:m,children:l,patchFlag:T}=r,P=y.emitsOptions;if(r.dirs||r.transition)return!0;if(a&&T>=0){if(T&1024)return!0;if(T&16)return u?qy(u,m,P):!!m;if(T&8){const R=r.dynamicProps;for(let D=0;D<R.length;D++){const z=R[D];if(m[z]!==u[z]&&!yf(P,z))return!0}}}else return(d||l)&&(!l||!l.$stable)?!0:u===m?!1:u?m?qy(u,m,P):!0:!!m;return!1}function qy(e,r,a){const u=Object.keys(r);if(u.length!==Object.keys(e).length)return!0;for(let d=0;d<u.length;d++){const y=u[d];if(r[y]!==e[y]&&!yf(a,y))return!0}return!1}function Nw({vnode:e,parent:r},a){for(;r;){const u=r.subTree;if(u.suspense&&u.suspense.activeBranch===e&&(u.el=e.el),u===e)(e=r.vnode).el=a,r=r.parent;else break}}const Q0="components";function WR(e,r){return Uw(Q0,e,!0,r)||e}const $w=Symbol.for("v-ndc");function Uw(e,r,a=!0,u=!1){const d=En||Un;if(d){const y=d.type;if(e===Q0){const l=z2(y,!1);if(l&&(l===r||l===io(r)||l===ff(io(r))))return y}const m=Gy(d[e]||y[e],r)||Gy(d.appContext[e],r);return!m&&u?y:m}}function Gy(e,r){return e&&(e[r]||e[io(r)]||e[ff(io(r))])}const Vw=e=>e.__isSuspense;function jw(e,r){r&&r.pendingBranch?pi(e)?r.effects.push(...e):r.effects.push(e):Lw(e)}const qw=Symbol.for("v-scx"),Gw=()=>ca(qw),Ad={};function la(e,r,a){return ev(e,r,a)}function ev(e,r,{immediate:a,deep:u,flush:d,once:y,onTrack:m,onTrigger:l}=zr){if(r&&y){const Je=r;r=(...dt)=>{Je(...dt),Ze()}}const T=Un,P=Je=>u===!0?Je:sc(Je,u===!1?1:void 0);let R,D=!1,z=!1;if(Cn(e)?(R=()=>e.value,D=Wd(e)):_l(e)?(R=()=>P(e),D=!0):pi(e)?(z=!0,D=e.some(Je=>_l(Je)||Wd(Je)),R=()=>e.map(Je=>{if(Cn(Je))return Je.value;if(_l(Je))return P(Je);if(Mi(Je))return vl(Je,T,2)})):Mi(e)?r?R=()=>vl(e,T,2):R=()=>(Z&&Z(),Pa(e,T,3,[K])):R=oa,r&&u){const Je=R;R=()=>sc(Je())}let Z,K=Je=>{Z=ae.onStop=()=>{vl(Je,T,4),Z=ae.onStop=void 0}},Y;if(Sf)if(K=oa,r?a&&Pa(r,T,3,[R(),z?[]:void 0,K]):R(),d==="sync"){const Je=Gw();Y=Je.__watcherHandles||(Je.__watcherHandles=[])}else return oa;let me=z?new Array(e.length).fill(Ad):Ad;const Te=()=>{if(!(!ae.active||!ae.dirty))if(r){const Je=ae.run();(u||D||(z?Je.some((dt,_t)=>bl(dt,me[_t])):bl(Je,me)))&&(Z&&Z(),Pa(r,T,3,[Je,me===Ad?void 0:z&&me[0]===Ad?[]:me,K]),me=Je)}else ae.run()};Te.allowRecurse=!!r;let Fe;d==="sync"?Fe=Te:d==="post"?Fe=()=>As(Te,T&&T.suspense):(Te.pre=!0,T&&(Te.id=T.uid),Fe=()=>Fm(Te));const ae=new Im(R,oa,Fe),Pe=A0(),Ze=()=>{ae.stop(),Pe&&Em(Pe.effects,ae)};return r?a?Te():me=ae.run():d==="post"?As(ae.run.bind(ae),T&&T.suspense):ae.run(),Y&&Y.push(Ze),Ze}function Hw(e,r,a){const u=this.proxy,d=Tn(e)?e.includes(".")?tv(u,e):()=>u[e]:e.bind(u,u);let y;Mi(r)?y=r:(y=r.handler,a=r);const m=Fh(this),l=ev(d,y.bind(u),a);return m(),l}function tv(e,r){const a=r.split(".");return()=>{let u=e;for(let d=0;d<a.length&&u;d++)u=u[a[d]];return u}}function sc(e,r,a=0,u){if(!$r(e)||e.__v_skip)return e;if(r&&r>0){if(a>=r)return e;a++}if(u=u||new Set,u.has(e))return e;if(u.add(e),Cn(e))sc(e.value,r,a,u);else if(pi(e))for(let d=0;d<e.length;d++)sc(e[d],r,a,u);else if(x0(e)||eu(e))e.forEach(d=>{sc(d,r,a,u)});else if(M0(e))for(const d in e)sc(e[d],r,a,u);return e}function iv(e,r){if(En===null)return e;const a=Ef(En)||En.proxy,u=e.dirs||(e.dirs=[]);for(let d=0;d<r.length;d++){let[y,m,l,T=zr]=r[d];y&&(Mi(y)&&(y={mounted:y,updated:y}),y.deep&&sc(m),u.push({dir:y,instance:a,value:m,oldValue:void 0,arg:l,modifiers:T}))}return e}function Ql(e,r,a,u){const d=e.dirs,y=r&&r.dirs;for(let m=0;m<d.length;m++){const l=d[m];y&&(l.oldValue=y[m].value);let T=l.dir[u];T&&(hc(),Pa(T,a,8,[e.el,l,e,r]),dc())}}/*! #__NO_SIDE_EFFECTS__ */function rv(e,r){return Mi(e)?Vn({name:e.name},r,{setup:e}):e}const hh=e=>!!e.type.__asyncLoader,nv=e=>e.type.__isKeepAlive;function Zw(e,r){sv(e,"a",r)}function Ww(e,r){sv(e,"da",r)}function sv(e,r,a=Un){const u=e.__wdc||(e.__wdc=()=>{let d=a;for(;d;){if(d.isDeactivated)return;d=d.parent}return e()});if(bf(r,u,a),a){let d=a.parent;for(;d&&d.parent;)nv(d.parent.vnode)&&Xw(u,r,a,d),d=d.parent}}function Xw(e,r,a,u){const d=bf(r,e,u,!0);ov(()=>{Em(u[r],d)},a)}function bf(e,r,a=Un,u=!1){if(a){const d=a[e]||(a[e]=[]),y=r.__weh||(r.__weh=(...m)=>{if(a.isUnmounted)return;hc();const l=Fh(a),T=Pa(r,a,e,m);return l(),dc(),T});return u?d.unshift(y):d.push(y),y}}const Po=e=>(r,a=Un)=>(!Sf||e==="sp")&&bf(e,(...u)=>r(...u),a),av=Po("bm"),Oh=Po("m"),Kw=Po("bu"),Yw=Po("u"),Jw=Po("bum"),ov=Po("um"),Qw=Po("sp"),e2=Po("rtg"),t2=Po("rtc");function i2(e,r=Un){bf("ec",e,r)}function Ca(e,r,a,u){let d;const y=a&&a[u];if(pi(e)||Tn(e)){d=new Array(e.length);for(let m=0,l=e.length;m<l;m++)d[m]=r(e[m],m,void 0,y&&y[m])}else if(typeof e=="number"){d=new Array(e);for(let m=0;m<e;m++)d[m]=r(m+1,m,void 0,y&&y[m])}else if($r(e))if(e[Symbol.iterator])d=Array.from(e,(m,l)=>r(m,l,void 0,y&&y[l]));else{const m=Object.keys(e);d=new Array(m.length);for(let l=0,T=m.length;l<T;l++){const P=m[l];d[l]=r(e[P],P,l,y&&y[l])}}else d=[];return a&&(a[u]=d),d}function r2(e,r,a={},u,d){if(En.isCE||En.parent&&hh(En.parent)&&En.parent.isCE)return r!=="default"&&(a.name=r),or("slot",a,u&&u());let y=e[r];y&&y._c&&(y._d=!1),Lt();const m=y&&lv(y(a)),l=Ka(Nr,{key:a.key||m&&m.key||`_${r}`},m||(u?u():[]),m&&e._===1?64:-2);return!d&&l.scopeId&&(l.slotScopeIds=[l.scopeId+"-s"]),y&&y._c&&(y._d=!0),l}function lv(e){return e.some(r=>Yd(r)?!(r.type===wl||r.type===Nr&&!lv(r.children)):!0)?e:null}const Qp=e=>e?xv(e)?Ef(e)||e.proxy:Qp(e.parent):null,dh=Vn(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>Qp(e.parent),$root:e=>Qp(e.root),$emit:e=>e.emit,$options:e=>Bm(e),$forceUpdate:e=>e.f||(e.f=()=>{e.effect.dirty=!0,Fm(e.update)}),$nextTick:e=>e.n||(e.n=Om.bind(e.proxy)),$watch:e=>Hw.bind(e)}),Ap=(e,r)=>e!==zr&&!e.__isScriptSetup&&qi(e,r),n2={get({_:e},r){const{ctx:a,setupState:u,data:d,props:y,accessCache:m,type:l,appContext:T}=e;let P;if(r[0]!=="$"){const Z=m[r];if(Z!==void 0)switch(Z){case 1:return u[r];case 2:return d[r];case 4:return a[r];case 3:return y[r]}else{if(Ap(u,r))return m[r]=1,u[r];if(d!==zr&&qi(d,r))return m[r]=2,d[r];if((P=e.propsOptions[0])&&qi(P,r))return m[r]=3,y[r];if(a!==zr&&qi(a,r))return m[r]=4,a[r];em&&(m[r]=0)}}const R=dh[r];let D,z;if(R)return r==="$attrs"&&Ps(e,"get",r),R(e);if((D=l.__cssModules)&&(D=D[r]))return D;if(a!==zr&&qi(a,r))return m[r]=4,a[r];if(z=T.config.globalProperties,qi(z,r))return z[r]},set({_:e},r,a){const{data:u,setupState:d,ctx:y}=e;return Ap(d,r)?(d[r]=a,!0):u!==zr&&qi(u,r)?(u[r]=a,!0):qi(e.props,r)||r[0]==="$"&&r.slice(1)in e?!1:(y[r]=a,!0)},has({_:{data:e,setupState:r,accessCache:a,ctx:u,appContext:d,propsOptions:y}},m){let l;return!!a[m]||e!==zr&&qi(e,m)||Ap(r,m)||(l=y[0])&&qi(l,m)||qi(u,m)||qi(dh,m)||qi(d.config.globalProperties,m)},defineProperty(e,r,a){return a.get!=null?e._.accessCache[r]=0:qi(a,"value")&&this.set(e,r,a.value,null),Reflect.defineProperty(e,r,a)}};function Hy(e){return pi(e)?e.reduce((r,a)=>(r[a]=null,r),{}):e}let em=!0;function s2(e){const r=Bm(e),a=e.proxy,u=e.ctx;em=!1,r.beforeCreate&&Zy(r.beforeCreate,e,"bc");const{data:d,computed:y,methods:m,watch:l,provide:T,inject:P,created:R,beforeMount:D,mounted:z,beforeUpdate:Z,updated:K,activated:Y,deactivated:me,beforeDestroy:Te,beforeUnmount:Fe,destroyed:ae,unmounted:Pe,render:Ze,renderTracked:Je,renderTriggered:dt,errorCaptured:_t,serverPrefetch:xt,expose:Vt,inheritAttrs:kt,components:ri,directives:xi,filters:li}=r;if(P&&a2(P,u,null),m)for(const tt in m){const rt=m[tt];Mi(rt)&&(u[tt]=rt.bind(a))}if(d){const tt=d.call(a,a);$r(tt)&&(e.data=zh(tt))}if(em=!0,y)for(const tt in y){const rt=y[tt],It=Mi(rt)?rt.bind(a,a):Mi(rt.get)?rt.get.bind(a,a):oa,br=!Mi(rt)&&Mi(rt.set)?rt.set.bind(a):oa,Oi=Gi({get:It,set:br});Object.defineProperty(u,tt,{enumerable:!0,configurable:!0,get:()=>Oi.value,set:Si=>Oi.value=Si})}if(l)for(const tt in l)cv(l[tt],u,a,tt);if(T){const tt=Mi(T)?T.call(a):T;Reflect.ownKeys(tt).forEach(rt=>{Od(rt,tt[rt])})}R&&Zy(R,e,"c");function si(tt,rt){pi(rt)?rt.forEach(It=>tt(It.bind(a))):rt&&tt(rt.bind(a))}if(si(av,D),si(Oh,z),si(Kw,Z),si(Yw,K),si(Zw,Y),si(Ww,me),si(i2,_t),si(t2,Je),si(e2,dt),si(Jw,Fe),si(ov,Pe),si(Qw,xt),pi(Vt))if(Vt.length){const tt=e.exposed||(e.exposed={});Vt.forEach(rt=>{Object.defineProperty(tt,rt,{get:()=>a[rt],set:It=>a[rt]=It})})}else e.exposed||(e.exposed={});Ze&&e.render===oa&&(e.render=Ze),kt!=null&&(e.inheritAttrs=kt),ri&&(e.components=ri),xi&&(e.directives=xi)}function a2(e,r,a=oa){pi(e)&&(e=tm(e));for(const u in e){const d=e[u];let y;$r(d)?"default"in d?y=ca(d.from||u,d.default,!0):y=ca(d.from||u):y=ca(d),Cn(y)?Object.defineProperty(r,u,{enumerable:!0,configurable:!0,get:()=>y.value,set:m=>y.value=m}):r[u]=y}}function Zy(e,r,a){Pa(pi(e)?e.map(u=>u.bind(r.proxy)):e.bind(r.proxy),r,a)}function cv(e,r,a,u){const d=u.includes(".")?tv(a,u):()=>a[u];if(Tn(e)){const y=r[e];Mi(y)&&la(d,y)}else if(Mi(e))la(d,e.bind(a));else if($r(e))if(pi(e))e.forEach(y=>cv(y,r,a,u));else{const y=Mi(e.handler)?e.handler.bind(a):r[e.handler];Mi(y)&&la(d,y,e)}}function Bm(e){const r=e.type,{mixins:a,extends:u}=r,{mixins:d,optionsCache:y,config:{optionMergeStrategies:m}}=e.appContext,l=y.get(r);let T;return l?T=l:!d.length&&!a&&!u?T=r:(T={},d.length&&d.forEach(P=>Kd(T,P,m,!0)),Kd(T,r,m)),$r(r)&&y.set(r,T),T}function Kd(e,r,a,u=!1){const{mixins:d,extends:y}=r;y&&Kd(e,y,a,!0),d&&d.forEach(m=>Kd(e,m,a,!0));for(const m in r)if(!(u&&m==="expose")){const l=o2[m]||a&&a[m];e[m]=l?l(e[m],r[m]):r[m]}return e}const o2={data:Wy,props:Xy,emits:Xy,methods:ah,computed:ah,beforeCreate:ds,created:ds,beforeMount:ds,mounted:ds,beforeUpdate:ds,updated:ds,beforeDestroy:ds,beforeUnmount:ds,destroyed:ds,unmounted:ds,activated:ds,deactivated:ds,errorCaptured:ds,serverPrefetch:ds,components:ah,directives:ah,watch:c2,provide:Wy,inject:l2};function Wy(e,r){return r?e?function(){return Vn(Mi(e)?e.call(this,this):e,Mi(r)?r.call(this,this):r)}:r:e}function l2(e,r){return ah(tm(e),tm(r))}function tm(e){if(pi(e)){const r={};for(let a=0;a<e.length;a++)r[e[a]]=e[a];return r}return e}function ds(e,r){return e?[...new Set([].concat(e,r))]:r}function ah(e,r){return e?Vn(Object.create(null),e,r):r}function Xy(e,r){return e?pi(e)&&pi(r)?[...new Set([...e,...r])]:Vn(Object.create(null),Hy(e),Hy(r??{})):r}function c2(e,r){if(!e)return r;if(!r)return e;const a=Vn(Object.create(null),e);for(const u in r)a[u]=ds(e[u],r[u]);return a}function uv(){return{app:null,config:{isNativeTag:qb,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let u2=0;function h2(e,r){return function(u,d=null){Mi(u)||(u=Vn({},u)),d!=null&&!$r(d)&&(d=null);const y=uv(),m=new WeakSet;let l=!1;const T=y.app={_uid:u2++,_component:u,_props:d,_container:null,_context:y,_instance:null,version:F2,get config(){return y.config},set config(P){},use(P,...R){return m.has(P)||(P&&Mi(P.install)?(m.add(P),P.install(T,...R)):Mi(P)&&(m.add(P),P(T,...R))),T},mixin(P){return y.mixins.includes(P)||y.mixins.push(P),T},component(P,R){return R?(y.components[P]=R,T):y.components[P]},directive(P,R){return R?(y.directives[P]=R,T):y.directives[P]},mount(P,R,D){if(!l){const z=or(u,d);return z.appContext=y,D===!0?D="svg":D===!1&&(D=void 0),R&&r?r(z,P):e(z,P,D),l=!0,T._container=P,P.__vue_app__=T,Ef(z.component)||z.component.proxy}},unmount(){l&&(e(null,T._container),delete T._container.__vue_app__)},provide(P,R){return y.provides[P]=R,T},runWithContext(P){const R=iu;iu=T;try{return P()}finally{iu=R}}};return T}}let iu=null;function Od(e,r){if(Un){let a=Un.provides;const u=Un.parent&&Un.parent.provides;u===a&&(a=Un.provides=Object.create(u)),a[e]=r}}function ca(e,r,a=!1){const u=Un||En;if(u||iu){const d=u?u.parent==null?u.vnode.appContext&&u.vnode.appContext.provides:u.parent.provides:iu._context.provides;if(d&&e in d)return d[e];if(arguments.length>1)return a&&Mi(r)?r.call(u&&u.proxy):r}}function d2(){return!!(Un||En||iu)}function f2(e,r,a,u=!1){const d={},y={};Hd(y,Mf,1),e.propsDefaults=Object.create(null),hv(e,r,d,y);for(const m in e.propsOptions[0])m in d||(d[m]=void 0);a?e.props=u?d:U0(d):e.type.props?e.props=d:e.props=y,e.attrs=y}function p2(e,r,a,u){const{props:d,attrs:y,vnode:{patchFlag:m}}=e,l=Hi(d),[T]=e.propsOptions;let P=!1;if((u||m>0)&&!(m&16)){if(m&8){const R=e.vnode.dynamicProps;for(let D=0;D<R.length;D++){let z=R[D];if(yf(e.emitsOptions,z))continue;const Z=r[z];if(T)if(qi(y,z))Z!==y[z]&&(y[z]=Z,P=!0);else{const K=io(z);d[K]=im(T,l,K,Z,e,!1)}else Z!==y[z]&&(y[z]=Z,P=!0)}}}else{hv(e,r,d,y)&&(P=!0);let R;for(const D in l)(!r||!qi(r,D)&&((R=uc(D))===D||!qi(r,R)))&&(T?a&&(a[D]!==void 0||a[R]!==void 0)&&(d[D]=im(T,l,D,void 0,e,!0)):delete d[D]);if(y!==l)for(const D in y)(!r||!qi(r,D))&&(delete y[D],P=!0)}P&&Io(e,"set","$attrs")}function hv(e,r,a,u){const[d,y]=e.propsOptions;let m=!1,l;if(r)for(let T in r){if(uh(T))continue;const P=r[T];let R;d&&qi(d,R=io(T))?!y||!y.includes(R)?a[R]=P:(l||(l={}))[R]=P:yf(e.emitsOptions,T)||(!(T in u)||P!==u[T])&&(u[T]=P,m=!0)}if(y){const T=Hi(a),P=l||zr;for(let R=0;R<y.length;R++){const D=y[R];a[D]=im(d,T,D,P[D],e,!qi(P,D))}}return m}function im(e,r,a,u,d,y){const m=e[a];if(m!=null){const l=qi(m,"default");if(l&&u===void 0){const T=m.default;if(m.type!==Function&&!m.skipFactory&&Mi(T)){const{propsDefaults:P}=d;if(a in P)u=P[a];else{const R=Fh(d);u=P[a]=T.call(null,r),R()}}else u=T}m[0]&&(y&&!l?u=!1:m[1]&&(u===""||u===uc(a))&&(u=!0))}return u}function dv(e,r,a=!1){const u=r.propsCache,d=u.get(e);if(d)return d;const y=e.props,m={},l=[];let T=!1;if(!Mi(e)){const R=D=>{T=!0;const[z,Z]=dv(D,r,!0);Vn(m,z),Z&&l.push(...Z)};!a&&r.mixins.length&&r.mixins.forEach(R),e.extends&&R(e.extends),e.mixins&&e.mixins.forEach(R)}if(!y&&!T)return $r(e)&&u.set(e,Qc),Qc;if(pi(y))for(let R=0;R<y.length;R++){const D=io(y[R]);Ky(D)&&(m[D]=zr)}else if(y)for(const R in y){const D=io(R);if(Ky(D)){const z=y[R],Z=m[D]=pi(z)||Mi(z)?{type:z}:Vn({},z);if(Z){const K=Qy(Boolean,Z.type),Y=Qy(String,Z.type);Z[0]=K>-1,Z[1]=Y<0||K<Y,(K>-1||qi(Z,"default"))&&l.push(D)}}}const P=[m,l];return $r(e)&&u.set(e,P),P}function Ky(e){return e[0]!=="$"&&!uh(e)}function Yy(e){return e===null?"null":typeof e=="function"?e.name||"":typeof e=="object"&&e.constructor&&e.constructor.name||""}function Jy(e,r){return Yy(e)===Yy(r)}function Qy(e,r){return pi(r)?r.findIndex(a=>Jy(a,e)):Mi(r)&&Jy(r,e)?0:-1}const fv=e=>e[0]==="_"||e==="$stable",Nm=e=>pi(e)?e.map(Ya):[Ya(e)],m2=(e,r,a)=>{if(r._n)return r;const u=To((...d)=>Nm(r(...d)),a);return u._c=!1,u},pv=(e,r,a)=>{const u=e._ctx;for(const d in e){if(fv(d))continue;const y=e[d];if(Mi(y))r[d]=m2(d,y,u);else if(y!=null){const m=Nm(y);r[d]=()=>m}}},mv=(e,r)=>{const a=Nm(r);e.slots.default=()=>a},g2=(e,r)=>{if(e.vnode.shapeFlag&32){const a=r._;a?(e.slots=Hi(r),Hd(r,"_",a)):pv(r,e.slots={})}else e.slots={},r&&mv(e,r);Hd(e.slots,Mf,1)},y2=(e,r,a)=>{const{vnode:u,slots:d}=e;let y=!0,m=zr;if(u.shapeFlag&32){const l=r._;l?a&&l===1?y=!1:(Vn(d,r),!a&&l===1&&delete d._):(y=!r.$stable,pv(r,d)),m=r}else r&&(mv(e,r),m={default:1});if(y)for(const l in d)!fv(l)&&m[l]==null&&delete d[l]};function rm(e,r,a,u,d=!1){if(pi(e)){e.forEach((z,Z)=>rm(z,r&&(pi(r)?r[Z]:r),a,u,d));return}if(hh(u)&&!d)return;const y=u.shapeFlag&4?Ef(u.component)||u.component.proxy:u.el,m=d?null:y,{i:l,r:T}=e,P=r&&r.r,R=l.refs===zr?l.refs={}:l.refs,D=l.setupState;if(P!=null&&P!==T&&(Tn(P)?(R[P]=null,qi(D,P)&&(D[P]=null)):Cn(P)&&(P.value=null)),Mi(T))vl(T,l,12,[m,R]);else{const z=Tn(T),Z=Cn(T);if(z||Z){const K=()=>{if(e.f){const Y=z?qi(D,T)?D[T]:R[T]:T.value;d?pi(Y)&&Em(Y,y):pi(Y)?Y.includes(y)||Y.push(y):z?(R[T]=[y],qi(D,T)&&(D[T]=R[T])):(T.value=[y],e.k&&(R[e.k]=T.value))}else z?(R[T]=m,qi(D,T)&&(D[T]=m)):Z&&(T.value=m,e.k&&(R[e.k]=m))};m?(K.id=-1,As(K,a)):K()}}}const As=jw;function _2(e){return v2(e)}function v2(e,r){const a=S0();a.__VUE__=!0;const{insert:u,remove:d,patchProp:y,createElement:m,createText:l,createComment:T,setText:P,setElementText:R,parentNode:D,nextSibling:z,setScopeId:Z=oa,insertStaticContent:K}=e,Y=(ne,ue,De,Oe=null,ce=null,ut=null,Ct=void 0,Be=null,it=!!ue.dynamicChildren)=>{if(ne===ue)return;ne&&!Ju(ne,ue)&&(Oe=Ve(ne),Si(ne,ce,ut,!0),ne=null),ue.patchFlag===-2&&(it=!1,ue.dynamicChildren=null);const{type:et,ref:At,shapeFlag:Gt}=ue;switch(et){case wf:me(ne,ue,De,Oe);break;case wl:Te(ne,ue,De,Oe);break;case Fd:ne==null&&Fe(ue,De,Oe,Ct);break;case Nr:ri(ne,ue,De,Oe,ce,ut,Ct,Be,it);break;default:Gt&1?Ze(ne,ue,De,Oe,ce,ut,Ct,Be,it):Gt&6?xi(ne,ue,De,Oe,ce,ut,Ct,Be,it):(Gt&64||Gt&128)&&et.process(ne,ue,De,Oe,ce,ut,Ct,Be,it,Ye)}At!=null&&ce&&rm(At,ne&&ne.ref,ut,ue||ne,!ue)},me=(ne,ue,De,Oe)=>{if(ne==null)u(ue.el=l(ue.children),De,Oe);else{const ce=ue.el=ne.el;ue.children!==ne.children&&P(ce,ue.children)}},Te=(ne,ue,De,Oe)=>{ne==null?u(ue.el=T(ue.children||""),De,Oe):ue.el=ne.el},Fe=(ne,ue,De,Oe)=>{[ne.el,ne.anchor]=K(ne.children,ue,De,Oe,ne.el,ne.anchor)},ae=({el:ne,anchor:ue},De,Oe)=>{let ce;for(;ne&&ne!==ue;)ce=z(ne),u(ne,De,Oe),ne=ce;u(ue,De,Oe)},Pe=({el:ne,anchor:ue})=>{let De;for(;ne&&ne!==ue;)De=z(ne),d(ne),ne=De;d(ue)},Ze=(ne,ue,De,Oe,ce,ut,Ct,Be,it)=>{ue.type==="svg"?Ct="svg":ue.type==="math"&&(Ct="mathml"),ne==null?Je(ue,De,Oe,ce,ut,Ct,Be,it):xt(ne,ue,ce,ut,Ct,Be,it)},Je=(ne,ue,De,Oe,ce,ut,Ct,Be)=>{let it,et;const{props:At,shapeFlag:Gt,transition:jt,dirs:Zt}=ne;if(it=ne.el=m(ne.type,ut,At&&At.is,At),Gt&8?R(it,ne.children):Gt&16&&_t(ne.children,it,null,Oe,ce,Pp(ne,ut),Ct,Be),Zt&&Ql(ne,null,Oe,"created"),dt(it,ne,ne.scopeId,Ct,Oe),At){for(const bi in At)bi!=="value"&&!uh(bi)&&y(it,bi,null,At[bi],ut,ne.children,Oe,ce,Ci);"value"in At&&y(it,"value",null,At.value,ut),(et=At.onVnodeBeforeMount)&&Wa(et,Oe,ne)}Zt&&Ql(ne,null,Oe,"beforeMount");const fi=x2(ce,jt);fi&&jt.beforeEnter(it),u(it,ue,De),((et=At&&At.onVnodeMounted)||fi||Zt)&&As(()=>{et&&Wa(et,Oe,ne),fi&&jt.enter(it),Zt&&Ql(ne,null,Oe,"mounted")},ce)},dt=(ne,ue,De,Oe,ce)=>{if(De&&Z(ne,De),Oe)for(let ut=0;ut<Oe.length;ut++)Z(ne,Oe[ut]);if(ce){let ut=ce.subTree;if(ue===ut){const Ct=ce.vnode;dt(ne,Ct,Ct.scopeId,Ct.slotScopeIds,ce.parent)}}},_t=(ne,ue,De,Oe,ce,ut,Ct,Be,it=0)=>{for(let et=it;et<ne.length;et++){const At=ne[et]=Be?pl(ne[et]):Ya(ne[et]);Y(null,At,ue,De,Oe,ce,ut,Ct,Be)}},xt=(ne,ue,De,Oe,ce,ut,Ct)=>{const Be=ue.el=ne.el;let{patchFlag:it,dynamicChildren:et,dirs:At}=ue;it|=ne.patchFlag&16;const Gt=ne.props||zr,jt=ue.props||zr;let Zt;if(De&&ec(De,!1),(Zt=jt.onVnodeBeforeUpdate)&&Wa(Zt,De,ue,ne),At&&Ql(ue,ne,De,"beforeUpdate"),De&&ec(De,!0),et?Vt(ne.dynamicChildren,et,Be,De,Oe,Pp(ue,ce),ut):Ct||rt(ne,ue,Be,null,De,Oe,Pp(ue,ce),ut,!1),it>0){if(it&16)kt(Be,ue,Gt,jt,De,Oe,ce);else if(it&2&&Gt.class!==jt.class&&y(Be,"class",null,jt.class,ce),it&4&&y(Be,"style",Gt.style,jt.style,ce),it&8){const fi=ue.dynamicProps;for(let bi=0;bi<fi.length;bi++){const Ue=fi[bi],Ri=Gt[Ue],Zi=jt[Ue];(Zi!==Ri||Ue==="value")&&y(Be,Ue,Ri,Zi,ce,ne.children,De,Oe,Ci)}}it&1&&ne.children!==ue.children&&R(Be,ue.children)}else!Ct&&et==null&&kt(Be,ue,Gt,jt,De,Oe,ce);((Zt=jt.onVnodeUpdated)||At)&&As(()=>{Zt&&Wa(Zt,De,ue,ne),At&&Ql(ue,ne,De,"updated")},Oe)},Vt=(ne,ue,De,Oe,ce,ut,Ct)=>{for(let Be=0;Be<ue.length;Be++){const it=ne[Be],et=ue[Be],At=it.el&&(it.type===Nr||!Ju(it,et)||it.shapeFlag&70)?D(it.el):De;Y(it,et,At,null,Oe,ce,ut,Ct,!0)}},kt=(ne,ue,De,Oe,ce,ut,Ct)=>{if(De!==Oe){if(De!==zr)for(const Be in De)!uh(Be)&&!(Be in Oe)&&y(ne,Be,De[Be],null,Ct,ue.children,ce,ut,Ci);for(const Be in Oe){if(uh(Be))continue;const it=Oe[Be],et=De[Be];it!==et&&Be!=="value"&&y(ne,Be,et,it,Ct,ue.children,ce,ut,Ci)}"value"in Oe&&y(ne,"value",De.value,Oe.value,Ct)}},ri=(ne,ue,De,Oe,ce,ut,Ct,Be,it)=>{const et=ue.el=ne?ne.el:l(""),At=ue.anchor=ne?ne.anchor:l("");let{patchFlag:Gt,dynamicChildren:jt,slotScopeIds:Zt}=ue;Zt&&(Be=Be?Be.concat(Zt):Zt),ne==null?(u(et,De,Oe),u(At,De,Oe),_t(ue.children||[],De,At,ce,ut,Ct,Be,it)):Gt>0&&Gt&64&&jt&&ne.dynamicChildren?(Vt(ne.dynamicChildren,jt,De,ce,ut,Ct,Be),(ue.key!=null||ce&&ue===ce.subTree)&&gv(ne,ue,!0)):rt(ne,ue,De,At,ce,ut,Ct,Be,it)},xi=(ne,ue,De,Oe,ce,ut,Ct,Be,it)=>{ue.slotScopeIds=Be,ne==null?ue.shapeFlag&512?ce.ctx.activate(ue,De,Oe,Ct,it):li(ue,De,Oe,ce,ut,Ct,it):xr(ne,ue,it)},li=(ne,ue,De,Oe,ce,ut,Ct)=>{const Be=ne.component=P2(ne,Oe,ce);if(nv(ne)&&(Be.ctx.renderer=Ye),D2(Be),Be.asyncDep){if(ce&&ce.registerDep(Be,si),!ne.el){const it=Be.subTree=or(wl);Te(null,it,ue,De)}}else si(Be,ne,ue,De,ce,ut,Ct)},xr=(ne,ue,De)=>{const Oe=ue.component=ne.component;if(Bw(ne,ue,De))if(Oe.asyncDep&&!Oe.asyncResolved){tt(Oe,ue,De);return}else Oe.next=ue,kw(Oe.update),Oe.effect.dirty=!0,Oe.update();else ue.el=ne.el,Oe.vnode=ue},si=(ne,ue,De,Oe,ce,ut,Ct)=>{const Be=()=>{if(ne.isMounted){let{next:At,bu:Gt,u:jt,parent:Zt,vnode:fi}=ne;{const pn=yv(ne);if(pn){At&&(At.el=fi.el,tt(ne,At,Ct)),pn.asyncDep.then(()=>{ne.isUnmounted||Be()});return}}let bi=At,Ue;ec(ne,!1),At?(At.el=fi.el,tt(ne,At,Ct)):At=fi,Gt&&Rd(Gt),(Ue=At.props&&At.props.onVnodeBeforeUpdate)&&Wa(Ue,Zt,At,fi),ec(ne,!0);const Ri=Ip(ne),Zi=ne.subTree;ne.subTree=Ri,Y(Zi,Ri,D(Zi.el),Ve(Zi),ne,ce,ut),At.el=Ri.el,bi===null&&Nw(ne,Ri.el),jt&&As(jt,ce),(Ue=At.props&&At.props.onVnodeUpdated)&&As(()=>Wa(Ue,Zt,At,fi),ce)}else{let At;const{el:Gt,props:jt}=ue,{bm:Zt,m:fi,parent:bi}=ne,Ue=hh(ue);if(ec(ne,!1),Zt&&Rd(Zt),!Ue&&(At=jt&&jt.onVnodeBeforeMount)&&Wa(At,bi,ue),ec(ne,!0),Gt&&ki){const Ri=()=>{ne.subTree=Ip(ne),ki(Gt,ne.subTree,ne,ce,null)};Ue?ue.type.__asyncLoader().then(()=>!ne.isUnmounted&&Ri()):Ri()}else{const Ri=ne.subTree=Ip(ne);Y(null,Ri,De,Oe,ne,ce,ut),ue.el=Ri.el}if(fi&&As(fi,ce),!Ue&&(At=jt&&jt.onVnodeMounted)){const Ri=ue;As(()=>Wa(At,bi,Ri),ce)}(ue.shapeFlag&256||bi&&hh(bi.vnode)&&bi.vnode.shapeFlag&256)&&ne.a&&As(ne.a,ce),ne.isMounted=!0,ue=De=Oe=null}},it=ne.effect=new Im(Be,oa,()=>Fm(et),ne.scope),et=ne.update=()=>{it.dirty&&it.run()};et.id=ne.uid,ec(ne,!0),et()},tt=(ne,ue,De)=>{ue.component=ne;const Oe=ne.vnode.props;ne.vnode=ue,ne.next=null,p2(ne,ue.props,Oe,De),y2(ne,ue.children,De),hc(),jy(ne),dc()},rt=(ne,ue,De,Oe,ce,ut,Ct,Be,it=!1)=>{const et=ne&&ne.children,At=ne?ne.shapeFlag:0,Gt=ue.children,{patchFlag:jt,shapeFlag:Zt}=ue;if(jt>0){if(jt&128){br(et,Gt,De,Oe,ce,ut,Ct,Be,it);return}else if(jt&256){It(et,Gt,De,Oe,ce,ut,Ct,Be,it);return}}Zt&8?(At&16&&Ci(et,ce,ut),Gt!==et&&R(De,Gt)):At&16?Zt&16?br(et,Gt,De,Oe,ce,ut,Ct,Be,it):Ci(et,ce,ut,!0):(At&8&&R(De,""),Zt&16&&_t(Gt,De,Oe,ce,ut,Ct,Be,it))},It=(ne,ue,De,Oe,ce,ut,Ct,Be,it)=>{ne=ne||Qc,ue=ue||Qc;const et=ne.length,At=ue.length,Gt=Math.min(et,At);let jt;for(jt=0;jt<Gt;jt++){const Zt=ue[jt]=it?pl(ue[jt]):Ya(ue[jt]);Y(ne[jt],Zt,De,null,ce,ut,Ct,Be,it)}et>At?Ci(ne,ce,ut,!0,!1,Gt):_t(ue,De,Oe,ce,ut,Ct,Be,it,Gt)},br=(ne,ue,De,Oe,ce,ut,Ct,Be,it)=>{let et=0;const At=ue.length;let Gt=ne.length-1,jt=At-1;for(;et<=Gt&&et<=jt;){const Zt=ne[et],fi=ue[et]=it?pl(ue[et]):Ya(ue[et]);if(Ju(Zt,fi))Y(Zt,fi,De,null,ce,ut,Ct,Be,it);else break;et++}for(;et<=Gt&&et<=jt;){const Zt=ne[Gt],fi=ue[jt]=it?pl(ue[jt]):Ya(ue[jt]);if(Ju(Zt,fi))Y(Zt,fi,De,null,ce,ut,Ct,Be,it);else break;Gt--,jt--}if(et>Gt){if(et<=jt){const Zt=jt+1,fi=Zt<At?ue[Zt].el:Oe;for(;et<=jt;)Y(null,ue[et]=it?pl(ue[et]):Ya(ue[et]),De,fi,ce,ut,Ct,Be,it),et++}}else if(et>jt)for(;et<=Gt;)Si(ne[et],ce,ut,!0),et++;else{const Zt=et,fi=et,bi=new Map;for(et=fi;et<=jt;et++){const Ot=ue[et]=it?pl(ue[et]):Ya(ue[et]);Ot.key!=null&&bi.set(Ot.key,et)}let Ue,Ri=0;const Zi=jt-fi+1;let pn=!1,wr=0;const nt=new Array(Zi);for(et=0;et<Zi;et++)nt[et]=0;for(et=Zt;et<=Gt;et++){const Ot=ne[et];if(Ri>=Zi){Si(Ot,ce,ut,!0);continue}let $i;if(Ot.key!=null)$i=bi.get(Ot.key);else for(Ue=fi;Ue<=jt;Ue++)if(nt[Ue-fi]===0&&Ju(Ot,ue[Ue])){$i=Ue;break}$i===void 0?Si(Ot,ce,ut,!0):(nt[$i-fi]=et+1,$i>=wr?wr=$i:pn=!0,Y(Ot,ue[$i],De,null,ce,ut,Ct,Be,it),Ri++)}const ai=pn?b2(nt):Qc;for(Ue=ai.length-1,et=Zi-1;et>=0;et--){const Ot=fi+et,$i=ue[Ot],mn=Ot+1<At?ue[Ot+1].el:Oe;nt[et]===0?Y(null,$i,De,mn,ce,ut,Ct,Be,it):pn&&(Ue<0||et!==ai[Ue]?Oi($i,De,mn,2):Ue--)}}},Oi=(ne,ue,De,Oe,ce=null)=>{const{el:ut,type:Ct,transition:Be,children:it,shapeFlag:et}=ne;if(et&6){Oi(ne.component.subTree,ue,De,Oe);return}if(et&128){ne.suspense.move(ue,De,Oe);return}if(et&64){Ct.move(ne,ue,De,Ye);return}if(Ct===Nr){u(ut,ue,De);for(let Gt=0;Gt<it.length;Gt++)Oi(it[Gt],ue,De,Oe);u(ne.anchor,ue,De);return}if(Ct===Fd){ae(ne,ue,De);return}if(Oe!==2&&et&1&&Be)if(Oe===0)Be.beforeEnter(ut),u(ut,ue,De),As(()=>Be.enter(ut),ce);else{const{leave:Gt,delayLeave:jt,afterLeave:Zt}=Be,fi=()=>u(ut,ue,De),bi=()=>{Gt(ut,()=>{fi(),Zt&&Zt()})};jt?jt(ut,fi,bi):bi()}else u(ut,ue,De)},Si=(ne,ue,De,Oe=!1,ce=!1)=>{const{type:ut,props:Ct,ref:Be,children:it,dynamicChildren:et,shapeFlag:At,patchFlag:Gt,dirs:jt}=ne;if(Be!=null&&rm(Be,null,De,ne,!0),At&256){ue.ctx.deactivate(ne);return}const Zt=At&1&&jt,fi=!hh(ne);let bi;if(fi&&(bi=Ct&&Ct.onVnodeBeforeUnmount)&&Wa(bi,ue,ne),At&6)lr(ne.component,De,Oe);else{if(At&128){ne.suspense.unmount(De,Oe);return}Zt&&Ql(ne,null,ue,"beforeUnmount"),At&64?ne.type.remove(ne,ue,De,ce,Ye,Oe):et&&(ut!==Nr||Gt>0&&Gt&64)?Ci(et,ue,De,!1,!0):(ut===Nr&&Gt&384||!ce&&At&16)&&Ci(it,ue,De),Oe&&Ni(ne)}(fi&&(bi=Ct&&Ct.onVnodeUnmounted)||Zt)&&As(()=>{bi&&Wa(bi,ue,ne),Zt&&Ql(ne,null,ue,"unmounted")},De)},Ni=ne=>{const{type:ue,el:De,anchor:Oe,transition:ce}=ne;if(ue===Nr){Hr(De,Oe);return}if(ue===Fd){Pe(ne);return}const ut=()=>{d(De),ce&&!ce.persisted&&ce.afterLeave&&ce.afterLeave()};if(ne.shapeFlag&1&&ce&&!ce.persisted){const{leave:Ct,delayLeave:Be}=ce,it=()=>Ct(De,ut);Be?Be(ne.el,ut,it):it()}else ut()},Hr=(ne,ue)=>{let De;for(;ne!==ue;)De=z(ne),d(ne),ne=De;d(ue)},lr=(ne,ue,De)=>{const{bum:Oe,scope:ce,update:ut,subTree:Ct,um:Be}=ne;Oe&&Rd(Oe),ce.stop(),ut&&(ut.active=!1,Si(Ct,ne,ue,De)),Be&&As(Be,ue),As(()=>{ne.isUnmounted=!0},ue),ue&&ue.pendingBranch&&!ue.isUnmounted&&ne.asyncDep&&!ne.asyncResolved&&ne.suspenseId===ue.pendingId&&(ue.deps--,ue.deps===0&&ue.resolve())},Ci=(ne,ue,De,Oe=!1,ce=!1,ut=0)=>{for(let Ct=ut;Ct<ne.length;Ct++)Si(ne[Ct],ue,De,Oe,ce)},Ve=ne=>ne.shapeFlag&6?Ve(ne.component.subTree):ne.shapeFlag&128?ne.suspense.next():z(ne.anchor||ne.el);let St=!1;const lt=(ne,ue,De)=>{ne==null?ue._vnode&&Si(ue._vnode,null,null,!0):Y(ue._vnode||null,ne,ue,null,null,null,De),St||(St=!0,jy(),K0(),St=!1),ue._vnode=ne},Ye={p:Y,um:Si,m:Oi,r:Ni,mt:li,mc:_t,pc:rt,pbc:Vt,n:Ve,o:e};let Ii,ki;return r&&([Ii,ki]=r(Ye)),{render:lt,hydrate:Ii,createApp:h2(lt,Ii)}}function Pp({type:e,props:r},a){return a==="svg"&&e==="foreignObject"||a==="mathml"&&e==="annotation-xml"&&r&&r.encoding&&r.encoding.includes("html")?void 0:a}function ec({effect:e,update:r},a){e.allowRecurse=r.allowRecurse=a}function x2(e,r){return(!e||e&&!e.pendingBranch)&&r&&!r.persisted}function gv(e,r,a=!1){const u=e.children,d=r.children;if(pi(u)&&pi(d))for(let y=0;y<u.length;y++){const m=u[y];let l=d[y];l.shapeFlag&1&&!l.dynamicChildren&&((l.patchFlag<=0||l.patchFlag===32)&&(l=d[y]=pl(d[y]),l.el=m.el),a||gv(m,l)),l.type===wf&&(l.el=m.el)}}function b2(e){const r=e.slice(),a=[0];let u,d,y,m,l;const T=e.length;for(u=0;u<T;u++){const P=e[u];if(P!==0){if(d=a[a.length-1],e[d]<P){r[u]=d,a.push(u);continue}for(y=0,m=a.length-1;y<m;)l=y+m>>1,e[a[l]]<P?y=l+1:m=l;P<e[a[y]]&&(y>0&&(r[u]=a[y-1]),a[y]=u)}}for(y=a.length,m=a[y-1];y-- >0;)a[y]=m,m=r[m];return a}function yv(e){const r=e.subTree.component;if(r)return r.asyncDep&&!r.asyncResolved?r:yv(r)}const w2=e=>e.__isTeleport,Nr=Symbol.for("v-fgt"),wf=Symbol.for("v-txt"),wl=Symbol.for("v-cmt"),Fd=Symbol.for("v-stc"),fh=[];let Ia=null;function Lt(e=!1){fh.push(Ia=e?null:[])}function M2(){fh.pop(),Ia=fh[fh.length-1]||null}let Eh=1;function e_(e){Eh+=e}function _v(e){return e.dynamicChildren=Eh>0?Ia||Qc:null,M2(),Eh>0&&Ia&&Ia.push(e),e}function Xt(e,r,a,u,d,y){return _v(se(e,r,a,u,d,y,!0))}function Ka(e,r,a,u,d){return _v(or(e,r,a,u,d,!0))}function Yd(e){return e?e.__v_isVNode===!0:!1}function Ju(e,r){return e.type===r.type&&e.key===r.key}const Mf="__vInternal",vv=({key:e})=>e??null,Bd=({ref:e,ref_key:r,ref_for:a})=>(typeof e=="number"&&(e=""+e),e!=null?Tn(e)||Cn(e)||Mi(e)?{i:En,r:e,k:r,f:!!a}:e:null);function se(e,r=null,a=null,u=0,d=null,y=e===Nr?0:1,m=!1,l=!1){const T={__v_isVNode:!0,__v_skip:!0,type:e,props:r,key:r&&vv(r),ref:r&&Bd(r),scopeId:_f,slotScopeIds:null,children:a,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:y,patchFlag:u,dynamicProps:d,dynamicChildren:null,appContext:null,ctx:En};return l?($m(T,a),y&128&&e.normalize(T)):a&&(T.shapeFlag|=Tn(a)?8:16),Eh>0&&!m&&Ia&&(T.patchFlag>0||y&6)&&T.patchFlag!==32&&Ia.push(T),T}const or=S2;function S2(e,r=null,a=null,u=0,d=null,y=!1){if((!e||e===$w)&&(e=wl),Yd(e)){const l=au(e,r,!0);return a&&$m(l,a),Eh>0&&!y&&Ia&&(l.shapeFlag&6?Ia[Ia.indexOf(e)]=l:Ia.push(l)),l.patchFlag|=-2,l}if(O2(e)&&(e=e.__vccOpts),r){r=E2(r);let{class:l,style:T}=r;l&&!Tn(l)&&(r.class=Co(l)),$r(T)&&(j0(T)&&!pi(T)&&(T=Vn({},T)),r.style=Cm(T))}const m=Tn(e)?1:Vw(e)?128:w2(e)?64:$r(e)?4:Mi(e)?2:0;return se(e,r,a,u,d,m,y,!0)}function E2(e){return e?j0(e)||Mf in e?Vn({},e):e:null}function au(e,r,a=!1){const{props:u,ref:d,patchFlag:y,children:m}=e,l=r?C2(u||{},r):u;return{__v_isVNode:!0,__v_skip:!0,type:e.type,props:l,key:l&&vv(l),ref:r&&r.ref?a&&d?pi(d)?d.concat(Bd(r)):[d,Bd(r)]:Bd(r):d,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:m,target:e.target,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:r&&e.type!==Nr?y===-1?16:y|16:y,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:e.transition,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&au(e.ssContent),ssFallback:e.ssFallback&&au(e.ssFallback),el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce}}function Jd(e=" ",r=0){return or(wf,null,e,r)}function T2(e,r){const a=or(Fd,null,e);return a.staticCount=r,a}function Ki(e="",r=!1){return r?(Lt(),Ka(wl,null,e)):or(wl,null,e)}function Ya(e){return e==null||typeof e=="boolean"?or(wl):pi(e)?or(Nr,null,e.slice()):typeof e=="object"?pl(e):or(wf,null,String(e))}function pl(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:au(e)}function $m(e,r){let a=0;const{shapeFlag:u}=e;if(r==null)r=null;else if(pi(r))a=16;else if(typeof r=="object")if(u&65){const d=r.default;d&&(d._c&&(d._d=!1),$m(e,d()),d._c&&(d._d=!0));return}else{a=32;const d=r._;!d&&!(Mf in r)?r._ctx=En:d===3&&En&&(En.slots._===1?r._=1:(r._=2,e.patchFlag|=1024))}else Mi(r)?(r={default:r,_ctx:En},a=32):(r=String(r),u&64?(a=16,r=[Jd(r)]):a=8);e.children=r,e.shapeFlag|=a}function C2(...e){const r={};for(let a=0;a<e.length;a++){const u=e[a];for(const d in u)if(d==="class")r.class!==u.class&&(r.class=Co([r.class,u.class]));else if(d==="style")r.style=Cm([r.style,u.style]);else if(uf(d)){const y=r[d],m=u[d];m&&y!==m&&!(pi(y)&&y.includes(m))&&(r[d]=y?[].concat(y,m):m)}else d!==""&&(r[d]=u[d])}return r}function Wa(e,r,a,u=null){Pa(e,r,7,[a,u])}const I2=uv();let A2=0;function P2(e,r,a){const u=e.type,d=(r?r.appContext:e.appContext)||I2,y={uid:A2++,vnode:e,type:u,parent:r,appContext:d,root:null,next:null,subTree:null,effect:null,update:null,scope:new C0(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:r?r.provides:Object.create(d.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:dv(u,d),emitsOptions:J0(u,d),emit:null,emitted:null,propsDefaults:zr,inheritAttrs:u.inheritAttrs,ctx:zr,data:zr,props:zr,attrs:zr,slots:zr,refs:zr,setupState:zr,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:a,suspenseId:a?a.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return y.ctx={_:y},y.root=r?r.root:y,y.emit=zw.bind(null,y),e.ce&&e.ce(y),y}let Un=null,Qd,nm;{const e=S0(),r=(a,u)=>{let d;return(d=e[a])||(d=e[a]=[]),d.push(u),y=>{d.length>1?d.forEach(m=>m(y)):d[0](y)}};Qd=r("__VUE_INSTANCE_SETTERS__",a=>Un=a),nm=r("__VUE_SSR_SETTERS__",a=>Sf=a)}const Fh=e=>{const r=Un;return Qd(e),e.scope.on(),()=>{e.scope.off(),Qd(r)}},t_=()=>{Un&&Un.scope.off(),Qd(null)};function xv(e){return e.vnode.shapeFlag&4}let Sf=!1;function D2(e,r=!1){r&&nm(r);const{props:a,children:u}=e.vnode,d=xv(e);f2(e,a,d,r),g2(e,u);const y=d?k2(e,r):void 0;return r&&nm(!1),y}function k2(e,r){const a=e.type;e.accessCache=Object.create(null),e.proxy=mf(new Proxy(e.ctx,n2));const{setup:u}=a;if(u){const d=e.setupContext=u.length>1?R2(e):null,y=Fh(e);hc();const m=vl(u,e,0,[e.props,d]);if(dc(),y(),b0(m)){if(m.then(t_,t_),r)return m.then(l=>{i_(e,l,r)}).catch(l=>{gf(l,e,0)});e.asyncDep=m}else i_(e,m,r)}else bv(e,r)}function i_(e,r,a){Mi(r)?e.type.__ssrInlineRender?e.ssrRender=r:e.render=r:$r(r)&&(e.setupState=Z0(r)),bv(e,a)}let r_;function bv(e,r,a){const u=e.type;if(!e.render){if(!r&&r_&&!u.render){const d=u.template||Bm(e).template;if(d){const{isCustomElement:y,compilerOptions:m}=e.appContext.config,{delimiters:l,compilerOptions:T}=u,P=Vn(Vn({isCustomElement:y,delimiters:l},m),T);u.render=r_(d,P)}}e.render=u.render||oa}{const d=Fh(e);hc();try{s2(e)}finally{dc(),d()}}}function L2(e){return e.attrsProxy||(e.attrsProxy=new Proxy(e.attrs,{get(r,a){return Ps(e,"get","$attrs"),r[a]}}))}function R2(e){const r=a=>{e.exposed=a||{}};return{get attrs(){return L2(e)},slots:e.slots,emit:e.emit,expose:r}}function Ef(e){if(e.exposed)return e.exposeProxy||(e.exposeProxy=new Proxy(Z0(mf(e.exposed)),{get(r,a){if(a in r)return r[a];if(a in dh)return dh[a](e)},has(r,a){return a in r||a in dh}}))}function z2(e,r=!0){return Mi(e)?e.displayName||e.name:e.name||r&&e.__name}function O2(e){return Mi(e)&&"__vccOpts"in e}const Gi=(e,r)=>Mw(e,r,Sf);function wv(e,r,a){const u=arguments.length;return u===2?$r(r)&&!pi(r)?Yd(r)?or(e,null,[r]):or(e,r):or(e,null,r):(u>3?a=Array.prototype.slice.call(arguments,2):u===3&&Yd(a)&&(a=[a]),or(e,r,a))}const F2="3.4.21";/**
* @vue/runtime-dom v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const B2="http://www.w3.org/2000/svg",N2="http://www.w3.org/1998/Math/MathML",ml=typeof document<"u"?document:null,n_=ml&&ml.createElement("template"),$2={insert:(e,r,a)=>{r.insertBefore(e,a||null)},remove:e=>{const r=e.parentNode;r&&r.removeChild(e)},createElement:(e,r,a,u)=>{const d=r==="svg"?ml.createElementNS(B2,e):r==="mathml"?ml.createElementNS(N2,e):ml.createElement(e,a?{is:a}:void 0);return e==="select"&&u&&u.multiple!=null&&d.setAttribute("multiple",u.multiple),d},createText:e=>ml.createTextNode(e),createComment:e=>ml.createComment(e),setText:(e,r)=>{e.nodeValue=r},setElementText:(e,r)=>{e.textContent=r},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>ml.querySelector(e),setScopeId(e,r){e.setAttribute(r,"")},insertStaticContent(e,r,a,u,d,y){const m=a?a.previousSibling:r.lastChild;if(d&&(d===y||d.nextSibling))for(;r.insertBefore(d.cloneNode(!0),a),!(d===y||!(d=d.nextSibling)););else{n_.innerHTML=u==="svg"?`<svg>${e}</svg>`:u==="mathml"?`<math>${e}</math>`:e;const l=n_.content;if(u==="svg"||u==="mathml"){const T=l.firstChild;for(;T.firstChild;)l.appendChild(T.firstChild);l.removeChild(T)}r.insertBefore(l,a)}return[m?m.nextSibling:r.firstChild,a?a.previousSibling:r.lastChild]}},U2=Symbol("_vtc");function V2(e,r,a){const u=e[U2];u&&(r=(r?[r,...u]:[...u]).join(" ")),r==null?e.removeAttribute("class"):a?e.setAttribute("class",r):e.className=r}const ef=Symbol("_vod"),Mv=Symbol("_vsh"),j2={beforeMount(e,{value:r},{transition:a}){e[ef]=e.style.display==="none"?"":e.style.display,a&&r?a.beforeEnter(e):Qu(e,r)},mounted(e,{value:r},{transition:a}){a&&r&&a.enter(e)},updated(e,{value:r,oldValue:a},{transition:u}){!r!=!a&&(u?r?(u.beforeEnter(e),Qu(e,!0),u.enter(e)):u.leave(e,()=>{Qu(e,!1)}):Qu(e,r))},beforeUnmount(e,{value:r}){Qu(e,r)}};function Qu(e,r){e.style.display=r?e[ef]:"none",e[Mv]=!r}const q2=Symbol(""),G2=/(^|;)\s*display\s*:/;function H2(e,r,a){const u=e.style,d=Tn(a);let y=!1;if(a&&!d){if(r)if(Tn(r))for(const m of r.split(";")){const l=m.slice(0,m.indexOf(":")).trim();a[l]==null&&Nd(u,l,"")}else for(const m in r)a[m]==null&&Nd(u,m,"");for(const m in a)m==="display"&&(y=!0),Nd(u,m,a[m])}else if(d){if(r!==a){const m=u[q2];m&&(a+=";"+m),u.cssText=a,y=G2.test(a)}}else r&&e.removeAttribute("style");ef in e&&(e[ef]=y?u.display:"",e[Mv]&&(u.display="none"))}const s_=/\s*!important$/;function Nd(e,r,a){if(pi(a))a.forEach(u=>Nd(e,r,u));else if(a==null&&(a=""),r.startsWith("--"))e.setProperty(r,a);else{const u=Z2(e,r);s_.test(a)?e.setProperty(uc(u),a.replace(s_,""),"important"):e[u]=a}}const a_=["Webkit","Moz","ms"],Dp={};function Z2(e,r){const a=Dp[r];if(a)return a;let u=io(r);if(u!=="filter"&&u in e)return Dp[r]=u;u=ff(u);for(let d=0;d<a_.length;d++){const y=a_[d]+u;if(y in e)return Dp[r]=y}return r}const o_="http://www.w3.org/1999/xlink";function W2(e,r,a,u,d){if(u&&r.startsWith("xlink:"))a==null?e.removeAttributeNS(o_,r.slice(6,r.length)):e.setAttributeNS(o_,r,a);else{const y=ew(r);a==null||y&&!E0(a)?e.removeAttribute(r):e.setAttribute(r,y?"":a)}}function X2(e,r,a,u,d,y,m){if(r==="innerHTML"||r==="textContent"){u&&m(u,d,y),e[r]=a??"";return}const l=e.tagName;if(r==="value"&&l!=="PROGRESS"&&!l.includes("-")){const P=l==="OPTION"?e.getAttribute("value")||"":e.value,R=a??"";(P!==R||!("_value"in e))&&(e.value=R),a==null&&e.removeAttribute(r),e._value=a;return}let T=!1;if(a===""||a==null){const P=typeof e[r];P==="boolean"?a=E0(a):a==null&&P==="string"?(a="",T=!0):P==="number"&&(a=0,T=!0)}try{e[r]=a}catch{}T&&e.removeAttribute(r)}function qc(e,r,a,u){e.addEventListener(r,a,u)}function K2(e,r,a,u){e.removeEventListener(r,a,u)}const l_=Symbol("_vei");function Y2(e,r,a,u,d=null){const y=e[l_]||(e[l_]={}),m=y[r];if(u&&m)m.value=u;else{const[l,T]=J2(r);if(u){const P=y[r]=tM(u,d);qc(e,l,P,T)}else m&&(K2(e,l,m,T),y[r]=void 0)}}const c_=/(?:Once|Passive|Capture)$/;function J2(e){let r;if(c_.test(e)){r={};let u;for(;u=e.match(c_);)e=e.slice(0,e.length-u[0].length),r[u[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):uc(e.slice(2)),r]}let kp=0;const Q2=Promise.resolve(),eM=()=>kp||(Q2.then(()=>kp=0),kp=Date.now());function tM(e,r){const a=u=>{if(!u._vts)u._vts=Date.now();else if(u._vts<=a.attached)return;Pa(iM(u,a.value),r,5,[u])};return a.value=e,a.attached=eM(),a}function iM(e,r){if(pi(r)){const a=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{a.call(e),e._stopped=!0},r.map(u=>d=>!d._stopped&&u&&u(d))}else return r}const u_=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&e.charCodeAt(2)>96&&e.charCodeAt(2)<123,rM=(e,r,a,u,d,y,m,l,T)=>{const P=d==="svg";r==="class"?V2(e,u,P):r==="style"?H2(e,a,u):uf(r)?Sm(r)||Y2(e,r,a,u,m):(r[0]==="."?(r=r.slice(1),!0):r[0]==="^"?(r=r.slice(1),!1):nM(e,r,u,P))?X2(e,r,u,y,m,l,T):(r==="true-value"?e._trueValue=u:r==="false-value"&&(e._falseValue=u),W2(e,r,u,P))};function nM(e,r,a,u){if(u)return!!(r==="innerHTML"||r==="textContent"||r in e&&u_(r)&&Mi(a));if(r==="spellcheck"||r==="draggable"||r==="translate"||r==="form"||r==="list"&&e.tagName==="INPUT"||r==="type"&&e.tagName==="TEXTAREA")return!1;if(r==="width"||r==="height"){const d=e.tagName;if(d==="IMG"||d==="VIDEO"||d==="CANVAS"||d==="SOURCE")return!1}return u_(r)&&Tn(a)?!1:r in e}const h_=e=>{const r=e.props["onUpdate:modelValue"]||!1;return pi(r)?a=>Rd(r,a):r};function sM(e){e.target.composing=!0}function d_(e){const r=e.target;r.composing&&(r.composing=!1,r.dispatchEvent(new Event("input")))}const Lp=Symbol("_assign"),aM={created(e,{modifiers:{lazy:r,trim:a,number:u}},d){e[Lp]=h_(d);const y=u||d.props&&d.props.type==="number";qc(e,r?"change":"input",m=>{if(m.target.composing)return;let l=e.value;a&&(l=l.trim()),y&&(l=Wp(l)),e[Lp](l)}),a&&qc(e,"change",()=>{e.value=e.value.trim()}),r||(qc(e,"compositionstart",sM),qc(e,"compositionend",d_),qc(e,"change",d_))},mounted(e,{value:r}){e.value=r??""},beforeUpdate(e,{value:r,modifiers:{lazy:a,trim:u,number:d}},y){if(e[Lp]=h_(y),e.composing)return;const m=d||e.type==="number"?Wp(e.value):e.value,l=r??"";m!==l&&(document.activeElement===e&&e.type!=="range"&&(a||u&&e.value.trim()===l)||(e.value=l))}},oM={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},lM=(e,r)=>{const a=e._withKeys||(e._withKeys={}),u=r.join(".");return a[u]||(a[u]=d=>{if(!("key"in d))return;const y=uc(d.key);if(r.some(m=>m===y||oM[m]===y))return e(d)})},cM=Vn({patchProp:rM},$2);let f_;function uM(){return f_||(f_=_2(cM))}const hM=(...e)=>{const r=uM().createApp(...e),{mount:a}=r;return r.mount=u=>{const d=fM(u);if(!d)return;const y=r._component;!Mi(y)&&!y.render&&!y.template&&(y.template=d.innerHTML),d.innerHTML="";const m=a(d,!1,dM(d));return d instanceof Element&&(d.removeAttribute("v-cloak"),d.setAttribute("data-v-app","")),m},r};function dM(e){if(e instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&e instanceof MathMLElement)return"mathml"}function fM(e){return Tn(e)?document.querySelector(e):e}var pM=!1;/*!
 * pinia v2.1.7
 * (c) 2023 Eduardo San Martin Morote
 * @license MIT
 */let Sv;const Tf=e=>Sv=e,Ev=Symbol();function sm(e){return e&&typeof e=="object"&&Object.prototype.toString.call(e)==="[object Object]"&&typeof e.toJSON!="function"}var ph;(function(e){e.direct="direct",e.patchObject="patch object",e.patchFunction="patch function"})(ph||(ph={}));function mM(){const e=I0(!0),r=e.run(()=>ms({}));let a=[],u=[];const d=mf({install(y){Tf(d),d._a=y,y.provide(Ev,d),y.config.globalProperties.$pinia=d,u.forEach(m=>a.push(m)),u=[]},use(y){return!this._a&&!pM?u.push(y):a.push(y),this},_p:a,_a:null,_e:e,_s:new Map,state:r});return d}const Tv=()=>{};function p_(e,r,a,u=Tv){e.push(r);const d=()=>{const y=e.indexOf(r);y>-1&&(e.splice(y,1),u())};return!a&&A0()&&iw(d),d}function Vc(e,...r){e.slice().forEach(a=>{a(...r)})}const gM=e=>e();function am(e,r){e instanceof Map&&r instanceof Map&&r.forEach((a,u)=>e.set(u,a)),e instanceof Set&&r instanceof Set&&r.forEach(e.add,e);for(const a in r){if(!r.hasOwnProperty(a))continue;const u=r[a],d=e[a];sm(d)&&sm(u)&&e.hasOwnProperty(a)&&!Cn(u)&&!_l(u)?e[a]=am(d,u):e[a]=u}return e}const yM=Symbol();function _M(e){return!sm(e)||!e.hasOwnProperty(yM)}const{assign:dl}=Object;function vM(e){return!!(Cn(e)&&e.effect)}function xM(e,r,a,u){const{state:d,actions:y,getters:m}=r,l=a.state.value[e];let T;function P(){l||(a.state.value[e]=d?d():{});const R=Cw(a.state.value[e]);return dl(R,y,Object.keys(m||{}).reduce((D,z)=>(D[z]=mf(Gi(()=>{Tf(a);const Z=a._s.get(e);return m[z].call(Z,Z)})),D),{}))}return T=Cv(e,P,r,a,u,!0),T}function Cv(e,r,a={},u,d,y){let m;const l=dl({actions:{}},a),T={deep:!0};let P,R,D=[],z=[],Z;const K=u.state.value[e];!y&&!K&&(u.state.value[e]={}),ms({});let Y;function me(_t){let xt;P=R=!1,typeof _t=="function"?(_t(u.state.value[e]),xt={type:ph.patchFunction,storeId:e,events:Z}):(am(u.state.value[e],_t),xt={type:ph.patchObject,payload:_t,storeId:e,events:Z});const Vt=Y=Symbol();Om().then(()=>{Y===Vt&&(P=!0)}),R=!0,Vc(D,xt,u.state.value[e])}const Te=y?function(){const{state:xt}=a,Vt=xt?xt():{};this.$patch(kt=>{dl(kt,Vt)})}:Tv;function Fe(){m.stop(),D=[],z=[],u._s.delete(e)}function ae(_t,xt){return function(){Tf(u);const Vt=Array.from(arguments),kt=[],ri=[];function xi(si){kt.push(si)}function li(si){ri.push(si)}Vc(z,{args:Vt,name:_t,store:Ze,after:xi,onError:li});let xr;try{xr=xt.apply(this&&this.$id===e?this:Ze,Vt)}catch(si){throw Vc(ri,si),si}return xr instanceof Promise?xr.then(si=>(Vc(kt,si),si)).catch(si=>(Vc(ri,si),Promise.reject(si))):(Vc(kt,xr),xr)}}const Pe={_p:u,$id:e,$onAction:p_.bind(null,z),$patch:me,$reset:Te,$subscribe(_t,xt={}){const Vt=p_(D,_t,xt.detached,()=>kt()),kt=m.run(()=>la(()=>u.state.value[e],ri=>{(xt.flush==="sync"?R:P)&&_t({storeId:e,type:ph.direct,events:Z},ri)},dl({},T,xt)));return Vt},$dispose:Fe},Ze=zh(Pe);u._s.set(e,Ze);const dt=(u._a&&u._a.runWithContext||gM)(()=>u._e.run(()=>(m=I0()).run(r)));for(const _t in dt){const xt=dt[_t];if(Cn(xt)&&!vM(xt)||_l(xt))y||(K&&_M(xt)&&(Cn(xt)?xt.value=K[_t]:am(xt,K[_t])),u.state.value[e][_t]=xt);else if(typeof xt=="function"){const Vt=ae(_t,xt);dt[_t]=Vt,l.actions[_t]=xt}}return dl(Ze,dt),dl(Hi(Ze),dt),Object.defineProperty(Ze,"$state",{get:()=>u.state.value[e],set:_t=>{me(xt=>{dl(xt,_t)})}}),u._p.forEach(_t=>{dl(Ze,m.run(()=>_t({store:Ze,app:u._a,pinia:u,options:l})))}),K&&y&&a.hydrate&&a.hydrate(Ze.$state,K),P=!0,R=!0,Ze}function Do(e,r,a){let u,d;const y=typeof r=="function";typeof e=="string"?(u=e,d=y?a:r):(d=e,u=e.id);function m(l,T){const P=d2();return l=l||(P?ca(Ev,null):null),l&&Tf(l),l=Sv,l._s.has(u)||(y?Cv(u,r,d,l):xM(u,d,l)),l._s.get(u)}return m.$id=u,m}const ha=Do("MainStore",{state:()=>({lastSearchMethod:"address",currentAddress:"",currentTopic:"Property",currentNearbyDataType:"nearby311",dataSourcesLoadedArray:[]}),actions:{setCurrentAddress(e){this.currentAddress=e},setLastSearchMethod(e){this.lastSearchMethod=e},setCurrentNearbyDataType(e){this.currentNearbyDataType=e},clearDataSourcesLoadedArray(){this.dataSourcesLoadedArray=[]},addToDataSourcesLoadedArray(e){this.dataSourcesLoadedArray.push(e)}}});/*!
  * vue-router v4.3.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const Gc=typeof document<"u";function bM(e){return e.__esModule||e[Symbol.toStringTag]==="Module"}const sr=Object.assign;function Rp(e,r){const a={};for(const u in r){const d=r[u];a[u]=ka(d)?d.map(e):e(d)}return a}const mh=()=>{},ka=Array.isArray,Iv=/#/g,wM=/&/g,MM=/\//g,SM=/=/g,EM=/\?/g,Av=/\+/g,TM=/%5B/g,CM=/%5D/g,Pv=/%5E/g,IM=/%60/g,Dv=/%7B/g,AM=/%7C/g,kv=/%7D/g,PM=/%20/g;function Um(e){return encodeURI(""+e).replace(AM,"|").replace(TM,"[").replace(CM,"]")}function DM(e){return Um(e).replace(Dv,"{").replace(kv,"}").replace(Pv,"^")}function om(e){return Um(e).replace(Av,"%2B").replace(PM,"+").replace(Iv,"%23").replace(wM,"%26").replace(IM,"`").replace(Dv,"{").replace(kv,"}").replace(Pv,"^")}function kM(e){return om(e).replace(SM,"%3D")}function LM(e){return Um(e).replace(Iv,"%23").replace(EM,"%3F")}function RM(e){return e==null?"":LM(e).replace(MM,"%2F")}function Th(e){try{return decodeURIComponent(""+e)}catch{}return""+e}const zM=/\/$/,OM=e=>e.replace(zM,"");function zp(e,r,a="/"){let u,d={},y="",m="";const l=r.indexOf("#");let T=r.indexOf("?");return l<T&&l>=0&&(T=-1),T>-1&&(u=r.slice(0,T),y=r.slice(T+1,l>-1?l:r.length),d=e(y)),l>-1&&(u=u||r.slice(0,l),m=r.slice(l,r.length)),u=$M(u??r,a),{fullPath:u+(y&&"?")+y+m,path:u,query:d,hash:Th(m)}}function FM(e,r){const a=r.query?e(r.query):"";return r.path+(a&&"?")+a+(r.hash||"")}function m_(e,r){return!r||!e.toLowerCase().startsWith(r.toLowerCase())?e:e.slice(r.length)||"/"}function BM(e,r,a){const u=r.matched.length-1,d=a.matched.length-1;return u>-1&&u===d&&ou(r.matched[u],a.matched[d])&&Lv(r.params,a.params)&&e(r.query)===e(a.query)&&r.hash===a.hash}function ou(e,r){return(e.aliasOf||e)===(r.aliasOf||r)}function Lv(e,r){if(Object.keys(e).length!==Object.keys(r).length)return!1;for(const a in e)if(!NM(e[a],r[a]))return!1;return!0}function NM(e,r){return ka(e)?g_(e,r):ka(r)?g_(r,e):e===r}function g_(e,r){return ka(r)?e.length===r.length&&e.every((a,u)=>a===r[u]):e.length===1&&e[0]===r}function $M(e,r){if(e.startsWith("/"))return e;if(!e)return r;const a=r.split("/"),u=e.split("/"),d=u[u.length-1];(d===".."||d===".")&&u.push("");let y=a.length-1,m,l;for(m=0;m<u.length;m++)if(l=u[m],l!==".")if(l==="..")y>1&&y--;else break;return a.slice(0,y).join("/")+"/"+u.slice(m).join("/")}var Ch;(function(e){e.pop="pop",e.push="push"})(Ch||(Ch={}));var gh;(function(e){e.back="back",e.forward="forward",e.unknown=""})(gh||(gh={}));function UM(e){if(!e)if(Gc){const r=document.querySelector("base");e=r&&r.getAttribute("href")||"/",e=e.replace(/^\w+:\/\/[^\/]+/,"")}else e="/";return e[0]!=="/"&&e[0]!=="#"&&(e="/"+e),OM(e)}const VM=/^[^#]+#/;function jM(e,r){return e.replace(VM,"#")+r}function qM(e,r){const a=document.documentElement.getBoundingClientRect(),u=e.getBoundingClientRect();return{behavior:r.behavior,left:u.left-a.left-(r.left||0),top:u.top-a.top-(r.top||0)}}const Cf=()=>({left:window.scrollX,top:window.scrollY});function GM(e){let r;if("el"in e){const a=e.el,u=typeof a=="string"&&a.startsWith("#"),d=typeof a=="string"?u?document.getElementById(a.slice(1)):document.querySelector(a):a;if(!d)return;r=qM(d,e)}else r=e;"scrollBehavior"in document.documentElement.style?window.scrollTo(r):window.scrollTo(r.left!=null?r.left:window.scrollX,r.top!=null?r.top:window.scrollY)}function y_(e,r){return(history.state?history.state.position-r:-1)+e}const lm=new Map;function HM(e,r){lm.set(e,r)}function ZM(e){const r=lm.get(e);return lm.delete(e),r}let WM=()=>location.protocol+"//"+location.host;function Rv(e,r){const{pathname:a,search:u,hash:d}=r,y=e.indexOf("#");if(y>-1){let l=d.includes(e.slice(y))?e.slice(y).length:1,T=d.slice(l);return T[0]!=="/"&&(T="/"+T),m_(T,"")}return m_(a,e)+u+d}function XM(e,r,a,u){let d=[],y=[],m=null;const l=({state:z})=>{const Z=Rv(e,location),K=a.value,Y=r.value;let me=0;if(z){if(a.value=Z,r.value=z,m&&m===K){m=null;return}me=Y?z.position-Y.position:0}else u(Z);d.forEach(Te=>{Te(a.value,K,{delta:me,type:Ch.pop,direction:me?me>0?gh.forward:gh.back:gh.unknown})})};function T(){m=a.value}function P(z){d.push(z);const Z=()=>{const K=d.indexOf(z);K>-1&&d.splice(K,1)};return y.push(Z),Z}function R(){const{history:z}=window;z.state&&z.replaceState(sr({},z.state,{scroll:Cf()}),"")}function D(){for(const z of y)z();y=[],window.removeEventListener("popstate",l),window.removeEventListener("beforeunload",R)}return window.addEventListener("popstate",l),window.addEventListener("beforeunload",R,{passive:!0}),{pauseListeners:T,listen:P,destroy:D}}function __(e,r,a,u=!1,d=!1){return{back:e,current:r,forward:a,replaced:u,position:window.history.length,scroll:d?Cf():null}}function KM(e){const{history:r,location:a}=window,u={value:Rv(e,a)},d={value:r.state};d.value||y(u.value,{back:null,current:u.value,forward:null,position:r.length-1,replaced:!0,scroll:null},!0);function y(T,P,R){const D=e.indexOf("#"),z=D>-1?(a.host&&document.querySelector("base")?e:e.slice(D))+T:WM()+e+T;try{r[R?"replaceState":"pushState"](P,"",z),d.value=P}catch(Z){console.error(Z),a[R?"replace":"assign"](z)}}function m(T,P){const R=sr({},r.state,__(d.value.back,T,d.value.forward,!0),P,{position:d.value.position});y(T,R,!0),u.value=T}function l(T,P){const R=sr({},d.value,r.state,{forward:T,scroll:Cf()});y(R.current,R,!0);const D=sr({},__(u.value,T,null),{position:R.position+1},P);y(T,D,!1),u.value=T}return{location:u,state:d,push:l,replace:m}}function YM(e){e=UM(e);const r=KM(e),a=XM(e,r.state,r.location,r.replace);function u(y,m=!0){m||a.pauseListeners(),history.go(y)}const d=sr({location:"",base:e,go:u,createHref:jM.bind(null,e)},r,a);return Object.defineProperty(d,"location",{enumerable:!0,get:()=>r.location.value}),Object.defineProperty(d,"state",{enumerable:!0,get:()=>r.state.value}),d}function JM(e){return e=location.host?e||location.pathname+location.search:"",e.includes("#")||(e+="#"),YM(e)}function QM(e){return typeof e=="string"||e&&typeof e=="object"}function zv(e){return typeof e=="string"||typeof e=="symbol"}const cl={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},Ov=Symbol("");var v_;(function(e){e[e.aborted=4]="aborted",e[e.cancelled=8]="cancelled",e[e.duplicated=16]="duplicated"})(v_||(v_={}));function lu(e,r){return sr(new Error,{type:e,[Ov]:!0},r)}function Eo(e,r){return e instanceof Error&&Ov in e&&(r==null||!!(e.type&r))}const x_="[^/]+?",eS={sensitive:!1,strict:!1,start:!0,end:!0},tS=/[.+*?^${}()[\]/\\]/g;function iS(e,r){const a=sr({},eS,r),u=[];let d=a.start?"^":"";const y=[];for(const P of e){const R=P.length?[]:[90];a.strict&&!P.length&&(d+="/");for(let D=0;D<P.length;D++){const z=P[D];let Z=40+(a.sensitive?.25:0);if(z.type===0)D||(d+="/"),d+=z.value.replace(tS,"\\$&"),Z+=40;else if(z.type===1){const{value:K,repeatable:Y,optional:me,regexp:Te}=z;y.push({name:K,repeatable:Y,optional:me});const Fe=Te||x_;if(Fe!==x_){Z+=10;try{new RegExp(`(${Fe})`)}catch(Pe){throw new Error(`Invalid custom RegExp for param "${K}" (${Fe}): `+Pe.message)}}let ae=Y?`((?:${Fe})(?:/(?:${Fe}))*)`:`(${Fe})`;D||(ae=me&&P.length<2?`(?:/${ae})`:"/"+ae),me&&(ae+="?"),d+=ae,Z+=20,me&&(Z+=-8),Y&&(Z+=-20),Fe===".*"&&(Z+=-50)}R.push(Z)}u.push(R)}if(a.strict&&a.end){const P=u.length-1;u[P][u[P].length-1]+=.7000000000000001}a.strict||(d+="/?"),a.end?d+="$":a.strict&&(d+="(?:/|$)");const m=new RegExp(d,a.sensitive?"":"i");function l(P){const R=P.match(m),D={};if(!R)return null;for(let z=1;z<R.length;z++){const Z=R[z]||"",K=y[z-1];D[K.name]=Z&&K.repeatable?Z.split("/"):Z}return D}function T(P){let R="",D=!1;for(const z of e){(!D||!R.endsWith("/"))&&(R+="/"),D=!1;for(const Z of z)if(Z.type===0)R+=Z.value;else if(Z.type===1){const{value:K,repeatable:Y,optional:me}=Z,Te=K in P?P[K]:"";if(ka(Te)&&!Y)throw new Error(`Provided param "${K}" is an array but it is not repeatable (* or + modifiers)`);const Fe=ka(Te)?Te.join("/"):Te;if(!Fe)if(me)z.length<2&&(R.endsWith("/")?R=R.slice(0,-1):D=!0);else throw new Error(`Missing required param "${K}"`);R+=Fe}}return R||"/"}return{re:m,score:u,keys:y,parse:l,stringify:T}}function rS(e,r){let a=0;for(;a<e.length&&a<r.length;){const u=r[a]-e[a];if(u)return u;a++}return e.length<r.length?e.length===1&&e[0]===80?-1:1:e.length>r.length?r.length===1&&r[0]===80?1:-1:0}function nS(e,r){let a=0;const u=e.score,d=r.score;for(;a<u.length&&a<d.length;){const y=rS(u[a],d[a]);if(y)return y;a++}if(Math.abs(d.length-u.length)===1){if(b_(u))return 1;if(b_(d))return-1}return d.length-u.length}function b_(e){const r=e[e.length-1];return e.length>0&&r[r.length-1]<0}const sS={type:0,value:""},aS=/[a-zA-Z0-9_]/;function oS(e){if(!e)return[[]];if(e==="/")return[[sS]];if(!e.startsWith("/"))throw new Error(`Invalid path "${e}"`);function r(Z){throw new Error(`ERR (${a})/"${P}": ${Z}`)}let a=0,u=a;const d=[];let y;function m(){y&&d.push(y),y=[]}let l=0,T,P="",R="";function D(){P&&(a===0?y.push({type:0,value:P}):a===1||a===2||a===3?(y.length>1&&(T==="*"||T==="+")&&r(`A repeatable param (${P}) must be alone in its segment. eg: '/:ids+.`),y.push({type:1,value:P,regexp:R,repeatable:T==="*"||T==="+",optional:T==="*"||T==="?"})):r("Invalid state to consume buffer"),P="")}function z(){P+=T}for(;l<e.length;){if(T=e[l++],T==="\\"&&a!==2){u=a,a=4;continue}switch(a){case 0:T==="/"?(P&&D(),m()):T===":"?(D(),a=1):z();break;case 4:z(),a=u;break;case 1:T==="("?a=2:aS.test(T)?z():(D(),a=0,T!=="*"&&T!=="?"&&T!=="+"&&l--);break;case 2:T===")"?R[R.length-1]=="\\"?R=R.slice(0,-1)+T:a=3:R+=T;break;case 3:D(),a=0,T!=="*"&&T!=="?"&&T!=="+"&&l--,R="";break;default:r("Unknown state");break}}return a===2&&r(`Unfinished custom RegExp for param "${P}"`),D(),m(),d}function lS(e,r,a){const u=iS(oS(e.path),a),d=sr(u,{record:e,parent:r,children:[],alias:[]});return r&&!d.record.aliasOf==!r.record.aliasOf&&r.children.push(d),d}function cS(e,r){const a=[],u=new Map;r=S_({strict:!1,end:!0,sensitive:!1},r);function d(R){return u.get(R)}function y(R,D,z){const Z=!z,K=uS(R);K.aliasOf=z&&z.record;const Y=S_(r,R),me=[K];if("alias"in R){const ae=typeof R.alias=="string"?[R.alias]:R.alias;for(const Pe of ae)me.push(sr({},K,{components:z?z.record.components:K.components,path:Pe,aliasOf:z?z.record:K}))}let Te,Fe;for(const ae of me){const{path:Pe}=ae;if(D&&Pe[0]!=="/"){const Ze=D.record.path,Je=Ze[Ze.length-1]==="/"?"":"/";ae.path=D.record.path+(Pe&&Je+Pe)}if(Te=lS(ae,D,Y),z?z.alias.push(Te):(Fe=Fe||Te,Fe!==Te&&Fe.alias.push(Te),Z&&R.name&&!M_(Te)&&m(R.name)),K.children){const Ze=K.children;for(let Je=0;Je<Ze.length;Je++)y(Ze[Je],Te,z&&z.children[Je])}z=z||Te,(Te.record.components&&Object.keys(Te.record.components).length||Te.record.name||Te.record.redirect)&&T(Te)}return Fe?()=>{m(Fe)}:mh}function m(R){if(zv(R)){const D=u.get(R);D&&(u.delete(R),a.splice(a.indexOf(D),1),D.children.forEach(m),D.alias.forEach(m))}else{const D=a.indexOf(R);D>-1&&(a.splice(D,1),R.record.name&&u.delete(R.record.name),R.children.forEach(m),R.alias.forEach(m))}}function l(){return a}function T(R){let D=0;for(;D<a.length&&nS(R,a[D])>=0&&(R.record.path!==a[D].record.path||!Fv(R,a[D]));)D++;a.splice(D,0,R),R.record.name&&!M_(R)&&u.set(R.record.name,R)}function P(R,D){let z,Z={},K,Y;if("name"in R&&R.name){if(z=u.get(R.name),!z)throw lu(1,{location:R});Y=z.record.name,Z=sr(w_(D.params,z.keys.filter(Fe=>!Fe.optional).concat(z.parent?z.parent.keys.filter(Fe=>Fe.optional):[]).map(Fe=>Fe.name)),R.params&&w_(R.params,z.keys.map(Fe=>Fe.name))),K=z.stringify(Z)}else if(R.path!=null)K=R.path,z=a.find(Fe=>Fe.re.test(K)),z&&(Z=z.parse(K),Y=z.record.name);else{if(z=D.name?u.get(D.name):a.find(Fe=>Fe.re.test(D.path)),!z)throw lu(1,{location:R,currentLocation:D});Y=z.record.name,Z=sr({},D.params,R.params),K=z.stringify(Z)}const me=[];let Te=z;for(;Te;)me.unshift(Te.record),Te=Te.parent;return{name:Y,path:K,params:Z,matched:me,meta:dS(me)}}return e.forEach(R=>y(R)),{addRoute:y,resolve:P,removeRoute:m,getRoutes:l,getRecordMatcher:d}}function w_(e,r){const a={};for(const u of r)u in e&&(a[u]=e[u]);return a}function uS(e){return{path:e.path,redirect:e.redirect,name:e.name,meta:e.meta||{},aliasOf:void 0,beforeEnter:e.beforeEnter,props:hS(e),children:e.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in e?e.components||null:e.component&&{default:e.component}}}function hS(e){const r={},a=e.props||!1;if("component"in e)r.default=a;else for(const u in e.components)r[u]=typeof a=="object"?a[u]:a;return r}function M_(e){for(;e;){if(e.record.aliasOf)return!0;e=e.parent}return!1}function dS(e){return e.reduce((r,a)=>sr(r,a.meta),{})}function S_(e,r){const a={};for(const u in e)a[u]=u in r?r[u]:e[u];return a}function Fv(e,r){return r.children.some(a=>a===e||Fv(e,a))}function fS(e){const r={};if(e===""||e==="?")return r;const u=(e[0]==="?"?e.slice(1):e).split("&");for(let d=0;d<u.length;++d){const y=u[d].replace(Av," "),m=y.indexOf("="),l=Th(m<0?y:y.slice(0,m)),T=m<0?null:Th(y.slice(m+1));if(l in r){let P=r[l];ka(P)||(P=r[l]=[P]),P.push(T)}else r[l]=T}return r}function E_(e){let r="";for(let a in e){const u=e[a];if(a=kM(a),u==null){u!==void 0&&(r+=(r.length?"&":"")+a);continue}(ka(u)?u.map(y=>y&&om(y)):[u&&om(u)]).forEach(y=>{y!==void 0&&(r+=(r.length?"&":"")+a,y!=null&&(r+="="+y))})}return r}function pS(e){const r={};for(const a in e){const u=e[a];u!==void 0&&(r[a]=ka(u)?u.map(d=>d==null?null:""+d):u==null?u:""+u)}return r}const mS=Symbol(""),T_=Symbol(""),If=Symbol(""),Vm=Symbol(""),cm=Symbol("");function eh(){let e=[];function r(u){return e.push(u),()=>{const d=e.indexOf(u);d>-1&&e.splice(d,1)}}function a(){e=[]}return{add:r,list:()=>e.slice(),reset:a}}function gl(e,r,a,u,d,y=m=>m()){const m=u&&(u.enterCallbacks[d]=u.enterCallbacks[d]||[]);return()=>new Promise((l,T)=>{const P=z=>{z===!1?T(lu(4,{from:a,to:r})):z instanceof Error?T(z):QM(z)?T(lu(2,{from:r,to:z})):(m&&u.enterCallbacks[d]===m&&typeof z=="function"&&m.push(z),l())},R=y(()=>e.call(u&&u.instances[d],r,a,P));let D=Promise.resolve(R);e.length<3&&(D=D.then(P)),D.catch(z=>T(z))})}function Op(e,r,a,u,d=y=>y()){const y=[];for(const m of e)for(const l in m.components){let T=m.components[l];if(!(r!=="beforeRouteEnter"&&!m.instances[l]))if(gS(T)){const R=(T.__vccOpts||T)[r];R&&y.push(gl(R,a,u,m,l,d))}else{let P=T();y.push(()=>P.then(R=>{if(!R)return Promise.reject(new Error(`Couldn't resolve component "${l}" at "${m.path}"`));const D=bM(R)?R.default:R;m.components[l]=D;const Z=(D.__vccOpts||D)[r];return Z&&gl(Z,a,u,m,l,d)()}))}}return y}function gS(e){return typeof e=="object"||"displayName"in e||"props"in e||"__vccOpts"in e}function C_(e){const r=ca(If),a=ca(Vm),u=Gi(()=>r.resolve(ar(e.to))),d=Gi(()=>{const{matched:T}=u.value,{length:P}=T,R=T[P-1],D=a.matched;if(!R||!D.length)return-1;const z=D.findIndex(ou.bind(null,R));if(z>-1)return z;const Z=I_(T[P-2]);return P>1&&I_(R)===Z&&D[D.length-1].path!==Z?D.findIndex(ou.bind(null,T[P-2])):z}),y=Gi(()=>d.value>-1&&vS(a.params,u.value.params)),m=Gi(()=>d.value>-1&&d.value===a.matched.length-1&&Lv(a.params,u.value.params));function l(T={}){return _S(T)?r[ar(e.replace)?"replace":"push"](ar(e.to)).catch(mh):Promise.resolve()}return{route:u,href:Gi(()=>u.value.href),isActive:y,isExactActive:m,navigate:l}}const yS=rv({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:C_,setup(e,{slots:r}){const a=zh(C_(e)),{options:u}=ca(If),d=Gi(()=>({[A_(e.activeClass,u.linkActiveClass,"router-link-active")]:a.isActive,[A_(e.exactActiveClass,u.linkExactActiveClass,"router-link-exact-active")]:a.isExactActive}));return()=>{const y=r.default&&r.default(a);return e.custom?y:wv("a",{"aria-current":a.isExactActive?e.ariaCurrentValue:null,href:a.href,onClick:a.navigate,class:d.value},y)}}}),Bv=yS;function _S(e){if(!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)&&!e.defaultPrevented&&!(e.button!==void 0&&e.button!==0)){if(e.currentTarget&&e.currentTarget.getAttribute){const r=e.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(r))return}return e.preventDefault&&e.preventDefault(),!0}}function vS(e,r){for(const a in r){const u=r[a],d=e[a];if(typeof u=="string"){if(u!==d)return!1}else if(!ka(d)||d.length!==u.length||u.some((y,m)=>y!==d[m]))return!1}return!0}function I_(e){return e?e.aliasOf?e.aliasOf.path:e.path:""}const A_=(e,r,a)=>e??r??a,xS=rv({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(e,{attrs:r,slots:a}){const u=ca(cm),d=Gi(()=>e.route||u.value),y=ca(T_,0),m=Gi(()=>{let P=ar(y);const{matched:R}=d.value;let D;for(;(D=R[P])&&!D.components;)P++;return P}),l=Gi(()=>d.value.matched[m.value]);Od(T_,Gi(()=>m.value+1)),Od(mS,l),Od(cm,d);const T=ms();return la(()=>[T.value,l.value,e.name],([P,R,D],[z,Z,K])=>{R&&(R.instances[D]=P,Z&&Z!==R&&P&&P===z&&(R.leaveGuards.size||(R.leaveGuards=Z.leaveGuards),R.updateGuards.size||(R.updateGuards=Z.updateGuards))),P&&R&&(!Z||!ou(R,Z)||!z)&&(R.enterCallbacks[D]||[]).forEach(Y=>Y(P))},{flush:"post"}),()=>{const P=d.value,R=e.name,D=l.value,z=D&&D.components[R];if(!z)return P_(a.default,{Component:z,route:P});const Z=D.props[R],K=Z?Z===!0?P.params:typeof Z=="function"?Z(P):Z:null,me=wv(z,sr({},K,r,{onVnodeUnmounted:Te=>{Te.component.isUnmounted&&(D.instances[R]=null)},ref:T}));return P_(a.default,{Component:me,route:P})||me}}});function P_(e,r){if(!e)return null;const a=e(r);return a.length===1?a[0]:a}const bS=xS;function wS(e){const r=cS(e.routes,e),a=e.parseQuery||fS,u=e.stringifyQuery||E_,d=e.history,y=eh(),m=eh(),l=eh(),T=Sw(cl);let P=cl;Gc&&e.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const R=Rp.bind(null,Ve=>""+Ve),D=Rp.bind(null,RM),z=Rp.bind(null,Th);function Z(Ve,St){let lt,Ye;return zv(Ve)?(lt=r.getRecordMatcher(Ve),Ye=St):Ye=Ve,r.addRoute(Ye,lt)}function K(Ve){const St=r.getRecordMatcher(Ve);St&&r.removeRoute(St)}function Y(){return r.getRoutes().map(Ve=>Ve.record)}function me(Ve){return!!r.getRecordMatcher(Ve)}function Te(Ve,St){if(St=sr({},St||T.value),typeof Ve=="string"){const ue=zp(a,Ve,St.path),De=r.resolve({path:ue.path},St),Oe=d.createHref(ue.fullPath);return sr(ue,De,{params:z(De.params),hash:Th(ue.hash),redirectedFrom:void 0,href:Oe})}let lt;if(Ve.path!=null)lt=sr({},Ve,{path:zp(a,Ve.path,St.path).path});else{const ue=sr({},Ve.params);for(const De in ue)ue[De]==null&&delete ue[De];lt=sr({},Ve,{params:D(ue)}),St.params=D(St.params)}const Ye=r.resolve(lt,St),Ii=Ve.hash||"";Ye.params=R(z(Ye.params));const ki=FM(u,sr({},Ve,{hash:DM(Ii),path:Ye.path})),ne=d.createHref(ki);return sr({fullPath:ki,hash:Ii,query:u===E_?pS(Ve.query):Ve.query||{}},Ye,{redirectedFrom:void 0,href:ne})}function Fe(Ve){return typeof Ve=="string"?zp(a,Ve,T.value.path):sr({},Ve)}function ae(Ve,St){if(P!==Ve)return lu(8,{from:St,to:Ve})}function Pe(Ve){return dt(Ve)}function Ze(Ve){return Pe(sr(Fe(Ve),{replace:!0}))}function Je(Ve){const St=Ve.matched[Ve.matched.length-1];if(St&&St.redirect){const{redirect:lt}=St;let Ye=typeof lt=="function"?lt(Ve):lt;return typeof Ye=="string"&&(Ye=Ye.includes("?")||Ye.includes("#")?Ye=Fe(Ye):{path:Ye},Ye.params={}),sr({query:Ve.query,hash:Ve.hash,params:Ye.path!=null?{}:Ve.params},Ye)}}function dt(Ve,St){const lt=P=Te(Ve),Ye=T.value,Ii=Ve.state,ki=Ve.force,ne=Ve.replace===!0,ue=Je(lt);if(ue)return dt(sr(Fe(ue),{state:typeof ue=="object"?sr({},Ii,ue.state):Ii,force:ki,replace:ne}),St||lt);const De=lt;De.redirectedFrom=St;let Oe;return!ki&&BM(u,Ye,lt)&&(Oe=lu(16,{to:De,from:Ye}),Oi(Ye,Ye,!0,!1)),(Oe?Promise.resolve(Oe):Vt(De,Ye)).catch(ce=>Eo(ce)?Eo(ce,2)?ce:br(ce):rt(ce,De,Ye)).then(ce=>{if(ce){if(Eo(ce,2))return dt(sr({replace:ne},Fe(ce.to),{state:typeof ce.to=="object"?sr({},Ii,ce.to.state):Ii,force:ki}),St||De)}else ce=ri(De,Ye,!0,ne,Ii);return kt(De,Ye,ce),ce})}function _t(Ve,St){const lt=ae(Ve,St);return lt?Promise.reject(lt):Promise.resolve()}function xt(Ve){const St=Hr.values().next().value;return St&&typeof St.runWithContext=="function"?St.runWithContext(Ve):Ve()}function Vt(Ve,St){let lt;const[Ye,Ii,ki]=MS(Ve,St);lt=Op(Ye.reverse(),"beforeRouteLeave",Ve,St);for(const ue of Ye)ue.leaveGuards.forEach(De=>{lt.push(gl(De,Ve,St))});const ne=_t.bind(null,Ve,St);return lt.push(ne),Ci(lt).then(()=>{lt=[];for(const ue of y.list())lt.push(gl(ue,Ve,St));return lt.push(ne),Ci(lt)}).then(()=>{lt=Op(Ii,"beforeRouteUpdate",Ve,St);for(const ue of Ii)ue.updateGuards.forEach(De=>{lt.push(gl(De,Ve,St))});return lt.push(ne),Ci(lt)}).then(()=>{lt=[];for(const ue of ki)if(ue.beforeEnter)if(ka(ue.beforeEnter))for(const De of ue.beforeEnter)lt.push(gl(De,Ve,St));else lt.push(gl(ue.beforeEnter,Ve,St));return lt.push(ne),Ci(lt)}).then(()=>(Ve.matched.forEach(ue=>ue.enterCallbacks={}),lt=Op(ki,"beforeRouteEnter",Ve,St,xt),lt.push(ne),Ci(lt))).then(()=>{lt=[];for(const ue of m.list())lt.push(gl(ue,Ve,St));return lt.push(ne),Ci(lt)}).catch(ue=>Eo(ue,8)?ue:Promise.reject(ue))}function kt(Ve,St,lt){l.list().forEach(Ye=>xt(()=>Ye(Ve,St,lt)))}function ri(Ve,St,lt,Ye,Ii){const ki=ae(Ve,St);if(ki)return ki;const ne=St===cl,ue=Gc?history.state:{};lt&&(Ye||ne?d.replace(Ve.fullPath,sr({scroll:ne&&ue&&ue.scroll},Ii)):d.push(Ve.fullPath,Ii)),T.value=Ve,Oi(Ve,St,lt,ne),br()}let xi;function li(){xi||(xi=d.listen((Ve,St,lt)=>{if(!lr.listening)return;const Ye=Te(Ve),Ii=Je(Ye);if(Ii){dt(sr(Ii,{replace:!0}),Ye).catch(mh);return}P=Ye;const ki=T.value;Gc&&HM(y_(ki.fullPath,lt.delta),Cf()),Vt(Ye,ki).catch(ne=>Eo(ne,12)?ne:Eo(ne,2)?(dt(ne.to,Ye).then(ue=>{Eo(ue,20)&&!lt.delta&&lt.type===Ch.pop&&d.go(-1,!1)}).catch(mh),Promise.reject()):(lt.delta&&d.go(-lt.delta,!1),rt(ne,Ye,ki))).then(ne=>{ne=ne||ri(Ye,ki,!1),ne&&(lt.delta&&!Eo(ne,8)?d.go(-lt.delta,!1):lt.type===Ch.pop&&Eo(ne,20)&&d.go(-1,!1)),kt(Ye,ki,ne)}).catch(mh)}))}let xr=eh(),si=eh(),tt;function rt(Ve,St,lt){br(Ve);const Ye=si.list();return Ye.length?Ye.forEach(Ii=>Ii(Ve,St,lt)):console.error(Ve),Promise.reject(Ve)}function It(){return tt&&T.value!==cl?Promise.resolve():new Promise((Ve,St)=>{xr.add([Ve,St])})}function br(Ve){return tt||(tt=!Ve,li(),xr.list().forEach(([St,lt])=>Ve?lt(Ve):St()),xr.reset()),Ve}function Oi(Ve,St,lt,Ye){const{scrollBehavior:Ii}=e;if(!Gc||!Ii)return Promise.resolve();const ki=!lt&&ZM(y_(Ve.fullPath,0))||(Ye||!lt)&&history.state&&history.state.scroll||null;return Om().then(()=>Ii(Ve,St,ki)).then(ne=>ne&&GM(ne)).catch(ne=>rt(ne,Ve,St))}const Si=Ve=>d.go(Ve);let Ni;const Hr=new Set,lr={currentRoute:T,listening:!0,addRoute:Z,removeRoute:K,hasRoute:me,getRoutes:Y,resolve:Te,options:e,push:Pe,replace:Ze,go:Si,back:()=>Si(-1),forward:()=>Si(1),beforeEach:y.add,beforeResolve:m.add,afterEach:l.add,onError:si.add,isReady:It,install(Ve){const St=this;Ve.component("RouterLink",Bv),Ve.component("RouterView",bS),Ve.config.globalProperties.$router=St,Object.defineProperty(Ve.config.globalProperties,"$route",{enumerable:!0,get:()=>ar(T)}),Gc&&!Ni&&T.value===cl&&(Ni=!0,Pe(d.location).catch(Ii=>{}));const lt={};for(const Ii in cl)Object.defineProperty(lt,Ii,{get:()=>T.value[Ii],enumerable:!0});Ve.provide(If,St),Ve.provide(Vm,U0(lt)),Ve.provide(cm,T);const Ye=Ve.unmount;Hr.add(Ve),Ve.unmount=function(){Hr.delete(Ve),Hr.size<1&&(P=cl,xi&&xi(),xi=null,T.value=cl,Ni=!1,tt=!1),Ye()}}};function Ci(Ve){return Ve.reduce((St,lt)=>St.then(()=>xt(lt)),Promise.resolve())}return lr}function MS(e,r){const a=[],u=[],d=[],y=Math.max(r.matched.length,e.matched.length);for(let m=0;m<y;m++){const l=r.matched[m];l&&(e.matched.find(P=>ou(P,l))?u.push(l):a.push(l));const T=e.matched[m];T&&(r.matched.find(P=>ou(P,T))||d.push(T))}return[a,u,d]}function Bh(){return ca(If)}function Nh(){return ca(Vm)}const Ln=Do("AddressStore",{state:()=>({addressData:{}}),actions:{async fillAddressData(e){try{console.log("Address - fillAddressData is running, address:",e);const r=await fetch(`https://api.phila.gov/ais/v1/search/${e}?include_units=false`);if(r.ok)console.log("Address - await resolved and HTTP status is successful"),this.addressData=await r.json();else{console.log("Address - await resolved but HTTP status was not successful"),this.addressData={};const a=ha();a.currentAddress=""}}catch{console.error("Address - await never resolved, failed to fetch address data")}}},getters:{getOpaOwners:e=>e.addressData.features[0].properties.opa_owners.join(", ")}});function Nv(e,r){return function(){return e.apply(r,arguments)}}const{toString:SS}=Object.prototype,{getPrototypeOf:jm}=Object,Af=(e=>r=>{const a=SS.call(r);return e[a]||(e[a]=a.slice(8,-1).toLowerCase())})(Object.create(null)),no=e=>(e=e.toLowerCase(),r=>Af(r)===e),Pf=e=>r=>typeof r===e,{isArray:pu}=Array,Ih=Pf("undefined");function ES(e){return e!==null&&!Ih(e)&&e.constructor!==null&&!Ih(e.constructor)&&ua(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const $v=no("ArrayBuffer");function TS(e){let r;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?r=ArrayBuffer.isView(e):r=e&&e.buffer&&$v(e.buffer),r}const CS=Pf("string"),ua=Pf("function"),Uv=Pf("number"),Df=e=>e!==null&&typeof e=="object",IS=e=>e===!0||e===!1,$d=e=>{if(Af(e)!=="object")return!1;const r=jm(e);return(r===null||r===Object.prototype||Object.getPrototypeOf(r)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},AS=no("Date"),PS=no("File"),DS=no("Blob"),kS=no("FileList"),LS=e=>Df(e)&&ua(e.pipe),RS=e=>{let r;return e&&(typeof FormData=="function"&&e instanceof FormData||ua(e.append)&&((r=Af(e))==="formdata"||r==="object"&&ua(e.toString)&&e.toString()==="[object FormData]"))},zS=no("URLSearchParams"),OS=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function $h(e,r,{allOwnKeys:a=!1}={}){if(e===null||typeof e>"u")return;let u,d;if(typeof e!="object"&&(e=[e]),pu(e))for(u=0,d=e.length;u<d;u++)r.call(null,e[u],u,e);else{const y=a?Object.getOwnPropertyNames(e):Object.keys(e),m=y.length;let l;for(u=0;u<m;u++)l=y[u],r.call(null,e[l],l,e)}}function Vv(e,r){r=r.toLowerCase();const a=Object.keys(e);let u=a.length,d;for(;u-- >0;)if(d=a[u],r===d.toLowerCase())return d;return null}const jv=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,qv=e=>!Ih(e)&&e!==jv;function um(){const{caseless:e}=qv(this)&&this||{},r={},a=(u,d)=>{const y=e&&Vv(r,d)||d;$d(r[y])&&$d(u)?r[y]=um(r[y],u):$d(u)?r[y]=um({},u):pu(u)?r[y]=u.slice():r[y]=u};for(let u=0,d=arguments.length;u<d;u++)arguments[u]&&$h(arguments[u],a);return r}const FS=(e,r,a,{allOwnKeys:u}={})=>($h(r,(d,y)=>{a&&ua(d)?e[y]=Nv(d,a):e[y]=d},{allOwnKeys:u}),e),BS=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),NS=(e,r,a,u)=>{e.prototype=Object.create(r.prototype,u),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:r.prototype}),a&&Object.assign(e.prototype,a)},$S=(e,r,a,u)=>{let d,y,m;const l={};if(r=r||{},e==null)return r;do{for(d=Object.getOwnPropertyNames(e),y=d.length;y-- >0;)m=d[y],(!u||u(m,e,r))&&!l[m]&&(r[m]=e[m],l[m]=!0);e=a!==!1&&jm(e)}while(e&&(!a||a(e,r))&&e!==Object.prototype);return r},US=(e,r,a)=>{e=String(e),(a===void 0||a>e.length)&&(a=e.length),a-=r.length;const u=e.indexOf(r,a);return u!==-1&&u===a},VS=e=>{if(!e)return null;if(pu(e))return e;let r=e.length;if(!Uv(r))return null;const a=new Array(r);for(;r-- >0;)a[r]=e[r];return a},jS=(e=>r=>e&&r instanceof e)(typeof Uint8Array<"u"&&jm(Uint8Array)),qS=(e,r)=>{const u=(e&&e[Symbol.iterator]).call(e);let d;for(;(d=u.next())&&!d.done;){const y=d.value;r.call(e,y[0],y[1])}},GS=(e,r)=>{let a;const u=[];for(;(a=e.exec(r))!==null;)u.push(a);return u},HS=no("HTMLFormElement"),ZS=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(a,u,d){return u.toUpperCase()+d}),D_=(({hasOwnProperty:e})=>(r,a)=>e.call(r,a))(Object.prototype),WS=no("RegExp"),Gv=(e,r)=>{const a=Object.getOwnPropertyDescriptors(e),u={};$h(a,(d,y)=>{let m;(m=r(d,y,e))!==!1&&(u[y]=m||d)}),Object.defineProperties(e,u)},XS=e=>{Gv(e,(r,a)=>{if(ua(e)&&["arguments","caller","callee"].indexOf(a)!==-1)return!1;const u=e[a];if(ua(u)){if(r.enumerable=!1,"writable"in r){r.writable=!1;return}r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+a+"'")})}})},KS=(e,r)=>{const a={},u=d=>{d.forEach(y=>{a[y]=!0})};return pu(e)?u(e):u(String(e).split(r)),a},YS=()=>{},JS=(e,r)=>(e=+e,Number.isFinite(e)?e:r),Fp="abcdefghijklmnopqrstuvwxyz",k_="0123456789",Hv={DIGIT:k_,ALPHA:Fp,ALPHA_DIGIT:Fp+Fp.toUpperCase()+k_},QS=(e=16,r=Hv.ALPHA_DIGIT)=>{let a="";const{length:u}=r;for(;e--;)a+=r[Math.random()*u|0];return a};function eE(e){return!!(e&&ua(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])}const tE=e=>{const r=new Array(10),a=(u,d)=>{if(Df(u)){if(r.indexOf(u)>=0)return;if(!("toJSON"in u)){r[d]=u;const y=pu(u)?[]:{};return $h(u,(m,l)=>{const T=a(m,d+1);!Ih(T)&&(y[l]=T)}),r[d]=void 0,y}}return u};return a(e,0)},iE=no("AsyncFunction"),rE=e=>e&&(Df(e)||ua(e))&&ua(e.then)&&ua(e.catch),Xe={isArray:pu,isArrayBuffer:$v,isBuffer:ES,isFormData:RS,isArrayBufferView:TS,isString:CS,isNumber:Uv,isBoolean:IS,isObject:Df,isPlainObject:$d,isUndefined:Ih,isDate:AS,isFile:PS,isBlob:DS,isRegExp:WS,isFunction:ua,isStream:LS,isURLSearchParams:zS,isTypedArray:jS,isFileList:kS,forEach:$h,merge:um,extend:FS,trim:OS,stripBOM:BS,inherits:NS,toFlatObject:$S,kindOf:Af,kindOfTest:no,endsWith:US,toArray:VS,forEachEntry:qS,matchAll:GS,isHTMLForm:HS,hasOwnProperty:D_,hasOwnProp:D_,reduceDescriptors:Gv,freezeMethods:XS,toObjectSet:KS,toCamelCase:ZS,noop:YS,toFiniteNumber:JS,findKey:Vv,global:jv,isContextDefined:qv,ALPHABET:Hv,generateString:QS,isSpecCompliantForm:eE,toJSONObject:tE,isAsyncFn:iE,isThenable:rE};function Vi(e,r,a,u,d){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",r&&(this.code=r),a&&(this.config=a),u&&(this.request=u),d&&(this.response=d)}Xe.inherits(Vi,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Xe.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const Zv=Vi.prototype,Wv={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{Wv[e]={value:e}});Object.defineProperties(Vi,Wv);Object.defineProperty(Zv,"isAxiosError",{value:!0});Vi.from=(e,r,a,u,d,y)=>{const m=Object.create(Zv);return Xe.toFlatObject(e,m,function(T){return T!==Error.prototype},l=>l!=="isAxiosError"),Vi.call(m,e.message,r,a,u,d),m.cause=e,m.name=e.name,y&&Object.assign(m,y),m};const nE=null;function hm(e){return Xe.isPlainObject(e)||Xe.isArray(e)}function Xv(e){return Xe.endsWith(e,"[]")?e.slice(0,-2):e}function L_(e,r,a){return e?e.concat(r).map(function(d,y){return d=Xv(d),!a&&y?"["+d+"]":d}).join(a?".":""):r}function sE(e){return Xe.isArray(e)&&!e.some(hm)}const aE=Xe.toFlatObject(Xe,{},null,function(r){return/^is[A-Z]/.test(r)});function kf(e,r,a){if(!Xe.isObject(e))throw new TypeError("target must be an object");r=r||new FormData,a=Xe.toFlatObject(a,{metaTokens:!0,dots:!1,indexes:!1},!1,function(Y,me){return!Xe.isUndefined(me[Y])});const u=a.metaTokens,d=a.visitor||R,y=a.dots,m=a.indexes,T=(a.Blob||typeof Blob<"u"&&Blob)&&Xe.isSpecCompliantForm(r);if(!Xe.isFunction(d))throw new TypeError("visitor must be a function");function P(K){if(K===null)return"";if(Xe.isDate(K))return K.toISOString();if(!T&&Xe.isBlob(K))throw new Vi("Blob is not supported. Use a Buffer instead.");return Xe.isArrayBuffer(K)||Xe.isTypedArray(K)?T&&typeof Blob=="function"?new Blob([K]):Buffer.from(K):K}function R(K,Y,me){let Te=K;if(K&&!me&&typeof K=="object"){if(Xe.endsWith(Y,"{}"))Y=u?Y:Y.slice(0,-2),K=JSON.stringify(K);else if(Xe.isArray(K)&&sE(K)||(Xe.isFileList(K)||Xe.endsWith(Y,"[]"))&&(Te=Xe.toArray(K)))return Y=Xv(Y),Te.forEach(function(ae,Pe){!(Xe.isUndefined(ae)||ae===null)&&r.append(m===!0?L_([Y],Pe,y):m===null?Y:Y+"[]",P(ae))}),!1}return hm(K)?!0:(r.append(L_(me,Y,y),P(K)),!1)}const D=[],z=Object.assign(aE,{defaultVisitor:R,convertValue:P,isVisitable:hm});function Z(K,Y){if(!Xe.isUndefined(K)){if(D.indexOf(K)!==-1)throw Error("Circular reference detected in "+Y.join("."));D.push(K),Xe.forEach(K,function(Te,Fe){(!(Xe.isUndefined(Te)||Te===null)&&d.call(r,Te,Xe.isString(Fe)?Fe.trim():Fe,Y,z))===!0&&Z(Te,Y?Y.concat(Fe):[Fe])}),D.pop()}}if(!Xe.isObject(e))throw new TypeError("data must be an object");return Z(e),r}function R_(e){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(u){return r[u]})}function qm(e,r){this._pairs=[],e&&kf(e,this,r)}const Kv=qm.prototype;Kv.append=function(r,a){this._pairs.push([r,a])};Kv.toString=function(r){const a=r?function(u){return r.call(this,u,R_)}:R_;return this._pairs.map(function(d){return a(d[0])+"="+a(d[1])},"").join("&")};function oE(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Yv(e,r,a){if(!r)return e;const u=a&&a.encode||oE,d=a&&a.serialize;let y;if(d?y=d(r,a):y=Xe.isURLSearchParams(r)?r.toString():new qm(r,a).toString(u),y){const m=e.indexOf("#");m!==-1&&(e=e.slice(0,m)),e+=(e.indexOf("?")===-1?"?":"&")+y}return e}class z_{constructor(){this.handlers=[]}use(r,a,u){return this.handlers.push({fulfilled:r,rejected:a,synchronous:u?u.synchronous:!1,runWhen:u?u.runWhen:null}),this.handlers.length-1}eject(r){this.handlers[r]&&(this.handlers[r]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(r){Xe.forEach(this.handlers,function(u){u!==null&&r(u)})}}const Jv={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},lE=typeof URLSearchParams<"u"?URLSearchParams:qm,cE=typeof FormData<"u"?FormData:null,uE=typeof Blob<"u"?Blob:null,hE={isBrowser:!0,classes:{URLSearchParams:lE,FormData:cE,Blob:uE},protocols:["http","https","file","blob","url","data"]},Qv=typeof window<"u"&&typeof document<"u",dE=(e=>Qv&&["ReactNative","NativeScript","NS"].indexOf(e)<0)(typeof navigator<"u"&&navigator.product),fE=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",pE=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Qv,hasStandardBrowserEnv:dE,hasStandardBrowserWebWorkerEnv:fE},Symbol.toStringTag,{value:"Module"})),Qa={...pE,...hE};function mE(e,r){return kf(e,new Qa.classes.URLSearchParams,Object.assign({visitor:function(a,u,d,y){return Qa.isNode&&Xe.isBuffer(a)?(this.append(u,a.toString("base64")),!1):y.defaultVisitor.apply(this,arguments)}},r))}function gE(e){return Xe.matchAll(/\w+|\[(\w*)]/g,e).map(r=>r[0]==="[]"?"":r[1]||r[0])}function yE(e){const r={},a=Object.keys(e);let u;const d=a.length;let y;for(u=0;u<d;u++)y=a[u],r[y]=e[y];return r}function ex(e){function r(a,u,d,y){let m=a[y++];if(m==="__proto__")return!0;const l=Number.isFinite(+m),T=y>=a.length;return m=!m&&Xe.isArray(d)?d.length:m,T?(Xe.hasOwnProp(d,m)?d[m]=[d[m],u]:d[m]=u,!l):((!d[m]||!Xe.isObject(d[m]))&&(d[m]=[]),r(a,u,d[m],y)&&Xe.isArray(d[m])&&(d[m]=yE(d[m])),!l)}if(Xe.isFormData(e)&&Xe.isFunction(e.entries)){const a={};return Xe.forEachEntry(e,(u,d)=>{r(gE(u),d,a,0)}),a}return null}function _E(e,r,a){if(Xe.isString(e))try{return(r||JSON.parse)(e),Xe.trim(e)}catch(u){if(u.name!=="SyntaxError")throw u}return(a||JSON.stringify)(e)}const Gm={transitional:Jv,adapter:["xhr","http"],transformRequest:[function(r,a){const u=a.getContentType()||"",d=u.indexOf("application/json")>-1,y=Xe.isObject(r);if(y&&Xe.isHTMLForm(r)&&(r=new FormData(r)),Xe.isFormData(r))return d?JSON.stringify(ex(r)):r;if(Xe.isArrayBuffer(r)||Xe.isBuffer(r)||Xe.isStream(r)||Xe.isFile(r)||Xe.isBlob(r))return r;if(Xe.isArrayBufferView(r))return r.buffer;if(Xe.isURLSearchParams(r))return a.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),r.toString();let l;if(y){if(u.indexOf("application/x-www-form-urlencoded")>-1)return mE(r,this.formSerializer).toString();if((l=Xe.isFileList(r))||u.indexOf("multipart/form-data")>-1){const T=this.env&&this.env.FormData;return kf(l?{"files[]":r}:r,T&&new T,this.formSerializer)}}return y||d?(a.setContentType("application/json",!1),_E(r)):r}],transformResponse:[function(r){const a=this.transitional||Gm.transitional,u=a&&a.forcedJSONParsing,d=this.responseType==="json";if(r&&Xe.isString(r)&&(u&&!this.responseType||d)){const m=!(a&&a.silentJSONParsing)&&d;try{return JSON.parse(r)}catch(l){if(m)throw l.name==="SyntaxError"?Vi.from(l,Vi.ERR_BAD_RESPONSE,this,null,this.response):l}}return r}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Qa.classes.FormData,Blob:Qa.classes.Blob},validateStatus:function(r){return r>=200&&r<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Xe.forEach(["delete","get","head","post","put","patch"],e=>{Gm.headers[e]={}});const Hm=Gm,vE=Xe.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),xE=e=>{const r={};let a,u,d;return e&&e.split(`
`).forEach(function(m){d=m.indexOf(":"),a=m.substring(0,d).trim().toLowerCase(),u=m.substring(d+1).trim(),!(!a||r[a]&&vE[a])&&(a==="set-cookie"?r[a]?r[a].push(u):r[a]=[u]:r[a]=r[a]?r[a]+", "+u:u)}),r},O_=Symbol("internals");function th(e){return e&&String(e).trim().toLowerCase()}function Ud(e){return e===!1||e==null?e:Xe.isArray(e)?e.map(Ud):String(e)}function bE(e){const r=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let u;for(;u=a.exec(e);)r[u[1]]=u[2];return r}const wE=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function Bp(e,r,a,u,d){if(Xe.isFunction(u))return u.call(this,r,a);if(d&&(r=a),!!Xe.isString(r)){if(Xe.isString(u))return r.indexOf(u)!==-1;if(Xe.isRegExp(u))return u.test(r)}}function ME(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(r,a,u)=>a.toUpperCase()+u)}function SE(e,r){const a=Xe.toCamelCase(" "+r);["get","set","has"].forEach(u=>{Object.defineProperty(e,u+a,{value:function(d,y,m){return this[u].call(this,r,d,y,m)},configurable:!0})})}class Lf{constructor(r){r&&this.set(r)}set(r,a,u){const d=this;function y(l,T,P){const R=th(T);if(!R)throw new Error("header name must be a non-empty string");const D=Xe.findKey(d,R);(!D||d[D]===void 0||P===!0||P===void 0&&d[D]!==!1)&&(d[D||T]=Ud(l))}const m=(l,T)=>Xe.forEach(l,(P,R)=>y(P,R,T));return Xe.isPlainObject(r)||r instanceof this.constructor?m(r,a):Xe.isString(r)&&(r=r.trim())&&!wE(r)?m(xE(r),a):r!=null&&y(a,r,u),this}get(r,a){if(r=th(r),r){const u=Xe.findKey(this,r);if(u){const d=this[u];if(!a)return d;if(a===!0)return bE(d);if(Xe.isFunction(a))return a.call(this,d,u);if(Xe.isRegExp(a))return a.exec(d);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,a){if(r=th(r),r){const u=Xe.findKey(this,r);return!!(u&&this[u]!==void 0&&(!a||Bp(this,this[u],u,a)))}return!1}delete(r,a){const u=this;let d=!1;function y(m){if(m=th(m),m){const l=Xe.findKey(u,m);l&&(!a||Bp(u,u[l],l,a))&&(delete u[l],d=!0)}}return Xe.isArray(r)?r.forEach(y):y(r),d}clear(r){const a=Object.keys(this);let u=a.length,d=!1;for(;u--;){const y=a[u];(!r||Bp(this,this[y],y,r,!0))&&(delete this[y],d=!0)}return d}normalize(r){const a=this,u={};return Xe.forEach(this,(d,y)=>{const m=Xe.findKey(u,y);if(m){a[m]=Ud(d),delete a[y];return}const l=r?ME(y):String(y).trim();l!==y&&delete a[y],a[l]=Ud(d),u[l]=!0}),this}concat(...r){return this.constructor.concat(this,...r)}toJSON(r){const a=Object.create(null);return Xe.forEach(this,(u,d)=>{u!=null&&u!==!1&&(a[d]=r&&Xe.isArray(u)?u.join(", "):u)}),a}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([r,a])=>r+": "+a).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r,...a){const u=new this(r);return a.forEach(d=>u.set(d)),u}static accessor(r){const u=(this[O_]=this[O_]={accessors:{}}).accessors,d=this.prototype;function y(m){const l=th(m);u[l]||(SE(d,m),u[l]=!0)}return Xe.isArray(r)?r.forEach(y):y(r),this}}Lf.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Xe.reduceDescriptors(Lf.prototype,({value:e},r)=>{let a=r[0].toUpperCase()+r.slice(1);return{get:()=>e,set(u){this[a]=u}}});Xe.freezeMethods(Lf);const Ao=Lf;function Np(e,r){const a=this||Hm,u=r||a,d=Ao.from(u.headers);let y=u.data;return Xe.forEach(e,function(l){y=l.call(a,y,d.normalize(),r?r.status:void 0)}),d.normalize(),y}function tx(e){return!!(e&&e.__CANCEL__)}function Uh(e,r,a){Vi.call(this,e??"canceled",Vi.ERR_CANCELED,r,a),this.name="CanceledError"}Xe.inherits(Uh,Vi,{__CANCEL__:!0});function EE(e,r,a){const u=a.config.validateStatus;!a.status||!u||u(a.status)?e(a):r(new Vi("Request failed with status code "+a.status,[Vi.ERR_BAD_REQUEST,Vi.ERR_BAD_RESPONSE][Math.floor(a.status/100)-4],a.config,a.request,a))}const TE=Qa.hasStandardBrowserEnv?{write(e,r,a,u,d,y){const m=[e+"="+encodeURIComponent(r)];Xe.isNumber(a)&&m.push("expires="+new Date(a).toGMTString()),Xe.isString(u)&&m.push("path="+u),Xe.isString(d)&&m.push("domain="+d),y===!0&&m.push("secure"),document.cookie=m.join("; ")},read(e){const r=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function CE(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function IE(e,r){return r?e.replace(/\/?\/$/,"")+"/"+r.replace(/^\/+/,""):e}function ix(e,r){return e&&!CE(r)?IE(e,r):r}const AE=Qa.hasStandardBrowserEnv?function(){const r=/(msie|trident)/i.test(navigator.userAgent),a=document.createElement("a");let u;function d(y){let m=y;return r&&(a.setAttribute("href",m),m=a.href),a.setAttribute("href",m),{href:a.href,protocol:a.protocol?a.protocol.replace(/:$/,""):"",host:a.host,search:a.search?a.search.replace(/^\?/,""):"",hash:a.hash?a.hash.replace(/^#/,""):"",hostname:a.hostname,port:a.port,pathname:a.pathname.charAt(0)==="/"?a.pathname:"/"+a.pathname}}return u=d(window.location.href),function(m){const l=Xe.isString(m)?d(m):m;return l.protocol===u.protocol&&l.host===u.host}}():function(){return function(){return!0}}();function PE(e){const r=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return r&&r[1]||""}function DE(e,r){e=e||10;const a=new Array(e),u=new Array(e);let d=0,y=0,m;return r=r!==void 0?r:1e3,function(T){const P=Date.now(),R=u[y];m||(m=P),a[d]=T,u[d]=P;let D=y,z=0;for(;D!==d;)z+=a[D++],D=D%e;if(d=(d+1)%e,d===y&&(y=(y+1)%e),P-m<r)return;const Z=R&&P-R;return Z?Math.round(z*1e3/Z):void 0}}function F_(e,r){let a=0;const u=DE(50,250);return d=>{const y=d.loaded,m=d.lengthComputable?d.total:void 0,l=y-a,T=u(l),P=y<=m;a=y;const R={loaded:y,total:m,progress:m?y/m:void 0,bytes:l,rate:T||void 0,estimated:T&&m&&P?(m-y)/T:void 0,event:d};R[r?"download":"upload"]=!0,e(R)}}const kE=typeof XMLHttpRequest<"u",LE=kE&&function(e){return new Promise(function(a,u){let d=e.data;const y=Ao.from(e.headers).normalize();let{responseType:m,withXSRFToken:l}=e,T;function P(){e.cancelToken&&e.cancelToken.unsubscribe(T),e.signal&&e.signal.removeEventListener("abort",T)}let R;if(Xe.isFormData(d)){if(Qa.hasStandardBrowserEnv||Qa.hasStandardBrowserWebWorkerEnv)y.setContentType(!1);else if((R=y.getContentType())!==!1){const[Y,...me]=R?R.split(";").map(Te=>Te.trim()).filter(Boolean):[];y.setContentType([Y||"multipart/form-data",...me].join("; "))}}let D=new XMLHttpRequest;if(e.auth){const Y=e.auth.username||"",me=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";y.set("Authorization","Basic "+btoa(Y+":"+me))}const z=ix(e.baseURL,e.url);D.open(e.method.toUpperCase(),Yv(z,e.params,e.paramsSerializer),!0),D.timeout=e.timeout;function Z(){if(!D)return;const Y=Ao.from("getAllResponseHeaders"in D&&D.getAllResponseHeaders()),Te={data:!m||m==="text"||m==="json"?D.responseText:D.response,status:D.status,statusText:D.statusText,headers:Y,config:e,request:D};EE(function(ae){a(ae),P()},function(ae){u(ae),P()},Te),D=null}if("onloadend"in D?D.onloadend=Z:D.onreadystatechange=function(){!D||D.readyState!==4||D.status===0&&!(D.responseURL&&D.responseURL.indexOf("file:")===0)||setTimeout(Z)},D.onabort=function(){D&&(u(new Vi("Request aborted",Vi.ECONNABORTED,e,D)),D=null)},D.onerror=function(){u(new Vi("Network Error",Vi.ERR_NETWORK,e,D)),D=null},D.ontimeout=function(){let me=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";const Te=e.transitional||Jv;e.timeoutErrorMessage&&(me=e.timeoutErrorMessage),u(new Vi(me,Te.clarifyTimeoutError?Vi.ETIMEDOUT:Vi.ECONNABORTED,e,D)),D=null},Qa.hasStandardBrowserEnv&&(l&&Xe.isFunction(l)&&(l=l(e)),l||l!==!1&&AE(z))){const Y=e.xsrfHeaderName&&e.xsrfCookieName&&TE.read(e.xsrfCookieName);Y&&y.set(e.xsrfHeaderName,Y)}d===void 0&&y.setContentType(null),"setRequestHeader"in D&&Xe.forEach(y.toJSON(),function(me,Te){D.setRequestHeader(Te,me)}),Xe.isUndefined(e.withCredentials)||(D.withCredentials=!!e.withCredentials),m&&m!=="json"&&(D.responseType=e.responseType),typeof e.onDownloadProgress=="function"&&D.addEventListener("progress",F_(e.onDownloadProgress,!0)),typeof e.onUploadProgress=="function"&&D.upload&&D.upload.addEventListener("progress",F_(e.onUploadProgress)),(e.cancelToken||e.signal)&&(T=Y=>{D&&(u(!Y||Y.type?new Uh(null,e,D):Y),D.abort(),D=null)},e.cancelToken&&e.cancelToken.subscribe(T),e.signal&&(e.signal.aborted?T():e.signal.addEventListener("abort",T)));const K=PE(z);if(K&&Qa.protocols.indexOf(K)===-1){u(new Vi("Unsupported protocol "+K+":",Vi.ERR_BAD_REQUEST,e));return}D.send(d||null)})},dm={http:nE,xhr:LE};Xe.forEach(dm,(e,r)=>{if(e){try{Object.defineProperty(e,"name",{value:r})}catch{}Object.defineProperty(e,"adapterName",{value:r})}});const B_=e=>`- ${e}`,RE=e=>Xe.isFunction(e)||e===null||e===!1,rx={getAdapter:e=>{e=Xe.isArray(e)?e:[e];const{length:r}=e;let a,u;const d={};for(let y=0;y<r;y++){a=e[y];let m;if(u=a,!RE(a)&&(u=dm[(m=String(a)).toLowerCase()],u===void 0))throw new Vi(`Unknown adapter '${m}'`);if(u)break;d[m||"#"+y]=u}if(!u){const y=Object.entries(d).map(([l,T])=>`adapter ${l} `+(T===!1?"is not supported by the environment":"is not available in the build"));let m=r?y.length>1?`since :
`+y.map(B_).join(`
`):" "+B_(y[0]):"as no adapter specified";throw new Vi("There is no suitable adapter to dispatch the request "+m,"ERR_NOT_SUPPORT")}return u},adapters:dm};function $p(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Uh(null,e)}function N_(e){return $p(e),e.headers=Ao.from(e.headers),e.data=Np.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),rx.getAdapter(e.adapter||Hm.adapter)(e).then(function(u){return $p(e),u.data=Np.call(e,e.transformResponse,u),u.headers=Ao.from(u.headers),u},function(u){return tx(u)||($p(e),u&&u.response&&(u.response.data=Np.call(e,e.transformResponse,u.response),u.response.headers=Ao.from(u.response.headers))),Promise.reject(u)})}const $_=e=>e instanceof Ao?{...e}:e;function cu(e,r){r=r||{};const a={};function u(P,R,D){return Xe.isPlainObject(P)&&Xe.isPlainObject(R)?Xe.merge.call({caseless:D},P,R):Xe.isPlainObject(R)?Xe.merge({},R):Xe.isArray(R)?R.slice():R}function d(P,R,D){if(Xe.isUndefined(R)){if(!Xe.isUndefined(P))return u(void 0,P,D)}else return u(P,R,D)}function y(P,R){if(!Xe.isUndefined(R))return u(void 0,R)}function m(P,R){if(Xe.isUndefined(R)){if(!Xe.isUndefined(P))return u(void 0,P)}else return u(void 0,R)}function l(P,R,D){if(D in r)return u(P,R);if(D in e)return u(void 0,P)}const T={url:y,method:y,data:y,baseURL:m,transformRequest:m,transformResponse:m,paramsSerializer:m,timeout:m,timeoutMessage:m,withCredentials:m,withXSRFToken:m,adapter:m,responseType:m,xsrfCookieName:m,xsrfHeaderName:m,onUploadProgress:m,onDownloadProgress:m,decompress:m,maxContentLength:m,maxBodyLength:m,beforeRedirect:m,transport:m,httpAgent:m,httpsAgent:m,cancelToken:m,socketPath:m,responseEncoding:m,validateStatus:l,headers:(P,R)=>d($_(P),$_(R),!0)};return Xe.forEach(Object.keys(Object.assign({},e,r)),function(R){const D=T[R]||d,z=D(e[R],r[R],R);Xe.isUndefined(z)&&D!==l||(a[R]=z)}),a}const nx="1.6.8",Zm={};["object","boolean","number","function","string","symbol"].forEach((e,r)=>{Zm[e]=function(u){return typeof u===e||"a"+(r<1?"n ":" ")+e}});const U_={};Zm.transitional=function(r,a,u){function d(y,m){return"[Axios v"+nx+"] Transitional option '"+y+"'"+m+(u?". "+u:"")}return(y,m,l)=>{if(r===!1)throw new Vi(d(m," has been removed"+(a?" in "+a:"")),Vi.ERR_DEPRECATED);return a&&!U_[m]&&(U_[m]=!0,console.warn(d(m," has been deprecated since v"+a+" and will be removed in the near future"))),r?r(y,m,l):!0}};function zE(e,r,a){if(typeof e!="object")throw new Vi("options must be an object",Vi.ERR_BAD_OPTION_VALUE);const u=Object.keys(e);let d=u.length;for(;d-- >0;){const y=u[d],m=r[y];if(m){const l=e[y],T=l===void 0||m(l,y,e);if(T!==!0)throw new Vi("option "+y+" must be "+T,Vi.ERR_BAD_OPTION_VALUE);continue}if(a!==!0)throw new Vi("Unknown option "+y,Vi.ERR_BAD_OPTION)}}const fm={assertOptions:zE,validators:Zm},ul=fm.validators;class tf{constructor(r){this.defaults=r,this.interceptors={request:new z_,response:new z_}}async request(r,a){try{return await this._request(r,a)}catch(u){if(u instanceof Error){let d;Error.captureStackTrace?Error.captureStackTrace(d={}):d=new Error;const y=d.stack?d.stack.replace(/^.+\n/,""):"";u.stack?y&&!String(u.stack).endsWith(y.replace(/^.+\n.+\n/,""))&&(u.stack+=`
`+y):u.stack=y}throw u}}_request(r,a){typeof r=="string"?(a=a||{},a.url=r):a=r||{},a=cu(this.defaults,a);const{transitional:u,paramsSerializer:d,headers:y}=a;u!==void 0&&fm.assertOptions(u,{silentJSONParsing:ul.transitional(ul.boolean),forcedJSONParsing:ul.transitional(ul.boolean),clarifyTimeoutError:ul.transitional(ul.boolean)},!1),d!=null&&(Xe.isFunction(d)?a.paramsSerializer={serialize:d}:fm.assertOptions(d,{encode:ul.function,serialize:ul.function},!0)),a.method=(a.method||this.defaults.method||"get").toLowerCase();let m=y&&Xe.merge(y.common,y[a.method]);y&&Xe.forEach(["delete","get","head","post","put","patch","common"],K=>{delete y[K]}),a.headers=Ao.concat(m,y);const l=[];let T=!0;this.interceptors.request.forEach(function(Y){typeof Y.runWhen=="function"&&Y.runWhen(a)===!1||(T=T&&Y.synchronous,l.unshift(Y.fulfilled,Y.rejected))});const P=[];this.interceptors.response.forEach(function(Y){P.push(Y.fulfilled,Y.rejected)});let R,D=0,z;if(!T){const K=[N_.bind(this),void 0];for(K.unshift.apply(K,l),K.push.apply(K,P),z=K.length,R=Promise.resolve(a);D<z;)R=R.then(K[D++],K[D++]);return R}z=l.length;let Z=a;for(D=0;D<z;){const K=l[D++],Y=l[D++];try{Z=K(Z)}catch(me){Y.call(this,me);break}}try{R=N_.call(this,Z)}catch(K){return Promise.reject(K)}for(D=0,z=P.length;D<z;)R=R.then(P[D++],P[D++]);return R}getUri(r){r=cu(this.defaults,r);const a=ix(r.baseURL,r.url);return Yv(a,r.params,r.paramsSerializer)}}Xe.forEach(["delete","get","head","options"],function(r){tf.prototype[r]=function(a,u){return this.request(cu(u||{},{method:r,url:a,data:(u||{}).data}))}});Xe.forEach(["post","put","patch"],function(r){function a(u){return function(y,m,l){return this.request(cu(l||{},{method:r,headers:u?{"Content-Type":"multipart/form-data"}:{},url:y,data:m}))}}tf.prototype[r]=a(),tf.prototype[r+"Form"]=a(!0)});const Vd=tf;class Wm{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let a;this.promise=new Promise(function(y){a=y});const u=this;this.promise.then(d=>{if(!u._listeners)return;let y=u._listeners.length;for(;y-- >0;)u._listeners[y](d);u._listeners=null}),this.promise.then=d=>{let y;const m=new Promise(l=>{u.subscribe(l),y=l}).then(d);return m.cancel=function(){u.unsubscribe(y)},m},r(function(y,m,l){u.reason||(u.reason=new Uh(y,m,l),a(u.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){if(this.reason){r(this.reason);return}this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const a=this._listeners.indexOf(r);a!==-1&&this._listeners.splice(a,1)}static source(){let r;return{token:new Wm(function(d){r=d}),cancel:r}}}const OE=Wm;function FE(e){return function(a){return e.apply(null,a)}}function BE(e){return Xe.isObject(e)&&e.isAxiosError===!0}const pm={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(pm).forEach(([e,r])=>{pm[r]=e});const NE=pm;function sx(e){const r=new Vd(e),a=Nv(Vd.prototype.request,r);return Xe.extend(a,Vd.prototype,r,{allOwnKeys:!0}),Xe.extend(a,r,null,{allOwnKeys:!0}),a.create=function(d){return sx(cu(e,d))},a}const vr=sx(Hm);vr.Axios=Vd;vr.CanceledError=Uh;vr.CancelToken=OE;vr.isCancel=tx;vr.VERSION=nx;vr.toFormData=kf;vr.AxiosError=Vi;vr.Cancel=vr.CanceledError;vr.all=function(r){return Promise.all(r)};vr.spread=FE;vr.isAxiosError=BE;vr.mergeConfig=cu;vr.AxiosHeaders=Ao;vr.formToJSON=e=>ex(Xe.isHTMLForm(e)?new FormData(e):e);vr.getAdapter=rx.getAdapter;vr.HttpStatusCode=NE;vr.default=vr;const Rf=Do("CondosStore",{state:()=>({condosData:{}}),actions:{async fillCondoData(e){const a=Ln().addressData.features;if(!a)return;const u=a[0];let d={include_units:!0,opa_only:!0,page:1};const y=await vr(`//api.phila.gov/ais/v1/search/${e}`,{params:d});if(y.data.features.length>0){let m=[];for(let l of y.data.features)l.properties.address_low_frac!==u.properties.address_low_frac||l.properties.street_address===u.properties.street_address?y.data.total_size=y.data.total_size-1:m.push(l);this.condosData=m}}}});function ax(){return{routeApp:r=>{const a=ha();a.currentAddress&&a.currentTopic=="Nearby Activity"?r.push({name:"address-topic-and-data",params:{address:a.currentAddress,topic:"Nearby Activity",data:a.currentNearbyDataType}}):a.currentAddress&&a.currentTopic?r.push({name:"address-and-topic",params:{address:a.currentAddress,topic:a.currentTopic}}):a.currentAddress&&r.push({name:"address",params:{address:a.currentAddress}})}}}const El=(e,r)=>{const a=e.__vccOpts||e;for(const[u,d]of r)a[u]=d;return a},$E={class:"topic-name has-text-left"},UE={key:0,class:"topic-loading has-text-right"},VE={key:0},jE={class:"inside-topic"},qE={__name:"Topic",props:{topicName:String,loading:Boolean},setup(e){const r=ha(),a=e,u=Nh(),d=Bh(),{routeApp:y}=ax(),m=Gi(()=>u.params.topic==a.topicName),l=()=>{a.topicName==u.params.topic?r.currentTopic="":r.currentTopic=a.topicName,console.log("topic clicked:",a.topicName),y(d)};return(T,P)=>(Lt(),Xt("section",null,[se("div",{class:"topic",onClick:l},[se("span",$E,ei(e.topicName),1),m.value&&e.loading?(Lt(),Xt("span",UE,"Loading...")):Ki("",!0)]),m.value?(Lt(),Xt("div",VE,[se("div",jE,[r2(T.$slots,"default",{},void 0,!0)])])):Ki("",!0)]))}},tc=El(qE,[["__scopeId","data-v-ed149146"]]);var Hc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Xm(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var mm={exports:{}};/*!
 * accounting.js v0.4.1
 * Copyright 2014 Open Exchange Rates
 *
 * Freely distributable under the MIT license.
 * Portions of accounting.js are inspired or borrowed from underscore.js
 *
 * Full details and documentation:
 * http://openexchangerates.github.io/accounting.js/
 */(function(e,r){(function(a,u){var d={};d.version="0.4.1",d.settings={currency:{symbol:"$",format:"%s%v",decimal:".",thousand:",",precision:2,grouping:3},number:{precision:0,grouping:3,thousand:",",decimal:"."}};var y=Array.prototype.map,m=Array.isArray,l=Object.prototype.toString;function T(ae){return!!(ae===""||ae&&ae.charCodeAt&&ae.substr)}function P(ae){return m?m(ae):l.call(ae)==="[object Array]"}function R(ae){return ae&&l.call(ae)==="[object Object]"}function D(ae,Pe){var Ze;ae=ae||{},Pe=Pe||{};for(Ze in Pe)Pe.hasOwnProperty(Ze)&&ae[Ze]==null&&(ae[Ze]=Pe[Ze]);return ae}function z(ae,Pe,Ze){var Je=[],dt,_t;if(!ae)return Je;if(y&&ae.map===y)return ae.map(Pe,Ze);for(dt=0,_t=ae.length;dt<_t;dt++)Je[dt]=Pe.call(Ze,ae[dt],dt,ae);return Je}function Z(ae,Pe){return ae=Math.round(Math.abs(ae)),isNaN(ae)?Pe:ae}function K(ae){var Pe=d.settings.currency.format;return typeof ae=="function"&&(ae=ae()),T(ae)&&ae.match("%v")?{pos:ae,neg:ae.replace("-","").replace("%v","-%v"),zero:ae}:!ae||!ae.pos||!ae.pos.match("%v")?T(Pe)?d.settings.currency.format={pos:Pe,neg:Pe.replace("%v","-%v"),zero:Pe}:Pe:ae}var Y=d.unformat=d.parse=function(ae,Pe){if(P(ae))return z(ae,function(dt){return Y(dt,Pe)});if(ae=ae||0,typeof ae=="number")return ae;Pe=Pe||d.settings.number.decimal;var Ze=new RegExp("[^0-9-"+Pe+"]",["g"]),Je=parseFloat((""+ae).replace(/\((.*)\)/,"-$1").replace(Ze,"").replace(Pe,"."));return isNaN(Je)?0:Je},me=d.toFixed=function(ae,Pe){Pe=Z(Pe,d.settings.number.precision);var Ze=Math.pow(10,Pe);return(Math.round(d.unformat(ae)*Ze)/Ze).toFixed(Pe)},Te=d.formatNumber=d.format=function(ae,Pe,Ze,Je){if(P(ae))return z(ae,function(ri){return Te(ri,Pe,Ze,Je)});ae=Y(ae);var dt=D(R(Pe)?Pe:{precision:Pe,thousand:Ze,decimal:Je},d.settings.number),_t=Z(dt.precision),xt=ae<0?"-":"",Vt=parseInt(me(Math.abs(ae||0),_t),10)+"",kt=Vt.length>3?Vt.length%3:0;return xt+(kt?Vt.substr(0,kt)+dt.thousand:"")+Vt.substr(kt).replace(/(\d{3})(?=\d)/g,"$1"+dt.thousand)+(_t?dt.decimal+me(Math.abs(ae),_t).split(".")[1]:"")},Fe=d.formatMoney=function(ae,Pe,Ze,Je,dt,_t){if(P(ae))return z(ae,function(ri){return Fe(ri,Pe,Ze,Je,dt,_t)});ae=Y(ae);var xt=D(R(Pe)?Pe:{symbol:Pe,precision:Ze,thousand:Je,decimal:dt,format:_t},d.settings.currency),Vt=K(xt.format),kt=ae>0?Vt.pos:ae<0?Vt.neg:Vt.zero;return kt.replace("%s",xt.symbol).replace("%v",Te(Math.abs(ae),Z(xt.precision),xt.thousand,xt.decimal))};d.formatColumn=function(ae,Pe,Ze,Je,dt,_t){if(!ae)return[];var xt=D(R(Pe)?Pe:{symbol:Pe,precision:Ze,thousand:Je,decimal:dt,format:_t},d.settings.currency),Vt=K(xt.format),kt=Vt.pos.indexOf("%s")<Vt.pos.indexOf("%v"),ri=0,xi=z(ae,function(li,xr){if(P(li))return d.formatColumn(li,xt);li=Y(li);var si=li>0?Vt.pos:li<0?Vt.neg:Vt.zero,tt=si.replace("%s",xt.symbol).replace("%v",Te(Math.abs(li),Z(xt.precision),xt.thousand,xt.decimal));return tt.length>ri&&(ri=tt.length),tt});return z(xi,function(li,xr){return T(li)&&li.length<ri?kt?li.replace(xt.symbol,xt.symbol+new Array(ri-li.length+1).join(" ")):new Array(ri-li.length+1).join(" ")+li:li})},e.exports&&(r=e.exports=d),r.accounting=d})()})(mm,mm.exports);var GE=mm.exports;const ox=Xm(GE);function Ds(e){const r=Object.prototype.toString.call(e);return e instanceof Date||typeof e=="object"&&r==="[object Date]"?new e.constructor(+e):typeof e=="number"||r==="[object Number]"||typeof e=="string"||r==="[object String]"?new Date(e):new Date(NaN)}function La(e,r){return e instanceof Date?new e.constructor(r):new Date(r)}function lx(e,r){const a=Ds(e);return isNaN(r)?La(e,NaN):(r&&a.setDate(a.getDate()+r),a)}function cx(e,r){const a=Ds(e);if(isNaN(r))return La(e,NaN);if(!r)return a;const u=a.getDate(),d=La(e,a.getTime());d.setMonth(a.getMonth()+r+1,0);const y=d.getDate();return u>=y?d:(a.setFullYear(d.getFullYear(),d.getMonth(),u),a)}function HE(e,r){const a=+Ds(e);return La(e,a+r)}const ux=6048e5,ZE=864e5,hx=6e4,Km=36e5;function WE(e,r){return HE(e,r*Km)}let XE={};function zf(){return XE}function Ah(e,r){var l,T,P,R;const a=zf(),u=(r==null?void 0:r.weekStartsOn)??((T=(l=r==null?void 0:r.locale)==null?void 0:l.options)==null?void 0:T.weekStartsOn)??a.weekStartsOn??((R=(P=a.locale)==null?void 0:P.options)==null?void 0:R.weekStartsOn)??0,d=Ds(e),y=d.getDay(),m=(y<u?7:0)+y-u;return d.setDate(d.getDate()-m),d.setHours(0,0,0,0),d}function rf(e){return Ah(e,{weekStartsOn:1})}function dx(e){const r=Ds(e),a=r.getFullYear(),u=La(e,0);u.setFullYear(a+1,0,4),u.setHours(0,0,0,0);const d=rf(u),y=La(e,0);y.setFullYear(a,0,4),y.setHours(0,0,0,0);const m=rf(y);return r.getTime()>=d.getTime()?a+1:r.getTime()>=m.getTime()?a:a-1}function V_(e){const r=Ds(e);return r.setHours(0,0,0,0),r}function j_(e){const r=Ds(e),a=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return a.setUTCFullYear(r.getFullYear()),+e-+a}function KE(e,r){const a=V_(e),u=V_(r),d=+a-j_(a),y=+u-j_(u);return Math.round((d-y)/ZE)}function YE(e){const r=dx(e),a=La(e,0);return a.setFullYear(r,0,4),a.setHours(0,0,0,0),rf(a)}function JE(e,r){const a=r*7;return lx(e,a)}function QE(e,r){return cx(e,r*12)}function eT(e){return e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}function tT(e){if(!eT(e)&&typeof e!="number")return!1;const r=Ds(e);return!isNaN(Number(r))}function iT(e){const r=Ds(e),a=La(e,0);return a.setFullYear(r.getFullYear(),0,1),a.setHours(0,0,0,0),a}const rT={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},nT=(e,r,a)=>{let u;const d=rT[e];return typeof d=="string"?u=d:r===1?u=d.one:u=d.other.replace("{{count}}",r.toString()),a!=null&&a.addSuffix?a.comparison&&a.comparison>0?"in "+u:u+" ago":u};function Up(e){return(r={})=>{const a=r.width?String(r.width):e.defaultWidth;return e.formats[a]||e.formats[e.defaultWidth]}}const sT={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},aT={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},oT={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},lT={date:Up({formats:sT,defaultWidth:"full"}),time:Up({formats:aT,defaultWidth:"full"}),dateTime:Up({formats:oT,defaultWidth:"full"})},cT={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},uT=(e,r,a,u)=>cT[e];function ih(e){return(r,a)=>{const u=a!=null&&a.context?String(a.context):"standalone";let d;if(u==="formatting"&&e.formattingValues){const m=e.defaultFormattingWidth||e.defaultWidth,l=a!=null&&a.width?String(a.width):m;d=e.formattingValues[l]||e.formattingValues[m]}else{const m=e.defaultWidth,l=a!=null&&a.width?String(a.width):e.defaultWidth;d=e.values[l]||e.values[m]}const y=e.argumentCallback?e.argumentCallback(r):r;return d[y]}}const hT={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},dT={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},fT={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},pT={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},mT={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},gT={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},yT=(e,r)=>{const a=Number(e),u=a%100;if(u>20||u<10)switch(u%10){case 1:return a+"st";case 2:return a+"nd";case 3:return a+"rd"}return a+"th"},_T={ordinalNumber:yT,era:ih({values:hT,defaultWidth:"wide"}),quarter:ih({values:dT,defaultWidth:"wide",argumentCallback:e=>e-1}),month:ih({values:fT,defaultWidth:"wide"}),day:ih({values:pT,defaultWidth:"wide"}),dayPeriod:ih({values:mT,defaultWidth:"wide",formattingValues:gT,defaultFormattingWidth:"wide"})};function rh(e){return(r,a={})=>{const u=a.width,d=u&&e.matchPatterns[u]||e.matchPatterns[e.defaultMatchWidth],y=r.match(d);if(!y)return null;const m=y[0],l=u&&e.parsePatterns[u]||e.parsePatterns[e.defaultParseWidth],T=Array.isArray(l)?xT(l,D=>D.test(m)):vT(l,D=>D.test(m));let P;P=e.valueCallback?e.valueCallback(T):T,P=a.valueCallback?a.valueCallback(P):P;const R=r.slice(m.length);return{value:P,rest:R}}}function vT(e,r){for(const a in e)if(Object.prototype.hasOwnProperty.call(e,a)&&r(e[a]))return a}function xT(e,r){for(let a=0;a<e.length;a++)if(r(e[a]))return a}function bT(e){return(r,a={})=>{const u=r.match(e.matchPattern);if(!u)return null;const d=u[0],y=r.match(e.parsePattern);if(!y)return null;let m=e.valueCallback?e.valueCallback(y[0]):y[0];m=a.valueCallback?a.valueCallback(m):m;const l=r.slice(d.length);return{value:m,rest:l}}}const wT=/^(\d+)(th|st|nd|rd)?/i,MT=/\d+/i,ST={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},ET={any:[/^b/i,/^(a|c)/i]},TT={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},CT={any:[/1/i,/2/i,/3/i,/4/i]},IT={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},AT={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},PT={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},DT={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},kT={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},LT={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},RT={ordinalNumber:bT({matchPattern:wT,parsePattern:MT,valueCallback:e=>parseInt(e,10)}),era:rh({matchPatterns:ST,defaultMatchWidth:"wide",parsePatterns:ET,defaultParseWidth:"any"}),quarter:rh({matchPatterns:TT,defaultMatchWidth:"wide",parsePatterns:CT,defaultParseWidth:"any",valueCallback:e=>e+1}),month:rh({matchPatterns:IT,defaultMatchWidth:"wide",parsePatterns:AT,defaultParseWidth:"any"}),day:rh({matchPatterns:PT,defaultMatchWidth:"wide",parsePatterns:DT,defaultParseWidth:"any"}),dayPeriod:rh({matchPatterns:kT,defaultMatchWidth:"any",parsePatterns:LT,defaultParseWidth:"any"})},zT={code:"en-US",formatDistance:nT,formatLong:lT,formatRelative:uT,localize:_T,match:RT,options:{weekStartsOn:0,firstWeekContainsDate:1}};function OT(e){const r=Ds(e);return KE(r,iT(r))+1}function FT(e){const r=Ds(e),a=+rf(r)-+YE(r);return Math.round(a/ux)+1}function fx(e,r){var R,D,z,Z;const a=Ds(e),u=a.getFullYear(),d=zf(),y=(r==null?void 0:r.firstWeekContainsDate)??((D=(R=r==null?void 0:r.locale)==null?void 0:R.options)==null?void 0:D.firstWeekContainsDate)??d.firstWeekContainsDate??((Z=(z=d.locale)==null?void 0:z.options)==null?void 0:Z.firstWeekContainsDate)??1,m=La(e,0);m.setFullYear(u+1,0,y),m.setHours(0,0,0,0);const l=Ah(m,r),T=La(e,0);T.setFullYear(u,0,y),T.setHours(0,0,0,0);const P=Ah(T,r);return a.getTime()>=l.getTime()?u+1:a.getTime()>=P.getTime()?u:u-1}function BT(e,r){var l,T,P,R;const a=zf(),u=(r==null?void 0:r.firstWeekContainsDate)??((T=(l=r==null?void 0:r.locale)==null?void 0:l.options)==null?void 0:T.firstWeekContainsDate)??a.firstWeekContainsDate??((R=(P=a.locale)==null?void 0:P.options)==null?void 0:R.firstWeekContainsDate)??1,d=fx(e,r),y=La(e,0);return y.setFullYear(d,0,u),y.setHours(0,0,0,0),Ah(y,r)}function NT(e,r){const a=Ds(e),u=+Ah(a,r)-+BT(a,r);return Math.round(u/ux)+1}function nr(e,r){const a=e<0?"-":"",u=Math.abs(e).toString().padStart(r,"0");return a+u}const hl={y(e,r){const a=e.getFullYear(),u=a>0?a:1-a;return nr(r==="yy"?u%100:u,r.length)},M(e,r){const a=e.getMonth();return r==="M"?String(a+1):nr(a+1,2)},d(e,r){return nr(e.getDate(),r.length)},a(e,r){const a=e.getHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return a.toUpperCase();case"aaa":return a;case"aaaaa":return a[0];case"aaaa":default:return a==="am"?"a.m.":"p.m."}},h(e,r){return nr(e.getHours()%12||12,r.length)},H(e,r){return nr(e.getHours(),r.length)},m(e,r){return nr(e.getMinutes(),r.length)},s(e,r){return nr(e.getSeconds(),r.length)},S(e,r){const a=r.length,u=e.getMilliseconds(),d=Math.trunc(u*Math.pow(10,a-3));return nr(d,r.length)}},jc={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},q_={G:function(e,r,a){const u=e.getFullYear()>0?1:0;switch(r){case"G":case"GG":case"GGG":return a.era(u,{width:"abbreviated"});case"GGGGG":return a.era(u,{width:"narrow"});case"GGGG":default:return a.era(u,{width:"wide"})}},y:function(e,r,a){if(r==="yo"){const u=e.getFullYear(),d=u>0?u:1-u;return a.ordinalNumber(d,{unit:"year"})}return hl.y(e,r)},Y:function(e,r,a,u){const d=fx(e,u),y=d>0?d:1-d;if(r==="YY"){const m=y%100;return nr(m,2)}return r==="Yo"?a.ordinalNumber(y,{unit:"year"}):nr(y,r.length)},R:function(e,r){const a=dx(e);return nr(a,r.length)},u:function(e,r){const a=e.getFullYear();return nr(a,r.length)},Q:function(e,r,a){const u=Math.ceil((e.getMonth()+1)/3);switch(r){case"Q":return String(u);case"QQ":return nr(u,2);case"Qo":return a.ordinalNumber(u,{unit:"quarter"});case"QQQ":return a.quarter(u,{width:"abbreviated",context:"formatting"});case"QQQQQ":return a.quarter(u,{width:"narrow",context:"formatting"});case"QQQQ":default:return a.quarter(u,{width:"wide",context:"formatting"})}},q:function(e,r,a){const u=Math.ceil((e.getMonth()+1)/3);switch(r){case"q":return String(u);case"qq":return nr(u,2);case"qo":return a.ordinalNumber(u,{unit:"quarter"});case"qqq":return a.quarter(u,{width:"abbreviated",context:"standalone"});case"qqqqq":return a.quarter(u,{width:"narrow",context:"standalone"});case"qqqq":default:return a.quarter(u,{width:"wide",context:"standalone"})}},M:function(e,r,a){const u=e.getMonth();switch(r){case"M":case"MM":return hl.M(e,r);case"Mo":return a.ordinalNumber(u+1,{unit:"month"});case"MMM":return a.month(u,{width:"abbreviated",context:"formatting"});case"MMMMM":return a.month(u,{width:"narrow",context:"formatting"});case"MMMM":default:return a.month(u,{width:"wide",context:"formatting"})}},L:function(e,r,a){const u=e.getMonth();switch(r){case"L":return String(u+1);case"LL":return nr(u+1,2);case"Lo":return a.ordinalNumber(u+1,{unit:"month"});case"LLL":return a.month(u,{width:"abbreviated",context:"standalone"});case"LLLLL":return a.month(u,{width:"narrow",context:"standalone"});case"LLLL":default:return a.month(u,{width:"wide",context:"standalone"})}},w:function(e,r,a,u){const d=NT(e,u);return r==="wo"?a.ordinalNumber(d,{unit:"week"}):nr(d,r.length)},I:function(e,r,a){const u=FT(e);return r==="Io"?a.ordinalNumber(u,{unit:"week"}):nr(u,r.length)},d:function(e,r,a){return r==="do"?a.ordinalNumber(e.getDate(),{unit:"date"}):hl.d(e,r)},D:function(e,r,a){const u=OT(e);return r==="Do"?a.ordinalNumber(u,{unit:"dayOfYear"}):nr(u,r.length)},E:function(e,r,a){const u=e.getDay();switch(r){case"E":case"EE":case"EEE":return a.day(u,{width:"abbreviated",context:"formatting"});case"EEEEE":return a.day(u,{width:"narrow",context:"formatting"});case"EEEEEE":return a.day(u,{width:"short",context:"formatting"});case"EEEE":default:return a.day(u,{width:"wide",context:"formatting"})}},e:function(e,r,a,u){const d=e.getDay(),y=(d-u.weekStartsOn+8)%7||7;switch(r){case"e":return String(y);case"ee":return nr(y,2);case"eo":return a.ordinalNumber(y,{unit:"day"});case"eee":return a.day(d,{width:"abbreviated",context:"formatting"});case"eeeee":return a.day(d,{width:"narrow",context:"formatting"});case"eeeeee":return a.day(d,{width:"short",context:"formatting"});case"eeee":default:return a.day(d,{width:"wide",context:"formatting"})}},c:function(e,r,a,u){const d=e.getDay(),y=(d-u.weekStartsOn+8)%7||7;switch(r){case"c":return String(y);case"cc":return nr(y,r.length);case"co":return a.ordinalNumber(y,{unit:"day"});case"ccc":return a.day(d,{width:"abbreviated",context:"standalone"});case"ccccc":return a.day(d,{width:"narrow",context:"standalone"});case"cccccc":return a.day(d,{width:"short",context:"standalone"});case"cccc":default:return a.day(d,{width:"wide",context:"standalone"})}},i:function(e,r,a){const u=e.getDay(),d=u===0?7:u;switch(r){case"i":return String(d);case"ii":return nr(d,r.length);case"io":return a.ordinalNumber(d,{unit:"day"});case"iii":return a.day(u,{width:"abbreviated",context:"formatting"});case"iiiii":return a.day(u,{width:"narrow",context:"formatting"});case"iiiiii":return a.day(u,{width:"short",context:"formatting"});case"iiii":default:return a.day(u,{width:"wide",context:"formatting"})}},a:function(e,r,a){const d=e.getHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return a.dayPeriod(d,{width:"abbreviated",context:"formatting"});case"aaa":return a.dayPeriod(d,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return a.dayPeriod(d,{width:"narrow",context:"formatting"});case"aaaa":default:return a.dayPeriod(d,{width:"wide",context:"formatting"})}},b:function(e,r,a){const u=e.getHours();let d;switch(u===12?d=jc.noon:u===0?d=jc.midnight:d=u/12>=1?"pm":"am",r){case"b":case"bb":return a.dayPeriod(d,{width:"abbreviated",context:"formatting"});case"bbb":return a.dayPeriod(d,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return a.dayPeriod(d,{width:"narrow",context:"formatting"});case"bbbb":default:return a.dayPeriod(d,{width:"wide",context:"formatting"})}},B:function(e,r,a){const u=e.getHours();let d;switch(u>=17?d=jc.evening:u>=12?d=jc.afternoon:u>=4?d=jc.morning:d=jc.night,r){case"B":case"BB":case"BBB":return a.dayPeriod(d,{width:"abbreviated",context:"formatting"});case"BBBBB":return a.dayPeriod(d,{width:"narrow",context:"formatting"});case"BBBB":default:return a.dayPeriod(d,{width:"wide",context:"formatting"})}},h:function(e,r,a){if(r==="ho"){let u=e.getHours()%12;return u===0&&(u=12),a.ordinalNumber(u,{unit:"hour"})}return hl.h(e,r)},H:function(e,r,a){return r==="Ho"?a.ordinalNumber(e.getHours(),{unit:"hour"}):hl.H(e,r)},K:function(e,r,a){const u=e.getHours()%12;return r==="Ko"?a.ordinalNumber(u,{unit:"hour"}):nr(u,r.length)},k:function(e,r,a){let u=e.getHours();return u===0&&(u=24),r==="ko"?a.ordinalNumber(u,{unit:"hour"}):nr(u,r.length)},m:function(e,r,a){return r==="mo"?a.ordinalNumber(e.getMinutes(),{unit:"minute"}):hl.m(e,r)},s:function(e,r,a){return r==="so"?a.ordinalNumber(e.getSeconds(),{unit:"second"}):hl.s(e,r)},S:function(e,r){return hl.S(e,r)},X:function(e,r,a){const u=e.getTimezoneOffset();if(u===0)return"Z";switch(r){case"X":return H_(u);case"XXXX":case"XX":return ic(u);case"XXXXX":case"XXX":default:return ic(u,":")}},x:function(e,r,a){const u=e.getTimezoneOffset();switch(r){case"x":return H_(u);case"xxxx":case"xx":return ic(u);case"xxxxx":case"xxx":default:return ic(u,":")}},O:function(e,r,a){const u=e.getTimezoneOffset();switch(r){case"O":case"OO":case"OOO":return"GMT"+G_(u,":");case"OOOO":default:return"GMT"+ic(u,":")}},z:function(e,r,a){const u=e.getTimezoneOffset();switch(r){case"z":case"zz":case"zzz":return"GMT"+G_(u,":");case"zzzz":default:return"GMT"+ic(u,":")}},t:function(e,r,a){const u=Math.trunc(e.getTime()/1e3);return nr(u,r.length)},T:function(e,r,a){const u=e.getTime();return nr(u,r.length)}};function G_(e,r=""){const a=e>0?"-":"+",u=Math.abs(e),d=Math.trunc(u/60),y=u%60;return y===0?a+String(d):a+String(d)+r+nr(y,2)}function H_(e,r){return e%60===0?(e>0?"-":"+")+nr(Math.abs(e)/60,2):ic(e,r)}function ic(e,r=""){const a=e>0?"-":"+",u=Math.abs(e),d=nr(Math.trunc(u/60),2),y=nr(u%60,2);return a+d+r+y}const Z_=(e,r)=>{switch(e){case"P":return r.date({width:"short"});case"PP":return r.date({width:"medium"});case"PPP":return r.date({width:"long"});case"PPPP":default:return r.date({width:"full"})}},px=(e,r)=>{switch(e){case"p":return r.time({width:"short"});case"pp":return r.time({width:"medium"});case"ppp":return r.time({width:"long"});case"pppp":default:return r.time({width:"full"})}},$T=(e,r)=>{const a=e.match(/(P+)(p+)?/)||[],u=a[1],d=a[2];if(!d)return Z_(e,r);let y;switch(u){case"P":y=r.dateTime({width:"short"});break;case"PP":y=r.dateTime({width:"medium"});break;case"PPP":y=r.dateTime({width:"long"});break;case"PPPP":default:y=r.dateTime({width:"full"});break}return y.replace("{{date}}",Z_(u,r)).replace("{{time}}",px(d,r))},UT={p:px,P:$T},VT=/^D+$/,jT=/^Y+$/,qT=["D","DD","YY","YYYY"];function GT(e){return VT.test(e)}function HT(e){return jT.test(e)}function ZT(e,r,a){const u=WT(e,r,a);if(console.warn(u),qT.includes(e))throw new RangeError(u)}function WT(e,r,a){const u=e[0]==="Y"?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${r}\`) for formatting ${u} to the input \`${a}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const XT=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,KT=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,YT=/^'([^]*?)'?$/,JT=/''/g,QT=/[a-zA-Z]/;function gm(e,r,a){var R,D,z,Z,K,Y,me,Te;const u=zf(),d=(a==null?void 0:a.locale)??u.locale??zT,y=(a==null?void 0:a.firstWeekContainsDate)??((D=(R=a==null?void 0:a.locale)==null?void 0:R.options)==null?void 0:D.firstWeekContainsDate)??u.firstWeekContainsDate??((Z=(z=u.locale)==null?void 0:z.options)==null?void 0:Z.firstWeekContainsDate)??1,m=(a==null?void 0:a.weekStartsOn)??((Y=(K=a==null?void 0:a.locale)==null?void 0:K.options)==null?void 0:Y.weekStartsOn)??u.weekStartsOn??((Te=(me=u.locale)==null?void 0:me.options)==null?void 0:Te.weekStartsOn)??0,l=Ds(e);if(!tT(l))throw new RangeError("Invalid time value");let T=r.match(KT).map(Fe=>{const ae=Fe[0];if(ae==="p"||ae==="P"){const Pe=UT[ae];return Pe(Fe,d.formatLong)}return Fe}).join("").match(XT).map(Fe=>{if(Fe==="''")return{isToken:!1,value:"'"};const ae=Fe[0];if(ae==="'")return{isToken:!1,value:eC(Fe)};if(q_[ae])return{isToken:!0,value:Fe};if(ae.match(QT))throw new RangeError("Format string contains an unescaped latin alphabet character `"+ae+"`");return{isToken:!1,value:Fe}});d.localize.preprocessor&&(T=d.localize.preprocessor(l,T));const P={firstWeekContainsDate:y,weekStartsOn:m,locale:d};return T.map(Fe=>{if(!Fe.isToken)return Fe.value;const ae=Fe.value;(!(a!=null&&a.useAdditionalWeekYearTokens)&&HT(ae)||!(a!=null&&a.useAdditionalDayOfYearTokens)&&GT(ae))&&ZT(ae,r,String(e));const Pe=q_[ae[0]];return Pe(l,ae,d.localize,P)}).join("")}function eC(e){const r=e.match(YT);return r?r[1].replace(JT,"'"):e}function tC(e,r){return lx(e,-r)}function iC(e,r){const a=(r==null?void 0:r.additionalDigits)??2,u=aC(e);let d;if(u.date){const T=oC(u.date,a);d=lC(T.restDateString,T.year)}if(!d||isNaN(d.getTime()))return new Date(NaN);const y=d.getTime();let m=0,l;if(u.time&&(m=cC(u.time),isNaN(m)))return new Date(NaN);if(u.timezone){if(l=uC(u.timezone),isNaN(l))return new Date(NaN)}else{const T=new Date(y+m),P=new Date(0);return P.setFullYear(T.getUTCFullYear(),T.getUTCMonth(),T.getUTCDate()),P.setHours(T.getUTCHours(),T.getUTCMinutes(),T.getUTCSeconds(),T.getUTCMilliseconds()),P}return new Date(y+m+l)}const Pd={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},rC=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,nC=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,sC=/^([+-])(\d{2})(?::?(\d{2}))?$/;function aC(e){const r={},a=e.split(Pd.dateTimeDelimiter);let u;if(a.length>2)return r;if(/:/.test(a[0])?u=a[0]:(r.date=a[0],u=a[1],Pd.timeZoneDelimiter.test(r.date)&&(r.date=e.split(Pd.timeZoneDelimiter)[0],u=e.substr(r.date.length,e.length))),u){const d=Pd.timezone.exec(u);d?(r.time=u.replace(d[1],""),r.timezone=d[1]):r.time=u}return r}function oC(e,r){const a=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+r)+"})|(\\d{2}|[+-]\\d{"+(2+r)+"})$)"),u=e.match(a);if(!u)return{year:NaN,restDateString:""};const d=u[1]?parseInt(u[1]):null,y=u[2]?parseInt(u[2]):null;return{year:y===null?d:y*100,restDateString:e.slice((u[1]||u[2]).length)}}function lC(e,r){if(r===null)return new Date(NaN);const a=e.match(rC);if(!a)return new Date(NaN);const u=!!a[4],d=nh(a[1]),y=nh(a[2])-1,m=nh(a[3]),l=nh(a[4]),T=nh(a[5])-1;if(u)return mC(r,l,T)?hC(r,l,T):new Date(NaN);{const P=new Date(0);return!fC(r,y,m)||!pC(r,d)?new Date(NaN):(P.setUTCFullYear(r,y,Math.max(d,m)),P)}}function nh(e){return e?parseInt(e):1}function cC(e){const r=e.match(nC);if(!r)return NaN;const a=Vp(r[1]),u=Vp(r[2]),d=Vp(r[3]);return gC(a,u,d)?a*Km+u*hx+d*1e3:NaN}function Vp(e){return e&&parseFloat(e.replace(",","."))||0}function uC(e){if(e==="Z")return 0;const r=e.match(sC);if(!r)return 0;const a=r[1]==="+"?-1:1,u=parseInt(r[2]),d=r[3]&&parseInt(r[3])||0;return yC(u,d)?a*(u*Km+d*hx):NaN}function hC(e,r,a){const u=new Date(0);u.setUTCFullYear(e,0,4);const d=u.getUTCDay()||7,y=(r-1)*7+a+1-d;return u.setUTCDate(u.getUTCDate()+y),u}const dC=[31,null,31,30,31,30,31,31,30,31,30,31];function mx(e){return e%400===0||e%4===0&&e%100!==0}function fC(e,r,a){return r>=0&&r<=11&&a>=1&&a<=(dC[r]||(mx(e)?29:28))}function pC(e,r){return r>=1&&r<=(mx(e)?366:365)}function mC(e,r,a){return r>=1&&r<=53&&a>=0&&a<=6}function gC(e,r,a){return e===24?r===0&&a===0:a>=0&&a<60&&r>=0&&r<60&&e>=0&&e<25}function yC(e,r){return r>=0&&r<=59}function _C(e,r){return cx(e,-r)}function vC(e,r){return WE(e,-r)}function xC(e,r){return JE(e,-r)}function bC(e,r){return QE(e,-r)}ox.settings.currency.precision=0;function Ym(){return{bold:u=>"<strong>"+u+"</strong>",currency:u=>ox.formatMoney(u),date:u=>{let d;return typeof u=="string"?d=gm(iC(u),"MM/dd/yyyy"):d=gm(u,"MM/dd/yyyy"),d}}}const{currency:W_,date:wC}=Ym(),gx=Do("OpaStore",{state:()=>({opaData:{}}),actions:{async fillOpaData(){const r=Ln().addressData.features[0].properties.opa_account_num,a=await fetch(`https://phl.carto.com/api/v2/sql?q=select+*+from+opa_properties_public+where+parcel_number+%3D+%27${r}%27`);this.opaData=await a.json()}},getters:{getMarketValue:e=>W_(e.opaData.rows[0].market_value||null),getSaleDate:e=>wC(e.opaData.rows[0].sale_date),getSalePrice:e=>W_(e.opaData.rows[0].sale_price)}}),Tl=e=>(vf("data-v-c822a1b7"),e=e(),xf(),e),MC={key:0,class:"box"},SC={key:1,class:"vert-table"},EC={class:"columns"},TC=Tl(()=>se("div",{class:"column is-4"},"OPA Account #",-1)),CC={class:"column is-8"},IC={class:"columns"},AC=Tl(()=>se("div",{class:"column is-4"},"OPA Address",-1)),PC={class:"column is-8"},DC={class:"columns"},kC=Tl(()=>se("div",{class:"column is-4"},"Owners",-1)),LC={class:"column is-8"},RC={class:"columns"},zC=Tl(()=>se("div",{class:"column is-4"},"Assessed Value",-1)),OC={class:"column is-8"},FC={class:"columns"},BC=Tl(()=>se("div",{class:"column is-4"},"Sale Date",-1)),NC={class:"column is-8"},$C={class:"columns"},UC=Tl(()=>se("div",{class:"column is-4"},"Sale Price",-1)),VC={class:"column is-8"},jC={key:2},qC={class:"title is-5"},GC=Tl(()=>se("p",null,"You can use the Condominiums tab below to see information for an individual unit.",-1)),HC={key:3},ZC=Tl(()=>se("p",null,"There is no property assessment record for this address.",-1)),WC=[ZC],XC={__name:"Property",setup(e){console.log("Property.vue setup");const r=Ln(),a=gx(),u=Rf();return(d,y)=>(Lt(),Xt("section",null,[ar(a).opaData.rows.length?(Lt(),Xt("div",MC," Property assessment and sale information for this address. Source: Office of Property Assessments (OPA). OPA was formerly a part of the Bureau of Revision of Taxes (BRT) and some City records may still use that name. ")):Ki("",!0),ar(a).opaData.rows.length?(Lt(),Xt("div",SC,[se("div",EC,[TC,se("div",CC,ei(ar(r).addressData.features[0].properties.opa_account_num),1)]),se("div",IC,[AC,se("div",PC,ei(ar(r).addressData.features[0].properties.opa_address),1)]),se("div",DC,[kC,se("div",LC,ei(ar(r).getOpaOwners),1)]),se("div",RC,[zC,se("div",OC,ei(ar(a).getMarketValue),1)]),se("div",FC,[BC,se("div",NC,ei(ar(a).getSaleDate),1)]),se("div",$C,[UC,se("div",VC,ei(ar(a).getSalePrice),1)])])):Ki("",!0),!ar(a).opaData.rows.length&&ar(u).condosData.length?(Lt(),Xt("div",jC,[se("h5",qC,"There are "+ei(ar(u).condosData.length)+" condominium units at this address.",1),GC])):ar(a).opaData.rows.length?Ki("",!0):(Lt(),Xt("div",HC,WC))]))}},KC=El(XC,[["__scopeId","data-v-c822a1b7"]]),YC=se("div",{class:"box"}," Condominium units at your search address, as recorded for property assessment purposes. Click one of the addresses below to see information for that unit. Use the back button to return to this list. Source: Office of Property Assessment ",-1),JC=se("h5",{class:"subtitle is-5"},"Condominiums",-1),QC={class:"table is-fullwidth is-striped"},eI=se("thead",null,[se("tr",null,[se("th",null,"Address"),se("th",null,"OPA Account #")])],-1),tI={__name:"Condos",setup(e){console.log("Condos.vue setup");const r=Rf(),a=Gi(()=>r.condosData);return(u,d)=>(Lt(),Xt("section",null,[YC,JC,se("table",QC,[eI,se("tbody",null,[(Lt(!0),Xt(Nr,null,Ca(a.value,y=>(Lt(),Xt("tr",null,[se("td",null,[or(ar(Bv),{to:{name:"address-and-topic",params:{address:y.properties.opa_address,topic:"Property"}}},{default:To(()=>[Jd(ei(y.properties.opa_address),1)]),_:2},1032,["to"])]),se("td",null,ei(y.properties.opa_account_num),1)]))),256))])])]))}},Vh=Do("ParcelsStore",{state:()=>({pwd:{},dor:{}}),actions:{async fillPwdParcelData(){const r=Ln().addressData.features;if(!r)return;const a=r[0],u=a.properties.pwd_parcel_id;if(!u){console.log("no pwd parcel in AIS"),await this.fillParcelDataByLngLat(a.geometry.coordinates[0],a.geometry.coordinates[1],"pwd");return}try{const d=await fetch(`https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/PWD_PARCELS/FeatureServer/0/query?where=PARCELID=%27${u}%27&outSR=4326&f=geojson&outFields=*&returnGeometry=true`);d.ok?this.pwd=await d.json():console.error("Failed to fetch pwd parcel data")}catch{console.error("Failed to fetch pwd parcel data")}},async fillDorParcelData(){const r=Ln().addressData.features;if(!r)return;const a=r[0],u=a.properties.dor_parcel_id;if(!u){console.log("no dor parcel in AIS"),await this.fillParcelDataByLngLat(a.geometry.coordinates[0],a.geometry.coordinates[1],"dor");return}try{const d=await fetch(`https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/DOR_Parcel/FeatureServer/0/query?where=MAPREG=%27${u}%27&outSR=4326&f=geojson&outFields=*&returnGeometry=true`);d.ok?this.dor=await d.json():console.error("Failed to fetch dor parcel data")}catch{console.error("Failed to fetch dor parcel data")}},async fillParcelDataByLngLat(e,r,a){console.log("fillParcelDataByLngLat, lng:",e,"lat:",r,"parcelLayer:",a);let u=a==="pwd"?"PWD_PARCELS":"DOR_Parcel",d={where:"1=1",outSR:4326,f:"geojson",outFields:"*",returnGeometry:!0,geometry:`{ "x": ${e}, "y": ${r}, "spatialReference":{ "wkid":4326 }}`,geometryType:"esriGeometryPoint",spatialRel:"esriSpatialRelWithin"};const y=await vr(`https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/${u}/FeatureServer/0/query`,{params:d});console.log("response",y),y.data.features.length>0&&(this[a]=await y.data)}}}),Zc=function(e){var r=e?String(e):"";return r=r.replace(/\s+/g,""),[null,"0"].indexOf(r)>-1?"":r},iI=function(e,r){console.log("concatDorAddress is running, parcel:",e),r=!!r;var a=["STDIR","STNAM","STDES","STDESSUF"],u=e.properties,d=Zc(u.HOUSE),y=Zc(u.STEX),m=Zc(u.SUF),l=d;l=l+(y?"-"+y:""),l=l+(m||"");var T=Zc(u.UNIT);T&&(T="# "+T);var P=a.map(function(R){return u[R]});return P=P.map(Zc),P=[l].concat(P),r&&(P=P.concat([T])),l=P.filter(Boolean).join(" "),l===""&&(l="Parcel has no address"),console.log("concatDorAddress address result:",l),l},yx=Do("DorStore",{state:()=>({dorDocuments:{}}),actions:{async fillDorDocuments(){this.dorDocuments={};const e=Vh(),r=Ln(),a="//services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/RTT_SUMMARY/FeatureServer/0/query",u=function(d){console.log("where function is running, feature:",d);var y=iI(d),m=r.addressData.features[0].properties,l;if(!y||y==="null")l="MATCHED_REGMAP = '"+e.dor.features[0].properties.BASEREG+"'";else{var T=r.addressData.features[0].properties,P=T.address_low,R=Math.floor(P/100,1)*100,D=P-R,z=T.address_high,Z=z||P;l="(((ADDRESS_LOW >= "+P+" AND ADDRESS_LOW <= "+Z+") OR (ADDRESS_LOW >= "+R+" AND ADDRESS_LOW <= "+Z+" AND ADDRESS_HIGH >= "+D+" )) AND STREET_NAME = '"+m.street_name+"' AND STREET_SUFFIX = '"+m.street_suffix+"' AND (MOD(ADDRESS_LOW,2) = MOD( "+P+",2))",m.street_predir!=""&&(l+=" AND STREET_PREDIR = '"+m.street_predir+"'"),m.address_low_suffix!=""&&(l+=" AND ADDRESS_LOW_SUFFIX = '"+m.address_low_suffix+"'"),m.address_low_suffix==""&&(l+=" AND ADDRESS_LOW_SUFFIX = ''"),m.address_low_frac==="1/2"&&(l+=" AND ADDRESS_LOW_SUFFIX = '2'"),m.street_postdir!=""&&(l+=" AND STREET_POSTDIR = '"+m.street_postdir+"'");var K=Zc(d.properties.UNIT),Y=m.unit_num;K?l+=" AND UNIT_NUM = '"+K+"'":Y!==""&&(l+=" AND UNIT_NUM = '"+Y+"'"),l+=") or MATCHED_REGMAP = '"+e.dor.features[0].properties.BASEREG+"'",l+=" or REG_MAP_ID = '"+e.dor.features[0].properties.BASEREG+"'"}return l};for(let d of e.dor.features){const m={where:u(d),outFields:"DOCUMENT_ID, DISPLAY_DATE, DOCUMENT_TYPE, GRANTORS, GRANTEES",returnDistinctValues:"true",returnGeometry:"false",f:"json",sqlFormat:"standard"};console.log("params:",m);const l=await vr(a,{params:m});this.dorDocuments[d.properties.OBJECTID]=l}}}});function rI(e){e("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),e("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),e("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),e.WGS84=e["EPSG:4326"],e["EPSG:3785"]=e["EPSG:3857"],e.GOOGLE=e["EPSG:3857"],e["EPSG:900913"]=e["EPSG:3857"],e["EPSG:102113"]=e["EPSG:3857"]}var lc=1,cc=2,ru=3,nI=4,ym=5,X_=6378137,sI=6356752314e-3,K_=.0066943799901413165,yh=484813681109536e-20,pt=Math.PI/2,aI=.16666666666666666,oI=.04722222222222222,lI=.022156084656084655,Dt=1e-10,$n=.017453292519943295,eo=57.29577951308232,er=Math.PI/4,Ph=Math.PI*2,hn=3.14159265359,ks={};ks.greenwich=0;ks.lisbon=-9.131906111111;ks.paris=2.337229166667;ks.bogota=-74.080916666667;ks.madrid=-3.687938888889;ks.rome=12.452333333333;ks.bern=7.439583333333;ks.jakarta=106.807719444444;ks.ferro=-17.666666666667;ks.brussels=4.367975;ks.stockholm=18.058277777778;ks.athens=23.7163375;ks.oslo=10.722916666667;const cI={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var Y_=/[\s_\-\/\(\)]/g;function Ml(e,r){if(e[r])return e[r];for(var a=Object.keys(e),u=r.toLowerCase().replace(Y_,""),d=-1,y,m;++d<a.length;)if(y=a[d],m=y.toLowerCase().replace(Y_,""),m===u)return e[y]}function _m(e){var r={},a=e.split("+").map(function(l){return l.trim()}).filter(function(l){return l}).reduce(function(l,T){var P=T.split("=");return P.push(!0),l[P[0].toLowerCase()]=P[1],l},{}),u,d,y,m={proj:"projName",datum:"datumCode",rf:function(l){r.rf=parseFloat(l)},lat_0:function(l){r.lat0=l*$n},lat_1:function(l){r.lat1=l*$n},lat_2:function(l){r.lat2=l*$n},lat_ts:function(l){r.lat_ts=l*$n},lon_0:function(l){r.long0=l*$n},lon_1:function(l){r.long1=l*$n},lon_2:function(l){r.long2=l*$n},alpha:function(l){r.alpha=parseFloat(l)*$n},gamma:function(l){r.rectified_grid_angle=parseFloat(l)},lonc:function(l){r.longc=l*$n},x_0:function(l){r.x0=parseFloat(l)},y_0:function(l){r.y0=parseFloat(l)},k_0:function(l){r.k0=parseFloat(l)},k:function(l){r.k0=parseFloat(l)},a:function(l){r.a=parseFloat(l)},b:function(l){r.b=parseFloat(l)},r:function(l){r.a=r.b=parseFloat(l)},r_a:function(){r.R_A=!0},zone:function(l){r.zone=parseInt(l,10)},south:function(){r.utmSouth=!0},towgs84:function(l){r.datum_params=l.split(",").map(function(T){return parseFloat(T)})},to_meter:function(l){r.to_meter=parseFloat(l)},units:function(l){r.units=l;var T=Ml(cI,l);T&&(r.to_meter=T.to_meter)},from_greenwich:function(l){r.from_greenwich=l*$n},pm:function(l){var T=Ml(ks,l);r.from_greenwich=(T||parseFloat(l))*$n},nadgrids:function(l){l==="@null"?r.datumCode="none":r.nadgrids=l},axis:function(l){var T="ewnsud";l.length===3&&T.indexOf(l.substr(0,1))!==-1&&T.indexOf(l.substr(1,1))!==-1&&T.indexOf(l.substr(2,1))!==-1&&(r.axis=l)},approx:function(){r.approx=!0}};for(u in a)d=a[u],u in m?(y=m[u],typeof y=="function"?y(d):r[y]=d):r[u]=d;return typeof r.datumCode=="string"&&r.datumCode!=="WGS84"&&(r.datumCode=r.datumCode.toLowerCase()),r}var Dh=1,_x=2,vx=3,nf=4,xx=5,Jm=-1,uI=/\s/,hI=/[A-Za-z]/,dI=/[A-Za-z84_]/,Of=/[,\]]/,bx=/[\d\.E\-\+]/;function ko(e){if(typeof e!="string")throw new Error("not a string");this.text=e.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=Dh}ko.prototype.readCharicter=function(){var e=this.text[this.place++];if(this.state!==nf)for(;uI.test(e);){if(this.place>=this.text.length)return;e=this.text[this.place++]}switch(this.state){case Dh:return this.neutral(e);case _x:return this.keyword(e);case nf:return this.quoted(e);case xx:return this.afterquote(e);case vx:return this.number(e);case Jm:return}};ko.prototype.afterquote=function(e){if(e==='"'){this.word+='"',this.state=nf;return}if(Of.test(e)){this.word=this.word.trim(),this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in afterquote yet, index '+this.place)};ko.prototype.afterItem=function(e){if(e===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=Dh;return}if(e==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=Dh,this.currentObject=this.stack.pop(),this.currentObject||(this.state=Jm);return}};ko.prototype.number=function(e){if(bx.test(e)){this.word+=e;return}if(Of.test(e)){this.word=parseFloat(this.word),this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in number yet, index '+this.place)};ko.prototype.quoted=function(e){if(e==='"'){this.state=xx;return}this.word+=e};ko.prototype.keyword=function(e){if(dI.test(e)){this.word+=e;return}if(e==="["){var r=[];r.push(this.word),this.level++,this.root===null?this.root=r:this.currentObject.push(r),this.stack.push(this.currentObject),this.currentObject=r,this.state=Dh;return}if(Of.test(e)){this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in keyword yet, index '+this.place)};ko.prototype.neutral=function(e){if(hI.test(e)){this.word=e,this.state=_x;return}if(e==='"'){this.word="",this.state=nf;return}if(bx.test(e)){this.word=e,this.state=vx;return}if(Of.test(e)){this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in neutral yet, index '+this.place)};ko.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===Jm)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function fI(e){var r=new ko(e);return r.output()}function J_(e,r,a){Array.isArray(r)&&(a.unshift(r),r=null);var u=r?{}:e,d=a.reduce(function(y,m){return Xc(m,y),y},u);r&&(e[r]=d)}function Xc(e,r){if(!Array.isArray(e)){r[e]=!0;return}var a=e.shift();if(a==="PARAMETER"&&(a=e.shift()),e.length===1){if(Array.isArray(e[0])){r[a]={},Xc(e[0],r[a]);return}r[a]=e[0];return}if(!e.length){r[a]=!0;return}if(a==="TOWGS84"){r[a]=e;return}if(a==="AXIS"){a in r||(r[a]=[]),r[a].push(e);return}Array.isArray(a)||(r[a]={});var u;switch(a){case"UNIT":case"PRIMEM":case"VERT_DATUM":r[a]={name:e[0].toLowerCase(),convert:e[1]},e.length===3&&Xc(e[2],r[a]);return;case"SPHEROID":case"ELLIPSOID":r[a]={name:e[0],a:e[1],rf:e[2]},e.length===4&&Xc(e[3],r[a]);return;case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":e[0]=["name",e[0]],J_(r,a,e);return;default:for(u=-1;++u<e.length;)if(!Array.isArray(e[u]))return Xc(e,r[a]);return J_(r,a,e)}}var pI=.017453292519943295;function mI(e,r){var a=r[0],u=r[1];!(a in e)&&u in e&&(e[a]=e[u],r.length===3&&(e[a]=r[2](e[a])))}function Xa(e){return e*pI}function gI(e){if(e.type==="GEOGCS"?e.projName="longlat":e.type==="LOCAL_CS"?(e.projName="identity",e.local=!0):typeof e.PROJECTION=="object"?e.projName=Object.keys(e.PROJECTION)[0]:e.projName=e.PROJECTION,e.AXIS){for(var r="",a=0,u=e.AXIS.length;a<u;++a){var d=[e.AXIS[a][0].toLowerCase(),e.AXIS[a][1].toLowerCase()];d[0].indexOf("north")!==-1||(d[0]==="y"||d[0]==="lat")&&d[1]==="north"?r+="n":d[0].indexOf("south")!==-1||(d[0]==="y"||d[0]==="lat")&&d[1]==="south"?r+="s":d[0].indexOf("east")!==-1||(d[0]==="x"||d[0]==="lon")&&d[1]==="east"?r+="e":(d[0].indexOf("west")!==-1||(d[0]==="x"||d[0]==="lon")&&d[1]==="west")&&(r+="w")}r.length===2&&(r+="u"),r.length===3&&(e.axis=r)}e.UNIT&&(e.units=e.UNIT.name.toLowerCase(),e.units==="metre"&&(e.units="meter"),e.UNIT.convert&&(e.type==="GEOGCS"?e.DATUM&&e.DATUM.SPHEROID&&(e.to_meter=e.UNIT.convert*e.DATUM.SPHEROID.a):e.to_meter=e.UNIT.convert));var y=e.GEOGCS;e.type==="GEOGCS"&&(y=e),y&&(y.DATUM?e.datumCode=y.DATUM.name.toLowerCase():e.datumCode=y.name.toLowerCase(),e.datumCode.slice(0,2)==="d_"&&(e.datumCode=e.datumCode.slice(2)),(e.datumCode==="new_zealand_geodetic_datum_1949"||e.datumCode==="new_zealand_1949")&&(e.datumCode="nzgd49"),(e.datumCode==="wgs_1984"||e.datumCode==="world_geodetic_system_1984")&&(e.PROJECTION==="Mercator_Auxiliary_Sphere"&&(e.sphere=!0),e.datumCode="wgs84"),e.datumCode.slice(-6)==="_ferro"&&(e.datumCode=e.datumCode.slice(0,-6)),e.datumCode.slice(-8)==="_jakarta"&&(e.datumCode=e.datumCode.slice(0,-8)),~e.datumCode.indexOf("belge")&&(e.datumCode="rnb72"),y.DATUM&&y.DATUM.SPHEROID&&(e.ellps=y.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),e.ellps.toLowerCase().slice(0,13)==="international"&&(e.ellps="intl"),e.a=y.DATUM.SPHEROID.a,e.rf=parseFloat(y.DATUM.SPHEROID.rf,10)),y.DATUM&&y.DATUM.TOWGS84&&(e.datum_params=y.DATUM.TOWGS84),~e.datumCode.indexOf("osgb_1936")&&(e.datumCode="osgb36"),~e.datumCode.indexOf("osni_1952")&&(e.datumCode="osni52"),(~e.datumCode.indexOf("tm65")||~e.datumCode.indexOf("geodetic_datum_of_1965"))&&(e.datumCode="ire65"),e.datumCode==="ch1903+"&&(e.datumCode="ch1903"),~e.datumCode.indexOf("israel")&&(e.datumCode="isr93")),e.b&&!isFinite(e.b)&&(e.b=e.a);function m(P){var R=e.to_meter||1;return P*R}var l=function(P){return mI(e,P)},T=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Xa],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Xa],["x0","false_easting",m],["y0","false_northing",m],["long0","central_meridian",Xa],["lat0","latitude_of_origin",Xa],["lat0","standard_parallel_1",Xa],["lat1","standard_parallel_1",Xa],["lat2","standard_parallel_2",Xa],["azimuth","Azimuth"],["alpha","azimuth",Xa],["srsCode","name"]];T.forEach(l),!e.long0&&e.longc&&(e.projName==="Albers_Conic_Equal_Area"||e.projName==="Lambert_Azimuthal_Equal_Area")&&(e.long0=e.longc),!e.lat_ts&&e.lat1&&(e.projName==="Stereographic_South_Pole"||e.projName==="Polar Stereographic (variant B)")?(e.lat0=Xa(e.lat1>0?90:-90),e.lat_ts=e.lat1):!e.lat_ts&&e.lat0&&e.projName==="Polar_Stereographic"&&(e.lat_ts=e.lat0,e.lat0=Xa(e.lat0>0?90:-90))}function wx(e){var r=fI(e),a=r.shift(),u=r.shift();r.unshift(["name",u]),r.unshift(["type",a]);var d={};return Xc(r,d),gI(d),d}function fs(e){var r=this;if(arguments.length===2){var a=arguments[1];typeof a=="string"?a.charAt(0)==="+"?fs[e]=_m(arguments[1]):fs[e]=wx(arguments[1]):fs[e]=a}else if(arguments.length===1){if(Array.isArray(e))return e.map(function(u){Array.isArray(u)?fs.apply(r,u):fs(u)});if(typeof e=="string"){if(e in fs)return fs[e]}else"EPSG"in e?fs["EPSG:"+e.EPSG]=e:"ESRI"in e?fs["ESRI:"+e.ESRI]=e:"IAU2000"in e?fs["IAU2000:"+e.IAU2000]=e:console.log(e);return}}rI(fs);function yI(e){return typeof e=="string"}function _I(e){return e in fs}var vI=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function xI(e){return vI.some(function(r){return e.indexOf(r)>-1})}var bI=["3857","900913","3785","102113"];function wI(e){var r=Ml(e,"authority");if(r){var a=Ml(r,"epsg");return a&&bI.indexOf(a)>-1}}function MI(e){var r=Ml(e,"extension");if(r)return Ml(r,"proj4")}function SI(e){return e[0]==="+"}function EI(e){if(yI(e)){if(_I(e))return fs[e];if(xI(e)){var r=wx(e);if(wI(r))return fs["EPSG:3857"];var a=MI(r);return a?_m(a):r}if(SI(e))return _m(e)}else return e}function Q_(e,r){e=e||{};var a,u;if(!r)return e;for(u in r)a=r[u],a!==void 0&&(e[u]=a);return e}function ro(e,r,a){var u=e*r;return a/Math.sqrt(1-u*u)}function jh(e){return e<0?-1:1}function Nt(e){return Math.abs(e)<=hn?e:e-jh(e)*Ph}function Da(e,r,a){var u=e*a,d=.5*e;return u=Math.pow((1-u)/(1+u),d),Math.tan(.5*(pt-r))/u}function kh(e,r){for(var a=.5*e,u,d,y=pt-2*Math.atan(r),m=0;m<=15;m++)if(u=e*Math.sin(y),d=pt-2*Math.atan(r*Math.pow((1-u)/(1+u),a))-y,y+=d,Math.abs(d)<=1e-10)return y;return-9999}function TI(){var e=this.b/this.a;this.es=1-e*e,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=ro(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function CI(e){var r=e.x,a=e.y;if(a*eo>90&&a*eo<-90&&r*eo>180&&r*eo<-180)return null;var u,d;if(Math.abs(Math.abs(a)-pt)<=Dt)return null;if(this.sphere)u=this.x0+this.a*this.k0*Nt(r-this.long0),d=this.y0+this.a*this.k0*Math.log(Math.tan(er+.5*a));else{var y=Math.sin(a),m=Da(this.e,a,y);u=this.x0+this.a*this.k0*Nt(r-this.long0),d=this.y0-this.a*this.k0*Math.log(m)}return e.x=u,e.y=d,e}function II(e){var r=e.x-this.x0,a=e.y-this.y0,u,d;if(this.sphere)d=pt-2*Math.atan(Math.exp(-a/(this.a*this.k0)));else{var y=Math.exp(-a/(this.a*this.k0));if(d=kh(this.e,y),d===-9999)return null}return u=Nt(this.long0+r/(this.a*this.k0)),e.x=u,e.y=d,e}var AI=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];const PI={init:TI,forward:CI,inverse:II,names:AI};function DI(){}function e0(e){return e}var kI=["longlat","identity"];const LI={init:DI,forward:e0,inverse:e0,names:kI};var RI=[PI,LI],jd={},sf=[];function Mx(e,r){var a=sf.length;return e.names?(sf[a]=e,e.names.forEach(function(u){jd[u.toLowerCase()]=a}),this):(console.log(r),!0)}function zI(e){if(!e)return!1;var r=e.toLowerCase();if(typeof jd[r]<"u"&&sf[jd[r]])return sf[jd[r]]}function OI(){RI.forEach(Mx)}const FI={start:OI,add:Mx,get:zI};var _i={};_i.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};_i.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};_i.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};_i.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};_i.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"};_i.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};_i.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};_i.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"};_i.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};_i.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};_i.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};_i.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"};_i.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};_i.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"};_i.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."};_i.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"};_i.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"};_i.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};_i.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};_i.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"};_i.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"};_i.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"};_i.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"};_i.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"};_i.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};_i.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};_i.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};_i.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};_i.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};_i.hough={a:6378270,rf:297,ellipseName:"Hough"};_i.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};_i.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};_i.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};_i.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};_i.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"};_i.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};_i.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};_i.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"};_i.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"};_i.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};_i.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};_i.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var BI=_i.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};_i.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function NI(e,r,a,u){var d=e*e,y=r*r,m=(d-y)/d,l=0;u?(e*=1-m*(aI+m*(oI+m*lI)),d=e*e,m=0):l=Math.sqrt(m);var T=(d-y)/y;return{es:m,e:l,ep2:T}}function $I(e,r,a,u,d){if(!e){var y=Ml(_i,u);y||(y=BI),e=y.a,r=y.b,a=y.rf}return a&&!r&&(r=(1-1/a)*e),(a===0||Math.abs(e-r)<Dt)&&(d=!0,r=e),{a:e,b:r,rf:a,sphere:d}}var In={};In.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"};In.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"};In.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"};In.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"};In.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"};In.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"};In.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"};In.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"};In.militargeographische_institut={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"};In.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"};In.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"};In.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"};In.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"};In.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"};In.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"};In.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"};In.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"};In.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};function UI(e,r,a,u,d,y,m){var l={};return e===void 0||e==="none"?l.datum_type=ym:l.datum_type=nI,r&&(l.datum_params=r.map(parseFloat),(l.datum_params[0]!==0||l.datum_params[1]!==0||l.datum_params[2]!==0)&&(l.datum_type=lc),l.datum_params.length>3&&(l.datum_params[3]!==0||l.datum_params[4]!==0||l.datum_params[5]!==0||l.datum_params[6]!==0)&&(l.datum_type=cc,l.datum_params[3]*=yh,l.datum_params[4]*=yh,l.datum_params[5]*=yh,l.datum_params[6]=l.datum_params[6]/1e6+1)),m&&(l.datum_type=ru,l.grids=m),l.a=a,l.b=u,l.es=d,l.ep2=y,l}var Sx={};function VI(e,r){var a=new DataView(r),u=GI(a),d=HI(a,u),y=ZI(a,d,u),m={header:d,subgrids:y};return Sx[e]=m,m}function jI(e){if(e===void 0)return null;var r=e.split(",");return r.map(qI)}function qI(e){if(e.length===0)return null;var r=e[0]==="@";return r&&(e=e.slice(1)),e==="null"?{name:"null",mandatory:!r,grid:null,isNull:!0}:{name:e,mandatory:!r,grid:Sx[e]||null,isNull:!1}}function Kc(e){return e/3600*Math.PI/180}function GI(e){var r=e.getInt32(8,!1);return r===11?!1:(r=e.getInt32(8,!0),r!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function HI(e,r){return{nFields:e.getInt32(8,r),nSubgridFields:e.getInt32(24,r),nSubgrids:e.getInt32(40,r),shiftType:vm(e,56,64).trim(),fromSemiMajorAxis:e.getFloat64(120,r),fromSemiMinorAxis:e.getFloat64(136,r),toSemiMajorAxis:e.getFloat64(152,r),toSemiMinorAxis:e.getFloat64(168,r)}}function vm(e,r,a){return String.fromCharCode.apply(null,new Uint8Array(e.buffer.slice(r,a)))}function ZI(e,r,a){for(var u=176,d=[],y=0;y<r.nSubgrids;y++){var m=XI(e,u,a),l=KI(e,u,m,a),T=Math.round(1+(m.upperLongitude-m.lowerLongitude)/m.longitudeInterval),P=Math.round(1+(m.upperLatitude-m.lowerLatitude)/m.latitudeInterval);d.push({ll:[Kc(m.lowerLongitude),Kc(m.lowerLatitude)],del:[Kc(m.longitudeInterval),Kc(m.latitudeInterval)],lim:[T,P],count:m.gridNodeCount,cvs:WI(l)}),u+=176+m.gridNodeCount*16}return d}function WI(e){return e.map(function(r){return[Kc(r.longitudeShift),Kc(r.latitudeShift)]})}function XI(e,r,a){return{name:vm(e,r+8,r+16).trim(),parent:vm(e,r+24,r+24+8).trim(),lowerLatitude:e.getFloat64(r+72,a),upperLatitude:e.getFloat64(r+88,a),lowerLongitude:e.getFloat64(r+104,a),upperLongitude:e.getFloat64(r+120,a),latitudeInterval:e.getFloat64(r+136,a),longitudeInterval:e.getFloat64(r+152,a),gridNodeCount:e.getInt32(r+168,a)}}function KI(e,r,a,u){for(var d=r+176,y=16,m=[],l=0;l<a.gridNodeCount;l++){var T={latitudeShift:e.getFloat32(d+l*y,u),longitudeShift:e.getFloat32(d+l*y+4,u),latitudeAccuracy:e.getFloat32(d+l*y+8,u),longitudeAccuracy:e.getFloat32(d+l*y+12,u)};m.push(T)}return m}function to(e,r){if(!(this instanceof to))return new to(e);r=r||function(P){if(P)throw P};var a=EI(e);if(typeof a!="object"){r(e);return}var u=to.projections.get(a.projName);if(!u){r(e);return}if(a.datumCode&&a.datumCode!=="none"){var d=Ml(In,a.datumCode);d&&(a.datum_params=a.datum_params||(d.towgs84?d.towgs84.split(","):null),a.ellps=d.ellipse,a.datumName=d.datumName?d.datumName:a.datumCode)}a.k0=a.k0||1,a.axis=a.axis||"enu",a.ellps=a.ellps||"wgs84",a.lat1=a.lat1||a.lat0;var y=$I(a.a,a.b,a.rf,a.ellps,a.sphere),m=NI(y.a,y.b,y.rf,a.R_A),l=jI(a.nadgrids),T=a.datum||UI(a.datumCode,a.datum_params,y.a,y.b,m.es,m.ep2,l);Q_(this,a),Q_(this,u),this.a=y.a,this.b=y.b,this.rf=y.rf,this.sphere=y.sphere,this.es=m.es,this.e=m.e,this.ep2=m.ep2,this.datum=T,this.init(),r(null,this)}to.projections=FI;to.projections.start();function YI(e,r){return e.datum_type!==r.datum_type||e.a!==r.a||Math.abs(e.es-r.es)>5e-11?!1:e.datum_type===lc?e.datum_params[0]===r.datum_params[0]&&e.datum_params[1]===r.datum_params[1]&&e.datum_params[2]===r.datum_params[2]:e.datum_type===cc?e.datum_params[0]===r.datum_params[0]&&e.datum_params[1]===r.datum_params[1]&&e.datum_params[2]===r.datum_params[2]&&e.datum_params[3]===r.datum_params[3]&&e.datum_params[4]===r.datum_params[4]&&e.datum_params[5]===r.datum_params[5]&&e.datum_params[6]===r.datum_params[6]:!0}function Ex(e,r,a){var u=e.x,d=e.y,y=e.z?e.z:0,m,l,T,P;if(d<-pt&&d>-1.001*pt)d=-pt;else if(d>pt&&d<1.001*pt)d=pt;else{if(d<-pt)return{x:-1/0,y:-1/0,z:e.z};if(d>pt)return{x:1/0,y:1/0,z:e.z}}return u>Math.PI&&(u-=2*Math.PI),l=Math.sin(d),P=Math.cos(d),T=l*l,m=a/Math.sqrt(1-r*T),{x:(m+y)*P*Math.cos(u),y:(m+y)*P*Math.sin(u),z:(m*(1-r)+y)*l}}function Tx(e,r,a,u){var d=1e-12,y=d*d,m=30,l,T,P,R,D,z,Z,K,Y,me,Te,Fe,ae,Pe=e.x,Ze=e.y,Je=e.z?e.z:0,dt,_t,xt;if(l=Math.sqrt(Pe*Pe+Ze*Ze),T=Math.sqrt(Pe*Pe+Ze*Ze+Je*Je),l/a<d){if(dt=0,T/a<d)return _t=pt,xt=-u,{x:e.x,y:e.y,z:e.z}}else dt=Math.atan2(Ze,Pe);P=Je/T,R=l/T,D=1/Math.sqrt(1-r*(2-r)*R*R),K=R*(1-r)*D,Y=P*D,ae=0;do ae++,Z=a/Math.sqrt(1-r*Y*Y),xt=l*K+Je*Y-Z*(1-r*Y*Y),z=r*Z/(Z+xt),D=1/Math.sqrt(1-z*(2-z)*R*R),me=R*(1-z)*D,Te=P*D,Fe=Te*K-me*Y,K=me,Y=Te;while(Fe*Fe>y&&ae<m);return _t=Math.atan(Te/Math.abs(me)),{x:dt,y:_t,z:xt}}function JI(e,r,a){if(r===lc)return{x:e.x+a[0],y:e.y+a[1],z:e.z+a[2]};if(r===cc){var u=a[0],d=a[1],y=a[2],m=a[3],l=a[4],T=a[5],P=a[6];return{x:P*(e.x-T*e.y+l*e.z)+u,y:P*(T*e.x+e.y-m*e.z)+d,z:P*(-l*e.x+m*e.y+e.z)+y}}}function QI(e,r,a){if(r===lc)return{x:e.x-a[0],y:e.y-a[1],z:e.z-a[2]};if(r===cc){var u=a[0],d=a[1],y=a[2],m=a[3],l=a[4],T=a[5],P=a[6],R=(e.x-u)/P,D=(e.y-d)/P,z=(e.z-y)/P;return{x:R+T*D-l*z,y:-T*R+D+m*z,z:l*R-m*D+z}}}function Dd(e){return e===lc||e===cc}function eA(e,r,a){if(YI(e,r)||e.datum_type===ym||r.datum_type===ym)return a;var u=e.a,d=e.es;if(e.datum_type===ru){var y=t0(e,!1,a);if(y!==0)return;u=X_,d=K_}var m=r.a,l=r.b,T=r.es;if(r.datum_type===ru&&(m=X_,l=sI,T=K_),d===T&&u===m&&!Dd(e.datum_type)&&!Dd(r.datum_type))return a;if(a=Ex(a,d,u),Dd(e.datum_type)&&(a=JI(a,e.datum_type,e.datum_params)),Dd(r.datum_type)&&(a=QI(a,r.datum_type,r.datum_params)),a=Tx(a,T,m,l),r.datum_type===ru){var P=t0(r,!0,a);if(P!==0)return}return a}function t0(e,r,a){if(e.grids===null||e.grids.length===0)return console.log("Grid shift grids not found"),-1;var u={x:-a.x,y:a.y},d={x:Number.NaN,y:Number.NaN},y=[];e:for(var m=0;m<e.grids.length;m++){var l=e.grids[m];if(y.push(l.name),l.isNull){d=u;break}if(l.mandatory,l.grid===null){if(l.mandatory)return console.log("Unable to find mandatory grid '"+l.name+"'"),-1;continue}for(var T=l.grid.subgrids,P=0,R=T.length;P<R;P++){var D=T[P],z=(Math.abs(D.del[1])+Math.abs(D.del[0]))/1e4,Z=D.ll[0]-z,K=D.ll[1]-z,Y=D.ll[0]+(D.lim[0]-1)*D.del[0]+z,me=D.ll[1]+(D.lim[1]-1)*D.del[1]+z;if(!(K>u.y||Z>u.x||me<u.y||Y<u.x)&&(d=tA(u,r,D),!isNaN(d.x)))break e}}return isNaN(d.x)?(console.log("Failed to find a grid shift table for location '"+-u.x*eo+" "+u.y*eo+" tried: '"+y+"'"),-1):(a.x=-d.x,a.y=d.y,0)}function tA(e,r,a){var u={x:Number.NaN,y:Number.NaN};if(isNaN(e.x))return u;var d={x:e.x,y:e.y};d.x-=a.ll[0],d.y-=a.ll[1],d.x=Nt(d.x-Math.PI)+Math.PI;var y=i0(d,a);if(r){if(isNaN(y.x))return u;y.x=d.x-y.x,y.y=d.y-y.y;var m=9,l=1e-12,T,P;do{if(P=i0(y,a),isNaN(P.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}T={x:d.x-(P.x+y.x),y:d.y-(P.y+y.y)},y.x+=T.x,y.y+=T.y}while(m--&&Math.abs(T.x)>l&&Math.abs(T.y)>l);if(m<0)return console.log("Inverse grid shift iterator failed to converge."),u;u.x=Nt(y.x+a.ll[0]),u.y=y.y+a.ll[1]}else isNaN(y.x)||(u.x=e.x+y.x,u.y=e.y+y.y);return u}function i0(e,r){var a={x:e.x/r.del[0],y:e.y/r.del[1]},u={x:Math.floor(a.x),y:Math.floor(a.y)},d={x:a.x-1*u.x,y:a.y-1*u.y},y={x:Number.NaN,y:Number.NaN},m;if(u.x<0||u.x>=r.lim[0]||u.y<0||u.y>=r.lim[1])return y;m=u.y*r.lim[0]+u.x;var l={x:r.cvs[m][0],y:r.cvs[m][1]};m++;var T={x:r.cvs[m][0],y:r.cvs[m][1]};m+=r.lim[0];var P={x:r.cvs[m][0],y:r.cvs[m][1]};m--;var R={x:r.cvs[m][0],y:r.cvs[m][1]},D=d.x*d.y,z=d.x*(1-d.y),Z=(1-d.x)*(1-d.y),K=(1-d.x)*d.y;return y.x=Z*l.x+z*T.x+K*R.x+D*P.x,y.y=Z*l.y+z*T.y+K*R.y+D*P.y,y}function r0(e,r,a){var u=a.x,d=a.y,y=a.z||0,m,l,T,P={};for(T=0;T<3;T++)if(!(r&&T===2&&a.z===void 0))switch(T===0?(m=u,"ew".indexOf(e.axis[T])!==-1?l="x":l="y"):T===1?(m=d,"ns".indexOf(e.axis[T])!==-1?l="y":l="x"):(m=y,l="z"),e.axis[T]){case"e":P[l]=m;break;case"w":P[l]=-m;break;case"n":P[l]=m;break;case"s":P[l]=-m;break;case"u":a[l]!==void 0&&(P.z=m);break;case"d":a[l]!==void 0&&(P.z=-m);break;default:return null}return P}function Cx(e){var r={x:e[0],y:e[1]};return e.length>2&&(r.z=e[2]),e.length>3&&(r.m=e[3]),r}function iA(e){n0(e.x),n0(e.y)}function n0(e){if(typeof Number.isFinite=="function"){if(Number.isFinite(e))return;throw new TypeError("coordinates must be finite numbers")}if(typeof e!="number"||e!==e||!isFinite(e))throw new TypeError("coordinates must be finite numbers")}function rA(e,r){return(e.datum.datum_type===lc||e.datum.datum_type===cc||e.datum.datum_type===ru)&&r.datumCode!=="WGS84"||(r.datum.datum_type===lc||r.datum.datum_type===cc||r.datum.datum_type===ru)&&e.datumCode!=="WGS84"}function af(e,r,a,u){var d;Array.isArray(a)?a=Cx(a):a={x:a.x,y:a.y,z:a.z,m:a.m};var y=a.z!==void 0;if(iA(a),e.datum&&r.datum&&rA(e,r)&&(d=new to("WGS84"),a=af(e,d,a,u),e=d),u&&e.axis!=="enu"&&(a=r0(e,!1,a)),e.projName==="longlat")a={x:a.x*$n,y:a.y*$n,z:a.z||0};else if(e.to_meter&&(a={x:a.x*e.to_meter,y:a.y*e.to_meter,z:a.z||0}),a=e.inverse(a),!a)return;if(e.from_greenwich&&(a.x+=e.from_greenwich),a=eA(e.datum,r.datum,a),!!a)return r.from_greenwich&&(a={x:a.x-r.from_greenwich,y:a.y,z:a.z||0}),r.projName==="longlat"?a={x:a.x*eo,y:a.y*eo,z:a.z||0}:(a=r.forward(a),r.to_meter&&(a={x:a.x/r.to_meter,y:a.y/r.to_meter,z:a.z||0})),u&&r.axis!=="enu"?r0(r,!0,a):(a&&!y&&delete a.z,a)}var s0=to("WGS84");function jp(e,r,a,u){var d,y,m;return Array.isArray(a)?(d=af(e,r,a,u)||{x:NaN,y:NaN},a.length>2?typeof e.name<"u"&&e.name==="geocent"||typeof r.name<"u"&&r.name==="geocent"?typeof d.z=="number"?[d.x,d.y,d.z].concat(a.splice(3)):[d.x,d.y,a[2]].concat(a.splice(3)):[d.x,d.y].concat(a.splice(2)):[d.x,d.y]):(y=af(e,r,a,u),m=Object.keys(a),m.length===2||m.forEach(function(l){if(typeof e.name<"u"&&e.name==="geocent"||typeof r.name<"u"&&r.name==="geocent"){if(l==="x"||l==="y"||l==="z")return}else if(l==="x"||l==="y")return;y[l]=a[l]}),y)}function a0(e){return e instanceof to?e:e.oProj?e.oProj:to(e)}function Zs(e,r,a){e=a0(e);var u=!1,d;return typeof r>"u"?(r=e,e=s0,u=!0):(typeof r.x<"u"||Array.isArray(r))&&(a=r,r=e,e=s0,u=!0),r=a0(r),a?jp(e,r,a):(d={forward:function(y,m){return jp(e,r,y,m)},inverse:function(y,m){return jp(r,e,y,m)}},u&&(d.oProj=r),d)}var o0=6,Ix="AJSAJS",Ax="AFAFAF",Yc=65,Is=73,sa=79,oh=86,lh=90;const nA={forward:Px,inverse:sA,toPoint:Dx};function Px(e,r){return r=r||5,lA(aA({lat:e[1],lon:e[0]}),r)}function sA(e){var r=Qm(Lx(e.toUpperCase()));return r.lat&&r.lon?[r.lon,r.lat,r.lon,r.lat]:[r.left,r.bottom,r.right,r.top]}function Dx(e){var r=Qm(Lx(e.toUpperCase()));return r.lat&&r.lon?[r.lon,r.lat]:[(r.left+r.right)/2,(r.top+r.bottom)/2]}function qp(e){return e*(Math.PI/180)}function l0(e){return 180*(e/Math.PI)}function aA(e){var r=e.lat,a=e.lon,u=6378137,d=.00669438,y=.9996,m,l,T,P,R,D,z,Z=qp(r),K=qp(a),Y,me;me=Math.floor((a+180)/6)+1,a===180&&(me=60),r>=56&&r<64&&a>=3&&a<12&&(me=32),r>=72&&r<84&&(a>=0&&a<9?me=31:a>=9&&a<21?me=33:a>=21&&a<33?me=35:a>=33&&a<42&&(me=37)),m=(me-1)*6-180+3,Y=qp(m),l=d/(1-d),T=u/Math.sqrt(1-d*Math.sin(Z)*Math.sin(Z)),P=Math.tan(Z)*Math.tan(Z),R=l*Math.cos(Z)*Math.cos(Z),D=Math.cos(Z)*(K-Y),z=u*((1-d/4-3*d*d/64-5*d*d*d/256)*Z-(3*d/8+3*d*d/32+45*d*d*d/1024)*Math.sin(2*Z)+(15*d*d/256+45*d*d*d/1024)*Math.sin(4*Z)-35*d*d*d/3072*Math.sin(6*Z));var Te=y*T*(D+(1-P+R)*D*D*D/6+(5-18*P+P*P+72*R-58*l)*D*D*D*D*D/120)+5e5,Fe=y*(z+T*Math.tan(Z)*(D*D/2+(5-P+9*R+4*R*R)*D*D*D*D/24+(61-58*P+P*P+600*R-330*l)*D*D*D*D*D*D/720));return r<0&&(Fe+=1e7),{northing:Math.round(Fe),easting:Math.round(Te),zoneNumber:me,zoneLetter:oA(r)}}function Qm(e){var r=e.northing,a=e.easting,u=e.zoneLetter,d=e.zoneNumber;if(d<0||d>60)return null;var y=.9996,m=6378137,l=.00669438,T,P=(1-Math.sqrt(1-l))/(1+Math.sqrt(1-l)),R,D,z,Z,K,Y,me,Te,Fe,ae=a-5e5,Pe=r;u<"N"&&(Pe-=1e7),me=(d-1)*6-180+3,T=l/(1-l),Y=Pe/y,Te=Y/(m*(1-l/4-3*l*l/64-5*l*l*l/256)),Fe=Te+(3*P/2-27*P*P*P/32)*Math.sin(2*Te)+(21*P*P/16-55*P*P*P*P/32)*Math.sin(4*Te)+151*P*P*P/96*Math.sin(6*Te),R=m/Math.sqrt(1-l*Math.sin(Fe)*Math.sin(Fe)),D=Math.tan(Fe)*Math.tan(Fe),z=T*Math.cos(Fe)*Math.cos(Fe),Z=m*(1-l)/Math.pow(1-l*Math.sin(Fe)*Math.sin(Fe),1.5),K=ae/(R*y);var Ze=Fe-R*Math.tan(Fe)/Z*(K*K/2-(5+3*D+10*z-4*z*z-9*T)*K*K*K*K/24+(61+90*D+298*z+45*D*D-252*T-3*z*z)*K*K*K*K*K*K/720);Ze=l0(Ze);var Je=(K-(1+2*D+z)*K*K*K/6+(5-2*z+28*D-3*z*z+8*T+24*D*D)*K*K*K*K*K/120)/Math.cos(Fe);Je=me+l0(Je);var dt;if(e.accuracy){var _t=Qm({northing:e.northing+e.accuracy,easting:e.easting+e.accuracy,zoneLetter:e.zoneLetter,zoneNumber:e.zoneNumber});dt={top:_t.lat,right:_t.lon,bottom:Ze,left:Je}}else dt={lat:Ze,lon:Je};return dt}function oA(e){var r="Z";return 84>=e&&e>=72?r="X":72>e&&e>=64?r="W":64>e&&e>=56?r="V":56>e&&e>=48?r="U":48>e&&e>=40?r="T":40>e&&e>=32?r="S":32>e&&e>=24?r="R":24>e&&e>=16?r="Q":16>e&&e>=8?r="P":8>e&&e>=0?r="N":0>e&&e>=-8?r="M":-8>e&&e>=-16?r="L":-16>e&&e>=-24?r="K":-24>e&&e>=-32?r="J":-32>e&&e>=-40?r="H":-40>e&&e>=-48?r="G":-48>e&&e>=-56?r="F":-56>e&&e>=-64?r="E":-64>e&&e>=-72?r="D":-72>e&&e>=-80&&(r="C"),r}function lA(e,r){var a="00000"+e.easting,u="00000"+e.northing;return e.zoneNumber+e.zoneLetter+cA(e.easting,e.northing,e.zoneNumber)+a.substr(a.length-5,r)+u.substr(u.length-5,r)}function cA(e,r,a){var u=kx(a),d=Math.floor(e/1e5),y=Math.floor(r/1e5)%20;return uA(d,y,u)}function kx(e){var r=e%o0;return r===0&&(r=o0),r}function uA(e,r,a){var u=a-1,d=Ix.charCodeAt(u),y=Ax.charCodeAt(u),m=d+e-1,l=y+r,T=!1;m>lh&&(m=m-lh+Yc-1,T=!0),(m===Is||d<Is&&m>Is||(m>Is||d<Is)&&T)&&m++,(m===sa||d<sa&&m>sa||(m>sa||d<sa)&&T)&&(m++,m===Is&&m++),m>lh&&(m=m-lh+Yc-1),l>oh?(l=l-oh+Yc-1,T=!0):T=!1,(l===Is||y<Is&&l>Is||(l>Is||y<Is)&&T)&&l++,(l===sa||y<sa&&l>sa||(l>sa||y<sa)&&T)&&(l++,l===Is&&l++),l>oh&&(l=l-oh+Yc-1);var P=String.fromCharCode(m)+String.fromCharCode(l);return P}function Lx(e){if(e&&e.length===0)throw"MGRSPoint coverting from nothing";for(var r=e.length,a=null,u="",d,y=0;!/[A-Z]/.test(d=e.charAt(y));){if(y>=2)throw"MGRSPoint bad conversion from: "+e;u+=d,y++}var m=parseInt(u,10);if(y===0||y+3>r)throw"MGRSPoint bad conversion from: "+e;var l=e.charAt(y++);if(l<="A"||l==="B"||l==="Y"||l>="Z"||l==="I"||l==="O")throw"MGRSPoint zone letter "+l+" not handled: "+e;a=e.substring(y,y+=2);for(var T=kx(m),P=hA(a.charAt(0),T),R=dA(a.charAt(1),T);R<fA(l);)R+=2e6;var D=r-y;if(D%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+e;var z=D/2,Z=0,K=0,Y,me,Te,Fe,ae;return z>0&&(Y=1e5/Math.pow(10,z),me=e.substring(y,y+z),Z=parseFloat(me)*Y,Te=e.substring(y+z),K=parseFloat(Te)*Y),Fe=Z+P,ae=K+R,{easting:Fe,northing:ae,zoneLetter:l,zoneNumber:m,accuracy:Y}}function hA(e,r){for(var a=Ix.charCodeAt(r-1),u=1e5,d=!1;a!==e.charCodeAt(0);){if(a++,a===Is&&a++,a===sa&&a++,a>lh){if(d)throw"Bad character: "+e;a=Yc,d=!0}u+=1e5}return u}function dA(e,r){if(e>"V")throw"MGRSPoint given invalid Northing "+e;for(var a=Ax.charCodeAt(r-1),u=0,d=!1;a!==e.charCodeAt(0);){if(a++,a===Is&&a++,a===sa&&a++,a>oh){if(d)throw"Bad character: "+e;a=Yc,d=!0}u+=1e5}return u}function fA(e){var r;switch(e){case"C":r=11e5;break;case"D":r=2e6;break;case"E":r=28e5;break;case"F":r=37e5;break;case"G":r=46e5;break;case"H":r=55e5;break;case"J":r=64e5;break;case"K":r=73e5;break;case"L":r=82e5;break;case"M":r=91e5;break;case"N":r=0;break;case"P":r=8e5;break;case"Q":r=17e5;break;case"R":r=26e5;break;case"S":r=35e5;break;case"T":r=44e5;break;case"U":r=53e5;break;case"V":r=62e5;break;case"W":r=7e6;break;case"X":r=79e5;break;default:r=-1}if(r>=0)return r;throw"Invalid zone letter: "+e}function uu(e,r,a){if(!(this instanceof uu))return new uu(e,r,a);if(Array.isArray(e))this.x=e[0],this.y=e[1],this.z=e[2]||0;else if(typeof e=="object")this.x=e.x,this.y=e.y,this.z=e.z||0;else if(typeof e=="string"&&typeof r>"u"){var u=e.split(",");this.x=parseFloat(u[0],10),this.y=parseFloat(u[1],10),this.z=parseFloat(u[2],10)||0}else this.x=e,this.y=r,this.z=a||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}uu.fromMGRS=function(e){return new uu(Dx(e))};uu.prototype.toMGRS=function(e){return Px([this.x,this.y],e)};var pA=1,mA=.25,c0=.046875,u0=.01953125,h0=.01068115234375,gA=.75,yA=.46875,_A=.013020833333333334,vA=.007120768229166667,xA=.3645833333333333,bA=.005696614583333333,wA=.3076171875;function Rx(e){var r=[];r[0]=pA-e*(mA+e*(c0+e*(u0+e*h0))),r[1]=e*(gA-e*(c0+e*(u0+e*h0)));var a=e*e;return r[2]=a*(yA-e*(_A+e*vA)),a*=e,r[3]=a*(xA-e*bA),r[4]=a*e*wA,r}function Ff(e,r,a,u){return a*=r,r*=r,u[0]*e-a*(u[1]+r*(u[2]+r*(u[3]+r*u[4])))}var MA=20;function zx(e,r,a){for(var u=1/(1-r),d=e,y=MA;y;--y){var m=Math.sin(d),l=1-r*m*m;if(l=(Ff(d,m,Math.cos(d),a)-e)*(l*Math.sqrt(l))*u,d-=l,Math.abs(l)<Dt)return d}return d}function SA(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=Rx(this.es),this.ml0=Ff(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function EA(e){var r=e.x,a=e.y,u=Nt(r-this.long0),d,y,m,l=Math.sin(a),T=Math.cos(a);if(this.es){var R=T*u,D=Math.pow(R,2),z=this.ep2*Math.pow(T,2),Z=Math.pow(z,2),K=Math.abs(T)>Dt?Math.tan(a):0,Y=Math.pow(K,2),me=Math.pow(Y,2);d=1-this.es*Math.pow(l,2),R=R/Math.sqrt(d);var Te=Ff(a,l,T,this.en);y=this.a*(this.k0*R*(1+D/6*(1-Y+z+D/20*(5-18*Y+me+14*z-58*Y*z+D/42*(61+179*me-me*Y-479*Y)))))+this.x0,m=this.a*(this.k0*(Te-this.ml0+l*u*R/2*(1+D/12*(5-Y+9*z+4*Z+D/30*(61+me-58*Y+270*z-330*Y*z+D/56*(1385+543*me-me*Y-3111*Y))))))+this.y0}else{var P=T*Math.sin(u);if(Math.abs(Math.abs(P)-1)<Dt)return 93;if(y=.5*this.a*this.k0*Math.log((1+P)/(1-P))+this.x0,m=T*Math.cos(u)/Math.sqrt(1-Math.pow(P,2)),P=Math.abs(m),P>=1){if(P-1>Dt)return 93;m=0}else m=Math.acos(m);a<0&&(m=-m),m=this.a*this.k0*(m-this.lat0)+this.y0}return e.x=y,e.y=m,e}function TA(e){var r,a,u,d,y=(e.x-this.x0)*(1/this.a),m=(e.y-this.y0)*(1/this.a);if(this.es)if(r=this.ml0+m/this.k0,a=zx(r,this.es,this.en),Math.abs(a)<pt){var D=Math.sin(a),z=Math.cos(a),Z=Math.abs(z)>Dt?Math.tan(a):0,K=this.ep2*Math.pow(z,2),Y=Math.pow(K,2),me=Math.pow(Z,2),Te=Math.pow(me,2);r=1-this.es*Math.pow(D,2);var Fe=y*Math.sqrt(r)/this.k0,ae=Math.pow(Fe,2);r=r*Z,u=a-r*ae/(1-this.es)*.5*(1-ae/12*(5+3*me-9*K*me+K-4*Y-ae/30*(61+90*me-252*K*me+45*Te+46*K-ae/56*(1385+3633*me+4095*Te+1574*Te*me)))),d=Nt(this.long0+Fe*(1-ae/6*(1+2*me+K-ae/20*(5+28*me+24*Te+8*K*me+6*K-ae/42*(61+662*me+1320*Te+720*Te*me))))/z)}else u=pt*jh(m),d=0;else{var l=Math.exp(y/this.k0),T=.5*(l-1/l),P=this.lat0+m/this.k0,R=Math.cos(P);r=Math.sqrt((1-Math.pow(R,2))/(1+Math.pow(T,2))),u=Math.asin(r),m<0&&(u=-u),T===0&&R===0?d=0:d=Nt(Math.atan2(T,R)+this.long0)}return e.x=d,e.y=u,e}var CA=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const qd={init:SA,forward:EA,inverse:TA,names:CA};function Ox(e){var r=Math.exp(e);return r=(r-1/r)/2,r}function aa(e,r){e=Math.abs(e),r=Math.abs(r);var a=Math.max(e,r),u=Math.min(e,r)/(a||1);return a*Math.sqrt(1+Math.pow(u,2))}function IA(e){var r=1+e,a=r-1;return a===0?e:e*Math.log(r)/a}function AA(e){var r=Math.abs(e);return r=IA(r*(1+r/(aa(1,r)+1))),e<0?-r:r}function eg(e,r){for(var a=2*Math.cos(2*r),u=e.length-1,d=e[u],y=0,m;--u>=0;)m=-y+a*d+e[u],y=d,d=m;return r+m*Math.sin(2*r)}function PA(e,r){for(var a=2*Math.cos(r),u=e.length-1,d=e[u],y=0,m;--u>=0;)m=-y+a*d+e[u],y=d,d=m;return Math.sin(r)*m}function DA(e){var r=Math.exp(e);return r=(r+1/r)/2,r}function Fx(e,r,a){for(var u=Math.sin(r),d=Math.cos(r),y=Ox(a),m=DA(a),l=2*d*m,T=-2*u*y,P=e.length-1,R=e[P],D=0,z=0,Z=0,K,Y;--P>=0;)K=z,Y=D,z=R,D=Z,R=-K+l*z-T*D+e[P],Z=-Y+T*z+l*D;return l=u*m,T=d*y,[l*R-T*Z,l*Z+T*R]}function kA(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(qd.init.apply(this),this.forward=qd.forward,this.inverse=qd.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var e=this.es/(1+Math.sqrt(1-this.es)),r=e/(2-e),a=r;this.cgb[0]=r*(2+r*(-2/3+r*(-2+r*(116/45+r*(26/45+r*(-2854/675)))))),this.cbg[0]=r*(-2+r*(2/3+r*(4/3+r*(-82/45+r*(32/45+r*(4642/4725)))))),a=a*r,this.cgb[1]=a*(7/3+r*(-8/5+r*(-227/45+r*(2704/315+r*(2323/945))))),this.cbg[1]=a*(5/3+r*(-16/15+r*(-13/9+r*(904/315+r*(-1522/945))))),a=a*r,this.cgb[2]=a*(56/15+r*(-136/35+r*(-1262/105+r*(73814/2835)))),this.cbg[2]=a*(-26/15+r*(34/21+r*(8/5+r*(-12686/2835)))),a=a*r,this.cgb[3]=a*(4279/630+r*(-332/35+r*(-399572/14175))),this.cbg[3]=a*(1237/630+r*(-12/5+r*(-24832/14175))),a=a*r,this.cgb[4]=a*(4174/315+r*(-144838/6237)),this.cbg[4]=a*(-734/315+r*(109598/31185)),a=a*r,this.cgb[5]=a*(601676/22275),this.cbg[5]=a*(444337/155925),a=Math.pow(r,2),this.Qn=this.k0/(1+r)*(1+a*(1/4+a*(1/64+a/256))),this.utg[0]=r*(-.5+r*(2/3+r*(-37/96+r*(1/360+r*(81/512+r*(-96199/604800)))))),this.gtu[0]=r*(.5+r*(-2/3+r*(5/16+r*(41/180+r*(-127/288+r*(7891/37800)))))),this.utg[1]=a*(-1/48+r*(-1/15+r*(437/1440+r*(-46/105+r*(1118711/3870720))))),this.gtu[1]=a*(13/48+r*(-3/5+r*(557/1440+r*(281/630+r*(-1983433/1935360))))),a=a*r,this.utg[2]=a*(-17/480+r*(37/840+r*(209/4480+r*(-5569/90720)))),this.gtu[2]=a*(61/240+r*(-103/140+r*(15061/26880+r*(167603/181440)))),a=a*r,this.utg[3]=a*(-4397/161280+r*(11/504+r*(830251/7257600))),this.gtu[3]=a*(49561/161280+r*(-179/168+r*(6601661/7257600))),a=a*r,this.utg[4]=a*(-4583/161280+r*(108847/3991680)),this.gtu[4]=a*(34729/80640+r*(-3418889/1995840)),a=a*r,this.utg[5]=a*(-20648693/638668800),this.gtu[5]=a*(212378941/319334400);var u=eg(this.cbg,this.lat0);this.Zb=-this.Qn*(u+PA(this.gtu,2*u))}function LA(e){var r=Nt(e.x-this.long0),a=e.y;a=eg(this.cbg,a);var u=Math.sin(a),d=Math.cos(a),y=Math.sin(r),m=Math.cos(r);a=Math.atan2(u,m*d),r=Math.atan2(y*d,aa(u,d*m)),r=AA(Math.tan(r));var l=Fx(this.gtu,2*a,2*r);a=a+l[0],r=r+l[1];var T,P;return Math.abs(r)<=2.623395162778?(T=this.a*(this.Qn*r)+this.x0,P=this.a*(this.Qn*a+this.Zb)+this.y0):(T=1/0,P=1/0),e.x=T,e.y=P,e}function RA(e){var r=(e.x-this.x0)*(1/this.a),a=(e.y-this.y0)*(1/this.a);a=(a-this.Zb)/this.Qn,r=r/this.Qn;var u,d;if(Math.abs(r)<=2.623395162778){var y=Fx(this.utg,2*a,2*r);a=a+y[0],r=r+y[1],r=Math.atan(Ox(r));var m=Math.sin(a),l=Math.cos(a),T=Math.sin(r),P=Math.cos(r);a=Math.atan2(m*P,aa(T,P*l)),r=Math.atan2(T,P*l),u=Nt(r+this.long0),d=eg(this.cgb,a)}else u=1/0,d=1/0;return e.x=u,e.y=d,e}var zA=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const Gd={init:kA,forward:LA,inverse:RA,names:zA};function OA(e,r){if(e===void 0){if(e=Math.floor((Nt(r)+Math.PI)*30/Math.PI)+1,e<0)return 0;if(e>60)return 60}return e}var FA="etmerc";function BA(){var e=OA(this.zone,this.long0);if(e===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(e)-183)*$n,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Gd.init.apply(this),this.forward=Gd.forward,this.inverse=Gd.inverse}var NA=["Universal Transverse Mercator System","utm"];const $A={init:BA,names:NA,dependsOn:FA};function tg(e,r){return Math.pow((1-e)/(1+e),r)}var UA=20;function VA(){var e=Math.sin(this.lat0),r=Math.cos(this.lat0);r*=r,this.rc=Math.sqrt(1-this.es)/(1-this.es*e*e),this.C=Math.sqrt(1+this.es*r*r/(1-this.es)),this.phic0=Math.asin(e/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+er)/(Math.pow(Math.tan(.5*this.lat0+er),this.C)*tg(this.e*e,this.ratexp))}function jA(e){var r=e.x,a=e.y;return e.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*a+er),this.C)*tg(this.e*Math.sin(a),this.ratexp))-pt,e.x=this.C*r,e}function qA(e){for(var r=1e-14,a=e.x/this.C,u=e.y,d=Math.pow(Math.tan(.5*u+er)/this.K,1/this.C),y=UA;y>0&&(u=2*Math.atan(d*tg(this.e*Math.sin(e.y),-.5*this.e))-pt,!(Math.abs(u-e.y)<r));--y)e.y=u;return y?(e.x=a,e.y=u,e):null}var GA=["gauss"];const ig={init:VA,forward:jA,inverse:qA,names:GA};function HA(){ig.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function ZA(e){var r,a,u,d;return e.x=Nt(e.x-this.long0),ig.forward.apply(this,[e]),r=Math.sin(e.y),a=Math.cos(e.y),u=Math.cos(e.x),d=this.k0*this.R2/(1+this.sinc0*r+this.cosc0*a*u),e.x=d*a*Math.sin(e.x),e.y=d*(this.cosc0*r-this.sinc0*a*u),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function WA(e){var r,a,u,d,y;if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,y=aa(e.x,e.y)){var m=2*Math.atan2(y,this.R2);r=Math.sin(m),a=Math.cos(m),d=Math.asin(a*this.sinc0+e.y*r*this.cosc0/y),u=Math.atan2(e.x*r,y*this.cosc0*a-e.y*this.sinc0*r)}else d=this.phic0,u=0;return e.x=u,e.y=d,ig.inverse.apply(this,[e]),e.x=Nt(e.x+this.long0),e}var XA=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const KA={init:HA,forward:ZA,inverse:WA,names:XA};function YA(e,r,a){return r*=a,Math.tan(.5*(pt+e))*Math.pow((1-r)/(1+r),.5*a)}function JA(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Dt&&(this.k0=.5*(1+jh(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=Dt&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Dt&&Math.abs(Math.cos(this.lat_ts))>Dt&&(this.k0=.5*this.cons*ro(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Da(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=ro(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-pt,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function QA(e){var r=e.x,a=e.y,u=Math.sin(a),d=Math.cos(a),y,m,l,T,P,R,D=Nt(r-this.long0);return Math.abs(Math.abs(r-this.long0)-Math.PI)<=Dt&&Math.abs(a+this.lat0)<=Dt?(e.x=NaN,e.y=NaN,e):this.sphere?(y=2*this.k0/(1+this.sinlat0*u+this.coslat0*d*Math.cos(D)),e.x=this.a*y*d*Math.sin(D)+this.x0,e.y=this.a*y*(this.coslat0*u-this.sinlat0*d*Math.cos(D))+this.y0,e):(m=2*Math.atan(this.ssfn_(a,u,this.e))-pt,T=Math.cos(m),l=Math.sin(m),Math.abs(this.coslat0)<=Dt?(P=Da(this.e,a*this.con,this.con*u),R=2*this.a*this.k0*P/this.cons,e.x=this.x0+R*Math.sin(r-this.long0),e.y=this.y0-this.con*R*Math.cos(r-this.long0),e):(Math.abs(this.sinlat0)<Dt?(y=2*this.a*this.k0/(1+T*Math.cos(D)),e.y=y*l):(y=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*l+this.cosX0*T*Math.cos(D))),e.y=y*(this.cosX0*l-this.sinX0*T*Math.cos(D))+this.y0),e.x=y*T*Math.sin(D)+this.x0,e))}function eP(e){e.x-=this.x0,e.y-=this.y0;var r,a,u,d,y,m=Math.sqrt(e.x*e.x+e.y*e.y);if(this.sphere){var l=2*Math.atan(m/(2*this.a*this.k0));return r=this.long0,a=this.lat0,m<=Dt?(e.x=r,e.y=a,e):(a=Math.asin(Math.cos(l)*this.sinlat0+e.y*Math.sin(l)*this.coslat0/m),Math.abs(this.coslat0)<Dt?this.lat0>0?r=Nt(this.long0+Math.atan2(e.x,-1*e.y)):r=Nt(this.long0+Math.atan2(e.x,e.y)):r=Nt(this.long0+Math.atan2(e.x*Math.sin(l),m*this.coslat0*Math.cos(l)-e.y*this.sinlat0*Math.sin(l))),e.x=r,e.y=a,e)}else if(Math.abs(this.coslat0)<=Dt){if(m<=Dt)return a=this.lat0,r=this.long0,e.x=r,e.y=a,e;e.x*=this.con,e.y*=this.con,u=m*this.cons/(2*this.a*this.k0),a=this.con*kh(this.e,u),r=this.con*Nt(this.con*this.long0+Math.atan2(e.x,-1*e.y))}else d=2*Math.atan(m*this.cosX0/(2*this.a*this.k0*this.ms1)),r=this.long0,m<=Dt?y=this.X0:(y=Math.asin(Math.cos(d)*this.sinX0+e.y*Math.sin(d)*this.cosX0/m),r=Nt(this.long0+Math.atan2(e.x*Math.sin(d),m*this.cosX0*Math.cos(d)-e.y*this.sinX0*Math.sin(d)))),a=-1*kh(this.e,Math.tan(.5*(pt+y)));return e.x=r,e.y=a,e}var tP=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"];const iP={init:JA,forward:QA,inverse:eP,names:tP,ssfn_:YA};function rP(){var e=this.lat0;this.lambda0=this.long0;var r=Math.sin(e),a=this.a,u=this.rf,d=1/u,y=2*d-Math.pow(d,2),m=this.e=Math.sqrt(y);this.R=this.k0*a*Math.sqrt(1-y)/(1-y*Math.pow(r,2)),this.alpha=Math.sqrt(1+y/(1-y)*Math.pow(Math.cos(e),4)),this.b0=Math.asin(r/this.alpha);var l=Math.log(Math.tan(Math.PI/4+this.b0/2)),T=Math.log(Math.tan(Math.PI/4+e/2)),P=Math.log((1+m*r)/(1-m*r));this.K=l-this.alpha*T+this.alpha*m/2*P}function nP(e){var r=Math.log(Math.tan(Math.PI/4-e.y/2)),a=this.e/2*Math.log((1+this.e*Math.sin(e.y))/(1-this.e*Math.sin(e.y))),u=-this.alpha*(r+a)+this.K,d=2*(Math.atan(Math.exp(u))-Math.PI/4),y=this.alpha*(e.x-this.lambda0),m=Math.atan(Math.sin(y)/(Math.sin(this.b0)*Math.tan(d)+Math.cos(this.b0)*Math.cos(y))),l=Math.asin(Math.cos(this.b0)*Math.sin(d)-Math.sin(this.b0)*Math.cos(d)*Math.cos(y));return e.y=this.R/2*Math.log((1+Math.sin(l))/(1-Math.sin(l)))+this.y0,e.x=this.R*m+this.x0,e}function sP(e){for(var r=e.x-this.x0,a=e.y-this.y0,u=r/this.R,d=2*(Math.atan(Math.exp(a/this.R))-Math.PI/4),y=Math.asin(Math.cos(this.b0)*Math.sin(d)+Math.sin(this.b0)*Math.cos(d)*Math.cos(u)),m=Math.atan(Math.sin(u)/(Math.cos(this.b0)*Math.cos(u)-Math.sin(this.b0)*Math.tan(d))),l=this.lambda0+m/this.alpha,T=0,P=y,R=-1e3,D=0;Math.abs(P-R)>1e-7;){if(++D>20)return;T=1/this.alpha*(Math.log(Math.tan(Math.PI/4+y/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(P))/2)),R=P,P=2*Math.atan(Math.exp(T))-Math.PI/2}return e.x=l,e.y=P,e}var aP=["somerc"];const oP={init:rP,forward:nP,inverse:sP,names:aP};var Wc=1e-7;function lP(e){var r=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],a=typeof e.PROJECTION=="object"?Object.keys(e.PROJECTION)[0]:e.PROJECTION;return"no_uoff"in e||"no_off"in e||r.indexOf(a)!==-1}function cP(){var e,r,a,u,d,y,m,l,T,P,R=0,D,z=0,Z=0,K=0,Y=0,me=0,Te=0;this.no_off=lP(this),this.no_rot="no_rot"in this;var Fe=!1;"alpha"in this&&(Fe=!0);var ae=!1;if("rectified_grid_angle"in this&&(ae=!0),Fe&&(Te=this.alpha),ae&&(R=this.rectified_grid_angle*$n),Fe||ae)z=this.longc;else if(Z=this.long1,Y=this.lat1,K=this.long2,me=this.lat2,Math.abs(Y-me)<=Wc||(e=Math.abs(Y))<=Wc||Math.abs(e-pt)<=Wc||Math.abs(Math.abs(this.lat0)-pt)<=Wc||Math.abs(Math.abs(me)-pt)<=Wc)throw new Error;var Pe=1-this.es;r=Math.sqrt(Pe),Math.abs(this.lat0)>Dt?(l=Math.sin(this.lat0),a=Math.cos(this.lat0),e=1-this.es*l*l,this.B=a*a,this.B=Math.sqrt(1+this.es*this.B*this.B/Pe),this.A=this.B*this.k0*r/e,u=this.B*r/(a*Math.sqrt(e)),d=u*u-1,d<=0?d=0:(d=Math.sqrt(d),this.lat0<0&&(d=-d)),this.E=d+=u,this.E*=Math.pow(Da(this.e,this.lat0,l),this.B)):(this.B=1/r,this.A=this.k0,this.E=u=d=1),Fe||ae?(Fe?(D=Math.asin(Math.sin(Te)/u),ae||(R=Te)):(D=R,Te=Math.asin(u*Math.sin(D))),this.lam0=z-Math.asin(.5*(d-1/d)*Math.tan(D))/this.B):(y=Math.pow(Da(this.e,Y,Math.sin(Y)),this.B),m=Math.pow(Da(this.e,me,Math.sin(me)),this.B),d=this.E/y,T=(m-y)/(m+y),P=this.E*this.E,P=(P-m*y)/(P+m*y),e=Z-K,e<-Math.pi?K-=Ph:e>Math.pi&&(K+=Ph),this.lam0=Nt(.5*(Z+K)-Math.atan(P*Math.tan(.5*this.B*(Z-K))/T)/this.B),D=Math.atan(2*Math.sin(this.B*Nt(Z-this.lam0))/(d-1/d)),R=Te=Math.asin(u*Math.sin(D))),this.singam=Math.sin(D),this.cosgam=Math.cos(D),this.sinrot=Math.sin(R),this.cosrot=Math.cos(R),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(u*u-1)/Math.cos(Te))),this.lat0<0&&(this.u_0=-this.u_0)),d=.5*D,this.v_pole_n=this.ArB*Math.log(Math.tan(er-d)),this.v_pole_s=this.ArB*Math.log(Math.tan(er+d))}function uP(e){var r={},a,u,d,y,m,l,T,P;if(e.x=e.x-this.lam0,Math.abs(Math.abs(e.y)-pt)>Dt){if(m=this.E/Math.pow(Da(this.e,e.y,Math.sin(e.y)),this.B),l=1/m,a=.5*(m-l),u=.5*(m+l),y=Math.sin(this.B*e.x),d=(a*this.singam-y*this.cosgam)/u,Math.abs(Math.abs(d)-1)<Dt)throw new Error;P=.5*this.ArB*Math.log((1-d)/(1+d)),l=Math.cos(this.B*e.x),Math.abs(l)<Wc?T=this.A*e.x:T=this.ArB*Math.atan2(a*this.cosgam+y*this.singam,l)}else P=e.y>0?this.v_pole_n:this.v_pole_s,T=this.ArB*e.y;return this.no_rot?(r.x=T,r.y=P):(T-=this.u_0,r.x=P*this.cosrot+T*this.sinrot,r.y=T*this.cosrot-P*this.sinrot),r.x=this.a*r.x+this.x0,r.y=this.a*r.y+this.y0,r}function hP(e){var r,a,u,d,y,m,l,T={};if(e.x=(e.x-this.x0)*(1/this.a),e.y=(e.y-this.y0)*(1/this.a),this.no_rot?(a=e.y,r=e.x):(a=e.x*this.cosrot-e.y*this.sinrot,r=e.y*this.cosrot+e.x*this.sinrot+this.u_0),u=Math.exp(-this.BrA*a),d=.5*(u-1/u),y=.5*(u+1/u),m=Math.sin(this.BrA*r),l=(m*this.cosgam+d*this.singam)/y,Math.abs(Math.abs(l)-1)<Dt)T.x=0,T.y=l<0?-pt:pt;else{if(T.y=this.E/Math.sqrt((1+l)/(1-l)),T.y=kh(this.e,Math.pow(T.y,1/this.B)),T.y===1/0)throw new Error;T.x=-this.rB*Math.atan2(d*this.cosgam-m*this.singam,Math.cos(this.BrA*r))}return T.x+=this.lam0,T}var dP=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const fP={init:cP,forward:uP,inverse:hP,names:dP};function pP(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<Dt)){var e=this.b/this.a;this.e=Math.sqrt(1-e*e);var r=Math.sin(this.lat1),a=Math.cos(this.lat1),u=ro(this.e,r,a),d=Da(this.e,this.lat1,r),y=Math.sin(this.lat2),m=Math.cos(this.lat2),l=ro(this.e,y,m),T=Da(this.e,this.lat2,y),P=Da(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>Dt?this.ns=Math.log(u/l)/Math.log(d/T):this.ns=r,isNaN(this.ns)&&(this.ns=r),this.f0=u/(this.ns*Math.pow(d,this.ns)),this.rh=this.a*this.f0*Math.pow(P,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function mP(e){var r=e.x,a=e.y;Math.abs(2*Math.abs(a)-Math.PI)<=Dt&&(a=jh(a)*(pt-2*Dt));var u=Math.abs(Math.abs(a)-pt),d,y;if(u>Dt)d=Da(this.e,a,Math.sin(a)),y=this.a*this.f0*Math.pow(d,this.ns);else{if(u=a*this.ns,u<=0)return null;y=0}var m=this.ns*Nt(r-this.long0);return e.x=this.k0*(y*Math.sin(m))+this.x0,e.y=this.k0*(this.rh-y*Math.cos(m))+this.y0,e}function gP(e){var r,a,u,d,y,m=(e.x-this.x0)/this.k0,l=this.rh-(e.y-this.y0)/this.k0;this.ns>0?(r=Math.sqrt(m*m+l*l),a=1):(r=-Math.sqrt(m*m+l*l),a=-1);var T=0;if(r!==0&&(T=Math.atan2(a*m,a*l)),r!==0||this.ns>0){if(a=1/this.ns,u=Math.pow(r/(this.a*this.f0),a),d=kh(this.e,u),d===-9999)return null}else d=-pt;return y=Nt(T/this.ns+this.long0),e.x=y,e.y=d,e}var yP=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const _P={init:pP,forward:mP,inverse:gP,names:yP};function vP(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function xP(e){var r,a,u,d,y,m,l,T=e.x,P=e.y,R=Nt(T-this.long0);return r=Math.pow((1+this.e*Math.sin(P))/(1-this.e*Math.sin(P)),this.alfa*this.e/2),a=2*(Math.atan(this.k*Math.pow(Math.tan(P/2+this.s45),this.alfa)/r)-this.s45),u=-R*this.alfa,d=Math.asin(Math.cos(this.ad)*Math.sin(a)+Math.sin(this.ad)*Math.cos(a)*Math.cos(u)),y=Math.asin(Math.cos(a)*Math.sin(u)/Math.cos(d)),m=this.n*y,l=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(d/2+this.s45),this.n),e.y=l*Math.cos(m)/1,e.x=l*Math.sin(m)/1,this.czech||(e.y*=-1,e.x*=-1),e}function bP(e){var r,a,u,d,y,m,l,T,P=e.x;e.x=e.y,e.y=P,this.czech||(e.y*=-1,e.x*=-1),m=Math.sqrt(e.x*e.x+e.y*e.y),y=Math.atan2(e.y,e.x),d=y/Math.sin(this.s0),u=2*(Math.atan(Math.pow(this.ro0/m,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),r=Math.asin(Math.cos(this.ad)*Math.sin(u)-Math.sin(this.ad)*Math.cos(u)*Math.cos(d)),a=Math.asin(Math.cos(u)*Math.sin(d)/Math.cos(r)),e.x=this.long0-a/this.alfa,l=r,T=0;var R=0;do e.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(r/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(l))/(1-this.e*Math.sin(l)),this.e/2))-this.s45),Math.abs(l-e.y)<1e-10&&(T=1),l=e.y,R+=1;while(T===0&&R<15);return R>=15?null:e}var wP=["Krovak","krovak"];const MP={init:vP,forward:xP,inverse:bP,names:wP};function gs(e,r,a,u,d){return e*d-r*Math.sin(2*d)+a*Math.sin(4*d)-u*Math.sin(6*d)}function qh(e){return 1-.25*e*(1+e/16*(3+1.25*e))}function Gh(e){return .375*e*(1+.25*e*(1+.46875*e))}function Hh(e){return .05859375*e*e*(1+.75*e)}function Zh(e){return e*e*e*(35/3072)}function hu(e,r,a){var u=r*a;return e/Math.sqrt(1-u*u)}function mu(e){return Math.abs(e)<pt?e:e-jh(e)*Math.PI}function of(e,r,a,u,d){var y,m;y=e/r;for(var l=0;l<15;l++)if(m=(e-(r*y-a*Math.sin(2*y)+u*Math.sin(4*y)-d*Math.sin(6*y)))/(r-2*a*Math.cos(2*y)+4*u*Math.cos(4*y)-6*d*Math.cos(6*y)),y+=m,Math.abs(m)<=1e-10)return y;return NaN}function SP(){this.sphere||(this.e0=qh(this.es),this.e1=Gh(this.es),this.e2=Hh(this.es),this.e3=Zh(this.es),this.ml0=this.a*gs(this.e0,this.e1,this.e2,this.e3,this.lat0))}function EP(e){var r,a,u=e.x,d=e.y;if(u=Nt(u-this.long0),this.sphere)r=this.a*Math.asin(Math.cos(d)*Math.sin(u)),a=this.a*(Math.atan2(Math.tan(d),Math.cos(u))-this.lat0);else{var y=Math.sin(d),m=Math.cos(d),l=hu(this.a,this.e,y),T=Math.tan(d)*Math.tan(d),P=u*Math.cos(d),R=P*P,D=this.es*m*m/(1-this.es),z=this.a*gs(this.e0,this.e1,this.e2,this.e3,d);r=l*P*(1-R*T*(1/6-(8-T+8*D)*R/120)),a=z-this.ml0+l*y/m*R*(.5+(5-T+6*D)*R/24)}return e.x=r+this.x0,e.y=a+this.y0,e}function TP(e){e.x-=this.x0,e.y-=this.y0;var r=e.x/this.a,a=e.y/this.a,u,d;if(this.sphere){var y=a+this.lat0;u=Math.asin(Math.sin(y)*Math.cos(r)),d=Math.atan2(Math.tan(r),Math.cos(y))}else{var m=this.ml0/this.a+a,l=of(m,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(l)-pt)<=Dt)return e.x=this.long0,e.y=pt,a<0&&(e.y*=-1),e;var T=hu(this.a,this.e,Math.sin(l)),P=T*T*T/this.a/this.a*(1-this.es),R=Math.pow(Math.tan(l),2),D=r*this.a/T,z=D*D;u=l-T*Math.tan(l)/P*D*D*(.5-(1+3*R)*D*D/24),d=D*(1-z*(R/3+(1+3*R)*R*z/15))/Math.cos(l)}return e.x=Nt(d+this.long0),e.y=mu(u),e}var CP=["Cassini","Cassini_Soldner","cass"];const IP={init:SP,forward:EP,inverse:TP,names:CP};function xl(e,r){var a;return e>1e-7?(a=e*r,(1-e*e)*(r/(1-a*a)-.5/e*Math.log((1-a)/(1+a)))):2*r}var AP=1,PP=2,DP=3,kP=4;function LP(){var e=Math.abs(this.lat0);if(Math.abs(e-pt)<Dt?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<Dt?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var r;switch(this.qp=xl(this.e,1),this.mmf=.5/(1-this.es),this.apa=VP(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),r=Math.sin(this.lat0),this.sinb1=xl(this.e,r)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*r*r)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function RP(e){var r,a,u,d,y,m,l,T,P,R,D=e.x,z=e.y;if(D=Nt(D-this.long0),this.sphere){if(y=Math.sin(z),R=Math.cos(z),u=Math.cos(D),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(a=this.mode===this.EQUIT?1+R*u:1+this.sinph0*y+this.cosph0*R*u,a<=Dt)return null;a=Math.sqrt(2/a),r=a*R*Math.sin(D),a*=this.mode===this.EQUIT?y:this.cosph0*y-this.sinph0*R*u}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(u=-u),Math.abs(z+this.lat0)<Dt)return null;a=er-z*.5,a=2*(this.mode===this.S_POLE?Math.cos(a):Math.sin(a)),r=a*Math.sin(D),a*=u}}else{switch(l=0,T=0,P=0,u=Math.cos(D),d=Math.sin(D),y=Math.sin(z),m=xl(this.e,y),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(l=m/this.qp,T=Math.sqrt(1-l*l)),this.mode){case this.OBLIQ:P=1+this.sinb1*l+this.cosb1*T*u;break;case this.EQUIT:P=1+T*u;break;case this.N_POLE:P=pt+z,m=this.qp-m;break;case this.S_POLE:P=z-pt,m=this.qp+m;break}if(Math.abs(P)<Dt)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:P=Math.sqrt(2/P),this.mode===this.OBLIQ?a=this.ymf*P*(this.cosb1*l-this.sinb1*T*u):a=(P=Math.sqrt(2/(1+T*u)))*l*this.ymf,r=this.xmf*P*T*d;break;case this.N_POLE:case this.S_POLE:m>=0?(r=(P=Math.sqrt(m))*d,a=u*(this.mode===this.S_POLE?P:-P)):r=a=0;break}}return e.x=this.a*r+this.x0,e.y=this.a*a+this.y0,e}function zP(e){e.x-=this.x0,e.y-=this.y0;var r=e.x/this.a,a=e.y/this.a,u,d,y,m,l,T,P;if(this.sphere){var R=0,D,z=0;if(D=Math.sqrt(r*r+a*a),d=D*.5,d>1)return null;switch(d=2*Math.asin(d),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(z=Math.sin(d),R=Math.cos(d)),this.mode){case this.EQUIT:d=Math.abs(D)<=Dt?0:Math.asin(a*z/D),r*=z,a=R*D;break;case this.OBLIQ:d=Math.abs(D)<=Dt?this.lat0:Math.asin(R*this.sinph0+a*z*this.cosph0/D),r*=z*this.cosph0,a=(R-Math.sin(d)*this.sinph0)*D;break;case this.N_POLE:a=-a,d=pt-d;break;case this.S_POLE:d-=pt;break}u=a===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(r,a)}else{if(P=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(r/=this.dd,a*=this.dd,T=Math.sqrt(r*r+a*a),T<Dt)return e.x=this.long0,e.y=this.lat0,e;m=2*Math.asin(.5*T/this.rq),y=Math.cos(m),r*=m=Math.sin(m),this.mode===this.OBLIQ?(P=y*this.sinb1+a*m*this.cosb1/T,l=this.qp*P,a=T*this.cosb1*y-a*this.sinb1*m):(P=a*m/T,l=this.qp*P,a=T*y)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(a=-a),l=r*r+a*a,!l)return e.x=this.long0,e.y=this.lat0,e;P=1-l/this.qp,this.mode===this.S_POLE&&(P=-P)}u=Math.atan2(r,a),d=jP(Math.asin(P),this.apa)}return e.x=Nt(this.long0+u),e.y=d,e}var OP=.3333333333333333,FP=.17222222222222222,BP=.10257936507936508,NP=.06388888888888888,$P=.0664021164021164,UP=.016415012942191543;function VP(e){var r,a=[];return a[0]=e*OP,r=e*e,a[0]+=r*FP,a[1]=r*NP,r*=e,a[0]+=r*BP,a[1]+=r*$P,a[2]=r*UP,a}function jP(e,r){var a=e+e;return e+r[0]*Math.sin(a)+r[1]*Math.sin(a+a)+r[2]*Math.sin(a+a+a)}var qP=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const GP={init:LP,forward:RP,inverse:zP,names:qP,S_POLE:AP,N_POLE:PP,EQUIT:DP,OBLIQ:kP};function Sl(e){return Math.abs(e)>1&&(e=e>1?1:-1),Math.asin(e)}function HP(){Math.abs(this.lat1+this.lat2)<Dt||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=ro(this.e3,this.sin_po,this.cos_po),this.qs1=xl(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=ro(this.e3,this.sin_po,this.cos_po),this.qs2=xl(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=xl(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>Dt?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function ZP(e){var r=e.x,a=e.y;this.sin_phi=Math.sin(a),this.cos_phi=Math.cos(a);var u=xl(this.e3,this.sin_phi),d=this.a*Math.sqrt(this.c-this.ns0*u)/this.ns0,y=this.ns0*Nt(r-this.long0),m=d*Math.sin(y)+this.x0,l=this.rh-d*Math.cos(y)+this.y0;return e.x=m,e.y=l,e}function WP(e){var r,a,u,d,y,m;return e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns0>=0?(r=Math.sqrt(e.x*e.x+e.y*e.y),u=1):(r=-Math.sqrt(e.x*e.x+e.y*e.y),u=-1),d=0,r!==0&&(d=Math.atan2(u*e.x,u*e.y)),u=r*this.ns0/this.a,this.sphere?m=Math.asin((this.c-u*u)/(2*this.ns0)):(a=(this.c-u*u)/this.ns0,m=this.phi1z(this.e3,a)),y=Nt(d/this.ns0+this.long0),e.x=y,e.y=m,e}function XP(e,r){var a,u,d,y,m,l=Sl(.5*r);if(e<Dt)return l;for(var T=e*e,P=1;P<=25;P++)if(a=Math.sin(l),u=Math.cos(l),d=e*a,y=1-d*d,m=.5*y*y/u*(r/(1-T)-a/y+.5/e*Math.log((1-d)/(1+d))),l=l+m,Math.abs(m)<=1e-7)return l;return null}var KP=["Albers_Conic_Equal_Area","Albers","aea"];const YP={init:HP,forward:ZP,inverse:WP,names:KP,phi1z:XP};function JP(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function QP(e){var r,a,u,d,y,m,l,T,P=e.x,R=e.y;return u=Nt(P-this.long0),r=Math.sin(R),a=Math.cos(R),d=Math.cos(u),m=this.sin_p14*r+this.cos_p14*a*d,y=1,m>0||Math.abs(m)<=Dt?(l=this.x0+this.a*y*a*Math.sin(u)/m,T=this.y0+this.a*y*(this.cos_p14*r-this.sin_p14*a*d)/m):(l=this.x0+this.infinity_dist*a*Math.sin(u),T=this.y0+this.infinity_dist*(this.cos_p14*r-this.sin_p14*a*d)),e.x=l,e.y=T,e}function eD(e){var r,a,u,d,y,m;return e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,(r=Math.sqrt(e.x*e.x+e.y*e.y))?(d=Math.atan2(r,this.rc),a=Math.sin(d),u=Math.cos(d),m=Sl(u*this.sin_p14+e.y*a*this.cos_p14/r),y=Math.atan2(e.x*a,r*this.cos_p14*u-e.y*this.sin_p14*a),y=Nt(this.long0+y)):(m=this.phic0,y=0),e.x=y,e.y=m,e}var tD=["gnom"];const iD={init:JP,forward:QP,inverse:eD,names:tD};function rD(e,r){var a=1-(1-e*e)/(2*e)*Math.log((1-e)/(1+e));if(Math.abs(Math.abs(r)-a)<1e-6)return r<0?-1*pt:pt;for(var u=Math.asin(.5*r),d,y,m,l,T=0;T<30;T++)if(y=Math.sin(u),m=Math.cos(u),l=e*y,d=Math.pow(1-l*l,2)/(2*m)*(r/(1-e*e)-y/(1-l*l)+.5/e*Math.log((1-l)/(1+l))),u+=d,Math.abs(d)<=1e-10)return u;return NaN}function nD(){this.sphere||(this.k0=ro(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function sD(e){var r=e.x,a=e.y,u,d,y=Nt(r-this.long0);if(this.sphere)u=this.x0+this.a*y*Math.cos(this.lat_ts),d=this.y0+this.a*Math.sin(a)/Math.cos(this.lat_ts);else{var m=xl(this.e,Math.sin(a));u=this.x0+this.a*this.k0*y,d=this.y0+this.a*m*.5/this.k0}return e.x=u,e.y=d,e}function aD(e){e.x-=this.x0,e.y-=this.y0;var r,a;return this.sphere?(r=Nt(this.long0+e.x/this.a/Math.cos(this.lat_ts)),a=Math.asin(e.y/this.a*Math.cos(this.lat_ts))):(a=rD(this.e,2*e.y*this.k0/this.a),r=Nt(this.long0+e.x/(this.a*this.k0))),e.x=r,e.y=a,e}var oD=["cea"];const lD={init:nD,forward:sD,inverse:aD,names:oD};function cD(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function uD(e){var r=e.x,a=e.y,u=Nt(r-this.long0),d=mu(a-this.lat0);return e.x=this.x0+this.a*u*this.rc,e.y=this.y0+this.a*d,e}function hD(e){var r=e.x,a=e.y;return e.x=Nt(this.long0+(r-this.x0)/(this.a*this.rc)),e.y=mu(this.lat0+(a-this.y0)/this.a),e}var dD=["Equirectangular","Equidistant_Cylindrical","eqc"];const fD={init:cD,forward:uD,inverse:hD,names:dD};var d0=20;function pD(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=qh(this.es),this.e1=Gh(this.es),this.e2=Hh(this.es),this.e3=Zh(this.es),this.ml0=this.a*gs(this.e0,this.e1,this.e2,this.e3,this.lat0)}function mD(e){var r=e.x,a=e.y,u,d,y,m=Nt(r-this.long0);if(y=m*Math.sin(a),this.sphere)Math.abs(a)<=Dt?(u=this.a*m,d=-1*this.a*this.lat0):(u=this.a*Math.sin(y)/Math.tan(a),d=this.a*(mu(a-this.lat0)+(1-Math.cos(y))/Math.tan(a)));else if(Math.abs(a)<=Dt)u=this.a*m,d=-1*this.ml0;else{var l=hu(this.a,this.e,Math.sin(a))/Math.tan(a);u=l*Math.sin(y),d=this.a*gs(this.e0,this.e1,this.e2,this.e3,a)-this.ml0+l*(1-Math.cos(y))}return e.x=u+this.x0,e.y=d+this.y0,e}function gD(e){var r,a,u,d,y,m,l,T,P;if(u=e.x-this.x0,d=e.y-this.y0,this.sphere)if(Math.abs(d+this.a*this.lat0)<=Dt)r=Nt(u/this.a+this.long0),a=0;else{m=this.lat0+d/this.a,l=u*u/this.a/this.a+m*m,T=m;var R;for(y=d0;y;--y)if(R=Math.tan(T),P=-1*(m*(T*R+1)-T-.5*(T*T+l)*R)/((T-m)/R-1),T+=P,Math.abs(P)<=Dt){a=T;break}r=Nt(this.long0+Math.asin(u*Math.tan(T)/this.a)/Math.sin(a))}else if(Math.abs(d+this.ml0)<=Dt)a=0,r=Nt(this.long0+u/this.a);else{m=(this.ml0+d)/this.a,l=u*u/this.a/this.a+m*m,T=m;var D,z,Z,K,Y;for(y=d0;y;--y)if(Y=this.e*Math.sin(T),D=Math.sqrt(1-Y*Y)*Math.tan(T),z=this.a*gs(this.e0,this.e1,this.e2,this.e3,T),Z=this.e0-2*this.e1*Math.cos(2*T)+4*this.e2*Math.cos(4*T)-6*this.e3*Math.cos(6*T),K=z/this.a,P=(m*(D*K+1)-K-.5*D*(K*K+l))/(this.es*Math.sin(2*T)*(K*K+l-2*m*K)/(4*D)+(m-K)*(D*Z-2/Math.sin(2*T))-Z),T-=P,Math.abs(P)<=Dt){a=T;break}D=Math.sqrt(1-this.es*Math.pow(Math.sin(a),2))*Math.tan(a),r=Nt(this.long0+Math.asin(u*D/this.a)/Math.sin(a))}return e.x=r,e.y=a,e}var yD=["Polyconic","poly"];const _D={init:pD,forward:mD,inverse:gD,names:yD};function vD(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function xD(e){var r,a=e.x,u=e.y,d=u-this.lat0,y=a-this.long0,m=d/yh*1e-5,l=y,T=1,P=0;for(r=1;r<=10;r++)T=T*m,P=P+this.A[r]*T;var R=P,D=l,z=1,Z=0,K,Y,me=0,Te=0;for(r=1;r<=6;r++)K=z*R-Z*D,Y=Z*R+z*D,z=K,Z=Y,me=me+this.B_re[r]*z-this.B_im[r]*Z,Te=Te+this.B_im[r]*z+this.B_re[r]*Z;return e.x=Te*this.a+this.x0,e.y=me*this.a+this.y0,e}function bD(e){var r,a=e.x,u=e.y,d=a-this.x0,y=u-this.y0,m=y/this.a,l=d/this.a,T=1,P=0,R,D,z=0,Z=0;for(r=1;r<=6;r++)R=T*m-P*l,D=P*m+T*l,T=R,P=D,z=z+this.C_re[r]*T-this.C_im[r]*P,Z=Z+this.C_im[r]*T+this.C_re[r]*P;for(var K=0;K<this.iterations;K++){var Y=z,me=Z,Te,Fe,ae=m,Pe=l;for(r=2;r<=6;r++)Te=Y*z-me*Z,Fe=me*z+Y*Z,Y=Te,me=Fe,ae=ae+(r-1)*(this.B_re[r]*Y-this.B_im[r]*me),Pe=Pe+(r-1)*(this.B_im[r]*Y+this.B_re[r]*me);Y=1,me=0;var Ze=this.B_re[1],Je=this.B_im[1];for(r=2;r<=6;r++)Te=Y*z-me*Z,Fe=me*z+Y*Z,Y=Te,me=Fe,Ze=Ze+r*(this.B_re[r]*Y-this.B_im[r]*me),Je=Je+r*(this.B_im[r]*Y+this.B_re[r]*me);var dt=Ze*Ze+Je*Je;z=(ae*Ze+Pe*Je)/dt,Z=(Pe*Ze-ae*Je)/dt}var _t=z,xt=Z,Vt=1,kt=0;for(r=1;r<=9;r++)Vt=Vt*_t,kt=kt+this.D[r]*Vt;var ri=this.lat0+kt*yh*1e5,xi=this.long0+xt;return e.x=xi,e.y=ri,e}var wD=["New_Zealand_Map_Grid","nzmg"];const MD={init:vD,forward:xD,inverse:bD,names:wD};function SD(){}function ED(e){var r=e.x,a=e.y,u=Nt(r-this.long0),d=this.x0+this.a*u,y=this.y0+this.a*Math.log(Math.tan(Math.PI/4+a/2.5))*1.25;return e.x=d,e.y=y,e}function TD(e){e.x-=this.x0,e.y-=this.y0;var r=Nt(this.long0+e.x/this.a),a=2.5*(Math.atan(Math.exp(.8*e.y/this.a))-Math.PI/4);return e.x=r,e.y=a,e}var CD=["Miller_Cylindrical","mill"];const ID={init:SD,forward:ED,inverse:TD,names:CD};var AD=20;function PD(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=Rx(this.es)}function DD(e){var r,a,u=e.x,d=e.y;if(u=Nt(u-this.long0),this.sphere){if(!this.m)d=this.n!==1?Math.asin(this.n*Math.sin(d)):d;else for(var y=this.n*Math.sin(d),m=AD;m;--m){var l=(this.m*d+Math.sin(d)-y)/(this.m+Math.cos(d));if(d-=l,Math.abs(l)<Dt)break}r=this.a*this.C_x*u*(this.m+Math.cos(d)),a=this.a*this.C_y*d}else{var T=Math.sin(d),P=Math.cos(d);a=this.a*Ff(d,T,P,this.en),r=this.a*u*P/Math.sqrt(1-this.es*T*T)}return e.x=r,e.y=a,e}function kD(e){var r,a,u,d;return e.x-=this.x0,u=e.x/this.a,e.y-=this.y0,r=e.y/this.a,this.sphere?(r/=this.C_y,u=u/(this.C_x*(this.m+Math.cos(r))),this.m?r=Sl((this.m*r+Math.sin(r))/this.n):this.n!==1&&(r=Sl(Math.sin(r)/this.n)),u=Nt(u+this.long0),r=mu(r)):(r=zx(e.y/this.a,this.es,this.en),d=Math.abs(r),d<pt?(d=Math.sin(r),a=this.long0+e.x*Math.sqrt(1-this.es*d*d)/(this.a*Math.cos(r)),u=Nt(a)):d-Dt<pt&&(u=this.long0)),e.x=u,e.y=r,e}var LD=["Sinusoidal","sinu"];const RD={init:PD,forward:DD,inverse:kD,names:LD};function zD(){}function OD(e){for(var r=e.x,a=e.y,u=Nt(r-this.long0),d=a,y=Math.PI*Math.sin(a);;){var m=-(d+Math.sin(d)-y)/(1+Math.cos(d));if(d+=m,Math.abs(m)<Dt)break}d/=2,Math.PI/2-Math.abs(a)<Dt&&(u=0);var l=.900316316158*this.a*u*Math.cos(d)+this.x0,T=1.4142135623731*this.a*Math.sin(d)+this.y0;return e.x=l,e.y=T,e}function FD(e){var r,a;e.x-=this.x0,e.y-=this.y0,a=e.y/(1.4142135623731*this.a),Math.abs(a)>.999999999999&&(a=.999999999999),r=Math.asin(a);var u=Nt(this.long0+e.x/(.900316316158*this.a*Math.cos(r)));u<-Math.PI&&(u=-Math.PI),u>Math.PI&&(u=Math.PI),a=(2*r+Math.sin(2*r))/Math.PI,Math.abs(a)>1&&(a=1);var d=Math.asin(a);return e.x=u,e.y=d,e}var BD=["Mollweide","moll"];const ND={init:zD,forward:OD,inverse:FD,names:BD};function $D(){Math.abs(this.lat1+this.lat2)<Dt||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=qh(this.es),this.e1=Gh(this.es),this.e2=Hh(this.es),this.e3=Zh(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=ro(this.e,this.sinphi,this.cosphi),this.ml1=gs(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<Dt?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=ro(this.e,this.sinphi,this.cosphi),this.ml2=gs(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=gs(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function UD(e){var r=e.x,a=e.y,u;if(this.sphere)u=this.a*(this.g-a);else{var d=gs(this.e0,this.e1,this.e2,this.e3,a);u=this.a*(this.g-d)}var y=this.ns*Nt(r-this.long0),m=this.x0+u*Math.sin(y),l=this.y0+this.rh-u*Math.cos(y);return e.x=m,e.y=l,e}function VD(e){e.x-=this.x0,e.y=this.rh-e.y+this.y0;var r,a,u,d;this.ns>=0?(a=Math.sqrt(e.x*e.x+e.y*e.y),r=1):(a=-Math.sqrt(e.x*e.x+e.y*e.y),r=-1);var y=0;if(a!==0&&(y=Math.atan2(r*e.x,r*e.y)),this.sphere)return d=Nt(this.long0+y/this.ns),u=mu(this.g-a/this.a),e.x=d,e.y=u,e;var m=this.g-a/this.a;return u=of(m,this.e0,this.e1,this.e2,this.e3),d=Nt(this.long0+y/this.ns),e.x=d,e.y=u,e}var jD=["Equidistant_Conic","eqdc"];const qD={init:$D,forward:UD,inverse:VD,names:jD};function GD(){this.R=this.a}function HD(e){var r=e.x,a=e.y,u=Nt(r-this.long0),d,y;Math.abs(a)<=Dt&&(d=this.x0+this.R*u,y=this.y0);var m=Sl(2*Math.abs(a/Math.PI));(Math.abs(u)<=Dt||Math.abs(Math.abs(a)-pt)<=Dt)&&(d=this.x0,a>=0?y=this.y0+Math.PI*this.R*Math.tan(.5*m):y=this.y0+Math.PI*this.R*-Math.tan(.5*m));var l=.5*Math.abs(Math.PI/u-u/Math.PI),T=l*l,P=Math.sin(m),R=Math.cos(m),D=R/(P+R-1),z=D*D,Z=D*(2/P-1),K=Z*Z,Y=Math.PI*this.R*(l*(D-K)+Math.sqrt(T*(D-K)*(D-K)-(K+T)*(z-K)))/(K+T);u<0&&(Y=-Y),d=this.x0+Y;var me=T+D;return Y=Math.PI*this.R*(Z*me-l*Math.sqrt((K+T)*(T+1)-me*me))/(K+T),a>=0?y=this.y0+Y:y=this.y0-Y,e.x=d,e.y=y,e}function ZD(e){var r,a,u,d,y,m,l,T,P,R,D,z,Z;return e.x-=this.x0,e.y-=this.y0,D=Math.PI*this.R,u=e.x/D,d=e.y/D,y=u*u+d*d,m=-Math.abs(d)*(1+y),l=m-2*d*d+u*u,T=-2*m+1+2*d*d+y*y,Z=d*d/T+(2*l*l*l/T/T/T-9*m*l/T/T)/27,P=(m-l*l/3/T)/T,R=2*Math.sqrt(-P/3),D=3*Z/P/R,Math.abs(D)>1&&(D>=0?D=1:D=-1),z=Math.acos(D)/3,e.y>=0?a=(-R*Math.cos(z+Math.PI/3)-l/3/T)*Math.PI:a=-(-R*Math.cos(z+Math.PI/3)-l/3/T)*Math.PI,Math.abs(u)<Dt?r=this.long0:r=Nt(this.long0+Math.PI*(y-1+Math.sqrt(1+2*(u*u-d*d)+y*y))/2/u),e.x=r,e.y=a,e}var WD=["Van_der_Grinten_I","VanDerGrinten","vandg"];const XD={init:GD,forward:HD,inverse:ZD,names:WD};function KD(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function YD(e){var r=e.x,a=e.y,u=Math.sin(e.y),d=Math.cos(e.y),y=Nt(r-this.long0),m,l,T,P,R,D,z,Z,K,Y,me,Te,Fe,ae,Pe,Ze,Je,dt,_t,xt,Vt,kt,ri;return this.sphere?Math.abs(this.sin_p12-1)<=Dt?(e.x=this.x0+this.a*(pt-a)*Math.sin(y),e.y=this.y0-this.a*(pt-a)*Math.cos(y),e):Math.abs(this.sin_p12+1)<=Dt?(e.x=this.x0+this.a*(pt+a)*Math.sin(y),e.y=this.y0+this.a*(pt+a)*Math.cos(y),e):(dt=this.sin_p12*u+this.cos_p12*d*Math.cos(y),Ze=Math.acos(dt),Je=Ze?Ze/Math.sin(Ze):1,e.x=this.x0+this.a*Je*d*Math.sin(y),e.y=this.y0+this.a*Je*(this.cos_p12*u-this.sin_p12*d*Math.cos(y)),e):(m=qh(this.es),l=Gh(this.es),T=Hh(this.es),P=Zh(this.es),Math.abs(this.sin_p12-1)<=Dt?(R=this.a*gs(m,l,T,P,pt),D=this.a*gs(m,l,T,P,a),e.x=this.x0+(R-D)*Math.sin(y),e.y=this.y0-(R-D)*Math.cos(y),e):Math.abs(this.sin_p12+1)<=Dt?(R=this.a*gs(m,l,T,P,pt),D=this.a*gs(m,l,T,P,a),e.x=this.x0+(R+D)*Math.sin(y),e.y=this.y0+(R+D)*Math.cos(y),e):(z=u/d,Z=hu(this.a,this.e,this.sin_p12),K=hu(this.a,this.e,u),Y=Math.atan((1-this.es)*z+this.es*Z*this.sin_p12/(K*d)),me=Math.atan2(Math.sin(y),this.cos_p12*Math.tan(Y)-this.sin_p12*Math.cos(y)),me===0?_t=Math.asin(this.cos_p12*Math.sin(Y)-this.sin_p12*Math.cos(Y)):Math.abs(Math.abs(me)-Math.PI)<=Dt?_t=-Math.asin(this.cos_p12*Math.sin(Y)-this.sin_p12*Math.cos(Y)):_t=Math.asin(Math.sin(y)*Math.cos(Y)/Math.sin(me)),Te=this.e*this.sin_p12/Math.sqrt(1-this.es),Fe=this.e*this.cos_p12*Math.cos(me)/Math.sqrt(1-this.es),ae=Te*Fe,Pe=Fe*Fe,xt=_t*_t,Vt=xt*_t,kt=Vt*_t,ri=kt*_t,Ze=Z*_t*(1-xt*Pe*(1-Pe)/6+Vt/8*ae*(1-2*Pe)+kt/120*(Pe*(4-7*Pe)-3*Te*Te*(1-7*Pe))-ri/48*ae),e.x=this.x0+Ze*Math.sin(me),e.y=this.y0+Ze*Math.cos(me),e))}function JD(e){e.x-=this.x0,e.y-=this.y0;var r,a,u,d,y,m,l,T,P,R,D,z,Z,K,Y,me,Te,Fe,ae,Pe,Ze,Je,dt,_t;return this.sphere?(r=Math.sqrt(e.x*e.x+e.y*e.y),r>2*pt*this.a?void 0:(a=r/this.a,u=Math.sin(a),d=Math.cos(a),y=this.long0,Math.abs(r)<=Dt?m=this.lat0:(m=Sl(d*this.sin_p12+e.y*u*this.cos_p12/r),l=Math.abs(this.lat0)-pt,Math.abs(l)<=Dt?this.lat0>=0?y=Nt(this.long0+Math.atan2(e.x,-e.y)):y=Nt(this.long0-Math.atan2(-e.x,e.y)):y=Nt(this.long0+Math.atan2(e.x*u,r*this.cos_p12*d-e.y*this.sin_p12*u))),e.x=y,e.y=m,e)):(T=qh(this.es),P=Gh(this.es),R=Hh(this.es),D=Zh(this.es),Math.abs(this.sin_p12-1)<=Dt?(z=this.a*gs(T,P,R,D,pt),r=Math.sqrt(e.x*e.x+e.y*e.y),Z=z-r,m=of(Z/this.a,T,P,R,D),y=Nt(this.long0+Math.atan2(e.x,-1*e.y)),e.x=y,e.y=m,e):Math.abs(this.sin_p12+1)<=Dt?(z=this.a*gs(T,P,R,D,pt),r=Math.sqrt(e.x*e.x+e.y*e.y),Z=r-z,m=of(Z/this.a,T,P,R,D),y=Nt(this.long0+Math.atan2(e.x,e.y)),e.x=y,e.y=m,e):(r=Math.sqrt(e.x*e.x+e.y*e.y),me=Math.atan2(e.x,e.y),K=hu(this.a,this.e,this.sin_p12),Te=Math.cos(me),Fe=this.e*this.cos_p12*Te,ae=-Fe*Fe/(1-this.es),Pe=3*this.es*(1-ae)*this.sin_p12*this.cos_p12*Te/(1-this.es),Ze=r/K,Je=Ze-ae*(1+ae)*Math.pow(Ze,3)/6-Pe*(1+3*ae)*Math.pow(Ze,4)/24,dt=1-ae*Je*Je/2-Ze*Je*Je*Je/6,Y=Math.asin(this.sin_p12*Math.cos(Je)+this.cos_p12*Math.sin(Je)*Te),y=Nt(this.long0+Math.asin(Math.sin(me)*Math.sin(Je)/Math.cos(Y))),_t=Math.sin(Y),m=Math.atan2((_t-this.es*dt*this.sin_p12)*Math.tan(Y),_t*(1-this.es)),e.x=y,e.y=m,e))}var QD=["Azimuthal_Equidistant","aeqd"];const ek={init:KD,forward:YD,inverse:JD,names:QD};function tk(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function ik(e){var r,a,u,d,y,m,l,T,P=e.x,R=e.y;return u=Nt(P-this.long0),r=Math.sin(R),a=Math.cos(R),d=Math.cos(u),m=this.sin_p14*r+this.cos_p14*a*d,y=1,(m>0||Math.abs(m)<=Dt)&&(l=this.a*y*a*Math.sin(u),T=this.y0+this.a*y*(this.cos_p14*r-this.sin_p14*a*d)),e.x=l,e.y=T,e}function rk(e){var r,a,u,d,y,m,l;return e.x-=this.x0,e.y-=this.y0,r=Math.sqrt(e.x*e.x+e.y*e.y),a=Sl(r/this.a),u=Math.sin(a),d=Math.cos(a),m=this.long0,Math.abs(r)<=Dt?(l=this.lat0,e.x=m,e.y=l,e):(l=Sl(d*this.sin_p14+e.y*u*this.cos_p14/r),y=Math.abs(this.lat0)-pt,Math.abs(y)<=Dt?(this.lat0>=0?m=Nt(this.long0+Math.atan2(e.x,-e.y)):m=Nt(this.long0-Math.atan2(-e.x,e.y)),e.x=m,e.y=l,e):(m=Nt(this.long0+Math.atan2(e.x*u,r*this.cos_p14*d-e.y*this.sin_p14*u)),e.x=m,e.y=l,e))}var nk=["ortho"];const sk={init:tk,forward:ik,inverse:rk,names:nk};var Gr={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},tr={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function ak(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=pt-er/2?this.face=Gr.TOP:this.lat0<=-(pt-er/2)?this.face=Gr.BOTTOM:Math.abs(this.long0)<=er?this.face=Gr.FRONT:Math.abs(this.long0)<=pt+er?this.face=this.long0>0?Gr.RIGHT:Gr.LEFT:this.face=Gr.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function ok(e){var r={x:0,y:0},a,u,d,y,m,l,T={value:0};if(e.x-=this.long0,this.es!==0?a=Math.atan(this.one_minus_f_squared*Math.tan(e.y)):a=e.y,u=e.x,this.face===Gr.TOP)y=pt-a,u>=er&&u<=pt+er?(T.value=tr.AREA_0,d=u-pt):u>pt+er||u<=-(pt+er)?(T.value=tr.AREA_1,d=u>0?u-hn:u+hn):u>-(pt+er)&&u<=-er?(T.value=tr.AREA_2,d=u+pt):(T.value=tr.AREA_3,d=u);else if(this.face===Gr.BOTTOM)y=pt+a,u>=er&&u<=pt+er?(T.value=tr.AREA_0,d=-u+pt):u<er&&u>=-er?(T.value=tr.AREA_1,d=-u):u<-er&&u>=-(pt+er)?(T.value=tr.AREA_2,d=-u-pt):(T.value=tr.AREA_3,d=u>0?-u+hn:-u-hn);else{var P,R,D,z,Z,K,Y;this.face===Gr.RIGHT?u=nu(u,+pt):this.face===Gr.BACK?u=nu(u,+hn):this.face===Gr.LEFT&&(u=nu(u,-pt)),z=Math.sin(a),Z=Math.cos(a),K=Math.sin(u),Y=Math.cos(u),P=Z*Y,R=Z*K,D=z,this.face===Gr.FRONT?(y=Math.acos(P),d=kd(y,D,R,T)):this.face===Gr.RIGHT?(y=Math.acos(R),d=kd(y,D,-P,T)):this.face===Gr.BACK?(y=Math.acos(-P),d=kd(y,D,-R,T)):this.face===Gr.LEFT?(y=Math.acos(-R),d=kd(y,D,P,T)):(y=d=0,T.value=tr.AREA_0)}return l=Math.atan(12/hn*(d+Math.acos(Math.sin(d)*Math.cos(er))-pt)),m=Math.sqrt((1-Math.cos(y))/(Math.cos(l)*Math.cos(l))/(1-Math.cos(Math.atan(1/Math.cos(d))))),T.value===tr.AREA_1?l+=pt:T.value===tr.AREA_2?l+=hn:T.value===tr.AREA_3&&(l+=1.5*hn),r.x=m*Math.cos(l),r.y=m*Math.sin(l),r.x=r.x*this.a+this.x0,r.y=r.y*this.a+this.y0,e.x=r.x,e.y=r.y,e}function lk(e){var r={lam:0,phi:0},a,u,d,y,m,l,T,P,R,D={value:0};if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,u=Math.atan(Math.sqrt(e.x*e.x+e.y*e.y)),a=Math.atan2(e.y,e.x),e.x>=0&&e.x>=Math.abs(e.y)?D.value=tr.AREA_0:e.y>=0&&e.y>=Math.abs(e.x)?(D.value=tr.AREA_1,a-=pt):e.x<0&&-e.x>=Math.abs(e.y)?(D.value=tr.AREA_2,a=a<0?a+hn:a-hn):(D.value=tr.AREA_3,a+=pt),R=hn/12*Math.tan(a),m=Math.sin(R)/(Math.cos(R)-1/Math.sqrt(2)),l=Math.atan(m),d=Math.cos(a),y=Math.tan(u),T=1-d*d*y*y*(1-Math.cos(Math.atan(1/Math.cos(l)))),T<-1?T=-1:T>1&&(T=1),this.face===Gr.TOP)P=Math.acos(T),r.phi=pt-P,D.value===tr.AREA_0?r.lam=l+pt:D.value===tr.AREA_1?r.lam=l<0?l+hn:l-hn:D.value===tr.AREA_2?r.lam=l-pt:r.lam=l;else if(this.face===Gr.BOTTOM)P=Math.acos(T),r.phi=P-pt,D.value===tr.AREA_0?r.lam=-l+pt:D.value===tr.AREA_1?r.lam=-l:D.value===tr.AREA_2?r.lam=-l-pt:r.lam=l<0?-l-hn:-l+hn;else{var z,Z,K;z=T,R=z*z,R>=1?K=0:K=Math.sqrt(1-R)*Math.sin(l),R+=K*K,R>=1?Z=0:Z=Math.sqrt(1-R),D.value===tr.AREA_1?(R=Z,Z=-K,K=R):D.value===tr.AREA_2?(Z=-Z,K=-K):D.value===tr.AREA_3&&(R=Z,Z=K,K=-R),this.face===Gr.RIGHT?(R=z,z=-Z,Z=R):this.face===Gr.BACK?(z=-z,Z=-Z):this.face===Gr.LEFT&&(R=z,z=Z,Z=-R),r.phi=Math.acos(-K)-pt,r.lam=Math.atan2(Z,z),this.face===Gr.RIGHT?r.lam=nu(r.lam,-pt):this.face===Gr.BACK?r.lam=nu(r.lam,-hn):this.face===Gr.LEFT&&(r.lam=nu(r.lam,+pt))}if(this.es!==0){var Y,me,Te;Y=r.phi<0?1:0,me=Math.tan(r.phi),Te=this.b/Math.sqrt(me*me+this.one_minus_f_squared),r.phi=Math.atan(Math.sqrt(this.a*this.a-Te*Te)/(this.one_minus_f*Te)),Y&&(r.phi=-r.phi)}return r.lam+=this.long0,e.x=r.lam,e.y=r.phi,e}function kd(e,r,a,u){var d;return e<Dt?(u.value=tr.AREA_0,d=0):(d=Math.atan2(r,a),Math.abs(d)<=er?u.value=tr.AREA_0:d>er&&d<=pt+er?(u.value=tr.AREA_1,d-=pt):d>pt+er||d<=-(pt+er)?(u.value=tr.AREA_2,d=d>=0?d-hn:d+hn):(u.value=tr.AREA_3,d+=pt)),d}function nu(e,r){var a=e+r;return a<-hn?a+=Ph:a>+hn&&(a-=Ph),a}var ck=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const uk={init:ak,forward:ok,inverse:lk,names:ck};var xm=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],ch=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],Bx=.8487,Nx=1.3523,$x=eo/5,hk=1/$x,Jc=18,lf=function(e,r){return e[0]+r*(e[1]+r*(e[2]+r*e[3]))},dk=function(e,r){return e[1]+r*(2*e[2]+r*3*e[3])};function fk(e,r,a,u){for(var d=r;u;--u){var y=e(d);if(d-=y,Math.abs(y)<a)break}return d}function pk(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function mk(e){var r=Nt(e.x-this.long0),a=Math.abs(e.y),u=Math.floor(a*$x);u<0?u=0:u>=Jc&&(u=Jc-1),a=eo*(a-hk*u);var d={x:lf(xm[u],a)*r,y:lf(ch[u],a)};return e.y<0&&(d.y=-d.y),d.x=d.x*this.a*Bx+this.x0,d.y=d.y*this.a*Nx+this.y0,d}function gk(e){var r={x:(e.x-this.x0)/(this.a*Bx),y:Math.abs(e.y-this.y0)/(this.a*Nx)};if(r.y>=1)r.x/=xm[Jc][0],r.y=e.y<0?-pt:pt;else{var a=Math.floor(r.y*Jc);for(a<0?a=0:a>=Jc&&(a=Jc-1);;)if(ch[a][0]>r.y)--a;else if(ch[a+1][0]<=r.y)++a;else break;var u=ch[a],d=5*(r.y-u[0])/(ch[a+1][0]-u[0]);d=fk(function(y){return(lf(u,y)-r.y)/dk(u,y)},d,Dt,100),r.x/=lf(xm[a],d),r.y=(5*a+d)*$n,e.y<0&&(r.y=-r.y)}return r.x=Nt(r.x+this.long0),r}var yk=["Robinson","robin"];const _k={init:pk,forward:mk,inverse:gk,names:yk};function vk(){this.name="geocent"}function xk(e){var r=Ex(e,this.es,this.a);return r}function bk(e){var r=Tx(e,this.es,this.a,this.b);return r}var wk=["Geocentric","geocentric","geocent","Geocent"];const Mk={init:vk,forward:xk,inverse:bk,names:wk};var es={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},sh={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function Sk(){if(Object.keys(sh).forEach((function(a){if(typeof this[a]>"u")this[a]=sh[a].def;else{if(sh[a].num&&isNaN(this[a]))throw new Error("Invalid parameter value, must be numeric "+a+" = "+this[a]);sh[a].num&&(this[a]=parseFloat(this[a]))}sh[a].degrees&&(this[a]=this[a]*$n)}).bind(this)),Math.abs(Math.abs(this.lat0)-pt)<Dt?this.mode=this.lat0<0?es.S_POLE:es.N_POLE:Math.abs(this.lat0)<Dt?this.mode=es.EQUIT:(this.mode=es.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var e=this.tilt,r=this.azi;this.cg=Math.cos(r),this.sg=Math.sin(r),this.cw=Math.cos(e),this.sw=Math.sin(e)}function Ek(e){e.x-=this.long0;var r=Math.sin(e.y),a=Math.cos(e.y),u=Math.cos(e.x),d,y;switch(this.mode){case es.OBLIQ:y=this.sinph0*r+this.cosph0*a*u;break;case es.EQUIT:y=a*u;break;case es.S_POLE:y=-r;break;case es.N_POLE:y=r;break}switch(y=this.pn1/(this.p-y),d=y*a*Math.sin(e.x),this.mode){case es.OBLIQ:y*=this.cosph0*r-this.sinph0*a*u;break;case es.EQUIT:y*=r;break;case es.N_POLE:y*=-(a*u);break;case es.S_POLE:y*=a*u;break}var m,l;return m=y*this.cg+d*this.sg,l=1/(m*this.sw*this.h1+this.cw),d=(d*this.cg-y*this.sg)*this.cw*l,y=m*l,e.x=d*this.a,e.y=y*this.a,e}function Tk(e){e.x/=this.a,e.y/=this.a;var r={x:e.x,y:e.y},a,u,d;d=1/(this.pn1-e.y*this.sw),a=this.pn1*e.x*d,u=this.pn1*e.y*this.cw*d,e.x=a*this.cg+u*this.sg,e.y=u*this.cg-a*this.sg;var y=aa(e.x,e.y);if(Math.abs(y)<Dt)r.x=0,r.y=e.y;else{var m,l;switch(l=1-y*y*this.pfact,l=(this.p-Math.sqrt(l))/(this.pn1/y+y/this.pn1),m=Math.sqrt(1-l*l),this.mode){case es.OBLIQ:r.y=Math.asin(m*this.sinph0+e.y*l*this.cosph0/y),e.y=(m-this.sinph0*Math.sin(r.y))*y,e.x*=l*this.cosph0;break;case es.EQUIT:r.y=Math.asin(e.y*l/y),e.y=m*y,e.x*=l;break;case es.N_POLE:r.y=Math.asin(m),e.y=-e.y;break;case es.S_POLE:r.y=-Math.asin(m);break}r.x=Math.atan2(e.x,e.y)}return e.x=r.x+this.long0,e.y=r.y,e}var Ck=["Tilted_Perspective","tpers"];const Ik={init:Sk,forward:Ek,inverse:Tk,names:Ck};function Ak(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var e=1-this.es,r=1/e;this.radius_p=Math.sqrt(e),this.radius_p2=e,this.radius_p_inv2=r,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function Pk(e){var r=e.x,a=e.y,u,d,y,m;if(r=r-this.long0,this.shape==="ellipse"){a=Math.atan(this.radius_p2*Math.tan(a));var l=this.radius_p/aa(this.radius_p*Math.cos(a),Math.sin(a));if(d=l*Math.cos(r)*Math.cos(a),y=l*Math.sin(r)*Math.cos(a),m=l*Math.sin(a),(this.radius_g-d)*d-y*y-m*m*this.radius_p_inv2<0)return e.x=Number.NaN,e.y=Number.NaN,e;u=this.radius_g-d,this.flip_axis?(e.x=this.radius_g_1*Math.atan(y/aa(m,u)),e.y=this.radius_g_1*Math.atan(m/u)):(e.x=this.radius_g_1*Math.atan(y/u),e.y=this.radius_g_1*Math.atan(m/aa(y,u)))}else this.shape==="sphere"&&(u=Math.cos(a),d=Math.cos(r)*u,y=Math.sin(r)*u,m=Math.sin(a),u=this.radius_g-d,this.flip_axis?(e.x=this.radius_g_1*Math.atan(y/aa(m,u)),e.y=this.radius_g_1*Math.atan(m/u)):(e.x=this.radius_g_1*Math.atan(y/u),e.y=this.radius_g_1*Math.atan(m/aa(y,u))));return e.x=e.x*this.a,e.y=e.y*this.a,e}function Dk(e){var r=-1,a=0,u=0,d,y,m,l;if(e.x=e.x/this.a,e.y=e.y/this.a,this.shape==="ellipse"){this.flip_axis?(u=Math.tan(e.y/this.radius_g_1),a=Math.tan(e.x/this.radius_g_1)*aa(1,u)):(a=Math.tan(e.x/this.radius_g_1),u=Math.tan(e.y/this.radius_g_1)*aa(1,a));var T=u/this.radius_p;if(d=a*a+T*T+r*r,y=2*this.radius_g*r,m=y*y-4*d*this.C,m<0)return e.x=Number.NaN,e.y=Number.NaN,e;l=(-y-Math.sqrt(m))/(2*d),r=this.radius_g+l*r,a*=l,u*=l,e.x=Math.atan2(a,r),e.y=Math.atan(u*Math.cos(e.x)/r),e.y=Math.atan(this.radius_p_inv2*Math.tan(e.y))}else if(this.shape==="sphere"){if(this.flip_axis?(u=Math.tan(e.y/this.radius_g_1),a=Math.tan(e.x/this.radius_g_1)*Math.sqrt(1+u*u)):(a=Math.tan(e.x/this.radius_g_1),u=Math.tan(e.y/this.radius_g_1)*Math.sqrt(1+a*a)),d=a*a+u*u+r*r,y=2*this.radius_g*r,m=y*y-4*d*this.C,m<0)return e.x=Number.NaN,e.y=Number.NaN,e;l=(-y-Math.sqrt(m))/(2*d),r=this.radius_g+l*r,a*=l,u*=l,e.x=Math.atan2(a,r),e.y=Math.atan(u*Math.cos(e.x)/r)}return e.x=e.x+this.long0,e}var kk=["Geostationary Satellite View","Geostationary_Satellite","geos"];const Lk={init:Ak,forward:Pk,inverse:Dk,names:kk};var _h=1.340264,vh=-.081106,xh=893e-6,bh=.003796,cf=Math.sqrt(3)/2;function Rk(){this.es=0,this.long0=this.long0!==void 0?this.long0:0}function zk(e){var r=Nt(e.x-this.long0),a=e.y,u=Math.asin(cf*Math.sin(a)),d=u*u,y=d*d*d;return e.x=r*Math.cos(u)/(cf*(_h+3*vh*d+y*(7*xh+9*bh*d))),e.y=u*(_h+vh*d+y*(xh+bh*d)),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function Ok(e){e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a;var r=1e-9,a=12,u=e.y,d,y,m,l,T,P;for(P=0;P<a&&(d=u*u,y=d*d*d,m=u*(_h+vh*d+y*(xh+bh*d))-e.y,l=_h+3*vh*d+y*(7*xh+9*bh*d),u-=T=m/l,!(Math.abs(T)<r));++P);return d=u*u,y=d*d*d,e.x=cf*e.x*(_h+3*vh*d+y*(7*xh+9*bh*d))/Math.cos(u),e.y=Math.asin(Math.sin(u)/cf),e.x=Nt(e.x+this.long0),e}var Fk=["eqearth","Equal Earth","Equal_Earth"];const Bk={init:Rk,forward:zk,inverse:Ok,names:Fk};function Nk(e){e.Proj.projections.add(qd),e.Proj.projections.add(Gd),e.Proj.projections.add($A),e.Proj.projections.add(KA),e.Proj.projections.add(iP),e.Proj.projections.add(oP),e.Proj.projections.add(fP),e.Proj.projections.add(_P),e.Proj.projections.add(MP),e.Proj.projections.add(IP),e.Proj.projections.add(GP),e.Proj.projections.add(YP),e.Proj.projections.add(iD),e.Proj.projections.add(lD),e.Proj.projections.add(fD),e.Proj.projections.add(_D),e.Proj.projections.add(MD),e.Proj.projections.add(ID),e.Proj.projections.add(RD),e.Proj.projections.add(ND),e.Proj.projections.add(qD),e.Proj.projections.add(XD),e.Proj.projections.add(ek),e.Proj.projections.add(sk),e.Proj.projections.add(uk),e.Proj.projections.add(_k),e.Proj.projections.add(Mk),e.Proj.projections.add(Ik),e.Proj.projections.add(Lk),e.Proj.projections.add(Bk)}Zs.defaultDatum="WGS84";Zs.Proj=to;Zs.WGS84=new Zs.Proj("WGS84");Zs.Point=uu;Zs.toPoint=Cx;Zs.defs=fs;Zs.nadgrid=VI;Zs.transform=af;Zs.mgrs=nA;Zs.version="__VERSION__";Nk(Zs);const Hs=Do("MapStore",{state:()=>({map:{},currentMapStyle:"pwdDrawnMapStyle",bufferForAddress:{},currentMarkersForTopic:[],addressMarker:null,addressParcel:null,initialized:!1,draw:null,imageryOn:!1,imagerySelected:"2023"}),actions:{setMap(e){this.map=e},setMapStyle(e){this.currentMapStyle=e},async fillBufferForAddress(e,r){const y=Zs("+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs","+proj=lcc +lat_1=40.96666666666667 +lat_2=39.93333333333333 +lat_0=39.33333333333334 +lon_0=-77.75 +x_0=600000 +y_0=0 +ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 +no_defs",[e,r]);console.log("fillBufferForAddress is running, lng:",e,"lat:",r);const m="https://citygeo-geocoder-pub.databridge.phila.gov/arcgis/rest/services/Utilities/Geometry/GeometryServer/buffer",l={geometries:`${y.join(", ")}`,inSR:2272,outSR:4326,bufferSR:2272,distances:500,unionResults:!0,geodesic:!1,f:"json"};let T=await vr.get(m,{params:l});this.bufferForAddress=T.data}}}),Ra=e=>(vf("data-v-51fe83bd"),e=e(),xf(),e),$k=Ra(()=>se("div",{class:"box"},"Deed information and document transactions for this address. The map faithfully reflects property boundaries as described in recorded deeds including multiple types of easements. The property boundaries displayed on the map are for reference only and should not be used in place of the recorded deeds or land surveys. Source: Department of Records",-1)),Uk={class:"columns is-multiline"},Vk=["onClick"],jk=Ra(()=>se("h5",{class:"title is-5"},"Parcel Details",-1)),qk={key:0,class:"vert-table"},Gk={class:"columns"},Hk=Ra(()=>se("div",{class:"column is-4"},"Map Registry #",-1)),Zk={class:"column is-8"},Wk={class:"columns"},Xk=Ra(()=>se("div",{class:"column is-4"},"Parcel Address",-1)),Kk={class:"column is-8"},Yk={class:"columns"},Jk=Ra(()=>se("div",{class:"column is-4"},"Status",-1)),Qk={class:"column is-8"},e3={class:"columns"},t3=Ra(()=>se("div",{class:"column is-4"},"Origination Date",-1)),i3={class:"column is-8"},r3={class:"columns"},n3=Ra(()=>se("div",{class:"column is-4"},"Inactive Date",-1)),s3={class:"column is-8"},a3={class:"columns"},o3=Ra(()=>se("div",{class:"column is-4"},"Has Air Rights",-1)),l3={class:"column is-8"},c3={class:"columns"},u3=Ra(()=>se("div",{class:"column is-4"},"Is Condo",-1)),h3={class:"column is-8"},d3={class:"mt-6"},f3=Ra(()=>se("h5",{class:"subtitle is-5"},"Documents",-1)),p3={class:"table is-fullwidth is-striped"},m3=Ra(()=>se("thead",null,[se("tr",null,[se("th",null,"ID"),se("th",null,"Date"),se("th",null,"Type"),se("th",null,"Grantor"),se("th",null,"Grantee")])],-1)),g3={__name:"Deeds",setup(e){Ln();const r=Vh(),a=yx(),d=Hs().map,y=ms(""),m=Gi(()=>r.dor.features.filter(P=>P.id===y.value)[0]),l=Gi(()=>a.dorDocuments[y.value].data.features);av(()=>{console.log("Deeds.vue onBeforeMount"),y.value=r.dor.features[0].properties.OBJECTID}),Oh(()=>{console.log("Deeds.vue onMounted, map.getStyle().sources:",d.getStyle().sources,"map.getStyle.layers:",d.getStyle().layers)});const T={1:"Active",2:"Inactive",3:"Remainder"};return(P,R)=>(Lt(),Xt(Nr,null,[$k,se("div",Uk,[(Lt(!0),Xt(Nr,null,Ca(ar(r).dor.features,D=>(Lt(),Xt("div",{key:D.properties.OBJECTID,onClick:z=>y.value=D.properties.OBJECTID,class:Co(["column is-3 add-borders",{"is-selected":D.properties.OBJECTID===y.value}])},ei(D.properties.MAPREG),11,Vk))),128))]),jk,m.value?(Lt(),Xt("div",qk,[se("div",Gk,[Hk,se("div",Zk,ei(m.value.properties.MAPREG),1)]),se("div",Wk,[Xk,se("div",Kk,ei(m.value.properties.ADDR_SOURCE),1)]),se("div",Yk,[Jk,se("div",Qk,ei(T[m.value.properties.STATUS]),1)]),se("div",e3,[t3,se("div",i3,ei(m.value.properties.ORIG_DATE),1)]),se("div",r3,[n3,se("div",s3,ei(m.value.properties.INACTDATE||"None"),1)]),se("div",a3,[o3,se("div",l3,ei(m.value.properties.SUFFIX?"Yes":"No"),1)]),se("div",c3,[u3,se("div",h3,ei(m.value.properties.CONDOFLAG?"Yes":"No"),1)])])):Ki("",!0),se("div",d3,[f3,se("table",p3,[m3,se("tbody",null,[(Lt(!0),Xt(Nr,null,Ca(l.value,D=>(Lt(),Xt("tr",null,[se("td",null,ei(D.attributes.DOCUMENT_ID),1),se("td",null,ei(D.attributes.DISPLAY_DATE),1),se("td",null,ei(D.attributes.DOCUMENT_TYPE),1),se("td",null,ei(D.attributes.GRANTORS),1),se("td",null,ei(D.attributes.GRANTEES),1)]))),256))])])])],64))}},y3=El(g3,[["__scopeId","data-v-51fe83bd"]]),Ux=Do("LiStore",{state:()=>({liInspections:{},liPermits:{}}),actions:{async fillLiInspections(){const r=Ln().addressData.features[0];let a="https://phl.carto.com/api/v2/sql?q=";const u=r.properties.eclipse_location_id.replace(/\|/g,"', '"),d=r.properties.street_address,y=r.properties.opa_account_num?` AND opa_account_num IN ('${r.properties.opa_account_num}')`:"",m=r.properties.pwd_parcel_id,l=r.properties.li_address_key.replace(/\|/g,"', '"),T=a+=`SELECT * FROM case_investigations WHERE (address = '${d}' or addressobjectid IN ('${l}'))           AND systemofrecord IN ('HANSEN') ${y} UNION SELECT * FROM case_investigations WHERE           addressobjectid IN ('${u}') OR parcel_id_num IN ( '${m}' )           AND systemofrecord IN ('ECLIPSE') ${y}`,P=await fetch(T);this.liInspections=await P.json()},async fillLiPermits(){const r=Ln().addressData.features[0];let a="https://phl.carto.com/api/v2/sql?q=";const u=r.properties.eclipse_location_id.replace(/\|/g,"', '"),d=r.properties.street_address,y=r.properties.opa_account_num?` AND opa_account_num IN ('${r.properties.opa_account_num}')`:"",m=r.properties.pwd_parcel_id,l=r.properties.li_address_key.replace(/\|/g,"', '"),T=a+=`SELECT * FROM PERMITS WHERE address = '${d}' or addressobjectid IN ('${l}')       AND systemofrecord IN ('HANSEN') ${y}       UNION SELECT * FROM PERMITS WHERE addressobjectid IN ('${u}') OR parcel_id_num IN ( '${m}' )       AND systemofrecord IN ('ECLIPSE')${y}      ORDER BY permittype`,P=await fetch(T);this.liPermits=await P.json()}},getters:{}}),_3=se("div",{class:"box"}," Licenses, inspections, permits, property maintenance violations, and zoning permit documents at your search address. Source: Department of Licenses & Inspections ",-1),v3=se("h5",{class:"subtitle is-5"},"Permits",-1),x3={class:"table is-fullwidth is-striped"},b3=se("thead",null,[se("tr",null,[se("th",null,"Date"),se("th",null,"ID"),se("th",null,"Description"),se("th",null,"Status")])],-1),w3=se("h5",{class:"subtitle is-5"},"Inspections",-1),M3={class:"table is-fullwidth is-striped"},S3=se("thead",null,[se("tr",null,[se("th",null,"Date"),se("th",null,"ID"),se("th",null,"Description"),se("th",null,"Status")])],-1),E3=["innerHTML"],T3={__name:"LI",setup(e){console.log("LI.vue setup");const r=Ln(),a=Ux(),{currency:u,date:d}=Ym(),y=(R,D)=>new Date(D.permitissuedate)-new Date(R.permitissuedate),m=Gi(()=>a.liPermits.rows.sort(y).slice(0,5)),l=(R,D)=>new Date(D.investigationcompleted)-new Date(R.investigationcompleted),T=Gi(()=>a.liInspections.rows.sort(l).slice(0,5)),P=R=>{let D=r.addressData.features[0].properties.street_address;return R.unit_num&&R.unit_num!=null&&(D+=" Unit "+R.unit_num),"<a target='_blank' href='https://li.phila.gov/Property-History/search/Violation-Detail?address="+encodeURIComponent(D)+"&Id="+R.casenumber+"'>"+R.casenumber+" <i class='fa fa-external-link-alt'></i></a>"};return(R,D)=>(Lt(),Xt("section",null,[_3,v3,se("table",x3,[b3,se("tbody",null,[(Lt(!0),Xt(Nr,null,Ca(m.value,z=>(Lt(),Xt("tr",null,[se("td",null,ei(ar(d)(z.permitissuedate)),1),se("td",null,ei(z.permitnumber),1),se("td",null,ei(z.permitdescription),1),se("td",null,ei(z.status),1)]))),256))])]),w3,se("table",M3,[S3,se("tbody",null,[(Lt(!0),Xt(Nr,null,Ca(T.value,z=>(Lt(),Xt("tr",null,[se("td",null,ei(ar(d)(z.investigationcompleted)),1),se("td",{innerHTML:P(z)},null,8,E3),se("td",null,ei(z.investigationtype),1),se("td",null,ei(z.investigationstatus),1)]))),256))])])]))}},C3=se("h1",null,"Zoning Content",-1),I3=[C3],A3={__name:"Zoning",setup(e){return console.log("Zoning.vue setup"),(r,a)=>(Lt(),Xt("section",null,I3))}},P3=se("h1",null,"Voting Content",-1),D3=[P3],k3={__name:"Voting",setup(e){return console.log("Voting.vue setup"),(r,a)=>(Lt(),Xt("section",null,D3))}};function Gp(e){return e&&typeof e=="object"&&!Array.isArray(e)&&e!==null}function Wh(e,r){let a=Object.assign({},e);return Gp(e)&&Gp(r)&&Object.keys(r).forEach(u=>{Gp(r[u])?u in e?a[u]=Wh(e[u],r[u]):Object.assign(a,{[u]:r[u]}):Object.assign(a,{[u]:r[u]})}),a}const Bf={sources:{imageryLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2023:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2023/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2022:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2022_2in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2020:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2020_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2019:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2019_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2018:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2018_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2017:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2017_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2016:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2016_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2015:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2015_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2012:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2012_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2010:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2010_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2008:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2008_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2004:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2004_6in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},1996:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_1996_6in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},1962:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/HistoricLandUse_1962/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},1942:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/HistoricLandUse_1942/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},1910:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/HistoricBromleyAtlas_1910/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},1895:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/HistoricBromleyAtlas_1895/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},1875:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/HistoricGMHopkinsAtlas_1875/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},1860:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/HistoricHexamerLocherAtlas_1860/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256}}},L3=Wh(Bf,{version:8,name:"pwdDrawnMap",sources:{pwd:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityBasemap/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},pwdLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityBasemap_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},addressMarker:{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[]}}},dorParcel:{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[]]]}}}},layers:[{id:"pwd",source:"pwd",type:"raster"},{id:"pwdLabels",source:"pwdLabels",type:"raster"},{id:"addressMarker",source:"addressMarker",type:"circle",paint:{"circle-radius":7,"circle-color":"#ff0000"}}]}),R3=Wh(Bf,{version:8,name:"dorDrawnMap",sources:{dor:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/DORBasemap/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},dorLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/DORBasemap_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},addressMarker:{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[]}}},dorParcel:{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[]]]}}}},layers:[{id:"dor",source:"dor",type:"raster"},{id:"dorLabels",source:"dorLabels",type:"raster"},{id:"dorParcel",type:"fill",source:"dorParcel",layout:{},paint:{"fill-color":"#088","fill-opacity":.4}}]}),z3=Wh(Bf,{version:8,name:"dorDrawnMap",sources:{dor:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/DORBasemap/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},dorLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/DORBasemap_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},zoning:{tiles:["https://citygeo-geoserver.databridge.phila.gov/geoserver/wms?service=WMS&version=1.1.0&request=GetMap&layers=atlas_zoning_grouped&bbox={bbox-epsg-3857}&width=256&height=256&srs=EPSG%3A3857&styles=&format=image/png&transparent=true"],type:"raster",tileSize:256},addressMarker:{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[]}}},dorParcel:{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[]]]}}}},layers:[{id:"dor",source:"dor",type:"raster"},{id:"dorLabels",source:"dorLabels",type:"raster"},{id:"zoning",source:"zoning",type:"raster"},{id:"dorParcel",type:"fill",source:"dorParcel",layout:{},paint:{"fill-color":"#088","fill-opacity":.4}}]}),O3=Wh(Bf,{version:8,name:"pwdDrawnMap",sources:{pwd:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityBasemap/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},pwdLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityBasemap_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},addressMarker:{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[]}}},dorParcel:{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[]]]}}},nearby:{type:"geojson",data:{type:"FeatureCollection",features:[]}}},layers:[{id:"pwd",source:"pwd",type:"raster"},{id:"pwdLabels",source:"pwdLabels",type:"raster"},{id:"addressMarker",source:"addressMarker",type:"symbol",layout:{"icon-image":"custom-marker"}},{id:"nearby",source:"nearby",type:"circle",paint:{"circle-radius":7,"circle-color":"#ff0000","circle-stroke-width":1,"circle-stroke-color":"white"}}]}),ps={topicStyles:{Property:"pwdDrawnMapStyle",Condos:"pwdDrawnMapStyle",Deeds:"dorDrawnMapStyle","Licenses & Inspections":"pwdDrawnMapStyle",Zoning:"zoningDrawnMapStyle",Voting:"pwdDrawnMapStyle","Nearby Activity":"nearbyDrawnMapStyle"},parcelLayerForTopic:{undefined:"pwd",Property:"pwd",Condos:"pwd",Deeds:"dor","Licenses & Inspections":"pwd",Zoning:"dor",Voting:"pwd","Nearby Activity":"pwd"},mapLayers:{pwdBasemap:{id:"pwdBasemap",source:"pwdBasemap",type:"raster"},pwdLabels:{id:"pwdLabels",source:"pwdLabels",type:"raster"},dorBasemap:{id:"dorBasemap",source:"dorBasemap",type:"raster"},dorLabels:{id:"dorLabels",source:"dorLabels",type:"raster"},zoning:{id:"zoning",source:"zoning",type:"raster"},addressMarker:{id:"addressMarker",source:"addressMarker",type:"circle"},dorParcel:{id:"dorParcel",type:"fill",source:"dorParcel",layout:{},paint:{"fill-color":"#088","fill-opacity":.4}},imageryLabels:{id:"imageryLabels",source:"imageryLabels",type:"raster"},2023:{id:"2023",source:"2023",type:"raster"},2022:{id:"2022",source:"2022",type:"raster"},2020:{id:"2020",source:"2020",type:"raster"},2019:{id:"2019",source:"2019",type:"raster"},2018:{id:"2018",source:"2018",type:"raster"},2017:{id:"2017",source:"2017",type:"raster"},2016:{id:"2016",source:"2016",type:"raster"},2015:{id:"2015",source:"2015",type:"raster"},2012:{id:"2012",source:"2012",type:"raster"},2010:{id:"2010",source:"2010",type:"raster"},2008:{id:"2008",source:"2008",type:"raster"},2004:{id:"2004",source:"2004",type:"raster"},1996:{id:"1996",source:"1996",type:"raster"},1962:{id:"1962",source:"1962",type:"raster"},1942:{id:"1942",source:"1942",type:"raster"},1910:{id:"1910",source:"1910",type:"raster"},1895:{id:"1895",source:"1895",type:"raster"},1875:{id:"1875",source:"1875",type:"raster"},1860:{id:"1860",source:"1860",type:"raster"}}};ps.pwdDrawnMapStyle=L3;ps.dorDrawnMapStyle=R3;ps.zoningDrawnMapStyle=z3;ps.nearbyDrawnMapStyle=O3;var Cs=63710088e-1,Vx={centimeters:Cs*100,centimetres:Cs*100,degrees:Cs/111325,feet:Cs*3.28084,inches:Cs*39.37,kilometers:Cs/1e3,kilometres:Cs/1e3,meters:Cs,metres:Cs,miles:Cs/1609.344,millimeters:Cs*1e3,millimetres:Cs*1e3,nauticalmiles:Cs/1852,radians:1,yards:Cs*1.0936},f0={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function rg(e,r,a){a===void 0&&(a={});var u={type:"Feature"};return(a.id===0||a.id)&&(u.id=a.id),a.bbox&&(u.bbox=a.bbox),u.properties=r||{},u.geometry=e,u}function Lh(e,r,a){if(a===void 0&&(a={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!p0(e[0])||!p0(e[1]))throw new Error("coordinates must contain numbers");var u={type:"Point",coordinates:e};return rg(u,r,a)}function jx(e,r,a){a===void 0&&(a={});for(var u=0,d=e;u<d.length;u++){var y=d[u];if(y.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var m=0;m<y[y.length-1].length;m++)if(y[y.length-1][m]!==y[0][m])throw new Error("First and last Position are not equivalent.")}var l={type:"Polygon",coordinates:e};return rg(l,r,a)}function F3(e,r,a){if(a===void 0&&(a={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var u={type:"LineString",coordinates:e};return rg(u,r,a)}function B3(e,r){r===void 0&&(r={});var a={type:"FeatureCollection"};return r.id&&(a.id=r.id),r.bbox&&(a.bbox=r.bbox),a.features=e,a}function N3(e,r){r===void 0&&(r="kilometers");var a=Vx[r];if(!a)throw new Error(r+" units is invalid");return e*a}function $3(e,r){r===void 0&&(r="kilometers");var a=Vx[r];if(!a)throw new Error(r+" units is invalid");return e/a}function bm(e){var r=e%(2*Math.PI);return r*180/Math.PI}function Aa(e){var r=e%360;return r*Math.PI/180}function U3(e,r,a){if(r===void 0&&(r="meters"),a===void 0&&(a="kilometers"),!(e>=0))throw new Error("area must be a positive number");var u=f0[r];if(!u)throw new Error("invalid original units");var d=f0[a];if(!d)throw new Error("invalid final units");return e/u*d}function p0(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Rh(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function du(e,r,a){a===void 0&&(a={});var u=Rh(e),d=Rh(r),y=Aa(d[1]-u[1]),m=Aa(d[0]-u[0]),l=Aa(u[1]),T=Aa(d[1]),P=Math.pow(Math.sin(y/2),2)+Math.pow(Math.sin(m/2),2)*Math.cos(l)*Math.cos(T);return N3(2*Math.atan2(Math.sqrt(P),Math.sqrt(1-P)),a.units)}function wm(e,r,a){if(e!==null)for(var u,d,y,m,l,T,P,R=0,D=0,z,Z=e.type,K=Z==="FeatureCollection",Y=Z==="Feature",me=K?e.features.length:1,Te=0;Te<me;Te++){P=K?e.features[Te].geometry:Y?e.geometry:e,z=P?P.type==="GeometryCollection":!1,l=z?P.geometries.length:1;for(var Fe=0;Fe<l;Fe++){var ae=0,Pe=0;if(m=z?P.geometries[Fe]:P,m!==null){T=m.coordinates;var Ze=m.type;switch(R=a&&(Ze==="Polygon"||Ze==="MultiPolygon")?1:0,Ze){case null:break;case"Point":if(r(T,D,Te,ae,Pe)===!1)return!1;D++,ae++;break;case"LineString":case"MultiPoint":for(u=0;u<T.length;u++){if(r(T[u],D,Te,ae,Pe)===!1)return!1;D++,Ze==="MultiPoint"&&ae++}Ze==="LineString"&&ae++;break;case"Polygon":case"MultiLineString":for(u=0;u<T.length;u++){for(d=0;d<T[u].length-R;d++){if(r(T[u][d],D,Te,ae,Pe)===!1)return!1;D++}Ze==="MultiLineString"&&ae++,Ze==="Polygon"&&Pe++}Ze==="Polygon"&&ae++;break;case"MultiPolygon":for(u=0;u<T.length;u++){for(Pe=0,d=0;d<T[u].length;d++){for(y=0;y<T[u][d].length-R;y++){if(r(T[u][d][y],D,Te,ae,Pe)===!1)return!1;D++}Pe++}ae++}break;case"GeometryCollection":for(u=0;u<m.geometries.length;u++)if(wm(m.geometries[u],r,a)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function qx(e,r){if(e.type==="Feature")r(e,0);else if(e.type==="FeatureCollection")for(var a=0;a<e.features.length&&r(e.features[a],a)!==!1;a++);}function V3(e,r){var a,u,d,y,m,l,T,P,R,D,z=0,Z=e.type==="FeatureCollection",K=e.type==="Feature",Y=Z?e.features.length:1;for(a=0;a<Y;a++){for(l=Z?e.features[a].geometry:K?e.geometry:e,P=Z?e.features[a].properties:K?e.properties:{},R=Z?e.features[a].bbox:K?e.bbox:void 0,D=Z?e.features[a].id:K?e.id:void 0,T=l?l.type==="GeometryCollection":!1,m=T?l.geometries.length:1,d=0;d<m;d++){if(y=T?l.geometries[d]:l,y===null){if(r(null,z,P,R,D)===!1)return!1;continue}switch(y.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(r(y,z,P,R,D)===!1)return!1;break}case"GeometryCollection":{for(u=0;u<y.geometries.length;u++)if(r(y.geometries[u],z,P,R,D)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}z++}}function j3(e,r,a){var u=a;return V3(e,function(d,y,m,l,T){y===0&&a===void 0?u=d:u=r(u,d,y,m,l,T)}),u}function q3(e){var r=[];return e.type==="FeatureCollection"?qx(e,function(a){wm(a,function(u){r.push(Lh(u,a.properties))})}):wm(e,function(a){r.push(Lh(a,e.properties))}),B3(r)}function G3(e){if(!e)throw new Error("geojson is required");switch(e.type){case"Feature":return Gx(e);case"FeatureCollection":return H3(e);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return ng(e);default:throw new Error("unknown GeoJSON type")}}function Gx(e){var r={type:"Feature"};return Object.keys(e).forEach(function(a){switch(a){case"type":case"properties":case"geometry":return;default:r[a]=e[a]}}),r.properties=Hx(e.properties),r.geometry=ng(e.geometry),r}function Hx(e){var r={};return e&&Object.keys(e).forEach(function(a){var u=e[a];typeof u=="object"?u===null?r[a]=null:Array.isArray(u)?r[a]=u.map(function(d){return d}):r[a]=Hx(u):r[a]=u}),r}function H3(e){var r={type:"FeatureCollection"};return Object.keys(e).forEach(function(a){switch(a){case"type":case"features":return;default:r[a]=e[a]}}),r.features=e.features.map(function(a){return Gx(a)}),r}function ng(e){var r={type:e.type};return e.bbox&&(r.bbox=e.bbox),e.type==="GeometryCollection"?(r.geometries=e.geometries.map(function(a){return ng(a)}),r):(r.coordinates=Zx(e.coordinates),r)}function Zx(e){var r=e;return typeof r[0]!="object"?r.slice():r.map(function(a){return Zx(a)})}function Z3(e,r){if(!e)throw new Error("targetPoint is required");if(!r)throw new Error("points is required");var a,u=1/0,d=0;return qx(r,function(y,m){var l=du(e,y);l<u&&(d=m,u=l)}),a=G3(r.features[d]),a.properties.featureIndex=d,a.properties.distanceToPoint=u,a}const W3=(e,r)=>{const a={};if(!r.options.params)return a;const u=Object.entries(r.options.params);(void 0).store.state;for(let[d,y]of u){let m;typeof y=="function"?m=y(e):m=y,a[d]=m}return a},Hp=(e,r)=>{const a=W3(e,r);r.url;const u=r.options,d=u.table,y=u.dateMinNum||null,m=u.dateMinType||null,l=u.dateField||null;u.success;const T=u.distances||250,P=u.groupby||null,R="ST_Distance(the_geom::geography, ST_SetSRID(ST_Point("+e.geometry.coordinates[0]+","+e.geometry.coordinates[1]+"),4326)::geography)",D="ST_Y(the_geom)",z="ST_X(the_geom)";let Z;P?Z=P+", the_geom":Z="*",Z=Z+", "+R+"as distance,"+D+"as lat, "+z+"as lng",a.q="select "+Z+" from "+d+" where "+R+" < "+T;let K;if(y){switch(m){case"hour":K=vC;break;case"day":K=tC;break;case"week":K=xC;break;case"month":K=_C;break;case"year":K=bC;break}a.q=a.q+" and "+l+" > '"+gm(K(new Date,y),"yyyy-MM-dd")+"'"}return P&&(a.q=a.q+" group by "+P+", the_geom"),a},Wx=Do("NearbyActivityStore",{state:()=>({loadingData:!1,nearby311:{},nearbyCrimeIncidents:null,nearbyZoningAppeals:null,nearbyVacantIndicatorPoints:null,nearbyConstructionPermits:null,nearbyDemolitionPermits:null,nearbyImminentlyDangerous:null}),actions:{setLoadingData(e){this.loadingData=e},async fetchData(e){console.log("fetchData is runnning, dataType:",e),e==="nearby311"?await this.fillNearby311():e==="nearbyCrimeIncidents"?await this.fillNearbyCrimeIncidents():e==="nearbyZoningAppeals"?await this.fillNearbyZoningAppeals():e==="nearbyVacantIndicatorPoints"&&await this.fillNearbyVacantIndicatorPoints()},async fillNearby311(){const e=Ln();this.setLoadingData(!0);const r=e.addressData.features[0];let a={url:"https://phl.carto.com/api/v2/sql?",options:{table:"public_cases_fc",dateMinNum:365,dateMinType:"day",dateField:"requested_datetime"}},u=Hp(r,a);const d=await vr.get(a.url,{params:u});this.nearby311=d,this.setLoadingData(!1)},async fillNearbyCrimeIncidents(){const e=Ln();this.setLoadingData(!0);const r=e.addressData.features[0];let a={url:"https://phl.carto.com/api/v2/sql?",options:{table:"incidents_part1_part2",dateMinNum:90,dateMinType:"day",dateField:"dispatch_date"}},u=Hp(r,a);const d=await vr.get(a.url,{params:u});this.nearbyCrimeIncidents=d,this.setLoadingData(!1)},async fillNearbyZoningAppeals(){const e=Ln();this.setLoadingData(!0);const r=e.addressData.features[0];let a={url:"https://phl.carto.com/api/v2/sql?",options:{table:"appeals",dateMinNum:1,dateMinType:"year",dateField:"scheduleddate"}},u=Hp(r,a);const d=await vr.get(a.url,{params:u});this.nearbyZoningAppeals=d,this.setLoadingData(!1)},async fillNearbyVacantIndicatorPoints(){this.setLoadingData(!0);const r=Hs().bufferForAddress,a="https://services.arcgis.com/fLeGjb7u4uXqeF9q/arcgis/rest/services/Vacant_Indicators_Points/FeatureServer/0/query?",u=r.geometries[0].rings[0];let d=[[parseFloat(u[0][0].toFixed(6)),parseFloat(u[0][1].toFixed(6))]];var y;for(y=0;y<u.length;y++)if(y%3==0){let Z=[parseFloat(u[y][0].toFixed(6)),parseFloat(u[y][1].toFixed(6))];d.push(Z)}d.push([parseFloat(u[0][0].toFixed(6)),parseFloat(u[0][1].toFixed(6))]);const m={returnGeometry:!0,where:"1=1",outSR:4326,outFields:"*",inSr:4326,geometryType:"esriGeometryPolygon",spatialRel:"esriSpatialRelContains",f:"geojson",geometry:JSON.stringify({rings:[d],spatialReference:{wkid:4326}})};let P=(await(await vr.get(a,{params:m})).data||{}).features;const D=Ln().addressData.features[0],z=Lh(D.geometry.coordinates);P=P.map(Z=>{const K=Z.geometry.coordinates;let Y;if(Array.isArray(K[0])){let Te;Z.geometry.type==="LineString"?Te=F3([K[0],K[1]],{name:"line 1"}):Te=jx([K[0]]);const Fe=q3(Te),ae=Z3(z,Fe);Y=du(z,ae,{units:"miles"})}else{const Te=Lh(K);Y=du(z,Te,{units:"miles"})}const me=parseInt(Y*5280);return Z._distance=me,Z}),this.nearbyVacantIndicatorPoints=P,this.setLoadingData(!1)}}}),X3=se("div",{class:"box"}," See recent activity near your search address including 311 service requests, crimes, zoning appeals, and more. Hover over a record below to highlight it on the map. ",-1),K3=se("div",{class:"dropdown-trigger"},[se("button",{class:"button","aria-haspopup":"true","aria-controls":"dropdown-menu"},[se("span",null,"What nearby activity would you like to see?"),se("span",{class:"icon is-small"},[se("i",{class:"fas fa-angle-down","aria-hidden":"true"})])])],-1),Y3={class:"dropdown-menu",id:"dropdown-menu",role:"menu"},J3={class:"dropdown-content"},Q3=se("br",null,null,-1),eL=se("div",{class:"dropdown-trigger"},[se("button",{class:"button","aria-haspopup":"true","aria-controls":"dropdown-menu"},[se("span",null,"From"),se("span",{class:"icon is-small"},[se("i",{class:"fas fa-angle-down","aria-hidden":"true"})])])],-1),tL={class:"dropdown-menu",id:"dropdown-menu",role:"menu"},iL={class:"dropdown-content"},rL=["onClick"],nL=se("div",{class:"dropdown-trigger"},[se("button",{class:"button","aria-haspopup":"true","aria-controls":"dropdown-menu"},[se("span",null,"Sort by"),se("span",{class:"icon is-small"},[se("i",{class:"fas fa-angle-down","aria-hidden":"true"})])])],-1),sL={class:"dropdown-menu",id:"dropdown-menu",role:"menu"},aL={class:"dropdown-content"},oL=se("br",null,null,-1),lL={key:0,class:"mt-5"},cL=se("h5",{class:"subtitle is-5"},"311 Requests",-1),uL={key:0},hL={class:"table is-fullwidth is-striped"},dL=se("thead",null,[se("tr",null,[se("th",null,"Date"),se("th",null,"Location"),se("th",null,"Type"),se("th",null,"Distance")])],-1),fL={key:1,class:"mt-5"},pL=se("h5",{class:"subtitle is-5"},"Crime Incidents",-1),mL={key:0},gL={class:"table is-fullwidth is-striped"},yL=se("thead",null,[se("tr",null,[se("th",null,"Date"),se("th",null,"Location"),se("th",null,"Description"),se("th",null,"Distance")])],-1),_L={key:2,class:"mt-5"},vL=se("h5",{class:"subtitle is-5"},"Zoning Appeals",-1),xL={key:0},bL={class:"table is-fullwidth is-striped"},wL=se("thead",null,[se("tr",null,[se("th",null,"Date"),se("th",null,"Location"),se("th",null,"Description"),se("th",null,"Distance")])],-1),ML={key:3,class:"mt-5"},SL=se("h5",{class:"subtitle is-5"},"Likely Vacant Properties",-1),EL={key:0},TL={class:"table is-fullwidth is-striped"},CL=se("thead",null,[se("tr",null,[se("th",null,"Address"),se("th",null,"Property Type"),se("th",null,"Distance")])],-1),IL={__name:"NearbyActivity",setup(e){console.log("Nearby.vue setup");const r=Wx(),a=ha(),d=Hs().map,{currency:y,date:m}=Ym(),l=Nh(),T=Bh(),P=(tt,rt,It)=>new Date(rt[It])-new Date(tt[It]),R={nearby311:"311 Requests",nearbyCrimeIncidents:"Crime Incidents",nearbyZoningAppeals:"Zoning Appeals",nearbyVacantIndicatorPoints:"Vacant Properties",nearbyConstructionPermits:"Construction Permits",nearbyDemolitionPermits:"Demolition Permits",nearbyImminentlyDangerous:"Imminently Dangerous"},D=ms(!1),z=()=>D.value=!D.value,Z=Gi(()=>a.currentNearbyDataType),K=Gi(()=>r.loadingData),Y=tt=>{T.push({name:"address-topic-and-data",params:{address:a.currentAddress,topic:l.params.topic,data:tt}})};la(()=>l.params.data,async tt=>{tt&&(a.setCurrentNearbyDataType(tt),await me(tt))});const me=async tt=>{r[tt]===null&&(console.log("fetching new data"),await r.fetchData(tt)),xt(Vt[tt].values[0])},Te=ms(!1),Fe=()=>Te.value=!Te.value,ae=ms("distance"),Pe=tt=>{ae.value=tt},Ze=ms(!1),Je=()=>Ze.value=!Ze.value,dt=ms(null);Oh(()=>{dt.value=Vt[Z.value].values[0]});const _t=Gi(()=>Vt[Z.value].labels[Vt[Z.value].values.indexOf(dt.value)]),xt=tt=>{dt.value=tt},Vt={nearby311:{labels:["the last 30 days","the last 90 days","1 year"],values:[30,90,365]},nearbyCrimeIncidents:{labels:["the last 30 days","the last 90 days"],values:[30,90]},nearbyZoningAppeals:{labels:["any time","the last 90 days","the next 90 days"],values:[0,-90,90]},nearbyVacantIndicatorPoints:{labels:[],values:[]},nearbyConstructionPermits:{labels:["the last 30 days","the last 90 days","1 year"],values:[30,90,365]},nearbyDemolitionPermits:{labels:["the last 30 days","the last 90 days","1 year"],values:[30,90,365]},nearbyImminentlyDangerous:{labels:["the last 30 days","the last 90 days","1 year"],values:[30,90,365]}},kt=Gi(()=>{if(r.nearby311){let tt=[...r.nearby311.data.rows].filter(rt=>{let It=new Date(rt.requested_datetime);return(new Date-It)/(1e3*60*60*24)<=dt.value});return ae.value==="distance"?tt.sort((rt,It)=>rt.distance-It.distance):ae.value==="time"&&tt.sort((rt,It)=>P(rt,It,"requested_datetime")),tt}}),ri=Gi(()=>{let tt=[];if(!kt.value)return tt;for(let rt of kt.value)tt.push({type:"Feature",geometry:{type:"Point",coordinates:[rt.lng,rt.lat]},properties:{id:rt.service_request_id}});return tt});la(()=>ri.value,tt=>{if(console.log("nearby311Geojson watch, newGeojson:",tt),tt.length>0){console.log("$config:",ps,"map.getStyle().sources:",d.getStyle().sources,"map.getStyle().layers:",d.getStyle().layers);let rt={type:"FeatureCollection",features:tt};console.log("geojson:",rt,"map.getSource(nearby):",d.getSource("nearby")),d.getSource("nearby").setData(rt)}});const xi=Gi(()=>{if(r.nearbyCrimeIncidents){let tt=[...r.nearbyCrimeIncidents.data.rows].filter(rt=>{let It=new Date(rt.dispatch_date);return(new Date-It)/(1e3*60*60*24)<=dt.value});return ae.value==="distance"?tt.sort((rt,It)=>rt.distance-It.distance):ae.value==="time"&&tt.sort((rt,It)=>P(rt,It,"dispatch_date")),tt}}),li=Gi(()=>{let tt=[];if(!xi.value)return tt;for(let rt of xi.value)tt.push({type:"Feature",geometry:{type:"Point",coordinates:[rt.lng,rt.lat]},id:rt.id});return tt});la(()=>li.value,async tt=>{if(console.log("nearbyCrimeIncidents watch, newGeojson:",tt),tt.length>0){console.log("$config:",ps,"map.getStyle().sources:",d.getStyle().sources,"map.getStyle().layers:",d.getStyle().layers);let rt={type:"FeatureCollection",features:tt};await d.getSource("nearby").setData(rt),d.setPaintProperty("nearby","fill-color","#faafee"),console.log("geojson:",rt,"map.getSource(nearby):",d.getSource("nearby"))}});const xr=Gi(()=>{if(r.nearbyZoningAppeals){let tt=[...r.nearbyZoningAppeals.data.rows];return console.log(new Date(tt[0].scheduleddate)),dt.value<0?tt=tt.filter(rt=>{let It=new Date(rt.scheduleddate);return(new Date-It)/(1e3*60*60*24)>=dt.value}):dt.value>0&&(tt=tt.filter(rt=>{let It=new Date(rt.scheduleddate);return(new Date-It)/(1e3*60*60*24)<=dt.value})),ae.value==="distance"?tt.sort((rt,It)=>rt.distance-It.distance):ae.value==="time"&&tt.sort((rt,It)=>P(rt,It,"dispatch_date")),tt}}),si=Gi(()=>{if(r.nearbyVacantIndicatorPoints){let tt=[...r.nearbyVacantIndicatorPoints];return ae.value==="distance"?tt.sort((rt,It)=>rt._distance-It._distance):ae.value==="type"&&tt.sort((rt,It)=>rt.distance-It.distance),tt}});return(tt,rt)=>(Lt(),Xt("section",null,[X3,se("div",{class:Co(D.value?"dropdown is-active":"dropdown"),onClick:z},[K3,se("div",Y3,[se("div",J3,[se("a",{class:"dropdown-item",onClick:rt[0]||(rt[0]=It=>Y("nearby311"))},"311 Requests"),se("a",{class:"dropdown-item",onClick:rt[1]||(rt[1]=It=>Y("nearbyCrimeIncidents"))},"Crime Incidents"),se("a",{class:"dropdown-item",onClick:rt[2]||(rt[2]=It=>Y("nearbyZoningAppeals"))},"Zoning Appeals"),se("a",{class:"dropdown-item",onClick:rt[3]||(rt[3]=It=>Y("nearbyVacantIndicatorPoints"))},"Vacant Properties"),se("a",{class:"dropdown-item",onClick:rt[4]||(rt[4]=It=>Y("nearbyConstructionPermits"))},"Construction Permits"),se("a",{class:"dropdown-item",onClick:rt[5]||(rt[5]=It=>Y("nearbyDemolitionPermits"))},"Demolition Permits"),se("a",{class:"dropdown-item",onClick:rt[6]||(rt[6]=It=>Y("nearbyImminentlyDangerous"))},"Imminently Dangerous")])])],2),se("span",null,ei(R[Z.value]),1),Q3,se("div",{class:Co(Ze.value?"dropdown is-active":"dropdown"),onClick:Je},[eL,se("div",tL,[se("div",iL,[(Lt(!0),Xt(Nr,null,Ca(Vt[Z.value].values,(It,br)=>(Lt(),Xt("a",{class:"dropdown-item",onClick:Oi=>xt(It)},ei(Vt[Z.value].labels[br]),9,rL))),256))])])],2),se("span",null,ei(_t.value),1),se("div",{class:Co(Te.value?"dropdown is-active":"dropdown"),onClick:Fe},[nL,se("div",sL,[se("div",aL,[se("a",{class:"dropdown-item",onClick:rt[7]||(rt[7]=It=>Pe("distance"))},"distance"),se("a",{class:"dropdown-item",onClick:rt[8]||(rt[8]=It=>Pe("time"))},"time")])])],2),se("span",null,ei(ae.value),1),oL,Z.value=="nearby311"?(Lt(),Xt("div",lL,[cL,K.value?(Lt(),Xt("div",uL,"Loading...")):Ki("",!0),se("table",hL,[dL,se("tbody",null,[(Lt(!0),Xt(Nr,null,Ca(kt.value,It=>(Lt(),Xt("tr",null,[se("td",null,ei(ar(m)(It.requested_datetime)),1),se("td",null,ei(It.address),1),se("td",null,ei(It.service_name),1),se("td",null,ei((It.distance*3.28084).toFixed(0))+" ft",1)]))),256))])])])):Ki("",!0),Z.value=="nearbyCrimeIncidents"?(Lt(),Xt("div",fL,[pL,K.value?(Lt(),Xt("div",mL,"Loading...")):Ki("",!0),se("table",gL,[yL,se("tbody",null,[(Lt(!0),Xt(Nr,null,Ca(xi.value,It=>(Lt(),Xt("tr",null,[se("td",null,ei(It.dispatch_date),1),se("td",null,ei(It.location_block),1),se("td",null,ei(It.text_general_code),1),se("td",null,ei((It.distance*3.28084).toFixed(0))+" ft",1)]))),256))])])])):Ki("",!0),Z.value=="nearbyZoningAppeals"?(Lt(),Xt("div",_L,[vL,K.value?(Lt(),Xt("div",xL,"Loading...")):Ki("",!0),se("table",bL,[wL,se("tbody",null,[(Lt(!0),Xt(Nr,null,Ca(xr.value,It=>(Lt(),Xt("tr",null,[se("td",null,ei(It.scheduleddate),1),se("td",null,ei(It.address),1),se("td",null,ei(It.appeal_grounds),1),se("td",null,ei((It.distance*3.28084).toFixed(0))+" ft",1)]))),256))])])])):Ki("",!0),Z.value=="nearbyVacantIndicatorPoints"?(Lt(),Xt("div",ML,[SL,K.value?(Lt(),Xt("div",EL,"Loading...")):Ki("",!0),se("table",TL,[CL,se("tbody",null,[(Lt(!0),Xt(Nr,null,Ca(si.value,It=>(Lt(),Xt("tr",null,[se("td",null,ei(It.properties.ADDRESS),1),se("td",null,ei(It.properties.VACANT_FLAG),1),se("td",null,ei((It._distance*3.28084).toFixed(0))+" ft",1)]))),256))])])])):Ki("",!0)]))}},AL=e=>(vf("data-v-8b6a956f"),e=e(),xf(),e),PL={key:0,class:"columns"},DL=T2('<div class="column is-12" data-v-8b6a956f><h3 class="subtitle is-3" data-v-8b6a956f>Atlas is your front door to the City of Philadelphia.</h3><p class="subtitle is-5" data-v-8b6a956f>Here are some things you can do with Atlas:</p><ul data-v-8b6a956f><li data-v-8b6a956f>Find your polling place</li><li data-v-8b6a956f>Get the history of permits, licenses, and inspections at any address</li><li data-v-8b6a956f>Research real estate information including property values, zoning, and document archives</li><li data-v-8b6a956f>Get easy access to a variety of hard-to-find City resources</li><li data-v-8b6a956f>View recent activity around your address, such as crimes, 311 service requests, and more</li><li data-v-8b6a956f>Explore historical imagery and maps</li></ul><p data-v-8b6a956f>To get started, click anywhere on the map, or type an address, intersection, property assessment account number, or Department of Records Map Registry number into the search box.</p></div>',1),kL=[DL],LL={key:1,class:"columns"},RL=AL(()=>se("div",{class:"column is-12"},[se("p",null,"We couldn't find that address. Are you sure everything was spelled correctly?"),se("p",null,"Here are some examples of things you can search for:"),se("ul",null,[se("li",null,"1234 Market St"),se("li",null,"1001 Pine Street #201"),se("li",null,"12th & Market"),se("li",null,"12th & Market"),se("li",null,"883309050 (an OPA number with no hyphens or other characters)")])],-1)),zL=[RL],OL={key:2},FL={class:"columns"},BL={class:"column is-12"},NL={class:"subtitle is-3"},$L={class:"topics pr-4"},UL={__name:"TopicPanel",setup(e){const r=ha(),a=Rf(),u=Nh(),d=Gi(()=>r.currentAddress),y=Gi(()=>r.dataSourcesLoadedArray);return(m,l)=>(Lt(),Xt("section",null,[ar(u).name=="home"?(Lt(),Xt("div",PL,kL)):Ki("",!0),ar(u).name=="not-found"?(Lt(),Xt("div",LL,zL)):Ki("",!0),d.value?(Lt(),Xt("div",OL,[se("div",FL,[se("div",BL,[se("h3",NL,ei(d.value),1)])]),se("div",$L,[or(tc,{"topic-name":"Property",loading:!y.value.includes("Property")},{default:To(()=>[y.value.includes("Property")?(Lt(),Ka(KC,{key:0})):Ki("",!0)]),_:1},8,["loading"]),iv(or(tc,{"topic-name":"Condominiums",loading:!y.value.includes("Condominiums")},{default:To(()=>[y.value.includes("Condominiums")?(Lt(),Ka(tI,{key:0})):Ki("",!0)]),_:1},8,["loading"]),[[j2,ar(a).condosData.length>0]]),or(tc,{"topic-name":"Deeds",loading:!y.value.includes("Deeds")},{default:To(()=>[y.value.includes("Deeds")?(Lt(),Ka(y3,{key:0})):Ki("",!0)]),_:1},8,["loading"]),or(tc,{"topic-name":"Licenses & Inspections",loading:!y.value.includes("Licenses & Inspections")},{default:To(()=>[y.value.includes("Licenses & Inspections")?(Lt(),Ka(T3,{key:0})):Ki("",!0)]),_:1},8,["loading"]),or(tc,{"topic-name":"Zoning",loading:!y.value.includes("Zoning")},{default:To(()=>[y.value.includes("Zoning")?(Lt(),Ka(A3,{key:0})):Ki("",!0)]),_:1},8,["loading"]),or(tc,{"topic-name":"Voting",loading:!y.value.includes("Voting")},{default:To(()=>[y.value.includes("Voting")?(Lt(),Ka(k3,{key:0})):Ki("",!0)]),_:1},8,["loading"]),or(tc,{"topic-name":"Nearby Activity",loading:!y.value.includes("Nearby Activity")},{default:To(()=>[y.value.includes("Nearby Activity")?(Lt(),Ka(IL,{key:0})):Ki("",!0)]),_:1},8,["loading"])])])):Ki("",!0)]))}},VL=El(UL,[["__scopeId","data-v-8b6a956f"]]);var Xx={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.3/LICENSE.txt
 */(function(e,r){(function(a,u){e.exports=u()})(Hc,function(){var a={},u={};function d(m,l,T){if(u[m]=T,m==="index"){var P="var sharedModule = {}; ("+u.shared+")(sharedModule); ("+u.worker+")(sharedModule);",R={};return u.shared(R),u.index(a,R),typeof window<"u"&&a.setWorkerUrl(window.URL.createObjectURL(new Blob([P],{type:"text/javascript"}))),a}}d("shared",["exports"],function(m){function l(n,t,s,c){return new(s||(s=Promise))(function(p,v){function x(I){try{E(c.next(I))}catch(L){v(L)}}function w(I){try{E(c.throw(I))}catch(L){v(L)}}function E(I){var L;I.done?p(I.value):(L=I.value,L instanceof s?L:new s(function(O){O(L)})).then(x,w)}E((c=c.apply(n,t||[])).next())})}function T(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}typeof SuppressedError=="function"&&SuppressedError;var P=R;function R(n,t){this.x=n,this.y=t}R.prototype={clone:function(){return new R(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,t){return this.clone()._rotateAround(n,t)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var t=n.x-this.x,s=n.y-this.y;return t*t+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,t){return Math.atan2(this.x*t-this.y*n,this.x*n+this.y*t)},_matMult:function(n){var t=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=t,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var t=Math.cos(n),s=Math.sin(n),c=s*this.x+t*this.y;return this.x=t*this.x-s*this.y,this.y=c,this},_rotateAround:function(n,t){var s=Math.cos(n),c=Math.sin(n),p=t.y+c*(this.x-t.x)+s*(this.y-t.y);return this.x=t.x+s*(this.x-t.x)-c*(this.y-t.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},R.convert=function(n){return n instanceof R?n:Array.isArray(n)?new R(n[0],n[1]):n};var D=T(P),z=Z;function Z(n,t,s,c){this.cx=3*n,this.bx=3*(s-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(c-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=t,this.p2x=s,this.p2y=c}Z.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,t){if(t===void 0&&(t=1e-6),n<0)return 0;if(n>1)return 1;for(var s=n,c=0;c<8;c++){var p=this.sampleCurveX(s)-n;if(Math.abs(p)<t)return s;var v=this.sampleCurveDerivativeX(s);if(Math.abs(v)<1e-6)break;s-=p/v}var x=0,w=1;for(s=n,c=0;c<20&&(p=this.sampleCurveX(s),!(Math.abs(p-n)<t));c++)n>p?x=s:w=s,s=.5*(w-x)+x;return s},solve:function(n,t){return this.sampleCurveY(this.solveCurveX(n,t))}};var K=T(z);let Y,me;function Te(){return Y==null&&(Y=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Y}function Fe(){if(me==null&&(me=!1,Te())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let c=0;c<5*5;c++){const p=4*c;t.fillStyle=`rgb(${p},${p+1},${p+2})`,t.fillRect(c%5,Math.floor(c/5),1,1)}const s=t.getImageData(0,0,5,5).data;for(let c=0;c<5*5*4;c++)if(c%4!=3&&s[c]!==c){me=!0;break}}}return me||!1}function ae(n,t,s,c){const p=new K(n,t,s,c);return function(v){return p.solve(v)}}const Pe=ae(.25,.1,.25,1);function Ze(n,t,s){return Math.min(s,Math.max(t,n))}function Je(n,t,s){const c=s-t,p=((n-t)%c+c)%c+t;return p===t?s:p}function dt(n,...t){for(const s of t)for(const c in s)n[c]=s[c];return n}let _t=1;function xt(n,t,s){const c={};for(const p in n)c[p]=t.call(s||this,n[p],p,n);return c}function Vt(n,t,s){const c={};for(const p in n)t.call(s||this,n[p],p,n)&&(c[p]=n[p]);return c}function kt(n){return Array.isArray(n)?n.map(kt):typeof n=="object"&&n?xt(n,kt):n}const ri={};function xi(n){ri[n]||(typeof console<"u"&&console.warn(n),ri[n]=!0)}function li(n,t,s){return(s.y-n.y)*(t.x-n.x)>(t.y-n.y)*(s.x-n.x)}function xr(n){let t=0;for(let s,c,p=0,v=n.length,x=v-1;p<v;x=p++)s=n[p],c=n[x],t+=(c.x-s.x)*(s.y+c.y);return t}function si(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let tt=null;function rt(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const It="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function br(n,t,s,c,p){return l(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const v=new VideoFrame(n,{timestamp:0});try{const x=v==null?void 0:v.format;if(!x||!x.startsWith("BGR")&&!x.startsWith("RGB"))throw new Error(`Unrecognized format ${x}`);const w=x.startsWith("BGR"),E=new Uint8ClampedArray(c*p*4);if(yield v.copyTo(E,function(I,L,O,$,j){const G=4*Math.max(-L,0),X=(Math.max(0,O)-O)*$*4+G,ie=4*$,he=Math.max(0,L),Ee=Math.max(0,O);return{rect:{x:he,y:Ee,width:Math.min(I.width,L+$)-he,height:Math.min(I.height,O+j)-Ee},layout:[{offset:X,stride:ie}]}}(n,t,s,c,p)),w)for(let I=0;I<E.length;I+=4){const L=E[I];E[I]=E[I+2],E[I+2]=L}return E}finally{v.close()}})}let Oi,Si;const Ni="AbortError";function Hr(){return new Error(Ni)}const lr={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Ci(n){return lr.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const Ve="global-dispatcher";class St extends Error{constructor(t,s,c,p){super(`AJAXError: ${s} (${t}): ${c}`),this.status=t,this.statusText=s,this.url=c,this.body=p}}const lt=()=>si(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Ye=function(n,t){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const c=Ci(n.url);if(c)return c(n,t);if(si(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:Ve},t)}if(!(/^file:/.test(s=n.url)||/^file:/.test(lt())&&!/^\w+:/.test(s))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(c,p){return l(this,void 0,void 0,function*(){const v=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,cache:c.cache,referrer:lt(),signal:p.signal});c.type==="json"&&v.headers.set("Accept","application/json");const x=yield fetch(v);if(!x.ok){const I=yield x.blob();throw new St(x.status,x.statusText,c.url,I)}let w;w=c.type==="arrayBuffer"||c.type==="image"?x.arrayBuffer():c.type==="json"?x.json():x.text();const E=yield w;if(p.signal.aborted)throw Hr();return{data:E,cacheControl:x.headers.get("Cache-Control"),expires:x.headers.get("Expires")}})}(n,t);if(si(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:Ve},t)}var s;return function(c,p){return new Promise((v,x)=>{const w=new XMLHttpRequest;w.open(c.method||"GET",c.url,!0),c.type!=="arrayBuffer"&&c.type!=="image"||(w.responseType="arraybuffer");for(const E in c.headers)w.setRequestHeader(E,c.headers[E]);c.type==="json"&&(w.responseType="text",w.setRequestHeader("Accept","application/json")),w.withCredentials=c.credentials==="include",w.onerror=()=>{x(new Error(w.statusText))},w.onload=()=>{if(!p.signal.aborted)if((w.status>=200&&w.status<300||w.status===0)&&w.response!==null){let E=w.response;if(c.type==="json")try{E=JSON.parse(w.response)}catch(I){return void x(I)}v({data:E,cacheControl:w.getResponseHeader("Cache-Control"),expires:w.getResponseHeader("Expires")})}else{const E=new Blob([w.response],{type:w.getResponseHeader("Content-Type")});x(new St(w.status,w.statusText,c.url,E))}},p.signal.addEventListener("abort",()=>{w.abort(),x(Hr())}),w.send(c.body)})}(n,t)};function Ii(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const t=new URL(n),s=window.location;return t.protocol===s.protocol&&t.host===s.host}function ki(n,t,s){s[n]&&s[n].indexOf(t)!==-1||(s[n]=s[n]||[],s[n].push(t))}function ne(n,t,s){if(s&&s[n]){const c=s[n].indexOf(t);c!==-1&&s[n].splice(c,1)}}class ue{constructor(t,s={}){dt(this,s),this.type=t}}class De extends ue{constructor(t,s={}){super("error",dt({error:t},s))}}class Oe{on(t,s){return this._listeners=this._listeners||{},ki(t,s,this._listeners),this}off(t,s){return ne(t,s,this._listeners),ne(t,s,this._oneTimeListeners),this}once(t,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},ki(t,s,this._oneTimeListeners),this):new Promise(c=>this.once(t,c))}fire(t,s){typeof t=="string"&&(t=new ue(t,s||{}));const c=t.type;if(this.listens(c)){t.target=this;const p=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const w of p)w.call(this,t);const v=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const w of v)ne(c,w,this._oneTimeListeners),w.call(this,t);const x=this._eventedParent;x&&(dt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(t))}else t instanceof De&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,s){return this._eventedParent=t,this._eventedParentData=s,this}}var ce={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const ut=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ct(n,t){const s={};for(const c in n)c!=="ref"&&(s[c]=n[c]);return ut.forEach(c=>{c in t&&(s[c]=t[c])}),s}function Be(n,t){if(Array.isArray(n)){if(!Array.isArray(t)||n.length!==t.length)return!1;for(let s=0;s<n.length;s++)if(!Be(n[s],t[s]))return!1;return!0}if(typeof n=="object"&&n!==null&&t!==null){if(typeof t!="object"||Object.keys(n).length!==Object.keys(t).length)return!1;for(const s in n)if(!Be(n[s],t[s]))return!1;return!0}return n===t}function it(n,t){n.push(t)}function et(n,t,s){it(s,{command:"addSource",args:[n,t[n]]})}function At(n,t,s){it(t,{command:"removeSource",args:[n]}),s[n]=!0}function Gt(n,t,s,c){At(n,s,c),et(n,t,s)}function jt(n,t,s){let c;for(c in n[s])if(Object.prototype.hasOwnProperty.call(n[s],c)&&c!=="data"&&!Be(n[s][c],t[s][c]))return!1;for(c in t[s])if(Object.prototype.hasOwnProperty.call(t[s],c)&&c!=="data"&&!Be(n[s][c],t[s][c]))return!1;return!0}function Zt(n,t,s,c,p,v){n=n||{},t=t||{};for(const x in n)Object.prototype.hasOwnProperty.call(n,x)&&(Be(n[x],t[x])||s.push({command:v,args:[c,x,t[x],p]}));for(const x in t)Object.prototype.hasOwnProperty.call(t,x)&&!Object.prototype.hasOwnProperty.call(n,x)&&(Be(n[x],t[x])||s.push({command:v,args:[c,x,t[x],p]}))}function fi(n){return n.id}function bi(n,t){return n[t.id]=t,n}class Ue{constructor(t,s,c,p){this.message=(t?`${t}: `:"")+c,p&&(this.identifier=p),s!=null&&s.__line__&&(this.line=s.__line__)}}function Ri(n,...t){for(const s of t)for(const c in s)n[c]=s[c];return n}class Zi extends Error{constructor(t,s){super(s),this.message=s,this.key=t}}class pn{constructor(t,s=[]){this.parent=t,this.bindings={};for(const[c,p]of s)this.bindings[c]=p}concat(t){return new pn(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const wr={kind:"null"},nt={kind:"number"},ai={kind:"string"},Ot={kind:"boolean"},$i={kind:"color"},mn={kind:"object"},Jt={kind:"value"},Ws={kind:"collator"},Mr={kind:"formatted"},ee={kind:"padding"},N={kind:"resolvedImage"},U={kind:"variableAnchorOffsetCollection"};function H(n,t){return{kind:"array",itemType:n,N:t}}function J(n){if(n.kind==="array"){const t=J(n.itemType);return typeof n.N=="number"?`array<${t}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${t}>`}return n.kind}const _e=[wr,nt,ai,Ot,$i,Mr,mn,H(Jt),ee,N,U];function ve(n,t){if(t.kind==="error")return null;if(n.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!ve(n.itemType,t.itemType))&&(typeof n.N!="number"||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if(n.kind==="value"){for(const s of _e)if(!ve(s,t))return null}}return`Expected ${J(n)} but found ${J(t)} instead.`}function we(n,t){return t.some(s=>s.kind===n.kind)}function de(n,t){return t.some(s=>s==="null"?n===null:s==="array"?Array.isArray(n):s==="object"?n&&!Array.isArray(n)&&typeof n=="object":s===typeof n)}function Ce(n,t){return n.kind==="array"&&t.kind==="array"?n.itemType.kind===t.itemType.kind&&typeof n.N=="number":n.kind===t.kind}const qe=.96422,Re=.82521,Ne=4/29,Ft=6/29,Ut=3*Ft*Ft,Qt=Ft*Ft*Ft,ti=Math.PI/180,mi=180/Math.PI;function Fi(n){return(n%=360)<0&&(n+=360),n}function ir([n,t,s,c]){let p,v;const x=Ht((.2225045*(n=Or(n))+.7168786*(t=Or(t))+.0606169*(s=Or(s)))/1);n===t&&t===s?p=v=x:(p=Ht((.4360747*n+.3850649*t+.1430804*s)/qe),v=Ht((.0139322*n+.0971045*t+.7141733*s)/Re));const w=116*x-16;return[w<0?0:w,500*(p-x),200*(x-v),c]}function Or(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Ht(n){return n>Qt?Math.pow(n,1/3):n/Ut+Ne}function pr([n,t,s,c]){let p=(n+16)/116,v=isNaN(t)?p:p+t/500,x=isNaN(s)?p:p-s/200;return p=1*gn(p),v=qe*gn(v),x=Re*gn(x),[Ur(3.1338561*v-1.6168667*p-.4906146*x),Ur(-.9787684*v+1.9161415*p+.033454*x),Ur(.0719453*v-.2289914*p+1.4052427*x),c]}function Ur(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function gn(n){return n>Ft?n*n*n:Ut*(n-Ne)}function yn(n){return parseInt(n.padEnd(2,n),16)/255}function Zr(n,t){return jn(t?n/100:n,0,1)}function jn(n,t,s){return Math.min(Math.max(t,n),s)}function fc(n){return!n.some(Number.isNaN)}const Lo={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Bi{constructor(t,s,c,p=1,v=!0){this.r=t,this.g=s,this.b=c,this.a=p,v||(this.r*=p,this.g*=p,this.b*=p,p||this.overwriteGetter("rgb",[t,s,c,p]))}static parse(t){if(t instanceof Bi)return t;if(typeof t!="string")return;const s=function(c){if((c=c.toLowerCase().trim())==="transparent")return[0,0,0,0];const p=Lo[c];if(p){const[x,w,E]=p;return[x/255,w/255,E/255,1]}if(c.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(c)){const x=c.length<6?1:2;let w=1;return[yn(c.slice(w,w+=x)),yn(c.slice(w,w+=x)),yn(c.slice(w,w+=x)),yn(c.slice(w,w+x)||"ff")]}if(c.startsWith("rgb")){const x=c.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[w,E,I,L,O,$,j,G,X,ie,he,Ee]=x,fe=[L||" ",j||" ",ie].join("");if(fe==="  "||fe==="  /"||fe===",,"||fe===",,,"){const xe=[I,$,X].join(""),$e=xe==="%%%"?100:xe===""?255:0;if($e){const Ge=[jn(+E/$e,0,1),jn(+O/$e,0,1),jn(+G/$e,0,1),he?Zr(+he,Ee):1];if(fc(Ge))return Ge}}return}}const v=c.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[x,w,E,I,L,O,$,j,G]=v,X=[E||" ",L||" ",$].join("");if(X==="  "||X==="  /"||X===",,"||X===",,,"){const ie=[+w,jn(+I,0,100),jn(+O,0,100),j?Zr(+j,G):1];if(fc(ie))return function([he,Ee,fe,xe]){function $e(Ge){const Tt=(Ge+he/30)%12,zt=Ee*Math.min(fe,1-fe);return fe-zt*Math.max(-1,Math.min(Tt-3,9-Tt,1))}return he=Fi(he),Ee/=100,fe/=100,[$e(0),$e(8),$e(4),xe]}(ie)}}}(t);return s?new Bi(...s,!1):void 0}get rgb(){const{r:t,g:s,b:c,a:p}=this,v=p||1/0;return this.overwriteGetter("rgb",[t/v,s/v,c/v,p])}get hcl(){return this.overwriteGetter("hcl",function(t){const[s,c,p,v]=ir(t),x=Math.sqrt(c*c+p*p);return[Math.round(1e4*x)?Fi(Math.atan2(p,c)*mi):NaN,x,s,v]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ir(this.rgb))}overwriteGetter(t,s){return Object.defineProperty(this,t,{value:s}),s}toString(){const[t,s,c,p]=this.rgb;return`rgba(${[t,s,c].map(v=>Math.round(255*v)).join(",")},${p})`}}Bi.black=new Bi(0,0,0,1),Bi.white=new Bi(1,1,1,1),Bi.transparent=new Bi(0,0,0,0),Bi.red=new Bi(1,0,0,1);class so{constructor(t,s,c){this.sensitivity=t?s?"variant":"case":s?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,s){return this.collator.compare(t,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ar{constructor(t,s,c,p,v){this.text=t,this.image=s,this.scale=c,this.fontStack=p,this.textColor=v}}class An{constructor(t){this.sections=t}static fromString(t){return new An([new Ar(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof An?t:An.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class _n{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof _n)return t;if(typeof t=="number")return new _n([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const s of t)if(typeof s!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new _n(t)}}toString(){return JSON.stringify(this.values)}}const qn=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Pr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Pr)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let s=0;s<t.length;s+=2){const c=t[s],p=t[s+1];if(typeof c!="string"||!qn.has(c)||!Array.isArray(p)||p.length!==2||typeof p[0]!="number"||typeof p[1]!="number")return}return new Pr(t)}}toString(){return JSON.stringify(this.values)}}class vn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new vn({name:t,available:!1}):null}}function Gn(n,t,s,c){return typeof n=="number"&&n>=0&&n<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof s=="number"&&s>=0&&s<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[n,t,s,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[n,t,s,c]:[n,t,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ys(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Bi||n instanceof so||n instanceof An||n instanceof _n||n instanceof Pr||n instanceof vn)return!0;if(Array.isArray(n)){for(const t of n)if(!ys(t))return!1;return!0}if(typeof n=="object"){for(const t in n)if(!ys(n[t]))return!1;return!0}return!1}function Dr(n){if(n===null)return wr;if(typeof n=="string")return ai;if(typeof n=="boolean")return Ot;if(typeof n=="number")return nt;if(n instanceof Bi)return $i;if(n instanceof so)return Ws;if(n instanceof An)return Mr;if(n instanceof _n)return ee;if(n instanceof Pr)return U;if(n instanceof vn)return N;if(Array.isArray(n)){const t=n.length;let s;for(const c of n){const p=Dr(c);if(s){if(s===p)continue;s=Jt;break}s=p}return H(s||Jt,t)}return mn}function ao(n){const t=typeof n;return n===null?"":t==="string"||t==="number"||t==="boolean"?String(n):n instanceof Bi||n instanceof An||n instanceof _n||n instanceof Pr||n instanceof vn?n.toString():JSON.stringify(n)}class Xs{constructor(t,s){this.type=t,this.value=s}static parse(t,s){if(t.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!ys(t[1]))return s.error("invalid value");const c=t[1];let p=Dr(c);const v=s.expectedType;return p.kind!=="array"||p.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(p=v),new Xs(p,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class cr{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const oo={string:ai,number:nt,boolean:Ot,object:mn};class xn{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");let c,p=1;const v=t[0];if(v==="array"){let w,E;if(t.length>2){const I=t[1];if(typeof I!="string"||!(I in oo)||I==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);w=oo[I],p++}else w=Jt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return s.error('The length argument to "array" must be a positive integer literal',2);E=t[2],p++}c=H(w,E)}else{if(!oo[v])throw new Error(`Types doesn't contain name = ${v}`);c=oo[v]}const x=[];for(;p<t.length;p++){const w=s.parse(t[p],p,Jt);if(!w)return null;x.push(w)}return new xn(c,x)}evaluate(t){for(let s=0;s<this.args.length;s++){const c=this.args[s].evaluate(t);if(!ve(this.type,Dr(c)))return c;if(s===this.args.length-1)throw new cr(`Expected value to be of type ${J(this.type)}, but found ${J(Dr(c))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const lo={"to-boolean":Ot,"to-color":$i,"to-number":nt,"to-string":ai};class is{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const c=t[0];if(!lo[c])throw new Error(`Can't parse ${c} as it is not part of the known types`);if((c==="to-boolean"||c==="to-string")&&t.length!==2)return s.error("Expected one argument.");const p=lo[c],v=[];for(let x=1;x<t.length;x++){const w=s.parse(t[x],x,Jt);if(!w)return null;v.push(w)}return new is(p,v)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let s,c;for(const p of this.args){if(s=p.evaluate(t),c=null,s instanceof Bi)return s;if(typeof s=="string"){const v=t.parseColor(s);if(v)return v}else if(Array.isArray(s)&&(c=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Gn(s[0],s[1],s[2],s[3]),!c))return new Bi(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new cr(c||`Could not parse color from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"padding":{let s;for(const c of this.args){s=c.evaluate(t);const p=_n.parse(s);if(p)return p}throw new cr(`Could not parse padding from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"variableAnchorOffsetCollection":{let s;for(const c of this.args){s=c.evaluate(t);const p=Pr.parse(s);if(p)return p}throw new cr(`Could not parse variableAnchorOffsetCollection from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"number":{let s=null;for(const c of this.args){if(s=c.evaluate(t),s===null)return 0;const p=Number(s);if(!isNaN(p))return p}throw new cr(`Could not convert ${JSON.stringify(s)} to number.`)}case"formatted":return An.fromString(ao(this.args[0].evaluate(t)));case"resolvedImage":return vn.fromString(ao(this.args[0].evaluate(t)));default:return ao(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const co=["Unknown","Point","LineString","Polygon"];class Ui{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?co[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let s=this._parseColorCache[t];return s||(s=this._parseColorCache[t]=Bi.parse(t)),s}}class Ro{constructor(t,s,c=[],p,v=new pn,x=[]){this.registry=t,this.path=c,this.key=c.map(w=>`[${w}]`).join(""),this.scope=v,this.errors=x,this.expectedType=p,this._isConstant=s}parse(t,s,c,p,v={}){return s?this.concat(s,c,p)._parse(t,v):this._parse(t,v)}_parse(t,s){function c(p,v,x){return x==="assert"?new xn(v,[p]):x==="coerce"?new is(v,[p]):p}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=t[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[p];if(v){let x=v.parse(t,this);if(!x)return null;if(this.expectedType){const w=this.expectedType,E=x.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||E.kind!=="value")if(w.kind!=="color"&&w.kind!=="formatted"&&w.kind!=="resolvedImage"||E.kind!=="value"&&E.kind!=="string")if(w.kind!=="padding"||E.kind!=="value"&&E.kind!=="number"&&E.kind!=="array")if(w.kind!=="variableAnchorOffsetCollection"||E.kind!=="value"&&E.kind!=="array"){if(this.checkSubtype(w,E))return null}else x=c(x,w,s.typeAnnotation||"coerce");else x=c(x,w,s.typeAnnotation||"coerce");else x=c(x,w,s.typeAnnotation||"coerce");else x=c(x,w,s.typeAnnotation||"assert")}if(!(x instanceof Xs)&&x.type.kind!=="resolvedImage"&&this._isConstant(x)){const w=new Ui;try{x=new Xs(x.type,x.evaluate(w))}catch(E){return this.error(E.message),null}}return x}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,s,c){const p=typeof t=="number"?this.path.concat(t):this.path,v=c?this.scope.concat(c):this.scope;return new Ro(this.registry,this._isConstant,p,s||null,v,this.errors)}error(t,...s){const c=`${this.key}${s.map(p=>`[${p}]`).join("")}`;this.errors.push(new Zi(c,t))}checkSubtype(t,s){const c=ve(t,s);return c&&this.error(c),c}}class Ls{constructor(t,s,c){this.type=Ws,this.locale=c,this.caseSensitive=t,this.diacriticSensitive=s}static parse(t,s){if(t.length!==2)return s.error("Expected one argument.");const c=t[1];if(typeof c!="object"||Array.isArray(c))return s.error("Collator options argument must be an object.");const p=s.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,Ot);if(!p)return null;const v=s.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,Ot);if(!v)return null;let x=null;return c.locale&&(x=s.parse(c.locale,1,ai),!x)?null:new Ls(p,v,x)}evaluate(t){return new so(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}const b=8192;function A(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function V(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function oe(n,t){const s=(180+n[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,p=Math.pow(2,t.z);return[Math.round(s*p*b),Math.round(c*p*b)]}function ge(n,t,s){const c=n[0]-t[0],p=n[1]-t[1],v=n[0]-s[0],x=n[1]-s[1];return c*x-v*p==0&&c*v<=0&&p*x<=0}function ye(n,t){let s=!1;for(let x=0,w=t.length;x<w;x++){const E=t[x];for(let I=0,L=E.length;I<L-1;I++){if(ge(n,E[I],E[I+1]))return!1;(p=E[I])[1]>(c=n)[1]!=(v=E[I+1])[1]>c[1]&&c[0]<(v[0]-p[0])*(c[1]-p[1])/(v[1]-p[1])+p[0]&&(s=!s)}}var c,p,v;return s}function Me(n,t){for(let s=0;s<t.length;s++)if(ye(n,t[s]))return!0;return!1}function Ke(n,t,s,c){const p=c[0]-s[0],v=c[1]-s[1],x=(n[0]-s[0])*v-p*(n[1]-s[1]),w=(t[0]-s[0])*v-p*(t[1]-s[1]);return x>0&&w<0||x<0&&w>0}function at(n,t,s){for(const I of s)for(let L=0;L<I.length-1;++L)if((w=[(x=I[L+1])[0]-(v=I[L])[0],x[1]-v[1]])[0]*(E=[(p=t)[0]-(c=n)[0],p[1]-c[1]])[1]-w[1]*E[0]!=0&&Ke(c,p,v,x)&&Ke(v,x,c,p))return!0;var c,p,v,x,w,E;return!1}function bt(n,t){for(let s=0;s<n.length;++s)if(!ye(n[s],t))return!1;for(let s=0;s<n.length-1;++s)if(at(n[s],n[s+1],t))return!1;return!0}function wt(n,t){for(let s=0;s<t.length;s++)if(bt(n,t[s]))return!0;return!1}function ht(n,t,s){const c=[];for(let p=0;p<n.length;p++){const v=[];for(let x=0;x<n[p].length;x++){const w=oe(n[p][x],s);A(t,w),v.push(w)}c.push(v)}return c}function ni(n,t,s){const c=[];for(let p=0;p<n.length;p++){const v=ht(n[p],t,s);c.push(v)}return c}function ur(n,t,s,c){if(n[0]<s[0]||n[0]>s[2]){const p=.5*c;let v=n[0]-s[0]>p?-c:s[0]-n[0]>p?c:0;v===0&&(v=n[0]-s[2]>p?-c:s[2]-n[0]>p?c:0),n[0]+=v}A(t,n)}function oi(n,t,s,c){const p=Math.pow(2,c.z)*b,v=[c.x*b,c.y*b],x=[];for(const w of n)for(const E of w){const I=[E.x+v[0],E.y+v[1]];ur(I,t,s,p),x.push(I)}return x}function kr(n,t,s,c){const p=Math.pow(2,c.z)*b,v=[c.x*b,c.y*b],x=[];for(const E of n){const I=[];for(const L of E){const O=[L.x+v[0],L.y+v[1]];A(t,O),I.push(O)}x.push(I)}if(t[2]-t[0]<=p/2){(w=t)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const E of x)for(const I of E)ur(I,t,s,p)}var w;return x}class je{constructor(t,s){this.type=Ot,this.geojson=t,this.geometries=s}static parse(t,s){if(t.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ys(t[1])){const c=t[1];if(c.type==="FeatureCollection"){const p=[];for(const v of c.features){const{type:x,coordinates:w}=v.geometry;x==="Polygon"&&p.push(w),x==="MultiPolygon"&&p.push(...w)}if(p.length)return new je(c,{type:"MultiPolygon",coordinates:p})}else if(c.type==="Feature"){const p=c.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new je(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new je(c,c)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(s,c){const p=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=s.canonicalID();if(c.type==="Polygon"){const w=ht(c.coordinates,v,x),E=oi(s.geometry(),p,v,x);if(!V(p,v))return!1;for(const I of E)if(!ye(I,w))return!1}if(c.type==="MultiPolygon"){const w=ni(c.coordinates,v,x),E=oi(s.geometry(),p,v,x);if(!V(p,v))return!1;for(const I of E)if(!Me(I,w))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(s,c){const p=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=s.canonicalID();if(c.type==="Polygon"){const w=ht(c.coordinates,v,x),E=kr(s.geometry(),p,v,x);if(!V(p,v))return!1;for(const I of E)if(!bt(I,w))return!1}if(c.type==="MultiPolygon"){const w=ni(c.coordinates,v,x),E=kr(s.geometry(),p,v,x);if(!V(p,v))return!1;for(const I of E)if(!wt(I,w))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Rt{constructor(t,s){this.type=s.type,this.name=t,this.boundExpression=s}static parse(t,s){if(t.length!==2||typeof t[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const c=t[1];return s.scope.has(c)?new Rt(c,s.scope.get(c)):s.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class gi{constructor(t,s,c,p){this.name=t,this.type=s,this._evaluate=c,this.args=p}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,s){const c=t[0],p=gi.definitions[c];if(!p)return s.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(p)?p[0]:p.type,x=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,w=x.filter(([I])=>!Array.isArray(I)||I.length===t.length-1);let E=null;for(const[I,L]of w){E=new Ro(s.registry,Sr,s.path,null,s.scope);const O=[];let $=!1;for(let j=1;j<t.length;j++){const G=t[j],X=Array.isArray(I)?I[j-1]:I.type,ie=E.parse(G,1+O.length,X);if(!ie){$=!0;break}O.push(ie)}if(!$)if(Array.isArray(I)&&I.length!==O.length)E.error(`Expected ${I.length} arguments, but found ${O.length} instead.`);else{for(let j=0;j<O.length;j++){const G=Array.isArray(I)?I[j]:I.type,X=O[j];E.concat(j+1).checkSubtype(G,X.type)}if(E.errors.length===0)return new gi(c,v,L,O)}}if(w.length===1)s.errors.push(...E.errors);else{const I=(w.length?w:x).map(([O])=>{return $=O,Array.isArray($)?`(${$.map(J).join(", ")})`:`(${J($.type)}...)`;var $}).join(" | "),L=[];for(let O=1;O<t.length;O++){const $=s.parse(t[O],1+L.length);if(!$)return null;L.push(J($.type))}s.error(`Expected arguments of type ${I}, but found (${L.join(", ")}) instead.`)}return null}static register(t,s){gi.definitions=s;for(const c in s)t[c]=gi}}function Sr(n){if(n instanceof Rt)return Sr(n.boundExpression);if(n instanceof gi&&n.name==="error"||n instanceof Ls||n instanceof je)return!1;const t=n instanceof is||n instanceof xn;let s=!0;return n.eachChild(c=>{s=t?s&&Sr(c):s&&c instanceof Xs}),!!s&&mr(n)&&uo(n,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function mr(n){if(n instanceof gi&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof je)return!1;let t=!0;return n.eachChild(s=>{t&&!mr(s)&&(t=!1)}),t}function da(n){if(n instanceof gi&&n.name==="feature-state")return!1;let t=!0;return n.eachChild(s=>{t&&!da(s)&&(t=!1)}),t}function uo(n,t){if(n instanceof gi&&t.indexOf(n.name)>=0)return!1;let s=!0;return n.eachChild(c=>{s&&!uo(c,t)&&(s=!1)}),s}function ji(n,t){const s=n.length-1;let c,p,v=0,x=s,w=0;for(;v<=x;)if(w=Math.floor((v+x)/2),c=n[w],p=n[w+1],c<=t){if(w===s||t<p)return w;v=w+1}else{if(!(c>t))throw new cr("Input is not a number.");x=w-1}return 0}class za{constructor(t,s,c){this.type=t,this.input=s,this.labels=[],this.outputs=[];for(const[p,v]of c)this.labels.push(p),this.outputs.push(v)}static parse(t,s){if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");const c=s.parse(t[1],1,nt);if(!c)return null;const p=[];let v=null;s.expectedType&&s.expectedType.kind!=="value"&&(v=s.expectedType);for(let x=1;x<t.length;x+=2){const w=x===1?-1/0:t[x],E=t[x+1],I=x,L=x+1;if(typeof w!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(p.length&&p[p.length-1][0]>=w)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const O=s.parse(E,L,v);if(!O)return null;v=v||O.type,p.push([w,O])}return new za(v,c,p)}evaluate(t){const s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(t);const p=this.input.evaluate(t);if(p<=s[0])return c[0].evaluate(t);const v=s.length;return p>=s[v-1]?c[v-1].evaluate(t):c[ji(s,p)].evaluate(t)}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function yu(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Rs=Cl;function Cl(n,t,s,c){this.cx=3*n,this.bx=3*(s-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(c-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=t,this.p2x=s,this.p2y=c}Cl.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,t){if(t===void 0&&(t=1e-6),n<0)return 0;if(n>1)return 1;for(var s=n,c=0;c<8;c++){var p=this.sampleCurveX(s)-n;if(Math.abs(p)<t)return s;var v=this.sampleCurveDerivativeX(s);if(Math.abs(v)<1e-6)break;s-=p/v}var x=0,w=1;for(s=n,c=0;c<20&&(p=this.sampleCurveX(s),!(Math.abs(p-n)<t));c++)n>p?x=s:w=s,s=.5*(w-x)+x;return s},solve:function(n,t){return this.sampleCurveY(this.solveCurveX(n,t))}};var pc=yu(Rs);function Ks(n,t,s){return n+s*(t-n)}function Oa(n,t,s){return n.map((c,p)=>Ks(c,t[p],s))}const dn={number:Ks,color:function(n,t,s,c="rgb"){switch(c){case"rgb":{const[p,v,x,w]=Oa(n.rgb,t.rgb,s);return new Bi(p,v,x,w,!1)}case"hcl":{const[p,v,x,w]=n.hcl,[E,I,L,O]=t.hcl;let $,j;if(isNaN(p)||isNaN(E))isNaN(p)?isNaN(E)?$=NaN:($=E,x!==1&&x!==0||(j=I)):($=p,L!==1&&L!==0||(j=v));else{let Ee=E-p;E>p&&Ee>180?Ee-=360:E<p&&p-E>180&&(Ee+=360),$=p+s*Ee}const[G,X,ie,he]=function([Ee,fe,xe,$e]){return Ee=isNaN(Ee)?0:Ee*ti,pr([xe,Math.cos(Ee)*fe,Math.sin(Ee)*fe,$e])}([$,j??Ks(v,I,s),Ks(x,L,s),Ks(w,O,s)]);return new Bi(G,X,ie,he,!1)}case"lab":{const[p,v,x,w]=pr(Oa(n.lab,t.lab,s));return new Bi(p,v,x,w,!1)}}},array:Oa,padding:function(n,t,s){return new _n(Oa(n.values,t.values,s))},variableAnchorOffsetCollection:function(n,t,s){const c=n.values,p=t.values;if(c.length!==p.length)throw new cr(`Cannot interpolate values of different length. from: ${n.toString()}, to: ${t.toString()}`);const v=[];for(let x=0;x<c.length;x+=2){if(c[x]!==p[x])throw new cr(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${c[x]}, to[${x}]: ${p[x]}`);v.push(c[x]);const[w,E]=c[x+1],[I,L]=p[x+1];v.push([Ks(w,I,s),Ks(E,L,s)])}return new Pr(v)}};class Jr{constructor(t,s,c,p,v){this.type=t,this.operator=s,this.interpolation=c,this.input=p,this.labels=[],this.outputs=[];for(const[x,w]of v)this.labels.push(x),this.outputs.push(w)}static interpolationFactor(t,s,c,p){let v=0;if(t.name==="exponential")v=Li(s,t.base,c,p);else if(t.name==="linear")v=Li(s,1,c,p);else if(t.name==="cubic-bezier"){const x=t.controlPoints;v=new pc(x[0],x[1],x[2],x[3]).solve(Li(s,1,c,p))}return v}static parse(t,s){let[c,p,v,...x]=t;if(!Array.isArray(p)||p.length===0)return s.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const I=p[1];if(typeof I!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:I}}else{if(p[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const I=p.slice(1);if(I.length!==4||I.some(L=>typeof L!="number"||L<0||L>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:I}}}if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(v=s.parse(v,2,nt),!v)return null;const w=[];let E=null;c==="interpolate-hcl"||c==="interpolate-lab"?E=$i:s.expectedType&&s.expectedType.kind!=="value"&&(E=s.expectedType);for(let I=0;I<x.length;I+=2){const L=x[I],O=x[I+1],$=I+3,j=I+4;if(typeof L!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',$);if(w.length&&w[w.length-1][0]>=L)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',$);const G=s.parse(O,j,E);if(!G)return null;E=E||G.type,w.push([L,G])}return Ce(E,nt)||Ce(E,$i)||Ce(E,ee)||Ce(E,U)||Ce(E,H(nt))?new Jr(E,c,p,v,w):s.error(`Type ${J(E)} is not interpolatable.`)}evaluate(t){const s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(t);const p=this.input.evaluate(t);if(p<=s[0])return c[0].evaluate(t);const v=s.length;if(p>=s[v-1])return c[v-1].evaluate(t);const x=ji(s,p),w=Jr.interpolationFactor(this.interpolation,p,s[x],s[x+1]),E=c[x].evaluate(t),I=c[x+1].evaluate(t);switch(this.operator){case"interpolate":return dn[this.type.kind](E,I,w);case"interpolate-hcl":return dn.color(E,I,w,"hcl");case"interpolate-lab":return dn.color(E,I,w,"lab")}}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Li(n,t,s,c){const p=c-s,v=n-s;return p===0?0:t===1?v/p:(Math.pow(t,v)-1)/(Math.pow(t,p)-1)}class zo{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expectected at least one argument.");let c=null;const p=s.expectedType;p&&p.kind!=="value"&&(c=p);const v=[];for(const w of t.slice(1)){const E=s.parse(w,1+v.length,c,void 0,{typeAnnotation:"omit"});if(!E)return null;c=c||E.type,v.push(E)}if(!c)throw new Error("No output type");const x=p&&v.some(w=>ve(p,w.type));return new zo(x?Jt:c,v)}evaluate(t){let s,c=null,p=0;for(const v of this.args)if(p++,c=v.evaluate(t),c&&c instanceof vn&&!c.available&&(s||(s=c.name),c=null,p===this.args.length&&(c=s)),c!==null)break;return c}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}class Oo{constructor(t,s){this.type=s.type,this.bindings=[].concat(t),this.result=s}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const s of this.bindings)t(s[1]);t(this.result)}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const c=[];for(let v=1;v<t.length-1;v+=2){const x=t[v];if(typeof x!="string")return s.error(`Expected string, but found ${typeof x} instead.`,v);if(/[^a-zA-Z0-9_]/.test(x))return s.error("Variable names must contain only alphanumeric characters or '_'.",v);const w=s.parse(t[v+1],v+1);if(!w)return null;c.push([x,w])}const p=s.parse(t[t.length-1],t.length-1,s.expectedType,c);return p?new Oo(c,p):null}outputDefined(){return this.result.outputDefined()}}class Fo{constructor(t,s,c){this.type=t,this.index=s,this.input=c}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,nt),p=s.parse(t[2],2,H(s.expectedType||Jt));return c&&p?new Fo(p.type.itemType,c,p):null}evaluate(t){const s=this.index.evaluate(t),c=this.input.evaluate(t);if(s<0)throw new cr(`Array index out of bounds: ${s} < 0.`);if(s>=c.length)throw new cr(`Array index out of bounds: ${s} > ${c.length-1}.`);if(s!==Math.floor(s))throw new cr(`Array index must be an integer, but found ${s} instead.`);return c[s]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Bo{constructor(t,s){this.type=Ot,this.needle=t,this.haystack=s}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,Jt),p=s.parse(t[2],2,Jt);return c&&p?we(c.type,[Ot,ai,nt,wr,Jt])?new Bo(c,p):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${J(c.type)} instead`):null}evaluate(t){const s=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(!c)return!1;if(!de(s,["boolean","string","number","null"]))throw new cr(`Expected first argument to be of type boolean, string, number or null, but found ${J(Dr(s))} instead.`);if(!de(c,["string","array"]))throw new cr(`Expected second argument to be of type array or string, but found ${J(Dr(c))} instead.`);return c.indexOf(s)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class ho{constructor(t,s,c){this.type=nt,this.needle=t,this.haystack=s,this.fromIndex=c}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,Jt),p=s.parse(t[2],2,Jt);if(!c||!p)return null;if(!we(c.type,[Ot,ai,nt,wr,Jt]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${J(c.type)} instead`);if(t.length===4){const v=s.parse(t[3],3,nt);return v?new ho(c,p,v):null}return new ho(c,p)}evaluate(t){const s=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(!de(s,["boolean","string","number","null"]))throw new cr(`Expected first argument to be of type boolean, string, number or null, but found ${J(Dr(s))} instead.`);if(!de(c,["string","array"]))throw new cr(`Expected second argument to be of type array or string, but found ${J(Dr(c))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(t);return c.indexOf(s,p)}return c.indexOf(s)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Il{constructor(t,s,c,p,v,x){this.inputType=t,this.type=s,this.input=c,this.cases=p,this.outputs=v,this.otherwise=x}static parse(t,s){if(t.length<5)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return s.error("Expected an even number of arguments.");let c,p;s.expectedType&&s.expectedType.kind!=="value"&&(p=s.expectedType);const v={},x=[];for(let I=2;I<t.length-1;I+=2){let L=t[I];const O=t[I+1];Array.isArray(L)||(L=[L]);const $=s.concat(I);if(L.length===0)return $.error("Expected at least one branch label.");for(const G of L){if(typeof G!="number"&&typeof G!="string")return $.error("Branch labels must be numbers or strings.");if(typeof G=="number"&&Math.abs(G)>Number.MAX_SAFE_INTEGER)return $.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof G=="number"&&Math.floor(G)!==G)return $.error("Numeric branch labels must be integer values.");if(c){if($.checkSubtype(c,Dr(G)))return null}else c=Dr(G);if(v[String(G)]!==void 0)return $.error("Branch labels must be unique.");v[String(G)]=x.length}const j=s.parse(O,I,p);if(!j)return null;p=p||j.type,x.push(j)}const w=s.parse(t[1],1,Jt);if(!w)return null;const E=s.parse(t[t.length-1],t.length-1,p);return E?w.type.kind!=="value"&&s.concat(1).checkSubtype(c,w.type)?null:new Il(c,p,w,v,x,E):null}evaluate(t){const s=this.input.evaluate(t);return(Dr(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Al{constructor(t,s,c){this.type=t,this.branches=s,this.otherwise=c}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return s.error("Expected an odd number of arguments.");let c;s.expectedType&&s.expectedType.kind!=="value"&&(c=s.expectedType);const p=[];for(let x=1;x<t.length-1;x+=2){const w=s.parse(t[x],x,Ot);if(!w)return null;const E=s.parse(t[x+1],x+1,c);if(!E)return null;p.push([w,E]),c=c||E.type}const v=s.parse(t[t.length-1],t.length-1,c);if(!v)return null;if(!c)throw new Error("Can't infer output type");return new Al(c,p,v)}evaluate(t){for(const[s,c]of this.branches)if(s.evaluate(t))return c.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[s,c]of this.branches)t(s),t(c);t(this.otherwise)}outputDefined(){return this.branches.every(([t,s])=>s.outputDefined())&&this.otherwise.outputDefined()}}class fa{constructor(t,s,c,p){this.type=t,this.input=s,this.beginIndex=c,this.endIndex=p}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,Jt),p=s.parse(t[2],2,nt);if(!c||!p)return null;if(!we(c.type,[H(Jt),ai,Jt]))return s.error(`Expected first argument to be of type array or string, but found ${J(c.type)} instead`);if(t.length===4){const v=s.parse(t[3],3,nt);return v?new fa(c.type,c,p,v):null}return new fa(c.type,c,p)}evaluate(t){const s=this.input.evaluate(t),c=this.beginIndex.evaluate(t);if(!de(s,["string","array"]))throw new cr(`Expected first argument to be of type array or string, but found ${J(Dr(s))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(t);return s.slice(c,p)}return s.slice(c)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function No(n,t){return n==="=="||n==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Pl(n,t,s,c){return c.compare(t,s)===0}function bn(n,t,s){const c=n!=="=="&&n!=="!=";return class Kx{constructor(v,x,w){this.type=Ot,this.lhs=v,this.rhs=x,this.collator=w,this.hasUntypedArgument=v.type.kind==="value"||x.type.kind==="value"}static parse(v,x){if(v.length!==3&&v.length!==4)return x.error("Expected two or three arguments.");const w=v[0];let E=x.parse(v[1],1,Jt);if(!E)return null;if(!No(w,E.type))return x.concat(1).error(`"${w}" comparisons are not supported for type '${J(E.type)}'.`);let I=x.parse(v[2],2,Jt);if(!I)return null;if(!No(w,I.type))return x.concat(2).error(`"${w}" comparisons are not supported for type '${J(I.type)}'.`);if(E.type.kind!==I.type.kind&&E.type.kind!=="value"&&I.type.kind!=="value")return x.error(`Cannot compare types '${J(E.type)}' and '${J(I.type)}'.`);c&&(E.type.kind==="value"&&I.type.kind!=="value"?E=new xn(I.type,[E]):E.type.kind!=="value"&&I.type.kind==="value"&&(I=new xn(E.type,[I])));let L=null;if(v.length===4){if(E.type.kind!=="string"&&I.type.kind!=="string"&&E.type.kind!=="value"&&I.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(L=x.parse(v[3],3,Ws),!L)return null}return new Kx(E,I,L)}evaluate(v){const x=this.lhs.evaluate(v),w=this.rhs.evaluate(v);if(c&&this.hasUntypedArgument){const E=Dr(x),I=Dr(w);if(E.kind!==I.kind||E.kind!=="string"&&E.kind!=="number")throw new cr(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${E.kind}, ${I.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const E=Dr(x),I=Dr(w);if(E.kind!=="string"||I.kind!=="string")return t(v,x,w)}return this.collator?s(v,x,w,this.collator.evaluate(v)):t(v,x,w)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}}}const mc=bn("==",function(n,t,s){return t===s},Pl),gc=bn("!=",function(n,t,s){return t!==s},function(n,t,s,c){return!Pl(0,t,s,c)}),_u=bn("<",function(n,t,s){return t<s},function(n,t,s,c){return c.compare(t,s)<0}),yc=bn(">",function(n,t,s){return t>s},function(n,t,s,c){return c.compare(t,s)>0}),$o=bn("<=",function(n,t,s){return t<=s},function(n,t,s,c){return c.compare(t,s)<=0}),_c=bn(">=",function(n,t,s){return t>=s},function(n,t,s,c){return c.compare(t,s)>=0});class Uo{constructor(t,s,c,p,v){this.type=ai,this.number=t,this.locale=s,this.currency=c,this.minFractionDigits=p,this.maxFractionDigits=v}static parse(t,s){if(t.length!==3)return s.error("Expected two arguments.");const c=s.parse(t[1],1,nt);if(!c)return null;const p=t[2];if(typeof p!="object"||Array.isArray(p))return s.error("NumberFormat options argument must be an object.");let v=null;if(p.locale&&(v=s.parse(p.locale,1,ai),!v))return null;let x=null;if(p.currency&&(x=s.parse(p.currency,1,ai),!x))return null;let w=null;if(p["min-fraction-digits"]&&(w=s.parse(p["min-fraction-digits"],1,nt),!w))return null;let E=null;return p["max-fraction-digits"]&&(E=s.parse(p["max-fraction-digits"],1,nt),!E)?null:new Uo(c,v,x,w,E)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Vo{constructor(t){this.type=Mr,this.sections=t}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const c=t[1];if(!Array.isArray(c)&&typeof c=="object")return s.error("First argument must be an image or text section.");const p=[];let v=!1;for(let x=1;x<=t.length-1;++x){const w=t[x];if(v&&typeof w=="object"&&!Array.isArray(w)){v=!1;let E=null;if(w["font-scale"]&&(E=s.parse(w["font-scale"],1,nt),!E))return null;let I=null;if(w["text-font"]&&(I=s.parse(w["text-font"],1,H(ai)),!I))return null;let L=null;if(w["text-color"]&&(L=s.parse(w["text-color"],1,$i),!L))return null;const O=p[p.length-1];O.scale=E,O.font=I,O.textColor=L}else{const E=s.parse(t[x],1,Jt);if(!E)return null;const I=E.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,p.push({content:E,scale:null,font:null,textColor:null})}}return new Vo(p)}evaluate(t){return new An(this.sections.map(s=>{const c=s.content.evaluate(t);return Dr(c)===N?new Ar("",c,null,null,null):new Ar(ao(c),null,s.scale?s.scale.evaluate(t):null,s.font?s.font.evaluate(t).join(","):null,s.textColor?s.textColor.evaluate(t):null)}))}eachChild(t){for(const s of this.sections)t(s.content),s.scale&&t(s.scale),s.font&&t(s.font),s.textColor&&t(s.textColor)}outputDefined(){return!1}}class zs{constructor(t){this.type=N,this.input=t}static parse(t,s){if(t.length!==2)return s.error("Expected two arguments.");const c=s.parse(t[1],1,ai);return c?new zs(c):s.error("No image name provided.")}evaluate(t){const s=this.input.evaluate(t),c=vn.fromString(s);return c&&t.availableImages&&(c.available=t.availableImages.indexOf(s)>-1),c}eachChild(t){t(this.input)}outputDefined(){return!1}}class jo{constructor(t){this.type=nt,this.input=t}static parse(t,s){if(t.length!==2)return s.error(`Expected 1 argument, but found ${t.length-1} instead.`);const c=s.parse(t[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${J(c.type)} instead.`):new jo(c):null}evaluate(t){const s=this.input.evaluate(t);if(typeof s=="string"||Array.isArray(s))return s.length;throw new cr(`Expected value to be of type string or array, but found ${J(Dr(s))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Fa={"==":mc,"!=":gc,">":yc,"<":_u,">=":_c,"<=":$o,array:xn,at:Fo,boolean:xn,case:Al,coalesce:zo,collator:Ls,format:Vo,image:zs,in:Bo,"index-of":ho,interpolate:Jr,"interpolate-hcl":Jr,"interpolate-lab":Jr,length:jo,let:Oo,literal:Xs,match:Il,number:xn,"number-format":Uo,object:xn,slice:fa,step:za,string:xn,"to-boolean":is,"to-color":is,"to-number":is,"to-string":is,var:Rt,within:je};function vc(n,[t,s,c,p]){t=t.evaluate(n),s=s.evaluate(n),c=c.evaluate(n);const v=p?p.evaluate(n):1,x=Gn(t,s,c,v);if(x)throw new cr(x);return new Bi(t/255,s/255,c/255,v,!1)}function qo(n,t){return n in t}function pa(n,t){const s=t[n];return s===void 0?null:s}function Os(n){return{type:n}}function Go(n){return{result:"success",value:n}}function Ys(n){return{result:"error",value:n}}function _s(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function xc(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Dl(n){return!!n.expression&&n.expression.interpolated}function Ai(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function Ho(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function vu(n){return n}function kl(n,t){const s=t.type==="color",c=n.stops&&typeof n.stops[0][0]=="object",p=c||!(c||n.property!==void 0),v=n.type||(Dl(t)?"exponential":"interval");if(s||t.type==="padding"){const L=s?Bi.parse:_n.parse;(n=Ri({},n)).stops&&(n.stops=n.stops.map(O=>[O[0],L(O[1])])),n.default=L(n.default?n.default:t.default)}if(n.colorSpace&&(x=n.colorSpace)!=="rgb"&&x!=="hcl"&&x!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var x;let w,E,I;if(v==="exponential")w=hi;else if(v==="interval")w=Fs;else if(v==="categorical"){w=Yi,E=Object.create(null);for(const L of n.stops)E[L[0]]=L[1];I=typeof n.stops[0][0]}else{if(v!=="identity")throw new Error(`Unknown function type "${v}"`);w=Ba}if(c){const L={},O=[];for(let G=0;G<n.stops.length;G++){const X=n.stops[G],ie=X[0].zoom;L[ie]===void 0&&(L[ie]={zoom:ie,type:n.type,property:n.property,default:n.default,stops:[]},O.push(ie)),L[ie].stops.push([X[0].value,X[1]])}const $=[];for(const G of O)$.push([L[G].zoom,kl(L[G],t)]);const j={name:"linear"};return{kind:"composite",interpolationType:j,interpolationFactor:Jr.interpolationFactor.bind(void 0,j),zoomStops:$.map(G=>G[0]),evaluate:({zoom:G},X)=>hi({stops:$,base:n.base},t,G).evaluate(G,X)}}if(p){const L=v==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:L,interpolationFactor:Jr.interpolationFactor.bind(void 0,L),zoomStops:n.stops.map(O=>O[0]),evaluate:({zoom:O})=>w(n,t,O,E,I)}}return{kind:"source",evaluate(L,O){const $=O&&O.properties?O.properties[n.property]:void 0;return $===void 0?ma(n.default,t.default):w(n,t,$,E,I)}}}function ma(n,t,s){return n!==void 0?n:t!==void 0?t:s!==void 0?s:void 0}function Yi(n,t,s,c,p){return ma(typeof s===p?c[s]:void 0,n.default,t.default)}function Fs(n,t,s){if(Ai(s)!=="number")return ma(n.default,t.default);const c=n.stops.length;if(c===1||s<=n.stops[0][0])return n.stops[0][1];if(s>=n.stops[c-1][0])return n.stops[c-1][1];const p=ji(n.stops.map(v=>v[0]),s);return n.stops[p][1]}function hi(n,t,s){const c=n.base!==void 0?n.base:1;if(Ai(s)!=="number")return ma(n.default,t.default);const p=n.stops.length;if(p===1||s<=n.stops[0][0])return n.stops[0][1];if(s>=n.stops[p-1][0])return n.stops[p-1][1];const v=ji(n.stops.map(L=>L[0]),s),x=function(L,O,$,j){const G=j-$,X=L-$;return G===0?0:O===1?X/G:(Math.pow(O,X)-1)/(Math.pow(O,G)-1)}(s,c,n.stops[v][0],n.stops[v+1][0]),w=n.stops[v][1],E=n.stops[v+1][1],I=dn[t.type]||vu;return typeof w.evaluate=="function"?{evaluate(...L){const O=w.evaluate.apply(void 0,L),$=E.evaluate.apply(void 0,L);if(O!==void 0&&$!==void 0)return I(O,$,x,n.colorSpace)}}:I(w,E,x,n.colorSpace)}function Ba(n,t,s){switch(t.type){case"color":s=Bi.parse(s);break;case"formatted":s=An.fromString(s.toString());break;case"resolvedImage":s=vn.fromString(s.toString());break;case"padding":s=_n.parse(s);break;default:Ai(s)===t.type||t.type==="enum"&&t.values[s]||(s=void 0)}return ma(s,n.default,t.default)}gi.register(Fa,{error:[{kind:"error"},[ai],(n,[t])=>{throw new cr(t.evaluate(n))}],typeof:[ai,[Jt],(n,[t])=>J(Dr(t.evaluate(n)))],"to-rgba":[H(nt,4),[$i],(n,[t])=>{const[s,c,p,v]=t.evaluate(n).rgb;return[255*s,255*c,255*p,v]}],rgb:[$i,[nt,nt,nt],vc],rgba:[$i,[nt,nt,nt,nt],vc],has:{type:Ot,overloads:[[[ai],(n,[t])=>qo(t.evaluate(n),n.properties())],[[ai,mn],(n,[t,s])=>qo(t.evaluate(n),s.evaluate(n))]]},get:{type:Jt,overloads:[[[ai],(n,[t])=>pa(t.evaluate(n),n.properties())],[[ai,mn],(n,[t,s])=>pa(t.evaluate(n),s.evaluate(n))]]},"feature-state":[Jt,[ai],(n,[t])=>pa(t.evaluate(n),n.featureState||{})],properties:[mn,[],n=>n.properties()],"geometry-type":[ai,[],n=>n.geometryType()],id:[Jt,[],n=>n.id()],zoom:[nt,[],n=>n.globals.zoom],"heatmap-density":[nt,[],n=>n.globals.heatmapDensity||0],"line-progress":[nt,[],n=>n.globals.lineProgress||0],accumulated:[Jt,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[nt,Os(nt),(n,t)=>{let s=0;for(const c of t)s+=c.evaluate(n);return s}],"*":[nt,Os(nt),(n,t)=>{let s=1;for(const c of t)s*=c.evaluate(n);return s}],"-":{type:nt,overloads:[[[nt,nt],(n,[t,s])=>t.evaluate(n)-s.evaluate(n)],[[nt],(n,[t])=>-t.evaluate(n)]]},"/":[nt,[nt,nt],(n,[t,s])=>t.evaluate(n)/s.evaluate(n)],"%":[nt,[nt,nt],(n,[t,s])=>t.evaluate(n)%s.evaluate(n)],ln2:[nt,[],()=>Math.LN2],pi:[nt,[],()=>Math.PI],e:[nt,[],()=>Math.E],"^":[nt,[nt,nt],(n,[t,s])=>Math.pow(t.evaluate(n),s.evaluate(n))],sqrt:[nt,[nt],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[nt,[nt],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[nt,[nt],(n,[t])=>Math.log(t.evaluate(n))],log2:[nt,[nt],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[nt,[nt],(n,[t])=>Math.sin(t.evaluate(n))],cos:[nt,[nt],(n,[t])=>Math.cos(t.evaluate(n))],tan:[nt,[nt],(n,[t])=>Math.tan(t.evaluate(n))],asin:[nt,[nt],(n,[t])=>Math.asin(t.evaluate(n))],acos:[nt,[nt],(n,[t])=>Math.acos(t.evaluate(n))],atan:[nt,[nt],(n,[t])=>Math.atan(t.evaluate(n))],min:[nt,Os(nt),(n,t)=>Math.min(...t.map(s=>s.evaluate(n)))],max:[nt,Os(nt),(n,t)=>Math.max(...t.map(s=>s.evaluate(n)))],abs:[nt,[nt],(n,[t])=>Math.abs(t.evaluate(n))],round:[nt,[nt],(n,[t])=>{const s=t.evaluate(n);return s<0?-Math.round(-s):Math.round(s)}],floor:[nt,[nt],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[nt,[nt],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[Ot,[ai,Jt],(n,[t,s])=>n.properties()[t.value]===s.value],"filter-id-==":[Ot,[Jt],(n,[t])=>n.id()===t.value],"filter-type-==":[Ot,[ai],(n,[t])=>n.geometryType()===t.value],"filter-<":[Ot,[ai,Jt],(n,[t,s])=>{const c=n.properties()[t.value],p=s.value;return typeof c==typeof p&&c<p}],"filter-id-<":[Ot,[Jt],(n,[t])=>{const s=n.id(),c=t.value;return typeof s==typeof c&&s<c}],"filter->":[Ot,[ai,Jt],(n,[t,s])=>{const c=n.properties()[t.value],p=s.value;return typeof c==typeof p&&c>p}],"filter-id->":[Ot,[Jt],(n,[t])=>{const s=n.id(),c=t.value;return typeof s==typeof c&&s>c}],"filter-<=":[Ot,[ai,Jt],(n,[t,s])=>{const c=n.properties()[t.value],p=s.value;return typeof c==typeof p&&c<=p}],"filter-id-<=":[Ot,[Jt],(n,[t])=>{const s=n.id(),c=t.value;return typeof s==typeof c&&s<=c}],"filter->=":[Ot,[ai,Jt],(n,[t,s])=>{const c=n.properties()[t.value],p=s.value;return typeof c==typeof p&&c>=p}],"filter-id->=":[Ot,[Jt],(n,[t])=>{const s=n.id(),c=t.value;return typeof s==typeof c&&s>=c}],"filter-has":[Ot,[Jt],(n,[t])=>t.value in n.properties()],"filter-has-id":[Ot,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Ot,[H(ai)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[Ot,[H(Jt)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[Ot,[ai,H(Jt)],(n,[t,s])=>s.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[Ot,[ai,H(Jt)],(n,[t,s])=>function(c,p,v,x){for(;v<=x;){const w=v+x>>1;if(p[w]===c)return!0;p[w]>c?x=w-1:v=w+1}return!1}(n.properties()[t.value],s.value,0,s.value.length-1)],all:{type:Ot,overloads:[[[Ot,Ot],(n,[t,s])=>t.evaluate(n)&&s.evaluate(n)],[Os(Ot),(n,t)=>{for(const s of t)if(!s.evaluate(n))return!1;return!0}]]},any:{type:Ot,overloads:[[[Ot,Ot],(n,[t,s])=>t.evaluate(n)||s.evaluate(n)],[Os(Ot),(n,t)=>{for(const s of t)if(s.evaluate(n))return!0;return!1}]]},"!":[Ot,[Ot],(n,[t])=>!t.evaluate(n)],"is-supported-script":[Ot,[ai],(n,[t])=>{const s=n.globals&&n.globals.isSupportedScript;return!s||s(t.evaluate(n))}],upcase:[ai,[ai],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[ai,[ai],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[ai,Os(Jt),(n,t)=>t.map(s=>ao(s.evaluate(n))).join("")],"resolved-locale":[ai,[Ws],(n,[t])=>t.evaluate(n).resolvedLocale()]});class zi{constructor(t,s){var c;this.expression=t,this._warningHistory={},this._evaluator=new Ui,this._defaultValue=s?(c=s).type==="color"&&Ho(c.default)?new Bi(0,0,0,0):c.type==="color"?Bi.parse(c.default)||null:c.type==="padding"?_n.parse(c.default)||null:c.type==="variableAnchorOffsetCollection"?Pr.parse(c.default)||null:c.default===void 0?null:c.default:null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(t,s,c,p,v,x){return this._evaluator.globals=t,this._evaluator.feature=s,this._evaluator.featureState=c,this._evaluator.canonical=p,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(t,s,c,p,v,x){this._evaluator.globals=t,this._evaluator.feature=s||null,this._evaluator.featureState=c||null,this._evaluator.canonical=p,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new cr(`Expected value to be one of ${Object.keys(this._enumValues).map(E=>JSON.stringify(E)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function Wi(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Fa}function vs(n,t){const s=new Ro(Fa,Sr,[],t?function(p){const v={color:$i,string:ai,number:nt,enum:ai,boolean:Ot,formatted:Mr,padding:ee,resolvedImage:N,variableAnchorOffsetCollection:U};return p.type==="array"?H(v[p.value]||Jt,p.length):v[p.type]}(t):void 0),c=s.parse(n,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?Go(new zi(c,t)):Ys(s.errors)}class Js{constructor(t,s){this.kind=t,this._styleExpression=s,this.isStateDependent=t!=="constant"&&!da(s.expression)}evaluateWithoutErrorHandling(t,s,c,p,v,x){return this._styleExpression.evaluateWithoutErrorHandling(t,s,c,p,v,x)}evaluate(t,s,c,p,v,x){return this._styleExpression.evaluate(t,s,c,p,v,x)}}class Zo{constructor(t,s,c,p){this.kind=t,this.zoomStops=c,this._styleExpression=s,this.isStateDependent=t!=="camera"&&!da(s.expression),this.interpolationType=p}evaluateWithoutErrorHandling(t,s,c,p,v,x){return this._styleExpression.evaluateWithoutErrorHandling(t,s,c,p,v,x)}evaluate(t,s,c,p,v,x){return this._styleExpression.evaluate(t,s,c,p,v,x)}interpolationFactor(t,s,c){return this.interpolationType?Jr.interpolationFactor(this.interpolationType,t,s,c):0}}function Ll(n,t){const s=vs(n,t);if(s.result==="error")return s;const c=s.value.expression,p=mr(c);if(!p&&!_s(t))return Ys([new Zi("","data expressions not supported")]);const v=uo(c,["zoom"]);if(!v&&!xc(t))return Ys([new Zi("","zoom expressions not supported")]);const x=Xo(c);return x||v?x instanceof Zi?Ys([x]):x instanceof Jr&&!Dl(t)?Ys([new Zi("",'"interpolate" expressions cannot be used with this property')]):Go(x?new Zo(p?"camera":"composite",s.value,x.labels,x instanceof Jr?x.interpolation:void 0):new Js(p?"constant":"source",s.value)):Ys([new Zi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Wo{constructor(t,s){this._parameters=t,this._specification=s,Ri(this,kl(this._parameters,this._specification))}static deserialize(t){return new Wo(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Xo(n){let t=null;if(n instanceof Oo)t=Xo(n.result);else if(n instanceof zo){for(const s of n.args)if(t=Xo(s),t)break}else(n instanceof za||n instanceof Jr)&&n.input instanceof gi&&n.input.name==="zoom"&&(t=n);return t instanceof Zi||n.eachChild(s=>{const c=Xo(s);c instanceof Zi?t=c:!t&&c?t=new Zi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&c&&t!==c&&(t=new Zi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function fo(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const t of n.slice(1))if(!fo(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Rl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ga(n){if(n==null)return{filter:()=>!0,needGeometry:!1};fo(n)||(n=rs(n));const t=vs(n,Rl);if(t.result==="error")throw new Error(t.value.map(s=>`${s.key}: ${s.message}`).join(", "));return{filter:(s,c,p)=>t.value.evaluate(s,c,{},p),needGeometry:Ko(n)}}function ya(n,t){return n<t?-1:n>t?1:0}function Ko(n){if(!Array.isArray(n))return!1;if(n[0]==="within")return!0;for(let t=1;t<n.length;t++)if(Ko(n[t]))return!0;return!1}function rs(n){if(!n)return!0;const t=n[0];return n.length<=1?t!=="any":t==="=="?zl(n[1],n[2],"=="):t==="!="?Yo(zl(n[1],n[2],"==")):t==="<"||t===">"||t==="<="||t===">="?zl(n[1],n[2],t):t==="any"?(s=n.slice(1),["any"].concat(s.map(rs))):t==="all"?["all"].concat(n.slice(1).map(rs)):t==="none"?["all"].concat(n.slice(1).map(rs).map(Yo)):t==="in"?Qs(n[1],n.slice(2)):t==="!in"?Yo(Qs(n[1],n.slice(2))):t==="has"?Ol(n[1]):t==="!has"?Yo(Ol(n[1])):t!=="within"||n;var s}function zl(n,t,s){switch(n){case"$type":return[`filter-type-${s}`,t];case"$id":return[`filter-id-${s}`,t];default:return[`filter-${s}`,n,t]}}function Qs(n,t){if(t.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(s=>typeof s!=typeof t[0])?["filter-in-large",n,["literal",t.sort(ya)]]:["filter-in-small",n,["literal",t]]}}function Ol(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Yo(n){return["!",n]}function Na(n){const t=typeof n;if(t==="number"||t==="boolean"||t==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let p="[";for(const v of n)p+=`${Na(v)},`;return`${p}]`}const s=Object.keys(n).sort();let c="{";for(let p=0;p<s.length;p++)c+=`${JSON.stringify(s[p])}:${Na(n[s[p]])},`;return`${c}}`}function Fl(n){let t="";for(const s of ut)t+=`/${Na(n[s])}`;return t}function Bl(n){const t=n.value;return t?[new Ue(n.key,t,"constants have been deprecated as of v8")]:[]}function hr(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Bs(n){if(Array.isArray(n))return n.map(Bs);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const t={};for(const s in n)t[s]=Bs(n[s]);return t}return hr(n)}function Vr(n){const t=n.key,s=n.value,c=n.valueSpec||{},p=n.objectElementValidators||{},v=n.style,x=n.styleSpec,w=n.validateSpec;let E=[];const I=Ai(s);if(I!=="object")return[new Ue(t,s,`object expected, ${I} found`)];for(const L in s){const O=L.split(".")[0],$=c[O]||c["*"];let j;if(p[O])j=p[O];else if(c[O])j=w;else if(p["*"])j=p["*"];else{if(!c["*"]){E.push(new Ue(t,s[L],`unknown property "${L}"`));continue}j=w}E=E.concat(j({key:(t&&`${t}.`)+L,value:s[L],valueSpec:$,style:v,styleSpec:x,object:s,objectKey:L,validateSpec:w},s))}for(const L in c)p[L]||c[L].required&&c[L].default===void 0&&s[L]===void 0&&E.push(new Ue(t,s,`missing required property "${L}"`));return E}function Jo(n){const t=n.value,s=n.valueSpec,c=n.style,p=n.styleSpec,v=n.key,x=n.arrayElementValidator||n.validateSpec;if(Ai(t)!=="array")return[new Ue(v,t,`array expected, ${Ai(t)} found`)];if(s.length&&t.length!==s.length)return[new Ue(v,t,`array length ${s.length} expected, length ${t.length} found`)];if(s["min-length"]&&t.length<s["min-length"])return[new Ue(v,t,`array length at least ${s["min-length"]} expected, length ${t.length} found`)];let w={type:s.value,values:s.values};p.$version<7&&(w.function=s.function),Ai(s.value)==="object"&&(w=s.value);let E=[];for(let I=0;I<t.length;I++)E=E.concat(x({array:t,arrayIndex:I,value:t[I],valueSpec:w,validateSpec:n.validateSpec,style:c,styleSpec:p,key:`${v}[${I}]`}));return E}function Qo(n){const t=n.key,s=n.value,c=n.valueSpec;let p=Ai(s);return p==="number"&&s!=s&&(p="NaN"),p!=="number"?[new Ue(t,s,`number expected, ${p} found`)]:"minimum"in c&&s<c.minimum?[new Ue(t,s,`${s} is less than the minimum value ${c.minimum}`)]:"maximum"in c&&s>c.maximum?[new Ue(t,s,`${s} is greater than the maximum value ${c.maximum}`)]:[]}function Se(n){const t=n.valueSpec,s=hr(n.value.type);let c,p,v,x={};const w=s!=="categorical"&&n.value.property===void 0,E=!w,I=Ai(n.value.stops)==="array"&&Ai(n.value.stops[0])==="array"&&Ai(n.value.stops[0][0])==="object",L=Vr({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(j){if(s==="identity")return[new Ue(j.key,j.value,'identity function may not have a "stops" property')];let G=[];const X=j.value;return G=G.concat(Jo({key:j.key,value:X,valueSpec:j.valueSpec,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:O})),Ai(X)==="array"&&X.length===0&&G.push(new Ue(j.key,X,"array must have at least one stop")),G},default:function(j){return j.validateSpec({key:j.key,value:j.value,valueSpec:t,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec})}}});return s==="identity"&&w&&L.push(new Ue(n.key,n.value,'missing required property "property"')),s==="identity"||n.value.stops||L.push(new Ue(n.key,n.value,'missing required property "stops"')),s==="exponential"&&n.valueSpec.expression&&!Dl(n.valueSpec)&&L.push(new Ue(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(E&&!_s(n.valueSpec)?L.push(new Ue(n.key,n.value,"property functions not supported")):w&&!xc(n.valueSpec)&&L.push(new Ue(n.key,n.value,"zoom functions not supported"))),s!=="categorical"&&!I||n.value.property!==void 0||L.push(new Ue(n.key,n.value,'"property" property is required')),L;function O(j){let G=[];const X=j.value,ie=j.key;if(Ai(X)!=="array")return[new Ue(ie,X,`array expected, ${Ai(X)} found`)];if(X.length!==2)return[new Ue(ie,X,`array length 2 expected, length ${X.length} found`)];if(I){if(Ai(X[0])!=="object")return[new Ue(ie,X,`object expected, ${Ai(X[0])} found`)];if(X[0].zoom===void 0)return[new Ue(ie,X,"object stop key must have zoom")];if(X[0].value===void 0)return[new Ue(ie,X,"object stop key must have value")];if(v&&v>hr(X[0].zoom))return[new Ue(ie,X[0].zoom,"stop zoom values must appear in ascending order")];hr(X[0].zoom)!==v&&(v=hr(X[0].zoom),p=void 0,x={}),G=G.concat(Vr({key:`${ie}[0]`,value:X[0],valueSpec:{zoom:{}},validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:Qo,value:$}}))}else G=G.concat($({key:`${ie}[0]`,value:X[0],valueSpec:{},validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec},X));return Wi(Bs(X[1]))?G.concat([new Ue(`${ie}[1]`,X[1],"expressions are not allowed in function stops.")]):G.concat(j.validateSpec({key:`${ie}[1]`,value:X[1],valueSpec:t,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec}))}function $(j,G){const X=Ai(j.value),ie=hr(j.value),he=j.value!==null?j.value:G;if(c){if(X!==c)return[new Ue(j.key,he,`${X} stop domain type must match previous stop domain type ${c}`)]}else c=X;if(X!=="number"&&X!=="string"&&X!=="boolean")return[new Ue(j.key,he,"stop domain value must be a number, string, or boolean")];if(X!=="number"&&s!=="categorical"){let Ee=`number expected, ${X} found`;return _s(t)&&s===void 0&&(Ee+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ue(j.key,he,Ee)]}return s!=="categorical"||X!=="number"||isFinite(ie)&&Math.floor(ie)===ie?s!=="categorical"&&X==="number"&&p!==void 0&&ie<p?[new Ue(j.key,he,"stop domain values must appear in ascending order")]:(p=ie,s==="categorical"&&ie in x?[new Ue(j.key,he,"stop domain values must be unique")]:(x[ie]=!0,[])):[new Ue(j.key,he,`integer expected, found ${ie}`)]}}function Le(n){const t=(n.expressionContext==="property"?Ll:vs)(Bs(n.value),n.valueSpec);if(t.result==="error")return t.value.map(c=>new Ue(`${n.key}${c.key}`,n.value,c.message));const s=t.value.expression||t.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!s.outputDefined())return[new Ue(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!da(s))return[new Ue(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!da(s))return[new Ue(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!uo(s,["zoom","feature-state"]))return[new Ue(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!mr(s))return[new Ue(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ft(n){const t=n.key,s=n.value,c=n.valueSpec,p=[];return Array.isArray(c.values)?c.values.indexOf(hr(s))===-1&&p.push(new Ue(t,s,`expected one of [${c.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(c.values).indexOf(hr(s))===-1&&p.push(new Ue(t,s,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(s)} found`)),p}function qt(n){return fo(Bs(n.value))?Le(Ri({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ji(n)}function Ji(n){const t=n.value,s=n.key;if(Ai(t)!=="array")return[new Ue(s,t,`array expected, ${Ai(t)} found`)];const c=n.styleSpec;let p,v=[];if(t.length<1)return[new Ue(s,t,"filter array must have at least 1 element")];switch(v=v.concat(ft({key:`${s}[0]`,value:t[0],valueSpec:c.filter_operator,style:n.style,styleSpec:n.styleSpec})),hr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&hr(t[1])==="$type"&&v.push(new Ue(s,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&v.push(new Ue(s,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(p=Ai(t[1]),p!=="string"&&v.push(new Ue(`${s}[1]`,t[1],`string expected, ${p} found`)));for(let x=2;x<t.length;x++)p=Ai(t[x]),hr(t[1])==="$type"?v=v.concat(ft({key:`${s}[${x}]`,value:t[x],valueSpec:c.geometry_type,style:n.style,styleSpec:n.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&v.push(new Ue(`${s}[${x}]`,t[x],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let x=1;x<t.length;x++)v=v.concat(Ji({key:`${s}[${x}]`,value:t[x],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":p=Ai(t[1]),t.length!==2?v.push(new Ue(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):p!=="string"&&v.push(new Ue(`${s}[1]`,t[1],`string expected, ${p} found`));break;case"within":p=Ai(t[1]),t.length!==2?v.push(new Ue(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):p!=="object"&&v.push(new Ue(`${s}[1]`,t[1],`object expected, ${p} found`))}return v}function wi(n,t){const s=n.key,c=n.validateSpec,p=n.style,v=n.styleSpec,x=n.value,w=n.objectKey,E=v[`${t}_${n.layerType}`];if(!E)return[];const I=w.match(/^(.*)-transition$/);if(t==="paint"&&I&&E[I[1]]&&E[I[1]].transition)return c({key:s,value:x,valueSpec:v.transition,style:p,styleSpec:v});const L=n.valueSpec||E[w];if(!L)return[new Ue(s,x,`unknown property "${w}"`)];let O;if(Ai(x)==="string"&&_s(L)&&!L.tokens&&(O=/^{([^}]+)}$/.exec(x)))return[new Ue(s,x,`"${w}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(O[1])} }\`.`)];const $=[];return n.layerType==="symbol"&&(w==="text-field"&&p&&!p.glyphs&&$.push(new Ue(s,x,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&Ho(Bs(x))&&hr(x.type)==="identity"&&$.push(new Ue(s,x,'"text-font" does not support identity functions'))),$.concat(c({key:n.key,value:x,valueSpec:L,style:p,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:w}))}function dr(n){return wi(n,"paint")}function Er(n){return wi(n,"layout")}function wn(n){let t=[];const s=n.value,c=n.key,p=n.style,v=n.styleSpec;s.type||s.ref||t.push(new Ue(c,s,'either "type" or "ref" is required'));let x=hr(s.type);const w=hr(s.ref);if(s.id){const E=hr(s.id);for(let I=0;I<n.arrayIndex;I++){const L=p.layers[I];hr(L.id)===E&&t.push(new Ue(c,s.id,`duplicate layer id "${s.id}", previously used at line ${L.id.__line__}`))}}if("ref"in s){let E;["type","source","source-layer","filter","layout"].forEach(I=>{I in s&&t.push(new Ue(c,s[I],`"${I}" is prohibited for ref layers`))}),p.layers.forEach(I=>{hr(I.id)===w&&(E=I)}),E?E.ref?t.push(new Ue(c,s.ref,"ref cannot reference another ref layer")):x=hr(E.type):t.push(new Ue(c,s.ref,`ref layer "${w}" not found`))}else if(x!=="background")if(s.source){const E=p.sources&&p.sources[s.source],I=E&&hr(E.type);E?I==="vector"&&x==="raster"?t.push(new Ue(c,s.source,`layer "${s.id}" requires a raster source`)):I!=="raster-dem"&&x==="hillshade"?t.push(new Ue(c,s.source,`layer "${s.id}" requires a raster-dem source`)):I==="raster"&&x!=="raster"?t.push(new Ue(c,s.source,`layer "${s.id}" requires a vector source`)):I!=="vector"||s["source-layer"]?I==="raster-dem"&&x!=="hillshade"?t.push(new Ue(c,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!s.paint||!s.paint["line-gradient"]||I==="geojson"&&E.lineMetrics||t.push(new Ue(c,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Ue(c,s,`layer "${s.id}" must specify a "source-layer"`)):t.push(new Ue(c,s.source,`source "${s.source}" not found`))}else t.push(new Ue(c,s,'missing required property "source"'));return t=t.concat(Vr({key:c,value:s,valueSpec:v.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${c}.type`,value:s.type,valueSpec:v.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:s,objectKey:"type"}),filter:qt,layout:E=>Vr({layer:s,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,validateSpec:E.validateSpec,objectElementValidators:{"*":I=>Er(Ri({layerType:x},I))}}),paint:E=>Vr({layer:s,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,validateSpec:E.validateSpec,objectElementValidators:{"*":I=>dr(Ri({layerType:x},I))}})}})),t}function rr(n){const t=n.value,s=n.key,c=Ai(t);return c!=="string"?[new Ue(s,t,`string expected, ${c} found`)]:[]}const Fr={promoteId:function({key:n,value:t}){if(Ai(t)==="string")return rr({key:n,value:t});{const s=[];for(const c in t)s.push(...rr({key:`${n}.${c}`,value:t[c]}));return s}}};function ns(n){const t=n.value,s=n.key,c=n.styleSpec,p=n.style,v=n.validateSpec;if(!t.type)return[new Ue(s,t,'"type" is required')];const x=hr(t.type);let w;switch(x){case"vector":case"raster":return w=Vr({key:s,value:t,valueSpec:c[`source_${x.replace("-","_")}`],style:n.style,styleSpec:c,objectElementValidators:Fr,validateSpec:v}),w;case"raster-dem":return w=function(E){var I;const L=(I=E.sourceName)!==null&&I!==void 0?I:"",O=E.value,$=E.styleSpec,j=$.source_raster_dem,G=E.style;let X=[];const ie=Ai(O);if(O===void 0)return X;if(ie!=="object")return X.push(new Ue("source_raster_dem",O,`object expected, ${ie} found`)),X;const he=hr(O.encoding)==="custom",Ee=["redFactor","greenFactor","blueFactor","baseShift"],fe=E.value.encoding?`"${E.value.encoding}"`:"Default";for(const xe in O)!he&&Ee.includes(xe)?X.push(new Ue(xe,O[xe],`In "${L}": "${xe}" is only valid when "encoding" is set to "custom". ${fe} encoding found`)):j[xe]?X=X.concat(E.validateSpec({key:xe,value:O[xe],valueSpec:j[xe],validateSpec:E.validateSpec,style:G,styleSpec:$})):X.push(new Ue(xe,O[xe],`unknown property "${xe}"`));return X}({sourceName:s,value:t,style:n.style,styleSpec:c,validateSpec:v}),w;case"geojson":if(w=Vr({key:s,value:t,valueSpec:c.source_geojson,style:p,styleSpec:c,validateSpec:v,objectElementValidators:Fr}),t.cluster)for(const E in t.clusterProperties){const[I,L]=t.clusterProperties[E],O=typeof I=="string"?[I,["accumulated"],["get",E]]:I;w.push(...Le({key:`${s}.${E}.map`,value:L,validateSpec:v,expressionContext:"cluster-map"})),w.push(...Le({key:`${s}.${E}.reduce`,value:O,validateSpec:v,expressionContext:"cluster-reduce"}))}return w;case"video":return Vr({key:s,value:t,valueSpec:c.source_video,style:p,validateSpec:v,styleSpec:c});case"image":return Vr({key:s,value:t,valueSpec:c.source_image,style:p,validateSpec:v,styleSpec:c});case"canvas":return[new Ue(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ft({key:`${s}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:p,validateSpec:v,styleSpec:c})}}function xs(n){const t=n.value,s=n.styleSpec,c=s.light,p=n.style;let v=[];const x=Ai(t);if(t===void 0)return v;if(x!=="object")return v=v.concat([new Ue("light",t,`object expected, ${x} found`)]),v;for(const w in t){const E=w.match(/^(.*)-transition$/);v=v.concat(E&&c[E[1]]&&c[E[1]].transition?n.validateSpec({key:w,value:t[w],valueSpec:s.transition,validateSpec:n.validateSpec,style:p,styleSpec:s}):c[w]?n.validateSpec({key:w,value:t[w],valueSpec:c[w],validateSpec:n.validateSpec,style:p,styleSpec:s}):[new Ue(w,t[w],`unknown property "${w}"`)])}return v}function fn(n){const t=n.value,s=n.styleSpec,c=s.sky,p=n.style,v=Ai(t);if(t===void 0)return[];if(v!=="object")return[new Ue("sky",t,`object expected, ${v} found`)];let x=[];for(const w in t)x=x.concat(c[w]?Mn({key:w,value:t[w],valueSpec:c[w],style:p,styleSpec:s}):[new Ue(w,t[w],`unknown property "${w}"`)]);return x}function Rn(n){const t=n.value,s=n.styleSpec,c=s.terrain,p=n.style;let v=[];const x=Ai(t);if(t===void 0)return v;if(x!=="object")return v=v.concat([new Ue("terrain",t,`object expected, ${x} found`)]),v;for(const w in t)v=v.concat(c[w]?n.validateSpec({key:w,value:t[w],valueSpec:c[w],validateSpec:n.validateSpec,style:p,styleSpec:s}):[new Ue(w,t[w],`unknown property "${w}"`)]);return v}function bs(n){let t=[];const s=n.value,c=n.key;if(Array.isArray(s)){const p=[],v=[];for(const x in s)s[x].id&&p.includes(s[x].id)&&t.push(new Ue(c,s,`all the sprites' ids must be unique, but ${s[x].id} is duplicated`)),p.push(s[x].id),s[x].url&&v.includes(s[x].url)&&t.push(new Ue(c,s,`all the sprites' URLs must be unique, but ${s[x].url} is duplicated`)),v.push(s[x].url),t=t.concat(Vr({key:`${c}[${x}]`,value:s[x],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return t}return rr({key:c,value:s})}const Qr={"*":()=>[],array:Jo,boolean:function(n){const t=n.value,s=n.key,c=Ai(t);return c!=="boolean"?[new Ue(s,t,`boolean expected, ${c} found`)]:[]},number:Qo,color:function(n){const t=n.key,s=n.value,c=Ai(s);return c!=="string"?[new Ue(t,s,`color expected, ${c} found`)]:Bi.parse(String(s))?[]:[new Ue(t,s,`color expected, "${s}" found`)]},constants:Bl,enum:ft,filter:qt,function:Se,layer:wn,object:Vr,source:ns,light:xs,sky:fn,terrain:Rn,string:rr,formatted:function(n){return rr(n).length===0?[]:Le(n)},resolvedImage:function(n){return rr(n).length===0?[]:Le(n)},padding:function(n){const t=n.key,s=n.value;if(Ai(s)==="array"){if(s.length<1||s.length>4)return[new Ue(t,s,`padding requires 1 to 4 values; ${s.length} values found`)];const c={type:"number"};let p=[];for(let v=0;v<s.length;v++)p=p.concat(n.validateSpec({key:`${t}[${v}]`,value:s[v],validateSpec:n.validateSpec,valueSpec:c}));return p}return Qo({key:t,value:s,valueSpec:{}})},variableAnchorOffsetCollection:function(n){const t=n.key,s=n.value,c=Ai(s),p=n.styleSpec;if(c!=="array"||s.length<1||s.length%2!=0)return[new Ue(t,s,"variableAnchorOffsetCollection requires a non-empty array of even length")];let v=[];for(let x=0;x<s.length;x+=2)v=v.concat(ft({key:`${t}[${x}]`,value:s[x],valueSpec:p.layout_symbol["text-anchor"]})),v=v.concat(Jo({key:`${t}[${x+1}]`,value:s[x+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:p}));return v},sprite:bs};function Mn(n){const t=n.value,s=n.valueSpec,c=n.styleSpec;return n.validateSpec=Mn,s.expression&&Ho(hr(t))?Se(n):s.expression&&Wi(Bs(t))?Le(n):s.type&&Qr[s.type]?Qr[s.type](n):Vr(Ri({},n,{valueSpec:s.type?c[s.type]:s}))}function _a(n){const t=n.value,s=n.key,c=rr(n);return c.length||(t.indexOf("{fontstack}")===-1&&c.push(new Ue(s,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&c.push(new Ue(s,t,'"glyphs" url must include a "{range}" token'))),c}function Hn(n,t=ce){let s=[];return s=s.concat(Mn({key:"",value:n,valueSpec:t.$root,styleSpec:t,style:n,validateSpec:Mn,objectElementValidators:{glyphs:_a,"*":()=>[]}})),n.constants&&(s=s.concat(Bl({key:"constants",value:n.constants,style:n,styleSpec:t,validateSpec:Mn}))),$a(s)}function ws(n){return function(t){return n({...t,validateSpec:Mn})}}function $a(n){return[].concat(n).sort((t,s)=>t.line-s.line)}function Ei(n){return function(...t){return $a(n.apply(this,t))}}Hn.source=Ei(ws(ns)),Hn.sprite=Ei(ws(bs)),Hn.glyphs=Ei(ws(_a)),Hn.light=Ei(ws(xs)),Hn.sky=Ei(ws(fn)),Hn.terrain=Ei(ws(Rn)),Hn.layer=Ei(ws(wn)),Hn.filter=Ei(ws(qt)),Hn.paintProperty=Ei(ws(dr)),Hn.layoutProperty=Ei(ws(Er));const Di=Hn,el=Di.light,Ms=Di.paintProperty,Nl=Di.layoutProperty;function en(n,t){let s=!1;if(t&&t.length)for(const c of t)n.fire(new De(new Error(c.message))),s=!0;return s}class zn{constructor(t,s,c){const p=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const x=new Int32Array(this.arrayBuffer);t=x[0],this.d=(s=x[1])+2*(c=x[2]);for(let E=0;E<this.d*this.d;E++){const I=x[3+E],L=x[3+E+1];p.push(I===L?null:x.subarray(I,L))}const w=x[3+p.length+1];this.keys=x.subarray(x[3+p.length],w),this.bboxes=x.subarray(w),this.insert=this._insertReadonly}else{this.d=s+2*c;for(let x=0;x<this.d*this.d;x++)p.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=t,this.padding=c,this.scale=s/t,this.uid=0;const v=c/s*t;this.min=-v,this.max=t+v}insert(t,s,c,p,v){this._forEachCell(s,c,p,v,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(v)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,s,c,p,v,x){this.cells[v].push(x)}query(t,s,c,p,v){const x=this.min,w=this.max;if(t<=x&&s<=x&&w<=c&&w<=p&&!v)return Array.prototype.slice.call(this.keys);{const E=[];return this._forEachCell(t,s,c,p,this._queryCell,E,{},v),E}}_queryCell(t,s,c,p,v,x,w,E){const I=this.cells[v];if(I!==null){const L=this.keys,O=this.bboxes;for(let $=0;$<I.length;$++){const j=I[$];if(w[j]===void 0){const G=4*j;(E?E(O[G+0],O[G+1],O[G+2],O[G+3]):t<=O[G+2]&&s<=O[G+3]&&c>=O[G+0]&&p>=O[G+1])?(w[j]=!0,x.push(L[j])):w[j]=!1}}}}_forEachCell(t,s,c,p,v,x,w,E){const I=this._convertToCellCoord(t),L=this._convertToCellCoord(s),O=this._convertToCellCoord(c),$=this._convertToCellCoord(p);for(let j=I;j<=O;j++)for(let G=L;G<=$;G++){const X=this.d*G+j;if((!E||E(this._convertFromCellCoord(j),this._convertFromCellCoord(G),this._convertFromCellCoord(j+1),this._convertFromCellCoord(G+1)))&&v.call(this,t,s,c,p,X,x,w,E))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,s=3+this.cells.length+1+1;let c=0;for(let x=0;x<this.cells.length;x++)c+=this.cells[x].length;const p=new Int32Array(s+c+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;let v=s;for(let x=0;x<t.length;x++){const w=t[x];p[3+x]=v,p.set(w,v),v+=w.length}return p[3+t.length]=v,p.set(this.keys,v),v+=this.keys.length,p[3+t.length+1]=v,p.set(this.bboxes,v),v+=this.bboxes.length,p.buffer}static serialize(t,s){const c=t.toArrayBuffer();return s&&s.push(c),{buffer:c}}static deserialize(t){return new zn(t.buffer)}}const tn={};function Et(n,t,s={}){if(tn[n])throw new Error(`${n} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:n,writeable:!1}),tn[n]={klass:t,omit:s.omit||[],shallow:s.shallow||[]}}Et("Object",Object),Et("TransferableGridIndex",zn),Et("Color",Bi),Et("Error",Error),Et("AJAXError",St),Et("ResolvedImage",vn),Et("StylePropertyFunction",Wo),Et("StyleExpression",zi,{omit:["_evaluator"]}),Et("ZoomDependentExpression",Zo),Et("ZoomConstantExpression",Js),Et("CompoundExpression",gi,{omit:["_evaluate"]});for(const n in Fa)Fa[n]._classRegistryKey||Et(`Expression_${n}`,Fa[n]);function va(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function ss(n,t){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error)return n;if(va(n)||rt(n))return t&&t.push(n),n;if(ArrayBuffer.isView(n)){const s=n;return t&&t.push(s.buffer),s}if(n instanceof ImageData)return t&&t.push(n.data.buffer),n;if(Array.isArray(n)){const s=[];for(const c of n)s.push(ss(c,t));return s}if(typeof n=="object"){const s=n.constructor,c=s._classRegistryKey;if(!c)throw new Error(`can't serialize object of unregistered class ${s.name}`);if(!tn[c])throw new Error(`${c} is not registered.`);const p=s.serialize?s.serialize(n,t):{};if(s.serialize){if(t&&p===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const v in n){if(!n.hasOwnProperty(v)||tn[c].omit.indexOf(v)>=0)continue;const x=n[v];p[v]=tn[c].shallow.indexOf(v)>=0?x:ss(x,t)}n instanceof Error&&(p.message=n.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(p.$name=c),p}throw new Error("can't serialize object of type "+typeof n)}function Zn(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||va(n)||rt(n)||ArrayBuffer.isView(n)||n instanceof ImageData)return n;if(Array.isArray(n))return n.map(Zn);if(typeof n=="object"){const t=n.$name||"Object";if(!tn[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:s}=tn[t];if(!s)throw new Error(`can't deserialize unregistered class ${t}`);if(s.deserialize)return s.deserialize(n);const c=Object.create(s.prototype);for(const p of Object.keys(n)){if(p==="$name")continue;const v=n[p];c[p]=tn[t].shallow.indexOf(p)>=0?v:Zn(v)}return c}throw new Error("can't deserialize object of type "+typeof n)}class $l{constructor(){this.first=!0}update(t,s){const c=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=s),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=c,!0))}}const yt={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function ea(n){for(const t of n)if(go(t.charCodeAt(0)))return!0;return!1}function po(n){for(const t of n)if(!mo(t.charCodeAt(0)))return!1;return!0}function mo(n){return!(yt.Arabic(n)||yt["Arabic Supplement"](n)||yt["Arabic Extended-A"](n)||yt["Arabic Presentation Forms-A"](n)||yt["Arabic Presentation Forms-B"](n))}function go(n){return!(n!==746&&n!==747&&(n<4352||!(yt["Bopomofo Extended"](n)||yt.Bopomofo(n)||yt["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||yt["CJK Compatibility Ideographs"](n)||yt["CJK Compatibility"](n)||yt["CJK Radicals Supplement"](n)||yt["CJK Strokes"](n)||!(!yt["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||yt["CJK Unified Ideographs Extension A"](n)||yt["CJK Unified Ideographs"](n)||yt["Enclosed CJK Letters and Months"](n)||yt["Hangul Compatibility Jamo"](n)||yt["Hangul Jamo Extended-A"](n)||yt["Hangul Jamo Extended-B"](n)||yt["Hangul Jamo"](n)||yt["Hangul Syllables"](n)||yt.Hiragana(n)||yt["Ideographic Description Characters"](n)||yt.Kanbun(n)||yt["Kangxi Radicals"](n)||yt["Katakana Phonetic Extensions"](n)||yt.Katakana(n)&&n!==12540||!(!yt["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!yt["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||yt["Unified Canadian Aboriginal Syllabics"](n)||yt["Unified Canadian Aboriginal Syllabics Extended"](n)||yt["Vertical Forms"](n)||yt["Yijing Hexagram Symbols"](n)||yt["Yi Syllables"](n)||yt["Yi Radicals"](n))))}function Ua(n){return!(go(n)||function(t){return!!(yt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||yt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||yt["Letterlike Symbols"](t)||yt["Number Forms"](t)||yt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||yt["Control Pictures"](t)&&t!==9251||yt["Optical Character Recognition"](t)||yt["Enclosed Alphanumerics"](t)||yt["Geometric Shapes"](t)||yt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||yt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||yt["CJK Symbols and Punctuation"](t)||yt.Katakana(t)||yt["Private Use Area"](t)||yt["CJK Compatibility Forms"](t)||yt["Small Form Variants"](t)||yt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(n))}function xa(n){return n>=1424&&n<=2303||yt["Arabic Presentation Forms-A"](n)||yt["Arabic Presentation Forms-B"](n)}function Xh(n,t){return!(!t&&xa(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||yt.Khmer(n))}function Nf(n){for(const t of n)if(xa(t.charCodeAt(0)))return!0;return!1}const Va=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class gr{constructor(t,s){this.zoom=t,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new $l,this.transition={})}isSupportedScript(t){return function(s,c){for(const p of s)if(!Xh(p.charCodeAt(0),c))return!1;return!0}(t,Va.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,s=t-Math.floor(t),c=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*s}}}class Ul{constructor(t,s){this.property=t,this.value=s,this.expression=function(c,p){if(Ho(c))return new Wo(c,p);if(Wi(c)){const v=Ll(c,p);if(v.result==="error")throw new Error(v.value.map(x=>`${x.key}: ${x.message}`).join(", "));return v.value}{let v=c;return p.type==="color"&&typeof c=="string"?v=Bi.parse(c):p.type!=="padding"||typeof c!="number"&&!Array.isArray(c)?p.type==="variableAnchorOffsetCollection"&&Array.isArray(c)&&(v=Pr.parse(c)):v=_n.parse(c),{kind:"constant",evaluate:()=>v}}}(s===void 0?t.specification.default:s,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,s,c){return this.property.possiblyEvaluate(this,t,s,c)}}class bc{constructor(t){this.property=t,this.value=new Ul(t,void 0)}transitioned(t,s){return new Kh(this.property,this.value,s,dt({},t.transition,this.transition),t.now)}untransitioned(){return new Kh(this.property,this.value,null,{},0)}}class xu{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return kt(this._values[t].value.value)}setValue(t,s){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new bc(this._values[t].property)),this._values[t].value=new Ul(this._values[t].property,s===null?void 0:kt(s))}getTransition(t){return kt(this._values[t].transition)}setTransition(t,s){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new bc(this._values[t].property)),this._values[t].transition=kt(s)||void 0}serialize(){const t={};for(const s of Object.keys(this._values)){const c=this.getValue(s);c!==void 0&&(t[s]=c);const p=this.getTransition(s);p!==void 0&&(t[`${s}-transition`]=p)}return t}transitioned(t,s){const c=new Yh(this._properties);for(const p of Object.keys(this._values))c._values[p]=this._values[p].transitioned(t,s._values[p]);return c}untransitioned(){const t=new Yh(this._properties);for(const s of Object.keys(this._values))t._values[s]=this._values[s].untransitioned();return t}}class Kh{constructor(t,s,c,p,v){this.property=t,this.value=s,this.begin=v+p.delay||0,this.end=this.begin+p.duration||0,t.specification.transition&&(p.delay||p.duration)&&(this.prior=c)}possiblyEvaluate(t,s,c){const p=t.now||0,v=this.value.possiblyEvaluate(t,s,c),x=this.prior;if(x){if(p>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(p<this.begin)return x.possiblyEvaluate(t,s,c);{const w=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(t,s,c),v,function(E){if(E<=0)return 0;if(E>=1)return 1;const I=E*E,L=I*E;return 4*(E<.5?L:3*(E-I)+L-.75)}(w))}}return v}}class Yh{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,s,c){const p=new Vl(this._properties);for(const v of Object.keys(this._values))p._values[v]=this._values[v].possiblyEvaluate(t,s,c);return p}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Jh{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return kt(this._values[t].value)}setValue(t,s){this._values[t]=new Ul(this._values[t].property,s===null?void 0:kt(s))}serialize(){const t={};for(const s of Object.keys(this._values)){const c=this.getValue(s);c!==void 0&&(t[s]=c)}return t}possiblyEvaluate(t,s,c){const p=new Vl(this._properties);for(const v of Object.keys(this._values))p._values[v]=this._values[v].possiblyEvaluate(t,s,c);return p}}class Ns{constructor(t,s,c){this.property=t,this.value=s,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,s,c,p){return this.property.evaluate(this.value,this.parameters,t,s,c,p)}}class Vl{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class $t{constructor(t){this.specification=t}possiblyEvaluate(t,s){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(s)}interpolate(t,s,c){const p=dn[this.specification.type];return p?p(t,s,c):t}}class Kt{constructor(t,s){this.specification=t,this.overrides=s}possiblyEvaluate(t,s,c,p){return new Ns(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(s,null,{},c,p)}:t.expression,s)}interpolate(t,s,c){if(t.value.kind!=="constant"||s.value.kind!=="constant")return t;if(t.value.value===void 0||s.value.value===void 0)return new Ns(this,{kind:"constant",value:void 0},t.parameters);const p=dn[this.specification.type];if(p){const v=p(t.value.value,s.value.value,c);return new Ns(this,{kind:"constant",value:v},t.parameters)}return t}evaluate(t,s,c,p,v,x){return t.kind==="constant"?t.value:t.evaluate(s,c,p,v,x)}}class wc extends Kt{possiblyEvaluate(t,s,c,p){if(t.value===void 0)return new Ns(this,{kind:"constant",value:void 0},s);if(t.expression.kind==="constant"){const v=t.expression.evaluate(s,null,{},c,p),x=t.property.specification.type==="resolvedImage"&&typeof v!="string"?v.name:v,w=this._calculate(x,x,x,s);return new Ns(this,{kind:"constant",value:w},s)}if(t.expression.kind==="camera"){const v=this._calculate(t.expression.evaluate({zoom:s.zoom-1}),t.expression.evaluate({zoom:s.zoom}),t.expression.evaluate({zoom:s.zoom+1}),s);return new Ns(this,{kind:"constant",value:v},s)}return new Ns(this,t.expression,s)}evaluate(t,s,c,p,v,x){if(t.kind==="source"){const w=t.evaluate(s,c,p,v,x);return this._calculate(w,w,w,s)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(s.zoom)-1},c,p),t.evaluate({zoom:Math.floor(s.zoom)},c,p),t.evaluate({zoom:Math.floor(s.zoom)+1},c,p),s):t.value}_calculate(t,s,c,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:c,to:s}}interpolate(t){return t}}class jl{constructor(t){this.specification=t}possiblyEvaluate(t,s,c,p){if(t.value!==void 0){if(t.expression.kind==="constant"){const v=t.expression.evaluate(s,null,{},c,p);return this._calculate(v,v,v,s)}return this._calculate(t.expression.evaluate(new gr(Math.floor(s.zoom-1),s)),t.expression.evaluate(new gr(Math.floor(s.zoom),s)),t.expression.evaluate(new gr(Math.floor(s.zoom+1),s)),s)}}_calculate(t,s,c,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:c,to:s}}interpolate(t){return t}}class bu{constructor(t){this.specification=t}possiblyEvaluate(t,s,c,p){return!!t.expression.evaluate(s,null,{},c,p)}interpolate(){return!1}}class Wn{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in t){const c=t[s];c.specification.overridable&&this.overridableProperties.push(s);const p=this.defaultPropertyValues[s]=new Ul(c,void 0),v=this.defaultTransitionablePropertyValues[s]=new bc(c);this.defaultTransitioningPropertyValues[s]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=p.possiblyEvaluate({})}}}Et("DataDrivenProperty",Kt),Et("DataConstantProperty",$t),Et("CrossFadedDataDrivenProperty",wc),Et("CrossFadedProperty",jl),Et("ColorRampProperty",bu);const wu="-transition";class $s extends Oe{constructor(t,s){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),s.layout&&(this._unevaluatedLayout=new Jh(s.layout)),s.paint)){this._transitionablePaint=new xu(s.paint);for(const c in t.paint)this.setPaintProperty(c,t.paint[c],{validate:!1});for(const c in t.layout)this.setLayoutProperty(c,t.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Vl(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,s,c={}){s!=null&&this._validate(Nl,`layers.${this.id}.layout.${t}`,t,s,c)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,s):this.visibility=s)}getPaintProperty(t){return t.endsWith(wu)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,s,c={}){if(s!=null&&this._validate(Ms,`layers.${this.id}.paint.${t}`,t,s,c))return!1;if(t.endsWith(wu))return this._transitionablePaint.setTransition(t.slice(0,-11),s||void 0),!1;{const p=this._transitionablePaint._values[t],v=p.property.specification["property-type"]==="cross-faded-data-driven",x=p.value.isDataDriven(),w=p.value;this._transitionablePaint.setValue(t,s),this._handleSpecialPaintPropertyUpdate(t);const E=this._transitionablePaint._values[t].value;return E.isDataDriven()||x||v||this._handleOverridablePaintPropertyUpdate(t,w,E)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,s,c){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,s){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,s)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Vt(t,(s,c)=>!(s===void 0||c==="layout"&&!Object.keys(s).length||c==="paint"&&!Object.keys(s).length))}_validate(t,s,c,p,v={}){return(!v||v.validate!==!1)&&en(this,t.call(Di,{key:s,layerType:this.type,objectKey:c,value:p,styleSpec:ce,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const s=this.paint.get(t);if(s instanceof Ns&&_s(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}}const Qh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ql{constructor(t,s){this._structArray=t,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Lr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,s){return t._trim(),s&&(t.isTransferred=!0,s.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const s=Object.create(this.prototype);return s.arrayBuffer=t.arrayBuffer,s.length=t.length,s.capacity=t.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function jr(n,t=1){let s=0,c=0;return{members:n.map(p=>{const v=Qh[p.type].BYTES_PER_ELEMENT,x=s=ed(s,Math.max(t,v)),w=p.components||1;return c=Math.max(c,v),s+=v*w,{name:p.name,type:p.type,components:w,offset:x}}),size:ed(s,Math.max(c,t)),alignment:t}}function ed(n,t){return Math.ceil(n/t)*t}class Gl extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,s)}emplace(t,s,c){const p=2*t;return this.int16[p+0]=s,this.int16[p+1]=c,t}}Gl.prototype.bytesPerElement=4,Et("StructArrayLayout2i4",Gl);class ba extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,c)}emplace(t,s,c,p){const v=3*t;return this.int16[v+0]=s,this.int16[v+1]=c,this.int16[v+2]=p,t}}ba.prototype.bytesPerElement=6,Et("StructArrayLayout3i6",ba);class Mu extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,p){const v=this.length;return this.resize(v+1),this.emplace(v,t,s,c,p)}emplace(t,s,c,p,v){const x=4*t;return this.int16[x+0]=s,this.int16[x+1]=c,this.int16[x+2]=p,this.int16[x+3]=v,t}}Mu.prototype.bytesPerElement=8,Et("StructArrayLayout4i8",Mu);class Su extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,p,v,x){const w=this.length;return this.resize(w+1),this.emplace(w,t,s,c,p,v,x)}emplace(t,s,c,p,v,x,w){const E=6*t;return this.int16[E+0]=s,this.int16[E+1]=c,this.int16[E+2]=p,this.int16[E+3]=v,this.int16[E+4]=x,this.int16[E+5]=w,t}}Su.prototype.bytesPerElement=12,Et("StructArrayLayout2i4i12",Su);class Eu extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,p,v,x){const w=this.length;return this.resize(w+1),this.emplace(w,t,s,c,p,v,x)}emplace(t,s,c,p,v,x,w){const E=4*t,I=8*t;return this.int16[E+0]=s,this.int16[E+1]=c,this.uint8[I+4]=p,this.uint8[I+5]=v,this.uint8[I+6]=x,this.uint8[I+7]=w,t}}Eu.prototype.bytesPerElement=8,Et("StructArrayLayout2i4ub8",Eu);class Hl extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,s)}emplace(t,s,c){const p=2*t;return this.float32[p+0]=s,this.float32[p+1]=c,t}}Hl.prototype.bytesPerElement=8,Et("StructArrayLayout2f8",Hl);class Mc extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,p,v,x,w,E,I,L){const O=this.length;return this.resize(O+1),this.emplace(O,t,s,c,p,v,x,w,E,I,L)}emplace(t,s,c,p,v,x,w,E,I,L,O){const $=10*t;return this.uint16[$+0]=s,this.uint16[$+1]=c,this.uint16[$+2]=p,this.uint16[$+3]=v,this.uint16[$+4]=x,this.uint16[$+5]=w,this.uint16[$+6]=E,this.uint16[$+7]=I,this.uint16[$+8]=L,this.uint16[$+9]=O,t}}Mc.prototype.bytesPerElement=20,Et("StructArrayLayout10ui20",Mc);class Tu extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,p,v,x,w,E,I,L,O,$){const j=this.length;return this.resize(j+1),this.emplace(j,t,s,c,p,v,x,w,E,I,L,O,$)}emplace(t,s,c,p,v,x,w,E,I,L,O,$,j){const G=12*t;return this.int16[G+0]=s,this.int16[G+1]=c,this.int16[G+2]=p,this.int16[G+3]=v,this.uint16[G+4]=x,this.uint16[G+5]=w,this.uint16[G+6]=E,this.uint16[G+7]=I,this.int16[G+8]=L,this.int16[G+9]=O,this.int16[G+10]=$,this.int16[G+11]=j,t}}Tu.prototype.bytesPerElement=24,Et("StructArrayLayout4i4ui4i24",Tu);class Cu extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,c)}emplace(t,s,c,p){const v=3*t;return this.float32[v+0]=s,this.float32[v+1]=c,this.float32[v+2]=p,t}}Cu.prototype.bytesPerElement=12,Et("StructArrayLayout3f12",Cu);class wa extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint32[1*t+0]=s,t}}wa.prototype.bytesPerElement=4,Et("StructArrayLayout1ul4",wa);class Sc extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,p,v,x,w,E,I){const L=this.length;return this.resize(L+1),this.emplace(L,t,s,c,p,v,x,w,E,I)}emplace(t,s,c,p,v,x,w,E,I,L){const O=10*t,$=5*t;return this.int16[O+0]=s,this.int16[O+1]=c,this.int16[O+2]=p,this.int16[O+3]=v,this.int16[O+4]=x,this.int16[O+5]=w,this.uint32[$+3]=E,this.uint16[O+8]=I,this.uint16[O+9]=L,t}}Sc.prototype.bytesPerElement=20,Et("StructArrayLayout6i1ul2ui20",Sc);class Zl extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,p,v,x){const w=this.length;return this.resize(w+1),this.emplace(w,t,s,c,p,v,x)}emplace(t,s,c,p,v,x,w){const E=6*t;return this.int16[E+0]=s,this.int16[E+1]=c,this.int16[E+2]=p,this.int16[E+3]=v,this.int16[E+4]=x,this.int16[E+5]=w,t}}Zl.prototype.bytesPerElement=12,Et("StructArrayLayout2i2i2i12",Zl);class Ec extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,p,v){const x=this.length;return this.resize(x+1),this.emplace(x,t,s,c,p,v)}emplace(t,s,c,p,v,x){const w=4*t,E=8*t;return this.float32[w+0]=s,this.float32[w+1]=c,this.float32[w+2]=p,this.int16[E+6]=v,this.int16[E+7]=x,t}}Ec.prototype.bytesPerElement=16,Et("StructArrayLayout2f1f2i16",Ec);class Wl extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,p){const v=this.length;return this.resize(v+1),this.emplace(v,t,s,c,p)}emplace(t,s,c,p,v){const x=12*t,w=3*t;return this.uint8[x+0]=s,this.uint8[x+1]=c,this.float32[w+1]=p,this.float32[w+2]=v,t}}Wl.prototype.bytesPerElement=12,Et("StructArrayLayout2ub2f12",Wl);class Tc extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,c)}emplace(t,s,c,p){const v=3*t;return this.uint16[v+0]=s,this.uint16[v+1]=c,this.uint16[v+2]=p,t}}Tc.prototype.bytesPerElement=6,Et("StructArrayLayout3ui6",Tc);class tl extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,p,v,x,w,E,I,L,O,$,j,G,X,ie,he){const Ee=this.length;return this.resize(Ee+1),this.emplace(Ee,t,s,c,p,v,x,w,E,I,L,O,$,j,G,X,ie,he)}emplace(t,s,c,p,v,x,w,E,I,L,O,$,j,G,X,ie,he,Ee){const fe=24*t,xe=12*t,$e=48*t;return this.int16[fe+0]=s,this.int16[fe+1]=c,this.uint16[fe+2]=p,this.uint16[fe+3]=v,this.uint32[xe+2]=x,this.uint32[xe+3]=w,this.uint32[xe+4]=E,this.uint16[fe+10]=I,this.uint16[fe+11]=L,this.uint16[fe+12]=O,this.float32[xe+7]=$,this.float32[xe+8]=j,this.uint8[$e+36]=G,this.uint8[$e+37]=X,this.uint8[$e+38]=ie,this.uint32[xe+10]=he,this.int16[fe+22]=Ee,t}}tl.prototype.bytesPerElement=48,Et("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",tl);class yo extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,p,v,x,w,E,I,L,O,$,j,G,X,ie,he,Ee,fe,xe,$e,Ge,Tt,zt,Mt,vt,ot,Pt){const gt=this.length;return this.resize(gt+1),this.emplace(gt,t,s,c,p,v,x,w,E,I,L,O,$,j,G,X,ie,he,Ee,fe,xe,$e,Ge,Tt,zt,Mt,vt,ot,Pt)}emplace(t,s,c,p,v,x,w,E,I,L,O,$,j,G,X,ie,he,Ee,fe,xe,$e,Ge,Tt,zt,Mt,vt,ot,Pt,gt){const Qe=32*t,Wt=16*t;return this.int16[Qe+0]=s,this.int16[Qe+1]=c,this.int16[Qe+2]=p,this.int16[Qe+3]=v,this.int16[Qe+4]=x,this.int16[Qe+5]=w,this.int16[Qe+6]=E,this.int16[Qe+7]=I,this.uint16[Qe+8]=L,this.uint16[Qe+9]=O,this.uint16[Qe+10]=$,this.uint16[Qe+11]=j,this.uint16[Qe+12]=G,this.uint16[Qe+13]=X,this.uint16[Qe+14]=ie,this.uint16[Qe+15]=he,this.uint16[Qe+16]=Ee,this.uint16[Qe+17]=fe,this.uint16[Qe+18]=xe,this.uint16[Qe+19]=$e,this.uint16[Qe+20]=Ge,this.uint16[Qe+21]=Tt,this.uint16[Qe+22]=zt,this.uint32[Wt+12]=Mt,this.float32[Wt+13]=vt,this.float32[Wt+14]=ot,this.uint16[Qe+30]=Pt,this.uint16[Qe+31]=gt,t}}yo.prototype.bytesPerElement=64,Et("StructArrayLayout8i15ui1ul2f2ui64",yo);class Cc extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.float32[1*t+0]=s,t}}Cc.prototype.bytesPerElement=4,Et("StructArrayLayout1f4",Cc);class Ic extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,c)}emplace(t,s,c,p){const v=3*t;return this.uint16[6*t+0]=s,this.float32[v+1]=c,this.float32[v+2]=p,t}}Ic.prototype.bytesPerElement=12,Et("StructArrayLayout1ui2f12",Ic);class _o extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,c)}emplace(t,s,c,p){const v=4*t;return this.uint32[2*t+0]=s,this.uint16[v+2]=c,this.uint16[v+3]=p,t}}_o.prototype.bytesPerElement=8,Et("StructArrayLayout1ul2ui8",_o);class Iu extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,s)}emplace(t,s,c){const p=2*t;return this.uint16[p+0]=s,this.uint16[p+1]=c,t}}Iu.prototype.bytesPerElement=4,Et("StructArrayLayout2ui4",Iu);class Au extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint16[1*t+0]=s,t}}Au.prototype.bytesPerElement=2,Et("StructArrayLayout1ui2",Au);class Ac extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,p){const v=this.length;return this.resize(v+1),this.emplace(v,t,s,c,p)}emplace(t,s,c,p,v){const x=4*t;return this.float32[x+0]=s,this.float32[x+1]=c,this.float32[x+2]=p,this.float32[x+3]=v,t}}Ac.prototype.bytesPerElement=16,Et("StructArrayLayout4f16",Ac);class td extends ql{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new D(this.anchorPointX,this.anchorPointY)}}td.prototype.size=20;class g extends Sc{get(t){return new td(this,t)}}Et("CollisionBoxArray",g);class i extends ql{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}i.prototype.size=48;class o extends tl{get(t){return new i(this,t)}}Et("PlacedSymbolArray",o);class h extends ql{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}h.prototype.size=64;class f extends yo{get(t){return new h(this,t)}}Et("SymbolInstanceArray",f);class _ extends Cc{getoffsetX(t){return this.float32[1*t+0]}}Et("GlyphOffsetArray",_);class M extends ba{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Et("SymbolLineVertexArray",M);class S extends ql{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}S.prototype.size=12;class C extends Ic{get(t){return new S(this,t)}}Et("TextAnchorOffsetArray",C);class k extends ql{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}k.prototype.size=8;class F extends _o{get(t){return new k(this,t)}}Et("FeatureIndexArray",F);class B extends Gl{}class q extends Gl{}class te extends Gl{}class Q extends Su{}class re extends Eu{}class W extends Hl{}class pe extends Mc{}class Ie extends Tu{}class le extends Cu{}class be extends wa{}class Ae extends Zl{}class ke extends Wl{}class ze extends Tc{}class We extends Iu{}const He=jr([{name:"a_pos",components:2,type:"Int16"}],4),{members:st}=He;class ct{constructor(t=[]){this.segments=t}prepareSegment(t,s,c,p){let v=this.segments[this.segments.length-1];return t>ct.MAX_VERTEX_ARRAY_LENGTH&&xi(`Max vertices per segment is ${ct.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!v||v.vertexLength+t>ct.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==p)&&(v={vertexOffset:s.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},p!==void 0&&(v.sortKey=p),this.segments.push(v)),v}get(){return this.segments}destroy(){for(const t of this.segments)for(const s in t.vaos)t.vaos[s].destroy()}static simpleSegment(t,s,c,p){return new ct([{vertexOffset:t,primitiveOffset:s,vertexLength:c,primitiveLength:p,vaos:{},sortKey:0}])}}function ci(n,t){return 256*(n=Ze(Math.floor(n),0,255))+Ze(Math.floor(t),0,255)}ct.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Et("SegmentVector",ct);const mt=jr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Yt={exports:{}},ui={exports:{}};ui.exports=function(n,t){var s,c,p,v,x,w,E,I;for(c=n.length-(s=3&n.length),p=t,x=3432918353,w=461845907,I=0;I<c;)E=255&n.charCodeAt(I)|(255&n.charCodeAt(++I))<<8|(255&n.charCodeAt(++I))<<16|(255&n.charCodeAt(++I))<<24,++I,p=27492+(65535&(v=5*(65535&(p=(p^=E=(65535&(E=(E=(65535&E)*x+(((E>>>16)*x&65535)<<16)&4294967295)<<15|E>>>17))*w+(((E>>>16)*w&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(E=0,s){case 3:E^=(255&n.charCodeAt(I+2))<<16;case 2:E^=(255&n.charCodeAt(I+1))<<8;case 1:p^=E=(65535&(E=(E=(65535&(E^=255&n.charCodeAt(I)))*x+(((E>>>16)*x&65535)<<16)&4294967295)<<15|E>>>17))*w+(((E>>>16)*w&65535)<<16)&4294967295}return p^=n.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0};var Pi=ui.exports,ii={exports:{}};ii.exports=function(n,t){for(var s,c=n.length,p=t^c,v=0;c>=4;)s=1540483477*(65535&(s=255&n.charCodeAt(v)|(255&n.charCodeAt(++v))<<8|(255&n.charCodeAt(++v))<<16|(255&n.charCodeAt(++v))<<24))+((1540483477*(s>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),c-=4,++v;switch(c){case 3:p^=(255&n.charCodeAt(v+2))<<16;case 2:p^=(255&n.charCodeAt(v+1))<<8;case 1:p=1540483477*(65535&(p^=255&n.charCodeAt(v)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0};var di=Pi,yi=ii.exports;Yt.exports=di,Yt.exports.murmur3=di,Yt.exports.murmur2=yi;var Rr=T(Yt.exports);class Xi{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,s,c,p){this.ids.push(as(t)),this.positions.push(s,c,p)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const s=as(t);let c=0,p=this.ids.length-1;for(;c<p;){const x=c+p>>1;this.ids[x]>=s?p=x:c=x+1}const v=[];for(;this.ids[c]===s;)v.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return v}static serialize(t,s){const c=new Float64Array(t.ids),p=new Uint32Array(t.positions);return rn(c,p,0,c.length-1),s&&s.push(c.buffer,p.buffer),{ids:c,positions:p}}static deserialize(t){const s=new Xi;return s.ids=t.ids,s.positions=t.positions,s.indexed=!0,s}}function as(n){const t=+n;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Rr(String(n))}function rn(n,t,s,c){for(;s<c;){const p=n[s+c>>1];let v=s-1,x=c+1;for(;;){do v++;while(n[v]<p);do x--;while(n[x]>p);if(v>=x)break;Tr(n,v,x),Tr(t,3*v,3*x),Tr(t,3*v+1,3*x+1),Tr(t,3*v+2,3*x+2)}x-s<c-x?(rn(n,t,s,x),s=x+1):(rn(n,t,x+1,c),c=x)}}function Tr(n,t,s){const c=n[t];n[t]=n[s],n[s]=c}Et("FeaturePositionMap",Xi);class nn{constructor(t,s){this.gl=t.gl,this.location=s}}class os extends nn{constructor(t,s){super(t,s),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class ta extends nn{constructor(t,s){super(t,s),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class ja extends nn{constructor(t,s){super(t,s),this.current=Bi.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Xl=new Float32Array(16);function qa(n){return[ci(255*n.r,255*n.g),ci(255*n.b,255*n.a)]}class ia{constructor(t,s,c){this.value=t,this.uniformNames=s.map(p=>`u_${p}`),this.type=c}setUniform(t,s,c){t.set(c.constantOr(this.value))}getBinding(t,s,c){return this.type==="color"?new ja(t,s):new os(t,s)}}class Wr{constructor(t,s){this.uniformNames=s.map(c=>`u_${c}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=t.tlbr}setUniform(t,s,c,p){const v=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&t.set(v)}getBinding(t,s,c){return c.substr(0,9)==="u_pattern"?new ta(t,s):new os(t,s)}}class Cr{constructor(t,s,c,p){this.expression=t,this.type=c,this.maxValue=0,this.paintVertexAttributes=s.map(v=>({name:`a_${v}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(t,s,c,p,v){const x=this.paintVertexArray.length,w=this.expression.evaluate(new gr(0),s,{},p,[],v);this.paintVertexArray.resize(t),this._setPaintValue(x,t,w)}updatePaintArray(t,s,c,p){const v=this.expression.evaluate({zoom:0},c,p);this._setPaintValue(t,s,v)}_setPaintValue(t,s,c){if(this.type==="color"){const p=qa(c);for(let v=t;v<s;v++)this.paintVertexArray.emplace(v,p[0],p[1])}else{for(let p=t;p<s;p++)this.paintVertexArray.emplace(p,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class yr{constructor(t,s,c,p,v,x){this.expression=t,this.uniformNames=s.map(w=>`u_${w}_t`),this.type=c,this.useIntegerZoom=p,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=s.map(w=>({name:`a_${w}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(t,s,c,p,v){const x=this.expression.evaluate(new gr(this.zoom),s,{},p,[],v),w=this.expression.evaluate(new gr(this.zoom+1),s,{},p,[],v),E=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(E,t,x,w)}updatePaintArray(t,s,c,p){const v=this.expression.evaluate({zoom:this.zoom},c,p),x=this.expression.evaluate({zoom:this.zoom+1},c,p);this._setPaintValue(t,s,v,x)}_setPaintValue(t,s,c,p){if(this.type==="color"){const v=qa(c),x=qa(p);for(let w=t;w<s;w++)this.paintVertexArray.emplace(w,v[0],v[1],x[0],x[1])}else{for(let v=t;v<s;v++)this.paintVertexArray.emplace(v,c,p);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(p))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,s){const c=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,p=Ze(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);t.set(p)}getBinding(t,s,c){return new os(t,s)}}class Ss{constructor(t,s,c,p,v,x){this.expression=t,this.type=s,this.useIntegerZoom=c,this.zoom=p,this.layerId=x,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v}populatePaintArray(t,s,c){const p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(p,t,s.patterns&&s.patterns[this.layerId],c)}updatePaintArray(t,s,c,p,v){this._setPaintValues(t,s,c.patterns&&c.patterns[this.layerId],v)}_setPaintValues(t,s,c,p){if(!p||!c)return;const{min:v,mid:x,max:w}=c,E=p[v],I=p[x],L=p[w];if(E&&I&&L)for(let O=t;O<s;O++)this.zoomInPaintVertexArray.emplace(O,I.tl[0],I.tl[1],I.br[0],I.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],I.pixelRatio,E.pixelRatio),this.zoomOutPaintVertexArray.emplace(O,I.tl[0],I.tl[1],I.br[0],I.br[1],L.tl[0],L.tl[1],L.br[0],L.br[1],I.pixelRatio,L.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,mt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,mt.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Xr{constructor(t,s,c){this.binders={},this._buffers=[];const p=[];for(const v in t.paint._values){if(!c(v))continue;const x=t.paint.get(v);if(!(x instanceof Ns&&_s(x.property.specification)))continue;const w=Es(v,t.type),E=x.value,I=x.property.specification.type,L=x.property.useIntegerZoom,O=x.property.specification["property-type"],$=O==="cross-faded"||O==="cross-faded-data-driven";if(E.kind==="constant")this.binders[v]=$?new Wr(E.value,w):new ia(E.value,w,I),p.push(`/u_${v}`);else if(E.kind==="source"||$){const j=Kr(v,I,"source");this.binders[v]=$?new Ss(E,I,L,s,j,t.id):new Cr(E,w,I,j),p.push(`/a_${v}`)}else{const j=Kr(v,I,"composite");this.binders[v]=new yr(E,w,I,L,s,j),p.push(`/z_${v}`)}}this.cacheKey=p.sort().join("")}getMaxValue(t){const s=this.binders[t];return s instanceof Cr||s instanceof yr?s.maxValue:0}populatePaintArrays(t,s,c,p,v){for(const x in this.binders){const w=this.binders[x];(w instanceof Cr||w instanceof yr||w instanceof Ss)&&w.populatePaintArray(t,s,c,p,v)}}setConstantPatternPositions(t,s){for(const c in this.binders){const p=this.binders[c];p instanceof Wr&&p.setConstantPatternPositions(t,s)}}updatePaintArrays(t,s,c,p,v){let x=!1;for(const w in t){const E=s.getPositions(w);for(const I of E){const L=c.feature(I.index);for(const O in this.binders){const $=this.binders[O];if(($ instanceof Cr||$ instanceof yr||$ instanceof Ss)&&$.expression.isStateDependent===!0){const j=p.paint.get(O);$.expression=j.value,$.updatePaintArray(I.start,I.end,L,t[w],v),x=!0}}}}return x}defines(){const t=[];for(const s in this.binders){const c=this.binders[s];(c instanceof ia||c instanceof Wr)&&t.push(...c.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return t}getBinderAttributes(){const t=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof Cr||c instanceof yr)for(let p=0;p<c.paintVertexAttributes.length;p++)t.push(c.paintVertexAttributes[p].name);else if(c instanceof Ss)for(let p=0;p<mt.members.length;p++)t.push(mt.members[p].name)}return t}getBinderUniforms(){const t=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof ia||c instanceof Wr||c instanceof yr)for(const p of c.uniformNames)t.push(p)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,s){const c=[];for(const p in this.binders){const v=this.binders[p];if(v instanceof ia||v instanceof Wr||v instanceof yr){for(const x of v.uniformNames)if(s[x]){const w=v.getBinding(t,s[x],x);c.push({name:x,property:p,binding:w})}}}return c}setUniforms(t,s,c,p){for(const{name:v,property:x,binding:w}of s)this.binders[x].setUniform(w,p,c.get(x),v)}updatePaintBuffers(t){this._buffers=[];for(const s in this.binders){const c=this.binders[s];if(t&&c instanceof Ss){const p=t.fromScale===2?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(c instanceof Cr||c instanceof yr)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}}upload(t){for(const s in this.binders){const c=this.binders[s];(c instanceof Cr||c instanceof yr||c instanceof Ss)&&c.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const s=this.binders[t];(s instanceof Cr||s instanceof yr||s instanceof Ss)&&s.destroy()}}}class Ir{constructor(t,s,c=()=>!0){this.programConfigurations={};for(const p of t)this.programConfigurations[p.id]=new Xr(p,s,c);this.needsUpload=!1,this._featureMap=new Xi,this._bufferOffset=0}populatePaintArrays(t,s,c,p,v,x){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(t,s,p,v,x);s.id!==void 0&&this._featureMap.add(s.id,c,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,s,c,p){for(const v of c)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(t,this._featureMap,s,v,p)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Es(n,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}function Kr(n,t,s){const c={color:{source:Hl,composite:Ac},number:{source:Cc,composite:Hl}},p=function(v){return{"line-pattern":{source:pe,composite:pe},"fill-pattern":{source:pe,composite:pe},"fill-extrusion-pattern":{source:pe,composite:pe}}[v]}(n);return p&&p[s]||c[t][s]}Et("ConstantBinder",ia),Et("CrossFadedConstantBinder",Wr),Et("SourceExpressionBinder",Cr),Et("CrossFadedCompositeBinder",Ss),Et("CompositeExpressionBinder",yr),Et("ProgramConfiguration",Xr,{omit:["_buffers"]}),Et("ProgramConfigurationSet",Ir);const Br=8192,Pu=Math.pow(2,14)-1,id=-Pu-1;function vo(n){const t=Br/n.extent,s=n.loadGeometry();for(let c=0;c<s.length;c++){const p=s[c];for(let v=0;v<p.length;v++){const x=p[v],w=Math.round(x.x*t),E=Math.round(x.y*t);x.x=Ze(w,id,Pu),x.y=Ze(E,id,Pu),(w<x.x||w>x.x+1||E<x.y||E>x.y+1)&&xi("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return s}function xo(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?vo(n):[]}}function Pc(n,t,s,c,p){n.emplaceBack(2*t+(c+1)/2,2*s+(p+1)/2)}class Ga{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new q,this.indexArray=new ze,this.segments=new ct,this.programConfigurations=new Ir(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,c){const p=this.layers[0],v=[];let x=null,w=!1;p.type==="circle"&&(x=p.layout.get("circle-sort-key"),w=!x.isConstant());for(const{feature:E,id:I,index:L,sourceLayerIndex:O}of t){const $=this.layers[0]._featureFilter.needGeometry,j=xo(E,$);if(!this.layers[0]._featureFilter.filter(new gr(this.zoom),j,c))continue;const G=w?x.evaluate(j,{},c):void 0,X={id:I,properties:E.properties,type:E.type,sourceLayerIndex:O,index:L,geometry:$?j.geometry:vo(E),patterns:{},sortKey:G};v.push(X)}w&&v.sort((E,I)=>E.sortKey-I.sortKey);for(const E of v){const{geometry:I,index:L,sourceLayerIndex:O}=E,$=t[L].feature;this.addFeature(E,I,L,c),s.featureIndex.insert($,I,L,O,this.index)}}update(t,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,st),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,s,c,p){for(const v of s)for(const x of v){const w=x.x,E=x.y;if(w<0||w>=Br||E<0||E>=Br)continue;const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),L=I.vertexLength;Pc(this.layoutVertexArray,w,E,-1,-1),Pc(this.layoutVertexArray,w,E,1,-1),Pc(this.layoutVertexArray,w,E,1,1),Pc(this.layoutVertexArray,w,E,-1,1),this.indexArray.emplaceBack(L,L+1,L+2),this.indexArray.emplaceBack(L,L+3,L+2),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,{},p)}}function Du(n,t){for(let s=0;s<n.length;s++)if(kc(t,n[s]))return!0;for(let s=0;s<t.length;s++)if(kc(n,t[s]))return!0;return!!Dc(n,t)}function rd(n,t,s){return!!kc(n,t)||!!$f(t,n,s)}function ku(n,t){if(n.length===1)return og(t,n[0]);for(let s=0;s<t.length;s++){const c=t[s];for(let p=0;p<c.length;p++)if(kc(n,c[p]))return!0}for(let s=0;s<n.length;s++)if(og(t,n[s]))return!0;for(let s=0;s<t.length;s++)if(Dc(n,t[s]))return!0;return!1}function Lu(n,t,s){if(n.length>1){if(Dc(n,t))return!0;for(let c=0;c<t.length;c++)if($f(t[c],n,s))return!0}for(let c=0;c<n.length;c++)if($f(n[c],t,s))return!0;return!1}function Dc(n,t){if(n.length===0||t.length===0)return!1;for(let s=0;s<n.length-1;s++){const c=n[s],p=n[s+1];for(let v=0;v<t.length-1;v++)if(Ru(c,p,t[v],t[v+1]))return!0}return!1}function Ru(n,t,s,c){return li(n,s,c)!==li(t,s,c)&&li(n,t,s)!==li(n,t,c)}function $f(n,t,s){const c=s*s;if(t.length===1)return n.distSqr(t[0])<c;for(let p=1;p<t.length;p++)if(ag(n,t[p-1],t[p])<c)return!0;return!1}function ag(n,t,s){const c=t.distSqr(s);if(c===0)return n.distSqr(t);const p=((n.x-t.x)*(s.x-t.x)+(n.y-t.y)*(s.y-t.y))/c;return n.distSqr(p<0?t:p>1?s:s.sub(t)._mult(p)._add(t))}function og(n,t){let s,c,p,v=!1;for(let x=0;x<n.length;x++){s=n[x];for(let w=0,E=s.length-1;w<s.length;E=w++)c=s[w],p=s[E],c.y>t.y!=p.y>t.y&&t.x<(p.x-c.x)*(t.y-c.y)/(p.y-c.y)+c.x&&(v=!v)}return v}function kc(n,t){let s=!1;for(let c=0,p=n.length-1;c<n.length;p=c++){const v=n[c],x=n[p];v.y>t.y!=x.y>t.y&&t.x<(x.x-v.x)*(t.y-v.y)/(x.y-v.y)+v.x&&(s=!s)}return s}function e1(n,t,s){const c=s[0],p=s[2];if(n.x<c.x&&t.x<c.x||n.x>p.x&&t.x>p.x||n.y<c.y&&t.y<c.y||n.y>p.y&&t.y>p.y)return!1;const v=li(n,t,s[0]);return v!==li(n,t,s[1])||v!==li(n,t,s[2])||v!==li(n,t,s[3])}function zu(n,t,s){const c=t.paint.get(n).value;return c.kind==="constant"?c.value:s.programConfigurations.get(t.id).getMaxValue(n)}function nd(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function sd(n,t,s,c,p){if(!t[0]&&!t[1])return n;const v=D.convert(t)._mult(p);s==="viewport"&&v._rotate(-c);const x=[];for(let w=0;w<n.length;w++)x.push(n[w].sub(v));return x}let lg,cg;Et("CircleBucket",Ga,{omit:["layers"]});var t1={get paint(){return cg=cg||new Wn({"circle-radius":new Kt(ce.paint_circle["circle-radius"]),"circle-color":new Kt(ce.paint_circle["circle-color"]),"circle-blur":new Kt(ce.paint_circle["circle-blur"]),"circle-opacity":new Kt(ce.paint_circle["circle-opacity"]),"circle-translate":new $t(ce.paint_circle["circle-translate"]),"circle-translate-anchor":new $t(ce.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new $t(ce.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new $t(ce.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Kt(ce.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Kt(ce.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Kt(ce.paint_circle["circle-stroke-opacity"])})},get layout(){return lg=lg||new Wn({"circle-sort-key":new Kt(ce.layout_circle["circle-sort-key"])})}},Xn=1e-6,Lc=typeof Float32Array<"u"?Float32Array:Array;function Uf(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function ug(n,t,s){var c=t[0],p=t[1],v=t[2],x=t[3],w=t[4],E=t[5],I=t[6],L=t[7],O=t[8],$=t[9],j=t[10],G=t[11],X=t[12],ie=t[13],he=t[14],Ee=t[15],fe=s[0],xe=s[1],$e=s[2],Ge=s[3];return n[0]=fe*c+xe*w+$e*O+Ge*X,n[1]=fe*p+xe*E+$e*$+Ge*ie,n[2]=fe*v+xe*I+$e*j+Ge*he,n[3]=fe*x+xe*L+$e*G+Ge*Ee,n[4]=(fe=s[4])*c+(xe=s[5])*w+($e=s[6])*O+(Ge=s[7])*X,n[5]=fe*p+xe*E+$e*$+Ge*ie,n[6]=fe*v+xe*I+$e*j+Ge*he,n[7]=fe*x+xe*L+$e*G+Ge*Ee,n[8]=(fe=s[8])*c+(xe=s[9])*w+($e=s[10])*O+(Ge=s[11])*X,n[9]=fe*p+xe*E+$e*$+Ge*ie,n[10]=fe*v+xe*I+$e*j+Ge*he,n[11]=fe*x+xe*L+$e*G+Ge*Ee,n[12]=(fe=s[12])*c+(xe=s[13])*w+($e=s[14])*O+(Ge=s[15])*X,n[13]=fe*p+xe*E+$e*$+Ge*ie,n[14]=fe*v+xe*I+$e*j+Ge*he,n[15]=fe*x+xe*L+$e*G+Ge*Ee,n}Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var Ou,i1=ug;function ad(n,t,s){var c=t[0],p=t[1],v=t[2],x=t[3];return n[0]=s[0]*c+s[4]*p+s[8]*v+s[12]*x,n[1]=s[1]*c+s[5]*p+s[9]*v+s[13]*x,n[2]=s[2]*c+s[6]*p+s[10]*v+s[14]*x,n[3]=s[3]*c+s[7]*p+s[11]*v+s[15]*x,n}Ou=new Lc(4),Lc!=Float32Array&&(Ou[0]=0,Ou[1]=0,Ou[2]=0,Ou[3]=0);class r1 extends $s{constructor(t){super(t,t1)}createBucket(t){return new Ga(t)}queryRadius(t){const s=t;return zu("circle-radius",this,s)+zu("circle-stroke-width",this,s)+nd(this.paint.get("circle-translate"))}queryIntersectsFeature(t,s,c,p,v,x,w,E){const I=sd(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,w),L=this.paint.get("circle-radius").evaluate(s,c)+this.paint.get("circle-stroke-width").evaluate(s,c),O=this.paint.get("circle-pitch-alignment")==="map",$=O?I:function(G,X){return G.map(ie=>hg(ie,X))}(I,E),j=O?L*w:L;for(const G of p)for(const X of G){const ie=O?X:hg(X,E);let he=j;const Ee=ad([],[X.x,X.y,0,1],E);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?he*=Ee[3]/x.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(he*=x.cameraToCenterDistance/Ee[3]),rd($,ie,he))return!0}return!1}}function hg(n,t){const s=ad([],[n.x,n.y,0,1],t);return new D(s[0]/s[3],s[1]/s[3])}class dg extends Ga{}let fg;Et("HeatmapBucket",dg,{omit:["layers"]});var n1={get paint(){return fg=fg||new Wn({"heatmap-radius":new Kt(ce.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Kt(ce.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new $t(ce.paint_heatmap["heatmap-intensity"]),"heatmap-color":new bu(ce.paint_heatmap["heatmap-color"]),"heatmap-opacity":new $t(ce.paint_heatmap["heatmap-opacity"])})}};function Vf(n,{width:t,height:s},c,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==t*s*c)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${t*s*c}`)}else p=new Uint8Array(t*s*c);return n.width=t,n.height=s,n.data=p,n}function pg(n,{width:t,height:s},c){if(t===n.width&&s===n.height)return;const p=Vf({},{width:t,height:s},c);jf(n,p,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,t),height:Math.min(n.height,s)},c),n.width=t,n.height=s,n.data=p.data}function jf(n,t,s,c,p,v){if(p.width===0||p.height===0)return t;if(p.width>n.width||p.height>n.height||s.x>n.width-p.width||s.y>n.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>t.width||p.height>t.height||c.x>t.width-p.width||c.y>t.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const x=n.data,w=t.data;if(x===w)throw new Error("srcData equals dstData, so image is already copied");for(let E=0;E<p.height;E++){const I=((s.y+E)*n.width+s.x)*v,L=((c.y+E)*t.width+c.x)*v;for(let O=0;O<p.width*v;O++)w[L+O]=x[I+O]}return t}class Fu{constructor(t,s){Vf(this,t,1,s)}resize(t){pg(this,t,1)}clone(){return new Fu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,c,p,v){jf(t,s,c,p,v,1)}}class Us{constructor(t,s){Vf(this,t,4,s)}resize(t){pg(this,t,4)}replace(t,s){s?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Us({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,c,p,v){jf(t,s,c,p,v,4)}}function mg(n){const t={},s=n.resolution||256,c=n.clips?n.clips.length:1,p=n.image||new Us({width:s,height:c});if(Math.log(s)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${s}`);const v=(x,w,E)=>{t[n.evaluationKey]=E;const I=n.expression.evaluate(t);p.data[x+w+0]=Math.floor(255*I.r/I.a),p.data[x+w+1]=Math.floor(255*I.g/I.a),p.data[x+w+2]=Math.floor(255*I.b/I.a),p.data[x+w+3]=Math.floor(255*I.a)};if(n.clips)for(let x=0,w=0;x<c;++x,w+=4*s)for(let E=0,I=0;E<s;E++,I+=4){const L=E/(s-1),{start:O,end:$}=n.clips[x];v(w,I,O*(1-L)+$*L)}else for(let x=0,w=0;x<s;x++,w+=4)v(0,w,x/(s-1));return p}Et("AlphaImage",Fu),Et("RGBAImage",Us);class s1 extends $s{createBucket(t){return new dg(t)}constructor(t){super(t,n1),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=mg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let gg;var a1={get paint(){return gg=gg||new Wn({"hillshade-illumination-direction":new $t(ce.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new $t(ce.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new $t(ce.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new $t(ce.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new $t(ce.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new $t(ce.paint_hillshade["hillshade-accent-color"])})}};class o1 extends $s{constructor(t){super(t,a1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const l1=jr([{name:"a_pos",components:2,type:"Int16"}],4),{members:c1}=l1;var qf={exports:{}};function od(n,t,s){s=s||2;var c,p,v,x,w,E,I,L=t&&t.length,O=L?t[0]*s:n.length,$=yg(n,0,O,s,!0),j=[];if(!$||$.next===$.prev)return j;if(L&&($=function(X,ie,he,Ee){var fe,xe,$e,Ge=[];for(fe=0,xe=ie.length;fe<xe;fe++)($e=yg(X,ie[fe]*Ee,fe<xe-1?ie[fe+1]*Ee:X.length,Ee,!1))===$e.next&&($e.steiner=!0),Ge.push(y1($e));for(Ge.sort(p1),fe=0;fe<Ge.length;fe++)he=m1(Ge[fe],he);return he}(n,t,$,s)),n.length>80*s){c=v=n[0],p=x=n[1];for(var G=s;G<O;G+=s)(w=n[G])<c&&(c=w),(E=n[G+1])<p&&(p=E),w>v&&(v=w),E>x&&(x=E);I=(I=Math.max(v-c,x-p))!==0?32767/I:0}return Bu($,j,s,c,p,I,0),j}function yg(n,t,s,c,p){var v,x;if(p===Zf(n,t,s,c)>0)for(v=t;v<s;v+=c)x=xg(v,n[v],n[v+1],x);else for(v=s-c;v>=t;v-=c)x=xg(v,n[v],n[v+1],x);return x&&ld(x,x.next)&&($u(x),x=x.next),x}function Kl(n,t){if(!n)return n;t||(t=n);var s,c=n;do if(s=!1,c.steiner||!ld(c,c.next)&&qr(c.prev,c,c.next)!==0)c=c.next;else{if($u(c),(c=t=c.prev)===c.next)break;s=!0}while(s||c!==t);return t}function Bu(n,t,s,c,p,v,x){if(n){!x&&v&&function(L,O,$,j){var G=L;do G.z===0&&(G.z=Gf(G.x,G.y,O,$,j)),G.prevZ=G.prev,G.nextZ=G.next,G=G.next;while(G!==L);G.prevZ.nextZ=null,G.prevZ=null,function(X){var ie,he,Ee,fe,xe,$e,Ge,Tt,zt=1;do{for(he=X,X=null,xe=null,$e=0;he;){for($e++,Ee=he,Ge=0,ie=0;ie<zt&&(Ge++,Ee=Ee.nextZ);ie++);for(Tt=zt;Ge>0||Tt>0&&Ee;)Ge!==0&&(Tt===0||!Ee||he.z<=Ee.z)?(fe=he,he=he.nextZ,Ge--):(fe=Ee,Ee=Ee.nextZ,Tt--),xe?xe.nextZ=fe:X=fe,fe.prevZ=xe,xe=fe;he=Ee}xe.nextZ=null,zt*=2}while($e>1)}(G)}(n,c,p,v);for(var w,E,I=n;n.prev!==n.next;)if(w=n.prev,E=n.next,v?h1(n,c,p,v):u1(n))t.push(w.i/s|0),t.push(n.i/s|0),t.push(E.i/s|0),$u(n),n=E.next,I=E.next;else if((n=E)===I){x?x===1?Bu(n=d1(Kl(n),t,s),t,s,c,p,v,2):x===2&&f1(n,t,s,c,p,v):Bu(Kl(n),t,s,c,p,v,1);break}}}function u1(n){var t=n.prev,s=n,c=n.next;if(qr(t,s,c)>=0)return!1;for(var p=t.x,v=s.x,x=c.x,w=t.y,E=s.y,I=c.y,L=p<v?p<x?p:x:v<x?v:x,O=w<E?w<I?w:I:E<I?E:I,$=p>v?p>x?p:x:v>x?v:x,j=w>E?w>I?w:I:E>I?E:I,G=c.next;G!==t;){if(G.x>=L&&G.x<=$&&G.y>=O&&G.y<=j&&Rc(p,w,v,E,x,I,G.x,G.y)&&qr(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function h1(n,t,s,c){var p=n.prev,v=n,x=n.next;if(qr(p,v,x)>=0)return!1;for(var w=p.x,E=v.x,I=x.x,L=p.y,O=v.y,$=x.y,j=w<E?w<I?w:I:E<I?E:I,G=L<O?L<$?L:$:O<$?O:$,X=w>E?w>I?w:I:E>I?E:I,ie=L>O?L>$?L:$:O>$?O:$,he=Gf(j,G,t,s,c),Ee=Gf(X,ie,t,s,c),fe=n.prevZ,xe=n.nextZ;fe&&fe.z>=he&&xe&&xe.z<=Ee;){if(fe.x>=j&&fe.x<=X&&fe.y>=G&&fe.y<=ie&&fe!==p&&fe!==x&&Rc(w,L,E,O,I,$,fe.x,fe.y)&&qr(fe.prev,fe,fe.next)>=0||(fe=fe.prevZ,xe.x>=j&&xe.x<=X&&xe.y>=G&&xe.y<=ie&&xe!==p&&xe!==x&&Rc(w,L,E,O,I,$,xe.x,xe.y)&&qr(xe.prev,xe,xe.next)>=0))return!1;xe=xe.nextZ}for(;fe&&fe.z>=he;){if(fe.x>=j&&fe.x<=X&&fe.y>=G&&fe.y<=ie&&fe!==p&&fe!==x&&Rc(w,L,E,O,I,$,fe.x,fe.y)&&qr(fe.prev,fe,fe.next)>=0)return!1;fe=fe.prevZ}for(;xe&&xe.z<=Ee;){if(xe.x>=j&&xe.x<=X&&xe.y>=G&&xe.y<=ie&&xe!==p&&xe!==x&&Rc(w,L,E,O,I,$,xe.x,xe.y)&&qr(xe.prev,xe,xe.next)>=0)return!1;xe=xe.nextZ}return!0}function d1(n,t,s){var c=n;do{var p=c.prev,v=c.next.next;!ld(p,v)&&_g(p,c,c.next,v)&&Nu(p,v)&&Nu(v,p)&&(t.push(p.i/s|0),t.push(c.i/s|0),t.push(v.i/s|0),$u(c),$u(c.next),c=n=v),c=c.next}while(c!==n);return Kl(c)}function f1(n,t,s,c,p,v){var x=n;do{for(var w=x.next.next;w!==x.prev;){if(x.i!==w.i&&_1(x,w)){var E=vg(x,w);return x=Kl(x,x.next),E=Kl(E,E.next),Bu(x,t,s,c,p,v,0),void Bu(E,t,s,c,p,v,0)}w=w.next}x=x.next}while(x!==n)}function p1(n,t){return n.x-t.x}function m1(n,t){var s=function(p,v){var x,w=v,E=p.x,I=p.y,L=-1/0;do{if(I<=w.y&&I>=w.next.y&&w.next.y!==w.y){var O=w.x+(I-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(O<=E&&O>L&&(L=O,x=w.x<w.next.x?w:w.next,O===E))return x}w=w.next}while(w!==v);if(!x)return null;var $,j=x,G=x.x,X=x.y,ie=1/0;w=x;do E>=w.x&&w.x>=G&&E!==w.x&&Rc(I<X?E:L,I,G,X,I<X?L:E,I,w.x,w.y)&&($=Math.abs(I-w.y)/(E-w.x),Nu(w,p)&&($<ie||$===ie&&(w.x>x.x||w.x===x.x&&g1(x,w)))&&(x=w,ie=$)),w=w.next;while(w!==j);return x}(n,t);if(!s)return t;var c=vg(s,n);return Kl(c,c.next),Kl(s,s.next)}function g1(n,t){return qr(n.prev,n,t.prev)<0&&qr(t.next,n,n.next)<0}function Gf(n,t,s,c,p){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-s)*p|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-c)*p|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function y1(n){var t=n,s=n;do(t.x<s.x||t.x===s.x&&t.y<s.y)&&(s=t),t=t.next;while(t!==n);return s}function Rc(n,t,s,c,p,v,x,w){return(p-x)*(t-w)>=(n-x)*(v-w)&&(n-x)*(c-w)>=(s-x)*(t-w)&&(s-x)*(v-w)>=(p-x)*(c-w)}function _1(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!function(s,c){var p=s;do{if(p.i!==s.i&&p.next.i!==s.i&&p.i!==c.i&&p.next.i!==c.i&&_g(p,p.next,s,c))return!0;p=p.next}while(p!==s);return!1}(n,t)&&(Nu(n,t)&&Nu(t,n)&&function(s,c){var p=s,v=!1,x=(s.x+c.x)/2,w=(s.y+c.y)/2;do p.y>w!=p.next.y>w&&p.next.y!==p.y&&x<(p.next.x-p.x)*(w-p.y)/(p.next.y-p.y)+p.x&&(v=!v),p=p.next;while(p!==s);return v}(n,t)&&(qr(n.prev,n,t.prev)||qr(n,t.prev,t))||ld(n,t)&&qr(n.prev,n,n.next)>0&&qr(t.prev,t,t.next)>0)}function qr(n,t,s){return(t.y-n.y)*(s.x-t.x)-(t.x-n.x)*(s.y-t.y)}function ld(n,t){return n.x===t.x&&n.y===t.y}function _g(n,t,s,c){var p=ud(qr(n,t,s)),v=ud(qr(n,t,c)),x=ud(qr(s,c,n)),w=ud(qr(s,c,t));return p!==v&&x!==w||!(p!==0||!cd(n,s,t))||!(v!==0||!cd(n,c,t))||!(x!==0||!cd(s,n,c))||!(w!==0||!cd(s,t,c))}function cd(n,t,s){return t.x<=Math.max(n.x,s.x)&&t.x>=Math.min(n.x,s.x)&&t.y<=Math.max(n.y,s.y)&&t.y>=Math.min(n.y,s.y)}function ud(n){return n>0?1:n<0?-1:0}function Nu(n,t){return qr(n.prev,n,n.next)<0?qr(n,t,n.next)>=0&&qr(n,n.prev,t)>=0:qr(n,t,n.prev)<0||qr(n,n.next,t)<0}function vg(n,t){var s=new Hf(n.i,n.x,n.y),c=new Hf(t.i,t.x,t.y),p=n.next,v=t.prev;return n.next=t,t.prev=n,s.next=p,p.prev=s,c.next=s,s.prev=c,v.next=c,c.prev=v,c}function xg(n,t,s,c){var p=new Hf(n,t,s);return c?(p.next=c.next,p.prev=c,c.next.prev=p,c.next=p):(p.prev=p,p.next=p),p}function $u(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Hf(n,t,s){this.i=n,this.x=t,this.y=s,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Zf(n,t,s,c){for(var p=0,v=t,x=s-c;v<s;v+=c)p+=(n[x]-n[v])*(n[v+1]+n[x+1]),x=v;return p}qf.exports=od,qf.exports.default=od,od.deviation=function(n,t,s,c){var p=t&&t.length,v=Math.abs(Zf(n,0,p?t[0]*s:n.length,s));if(p)for(var x=0,w=t.length;x<w;x++)v-=Math.abs(Zf(n,t[x]*s,x<w-1?t[x+1]*s:n.length,s));var E=0;for(x=0;x<c.length;x+=3){var I=c[x]*s,L=c[x+1]*s,O=c[x+2]*s;E+=Math.abs((n[I]-n[O])*(n[L+1]-n[I+1])-(n[I]-n[L])*(n[O+1]-n[I+1]))}return v===0&&E===0?0:Math.abs((E-v)/v)},od.flatten=function(n){for(var t=n[0][0].length,s={vertices:[],holes:[],dimensions:t},c=0,p=0;p<n.length;p++){for(var v=0;v<n[p].length;v++)for(var x=0;x<t;x++)s.vertices.push(n[p][v][x]);p>0&&s.holes.push(c+=n[p-1].length)}return s};var bg=T(qf.exports);function v1(n,t,s,c,p){wg(n,t,s||0,c||n.length-1,p||x1)}function wg(n,t,s,c,p){for(;c>s;){if(c-s>600){var v=c-s+1,x=t-s+1,w=Math.log(v),E=.5*Math.exp(2*w/3),I=.5*Math.sqrt(w*E*(v-E)/v)*(x-v/2<0?-1:1);wg(n,t,Math.max(s,Math.floor(t-x*E/v+I)),Math.min(c,Math.floor(t+(v-x)*E/v+I)),p)}var L=n[t],O=s,$=c;for(Uu(n,s,t),p(n[c],L)>0&&Uu(n,s,c);O<$;){for(Uu(n,O,$),O++,$--;p(n[O],L)<0;)O++;for(;p(n[$],L)>0;)$--}p(n[s],L)===0?Uu(n,s,$):Uu(n,++$,c),$<=t&&(s=$+1),t<=$&&(c=$-1)}}function Uu(n,t,s){var c=n[t];n[t]=n[s],n[s]=c}function x1(n,t){return n<t?-1:n>t?1:0}function Wf(n,t){const s=n.length;if(s<=1)return[n];const c=[];let p,v;for(let x=0;x<s;x++){const w=xr(n[x]);w!==0&&(n[x].area=Math.abs(w),v===void 0&&(v=w<0),v===w<0?(p&&c.push(p),p=[n[x]]):p.push(n[x]))}if(p&&c.push(p),t>1)for(let x=0;x<c.length;x++)c[x].length<=t||(v1(c[x],t,1,c[x].length-1,b1),c[x]=c[x].slice(0,t));return c}function b1(n,t){return t.area-n.area}function Xf(n,t,s){const c=s.patternDependencies;let p=!1;for(const v of t){const x=v.paint.get(`${n}-pattern`);x.isConstant()||(p=!0);const w=x.constantOr(null);w&&(p=!0,c[w.to]=!0,c[w.from]=!0)}return p}function Kf(n,t,s,c,p){const v=p.patternDependencies;for(const x of t){const w=x.paint.get(`${n}-pattern`).value;if(w.kind!=="constant"){let E=w.evaluate({zoom:c-1},s,{},p.availableImages),I=w.evaluate({zoom:c},s,{},p.availableImages),L=w.evaluate({zoom:c+1},s,{},p.availableImages);E=E&&E.name?E.name:E,I=I&&I.name?I.name:I,L=L&&L.name?L.name:L,v[E]=!0,v[I]=!0,v[L]=!0,s.patterns[x.id]={min:E,mid:I,max:L}}}return s}class Yf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new te,this.indexArray=new ze,this.indexArray2=new We,this.programConfigurations=new Ir(t.layers,t.zoom),this.segments=new ct,this.segments2=new ct,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,c){this.hasPattern=Xf("fill",this.layers,s);const p=this.layers[0].layout.get("fill-sort-key"),v=!p.isConstant(),x=[];for(const{feature:w,id:E,index:I,sourceLayerIndex:L}of t){const O=this.layers[0]._featureFilter.needGeometry,$=xo(w,O);if(!this.layers[0]._featureFilter.filter(new gr(this.zoom),$,c))continue;const j=v?p.evaluate($,{},c,s.availableImages):void 0,G={id:E,properties:w.properties,type:w.type,sourceLayerIndex:L,index:I,geometry:O?$.geometry:vo(w),patterns:{},sortKey:j};x.push(G)}v&&x.sort((w,E)=>w.sortKey-E.sortKey);for(const w of x){const{geometry:E,index:I,sourceLayerIndex:L}=w;if(this.hasPattern){const O=Kf("fill",this.layers,w,this.zoom,s);this.patternFeatures.push(O)}else this.addFeature(w,E,I,c,{});s.featureIndex.insert(t[I].feature,E,I,L,this.index)}}update(t,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,c)}addFeatures(t,s,c){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,s,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,c1),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,s,c,p,v){for(const x of Wf(s,500)){let w=0;for(const j of x)w+=j.length;const E=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),I=E.vertexLength,L=[],O=[];for(const j of x){if(j.length===0)continue;j!==x[0]&&O.push(L.length/2);const G=this.segments2.prepareSegment(j.length,this.layoutVertexArray,this.indexArray2),X=G.vertexLength;this.layoutVertexArray.emplaceBack(j[0].x,j[0].y),this.indexArray2.emplaceBack(X+j.length-1,X),L.push(j[0].x),L.push(j[0].y);for(let ie=1;ie<j.length;ie++)this.layoutVertexArray.emplaceBack(j[ie].x,j[ie].y),this.indexArray2.emplaceBack(X+ie-1,X+ie),L.push(j[ie].x),L.push(j[ie].y);G.vertexLength+=j.length,G.primitiveLength+=j.length}const $=bg(L,O);for(let j=0;j<$.length;j+=3)this.indexArray.emplaceBack(I+$[j],I+$[j+1],I+$[j+2]);E.vertexLength+=w,E.primitiveLength+=$.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,v,p)}}let Mg,Sg;Et("FillBucket",Yf,{omit:["layers","patternFeatures"]});var w1={get paint(){return Sg=Sg||new Wn({"fill-antialias":new $t(ce.paint_fill["fill-antialias"]),"fill-opacity":new Kt(ce.paint_fill["fill-opacity"]),"fill-color":new Kt(ce.paint_fill["fill-color"]),"fill-outline-color":new Kt(ce.paint_fill["fill-outline-color"]),"fill-translate":new $t(ce.paint_fill["fill-translate"]),"fill-translate-anchor":new $t(ce.paint_fill["fill-translate-anchor"]),"fill-pattern":new wc(ce.paint_fill["fill-pattern"])})},get layout(){return Mg=Mg||new Wn({"fill-sort-key":new Kt(ce.layout_fill["fill-sort-key"])})}};class M1 extends $s{constructor(t){super(t,w1)}recalculate(t,s){super.recalculate(t,s);const c=this.paint._values["fill-outline-color"];c.value.kind==="constant"&&c.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Yf(t)}queryRadius(){return nd(this.paint.get("fill-translate"))}queryIntersectsFeature(t,s,c,p,v,x,w){return ku(sd(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,w),p)}isTileClipped(){return!0}}const S1=jr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),E1=jr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:T1}=S1;var il={},C1=P,Eg=zc;function zc(n,t,s,c,p){this.properties={},this.extent=s,this.type=0,this._pbf=n,this._geometry=-1,this._keys=c,this._values=p,n.readFields(I1,this,t)}function I1(n,t,s){n==1?t.id=s.readVarint():n==2?function(c,p){for(var v=c.readVarint()+c.pos;c.pos<v;){var x=p._keys[c.readVarint()],w=p._values[c.readVarint()];p.properties[x]=w}}(s,t):n==3?t.type=s.readVarint():n==4&&(t._geometry=s.pos)}function A1(n){for(var t,s,c=0,p=0,v=n.length,x=v-1;p<v;x=p++)c+=((s=n[x]).x-(t=n[p]).x)*(t.y+s.y);return c}zc.types=["Unknown","Point","LineString","Polygon"],zc.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var t,s=n.readVarint()+n.pos,c=1,p=0,v=0,x=0,w=[];n.pos<s;){if(p<=0){var E=n.readVarint();c=7&E,p=E>>3}if(p--,c===1||c===2)v+=n.readSVarint(),x+=n.readSVarint(),c===1&&(t&&w.push(t),t=[]),t.push(new C1(v,x));else{if(c!==7)throw new Error("unknown command "+c);t&&t.push(t[0].clone())}}return t&&w.push(t),w},zc.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var t=n.readVarint()+n.pos,s=1,c=0,p=0,v=0,x=1/0,w=-1/0,E=1/0,I=-1/0;n.pos<t;){if(c<=0){var L=n.readVarint();s=7&L,c=L>>3}if(c--,s===1||s===2)(p+=n.readSVarint())<x&&(x=p),p>w&&(w=p),(v+=n.readSVarint())<E&&(E=v),v>I&&(I=v);else if(s!==7)throw new Error("unknown command "+s)}return[x,E,w,I]},zc.prototype.toGeoJSON=function(n,t,s){var c,p,v=this.extent*Math.pow(2,s),x=this.extent*n,w=this.extent*t,E=this.loadGeometry(),I=zc.types[this.type];function L(j){for(var G=0;G<j.length;G++){var X=j[G];j[G]=[360*(X.x+x)/v-180,360/Math.PI*Math.atan(Math.exp((180-360*(X.y+w)/v)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(c=0;c<E.length;c++)O[c]=E[c][0];L(E=O);break;case 2:for(c=0;c<E.length;c++)L(E[c]);break;case 3:for(E=function(j){var G=j.length;if(G<=1)return[j];for(var X,ie,he=[],Ee=0;Ee<G;Ee++){var fe=A1(j[Ee]);fe!==0&&(ie===void 0&&(ie=fe<0),ie===fe<0?(X&&he.push(X),X=[j[Ee]]):X.push(j[Ee]))}return X&&he.push(X),he}(E),c=0;c<E.length;c++)for(p=0;p<E[c].length;p++)L(E[c][p])}E.length===1?E=E[0]:I="Multi"+I;var $={type:"Feature",geometry:{type:I,coordinates:E},properties:this.properties};return"id"in this&&($.id=this.id),$};var P1=Eg,Tg=Cg;function Cg(n,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(D1,this,t),this.length=this._features.length}function D1(n,t,s){n===15?t.version=s.readVarint():n===1?t.name=s.readString():n===5?t.extent=s.readVarint():n===2?t._features.push(s.pos):n===3?t._keys.push(s.readString()):n===4&&t._values.push(function(c){for(var p=null,v=c.readVarint()+c.pos;c.pos<v;){var x=c.readVarint()>>3;p=x===1?c.readString():x===2?c.readFloat():x===3?c.readDouble():x===4?c.readVarint64():x===5?c.readVarint():x===6?c.readSVarint():x===7?c.readBoolean():null}return p}(s))}Cg.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var t=this._pbf.readVarint()+this._pbf.pos;return new P1(this._pbf,t,this.extent,this._keys,this._values)};var k1=Tg;function L1(n,t,s){if(n===3){var c=new k1(s,s.readVarint()+s.pos);c.length&&(t[c.name]=c)}}il.VectorTile=function(n,t){this.layers=n.readFields(L1,{},t)},il.VectorTileFeature=Eg,il.VectorTileLayer=Tg;const R1=il.VectorTileFeature.types,Jf=Math.pow(2,13);function Vu(n,t,s,c,p,v,x,w){n.emplaceBack(t,s,2*Math.floor(c*Jf)+x,p*Jf*2,v*Jf*2,Math.round(w))}class Qf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Q,this.centroidVertexArray=new B,this.indexArray=new ze,this.programConfigurations=new Ir(t.layers,t.zoom),this.segments=new ct,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,c){this.features=[],this.hasPattern=Xf("fill-extrusion",this.layers,s);for(const{feature:p,id:v,index:x,sourceLayerIndex:w}of t){const E=this.layers[0]._featureFilter.needGeometry,I=xo(p,E);if(!this.layers[0]._featureFilter.filter(new gr(this.zoom),I,c))continue;const L={id:v,sourceLayerIndex:w,index:x,geometry:E?I.geometry:vo(p),properties:p.properties,type:p.type,patterns:{}};this.hasPattern?this.features.push(Kf("fill-extrusion",this.layers,L,this.zoom,s)):this.addFeature(L,L.geometry,x,c,{}),s.featureIndex.insert(p,L.geometry,x,w,this.index,!0)}}addFeatures(t,s,c){for(const p of this.features){const{geometry:v}=p;this.addFeature(p,v,p.index,s,c)}}update(t,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,c)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,T1),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,E1.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,s,c,p,v){const x={x:0,y:0,vertexCount:0};for(const w of Wf(s,500)){let E=0;for(const G of w)E+=G.length;let I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const G of w){if(G.length===0||O1(G))continue;let X=0;for(let ie=0;ie<G.length;ie++){const he=G[ie];if(ie>=1){const Ee=G[ie-1];if(!z1(he,Ee)){I.vertexLength+4>ct.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const fe=he.sub(Ee)._perp()._unit(),xe=Ee.dist(he);X+xe>32768&&(X=0),Vu(this.layoutVertexArray,he.x,he.y,fe.x,fe.y,0,0,X),Vu(this.layoutVertexArray,he.x,he.y,fe.x,fe.y,0,1,X),x.x+=2*he.x,x.y+=2*he.y,x.vertexCount+=2,X+=xe,Vu(this.layoutVertexArray,Ee.x,Ee.y,fe.x,fe.y,0,0,X),Vu(this.layoutVertexArray,Ee.x,Ee.y,fe.x,fe.y,0,1,X),x.x+=2*Ee.x,x.y+=2*Ee.y,x.vertexCount+=2;const $e=I.vertexLength;this.indexArray.emplaceBack($e,$e+2,$e+1),this.indexArray.emplaceBack($e+1,$e+2,$e+3),I.vertexLength+=4,I.primitiveLength+=2}}}}if(I.vertexLength+E>ct.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray)),R1[t.type]!=="Polygon")continue;const L=[],O=[],$=I.vertexLength;for(const G of w)if(G.length!==0){G!==w[0]&&O.push(L.length/2);for(let X=0;X<G.length;X++){const ie=G[X];Vu(this.layoutVertexArray,ie.x,ie.y,0,0,1,1,0),x.x+=ie.x,x.y+=ie.y,x.vertexCount+=1,L.push(ie.x),L.push(ie.y)}}const j=bg(L,O);for(let G=0;G<j.length;G+=3)this.indexArray.emplaceBack($+j[G],$+j[G+2],$+j[G+1]);I.primitiveLength+=j.length/3,I.vertexLength+=E}for(let w=0;w<x.vertexCount;w++)this.centroidVertexArray.emplaceBack(Math.floor(x.x/x.vertexCount),Math.floor(x.y/x.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,v,p)}}function z1(n,t){return n.x===t.x&&(n.x<0||n.x>Br)||n.y===t.y&&(n.y<0||n.y>Br)}function O1(n){return n.every(t=>t.x<0)||n.every(t=>t.x>Br)||n.every(t=>t.y<0)||n.every(t=>t.y>Br)}let Ig;Et("FillExtrusionBucket",Qf,{omit:["layers","features"]});var F1={get paint(){return Ig=Ig||new Wn({"fill-extrusion-opacity":new $t(ce["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Kt(ce["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new $t(ce["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new $t(ce["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new wc(ce["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Kt(ce["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Kt(ce["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new $t(ce["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class B1 extends $s{constructor(t){super(t,F1)}createBucket(t){return new Qf(t)}queryRadius(){return nd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,s,c,p,v,x,w,E){const I=sd(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,w),L=this.paint.get("fill-extrusion-height").evaluate(s,c),O=this.paint.get("fill-extrusion-base").evaluate(s,c),$=function(G,X,ie,he){const Ee=[];for(const fe of G){const xe=[fe.x,fe.y,0,1];ad(xe,xe,X),Ee.push(new D(xe[0]/xe[3],xe[1]/xe[3]))}return Ee}(I,E),j=function(G,X,ie,he){const Ee=[],fe=[],xe=he[8]*X,$e=he[9]*X,Ge=he[10]*X,Tt=he[11]*X,zt=he[8]*ie,Mt=he[9]*ie,vt=he[10]*ie,ot=he[11]*ie;for(const Pt of G){const gt=[],Qe=[];for(const Wt of Pt){const Bt=Wt.x,vi=Wt.y,fr=he[0]*Bt+he[4]*vi+he[12],_r=he[1]*Bt+he[5]*vi+he[13],an=he[2]*Bt+he[6]*vi+he[14],Ts=he[3]*Bt+he[7]*vi+he[15],Kn=an+Ge,Yr=Ts+Tt,Sn=fr+zt,Dn=_r+Mt,Yn=an+vt,Jn=Ts+ot,on=new D((fr+xe)/Yr,(_r+$e)/Yr);on.z=Kn/Yr,gt.push(on);const ln=new D(Sn/Jn,Dn/Jn);ln.z=Yn/Jn,Qe.push(ln)}Ee.push(gt),fe.push(Qe)}return[Ee,fe]}(p,O,L,E);return function(G,X,ie){let he=1/0;ku(ie,X)&&(he=Ag(ie,X[0]));for(let Ee=0;Ee<X.length;Ee++){const fe=X[Ee],xe=G[Ee];for(let $e=0;$e<fe.length-1;$e++){const Ge=fe[$e],Tt=[Ge,fe[$e+1],xe[$e+1],xe[$e],Ge];Du(ie,Tt)&&(he=Math.min(he,Ag(ie,Tt)))}}return he!==1/0&&he}(j[0],j[1],$)}}function ju(n,t){return n.x*t.x+n.y*t.y}function Ag(n,t){if(n.length===1){let s=0;const c=t[s++];let p;for(;!p||c.equals(p);)if(p=t[s++],!p)return 1/0;for(;s<t.length;s++){const v=t[s],x=n[0],w=p.sub(c),E=v.sub(c),I=x.sub(c),L=ju(w,w),O=ju(w,E),$=ju(E,E),j=ju(I,w),G=ju(I,E),X=L*$-O*O,ie=($*j-O*G)/X,he=(L*G-O*j)/X,Ee=c.z*(1-ie-he)+p.z*ie+v.z*he;if(isFinite(Ee))return Ee}return 1/0}{let s=1/0;for(const c of t)s=Math.min(s,c.z);return s}}const N1=jr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:$1}=N1,U1=jr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:V1}=U1,j1=il.VectorTileFeature.types,q1=Math.cos(Math.PI/180*37.5),Pg=Math.pow(2,14)/.5;class ep{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new re,this.layoutVertexArray2=new W,this.indexArray=new ze,this.programConfigurations=new Ir(t.layers,t.zoom),this.segments=new ct,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,c){this.hasPattern=Xf("line",this.layers,s);const p=this.layers[0].layout.get("line-sort-key"),v=!p.isConstant(),x=[];for(const{feature:w,id:E,index:I,sourceLayerIndex:L}of t){const O=this.layers[0]._featureFilter.needGeometry,$=xo(w,O);if(!this.layers[0]._featureFilter.filter(new gr(this.zoom),$,c))continue;const j=v?p.evaluate($,{},c):void 0,G={id:E,properties:w.properties,type:w.type,sourceLayerIndex:L,index:I,geometry:O?$.geometry:vo(w),patterns:{},sortKey:j};x.push(G)}v&&x.sort((w,E)=>w.sortKey-E.sortKey);for(const w of x){const{geometry:E,index:I,sourceLayerIndex:L}=w;if(this.hasPattern){const O=Kf("line",this.layers,w,this.zoom,s);this.patternFeatures.push(O)}else this.addFeature(w,E,I,c,{});s.featureIndex.insert(t[I].feature,E,I,L,this.index)}}update(t,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,c)}addFeatures(t,s,c){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,s,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,V1)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,$1),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,s,c,p,v){const x=this.layers[0].layout,w=x.get("line-join").evaluate(t,{}),E=x.get("line-cap"),I=x.get("line-miter-limit"),L=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const O of s)this.addLine(O,t,w,E,I,L);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,v,p)}addLine(t,s,c,p,v,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let he=0;he<t.length-1;he++)this.totalDistance+=t[he].dist(t[he+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w=j1[s.type]==="Polygon";let E=t.length;for(;E>=2&&t[E-1].equals(t[E-2]);)E--;let I=0;for(;I<E-1&&t[I].equals(t[I+1]);)I++;if(E<(w?3:2))return;c==="bevel"&&(v=1.05);const L=this.overscaling<=16?15*Br/(512*this.overscaling):0,O=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let $,j,G,X,ie;this.e1=this.e2=-1,w&&($=t[E-2],ie=t[I].sub($)._unit()._perp());for(let he=I;he<E;he++){if(G=he===E-1?w?t[I+1]:void 0:t[he+1],G&&t[he].equals(G))continue;ie&&(X=ie),$&&(j=$),$=t[he],ie=G?G.sub($)._unit()._perp():X,X=X||ie;let Ee=X.add(ie);Ee.x===0&&Ee.y===0||Ee._unit();const fe=X.x*ie.x+X.y*ie.y,xe=Ee.x*ie.x+Ee.y*ie.y,$e=xe!==0?1/xe:1/0,Ge=2*Math.sqrt(2-2*xe),Tt=xe<q1&&j&&G,zt=X.x*ie.y-X.y*ie.x>0;if(Tt&&he>I){const ot=$.dist(j);if(ot>2*L){const Pt=$.sub($.sub(j)._mult(L/ot)._round());this.updateDistance(j,Pt),this.addCurrentVertex(Pt,X,0,0,O),j=Pt}}const Mt=j&&G;let vt=Mt?c:w?"butt":p;if(Mt&&vt==="round"&&($e<x?vt="miter":$e<=2&&(vt="fakeround")),vt==="miter"&&$e>v&&(vt="bevel"),vt==="bevel"&&($e>2&&(vt="flipbevel"),$e<v&&(vt="miter")),j&&this.updateDistance(j,$),vt==="miter")Ee._mult($e),this.addCurrentVertex($,Ee,0,0,O);else if(vt==="flipbevel"){if($e>100)Ee=ie.mult(-1);else{const ot=$e*X.add(ie).mag()/X.sub(ie).mag();Ee._perp()._mult(ot*(zt?-1:1))}this.addCurrentVertex($,Ee,0,0,O),this.addCurrentVertex($,Ee.mult(-1),0,0,O)}else if(vt==="bevel"||vt==="fakeround"){const ot=-Math.sqrt($e*$e-1),Pt=zt?ot:0,gt=zt?0:ot;if(j&&this.addCurrentVertex($,X,Pt,gt,O),vt==="fakeround"){const Qe=Math.round(180*Ge/Math.PI/20);for(let Wt=1;Wt<Qe;Wt++){let Bt=Wt/Qe;if(Bt!==.5){const fr=Bt-.5;Bt+=Bt*fr*(Bt-1)*((1.0904+fe*(fe*(3.55645-1.43519*fe)-3.2452))*fr*fr+(.848013+fe*(.215638*fe-1.06021)))}const vi=ie.sub(X)._mult(Bt)._add(X)._unit()._mult(zt?-1:1);this.addHalfVertex($,vi.x,vi.y,!1,zt,0,O)}}G&&this.addCurrentVertex($,ie,-Pt,-gt,O)}else if(vt==="butt")this.addCurrentVertex($,Ee,0,0,O);else if(vt==="square"){const ot=j?1:-1;this.addCurrentVertex($,Ee,ot,ot,O)}else vt==="round"&&(j&&(this.addCurrentVertex($,X,0,0,O),this.addCurrentVertex($,X,1,1,O,!0)),G&&(this.addCurrentVertex($,ie,-1,-1,O,!0),this.addCurrentVertex($,ie,0,0,O)));if(Tt&&he<E-1){const ot=$.dist(G);if(ot>2*L){const Pt=$.add(G.sub($)._mult(L/ot)._round());this.updateDistance($,Pt),this.addCurrentVertex(Pt,ie,0,0,O),$=Pt}}}}addCurrentVertex(t,s,c,p,v,x=!1){const w=s.y*p-s.x,E=-s.y-s.x*p;this.addHalfVertex(t,s.x+s.y*c,s.y-s.x*c,x,!1,c,v),this.addHalfVertex(t,w,E,x,!0,-p,v),this.distance>Pg/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,s,c,p,v,x))}addHalfVertex({x:t,y:s},c,p,v,x,w,E){const I=.5*(this.lineClips?this.scaledDistance*(Pg-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(v?1:0),(s<<1)+(x?1:0),Math.round(63*c)+128,Math.round(63*p)+128,1+(w===0?0:w<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const L=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,L),E.primitiveLength++),x?this.e2=L:this.e1=L}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,s){this.distance+=t.dist(s),this.updateScaledDistance()}}let Dg,kg;Et("LineBucket",ep,{omit:["layers","patternFeatures"]});var Lg={get paint(){return kg=kg||new Wn({"line-opacity":new Kt(ce.paint_line["line-opacity"]),"line-color":new Kt(ce.paint_line["line-color"]),"line-translate":new $t(ce.paint_line["line-translate"]),"line-translate-anchor":new $t(ce.paint_line["line-translate-anchor"]),"line-width":new Kt(ce.paint_line["line-width"]),"line-gap-width":new Kt(ce.paint_line["line-gap-width"]),"line-offset":new Kt(ce.paint_line["line-offset"]),"line-blur":new Kt(ce.paint_line["line-blur"]),"line-dasharray":new jl(ce.paint_line["line-dasharray"]),"line-pattern":new wc(ce.paint_line["line-pattern"]),"line-gradient":new bu(ce.paint_line["line-gradient"])})},get layout(){return Dg=Dg||new Wn({"line-cap":new $t(ce.layout_line["line-cap"]),"line-join":new Kt(ce.layout_line["line-join"]),"line-miter-limit":new $t(ce.layout_line["line-miter-limit"]),"line-round-limit":new $t(ce.layout_line["line-round-limit"]),"line-sort-key":new Kt(ce.layout_line["line-sort-key"])})}};class G1 extends Kt{possiblyEvaluate(t,s){return s=new gr(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,zoomHistory:s.zoomHistory,transition:s.transition}),super.possiblyEvaluate(t,s)}evaluate(t,s,c,p){return s=dt({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(t,s,c,p)}}let hd;class H1 extends $s{constructor(t){super(t,Lg),this.gradientVersion=0,hd||(hd=new G1(Lg.paint.properties["line-width"].specification),hd.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const s=this.gradientExpression();this.stepInterpolant=!!function(c){return c._styleExpression!==void 0}(s)&&s._styleExpression.expression instanceof za,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,s){super.recalculate(t,s),this.paint._values["line-floorwidth"]=hd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new ep(t)}queryRadius(t){const s=t,c=Rg(zu("line-width",this,s),zu("line-gap-width",this,s)),p=zu("line-offset",this,s);return c/2+Math.abs(p)+nd(this.paint.get("line-translate"))}queryIntersectsFeature(t,s,c,p,v,x,w){const E=sd(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,w),I=w/2*Rg(this.paint.get("line-width").evaluate(s,c),this.paint.get("line-gap-width").evaluate(s,c)),L=this.paint.get("line-offset").evaluate(s,c);return L&&(p=function(O,$){const j=[];for(let G=0;G<O.length;G++){const X=O[G],ie=[];for(let he=0;he<X.length;he++){const Ee=X[he-1],fe=X[he],xe=X[he+1],$e=he===0?new D(0,0):fe.sub(Ee)._unit()._perp(),Ge=he===X.length-1?new D(0,0):xe.sub(fe)._unit()._perp(),Tt=$e._add(Ge)._unit(),zt=Tt.x*Ge.x+Tt.y*Ge.y;zt!==0&&Tt._mult(1/zt),ie.push(Tt._mult($)._add(fe))}j.push(ie)}return j}(p,L*w)),function(O,$,j){for(let G=0;G<$.length;G++){const X=$[G];if(O.length>=3){for(let ie=0;ie<X.length;ie++)if(kc(O,X[ie]))return!0}if(Lu(O,X,j))return!0}return!1}(E,p,I)}isTileClipped(){return!0}}function Rg(n,t){return t>0?t+2*n:n}const Z1=jr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),W1=jr([{name:"a_projected_pos",components:3,type:"Float32"}],4);jr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const X1=jr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);jr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const zg=jr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),K1=jr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Y1(n,t,s){return n.sections.forEach(c=>{c.text=function(p,v,x){const w=v.layout.get("text-transform").evaluate(x,{});return w==="uppercase"?p=p.toLocaleUpperCase():w==="lowercase"&&(p=p.toLocaleLowerCase()),Va.applyArabicShaping&&(p=Va.applyArabicShaping(p)),p}(c.text,t,s)}),n}jr([{name:"triangle",components:3,type:"Uint16"}]),jr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),jr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),jr([{type:"Float32",name:"offsetX"}]),jr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),jr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const qu={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var sn=24,Og=Qi,Fg=function(n,t,s,c,p){var v,x,w=8*p-c-1,E=(1<<w)-1,I=E>>1,L=-7,O=s?p-1:0,$=s?-1:1,j=n[t+O];for(O+=$,v=j&(1<<-L)-1,j>>=-L,L+=w;L>0;v=256*v+n[t+O],O+=$,L-=8);for(x=v&(1<<-L)-1,v>>=-L,L+=c;L>0;x=256*x+n[t+O],O+=$,L-=8);if(v===0)v=1-I;else{if(v===E)return x?NaN:1/0*(j?-1:1);x+=Math.pow(2,c),v-=I}return(j?-1:1)*x*Math.pow(2,v-c)},Bg=function(n,t,s,c,p,v){var x,w,E,I=8*v-p-1,L=(1<<I)-1,O=L>>1,$=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,j=c?0:v-1,G=c?1:-1,X=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(w=isNaN(t)?1:0,x=L):(x=Math.floor(Math.log(t)/Math.LN2),t*(E=Math.pow(2,-x))<1&&(x--,E*=2),(t+=x+O>=1?$/E:$*Math.pow(2,1-O))*E>=2&&(x++,E/=2),x+O>=L?(w=0,x=L):x+O>=1?(w=(t*E-1)*Math.pow(2,p),x+=O):(w=t*Math.pow(2,O-1)*Math.pow(2,p),x=0));p>=8;n[s+j]=255&w,j+=G,w/=256,p-=8);for(x=x<<p|w,I+=p;I>0;n[s+j]=255&x,j+=G,x/=256,I-=8);n[s+j-G]|=128*X};function Qi(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}Qi.Varint=0,Qi.Fixed64=1,Qi.Bytes=2,Qi.Fixed32=5;var tp=4294967296,Ng=1/tp,$g=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function bo(n){return n.type===Qi.Bytes?n.readVarint()+n.pos:n.pos+1}function Oc(n,t,s){return s?4294967296*t+(n>>>0):4294967296*(t>>>0)+(n>>>0)}function Ug(n,t,s){var c=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));s.realloc(c);for(var p=s.pos-1;p>=n;p--)s.buf[p+c]=s.buf[p]}function J1(n,t){for(var s=0;s<n.length;s++)t.writeVarint(n[s])}function Q1(n,t){for(var s=0;s<n.length;s++)t.writeSVarint(n[s])}function eb(n,t){for(var s=0;s<n.length;s++)t.writeFloat(n[s])}function tb(n,t){for(var s=0;s<n.length;s++)t.writeDouble(n[s])}function ib(n,t){for(var s=0;s<n.length;s++)t.writeBoolean(n[s])}function rb(n,t){for(var s=0;s<n.length;s++)t.writeFixed32(n[s])}function nb(n,t){for(var s=0;s<n.length;s++)t.writeSFixed32(n[s])}function sb(n,t){for(var s=0;s<n.length;s++)t.writeFixed64(n[s])}function ab(n,t){for(var s=0;s<n.length;s++)t.writeSFixed64(n[s])}function dd(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+16777216*n[t+3]}function Fc(n,t,s){n[s]=t,n[s+1]=t>>>8,n[s+2]=t>>>16,n[s+3]=t>>>24}function Vg(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+(n[t+3]<<24)}Qi.prototype={destroy:function(){this.buf=null},readFields:function(n,t,s){for(s=s||this.length;this.pos<s;){var c=this.readVarint(),p=c>>3,v=this.pos;this.type=7&c,n(p,t,this),this.pos===v&&this.skip(c)}return t},readMessage:function(n,t){return this.readFields(n,t,this.readVarint()+this.pos)},readFixed32:function(){var n=dd(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=Vg(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=dd(this.buf,this.pos)+dd(this.buf,this.pos+4)*tp;return this.pos+=8,n},readSFixed64:function(){var n=dd(this.buf,this.pos)+Vg(this.buf,this.pos+4)*tp;return this.pos+=8,n},readFloat:function(){var n=Fg(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=Fg(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var t,s,c=this.buf;return t=127&(s=c[this.pos++]),s<128?t:(t|=(127&(s=c[this.pos++]))<<7,s<128?t:(t|=(127&(s=c[this.pos++]))<<14,s<128?t:(t|=(127&(s=c[this.pos++]))<<21,s<128?t:function(p,v,x){var w,E,I=x.buf;if(w=(112&(E=I[x.pos++]))>>4,E<128||(w|=(127&(E=I[x.pos++]))<<3,E<128)||(w|=(127&(E=I[x.pos++]))<<10,E<128)||(w|=(127&(E=I[x.pos++]))<<17,E<128)||(w|=(127&(E=I[x.pos++]))<<24,E<128)||(w|=(1&(E=I[x.pos++]))<<31,E<128))return Oc(p,w,v);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(s=c[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,t=this.pos;return this.pos=n,n-t>=12&&$g?function(s,c,p){return $g.decode(s.subarray(c,p))}(this.buf,t,n):function(s,c,p){for(var v="",x=c;x<p;){var w,E,I,L=s[x],O=null,$=L>239?4:L>223?3:L>191?2:1;if(x+$>p)break;$===1?L<128&&(O=L):$===2?(192&(w=s[x+1]))==128&&(O=(31&L)<<6|63&w)<=127&&(O=null):$===3?(E=s[x+2],(192&(w=s[x+1]))==128&&(192&E)==128&&((O=(15&L)<<12|(63&w)<<6|63&E)<=2047||O>=55296&&O<=57343)&&(O=null)):$===4&&(E=s[x+2],I=s[x+3],(192&(w=s[x+1]))==128&&(192&E)==128&&(192&I)==128&&((O=(15&L)<<18|(63&w)<<12|(63&E)<<6|63&I)<=65535||O>=1114112)&&(O=null)),O===null?(O=65533,$=1):O>65535&&(O-=65536,v+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),v+=String.fromCharCode(O),x+=$}return v}(this.buf,t,n)},readBytes:function(){var n=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,n);return this.pos=n,t},readPackedVarint:function(n,t){if(this.type!==Qi.Bytes)return n.push(this.readVarint(t));var s=bo(this);for(n=n||[];this.pos<s;)n.push(this.readVarint(t));return n},readPackedSVarint:function(n){if(this.type!==Qi.Bytes)return n.push(this.readSVarint());var t=bo(this);for(n=n||[];this.pos<t;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==Qi.Bytes)return n.push(this.readBoolean());var t=bo(this);for(n=n||[];this.pos<t;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==Qi.Bytes)return n.push(this.readFloat());var t=bo(this);for(n=n||[];this.pos<t;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==Qi.Bytes)return n.push(this.readDouble());var t=bo(this);for(n=n||[];this.pos<t;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==Qi.Bytes)return n.push(this.readFixed32());var t=bo(this);for(n=n||[];this.pos<t;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==Qi.Bytes)return n.push(this.readSFixed32());var t=bo(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==Qi.Bytes)return n.push(this.readFixed64());var t=bo(this);for(n=n||[];this.pos<t;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==Qi.Bytes)return n.push(this.readSFixed64());var t=bo(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed64());return n},skip:function(n){var t=7&n;if(t===Qi.Varint)for(;this.buf[this.pos++]>127;);else if(t===Qi.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Qi.Fixed32)this.pos+=4;else{if(t!==Qi.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(n,t){this.writeVarint(n<<3|t)},realloc:function(n){for(var t=this.length||16;t<this.pos+n;)t*=2;if(t!==this.length){var s=new Uint8Array(t);s.set(this.buf),this.buf=s,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),Fc(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),Fc(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),Fc(this.buf,-1&n,this.pos),Fc(this.buf,Math.floor(n*Ng),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),Fc(this.buf,-1&n,this.pos),Fc(this.buf,Math.floor(n*Ng),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(t,s){var c,p;if(t>=0?(c=t%4294967296|0,p=t/4294967296|0):(p=~(-t/4294967296),4294967295^(c=~(-t%4294967296))?c=c+1|0:(c=0,p=p+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(v,x,w){w.buf[w.pos++]=127&v|128,v>>>=7,w.buf[w.pos++]=127&v|128,v>>>=7,w.buf[w.pos++]=127&v|128,v>>>=7,w.buf[w.pos++]=127&v|128,w.buf[w.pos]=127&(v>>>=7)}(c,0,s),function(v,x){var w=(7&v)<<4;x.buf[x.pos++]|=w|((v>>>=3)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v)))))}(p,s)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var t=this.pos;this.pos=function(c,p,v){for(var x,w,E=0;E<p.length;E++){if((x=p.charCodeAt(E))>55295&&x<57344){if(!w){x>56319||E+1===p.length?(c[v++]=239,c[v++]=191,c[v++]=189):w=x;continue}if(x<56320){c[v++]=239,c[v++]=191,c[v++]=189,w=x;continue}x=w-55296<<10|x-56320|65536,w=null}else w&&(c[v++]=239,c[v++]=191,c[v++]=189,w=null);x<128?c[v++]=x:(x<2048?c[v++]=x>>6|192:(x<65536?c[v++]=x>>12|224:(c[v++]=x>>18|240,c[v++]=x>>12&63|128),c[v++]=x>>6&63|128),c[v++]=63&x|128)}return v}(this.buf,n,this.pos);var s=this.pos-t;s>=128&&Ug(t,s,this),this.pos=t-1,this.writeVarint(s),this.pos+=s},writeFloat:function(n){this.realloc(4),Bg(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),Bg(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var t=n.length;this.writeVarint(t),this.realloc(t);for(var s=0;s<t;s++)this.buf[this.pos++]=n[s]},writeRawMessage:function(n,t){this.pos++;var s=this.pos;n(t,this);var c=this.pos-s;c>=128&&Ug(s,c,this),this.pos=s-1,this.writeVarint(c),this.pos+=c},writeMessage:function(n,t,s){this.writeTag(n,Qi.Bytes),this.writeRawMessage(t,s)},writePackedVarint:function(n,t){t.length&&this.writeMessage(n,J1,t)},writePackedSVarint:function(n,t){t.length&&this.writeMessage(n,Q1,t)},writePackedBoolean:function(n,t){t.length&&this.writeMessage(n,ib,t)},writePackedFloat:function(n,t){t.length&&this.writeMessage(n,eb,t)},writePackedDouble:function(n,t){t.length&&this.writeMessage(n,tb,t)},writePackedFixed32:function(n,t){t.length&&this.writeMessage(n,rb,t)},writePackedSFixed32:function(n,t){t.length&&this.writeMessage(n,nb,t)},writePackedFixed64:function(n,t){t.length&&this.writeMessage(n,sb,t)},writePackedSFixed64:function(n,t){t.length&&this.writeMessage(n,ab,t)},writeBytesField:function(n,t){this.writeTag(n,Qi.Bytes),this.writeBytes(t)},writeFixed32Field:function(n,t){this.writeTag(n,Qi.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(n,t){this.writeTag(n,Qi.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(n,t){this.writeTag(n,Qi.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(n,t){this.writeTag(n,Qi.Fixed64),this.writeSFixed64(t)},writeVarintField:function(n,t){this.writeTag(n,Qi.Varint),this.writeVarint(t)},writeSVarintField:function(n,t){this.writeTag(n,Qi.Varint),this.writeSVarint(t)},writeStringField:function(n,t){this.writeTag(n,Qi.Bytes),this.writeString(t)},writeFloatField:function(n,t){this.writeTag(n,Qi.Fixed32),this.writeFloat(t)},writeDoubleField:function(n,t){this.writeTag(n,Qi.Fixed64),this.writeDouble(t)},writeBooleanField:function(n,t){this.writeVarintField(n,!!t)}};var ip=T(Og);const rp=3;function ob(n,t,s){n===1&&s.readMessage(lb,t)}function lb(n,t,s){if(n===3){const{id:c,bitmap:p,width:v,height:x,left:w,top:E,advance:I}=s.readMessage(cb,{});t.push({id:c,bitmap:new Fu({width:v+2*rp,height:x+2*rp},p),metrics:{width:v,height:x,left:w,top:E,advance:I}})}}function cb(n,t,s){n===1?t.id=s.readVarint():n===2?t.bitmap=s.readBytes():n===3?t.width=s.readVarint():n===4?t.height=s.readVarint():n===5?t.left=s.readSVarint():n===6?t.top=s.readSVarint():n===7&&(t.advance=s.readVarint())}const jg=rp;function qg(n){let t=0,s=0;for(const x of n)t+=x.w*x.h,s=Math.max(s,x.w);n.sort((x,w)=>w.h-x.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),s),h:1/0}];let p=0,v=0;for(const x of n)for(let w=c.length-1;w>=0;w--){const E=c[w];if(!(x.w>E.w||x.h>E.h)){if(x.x=E.x,x.y=E.y,v=Math.max(v,x.y+x.h),p=Math.max(p,x.x+x.w),x.w===E.w&&x.h===E.h){const I=c.pop();w<c.length&&(c[w]=I)}else x.h===E.h?(E.x+=x.w,E.w-=x.w):x.w===E.w?(E.y+=x.h,E.h-=x.h):(c.push({x:E.x+x.w,y:E.y,w:E.w-x.w,h:x.h}),E.y+=x.h,E.h-=x.h);break}}return{w:p,h:v,fill:t/(p*v)||0}}const ls=1;class np{constructor(t,{pixelRatio:s,version:c,stretchX:p,stretchY:v,content:x}){this.paddedRect=t,this.pixelRatio=s,this.stretchX=p,this.stretchY=v,this.content=x,this.version=c}get tl(){return[this.paddedRect.x+ls,this.paddedRect.y+ls]}get br(){return[this.paddedRect.x+this.paddedRect.w-ls,this.paddedRect.y+this.paddedRect.h-ls]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*ls)/this.pixelRatio,(this.paddedRect.h-2*ls)/this.pixelRatio]}}class Gg{constructor(t,s){const c={},p={};this.haveRenderCallbacks=[];const v=[];this.addImages(t,c,v),this.addImages(s,p,v);const{w:x,h:w}=qg(v),E=new Us({width:x||1,height:w||1});for(const I in t){const L=t[I],O=c[I].paddedRect;Us.copy(L.data,E,{x:0,y:0},{x:O.x+ls,y:O.y+ls},L.data)}for(const I in s){const L=s[I],O=p[I].paddedRect,$=O.x+ls,j=O.y+ls,G=L.data.width,X=L.data.height;Us.copy(L.data,E,{x:0,y:0},{x:$,y:j},L.data),Us.copy(L.data,E,{x:0,y:X-1},{x:$,y:j-1},{width:G,height:1}),Us.copy(L.data,E,{x:0,y:0},{x:$,y:j+X},{width:G,height:1}),Us.copy(L.data,E,{x:G-1,y:0},{x:$-1,y:j},{width:1,height:X}),Us.copy(L.data,E,{x:0,y:0},{x:$+G,y:j},{width:1,height:X})}this.image=E,this.iconPositions=c,this.patternPositions=p}addImages(t,s,c){for(const p in t){const v=t[p],x={x:0,y:0,w:v.data.width+2*ls,h:v.data.height+2*ls};c.push(x),s[p]=new np(x,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(t,s){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in t.updatedImages)this.patchUpdatedImage(this.iconPositions[c],t.getImage(c),s),this.patchUpdatedImage(this.patternPositions[c],t.getImage(c),s)}patchUpdatedImage(t,s,c){if(!t||!s||t.version===s.version)return;t.version=s.version;const[p,v]=t.tl;c.update(s.data,void 0,{x:p,y:v})}}var rl;Et("ImagePosition",np),Et("ImageAtlas",Gg),m.ah=void 0,(rl=m.ah||(m.ah={}))[rl.none=0]="none",rl[rl.horizontal=1]="horizontal",rl[rl.vertical=2]="vertical",rl[rl.horizontalOnly=3]="horizontalOnly";const Gu=-17;class Hu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,s){const c=new Hu;return c.scale=t||1,c.fontStack=s,c}static forImage(t){const s=new Hu;return s.imageName=t,s}}class Bc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,s){const c=new Bc;for(let p=0;p<t.sections.length;p++){const v=t.sections[p];v.image?c.addImageSection(v):c.addTextSection(v,s)}return c}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let s="";for(let c=0;c<t.length;c++){const p=t.charCodeAt(c+1)||null,v=t.charCodeAt(c-1)||null;s+=p&&Ua(p)&&!qu[t[c+1]]||v&&Ua(v)&&!qu[t[c-1]]||!qu[t[c]]?t[c]:qu[t[c]]}return s}(this.text)}trim(){let t=0;for(let c=0;c<this.text.length&&pd[this.text.charCodeAt(c)];c++)t++;let s=this.text.length;for(let c=this.text.length-1;c>=0&&c>=t&&pd[this.text.charCodeAt(c)];c--)s--;this.text=this.text.substring(t,s),this.sectionIndex=this.sectionIndex.slice(t,s)}substring(t,s){const c=new Bc;return c.text=this.text.substring(t,s),c.sectionIndex=this.sectionIndex.slice(t,s),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,s)=>Math.max(t,this.sections[s].scale),0)}addTextSection(t,s){this.text+=t.text,this.sections.push(Hu.forText(t.scale,t.fontStack||s));const c=this.sections.length-1;for(let p=0;p<t.text.length;++p)this.sectionIndex.push(c)}addImageSection(t){const s=t.image?t.image.name:"";if(s.length===0)return void xi("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Hu.forImage(s)),this.sectionIndex.push(this.sections.length-1)):xi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function fd(n,t,s,c,p,v,x,w,E,I,L,O,$,j,G,X){const ie=Bc.fromFeature(n,p);let he;O===m.ah.vertical&&ie.verticalizePunctuation();const{processBidirectionalText:Ee,processStyledBidirectionalText:fe}=Va;if(Ee&&ie.sections.length===1){he=[];const Ge=Ee(ie.toString(),sp(ie,I,v,t,c,j,G));for(const Tt of Ge){const zt=new Bc;zt.text=Tt,zt.sections=ie.sections;for(let Mt=0;Mt<Tt.length;Mt++)zt.sectionIndex.push(0);he.push(zt)}}else if(fe){he=[];const Ge=fe(ie.text,ie.sectionIndex,sp(ie,I,v,t,c,j,G));for(const Tt of Ge){const zt=new Bc;zt.text=Tt[0],zt.sectionIndex=Tt[1],zt.sections=ie.sections,he.push(zt)}}else he=function(Ge,Tt){const zt=[],Mt=Ge.text;let vt=0;for(const ot of Tt)zt.push(Ge.substring(vt,ot)),vt=ot;return vt<Mt.length&&zt.push(Ge.substring(vt,Mt.length)),zt}(ie,sp(ie,I,v,t,c,j,G));const xe=[],$e={positionedLines:xe,text:ie.toString(),top:L[1],bottom:L[1],left:L[0],right:L[0],writingMode:O,iconsInText:!1,verticalizable:!1};return function(Ge,Tt,zt,Mt,vt,ot,Pt,gt,Qe,Wt,Bt,vi){let fr=0,_r=Gu,an=0,Ts=0;const Kn=gt==="right"?1:gt==="left"?0:.5;let Yr=0;for(const on of vt){on.trim();const ln=on.getMaxScale(),On=(ln-1)*sn,Qn={positionedGlyphs:[],lineOffset:0};Ge.positionedLines[Yr]=Qn;const Fn=Qn.positionedGlyphs;let cs=0;if(!on.length()){_r+=ot,++Yr;continue}for(let cn=0;cn<on.length();cn++){const Ti=on.getSection(cn),Bn=on.getSectionIndex(cn),kn=on.getCharCode(cn);let un=0,ra=null,Ma=null,Sa=null,wo=sn;const na=!(Qe===m.ah.horizontal||!Bt&&!go(kn)||Bt&&(pd[kn]||(Sn=kn,yt.Arabic(Sn)||yt["Arabic Supplement"](Sn)||yt["Arabic Extended-A"](Sn)||yt["Arabic Presentation Forms-A"](Sn)||yt["Arabic Presentation Forms-B"](Sn))));if(Ti.imageName){const js=Mt[Ti.imageName];if(!js)continue;Sa=Ti.imageName,Ge.iconsInText=Ge.iconsInText||!0,Ma=js.paddedRect;const hs=js.displaySize;Ti.scale=Ti.scale*sn/vi,ra={width:hs[0],height:hs[1],left:ls,top:-jg,advance:na?hs[1]:hs[0]},un=On+(sn-hs[1]*Ti.scale),wo=ra.advance;const Mo=na?hs[0]*Ti.scale-sn*ln:hs[1]*Ti.scale-sn*ln;Mo>0&&Mo>cs&&(cs=Mo)}else{const js=zt[Ti.fontStack],hs=js&&js[kn];if(hs&&hs.rect)Ma=hs.rect,ra=hs.metrics;else{const Mo=Tt[Ti.fontStack],Yu=Mo&&Mo[kn];if(!Yu)continue;ra=Yu.metrics}un=(ln-Ti.scale)*sn}na?(Ge.verticalizable=!0,Fn.push({glyph:kn,imageName:Sa,x:fr,y:_r+un,vertical:na,scale:Ti.scale,fontStack:Ti.fontStack,sectionIndex:Bn,metrics:ra,rect:Ma}),fr+=wo*Ti.scale+Wt):(Fn.push({glyph:kn,imageName:Sa,x:fr,y:_r+un,vertical:na,scale:Ti.scale,fontStack:Ti.fontStack,sectionIndex:Bn,metrics:ra,rect:Ma}),fr+=ra.advance*Ti.scale+Wt)}Fn.length!==0&&(an=Math.max(fr-Wt,an),db(Fn,0,Fn.length-1,Kn,cs)),fr=0;const us=ot*ln+cs;Qn.lineOffset=Math.max(cs,On),_r+=us,Ts=Math.max(us,Ts),++Yr}var Sn;const Dn=_r-Gu,{horizontalAlign:Yn,verticalAlign:Jn}=ap(Pt);(function(on,ln,On,Qn,Fn,cs,us,cn,Ti){const Bn=(ln-On)*Fn;let kn=0;kn=cs!==us?-cn*Qn-Gu:(-Qn*Ti+.5)*us;for(const un of on)for(const ra of un.positionedGlyphs)ra.x+=Bn,ra.y+=kn})(Ge.positionedLines,Kn,Yn,Jn,an,Ts,ot,Dn,vt.length),Ge.top+=-Jn*Dn,Ge.bottom=Ge.top+Dn,Ge.left+=-Yn*an,Ge.right=Ge.left+an}($e,t,s,c,he,x,w,E,O,I,$,X),!function(Ge){for(const Tt of Ge)if(Tt.positionedGlyphs.length!==0)return!1;return!0}(xe)&&$e}const pd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ub={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Hg(n,t,s,c,p,v){if(t.imageName){const x=c[t.imageName];return x?x.displaySize[0]*t.scale*sn/v+p:0}{const x=s[t.fontStack],w=x&&x[n];return w?w.metrics.advance*t.scale+p:0}}function Zg(n,t,s,c){const p=Math.pow(n-t,2);return c?n<t?p/2:2*p:p+Math.abs(s)*s}function hb(n,t,s){let c=0;return n===10&&(c-=1e4),s&&(c+=150),n!==40&&n!==65288||(c+=50),t!==41&&t!==65289||(c+=50),c}function Wg(n,t,s,c,p,v){let x=null,w=Zg(t,s,p,v);for(const E of c){const I=Zg(t-E.x,s,p,v)+E.badness;I<=w&&(x=E,w=I)}return{index:n,x:t,priorBreak:x,badness:w}}function Xg(n){return n?Xg(n.priorBreak).concat(n.index):[]}function sp(n,t,s,c,p,v,x){if(v!=="point")return[];if(!n)return[];const w=[],E=function($,j,G,X,ie,he){let Ee=0;for(let fe=0;fe<$.length();fe++){const xe=$.getSection(fe);Ee+=Hg($.getCharCode(fe),xe,X,ie,j,he)}return Ee/Math.max(1,Math.ceil(Ee/G))}(n,t,s,c,p,x),I=n.text.indexOf("")>=0;let L=0;for(let $=0;$<n.length();$++){const j=n.getSection($),G=n.getCharCode($);if(pd[G]||(L+=Hg(G,j,c,p,t,x)),$<n.length()-1){const X=!((O=G)<11904||!(yt["Bopomofo Extended"](O)||yt.Bopomofo(O)||yt["CJK Compatibility Forms"](O)||yt["CJK Compatibility Ideographs"](O)||yt["CJK Compatibility"](O)||yt["CJK Radicals Supplement"](O)||yt["CJK Strokes"](O)||yt["CJK Symbols and Punctuation"](O)||yt["CJK Unified Ideographs Extension A"](O)||yt["CJK Unified Ideographs"](O)||yt["Enclosed CJK Letters and Months"](O)||yt["Halfwidth and Fullwidth Forms"](O)||yt.Hiragana(O)||yt["Ideographic Description Characters"](O)||yt["Kangxi Radicals"](O)||yt["Katakana Phonetic Extensions"](O)||yt.Katakana(O)||yt["Vertical Forms"](O)||yt["Yi Radicals"](O)||yt["Yi Syllables"](O)));(ub[G]||X||j.imageName)&&w.push(Wg($+1,L,E,w,hb(G,n.getCharCode($+1),X&&I),!1))}}var O;return Xg(Wg(n.length(),L,E,w,0,!0))}function ap(n){let t=.5,s=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:t,verticalAlign:s}}function db(n,t,s,c,p){if(!c&&!p)return;const v=n[s],x=(n[s].x+v.metrics.advance*v.scale)*c;for(let w=t;w<=s;w++)n[w].x-=x,n[w].y+=p}function fb(n,t,s){const{horizontalAlign:c,verticalAlign:p}=ap(s),v=t[0]-n.displaySize[0]*c,x=t[1]-n.displaySize[1]*p;return{image:n,top:x,bottom:x+n.displaySize[1],left:v,right:v+n.displaySize[0]}}function Kg(n,t,s,c,p,v){const x=n.image;let w;if(x.content){const ie=x.content,he=x.pixelRatio||1;w=[ie[0]/he,ie[1]/he,x.displaySize[0]-ie[2]/he,x.displaySize[1]-ie[3]/he]}const E=t.left*v,I=t.right*v;let L,O,$,j;s==="width"||s==="both"?(j=p[0]+E-c[3],O=p[0]+I+c[1]):(j=p[0]+(E+I-x.displaySize[0])/2,O=j+x.displaySize[0]);const G=t.top*v,X=t.bottom*v;return s==="height"||s==="both"?(L=p[1]+G-c[0],$=p[1]+X+c[2]):(L=p[1]+(G+X-x.displaySize[1])/2,$=L+x.displaySize[1]),{image:x,top:L,right:O,bottom:$,left:j,collisionPadding:w}}const Zu=255,Ha=128,nl=Zu*Ha;function Yg(n,t){const{expression:s}=t;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new gr(n+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:p}=s;let v=0;for(;v<c.length&&c[v]<=n;)v++;v=Math.max(0,v-1);let x=v;for(;x<c.length&&c[x]<n+1;)x++;x=Math.min(c.length-1,x);const w=c[v],E=c[x];return s.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:E,interpolationType:p}:{kind:"camera",minZoom:w,maxZoom:E,minSize:s.evaluate(new gr(w)),maxSize:s.evaluate(new gr(E)),interpolationType:p}}}function op(n,t,s){let c="never";const p=n.get(t);return p?c=p:n.get(s)&&(c="always"),c}const pb=il.VectorTileFeature.types,mb=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function md(n,t,s,c,p,v,x,w,E,I,L,O,$){const j=w?Math.min(nl,Math.round(w[0])):0,G=w?Math.min(nl,Math.round(w[1])):0;n.emplaceBack(t,s,Math.round(32*c),Math.round(32*p),v,x,(j<<1)+(E?1:0),G,16*I,16*L,256*O,256*$)}function lp(n,t,s){n.emplaceBack(t.x,t.y,s),n.emplaceBack(t.x,t.y,s),n.emplaceBack(t.x,t.y,s),n.emplaceBack(t.x,t.y,s)}function gb(n){for(const t of n.sections)if(Nf(t.text))return!0;return!1}class cp{constructor(t){this.layoutVertexArray=new Ie,this.indexArray=new ze,this.programConfigurations=t,this.segments=new ct,this.dynamicLayoutVertexArray=new le,this.opacityVertexArray=new be,this.hasVisibleVertices=!1,this.placedSymbolArray=new o}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,s,c,p){this.isEmpty()||(c&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Z1.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,W1.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,mb,!0),this.opacityVertexBuffer.itemSize=1),(c||p)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Et("SymbolBuffers",cp);class up{constructor(t,s,c){this.layoutVertexArray=new t,this.layoutAttributes=s,this.indexArray=new c,this.segments=new ct,this.collisionVertexArray=new ke}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,X1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Et("CollisionBuffers",up);class Nc{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(x=>x.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Uf([]),this.placementViewportMatrix=Uf([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Yg(this.zoom,s["text-size"]),this.iconSizeData=Yg(this.zoom,s["icon-size"]);const c=this.layers[0].layout,p=c.get("symbol-sort-key"),v=c.get("symbol-z-order");this.canOverlap=op(c,"text-overlap","text-allow-overlap")!=="never"||op(c,"icon-overlap","icon-allow-overlap")!=="never"||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&!p.isConstant(),this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,c.get("symbol-placement")==="point"&&(this.writingModes=c.get("text-writing-mode").map(x=>m.ah[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=t.sourceID}createArrays(){this.text=new cp(new Ir(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new cp(new Ir(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new _,this.lineVertexArray=new M,this.symbolInstances=new f,this.textAnchorOffsets=new C}calculateGlyphDependencies(t,s,c,p,v){for(let x=0;x<t.length;x++)if(s[t.charCodeAt(x)]=!0,(c||p)&&v){const w=qu[t.charAt(x)];w&&(s[w.charCodeAt(0)]=!0)}}populate(t,s,c){const p=this.layers[0],v=p.layout,x=v.get("text-font"),w=v.get("text-field"),E=v.get("icon-image"),I=(w.value.kind!=="constant"||w.value.value instanceof An&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),L=E.value.kind!=="constant"||!!E.value.value||Object.keys(E.parameters).length>0,O=v.get("symbol-sort-key");if(this.features=[],!I&&!L)return;const $=s.iconDependencies,j=s.glyphDependencies,G=s.availableImages,X=new gr(this.zoom);for(const{feature:ie,id:he,index:Ee,sourceLayerIndex:fe}of t){const xe=p._featureFilter.needGeometry,$e=xo(ie,xe);if(!p._featureFilter.filter(X,$e,c))continue;let Ge,Tt;if(xe||($e.geometry=vo(ie)),I){const Mt=p.getValueAndResolveTokens("text-field",$e,c,G),vt=An.factory(Mt),ot=this.hasRTLText=this.hasRTLText||gb(vt);(!ot||Va.getRTLTextPluginStatus()==="unavailable"||ot&&Va.isParsed())&&(Ge=Y1(vt,p,$e))}if(L){const Mt=p.getValueAndResolveTokens("icon-image",$e,c,G);Tt=Mt instanceof vn?Mt:vn.fromString(Mt)}if(!Ge&&!Tt)continue;const zt=this.sortFeaturesByKey?O.evaluate($e,{},c):void 0;if(this.features.push({id:he,text:Ge,icon:Tt,index:Ee,sourceLayerIndex:fe,geometry:$e.geometry,properties:ie.properties,type:pb[ie.type],sortKey:zt}),Tt&&($[Tt.name]=!0),Ge){const Mt=x.evaluate($e,{},c).join(","),vt=v.get("text-rotation-alignment")!=="viewport"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(m.ah.vertical)>=0;for(const ot of Ge.sections)if(ot.image)$[ot.image.name]=!0;else{const Pt=ea(Ge.toString()),gt=ot.fontStack||Mt,Qe=j[gt]=j[gt]||{};this.calculateGlyphDependencies(ot.text,Qe,vt,this.allowVerticalPlacement,Pt)}}}v.get("symbol-placement")==="line"&&(this.features=function(ie){const he={},Ee={},fe=[];let xe=0;function $e(Mt){fe.push(ie[Mt]),xe++}function Ge(Mt,vt,ot){const Pt=Ee[Mt];return delete Ee[Mt],Ee[vt]=Pt,fe[Pt].geometry[0].pop(),fe[Pt].geometry[0]=fe[Pt].geometry[0].concat(ot[0]),Pt}function Tt(Mt,vt,ot){const Pt=he[vt];return delete he[vt],he[Mt]=Pt,fe[Pt].geometry[0].shift(),fe[Pt].geometry[0]=ot[0].concat(fe[Pt].geometry[0]),Pt}function zt(Mt,vt,ot){const Pt=ot?vt[0][vt[0].length-1]:vt[0][0];return`${Mt}:${Pt.x}:${Pt.y}`}for(let Mt=0;Mt<ie.length;Mt++){const vt=ie[Mt],ot=vt.geometry,Pt=vt.text?vt.text.toString():null;if(!Pt){$e(Mt);continue}const gt=zt(Pt,ot),Qe=zt(Pt,ot,!0);if(gt in Ee&&Qe in he&&Ee[gt]!==he[Qe]){const Wt=Tt(gt,Qe,ot),Bt=Ge(gt,Qe,fe[Wt].geometry);delete he[gt],delete Ee[Qe],Ee[zt(Pt,fe[Bt].geometry,!0)]=Bt,fe[Wt].geometry=null}else gt in Ee?Ge(gt,Qe,ot):Qe in he?Tt(gt,Qe,ot):($e(Mt),he[gt]=xe-1,Ee[Qe]=xe-1)}return fe.filter(Mt=>Mt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ie,he)=>ie.sortKey-he.sortKey)}update(t,s,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,s,this.layers,c),this.icon.programConfigurations.updatePaintArrays(t,s,this.layers,c))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,s){const c=this.lineVertexArray.length;if(t.segment!==void 0){let p=t.dist(s[t.segment+1]),v=t.dist(s[t.segment]);const x={};for(let w=t.segment+1;w<s.length;w++)x[w]={x:s[w].x,y:s[w].y,tileUnitDistanceFromAnchor:p},w<s.length-1&&(p+=s[w+1].dist(s[w]));for(let w=t.segment||0;w>=0;w--)x[w]={x:s[w].x,y:s[w].y,tileUnitDistanceFromAnchor:v},w>0&&(v+=s[w-1].dist(s[w]));for(let w=0;w<s.length;w++){const E=x[w];this.lineVertexArray.emplaceBack(E.x,E.y,E.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(t,s,c,p,v,x,w,E,I,L,O,$){const j=t.indexArray,G=t.layoutVertexArray,X=t.segments.prepareSegment(4*s.length,G,j,this.canOverlap?x.sortKey:void 0),ie=this.glyphOffsetArray.length,he=X.vertexLength,Ee=this.allowVerticalPlacement&&w===m.ah.vertical?Math.PI/2:0,fe=x.text&&x.text.sections;for(let xe=0;xe<s.length;xe++){const{tl:$e,tr:Ge,bl:Tt,br:zt,tex:Mt,pixelOffsetTL:vt,pixelOffsetBR:ot,minFontScaleX:Pt,minFontScaleY:gt,glyphOffset:Qe,isSDF:Wt,sectionIndex:Bt}=s[xe],vi=X.vertexLength,fr=Qe[1];md(G,E.x,E.y,$e.x,fr+$e.y,Mt.x,Mt.y,c,Wt,vt.x,vt.y,Pt,gt),md(G,E.x,E.y,Ge.x,fr+Ge.y,Mt.x+Mt.w,Mt.y,c,Wt,ot.x,vt.y,Pt,gt),md(G,E.x,E.y,Tt.x,fr+Tt.y,Mt.x,Mt.y+Mt.h,c,Wt,vt.x,ot.y,Pt,gt),md(G,E.x,E.y,zt.x,fr+zt.y,Mt.x+Mt.w,Mt.y+Mt.h,c,Wt,ot.x,ot.y,Pt,gt),lp(t.dynamicLayoutVertexArray,E,Ee),j.emplaceBack(vi,vi+1,vi+2),j.emplaceBack(vi+1,vi+2,vi+3),X.vertexLength+=4,X.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Qe[0]),xe!==s.length-1&&Bt===s[xe+1].sectionIndex||t.programConfigurations.populatePaintArrays(G.length,x,x.index,{},$,fe&&fe[Bt])}t.placedSymbolArray.emplaceBack(E.x,E.y,ie,this.glyphOffsetArray.length-ie,he,I,L,E.segment,c?c[0]:0,c?c[1]:0,p[0],p[1],w,0,!1,0,O)}_addCollisionDebugVertex(t,s,c,p,v,x){return s.emplaceBack(0,0),t.emplaceBack(c.x,c.y,p,v,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(t,s,c,p,v,x,w){const E=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),I=E.vertexLength,L=v.layoutVertexArray,O=v.collisionVertexArray,$=w.anchorX,j=w.anchorY;this._addCollisionDebugVertex(L,O,x,$,j,new D(t,s)),this._addCollisionDebugVertex(L,O,x,$,j,new D(c,s)),this._addCollisionDebugVertex(L,O,x,$,j,new D(c,p)),this._addCollisionDebugVertex(L,O,x,$,j,new D(t,p)),E.vertexLength+=4;const G=v.indexArray;G.emplaceBack(I,I+1),G.emplaceBack(I+1,I+2),G.emplaceBack(I+2,I+3),G.emplaceBack(I+3,I),E.primitiveLength+=4}addDebugCollisionBoxes(t,s,c,p){for(let v=t;v<s;v++){const x=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,p?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,c)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new up(Ae,zg.members,We),this.iconCollisionBox=new up(Ae,zg.members,We);for(let t=0;t<this.symbolInstances.length;t++){const s=this.symbolInstances.get(t);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}}_deserializeCollisionBoxesForSymbol(t,s,c,p,v,x,w,E,I){const L={};for(let O=s;O<c;O++){const $=t.get(O);L.textBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},L.textFeatureIndex=$.featureIndex;break}for(let O=p;O<v;O++){const $=t.get(O);L.verticalTextBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},L.verticalTextFeatureIndex=$.featureIndex;break}for(let O=x;O<w;O++){const $=t.get(O);L.iconBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},L.iconFeatureIndex=$.featureIndex;break}for(let O=E;O<I;O++){const $=t.get(O);L.verticalIconBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},L.verticalIconFeatureIndex=$.featureIndex;break}return L}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const c=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,s){const c=t.placedSymbolArray.get(s),p=c.vertexStartIndex+4*c.numGlyphs;for(let v=c.vertexStartIndex;v<p;v+=4)t.indexArray.emplaceBack(v,v+1,v+2),t.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(t),c=Math.cos(t),p=[],v=[],x=[];for(let w=0;w<this.symbolInstances.length;++w){x.push(w);const E=this.symbolInstances.get(w);p.push(0|Math.round(s*E.anchorX+c*E.anchorY)),v.push(E.featureIndex)}return x.sort((w,E)=>p[w]-p[E]||v[E]-v[w]),x}addToSortKeyRanges(t,s){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===s?c.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const c=this.symbolInstances.get(s);this.featureSortOrder.push(c.featureIndex),[c.rightJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.leftJustifiedTextSymbolIndex].forEach((p,v,x)=>{p>=0&&x.indexOf(p)===v&&this.addIndicesForPlacedSymbol(this.text,p)}),c.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,c.verticalPlacedTextSymbolIndex),c.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.placedIconSymbolIndex),c.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Jg,Qg;Et("SymbolBucket",Nc,{omit:["layers","collisionBoxArray","features","compareText"]}),Nc.MAX_GLYPHS=65535,Nc.addDynamicAttributes=lp;var hp={get paint(){return Qg=Qg||new Wn({"icon-opacity":new Kt(ce.paint_symbol["icon-opacity"]),"icon-color":new Kt(ce.paint_symbol["icon-color"]),"icon-halo-color":new Kt(ce.paint_symbol["icon-halo-color"]),"icon-halo-width":new Kt(ce.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Kt(ce.paint_symbol["icon-halo-blur"]),"icon-translate":new $t(ce.paint_symbol["icon-translate"]),"icon-translate-anchor":new $t(ce.paint_symbol["icon-translate-anchor"]),"text-opacity":new Kt(ce.paint_symbol["text-opacity"]),"text-color":new Kt(ce.paint_symbol["text-color"],{runtimeType:$i,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new Kt(ce.paint_symbol["text-halo-color"]),"text-halo-width":new Kt(ce.paint_symbol["text-halo-width"]),"text-halo-blur":new Kt(ce.paint_symbol["text-halo-blur"]),"text-translate":new $t(ce.paint_symbol["text-translate"]),"text-translate-anchor":new $t(ce.paint_symbol["text-translate-anchor"])})},get layout(){return Jg=Jg||new Wn({"symbol-placement":new $t(ce.layout_symbol["symbol-placement"]),"symbol-spacing":new $t(ce.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new $t(ce.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Kt(ce.layout_symbol["symbol-sort-key"]),"symbol-z-order":new $t(ce.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new $t(ce.layout_symbol["icon-allow-overlap"]),"icon-overlap":new $t(ce.layout_symbol["icon-overlap"]),"icon-ignore-placement":new $t(ce.layout_symbol["icon-ignore-placement"]),"icon-optional":new $t(ce.layout_symbol["icon-optional"]),"icon-rotation-alignment":new $t(ce.layout_symbol["icon-rotation-alignment"]),"icon-size":new Kt(ce.layout_symbol["icon-size"]),"icon-text-fit":new $t(ce.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new $t(ce.layout_symbol["icon-text-fit-padding"]),"icon-image":new Kt(ce.layout_symbol["icon-image"]),"icon-rotate":new Kt(ce.layout_symbol["icon-rotate"]),"icon-padding":new Kt(ce.layout_symbol["icon-padding"]),"icon-keep-upright":new $t(ce.layout_symbol["icon-keep-upright"]),"icon-offset":new Kt(ce.layout_symbol["icon-offset"]),"icon-anchor":new Kt(ce.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new $t(ce.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new $t(ce.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new $t(ce.layout_symbol["text-rotation-alignment"]),"text-field":new Kt(ce.layout_symbol["text-field"]),"text-font":new Kt(ce.layout_symbol["text-font"]),"text-size":new Kt(ce.layout_symbol["text-size"]),"text-max-width":new Kt(ce.layout_symbol["text-max-width"]),"text-line-height":new $t(ce.layout_symbol["text-line-height"]),"text-letter-spacing":new Kt(ce.layout_symbol["text-letter-spacing"]),"text-justify":new Kt(ce.layout_symbol["text-justify"]),"text-radial-offset":new Kt(ce.layout_symbol["text-radial-offset"]),"text-variable-anchor":new $t(ce.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Kt(ce.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Kt(ce.layout_symbol["text-anchor"]),"text-max-angle":new $t(ce.layout_symbol["text-max-angle"]),"text-writing-mode":new $t(ce.layout_symbol["text-writing-mode"]),"text-rotate":new Kt(ce.layout_symbol["text-rotate"]),"text-padding":new $t(ce.layout_symbol["text-padding"]),"text-keep-upright":new $t(ce.layout_symbol["text-keep-upright"]),"text-transform":new Kt(ce.layout_symbol["text-transform"]),"text-offset":new Kt(ce.layout_symbol["text-offset"]),"text-allow-overlap":new $t(ce.layout_symbol["text-allow-overlap"]),"text-overlap":new $t(ce.layout_symbol["text-overlap"]),"text-ignore-placement":new $t(ce.layout_symbol["text-ignore-placement"]),"text-optional":new $t(ce.layout_symbol["text-optional"])})}};class ey{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:wr,this.defaultValue=t}evaluate(t){if(t.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(t.formattedSection))return s.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Et("FormatSectionOverride",ey,{omit:["defaultValue"]});class gd extends $s{constructor(t){super(t,hp)}recalculate(t,s){if(super.recalculate(t,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const c=this.layout.get("text-writing-mode");if(c){const p=[];for(const v of c)p.indexOf(v)<0&&p.push(v);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,s,c,p){const v=this.layout.get(t).evaluate(s,{},c,p),x=this._unevaluatedLayout._values[t];return x.isDataDriven()||Wi(x.value)||!v?v:function(w,E){return E.replace(/{([^{}]+)}/g,(I,L)=>w&&L in w?String(w[L]):"")}(s.properties,v)}createBucket(t){return new Nc(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of hp.paint.overridableProperties){if(!gd.hasPaintOverride(this.layout,t))continue;const s=this.paint.get(t),c=new ey(s),p=new zi(c,s.property.specification);let v=null;v=s.value.kind==="constant"||s.value.kind==="source"?new Js("source",p):new Zo("composite",p,s.value.zoomStops),this.paint._values[t]=new Ns(s.property,v,s.parameters)}}_handleOverridablePaintPropertyUpdate(t,s,c){return!(!this.layout||s.isDataDriven()||c.isDataDriven())&&gd.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,s){const c=t.get("text-field"),p=hp.paint.properties[s];let v=!1;const x=w=>{for(const E of w)if(p.overrides&&p.overrides.hasOverride(E))return void(v=!0)};if(c.value.kind==="constant"&&c.value.value instanceof An)x(c.value.value.sections);else if(c.value.kind==="source"){const w=I=>{v||(I instanceof Xs&&Dr(I.value)===Mr?x(I.value.sections):I instanceof Vo?x(I.sections):I.eachChild(w))},E=c.value;E._styleExpression&&w(E._styleExpression.expression)}return v}}let ty;var yb={get paint(){return ty=ty||new Wn({"background-color":new $t(ce.paint_background["background-color"]),"background-pattern":new jl(ce.paint_background["background-pattern"]),"background-opacity":new $t(ce.paint_background["background-opacity"])})}};class _b extends $s{constructor(t){super(t,yb)}}let iy;var vb={get paint(){return iy=iy||new Wn({"raster-opacity":new $t(ce.paint_raster["raster-opacity"]),"raster-hue-rotate":new $t(ce.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new $t(ce.paint_raster["raster-brightness-min"]),"raster-brightness-max":new $t(ce.paint_raster["raster-brightness-max"]),"raster-saturation":new $t(ce.paint_raster["raster-saturation"]),"raster-contrast":new $t(ce.paint_raster["raster-contrast"]),"raster-resampling":new $t(ce.paint_raster["raster-resampling"]),"raster-fade-duration":new $t(ce.paint_raster["raster-fade-duration"])})}};class xb extends $s{constructor(t){super(t,vb)}}class bb extends $s{constructor(t){super(t,{}),this.onAdd=s=>{this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},this.onRemove=s=>{this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class wb{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const dp=63710088e-1;class sl{constructor(t,s){if(isNaN(t)||isNaN(s))throw new Error(`Invalid LngLat object: (${t}, ${s})`);if(this.lng=+t,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new sl(Je(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const s=Math.PI/180,c=this.lat*s,p=t.lat*s,v=Math.sin(c)*Math.sin(p)+Math.cos(c)*Math.cos(p)*Math.cos((t.lng-this.lng)*s);return dp*Math.acos(Math.min(v,1))}static convert(t){if(t instanceof sl)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new sl(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new sl(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const ry=2*Math.PI*dp;function ny(n){return ry*Math.cos(n*Math.PI/180)}function sy(n){return(180+n)/360}function ay(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function oy(n,t){return n/ny(t)}function fp(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}class yd{constructor(t,s,c=0){this.x=+t,this.y=+s,this.z=+c}static fromLngLat(t,s=0){const c=sl.convert(t);return new yd(sy(c.lng),ay(c.lat),oy(s,c.lat))}toLngLat(){return new sl(360*this.x-180,fp(this.y))}toAltitude(){return this.z*ny(fp(this.y))}meterInMercatorCoordinateUnits(){return 1/ry*(t=fp(this.y),1/Math.cos(t*Math.PI/180));var t}}function ly(n,t,s){var c=2*Math.PI*6378137/256/Math.pow(2,s);return[n*c-2*Math.PI*6378137/2,t*c-2*Math.PI*6378137/2]}class pp{constructor(t,s,c){if(t<0||t>25||c<0||c>=Math.pow(2,t)||s<0||s>=Math.pow(2,t))throw new Error(`x=${s}, y=${c}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=s,this.y=c,this.key=Wu(0,t,t,s,c)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,s,c){const p=(x=this.y,w=this.z,E=ly(256*(v=this.x),256*(x=Math.pow(2,w)-x-1),w),I=ly(256*(v+1),256*(x+1),w),E[0]+","+E[1]+","+I[0]+","+I[1]);var v,x,w,E,I;const L=function(O,$,j){let G,X="";for(let ie=O;ie>0;ie--)G=1<<ie-1,X+=($&G?1:0)+(j&G?2:0);return X}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(c==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,s>1?"@2x":"").replace(/{quadkey}/g,L).replace(/{bbox-epsg-3857}/g,p)}isChildOf(t){const s=this.z-t.z;return s>0&&t.x===this.x>>s&&t.y===this.y>>s}getTilePoint(t){const s=Math.pow(2,this.z);return new D((t.x*s-this.x)*Br,(t.y*s-this.y)*Br)}toString(){return`${this.z}/${this.x}/${this.y}`}}class cy{constructor(t,s){this.wrap=t,this.canonical=s,this.key=Wu(t,s.z,s.z,s.x,s.y)}}class Vs{constructor(t,s,c,p,v){if(t<c)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${c}`);this.overscaledZ=t,this.wrap=s,this.canonical=new pp(c,+p,+v),this.key=Wu(s,t,c,p,v)}clone(){return new Vs(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-t;return t>this.canonical.z?new Vs(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Vs(t,this.wrap,t,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(t,s){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-t;return t>this.canonical.z?Wu(this.wrap*+s,t,this.canonical.z,this.canonical.x,this.canonical.y):Wu(this.wrap*+s,t,t,this.canonical.x>>c,this.canonical.y>>c)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const s=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>s&&t.canonical.y===this.canonical.y>>s}children(t){if(this.overscaledZ>=t)return[new Vs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,c=2*this.canonical.x,p=2*this.canonical.y;return[new Vs(s,this.wrap,s,c,p),new Vs(s,this.wrap,s,c+1,p),new Vs(s,this.wrap,s,c,p+1),new Vs(s,this.wrap,s,c+1,p+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Vs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Vs(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new cy(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new yd(t.x-this.wrap,t.y))}}function Wu(n,t,s,c,p){(n*=2)<0&&(n=-1*n-1);const v=1<<s;return(v*v*n+v*p+c).toString(36)+s.toString(36)+t.toString(36)}Et("CanonicalTileID",pp),Et("OverscaledTileID",Vs,{omit:["posMatrix"]});class uy{constructor(t,s,c,p=1,v=1,x=1,w=0){if(this.uid=t,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(c&&!["mapbox","terrarium","custom"].includes(c))return void xi(`"${c}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=s.height;const E=this.dim=s.height-2;switch(this.data=new Uint32Array(s.data.buffer),c){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=p,this.greenFactor=v,this.blueFactor=x,this.baseShift=w;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let I=0;I<E;I++)this.data[this._idx(-1,I)]=this.data[this._idx(0,I)],this.data[this._idx(E,I)]=this.data[this._idx(E-1,I)],this.data[this._idx(I,-1)]=this.data[this._idx(I,0)],this.data[this._idx(I,E)]=this.data[this._idx(I,E-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(E,-1)]=this.data[this._idx(E-1,0)],this.data[this._idx(-1,E)]=this.data[this._idx(0,E-1)],this.data[this._idx(E,E)]=this.data[this._idx(E-1,E-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let I=0;I<E;I++)for(let L=0;L<E;L++){const O=this.get(I,L);O>this.max&&(this.max=O),O<this.min&&(this.min=O)}}get(t,s){const c=new Uint8Array(this.data.buffer),p=4*this._idx(t,s);return this.unpack(c[p],c[p+1],c[p+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,s){if(t<-1||t>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(t+1)}unpack(t,s,c){return t*this.redFactor+s*this.greenFactor+c*this.blueFactor-this.baseShift}getPixels(){return new Us({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,s,c){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let p=s*this.dim,v=s*this.dim+this.dim,x=c*this.dim,w=c*this.dim+this.dim;switch(s){case-1:p=v-1;break;case 1:v=p+1}switch(c){case-1:x=w-1;break;case 1:w=x+1}const E=-s*this.dim,I=-c*this.dim;for(let L=x;L<w;L++)for(let O=p;O<v;O++)this.data[this._idx(O,L)]=t.data[this._idx(O+E,L+I)]}}Et("DEMData",uy);class hy{constructor(t){this._stringToNumber={},this._numberToString=[];for(let s=0;s<t.length;s++){const c=t[s];this._stringToNumber[c]=s,this._numberToString[s]=c}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class dy{constructor(t,s,c,p,v){this.type="Feature",this._vectorTileFeature=t,t._z=s,t._x=c,t._y=p,this.properties=t.properties,this.id=v}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(t[s]=this[s]);return t}}class fy{constructor(t,s){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new zn(Br,16,0),this.grid3D=new zn(Br,16,0),this.featureIndexArray=new F,this.promoteId=s}insert(t,s,c,p,v,x){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,p,v);const E=x?this.grid3D:this.grid;for(let I=0;I<s.length;I++){const L=s[I],O=[1/0,1/0,-1/0,-1/0];for(let $=0;$<L.length;$++){const j=L[$];O[0]=Math.min(O[0],j.x),O[1]=Math.min(O[1],j.y),O[2]=Math.max(O[2],j.x),O[3]=Math.max(O[3],j.y)}O[0]<Br&&O[1]<Br&&O[2]>=0&&O[3]>=0&&E.insert(w,O[0],O[1],O[2],O[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new il.VectorTile(new ip(this.rawTileData)).layers,this.sourceLayerCoder=new hy(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,s,c,p){this.loadVTLayers();const v=t.params||{},x=Br/t.tileSize/t.scale,w=ga(v.filter),E=t.queryGeometry,I=t.queryPadding*x,L=my(E),O=this.grid.query(L.minX-I,L.minY-I,L.maxX+I,L.maxY+I),$=my(t.cameraQueryGeometry),j=this.grid3D.query($.minX-I,$.minY-I,$.maxX+I,$.maxY+I,(ie,he,Ee,fe)=>function(xe,$e,Ge,Tt,zt){for(const vt of xe)if($e<=vt.x&&Ge<=vt.y&&Tt>=vt.x&&zt>=vt.y)return!0;const Mt=[new D($e,Ge),new D($e,zt),new D(Tt,zt),new D(Tt,Ge)];if(xe.length>2){for(const vt of Mt)if(kc(xe,vt))return!0}for(let vt=0;vt<xe.length-1;vt++)if(e1(xe[vt],xe[vt+1],Mt))return!0;return!1}(t.cameraQueryGeometry,ie-I,he-I,Ee+I,fe+I));for(const ie of j)O.push(ie);O.sort(Mb);const G={};let X;for(let ie=0;ie<O.length;ie++){const he=O[ie];if(he===X)continue;X=he;const Ee=this.featureIndexArray.get(he);let fe=null;this.loadMatchingFeature(G,Ee.bucketIndex,Ee.sourceLayerIndex,Ee.featureIndex,w,v.layers,v.availableImages,s,c,p,(xe,$e,Ge)=>(fe||(fe=vo(xe)),$e.queryIntersectsFeature(E,xe,Ge,fe,this.z,t.transform,x,t.pixelPosMatrix)))}return G}loadMatchingFeature(t,s,c,p,v,x,w,E,I,L,O){const $=this.bucketLayerIDs[s];if(x&&!function(ie,he){for(let Ee=0;Ee<ie.length;Ee++)if(he.indexOf(ie[Ee])>=0)return!0;return!1}(x,$))return;const j=this.sourceLayerCoder.decode(c),G=this.vtLayers[j].feature(p);if(v.needGeometry){const ie=xo(G,!0);if(!v.filter(new gr(this.tileID.overscaledZ),ie,this.tileID.canonical))return}else if(!v.filter(new gr(this.tileID.overscaledZ),G))return;const X=this.getId(G,j);for(let ie=0;ie<$.length;ie++){const he=$[ie];if(x&&x.indexOf(he)<0)continue;const Ee=E[he];if(!Ee)continue;let fe={};X&&L&&(fe=L.getState(Ee.sourceLayer||"_geojsonTileLayer",X));const xe=dt({},I[he]);xe.paint=py(xe.paint,Ee.paint,G,fe,w),xe.layout=py(xe.layout,Ee.layout,G,fe,w);const $e=!O||O(G,Ee,fe);if(!$e)continue;const Ge=new dy(G,this.z,this.x,this.y,X);Ge.layer=xe;let Tt=t[he];Tt===void 0&&(Tt=t[he]=[]),Tt.push({featureIndex:p,feature:Ge,intersectionZ:$e})}}lookupSymbolFeatures(t,s,c,p,v,x,w,E){const I={};this.loadVTLayers();const L=ga(v);for(const O of t)this.loadMatchingFeature(I,c,p,O,L,x,w,E,s);return I}hasLayer(t){for(const s of this.bucketLayerIDs)for(const c of s)if(t===c)return!0;return!1}getId(t,s){let c=t.id;return this.promoteId&&(c=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]],typeof c=="boolean"&&(c=Number(c))),c}}function py(n,t,s,c,p){return xt(n,(v,x)=>{const w=t instanceof Vl?t.get(x):null;return w&&w.evaluate?w.evaluate(s,c,p):w})}function my(n){let t=1/0,s=1/0,c=-1/0,p=-1/0;for(const v of n)t=Math.min(t,v.x),s=Math.min(s,v.y),c=Math.max(c,v.x),p=Math.max(p,v.y);return{minX:t,minY:s,maxX:c,maxY:p}}function Mb(n,t){return t-n}function gy(n,t,s,c,p){const v=[];for(let x=0;x<n.length;x++){const w=n[x];let E;for(let I=0;I<w.length-1;I++){let L=w[I],O=w[I+1];L.x<t&&O.x<t||(L.x<t?L=new D(t,L.y+(t-L.x)/(O.x-L.x)*(O.y-L.y))._round():O.x<t&&(O=new D(t,L.y+(t-L.x)/(O.x-L.x)*(O.y-L.y))._round()),L.y<s&&O.y<s||(L.y<s?L=new D(L.x+(s-L.y)/(O.y-L.y)*(O.x-L.x),s)._round():O.y<s&&(O=new D(L.x+(s-L.y)/(O.y-L.y)*(O.x-L.x),s)._round()),L.x>=c&&O.x>=c||(L.x>=c?L=new D(c,L.y+(c-L.x)/(O.x-L.x)*(O.y-L.y))._round():O.x>=c&&(O=new D(c,L.y+(c-L.x)/(O.x-L.x)*(O.y-L.y))._round()),L.y>=p&&O.y>=p||(L.y>=p?L=new D(L.x+(p-L.y)/(O.y-L.y)*(O.x-L.x),p)._round():O.y>=p&&(O=new D(L.x+(p-L.y)/(O.y-L.y)*(O.x-L.x),p)._round()),E&&L.equals(E[E.length-1])||(E=[L],v.push(E)),E.push(O)))))}}return v}Et("FeatureIndex",fy,{omit:["rawTileData","sourceLayerCoder"]});class al extends D{constructor(t,s,c,p){super(t,s),this.angle=c,p!==void 0&&(this.segment=p)}clone(){return new al(this.x,this.y,this.angle,this.segment)}}function yy(n,t,s,c,p){if(t.segment===void 0||s===0)return!0;let v=t,x=t.segment+1,w=0;for(;w>-s/2;){if(x--,x<0)return!1;w-=n[x].dist(v),v=n[x]}w+=n[x].dist(n[x+1]),x++;const E=[];let I=0;for(;w<s/2;){const L=n[x],O=n[x+1];if(!O)return!1;let $=n[x-1].angleTo(L)-L.angleTo(O);for($=Math.abs(($+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:w,angleDelta:$}),I+=$;w-E[0].distance>c;)I-=E.shift().angleDelta;if(I>p)return!1;x++,w+=L.dist(O)}return!0}function _y(n){let t=0;for(let s=0;s<n.length-1;s++)t+=n[s].dist(n[s+1]);return t}function vy(n,t,s){return n?.6*t*s:0}function xy(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function Sb(n,t,s,c,p,v){const x=vy(s,p,v),w=xy(s,c)*v;let E=0;const I=_y(n)/2;for(let L=0;L<n.length-1;L++){const O=n[L],$=n[L+1],j=O.dist($);if(E+j>I){const G=(I-E)/j,X=dn.number(O.x,$.x,G),ie=dn.number(O.y,$.y,G),he=new al(X,ie,$.angleTo(O),L);return he._round(),!x||yy(n,he,w,x,t)?he:void 0}E+=j}}function Eb(n,t,s,c,p,v,x,w,E){const I=vy(c,v,x),L=xy(c,p),O=L*x,$=n[0].x===0||n[0].x===E||n[0].y===0||n[0].y===E;return t-O<t/4&&(t=O+t/4),by(n,$?t/2*w%t:(L/2+2*v)*x*w%t,t,I,s,O,$,!1,E)}function by(n,t,s,c,p,v,x,w,E){const I=v/2,L=_y(n);let O=0,$=t-s,j=[];for(let G=0;G<n.length-1;G++){const X=n[G],ie=n[G+1],he=X.dist(ie),Ee=ie.angleTo(X);for(;$+s<O+he;){$+=s;const fe=($-O)/he,xe=dn.number(X.x,ie.x,fe),$e=dn.number(X.y,ie.y,fe);if(xe>=0&&xe<E&&$e>=0&&$e<E&&$-I>=0&&$+I<=L){const Ge=new al(xe,$e,Ee,G);Ge._round(),c&&!yy(n,Ge,v,c,p)||j.push(Ge)}}O+=he}return w||j.length||x||(j=by(n,O/2,s,c,p,v,x,!0,E)),j}Et("Anchor",al);const $c=ls;function wy(n,t,s,c){const p=[],v=n.image,x=v.pixelRatio,w=v.paddedRect.w-2*$c,E=v.paddedRect.h-2*$c,I=n.right-n.left,L=n.bottom-n.top,O=v.stretchX||[[0,w]],$=v.stretchY||[[0,E]],j=(ot,Pt)=>ot+Pt[1]-Pt[0],G=O.reduce(j,0),X=$.reduce(j,0),ie=w-G,he=E-X;let Ee=0,fe=G,xe=0,$e=X,Ge=0,Tt=ie,zt=0,Mt=he;if(v.content&&c){const ot=v.content;Ee=_d(O,0,ot[0]),xe=_d($,0,ot[1]),fe=_d(O,ot[0],ot[2]),$e=_d($,ot[1],ot[3]),Ge=ot[0]-Ee,zt=ot[1]-xe,Tt=ot[2]-ot[0]-fe,Mt=ot[3]-ot[1]-$e}const vt=(ot,Pt,gt,Qe)=>{const Wt=vd(ot.stretch-Ee,fe,I,n.left),Bt=xd(ot.fixed-Ge,Tt,ot.stretch,G),vi=vd(Pt.stretch-xe,$e,L,n.top),fr=xd(Pt.fixed-zt,Mt,Pt.stretch,X),_r=vd(gt.stretch-Ee,fe,I,n.left),an=xd(gt.fixed-Ge,Tt,gt.stretch,G),Ts=vd(Qe.stretch-xe,$e,L,n.top),Kn=xd(Qe.fixed-zt,Mt,Qe.stretch,X),Yr=new D(Wt,vi),Sn=new D(_r,vi),Dn=new D(_r,Ts),Yn=new D(Wt,Ts),Jn=new D(Bt/x,fr/x),on=new D(an/x,Kn/x),ln=t*Math.PI/180;if(ln){const Fn=Math.sin(ln),cs=Math.cos(ln),us=[cs,-Fn,Fn,cs];Yr._matMult(us),Sn._matMult(us),Yn._matMult(us),Dn._matMult(us)}const On=ot.stretch+ot.fixed,Qn=Pt.stretch+Pt.fixed;return{tl:Yr,tr:Sn,bl:Yn,br:Dn,tex:{x:v.paddedRect.x+$c+On,y:v.paddedRect.y+$c+Qn,w:gt.stretch+gt.fixed-On,h:Qe.stretch+Qe.fixed-Qn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Jn,pixelOffsetBR:on,minFontScaleX:Tt/x/I,minFontScaleY:Mt/x/L,isSDF:s}};if(c&&(v.stretchX||v.stretchY)){const ot=My(O,ie,G),Pt=My($,he,X);for(let gt=0;gt<ot.length-1;gt++){const Qe=ot[gt],Wt=ot[gt+1];for(let Bt=0;Bt<Pt.length-1;Bt++)p.push(vt(Qe,Pt[Bt],Wt,Pt[Bt+1]))}}else p.push(vt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:E+1}));return p}function _d(n,t,s){let c=0;for(const p of n)c+=Math.max(t,Math.min(s,p[1]))-Math.max(t,Math.min(s,p[0]));return c}function My(n,t,s){const c=[{fixed:-$c,stretch:0}];for(const[p,v]of n){const x=c[c.length-1];c.push({fixed:p-x.stretch,stretch:x.stretch}),c.push({fixed:p-x.stretch,stretch:x.stretch+(v-p)})}return c.push({fixed:t+$c,stretch:s}),c}function vd(n,t,s,c){return n/t*s+c}function xd(n,t,s,c){return n-t*s/c}class bd{constructor(t,s,c,p,v,x,w,E,I,L){if(this.boxStartIndex=t.length,I){let O=x.top,$=x.bottom;const j=x.collisionPadding;j&&(O-=j[1],$+=j[3]);let G=$-O;G>0&&(G=Math.max(10,G),this.circleDiameter=G)}else{let O=x.top*w-E[0],$=x.bottom*w+E[2],j=x.left*w-E[3],G=x.right*w+E[1];const X=x.collisionPadding;if(X&&(j-=X[0]*w,O-=X[1]*w,G+=X[2]*w,$+=X[3]*w),L){const ie=new D(j,O),he=new D(G,O),Ee=new D(j,$),fe=new D(G,$),xe=L*Math.PI/180;ie._rotate(xe),he._rotate(xe),Ee._rotate(xe),fe._rotate(xe),j=Math.min(ie.x,he.x,Ee.x,fe.x),G=Math.max(ie.x,he.x,Ee.x,fe.x),O=Math.min(ie.y,he.y,Ee.y,fe.y),$=Math.max(ie.y,he.y,Ee.y,fe.y)}t.emplaceBack(s.x,s.y,j,O,G,$,c,p,v)}this.boxEndIndex=t.length}}class Tb{constructor(t=[],s=Cb){if(this.data=t,this.length=this.data.length,this.compare=s,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:s,compare:c}=this,p=s[t];for(;t>0;){const v=t-1>>1,x=s[v];if(c(p,x)>=0)break;s[t]=x,t=v}s[t]=p}_down(t){const{data:s,compare:c}=this,p=this.length>>1,v=s[t];for(;t<p;){let x=1+(t<<1),w=s[x];const E=x+1;if(E<this.length&&c(s[E],w)<0&&(x=E,w=s[E]),c(w,v)>=0)break;s[t]=w,t=x}s[t]=v}}function Cb(n,t){return n<t?-1:n>t?1:0}function Ib(n,t=1,s=!1){let c=1/0,p=1/0,v=-1/0,x=-1/0;const w=n[0];for(let j=0;j<w.length;j++){const G=w[j];(!j||G.x<c)&&(c=G.x),(!j||G.y<p)&&(p=G.y),(!j||G.x>v)&&(v=G.x),(!j||G.y>x)&&(x=G.y)}const E=Math.min(v-c,x-p);let I=E/2;const L=new Tb([],Ab);if(E===0)return new D(c,p);for(let j=c;j<v;j+=E)for(let G=p;G<x;G+=E)L.push(new Uc(j+I,G+I,I,n));let O=function(j){let G=0,X=0,ie=0;const he=j[0];for(let Ee=0,fe=he.length,xe=fe-1;Ee<fe;xe=Ee++){const $e=he[Ee],Ge=he[xe],Tt=$e.x*Ge.y-Ge.x*$e.y;X+=($e.x+Ge.x)*Tt,ie+=($e.y+Ge.y)*Tt,G+=3*Tt}return new Uc(X/G,ie/G,0,j)}(n),$=L.length;for(;L.length;){const j=L.pop();(j.d>O.d||!O.d)&&(O=j,s&&console.log("found best %d after %d probes",Math.round(1e4*j.d)/1e4,$)),j.max-O.d<=t||(I=j.h/2,L.push(new Uc(j.p.x-I,j.p.y-I,I,n)),L.push(new Uc(j.p.x+I,j.p.y-I,I,n)),L.push(new Uc(j.p.x-I,j.p.y+I,I,n)),L.push(new Uc(j.p.x+I,j.p.y+I,I,n)),$+=4)}return s&&(console.log(`num probes: ${$}`),console.log(`best distance: ${O.d}`)),O.p}function Ab(n,t){return t.max-n.max}function Uc(n,t,s,c){this.p=new D(n,t),this.h=s,this.d=function(p,v){let x=!1,w=1/0;for(let E=0;E<v.length;E++){const I=v[E];for(let L=0,O=I.length,$=O-1;L<O;$=L++){const j=I[L],G=I[$];j.y>p.y!=G.y>p.y&&p.x<(G.x-j.x)*(p.y-j.y)/(G.y-j.y)+j.x&&(x=!x),w=Math.min(w,ag(p,j,G))}}return(x?1:-1)*Math.sqrt(w)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}var Pn;m.ap=void 0,(Pn=m.ap||(m.ap={}))[Pn.center=1]="center",Pn[Pn.left=2]="left",Pn[Pn.right=3]="right",Pn[Pn.top=4]="top",Pn[Pn.bottom=5]="bottom",Pn[Pn["top-left"]=6]="top-left",Pn[Pn["top-right"]=7]="top-right",Pn[Pn["bottom-left"]=8]="bottom-left",Pn[Pn["bottom-right"]=9]="bottom-right";const ol=7,mp=Number.POSITIVE_INFINITY;function Sy(n,t){return t[1]!==mp?function(s,c,p){let v=0,x=0;switch(c=Math.abs(c),p=Math.abs(p),s){case"top-right":case"top-left":case"top":x=p-ol;break;case"bottom-right":case"bottom-left":case"bottom":x=-p+ol}switch(s){case"top-right":case"bottom-right":case"right":v=-c;break;case"top-left":case"bottom-left":case"left":v=c}return[v,x]}(n,t[0],t[1]):function(s,c){let p=0,v=0;c<0&&(c=0);const x=c/Math.SQRT2;switch(s){case"top-right":case"top-left":v=x-ol;break;case"bottom-right":case"bottom-left":v=-x+ol;break;case"bottom":v=-c+ol;break;case"top":v=c-ol}switch(s){case"top-right":case"bottom-right":p=-x;break;case"top-left":case"bottom-left":p=x;break;case"left":p=c;break;case"right":p=-c}return[p,v]}(n,t[0])}function Ey(n,t,s){var c;const p=n.layout,v=(c=p.get("text-variable-anchor-offset"))===null||c===void 0?void 0:c.evaluate(t,{},s);if(v){const w=v.values,E=[];for(let I=0;I<w.length;I+=2){const L=E[I]=w[I],O=w[I+1].map($=>$*sn);L.startsWith("top")?O[1]-=ol:L.startsWith("bottom")&&(O[1]+=ol),E[I+1]=O}return new Pr(E)}const x=p.get("text-variable-anchor");if(x){let w;w=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[p.get("text-radial-offset").evaluate(t,{},s)*sn,mp]:p.get("text-offset").evaluate(t,{},s).map(I=>I*sn);const E=[];for(const I of x)E.push(I,Sy(I,w));return new Pr(E)}return null}function gp(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Pb(n,t,s,c,p,v,x,w,E,I,L){let O=v.textMaxSize.evaluate(t,{});O===void 0&&(O=x);const $=n.layers[0].layout,j=$.get("icon-offset").evaluate(t,{},L),G=Cy(s.horizontal),X=x/24,ie=n.tilePixelRatio*X,he=n.tilePixelRatio*O/24,Ee=n.tilePixelRatio*w,fe=n.tilePixelRatio*$.get("symbol-spacing"),xe=$.get("text-padding")*n.tilePixelRatio,$e=function(Qe,Wt,Bt,vi=1){const fr=Qe.get("icon-padding").evaluate(Wt,{},Bt),_r=fr&&fr.values;return[_r[0]*vi,_r[1]*vi,_r[2]*vi,_r[3]*vi]}($,t,L,n.tilePixelRatio),Ge=$.get("text-max-angle")/180*Math.PI,Tt=$.get("text-rotation-alignment")!=="viewport"&&$.get("symbol-placement")!=="point",zt=$.get("icon-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",Mt=$.get("symbol-placement"),vt=fe/2,ot=$.get("icon-text-fit");let Pt;c&&ot!=="none"&&(n.allowVerticalPlacement&&s.vertical&&(Pt=Kg(c,s.vertical,ot,$.get("icon-text-fit-padding"),j,X)),G&&(c=Kg(c,G,ot,$.get("icon-text-fit-padding"),j,X)));const gt=(Qe,Wt)=>{Wt.x<0||Wt.x>=Br||Wt.y<0||Wt.y>=Br||function(Bt,vi,fr,_r,an,Ts,Kn,Yr,Sn,Dn,Yn,Jn,on,ln,On,Qn,Fn,cs,us,cn,Ti,Bn,kn,un,ra){const Ma=Bt.addToLineVertexArray(vi,fr);let Sa,wo,na,js,hs=0,Mo=0,Yu=0,Dy=0,Sp=-1,Ep=-1;const So={};let ky=Rr("");if(Bt.allowVerticalPlacement&&_r.vertical){const Nn=Yr.layout.get("text-rotate").evaluate(Ti,{},un)+90;na=new bd(Sn,vi,Dn,Yn,Jn,_r.vertical,on,ln,On,Nn),Kn&&(js=new bd(Sn,vi,Dn,Yn,Jn,Kn,Fn,cs,On,Nn))}if(an){const Nn=Yr.layout.get("icon-rotate").evaluate(Ti,{}),qs=Yr.layout.get("icon-text-fit")!=="none",Yl=wy(an,Nn,kn,qs),Ta=Kn?wy(Kn,Nn,kn,qs):void 0;wo=new bd(Sn,vi,Dn,Yn,Jn,an,Fn,cs,!1,Nn),hs=4*Yl.length;const Jl=Bt.iconSizeData;let Za=null;Jl.kind==="source"?(Za=[Ha*Yr.layout.get("icon-size").evaluate(Ti,{})],Za[0]>nl&&xi(`${Bt.layerIds[0]}: Value for "icon-size" is >= ${Zu}. Reduce your "icon-size".`)):Jl.kind==="composite"&&(Za=[Ha*Bn.compositeIconSizes[0].evaluate(Ti,{},un),Ha*Bn.compositeIconSizes[1].evaluate(Ti,{},un)],(Za[0]>nl||Za[1]>nl)&&xi(`${Bt.layerIds[0]}: Value for "icon-size" is >= ${Zu}. Reduce your "icon-size".`)),Bt.addSymbols(Bt.icon,Yl,Za,cn,us,Ti,m.ah.none,vi,Ma.lineStartIndex,Ma.lineLength,-1,un),Sp=Bt.icon.placedSymbolArray.length-1,Ta&&(Mo=4*Ta.length,Bt.addSymbols(Bt.icon,Ta,Za,cn,us,Ti,m.ah.vertical,vi,Ma.lineStartIndex,Ma.lineLength,-1,un),Ep=Bt.icon.placedSymbolArray.length-1)}const Ly=Object.keys(_r.horizontal);for(const Nn of Ly){const qs=_r.horizontal[Nn];if(!Sa){ky=Rr(qs.text);const Ta=Yr.layout.get("text-rotate").evaluate(Ti,{},un);Sa=new bd(Sn,vi,Dn,Yn,Jn,qs,on,ln,On,Ta)}const Yl=qs.positionedLines.length===1;if(Yu+=Ty(Bt,vi,qs,Ts,Yr,On,Ti,Qn,Ma,_r.vertical?m.ah.horizontal:m.ah.horizontalOnly,Yl?Ly:[Nn],So,Sp,Bn,un),Yl)break}_r.vertical&&(Dy+=Ty(Bt,vi,_r.vertical,Ts,Yr,On,Ti,Qn,Ma,m.ah.vertical,["vertical"],So,Ep,Bn,un));const Lb=Sa?Sa.boxStartIndex:Bt.collisionBoxArray.length,Rb=Sa?Sa.boxEndIndex:Bt.collisionBoxArray.length,zb=na?na.boxStartIndex:Bt.collisionBoxArray.length,Ob=na?na.boxEndIndex:Bt.collisionBoxArray.length,Fb=wo?wo.boxStartIndex:Bt.collisionBoxArray.length,Bb=wo?wo.boxEndIndex:Bt.collisionBoxArray.length,Nb=js?js.boxStartIndex:Bt.collisionBoxArray.length,$b=js?js.boxEndIndex:Bt.collisionBoxArray.length;let Ea=-1;const Md=(Nn,qs)=>Nn&&Nn.circleDiameter?Math.max(Nn.circleDiameter,qs):qs;Ea=Md(Sa,Ea),Ea=Md(na,Ea),Ea=Md(wo,Ea),Ea=Md(js,Ea);const Ry=Ea>-1?1:0;Ry&&(Ea*=ra/sn),Bt.glyphOffsetArray.length>=Nc.MAX_GLYPHS&&xi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ti.sortKey!==void 0&&Bt.addToSortKeyRanges(Bt.symbolInstances.length,Ti.sortKey);const Ub=Ey(Yr,Ti,un),[Vb,jb]=function(Nn,qs){const Yl=Nn.length,Ta=qs==null?void 0:qs.values;if((Ta==null?void 0:Ta.length)>0)for(let Jl=0;Jl<Ta.length;Jl+=2){const Za=Ta[Jl+1];Nn.emplaceBack(m.ap[Ta[Jl]],Za[0],Za[1])}return[Yl,Nn.length]}(Bt.textAnchorOffsets,Ub);Bt.symbolInstances.emplaceBack(vi.x,vi.y,So.right>=0?So.right:-1,So.center>=0?So.center:-1,So.left>=0?So.left:-1,So.vertical||-1,Sp,Ep,ky,Lb,Rb,zb,Ob,Fb,Bb,Nb,$b,Dn,Yu,Dy,hs,Mo,Ry,0,on,Ea,Vb,jb)}(n,Wt,Qe,s,c,p,Pt,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,ie,[xe,xe,xe,xe],Tt,E,Ee,$e,zt,j,t,v,I,L,x)};if(Mt==="line")for(const Qe of gy(t.geometry,0,0,Br,Br)){const Wt=Eb(Qe,fe,Ge,s.vertical||G,c,24,he,n.overscaling,Br);for(const Bt of Wt)G&&Db(n,G.text,vt,Bt)||gt(Qe,Bt)}else if(Mt==="line-center"){for(const Qe of t.geometry)if(Qe.length>1){const Wt=Sb(Qe,Ge,s.vertical||G,c,24,he);Wt&&gt(Qe,Wt)}}else if(t.type==="Polygon")for(const Qe of Wf(t.geometry,0)){const Wt=Ib(Qe,16);gt(Qe[0],new al(Wt.x,Wt.y,0))}else if(t.type==="LineString")for(const Qe of t.geometry)gt(Qe,new al(Qe[0].x,Qe[0].y,0));else if(t.type==="Point")for(const Qe of t.geometry)for(const Wt of Qe)gt([Wt],new al(Wt.x,Wt.y,0))}function Ty(n,t,s,c,p,v,x,w,E,I,L,O,$,j,G){const X=function(Ee,fe,xe,$e,Ge,Tt,zt,Mt){const vt=$e.layout.get("text-rotate").evaluate(Tt,{})*Math.PI/180,ot=[];for(const Pt of fe.positionedLines)for(const gt of Pt.positionedGlyphs){if(!gt.rect)continue;const Qe=gt.rect||{};let Wt=jg+1,Bt=!0,vi=1,fr=0;const _r=(Ge||Mt)&&gt.vertical,an=gt.metrics.advance*gt.scale/2;if(Mt&&fe.verticalizable&&(fr=Pt.lineOffset/2-(gt.imageName?-(sn-gt.metrics.width*gt.scale)/2:(gt.scale-1)*sn)),gt.imageName){const cn=zt[gt.imageName];Bt=cn.sdf,vi=cn.pixelRatio,Wt=ls/vi}const Ts=Ge?[gt.x+an,gt.y]:[0,0];let Kn=Ge?[0,0]:[gt.x+an+xe[0],gt.y+xe[1]-fr],Yr=[0,0];_r&&(Yr=Kn,Kn=[0,0]);const Sn=gt.metrics.isDoubleResolution?2:1,Dn=(gt.metrics.left-Wt)*gt.scale-an+Kn[0],Yn=(-gt.metrics.top-Wt)*gt.scale+Kn[1],Jn=Dn+Qe.w/Sn*gt.scale/vi,on=Yn+Qe.h/Sn*gt.scale/vi,ln=new D(Dn,Yn),On=new D(Jn,Yn),Qn=new D(Dn,on),Fn=new D(Jn,on);if(_r){const cn=new D(-an,an-Gu),Ti=-Math.PI/2,Bn=sn/2-an,kn=new D(5-Gu-Bn,-(gt.imageName?Bn:0)),un=new D(...Yr);ln._rotateAround(Ti,cn)._add(kn)._add(un),On._rotateAround(Ti,cn)._add(kn)._add(un),Qn._rotateAround(Ti,cn)._add(kn)._add(un),Fn._rotateAround(Ti,cn)._add(kn)._add(un)}if(vt){const cn=Math.sin(vt),Ti=Math.cos(vt),Bn=[Ti,-cn,cn,Ti];ln._matMult(Bn),On._matMult(Bn),Qn._matMult(Bn),Fn._matMult(Bn)}const cs=new D(0,0),us=new D(0,0);ot.push({tl:ln,tr:On,bl:Qn,br:Fn,tex:Qe,writingMode:fe.writingMode,glyphOffset:Ts,sectionIndex:gt.sectionIndex,isSDF:Bt,pixelOffsetTL:cs,pixelOffsetBR:us,minFontScaleX:0,minFontScaleY:0})}return ot}(0,s,w,p,v,x,c,n.allowVerticalPlacement),ie=n.textSizeData;let he=null;ie.kind==="source"?(he=[Ha*p.layout.get("text-size").evaluate(x,{})],he[0]>nl&&xi(`${n.layerIds[0]}: Value for "text-size" is >= ${Zu}. Reduce your "text-size".`)):ie.kind==="composite"&&(he=[Ha*j.compositeTextSizes[0].evaluate(x,{},G),Ha*j.compositeTextSizes[1].evaluate(x,{},G)],(he[0]>nl||he[1]>nl)&&xi(`${n.layerIds[0]}: Value for "text-size" is >= ${Zu}. Reduce your "text-size".`)),n.addSymbols(n.text,X,he,w,v,x,I,t,E.lineStartIndex,E.lineLength,$,G);for(const Ee of L)O[Ee]=n.text.placedSymbolArray.length-1;return 4*X.length}function Cy(n){for(const t in n)return n[t];return null}function Db(n,t,s,c){const p=n.compareText;if(t in p){const v=p[t];for(let x=v.length-1;x>=0;x--)if(c.dist(v[x])<s)return!0}else p[t]=[];return p[t].push(c),!1}const Iy=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class yp{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,c]=new Uint8Array(t,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=c>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const v=Iy[15&c];if(!v)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(t,2,1),[w]=new Uint32Array(t,4,1);return new yp(w,x,v,t)}constructor(t,s=64,c=Float64Array,p){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=c,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const v=Iy.indexOf(this.ArrayType),x=2*t*this.ArrayType.BYTES_PER_ELEMENT,w=t*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-w%8)%8;if(v<0)throw new Error(`Unexpected typed array class: ${c}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+w+E,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+x+w+E),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+w+E,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+v]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=t)}add(t,s){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=t,this.coords[this._pos++]=s,c}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return _p(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,s,c,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:x,nodeSize:w}=this,E=[0,v.length-1,0],I=[];for(;E.length;){const L=E.pop()||0,O=E.pop()||0,$=E.pop()||0;if(O-$<=w){for(let ie=$;ie<=O;ie++){const he=x[2*ie],Ee=x[2*ie+1];he>=t&&he<=c&&Ee>=s&&Ee<=p&&I.push(v[ie])}continue}const j=$+O>>1,G=x[2*j],X=x[2*j+1];G>=t&&G<=c&&X>=s&&X<=p&&I.push(v[j]),(L===0?t<=G:s<=X)&&(E.push($),E.push(j-1),E.push(1-L)),(L===0?c>=G:p>=X)&&(E.push(j+1),E.push(O),E.push(1-L))}return I}within(t,s,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:v,nodeSize:x}=this,w=[0,p.length-1,0],E=[],I=c*c;for(;w.length;){const L=w.pop()||0,O=w.pop()||0,$=w.pop()||0;if(O-$<=x){for(let ie=$;ie<=O;ie++)Py(v[2*ie],v[2*ie+1],t,s)<=I&&E.push(p[ie]);continue}const j=$+O>>1,G=v[2*j],X=v[2*j+1];Py(G,X,t,s)<=I&&E.push(p[j]),(L===0?t-c<=G:s-c<=X)&&(w.push($),w.push(j-1),w.push(1-L)),(L===0?t+c>=G:s+c>=X)&&(w.push(j+1),w.push(O),w.push(1-L))}return E}}function _p(n,t,s,c,p,v){if(p-c<=s)return;const x=c+p>>1;Ay(n,t,x,c,p,v),_p(n,t,s,c,x-1,1-v),_p(n,t,s,x+1,p,1-v)}function Ay(n,t,s,c,p,v){for(;p>c;){if(p-c>600){const I=p-c+1,L=s-c+1,O=Math.log(I),$=.5*Math.exp(2*O/3),j=.5*Math.sqrt(O*$*(I-$)/I)*(L-I/2<0?-1:1);Ay(n,t,s,Math.max(c,Math.floor(s-L*$/I+j)),Math.min(p,Math.floor(s+(I-L)*$/I+j)),v)}const x=t[2*s+v];let w=c,E=p;for(Xu(n,t,c,s),t[2*p+v]>x&&Xu(n,t,c,p);w<E;){for(Xu(n,t,w,E),w++,E--;t[2*w+v]<x;)w++;for(;t[2*E+v]>x;)E--}t[2*c+v]===x?Xu(n,t,c,E):(E++,Xu(n,t,E,p)),E<=s&&(c=E+1),s<=E&&(p=E-1)}}function Xu(n,t,s,c){vp(n,s,c),vp(t,2*s,2*c),vp(t,2*s+1,2*c+1)}function vp(n,t,s){const c=n[t];n[t]=n[s],n[s]=c}function Py(n,t,s,c){const p=n-s,v=t-c;return p*p+v*v}var xp;m.bd=void 0,(xp=m.bd||(m.bd={})).create="create",xp.load="load",xp.fullLoad="fullLoad";let wd=null,Ku=[];const bp=1e3/60,wp="loadTime",Mp="fullLoadTime",kb={mark(n){performance.mark(n)},frame(n){const t=n;wd!=null&&Ku.push(t-wd),wd=t},clearMetrics(){wd=null,Ku=[],performance.clearMeasures(wp),performance.clearMeasures(Mp);for(const n in m.bd)performance.clearMarks(m.bd[n])},getPerformanceMetrics(){performance.measure(wp,m.bd.create,m.bd.load),performance.measure(Mp,m.bd.create,m.bd.fullLoad);const n=performance.getEntriesByName(wp)[0].duration,t=performance.getEntriesByName(Mp)[0].duration,s=Ku.length,c=1/(Ku.reduce((v,x)=>v+x,0)/s/1e3),p=Ku.filter(v=>v>bp).reduce((v,x)=>v+(x-bp)/bp,0);return{loadTime:n,fullLoadTime:t,fps:c,percentDroppedFrames:p/(s+p)*100,totalFrames:s}}};m.$=ct,m.A=Lc,m.B=function(n){if(tt==null){const t=n.navigator?n.navigator.userAgent:null;tt=!!n.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return tt},m.C=class{constructor(n,t){this.target=n,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new wb(()=>this.process()),this.subscription=function(s,c,p,v){return s.addEventListener(c,p,!1),{unsubscribe:()=>{s.removeEventListener(c,p,!1)}}}(this.target,"message",s=>this.receive(s)),this.globalScope=si(self)?n:window}registerMessageHandler(n,t){this.messageHandlers[n]=t}sendAsync(n,t){return new Promise((s,c)=>{const p=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[p]={resolve:s,reject:c},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[p];const w={id:p,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(w)},{once:!0});const v=[],x=Object.assign(Object.assign({},n),{id:p,sourceMapId:this.mapId,origin:location.origin,data:ss(n.data,v)});this.target.postMessage(x,{transfer:v})})}receive(n){const t=n.data,s=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[s];const c=this.abortControllers[s];return delete this.abortControllers[s],void(c&&c.abort())}if(si(self)||t.mustQueue)return this.tasks[s]=t,this.taskQueue.push(s),void this.invoker.trigger();this.processTask(s,t)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),t=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(n,t)}processTask(n,t){return l(this,void 0,void 0,function*(){if(t.type==="<response>"){const p=this.resolveRejects[n];return delete this.resolveRejects[n],p?void(t.error?p.reject(Zn(t.error)):p.resolve(Zn(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const s=Zn(t.data),c=new AbortController;this.abortControllers[n]=c;try{const p=yield this.messageHandlers[t.type](t.sourceMapId,s,c);this.completeTask(n,null,p)}catch(p){this.completeTask(n,p)}})}completeTask(n,t,s){const c=[];delete this.abortControllers[n];const p={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?ss(t):null,data:ss(s,c)};this.target.postMessage(p,{transfer:c})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},m.D=$t,m.E=Oe,m.F=function(){var n=new Lc(16);return Lc!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},m.G=Ve,m.H=function(n,t,s){var c,p,v,x,w,E,I,L,O,$,j,G,X=s[0],ie=s[1],he=s[2];return t===n?(n[12]=t[0]*X+t[4]*ie+t[8]*he+t[12],n[13]=t[1]*X+t[5]*ie+t[9]*he+t[13],n[14]=t[2]*X+t[6]*ie+t[10]*he+t[14],n[15]=t[3]*X+t[7]*ie+t[11]*he+t[15]):(p=t[1],v=t[2],x=t[3],w=t[4],E=t[5],I=t[6],L=t[7],O=t[8],$=t[9],j=t[10],G=t[11],n[0]=c=t[0],n[1]=p,n[2]=v,n[3]=x,n[4]=w,n[5]=E,n[6]=I,n[7]=L,n[8]=O,n[9]=$,n[10]=j,n[11]=G,n[12]=c*X+w*ie+O*he+t[12],n[13]=p*X+E*ie+$*he+t[13],n[14]=v*X+I*ie+j*he+t[14],n[15]=x*X+L*ie+G*he+t[15]),n},m.I=np,m.J=function(n,t,s){var c=s[0],p=s[1],v=s[2];return n[0]=t[0]*c,n[1]=t[1]*c,n[2]=t[2]*c,n[3]=t[3]*c,n[4]=t[4]*p,n[5]=t[5]*p,n[6]=t[6]*p,n[7]=t[7]*p,n[8]=t[8]*v,n[9]=t[9]*v,n[10]=t[10]*v,n[11]=t[11]*v,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},m.K=ug,m.L=function(n,t){const s={};for(let c=0;c<t.length;c++){const p=t[c];p in n&&(s[p]=n[p])}return s},m.M=sl,m.N=sy,m.O=ay,m.P=D,m.Q=Vs,m.R=Us,m.S=Te,m.T=xu,m.U=Fe,m.V=br,m.W=Br,m.X=jr,m.Y=yd,m.Z=class extends Mu{},m._=l,m.a=lr,m.a$=function(n,t,s){return n[0]=t[0]*s[0],n[1]=t[1]*s[1],n[2]=t[2]*s[2],n[3]=t[3]*s[3],n},m.a0=pp,m.a1=Ue,m.a2=n=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(s=>{t.onloadstart=()=>{s(t)};for(const c of n){const p=window.document.createElement("source");Ii(c)||(t.crossOrigin="Anonymous"),p.src=c,t.appendChild(p)}})},m.a3=function(){return _t++},m.a4=g,m.a5=Nc,m.a6=ga,m.a7=xo,m.a8=gr,m.a9=dy,m.aA=kt,m.aB=function(n,t){if(!n)return[{command:"setStyle",args:[t]}];let s=[];try{if(!Be(n.version,t.version))return[{command:"setStyle",args:[t]}];Be(n.center,t.center)||s.push({command:"setCenter",args:[t.center]}),Be(n.zoom,t.zoom)||s.push({command:"setZoom",args:[t.zoom]}),Be(n.bearing,t.bearing)||s.push({command:"setBearing",args:[t.bearing]}),Be(n.pitch,t.pitch)||s.push({command:"setPitch",args:[t.pitch]}),Be(n.sprite,t.sprite)||s.push({command:"setSprite",args:[t.sprite]}),Be(n.glyphs,t.glyphs)||s.push({command:"setGlyphs",args:[t.glyphs]}),Be(n.transition,t.transition)||s.push({command:"setTransition",args:[t.transition]}),Be(n.light,t.light)||s.push({command:"setLight",args:[t.light]}),Be(n.terrain,t.terrain)||s.push({command:"setTerrain",args:[t.terrain]}),Be(n.sky,t.sky)||s.push({command:"setSky",args:[t.sky]});const c={},p=[];(function(x,w,E,I){let L;for(L in w=w||{},x=x||{})Object.prototype.hasOwnProperty.call(x,L)&&(Object.prototype.hasOwnProperty.call(w,L)||At(L,E,I));for(L in w)Object.prototype.hasOwnProperty.call(w,L)&&(Object.prototype.hasOwnProperty.call(x,L)?Be(x[L],w[L])||(x[L].type==="geojson"&&w[L].type==="geojson"&&jt(x,w,L)?it(E,{command:"setGeoJSONSourceData",args:[L,w[L].data]}):Gt(L,w,E,I)):et(L,w,E))})(n.sources,t.sources,p,c);const v=[];n.layers&&n.layers.forEach(x=>{"source"in x&&c[x.source]?s.push({command:"removeLayer",args:[x.id]}):v.push(x)}),s=s.concat(p),function(x,w,E){w=w||[];const I=(x=x||[]).map(fi),L=w.map(fi),O=x.reduce(bi,{}),$=w.reduce(bi,{}),j=I.slice(),G=Object.create(null);let X,ie,he,Ee,fe;for(let xe=0,$e=0;xe<I.length;xe++)X=I[xe],Object.prototype.hasOwnProperty.call($,X)?$e++:(it(E,{command:"removeLayer",args:[X]}),j.splice(j.indexOf(X,$e),1));for(let xe=0,$e=0;xe<L.length;xe++)X=L[L.length-1-xe],j[j.length-1-xe]!==X&&(Object.prototype.hasOwnProperty.call(O,X)?(it(E,{command:"removeLayer",args:[X]}),j.splice(j.lastIndexOf(X,j.length-$e),1)):$e++,Ee=j[j.length-xe],it(E,{command:"addLayer",args:[$[X],Ee]}),j.splice(j.length-xe,0,X),G[X]=!0);for(let xe=0;xe<L.length;xe++)if(X=L[xe],ie=O[X],he=$[X],!G[X]&&!Be(ie,he))if(Be(ie.source,he.source)&&Be(ie["source-layer"],he["source-layer"])&&Be(ie.type,he.type)){for(fe in Zt(ie.layout,he.layout,E,X,null,"setLayoutProperty"),Zt(ie.paint,he.paint,E,X,null,"setPaintProperty"),Be(ie.filter,he.filter)||it(E,{command:"setFilter",args:[X,he.filter]}),Be(ie.minzoom,he.minzoom)&&Be(ie.maxzoom,he.maxzoom)||it(E,{command:"setLayerZoomRange",args:[X,he.minzoom,he.maxzoom]}),ie)Object.prototype.hasOwnProperty.call(ie,fe)&&fe!=="layout"&&fe!=="paint"&&fe!=="filter"&&fe!=="metadata"&&fe!=="minzoom"&&fe!=="maxzoom"&&(fe.indexOf("paint.")===0?Zt(ie[fe],he[fe],E,X,fe.slice(6),"setPaintProperty"):Be(ie[fe],he[fe])||it(E,{command:"setLayerProperty",args:[X,fe,he[fe]]}));for(fe in he)Object.prototype.hasOwnProperty.call(he,fe)&&!Object.prototype.hasOwnProperty.call(ie,fe)&&fe!=="layout"&&fe!=="paint"&&fe!=="filter"&&fe!=="metadata"&&fe!=="minzoom"&&fe!=="maxzoom"&&(fe.indexOf("paint.")===0?Zt(ie[fe],he[fe],E,X,fe.slice(6),"setPaintProperty"):Be(ie[fe],he[fe])||it(E,{command:"setLayerProperty",args:[X,fe,he[fe]]}))}else it(E,{command:"removeLayer",args:[X]}),Ee=j[j.lastIndexOf(X)+1],it(E,{command:"addLayer",args:[he,Ee]})}(v,t.layers,s)}catch(c){console.warn("Unable to compute style diff:",c),s=[{command:"setStyle",args:[t]}]}return s},m.aC=function(n){const t=[],s=n.id;return s===void 0&&t.push({message:`layers.${s}: missing required property "id"`}),n.render===void 0&&t.push({message:`layers.${s}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&t.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),t},m.aD=function n(t,s){if(Array.isArray(t)){if(!Array.isArray(s)||t.length!==s.length)return!1;for(let c=0;c<t.length;c++)if(!n(t[c],s[c]))return!1;return!0}if(typeof t=="object"&&t!==null&&s!==null){if(typeof s!="object"||Object.keys(t).length!==Object.keys(s).length)return!1;for(const c in t)if(!n(t[c],s[c]))return!1;return!0}return t===s},m.aE=xt,m.aF=Vt,m.aG=class extends nn{constructor(n,t){super(n,t),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},m.aH=os,m.aI=class extends nn{constructor(n,t){super(n,t),this.current=Xl}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let t=1;t<16;t++)if(n[t]!==this.current[t]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},m.aJ=ta,m.aK=class extends nn{constructor(n,t){super(n,t),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},m.aL=class extends nn{constructor(n,t){super(n,t),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},m.aM=ja,m.aN=function(n,t,s,c,p,v,x){var w=1/(t-s),E=1/(c-p),I=1/(v-x);return n[0]=-2*w,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*E,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*I,n[11]=0,n[12]=(t+s)*w,n[13]=(p+c)*E,n[14]=(x+v)*I,n[15]=1,n},m.aO=Bi,m.aP=i1,m.aQ=class extends Ec{},m.aR=K1,m.aS=class extends Tc{},m.aT=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},m.aU=mg,m.aV=B,m.aW=class extends Au{},m.aX=ze,m.aY=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]&&n[9]===t[9]&&n[10]===t[10]&&n[11]===t[11]&&n[12]===t[12]&&n[13]===t[13]&&n[14]===t[14]&&n[15]===t[15]},m.aZ=function(n,t){var s=n[0],c=n[1],p=n[2],v=n[3],x=n[4],w=n[5],E=n[6],I=n[7],L=n[8],O=n[9],$=n[10],j=n[11],G=n[12],X=n[13],ie=n[14],he=n[15],Ee=t[0],fe=t[1],xe=t[2],$e=t[3],Ge=t[4],Tt=t[5],zt=t[6],Mt=t[7],vt=t[8],ot=t[9],Pt=t[10],gt=t[11],Qe=t[12],Wt=t[13],Bt=t[14],vi=t[15];return Math.abs(s-Ee)<=Xn*Math.max(1,Math.abs(s),Math.abs(Ee))&&Math.abs(c-fe)<=Xn*Math.max(1,Math.abs(c),Math.abs(fe))&&Math.abs(p-xe)<=Xn*Math.max(1,Math.abs(p),Math.abs(xe))&&Math.abs(v-$e)<=Xn*Math.max(1,Math.abs(v),Math.abs($e))&&Math.abs(x-Ge)<=Xn*Math.max(1,Math.abs(x),Math.abs(Ge))&&Math.abs(w-Tt)<=Xn*Math.max(1,Math.abs(w),Math.abs(Tt))&&Math.abs(E-zt)<=Xn*Math.max(1,Math.abs(E),Math.abs(zt))&&Math.abs(I-Mt)<=Xn*Math.max(1,Math.abs(I),Math.abs(Mt))&&Math.abs(L-vt)<=Xn*Math.max(1,Math.abs(L),Math.abs(vt))&&Math.abs(O-ot)<=Xn*Math.max(1,Math.abs(O),Math.abs(ot))&&Math.abs($-Pt)<=Xn*Math.max(1,Math.abs($),Math.abs(Pt))&&Math.abs(j-gt)<=Xn*Math.max(1,Math.abs(j),Math.abs(gt))&&Math.abs(G-Qe)<=Xn*Math.max(1,Math.abs(G),Math.abs(Qe))&&Math.abs(X-Wt)<=Xn*Math.max(1,Math.abs(X),Math.abs(Wt))&&Math.abs(ie-Bt)<=Xn*Math.max(1,Math.abs(ie),Math.abs(Bt))&&Math.abs(he-vi)<=Xn*Math.max(1,Math.abs(he),Math.abs(vi))},m.a_=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},m.aa=function(n){const t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,c,p,v)=>{const x=p||v;return t[c]=!x||x.toLowerCase(),""}),t["max-age"]){const s=parseInt(t["max-age"],10);isNaN(s)?delete t["max-age"]:t["max-age"]=s}return t},m.ab=function(n,t){const s=[];for(const c in n)c in t||s.push(c);return s},m.ac=Ze,m.ad=function(n,t,s){var c=Math.sin(s),p=Math.cos(s),v=t[0],x=t[1],w=t[2],E=t[3],I=t[4],L=t[5],O=t[6],$=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=v*p+I*c,n[1]=x*p+L*c,n[2]=w*p+O*c,n[3]=E*p+$*c,n[4]=I*p-v*c,n[5]=L*p-x*c,n[6]=O*p-w*c,n[7]=$*p-E*c,n},m.ae=function(n){var t=new Lc(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},m.af=ad,m.ag=function(n,t){let s=0,c=0;if(n.kind==="constant")c=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:p,minZoom:v,maxZoom:x}=n,w=p?Ze(Jr.interpolationFactor(p,t,v,x),0,1):0;n.kind==="camera"?c=dn.number(n.minSize,n.maxSize,w):s=w}return{uSizeT:s,uSize:c}},m.ai=function(n,{uSize:t,uSizeT:s},{lowerSize:c,upperSize:p}){return n.kind==="source"?c/Ha:n.kind==="composite"?dn.number(c/Ha,p/Ha,s):t},m.aj=lp,m.ak=function(n,t,s,c){const p=t.y-n.y,v=t.x-n.x,x=c.y-s.y,w=c.x-s.x,E=x*v-w*p;if(E===0)return null;const I=(w*(n.y-s.y)-x*(n.x-s.x))/E;return new D(n.x+I*v,n.y+I*p)},m.al=gy,m.am=Du,m.an=Uf,m.ao=sn,m.aq=op,m.ar=function(n,t){var s=t[0],c=t[1],p=t[2],v=t[3],x=t[4],w=t[5],E=t[6],I=t[7],L=t[8],O=t[9],$=t[10],j=t[11],G=t[12],X=t[13],ie=t[14],he=t[15],Ee=s*w-c*x,fe=s*E-p*x,xe=s*I-v*x,$e=c*E-p*w,Ge=c*I-v*w,Tt=p*I-v*E,zt=L*X-O*G,Mt=L*ie-$*G,vt=L*he-j*G,ot=O*ie-$*X,Pt=O*he-j*X,gt=$*he-j*ie,Qe=Ee*gt-fe*Pt+xe*ot+$e*vt-Ge*Mt+Tt*zt;return Qe?(n[0]=(w*gt-E*Pt+I*ot)*(Qe=1/Qe),n[1]=(p*Pt-c*gt-v*ot)*Qe,n[2]=(X*Tt-ie*Ge+he*$e)*Qe,n[3]=($*Ge-O*Tt-j*$e)*Qe,n[4]=(E*vt-x*gt-I*Mt)*Qe,n[5]=(s*gt-p*vt+v*Mt)*Qe,n[6]=(ie*xe-G*Tt-he*fe)*Qe,n[7]=(L*Tt-$*xe+j*fe)*Qe,n[8]=(x*Pt-w*vt+I*zt)*Qe,n[9]=(c*vt-s*Pt-v*zt)*Qe,n[10]=(G*Ge-X*xe+he*Ee)*Qe,n[11]=(O*xe-L*Ge-j*Ee)*Qe,n[12]=(w*Mt-x*ot-E*zt)*Qe,n[13]=(s*ot-c*Mt+p*zt)*Qe,n[14]=(X*fe-G*$e-ie*Ee)*Qe,n[15]=(L*$e-O*fe+$*Ee)*Qe,n):null},m.as=gp,m.at=ap,m.au=yp,m.av=function(){const n={},t=ce.$version;for(const s in ce.$root){const c=ce.$root[s];if(c.required){let p=null;p=s==="version"?t:c.type==="array"?[]:{},p!=null&&(n[s]=p)}}return n},m.aw=$l,m.ax=lt,m.ay=function(n){n=n.slice();const t=Object.create(null);for(let s=0;s<n.length;s++)t[n[s].id]=n[s];for(let s=0;s<n.length;s++)"ref"in n[s]&&(n[s]=Ct(n[s],t[n[s].ref]));return n},m.az=function(n){if(n.type==="custom")return new bb(n);switch(n.type){case"background":return new _b(n);case"circle":return new r1(n);case"fill":return new M1(n);case"fill-extrusion":return new B1(n);case"heatmap":return new s1(n);case"hillshade":return new o1(n);case"line":return new H1(n);case"raster":return new xb(n);case"symbol":return new gd(n)}},m.b=rt,m.b0=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]},m.b1=Je,m.b2=cy,m.b3=oy,m.b4=function(n,t,s,c,p){var v,x=1/Math.tan(t/2);return n[0]=x/s,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=x,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,p!=null&&p!==1/0?(n[10]=(p+c)*(v=1/(c-p)),n[14]=2*p*c*v):(n[10]=-1,n[14]=-2*c),n},m.b5=function(n,t,s){var c=Math.sin(s),p=Math.cos(s),v=t[4],x=t[5],w=t[6],E=t[7],I=t[8],L=t[9],O=t[10],$=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=v*p+I*c,n[5]=x*p+L*c,n[6]=w*p+O*c,n[7]=E*p+$*c,n[8]=I*p-v*c,n[9]=L*p-x*c,n[10]=O*p-w*c,n[11]=$*p-E*c,n},m.b6=ae,m.b7=Pe,m.b8=function(n){return n*Math.PI/180},m.b9=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},m.bA=Va,m.ba=class extends ba{},m.bb=dp,m.bc=kb,m.be=St,m.bf=function(n,t){lr.REGISTERED_PROTOCOLS[n]=t},m.bg=function(n){delete lr.REGISTERED_PROTOCOLS[n]},m.bh=function(n,t){const s={};for(let p=0;p<n.length;p++){const v=t&&t[n[p].id]||Fl(n[p]);t&&(t[n[p].id]=v);let x=s[v];x||(x=s[v]=[]),x.push(n[p])}const c=[];for(const p in s)c.push(s[p]);return c},m.bi=Et,m.bj=hy,m.bk=fy,m.bl=Gg,m.bm=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=Br/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const t=n.bucket.layers[0],s=t.layout,c=t._unevaluatedLayout._values,p={layoutIconSize:c["icon-size"].possiblyEvaluate(new gr(n.bucket.zoom+1),n.canonical),layoutTextSize:c["text-size"].possiblyEvaluate(new gr(n.bucket.zoom+1),n.canonical),textMaxSize:c["text-size"].possiblyEvaluate(new gr(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:I,maxZoom:L}=n.bucket.textSizeData;p.compositeTextSizes=[c["text-size"].possiblyEvaluate(new gr(I),n.canonical),c["text-size"].possiblyEvaluate(new gr(L),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:I,maxZoom:L}=n.bucket.iconSizeData;p.compositeIconSizes=[c["icon-size"].possiblyEvaluate(new gr(I),n.canonical),c["icon-size"].possiblyEvaluate(new gr(L),n.canonical)]}const v=s.get("text-line-height")*sn,x=s.get("text-rotation-alignment")!=="viewport"&&s.get("symbol-placement")!=="point",w=s.get("text-keep-upright"),E=s.get("text-size");for(const I of n.bucket.features){const L=s.get("text-font").evaluate(I,{},n.canonical).join(","),O=E.evaluate(I,{},n.canonical),$=p.layoutTextSize.evaluate(I,{},n.canonical),j=p.layoutIconSize.evaluate(I,{},n.canonical),G={horizontal:{},vertical:void 0},X=I.text;let ie,he=[0,0];if(X){const xe=X.toString(),$e=s.get("text-letter-spacing").evaluate(I,{},n.canonical)*sn,Ge=po(xe)?$e:0,Tt=s.get("text-anchor").evaluate(I,{},n.canonical),zt=Ey(t,I,n.canonical);if(!zt){const gt=s.get("text-radial-offset").evaluate(I,{},n.canonical);he=gt?Sy(Tt,[gt*sn,mp]):s.get("text-offset").evaluate(I,{},n.canonical).map(Qe=>Qe*sn)}let Mt=x?"center":s.get("text-justify").evaluate(I,{},n.canonical);const vt=s.get("symbol-placement"),ot=vt==="point"?s.get("text-max-width").evaluate(I,{},n.canonical)*sn:0,Pt=()=>{n.bucket.allowVerticalPlacement&&ea(xe)&&(G.vertical=fd(X,n.glyphMap,n.glyphPositions,n.imagePositions,L,ot,v,Tt,"left",Ge,he,m.ah.vertical,!0,vt,$,O))};if(!x&&zt){const gt=new Set;if(Mt==="auto")for(let Wt=0;Wt<zt.values.length;Wt+=2)gt.add(gp(zt.values[Wt]));else gt.add(Mt);let Qe=!1;for(const Wt of gt)if(!G.horizontal[Wt])if(Qe)G.horizontal[Wt]=G.horizontal[0];else{const Bt=fd(X,n.glyphMap,n.glyphPositions,n.imagePositions,L,ot,v,"center",Wt,Ge,he,m.ah.horizontal,!1,vt,$,O);Bt&&(G.horizontal[Wt]=Bt,Qe=Bt.positionedLines.length===1)}Pt()}else{Mt==="auto"&&(Mt=gp(Tt));const gt=fd(X,n.glyphMap,n.glyphPositions,n.imagePositions,L,ot,v,Tt,Mt,Ge,he,m.ah.horizontal,!1,vt,$,O);gt&&(G.horizontal[Mt]=gt),Pt(),ea(xe)&&x&&w&&(G.vertical=fd(X,n.glyphMap,n.glyphPositions,n.imagePositions,L,ot,v,Tt,Mt,Ge,he,m.ah.vertical,!1,vt,$,O))}}let Ee=!1;if(I.icon&&I.icon.name){const xe=n.imageMap[I.icon.name];xe&&(ie=fb(n.imagePositions[I.icon.name],s.get("icon-offset").evaluate(I,{},n.canonical),s.get("icon-anchor").evaluate(I,{},n.canonical)),Ee=!!xe.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=Ee:n.bucket.sdfIcons!==Ee&&xi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(xe.pixelRatio!==n.bucket.pixelRatio||s.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const fe=Cy(G.horizontal)||G.vertical;n.bucket.iconsInText=!!fe&&fe.iconsInText,(fe||ie)&&Pb(n.bucket,I,G,ie,n.imageMap,p,$,j,he,Ee,n.canonical)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},m.bn=ep,m.bo=Yf,m.bp=Qf,m.bq=il,m.br=ip,m.bs=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},m.bt=function(n,t,s,c,p){return l(this,void 0,void 0,function*(){if(Fe())try{return yield br(n,t,s,c,p)}catch{}return function(v,x,w,E,I){const L=v.width,O=v.height;Oi&&Si||(Oi=new OffscreenCanvas(L,O),Si=Oi.getContext("2d",{willReadFrequently:!0})),Oi.width=L,Oi.height=O,Si.drawImage(v,0,0,L,O);const $=Si.getImageData(x,w,E,I);return Si.clearRect(0,0,L,O),$.data}(n,t,s,c,p)})},m.bu=uy,m.bv=T,m.bw=P,m.bx=Og,m.by=vs,m.bz=function(n){return n.message===Ni},m.c=Hr,m.d=n=>l(void 0,void 0,void 0,function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(t)}catch(s){throw new Error(`Could not load image because of ${s.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),m.e=dt,m.f=n=>new Promise((t,s)=>{const c=new Image;c.onload=()=>{t(c),URL.revokeObjectURL(c.src),c.onload=null,window.requestAnimationFrame(()=>{c.src=It})},c.onerror=()=>s(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const p=new Blob([new Uint8Array(n)],{type:"image/png"});c.src=n.byteLength?URL.createObjectURL(p):It}),m.g=Ci,m.h=(n,t)=>Ye(dt(n,{type:"json"}),t),m.i=si,m.j=De,m.k=ue,m.l=(n,t)=>Ye(dt(n,{type:"arrayBuffer"}),t),m.m=Ye,m.n=function(n){return new ip(n).readFields(ob,[])},m.o=Fu,m.p=qg,m.q=Wn,m.r=el,m.s=Ii,m.t=en,m.u=yt,m.v=ce,m.w=xi,m.x=Di,m.y=function([n,t,s]){return t+=90,t*=Math.PI/180,s*=Math.PI/180,{x:n*Math.cos(t)*Math.sin(s),y:n*Math.sin(t)*Math.sin(s),z:n*Math.cos(s)}},m.z=dn}),d("worker",["./shared"],function(m){class l{constructor(N){this.keyCache={},N&&this.replace(N)}replace(N){this._layerConfigs={},this._layers={},this.update(N,[])}update(N,U){for(const J of N){this._layerConfigs[J.id]=J;const _e=this._layers[J.id]=m.az(J);_e._featureFilter=m.a6(_e.filter),this.keyCache[J.id]&&delete this.keyCache[J.id]}for(const J of U)delete this.keyCache[J],delete this._layerConfigs[J],delete this._layers[J];this.familiesBySource={};const H=m.bh(Object.values(this._layerConfigs),this.keyCache);for(const J of H){const _e=J.map(Re=>this._layers[Re.id]),ve=_e[0];if(ve.visibility==="none")continue;const we=ve.source||"";let de=this.familiesBySource[we];de||(de=this.familiesBySource[we]={});const Ce=ve.sourceLayer||"_geojsonTileLayer";let qe=de[Ce];qe||(qe=de[Ce]=[]),qe.push(_e)}}}class T{constructor(N){const U={},H=[];for(const we in N){const de=N[we],Ce=U[we]={};for(const qe in de){const Re=de[+qe];if(!Re||Re.bitmap.width===0||Re.bitmap.height===0)continue;const Ne={x:0,y:0,w:Re.bitmap.width+2,h:Re.bitmap.height+2};H.push(Ne),Ce[qe]={rect:Ne,metrics:Re.metrics}}}const{w:J,h:_e}=m.p(H),ve=new m.o({width:J||1,height:_e||1});for(const we in N){const de=N[we];for(const Ce in de){const qe=de[+Ce];if(!qe||qe.bitmap.width===0||qe.bitmap.height===0)continue;const Re=U[we][Ce].rect;m.o.copy(qe.bitmap,ve,{x:0,y:0},{x:Re.x+1,y:Re.y+1},qe.bitmap)}}this.image=ve,this.positions=U}}m.bi("GlyphAtlas",T);class P{constructor(N){this.tileID=new m.Q(N.tileID.overscaledZ,N.tileID.wrap,N.tileID.canonical.z,N.tileID.canonical.x,N.tileID.canonical.y),this.uid=N.uid,this.zoom=N.zoom,this.pixelRatio=N.pixelRatio,this.tileSize=N.tileSize,this.source=N.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=N.showCollisionBoxes,this.collectResourceTiming=!!N.collectResourceTiming,this.returnDependencies=!!N.returnDependencies,this.promoteId=N.promoteId,this.inFlightDependencies=[]}parse(N,U,H,J){return m._(this,void 0,void 0,function*(){this.status="parsing",this.data=N,this.collisionBoxArray=new m.a4;const _e=new m.bj(Object.keys(N.layers).sort()),ve=new m.bk(this.tileID,this.promoteId);ve.bucketLayerIDs=[];const we={},de={featureIndex:ve,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:H},Ce=U.familiesBySource[this.source];for(const Ht in Ce){const pr=N.layers[Ht];if(!pr)continue;pr.version===1&&m.w(`Vector tile source "${this.source}" layer "${Ht}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ur=_e.encode(Ht),gn=[];for(let yn=0;yn<pr.length;yn++){const Zr=pr.feature(yn),jn=ve.getId(Zr,Ht);gn.push({feature:Zr,id:jn,index:yn,sourceLayerIndex:Ur})}for(const yn of Ce[Ht]){const Zr=yn[0];Zr.source!==this.source&&m.w(`layer.source = ${Zr.source} does not equal this.source = ${this.source}`),Zr.minzoom&&this.zoom<Math.floor(Zr.minzoom)||Zr.maxzoom&&this.zoom>=Zr.maxzoom||Zr.visibility!=="none"&&(R(yn,this.zoom,H),(we[Zr.id]=Zr.createBucket({index:ve.bucketLayerIDs.length,layers:yn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ur,sourceID:this.source})).populate(gn,de,this.tileID.canonical),ve.bucketLayerIDs.push(yn.map(jn=>jn.id)))}}const qe=m.aE(de.glyphDependencies,Ht=>Object.keys(Ht).map(Number));this.inFlightDependencies.forEach(Ht=>Ht==null?void 0:Ht.abort()),this.inFlightDependencies=[];let Re=Promise.resolve({});if(Object.keys(qe).length){const Ht=new AbortController;this.inFlightDependencies.push(Ht),Re=J.sendAsync({type:"GG",data:{stacks:qe,source:this.source,tileID:this.tileID,type:"glyphs"}},Ht)}const Ne=Object.keys(de.iconDependencies);let Ft=Promise.resolve({});if(Ne.length){const Ht=new AbortController;this.inFlightDependencies.push(Ht),Ft=J.sendAsync({type:"GI",data:{icons:Ne,source:this.source,tileID:this.tileID,type:"icons"}},Ht)}const Ut=Object.keys(de.patternDependencies);let Qt=Promise.resolve({});if(Ut.length){const Ht=new AbortController;this.inFlightDependencies.push(Ht),Qt=J.sendAsync({type:"GI",data:{icons:Ut,source:this.source,tileID:this.tileID,type:"patterns"}},Ht)}const[ti,mi,Fi]=yield Promise.all([Re,Ft,Qt]),ir=new T(ti),Or=new m.bl(mi,Fi);for(const Ht in we){const pr=we[Ht];pr instanceof m.a5?(R(pr.layers,this.zoom,H),m.bm({bucket:pr,glyphMap:ti,glyphPositions:ir.positions,imageMap:mi,imagePositions:Or.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):pr.hasPattern&&(pr instanceof m.bn||pr instanceof m.bo||pr instanceof m.bp)&&(R(pr.layers,this.zoom,H),pr.addFeatures(de,this.tileID.canonical,Or.patternPositions))}return this.status="done",{buckets:Object.values(we).filter(Ht=>!Ht.isEmpty()),featureIndex:ve,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ir.image,imageAtlas:Or,glyphMap:this.returnDependencies?ti:null,iconMap:this.returnDependencies?mi:null,glyphPositions:this.returnDependencies?ir.positions:null}})}}function R(ee,N,U){const H=new m.a8(N);for(const J of ee)J.recalculate(H,U)}class D{constructor(N,U,H){this.actor=N,this.layerIndex=U,this.availableImages=H,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(N,U){return m._(this,void 0,void 0,function*(){const H=yield m.l(N.request,U);try{return{vectorTile:new m.bq.VectorTile(new m.br(H.data)),rawData:H.data,cacheControl:H.cacheControl,expires:H.expires}}catch(J){const _e=new Uint8Array(H.data);let ve=`Unable to parse the tile at ${N.request.url}, `;throw ve+=_e[0]===31&&_e[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${J.messge}`,new Error(ve)}})}loadTile(N){return m._(this,void 0,void 0,function*(){const U=N.uid,H=!!(N&&N.request&&N.request.collectResourceTiming)&&new m.bs(N.request),J=new P(N);this.loading[U]=J;const _e=new AbortController;J.abort=_e;try{const ve=yield this.loadVectorTile(N,_e);if(delete this.loading[U],!ve)return null;const we=ve.rawData,de={};ve.expires&&(de.expires=ve.expires),ve.cacheControl&&(de.cacheControl=ve.cacheControl);const Ce={};if(H){const Re=H.finish();Re&&(Ce.resourceTiming=JSON.parse(JSON.stringify(Re)))}J.vectorTile=ve.vectorTile;const qe=J.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[U]=J,this.fetching[U]={rawTileData:we,cacheControl:de,resourceTiming:Ce};try{const Re=yield qe;return m.e({rawTileData:we.slice(0)},Re,de,Ce)}finally{delete this.fetching[U]}}catch(ve){throw delete this.loading[U],J.status="done",this.loaded[U]=J,ve}})}reloadTile(N){return m._(this,void 0,void 0,function*(){const U=N.uid;if(!this.loaded||!this.loaded[U])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const H=this.loaded[U];if(H.showCollisionBoxes=N.showCollisionBoxes,H.status==="parsing"){const J=yield H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor);let _e;if(this.fetching[U]){const{rawTileData:ve,cacheControl:we,resourceTiming:de}=this.fetching[U];delete this.fetching[U],_e=m.e({rawTileData:ve.slice(0)},J,we,de)}else _e=J;return _e}if(H.status==="done"&&H.vectorTile)return H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(N){return m._(this,void 0,void 0,function*(){const U=this.loading,H=N.uid;U&&U[H]&&U[H].abort&&(U[H].abort.abort(),delete U[H])})}removeTile(N){return m._(this,void 0,void 0,function*(){this.loaded&&this.loaded[N.uid]&&delete this.loaded[N.uid]})}}class z{constructor(){this.loaded={}}loadTile(N){return m._(this,void 0,void 0,function*(){const{uid:U,encoding:H,rawImageData:J,redFactor:_e,greenFactor:ve,blueFactor:we,baseShift:de}=N,Ce=J.width+2,qe=J.height+2,Re=m.b(J)?new m.R({width:Ce,height:qe},yield m.bt(J,-1,-1,Ce,qe)):J,Ne=new m.bu(U,Re,H,_e,ve,we,de);return this.loaded=this.loaded||{},this.loaded[U]=Ne,Ne})}removeTile(N){const U=this.loaded,H=N.uid;U&&U[H]&&delete U[H]}}function Z(ee,N){if(ee.length!==0){K(ee[0],N);for(var U=1;U<ee.length;U++)K(ee[U],!N)}}function K(ee,N){for(var U=0,H=0,J=0,_e=ee.length,ve=_e-1;J<_e;ve=J++){var we=(ee[J][0]-ee[ve][0])*(ee[ve][1]+ee[J][1]),de=U+we;H+=Math.abs(U)>=Math.abs(we)?U-de+we:we-de+U,U=de}U+H>=0!=!!N&&ee.reverse()}var Y=m.bv(function ee(N,U){var H,J=N&&N.type;if(J==="FeatureCollection")for(H=0;H<N.features.length;H++)ee(N.features[H],U);else if(J==="GeometryCollection")for(H=0;H<N.geometries.length;H++)ee(N.geometries[H],U);else if(J==="Feature")ee(N.geometry,U);else if(J==="Polygon")Z(N.coordinates,U);else if(J==="MultiPolygon")for(H=0;H<N.coordinates.length;H++)Z(N.coordinates[H],U);return N});const me=m.bq.VectorTileFeature.prototype.toGeoJSON;var Te={exports:{}},Fe=m.bw,ae=m.bq.VectorTileFeature,Pe=Ze;function Ze(ee,N){this.options=N||{},this.features=ee,this.length=ee.length}function Je(ee,N){this.id=typeof ee.id=="number"?ee.id:void 0,this.type=ee.type,this.rawGeometry=ee.type===1?[ee.geometry]:ee.geometry,this.properties=ee.tags,this.extent=N||4096}Ze.prototype.feature=function(ee){return new Je(this.features[ee],this.options.extent)},Je.prototype.loadGeometry=function(){var ee=this.rawGeometry;this.geometry=[];for(var N=0;N<ee.length;N++){for(var U=ee[N],H=[],J=0;J<U.length;J++)H.push(new Fe(U[J][0],U[J][1]));this.geometry.push(H)}return this.geometry},Je.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ee=this.geometry,N=1/0,U=-1/0,H=1/0,J=-1/0,_e=0;_e<ee.length;_e++)for(var ve=ee[_e],we=0;we<ve.length;we++){var de=ve[we];N=Math.min(N,de.x),U=Math.max(U,de.x),H=Math.min(H,de.y),J=Math.max(J,de.y)}return[N,H,U,J]},Je.prototype.toGeoJSON=ae.prototype.toGeoJSON;var dt=m.bx,_t=Pe;function xt(ee){var N=new dt;return function(U,H){for(var J in U.layers)H.writeMessage(3,Vt,U.layers[J])}(ee,N),N.finish()}function Vt(ee,N){var U;N.writeVarintField(15,ee.version||1),N.writeStringField(1,ee.name||""),N.writeVarintField(5,ee.extent||4096);var H={keys:[],values:[],keycache:{},valuecache:{}};for(U=0;U<ee.length;U++)H.feature=ee.feature(U),N.writeMessage(2,kt,H);var J=H.keys;for(U=0;U<J.length;U++)N.writeStringField(3,J[U]);var _e=H.values;for(U=0;U<_e.length;U++)N.writeMessage(4,si,_e[U])}function kt(ee,N){var U=ee.feature;U.id!==void 0&&N.writeVarintField(1,U.id),N.writeMessage(2,ri,ee),N.writeVarintField(3,U.type),N.writeMessage(4,xr,U)}function ri(ee,N){var U=ee.feature,H=ee.keys,J=ee.values,_e=ee.keycache,ve=ee.valuecache;for(var we in U.properties){var de=U.properties[we],Ce=_e[we];if(de!==null){Ce===void 0&&(H.push(we),_e[we]=Ce=H.length-1),N.writeVarint(Ce);var qe=typeof de;qe!=="string"&&qe!=="boolean"&&qe!=="number"&&(de=JSON.stringify(de));var Re=qe+":"+de,Ne=ve[Re];Ne===void 0&&(J.push(de),ve[Re]=Ne=J.length-1),N.writeVarint(Ne)}}}function xi(ee,N){return(N<<3)+(7&ee)}function li(ee){return ee<<1^ee>>31}function xr(ee,N){for(var U=ee.loadGeometry(),H=ee.type,J=0,_e=0,ve=U.length,we=0;we<ve;we++){var de=U[we],Ce=1;H===1&&(Ce=de.length),N.writeVarint(xi(1,Ce));for(var qe=H===3?de.length-1:de.length,Re=0;Re<qe;Re++){Re===1&&H!==1&&N.writeVarint(xi(2,qe-1));var Ne=de[Re].x-J,Ft=de[Re].y-_e;N.writeVarint(li(Ne)),N.writeVarint(li(Ft)),J+=Ne,_e+=Ft}H===3&&N.writeVarint(xi(7,1))}}function si(ee,N){var U=typeof ee;U==="string"?N.writeStringField(1,ee):U==="boolean"?N.writeBooleanField(7,ee):U==="number"&&(ee%1!=0?N.writeDoubleField(3,ee):ee<0?N.writeSVarintField(6,ee):N.writeVarintField(5,ee))}Te.exports=xt,Te.exports.fromVectorTileJs=xt,Te.exports.fromGeojsonVt=function(ee,N){N=N||{};var U={};for(var H in ee)U[H]=new _t(ee[H].features,N),U[H].name=H,U[H].version=N.version,U[H].extent=N.extent;return xt({layers:U})},Te.exports.GeoJSONWrapper=_t;var tt=m.bv(Te.exports);const rt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ee=>ee},It=Math.fround||(br=new Float32Array(1),ee=>(br[0]=+ee,br[0]));var br;const Oi=3,Si=5,Ni=6;class Hr{constructor(N){this.options=Object.assign(Object.create(rt),N),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(N){const{log:U,minZoom:H,maxZoom:J}=this.options;U&&console.time("total time");const _e=`prepare ${N.length} points`;U&&console.time(_e),this.points=N;const ve=[];for(let de=0;de<N.length;de++){const Ce=N[de];if(!Ce.geometry)continue;const[qe,Re]=Ce.geometry.coordinates,Ne=It(Ve(qe)),Ft=It(St(Re));ve.push(Ne,Ft,1/0,de,-1,1),this.options.reduce&&ve.push(0)}let we=this.trees[J+1]=this._createTree(ve);U&&console.timeEnd(_e);for(let de=J;de>=H;de--){const Ce=+Date.now();we=this.trees[de]=this._createTree(this._cluster(we,de)),U&&console.log("z%d: %d clusters in %dms",de,we.numItems,+Date.now()-Ce)}return U&&console.timeEnd("total time"),this}getClusters(N,U){let H=((N[0]+180)%360+360)%360-180;const J=Math.max(-90,Math.min(90,N[1]));let _e=N[2]===180?180:((N[2]+180)%360+360)%360-180;const ve=Math.max(-90,Math.min(90,N[3]));if(N[2]-N[0]>=360)H=-180,_e=180;else if(H>_e){const Re=this.getClusters([H,J,180,ve],U),Ne=this.getClusters([-180,J,_e,ve],U);return Re.concat(Ne)}const we=this.trees[this._limitZoom(U)],de=we.range(Ve(H),St(ve),Ve(_e),St(J)),Ce=we.data,qe=[];for(const Re of de){const Ne=this.stride*Re;qe.push(Ce[Ne+Si]>1?lr(Ce,Ne,this.clusterProps):this.points[Ce[Ne+Oi]])}return qe}getChildren(N){const U=this._getOriginId(N),H=this._getOriginZoom(N),J="No cluster with the specified id.",_e=this.trees[H];if(!_e)throw new Error(J);const ve=_e.data;if(U*this.stride>=ve.length)throw new Error(J);const we=this.options.radius/(this.options.extent*Math.pow(2,H-1)),de=_e.within(ve[U*this.stride],ve[U*this.stride+1],we),Ce=[];for(const qe of de){const Re=qe*this.stride;ve[Re+4]===N&&Ce.push(ve[Re+Si]>1?lr(ve,Re,this.clusterProps):this.points[ve[Re+Oi]])}if(Ce.length===0)throw new Error(J);return Ce}getLeaves(N,U,H){const J=[];return this._appendLeaves(J,N,U=U||10,H=H||0,0),J}getTile(N,U,H){const J=this.trees[this._limitZoom(N)],_e=Math.pow(2,N),{extent:ve,radius:we}=this.options,de=we/ve,Ce=(H-de)/_e,qe=(H+1+de)/_e,Re={features:[]};return this._addTileFeatures(J.range((U-de)/_e,Ce,(U+1+de)/_e,qe),J.data,U,H,_e,Re),U===0&&this._addTileFeatures(J.range(1-de/_e,Ce,1,qe),J.data,_e,H,_e,Re),U===_e-1&&this._addTileFeatures(J.range(0,Ce,de/_e,qe),J.data,-1,H,_e,Re),Re.features.length?Re:null}getClusterExpansionZoom(N){let U=this._getOriginZoom(N)-1;for(;U<=this.options.maxZoom;){const H=this.getChildren(N);if(U++,H.length!==1)break;N=H[0].properties.cluster_id}return U}_appendLeaves(N,U,H,J,_e){const ve=this.getChildren(U);for(const we of ve){const de=we.properties;if(de&&de.cluster?_e+de.point_count<=J?_e+=de.point_count:_e=this._appendLeaves(N,de.cluster_id,H,J,_e):_e<J?_e++:N.push(we),N.length===H)break}return _e}_createTree(N){const U=new m.au(N.length/this.stride|0,this.options.nodeSize,Float32Array);for(let H=0;H<N.length;H+=this.stride)U.add(N[H],N[H+1]);return U.finish(),U.data=N,U}_addTileFeatures(N,U,H,J,_e,ve){for(const we of N){const de=we*this.stride,Ce=U[de+Si]>1;let qe,Re,Ne;if(Ce)qe=Ci(U,de,this.clusterProps),Re=U[de],Ne=U[de+1];else{const Qt=this.points[U[de+Oi]];qe=Qt.properties;const[ti,mi]=Qt.geometry.coordinates;Re=Ve(ti),Ne=St(mi)}const Ft={type:1,geometry:[[Math.round(this.options.extent*(Re*_e-H)),Math.round(this.options.extent*(Ne*_e-J))]],tags:qe};let Ut;Ut=Ce||this.options.generateId?U[de+Oi]:this.points[U[de+Oi]].id,Ut!==void 0&&(Ft.id=Ut),ve.features.push(Ft)}}_limitZoom(N){return Math.max(this.options.minZoom,Math.min(Math.floor(+N),this.options.maxZoom+1))}_cluster(N,U){const{radius:H,extent:J,reduce:_e,minPoints:ve}=this.options,we=H/(J*Math.pow(2,U)),de=N.data,Ce=[],qe=this.stride;for(let Re=0;Re<de.length;Re+=qe){if(de[Re+2]<=U)continue;de[Re+2]=U;const Ne=de[Re],Ft=de[Re+1],Ut=N.within(de[Re],de[Re+1],we),Qt=de[Re+Si];let ti=Qt;for(const mi of Ut){const Fi=mi*qe;de[Fi+2]>U&&(ti+=de[Fi+Si])}if(ti>Qt&&ti>=ve){let mi,Fi=Ne*Qt,ir=Ft*Qt,Or=-1;const Ht=((Re/qe|0)<<5)+(U+1)+this.points.length;for(const pr of Ut){const Ur=pr*qe;if(de[Ur+2]<=U)continue;de[Ur+2]=U;const gn=de[Ur+Si];Fi+=de[Ur]*gn,ir+=de[Ur+1]*gn,de[Ur+4]=Ht,_e&&(mi||(mi=this._map(de,Re,!0),Or=this.clusterProps.length,this.clusterProps.push(mi)),_e(mi,this._map(de,Ur)))}de[Re+4]=Ht,Ce.push(Fi/ti,ir/ti,1/0,Ht,-1,ti),_e&&Ce.push(Or)}else{for(let mi=0;mi<qe;mi++)Ce.push(de[Re+mi]);if(ti>1)for(const mi of Ut){const Fi=mi*qe;if(!(de[Fi+2]<=U)){de[Fi+2]=U;for(let ir=0;ir<qe;ir++)Ce.push(de[Fi+ir])}}}}return Ce}_getOriginId(N){return N-this.points.length>>5}_getOriginZoom(N){return(N-this.points.length)%32}_map(N,U,H){if(N[U+Si]>1){const ve=this.clusterProps[N[U+Ni]];return H?Object.assign({},ve):ve}const J=this.points[N[U+Oi]].properties,_e=this.options.map(J);return H&&_e===J?Object.assign({},_e):_e}}function lr(ee,N,U){return{type:"Feature",id:ee[N+Oi],properties:Ci(ee,N,U),geometry:{type:"Point",coordinates:[(H=ee[N],360*(H-.5)),lt(ee[N+1])]}};var H}function Ci(ee,N,U){const H=ee[N+Si],J=H>=1e4?`${Math.round(H/1e3)}k`:H>=1e3?Math.round(H/100)/10+"k":H,_e=ee[N+Ni],ve=_e===-1?{}:Object.assign({},U[_e]);return Object.assign(ve,{cluster:!0,cluster_id:ee[N+Oi],point_count:H,point_count_abbreviated:J})}function Ve(ee){return ee/360+.5}function St(ee){const N=Math.sin(ee*Math.PI/180),U=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return U<0?0:U>1?1:U}function lt(ee){const N=(180-360*ee)*Math.PI/180;return 360*Math.atan(Math.exp(N))/Math.PI-90}function Ye(ee,N,U,H){for(var J,_e=H,ve=U-N>>1,we=U-N,de=ee[N],Ce=ee[N+1],qe=ee[U],Re=ee[U+1],Ne=N+3;Ne<U;Ne+=3){var Ft=Ii(ee[Ne],ee[Ne+1],de,Ce,qe,Re);if(Ft>_e)J=Ne,_e=Ft;else if(Ft===_e){var Ut=Math.abs(Ne-ve);Ut<we&&(J=Ne,we=Ut)}}_e>H&&(J-N>3&&Ye(ee,N,J,H),ee[J+2]=_e,U-J>3&&Ye(ee,J,U,H))}function Ii(ee,N,U,H,J,_e){var ve=J-U,we=_e-H;if(ve!==0||we!==0){var de=((ee-U)*ve+(N-H)*we)/(ve*ve+we*we);de>1?(U=J,H=_e):de>0&&(U+=ve*de,H+=we*de)}return(ve=ee-U)*ve+(we=N-H)*we}function ki(ee,N,U,H){var J={id:ee===void 0?null:ee,type:N,geometry:U,tags:H,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(_e){var ve=_e.geometry,we=_e.type;if(we==="Point"||we==="MultiPoint"||we==="LineString")ne(_e,ve);else if(we==="Polygon"||we==="MultiLineString")for(var de=0;de<ve.length;de++)ne(_e,ve[de]);else if(we==="MultiPolygon")for(de=0;de<ve.length;de++)for(var Ce=0;Ce<ve[de].length;Ce++)ne(_e,ve[de][Ce])}(J),J}function ne(ee,N){for(var U=0;U<N.length;U+=3)ee.minX=Math.min(ee.minX,N[U]),ee.minY=Math.min(ee.minY,N[U+1]),ee.maxX=Math.max(ee.maxX,N[U]),ee.maxY=Math.max(ee.maxY,N[U+1])}function ue(ee,N,U,H){if(N.geometry){var J=N.geometry.coordinates,_e=N.geometry.type,ve=Math.pow(U.tolerance/((1<<U.maxZoom)*U.extent),2),we=[],de=N.id;if(U.promoteId?de=N.properties[U.promoteId]:U.generateId&&(de=H||0),_e==="Point")De(J,we);else if(_e==="MultiPoint")for(var Ce=0;Ce<J.length;Ce++)De(J[Ce],we);else if(_e==="LineString")Oe(J,we,ve,!1);else if(_e==="MultiLineString"){if(U.lineMetrics){for(Ce=0;Ce<J.length;Ce++)Oe(J[Ce],we=[],ve,!1),ee.push(ki(de,"LineString",we,N.properties));return}ce(J,we,ve,!1)}else if(_e==="Polygon")ce(J,we,ve,!0);else{if(_e!=="MultiPolygon"){if(_e==="GeometryCollection"){for(Ce=0;Ce<N.geometry.geometries.length;Ce++)ue(ee,{id:de,geometry:N.geometry.geometries[Ce],properties:N.properties},U,H);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ce=0;Ce<J.length;Ce++){var qe=[];ce(J[Ce],qe,ve,!0),we.push(qe)}}ee.push(ki(de,_e,we,N.properties))}}function De(ee,N){N.push(ut(ee[0])),N.push(Ct(ee[1])),N.push(0)}function Oe(ee,N,U,H){for(var J,_e,ve=0,we=0;we<ee.length;we++){var de=ut(ee[we][0]),Ce=Ct(ee[we][1]);N.push(de),N.push(Ce),N.push(0),we>0&&(ve+=H?(J*Ce-de*_e)/2:Math.sqrt(Math.pow(de-J,2)+Math.pow(Ce-_e,2))),J=de,_e=Ce}var qe=N.length-3;N[2]=1,Ye(N,0,qe,U),N[qe+2]=1,N.size=Math.abs(ve),N.start=0,N.end=N.size}function ce(ee,N,U,H){for(var J=0;J<ee.length;J++){var _e=[];Oe(ee[J],_e,U,H),N.push(_e)}}function ut(ee){return ee/360+.5}function Ct(ee){var N=Math.sin(ee*Math.PI/180),U=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return U<0?0:U>1?1:U}function Be(ee,N,U,H,J,_e,ve,we){if(H/=N,_e>=(U/=N)&&ve<H)return ee;if(ve<U||_e>=H)return null;for(var de=[],Ce=0;Ce<ee.length;Ce++){var qe=ee[Ce],Re=qe.geometry,Ne=qe.type,Ft=J===0?qe.minX:qe.minY,Ut=J===0?qe.maxX:qe.maxY;if(Ft>=U&&Ut<H)de.push(qe);else if(!(Ut<U||Ft>=H)){var Qt=[];if(Ne==="Point"||Ne==="MultiPoint")it(Re,Qt,U,H,J);else if(Ne==="LineString")et(Re,Qt,U,H,J,!1,we.lineMetrics);else if(Ne==="MultiLineString")Gt(Re,Qt,U,H,J,!1);else if(Ne==="Polygon")Gt(Re,Qt,U,H,J,!0);else if(Ne==="MultiPolygon")for(var ti=0;ti<Re.length;ti++){var mi=[];Gt(Re[ti],mi,U,H,J,!0),mi.length&&Qt.push(mi)}if(Qt.length){if(we.lineMetrics&&Ne==="LineString"){for(ti=0;ti<Qt.length;ti++)de.push(ki(qe.id,Ne,Qt[ti],qe.tags));continue}Ne!=="LineString"&&Ne!=="MultiLineString"||(Qt.length===1?(Ne="LineString",Qt=Qt[0]):Ne="MultiLineString"),Ne!=="Point"&&Ne!=="MultiPoint"||(Ne=Qt.length===3?"Point":"MultiPoint"),de.push(ki(qe.id,Ne,Qt,qe.tags))}}}return de.length?de:null}function it(ee,N,U,H,J){for(var _e=0;_e<ee.length;_e+=3){var ve=ee[_e+J];ve>=U&&ve<=H&&(N.push(ee[_e]),N.push(ee[_e+1]),N.push(ee[_e+2]))}}function et(ee,N,U,H,J,_e,ve){for(var we,de,Ce=At(ee),qe=J===0?Zt:fi,Re=ee.start,Ne=0;Ne<ee.length-3;Ne+=3){var Ft=ee[Ne],Ut=ee[Ne+1],Qt=ee[Ne+2],ti=ee[Ne+3],mi=ee[Ne+4],Fi=J===0?Ft:Ut,ir=J===0?ti:mi,Or=!1;ve&&(we=Math.sqrt(Math.pow(Ft-ti,2)+Math.pow(Ut-mi,2))),Fi<U?ir>U&&(de=qe(Ce,Ft,Ut,ti,mi,U),ve&&(Ce.start=Re+we*de)):Fi>H?ir<H&&(de=qe(Ce,Ft,Ut,ti,mi,H),ve&&(Ce.start=Re+we*de)):jt(Ce,Ft,Ut,Qt),ir<U&&Fi>=U&&(de=qe(Ce,Ft,Ut,ti,mi,U),Or=!0),ir>H&&Fi<=H&&(de=qe(Ce,Ft,Ut,ti,mi,H),Or=!0),!_e&&Or&&(ve&&(Ce.end=Re+we*de),N.push(Ce),Ce=At(ee)),ve&&(Re+=we)}var Ht=ee.length-3;Ft=ee[Ht],Ut=ee[Ht+1],Qt=ee[Ht+2],(Fi=J===0?Ft:Ut)>=U&&Fi<=H&&jt(Ce,Ft,Ut,Qt),Ht=Ce.length-3,_e&&Ht>=3&&(Ce[Ht]!==Ce[0]||Ce[Ht+1]!==Ce[1])&&jt(Ce,Ce[0],Ce[1],Ce[2]),Ce.length&&N.push(Ce)}function At(ee){var N=[];return N.size=ee.size,N.start=ee.start,N.end=ee.end,N}function Gt(ee,N,U,H,J,_e){for(var ve=0;ve<ee.length;ve++)et(ee[ve],N,U,H,J,_e,!1)}function jt(ee,N,U,H){ee.push(N),ee.push(U),ee.push(H)}function Zt(ee,N,U,H,J,_e){var ve=(_e-N)/(H-N);return ee.push(_e),ee.push(U+(J-U)*ve),ee.push(1),ve}function fi(ee,N,U,H,J,_e){var ve=(_e-U)/(J-U);return ee.push(N+(H-N)*ve),ee.push(_e),ee.push(1),ve}function bi(ee,N){for(var U=[],H=0;H<ee.length;H++){var J,_e=ee[H],ve=_e.type;if(ve==="Point"||ve==="MultiPoint"||ve==="LineString")J=Ue(_e.geometry,N);else if(ve==="MultiLineString"||ve==="Polygon"){J=[];for(var we=0;we<_e.geometry.length;we++)J.push(Ue(_e.geometry[we],N))}else if(ve==="MultiPolygon")for(J=[],we=0;we<_e.geometry.length;we++){for(var de=[],Ce=0;Ce<_e.geometry[we].length;Ce++)de.push(Ue(_e.geometry[we][Ce],N));J.push(de)}U.push(ki(_e.id,ve,J,_e.tags))}return U}function Ue(ee,N){var U=[];U.size=ee.size,ee.start!==void 0&&(U.start=ee.start,U.end=ee.end);for(var H=0;H<ee.length;H+=3)U.push(ee[H]+N,ee[H+1],ee[H+2]);return U}function Ri(ee,N){if(ee.transformed)return ee;var U,H,J,_e=1<<ee.z,ve=ee.x,we=ee.y;for(U=0;U<ee.features.length;U++){var de=ee.features[U],Ce=de.geometry,qe=de.type;if(de.geometry=[],qe===1)for(H=0;H<Ce.length;H+=2)de.geometry.push(Zi(Ce[H],Ce[H+1],N,_e,ve,we));else for(H=0;H<Ce.length;H++){var Re=[];for(J=0;J<Ce[H].length;J+=2)Re.push(Zi(Ce[H][J],Ce[H][J+1],N,_e,ve,we));de.geometry.push(Re)}}return ee.transformed=!0,ee}function Zi(ee,N,U,H,J,_e){return[Math.round(U*(ee*H-J)),Math.round(U*(N*H-_e))]}function pn(ee,N,U,H,J){for(var _e=N===J.maxZoom?0:J.tolerance/((1<<N)*J.extent),ve={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:U,y:H,z:N,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},we=0;we<ee.length;we++){ve.numFeatures++,wr(ve,ee[we],_e,J);var de=ee[we].minX,Ce=ee[we].minY,qe=ee[we].maxX,Re=ee[we].maxY;de<ve.minX&&(ve.minX=de),Ce<ve.minY&&(ve.minY=Ce),qe>ve.maxX&&(ve.maxX=qe),Re>ve.maxY&&(ve.maxY=Re)}return ve}function wr(ee,N,U,H){var J=N.geometry,_e=N.type,ve=[];if(_e==="Point"||_e==="MultiPoint")for(var we=0;we<J.length;we+=3)ve.push(J[we]),ve.push(J[we+1]),ee.numPoints++,ee.numSimplified++;else if(_e==="LineString")nt(ve,J,ee,U,!1,!1);else if(_e==="MultiLineString"||_e==="Polygon")for(we=0;we<J.length;we++)nt(ve,J[we],ee,U,_e==="Polygon",we===0);else if(_e==="MultiPolygon")for(var de=0;de<J.length;de++){var Ce=J[de];for(we=0;we<Ce.length;we++)nt(ve,Ce[we],ee,U,!0,we===0)}if(ve.length){var qe=N.tags||null;if(_e==="LineString"&&H.lineMetrics){for(var Re in qe={},N.tags)qe[Re]=N.tags[Re];qe.mapbox_clip_start=J.start/J.size,qe.mapbox_clip_end=J.end/J.size}var Ne={geometry:ve,type:_e==="Polygon"||_e==="MultiPolygon"?3:_e==="LineString"||_e==="MultiLineString"?2:1,tags:qe};N.id!==null&&(Ne.id=N.id),ee.features.push(Ne)}}function nt(ee,N,U,H,J,_e){var ve=H*H;if(H>0&&N.size<(J?ve:H))U.numPoints+=N.length/3;else{for(var we=[],de=0;de<N.length;de+=3)(H===0||N[de+2]>ve)&&(U.numSimplified++,we.push(N[de]),we.push(N[de+1])),U.numPoints++;J&&function(Ce,qe){for(var Re=0,Ne=0,Ft=Ce.length,Ut=Ft-2;Ne<Ft;Ut=Ne,Ne+=2)Re+=(Ce[Ne]-Ce[Ut])*(Ce[Ne+1]+Ce[Ut+1]);if(Re>0===qe)for(Ne=0,Ft=Ce.length;Ne<Ft/2;Ne+=2){var Qt=Ce[Ne],ti=Ce[Ne+1];Ce[Ne]=Ce[Ft-2-Ne],Ce[Ne+1]=Ce[Ft-1-Ne],Ce[Ft-2-Ne]=Qt,Ce[Ft-1-Ne]=ti}}(we,_e),ee.push(we)}}function ai(ee,N){var U=(N=this.options=function(J,_e){for(var ve in _e)J[ve]=_e[ve];return J}(Object.create(this.options),N)).debug;if(U&&console.time("preprocess data"),N.maxZoom<0||N.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(N.promoteId&&N.generateId)throw new Error("promoteId and generateId cannot be used together.");var H=function(J,_e){var ve=[];if(J.type==="FeatureCollection")for(var we=0;we<J.features.length;we++)ue(ve,J.features[we],_e,we);else ue(ve,J.type==="Feature"?J:{geometry:J},_e);return ve}(ee,N);this.tiles={},this.tileCoords=[],U&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",N.indexMaxZoom,N.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),H=function(J,_e){var ve=_e.buffer/_e.extent,we=J,de=Be(J,1,-1-ve,ve,0,-1,2,_e),Ce=Be(J,1,1-ve,2+ve,0,-1,2,_e);return(de||Ce)&&(we=Be(J,1,-ve,1+ve,0,-1,2,_e)||[],de&&(we=bi(de,1).concat(we)),Ce&&(we=we.concat(bi(Ce,-1)))),we}(H,N),H.length&&this.splitTile(H,0,0,0),U&&(H.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ot(ee,N,U){return 32*((1<<ee)*U+N)+ee}function $i(ee,N){return N?ee.properties[N]:ee.id}function mn(ee,N){if(ee==null)return!0;if(ee.type==="Feature")return $i(ee,N)!=null;if(ee.type==="FeatureCollection"){const U=new Set;for(const H of ee.features){const J=$i(H,N);if(J==null||U.has(J))return!1;U.add(J)}return!0}return!1}function Jt(ee,N){const U=new Map;if(ee!=null)if(ee.type==="Feature")U.set($i(ee,N),ee);else for(const H of ee.features)U.set($i(H,N),H);return U}ai.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ai.prototype.splitTile=function(ee,N,U,H,J,_e,ve){for(var we=[ee,N,U,H],de=this.options,Ce=de.debug;we.length;){H=we.pop(),U=we.pop(),N=we.pop(),ee=we.pop();var qe=1<<N,Re=Ot(N,U,H),Ne=this.tiles[Re];if(!Ne&&(Ce>1&&console.time("creation"),Ne=this.tiles[Re]=pn(ee,N,U,H,de),this.tileCoords.push({z:N,x:U,y:H}),Ce)){Ce>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",N,U,H,Ne.numFeatures,Ne.numPoints,Ne.numSimplified),console.timeEnd("creation"));var Ft="z"+N;this.stats[Ft]=(this.stats[Ft]||0)+1,this.total++}if(Ne.source=ee,J){if(N===de.maxZoom||N===J)continue;var Ut=1<<J-N;if(U!==Math.floor(_e/Ut)||H!==Math.floor(ve/Ut))continue}else if(N===de.indexMaxZoom||Ne.numPoints<=de.indexMaxPoints)continue;if(Ne.source=null,ee.length!==0){Ce>1&&console.time("clipping");var Qt,ti,mi,Fi,ir,Or,Ht=.5*de.buffer/de.extent,pr=.5-Ht,Ur=.5+Ht,gn=1+Ht;Qt=ti=mi=Fi=null,ir=Be(ee,qe,U-Ht,U+Ur,0,Ne.minX,Ne.maxX,de),Or=Be(ee,qe,U+pr,U+gn,0,Ne.minX,Ne.maxX,de),ee=null,ir&&(Qt=Be(ir,qe,H-Ht,H+Ur,1,Ne.minY,Ne.maxY,de),ti=Be(ir,qe,H+pr,H+gn,1,Ne.minY,Ne.maxY,de),ir=null),Or&&(mi=Be(Or,qe,H-Ht,H+Ur,1,Ne.minY,Ne.maxY,de),Fi=Be(Or,qe,H+pr,H+gn,1,Ne.minY,Ne.maxY,de),Or=null),Ce>1&&console.timeEnd("clipping"),we.push(Qt||[],N+1,2*U,2*H),we.push(ti||[],N+1,2*U,2*H+1),we.push(mi||[],N+1,2*U+1,2*H),we.push(Fi||[],N+1,2*U+1,2*H+1)}}},ai.prototype.getTile=function(ee,N,U){var H=this.options,J=H.extent,_e=H.debug;if(ee<0||ee>24)return null;var ve=1<<ee,we=Ot(ee,N=(N%ve+ve)%ve,U);if(this.tiles[we])return Ri(this.tiles[we],J);_e>1&&console.log("drilling down to z%d-%d-%d",ee,N,U);for(var de,Ce=ee,qe=N,Re=U;!de&&Ce>0;)Ce--,qe=Math.floor(qe/2),Re=Math.floor(Re/2),de=this.tiles[Ot(Ce,qe,Re)];return de&&de.source?(_e>1&&console.log("found parent tile z%d-%d-%d",Ce,qe,Re),_e>1&&console.time("drilling down"),this.splitTile(de.source,Ce,qe,Re,ee,N,U),_e>1&&console.timeEnd("drilling down"),this.tiles[we]?Ri(this.tiles[we],J):null):null};class Ws extends D{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(N,U){return m._(this,void 0,void 0,function*(){const H=N.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const J=this._geoJSONIndex.getTile(H.z,H.x,H.y);if(!J)return null;const _e=new class{constructor(we){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.W,this.length=we.length,this._features=we}feature(we){return new class{constructor(de){this._feature=de,this.extent=m.W,this.type=de.type,this.properties=de.tags,"id"in de&&!isNaN(de.id)&&(this.id=parseInt(de.id,10))}loadGeometry(){if(this._feature.type===1){const de=[];for(const Ce of this._feature.geometry)de.push([new m.P(Ce[0],Ce[1])]);return de}{const de=[];for(const Ce of this._feature.geometry){const qe=[];for(const Re of Ce)qe.push(new m.P(Re[0],Re[1]));de.push(qe)}return de}}toGeoJSON(de,Ce,qe){return me.call(this,de,Ce,qe)}}(this._features[we])}}(J.features);let ve=tt(_e);return ve.byteOffset===0&&ve.byteLength===ve.buffer.byteLength||(ve=new Uint8Array(ve)),{vectorTile:_e,rawData:ve.buffer}})}loadData(N){return m._(this,void 0,void 0,function*(){var U;(U=this._pendingRequest)===null||U===void 0||U.abort();const H=!!(N&&N.request&&N.request.collectResourceTiming)&&new m.bs(N.request);this._pendingRequest=new AbortController;try{let J=yield this.loadGeoJSON(N,this._pendingRequest);if(delete this._pendingRequest,typeof J!="object")throw new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`);if(Y(J,!0),N.filter){const ve=m.by(N.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ve.result==="error")throw new Error(ve.value.map(de=>`${de.key}: ${de.message}`).join(", "));J={type:"FeatureCollection",features:J.features.filter(de=>ve.value.evaluate({zoom:0},de))}}this._geoJSONIndex=N.cluster?new Hr(function({superclusterOptions:ve,clusterProperties:we}){if(!we||!ve)return ve;const de={},Ce={},qe={accumulated:null,zoom:0},Re={properties:null},Ne=Object.keys(we);for(const Ft of Ne){const[Ut,Qt]=we[Ft],ti=m.by(Qt),mi=m.by(typeof Ut=="string"?[Ut,["accumulated"],["get",Ft]]:Ut);de[Ft]=ti.value,Ce[Ft]=mi.value}return ve.map=Ft=>{Re.properties=Ft;const Ut={};for(const Qt of Ne)Ut[Qt]=de[Qt].evaluate(qe,Re);return Ut},ve.reduce=(Ft,Ut)=>{Re.properties=Ut;for(const Qt of Ne)qe.accumulated=Ft[Qt],Ft[Qt]=Ce[Qt].evaluate(qe,Re)},ve}(N)).load(J.features):function(ve,we){return new ai(ve,we)}(J,N.geojsonVtOptions),this.loaded={};const _e={};if(H){const ve=H.finish();ve&&(_e.resourceTiming={},_e.resourceTiming[N.source]=JSON.parse(JSON.stringify(ve)))}return _e}catch(J){if(delete this._pendingRequest,m.bz(J))return{abandoned:!0};throw J}})}reloadTile(N){const U=this.loaded;return U&&U[N.uid]?super.reloadTile(N):this.loadTile(N)}loadGeoJSON(N,U){return m._(this,void 0,void 0,function*(){const{promoteId:H}=N;if(N.request){const J=yield m.h(N.request,U);return this._dataUpdateable=mn(J.data,H)?Jt(J.data,H):void 0,J.data}if(typeof N.data=="string")try{const J=JSON.parse(N.data);return this._dataUpdateable=mn(J,H)?Jt(J,H):void 0,J}catch{throw new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`)}if(!N.dataDiff)throw new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${N.source}`);return function(J,_e,ve){var we,de,Ce,qe;if(_e.removeAll&&J.clear(),_e.remove)for(const Re of _e.remove)J.delete(Re);if(_e.add)for(const Re of _e.add){const Ne=$i(Re,ve);Ne!=null&&J.set(Ne,Re)}if(_e.update)for(const Re of _e.update){let Ne=J.get(Re.id);if(Ne==null)continue;const Ft=!Re.removeAllProperties&&(((we=Re.removeProperties)===null||we===void 0?void 0:we.length)>0||((de=Re.addOrUpdateProperties)===null||de===void 0?void 0:de.length)>0);if((Re.newGeometry||Re.removeAllProperties||Ft)&&(Ne=Object.assign({},Ne),J.set(Re.id,Ne),Ft&&(Ne.properties=Object.assign({},Ne.properties))),Re.newGeometry&&(Ne.geometry=Re.newGeometry),Re.removeAllProperties)Ne.properties={};else if(((Ce=Re.removeProperties)===null||Ce===void 0?void 0:Ce.length)>0)for(const Ut of Re.removeProperties)Object.prototype.hasOwnProperty.call(Ne.properties,Ut)&&delete Ne.properties[Ut];if(((qe=Re.addOrUpdateProperties)===null||qe===void 0?void 0:qe.length)>0)for(const{key:Ut,value:Qt}of Re.addOrUpdateProperties)Ne.properties[Ut]=Qt}}(this._dataUpdateable,N.dataDiff,H),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(N){return m._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(N){return this._geoJSONIndex.getClusterExpansionZoom(N.clusterId)}getClusterChildren(N){return this._geoJSONIndex.getChildren(N.clusterId)}getClusterLeaves(N){return this._geoJSONIndex.getLeaves(N.clusterId,N.limit,N.offset)}}class Mr{constructor(N){this.self=N,this.actor=new m.C(N),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(U,H)=>{if(this.externalWorkerSourceTypes[U])throw new Error(`Worker source with name "${U}" already registered.`);this.externalWorkerSourceTypes[U]=H},this.self.addProtocol=m.bf,this.self.removeProtocol=m.bg,this.self.registerRTLTextPlugin=U=>{if(m.bA.isParsed())throw new Error("RTL text plugin already registered.");m.bA.setMethods(U)},this.actor.registerMessageHandler("LDT",(U,H)=>this._getDEMWorkerSource(U,H.source).loadTile(H)),this.actor.registerMessageHandler("RDT",(U,H)=>m._(this,void 0,void 0,function*(){this._getDEMWorkerSource(U,H.source).removeTile(H)})),this.actor.registerMessageHandler("GCEZ",(U,H)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(U,H.type,H.source).getClusterExpansionZoom(H)})),this.actor.registerMessageHandler("GCC",(U,H)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(U,H.type,H.source).getClusterChildren(H)})),this.actor.registerMessageHandler("GCL",(U,H)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(U,H.type,H.source).getClusterLeaves(H)})),this.actor.registerMessageHandler("LD",(U,H)=>this._getWorkerSource(U,H.type,H.source).loadData(H)),this.actor.registerMessageHandler("LT",(U,H)=>this._getWorkerSource(U,H.type,H.source).loadTile(H)),this.actor.registerMessageHandler("RT",(U,H)=>this._getWorkerSource(U,H.type,H.source).reloadTile(H)),this.actor.registerMessageHandler("AT",(U,H)=>this._getWorkerSource(U,H.type,H.source).abortTile(H)),this.actor.registerMessageHandler("RMT",(U,H)=>this._getWorkerSource(U,H.type,H.source).removeTile(H)),this.actor.registerMessageHandler("RS",(U,H)=>m._(this,void 0,void 0,function*(){if(!this.workerSources[U]||!this.workerSources[U][H.type]||!this.workerSources[U][H.type][H.source])return;const J=this.workerSources[U][H.type][H.source];delete this.workerSources[U][H.type][H.source],J.removeSource!==void 0&&J.removeSource(H)})),this.actor.registerMessageHandler("RM",U=>m._(this,void 0,void 0,function*(){delete this.layerIndexes[U],delete this.availableImages[U],delete this.workerSources[U],delete this.demWorkerSources[U]})),this.actor.registerMessageHandler("SR",(U,H)=>m._(this,void 0,void 0,function*(){this.referrer=H})),this.actor.registerMessageHandler("SRPS",(U,H)=>this._syncRTLPluginState(U,H)),this.actor.registerMessageHandler("IS",(U,H)=>m._(this,void 0,void 0,function*(){this.self.importScripts(H)})),this.actor.registerMessageHandler("SI",(U,H)=>this._setImages(U,H)),this.actor.registerMessageHandler("UL",(U,H)=>m._(this,void 0,void 0,function*(){this._getLayerIndex(U).update(H.layers,H.removedIds)})),this.actor.registerMessageHandler("SL",(U,H)=>m._(this,void 0,void 0,function*(){this._getLayerIndex(U).replace(H)}))}_setImages(N,U){return m._(this,void 0,void 0,function*(){this.availableImages[N]=U;for(const H in this.workerSources[N]){const J=this.workerSources[N][H];for(const _e in J)J[_e].availableImages=U}})}_syncRTLPluginState(N,U){return m._(this,void 0,void 0,function*(){if(m.bA.isParsed())return m.bA.getState();if(U.pluginStatus!=="loading")return m.bA.setState(U),U;const H=U.pluginURL;if(this.self.importScripts(H),m.bA.isParsed()){const J={pluginStatus:"loaded",pluginURL:H};return m.bA.setState(J),J}throw m.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${H}`)})}_getAvailableImages(N){let U=this.availableImages[N];return U||(U=[]),U}_getLayerIndex(N){let U=this.layerIndexes[N];return U||(U=this.layerIndexes[N]=new l),U}_getWorkerSource(N,U,H){if(this.workerSources[N]||(this.workerSources[N]={}),this.workerSources[N][U]||(this.workerSources[N][U]={}),!this.workerSources[N][U][H]){const J={sendAsync:(_e,ve)=>(_e.targetMapId=N,this.actor.sendAsync(_e,ve))};switch(U){case"vector":this.workerSources[N][U][H]=new D(J,this._getLayerIndex(N),this._getAvailableImages(N));break;case"geojson":this.workerSources[N][U][H]=new Ws(J,this._getLayerIndex(N),this._getAvailableImages(N));break;default:this.workerSources[N][U][H]=new this.externalWorkerSourceTypes[U](J,this._getLayerIndex(N),this._getAvailableImages(N))}}return this.workerSources[N][U][H]}_getDEMWorkerSource(N,U){return this.demWorkerSources[N]||(this.demWorkerSources[N]={}),this.demWorkerSources[N][U]||(this.demWorkerSources[N][U]=new z),this.demWorkerSources[N][U]}}return m.i(self)&&(self.worker=new Mr(self)),Mr}),d("index",["exports","./shared"],function(m,l){var T="4.1.3";let P,R;const D={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:g=>new Promise((i,o)=>{const h=requestAnimationFrame(i);g.signal.addEventListener("abort",()=>{cancelAnimationFrame(h),o(l.c())})}),getImageData(g,i=0){return this.getImageCanvasContext(g).getImageData(-i,-i,g.width+2*i,g.height+2*i)},getImageCanvasContext(g){const i=window.document.createElement("canvas"),o=i.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return i.width=g.width,i.height=g.height,o.drawImage(g,0,0,g.width,g.height),o},resolveURL:g=>(P||(P=document.createElement("a")),P.href=g,P.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(R==null&&(R=matchMedia("(prefers-reduced-motion: reduce)")),R.matches)}};class z{static testProp(i){if(!z.docStyle)return i[0];for(let o=0;o<i.length;o++)if(i[o]in z.docStyle)return i[o];return i[0]}static create(i,o,h){const f=window.document.createElement(i);return o!==void 0&&(f.className=o),h&&h.appendChild(f),f}static createNS(i,o){return window.document.createElementNS(i,o)}static disableDrag(){z.docStyle&&z.selectProp&&(z.userSelect=z.docStyle[z.selectProp],z.docStyle[z.selectProp]="none")}static enableDrag(){z.docStyle&&z.selectProp&&(z.docStyle[z.selectProp]=z.userSelect)}static setTransform(i,o){i.style[z.transformProp]=o}static addEventListener(i,o,h,f={}){i.addEventListener(o,h,"passive"in f?f:f.capture)}static removeEventListener(i,o,h,f={}){i.removeEventListener(o,h,"passive"in f?f:f.capture)}static suppressClickInternal(i){i.preventDefault(),i.stopPropagation(),window.removeEventListener("click",z.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",z.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",z.suppressClickInternal,!0)},0)}static getScale(i){const o=i.getBoundingClientRect();return{x:o.width/i.offsetWidth||1,y:o.height/i.offsetHeight||1,boundingClientRect:o}}static getPoint(i,o,h){const f=o.boundingClientRect;return new l.P((h.clientX-f.left)/o.x-i.clientLeft,(h.clientY-f.top)/o.y-i.clientTop)}static mousePos(i,o){const h=z.getScale(i);return z.getPoint(i,h,o)}static touchPos(i,o){const h=[],f=z.getScale(i);for(let _=0;_<o.length;_++)h.push(z.getPoint(i,f,o[_]));return h}static mouseButton(i){return i.button}static remove(i){i.parentNode&&i.parentNode.removeChild(i)}}z.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,z.selectProp=z.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),z.transformProp=z.testProp(["transform","WebkitTransform"]);const Z={supported:!1,testSupport:function(g){!me&&Y&&(Te?Fe(g):K=g)}};let K,Y,me=!1,Te=!1;function Fe(g){const i=g.createTexture();g.bindTexture(g.TEXTURE_2D,i);try{if(g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,Y),g.isContextLost())return;Z.supported=!0}catch{}g.deleteTexture(i),me=!0}var ae;typeof document<"u"&&(Y=document.createElement("img"),Y.onload=function(){K&&Fe(K),K=null,Te=!0},Y.onerror=function(){me=!0,K=null},Y.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(g){let i,o,h,f;g.resetRequestQueue=()=>{i=[],o=0,h=0,f={}},g.addThrottleControl=C=>{const k=h++;return f[k]=C,k},g.removeThrottleControl=C=>{delete f[C],M()},g.getImage=(C,k,F=!0)=>new Promise((B,q)=>{Z.supported&&(C.headers||(C.headers={}),C.headers.accept="image/webp,*/*"),l.e(C,{type:"image"}),i.push({abortController:k,requestParameters:C,supportImageRefresh:F,state:"queued",onError:te=>{q(te)},onSuccess:te=>{B(te)}}),M()});const _=C=>l._(this,void 0,void 0,function*(){C.state="running";const{requestParameters:k,supportImageRefresh:F,onError:B,onSuccess:q,abortController:te}=C,Q=F===!1&&!l.i(self)&&!l.g(k.url)&&(!k.headers||Object.keys(k.headers).reduce((pe,Ie)=>pe&&Ie==="accept",!0));o++;const re=Q?S(k,te):l.m(k,te);try{const pe=yield re;delete C.abortController,C.state="completed",pe.data instanceof HTMLImageElement||l.b(pe.data)?q(pe):pe.data&&q({data:yield(W=pe.data,typeof createImageBitmap=="function"?l.d(W):l.f(W)),cacheControl:pe.cacheControl,expires:pe.expires})}catch(pe){delete C.abortController,B(pe)}finally{o--,M()}var W}),M=()=>{const C=(()=>{for(const k of Object.keys(f))if(f[k]())return!0;return!1})()?l.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let k=o;k<C&&i.length>0;k++){const F=i.shift();F.abortController.signal.aborted?k--:_(F)}},S=(C,k)=>new Promise((F,B)=>{const q=new Image,te=C.url,Q=C.credentials;Q&&Q==="include"?q.crossOrigin="use-credentials":(Q&&Q==="same-origin"||!l.s(te))&&(q.crossOrigin="anonymous"),k.signal.addEventListener("abort",()=>{q.src="",B(l.c())}),q.fetchPriority="high",q.onload=()=>{q.onerror=q.onload=null,F({data:q})},q.onerror=()=>{q.onerror=q.onload=null,k.signal.aborted||B(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},q.src=te})}(ae||(ae={})),ae.resetRequestQueue();class Pe{constructor(i){this._transformRequestFn=i}transformRequest(i,o){return this._transformRequestFn&&this._transformRequestFn(i,o)||{url:i}}normalizeSpriteURL(i,o,h){const f=function(_){const M=_.match(Ze);if(!M)throw new Error(`Unable to parse URL "${_}"`);return{protocol:M[1],authority:M[2],path:M[3]||"/",params:M[4]?M[4].split("&"):[]}}(i);return f.path+=`${o}${h}`,function(_){const M=_.params.length?`?${_.params.join("&")}`:"";return`${_.protocol}://${_.authority}${_.path}${M}`}(f)}setTransformRequest(i){this._transformRequestFn=i}}const Ze=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Je(g){var i=new l.A(3);return i[0]=g[0],i[1]=g[1],i[2]=g[2],i}var dt,_t=function(g,i,o){return g[0]=i[0]-o[0],g[1]=i[1]-o[1],g[2]=i[2]-o[2],g};dt=new l.A(3),l.A!=Float32Array&&(dt[0]=0,dt[1]=0,dt[2]=0);var xt=function(g){var i=g[0],o=g[1];return i*i+o*o};function Vt(g){const i=[];if(typeof g=="string")i.push({id:"default",url:g});else if(g&&g.length>0){const o=[];for(const{id:h,url:f}of g){const _=`${h}${f}`;o.indexOf(_)===-1&&(o.push(_),i.push({id:h,url:f}))}}return i}(function(){var g=new l.A(2);l.A!=Float32Array&&(g[0]=0,g[1]=0)})();class kt{constructor(i,o,h,f){this.context=i,this.format=h,this.texture=i.gl.createTexture(),this.update(o,f)}update(i,o,h){const{width:f,height:_}=i,M=!(this.size&&this.size[0]===f&&this.size[1]===_||h),{context:S}=this,{gl:C}=S;if(this.useMipmap=!!(o&&o.useMipmap),C.bindTexture(C.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===C.RGBA&&(!o||o.premultiply!==!1)),M)this.size=[f,_],i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||l.b(i)?C.texImage2D(C.TEXTURE_2D,0,this.format,this.format,C.UNSIGNED_BYTE,i):C.texImage2D(C.TEXTURE_2D,0,this.format,f,_,0,this.format,C.UNSIGNED_BYTE,i.data);else{const{x:k,y:F}=h||{x:0,y:0};i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||l.b(i)?C.texSubImage2D(C.TEXTURE_2D,0,k,F,C.RGBA,C.UNSIGNED_BYTE,i):C.texSubImage2D(C.TEXTURE_2D,0,k,F,f,_,C.RGBA,C.UNSIGNED_BYTE,i.data)}this.useMipmap&&this.isSizePowerOfTwo()&&C.generateMipmap(C.TEXTURE_2D)}bind(i,o,h){const{context:f}=this,{gl:_}=f;_.bindTexture(_.TEXTURE_2D,this.texture),h!==_.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(h=_.LINEAR),i!==this.filter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,i),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,h||i),this.filter=i),o!==this.wrap&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,o),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}function ri(g){const{userImage:i}=g;return!!(i&&i.render&&i.render())&&(g.data.replace(new Uint8Array(i.data.buffer)),!0)}class xi extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:o,promiseResolve:h}of this.requestors)h(this._getImagesForIds(o));this.requestors=[]}}getImage(i){const o=this.images[i];if(o&&!o.data&&o.spriteData){const h=o.spriteData;o.data=new l.R({width:h.width,height:h.height},h.context.getImageData(h.x,h.y,h.width,h.height).data),o.spriteData=null}return o}addImage(i,o){if(this.images[i])throw new Error(`Image id ${i} already exist, use updateImage instead`);this._validate(i,o)&&(this.images[i]=o)}_validate(i,o){let h=!0;const f=o.data||o.spriteData;return this._validateStretch(o.stretchX,f&&f.width)||(this.fire(new l.j(new Error(`Image "${i}" has invalid "stretchX" value`))),h=!1),this._validateStretch(o.stretchY,f&&f.height)||(this.fire(new l.j(new Error(`Image "${i}" has invalid "stretchY" value`))),h=!1),this._validateContent(o.content,o)||(this.fire(new l.j(new Error(`Image "${i}" has invalid "content" value`))),h=!1),h}_validateStretch(i,o){if(!i)return!0;let h=0;for(const f of i){if(f[0]<h||f[1]<f[0]||o<f[1])return!1;h=f[1]}return!0}_validateContent(i,o){if(!i)return!0;if(i.length!==4)return!1;const h=o.spriteData,f=h&&h.width||o.data.width,_=h&&h.height||o.data.height;return!(i[0]<0||f<i[0]||i[1]<0||_<i[1]||i[2]<0||f<i[2]||i[3]<0||_<i[3]||i[2]<i[0]||i[3]<i[1])}updateImage(i,o,h=!0){const f=this.getImage(i);if(h&&(f.data.width!==o.data.width||f.data.height!==o.data.height))throw new Error(`size mismatch between old image (${f.data.width}x${f.data.height}) and new image (${o.data.width}x${o.data.height}).`);o.version=f.version+1,this.images[i]=o,this.updatedImages[i]=!0}removeImage(i){const o=this.images[i];delete this.images[i],delete this.patterns[i],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i){return new Promise((o,h)=>{let f=!0;if(!this.isLoaded())for(const _ of i)this.images[_]||(f=!1);this.isLoaded()||f?o(this._getImagesForIds(i)):this.requestors.push({ids:i,promiseResolve:o})})}_getImagesForIds(i){const o={};for(const h of i){let f=this.getImage(h);f||(this.fire(new l.k("styleimagemissing",{id:h})),f=this.getImage(h)),f?o[h]={data:f.data.clone(),pixelRatio:f.pixelRatio,sdf:f.sdf,version:f.version,stretchX:f.stretchX,stretchY:f.stretchY,content:f.content,hasRenderCallback:!!(f.userImage&&f.userImage.render)}:l.w(`Image "${h}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return o}getPixelSize(){const{width:i,height:o}=this.atlasImage;return{width:i,height:o}}getPattern(i){const o=this.patterns[i],h=this.getImage(i);if(!h)return null;if(o&&o.position.version===h.version)return o.position;if(o)o.position.version=h.version;else{const f={w:h.data.width+2,h:h.data.height+2,x:0,y:0},_=new l.I(f,h);this.patterns[i]={bin:f,position:_}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const o=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new kt(i,this.atlasImage,o.RGBA),this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const _ in this.patterns)i.push(this.patterns[_].bin);const{w:o,h}=l.p(i),f=this.atlasImage;f.resize({width:o||1,height:h||1});for(const _ in this.patterns){const{bin:M}=this.patterns[_],S=M.x+1,C=M.y+1,k=this.getImage(_).data,F=k.width,B=k.height;l.R.copy(k,f,{x:0,y:0},{x:S,y:C},{width:F,height:B}),l.R.copy(k,f,{x:0,y:B-1},{x:S,y:C-1},{width:F,height:1}),l.R.copy(k,f,{x:0,y:0},{x:S,y:C+B},{width:F,height:1}),l.R.copy(k,f,{x:F-1,y:0},{x:S-1,y:C},{width:1,height:B}),l.R.copy(k,f,{x:0,y:0},{x:S+F,y:C},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const o of i){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;const h=this.getImage(o);h||l.w(`Image with ID: "${o}" was not found`),ri(h)&&this.updateImage(o,h)}}}const li=1e20;function xr(g,i,o,h,f,_,M,S,C){for(let k=i;k<i+h;k++)si(g,o*_+k,_,f,M,S,C);for(let k=o;k<o+f;k++)si(g,k*_+i,1,h,M,S,C)}function si(g,i,o,h,f,_,M){_[0]=0,M[0]=-li,M[1]=li,f[0]=g[i];for(let S=1,C=0,k=0;S<h;S++){f[S]=g[i+S*o];const F=S*S;do{const B=_[C];k=(f[S]-f[B]+F-B*B)/(S-B)/2}while(k<=M[C]&&--C>-1);C++,_[C]=S,M[C]=k,M[C+1]=li}for(let S=0,C=0;S<h;S++){for(;M[C+1]<S;)C++;const k=_[C],F=S-k;g[i+S*o]=f[k]+F*F}}class tt{constructor(i,o){this.requestManager=i,this.localIdeographFontFamily=o,this.entries={}}setURL(i){this.url=i}getGlyphs(i){return l._(this,void 0,void 0,function*(){const o=[];for(const _ in i)for(const M of i[_])o.push(this._getAndCacheGlyphsPromise(_,M));const h=yield Promise.all(o),f={};for(const{stack:_,id:M,glyph:S}of h)f[_]||(f[_]={}),f[_][M]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics};return f})}_getAndCacheGlyphsPromise(i,o){return l._(this,void 0,void 0,function*(){let h=this.entries[i];h||(h=this.entries[i]={glyphs:{},requests:{},ranges:{}});let f=h.glyphs[o];if(f!==void 0)return{stack:i,id:o,glyph:f};if(f=this._tinySDF(h,i,o),f)return h.glyphs[o]=f,{stack:i,id:o,glyph:f};const _=Math.floor(o/256);if(256*_>65535)throw new Error("glyphs > 65535 not supported");if(h.ranges[_])return{stack:i,id:o,glyph:f};if(!this.url)throw new Error("glyphsUrl is not set");if(!h.requests[_]){const S=tt.loadGlyphRange(i,_,this.url,this.requestManager);h.requests[_]=S}const M=yield h.requests[_];for(const S in M)this._doesCharSupportLocalGlyph(+S)||(h.glyphs[+S]=M[+S]);return h.ranges[_]=!0,{stack:i,id:o,glyph:M[o]||null}})}_doesCharSupportLocalGlyph(i){return!!this.localIdeographFontFamily&&(l.u["CJK Unified Ideographs"](i)||l.u["Hangul Syllables"](i)||l.u.Hiragana(i)||l.u.Katakana(i))}_tinySDF(i,o,h){const f=this.localIdeographFontFamily;if(!f||!this._doesCharSupportLocalGlyph(h))return;let _=i.tinySDF;if(!_){let S="400";/bold/i.test(o)?S="900":/medium/i.test(o)?S="500":/light/i.test(o)&&(S="200"),_=i.tinySDF=new tt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:f,fontWeight:S})}const M=_.draw(String.fromCharCode(h));return{id:h,bitmap:new l.o({width:M.width||60,height:M.height||60},M.data),metrics:{width:M.glyphWidth/2||24,height:M.glyphHeight/2||24,left:M.glyphLeft/2+.5||0,top:M.glyphTop/2-27.5||-8,advance:M.glyphAdvance/2||24,isDoubleResolution:!0}}}}tt.loadGlyphRange=function(g,i,o,h){return l._(this,void 0,void 0,function*(){const f=256*i,_=f+255,M=h.transformRequest(o.replace("{fontstack}",g).replace("{range}",`${f}-${_}`),"Glyphs"),S=yield l.l(M,new AbortController);if(!S||!S.data)throw new Error(`Could not load glyph range. range: ${i}, ${f}-${_}`);const C={};for(const k of l.n(S.data))C[k.id]=k;return C})},tt.TinySDF=class{constructor({fontSize:g=24,buffer:i=3,radius:o=8,cutoff:h=.25,fontFamily:f="sans-serif",fontWeight:_="normal",fontStyle:M="normal"}={}){this.buffer=i,this.cutoff=h,this.radius=o;const S=this.size=g+4*i,C=this._createCanvas(S),k=this.ctx=C.getContext("2d",{willReadFrequently:!0});k.font=`${M} ${_} ${g}px ${f}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(g){const i=document.createElement("canvas");return i.width=i.height=g,i}draw(g){const{width:i,actualBoundingBoxAscent:o,actualBoundingBoxDescent:h,actualBoundingBoxLeft:f,actualBoundingBoxRight:_}=this.ctx.measureText(g),M=Math.ceil(o),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-f))),C=Math.min(this.size-this.buffer,M+Math.ceil(h)),k=S+2*this.buffer,F=C+2*this.buffer,B=Math.max(k*F,0),q=new Uint8ClampedArray(B),te={data:q,width:k,height:F,glyphWidth:S,glyphHeight:C,glyphTop:M,glyphLeft:0,glyphAdvance:i};if(S===0||C===0)return te;const{ctx:Q,buffer:re,gridInner:W,gridOuter:pe}=this;Q.clearRect(re,re,S,C),Q.fillText(g,re,re+M);const Ie=Q.getImageData(re,re,S,C);pe.fill(li,0,B),W.fill(0,0,B);for(let le=0;le<C;le++)for(let be=0;be<S;be++){const Ae=Ie.data[4*(le*S+be)+3]/255;if(Ae===0)continue;const ke=(le+re)*k+be+re;if(Ae===1)pe[ke]=0,W[ke]=li;else{const ze=.5-Ae;pe[ke]=ze>0?ze*ze:0,W[ke]=ze<0?ze*ze:0}}xr(pe,0,0,k,F,k,this.f,this.v,this.z),xr(W,re,re,S,C,k,this.f,this.v,this.z);for(let le=0;le<B;le++){const be=Math.sqrt(pe[le])-Math.sqrt(W[le]);q[le]=Math.round(255-255*(be/this.radius+this.cutoff))}return te}};class rt{constructor(){this.specification=l.v.light.position}possiblyEvaluate(i,o){return l.y(i.expression.evaluate(o))}interpolate(i,o,h){return{x:l.z.number(i.x,o.x,h),y:l.z.number(i.y,o.y,h),z:l.z.number(i.z,o.z,h)}}}let It;class br extends l.E{constructor(i){super(),It=It||new l.q({anchor:new l.D(l.v.light.anchor),position:new rt,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.T(It),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,o={}){if(!this._validate(l.r,i,o))for(const h in i){const f=i[h];h.endsWith("-transition")?this._transitionable.setTransition(h.slice(0,-11),f):this._transitionable.setValue(h,f)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,o,h){return(!h||h.validate!==!1)&&l.t(this,i.call(l.x,{value:o,style:{glyphs:!0,sprite:!0},styleSpec:l.v}))}}class Oi{constructor(i,o){this.width=i,this.height=o,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(i,o){const h=i.join(",")+String(o);return this.dashEntry[h]||(this.dashEntry[h]=this.addDash(i,o)),this.dashEntry[h]}getDashRanges(i,o,h){const f=[];let _=i.length%2==1?-i[i.length-1]*h:0,M=i[0]*h,S=!0;f.push({left:_,right:M,isDash:S,zeroLength:i[0]===0});let C=i[0];for(let k=1;k<i.length;k++){S=!S;const F=i[k];_=C*h,C+=F,M=C*h,f.push({left:_,right:M,isDash:S,zeroLength:F===0})}return f}addRoundDash(i,o,h){const f=o/2;for(let _=-h;_<=h;_++){const M=this.width*(this.nextRow+h+_);let S=0,C=i[S];for(let k=0;k<this.width;k++){k/C.right>1&&(C=i[++S]);const F=Math.abs(k-C.left),B=Math.abs(k-C.right),q=Math.min(F,B);let te;const Q=_/h*(f+1);if(C.isDash){const re=f-Math.abs(Q);te=Math.sqrt(q*q+re*re)}else te=f-Math.sqrt(q*q+Q*Q);this.data[M+k]=Math.max(0,Math.min(255,te+128))}}}addRegularDash(i){for(let S=i.length-1;S>=0;--S){const C=i[S],k=i[S+1];C.zeroLength?i.splice(S,1):k&&k.isDash===C.isDash&&(k.left=C.left,i.splice(S,1))}const o=i[0],h=i[i.length-1];o.isDash===h.isDash&&(o.left=h.left-this.width,h.right=o.right+this.width);const f=this.width*this.nextRow;let _=0,M=i[_];for(let S=0;S<this.width;S++){S/M.right>1&&(M=i[++_]);const C=Math.abs(S-M.left),k=Math.abs(S-M.right),F=Math.min(C,k);this.data[f+S]=Math.max(0,Math.min(255,(M.isDash?F:-F)+128))}}addDash(i,o){const h=o?7:0,f=2*h+1;if(this.nextRow+f>this.height)return l.w("LineAtlas out of space"),null;let _=0;for(let S=0;S<i.length;S++)_+=i[S];if(_!==0){const S=this.width/_,C=this.getDashRanges(i,this.width,S);o?this.addRoundDash(C,S,h):this.addRegularDash(C)}const M={y:(this.nextRow+h+.5)/this.height,height:2*h/this.height,width:_};return this.nextRow+=f,this.dirty=!0,M}bind(i){const o=i.gl;this.texture?(o.bindTexture(o.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,o.texSubImage2D(o.TEXTURE_2D,0,0,0,this.width,this.height,o.ALPHA,o.UNSIGNED_BYTE,this.data))):(this.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.ALPHA,this.width,this.height,0,o.ALPHA,o.UNSIGNED_BYTE,this.data))}}const Si="maplibre_preloaded_worker_pool";class Ni{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<Ni.workerCount;)this.workers.push(new Worker(l.a.WORKER_URL));return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Si]}numActive(){return Object.keys(this.active).length}}const Hr=Math.floor(D.hardwareConcurrency/2);let lr,Ci;function Ve(){return lr||(lr=new Ni),lr}Ni.workerCount=l.B(globalThis)?Math.max(Math.min(Hr,3),1):1;class St{constructor(i,o){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=o;const h=this.workerPool.acquire(o);for(let f=0;f<h.length;f++){const _=new l.C(h[f],o);_.name=`Worker ${f}`,this.actors.push(_)}if(!this.actors.length)throw new Error("No actors found")}broadcast(i,o){const h=[];for(const f of this.actors)h.push(f.sendAsync({type:i,data:o}));return Promise.all(h)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(i=!0){this.actors.forEach(o=>{o.remove()}),this.actors=[],i&&this.workerPool.release(this.id)}registerMessageHandler(i,o){for(const h of this.actors)h.registerMessageHandler(i,o)}}function lt(){return Ci||(Ci=new St(Ve(),l.G),Ci.registerMessageHandler("GR",(g,i,o)=>l.m(i,o))),Ci}function Ye(g,i){const o=l.F();return l.H(o,o,[1,1,0]),l.J(o,o,[.5*g.width,.5*g.height,1]),l.K(o,o,g.calculatePosMatrix(i.toUnwrapped()))}function Ii(g,i,o,h,f,_){const M=function(B,q,te){if(B)for(const Q of B){const re=q[Q];if(re&&re.source===te&&re.type==="fill-extrusion")return!0}else for(const Q in q){const re=q[Q];if(re.source===te&&re.type==="fill-extrusion")return!0}return!1}(f&&f.layers,i,g.id),S=_.maxPitchScaleFactor(),C=g.tilesIn(h,S,M);C.sort(ki);const k=[];for(const B of C)k.push({wrappedTileID:B.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(i,o,g._state,B.queryGeometry,B.cameraQueryGeometry,B.scale,f,_,S,Ye(g.transform,B.tileID))});const F=function(B){const q={},te={};for(const Q of B){const re=Q.queryResults,W=Q.wrappedTileID,pe=te[W]=te[W]||{};for(const Ie in re){const le=re[Ie],be=pe[Ie]=pe[Ie]||{},Ae=q[Ie]=q[Ie]||[];for(const ke of le)be[ke.featureIndex]||(be[ke.featureIndex]=!0,Ae.push(ke))}}return q}(k);for(const B in F)F[B].forEach(q=>{const te=q.feature,Q=g.getFeatureState(te.layer["source-layer"],te.id);te.source=te.layer.source,te.layer["source-layer"]&&(te.sourceLayer=te.layer["source-layer"]),te.state=Q});return F}function ki(g,i){const o=g.tileID,h=i.tileID;return o.overscaledZ-h.overscaledZ||o.canonical.y-h.canonical.y||o.wrap-h.wrap||o.canonical.x-h.canonical.x}function ne(g,i,o){return l._(this,void 0,void 0,function*(){let h=g;if(g.url?h=(yield l.h(i.transformRequest(g.url,"Source"),o)).data:yield D.frameAsync(o),!h)return null;const f=l.L(l.e(h,g),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in h&&h.vector_layers&&(f.vectorLayerIds=h.vector_layers.map(_=>_.id)),f})}class ue{constructor(i,o){i&&(o?this.setSouthWest(i).setNorthEast(o):Array.isArray(i)&&(i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1])))}setNorthEast(i){return this._ne=i instanceof l.M?new l.M(i.lng,i.lat):l.M.convert(i),this}setSouthWest(i){return this._sw=i instanceof l.M?new l.M(i.lng,i.lat):l.M.convert(i),this}extend(i){const o=this._sw,h=this._ne;let f,_;if(i instanceof l.M)f=i,_=i;else{if(!(i instanceof ue))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(ue.convert(i)):this.extend(l.M.convert(i)):i&&("lng"in i||"lon"in i)&&"lat"in i?this.extend(l.M.convert(i)):this;if(f=i._sw,_=i._ne,!f||!_)return this}return o||h?(o.lng=Math.min(f.lng,o.lng),o.lat=Math.min(f.lat,o.lat),h.lng=Math.max(_.lng,h.lng),h.lat=Math.max(_.lat,h.lat)):(this._sw=new l.M(f.lng,f.lat),this._ne=new l.M(_.lng,_.lat)),this}getCenter(){return new l.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.M(this.getWest(),this.getNorth())}getSouthEast(){return new l.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:o,lat:h}=l.M.convert(i);let f=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&f}static convert(i){return i instanceof ue?i:i&&new ue(i)}static fromLngLat(i,o=0){const h=360*o/40075017,f=h/Math.cos(Math.PI/180*i.lat);return new ue(new l.M(i.lng-f,i.lat-h),new l.M(i.lng+f,i.lat+h))}}class De{constructor(i,o,h){this.bounds=ue.convert(this.validateBounds(i)),this.minzoom=o||0,this.maxzoom=h||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const o=Math.pow(2,i.z),h=Math.floor(l.N(this.bounds.getWest())*o),f=Math.floor(l.O(this.bounds.getNorth())*o),_=Math.ceil(l.N(this.bounds.getEast())*o),M=Math.ceil(l.O(this.bounds.getSouth())*o);return i.x>=h&&i.x<_&&i.y>=f&&i.y<M}}class Oe extends l.E{constructor(i,o,h,f){if(super(),this.id=i,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.L(o,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f)}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield ne(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),i&&(l.e(this,i),i.bounds&&(this.tileBounds=new De(i.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(i){this._tileJSONRequest=null,this.fire(new l.j(i))}})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}setSourceProperty(i){this._tileJSONRequest&&this._tileJSONRequest.abort(),i(),this.load()}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}setUrl(i){return this.setSourceProperty(()=>{this.url=i,this._options.url=i}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(i){return l._(this,void 0,void 0,function*(){const o=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),h={request:this.map._requestManager.transformRequest(o,"Tile"),uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};h.request.collectResourceTiming=this._collectResourceTiming;let f="RT";if(i.actor&&i.state!=="expired"){if(i.state==="loading")return new Promise((_,M)=>{i.reloadPromise={resolve:_,reject:M}})}else i.actor=this.dispatcher.getActor(),f="LT";i.abortController=new AbortController;try{const _=yield i.actor.sendAsync({type:f,data:h},i.abortController);if(delete i.abortController,i.aborted)return;this._afterTileLoadWorkerResponse(i,_)}catch(_){if(delete i.abortController,i.aborted)return;if(_&&_.status!==404)throw _;this._afterTileLoadWorkerResponse(i,null)}})}_afterTileLoadWorkerResponse(i,o){if(o&&o.resourceTiming&&(i.resourceTiming=o.resourceTiming),o&&this.map._refreshExpiredTiles&&i.setExpiryData(o),i.loadVectorData(o,this.map.painter),i.reloadPromise){const h=i.reloadPromise;i.reloadPromise=null,this.loadTile(i).then(h.resolve).catch(h.reject)}}abortTile(i){return l._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.actor&&(yield i.actor.sendAsync({type:"AT",data:{uid:i.uid,type:this.type,source:this.id}}))})}unloadTile(i){return l._(this,void 0,void 0,function*(){i.unloadVectorData(),i.actor&&(yield i.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ce extends l.E{constructor(i,o,h,f){super(),this.id=i,this.dispatcher=h,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},o),l.e(this,l.L(o,["url","scheme","tileSize"]))}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield ne(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,i&&(l.e(this,i),i.bounds&&(this.tileBounds=new De(i.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(i){this._tileJSONRequest=null,this.fire(new l.j(i))}})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(i){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),i(),this.load()}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}setUrl(i){return this.setSourceProperty(()=>{this.url=i,this._options.url=i}),this}serialize(){return l.e({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i){return l._(this,void 0,void 0,function*(){const o=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);i.abortController=new AbortController;try{const h=yield ae.getImage(this.map._requestManager.transformRequest(o,"Tile"),i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(h&&h.data){this.map._refreshExpiredTiles&&h.cacheControl&&h.expires&&i.setExpiryData({cacheControl:h.cacheControl,expires:h.expires});const f=this.map.painter.context,_=f.gl,M=h.data;i.texture=this.map.painter.getTileTexture(M.width),i.texture?i.texture.update(M,{useMipmap:!0}):(i.texture=new kt(f,M,_.RGBA,{useMipmap:!0}),i.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST),f.extTextureFilterAnisotropic&&_.texParameterf(_.TEXTURE_2D,f.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,f.extTextureFilterAnisotropicMax)),i.state="loaded"}}catch(h){if(delete i.abortController,i.aborted)i.state="unloaded";else if(h)throw i.state="errored",h}})}abortTile(i){return l._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController)})}unloadTile(i){return l._(this,void 0,void 0,function*(){i.texture&&this.map.painter.saveTileTexture(i.texture)})}hasTransition(){return!1}}class ut extends ce{constructor(i,o,h,f){super(i,o,h,f),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox",this.redFactor=o.redFactor,this.greenFactor=o.greenFactor,this.blueFactor=o.blueFactor,this.baseShift=o.baseShift}loadTile(i){return l._(this,void 0,void 0,function*(){const o=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),h=this.map._requestManager.transformRequest(o,"Tile");i.neighboringTiles=this._getNeighboringTiles(i.tileID),i.abortController=new AbortController;try{const f=yield ae.getImage(h,i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(f&&f.data){const _=f.data;this.map._refreshExpiredTiles&&f.cacheControl&&f.expires&&i.setExpiryData({cacheControl:f.cacheControl,expires:f.expires});const M=l.b(_)&&l.S()?_:yield this.readImageNow(_),S={type:this.type,uid:i.uid,source:this.id,rawImageData:M,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!i.actor||i.state==="expired"){i.actor=this.dispatcher.getActor();const C=yield i.actor.sendAsync({type:"LDT",data:S});i.dem=C,i.needsHillshadePrepare=!0,i.needsTerrainPrepare=!0,i.state="loaded"}}}catch(f){if(delete i.abortController,i.aborted)i.state="unloaded";else if(f)throw i.state="errored",f}})}readImageNow(i){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.U()){const o=i.width+2,h=i.height+2;try{return new l.R({width:o,height:h},yield l.V(i,-1,-1,o,h))}catch{}}return D.getImageData(i,1)})}_getNeighboringTiles(i){const o=i.canonical,h=Math.pow(2,o.z),f=(o.x-1+h)%h,_=o.x===0?i.wrap-1:i.wrap,M=(o.x+1+h)%h,S=o.x+1===h?i.wrap+1:i.wrap,C={};return C[new l.Q(i.overscaledZ,_,o.z,f,o.y).key]={backfilled:!1},C[new l.Q(i.overscaledZ,S,o.z,M,o.y).key]={backfilled:!1},o.y>0&&(C[new l.Q(i.overscaledZ,_,o.z,f,o.y-1).key]={backfilled:!1},C[new l.Q(i.overscaledZ,i.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},C[new l.Q(i.overscaledZ,S,o.z,M,o.y-1).key]={backfilled:!1}),o.y+1<h&&(C[new l.Q(i.overscaledZ,_,o.z,f,o.y+1).key]={backfilled:!1},C[new l.Q(i.overscaledZ,i.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},C[new l.Q(i.overscaledZ,S,o.z,M,o.y+1).key]={backfilled:!1}),C}unloadTile(i){return l._(this,void 0,void 0,function*(){i.demTexture&&this.map.painter.saveTileTexture(i.demTexture),i.fbo&&(i.fbo.destroy(),delete i.fbo),i.dem&&delete i.dem,delete i.neighboringTiles,i.state="unloaded",i.actor&&(yield i.actor.sendAsync({type:"RDT",data:{type:this.type,uid:i.uid,source:this.id}}))})}}class Ct extends l.E{constructor(i,o,h,f){super(),this.id=i,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=h.getActor(),this.setEventedParent(f),this._data=o.data,this._options=l.e({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const _=l.W/this.tileSize;this.workerOptions=l.e({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*_,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*_,extent:l.W,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:l.W,radius:(o.clusterRadius||50)*_,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return l._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(i){this.map=i,this.load()}setData(i){return this._data=i,this._updateWorkerData(),this}updateData(i){return this._updateWorkerData(i),this}setClusterOptions(i){return this.workerOptions.cluster=i.cluster,i&&(i.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=i.clusterRadius),i.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=i.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(i){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:i,source:this.id}})}getClusterChildren(i){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:i,source:this.id}})}getClusterLeaves(i,o,h){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:i,limit:o,offset:h}})}_updateWorkerData(i){return l._(this,void 0,void 0,function*(){const o=l.e({type:this.type},this.workerOptions);i?o.dataDiff=i:typeof this._data=="string"?(o.request=this.map._requestManager.transformRequest(D.resolveURL(this._data),"Source"),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.k("dataloading",{dataType:"source"}));try{const h=yield this.actor.sendAsync({type:"LD",data:o});if(this._pendingLoads--,this._removed||h.abandoned)return void this.fire(new l.k("dataabort",{dataType:"source"}));let f=null;h.resourceTiming&&h.resourceTiming[this.id]&&(f=h.resourceTiming[this.id].slice(0));const _={dataType:"source"};this._collectResourceTiming&&f&&f.length>0&&l.e(_,{resourceTiming:f}),this.fire(new l.k("data",Object.assign(Object.assign({},_),{sourceDataType:"metadata"}))),this.fire(new l.k("data",Object.assign(Object.assign({},_),{sourceDataType:"content"})))}catch(h){if(this._pendingLoads--,this._removed)return void this.fire(new l.k("dataabort",{dataType:"source"}));this.fire(new l.j(h))}})}loaded(){return this._pendingLoads===0}loadTile(i){return l._(this,void 0,void 0,function*(){const o=i.actor?"RT":"LT";i.actor=this.actor;const h={type:this.type,uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};i.abortController=new AbortController;const f=yield this.actor.sendAsync({type:o,data:h},i.abortController);delete i.abortController,i.unloadVectorData(),i.aborted||i.loadVectorData(f,this.map.painter,o==="RT")})}abortTile(i){return l._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.aborted=!0})}unloadTile(i){return l._(this,void 0,void 0,function*(){i.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Be=l.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class it extends l.E{constructor(i,o,h,f){super(),this.id=i,this.dispatcher=h,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(f),this.options=o}load(i){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const o=yield ae.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,o&&o.data&&(this.image=o.data,i&&(this.coordinates=i),this._finishLoading())}catch(o){this._request=null,this._loaded=!0,this.fire(new l.j(o))}})}loaded(){return this._loaded}updateImage(i){return i.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=i.url,this.load(i.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(i){this.coordinates=i;const o=i.map(l.Y.fromLngLat);this.tileID=function(f){let _=1/0,M=1/0,S=-1/0,C=-1/0;for(const q of f)_=Math.min(_,q.x),M=Math.min(M,q.y),S=Math.max(S,q.x),C=Math.max(C,q.y);const k=Math.max(S-_,C-M),F=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),B=Math.pow(2,F);return new l.a0(F,Math.floor((_+S)/2*B),Math.floor((M+C)/2*B))}(o),this.minzoom=this.maxzoom=this.tileID.z;const h=o.map(f=>this.tileID.getTilePoint(f)._round());return this._boundsArray=new l.Z,this._boundsArray.emplaceBack(h[0].x,h[0].y,0,0),this._boundsArray.emplaceBack(h[1].x,h[1].y,l.W,0),this._boundsArray.emplaceBack(h[3].x,h[3].y,0,l.W),this._boundsArray.emplaceBack(h[2].x,h[2].y,l.W,l.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const i=this.map.painter.context,o=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,Be.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new kt(i,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let h=!1;for(const f in this.tiles){const _=this.tiles[f];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,h=!0)}h&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(i){return l._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={}):i.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class et extends it{constructor(i,o,h,f){super(i,o,h,f),this.roundZoom=!0,this.type="video",this.options=o}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1;const i=this.options;this.urls=[];for(const o of i.urls)this.urls.push(this.map._requestManager.transformRequest(o,"Source").url);try{const o=yield l.a2(this.urls);if(this._loaded=!0,!o)return;this.video=o,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(o){this.fire(new l.j(o))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(i){if(this.video){const o=this.video.seekable;i<o.start(0)||i>o.end(0)?this.fire(new l.j(new l.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=i}}getVideo(){return this.video}onAdd(i){this.map||(this.map=i,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const i=this.map.painter.context,o=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,Be.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new kt(i,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let h=!1;for(const f in this.tiles){const _=this.tiles[f];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,h=!0)}h&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class At extends it{constructor(i,o,h,f){super(i,o,h,f),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(M=>typeof M!="number"))||this.fire(new l.j(new l.a1(`sources.${i}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.j(new l.a1(`sources.${i}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new l.j(new l.a1(`sources.${i}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new l.j(new l.a1(`sources.${i}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.j(new l.a1(`sources.${i}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){return l._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(i){this.map=i,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let i=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,i=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,i=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context,h=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Be.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture?(i||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new kt(o,this.canvas,h.RGBA,{premultiply:!0});let f=!1;for(const _ in this.tiles){const M=this.tiles[_];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture,f=!0)}f&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const i of[this.canvas.width,this.canvas.height])if(isNaN(i)||i<=0)return!0;return!1}}const Gt={},jt=g=>{switch(g){case"geojson":return Ct;case"image":return it;case"raster":return ce;case"raster-dem":return ut;case"vector":return Oe;case"video":return et;case"canvas":return At}return Gt[g]},Zt="RTLPluginLoaded";class fi extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=lt()}_syncState(i){return this.status=i,this.dispatcher.broadcast("SRPS",{pluginStatus:i,pluginURL:this.url}).catch(o=>{throw this.status="error",o})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(i){return l._(this,arguments,void 0,function*(o,h=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=D.resolveURL(o),!this.url)throw new Error(`requested url ${o} is invalid`);if(this.status==="unavailable"){if(!h)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return l._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.k(Zt))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let bi=null;function Ue(){return bi||(bi=new fi),bi}class Ri{constructor(i,o){this.timeAdded=0,this.fadeEndTime=0,this.tileID=i,this.uid=l.a3(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(i){const o=i+this.timeAdded;o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(i){this.demTexture&&i.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(i,o,h){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(f,_){const M={};if(!_)return M;for(const S of f){const C=S.layerIds.map(k=>_.getLayer(k)).filter(Boolean);if(C.length!==0){S.layers=C,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(k=>C.filter(F=>F.id===k)[0]));for(const k of C)M[k.id]=S}}return M}(i.buckets,o.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const _=this.buckets[f];if(_ instanceof l.a5){if(this.hasSymbolBuckets=!0,!h)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const _=this.buckets[f];if(_ instanceof l.a5&&_.hasRTLText){this.hasRTLText=!0,Ue().lazyLoad();break}}this.queryPadding=0;for(const f in this.buckets){const _=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(f).queryRadius(_))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage)}else this.collisionBoxArray=new l.a4}unloadVectorData(){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(i){return this.buckets[i.id]}upload(i){for(const h in this.buckets){const f=this.buckets[h];f.uploadPending()&&f.upload(i)}const o=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new kt(i,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new kt(i,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,o,h,f,_,M,S,C,k,F){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:f,cameraQueryGeometry:_,scale:M,tileSize:this.tileSize,pixelPosMatrix:F,transform:C,params:S,queryPadding:this.queryPadding*k},i,o,h):{}}querySourceFeatures(i,o){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const f=h.loadVTLayers(),_=o&&o.sourceLayer?o.sourceLayer:"",M=f._geojsonTileLayer||f[_];if(!M)return;const S=l.a6(o&&o.filter),{z:C,x:k,y:F}=this.tileID.canonical,B={z:C,x:k,y:F};for(let q=0;q<M.length;q++){const te=M.feature(q);if(S.needGeometry){const W=l.a7(te,!0);if(!S.filter(new l.a8(this.tileID.overscaledZ),W,this.tileID.canonical))continue}else if(!S.filter(new l.a8(this.tileID.overscaledZ),te))continue;const Q=h.getId(te,_),re=new l.a9(te,C,k,F,Q);re.tile=B,i.push(re)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const o=this.expirationTime;if(i.cacheControl){const h=l.aa(i.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const h=Date.now();let f=!1;if(this.expirationTime>h)f=!1;else if(o)if(this.expirationTime<o)f=!0;else{const _=this.expirationTime-o;_?this.expirationTime=h+Math.max(_,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(i,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(i).length===0)return;const h=this.latestFeatureIndex.loadVTLayers();for(const f in this.buckets){if(!o.style.hasLayer(f))continue;const _=this.buckets[f],M=_.layers[0].sourceLayer||"_geojsonTileLayer",S=h[M],C=i[M];if(!S||!C||Object.keys(C).length===0)continue;_.update(C,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});const k=o&&o.style&&o.style.getLayer(f);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<D.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=D.now()+i}setDependencies(i,o){const h={};for(const f of o)h[f]=!0;this.dependencies[i]=h}hasDependency(i,o){for(const h of i){const f=this.dependencies[h];if(f){for(const _ of o)if(f[_])return!0}}return!1}}class Zi{constructor(i,o){this.max=i,this.onRemove=o,this.reset()}reset(){for(const i in this.data)for(const o of this.data[i])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(i,o,h){const f=i.wrapped().key;this.data[f]===void 0&&(this.data[f]=[]);const _={value:o,timeout:void 0};if(h!==void 0&&(_.timeout=setTimeout(()=>{this.remove(i,_)},h)),this.data[f].push(_),this.order.push(f),this.order.length>this.max){const M=this._getAndRemoveByKey(this.order[0]);M&&this.onRemove(M)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const o=this.data[i].shift();return o.timeout&&clearTimeout(o.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),o.value}getByKey(i){const o=this.data[i];return o?o[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,o){if(!this.has(i))return this;const h=i.wrapped().key,f=o===void 0?0:this.data[h].indexOf(o),_=this.data[h][f];return this.data[h].splice(f,1),_.timeout&&clearTimeout(_.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(_.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(i){const o=[];for(const h in this.data)for(const f of this.data[h])i(f.value)||o.push(f);for(const h of o)this.remove(h.value.tileID,h)}}class pn{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,o,h){const f=String(o);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][f]=this.stateChanges[i][f]||{},l.e(this.stateChanges[i][f],h),this.deletedStates[i]===null){this.deletedStates[i]={};for(const _ in this.state[i])_!==f&&(this.deletedStates[i][_]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][f]===null){this.deletedStates[i][f]={};for(const _ in this.state[i][f])h[_]||(this.deletedStates[i][f][_]=null)}else for(const _ in h)this.deletedStates[i]&&this.deletedStates[i][f]&&this.deletedStates[i][f][_]===null&&delete this.deletedStates[i][f][_]}removeFeatureState(i,o,h){if(this.deletedStates[i]===null)return;const f=String(o);if(this.deletedStates[i]=this.deletedStates[i]||{},h&&o!==void 0)this.deletedStates[i][f]!==null&&(this.deletedStates[i][f]=this.deletedStates[i][f]||{},this.deletedStates[i][f][h]=null);else if(o!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][f])for(h in this.deletedStates[i][f]={},this.stateChanges[i][f])this.deletedStates[i][f][h]=null;else this.deletedStates[i][f]=null;else this.deletedStates[i]=null}getState(i,o){const h=String(o),f=l.e({},(this.state[i]||{})[h],(this.stateChanges[i]||{})[h]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){const _=this.deletedStates[i][o];if(_===null)return{};for(const M in _)delete f[M]}return f}initializeTileState(i,o){i.setFeatureState(this.state,o)}coalesceChanges(i,o){const h={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const _={};for(const M in this.stateChanges[f])this.state[f][M]||(this.state[f][M]={}),l.e(this.state[f][M],this.stateChanges[f][M]),_[M]=this.state[f][M];h[f]=_}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const _={};if(this.deletedStates[f]===null)for(const M in this.state[f])_[M]={},this.state[f][M]={};else for(const M in this.deletedStates[f]){if(this.deletedStates[f][M]===null)this.state[f][M]={};else for(const S of Object.keys(this.deletedStates[f][M]))delete this.state[f][M][S];_[M]=this.state[f][M]}h[f]=h[f]||{},l.e(h[f],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(const f in i)i[f].setFeatureState(h,o)}}class wr extends l.E{constructor(i,o,h){super(),this.id=i,this.dispatcher=h,this.on("data",f=>this._dataHandler(f)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((f,_,M,S)=>{const C=new(jt(_.type))(f,_,M,S);if(C.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${C.id}`);return C})(i,o,h,this),this._tiles={},this._cache=new Zi(0,f=>this._unloadTile(f)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new pn,this._didEmitContent=!1,this._updated=!1}onAdd(i){this.map=i,this._maxTileCacheSize=i?i._maxTileCacheSize:null,this._maxTileCacheZoomLevels=i?i._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(i)}onRemove(i){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(i)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const i in this._tiles){const o=this._tiles[i];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(i,o,h){return l._(this,void 0,void 0,function*(){try{yield this._source.loadTile(i),this._tileLoaded(i,o,h)}catch(f){i.state="errored",f.status!==404?this._source.fire(new l.j(f,{tile:i})):this.update(this.transform,this.terrain)}})}_unloadTile(i){this._source.unloadTile&&this._source.unloadTile(i)}_abortTile(i){this._source.abortTile&&this._source.abortTile(i),this._source.fire(new l.k("dataabort",{tile:i,coord:i.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const h=this._tiles[o];h.upload(i),h.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(i=>i.tileID).sort(nt).map(i=>i.key)}getRenderableIds(i){const o=[];for(const h in this._tiles)this._isIdRenderable(h,i)&&o.push(this._tiles[h]);return i?o.sort((h,f)=>{const _=h.tileID,M=f.tileID,S=new l.P(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),C=new l.P(M.canonical.x,M.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-M.overscaledZ||C.y-S.y||C.x-S.x}).map(h=>h.tileID.key):o.map(h=>h.tileID).sort(nt).map(h=>h.key)}hasRenderableParent(i){const o=this.findLoadedParent(i,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(i,o){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(o||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(i,"reloading")}}_reloadTile(i,o){return l._(this,void 0,void 0,function*(){const h=this._tiles[i];h&&(h.state!=="loading"&&(h.state=o),yield this._loadTile(h,i,o))})}_tileLoaded(i,o,h){i.timeAdded=D.now(),h==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(o,i),this.getSource().type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),i.aborted||this._source.fire(new l.k("data",{dataType:"source",tile:i,coord:i.tileID}))}_backfillDEM(i){const o=this.getRenderableIds();for(let f=0;f<o.length;f++){const _=o[f];if(i.neighboringTiles&&i.neighboringTiles[_]){const M=this.getTileByID(_);h(i,M),h(M,i)}}function h(f,_){f.needsHillshadePrepare=!0,f.needsTerrainPrepare=!0;let M=_.tileID.canonical.x-f.tileID.canonical.x;const S=_.tileID.canonical.y-f.tileID.canonical.y,C=Math.pow(2,f.tileID.canonical.z),k=_.tileID.key;M===0&&S===0||Math.abs(S)>1||(Math.abs(M)>1&&(Math.abs(M+C)===1?M+=C:Math.abs(M-C)===1&&(M-=C)),_.dem&&f.dem&&(f.dem.backfillBorder(_.dem,M,S),f.neighboringTiles&&f.neighboringTiles[k]&&(f.neighboringTiles[k].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,o,h,f){for(const _ in this._tiles){let M=this._tiles[_];if(f[_]||!M.hasData()||M.tileID.overscaledZ<=o||M.tileID.overscaledZ>h)continue;let S=M.tileID;for(;M&&M.tileID.overscaledZ>o+1;){const k=M.tileID.scaledTo(M.tileID.overscaledZ-1);M=this._tiles[k.key],M&&M.hasData()&&(S=k)}let C=S;for(;C.overscaledZ>o;)if(C=C.scaledTo(C.overscaledZ-1),i[C.key]){f[S.key]=S;break}}}findLoadedParent(i,o){if(i.key in this._loadedParentTiles){const h=this._loadedParentTiles[i.key];return h&&h.tileID.overscaledZ>=o?h:null}for(let h=i.overscaledZ-1;h>=o;h--){const f=i.scaledTo(h),_=this._getLoadedTile(f);if(_)return _}}_getLoadedTile(i){const o=this._tiles[i.key];return o&&o.hasData()?o:this._cache.getByKey(i.wrapped().key)}updateCacheSize(i){const o=Math.ceil(i.width/this._source.tileSize)+1,h=Math.ceil(i.height/this._source.tileSize)+1,f=Math.floor(o*h*(this._maxTileCacheZoomLevels===null?l.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,f):f;this._cache.setMaxSize(_)}handleWrapJump(i){const o=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,o){const h={};for(const f in this._tiles){const _=this._tiles[f];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+o),h[_.tileID.key]=_}this._tiles=h;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(f,this._tiles[f])}}update(i,o){if(!this._sourceLoaded||this._paused)return;let h;this.transform=i,this.terrain=o,this.updateCacheSize(i),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(F=>new l.Q(F.canonical.z,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y)):(h=i.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:o}),this._source.hasTile&&(h=h.filter(F=>this._source.hasTile(F)))):h=[];const f=i.coveringZoomLevel(this._source),_=Math.max(f-wr.maxOverzooming,this._source.minzoom),M=Math.max(f+wr.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const F={};for(const B of h)if(B.canonical.z>this._source.minzoom){const q=B.scaledTo(B.canonical.z-1);F[q.key]=q;const te=B.scaledTo(Math.max(this._source.minzoom,Math.min(B.canonical.z,5)));F[te.key]=te}h=h.concat(Object.values(F))}const S=h.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,S&&this.fire(new l.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const C=this._updateRetainedTiles(h,f);if(ai(this._source.type)){const F={},B={},q=Object.keys(C),te=D.now();for(const Q of q){const re=C[Q],W=this._tiles[Q];if(!W||W.fadeEndTime!==0&&W.fadeEndTime<=te)continue;const pe=this.findLoadedParent(re,_);pe&&(this._addTile(pe.tileID),F[pe.tileID.key]=pe.tileID),B[Q]=re}this._retainLoadedChildren(B,f,M,C);for(const Q in F)C[Q]||(this._coveredTiles[Q]=!0,C[Q]=F[Q]);if(o){const Q={},re={};for(const W of h)this._tiles[W.key].hasData()?Q[W.key]=W:re[W.key]=W;for(const W in re){const pe=re[W].children(this._source.maxzoom);this._tiles[pe[0].key]&&this._tiles[pe[1].key]&&this._tiles[pe[2].key]&&this._tiles[pe[3].key]&&(Q[pe[0].key]=C[pe[0].key]=pe[0],Q[pe[1].key]=C[pe[1].key]=pe[1],Q[pe[2].key]=C[pe[2].key]=pe[2],Q[pe[3].key]=C[pe[3].key]=pe[3],delete re[W])}for(const W in re){const pe=this.findLoadedParent(re[W],this._source.minzoom);if(pe){Q[pe.tileID.key]=C[pe.tileID.key]=pe.tileID;for(const Ie in Q)Q[Ie].isChildOf(pe.tileID)&&delete Q[Ie]}}for(const W in this._tiles)Q[W]||(this._coveredTiles[W]=!0)}}for(const F in C)this._tiles[F].clearFadeHold();const k=l.ab(this._tiles,C);for(const F of k){const B=this._tiles[F];B.hasSymbolBuckets&&!B.holdingForFade()?B.setHoldDuration(this.map._fadeDuration):B.hasSymbolBuckets&&!B.symbolFadeFinished()||this._removeTile(F)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(i)}_updateRetainedTiles(i,o){const h={},f={},_=Math.max(o-wr.maxOverzooming,this._source.minzoom),M=Math.max(o+wr.maxUnderzooming,this._source.minzoom),S={};for(const C of i){const k=this._addTile(C);h[C.key]=C,k.hasData()||o<this._source.maxzoom&&(S[C.key]=C)}this._retainLoadedChildren(S,o,M,h);for(const C of i){let k=this._tiles[C.key];if(k.hasData())continue;if(o+1>this._source.maxzoom){const B=C.children(this._source.maxzoom)[0],q=this.getTile(B);if(q&&q.hasData()){h[B.key]=B;continue}}else{const B=C.children(this._source.maxzoom);if(h[B[0].key]&&h[B[1].key]&&h[B[2].key]&&h[B[3].key])continue}let F=k.wasRequested();for(let B=C.overscaledZ-1;B>=_;--B){const q=C.scaledTo(B);if(f[q.key])break;if(f[q.key]=!0,k=this.getTile(q),!k&&F&&(k=this._addTile(q)),k){const te=k.hasData();if((F||te)&&(h[q.key]=q),F=k.wasRequested(),te)break}}}return h}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const o=[];let h,f=this._tiles[i].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){h=this._loadedParentTiles[f.key];break}o.push(f.key);const _=f.scaledTo(f.overscaledZ-1);if(h=this._getLoadedTile(_),h)break;f=_}for(const _ of o)this._loadedParentTiles[_]=h}}_addTile(i){let o=this._tiles[i.key];if(o)return o;o=this._cache.getAndRemove(i),o&&(this._setTileReloadTimer(i.key,o),o.tileID=i,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,o)));const h=o;return o||(o=new Ri(i,this._source.tileSize*i.overscaleFactor()),this._loadTile(o,i.key,o.state)),o.uses++,this._tiles[i.key]=o,h||this._source.fire(new l.k("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o}_setTileReloadTimer(i,o){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const h=o.getExpiryTimeout();h&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},h))}_removeTile(i){const o=this._tiles[i];o&&(o.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),o.uses>0||(o.hasData()&&o.state!=="reloading"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}_dataHandler(i){const o=i.sourceDataType;i.dataType==="source"&&o==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&i.dataType==="source"&&o==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(i);this._cache.reset()}tilesIn(i,o,h){const f=[],_=this.transform;if(!_)return f;const M=h?_.getCameraQueryGeometry(i):i,S=i.map(Q=>_.pointCoordinate(Q,this.terrain)),C=M.map(Q=>_.pointCoordinate(Q,this.terrain)),k=this.getIds();let F=1/0,B=1/0,q=-1/0,te=-1/0;for(const Q of C)F=Math.min(F,Q.x),B=Math.min(B,Q.y),q=Math.max(q,Q.x),te=Math.max(te,Q.y);for(let Q=0;Q<k.length;Q++){const re=this._tiles[k[Q]];if(re.holdingForFade())continue;const W=re.tileID,pe=Math.pow(2,_.zoom-re.tileID.overscaledZ),Ie=o*re.queryPadding*l.W/re.tileSize/pe,le=[W.getTilePoint(new l.Y(F,B)),W.getTilePoint(new l.Y(q,te))];if(le[0].x-Ie<l.W&&le[0].y-Ie<l.W&&le[1].x+Ie>=0&&le[1].y+Ie>=0){const be=S.map(ke=>W.getTilePoint(ke)),Ae=C.map(ke=>W.getTilePoint(ke));f.push({tile:re,tileID:W,queryGeometry:be,cameraQueryGeometry:Ae,scale:pe})}}return f}getVisibleCoordinates(i){const o=this.getRenderableIds(i).map(h=>this._tiles[h].tileID);for(const h of o)h.posMatrix=this.transform.calculatePosMatrix(h.toUnwrapped());return o}hasTransition(){if(this._source.hasTransition())return!0;if(ai(this._source.type)){const i=D.now();for(const o in this._tiles)if(this._tiles[o].fadeEndTime>=i)return!0}return!1}setFeatureState(i,o,h){this._state.updateState(i=i||"_geojsonTileLayer",o,h)}removeFeatureState(i,o,h){this._state.removeFeatureState(i=i||"_geojsonTileLayer",o,h)}getFeatureState(i,o){return this._state.getState(i=i||"_geojsonTileLayer",o)}setDependencies(i,o,h){const f=this._tiles[i];f&&f.setDependencies(o,h)}reloadTilesForDependencies(i,o){for(const h in this._tiles)this._tiles[h].hasDependency(i,o)&&this._reloadTile(h,"reloading");this._cache.filter(h=>!h.hasDependency(i,o))}}function nt(g,i){const o=Math.abs(2*g.wrap)-+(g.wrap<0),h=Math.abs(2*i.wrap)-+(i.wrap<0);return g.overscaledZ-i.overscaledZ||h-o||i.canonical.y-g.canonical.y||i.canonical.x-g.canonical.x}function ai(g){return g==="raster"||g==="image"||g==="video"}wr.maxOverzooming=10,wr.maxUnderzooming=3;class Ot{constructor(i,o){this.reset(i,o)}reset(i,o){this.points=i||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=l.ac(i,0,1);let o=1,h=this._distances[o];const f=i*this.paddedLength+this.padding;for(;h<f&&o<this._distances.length;)h=this._distances[++o];const _=o-1,M=this._distances[_],S=h-M,C=S>0?(f-M)/S:0;return this.points[_].mult(1-C).add(this.points[o].mult(C))}}function $i(g,i){let o=!0;return g==="always"||g!=="never"&&i!=="never"||(o=!1),o}class mn{constructor(i,o,h){const f=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(i/h),this.yCellCount=Math.ceil(o/h);for(let M=0;M<this.xCellCount*this.yCellCount;M++)f.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=o,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,o,h,f,_){this._forEachCell(o,h,f,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(f),this.bboxes.push(_)}insertCircle(i,o,h,f){this._forEachCell(o-f,h-f,o+f,h+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(o),this.circles.push(h),this.circles.push(f)}_insertBoxCell(i,o,h,f,_,M){this.boxCells[_].push(M)}_insertCircleCell(i,o,h,f,_,M){this.circleCells[_].push(M)}_query(i,o,h,f,_,M,S){if(h<0||i>this.width||f<0||o>this.height)return[];const C=[];if(i<=0&&o<=0&&this.width<=h&&this.height<=f){if(_)return[{key:null,x1:i,y1:o,x2:h,y2:f}];for(let k=0;k<this.boxKeys.length;k++)C.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const F=this.circles[3*k],B=this.circles[3*k+1],q=this.circles[3*k+2];C.push({key:this.circleKeys[k],x1:F-q,y1:B-q,x2:F+q,y2:B+q})}}else this._forEachCell(i,o,h,f,this._queryCell,C,{hitTest:_,overlapMode:M,seenUids:{box:{},circle:{}}},S);return C}query(i,o,h,f){return this._query(i,o,h,f,!1,null)}hitTest(i,o,h,f,_,M){return this._query(i,o,h,f,!0,_,M).length>0}hitTestCircle(i,o,h,f,_){const M=i-h,S=i+h,C=o-h,k=o+h;if(S<0||M>this.width||k<0||C>this.height)return!1;const F=[];return this._forEachCell(M,C,S,k,this._queryCellCircle,F,{hitTest:!0,overlapMode:f,circle:{x:i,y:o,radius:h},seenUids:{box:{},circle:{}}},_),F.length>0}_queryCell(i,o,h,f,_,M,S,C){const{seenUids:k,hitTest:F,overlapMode:B}=S,q=this.boxCells[_];if(q!==null){const Q=this.bboxes;for(const re of q)if(!k.box[re]){k.box[re]=!0;const W=4*re,pe=this.boxKeys[re];if(i<=Q[W+2]&&o<=Q[W+3]&&h>=Q[W+0]&&f>=Q[W+1]&&(!C||C(pe))&&(!F||!$i(B,pe.overlapMode))&&(M.push({key:pe,x1:Q[W],y1:Q[W+1],x2:Q[W+2],y2:Q[W+3]}),F))return!0}}const te=this.circleCells[_];if(te!==null){const Q=this.circles;for(const re of te)if(!k.circle[re]){k.circle[re]=!0;const W=3*re,pe=this.circleKeys[re];if(this._circleAndRectCollide(Q[W],Q[W+1],Q[W+2],i,o,h,f)&&(!C||C(pe))&&(!F||!$i(B,pe.overlapMode))){const Ie=Q[W],le=Q[W+1],be=Q[W+2];if(M.push({key:pe,x1:Ie-be,y1:le-be,x2:Ie+be,y2:le+be}),F)return!0}}}return!1}_queryCellCircle(i,o,h,f,_,M,S,C){const{circle:k,seenUids:F,overlapMode:B}=S,q=this.boxCells[_];if(q!==null){const Q=this.bboxes;for(const re of q)if(!F.box[re]){F.box[re]=!0;const W=4*re,pe=this.boxKeys[re];if(this._circleAndRectCollide(k.x,k.y,k.radius,Q[W+0],Q[W+1],Q[W+2],Q[W+3])&&(!C||C(pe))&&!$i(B,pe.overlapMode))return M.push(!0),!0}}const te=this.circleCells[_];if(te!==null){const Q=this.circles;for(const re of te)if(!F.circle[re]){F.circle[re]=!0;const W=3*re,pe=this.circleKeys[re];if(this._circlesCollide(Q[W],Q[W+1],Q[W+2],k.x,k.y,k.radius)&&(!C||C(pe))&&!$i(B,pe.overlapMode))return M.push(!0),!0}}}_forEachCell(i,o,h,f,_,M,S,C){const k=this._convertToXCellCoord(i),F=this._convertToYCellCoord(o),B=this._convertToXCellCoord(h),q=this._convertToYCellCoord(f);for(let te=k;te<=B;te++)for(let Q=F;Q<=q;Q++)if(_.call(this,i,o,h,f,this.xCellCount*Q+te,M,S,C))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,o,h,f,_,M){const S=f-i,C=_-o,k=h+M;return k*k>S*S+C*C}_circleAndRectCollide(i,o,h,f,_,M,S){const C=(M-f)/2,k=Math.abs(i-(f+C));if(k>C+h)return!1;const F=(S-_)/2,B=Math.abs(o-(_+F));if(B>F+h)return!1;if(k<=C||B<=F)return!0;const q=k-C,te=B-F;return q*q+te*te<=h*h}}function Jt(g,i,o,h,f){const _=l.F();return i?(l.J(_,_,[1/f,1/f,1]),o||l.ad(_,_,h.angle)):l.K(_,h.labelPlaneMatrix,g),_}function Ws(g,i,o,h,f){if(i){const _=l.ae(g);return l.J(_,_,[f,f,1]),o||l.ad(_,_,-h.angle),_}return h.glCoordMatrix}function Mr(g,i,o){let h;o?(h=[g.x,g.y,o(g.x,g.y),1],l.af(h,h,i)):(h=[g.x,g.y,0,1],Ft(h,h,i));const f=h[3];return{point:new l.P(h[0]/f,h[1]/f),signedDistanceFromCamera:f}}function ee(g,i){return .5+g/i*.5}function N(g,i){const o=g[0]/g[3],h=g[1]/g[3];return o>=-i[0]&&o<=i[0]&&h>=-i[1]&&h<=i[1]}function U(g,i,o,h,f,_,M,S,C,k){const F=h?g.textSizeData:g.iconSizeData,B=l.ag(F,o.transform.zoom),q=[256/o.width*2+1,256/o.height*2+1],te=h?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;te.clear();const Q=g.lineVertexArray,re=h?g.text.placedSymbolArray:g.icon.placedSymbolArray,W=o.transform.width/o.transform.height;let pe=!1;for(let Ie=0;Ie<re.length;Ie++){const le=re.get(Ie);if(le.hidden||le.writingMode===l.ah.vertical&&!pe){Ne(le.numGlyphs,te);continue}let be;if(pe=!1,k?(be=[le.anchorX,le.anchorY,k(le.anchorX,le.anchorY),1],l.af(be,be,i)):(be=[le.anchorX,le.anchorY,0,1],Ft(be,be,i)),!N(be,q)){Ne(le.numGlyphs,te);continue}const Ae=ee(o.transform.cameraToCenterDistance,be[3]),ke=l.ai(F,B,le),ze=M?ke/Ae:ke*Ae,We=new l.P(le.anchorX,le.anchorY),He=Mr(We,f,k).point,st={projections:{},offsets:{}},ct=_e(le,ze,!1,S,i,f,_,g.glyphOffsetArray,Q,te,He,We,st,W,C,k);pe=ct.useVertical,(ct.notEnoughRoom||pe||ct.needsFlipping&&_e(le,ze,!0,S,i,f,_,g.glyphOffsetArray,Q,te,He,We,st,W,C,k).notEnoughRoom)&&Ne(le.numGlyphs,te)}h?g.text.dynamicLayoutVertexBuffer.updateData(te):g.icon.dynamicLayoutVertexBuffer.updateData(te)}function H(g,i,o,h,f,_,M,S,C,k,F,B,q){const te=S.glyphStartIndex+S.numGlyphs,Q=S.lineStartIndex,re=S.lineStartIndex+S.lineLength,W=i.getoffsetX(S.glyphStartIndex),pe=i.getoffsetX(te-1),Ie=qe(g*W,o,h,f,_,M,S.segment,Q,re,C,k,F,B,q);if(!Ie)return null;const le=qe(g*pe,o,h,f,_,M,S.segment,Q,re,C,k,F,B,q);return le?{first:Ie,last:le}:null}function J(g,i,o,h){return g===l.ah.horizontal&&Math.abs(o.y-i.y)>Math.abs(o.x-i.x)*h?{useVertical:!0}:(g===l.ah.vertical?i.y<o.y:i.x>o.x)?{needsFlipping:!0}:null}function _e(g,i,o,h,f,_,M,S,C,k,F,B,q,te,Q,re){const W=i/24,pe=g.lineOffsetX*W,Ie=g.lineOffsetY*W;let le;if(g.numGlyphs>1){const be=g.glyphStartIndex+g.numGlyphs,Ae=g.lineStartIndex,ke=g.lineStartIndex+g.lineLength,ze=H(W,S,pe,Ie,o,F,B,g,C,_,q,Q,re);if(!ze)return{notEnoughRoom:!0};const We=Mr(ze.first.point,M,re).point,He=Mr(ze.last.point,M,re).point;if(h&&!o){const st=J(g.writingMode,We,He,te);if(st)return st}le=[ze.first];for(let st=g.glyphStartIndex+1;st<be-1;st++)le.push(qe(W*S.getoffsetX(st),pe,Ie,o,F,B,g.segment,Ae,ke,C,_,q,Q,re));le.push(ze.last)}else{if(h&&!o){const Ae=Mr(B,f,re).point,ke=g.lineStartIndex+g.segment+1,ze=new l.P(C.getx(ke),C.gety(ke)),We=Mr(ze,f,re),He=We.signedDistanceFromCamera>0?We.point:ve(B,ze,Ae,1,f,re),st=J(g.writingMode,Ae,He,te);if(st)return st}const be=qe(W*S.getoffsetX(g.glyphStartIndex),pe,Ie,o,F,B,g.segment,g.lineStartIndex,g.lineStartIndex+g.lineLength,C,_,q,Q,re);if(!be)return{notEnoughRoom:!0};le=[be]}for(const be of le)l.aj(k,be.point,be.angle);return{}}function ve(g,i,o,h,f,_){const M=Mr(g.add(g.sub(i)._unit()),f,_).point,S=o.sub(M);return o.add(S._mult(h/S.mag()))}function we(g,i){const{projectionCache:o,lineVertexArray:h,labelPlaneMatrix:f,tileAnchorPoint:_,distanceFromAnchor:M,getElevation:S,previousVertex:C,direction:k,absOffsetX:F}=i;if(o.projections[g])return o.projections[g];const B=new l.P(h.getx(g),h.gety(g)),q=Mr(B,f,S);if(q.signedDistanceFromCamera>0)return o.projections[g]=q.point,q.point;const te=g-k;return ve(M===0?_:new l.P(h.getx(te),h.gety(te)),B,C,F-M+1,f,S)}function de(g,i,o){return g._unit()._perp()._mult(i*o)}function Ce(g,i,o,h,f,_,M,S){const{projectionCache:C,direction:k}=S;if(C.offsets[g])return C.offsets[g];const F=o.add(i);if(g+k<h||g+k>=f)return C.offsets[g]=F,F;const B=we(g+k,S),q=de(B.sub(o),M,k),te=o.add(q),Q=B.add(q);return C.offsets[g]=l.ak(_,F,te,Q)||F,C.offsets[g]}function qe(g,i,o,h,f,_,M,S,C,k,F,B,q,te){const Q=h?g-i:g+i;let re=Q>0?1:-1,W=0;h&&(re*=-1,W=Math.PI),re<0&&(W+=Math.PI);let pe,Ie,le=re>0?S+M:S+M+1,be=f,Ae=f,ke=0,ze=0;const We=Math.abs(Q),He=[];let st;for(;ke+ze<=We;){if(le+=re,le<S||le>=C)return null;ke+=ze,Ae=be,Ie=pe;const mt={projectionCache:B,lineVertexArray:k,labelPlaneMatrix:F,tileAnchorPoint:_,distanceFromAnchor:ke,getElevation:te,previousVertex:Ae,direction:re,absOffsetX:We};if(be=we(le,mt),o===0)He.push(Ae),st=be.sub(Ae);else{let Yt;const ui=be.sub(Ae);Yt=ui.mag()===0?de(we(le+re,mt).sub(be),o,re):de(ui,o,re),Ie||(Ie=Ae.add(Yt)),pe=Ce(le,Yt,be,S,C,Ie,o,mt),He.push(Ie),st=pe.sub(Ie)}ze=st.mag()}const ct=st._mult((We-ke)/ze)._add(Ie||Ae),ci=W+Math.atan2(be.y-Ae.y,be.x-Ae.x);return He.push(ct),{point:ct,angle:q?ci:0,path:He}}const Re=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ne(g,i){for(let o=0;o<g;o++){const h=i.length;i.resize(h+4),i.float32.set(Re,3*h)}}function Ft(g,i,o){const h=i[0],f=i[1];return g[0]=o[0]*h+o[4]*f+o[12],g[1]=o[1]*h+o[5]*f+o[13],g[3]=o[3]*h+o[7]*f+o[15],g}const Ut=100;class Qt{constructor(i,o=new mn(i.width+200,i.height+200,25),h=new mn(i.width+200,i.height+200,25)){this.transform=i,this.grid=o,this.ignoredGrid=h,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Ut,this.screenBottomBoundary=i.height+Ut,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(i,o,h,f,_,M){const S=this.projectAndGetPerspectiveRatio(f,i.anchorPointX,i.anchorPointY,M),C=h*S.perspectiveRatio,k=i.x1*C+S.point.x,F=i.y1*C+S.point.y,B=i.x2*C+S.point.x,q=i.y2*C+S.point.y;return!this.isInsideGrid(k,F,B,q)||o!=="always"&&this.grid.hitTest(k,F,B,q,o,_)||S.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[k,F,B,q],offscreen:this.isOffscreen(k,F,B,q)}}placeCollisionCircles(i,o,h,f,_,M,S,C,k,F,B,q,te,Q){const re=[],W=new l.P(o.anchorX,o.anchorY),pe=Mr(W,M,Q),Ie=ee(this.transform.cameraToCenterDistance,pe.signedDistanceFromCamera),le=(F?_/Ie:_*Ie)/l.ao,be=Mr(W,S,Q).point,Ae=H(le,f,o.lineOffsetX*le,o.lineOffsetY*le,!1,be,W,o,h,S,{projections:{},offsets:{}},!1,Q);let ke=!1,ze=!1,We=!0;if(Ae){const He=.5*q*Ie+te,st=new l.P(-100,-100),ct=new l.P(this.screenRightBoundary,this.screenBottomBoundary),ci=new Ot,mt=Ae.first,Yt=Ae.last;let ui=[];for(let di=mt.path.length-1;di>=1;di--)ui.push(mt.path[di]);for(let di=1;di<Yt.path.length;di++)ui.push(Yt.path[di]);const Pi=2.5*He;if(C){const di=ui.map(yi=>Mr(yi,C,Q));ui=di.some(yi=>yi.signedDistanceFromCamera<=0)?[]:di.map(yi=>yi.point)}let ii=[];if(ui.length>0){const di=ui[0].clone(),yi=ui[0].clone();for(let Rr=1;Rr<ui.length;Rr++)di.x=Math.min(di.x,ui[Rr].x),di.y=Math.min(di.y,ui[Rr].y),yi.x=Math.max(yi.x,ui[Rr].x),yi.y=Math.max(yi.y,ui[Rr].y);ii=di.x>=st.x&&yi.x<=ct.x&&di.y>=st.y&&yi.y<=ct.y?[ui]:yi.x<st.x||di.x>ct.x||yi.y<st.y||di.y>ct.y?[]:l.al([ui],st.x,st.y,ct.x,ct.y)}for(const di of ii){ci.reset(di,.25*He);let yi=0;yi=ci.length<=.5*He?1:Math.ceil(ci.paddedLength/Pi)+1;for(let Rr=0;Rr<yi;Rr++){const Xi=Rr/Math.max(yi-1,1),as=ci.lerp(Xi),rn=as.x+Ut,Tr=as.y+Ut;re.push(rn,Tr,He,0);const nn=rn-He,os=Tr-He,ta=rn+He,ja=Tr+He;if(We=We&&this.isOffscreen(nn,os,ta,ja),ze=ze||this.isInsideGrid(nn,os,ta,ja),i!=="always"&&this.grid.hitTestCircle(rn,Tr,He,i,B)&&(ke=!0,!k))return{circles:[],offscreen:!1,collisionDetected:ke}}}}return{circles:!k&&ke||!ze||Ie<this.perspectiveRatioCutoff?[]:re,offscreen:We,collisionDetected:ke}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let h=1/0,f=1/0,_=-1/0,M=-1/0;for(const F of i){const B=new l.P(F.x+Ut,F.y+Ut);h=Math.min(h,B.x),f=Math.min(f,B.y),_=Math.max(_,B.x),M=Math.max(M,B.y),o.push(B)}const S=this.grid.query(h,f,_,M).concat(this.ignoredGrid.query(h,f,_,M)),C={},k={};for(const F of S){const B=F.key;if(C[B.bucketInstanceId]===void 0&&(C[B.bucketInstanceId]={}),C[B.bucketInstanceId][B.featureIndex])continue;const q=[new l.P(F.x1,F.y1),new l.P(F.x2,F.y1),new l.P(F.x2,F.y2),new l.P(F.x1,F.y2)];l.am(o,q)&&(C[B.bucketInstanceId][B.featureIndex]=!0,k[B.bucketInstanceId]===void 0&&(k[B.bucketInstanceId]=[]),k[B.bucketInstanceId].push(B.featureIndex))}return k}insertCollisionBox(i,o,h,f,_,M){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:_,collisionGroupID:M,overlapMode:o},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,o,h,f,_,M){const S=h?this.ignoredGrid:this.grid,C={bucketInstanceId:f,featureIndex:_,collisionGroupID:M,overlapMode:o};for(let k=0;k<i.length;k+=4)S.insertCircle(C,i[k],i[k+1],i[k+2])}projectAndGetPerspectiveRatio(i,o,h,f){let _;return f?(_=[o,h,f(o,h),1],l.af(_,_,i)):(_=[o,h,0,1],Ft(_,_,i)),{point:new l.P((_[0]/_[3]+1)/2*this.transform.width+Ut,(-_[1]/_[3]+1)/2*this.transform.height+Ut),perspectiveRatio:.5+this.transform.cameraToCenterDistance/_[3]*.5}}isOffscreen(i,o,h,f){return h<Ut||i>=this.screenRightBoundary||f<Ut||o>this.screenBottomBoundary}isInsideGrid(i,o,h,f){return h>=0&&i<this.gridRightBoundary&&f>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const i=l.an([]);return l.H(i,i,[-100,-100,0]),i}}function ti(g,i,o){return i*(l.W/(g.tileSize*Math.pow(2,o-g.tileID.overscaledZ)))}class mi{constructor(i,o,h,f){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?o:-o))):f&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class Fi{constructor(i,o,h,f,_){this.text=new mi(i?i.text:null,o,h,_),this.icon=new mi(i?i.icon:null,o,f,_)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ir{constructor(i,o,h){this.text=i,this.icon=o,this.skipFade=h}}class Or{constructor(){this.invProjMatrix=l.F(),this.viewportMatrix=l.F(),this.circles=[]}}class Ht{constructor(i,o,h,f,_){this.bucketInstanceId=i,this.featureIndex=o,this.sourceLayerIndex=h,this.bucketIndex=f,this.tileID=_}}class pr{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const o=++this.maxGroupID;this.collisionGroups[i]={ID:o,predicate:h=>h.collisionGroupID===o}}return this.collisionGroups[i]}}function Ur(g,i,o,h,f){const{horizontalAlign:_,verticalAlign:M}=l.at(g);return new l.P(-(_-.5)*i+h[0]*f,-(M-.5)*o+h[1]*f)}function gn(g,i,o,h,f,_){const{x1:M,x2:S,y1:C,y2:k,anchorPointX:F,anchorPointY:B}=g,q=new l.P(i,o);return h&&q._rotate(f?_:-_),{x1:M+q.x,y1:C+q.y,x2:S+q.x,y2:k+q.y,anchorPointX:F,anchorPointY:B}}class yn{constructor(i,o,h,f,_){this.transform=i.clone(),this.terrain=o,this.collisionIndex=new Qt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new pr(f),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,o,h,f){const _=h.getBucket(o),M=h.latestFeatureIndex;if(!_||!M||o.id!==_.layerIds[0])return;const S=h.collisionBoxArray,C=_.layers[0].layout,k=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),F=h.tileSize/l.W,B=this.transform.calculatePosMatrix(h.tileID.toUnwrapped()),q=C.get("text-pitch-alignment")==="map",te=C.get("text-rotation-alignment")==="map",Q=ti(h,1,this.transform.zoom),re=Jt(B,q,te,this.transform,Q);let W=null;if(q){const Ie=Ws(B,q,te,this.transform,Q);W=l.K([],this.transform.labelPlaneMatrix,Ie)}this.retainedQueryData[_.bucketInstanceId]=new Ht(_.bucketInstanceId,M,_.sourceLayerIndex,_.index,h.tileID);const pe={bucket:_,layout:C,posMatrix:B,textLabelPlaneMatrix:re,labelToScreenMatrix:W,scale:k,textPixelRatio:F,holdingForFade:h.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:l.ag(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(f)for(const Ie of _.sortKeyRanges){const{sortKey:le,symbolInstanceStart:be,symbolInstanceEnd:Ae}=Ie;i.push({sortKey:le,symbolInstanceStart:be,symbolInstanceEnd:Ae,parameters:pe})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:pe})}attemptAnchorPlacement(i,o,h,f,_,M,S,C,k,F,B,q,te,Q,re,W){const pe=l.ap[i.textAnchor],Ie=[i.textOffset0,i.textOffset1],le=Ur(pe,h,f,Ie,_),be=this.collisionIndex.placeCollisionBox(gn(o,le.x,le.y,M,S,this.transform.angle),B,C,k,F.predicate,W);if((!re||this.collisionIndex.placeCollisionBox(gn(re,le.x,le.y,M,S,this.transform.angle),B,C,k,F.predicate,W).box.length!==0)&&be.box.length>0){let Ae;if(this.prevPlacement&&this.prevPlacement.variableOffsets[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID].text&&(Ae=this.prevPlacement.variableOffsets[q.crossTileID].anchor),q.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[q.crossTileID]={textOffset:Ie,width:h,height:f,anchor:pe,textBoxScale:_,prevAnchor:Ae},this.markUsedJustification(te,pe,q,Q),te.allowVerticalPlacement&&(this.markUsedOrientation(te,Q,q),this.placedOrientations[q.crossTileID]=Q),{shift:le,placedGlyphBoxes:be}}}placeLayerBucketPart(i,o,h){const{bucket:f,layout:_,posMatrix:M,textLabelPlaneMatrix:S,labelToScreenMatrix:C,textPixelRatio:k,holdingForFade:F,collisionBoxArray:B,partiallyEvaluatedTextSize:q,collisionGroup:te}=i.parameters,Q=_.get("text-optional"),re=_.get("icon-optional"),W=l.aq(_,"text-overlap","text-allow-overlap"),pe=W==="always",Ie=l.aq(_,"icon-overlap","icon-allow-overlap"),le=Ie==="always",be=_.get("text-rotation-alignment")==="map",Ae=_.get("text-pitch-alignment")==="map",ke=_.get("icon-text-fit")!=="none",ze=_.get("symbol-z-order")==="viewport-y",We=pe&&(le||!f.hasIconData()||re),He=le&&(pe||!f.hasTextData()||Q);!f.collisionArrays&&B&&f.deserializeCollisionBoxes(B);const st=this.retainedQueryData[f.bucketInstanceId].tileID,ct=this.terrain?(mt,Yt)=>this.terrain.getElevation(st,mt,Yt):null,ci=(mt,Yt)=>{var ui,Pi;if(o[mt.crossTileID])return;if(F)return void(this.placements[mt.crossTileID]=new ir(!1,!1,!1));let ii=!1,di=!1,yi=!0,Rr=null,Xi={box:null,offscreen:null},as={box:null,offscreen:null},rn=null,Tr=null,nn=null,os=0,ta=0,ja=0;Yt.textFeatureIndex?os=Yt.textFeatureIndex:mt.useRuntimeCollisionCircles&&(os=mt.featureIndex),Yt.verticalTextFeatureIndex&&(ta=Yt.verticalTextFeatureIndex);const Xl=Yt.textBox;if(Xl){const Wr=Xr=>{let Ir=l.ah.horizontal;if(f.allowVerticalPlacement&&!Xr&&this.prevPlacement){const Es=this.prevPlacement.placedOrientations[mt.crossTileID];Es&&(this.placedOrientations[mt.crossTileID]=Es,Ir=Es,this.markUsedOrientation(f,Ir,mt))}return Ir},Cr=(Xr,Ir)=>{if(f.allowVerticalPlacement&&mt.numVerticalGlyphVertices>0&&Yt.verticalTextBox){for(const Es of f.writingModes)if(Es===l.ah.vertical?(Xi=Ir(),as=Xi):Xi=Xr(),Xi&&Xi.box&&Xi.box.length)break}else Xi=Xr()},yr=mt.textAnchorOffsetStartIndex,Ss=mt.textAnchorOffsetEndIndex;if(Ss===yr){const Xr=(Ir,Es)=>{const Kr=this.collisionIndex.placeCollisionBox(Ir,W,k,M,te.predicate,ct);return Kr&&Kr.box&&Kr.box.length&&(this.markUsedOrientation(f,Es,mt),this.placedOrientations[mt.crossTileID]=Es),Kr};Cr(()=>Xr(Xl,l.ah.horizontal),()=>{const Ir=Yt.verticalTextBox;return f.allowVerticalPlacement&&mt.numVerticalGlyphVertices>0&&Ir?Xr(Ir,l.ah.vertical):{box:null,offscreen:null}}),Wr(Xi&&Xi.box&&Xi.box.length)}else{let Xr=l.ap[(Pi=(ui=this.prevPlacement)===null||ui===void 0?void 0:ui.variableOffsets[mt.crossTileID])===null||Pi===void 0?void 0:Pi.anchor];const Ir=(Kr,Br,Pu)=>{const id=Kr.x2-Kr.x1,vo=Kr.y2-Kr.y1,xo=mt.textBoxScale,Pc=ke&&Ie==="never"?Br:null;let Ga={box:[],offscreen:!1},Du=W==="never"?1:2,rd="never";Xr&&Du++;for(let ku=0;ku<Du;ku++){for(let Lu=yr;Lu<Ss;Lu++){const Dc=f.textAnchorOffsets.get(Lu);if(Xr&&Dc.textAnchor!==Xr)continue;const Ru=this.attemptAnchorPlacement(Dc,Kr,id,vo,xo,be,Ae,k,M,te,rd,mt,f,Pu,Pc,ct);if(Ru&&(Ga=Ru.placedGlyphBoxes,Ga&&Ga.box&&Ga.box.length))return ii=!0,Rr=Ru.shift,Ga}Xr?Xr=null:rd=W}return Ga};Cr(()=>Ir(Xl,Yt.iconBox,l.ah.horizontal),()=>{const Kr=Yt.verticalTextBox;return f.allowVerticalPlacement&&!(Xi&&Xi.box&&Xi.box.length)&&mt.numVerticalGlyphVertices>0&&Kr?Ir(Kr,Yt.verticalIconBox,l.ah.vertical):{box:null,offscreen:null}}),Xi&&(ii=Xi.box,yi=Xi.offscreen);const Es=Wr(Xi&&Xi.box);if(!ii&&this.prevPlacement){const Kr=this.prevPlacement.variableOffsets[mt.crossTileID];Kr&&(this.variableOffsets[mt.crossTileID]=Kr,this.markUsedJustification(f,Kr.anchor,mt,Es))}}}if(rn=Xi,ii=rn&&rn.box&&rn.box.length>0,yi=rn&&rn.offscreen,mt.useRuntimeCollisionCircles){const Wr=f.text.placedSymbolArray.get(mt.centerJustifiedTextSymbolIndex),Cr=l.ai(f.textSizeData,q,Wr),yr=_.get("text-padding");Tr=this.collisionIndex.placeCollisionCircles(W,Wr,f.lineVertexArray,f.glyphOffsetArray,Cr,M,S,C,h,Ae,te.predicate,mt.collisionCircleDiameter,yr,ct),Tr.circles.length&&Tr.collisionDetected&&!h&&l.w("Collisions detected, but collision boxes are not shown"),ii=pe||Tr.circles.length>0&&!Tr.collisionDetected,yi=yi&&Tr.offscreen}if(Yt.iconFeatureIndex&&(ja=Yt.iconFeatureIndex),Yt.iconBox){const Wr=Cr=>{const yr=ke&&Rr?gn(Cr,Rr.x,Rr.y,be,Ae,this.transform.angle):Cr;return this.collisionIndex.placeCollisionBox(yr,Ie,k,M,te.predicate,ct)};as&&as.box&&as.box.length&&Yt.verticalIconBox?(nn=Wr(Yt.verticalIconBox),di=nn.box.length>0):(nn=Wr(Yt.iconBox),di=nn.box.length>0),yi=yi&&nn.offscreen}const qa=Q||mt.numHorizontalGlyphVertices===0&&mt.numVerticalGlyphVertices===0,ia=re||mt.numIconVertices===0;if(qa||ia?ia?qa||(di=di&&ii):ii=di&&ii:di=ii=di&&ii,ii&&rn&&rn.box&&this.collisionIndex.insertCollisionBox(rn.box,W,_.get("text-ignore-placement"),f.bucketInstanceId,as&&as.box&&ta?ta:os,te.ID),di&&nn&&this.collisionIndex.insertCollisionBox(nn.box,Ie,_.get("icon-ignore-placement"),f.bucketInstanceId,ja,te.ID),Tr&&(ii&&this.collisionIndex.insertCollisionCircles(Tr.circles,W,_.get("text-ignore-placement"),f.bucketInstanceId,os,te.ID),h)){const Wr=f.bucketInstanceId;let Cr=this.collisionCircleArrays[Wr];Cr===void 0&&(Cr=this.collisionCircleArrays[Wr]=new Or);for(let yr=0;yr<Tr.circles.length;yr+=4)Cr.circles.push(Tr.circles[yr+0]),Cr.circles.push(Tr.circles[yr+1]),Cr.circles.push(Tr.circles[yr+2]),Cr.circles.push(Tr.collisionDetected?1:0)}if(mt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(f.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[mt.crossTileID]=new ir(ii||We,di||He,yi||f.justReloaded),o[mt.crossTileID]=!0};if(ze){if(i.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const mt=f.getSortedSymbolIndexes(this.transform.angle);for(let Yt=mt.length-1;Yt>=0;--Yt){const ui=mt[Yt];ci(f.symbolInstances.get(ui),f.collisionArrays[ui])}}else for(let mt=i.symbolInstanceStart;mt<i.symbolInstanceEnd;mt++)ci(f.symbolInstances.get(mt),f.collisionArrays[mt]);if(h&&f.bucketInstanceId in this.collisionCircleArrays){const mt=this.collisionCircleArrays[f.bucketInstanceId];l.ar(mt.invProjMatrix,M),mt.viewportMatrix=this.collisionIndex.getViewportMatrix()}f.justReloaded=!1}markUsedJustification(i,o,h,f){let _;_=f===l.ah.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[l.as(o)];const M=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];for(const S of M)S>=0&&(i.text.placedSymbolArray.get(S).crossTileID=_>=0&&S!==_?0:h.crossTileID)}markUsedOrientation(i,o,h){const f=o===l.ah.horizontal||o===l.ah.horizontalOnly?o:0,_=o===l.ah.vertical?o:0,M=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];for(const S of M)i.text.placedSymbolArray.get(S).placedOrientation=f;h.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let h=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const f=o?o.symbolFadeChange(i):1,_=o?o.opacities:{},M=o?o.variableOffsets:{},S=o?o.placedOrientations:{};for(const C in this.placements){const k=this.placements[C],F=_[C];F?(this.opacities[C]=new Fi(F,f,k.text,k.icon),h=h||k.text!==F.text.placed||k.icon!==F.icon.placed):(this.opacities[C]=new Fi(null,f,k.text,k.icon,k.skipFade),h=h||k.text||k.icon)}for(const C in _){const k=_[C];if(!this.opacities[C]){const F=new Fi(k,f,!1,!1);F.isHidden()||(this.opacities[C]=F,h=h||k.text.placed||k.icon.placed)}}for(const C in M)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=M[C]);for(const C in S)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=S[C]);if(o&&o.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");h?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:i)}updateLayerOpacities(i,o){const h={};for(const f of o){const _=f.getBucket(i);_&&f.latestFeatureIndex&&i.id===_.layerIds[0]&&this.updateBucketOpacities(_,h,f.collisionBoxArray)}}updateBucketOpacities(i,o,h){i.hasTextData()&&(i.text.opacityVertexArray.clear(),i.text.hasVisibleVertices=!1),i.hasIconData()&&(i.icon.opacityVertexArray.clear(),i.icon.hasVisibleVertices=!1),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const f=i.layers[0],_=f.layout,M=new Fi(null,0,!1,!1,!0),S=_.get("text-allow-overlap"),C=_.get("icon-allow-overlap"),k=f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset"),F=_.get("text-rotation-alignment")==="map",B=_.get("text-pitch-alignment")==="map",q=_.get("icon-text-fit")!=="none",te=new Fi(null,0,S&&(C||!i.hasIconData()||_.get("icon-optional")),C&&(S||!i.hasTextData()||_.get("text-optional")),!0);!i.collisionArrays&&h&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(h);const Q=(re,W,pe)=>{for(let Ie=0;Ie<W/4;Ie++)re.opacityVertexArray.emplaceBack(pe);re.hasVisibleVertices=re.hasVisibleVertices||pe!==qn};for(let re=0;re<i.symbolInstances.length;re++){const W=i.symbolInstances.get(re),{numHorizontalGlyphVertices:pe,numVerticalGlyphVertices:Ie,crossTileID:le}=W;let be=this.opacities[le];o[le]?be=M:be||(be=te,this.opacities[le]=be),o[le]=!0;const Ae=W.numIconVertices>0,ke=this.placedOrientations[W.crossTileID],ze=ke===l.ah.vertical,We=ke===l.ah.horizontal||ke===l.ah.horizontalOnly;if(pe>0||Ie>0){const He=_n(be.text);Q(i.text,pe,ze?qn:He),Q(i.text,Ie,We?qn:He);const st=be.text.isHidden();[W.rightJustifiedTextSymbolIndex,W.centerJustifiedTextSymbolIndex,W.leftJustifiedTextSymbolIndex].forEach(mt=>{mt>=0&&(i.text.placedSymbolArray.get(mt).hidden=st||ze?1:0)}),W.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(W.verticalPlacedTextSymbolIndex).hidden=st||We?1:0);const ct=this.variableOffsets[W.crossTileID];ct&&this.markUsedJustification(i,ct.anchor,W,ke);const ci=this.placedOrientations[W.crossTileID];ci&&(this.markUsedJustification(i,"left",W,ci),this.markUsedOrientation(i,ci,W))}if(Ae){const He=_n(be.icon),st=!(q&&W.verticalPlacedIconSymbolIndex&&ze);W.placedIconSymbolIndex>=0&&(Q(i.icon,W.numIconVertices,st?He:qn),i.icon.placedSymbolArray.get(W.placedIconSymbolIndex).hidden=be.icon.isHidden()),W.verticalPlacedIconSymbolIndex>=0&&(Q(i.icon,W.numVerticalIconVertices,st?qn:He),i.icon.placedSymbolArray.get(W.verticalPlacedIconSymbolIndex).hidden=be.icon.isHidden())}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const He=i.collisionArrays[re];if(He){let st=new l.P(0,0);if(He.textBox||He.verticalTextBox){let ci=!0;if(k){const mt=this.variableOffsets[le];mt?(st=Ur(mt.anchor,mt.width,mt.height,mt.textOffset,mt.textBoxScale),F&&st._rotate(B?this.transform.angle:-this.transform.angle)):ci=!1}He.textBox&&Zr(i.textCollisionBox.collisionVertexArray,be.text.placed,!ci||ze,st.x,st.y),He.verticalTextBox&&Zr(i.textCollisionBox.collisionVertexArray,be.text.placed,!ci||We,st.x,st.y)}const ct=!!(!We&&He.verticalIconBox);He.iconBox&&Zr(i.iconCollisionBox.collisionVertexArray,be.icon.placed,ct,q?st.x:0,q?st.y:0),He.verticalIconBox&&Zr(i.iconCollisionBox.collisionVertexArray,be.icon.placed,!ct,q?st.x:0,q?st.y:0)}}}if(i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.text.opacityVertexArray.length!==i.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${i.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${i.text.layoutVertexArray.length}) / 4`);if(i.icon.opacityVertexArray.length!==i.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${i.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${i.icon.layoutVertexArray.length}) / 4`);if(i.bucketInstanceId in this.collisionCircleArrays){const re=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=re.invProjMatrix,i.placementViewportMatrix=re.viewportMatrix,i.collisionCircleArray=re.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,o){const h=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*h>i}setStale(){this.stale=!0}}function Zr(g,i,o,h,f){g.emplaceBack(i?1:0,o?1:0,h||0,f||0),g.emplaceBack(i?1:0,o?1:0,h||0,f||0),g.emplaceBack(i?1:0,o?1:0,h||0,f||0),g.emplaceBack(i?1:0,o?1:0,h||0,f||0)}const jn=Math.pow(2,25),fc=Math.pow(2,24),Lo=Math.pow(2,17),Bi=Math.pow(2,16),so=Math.pow(2,9),Ar=Math.pow(2,8),An=Math.pow(2,1);function _n(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const i=g.placed?1:0,o=Math.floor(127*g.opacity);return o*jn+i*fc+o*Lo+i*Bi+o*so+i*Ar+o*An+i}const qn=0;class Pr{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&!i.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,o,h,f,_){const M=this._bucketParts;for(;this._currentTileIndex<i.length;)if(o.getBucketParts(M,f,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort((S,C)=>S.sortKey-C.sortKey));this._currentPartIndex<M.length;)if(o.placeLayerBucketPart(M[this._currentPartIndex],this._seenCrossTileIDs,h),this._currentPartIndex++,_())return!0;return!1}}class vn{constructor(i,o,h,f,_,M,S,C){this.placement=new yn(i,o,M,S,C),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(i,o,h){const f=D.now(),_=()=>!this._forceFullPlacement&&D.now()-f>2;for(;this._currentPlacementIndex>=0;){const M=o[i[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(M.type==="symbol"&&(!M.minzoom||M.minzoom<=S)&&(!M.maxzoom||M.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new Pr(M)),this._inProgressLayer.continuePlacement(h[M.source],this.placement,this._showCollisionBoxes,M,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const Gn=512/l.W/2;class ys{constructor(i,o,h){this.tileID=i,this.bucketInstanceId=h,this._symbolsByKey={};const f=new Map;for(let _=0;_<o.length;_++){const M=o.get(_),S=M.key,C=f.get(S);C?C.push(M):f.set(S,[M])}for(const[_,M]of f){const S={positions:M.map(C=>({x:Math.floor(C.anchorX*Gn),y:Math.floor(C.anchorY*Gn)})),crossTileIDs:M.map(C=>C.crossTileID)};if(S.positions.length>128){const C=new l.au(S.positions.length,16,Uint16Array);for(const{x:k,y:F}of S.positions)C.add(k,F);C.finish(),delete S.positions,S.index=C}this._symbolsByKey[_]=S}}getScaledCoordinates(i,o){const{x:h,y:f,z:_}=this.tileID.canonical,{x:M,y:S,z:C}=o.canonical,k=Gn/Math.pow(2,C-_),F=(S*l.W+i.anchorY)*k,B=f*l.W*Gn;return{x:Math.floor((M*l.W+i.anchorX)*k-h*l.W*Gn),y:Math.floor(F-B)}}findMatches(i,o,h){const f=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z);for(let _=0;_<i.length;_++){const M=i.get(_);if(M.crossTileID)continue;const S=this._symbolsByKey[M.key];if(!S)continue;const C=this.getScaledCoordinates(M,o);if(S.index){const k=S.index.range(C.x-f,C.y-f,C.x+f,C.y+f).sort();for(const F of k){const B=S.crossTileIDs[F];if(!h[B]){h[B]=!0,M.crossTileID=B;break}}}else if(S.positions)for(let k=0;k<S.positions.length;k++){const F=S.positions[k],B=S.crossTileIDs[k];if(Math.abs(F.x-C.x)<=f&&Math.abs(F.y-C.y)<=f&&!h[B]){h[B]=!0,M.crossTileID=B;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:i})=>i)}}class Dr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ao{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const o=Math.round((i-this.lng)/360);if(o!==0)for(const h in this.indexes){const f=this.indexes[h],_={};for(const M in f){const S=f[M];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+o),_[S.tileID.key]=S}this.indexes[h]=_}this.lng=i}addBucket(i,o,h){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let _=0;_<o.symbolInstances.length;_++)o.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const f=this.usedCrossTileIDs[i.overscaledZ];for(const _ in this.indexes){const M=this.indexes[_];if(Number(_)>i.overscaledZ)for(const S in M){const C=M[S];C.tileID.isChildOf(i)&&C.findMatches(o.symbolInstances,i,f)}else{const S=M[i.scaledTo(Number(_)).key];S&&S.findMatches(o.symbolInstances,i,f)}}for(let _=0;_<o.symbolInstances.length;_++){const M=o.symbolInstances.get(_);M.crossTileID||(M.crossTileID=h.generate(),f[M.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new ys(i,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(i,o){for(const h of o.getCrossTileIDsLists())for(const f of h)delete this.usedCrossTileIDs[i][f]}removeStaleBuckets(i){let o=!1;for(const h in this.indexes){const f=this.indexes[h];for(const _ in f)i[f[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,f[_]),delete f[_],o=!0)}return o}}class Xs{constructor(){this.layerIndexes={},this.crossTileIDs=new Dr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,o,h){let f=this.layerIndexes[i.id];f===void 0&&(f=this.layerIndexes[i.id]=new ao);let _=!1;const M={};f.handleWrapJump(h);for(const S of o){const C=S.getBucket(i);C&&i.id===C.layerIds[0]&&(C.bucketInstanceId||(C.bucketInstanceId=++this.maxBucketInstanceId),f.addBucket(S.tileID,C,this.crossTileIDs)&&(_=!0),M[C.bucketInstanceId]=!0)}return f.removeStaleBuckets(M)&&(_=!0),_}pruneUnusedLayers(i){const o={};i.forEach(h=>{o[h]=!0});for(const h in this.layerIndexes)o[h]||delete this.layerIndexes[h]}}const cr=(g,i)=>l.t(g,i&&i.filter(o=>o.identifier!=="source.canvas")),oo=l.av();class xn extends l.E{constructor(i,o={}){super(),this._rtlPluginLoaded=()=>{for(const h in this.sourceCaches){const f=this.sourceCaches[h].getSource().type;f!=="vector"&&f!=="geojson"||this.sourceCaches[h].reload()}},this.map=i,this.dispatcher=new St(Ve(),i._getMapId()),this.dispatcher.registerMessageHandler("GG",(h,f)=>this.getGlyphs(h,f)),this.dispatcher.registerMessageHandler("GI",(h,f)=>this.getImages(h,f)),this.imageManager=new xi,this.imageManager.setEventedParent(this),this.glyphManager=new tt(i._requestManager,o.localIdeographFontFamily),this.lineAtlas=new Oi(256,512),this.crossTileSymbolIndex=new Xs,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",l.ax()),Ue().on(Zt,this._rtlPluginLoaded),this.on("data",h=>{if(h.dataType!=="source"||h.sourceDataType!=="metadata")return;const f=this.sourceCaches[h.sourceId];if(!f)return;const _=f.getSource();if(_&&_.vectorLayerIds)for(const M in this._layers){const S=this._layers[M];S.source===_.id&&this._validateLayer(S)}})}loadURL(i,o={},h){this.fire(new l.k("dataloading",{dataType:"style"})),o.validate=typeof o.validate!="boolean"||o.validate;const f=this.map._requestManager.transformRequest(i,"Style");this._loadStyleRequest=new AbortController,l.h(f,this._loadStyleRequest).then(_=>{this._loadStyleRequest=null,this._load(_.data,o,h)}).catch(_=>{this._loadStyleRequest=null,_&&this.fire(new l.j(_))})}loadJSON(i,o={},h){this.fire(new l.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,D.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,o.validate=o.validate!==!1,this._load(i,o,h)}).catch(()=>{})}loadEmpty(){this.fire(new l.k("dataloading",{dataType:"style"})),this._load(oo,{validate:!1})}_load(i,o,h){var f;const _=o.transformStyle?o.transformStyle(h,i):i;if(!o.validate||!cr(this,l.x(_))){this._loaded=!0,this.stylesheet=_;for(const M in _.sources)this.addSource(M,_.sources[M],{validate:!1});_.sprite?this._loadSprite(_.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(_.glyphs),this._createLayers(),this.light=new br(this.stylesheet.light),this.map.setTerrain((f=this.stylesheet.terrain)!==null&&f!==void 0?f:null),this.fire(new l.k("data",{dataType:"style"})),this.fire(new l.k("style.load"))}}_createLayers(){const i=l.ay(this.stylesheet.layers);this.dispatcher.broadcast("SL",i),this._order=i.map(o=>o.id),this._layers={},this._serializedLayers=null;for(const o of i){const h=l.az(o);h.setEventedParent(this,{layer:{id:o.id}}),this._layers[o.id]=h}}_loadSprite(i,o=!1,h=void 0){let f;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(_,M,S,C){return l._(this,void 0,void 0,function*(){const k=Vt(_),F=S>1?"@2x":"",B={},q={};for(const{id:te,url:Q}of k){const re=M.transformRequest(M.normalizeSpriteURL(Q,F,".json"),"SpriteJSON");B[te]=l.h(re,C);const W=M.transformRequest(M.normalizeSpriteURL(Q,F,".png"),"SpriteImage");q[te]=ae.getImage(W,C)}return yield Promise.all([...Object.values(B),...Object.values(q)]),function(te,Q){return l._(this,void 0,void 0,function*(){const re={};for(const W in te){re[W]={};const pe=D.getImageCanvasContext((yield Q[W]).data),Ie=(yield te[W]).data;for(const le in Ie){const{width:be,height:Ae,x:ke,y:ze,sdf:We,pixelRatio:He,stretchX:st,stretchY:ct,content:ci}=Ie[le];re[W][le]={data:null,pixelRatio:He,sdf:We,stretchX:st,stretchY:ct,content:ci,spriteData:{width:be,height:Ae,x:ke,y:ze,context:pe}}}}return re})}(B,q)})}(i,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(_=>{if(this._spriteRequest=null,_)for(const M in _){this._spritesImagesIds[M]=[];const S=this._spritesImagesIds[M]?this._spritesImagesIds[M].filter(C=>!(C in _)):[];for(const C of S)this.imageManager.removeImage(C),this._changedImages[C]=!0;for(const C in _[M]){const k=M==="default"?C:`${M}:${C}`;this._spritesImagesIds[M].push(k),k in this.imageManager.images?this.imageManager.updateImage(k,_[M][C],!1):this.imageManager.addImage(k,_[M][C]),o&&(this._changedImages[k]=!0)}}}).catch(_=>{this._spriteRequest=null,f=_,this.fire(new l.j(f))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),o&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"})),h&&h(f)})}_unloadSprite(){for(const i of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(i),this._changedImages[i]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}_validateLayer(i){const o=this.sourceCaches[i.source];if(!o)return;const h=i.sourceLayer;if(!h)return;const f=o.getSource();(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(h)===-1)&&this.fire(new l.j(new Error(`Source layer "${h}" does not exist on source "${f.id}" as specified by style layer "${i.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this.sourceCaches)if(!this.sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(i){const o=this._serializedAllLayers();if(!i||i.length===0)return Object.values(o);const h=[];for(const f of i)o[f]&&h.push(o[f]);return h}_serializedAllLayers(){let i=this._serializedLayers;if(i)return i;i=this._serializedLayers={};const o=Object.keys(this._layers);for(const h of o){const f=this._layers[h];f.type!=="custom"&&(i[h]=f.serialize())}return i}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const i in this.sourceCaches)if(this.sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(i){if(!this._loaded)return;const o=this._changed;if(o){const f=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(f.length||_.length)&&this._updateWorkerLayers(f,_);for(const M in this._updatedSources){const S=this._updatedSources[M];if(S==="reload")this._reloadSource(M);else{if(S!=="clear")throw new Error(`Invalid action ${S}`);this._clearSource(M)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const M in this._updatedPaintProps)this._layers[M].updateTransitions(i);this.light.updateTransitions(i),this._resetUpdates()}const h={};for(const f in this.sourceCaches){const _=this.sourceCaches[f];h[f]=_.used,_.used=!1}for(const f of this._order){const _=this._layers[f];_.recalculate(i,this._availableImages),!_.isHidden(i.zoom)&&_.source&&(this.sourceCaches[_.source].used=!0)}for(const f in h){const _=this.sourceCaches[f];!!h[f]!=!!_.used&&_.fire(new l.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:f}))}this.light.recalculate(i),this.z=i.zoom,o&&this.fire(new l.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const i in this.sourceCaches)this.sourceCaches[i].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(i,o){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(i),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(i,o={}){var h;this._checkLoaded();const f=this.serialize();if(i=o.transformStyle?o.transformStyle(f,i):i,((h=o.validate)===null||h===void 0||h)&&cr(this,l.x(i)))return!1;(i=l.aA(i)).layers=l.ay(i.layers);const _=l.aB(f,i),M=this._getOperationsToPerform(_);if(M.unimplemented.length>0)throw new Error(`Unimplemented: ${M.unimplemented.join(", ")}.`);if(M.operations.length===0)return!1;for(const S of M.operations)S();return this.stylesheet=i,this._serializedLayers=null,!0}_getOperationsToPerform(i){const o=[],h=[];for(const f of i)switch(f.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":o.push(()=>this.addLayer.apply(this,f.args));break;case"removeLayer":o.push(()=>this.removeLayer.apply(this,f.args));break;case"setPaintProperty":o.push(()=>this.setPaintProperty.apply(this,f.args));break;case"setLayoutProperty":o.push(()=>this.setLayoutProperty.apply(this,f.args));break;case"setFilter":o.push(()=>this.setFilter.apply(this,f.args));break;case"addSource":o.push(()=>this.addSource.apply(this,f.args));break;case"removeSource":o.push(()=>this.removeSource.apply(this,f.args));break;case"setLayerZoomRange":o.push(()=>this.setLayerZoomRange.apply(this,f.args));break;case"setLight":o.push(()=>this.setLight.apply(this,f.args));break;case"setGeoJSONSourceData":o.push(()=>this.setGeoJSONSourceData.apply(this,f.args));break;case"setGlyphs":o.push(()=>this.setGlyphs.apply(this,f.args));break;case"setSprite":o.push(()=>this.setSprite.apply(this,f.args));break;case"setTerrain":o.push(()=>this.map.setTerrain.apply(this,f.args));break;case"setTransition":o.push(()=>{});break;default:h.push(f.command)}return{operations:o,unimplemented:h}}addImage(i,o){if(this.getImage(i))return this.fire(new l.j(new Error(`An image named "${i}" already exists.`)));this.imageManager.addImage(i,o),this._afterImageUpdated(i)}updateImage(i,o){this.imageManager.updateImage(i,o)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){if(!this.getImage(i))return this.fire(new l.j(new Error(`An image named "${i}" does not exist.`)));this.imageManager.removeImage(i),this._afterImageUpdated(i)}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(i,o,h={}){if(this._checkLoaded(),this.sourceCaches[i]!==void 0)throw new Error(`Source "${i}" already exists.`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(l.x.source,`sources.${i}`,o,null,h))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const f=this.sourceCaches[i]=new wr(i,o,this.dispatcher);f.style=this,f.setEventedParent(this,()=>({isSourceLoaded:f.loaded(),source:f.serialize(),sourceId:i})),f.onAdd(this.map),this._changed=!0}removeSource(i){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error("There is no source with this ID");for(const h in this._layers)if(this._layers[h].source===i)return this.fire(new l.j(new Error(`Source "${i}" cannot be removed while layer "${h}" is using it.`)));const o=this.sourceCaches[i];delete this.sourceCaches[i],delete this._updatedSources[i],o.fire(new l.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:i})),o.setEventedParent(null),o.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(i,o){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error(`There is no source with this ID=${i}`);const h=this.sourceCaches[i].getSource();if(h.type!=="geojson")throw new Error(`geojsonSource.type is ${h.type}, which is !== 'geojson`);h.setData(o),this._changed=!0}getSource(i){return this.sourceCaches[i]&&this.sourceCaches[i].getSource()}addLayer(i,o,h={}){this._checkLoaded();const f=i.id;if(this.getLayer(f))return void this.fire(new l.j(new Error(`Layer "${f}" already exists on this map.`)));let _;if(i.type==="custom"){if(cr(this,l.aC(i)))return;_=l.az(i)}else{if("source"in i&&typeof i.source=="object"&&(this.addSource(f,i.source),i=l.aA(i),i=l.e(i,{source:f})),this._validate(l.x.layer,`layers.${f}`,i,{arrayIndex:-1},h))return;_=l.az(i),this._validateLayer(_),_.setEventedParent(this,{layer:{id:f}})}const M=o?this._order.indexOf(o):this._order.length;if(o&&M===-1)this.fire(new l.j(new Error(`Cannot add layer "${f}" before non-existing layer "${o}".`)));else{if(this._order.splice(M,0,f),this._layerOrderChanged=!0,this._layers[f]=_,this._removedLayers[f]&&_.source&&_.type!=="custom"){const S=this._removedLayers[f];delete this._removedLayers[f],S.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",this.sourceCaches[_.source].pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map)}}moveLayer(i,o){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new l.j(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===o)return;const h=this._order.indexOf(i);this._order.splice(h,1);const f=o?this._order.indexOf(o):this._order.length;o&&f===-1?this.fire(new l.j(new Error(`Cannot move layer "${i}" before non-existing layer "${o}".`))):(this._order.splice(f,0,i),this._layerOrderChanged=!0)}removeLayer(i){this._checkLoaded();const o=this._layers[i];if(!o)return void this.fire(new l.j(new Error(`Cannot remove non-existing layer "${i}".`)));o.setEventedParent(null);const h=this._order.indexOf(i);this._order.splice(h,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=o,delete this._layers[i],this._serializedLayers&&delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],o.onRemove&&o.onRemove(this.map)}getLayer(i){return this._layers[i]}getLayersOrder(){return[...this._order]}hasLayer(i){return i in this._layers}setLayerZoomRange(i,o,h){this._checkLoaded();const f=this.getLayer(i);f?f.minzoom===o&&f.maxzoom===h||(o!=null&&(f.minzoom=o),h!=null&&(f.maxzoom=h),this._updateLayer(f)):this.fire(new l.j(new Error(`Cannot set the zoom range of non-existing layer "${i}".`)))}setFilter(i,o,h={}){this._checkLoaded();const f=this.getLayer(i);if(f){if(!l.aD(f.filter,o))return o==null?(f.filter=void 0,void this._updateLayer(f)):void(this._validate(l.x.filter,`layers.${f.id}.filter`,o,null,h)||(f.filter=l.aA(o),this._updateLayer(f)))}else this.fire(new l.j(new Error(`Cannot filter non-existing layer "${i}".`)))}getFilter(i){return l.aA(this.getLayer(i).filter)}setLayoutProperty(i,o,h,f={}){this._checkLoaded();const _=this.getLayer(i);_?l.aD(_.getLayoutProperty(o),h)||(_.setLayoutProperty(o,h,f),this._updateLayer(_)):this.fire(new l.j(new Error(`Cannot style non-existing layer "${i}".`)))}getLayoutProperty(i,o){const h=this.getLayer(i);if(h)return h.getLayoutProperty(o);this.fire(new l.j(new Error(`Cannot get style of non-existing layer "${i}".`)))}setPaintProperty(i,o,h,f={}){this._checkLoaded();const _=this.getLayer(i);_?l.aD(_.getPaintProperty(o),h)||(_.setPaintProperty(o,h,f)&&this._updateLayer(_),this._changed=!0,this._updatedPaintProps[i]=!0,this._serializedLayers=null):this.fire(new l.j(new Error(`Cannot style non-existing layer "${i}".`)))}getPaintProperty(i,o){return this.getLayer(i).getPaintProperty(o)}setFeatureState(i,o){this._checkLoaded();const h=i.source,f=i.sourceLayer,_=this.sourceCaches[h];if(_===void 0)return void this.fire(new l.j(new Error(`The source '${h}' does not exist in the map's style.`)));const M=_.getSource().type;M==="geojson"&&f?this.fire(new l.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):M!=="vector"||f?(i.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),_.setFeatureState(f,i.id,o)):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(i,o){this._checkLoaded();const h=i.source,f=this.sourceCaches[h];if(f===void 0)return void this.fire(new l.j(new Error(`The source '${h}' does not exist in the map's style.`)));const _=f.getSource().type,M=_==="vector"?i.sourceLayer:void 0;_!=="vector"||M?o&&typeof i.id!="string"&&typeof i.id!="number"?this.fire(new l.j(new Error("A feature id is required to remove its specific state property."))):f.removeFeatureState(M,i.id,o):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(i){this._checkLoaded();const o=i.source,h=i.sourceLayer,f=this.sourceCaches[o];if(f!==void 0)return f.getSource().type!=="vector"||h?(i.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),f.getFeatureState(h,i.id)):void this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.j(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const i=l.aE(this.sourceCaches,_=>_.serialize()),o=this._serializeByIds(this._order),h=this.map.getTerrain()||void 0,f=this.stylesheet;return l.aF({version:f.version,name:f.name,metadata:f.metadata,light:f.light,center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch,sprite:f.sprite,glyphs:f.glyphs,transition:f.transition,sources:i,layers:o,terrain:h},_=>_!==void 0)}_updateLayer(i){this._updatedLayers[i.id]=!0,i.source&&!this._updatedSources[i.source]&&this.sourceCaches[i.source].getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",this.sourceCaches[i.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(i){const o=M=>this._layers[M].type==="fill-extrusion",h={},f=[];for(let M=this._order.length-1;M>=0;M--){const S=this._order[M];if(o(S)){h[S]=M;for(const C of i){const k=C[S];if(k)for(const F of k)f.push(F)}}}f.sort((M,S)=>S.intersectionZ-M.intersectionZ);const _=[];for(let M=this._order.length-1;M>=0;M--){const S=this._order[M];if(o(S))for(let C=f.length-1;C>=0;C--){const k=f[C].feature;if(h[k.layer.id]<M)break;_.push(k),f.pop()}else for(const C of i){const k=C[S];if(k)for(const F of k)_.push(F.feature)}}return _}queryRenderedFeatures(i,o,h){o&&o.filter&&this._validate(l.x.filter,"queryRenderedFeatures.filter",o.filter,null,o);const f={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new l.j(new Error("parameters.layers must be an Array."))),[];for(const S of o.layers){const C=this._layers[S];if(!C)return this.fire(new l.j(new Error(`The layer '${S}' does not exist in the map's style and cannot be queried for features.`))),[];f[C.source]=!0}}const _=[];o.availableImages=this._availableImages;const M=this._serializedAllLayers();for(const S in this.sourceCaches)o.layers&&!f[S]||_.push(Ii(this.sourceCaches[S],this._layers,M,i,o,h));return this.placement&&_.push(function(S,C,k,F,B,q,te){const Q={},re=q.queryRenderedSymbols(F),W=[];for(const pe of Object.keys(re).map(Number))W.push(te[pe]);W.sort(ki);for(const pe of W){const Ie=pe.featureIndex.lookupSymbolFeatures(re[pe.bucketInstanceId],C,pe.bucketIndex,pe.sourceLayerIndex,B.filter,B.layers,B.availableImages,S);for(const le in Ie){const be=Q[le]=Q[le]||[],Ae=Ie[le];Ae.sort((ke,ze)=>{const We=pe.featureSortOrder;if(We){const He=We.indexOf(ke.featureIndex);return We.indexOf(ze.featureIndex)-He}return ze.featureIndex-ke.featureIndex});for(const ke of Ae)be.push(ke)}}for(const pe in Q)Q[pe].forEach(Ie=>{const le=Ie.feature,be=k[S[pe].source].getFeatureState(le.layer["source-layer"],le.id);le.source=le.layer.source,le.layer["source-layer"]&&(le.sourceLayer=le.layer["source-layer"]),le.state=be});return Q}(this._layers,M,this.sourceCaches,i,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(i,o){o&&o.filter&&this._validate(l.x.filter,"querySourceFeatures.filter",o.filter,null,o);const h=this.sourceCaches[i];return h?function(f,_){const M=f.getRenderableIds().map(k=>f.getTileByID(k)),S=[],C={};for(let k=0;k<M.length;k++){const F=M[k],B=F.tileID.canonical.key;C[B]||(C[B]=!0,F.querySourceFeatures(S,_))}return S}(h,o):[]}getLight(){return this.light.getLight()}setLight(i,o={}){this._checkLoaded();const h=this.light.getLight();let f=!1;for(const M in i)if(!l.aD(i[M],h[M])){f=!0;break}if(!f)return;const _={now:D.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,o),this.light.updateTransitions(_)}_validate(i,o,h,f,_={}){return(!_||_.validate!==!1)&&cr(this,i.call(l.x,l.e({key:o,style:this.serialize(),value:h,styleSpec:l.v},f)))}_remove(i=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Ue().off(Zt,this._rtlPluginLoaded);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this.sourceCaches){const h=this.sourceCaches[o];h.setEventedParent(null),h.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),i&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(i)}_clearSource(i){this.sourceCaches[i].clearTiles()}_reloadSource(i){this.sourceCaches[i].resume(),this.sourceCaches[i].reload()}_updateSources(i){for(const o in this.sourceCaches)this.sourceCaches[o].update(i,this.map.terrain)}_generateCollisionBoxes(){for(const i in this.sourceCaches)this._reloadSource(i)}_updatePlacement(i,o,h,f,_=!1){let M=!1,S=!1;const C={};for(const k of this._order){const F=this._layers[k];if(F.type!=="symbol")continue;if(!C[F.source]){const q=this.sourceCaches[F.source];C[F.source]=q.getRenderableIds(!0).map(te=>q.getTileByID(te)).sort((te,Q)=>Q.tileID.overscaledZ-te.tileID.overscaledZ||(te.tileID.isLessThan(Q.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(F,C[F.source],i.center.lng);M=M||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((_=_||this._layerOrderChanged||h===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(D.now(),i.zoom))&&(this.pauseablePlacement=new vn(i,this.map.terrain,this._order,_,o,h,f,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,C),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(D.now()),S=!0),M&&this.pauseablePlacement.placement.setStale()),S||M)for(const k of this._order){const F=this._layers[k];F.type==="symbol"&&this.placement.updateLayerOpacities(F,C[F.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(D.now())}_releaseSymbolFadeTiles(){for(const i in this.sourceCaches)this.sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,o){return l._(this,void 0,void 0,function*(){const h=yield this.imageManager.getImages(o.icons);this._updateTilesForChangedImages();const f=this.sourceCaches[o.source];return f&&f.setDependencies(o.tileID.key,o.type,o.icons),h})}getGlyphs(i,o){return l._(this,void 0,void 0,function*(){const h=yield this.glyphManager.getGlyphs(o.stacks),f=this.sourceCaches[o.source];return f&&f.setDependencies(o.tileID.key,o.type,[""]),h})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(i,o={}){this._checkLoaded(),i&&this._validate(l.x.glyphs,"glyphs",i,null,o)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=i,this.glyphManager.entries={},this.glyphManager.setURL(i))}addSprite(i,o,h={},f){this._checkLoaded();const _=[{id:i,url:o}],M=[...Vt(this.stylesheet.sprite),..._];this._validate(l.x.sprite,"sprite",M,null,h)||(this.stylesheet.sprite=M,this._loadSprite(_,!0,f))}removeSprite(i){this._checkLoaded();const o=Vt(this.stylesheet.sprite);if(o.find(h=>h.id===i)){if(this._spritesImagesIds[i])for(const h of this._spritesImagesIds[i])this.imageManager.removeImage(h),this._changedImages[h]=!0;o.splice(o.findIndex(h=>h.id===i),1),this.stylesheet.sprite=o.length>0?o:void 0,delete this._spritesImagesIds[i],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}else this.fire(new l.j(new Error(`Sprite "${i}" doesn't exists on this map.`)))}getSprite(){return Vt(this.stylesheet.sprite)}setSprite(i,o={},h){this._checkLoaded(),i&&this._validate(l.x.sprite,"sprite",i,null,o)||(this.stylesheet.sprite=i,i?this._loadSprite(i,!0,h):(this._unloadSprite(),h&&h(null)))}}var lo=l.X([{name:"a_pos",type:"Int16",components:2}]),is="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const co={prelude:Ui(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Ui(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Ui(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ui(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ui("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ui(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Ui(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ui("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ui("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ui("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Ui(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Ui(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Ui(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Ui(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ui(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ui(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ui(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ui(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Ui(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ui(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ui(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ui(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Ui(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Ui(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ui(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ui(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ui("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",is),terrainDepth:Ui("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",is),terrainCoords:Ui("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",is)};function Ui(g,i){const o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=i.match(/attribute ([\w]+) ([\w]+)/g),f=g.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=i.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),M=_?_.concat(f):f,S={};return{fragmentSource:g=g.replace(o,(C,k,F,B,q)=>(S[q]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${q}
varying ${F} ${B} ${q};
#else
uniform ${F} ${B} u_${q};
#endif
`:`
#ifdef HAS_UNIFORM_u_${q}
    ${F} ${B} ${q} = u_${q};
#endif
`)),vertexSource:i=i.replace(o,(C,k,F,B,q)=>{const te=B==="float"?"vec2":"vec4",Q=q.match(/color/)?"color":te;return S[q]?k==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
attribute ${F} ${te} a_${q};
varying ${F} ${B} ${q};
#else
uniform ${F} ${B} u_${q};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = a_${q};
#else
    ${F} ${B} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = unpack_mix_${Q}(a_${q}, u_${q}_t);
#else
    ${F} ${B} ${q} = u_${q};
#endif
`:k==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
attribute ${F} ${te} a_${q};
#else
uniform ${F} ${B} u_${q};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${F} ${B} ${q} = a_${q};
#else
    ${F} ${B} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${F} ${B} ${q} = unpack_mix_${Q}(a_${q}, u_${q}_t);
#else
    ${F} ${B} ${q} = u_${q};
#endif
`}),staticAttributes:h,staticUniforms:M}}class Ro{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(i,o,h,f,_,M,S,C,k){this.context=i;let F=this.boundPaintVertexBuffers.length!==f.length;for(let B=0;!F&&B<f.length;B++)this.boundPaintVertexBuffers[B]!==f[B]&&(F=!0);!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==h||F||this.boundIndexBuffer!==_||this.boundVertexOffset!==M||this.boundDynamicVertexBuffer!==S||this.boundDynamicVertexBuffer2!==C||this.boundDynamicVertexBuffer3!==k?this.freshBind(o,h,f,_,M,S,C,k):(i.bindVertexArray.set(this.vao),S&&S.bind(),_&&_.dynamicDraw&&_.bind(),C&&C.bind(),k&&k.bind())}freshBind(i,o,h,f,_,M,S,C){const k=i.numAttributes,F=this.context,B=F.gl;this.vao&&this.destroy(),this.vao=F.createVertexArray(),F.bindVertexArray.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=f,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=M,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=C,o.enableAttributes(B,i);for(const q of h)q.enableAttributes(B,i);M&&M.enableAttributes(B,i),S&&S.enableAttributes(B,i),C&&C.enableAttributes(B,i),o.bind(),o.setVertexAttribPointers(B,i,_);for(const q of h)q.bind(),q.setVertexAttribPointers(B,i,_);M&&(M.bind(),M.setVertexAttribPointers(B,i,_)),f&&f.bind(),S&&(S.bind(),S.setVertexAttribPointers(B,i,_)),C&&(C.bind(),C.setVertexAttribPointers(B,i,_)),F.currentNumAttributes=k}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Ls(g){const i=[];for(let o=0;o<g.length;o++){if(g[o]===null)continue;const h=g[o].split(" ");i.push(h.pop())}return i}class b{constructor(i,o,h,f,_,M){const S=i.gl;this.program=S.createProgram();const C=Ls(o.staticAttributes),k=h?h.getBinderAttributes():[],F=C.concat(k),B=co.prelude.staticUniforms?Ls(co.prelude.staticUniforms):[],q=o.staticUniforms?Ls(o.staticUniforms):[],te=h?h.getBinderUniforms():[],Q=B.concat(q).concat(te),re=[];for(const ke of Q)re.indexOf(ke)<0&&re.push(ke);const W=h?h.defines():[];_&&W.push("#define OVERDRAW_INSPECTOR;"),M&&W.push("#define TERRAIN3D;");const pe=W.concat(co.prelude.fragmentSource,o.fragmentSource).join(`
`),Ie=W.concat(co.prelude.vertexSource,o.vertexSource).join(`
`),le=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);if(S.shaderSource(le,pe),S.compileShader(le),!S.getShaderParameter(le,S.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${S.getShaderInfoLog(le)}`);S.attachShader(this.program,le);const be=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);if(S.shaderSource(be,Ie),S.compileShader(be),!S.getShaderParameter(be,S.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${S.getShaderInfoLog(be)}`);S.attachShader(this.program,be),this.attributes={};const Ae={};this.numAttributes=F.length;for(let ke=0;ke<this.numAttributes;ke++)F[ke]&&(S.bindAttribLocation(this.program,ke,F[ke]),this.attributes[F[ke]]=ke);if(S.linkProgram(this.program),!S.getProgramParameter(this.program,S.LINK_STATUS))throw new Error(`Program failed to link: ${S.getProgramInfoLog(this.program)}`);S.deleteShader(be),S.deleteShader(le);for(let ke=0;ke<re.length;ke++){const ze=re[ke];if(ze&&!Ae[ze]){const We=S.getUniformLocation(this.program,ze);We&&(Ae[ze]=We)}}this.fixedUniforms=f(i,Ae),this.terrainUniforms=((ke,ze)=>({u_depth:new l.aG(ke,ze.u_depth),u_terrain:new l.aG(ke,ze.u_terrain),u_terrain_dim:new l.aH(ke,ze.u_terrain_dim),u_terrain_matrix:new l.aI(ke,ze.u_terrain_matrix),u_terrain_unpack:new l.aJ(ke,ze.u_terrain_unpack),u_terrain_exaggeration:new l.aH(ke,ze.u_terrain_exaggeration)}))(i,Ae),this.binderUniforms=h?h.getUniforms(i,Ae):[]}draw(i,o,h,f,_,M,S,C,k,F,B,q,te,Q,re,W,pe,Ie){const le=i.gl;if(this.failedToCreate)return;if(i.program.set(this.program),i.setDepthMode(h),i.setStencilMode(f),i.setColorMode(_),i.setCullFace(M),C){i.activeTexture.set(le.TEXTURE2),le.bindTexture(le.TEXTURE_2D,C.depthTexture),i.activeTexture.set(le.TEXTURE3),le.bindTexture(le.TEXTURE_2D,C.texture);for(const Ae in this.terrainUniforms)this.terrainUniforms[Ae].set(C[Ae])}for(const Ae in this.fixedUniforms)this.fixedUniforms[Ae].set(S[Ae]);re&&re.setUniforms(i,this.binderUniforms,te,{zoom:Q});let be=0;switch(o){case le.LINES:be=2;break;case le.TRIANGLES:be=3;break;case le.LINE_STRIP:be=1}for(const Ae of q.get()){const ke=Ae.vaos||(Ae.vaos={});(ke[k]||(ke[k]=new Ro)).bind(i,this,F,re?re.getPaintVertexBuffers():[],B,Ae.vertexOffset,W,pe,Ie),le.drawElements(o,Ae.primitiveLength*be,le.UNSIGNED_SHORT,Ae.primitiveOffset*be*2)}}}function A(g,i,o){const h=1/ti(o,1,i.transform.tileZoom),f=Math.pow(2,o.tileID.overscaledZ),_=o.tileSize*Math.pow(2,i.transform.tileZoom)/f,M=_*(o.tileID.canonical.x+o.tileID.wrap*f),S=_*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[h,g.fromScale,g.toScale],u_fade:g.t,u_pixel_coord_upper:[M>>16,S>>16],u_pixel_coord_lower:[65535&M,65535&S]}}const V=(g,i,o,h)=>{const f=i.style.light,_=f.properties.get("position"),M=[_.x,_.y,_.z],S=function(){var k=new l.A(9);return l.A!=Float32Array&&(k[1]=0,k[2]=0,k[3]=0,k[5]=0,k[6]=0,k[7]=0),k[0]=1,k[4]=1,k[8]=1,k}();f.properties.get("anchor")==="viewport"&&function(k,F){var B=Math.sin(F),q=Math.cos(F);k[0]=q,k[1]=B,k[2]=0,k[3]=-B,k[4]=q,k[5]=0,k[6]=0,k[7]=0,k[8]=1}(S,-i.transform.angle),function(k,F,B){var q=F[0],te=F[1],Q=F[2];k[0]=q*B[0]+te*B[3]+Q*B[6],k[1]=q*B[1]+te*B[4]+Q*B[7],k[2]=q*B[2]+te*B[5]+Q*B[8]}(M,M,S);const C=f.properties.get("color");return{u_matrix:g,u_lightpos:M,u_lightintensity:f.properties.get("intensity"),u_lightcolor:[C.r,C.g,C.b],u_vertical_gradient:+o,u_opacity:h}},oe=(g,i,o,h,f,_,M)=>l.e(V(g,i,o,h),A(_,i,M),{u_height_factor:-Math.pow(2,f.overscaledZ)/M.tileSize/8}),ge=g=>({u_matrix:g}),ye=(g,i,o,h)=>l.e(ge(g),A(o,i,h)),Me=(g,i)=>({u_matrix:g,u_world:i}),Ke=(g,i,o,h,f)=>l.e(ye(g,i,o,h),{u_world:f}),at=(g,i,o,h)=>{const f=g.transform;let _,M;if(h.paint.get("circle-pitch-alignment")==="map"){const S=ti(o,1,f.zoom);_=!0,M=[S,S]}else _=!1,M=f.pixelsToGLUnits;return{u_camera_to_center_distance:f.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_matrix:g.translatePosMatrix(i.posMatrix,o,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_pitch_with_map:+_,u_device_pixel_ratio:g.pixelRatio,u_extrude_scale:M}},bt=(g,i,o)=>{const h=ti(o,1,i.zoom),f=Math.pow(2,i.zoom-o.tileID.overscaledZ),_=o.tileID.overscaleFactor();return{u_matrix:g,u_camera_to_center_distance:i.cameraToCenterDistance,u_pixels_to_tile_units:h,u_extrude_scale:[i.pixelsToGLUnits[0]/(h*f),i.pixelsToGLUnits[1]/(h*f)],u_overscale_factor:_}},wt=(g,i,o=1)=>({u_matrix:g,u_color:i,u_overlay:0,u_overlay_scale:o}),ht=g=>({u_matrix:g}),ni=(g,i,o,h)=>({u_matrix:g,u_extrude_scale:ti(i,1,o),u_intensity:h});function ur(g,i){const o=Math.pow(2,i.canonical.z),h=i.canonical.y;return[new l.Y(0,h/o).toLngLat().lat,new l.Y(0,(h+1)/o).toLngLat().lat]}const oi=(g,i,o,h)=>{const f=g.transform;return{u_matrix:Sr(g,i,o,h),u_ratio:1/ti(i,1,f.zoom),u_device_pixel_ratio:g.pixelRatio,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},kr=(g,i,o,h,f)=>l.e(oi(g,i,o,f),{u_image:0,u_image_height:h}),je=(g,i,o,h,f)=>{const _=g.transform,M=gi(i,_);return{u_matrix:Sr(g,i,o,f),u_texsize:i.imageAtlasTexture.size,u_ratio:1/ti(i,1,_.zoom),u_device_pixel_ratio:g.pixelRatio,u_image:0,u_scale:[M,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},Rt=(g,i,o,h,f,_)=>{const M=g.lineAtlas,S=gi(i,g.transform),C=o.layout.get("line-cap")==="round",k=M.getDash(h.from,C),F=M.getDash(h.to,C),B=k.width*f.fromScale,q=F.width*f.toScale;return l.e(oi(g,i,o,_),{u_patternscale_a:[S/B,-k.height/2],u_patternscale_b:[S/q,-F.height/2],u_sdfgamma:M.width/(256*Math.min(B,q)*g.pixelRatio)/2,u_image:0,u_tex_y_a:k.y,u_tex_y_b:F.y,u_mix:f.t})};function gi(g,i){return 1/ti(g,1,i.tileZoom)}function Sr(g,i,o,h){return g.translatePosMatrix(h?h.posMatrix:i.tileID.posMatrix,i,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const mr=(g,i,o,h,f)=>{return{u_matrix:g,u_tl_parent:i,u_scale_parent:o,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*f.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:f.paint.get("raster-brightness-min"),u_brightness_high:f.paint.get("raster-brightness-max"),u_saturation_factor:(M=f.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(_=f.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:da(f.paint.get("raster-hue-rotate"))};var _,M};function da(g){g*=Math.PI/180;const i=Math.sin(g),o=Math.cos(g);return[(2*o+1)/3,(-Math.sqrt(3)*i-o+1)/3,(Math.sqrt(3)*i-o+1)/3]}const uo=(g,i,o,h,f,_,M,S,C,k)=>{const F=f.transform;return{u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:F.cameraToCenterDistance,u_pitch:F.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:F.width/F.height,u_fade_change:f.options.fadeDuration?f.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:M,u_coord_matrix:S,u_is_text:+C,u_pitch_with_map:+h,u_texsize:k,u_texture:0}},ji=(g,i,o,h,f,_,M,S,C,k,F)=>{const B=f.transform;return l.e(uo(g,i,o,h,f,_,M,S,C,k),{u_gamma_scale:h?Math.cos(B._pitch)*B.cameraToCenterDistance:1,u_device_pixel_ratio:f.pixelRatio,u_is_halo:+F})},za=(g,i,o,h,f,_,M,S,C,k)=>l.e(ji(g,i,o,h,f,_,M,S,!0,C,!0),{u_texsize_icon:k,u_texture_icon:1}),yu=(g,i,o)=>({u_matrix:g,u_opacity:i,u_color:o}),Rs=(g,i,o,h,f,_)=>l.e(function(M,S,C,k){const F=C.imageManager.getPattern(M.from.toString()),B=C.imageManager.getPattern(M.to.toString()),{width:q,height:te}=C.imageManager.getPixelSize(),Q=Math.pow(2,k.tileID.overscaledZ),re=k.tileSize*Math.pow(2,C.transform.tileZoom)/Q,W=re*(k.tileID.canonical.x+k.tileID.wrap*Q),pe=re*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:F.tl,u_pattern_br_a:F.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[q,te],u_mix:S.t,u_pattern_size_a:F.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/ti(k,1,C.transform.tileZoom),u_pixel_coord_upper:[W>>16,pe>>16],u_pixel_coord_lower:[65535&W,65535&pe]}}(h,_,o,f),{u_matrix:g,u_opacity:i}),Cl={fillExtrusion:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_lightpos:new l.aK(g,i.u_lightpos),u_lightintensity:new l.aH(g,i.u_lightintensity),u_lightcolor:new l.aK(g,i.u_lightcolor),u_vertical_gradient:new l.aH(g,i.u_vertical_gradient),u_opacity:new l.aH(g,i.u_opacity)}),fillExtrusionPattern:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_lightpos:new l.aK(g,i.u_lightpos),u_lightintensity:new l.aH(g,i.u_lightintensity),u_lightcolor:new l.aK(g,i.u_lightcolor),u_vertical_gradient:new l.aH(g,i.u_vertical_gradient),u_height_factor:new l.aH(g,i.u_height_factor),u_image:new l.aG(g,i.u_image),u_texsize:new l.aL(g,i.u_texsize),u_pixel_coord_upper:new l.aL(g,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(g,i.u_pixel_coord_lower),u_scale:new l.aK(g,i.u_scale),u_fade:new l.aH(g,i.u_fade),u_opacity:new l.aH(g,i.u_opacity)}),fill:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix)}),fillPattern:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_image:new l.aG(g,i.u_image),u_texsize:new l.aL(g,i.u_texsize),u_pixel_coord_upper:new l.aL(g,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(g,i.u_pixel_coord_lower),u_scale:new l.aK(g,i.u_scale),u_fade:new l.aH(g,i.u_fade)}),fillOutline:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_world:new l.aL(g,i.u_world)}),fillOutlinePattern:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_world:new l.aL(g,i.u_world),u_image:new l.aG(g,i.u_image),u_texsize:new l.aL(g,i.u_texsize),u_pixel_coord_upper:new l.aL(g,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(g,i.u_pixel_coord_lower),u_scale:new l.aK(g,i.u_scale),u_fade:new l.aH(g,i.u_fade)}),circle:(g,i)=>({u_camera_to_center_distance:new l.aH(g,i.u_camera_to_center_distance),u_scale_with_map:new l.aG(g,i.u_scale_with_map),u_pitch_with_map:new l.aG(g,i.u_pitch_with_map),u_extrude_scale:new l.aL(g,i.u_extrude_scale),u_device_pixel_ratio:new l.aH(g,i.u_device_pixel_ratio),u_matrix:new l.aI(g,i.u_matrix)}),collisionBox:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_camera_to_center_distance:new l.aH(g,i.u_camera_to_center_distance),u_pixels_to_tile_units:new l.aH(g,i.u_pixels_to_tile_units),u_extrude_scale:new l.aL(g,i.u_extrude_scale),u_overscale_factor:new l.aH(g,i.u_overscale_factor)}),collisionCircle:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_inv_matrix:new l.aI(g,i.u_inv_matrix),u_camera_to_center_distance:new l.aH(g,i.u_camera_to_center_distance),u_viewport_size:new l.aL(g,i.u_viewport_size)}),debug:(g,i)=>({u_color:new l.aM(g,i.u_color),u_matrix:new l.aI(g,i.u_matrix),u_overlay:new l.aG(g,i.u_overlay),u_overlay_scale:new l.aH(g,i.u_overlay_scale)}),clippingMask:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix)}),heatmap:(g,i)=>({u_extrude_scale:new l.aH(g,i.u_extrude_scale),u_intensity:new l.aH(g,i.u_intensity),u_matrix:new l.aI(g,i.u_matrix)}),heatmapTexture:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_world:new l.aL(g,i.u_world),u_image:new l.aG(g,i.u_image),u_color_ramp:new l.aG(g,i.u_color_ramp),u_opacity:new l.aH(g,i.u_opacity)}),hillshade:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_image:new l.aG(g,i.u_image),u_latrange:new l.aL(g,i.u_latrange),u_light:new l.aL(g,i.u_light),u_shadow:new l.aM(g,i.u_shadow),u_highlight:new l.aM(g,i.u_highlight),u_accent:new l.aM(g,i.u_accent)}),hillshadePrepare:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_image:new l.aG(g,i.u_image),u_dimension:new l.aL(g,i.u_dimension),u_zoom:new l.aH(g,i.u_zoom),u_unpack:new l.aJ(g,i.u_unpack)}),line:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_ratio:new l.aH(g,i.u_ratio),u_device_pixel_ratio:new l.aH(g,i.u_device_pixel_ratio),u_units_to_pixels:new l.aL(g,i.u_units_to_pixels)}),lineGradient:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_ratio:new l.aH(g,i.u_ratio),u_device_pixel_ratio:new l.aH(g,i.u_device_pixel_ratio),u_units_to_pixels:new l.aL(g,i.u_units_to_pixels),u_image:new l.aG(g,i.u_image),u_image_height:new l.aH(g,i.u_image_height)}),linePattern:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_texsize:new l.aL(g,i.u_texsize),u_ratio:new l.aH(g,i.u_ratio),u_device_pixel_ratio:new l.aH(g,i.u_device_pixel_ratio),u_image:new l.aG(g,i.u_image),u_units_to_pixels:new l.aL(g,i.u_units_to_pixels),u_scale:new l.aK(g,i.u_scale),u_fade:new l.aH(g,i.u_fade)}),lineSDF:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_ratio:new l.aH(g,i.u_ratio),u_device_pixel_ratio:new l.aH(g,i.u_device_pixel_ratio),u_units_to_pixels:new l.aL(g,i.u_units_to_pixels),u_patternscale_a:new l.aL(g,i.u_patternscale_a),u_patternscale_b:new l.aL(g,i.u_patternscale_b),u_sdfgamma:new l.aH(g,i.u_sdfgamma),u_image:new l.aG(g,i.u_image),u_tex_y_a:new l.aH(g,i.u_tex_y_a),u_tex_y_b:new l.aH(g,i.u_tex_y_b),u_mix:new l.aH(g,i.u_mix)}),raster:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_tl_parent:new l.aL(g,i.u_tl_parent),u_scale_parent:new l.aH(g,i.u_scale_parent),u_buffer_scale:new l.aH(g,i.u_buffer_scale),u_fade_t:new l.aH(g,i.u_fade_t),u_opacity:new l.aH(g,i.u_opacity),u_image0:new l.aG(g,i.u_image0),u_image1:new l.aG(g,i.u_image1),u_brightness_low:new l.aH(g,i.u_brightness_low),u_brightness_high:new l.aH(g,i.u_brightness_high),u_saturation_factor:new l.aH(g,i.u_saturation_factor),u_contrast_factor:new l.aH(g,i.u_contrast_factor),u_spin_weights:new l.aK(g,i.u_spin_weights)}),symbolIcon:(g,i)=>({u_is_size_zoom_constant:new l.aG(g,i.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(g,i.u_is_size_feature_constant),u_size_t:new l.aH(g,i.u_size_t),u_size:new l.aH(g,i.u_size),u_camera_to_center_distance:new l.aH(g,i.u_camera_to_center_distance),u_pitch:new l.aH(g,i.u_pitch),u_rotate_symbol:new l.aG(g,i.u_rotate_symbol),u_aspect_ratio:new l.aH(g,i.u_aspect_ratio),u_fade_change:new l.aH(g,i.u_fade_change),u_matrix:new l.aI(g,i.u_matrix),u_label_plane_matrix:new l.aI(g,i.u_label_plane_matrix),u_coord_matrix:new l.aI(g,i.u_coord_matrix),u_is_text:new l.aG(g,i.u_is_text),u_pitch_with_map:new l.aG(g,i.u_pitch_with_map),u_texsize:new l.aL(g,i.u_texsize),u_texture:new l.aG(g,i.u_texture)}),symbolSDF:(g,i)=>({u_is_size_zoom_constant:new l.aG(g,i.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(g,i.u_is_size_feature_constant),u_size_t:new l.aH(g,i.u_size_t),u_size:new l.aH(g,i.u_size),u_camera_to_center_distance:new l.aH(g,i.u_camera_to_center_distance),u_pitch:new l.aH(g,i.u_pitch),u_rotate_symbol:new l.aG(g,i.u_rotate_symbol),u_aspect_ratio:new l.aH(g,i.u_aspect_ratio),u_fade_change:new l.aH(g,i.u_fade_change),u_matrix:new l.aI(g,i.u_matrix),u_label_plane_matrix:new l.aI(g,i.u_label_plane_matrix),u_coord_matrix:new l.aI(g,i.u_coord_matrix),u_is_text:new l.aG(g,i.u_is_text),u_pitch_with_map:new l.aG(g,i.u_pitch_with_map),u_texsize:new l.aL(g,i.u_texsize),u_texture:new l.aG(g,i.u_texture),u_gamma_scale:new l.aH(g,i.u_gamma_scale),u_device_pixel_ratio:new l.aH(g,i.u_device_pixel_ratio),u_is_halo:new l.aG(g,i.u_is_halo)}),symbolTextAndIcon:(g,i)=>({u_is_size_zoom_constant:new l.aG(g,i.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(g,i.u_is_size_feature_constant),u_size_t:new l.aH(g,i.u_size_t),u_size:new l.aH(g,i.u_size),u_camera_to_center_distance:new l.aH(g,i.u_camera_to_center_distance),u_pitch:new l.aH(g,i.u_pitch),u_rotate_symbol:new l.aG(g,i.u_rotate_symbol),u_aspect_ratio:new l.aH(g,i.u_aspect_ratio),u_fade_change:new l.aH(g,i.u_fade_change),u_matrix:new l.aI(g,i.u_matrix),u_label_plane_matrix:new l.aI(g,i.u_label_plane_matrix),u_coord_matrix:new l.aI(g,i.u_coord_matrix),u_is_text:new l.aG(g,i.u_is_text),u_pitch_with_map:new l.aG(g,i.u_pitch_with_map),u_texsize:new l.aL(g,i.u_texsize),u_texsize_icon:new l.aL(g,i.u_texsize_icon),u_texture:new l.aG(g,i.u_texture),u_texture_icon:new l.aG(g,i.u_texture_icon),u_gamma_scale:new l.aH(g,i.u_gamma_scale),u_device_pixel_ratio:new l.aH(g,i.u_device_pixel_ratio),u_is_halo:new l.aG(g,i.u_is_halo)}),background:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_opacity:new l.aH(g,i.u_opacity),u_color:new l.aM(g,i.u_color)}),backgroundPattern:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_opacity:new l.aH(g,i.u_opacity),u_image:new l.aG(g,i.u_image),u_pattern_tl_a:new l.aL(g,i.u_pattern_tl_a),u_pattern_br_a:new l.aL(g,i.u_pattern_br_a),u_pattern_tl_b:new l.aL(g,i.u_pattern_tl_b),u_pattern_br_b:new l.aL(g,i.u_pattern_br_b),u_texsize:new l.aL(g,i.u_texsize),u_mix:new l.aH(g,i.u_mix),u_pattern_size_a:new l.aL(g,i.u_pattern_size_a),u_pattern_size_b:new l.aL(g,i.u_pattern_size_b),u_scale_a:new l.aH(g,i.u_scale_a),u_scale_b:new l.aH(g,i.u_scale_b),u_pixel_coord_upper:new l.aL(g,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(g,i.u_pixel_coord_lower),u_tile_units_to_pixels:new l.aH(g,i.u_tile_units_to_pixels)}),terrain:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_texture:new l.aG(g,i.u_texture),u_ele_delta:new l.aH(g,i.u_ele_delta)}),terrainDepth:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_ele_delta:new l.aH(g,i.u_ele_delta)}),terrainCoords:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_texture:new l.aG(g,i.u_texture),u_terrain_coords_id:new l.aH(g,i.u_terrain_coords_id),u_ele_delta:new l.aH(g,i.u_ele_delta)})};class pc{constructor(i,o,h){this.context=i;const f=i.gl;this.buffer=f.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const o=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ks={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Oa{constructor(i,o,h,f){this.length=o.length,this.attributes=h,this.itemSize=o.bytesPerElement,this.dynamicDraw=f,this.context=i;const _=i.gl;this.buffer=_.createBuffer(),i.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){if(i.length!==this.length)throw new Error(`Length of new data is ${i.length}, which doesn't match current length of ${this.length}`);const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,o){for(let h=0;h<this.attributes.length;h++){const f=o.attributes[this.attributes[h].name];f!==void 0&&i.enableVertexAttribArray(f)}}setVertexAttribPointers(i,o,h){for(let f=0;f<this.attributes.length;f++){const _=this.attributes[f],M=o.attributes[_.name];M!==void 0&&i.vertexAttribPointer(M,_.components,i[Ks[_.type]],!1,this.itemSize,_.offset+this.itemSize*(h||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const dn=new WeakMap;function Jr(g){var i;if(dn.has(g))return dn.get(g);{const o=(i=g.getParameter(g.VERSION))===null||i===void 0?void 0:i.startsWith("WebGL 2.0");return dn.set(g,o),o}}class Li{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class zo extends Li{getDefault(){return l.aO.transparent}set(i){const o=this.current;(i.r!==o.r||i.g!==o.g||i.b!==o.b||i.a!==o.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Oo extends Li{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class Fo extends Li{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class Bo extends Li{getDefault(){return[!0,!0,!0,!0]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class ho extends Li{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class Il extends Li{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class Al extends Li{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const o=this.current;(i.func!==o.func||i.ref!==o.ref||i.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class fa extends Li{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class No extends Li{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=i,this.dirty=!1}}class Pl extends Li{getDefault(){return[0,1]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class bn extends Li{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=i,this.dirty=!1}}class mc extends Li{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class gc extends Li{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.BLEND):o.disable(o.BLEND),this.current=i,this.dirty=!1}}class _u extends Li{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class yc extends Li{getDefault(){return l.aO.transparent}set(i){const o=this.current;(i.r!==o.r||i.g!==o.g||i.b!==o.b||i.a!==o.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class $o extends Li{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class _c extends Li{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=i,this.dirty=!1}}class Uo extends Li{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class Vo extends Li{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class zs extends Li{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class jo extends Li{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class Fa extends Li{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class vc extends Li{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class qo extends Li{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class pa extends Li{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class Os extends Li{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Go extends Li{getDefault(){return null}set(i){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Ys extends Li{getDefault(){return null}set(i){var o;if(i===this.current&&!this.dirty)return;const h=this.gl;Jr(h)?h.bindVertexArray(i):(o=h.getExtension("OES_vertex_array_object"))===null||o===void 0||o.bindVertexArrayOES(i),this.current=i,this.dirty=!1}}class _s extends Li{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class xc extends Li{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class Dl extends Li{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class Ai extends Li{constructor(i,o){super(i),this.context=i,this.parent=o}getDefault(){return null}}class Ho extends Ai{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class vu extends Ai{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class kl extends Ai{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class ma{constructor(i,o,h,f,_){this.context=i,this.width=o,this.height=h;const M=i.gl,S=this.framebuffer=M.createFramebuffer();if(this.colorAttachment=new Ho(i,S),f)this.depthAttachment=_?new kl(i,S):new vu(i,S);else if(_)throw new Error("Stencil cannot be set without depth");if(M.checkFramebufferStatus(M.FRAMEBUFFER)!==M.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const i=this.context.gl,o=this.colorAttachment.get();if(o&&i.deleteTexture(o),this.depthAttachment){const h=this.depthAttachment.get();h&&i.deleteRenderbuffer(h)}i.deleteFramebuffer(this.framebuffer)}}class Yi{constructor(i,o,h){this.blendFunction=i,this.blendColor=o,this.mask=h}}Yi.Replace=[1,0],Yi.disabled=new Yi(Yi.Replace,l.aO.transparent,[!1,!1,!1,!1]),Yi.unblended=new Yi(Yi.Replace,l.aO.transparent,[!0,!0,!0,!0]),Yi.alphaBlended=new Yi([1,771],l.aO.transparent,[!0,!0,!0,!0]);class Fs{constructor(i){var o,h;if(this.gl=i,this.clearColor=new zo(this),this.clearDepth=new Oo(this),this.clearStencil=new Fo(this),this.colorMask=new Bo(this),this.depthMask=new ho(this),this.stencilMask=new Il(this),this.stencilFunc=new Al(this),this.stencilOp=new fa(this),this.stencilTest=new No(this),this.depthRange=new Pl(this),this.depthTest=new bn(this),this.depthFunc=new mc(this),this.blend=new gc(this),this.blendFunc=new _u(this),this.blendColor=new yc(this),this.blendEquation=new $o(this),this.cullFace=new _c(this),this.cullFaceSide=new Uo(this),this.frontFace=new Vo(this),this.program=new zs(this),this.activeTexture=new jo(this),this.viewport=new Fa(this),this.bindFramebuffer=new vc(this),this.bindRenderbuffer=new qo(this),this.bindTexture=new pa(this),this.bindVertexBuffer=new Os(this),this.bindElementBuffer=new Go(this),this.bindVertexArray=new Ys(this),this.pixelStoreUnpack=new _s(this),this.pixelStoreUnpackPremultiplyAlpha=new xc(this),this.pixelStoreUnpackFlipY=new Dl(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),Jr(i)){this.HALF_FLOAT=i.HALF_FLOAT;const f=i.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(o=i.RGBA16F)!==null&&o!==void 0?o:f==null?void 0:f.RGBA16F_EXT,this.RGB16F=(h=i.RGB16F)!==null&&h!==void 0?h:f==null?void 0:f.RGB16F_EXT,i.getExtension("EXT_color_buffer_float")}else{i.getExtension("EXT_color_buffer_half_float"),i.getExtension("OES_texture_half_float_linear");const f=i.getExtension("OES_texture_half_float");this.HALF_FLOAT=f==null?void 0:f.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,o){return new pc(this,i,o)}createVertexBuffer(i,o,h){return new Oa(this,i,o,h)}createRenderbuffer(i,o,h){const f=this.gl,_=f.createRenderbuffer();return this.bindRenderbuffer.set(_),f.renderbufferStorage(f.RENDERBUFFER,i,o,h),this.bindRenderbuffer.set(null),_}createFramebuffer(i,o,h,f){return new ma(this,i,o,h,f)}clear({color:i,depth:o,stencil:h}){const f=this.gl;let _=0;i&&(_|=f.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(_|=f.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),h!==void 0&&(_|=f.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),f.clear(_)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){l.aD(i.blendFunction,Yi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}createVertexArray(){var i;return Jr(this.gl)?this.gl.createVertexArray():(i=this.gl.getExtension("OES_vertex_array_object"))===null||i===void 0?void 0:i.createVertexArrayOES()}deleteVertexArray(i){var o;return Jr(this.gl)?this.gl.deleteVertexArray(i):(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.deleteVertexArrayOES(i)}unbindVAO(){this.bindVertexArray.set(null)}}class hi{constructor(i,o,h){this.func=i,this.mask=o,this.range=h}}hi.ReadOnly=!1,hi.ReadWrite=!0,hi.disabled=new hi(519,hi.ReadOnly,[0,1]);const Ba=7680;class zi{constructor(i,o,h,f,_,M){this.test=i,this.ref=o,this.mask=h,this.fail=f,this.depthFail=_,this.pass=M}}zi.disabled=new zi({func:519,mask:0},0,0,Ba,Ba,Ba);class Wi{constructor(i,o,h){this.enable=i,this.mode=o,this.frontFace=h}}let vs;function Js(g,i,o,h,f,_,M){const S=g.context,C=S.gl,k=g.useProgram("collisionBox"),F=[];let B=0,q=0;for(let le=0;le<h.length;le++){const be=h[le],Ae=i.getTile(be),ke=Ae.getBucket(o);if(!ke)continue;let ze=be.posMatrix;f[0]===0&&f[1]===0||(ze=g.translatePosMatrix(be.posMatrix,Ae,f,_));const We=M?ke.textCollisionBox:ke.iconCollisionBox,He=ke.collisionCircleArray;if(He.length>0){const st=l.F(),ct=ze;l.aP(st,ke.placementInvProjMatrix,g.transform.glCoordMatrix),l.aP(st,st,ke.placementViewportMatrix),F.push({circleArray:He,circleOffset:q,transform:ct,invTransform:st,coord:be}),B+=He.length/4,q=B}We&&k.draw(S,C.LINES,hi.disabled,zi.disabled,g.colorModeForRenderPass(),Wi.disabled,bt(ze,g.transform,Ae),g.style.map.terrain&&g.style.map.terrain.getTerrainData(be),o.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,null,g.transform.zoom,null,null,We.collisionVertexBuffer)}if(!M||!F.length)return;const te=g.useProgram("collisionCircle"),Q=new l.aQ;Q.resize(4*B),Q._trim();let re=0;for(const le of F)for(let be=0;be<le.circleArray.length/4;be++){const Ae=4*be,ke=le.circleArray[Ae+0],ze=le.circleArray[Ae+1],We=le.circleArray[Ae+2],He=le.circleArray[Ae+3];Q.emplace(re++,ke,ze,We,He,0),Q.emplace(re++,ke,ze,We,He,1),Q.emplace(re++,ke,ze,We,He,2),Q.emplace(re++,ke,ze,We,He,3)}(!vs||vs.length<2*B)&&(vs=function(le){const be=2*le,Ae=new l.aS;Ae.resize(be),Ae._trim();for(let ke=0;ke<be;ke++){const ze=6*ke;Ae.uint16[ze+0]=4*ke+0,Ae.uint16[ze+1]=4*ke+1,Ae.uint16[ze+2]=4*ke+2,Ae.uint16[ze+3]=4*ke+2,Ae.uint16[ze+4]=4*ke+3,Ae.uint16[ze+5]=4*ke+0}return Ae}(B));const W=S.createIndexBuffer(vs,!0),pe=S.createVertexBuffer(Q,l.aR.members,!0);for(const le of F){const be={u_matrix:le.transform,u_inv_matrix:le.invTransform,u_camera_to_center_distance:(Ie=g.transform).cameraToCenterDistance,u_viewport_size:[Ie.width,Ie.height]};te.draw(S,C.TRIANGLES,hi.disabled,zi.disabled,g.colorModeForRenderPass(),Wi.disabled,be,g.style.map.terrain&&g.style.map.terrain.getTerrainData(le.coord),o.id,pe,W,l.$.simpleSegment(0,2*le.circleOffset,le.circleArray.length,le.circleArray.length/2),null,g.transform.zoom,null,null,null)}var Ie;pe.destroy(),W.destroy()}Wi.disabled=new Wi(!1,1029,2305),Wi.backCCW=new Wi(!0,1029,2305);const Zo=l.an(new Float32Array(16));function Ll(g,i,o,h,f,_){const{horizontalAlign:M,verticalAlign:S}=l.at(g);return new l.P((-(M-.5)*i/f+h[0])*_,(-(S-.5)*o/f+h[1])*_)}function Wo(g,i,o,h,f,_,M,S,C,k,F){const B=g.text.placedSymbolArray,q=g.text.dynamicLayoutVertexArray,te=g.icon.dynamicLayoutVertexArray,Q={};q.clear();for(let re=0;re<B.length;re++){const W=B.get(re),pe=W.hidden||!W.crossTileID||g.allowVerticalPlacement&&!W.placedOrientation?null:h[W.crossTileID];if(pe){const Ie=new l.P(W.anchorX,W.anchorY),le=Mr(Ie,o?M:_,F),be=ee(f.cameraToCenterDistance,le.signedDistanceFromCamera);let Ae=l.ai(g.textSizeData,C,W)*be/l.ao;o&&(Ae*=g.tilePixelRatio/S);const{width:ke,height:ze,anchor:We,textOffset:He,textBoxScale:st}=pe,ct=Ll(We,ke,ze,He,st,Ae),ci=o?Mr(Ie.add(ct),_,F).point:le.point.add(i?ct.rotate(-f.angle):ct),mt=g.allowVerticalPlacement&&W.placedOrientation===l.ah.vertical?Math.PI/2:0;for(let Yt=0;Yt<W.numGlyphs;Yt++)l.aj(q,ci,mt);k&&W.associatedIconIndex>=0&&(Q[W.associatedIconIndex]={shiftedAnchor:ci,angle:mt})}else Ne(W.numGlyphs,q)}if(k){te.clear();const re=g.icon.placedSymbolArray;for(let W=0;W<re.length;W++){const pe=re.get(W);if(pe.hidden)Ne(pe.numGlyphs,te);else{const Ie=Q[W];if(Ie)for(let le=0;le<pe.numGlyphs;le++)l.aj(te,Ie.shiftedAnchor,Ie.angle);else Ne(pe.numGlyphs,te)}}g.icon.dynamicLayoutVertexBuffer.updateData(te)}g.text.dynamicLayoutVertexBuffer.updateData(q)}function Xo(g,i,o){return o.iconsInText&&i?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function fo(g,i,o,h,f,_,M,S,C,k,F,B){const q=g.context,te=q.gl,Q=g.transform,re=S==="map",W=C==="map",pe=S!=="viewport"&&o.layout.get("symbol-placement")!=="point",Ie=re&&!W&&!pe,le=!o.layout.get("symbol-sort-key").isConstant();let be=!1;const Ae=g.depthModeForSublayer(0,hi.ReadOnly),ke=o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ze=[];for(const We of h){const He=i.getTile(We),st=He.getBucket(o);if(!st)continue;const ct=f?st.text:st.icon;if(!ct||!ct.segments.get().length||!ct.hasVisibleVertices)continue;const ci=ct.programConfigurations.get(o.id),mt=f||st.sdfIcons,Yt=f?st.textSizeData:st.iconSizeData,ui=W||Q.pitch!==0,Pi=g.useProgram(Xo(mt,f,st),ci),ii=l.ag(Yt,Q.zoom),di=g.style.map.terrain&&g.style.map.terrain.getTerrainData(We);let yi,Rr,Xi,as,rn=[0,0],Tr=null;if(f)Rr=He.glyphAtlasTexture,Xi=te.LINEAR,yi=He.glyphAtlasTexture.size,st.iconsInText&&(rn=He.imageAtlasTexture.size,Tr=He.imageAtlasTexture,as=ui||g.options.rotating||g.options.zooming||Yt.kind==="composite"||Yt.kind==="camera"?te.LINEAR:te.NEAREST);else{const Xr=o.layout.get("icon-size").constantOr(0)!==1||st.iconsNeedLinear;Rr=He.imageAtlasTexture,Xi=mt||g.options.rotating||g.options.zooming||Xr||ui?te.LINEAR:te.NEAREST,yi=He.imageAtlasTexture.size}const nn=ti(He,1,g.transform.zoom),os=Jt(We.posMatrix,W,re,g.transform,nn),ta=Ws(We.posMatrix,W,re,g.transform,nn),ja=ke&&st.hasTextData(),Xl=o.layout.get("icon-text-fit")!=="none"&&ja&&st.hasIconData();if(pe){const Xr=g.style.map.terrain?(Es,Kr)=>g.style.map.terrain.getElevation(We,Es,Kr):null,Ir=o.layout.get("text-rotation-alignment")==="map";U(st,We.posMatrix,g,f,os,ta,W,k,Ir,Xr)}const qa=g.translatePosMatrix(We.posMatrix,He,_,M),ia=pe||f&&ke||Xl?Zo:os,Wr=g.translatePosMatrix(ta,He,_,M,!0),Cr=mt&&o.paint.get(f?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let yr;yr=mt?st.iconsInText?za(Yt.kind,ii,Ie,W,g,qa,ia,Wr,yi,rn):ji(Yt.kind,ii,Ie,W,g,qa,ia,Wr,f,yi,!0):uo(Yt.kind,ii,Ie,W,g,qa,ia,Wr,f,yi);const Ss={program:Pi,buffers:ct,uniformValues:yr,atlasTexture:Rr,atlasTextureIcon:Tr,atlasInterpolation:Xi,atlasInterpolationIcon:as,isSDF:mt,hasHalo:Cr};if(le&&st.canOverlap){be=!0;const Xr=ct.segments.get();for(const Ir of Xr)ze.push({segments:new l.$([Ir]),sortKey:Ir.sortKey,state:Ss,terrainData:di})}else ze.push({segments:ct.segments,sortKey:0,state:Ss,terrainData:di})}be&&ze.sort((We,He)=>We.sortKey-He.sortKey);for(const We of ze){const He=We.state;if(q.activeTexture.set(te.TEXTURE0),He.atlasTexture.bind(He.atlasInterpolation,te.CLAMP_TO_EDGE),He.atlasTextureIcon&&(q.activeTexture.set(te.TEXTURE1),He.atlasTextureIcon&&He.atlasTextureIcon.bind(He.atlasInterpolationIcon,te.CLAMP_TO_EDGE)),He.isSDF){const st=He.uniformValues;He.hasHalo&&(st.u_is_halo=1,Rl(He.buffers,We.segments,o,g,He.program,Ae,F,B,st,We.terrainData)),st.u_is_halo=0}Rl(He.buffers,We.segments,o,g,He.program,Ae,F,B,He.uniformValues,We.terrainData)}}function Rl(g,i,o,h,f,_,M,S,C,k){const F=h.context;f.draw(F,F.gl.TRIANGLES,_,M,S,Wi.disabled,C,k,o.id,g.layoutVertexBuffer,g.indexBuffer,i,o.paint,h.transform.zoom,g.programConfigurations.get(o.id),g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer)}function ga(g,i,o,h,f){if(!o||!h||!h.imageAtlas)return;const _=h.imageAtlas.patternPositions;let M=_[o.to.toString()],S=_[o.from.toString()];if(!M&&S&&(M=S),!S&&M&&(S=M),!M||!S){const C=f.getPaintProperty(i);M=_[C],S=_[C]}M&&S&&g.setConstantPatternPositions(M,S)}function ya(g,i,o,h,f,_,M){const S=g.context.gl,C="fill-pattern",k=o.paint.get(C),F=k&&k.constantOr(1),B=o.getCrossfadeParameters();let q,te,Q,re,W;M?(te=F&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",q=S.LINES):(te=F?"fillPattern":"fill",q=S.TRIANGLES);const pe=k.constantOr(null);for(const Ie of h){const le=i.getTile(Ie);if(F&&!le.patternsLoaded())continue;const be=le.getBucket(o);if(!be)continue;const Ae=be.programConfigurations.get(o.id),ke=g.useProgram(te,Ae),ze=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Ie);F&&(g.context.activeTexture.set(S.TEXTURE0),le.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),Ae.updatePaintBuffers(B)),ga(Ae,C,pe,le,o);const We=ze?Ie:null,He=g.translatePosMatrix(We?We.posMatrix:Ie.posMatrix,le,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(M){re=be.indexBuffer2,W=be.segments2;const st=[S.drawingBufferWidth,S.drawingBufferHeight];Q=te==="fillOutlinePattern"&&F?Ke(He,g,B,le,st):Me(He,st)}else re=be.indexBuffer,W=be.segments,Q=F?ye(He,g,B,le):ge(He);ke.draw(g.context,q,f,g.stencilModeForClipping(Ie),_,Wi.disabled,Q,ze,o.id,be.layoutVertexBuffer,re,W,o.paint,g.transform.zoom,Ae)}}function Ko(g,i,o,h,f,_,M){const S=g.context,C=S.gl,k="fill-extrusion-pattern",F=o.paint.get(k),B=F.constantOr(1),q=o.getCrossfadeParameters(),te=o.paint.get("fill-extrusion-opacity"),Q=F.constantOr(null);for(const re of h){const W=i.getTile(re),pe=W.getBucket(o);if(!pe)continue;const Ie=g.style.map.terrain&&g.style.map.terrain.getTerrainData(re),le=pe.programConfigurations.get(o.id),be=g.useProgram(B?"fillExtrusionPattern":"fillExtrusion",le);B&&(g.context.activeTexture.set(C.TEXTURE0),W.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),le.updatePaintBuffers(q)),ga(le,k,Q,W,o);const Ae=g.translatePosMatrix(re.posMatrix,W,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),ke=o.paint.get("fill-extrusion-vertical-gradient"),ze=B?oe(Ae,g,ke,te,re,q,W):V(Ae,g,ke,te);be.draw(S,S.gl.TRIANGLES,f,_,M,Wi.backCCW,ze,Ie,o.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,o.paint,g.transform.zoom,le,g.style.map.terrain&&pe.centroidVertexBuffer)}}function rs(g,i,o,h,f,_,M){const S=g.context,C=S.gl,k=o.fbo;if(!k)return;const F=g.useProgram("hillshade"),B=g.style.map.terrain&&g.style.map.terrain.getTerrainData(i);S.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,k.colorAttachment.get()),F.draw(S,C.TRIANGLES,f,_,M,Wi.disabled,((q,te,Q,re)=>{const W=Q.paint.get("hillshade-shadow-color"),pe=Q.paint.get("hillshade-highlight-color"),Ie=Q.paint.get("hillshade-accent-color");let le=Q.paint.get("hillshade-illumination-direction")*(Math.PI/180);Q.paint.get("hillshade-illumination-anchor")==="viewport"&&(le-=q.transform.angle);const be=!q.options.moving;return{u_matrix:re?re.posMatrix:q.transform.calculatePosMatrix(te.tileID.toUnwrapped(),be),u_image:0,u_latrange:ur(0,te.tileID),u_light:[Q.paint.get("hillshade-exaggeration"),le],u_shadow:W,u_highlight:pe,u_accent:Ie}})(g,o,h,B?i:null),B,h.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments)}function zl(g,i,o,h,f,_){const M=g.context,S=M.gl,C=i.dem;if(C&&C.data){const k=C.dim,F=C.stride,B=C.getPixels();if(M.activeTexture.set(S.TEXTURE1),M.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||g.getTileTexture(F),i.demTexture){const te=i.demTexture;te.update(B,{premultiply:!1}),te.bind(S.NEAREST,S.CLAMP_TO_EDGE)}else i.demTexture=new kt(M,B,S.RGBA,{premultiply:!1}),i.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);M.activeTexture.set(S.TEXTURE0);let q=i.fbo;if(!q){const te=new kt(M,{width:k,height:k,data:null},S.RGBA);te.bind(S.LINEAR,S.CLAMP_TO_EDGE),q=i.fbo=M.createFramebuffer(k,k,!0,!1),q.colorAttachment.set(te.texture)}M.bindFramebuffer.set(q.framebuffer),M.viewport.set([0,0,k,k]),g.useProgram("hillshadePrepare").draw(M,S.TRIANGLES,h,f,_,Wi.disabled,((te,Q)=>{const re=Q.stride,W=l.F();return l.aN(W,0,l.W,-l.W,0,0,1),l.H(W,W,[0,-l.W,0]),{u_matrix:W,u_image:1,u_dimension:[re,re],u_zoom:te.overscaledZ,u_unpack:Q.getUnpackVector()}})(i.tileID,C),null,o.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments),i.needsHillshadePrepare=!1}}function Qs(g,i,o,h,f,_){const M=h.paint.get("raster-fade-duration");if(!_&&M>0){const S=D.now(),C=(S-g.timeAdded)/M,k=i?(S-i.timeAdded)/M:-1,F=o.getSource(),B=f.coveringZoomLevel({tileSize:F.tileSize,roundZoom:F.roundZoom}),q=!i||Math.abs(i.tileID.overscaledZ-B)>Math.abs(g.tileID.overscaledZ-B),te=q&&g.refreshedUponExpiration?1:l.ac(q?C:1-k,0,1);return g.refreshedUponExpiration&&C>=1&&(g.refreshedUponExpiration=!1),i?{opacity:1,mix:1-te}:{opacity:te,mix:0}}return{opacity:1,mix:0}}const Ol=new l.aO(1,0,0,1),Yo=new l.aO(0,1,0,1),Na=new l.aO(0,0,1,1),Fl=new l.aO(1,0,1,1),Bl=new l.aO(0,1,1,1);function hr(g,i,o,h){Vr(g,0,i+o/2,g.transform.width,o,h)}function Bs(g,i,o,h){Vr(g,i-o/2,0,o,g.transform.height,h)}function Vr(g,i,o,h,f,_){const M=g.context,S=M.gl;S.enable(S.SCISSOR_TEST),S.scissor(i*g.pixelRatio,o*g.pixelRatio,h*g.pixelRatio,f*g.pixelRatio),M.clear({color:_}),S.disable(S.SCISSOR_TEST)}function Jo(g,i,o){const h=g.context,f=h.gl,_=o.posMatrix,M=g.useProgram("debug"),S=hi.disabled,C=zi.disabled,k=g.colorModeForRenderPass(),F="$debug",B=g.style.map.terrain&&g.style.map.terrain.getTerrainData(o);h.activeTexture.set(f.TEXTURE0);const q=i.getTileByID(o.key).latestRawTileData,te=Math.floor((q&&q.byteLength||0)/1024),Q=i.getTile(o).tileSize,re=512/Math.min(Q,512)*(o.overscaledZ/g.transform.zoom)*.5;let W=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(W+=` => ${o.overscaledZ}`),function(pe,Ie){pe.initDebugOverlayCanvas();const le=pe.debugOverlayCanvas,be=pe.context.gl,Ae=pe.debugOverlayCanvas.getContext("2d");Ae.clearRect(0,0,le.width,le.height),Ae.shadowColor="white",Ae.shadowBlur=2,Ae.lineWidth=1.5,Ae.strokeStyle="white",Ae.textBaseline="top",Ae.font="bold 36px Open Sans, sans-serif",Ae.fillText(Ie,5,5),Ae.strokeText(Ie,5,5),pe.debugOverlayTexture.update(le),pe.debugOverlayTexture.bind(be.LINEAR,be.CLAMP_TO_EDGE)}(g,`${W} ${te}kB`),M.draw(h,f.TRIANGLES,S,C,Yi.alphaBlended,Wi.disabled,wt(_,l.aO.transparent,re),null,F,g.debugBuffer,g.quadTriangleIndexBuffer,g.debugSegments),M.draw(h,f.LINE_STRIP,S,C,k,Wi.disabled,wt(_,l.aO.red),B,F,g.debugBuffer,g.tileBorderIndexBuffer,g.debugSegments)}function Qo(g,i,o){const h=g.context,f=h.gl,_=g.colorModeForRenderPass(),M=new hi(f.LEQUAL,hi.ReadWrite,g.depthRangeFor3D),S=g.useProgram("terrain"),C=i.getTerrainMesh();h.bindFramebuffer.set(null),h.viewport.set([0,0,g.width,g.height]);for(const k of o){const F=g.renderToTexture.getTexture(k),B=i.getTerrainData(k.tileID);h.activeTexture.set(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,F.texture);const q={u_matrix:g.transform.calculatePosMatrix(k.tileID.toUnwrapped()),u_texture:0,u_ele_delta:i.getMeshFrameDelta(g.transform.zoom)};S.draw(h,f.TRIANGLES,M,zi.disabled,_,Wi.backCCW,q,B,"terrain",C.vertexBuffer,C.indexBuffer,C.segments)}}class Se{constructor(i,o){this.context=new Fs(i),this.transform=o,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=wr.maxUnderzooming+wr.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Xs}resize(i,o,h){if(this.width=Math.floor(i*h),this.height=Math.floor(o*h),this.pixelRatio=h,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style._order)this.style._layers[f].resize()}setup(){const i=this.context,o=new l.aV;o.emplaceBack(0,0),o.emplaceBack(l.W,0),o.emplaceBack(0,l.W),o.emplaceBack(l.W,l.W),this.tileExtentBuffer=i.createVertexBuffer(o,lo.members),this.tileExtentSegments=l.$.simpleSegment(0,0,4,2);const h=new l.aV;h.emplaceBack(0,0),h.emplaceBack(l.W,0),h.emplaceBack(0,l.W),h.emplaceBack(l.W,l.W),this.debugBuffer=i.createVertexBuffer(h,lo.members),this.debugSegments=l.$.simpleSegment(0,0,4,5);const f=new l.Z;f.emplaceBack(0,0,0,0),f.emplaceBack(l.W,0,l.W,0),f.emplaceBack(0,l.W,0,l.W),f.emplaceBack(l.W,l.W,l.W,l.W),this.rasterBoundsBuffer=i.createVertexBuffer(f,Be.members),this.rasterBoundsSegments=l.$.simpleSegment(0,0,4,2);const _=new l.aV;_.emplaceBack(0,0),_.emplaceBack(1,0),_.emplaceBack(0,1),_.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(_,lo.members),this.viewportSegments=l.$.simpleSegment(0,0,4,2);const M=new l.aW;M.emplaceBack(0),M.emplaceBack(1),M.emplaceBack(3),M.emplaceBack(2),M.emplaceBack(0),this.tileBorderIndexBuffer=i.createIndexBuffer(M);const S=new l.aX;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(S);const C=this.context.gl;this.stencilClearMode=new zi({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO)}clearStencil(){const i=this.context,o=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const h=l.F();l.aN(h,0,this.width,this.height,0,0,1),l.J(h,h,[o.drawingBufferWidth,o.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(i,o.TRIANGLES,hi.disabled,this.stencilClearMode,Yi.disabled,Wi.disabled,ht(h),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(i,o){if(this.currentStencilSource===i.source||!i.isTileClipped()||!o||!o.length)return;this.currentStencilSource=i.source;const h=this.context,f=h.gl;this.nextStencilID+o.length>256&&this.clearStencil(),h.setColorMode(Yi.disabled),h.setDepthMode(hi.disabled);const _=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const M of o){const S=this._tileClippingMaskIDs[M.key]=this.nextStencilID++,C=this.style.map.terrain&&this.style.map.terrain.getTerrainData(M);_.draw(h,f.TRIANGLES,hi.disabled,new zi({func:f.ALWAYS,mask:0},S,255,f.KEEP,f.KEEP,f.REPLACE),Yi.disabled,Wi.disabled,ht(M.posMatrix),C,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,o=this.context.gl;return new zi({func:o.NOTEQUAL,mask:255},i,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(i){const o=this.context.gl;return new zi({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(i){const o=this.context.gl,h=i.sort((M,S)=>S.overscaledZ-M.overscaledZ),f=h[h.length-1].overscaledZ,_=h[0].overscaledZ-f+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const M={};for(let S=0;S<_;S++)M[S+f]=new zi({func:o.GEQUAL,mask:255},S+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=_,[M,h]}return[{[f]:zi.disabled},h]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new Yi([i.CONSTANT_COLOR,i.ONE],new l.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Yi.unblended:Yi.alphaBlended}depthModeForSublayer(i,o,h){if(!this.opaquePassEnabledForLayer())return hi.disabled;const f=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new hi(h||this.context.gl.LEQUAL,o,[f,f])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,o){this.style=i,this.options=o,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(D.now()),this.imageManager.beginFrame();const h=this.style._order,f=this.style.sourceCaches,_={},M={},S={};for(const C in f){const k=f[C];k.used&&k.prepare(this.context),_[C]=k.getVisibleCoordinates(),M[C]=_[C].slice().reverse(),S[C]=k.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let C=0;C<h.length;C++)if(this.style._layers[h[C]].is3D()){this.opaquePassCutoff=C;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const C of h){const k=this.style._layers[C];if(!k.hasOffscreenPass()||k.isHidden(this.transform.zoom))continue;const F=M[k.source];(k.type==="custom"||F.length)&&this.renderLayer(this,f[k.source],k,F)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:o.showOverdrawInspector?l.aO.black:l.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.depthRangeFor3D=[0,1-(i._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){const C=this.style._layers[h[this.currentLayer]],k=f[C.source],F=_[C.source];this._renderTileClippingMasks(C,F),this.renderLayer(this,k,C,F)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){const C=this.style._layers[h[this.currentLayer]],k=f[C.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(C))continue;const F=(C.type==="symbol"?S:M)[C.source];this._renderTileClippingMasks(C,_[C.source]),this.renderLayer(this,k,C,F)}if(this.options.showTileBoundaries){const C=function(k,F){let B=null;const q=Object.values(k._layers).flatMap(W=>W.source&&!W.isHidden(F)?[k.sourceCaches[W.source]]:[]),te=q.filter(W=>W.getSource().type==="vector"),Q=q.filter(W=>W.getSource().type!=="vector"),re=W=>{(!B||B.getSource().maxzoom<W.getSource().maxzoom)&&(B=W)};return te.forEach(W=>re(W)),B||Q.forEach(W=>re(W)),B}(this.style,this.transform.zoom);C&&function(k,F,B){for(let q=0;q<B.length;q++)Jo(k,F,B[q])}(this,C,C.getVisibleCoordinates())}this.options.showPadding&&function(C){const k=C.transform.padding;hr(C,C.transform.height-(k.top||0),3,Ol),hr(C,k.bottom||0,3,Yo),Bs(C,k.left||0,3,Na),Bs(C,C.transform.width-(k.right||0),3,Fl);const F=C.transform.centerPoint;(function(B,q,te,Q){Vr(B,q-1,te-10,2,20,Q),Vr(B,q-10,te-1,20,2,Q)})(C,F.x,C.transform.height-F.y,Bl)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(i){if(!this.style||!this.style.map||!this.style.map.terrain)return;const o=this.terrainFacilitator.matrix,h=this.transform.projMatrix;let f=this.terrainFacilitator.dirty;f||(f=i?!l.aY(o,h):!l.aZ(o,h)),f||(f=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),f&&(l.a_(o,h),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(_,M){const S=_.context,C=S.gl,k=Yi.unblended,F=new hi(C.LEQUAL,hi.ReadWrite,[0,1]),B=M.getTerrainMesh(),q=M.sourceCache.getRenderableTiles(),te=_.useProgram("terrainDepth");S.bindFramebuffer.set(M.getFramebuffer("depth").framebuffer),S.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),S.clear({color:l.aO.transparent,depth:1});for(const Q of q){const re=M.getTerrainData(Q.tileID),W={u_matrix:_.transform.calculatePosMatrix(Q.tileID.toUnwrapped()),u_ele_delta:M.getMeshFrameDelta(_.transform.zoom)};te.draw(S,C.TRIANGLES,F,zi.disabled,k,Wi.backCCW,W,re,"terrain",B.vertexBuffer,B.indexBuffer,B.segments)}S.bindFramebuffer.set(null),S.viewport.set([0,0,_.width,_.height])}(this,this.style.map.terrain),function(_,M){const S=_.context,C=S.gl,k=Yi.unblended,F=new hi(C.LEQUAL,hi.ReadWrite,[0,1]),B=M.getTerrainMesh(),q=M.getCoordsTexture(),te=M.sourceCache.getRenderableTiles(),Q=_.useProgram("terrainCoords");S.bindFramebuffer.set(M.getFramebuffer("coords").framebuffer),S.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),S.clear({color:l.aO.transparent,depth:1}),M.coordsIndex=[];for(const re of te){const W=M.getTerrainData(re.tileID);S.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,q.texture);const pe={u_matrix:_.transform.calculatePosMatrix(re.tileID.toUnwrapped()),u_terrain_coords_id:(255-M.coordsIndex.length)/255,u_texture:0,u_ele_delta:M.getMeshFrameDelta(_.transform.zoom)};Q.draw(S,C.TRIANGLES,F,zi.disabled,k,Wi.backCCW,pe,W,"terrain",B.vertexBuffer,B.indexBuffer,B.segments),M.coordsIndex.push(re.tileID.key)}S.bindFramebuffer.set(null),S.viewport.set([0,0,_.width,_.height])}(this,this.style.map.terrain))}renderLayer(i,o,h,f){if(!h.isHidden(this.transform.zoom)&&(h.type==="background"||h.type==="custom"||(f||[]).length))switch(this.id=h.id,h.type){case"symbol":(function(_,M,S,C,k){if(_.renderPass!=="translucent")return;const F=zi.disabled,B=_.colorModeForRenderPass();(S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(q,te,Q,re,W,pe,Ie){const le=te.transform,be=W==="map",Ae=pe==="map";for(const ke of q){const ze=re.getTile(ke),We=ze.getBucket(Q);if(!We||!We.text||!We.text.segments.get().length)continue;const He=l.ag(We.textSizeData,le.zoom),st=ti(ze,1,te.transform.zoom),ct=Jt(ke.posMatrix,Ae,be,te.transform,st),ci=Q.layout.get("icon-text-fit")!=="none"&&We.hasIconData();if(He){const mt=Math.pow(2,le.zoom-ze.tileID.overscaledZ);Wo(We,be,Ae,Ie,le,ct,ke.posMatrix,mt,He,ci,te.style.map.terrain?(Yt,ui)=>te.style.map.terrain.getElevation(ke,Yt,ui):null)}}}(C,_,S,M,S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),k),S.paint.get("icon-opacity").constantOr(1)!==0&&fo(_,M,S,C,!1,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),S.layout.get("icon-rotation-alignment"),S.layout.get("icon-pitch-alignment"),S.layout.get("icon-keep-upright"),F,B),S.paint.get("text-opacity").constantOr(1)!==0&&fo(_,M,S,C,!0,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.layout.get("text-keep-upright"),F,B),M.map.showCollisionBoxes&&(Js(_,M,S,C,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),!0),Js(_,M,S,C,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),!1))})(i,o,h,f,this.style.placement.variableOffsets);break;case"circle":(function(_,M,S,C){if(_.renderPass!=="translucent")return;const k=S.paint.get("circle-opacity"),F=S.paint.get("circle-stroke-width"),B=S.paint.get("circle-stroke-opacity"),q=!S.layout.get("circle-sort-key").isConstant();if(k.constantOr(1)===0&&(F.constantOr(1)===0||B.constantOr(1)===0))return;const te=_.context,Q=te.gl,re=_.depthModeForSublayer(0,hi.ReadOnly),W=zi.disabled,pe=_.colorModeForRenderPass(),Ie=[];for(let le=0;le<C.length;le++){const be=C[le],Ae=M.getTile(be),ke=Ae.getBucket(S);if(!ke)continue;const ze=ke.programConfigurations.get(S.id),We=_.useProgram("circle",ze),He=ke.layoutVertexBuffer,st=ke.indexBuffer,ct=_.style.map.terrain&&_.style.map.terrain.getTerrainData(be),ci={programConfiguration:ze,program:We,layoutVertexBuffer:He,indexBuffer:st,uniformValues:at(_,be,Ae,S),terrainData:ct};if(q){const mt=ke.segments.get();for(const Yt of mt)Ie.push({segments:new l.$([Yt]),sortKey:Yt.sortKey,state:ci})}else Ie.push({segments:ke.segments,sortKey:0,state:ci})}q&&Ie.sort((le,be)=>le.sortKey-be.sortKey);for(const le of Ie){const{programConfiguration:be,program:Ae,layoutVertexBuffer:ke,indexBuffer:ze,uniformValues:We,terrainData:He}=le.state;Ae.draw(te,Q.TRIANGLES,re,W,pe,Wi.disabled,We,He,S.id,ke,ze,le.segments,S.paint,_.transform.zoom,be)}})(i,o,h,f);break;case"heatmap":(function(_,M,S,C){if(S.paint.get("heatmap-opacity")!==0)if(_.renderPass==="offscreen"){const k=_.context,F=k.gl,B=zi.disabled,q=new Yi([F.ONE,F.ONE],l.aO.transparent,[!0,!0,!0,!0]);(function(te,Q,re){const W=te.gl;te.activeTexture.set(W.TEXTURE1),te.viewport.set([0,0,Q.width/4,Q.height/4]);let pe=re.heatmapFbo;if(pe)W.bindTexture(W.TEXTURE_2D,pe.colorAttachment.get()),te.bindFramebuffer.set(pe.framebuffer);else{const Ie=W.createTexture();W.bindTexture(W.TEXTURE_2D,Ie),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MAG_FILTER,W.LINEAR),pe=re.heatmapFbo=te.createFramebuffer(Q.width/4,Q.height/4,!1,!1),function(le,be,Ae,ke){var ze,We;const He=le.gl,st=(ze=le.HALF_FLOAT)!==null&&ze!==void 0?ze:He.UNSIGNED_BYTE,ct=(We=le.RGBA16F)!==null&&We!==void 0?We:He.RGBA;He.texImage2D(He.TEXTURE_2D,0,ct,be.width/4,be.height/4,0,He.RGBA,st,null),ke.colorAttachment.set(Ae)}(te,Q,Ie,pe)}})(k,_,S),k.clear({color:l.aO.transparent});for(let te=0;te<C.length;te++){const Q=C[te];if(M.hasRenderableParent(Q))continue;const re=M.getTile(Q),W=re.getBucket(S);if(!W)continue;const pe=W.programConfigurations.get(S.id),Ie=_.useProgram("heatmap",pe),{zoom:le}=_.transform;Ie.draw(k,F.TRIANGLES,hi.disabled,B,q,Wi.disabled,ni(Q.posMatrix,re,le,S.paint.get("heatmap-intensity")),null,S.id,W.layoutVertexBuffer,W.indexBuffer,W.segments,S.paint,_.transform.zoom,pe)}k.viewport.set([0,0,_.width,_.height])}else _.renderPass==="translucent"&&(_.context.setColorMode(_.colorModeForRenderPass()),function(k,F){const B=k.context,q=B.gl,te=F.heatmapFbo;if(!te)return;B.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_2D,te.colorAttachment.get()),B.activeTexture.set(q.TEXTURE1);let Q=F.colorRampTexture;Q||(Q=F.colorRampTexture=new kt(B,F.colorRamp,q.RGBA)),Q.bind(q.LINEAR,q.CLAMP_TO_EDGE),k.useProgram("heatmapTexture").draw(B,q.TRIANGLES,hi.disabled,zi.disabled,k.colorModeForRenderPass(),Wi.disabled,((re,W,pe,Ie)=>{const le=l.F();l.aN(le,0,re.width,re.height,0,0,1);const be=re.context.gl;return{u_matrix:le,u_world:[be.drawingBufferWidth,be.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:W.paint.get("heatmap-opacity")}})(k,F),null,F.id,k.viewportBuffer,k.quadTriangleIndexBuffer,k.viewportSegments,F.paint,k.transform.zoom)}(_,S))})(i,o,h,f);break;case"line":(function(_,M,S,C){if(_.renderPass!=="translucent")return;const k=S.paint.get("line-opacity"),F=S.paint.get("line-width");if(k.constantOr(1)===0||F.constantOr(1)===0)return;const B=_.depthModeForSublayer(0,hi.ReadOnly),q=_.colorModeForRenderPass(),te=S.paint.get("line-dasharray"),Q=S.paint.get("line-pattern"),re=Q.constantOr(1),W=S.paint.get("line-gradient"),pe=S.getCrossfadeParameters(),Ie=re?"linePattern":te?"lineSDF":W?"lineGradient":"line",le=_.context,be=le.gl;let Ae=!0;for(const ke of C){const ze=M.getTile(ke);if(re&&!ze.patternsLoaded())continue;const We=ze.getBucket(S);if(!We)continue;const He=We.programConfigurations.get(S.id),st=_.context.program.get(),ct=_.useProgram(Ie,He),ci=Ae||ct.program!==st,mt=_.style.map.terrain&&_.style.map.terrain.getTerrainData(ke),Yt=Q.constantOr(null);if(Yt&&ze.imageAtlas){const ii=ze.imageAtlas,di=ii.patternPositions[Yt.to.toString()],yi=ii.patternPositions[Yt.from.toString()];di&&yi&&He.setConstantPatternPositions(di,yi)}const ui=mt?ke:null,Pi=re?je(_,ze,S,pe,ui):te?Rt(_,ze,S,te,pe,ui):W?kr(_,ze,S,We.lineClipsArray.length,ui):oi(_,ze,S,ui);if(re)le.activeTexture.set(be.TEXTURE0),ze.imageAtlasTexture.bind(be.LINEAR,be.CLAMP_TO_EDGE),He.updatePaintBuffers(pe);else if(te&&(ci||_.lineAtlas.dirty))le.activeTexture.set(be.TEXTURE0),_.lineAtlas.bind(le);else if(W){const ii=We.gradients[S.id];let di=ii.texture;if(S.gradientVersion!==ii.version){let yi=256;if(S.stepInterpolant){const Rr=M.getSource().maxzoom,Xi=ke.canonical.z===Rr?Math.ceil(1<<_.transform.maxZoom-ke.canonical.z):1;yi=l.ac(l.aT(We.maxLineLength/l.W*1024*Xi),256,le.maxTextureSize)}ii.gradient=l.aU({expression:S.gradientExpression(),evaluationKey:"lineProgress",resolution:yi,image:ii.gradient||void 0,clips:We.lineClipsArray}),ii.texture?ii.texture.update(ii.gradient):ii.texture=new kt(le,ii.gradient,be.RGBA),ii.version=S.gradientVersion,di=ii.texture}le.activeTexture.set(be.TEXTURE0),di.bind(S.stepInterpolant?be.NEAREST:be.LINEAR,be.CLAMP_TO_EDGE)}ct.draw(le,be.TRIANGLES,B,_.stencilModeForClipping(ke),q,Wi.disabled,Pi,mt,S.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,S.paint,_.transform.zoom,He,We.layoutVertexBuffer2),Ae=!1}})(i,o,h,f);break;case"fill":(function(_,M,S,C){const k=S.paint.get("fill-color"),F=S.paint.get("fill-opacity");if(F.constantOr(1)===0)return;const B=_.colorModeForRenderPass(),q=S.paint.get("fill-pattern"),te=_.opaquePassEnabledForLayer()&&!q.constantOr(1)&&k.constantOr(l.aO.transparent).a===1&&F.constantOr(0)===1?"opaque":"translucent";if(_.renderPass===te){const Q=_.depthModeForSublayer(1,_.renderPass==="opaque"?hi.ReadWrite:hi.ReadOnly);ya(_,M,S,C,Q,B,!1)}if(_.renderPass==="translucent"&&S.paint.get("fill-antialias")){const Q=_.depthModeForSublayer(S.getPaintProperty("fill-outline-color")?2:0,hi.ReadOnly);ya(_,M,S,C,Q,B,!0)}})(i,o,h,f);break;case"fill-extrusion":(function(_,M,S,C){const k=S.paint.get("fill-extrusion-opacity");if(k!==0&&_.renderPass==="translucent"){const F=new hi(_.context.gl.LEQUAL,hi.ReadWrite,_.depthRangeFor3D);if(k!==1||S.paint.get("fill-extrusion-pattern").constantOr(1))Ko(_,M,S,C,F,zi.disabled,Yi.disabled),Ko(_,M,S,C,F,_.stencilModeFor3D(),_.colorModeForRenderPass());else{const B=_.colorModeForRenderPass();Ko(_,M,S,C,F,zi.disabled,B)}}})(i,o,h,f);break;case"hillshade":(function(_,M,S,C){if(_.renderPass!=="offscreen"&&_.renderPass!=="translucent")return;const k=_.context,F=_.depthModeForSublayer(0,hi.ReadOnly),B=_.colorModeForRenderPass(),[q,te]=_.renderPass==="translucent"?_.stencilConfigForOverlap(C):[{},C];for(const Q of te){const re=M.getTile(Q);re.needsHillshadePrepare!==void 0&&re.needsHillshadePrepare&&_.renderPass==="offscreen"?zl(_,re,S,F,zi.disabled,B):_.renderPass==="translucent"&&rs(_,Q,re,S,F,q[Q.overscaledZ],B)}k.viewport.set([0,0,_.width,_.height])})(i,o,h,f);break;case"raster":(function(_,M,S,C){if(_.renderPass!=="translucent"||S.paint.get("raster-opacity")===0||!C.length)return;const k=_.context,F=k.gl,B=M.getSource(),q=_.useProgram("raster"),te=_.colorModeForRenderPass(),[Q,re]=B instanceof it?[{},C]:_.stencilConfigForOverlap(C),W=re[re.length-1].overscaledZ,pe=!_.options.moving;for(const Ie of re){const le=_.depthModeForSublayer(Ie.overscaledZ-W,S.paint.get("raster-opacity")===1?hi.ReadWrite:hi.ReadOnly,F.LESS),be=M.getTile(Ie);be.registerFadeDuration(S.paint.get("raster-fade-duration"));const Ae=M.findLoadedParent(Ie,0),ke=Qs(be,Ae,M,S,_.transform,_.style.map.terrain);let ze,We;const He=S.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;k.activeTexture.set(F.TEXTURE0),be.texture.bind(He,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),k.activeTexture.set(F.TEXTURE1),Ae?(Ae.texture.bind(He,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),ze=Math.pow(2,Ae.tileID.overscaledZ-be.tileID.overscaledZ),We=[be.tileID.canonical.x*ze%1,be.tileID.canonical.y*ze%1]):be.texture.bind(He,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST);const st=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Ie),ct=st?Ie:null,ci=ct?ct.posMatrix:_.transform.calculatePosMatrix(Ie.toUnwrapped(),pe),mt=mr(ci,We||[0,0],ze||1,ke,S);B instanceof it?q.draw(k,F.TRIANGLES,le,zi.disabled,te,Wi.disabled,mt,st,S.id,B.boundsBuffer,_.quadTriangleIndexBuffer,B.boundsSegments):q.draw(k,F.TRIANGLES,le,Q[Ie.overscaledZ],te,Wi.disabled,mt,st,S.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments)}})(i,o,h,f);break;case"background":(function(_,M,S,C){const k=S.paint.get("background-color"),F=S.paint.get("background-opacity");if(F===0)return;const B=_.context,q=B.gl,te=_.transform,Q=te.tileSize,re=S.paint.get("background-pattern");if(_.isPatternMissing(re))return;const W=!re&&k.a===1&&F===1&&_.opaquePassEnabledForLayer()?"opaque":"translucent";if(_.renderPass!==W)return;const pe=zi.disabled,Ie=_.depthModeForSublayer(0,W==="opaque"?hi.ReadWrite:hi.ReadOnly),le=_.colorModeForRenderPass(),be=_.useProgram(re?"backgroundPattern":"background"),Ae=C||te.coveringTiles({tileSize:Q,terrain:_.style.map.terrain});re&&(B.activeTexture.set(q.TEXTURE0),_.imageManager.bind(_.context));const ke=S.getCrossfadeParameters();for(const ze of Ae){const We=C?ze.posMatrix:_.transform.calculatePosMatrix(ze.toUnwrapped()),He=re?Rs(We,F,_,re,{tileID:ze,tileSize:Q},ke):yu(We,F,k),st=_.style.map.terrain&&_.style.map.terrain.getTerrainData(ze);be.draw(B,q.TRIANGLES,Ie,pe,le,Wi.disabled,He,st,S.id,_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}})(i,0,h,f);break;case"custom":(function(_,M,S){const C=_.context,k=S.implementation;if(_.renderPass==="offscreen"){const F=k.prerender;F&&(_.setCustomLayerDefaults(),C.setColorMode(_.colorModeForRenderPass()),F.call(k,C.gl,_.transform.customLayerMatrix()),C.setDirty(),_.setBaseState())}else if(_.renderPass==="translucent"){_.setCustomLayerDefaults(),C.setColorMode(_.colorModeForRenderPass()),C.setStencilMode(zi.disabled);const F=k.renderingMode==="3d"?new hi(_.context.gl.LEQUAL,hi.ReadWrite,_.depthRangeFor3D):_.depthModeForSublayer(0,hi.ReadOnly);C.setDepthMode(F),k.render(C.gl,_.transform.customLayerMatrix()),C.setDirty(),_.setBaseState(),C.bindFramebuffer.set(null)}})(i,0,h)}}translatePosMatrix(i,o,h,f,_){if(!h[0]&&!h[1])return i;const M=_?f==="map"?this.transform.angle:0:f==="viewport"?-this.transform.angle:0;if(M){const k=Math.sin(M),F=Math.cos(M);h=[h[0]*F-h[1]*k,h[0]*k+h[1]*F]}const S=[_?h[0]:ti(o,h[0],this.transform.zoom),_?h[1]:ti(o,h[1],this.transform.zoom),0],C=new Float32Array(16);return l.H(C,i,S),C}saveTileTexture(i){const o=this._tileTextures[i.size[0]];o?o.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const o=this._tileTextures[i];return o&&o.length>0?o.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const o=this.imageManager.getPattern(i.from.toString()),h=this.imageManager.getPattern(i.to.toString());return!o||!h}useProgram(i,o){this.cache=this.cache||{};const h=i+(o?o.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[h]||(this.cache[h]=new b(this.context,co[i],o,Cl[i],this._showOverdrawInspector,this.style.map.terrain)),this.cache[h]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new kt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:i,drawingBufferHeight:o}=this.context.gl;return this.width!==i||this.height!==o}}class Le{constructor(i,o){this.points=i,this.planes=o}static fromInvProjectionMatrix(i,o,h){const f=Math.pow(2,h),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const C=1/(S=l.af([],S,i))[3]/o*f;return l.a$(S,S,[C,C,1/S[3],C])}),M=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const C=function(q,te){var Q=te[0],re=te[1],W=te[2],pe=Q*Q+re*re+W*W;return pe>0&&(pe=1/Math.sqrt(pe)),q[0]=te[0]*pe,q[1]=te[1]*pe,q[2]=te[2]*pe,q}([],function(q,te,Q){var re=te[0],W=te[1],pe=te[2],Ie=Q[0],le=Q[1],be=Q[2];return q[0]=W*be-pe*le,q[1]=pe*Ie-re*be,q[2]=re*le-W*Ie,q}([],_t([],_[S[0]],_[S[1]]),_t([],_[S[2]],_[S[1]]))),k=-((F=C)[0]*(B=_[S[1]])[0]+F[1]*B[1]+F[2]*B[2]);var F,B;return C.concat(k)});return new Le(_,M)}}class ft{constructor(i,o){this.min=i,this.max=o,this.center=function(h,f,_){return h[0]=.5*f[0],h[1]=.5*f[1],h[2]=.5*f[2],h}([],function(h,f,_){return h[0]=f[0]+_[0],h[1]=f[1]+_[1],h[2]=f[2]+_[2],h}([],this.min,this.max))}quadrant(i){const o=[i%2==0,i<2],h=Je(this.min),f=Je(this.max);for(let _=0;_<o.length;_++)h[_]=o[_]?this.min[_]:this.center[_],f[_]=o[_]?this.center[_]:this.max[_];return f[2]=this.max[2],new ft(h,f)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}intersects(i){const o=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let h=!0;for(let f=0;f<i.planes.length;f++){const _=i.planes[f];let M=0;for(let S=0;S<o.length;S++)l.b0(_,o[S])>=0&&M++;if(M===0)return 0;M!==o.length&&(h=!1)}if(h)return 2;for(let f=0;f<3;f++){let _=Number.MAX_VALUE,M=-Number.MAX_VALUE;for(let S=0;S<i.points.length;S++){const C=i.points[S][f]-this.min[f];_=Math.min(_,C),M=Math.max(M,C)}if(M<0||_>this.max[f]-this.min[f])return 0}return 1}}class qt{constructor(i=0,o=0,h=0,f=0){if(isNaN(i)||i<0||isNaN(o)||o<0||isNaN(h)||h<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=o,this.left=h,this.right=f}interpolate(i,o,h){return o.top!=null&&i.top!=null&&(this.top=l.z.number(i.top,o.top,h)),o.bottom!=null&&i.bottom!=null&&(this.bottom=l.z.number(i.bottom,o.bottom,h)),o.left!=null&&i.left!=null&&(this.left=l.z.number(i.left,o.left,h)),o.right!=null&&i.right!=null&&(this.right=l.z.number(i.right,o.right,h)),this}getCenter(i,o){const h=l.ac((this.left+i-this.right)/2,0,i),f=l.ac((this.top+o-this.bottom)/2,0,o);return new l.P(h,f)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new qt(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Ji=85.051129;class wi{constructor(i,o,h,f,_){this.tileSize=512,this._renderWorldCopies=_===void 0||!!_,this._minZoom=i||0,this._maxZoom=o||22,this._minPitch=h??0,this._maxPitch=f??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new qt,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const i=new wi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return i.apply(this),i}apply(i){this.tileSize=i.tileSize,this.latRange=i.latRange,this.width=i.width,this.height=i.height,this._center=i._center,this._elevation=i._elevation,this.minElevationForCurrentTile=i.minElevationForCurrentTile,this.zoom=i.zoom,this.angle=i.angle,this._fov=i._fov,this._pitch=i._pitch,this._unmodified=i._unmodified,this._edgeInsets=i._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(i){const o=-l.b1(i,-180,180)*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=function(){var h=new l.A(4);return l.A!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h}(),function(h,f,_){var M=f[0],S=f[1],C=f[2],k=f[3],F=Math.sin(_),B=Math.cos(_);h[0]=M*B+C*F,h[1]=S*B+k*F,h[2]=M*-F+C*B,h[3]=S*-F+k*B}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const o=l.ac(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(i){const o=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._zoom=o,this.tileZoom=Math.max(0,Math.floor(o)),this.scale=this.zoomScale(o),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(i){i!==this._elevation&&(this._elevation=i,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,o,h){this._unmodified=!1,this._edgeInsets.interpolate(i,o,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const o=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(i){const o=[new l.b2(0,i)];if(this._renderWorldCopies){const h=this.pointCoordinate(new l.P(0,0)),f=this.pointCoordinate(new l.P(this.width,0)),_=this.pointCoordinate(new l.P(this.width,this.height)),M=this.pointCoordinate(new l.P(0,this.height)),S=Math.floor(Math.min(h.x,f.x,_.x,M.x)),C=Math.floor(Math.max(h.x,f.x,_.x,M.x)),k=1;for(let F=S-k;F<=C+k;F++)F!==0&&o.push(new l.b2(F,i))}return o}coveringTiles(i){var o,h;let f=this.coveringZoomLevel(i);const _=f;if(i.minzoom!==void 0&&f<i.minzoom)return[];i.maxzoom!==void 0&&f>i.maxzoom&&(f=i.maxzoom);const M=this.pointCoordinate(this.getCameraPoint()),S=l.Y.fromLngLat(this.center),C=Math.pow(2,f),k=[C*M.x,C*M.y,0],F=[C*S.x,C*S.y,0],B=Le.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f);let q=i.minzoom||0;!i.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(q=f);const te=i.terrain?2/Math.min(this.tileSize,i.tileSize)*this.tileSize:3,Q=le=>({aabb:new ft([le*C,0,0],[(le+1)*C,C,0]),zoom:0,x:0,y:0,wrap:le,fullyVisible:!1}),re=[],W=[],pe=f,Ie=i.reparseOverscaled?_:f;if(this._renderWorldCopies)for(let le=1;le<=3;le++)re.push(Q(-le)),re.push(Q(le));for(re.push(Q(0));re.length>0;){const le=re.pop(),be=le.x,Ae=le.y;let ke=le.fullyVisible;if(!ke){const ct=le.aabb.intersects(B);if(ct===0)continue;ke=ct===2}const ze=i.terrain?k:F,We=le.aabb.distanceX(ze),He=le.aabb.distanceY(ze),st=Math.max(Math.abs(We),Math.abs(He));if(le.zoom===pe||st>te+(1<<pe-le.zoom)-2&&le.zoom>=q){const ct=pe-le.zoom,ci=k[0]-.5-(be<<ct),mt=k[1]-.5-(Ae<<ct);W.push({tileID:new l.Q(le.zoom===pe?Ie:le.zoom,le.wrap,le.zoom,be,Ae),distanceSq:xt([F[0]-.5-be,F[1]-.5-Ae]),tileDistanceToCamera:Math.sqrt(ci*ci+mt*mt)})}else for(let ct=0;ct<4;ct++){const ci=(be<<1)+ct%2,mt=(Ae<<1)+(ct>>1),Yt=le.zoom+1;let ui=le.aabb.quadrant(ct);if(i.terrain){const Pi=new l.Q(Yt,le.wrap,Yt,ci,mt),ii=i.terrain.getMinMaxElevation(Pi),di=(o=ii.minElevation)!==null&&o!==void 0?o:this.elevation,yi=(h=ii.maxElevation)!==null&&h!==void 0?h:this.elevation;ui=new ft([ui.min[0],ui.min[1],di],[ui.max[0],ui.max[1],yi])}re.push({aabb:ui,zoom:Yt,x:ci,y:mt,wrap:le.wrap,fullyVisible:ke})}}return W.sort((le,be)=>le.distanceSq-be.distanceSq).map(le=>le.tileID)}resize(i,o){this.width=i,this.height=o,this.pixelsToGLUnits=[2/i,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const o=l.ac(i.lat,-85.051129,Ji);return new l.P(l.N(i.lng)*this.worldSize,l.O(o)*this.worldSize)}unproject(i){return new l.Y(i.x/this.worldSize,i.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(i){const o=this.elevation,h=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,f=this.pointLocation(this.centerPoint,i),_=i.getElevationForLngLatZoom(f,this.tileZoom);if(!(this.elevation-_))return;const M=h+o-_,S=Math.cos(this._pitch)*this.cameraToCenterDistance/M/l.b3(1,f.lat),C=this.scaleZoom(S/this.tileSize);this._elevation=_,this._center=f,this.zoom=C}setLocationAtPoint(i,o){const h=this.pointCoordinate(o),f=this.pointCoordinate(this.centerPoint),_=this.locationCoordinate(i),M=new l.Y(_.x-(h.x-f.x),_.y-(h.y-f.y));this.center=this.coordinateLocation(M),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(i,o){return o?this.coordinatePoint(this.locationCoordinate(i),o.getElevationForLngLatZoom(i,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(i))}pointLocation(i,o){return this.coordinateLocation(this.pointCoordinate(i,o))}locationCoordinate(i){return l.Y.fromLngLat(i)}coordinateLocation(i){return i&&i.toLngLat()}pointCoordinate(i,o){if(o){const q=o.pointCoordinate(i);if(q!=null)return q}const h=[i.x,i.y,0,1],f=[i.x,i.y,1,1];l.af(h,h,this.pixelMatrixInverse),l.af(f,f,this.pixelMatrixInverse);const _=h[3],M=f[3],S=h[1]/_,C=f[1]/M,k=h[2]/_,F=f[2]/M,B=k===F?0:(0-k)/(F-k);return new l.Y(l.z.number(h[0]/_,f[0]/M,B)/this.worldSize,l.z.number(S,C,B)/this.worldSize)}coordinatePoint(i,o=0,h=this.pixelMatrix){const f=[i.x*this.worldSize,i.y*this.worldSize,o,1];return l.af(f,f,h),new l.P(f[0]/f[3],f[1]/f[3])}getBounds(){const i=Math.max(0,this.height/2-this.getHorizon());return new ue().extend(this.pointLocation(new l.P(0,i))).extend(this.pointLocation(new l.P(this.width,i))).extend(this.pointLocation(new l.P(this.width,this.height))).extend(this.pointLocation(new l.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new ue([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(i){i?(this.lngRange=[i.getWest(),i.getEast()],this.latRange=[i.getSouth(),i.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Ji])}calculatePosMatrix(i,o=!1){const h=i.key,f=o?this._alignedPosMatrixCache:this._posMatrixCache;if(f[h])return f[h];const _=i.canonical,M=this.worldSize/this.zoomScale(_.z),S=_.x+Math.pow(2,_.z)*i.wrap,C=l.an(new Float64Array(16));return l.H(C,C,[S*M,_.y*M,0]),l.J(C,C,[M/l.W,M/l.W,1]),l.K(C,o?this.alignedProjMatrix:this.projMatrix,C),f[h]=new Float32Array(C),f[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(i,o){o=l.ac(+o,this.minZoom,this.maxZoom);const h={center:new l.M(i.lng,i.lat),zoom:o};let f=this.lngRange;if(!this._renderWorldCopies&&f===null){const le=179.9999999999;f=[-le,le]}const _=this.tileSize*this.zoomScale(h.zoom);let M=0,S=_,C=0,k=_,F=0,B=0;const{x:q,y:te}=this.size;if(this.latRange){const le=this.latRange;M=l.O(le[1])*_,S=l.O(le[0])*_,S-M<te&&(F=te/(S-M))}f&&(C=l.b1(l.N(f[0])*_,0,_),k=l.b1(l.N(f[1])*_,0,_),k<C&&(k+=_),k-C<q&&(B=q/(k-C)));const{x:Q,y:re}=this.project.call({worldSize:_},i);let W,pe;const Ie=Math.max(B||0,F||0);if(Ie){const le=new l.P(B?(k+C)/2:Q,F?(S+M)/2:re);return h.center=this.unproject.call({worldSize:_},le).wrap(),h.zoom+=this.scaleZoom(Ie),h}if(this.latRange){const le=te/2;re-le<M&&(pe=M+le),re+le>S&&(pe=S-le)}if(f){const le=(C+k)/2;let be=Q;this._renderWorldCopies&&(be=l.b1(Q,le-_/2,le+_/2));const Ae=q/2;be-Ae<C&&(W=C+Ae),be+Ae>k&&(W=k-Ae)}if(W!==void 0||pe!==void 0){const le=new l.P(W??Q,pe??re);h.center=this.unproject.call({worldSize:_},le).wrap()}return h}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this._unmodified,{center:o,zoom:h}=this.getConstrained(this.center,this.zoom);this.center=o,this.zoom=h,this._unmodified=i,this._constraining=!1}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,o=this.point.x,h=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.b3(1,this.center.lat)*this.worldSize;let f=l.an(new Float64Array(16));l.J(f,f,[this.width/2,-this.height/2,1]),l.H(f,f,[1,-1,0]),this.labelPlaneMatrix=f,f=l.an(new Float64Array(16)),l.J(f,f,[1,-1,1]),l.H(f,f,[-1,-1,0]),l.J(f,f,[2/this.width,2/this.height,1]),this.glCoordMatrix=f;const _=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),M=Math.min(this.elevation,this.minElevationForCurrentTile),S=_-M*this._pixelPerMeter/Math.cos(this._pitch),C=M<0?S:_,k=Math.PI/2+this._pitch,F=this._fov*(.5+i.y/this.height),B=Math.sin(F)*C/Math.sin(l.ac(Math.PI-k-F,.01,Math.PI-.01)),q=this.getHorizon(),te=2*Math.atan(q/this.cameraToCenterDistance)*(.5+i.y/(2*q)),Q=Math.sin(te)*C/Math.sin(l.ac(Math.PI-k-te,.01,Math.PI-.01)),re=Math.min(B,Q),W=1.01*(Math.cos(Math.PI/2-this._pitch)*re+C),pe=this.height/50;f=new Float64Array(16),l.b4(f,this._fov,this.width/this.height,pe,W),f[8]=2*-i.x/this.width,f[9]=2*i.y/this.height,l.J(f,f,[1,-1,1]),l.H(f,f,[0,0,-this.cameraToCenterDistance]),l.b5(f,f,this._pitch),l.ad(f,f,this.angle),l.H(f,f,[-o,-h,0]),this.mercatorMatrix=l.J([],f,[this.worldSize,this.worldSize,this.worldSize]),l.J(f,f,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.K(new Float64Array(16),this.labelPlaneMatrix,f),l.H(f,f,[0,0,-this.elevation]),this.projMatrix=f,this.invProjMatrix=l.ar([],f),this.pixelMatrix3D=l.K(new Float64Array(16),this.labelPlaneMatrix,f);const Ie=this.width%2/2,le=this.height%2/2,be=Math.cos(this.angle),Ae=Math.sin(this.angle),ke=o-Math.round(o)+be*Ie+Ae*le,ze=h-Math.round(h)+be*le+Ae*Ie,We=new Float64Array(f);if(l.H(We,We,[ke>.5?ke-1:ke,ze>.5?ze-1:ze,0]),this.alignedProjMatrix=We,f=l.ar(new Float64Array(16),this.pixelMatrix),!f)throw new Error("failed to invert matrix");this.pixelMatrixInverse=f,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const i=this.pointCoordinate(new l.P(0,0)),o=[i.x*this.worldSize,i.y*this.worldSize,0,1];return l.af(o,o,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(0,i))}getCameraQueryGeometry(i){const o=this.getCameraPoint();if(i.length===1)return[i[0],o];{let h=o.x,f=o.y,_=o.x,M=o.y;for(const S of i)h=Math.min(h,S.x),f=Math.min(f,S.y),_=Math.max(_,S.x),M=Math.max(M,S.y);return[new l.P(h,f),new l.P(_,f),new l.P(_,M),new l.P(h,M),new l.P(h,f)]}}lngLatToCameraDepth(i,o){const h=this.locationCoordinate(i),f=[h.x*this.worldSize,h.y*this.worldSize,o,1];return l.af(f,f,this.projMatrix),f[2]/f[3]}}function dr(g,i){let o,h=!1,f=null,_=null;const M=()=>{f=null,h&&(g.apply(_,o),f=setTimeout(M,i),h=!1)};return(...S)=>(h=!0,_=this,o=S,f||M(),f)}class Er{constructor(i){this._getCurrentHash=()=>{const o=window.location.hash.replace("#","");if(this._hashName){let h;return o.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(h=f)}),(h&&h[1]||"").split("/")}return o.split("/")},this._onHashChange=()=>{const o=this._getCurrentHash();if(o.length>=3&&!o.some(h=>isNaN(h))){const h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:h,pitch:+(o[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const o=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,o)}catch{}},this._updateHash=dr(this._updateHashUnthrottled,300),this._hashName=i&&encodeURIComponent(i)}addTo(i){return this._map=i,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(i){const o=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,f=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,f),M=Math.round(o.lng*_)/_,S=Math.round(o.lat*_)/_,C=this._map.getBearing(),k=this._map.getPitch();let F="";if(F+=i?`/${M}/${S}/${h}`:`${h}/${S}/${M}`,(C||k)&&(F+="/"+Math.round(10*C)/10),k&&(F+=`/${Math.round(k)}`),this._hashName){const B=this._hashName;let q=!1;const te=window.location.hash.slice(1).split("&").map(Q=>{const re=Q.split("=")[0];return re===B?(q=!0,`${re}=${F}`):Q}).filter(Q=>Q);return q||te.push(`${B}=${F}`),`#${te.join("&")}`}return`#${F}`}}const wn={linearity:.3,easing:l.b6(0,0,.3,1)},rr=l.e({deceleration:2500,maxSpeed:1400},wn),Fr=l.e({deceleration:20,maxSpeed:1400},wn),ns=l.e({deceleration:1e3,maxSpeed:360},wn),xs=l.e({deceleration:1e3,maxSpeed:90},wn);class fn{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:D.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,o=D.now();for(;i.length>0&&o-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const o={zoom:0,bearing:0,pitch:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)o.zoom+=_.zoomDelta||0,o.bearing+=_.bearingDelta||0,o.pitch+=_.pitchDelta||0,_.panDelta&&o.pan._add(_.panDelta),_.around&&(o.around=_.around),_.pinchAround&&(o.pinchAround=_.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,f={};if(o.pan.mag()){const _=bs(o.pan.mag(),h,l.e({},rr,i||{}));f.offset=o.pan.mult(_.amount/o.pan.mag()),f.center=this._map.transform.center,Rn(f,_)}if(o.zoom){const _=bs(o.zoom,h,Fr);f.zoom=this._map.transform.zoom+_.amount,Rn(f,_)}if(o.bearing){const _=bs(o.bearing,h,ns);f.bearing=this._map.transform.bearing+l.ac(_.amount,-179,179),Rn(f,_)}if(o.pitch){const _=bs(o.pitch,h,xs);f.pitch=this._map.transform.pitch+_.amount,Rn(f,_)}if(f.zoom||f.bearing){const _=o.pinchAround===void 0?o.around:o.pinchAround;f.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),l.e(f,{noMoveStart:!0})}}function Rn(g,i){(!g.duration||g.duration<i.duration)&&(g.duration=i.duration,g.easing=i.easing)}function bs(g,i,o){const{maxSpeed:h,linearity:f,deceleration:_}=o,M=l.ac(g*f/(i/1e3),-h,h),S=Math.abs(M)/(_*f);return{easing:o.easing,duration:1e3*S,amount:M*(S/2)}}class Qr extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,h,f={}){const _=z.mousePos(o.getCanvas(),h),M=o.unproject(_);super(i,l.e({point:_,lngLat:M,originalEvent:h},f)),this._defaultPrevented=!1,this.target=o}}class Mn extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,h){const f=i==="touchend"?h.changedTouches:h.touches,_=z.touchPos(o.getCanvasContainer(),f),M=_.map(C=>o.unproject(C)),S=_.reduce((C,k,F,B)=>C.add(k.div(B.length)),new l.P(0,0));super(i,{points:_,point:S,lngLats:M,lngLat:o.unproject(S),originalEvent:h}),this._defaultPrevented=!1}}class _a extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,h){super(i,{originalEvent:h}),this._defaultPrevented=!1}}class Hn{constructor(i,o){this._map=i,this._clickTolerance=o.clickTolerance}reset(){delete this._mousedownPos}wheel(i){return this._firePreventable(new _a(i.type,this._map,i))}mousedown(i,o){return this._mousedownPos=o,this._firePreventable(new Qr(i.type,this._map,i))}mouseup(i){this._map.fire(new Qr(i.type,this._map,i))}click(i,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||this._map.fire(new Qr(i.type,this._map,i))}dblclick(i){return this._firePreventable(new Qr(i.type,this._map,i))}mouseover(i){this._map.fire(new Qr(i.type,this._map,i))}mouseout(i){this._map.fire(new Qr(i.type,this._map,i))}touchstart(i){return this._firePreventable(new Mn(i.type,this._map,i))}touchmove(i){this._map.fire(new Mn(i.type,this._map,i))}touchend(i){this._map.fire(new Mn(i.type,this._map,i))}touchcancel(i){this._map.fire(new Mn(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ws{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(i){this._map.fire(new Qr(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Qr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._ignoreContextMenu||this._map.fire(new Qr(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class $a{constructor(i){this._map=i}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(i){return this.transform.pointLocation(l.P.convert(i),this._map.terrain)}}class Ei{constructor(i,o){this._map=i,this._tr=new $a(i),this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,o){this.isEnabled()&&i.shiftKey&&i.button===0&&(z.disableDrag(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(i,o){if(!this._active)return;const h=o;if(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)return;const f=this._startPos;this._lastPos=h,this._box||(this._box=z.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",i));const _=Math.min(f.x,h.x),M=Math.max(f.x,h.x),S=Math.min(f.y,h.y),C=Math.max(f.y,h.y);z.setTransform(this._box,`translate(${_}px,${S}px)`),this._box.style.width=M-_+"px",this._box.style.height=C-S+"px"}mouseupWindow(i,o){if(!this._active||i.button!==0)return;const h=this._startPos,f=o;if(this.reset(),z.suppressClick(),h.x!==f.x||h.y!==f.y)return this._map.fire(new l.k("boxzoomend",{originalEvent:i})),{cameraAnimation:_=>_.fitScreenCoordinates(h,f,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",i)}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(z.remove(this._box),this._box=null),z.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(i,o){return this._map.fire(new l.k(i,{originalEvent:o}))}}function Di(g,i){if(g.length!==i.length)throw new Error(`The number of touches and points are not equal - touches ${g.length}, points ${i.length}`);const o={};for(let h=0;h<g.length;h++)o[g[h].identifier]=i[h];return o}class el{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(i,o,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),h.length===this.numTouches&&(this.centroid=function(f){const _=new l.P(0,0);for(const M of f)_._add(M);return _.div(f.length)}(o),this.touches=Di(h,o)))}touchmove(i,o,h){if(this.aborted||!this.centroid)return;const f=Di(h,o);for(const _ in this.touches){const M=f[_];(!M||M.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(i,o,h){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const f=!this.aborted&&this.centroid;if(this.reset(),f)return f}}}class Ms{constructor(i){this.singleTap=new el(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(i,o,h){this.singleTap.touchstart(i,o,h)}touchmove(i,o,h){this.singleTap.touchmove(i,o,h)}touchend(i,o,h){const f=this.singleTap.touchend(i,o,h);if(f){const _=i.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(f)<30;if(_&&M||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class Nl{constructor(i){this._tr=new $a(i),this._zoomIn=new Ms({numTouches:1,numTaps:2}),this._zoomOut=new Ms({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,o,h){this._zoomIn.touchstart(i,o,h),this._zoomOut.touchstart(i,o,h)}touchmove(i,o,h){this._zoomIn.touchmove(i,o,h),this._zoomOut.touchmove(i,o,h)}touchend(i,o,h){const f=this._zoomIn.touchend(i,o,h),_=this._zoomOut.touchend(i,o,h),M=this._tr;return f?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:M.zoom+1,around:M.unproject(f)},{originalEvent:i})}):_?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:M.zoom-1,around:M.unproject(_)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class en{constructor(i){this._enabled=!!i.enable,this._moveStateManager=i.moveStateManager,this._clickTolerance=i.clickTolerance||1,this._moveFunction=i.move,this._activateOnStart=!!i.activateOnStart,i.assignEvents(this),this.reset()}reset(i){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(i)}_move(...i){const o=this._moveFunction(...i);if(o.bearingDelta||o.pitchDelta||o.around||o.panDelta)return this._active=!0,o}dragStart(i,o){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(i)&&(this._moveStateManager.startMove(i),this._lastPoint=o.length?o[0]:o,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(i,o){if(!this.isEnabled())return;const h=this._lastPoint;if(!h)return;if(i.preventDefault(),!this._moveStateManager.isValidMoveEvent(i))return void this.reset(i);const f=o.length?o[0]:o;return!this._moved&&f.dist(h)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=f,this._move(h,f))}dragEnd(i){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(i)&&(this._moved&&z.suppressClick(),this.reset(i))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const zn={0:1,2:2};class tn{constructor(i){this._correctEvent=i.checkCorrectEvent}startMove(i){const o=z.mouseButton(i);this._eventButton=o}endMove(i){delete this._eventButton}isValidStartEvent(i){return this._correctEvent(i)}isValidMoveEvent(i){return!function(o,h){const f=zn[h];return o.buttons===void 0||(o.buttons&f)!==f}(i,this._eventButton)}isValidEndEvent(i){return z.mouseButton(i)===this._eventButton}}class Et{constructor(){this._firstTouch=void 0}_isOneFingerTouch(i){return i.targetTouches.length===1}_isSameTouchEvent(i){return i.targetTouches[0].identifier===this._firstTouch}startMove(i){this._firstTouch=i.targetTouches[0].identifier}endMove(i){delete this._firstTouch}isValidStartEvent(i){return this._isOneFingerTouch(i)}isValidMoveEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}isValidEndEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}}const va=g=>{g.mousedown=g.dragStart,g.mousemoveWindow=g.dragMove,g.mouseup=g.dragEnd,g.contextmenu=function(i){i.preventDefault()}},ss=({enable:g,clickTolerance:i,bearingDegreesPerPixelMoved:o=.8})=>{const h=new tn({checkCorrectEvent:f=>z.mouseButton(f)===0&&f.ctrlKey||z.mouseButton(f)===2});return new en({clickTolerance:i,move:(f,_)=>({bearingDelta:(_.x-f.x)*o}),moveStateManager:h,enable:g,assignEvents:va})},Zn=({enable:g,clickTolerance:i,pitchDegreesPerPixelMoved:o=-.5})=>{const h=new tn({checkCorrectEvent:f=>z.mouseButton(f)===0&&f.ctrlKey||z.mouseButton(f)===2});return new en({clickTolerance:i,move:(f,_)=>({pitchDelta:(_.y-f.y)*o}),moveStateManager:h,enable:g,assignEvents:va})};class $l{constructor(i,o){this._clickTolerance=i.clickTolerance||1,this._map=o,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(i,o,h){return this._calculateTransform(i,o,h)}touchmove(i,o,h){if(this._active&&!(h.length<this.minTouchs()))return i.preventDefault(),this._calculateTransform(i,o,h)}touchend(i,o,h){this._calculateTransform(i,o,h),this._active&&h.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,o,h){h.length>0&&(this._active=!0);const f=Di(h,o),_=new l.P(0,0),M=new l.P(0,0);let S=0;for(const k in f){const F=f[k],B=this._touches[k];B&&(_._add(F),M._add(F.sub(B)),S++,f[k]=F)}if(this._touches=f,S<this.minTouchs()||!M.mag())return;const C=M.div(S);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(S),panDelta:C}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yt{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(i,o,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([o[0],o[1]]))}touchmove(i,o,h){if(!this._firstTwoTouches)return;i.preventDefault();const[f,_]=this._firstTwoTouches,M=ea(h,o,f),S=ea(h,o,_);if(!M||!S)return;const C=this._aroundCenter?null:M.add(S).div(2);return this._move([M,S],C,i)}touchend(i,o,h){if(!this._firstTwoTouches)return;const[f,_]=this._firstTwoTouches,M=ea(h,o,f),S=ea(h,o,_);M&&S||(this._active&&z.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ea(g,i,o){for(let h=0;h<g.length;h++)if(g[h].identifier===o)return i[h]}function po(g,i){return Math.log(g/i)/Math.LN2}class mo extends yt{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,o){const h=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(po(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:po(this._distance,h),pinchAround:o}}}function go(g,i){return 180*g.angleWith(i)/Math.PI}class Ua extends yt{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,o,h){const f=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:go(this._vector,f),pinchAround:o}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const o=25/(Math.PI*this._minDiameter)*360,h=go(i,this._startVector);return Math.abs(h)<o}}function xa(g){return Math.abs(g.y)>Math.abs(g.x)}class Xh extends yt{constructor(i){super(),this._currentTouchCount=0,this._map=i}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(i,o,h){super.touchstart(i,o,h),this._currentTouchCount=h.length}_start(i){this._lastPoints=i,xa(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,o,h){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const f=i[0].sub(this._lastPoints[0]),_=i[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(f,_,h.timeStamp),this._valid?(this._lastPoints=i,this._active=!0,{pitchDelta:(f.y+_.y)/2*-.5}):void 0}gestureBeginsVertically(i,o,h){if(this._valid!==void 0)return this._valid;const f=i.mag()>=2,_=o.mag()>=2;if(!f&&!_)return;if(!f||!_)return this._firstMove===void 0&&(this._firstMove=h),h-this._firstMove<100&&void 0;const M=i.y>0==o.y>0;return xa(i)&&xa(o)&&M}}const Nf={panStep:100,bearingStep:15,pitchStep:10};class Va{constructor(i){this._tr=new $a(i);const o=Nf;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let o=0,h=0,f=0,_=0,M=0;switch(i.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:i.shiftKey?h=-1:(i.preventDefault(),_=-1);break;case 39:i.shiftKey?h=1:(i.preventDefault(),_=1);break;case 38:i.shiftKey?f=1:(i.preventDefault(),M=-1);break;case 40:i.shiftKey?f=-1:(i.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(h=0,f=0),{cameraAnimation:S=>{const C=this._tr;S.easeTo({duration:300,easeId:"keyboardHandler",easing:gr,zoom:o?Math.round(C.zoom)+o*(i.shiftKey?2:1):C.zoom,bearing:C.bearing+h*this._bearingStep,pitch:C.pitch+f*this._pitchStep,offset:[-_*this._panStep,-M*this._panStep],center:C.center},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function gr(g){return g*(2-g)}const Ul=4.000244140625;class bc{constructor(i,o){this._onTimeout=h=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(h)},this._map=i,this._tr=new $a(i),this._triggerRenderFrame=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(i){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!i[this._map.cooperativeGestures._bypassKey])return;let o=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const h=D.now(),f=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,o!==0&&o%Ul==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(f*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),i.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=i,this._delta-=o,this._active||this._start(i)),i.preventDefault()}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=z.mousePos(this._map.getCanvas(),i),h=this._tr;this._around=o.y>h.transform.height/2-h.transform.getHorizon()?l.M.convert(this._aroundCenter?h.center:h.unproject(o)):l.M.convert(h.center),this._aroundPoint=h.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._tr.transform;if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>Ul?this._wheelZoomRate:this._defaultZoomRate;let C=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&C!==0&&(C=1/C);const k=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):i.scale;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(k*C))),this._type==="wheel"&&(this._startZoom=i.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const o=typeof this._targetZoom=="number"?this._targetZoom:i.zoom,h=this._startZoom,f=this._easing;let _,M=!1;if(this._type==="wheel"&&h&&f){const S=Math.min((D.now()-this._lastWheelEventTime)/200,1),C=f(S);_=l.z.number(h,o,C),S<1?this._frameId||(this._frameId=!0):M=!0}else _=o,M=!0;return this._active=!0,M&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!M,zoomDelta:_-i.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let o=l.b7;if(this._prevEase){const h=this._prevEase,f=(D.now()-h.start)/h.duration,_=h.easing(f+.01)-h.easing(f),M=.27/Math.sqrt(_*_+1e-4)*.01,S=Math.sqrt(.0729-M*M);o=l.b6(M,S,.25,1)}return this._prevEase={start:D.now(),duration:i,easing:o},o}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class xu{constructor(i,o){this._clickZoom=i,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Kh{constructor(i){this._tr=new $a(i),this.reset()}reset(){this._active=!1}dblclick(i,o){return i.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:this._tr.zoom+(i.shiftKey?-1:1),around:this._tr.unproject(o)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yh{constructor(){this._tap=new Ms({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(i,o,h){if(!this._swipePoint)if(this._tapTime){const f=o[0],_=i.timeStamp-this._tapTime<500,M=this._tapPoint.dist(f)<30;_&&M?h.length>0&&(this._swipePoint=f,this._swipeTouch=h[0].identifier):this.reset()}else this._tap.touchstart(i,o,h)}touchmove(i,o,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const f=o[0],_=f.y-this._swipePoint.y;return this._swipePoint=f,i.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(i,o,h)}touchend(i,o,h){if(this._tapTime)this._swipePoint&&h.length===0&&this.reset();else{const f=this._tap.touchend(i,o,h);f&&(this._tapTime=i.timeStamp,this._tapPoint=f)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jh{constructor(i,o,h){this._el=i,this._mousePan=o,this._touchPan=h}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ns{constructor(i,o,h){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=o,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Vl{constructor(i,o,h,f){this._el=i,this._touchZoom=o,this._touchRotate=h,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class $t{constructor(i,o){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=i,this._options=o,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const i=this._map.getCanvasContainer();i.classList.add("maplibregl-cooperative-gestures"),this._container=z.create("div","maplibregl-cooperative-gesture-screen",i);let o=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(o=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const h=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),f=document.createElement("div");f.className="maplibregl-desktop-message",f.textContent=o,this._container.appendChild(f);const _=document.createElement("div");_.className="maplibregl-mobile-message",_.textContent=h,this._container.appendChild(_),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(z.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(i){this._onCooperativeGesture(i.touches.length===1)}wheel(i){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!i[this._bypassKey])}_onCooperativeGesture(i){this._enabled&&i&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Kt=g=>g.zoom||g.drag||g.pitch||g.rotate;class wc extends l.k{}function jl(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class bu{constructor(i,o){this.handleWindowEvent=f=>{this.handleEvent(f,`${f.type}Window`)},this.handleEvent=(f,_)=>{if(f.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const M=f.type==="renderFrame"?void 0:f,S={needsRenderFrame:!1},C={},k={},F=f.touches,B=F?this._getMapTouches(F):void 0,q=B?z.touchPos(this._map.getCanvas(),B):z.mousePos(this._map.getCanvas(),f);for(const{handlerName:re,handler:W,allowed:pe}of this._handlers){if(!W.isEnabled())continue;let Ie;this._blockedByActive(k,pe,re)?W.reset():W[_||f.type]&&(Ie=W[_||f.type](f,q,B),this.mergeHandlerResult(S,C,Ie,re,M),Ie&&Ie.needsRenderFrame&&this._triggerRenderFrame()),(Ie||W.isActive())&&(k[re]=W)}const te={};for(const re in this._previousActiveHandlers)k[re]||(te[re]=M);this._previousActiveHandlers=k,(Object.keys(te).length||jl(S))&&(this._changes.push([S,C,te]),this._triggerRenderFrame()),(Object.keys(k).length||jl(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Q}=S;Q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Q(this._map))},this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new fn(i),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(o);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[window,"blur",void 0]];for(const[f,_,M]of this._listeners)z.addEventListener(f,_,f===document?this.handleWindowEvent:this.handleEvent,M)}destroy(){for(const[i,o,h]of this._listeners)z.removeEventListener(i,o,i===document?this.handleWindowEvent:this.handleEvent,h)}_addDefaultHandlers(i){const o=this._map,h=o.getCanvasContainer();this._add("mapEvent",new Hn(o,i));const f=o.boxZoom=new Ei(o,i);this._add("boxZoom",f),i.interactive&&i.boxZoom&&f.enable();const _=o.cooperativeGestures=new $t(o,i.cooperativeGestures);this._add("cooperativeGestures",_),i.cooperativeGestures&&_.enable();const M=new Nl(o),S=new Kh(o);o.doubleClickZoom=new xu(S,M),this._add("tapZoom",M),this._add("clickZoom",S),i.interactive&&i.doubleClickZoom&&o.doubleClickZoom.enable();const C=new Yh;this._add("tapDragZoom",C);const k=o.touchPitch=new Xh(o);this._add("touchPitch",k),i.interactive&&i.touchPitch&&o.touchPitch.enable(i.touchPitch);const F=ss(i),B=Zn(i);o.dragRotate=new Ns(i,F,B),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",B,["mouseRotate"]),i.interactive&&i.dragRotate&&o.dragRotate.enable();const q=(({enable:Ie,clickTolerance:le})=>{const be=new tn({checkCorrectEvent:Ae=>z.mouseButton(Ae)===0&&!Ae.ctrlKey});return new en({clickTolerance:le,move:(Ae,ke)=>({around:ke,panDelta:ke.sub(Ae)}),activateOnStart:!0,moveStateManager:be,enable:Ie,assignEvents:va})})(i),te=new $l(i,o);o.dragPan=new Jh(h,q,te),this._add("mousePan",q),this._add("touchPan",te,["touchZoom","touchRotate"]),i.interactive&&i.dragPan&&o.dragPan.enable(i.dragPan);const Q=new Ua,re=new mo;o.touchZoomRotate=new Vl(h,re,Q,C),this._add("touchRotate",Q,["touchPan","touchZoom"]),this._add("touchZoom",re,["touchPan","touchRotate"]),i.interactive&&i.touchZoomRotate&&o.touchZoomRotate.enable(i.touchZoomRotate);const W=o.scrollZoom=new bc(o,()=>this._triggerRenderFrame());this._add("scrollZoom",W,["mousePan"]),i.interactive&&i.scrollZoom&&o.scrollZoom.enable(i.scrollZoom);const pe=o.keyboard=new Va(o);this._add("keyboard",pe),i.interactive&&i.keyboard&&o.keyboard.enable(),this._add("blockableMapEvent",new ws(o))}_add(i,o,h){this._handlers.push({handlerName:i,handler:o,allowed:h}),this._handlersById[i]=o}stop(i){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Kt(this._eventsInProgress)||this.isZooming()}_blockedByActive(i,o,h){for(const f in i)if(f!==h&&(!o||o.indexOf(f)<0))return!0;return!1}_getMapTouches(i){const o=[];for(const h of i)this._el.contains(h.target)&&o.push(h);return o}mergeHandlerResult(i,o,h,f,_){if(!h)return;l.e(i,h);const M={handlerName:f,originalEvent:h.originalEvent||_};h.zoomDelta!==void 0&&(o.zoom=M),h.panDelta!==void 0&&(o.drag=M),h.pitchDelta!==void 0&&(o.pitch=M),h.bearingDelta!==void 0&&(o.rotate=M)}_applyChanges(){const i={},o={},h={};for(const[f,_,M]of this._changes)f.panDelta&&(i.panDelta=(i.panDelta||new l.P(0,0))._add(f.panDelta)),f.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+f.zoomDelta),f.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+f.bearingDelta),f.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+f.pitchDelta),f.around!==void 0&&(i.around=f.around),f.pinchAround!==void 0&&(i.pinchAround=f.pinchAround),f.noInertia&&(i.noInertia=f.noInertia),l.e(o,_),l.e(h,M);this._updateMapTransform(i,o,h),this._changes=[]}_updateMapTransform(i,o,h){const f=this._map,_=f._getTransformForUpdate(),M=f.terrain;if(!(jl(i)||M&&this._terrainMovement))return this._fireEvents(o,h,!0);let{panDelta:S,zoomDelta:C,bearingDelta:k,pitchDelta:F,around:B,pinchAround:q}=i;q!==void 0&&(B=q),f._stop(!0),B=B||f.transform.centerPoint;const te=_.pointLocation(S?B.sub(S):B);k&&(_.bearing+=k),F&&(_.pitch+=F),C&&(_.zoom+=C),M?this._terrainMovement||!o.drag&&!o.zoom?o.drag&&this._terrainMovement?_.center=_.pointLocation(_.centerPoint.sub(S)):_.setLocationAtPoint(te,B):(this._terrainMovement=!0,this._map._elevationFreeze=!0,_.setLocationAtPoint(te,B),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,_.recalculateZoom(f.terrain)})):_.setLocationAtPoint(te,B),f._applyUpdatedTransform(_),this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(o,h,!0)}_fireEvents(i,o,h){const f=Kt(this._eventsInProgress),_=Kt(i),M={};for(const F in i){const{originalEvent:B}=i[F];this._eventsInProgress[F]||(M[`${F}start`]=B),this._eventsInProgress[F]=i[F]}!f&&_&&this._fireEvent("movestart",_.originalEvent);for(const F in M)this._fireEvent(F,M[F]);_&&this._fireEvent("move",_.originalEvent);for(const F in i){const{originalEvent:B}=i[F];this._fireEvent(F,B)}const S={};let C;for(const F in this._eventsInProgress){const{handlerName:B,originalEvent:q}=this._eventsInProgress[F];this._handlersById[B].isActive()||(delete this._eventsInProgress[F],C=o[B]||q,S[`${F}end`]=C)}for(const F in S)this._fireEvent(F,S[F]);const k=Kt(this._eventsInProgress);if(h&&(f||_)&&!k){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=q=>q!==0&&-this._bearingSnap<q&&q<this._bearingSnap;!F||!F.essential&&D.prefersReducedMotion?(this._map.fire(new l.k("moveend",{originalEvent:C})),B(this._map.getBearing())&&this._map.resetNorth()):(B(F.bearing||this._map.getBearing())&&(F.bearing=0),F.freezeElevation=!0,this._map.easeTo(F,{originalEvent:C})),this._updatingCamera=!1}}_fireEvent(i,o){this._map.fire(new l.k(i,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{delete this._frameId,this.handleEvent(new wc("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Wn extends l.E{constructor(i,o){super(),this._renderFrameCallback=()=>{const h=Math.min((D.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=o.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new l.M(this.transform.center.lng,this.transform.center.lat)}setCenter(i,o){return this.jumpTo({center:i},o)}panBy(i,o,h){return i=l.P.convert(i).mult(-1),this.panTo(this.transform.center,l.e({offset:i},o),h)}panTo(i,o,h){return this.easeTo(l.e({center:i},o),h)}getZoom(){return this.transform.zoom}setZoom(i,o){return this.jumpTo({zoom:i},o),this}zoomTo(i,o,h){return this.easeTo(l.e({zoom:i},o),h)}zoomIn(i,o){return this.zoomTo(this.getZoom()+1,i,o),this}zoomOut(i,o){return this.zoomTo(this.getZoom()-1,i,o),this}getBearing(){return this.transform.bearing}setBearing(i,o){return this.jumpTo({bearing:i},o),this}getPadding(){return this.transform.padding}setPadding(i,o){return this.jumpTo({padding:i},o),this}rotateTo(i,o,h){return this.easeTo(l.e({bearing:i},o),h)}resetNorth(i,o){return this.rotateTo(0,l.e({duration:1e3},i),o),this}resetNorthPitch(i,o){return this.easeTo(l.e({bearing:0,pitch:0,duration:1e3},i),o),this}snapToNorth(i,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,o):this}getPitch(){return this.transform.pitch}setPitch(i,o){return this.jumpTo({pitch:i},o),this}cameraForBounds(i,o){i=ue.convert(i);const h=o&&o.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),h,o)}_cameraForBoxAndBearing(i,o,h,f){const _={top:0,bottom:0,right:0,left:0};if(typeof(f=l.e({padding:_,offset:[0,0],maxZoom:this.transform.maxZoom},f)).padding=="number"){const ct=f.padding;f.padding={top:ct,bottom:ct,right:ct,left:ct}}f.padding=l.e(_,f.padding);const M=this.transform,S=M.padding,C=new ue(i,o),k=M.project(C.getNorthWest()),F=M.project(C.getNorthEast()),B=M.project(C.getSouthEast()),q=M.project(C.getSouthWest()),te=l.b8(-h),Q=k.rotate(te),re=F.rotate(te),W=B.rotate(te),pe=q.rotate(te),Ie=new l.P(Math.max(Q.x,re.x,pe.x,W.x),Math.max(Q.y,re.y,pe.y,W.y)),le=new l.P(Math.min(Q.x,re.x,pe.x,W.x),Math.min(Q.y,re.y,pe.y,W.y)),be=Ie.sub(le),Ae=(M.width-(S.left+S.right+f.padding.left+f.padding.right))/be.x,ke=(M.height-(S.top+S.bottom+f.padding.top+f.padding.bottom))/be.y;if(ke<0||Ae<0)return void l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ze=Math.min(M.scaleZoom(M.scale*Math.min(Ae,ke)),f.maxZoom),We=l.P.convert(f.offset),He=new l.P((f.padding.left-f.padding.right)/2,(f.padding.top-f.padding.bottom)/2).rotate(l.b8(h)),st=We.add(He).mult(M.scale/M.zoomScale(ze));return{center:M.unproject(k.add(B).div(2).sub(st)),zoom:ze,bearing:h}}fitBounds(i,o,h){return this._fitInternal(this.cameraForBounds(i,o),o,h)}fitScreenCoordinates(i,o,h,f,_){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.P.convert(i)),this.transform.pointLocation(l.P.convert(o)),h,f),f,_)}_fitInternal(i,o,h){return i?(delete(o=l.e(i,o)).padding,o.linear?this.easeTo(o,h):this.flyTo(o,h)):this}jumpTo(i,o){this.stop();const h=this._getTransformForUpdate();let f=!1,_=!1,M=!1;return"zoom"in i&&h.zoom!==+i.zoom&&(f=!0,h.zoom=+i.zoom),i.center!==void 0&&(h.center=l.M.convert(i.center)),"bearing"in i&&h.bearing!==+i.bearing&&(_=!0,h.bearing=+i.bearing),"pitch"in i&&h.pitch!==+i.pitch&&(M=!0,h.pitch=+i.pitch),i.padding==null||h.isPaddingEqual(i.padding)||(h.padding=i.padding),this._applyUpdatedTransform(h),this.fire(new l.k("movestart",o)).fire(new l.k("move",o)),f&&this.fire(new l.k("zoomstart",o)).fire(new l.k("zoom",o)).fire(new l.k("zoomend",o)),_&&this.fire(new l.k("rotatestart",o)).fire(new l.k("rotate",o)).fire(new l.k("rotateend",o)),M&&this.fire(new l.k("pitchstart",o)).fire(new l.k("pitch",o)).fire(new l.k("pitchend",o)),this.fire(new l.k("moveend",o))}calculateCameraOptionsFromTo(i,o,h,f=0){const _=l.Y.fromLngLat(i,o),M=l.Y.fromLngLat(h,f),S=M.x-_.x,C=M.y-_.y,k=M.z-_.z,F=Math.hypot(S,C,k);if(F===0)throw new Error("Can't calculate camera options with same From and To");const B=Math.hypot(S,C),q=this.transform.scaleZoom(this.transform.cameraToCenterDistance/F/this.transform.tileSize),te=180*Math.atan2(S,-C)/Math.PI;let Q=180*Math.acos(B/F)/Math.PI;return Q=k<0?90-Q:90+Q,{center:M.toLngLat(),zoom:q,pitch:Q,bearing:te}}easeTo(i,o){var h;this._stop(!1,i.easeId),((i=l.e({offset:[0,0],duration:500,easing:l.b7},i)).animate===!1||!i.essential&&D.prefersReducedMotion)&&(i.duration=0);const f=this._getTransformForUpdate(),_=this.getZoom(),M=this.getBearing(),S=this.getPitch(),C=this.getPadding(),k="bearing"in i?this._normalizeBearing(i.bearing,M):M,F="pitch"in i?+i.pitch:S,B="padding"in i?i.padding:f.padding,q=l.P.convert(i.offset);let te=f.centerPoint.add(q);const Q=f.pointLocation(te),{center:re,zoom:W}=f.getConstrained(l.M.convert(i.center||Q),(h=i.zoom)!==null&&h!==void 0?h:_);this._normalizeCenter(re);const pe=f.project(Q),Ie=f.project(re).sub(pe),le=f.zoomScale(W-_);let be,Ae;i.around&&(be=l.M.convert(i.around),Ae=f.locationPoint(be));const ke={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||W!==_,this._rotating=this._rotating||M!==k,this._pitching=this._pitching||F!==S,this._padding=!f.isPaddingEqual(B),this._easeId=i.easeId,this._prepareEase(o,i.noMoveStart,ke),this.terrain&&this._prepareElevation(re),this._ease(ze=>{if(this._zooming&&(f.zoom=l.z.number(_,W,ze)),this._rotating&&(f.bearing=l.z.number(M,k,ze)),this._pitching&&(f.pitch=l.z.number(S,F,ze)),this._padding&&(f.interpolatePadding(C,B,ze),te=f.centerPoint.add(q)),this.terrain&&!i.freezeElevation&&this._updateElevation(ze),be)f.setLocationAtPoint(be,Ae);else{const We=f.zoomScale(f.zoom-_),He=W>_?Math.min(2,le):Math.max(.5,le),st=Math.pow(He,1-ze),ct=f.unproject(pe.add(Ie.mult(ze*st)).mult(We));f.setLocationAtPoint(f.renderWorldCopies?ct.wrap():ct,te)}this._applyUpdatedTransform(f),this._fireMoveEvents(o)},ze=>{this.terrain&&this._finalizeElevation(),this._afterEase(o,ze)},i),this}_prepareEase(i,o,h={}){this._moving=!0,o||h.moving||this.fire(new l.k("movestart",i)),this._zooming&&!h.zooming&&this.fire(new l.k("zoomstart",i)),this._rotating&&!h.rotating&&this.fire(new l.k("rotatestart",i)),this._pitching&&!h.pitching&&this.fire(new l.k("pitchstart",i))}_prepareElevation(i){this._elevationCenter=i,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(i){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const o=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(i<1&&o!==this._elevationTarget){const h=this._elevationTarget-this._elevationStart;this._elevationStart+=i*(h-(o-(h*i+this._elevationStart))/(1-i)),this._elevationTarget=o}this.transform.elevation=l.z.number(this._elevationStart,this._elevationTarget,i)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(i){if(!this.transformCameraUpdate)return;const o=i.clone(),{center:h,zoom:f,pitch:_,bearing:M,elevation:S}=this.transformCameraUpdate(o);h&&(o.center=h),f!==void 0&&(o.zoom=f),_!==void 0&&(o.pitch=_),M!==void 0&&(o.bearing=M),S!==void 0&&(o.elevation=S),this.transform.apply(o)}_fireMoveEvents(i){this.fire(new l.k("move",i)),this._zooming&&this.fire(new l.k("zoom",i)),this._rotating&&this.fire(new l.k("rotate",i)),this._pitching&&this.fire(new l.k("pitch",i))}_afterEase(i,o){if(this._easeId&&o&&this._easeId===o)return;delete this._easeId;const h=this._zooming,f=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,h&&this.fire(new l.k("zoomend",i)),f&&this.fire(new l.k("rotateend",i)),_&&this.fire(new l.k("pitchend",i)),this.fire(new l.k("moveend",i))}flyTo(i,o){var h;if(!i.essential&&D.prefersReducedMotion){const Pi=l.L(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Pi,o)}this.stop(),i=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.b7},i);const f=this._getTransformForUpdate(),_=this.getZoom(),M=this.getBearing(),S=this.getPitch(),C=this.getPadding(),k="bearing"in i?this._normalizeBearing(i.bearing,M):M,F="pitch"in i?+i.pitch:S,B="padding"in i?i.padding:f.padding,q=l.P.convert(i.offset);let te=f.centerPoint.add(q);const Q=f.pointLocation(te),{center:re,zoom:W}=f.getConstrained(l.M.convert(i.center||Q),(h=i.zoom)!==null&&h!==void 0?h:_);this._normalizeCenter(re);const pe=f.zoomScale(W-_),Ie=f.project(Q),le=f.project(re).sub(Ie);let be=i.curve;const Ae=Math.max(f.width,f.height),ke=Ae/pe,ze=le.mag();if("minZoom"in i){const Pi=l.ac(Math.min(i.minZoom,_,W),f.minZoom,f.maxZoom),ii=Ae/f.zoomScale(Pi-_);be=Math.sqrt(ii/ze*2)}const We=be*be;function He(Pi){const ii=(ke*ke-Ae*Ae+(Pi?-1:1)*We*We*ze*ze)/(2*(Pi?ke:Ae)*We*ze);return Math.log(Math.sqrt(ii*ii+1)-ii)}function st(Pi){return(Math.exp(Pi)-Math.exp(-Pi))/2}function ct(Pi){return(Math.exp(Pi)+Math.exp(-Pi))/2}const ci=He(!1);let mt=function(Pi){return ct(ci)/ct(ci+be*Pi)},Yt=function(Pi){return Ae*((ct(ci)*(st(ii=ci+be*Pi)/ct(ii))-st(ci))/We)/ze;var ii},ui=(He(!0)-ci)/be;if(Math.abs(ze)<1e-6||!isFinite(ui)){if(Math.abs(Ae-ke)<1e-6)return this.easeTo(i,o);const Pi=ke<Ae?-1:1;ui=Math.abs(Math.log(ke/Ae))/be,Yt=function(){return 0},mt=function(ii){return Math.exp(Pi*be*ii)}}return i.duration="duration"in i?+i.duration:1e3*ui/("screenSpeed"in i?+i.screenSpeed/be:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0),this._zooming=!0,this._rotating=M!==k,this._pitching=F!==S,this._padding=!f.isPaddingEqual(B),this._prepareEase(o,!1),this.terrain&&this._prepareElevation(re),this._ease(Pi=>{const ii=Pi*ui,di=1/mt(ii);f.zoom=Pi===1?W:_+f.scaleZoom(di),this._rotating&&(f.bearing=l.z.number(M,k,Pi)),this._pitching&&(f.pitch=l.z.number(S,F,Pi)),this._padding&&(f.interpolatePadding(C,B,Pi),te=f.centerPoint.add(q)),this.terrain&&!i.freezeElevation&&this._updateElevation(Pi);const yi=Pi===1?re:f.unproject(Ie.add(le.mult(Yt(ii))).mult(di));f.setLocationAtPoint(f.renderWorldCopies?yi.wrap():yi,te),this._applyUpdatedTransform(f),this._fireMoveEvents(o)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(o)},i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const h=this._onEaseEnd;delete this._onEaseEnd,h.call(this,o)}if(!i){const h=this.handlers;h&&h.stop(!1)}return this}_ease(i,o,h){h.animate===!1||h.duration===0?(i(1),o()):(this._easeStart=D.now(),this._easeOptions=h,this._onEaseFrame=i,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(i,o){i=l.b1(i,-180,180);const h=Math.abs(i-o);return Math.abs(i-360-o)<h&&(i-=360),Math.abs(i+360-o)<h&&(i+=360),i}_normalizeCenter(i){const o=this.transform;if(!o.renderWorldCopies||o.lngRange)return;const h=i.lng-o.center.lng;i.lng+=h>180?-360:h<-180?360:0}queryTerrainElevation(i){return this.terrain?this.terrain.getElevationForLngLatZoom(l.M.convert(i),this.transform.tileZoom)-this.transform.elevation:null}}const wu={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class $s{constructor(i=wu){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=o=>{!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"&&o.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=i}getDefaultPosition(){return"bottom-right"}onAdd(i){return this._map=i,this._compact=this.options.compact,this._container=z.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=z.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=z.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){z.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(i,o){const h=this._map._getUIString(`AttributionControl.${o}`);i.title=h,i.setAttribute("aria-label",h)}_updateAttributions(){if(!this._map.style)return;let i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map(f=>typeof f!="string"?"":f)):typeof this.options.customAttribution=="string"&&i.push(this.options.customAttribution)),this._map.style.stylesheet){const f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}const o=this._map.style.sourceCaches;for(const f in o){const _=o[f];if(_.used||_.usedForTerrain){const M=_.getSource();M.attribution&&i.indexOf(M.attribution)<0&&i.push(M.attribution)}}i=i.filter(f=>String(f).trim()),i.sort((f,_)=>f.length-_.length),i=i.filter((f,_)=>{for(let M=_+1;M<i.length;M++)if(i[M].indexOf(f)>=0)return!1;return!0});const h=i.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,i.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Qh{constructor(i={}){this._updateCompact=()=>{const o=this._container.children;if(o.length){const h=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&h.classList.add("maplibregl-compact"):h.classList.remove("maplibregl-compact")}},this.options=i}getDefaultPosition(){return"bottom-left"}onAdd(i){this._map=i,this._compact=this.options&&this.options.compact,this._container=z.create("div","maplibregl-ctrl");const o=z.create("a","maplibregl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://maplibre.org/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){z.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class ql{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const o=++this._id;return this._queue.push({callback:i,id:o,cancelled:!1}),o}remove(i){const o=this._currentlyRunning,h=o?this._queue.concat(o):this._queue;for(const f of h)if(f.id===i)return void(f.cancelled=!0)}run(i=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const o=this._currentlyRunning=this._queue;this._queue=[];for(const h of o)if(!h.cancelled&&(h.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Lr=l.X([{name:"a_pos3d",type:"Int16",components:3}]);class jr extends l.E{constructor(i){super(),this.sourceCache=i,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,i.usedForTerrain=!0,i.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(i,o){this.sourceCache.update(i,o),this._renderableTilesKeys=[];const h={};for(const f of i.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:o}))h[f.key]=!0,this._renderableTilesKeys.push(f.key),this._tiles[f.key]||(f.posMatrix=new Float64Array(16),l.aN(f.posMatrix,0,l.W,0,l.W,0,1),this._tiles[f.key]=new Ri(f,this.tileSize));for(const f in this._tiles)h[f]||delete this._tiles[f]}freeRtt(i){for(const o in this._tiles){const h=this._tiles[o];(!i||h.tileID.equals(i)||h.tileID.isChildOf(i)||i.isChildOf(h.tileID))&&(h.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(i=>this.getTileByID(i))}getTileByID(i){return this._tiles[i]}getTerrainCoords(i){const o={};for(const h of this._renderableTilesKeys){const f=this._tiles[h].tileID;if(f.canonical.equals(i.canonical)){const _=i.clone();_.posMatrix=new Float64Array(16),l.aN(_.posMatrix,0,l.W,0,l.W,0,1),o[h]=_}else if(f.canonical.isChildOf(i.canonical)){const _=i.clone();_.posMatrix=new Float64Array(16);const M=f.canonical.z-i.canonical.z,S=f.canonical.x-(f.canonical.x>>M<<M),C=f.canonical.y-(f.canonical.y>>M<<M),k=l.W>>M;l.aN(_.posMatrix,0,k,0,k,0,1),l.H(_.posMatrix,_.posMatrix,[-S*k,-C*k,0]),o[h]=_}else if(i.canonical.isChildOf(f.canonical)){const _=i.clone();_.posMatrix=new Float64Array(16);const M=i.canonical.z-f.canonical.z,S=i.canonical.x-(i.canonical.x>>M<<M),C=i.canonical.y-(i.canonical.y>>M<<M),k=l.W>>M;l.aN(_.posMatrix,0,l.W,0,l.W,0,1),l.H(_.posMatrix,_.posMatrix,[S*k,C*k,0]),l.J(_.posMatrix,_.posMatrix,[1/2**M,1/2**M,0]),o[h]=_}}return o}getSourceTile(i,o){const h=this.sourceCache._source;let f=i.overscaledZ-this.deltaZoom;if(f>h.maxzoom&&(f=h.maxzoom),f<h.minzoom)return null;this._sourceTileCache[i.key]||(this._sourceTileCache[i.key]=i.scaledTo(f).key);let _=this.sourceCache.getTileByID(this._sourceTileCache[i.key]);if((!_||!_.dem)&&o)for(;f>=h.minzoom&&(!_||!_.dem);)_=this.sourceCache.getTileByID(i.scaledTo(f--).key);return _}tilesAfterTime(i=Date.now()){return Object.values(this._tiles).filter(o=>o.timeAdded>=i)}}class ed{constructor(i,o,h){this.painter=i,this.sourceCache=new jr(o),this.options=h,this.exaggeration=typeof h.exaggeration=="number"?h.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(i,o,h,f=l.W){var _;if(!(o>=0&&o<f&&h>=0&&h<f))return 0;const M=this.getTerrainData(i),S=(_=M.tile)===null||_===void 0?void 0:_.dem;if(!S)return 0;const C=function(Q,re,W){var pe=re[0],Ie=re[1];return Q[0]=W[0]*pe+W[4]*Ie+W[12],Q[1]=W[1]*pe+W[5]*Ie+W[13],Q}([],[o/f*l.W,h/f*l.W],M.u_terrain_matrix),k=[C[0]*S.dim,C[1]*S.dim],F=Math.floor(k[0]),B=Math.floor(k[1]),q=k[0]-F,te=k[1]-B;return S.get(F,B)*(1-q)*(1-te)+S.get(F+1,B)*q*(1-te)+S.get(F,B+1)*(1-q)*te+S.get(F+1,B+1)*q*te}getElevationForLngLatZoom(i,o){const{tileID:h,mercatorX:f,mercatorY:_}=this._getOverscaledTileIDFromLngLatZoom(i,o);return this.getElevation(h,f%l.W,_%l.W,l.W)}getElevation(i,o,h,f=l.W){return this.getDEMElevation(i,o,h,f)*this.exaggeration}getTerrainData(i){if(!this._emptyDemTexture){const f=this.painter.context,_=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new kt(f,_,f.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new kt(f,new l.R({width:1,height:1}),f.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.an([])}const o=this.sourceCache.getSourceTile(i,!0);if(o&&o.dem&&(!o.demTexture||o.needsTerrainPrepare)){const f=this.painter.context;o.demTexture=this.painter.getTileTexture(o.dem.stride),o.demTexture?o.demTexture.update(o.dem.getPixels(),{premultiply:!1}):o.demTexture=new kt(f,o.dem.getPixels(),f.gl.RGBA,{premultiply:!1}),o.demTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),o.needsTerrainPrepare=!1}const h=o&&o+o.tileID.key+i.key;if(h&&!this._demMatrixCache[h]){const f=this.sourceCache.sourceCache._source.maxzoom;let _=i.canonical.z-o.tileID.canonical.z;i.overscaledZ>i.canonical.z&&(i.canonical.z>=f?_=i.canonical.z-f:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const M=i.canonical.x-(i.canonical.x>>_<<_),S=i.canonical.y-(i.canonical.y>>_<<_),C=l.b9(new Float64Array(16),[1/(l.W<<_),1/(l.W<<_),0]);l.H(C,C,[M*l.W,S*l.W,0]),this._demMatrixCache[i.key]={matrix:C,coord:i}}return{u_depth:2,u_terrain:3,u_terrain_dim:o&&o.dem&&o.dem.dim||1,u_terrain_matrix:h?this._demMatrixCache[i.key].matrix:this._emptyDemMatrix,u_terrain_unpack:o&&o.dem&&o.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(o&&o.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:o}}getFramebuffer(i){const o=this.painter,h=o.width/devicePixelRatio,f=o.height/devicePixelRatio;return!this._fbo||this._fbo.width===h&&this._fbo.height===f||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new kt(o.context,{width:h,height:f,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new kt(o.context,{width:h,height:f,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=o.context.createFramebuffer(h,f,!0,!1),this._fbo.depthAttachment.set(o.context.createRenderbuffer(o.context.gl.DEPTH_COMPONENT16,h,f))),this._fbo.colorAttachment.set(i==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const i=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const o=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let _=0,M=0;_<this._coordsTextureSize;_++)for(let S=0;S<this._coordsTextureSize;S++,M+=4)o[M+0]=255&S,o[M+1]=255&_,o[M+2]=S>>8<<4|_>>8,o[M+3]=0;const h=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(o.buffer)),f=new kt(i,h,i.gl.RGBA,{premultiply:!1});return f.bind(i.gl.NEAREST,i.gl.CLAMP_TO_EDGE),this._coordsTexture=f,f}pointCoordinate(i){this.painter.maybeDrawDepthAndCoords(!0);const o=new Uint8Array(4),h=this.painter.context,f=h.gl,_=Math.round(i.x*this.painter.pixelRatio/devicePixelRatio),M=Math.round(i.y*this.painter.pixelRatio/devicePixelRatio),S=Math.round(this.painter.height/devicePixelRatio);h.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),f.readPixels(_,S-M-1,1,1,f.RGBA,f.UNSIGNED_BYTE,o),h.bindFramebuffer.set(null);const C=o[0]+(o[2]>>4<<8),k=o[1]+((15&o[2])<<8),F=this.coordsIndex[255-o[3]],B=F&&this.sourceCache.getTileByID(F);if(!B)return null;const q=this._coordsTextureSize,te=(1<<B.tileID.canonical.z)*q;return new l.Y((B.tileID.canonical.x*q+C)/te+B.tileID.wrap,(B.tileID.canonical.y*q+k)/te,this.getElevation(B.tileID,C,k,q))}depthAtPoint(i){const o=new Uint8Array(4),h=this.painter.context,f=h.gl;return h.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),f.readPixels(i.x,this.painter.height/devicePixelRatio-i.y-1,1,1,f.RGBA,f.UNSIGNED_BYTE,o),h.bindFramebuffer.set(null),(o[0]/16777216+o[1]/65536+o[2]/256+o[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const i=this.painter.context,o=new l.ba,h=new l.aX,f=this.meshSize,_=l.W/f,M=f*f;for(let B=0;B<=f;B++)for(let q=0;q<=f;q++)o.emplaceBack(q*_,B*_,0);for(let B=0;B<M;B+=f+1)for(let q=0;q<f;q++)h.emplaceBack(q+B,f+q+B+1,f+q+B+2),h.emplaceBack(q+B,f+q+B+2,q+B+1);const S=o.length,C=S+2*(f+1);for(const B of[0,1])for(let q=0;q<=f;q++)for(const te of[0,1])o.emplaceBack(q*_,B*l.W,te);for(let B=0;B<2*f;B+=2)h.emplaceBack(C+B,C+B+1,C+B+3),h.emplaceBack(C+B,C+B+3,C+B+2),h.emplaceBack(S+B,S+B+3,S+B+1),h.emplaceBack(S+B,S+B+2,S+B+3);const k=o.length,F=k+2*(f+1);for(const B of[0,1])for(let q=0;q<=f;q++)for(const te of[0,1])o.emplaceBack(B*l.W,q*_,te);for(let B=0;B<2*f;B+=2)h.emplaceBack(k+B,k+B+1,k+B+3),h.emplaceBack(k+B,k+B+3,k+B+2),h.emplaceBack(F+B,F+B+3,F+B+1),h.emplaceBack(F+B,F+B+2,F+B+3);return this._mesh={indexBuffer:i.createIndexBuffer(h),vertexBuffer:i.createVertexBuffer(o,Lr.members),segments:l.$.simpleSegment(0,0,o.length,h.length)},this._mesh}getMeshFrameDelta(i){return 2*Math.PI*l.bb/Math.pow(2,i)/5}getMinTileElevationForLngLatZoom(i,o){var h;const{tileID:f}=this._getOverscaledTileIDFromLngLatZoom(i,o);return(h=this.getMinMaxElevation(f).minElevation)!==null&&h!==void 0?h:0}getMinMaxElevation(i){const o=this.getTerrainData(i).tile,h={minElevation:null,maxElevation:null};return o&&o.dem&&(h.minElevation=o.dem.min*this.exaggeration,h.maxElevation=o.dem.max*this.exaggeration),h}_getOverscaledTileIDFromLngLatZoom(i,o){const h=l.Y.fromLngLat(i.wrap()),f=(1<<o)*l.W,_=h.x*f,M=h.y*f,S=Math.floor(_/l.W),C=Math.floor(M/l.W);return{tileID:new l.Q(o,0,o,S,C),mercatorX:_,mercatorY:M}}}class Gl{constructor(i,o,h){this._context=i,this._size=o,this._tileSize=h,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const i of this._objects)i.texture.destroy(),i.fbo.destroy()}_createObject(i){const o=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),h=new kt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return h.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),o.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),o.colorAttachment.set(h.texture),{id:i,fbo:o,texture:h,stamp:-1,inUse:!1}}getObjectForId(i){return this._objects[i]}useObject(i){i.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(o=>i.id!==o),this._recentlyUsed.push(i.id)}stampObject(i){i.stamp=++this._stamp}getOrCreateFreeObject(){for(const o of this._recentlyUsed)if(!this._objects[o].inUse)return this._objects[o];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const i=this._createObject(this._objects.length);return this._objects.push(i),i}freeObject(i){i.inUse=!1}freeAllObjects(){for(const i of this._objects)this.freeObject(i)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(i=>!i.inUse)===!1}}const ba={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Mu{constructor(i,o){this.painter=i,this.terrain=o,this.pool=new Gl(i.context,30,o.sourceCache.tileSize*o.qualityFactor)}destruct(){this.pool.destruct()}getTexture(i){return this.pool.getObjectForId(i.rtt[this._stacks.length-1].id).texture}prepareForRender(i,o){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=i._order.filter(h=>!i._layers[h].isHidden(o)),this._coordsDescendingInv={};for(const h in i.sourceCaches){this._coordsDescendingInv[h]={};const f=i.sourceCaches[h].getVisibleCoordinates();for(const _ of f){const M=this.terrain.sourceCache.getTerrainCoords(_);for(const S in M)this._coordsDescendingInv[h][S]||(this._coordsDescendingInv[h][S]=[]),this._coordsDescendingInv[h][S].push(M[S])}}this._coordsDescendingInvStr={};for(const h of i._order){const f=i._layers[h],_=f.source;if(ba[f.type]&&!this._coordsDescendingInvStr[_]){this._coordsDescendingInvStr[_]={};for(const M in this._coordsDescendingInv[_])this._coordsDescendingInvStr[_][M]=this._coordsDescendingInv[_][M].map(S=>S.key).sort().join()}}for(const h of this._renderableTiles)for(const f in this._coordsDescendingInvStr){const _=this._coordsDescendingInvStr[f][h.tileID.key];_&&_!==h.rttCoords[f]&&(h.rtt=[])}}renderLayer(i){if(i.isHidden(this.painter.transform.zoom))return!1;const o=i.type,h=this.painter,f=this._renderableLayerIds[this._renderableLayerIds.length-1]===i.id;if(ba[o]&&(this._prevType&&ba[this._prevType]||this._stacks.push([]),this._prevType=o,this._stacks[this._stacks.length-1].push(i.id),!f))return!0;if(ba[this._prevType]||ba[o]&&f){this._prevType=o;const _=this._stacks.length-1,M=this._stacks[_]||[];for(const S of this._renderableTiles){if(this.pool.isFull()&&(Qo(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(S),S.rtt[_]){const k=this.pool.getObjectForId(S.rtt[_].id);if(k.stamp===S.rtt[_].stamp){this.pool.useObject(k);continue}}const C=this.pool.getOrCreateFreeObject();this.pool.useObject(C),this.pool.stampObject(C),S.rtt[_]={id:C.id,stamp:C.stamp},h.context.bindFramebuffer.set(C.fbo.framebuffer),h.context.clear({color:l.aO.transparent,stencil:0}),h.currentStencilSource=void 0;for(let k=0;k<M.length;k++){const F=h.style._layers[M[k]],B=F.source?this._coordsDescendingInv[F.source][S.tileID.key]:[S.tileID];h.context.viewport.set([0,0,C.fbo.width,C.fbo.height]),h._renderTileClippingMasks(F,B),h.renderLayer(h,h.style.sourceCaches[F.source],F,B),F.source&&(S.rttCoords[F.source]=this._coordsDescendingInvStr[F.source][S.tileID.key])}}return Qo(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),ba[o]}return!1}}const Su={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Eu=T,Hl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:wu,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Mc=g=>{g.touchstart=g.dragStart,g.touchmoveWindow=g.dragMove,g.touchend=g.dragEnd},Tu={showCompass:!0,showZoom:!0,visualizePitch:!1};class Cu{constructor(i,o,h=!1){this.mousedown=M=>{this.startMouse(l.e({},M,{ctrlKey:!0,preventDefault:()=>M.preventDefault()}),z.mousePos(this.element,M)),z.addEventListener(window,"mousemove",this.mousemove),z.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=M=>{this.moveMouse(M,z.mousePos(this.element,M))},this.mouseup=M=>{this.mouseRotate.dragEnd(M),this.mousePitch&&this.mousePitch.dragEnd(M),this.offTemp()},this.touchstart=M=>{M.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=z.touchPos(this.element,M.targetTouches)[0],this.startTouch(M,this._startPos),z.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),z.addEventListener(window,"touchend",this.touchend))},this.touchmove=M=>{M.targetTouches.length!==1?this.reset():(this._lastPos=z.touchPos(this.element,M.targetTouches)[0],this.moveTouch(M,this._lastPos))},this.touchend=M=>{M.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const f=i.dragRotate._mouseRotate.getClickTolerance(),_=i.dragRotate._mousePitch.getClickTolerance();this.element=o,this.mouseRotate=ss({clickTolerance:f,enable:!0}),this.touchRotate=(({enable:M,clickTolerance:S,bearingDegreesPerPixelMoved:C=.8})=>{const k=new Et;return new en({clickTolerance:S,move:(F,B)=>({bearingDelta:(B.x-F.x)*C}),moveStateManager:k,enable:M,assignEvents:Mc})})({clickTolerance:f,enable:!0}),this.map=i,h&&(this.mousePitch=Zn({clickTolerance:_,enable:!0}),this.touchPitch=(({enable:M,clickTolerance:S,pitchDegreesPerPixelMoved:C=-.5})=>{const k=new Et;return new en({clickTolerance:S,move:(F,B)=>({pitchDelta:(B.y-F.y)*C}),moveStateManager:k,enable:M,assignEvents:Mc})})({clickTolerance:_,enable:!0})),z.addEventListener(o,"mousedown",this.mousedown),z.addEventListener(o,"touchstart",this.touchstart,{passive:!1}),z.addEventListener(o,"touchcancel",this.reset)}startMouse(i,o){this.mouseRotate.dragStart(i,o),this.mousePitch&&this.mousePitch.dragStart(i,o),z.disableDrag()}startTouch(i,o){this.touchRotate.dragStart(i,o),this.touchPitch&&this.touchPitch.dragStart(i,o),z.disableDrag()}moveMouse(i,o){const h=this.map,{bearingDelta:f}=this.mouseRotate.dragMove(i,o)||{};if(f&&h.setBearing(h.getBearing()+f),this.mousePitch){const{pitchDelta:_}=this.mousePitch.dragMove(i,o)||{};_&&h.setPitch(h.getPitch()+_)}}moveTouch(i,o){const h=this.map,{bearingDelta:f}=this.touchRotate.dragMove(i,o)||{};if(f&&h.setBearing(h.getBearing()+f),this.touchPitch){const{pitchDelta:_}=this.touchPitch.dragMove(i,o)||{};_&&h.setPitch(h.getPitch()+_)}}off(){const i=this.element;z.removeEventListener(i,"mousedown",this.mousedown),z.removeEventListener(i,"touchstart",this.touchstart,{passive:!1}),z.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),z.removeEventListener(window,"touchend",this.touchend),z.removeEventListener(i,"touchcancel",this.reset),this.offTemp()}offTemp(){z.enableDrag(),z.removeEventListener(window,"mousemove",this.mousemove),z.removeEventListener(window,"mouseup",this.mouseup),z.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),z.removeEventListener(window,"touchend",this.touchend)}}let wa;function Sc(g,i,o){const h=new l.M(g.lng,g.lat);if(g=new l.M(g.lng,g.lat),i){const f=new l.M(g.lng-360,g.lat),_=new l.M(g.lng+360,g.lat),M=o.locationPoint(g).distSqr(i);o.locationPoint(f).distSqr(i)<M?g=f:o.locationPoint(_).distSqr(i)<M&&(g=_)}for(;Math.abs(g.lng-o.center.lng)>180;){const f=o.locationPoint(g);if(f.x>=0&&f.y>=0&&f.x<=o.width&&f.y<=o.height)break;g.lng>o.center.lng?g.lng-=360:g.lng+=360}return g.lng!==h.lng&&o.locationPoint(g).y>o.height/2-o.getHorizon()?g:h}const Zl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ec(g,i,o){const h=g.classList;for(const f in Zl)h.remove(`maplibregl-${o}-anchor-${f}`);h.add(`maplibregl-${o}-anchor-${i}`)}class Wl extends l.E{constructor(i){if(super(),this._onKeyPress=o=>{const h=o.code,f=o.charCode||o.keyCode;h!=="Space"&&h!=="Enter"&&f!==32&&f!==13||this.togglePopup()},this._onMapClick=o=>{const h=o.originalEvent.target,f=this._element;this._popup&&(h===f||f.contains(h))&&this.togglePopup()},this._update=o=>{var h;if(!this._map)return;const f=this._map.loaded()&&!this._map.isMoving();((o==null?void 0:o.type)==="terrain"||(o==null?void 0:o.type)==="render"&&!f)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Sc(this._lngLat,this._flatPos,this._map.transform):(h=this._lngLat)===null||h===void 0?void 0:h.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let _="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?_=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(_=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let M="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?M="rotateX(0deg)":this._pitchAlignment==="map"&&(M=`rotateX(${this._map.getPitch()}deg)`),o&&o.type!=="moveend"||(this._pos=this._pos.round()),z.setTransform(this._element,`${Zl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${M} ${_}`),D.frameAsync(new AbortController).then(()=>{this._updateOpacity(o&&o.type==="moveend")}).catch(()=>{})},this._onMove=o=>{if(!this._isDragging){const h=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.k("dragstart"))),this.fire(new l.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.k("dragend")),this._state="inactive"},this._addDragHandler=o=>{this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment!=="auto"?i.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(i==null?void 0:i.opacity,i==null?void 0:i.opacityWhenCovered),i&&i.element)this._element=i.element,this._offset=l.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=z.create("div"),this._element.setAttribute("aria-label","Map marker");const o=z.createNS("http://www.w3.org/2000/svg","svg"),h=41,f=27;o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height",`${h}px`),o.setAttributeNS(null,"width",`${f}px`),o.setAttributeNS(null,"viewBox",`0 0 ${f} ${h}`);const _=z.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"stroke","none"),_.setAttributeNS(null,"stroke-width","1"),_.setAttributeNS(null,"fill","none"),_.setAttributeNS(null,"fill-rule","evenodd");const M=z.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill-rule","nonzero");const S=z.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(3.0, 29.0)"),S.setAttributeNS(null,"fill","#000000");const C=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const pe of C){const Ie=z.createNS("http://www.w3.org/2000/svg","ellipse");Ie.setAttributeNS(null,"opacity","0.04"),Ie.setAttributeNS(null,"cx","10.5"),Ie.setAttributeNS(null,"cy","5.80029008"),Ie.setAttributeNS(null,"rx",pe.rx),Ie.setAttributeNS(null,"ry",pe.ry),S.appendChild(Ie)}const k=z.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"fill",this._color);const F=z.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),k.appendChild(F);const B=z.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"opacity","0.25"),B.setAttributeNS(null,"fill","#000000");const q=z.createNS("http://www.w3.org/2000/svg","path");q.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),B.appendChild(q);const te=z.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"transform","translate(6.0, 7.0)"),te.setAttributeNS(null,"fill","#FFFFFF");const Q=z.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"transform","translate(8.0, 8.0)");const re=z.createNS("http://www.w3.org/2000/svg","circle");re.setAttributeNS(null,"fill","#000000"),re.setAttributeNS(null,"opacity","0.25"),re.setAttributeNS(null,"cx","5.5"),re.setAttributeNS(null,"cy","5.5"),re.setAttributeNS(null,"r","5.4999962");const W=z.createNS("http://www.w3.org/2000/svg","circle");W.setAttributeNS(null,"fill","#FFFFFF"),W.setAttributeNS(null,"cx","5.5"),W.setAttributeNS(null,"cy","5.5"),W.setAttributeNS(null,"r","5.4999962"),Q.appendChild(re),Q.appendChild(W),M.appendChild(S),M.appendChild(k),M.appendChild(B),M.appendChild(te),M.appendChild(Q),o.appendChild(M),o.setAttributeNS(null,"height",h*this._scale+"px"),o.setAttributeNS(null,"width",f*this._scale+"px"),this._element.appendChild(o),this._offset=l.P.convert(i&&i.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",o=>{o.preventDefault()}),this._element.addEventListener("mousedown",o=>{o.preventDefault()}),Ec(this._element,this._anchor,"marker"),i&&i.className)for(const o of i.className.split(" "))this._element.classList.add(o);this._popup=null}addTo(i){return this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._update),i.on("moveend",this._update),i.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),z.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=l.M.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const f=Math.abs(13.5)/Math.SQRT2;i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(38.1-13.5+f)],"bottom-right":[-f,-1*(38.1-13.5+f)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const i=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:i?(i.isOpen()?i.remove():(i.setLngLat(this._lngLat),i.addTo(this._map)),this):this}_updateOpacity(i=!1){var o,h;if(!(!((o=this._map)===null||o===void 0)&&o.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(i)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const f=this._map,_=f.terrain.depthAtPoint(this._pos),M=f.terrain.getElevationForLngLatZoom(this._lngLat,f.transform.tileZoom);if(f.transform.lngLatToCameraDepth(this._lngLat,M)-_<.006)return void(this._element.style.opacity=this._opacity);const S=-this._offset.y/f.transform._pixelPerMeter,C=Math.sin(f.getPitch()*Math.PI/180)*S,k=f.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),F=f.transform.lngLatToCameraDepth(this._lngLat,M+C)-k>.006;!((h=this._popup)===null||h===void 0)&&h.isOpen()&&F&&this._popup.remove(),this._element.style.opacity=F?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(i){return this._offset=l.P.convert(i),this._update(),this}addClassName(i){this._element.classList.add(i)}removeClassName(i){this._element.classList.remove(i)}toggleClassName(i){return this._element.classList.toggle(i)}setDraggable(i){return this._draggable=!!i,this._map&&(i?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i&&i!=="auto"?i:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(i,o){return i===void 0&&o===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),i!==void 0&&(this._opacity=i),o!==void 0&&(this._opacityWhenCovered=o),this._map&&this._updateOpacity(!0),this}}const Tc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let tl=0,yo=!1;const Cc={maxWidth:100,unit:"metric"};function Ic(g,i,o){const h=o&&o.maxWidth||100,f=g._container.clientHeight/2,_=g.unproject([0,f]),M=g.unproject([h,f]),S=_.distanceTo(M);if(o&&o.unit==="imperial"){const C=3.2808*S;C>5280?_o(i,h,C/5280,g._getUIString("ScaleControl.Miles")):_o(i,h,C,g._getUIString("ScaleControl.Feet"))}else o&&o.unit==="nautical"?_o(i,h,S/1852,g._getUIString("ScaleControl.NauticalMiles")):S>=1e3?_o(i,h,S/1e3,g._getUIString("ScaleControl.Kilometers")):_o(i,h,S,g._getUIString("ScaleControl.Meters"))}function _o(g,i,o,h){const f=function(_){const M=Math.pow(10,`${Math.floor(_)}`.length-1);let S=_/M;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(C){const k=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*k)/k}(S),M*S}(o);g.style.width=i*(f/o)+"px",g.innerHTML=`${f}&nbsp;${h}`}const Iu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Au=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ac(g){if(g){if(typeof g=="number"){const i=Math.round(Math.abs(g)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,g),"top-left":new l.P(i,i),"top-right":new l.P(-i,i),bottom:new l.P(0,-g),"bottom-left":new l.P(i,-i),"bottom-right":new l.P(-i,-i),left:new l.P(g,0),right:new l.P(-g,0)}}if(g instanceof l.P||Array.isArray(g)){const i=l.P.convert(g);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:l.P.convert(g.center||[0,0]),top:l.P.convert(g.top||[0,0]),"top-left":l.P.convert(g["top-left"]||[0,0]),"top-right":l.P.convert(g["top-right"]||[0,0]),bottom:l.P.convert(g.bottom||[0,0]),"bottom-left":l.P.convert(g["bottom-left"]||[0,0]),"bottom-right":l.P.convert(g["bottom-right"]||[0,0]),left:l.P.convert(g.left||[0,0]),right:l.P.convert(g.right||[0,0])}}return Ac(new l.P(0,0))}const td=T;m.AJAXError=l.be,m.Evented=l.E,m.LngLat=l.M,m.MercatorCoordinate=l.Y,m.Point=l.P,m.addProtocol=l.bf,m.config=l.a,m.removeProtocol=l.bg,m.AttributionControl=$s,m.BoxZoomHandler=Ei,m.CanvasSource=At,m.CooperativeGesturesHandler=$t,m.DoubleClickZoomHandler=xu,m.DragPanHandler=Jh,m.DragRotateHandler=Ns,m.EdgeInsets=qt,m.FullscreenControl=class extends l.E{constructor(g={}){super(),this._onFullscreenChange=()=>{var i;let o=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((i=o==null?void 0:o.shadowRoot)===null||i===void 0)&&i.fullscreenElement;)o=o.shadowRoot.fullscreenElement;o===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){z.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const g=this._fullscreenButton=z.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);z.create("span","maplibregl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.title=g}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},m.GeoJSONSource=Ct,m.GeolocateControl=class extends l.E{constructor(g){super(),this._onSuccess=i=>{if(this._map){if(this._isOutOfMapMaxBounds(i))return this._setErrorState(),this.fire(new l.k("outofmaxbounds",i)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=i,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(i),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(i),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.k("geolocate",i)),this._finish()}},this._updateCamera=i=>{const o=new l.M(i.coords.longitude,i.coords.latitude),h=i.coords.accuracy,f=this._map.getBearing(),_=l.e({bearing:f},this.options.fitBoundsOptions),M=ue.fromLngLat(o,h);this._map.fitBounds(M,_,{geolocateSource:!0})},this._updateMarker=i=>{if(i){const o=new l.M(i.coords.longitude,i.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=i.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=i=>{if(this._map){if(this.options.trackUserLocation)if(i.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(i.code===3&&yo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.k("error",i)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=i=>{if(this._map){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=z.create("button","maplibregl-ctrl-geolocate",this._container),z.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",i===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=z.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Wl({element:this._dotElement}),this._circleElement=z.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Wl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.k("trackuserlocationend")))})}},this.options=l.e({},Tc,g)}onAdd(g){return this._map=g,this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return l._(this,arguments,void 0,function*(i=!1){if(wa!==void 0&&!i)return wa;if(window.navigator.permissions===void 0)return wa=!!window.navigator.geolocation,wa;try{wa=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{wa=!!window.navigator.geolocation}return wa})}().then(i=>this._setupUI(i)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),z.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,tl=0,yo=!1}_isOutOfMapMaxBounds(g){const i=this._map.getMaxBounds(),o=g.coords;return i&&(o.longitude<i.getWest()||o.longitude>i.getEast()||o.latitude<i.getSouth()||o.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const g=this._map.getBounds(),i=g.getSouthEast(),o=g.getNorthEast(),h=i.distanceTo(o),f=Math.ceil(this._accuracy/(h/this._map._container.clientHeight)*2);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":tl--,yo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),tl++,tl>1?(g={maximumAge:6e5,timeout:0},yo=!0):(g=this.options.positionOptions,yo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,g)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},m.Hash=Er,m.ImageSource=it,m.KeyboardHandler=Va,m.LngLatBounds=ue,m.LogoControl=Qh,m.Map=class extends Wn{constructor(g){if(l.bc.mark(l.bd.create),(g=l.e({},Hl,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new wi(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),{bearingSnap:g.bearingSnap}),this._contextLost=i=>{i.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new l.k("webglcontextlost",{originalEvent:i}))},this._contextRestored=i=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.k("webglcontextrestored",{originalEvent:i}))},this._onMapScroll=i=>{if(i.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=g.interactive,this._maxTileCacheSize=g.maxTileCacheSize,this._maxTileCacheZoomLevels=g.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._renderTaskQueue=new ql,this._controls=[],this._mapId=l.a3(),this._locale=l.e({},Su,g.locale),this._clickTolerance=g.clickTolerance,this._overridePixelRatio=g.pixelRatio,this._maxCanvasSize=g.maxCanvasSize,this.transformCameraUpdate=g.transformCameraUpdate,this._imageQueueHandle=ae.addThrottleControl(()=>this.isMoving()),this._requestManager=new Pe(g.transformRequest),typeof g.container=="string"){if(this._container=document.getElementById(g.container),!this._container)throw new Error(`Container '${g.container}' not found.`)}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(g.maxBounds&&this.setMaxBounds(g.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let i=!1;const o=dr(h=>{this._trackResize&&!this._removed&&this.resize(h)._update()},50);this._resizeObserver=new ResizeObserver(h=>{i?o(h):i=!0}),this._resizeObserver.observe(this._container)}this.handlers=new bu(this,g),this._hash=g.hash&&new Er(typeof g.hash=="string"&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,l.e({},g.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=g.localIdeographFontFamily,this._validateStyle=g.validateStyle,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new $s(typeof g.attributionControl=="boolean"?void 0:g.attributionControl)),g.maplibreLogo&&this.addControl(new Qh,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update(i.dataType==="style"),this.fire(new l.k(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new l.k(`${i.dataType}dataloading`,i))}),this.on("dataabort",i=>{this.fire(new l.k("sourcedataabort",i))})}_getMapId(){return this._mapId}addControl(g,i){if(i===void 0&&(i=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new l.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=g.onAdd(this);this._controls.push(g);const h=this._controlPositions[i];return i.indexOf("bottom")!==-1?h.insertBefore(o,h.firstChild):h.appendChild(o),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new l.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(g);return i>-1&&this._controls.splice(i,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}calculateCameraOptionsFromTo(g,i,o,h){return h==null&&this.terrain&&(h=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(g,i,o,h)}resize(g){var i;const o=this._containerDimensions(),h=o[0],f=o[1],_=this._getClampedPixelRatio(h,f);if(this._resizeCanvas(h,f,_),this.painter.resize(h,f,_),this.painter.overLimit()){const S=this.painter.context.gl;this._maxCanvasSize=[S.drawingBufferWidth,S.drawingBufferHeight];const C=this._getClampedPixelRatio(h,f);this._resizeCanvas(h,f,C),this.painter.resize(h,f,C)}this.transform.resize(h,f),(i=this._requestedCameraState)===null||i===void 0||i.resize(h,f);const M=!this._moving;return M&&(this.stop(),this.fire(new l.k("movestart",g)).fire(new l.k("move",g))),this.fire(new l.k("resize",g)),M&&this.fire(new l.k("moveend",g)),this}_getClampedPixelRatio(g,i){const{0:o,1:h}=this._maxCanvasSize,f=this.getPixelRatio(),_=g*f,M=i*f;return Math.min(_>o?o/_:1,M>h?h/M:1)*f}getPixelRatio(){var g;return(g=this._overridePixelRatio)!==null&&g!==void 0?g:devicePixelRatio}setPixelRatio(g){this._overridePixelRatio=g,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(g){return this.transform.setMaxBounds(ue.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this._update()}project(g){return this.transform.locationPoint(l.M.convert(g),this.style&&this.terrain)}unproject(g){return this.transform.pointLocation(l.P.convert(g),this.terrain)}isMoving(){var g;return this._moving||((g=this.handlers)===null||g===void 0?void 0:g.isMoving())}isZooming(){var g;return this._zooming||((g=this.handlers)===null||g===void 0?void 0:g.isZooming())}isRotating(){var g;return this._rotating||((g=this.handlers)===null||g===void 0?void 0:g.isRotating())}_createDelegatedListener(g,i,o){if(g==="mouseenter"||g==="mouseover"){let h=!1;return{layer:i,listener:o,delegates:{mousemove:_=>{const M=this.getLayer(i)?this.queryRenderedFeatures(_.point,{layers:[i]}):[];M.length?h||(h=!0,o.call(this,new Qr(g,this,_.originalEvent,{features:M}))):h=!1},mouseout:()=>{h=!1}}}}if(g==="mouseleave"||g==="mouseout"){let h=!1;return{layer:i,listener:o,delegates:{mousemove:M=>{(this.getLayer(i)?this.queryRenderedFeatures(M.point,{layers:[i]}):[]).length?h=!0:h&&(h=!1,o.call(this,new Qr(g,this,M.originalEvent)))},mouseout:M=>{h&&(h=!1,o.call(this,new Qr(g,this,M.originalEvent)))}}}}{const h=f=>{const _=this.getLayer(i)?this.queryRenderedFeatures(f.point,{layers:[i]}):[];_.length&&(f.features=_,o.call(this,f),delete f.features)};return{layer:i,listener:o,delegates:{[g]:h}}}}on(g,i,o){if(o===void 0)return super.on(g,i);const h=this._createDelegatedListener(g,i,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(h);for(const f in h.delegates)this.on(f,h.delegates[f]);return this}once(g,i,o){if(o===void 0)return super.once(g,i);const h=this._createDelegatedListener(g,i,o);for(const f in h.delegates)this.once(f,h.delegates[f]);return this}off(g,i,o){return o===void 0?super.off(g,i):(this._delegatedListeners&&this._delegatedListeners[g]&&(h=>{const f=this._delegatedListeners[g];for(let _=0;_<f.length;_++){const M=f[_];if(M.layer===i&&M.listener===o){for(const S in M.delegates)this.off(S,M.delegates[S]);return f.splice(_,1),this}}})(),this)}queryRenderedFeatures(g,i){if(!this.style)return[];let o;const h=g instanceof l.P||Array.isArray(g),f=h?g:[[0,0],[this.transform.width,this.transform.height]];if(i=i||(h?{}:g)||{},f instanceof l.P||typeof f[0]=="number")o=[l.P.convert(f)];else{const _=l.P.convert(f[0]),M=l.P.convert(f[1]);o=[_,new l.P(M.x,_.y),M,new l.P(_.x,M.y),_]}return this.style.queryRenderedFeatures(o,i,this.transform)}querySourceFeatures(g,i){return this.style.querySourceFeatures(g,i)}setStyle(g,i){return(i=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},i)).diff!==!1&&i.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._updateStyle(g,i))}setTransformRequest(g){return this._requestManager.setTransformRequest(g),this}_getUIString(g){const i=this._locale[g];if(i==null)throw new Error(`Missing UI string '${g}'`);return i}_updateStyle(g,i){if(i.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(g,i));const o=this.style&&i.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!g)),g?(this.style=new xn(this,i||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g,i,o):this.style.loadJSON(g,i,o),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new xn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,i){if(typeof g=="string"){const o=this._requestManager.transformRequest(g,"Style");l.h(o,new AbortController).then(h=>{this._updateDiff(h.data,i)}).catch(h=>{h&&this.fire(new l.j(h))})}else typeof g=="object"&&this._updateDiff(g,i)}_updateDiff(g,i){try{this.style.setState(g,i)&&this._update(!0)}catch(o){l.w(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(g,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(g,i){return this._lazyInitEmptyStyle(),this.style.addSource(g,i),this._update(!0)}isSourceLoaded(g){const i=this.style&&this.style.sourceCaches[g];if(i!==void 0)return i.loaded();this.fire(new l.j(new Error(`There is no source with ID '${g}'`)))}setTerrain(g){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),g){const i=this.style.sourceCaches[g.source];if(!i)throw new Error(`cannot load terrain, because there exists no source with ID: ${g.source}`);this.terrain===null&&i.reload();for(const o in this.style._layers){const h=this.style._layers[o];h.type==="hillshade"&&h.source===g.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new ed(this.painter,i,g),this.painter.renderToTexture=new Mu(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=o=>{o.dataType==="style"?this.terrain.sourceCache.freeRtt():o.dataType==="source"&&o.tile&&(o.sourceId!==g.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(o.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new l.k("terrain",{terrain:g})),this}getTerrain(){var g,i;return(i=(g=this.terrain)===null||g===void 0?void 0:g.options)!==null&&i!==void 0?i:null}areTilesLoaded(){const g=this.style&&this.style.sourceCaches;for(const i in g){const o=g[i]._tiles;for(const h in o){const f=o[h];if(f.state!=="loaded"&&f.state!=="errored")return!1}}return!0}removeSource(g){return this.style.removeSource(g),this._update(!0)}getSource(g){return this.style.getSource(g)}addImage(g,i,o={}){const{pixelRatio:h=1,sdf:f=!1,stretchX:_,stretchY:M,content:S}=o;if(this._lazyInitEmptyStyle(),!(i instanceof HTMLImageElement||l.b(i))){if(i.width===void 0||i.height===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:C,height:k,data:F}=i,B=i;return this.style.addImage(g,{data:new l.R({width:C,height:k},new Uint8Array(F)),pixelRatio:h,stretchX:_,stretchY:M,content:S,sdf:f,version:0,userImage:B}),B.onAdd&&B.onAdd(this,g),this}}{const{width:C,height:k,data:F}=D.getImageData(i);this.style.addImage(g,{data:new l.R({width:C,height:k},F),pixelRatio:h,stretchX:_,stretchY:M,content:S,sdf:f,version:0})}}updateImage(g,i){const o=this.style.getImage(g);if(!o)return this.fire(new l.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const h=i instanceof HTMLImageElement||l.b(i)?D.getImageData(i):i,{width:f,height:_,data:M}=h;if(f===void 0||_===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(f!==o.data.width||_!==o.data.height)return this.fire(new l.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const S=!(i instanceof HTMLImageElement||l.b(i));return o.data.replace(M,S),this.style.updateImage(g,o),this}getImage(g){return this.style.getImage(g)}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new l.j(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g){return ae.getImage(this._requestManager.transformRequest(g,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(g,i){return this._lazyInitEmptyStyle(),this.style.addLayer(g,i),this._update(!0)}moveLayer(g,i){return this.style.moveLayer(g,i),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(g,i,o){return this.style.setLayerZoomRange(g,i,o),this._update(!0)}setFilter(g,i,o={}){return this.style.setFilter(g,i,o),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,i,o,h={}){return this.style.setPaintProperty(g,i,o,h),this._update(!0)}getPaintProperty(g,i){return this.style.getPaintProperty(g,i)}setLayoutProperty(g,i,o,h={}){return this.style.setLayoutProperty(g,i,o,h),this._update(!0)}getLayoutProperty(g,i){return this.style.getLayoutProperty(g,i)}setGlyphs(g,i={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(g,i),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(g,i,o={}){return this._lazyInitEmptyStyle(),this.style.addSprite(g,i,o,h=>{h||this._update(!0)}),this}removeSprite(g){return this._lazyInitEmptyStyle(),this.style.removeSprite(g),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(g,i={}){return this._lazyInitEmptyStyle(),this.style.setSprite(g,i,o=>{o||this._update(!0)}),this}setLight(g,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,i),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(g,i){return this.style.setFeatureState(g,i),this._update()}removeFeatureState(g,i){return this.style.removeFeatureState(g,i),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let g=0,i=0;return this._container&&(g=this._container.clientWidth||400,i=this._container.clientHeight||300),[g,i]}_setupContainer(){const g=this._container;g.classList.add("maplibregl-map");const i=this._canvasContainer=z.create("div","maplibregl-canvas-container",g);this._interactive&&i.classList.add("maplibregl-interactive"),this._canvas=z.create("canvas","maplibregl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const o=this._containerDimensions(),h=this._getClampedPixelRatio(o[0],o[1]);this._resizeCanvas(o[0],o[1],h);const f=this._controlContainer=z.create("div","maplibregl-control-container",g),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(M=>{_[M]=z.create("div",`maplibregl-ctrl-${M} `,f)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,i,o){this._canvas.width=Math.floor(o*g),this._canvas.height=Math.floor(o*i),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${i}px`}_setupPainter(){const g={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let i=null;this._canvas.addEventListener("webglcontextcreationerror",h=>{i={requestedAttributes:g},h&&(i.statusMessage=h.statusMessage,i.type=h.type)},{once:!0});const o=this._canvas.getContext("webgl2",g)||this._canvas.getContext("webgl",g);if(!o){const h="Failed to initialize WebGL";throw i?(i.message=h,new Error(JSON.stringify(i))):new Error(h)}this.painter=new Se(o,this.transform),Z.testSupport(o)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_render(g){const i=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),this._removed)return;let o=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const f=this.transform.zoom,_=D.now();this.style.zoomHistory.update(f,_);const M=new l.a8(f,{now:_,fadeDuration:i,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),S=M.crossFadingFactor();S===1&&S===this._crossFadingFactor||(o=!0,this._crossFadingFactor=S),this.style.update(M)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,i,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:i,showPadding:this.showPadding}),this.fire(new l.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.bc.mark(l.bd.load),this.fire(new l.k("load"))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const h=this._sourcesDirty||this._styleDirty||this._placementDirty;return h||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.k("idle")),!this._loaded||this._fullyLoaded||h||(this._fullyLoaded=!0,l.bc.mark(l.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var g;this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ae.removeThrottleControl(this._imageQueueHandle),(g=this._resizeObserver)===null||g===void 0||g.disconnect();const i=this.painter.context.gl.getExtension("WEBGL_lose_context");i&&i.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),z.remove(this._canvasContainer),z.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),l.bc.clearMetrics(),this._removed=!0,this.fire(new l.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,D.frameAsync(this._frameRequest).then(g=>{l.bc.frame(g),this._frameRequest=null,this._render(g)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get version(){return Eu}getCameraTargetElevation(){return this.transform.elevation}},m.MapMouseEvent=Qr,m.MapTouchEvent=Mn,m.MapWheelEvent=_a,m.Marker=Wl,m.NavigationControl=class{constructor(g){this._updateZoomButtons=()=>{const i=this._map.getZoom(),o=i===this._map.getMaxZoom(),h=i===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())},this._rotateCompassArrow=()=>{const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=i},this._setButtonTitle=(i,o)=>{const h=this._map._getUIString(`NavigationControl.${o}`);i.title=h,i.setAttribute("aria-label",h)},this.options=l.e({},Tu,g),this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",i=>this._map.zoomIn({},{originalEvent:i})),z.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",i=>this._map.zoomOut({},{originalEvent:i})),z.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",i=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:i}):this._map.resetNorth({},{originalEvent:i})}),this._compassIcon=z.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Cu(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){z.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(g,i){const o=z.create("button",g,this._container);return o.type="button",o.addEventListener("click",i),o}},m.Popup=class extends l.E{constructor(g){super(),this.remove=()=>(this._content&&z.remove(this._content),this._container&&(z.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.k("close"))),this),this._onMouseUp=i=>{this._update(i.point)},this._onMouseMove=i=>{this._update(i.point)},this._onDrag=i=>{this._update(i.point)},this._update=i=>{var o;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=z.create("div","maplibregl-popup",this._map.getContainer()),this._tip=z.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const S of this.options.className.split(" "))this._container.classList.add(S);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Sc(this._lngLat,this._flatPos,this._map.transform):(o=this._lngLat)===null||o===void 0?void 0:o.wrap(),this._trackPointer&&!i)return;const h=this._flatPos=this._pos=this._trackPointer&&i?i:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&i?i:this._map.transform.locationPoint(this._lngLat));let f=this.options.anchor;const _=Ac(this.options.offset);if(!f){const S=this._container.offsetWidth,C=this._container.offsetHeight;let k;k=h.y+_.bottom.y<C?["top"]:h.y>this._map.transform.height-C?["bottom"]:[],h.x<S/2?k.push("left"):h.x>this._map.transform.width-S/2&&k.push("right"),f=k.length===0?"bottom":k.join("-")}let M=h.add(_[f]);this.options.subpixelPositioning||(M=M.round()),z.setTransform(this._container,`${Zl[f]} translate(${M.x}px,${M.y}px)`),Ec(this._container,f,"popup")},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(Iu),g)}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(g){return this._lngLat=l.M.convert(g),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const i=document.createDocumentFragment(),o=document.createElement("body");let h;for(o.innerHTML=g;h=o.firstChild,h;)i.appendChild(h);return this.setDOMContent(i)}getMaxWidth(){var g;return(g=this._container)===null||g===void 0?void 0:g.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=z.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(g),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(g){this._container&&this._container.classList.add(g)}removeClassName(g){this._container&&this._container.classList.remove(g)}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){if(this._container)return this._container.classList.toggle(g)}setSubpixelPositioning(g){this.options.subpixelPositioning=g}_createCloseButton(){this.options.closeButton&&(this._closeButton=z.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(Au);g&&g.focus()}},m.RasterDEMTileSource=ut,m.RasterTileSource=ce,m.ScaleControl=class{constructor(g){this._onMove=()=>{Ic(this._map,this._container,this.options)},this.setUnit=i=>{this.options.unit=i,Ic(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Cc),g)}getDefaultPosition(){return"bottom-left"}onAdd(g){return this._map=g,this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-scale",g.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){z.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},m.ScrollZoomHandler=bc,m.Style=xn,m.TerrainControl=class{constructor(g){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=g}onAdd(g){return this._map=g,this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=z.create("button","maplibregl-ctrl-terrain",this._container),z.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){z.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},m.TwoFingersTouchPitchHandler=Xh,m.TwoFingersTouchRotateHandler=Ua,m.TwoFingersTouchZoomHandler=mo,m.TwoFingersTouchZoomRotateHandler=Vl,m.VectorTileSource=Oe,m.VideoSource=et,m.addSourceType=(g,i)=>l._(void 0,void 0,void 0,function*(){if(jt(g))throw new Error(`A source type called "${g}" already exists.`);((o,h)=>{Gt[o]=h})(g,i)}),m.clearPrewarmedResources=function(){const g=lr;g&&(g.isPreloaded()&&g.numActive()===1?(g.release(Si),lr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},m.getMaxParallelImageRequests=function(){return l.a.MAX_PARALLEL_IMAGE_REQUESTS},m.getRTLTextPluginStatus=function(){return Ue().getRTLTextPluginStatus()},m.getVersion=function(){return td},m.getWorkerCount=function(){return Ni.workerCount},m.getWorkerUrl=function(){return l.a.WORKER_URL},m.importScriptInWorkers=function(g){return lt().broadcast("IS",g)},m.prewarm=function(){Ve().acquire(Si)},m.setMaxParallelImageRequests=function(g){l.a.MAX_PARALLEL_IMAGE_REQUESTS=g},m.setRTLTextPlugin=function(g,i){return Ue().setRTLTextPlugin(g,i)},m.setWorkerCount=function(g){Ni.workerCount=g},m.setWorkerUrl=function(g){l.a.WORKER_URL=g}});var y=a;return y})})(Xx);var jL=Xx.exports;const qL=Xm(jL);var Yx={exports:{}};(function(e,r){(function(a,u){e.exports=u()})(Hc,function(){var a=function(b,A){var V={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},oe={on:function(ye,Me,Ke){if(V[ye]===void 0)throw new Error("Invalid event type: "+ye);V[ye].push({selector:Me,fn:Ke})},render:function(ye){A.store.featureChanged(ye)}},ge=function(ye,Me){for(var Ke=V[ye],at=Ke.length;at--;){var bt=Ke[at];if(bt.selector(Me)){bt.fn.call(oe,Me)||A.store.render(),A.ui.updateMapClasses();break}}};return b.start.call(oe),{render:b.render,stop:function(){b.stop&&b.stop()},trash:function(){b.trash&&(b.trash(),A.store.render())},combineFeatures:function(){b.combineFeatures&&b.combineFeatures()},uncombineFeatures:function(){b.uncombineFeatures&&b.uncombineFeatures()},drag:function(ye){ge("drag",ye)},click:function(ye){ge("click",ye)},mousemove:function(ye){ge("mousemove",ye)},mousedown:function(ye){ge("mousedown",ye)},mouseup:function(ye){ge("mouseup",ye)},mouseout:function(ye){ge("mouseout",ye)},keydown:function(ye){ge("keydown",ye)},keyup:function(ye){ge("keyup",ye)},touchstart:function(ye){ge("touchstart",ye)},touchmove:function(ye){ge("touchmove",ye)},touchend:function(ye){ge("touchend",ye)},tap:function(ye){ge("tap",ye)}}};function u(b){return b&&b.__esModule&&Object.prototype.hasOwnProperty.call(b,"default")?b.default:b}function d(b){if(b.__esModule)return b;var A=b.default;if(typeof A=="function"){var V=function oe(){if(this instanceof oe){var ge=[null];ge.push.apply(ge,arguments);var ye=Function.bind.apply(A,ge);return new ye}return A.apply(this,arguments)};V.prototype=A.prototype}else V={};return Object.defineProperty(V,"__esModule",{value:!0}),Object.keys(b).forEach(function(oe){var ge=Object.getOwnPropertyDescriptor(b,oe);Object.defineProperty(V,oe,ge.get?ge:{enumerable:!0,get:function(){return b[oe]}})}),V}var y={},m={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:63567523142e-4},l=m;function T(b){var A=0;if(b&&b.length>0){A+=Math.abs(P(b[0]));for(var V=1;V<b.length;V++)A-=Math.abs(P(b[V]))}return A}function P(b){var A,V,oe,ge,ye,Me,Ke=0,at=b.length;if(at>2){for(Me=0;Me<at;Me++)Me===at-2?(oe=at-2,ge=at-1,ye=0):Me===at-1?(oe=at-1,ge=0,ye=1):(oe=Me,ge=Me+1,ye=Me+2),A=b[oe],V=b[ge],Ke+=(R(b[ye][0])-R(A[0]))*Math.sin(R(V[1]));Ke=Ke*l.RADIUS*l.RADIUS/2}return Ke}function R(b){return b*Math.PI/180}y.geometry=function b(A){var V,oe=0;switch(A.type){case"Polygon":return T(A.coordinates);case"MultiPolygon":for(V=0;V<A.coordinates.length;V++)oe+=T(A.coordinates[V]);return oe;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(V=0;V<A.geometries.length;V++)oe+=b(A.geometries[V]);return oe}},y.ring=P;var D={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},z={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},Z={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},K={POLYGON:"polygon",LINE:"line_string",POINT:"point"},Y={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},me={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},Te={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},Fe={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},ae={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},Pe={ACTIVE:"true",INACTIVE:"false"},Ze=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],Je=-85,dt=Object.freeze({__proto__:null,classes:D,sources:z,cursors:Z,types:K,geojsonTypes:Y,modes:me,events:Te,updateActions:Fe,meta:ae,activeStates:Pe,interactions:Ze,LAT_MIN:-90,LAT_RENDERED_MIN:Je,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),_t={Point:0,LineString:1,MultiLineString:1,Polygon:2};function xt(b,A){var V=_t[b.geometry.type]-_t[A.geometry.type];return V===0&&b.geometry.type===Y.POLYGON?b.area-A.area:V}function Vt(b){return b.map(function(A){return A.geometry.type===Y.POLYGON&&(A.area=y.geometry({type:Y.FEATURE,property:{},geometry:A.geometry})),A}).sort(xt).map(function(A){return delete A.area,A})}function kt(b,A){return A===void 0&&(A=0),[[b.point.x-A,b.point.y-A],[b.point.x+A,b.point.y+A]]}function ri(b){if(this._items={},this._nums={},this._length=b?b.length:0,b)for(var A=0,V=b.length;A<V;A++)this.add(b[A]),b[A]!==void 0&&(typeof b[A]=="string"?this._items[b[A]]=A:this._nums[b[A]]=A)}ri.prototype.add=function(b){return this.has(b)||(this._length++,typeof b=="string"?this._items[b]=this._length:this._nums[b]=this._length),this},ri.prototype.delete=function(b){return this.has(b)===!1||(this._length--,delete this._items[b],delete this._nums[b]),this},ri.prototype.has=function(b){return(typeof b=="string"||typeof b=="number")&&(this._items[b]!==void 0||this._nums[b]!==void 0)},ri.prototype.values=function(){var b=this,A=[];return Object.keys(this._items).forEach(function(V){A.push({k:V,v:b._items[V]})}),Object.keys(this._nums).forEach(function(V){A.push({k:JSON.parse(V),v:b._nums[V]})}),A.sort(function(V,oe){return V.v-oe.v}).map(function(V){return V.k})},ri.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var xi=[ae.FEATURE,ae.MIDPOINT,ae.VERTEX],li={click:function(b,A,V){return xr(b,A,V,V.options.clickBuffer)},touch:function(b,A,V){return xr(b,A,V,V.options.touchBuffer)}};function xr(b,A,V,oe){if(V.map===null)return[];var ge=b?kt(b,oe):A,ye={};V.options.styles&&(ye.layers=V.options.styles.map(function(bt){return bt.id}).filter(function(bt){return V.map.getLayer(bt)!=null}));var Me=V.map.queryRenderedFeatures(ge,ye).filter(function(bt){return xi.indexOf(bt.properties.meta)!==-1}),Ke=new ri,at=[];return Me.forEach(function(bt){var wt=bt.properties.id;Ke.has(wt)||(Ke.add(wt),at.push(bt))}),Vt(at)}function si(b,A){var V=li.click(b,null,A),oe={mouse:Z.NONE};return V[0]&&(oe.mouse=V[0].properties.active===Pe.ACTIVE?Z.MOVE:Z.POINTER,oe.feature=V[0].properties.meta),A.events.currentModeName().indexOf("draw")!==-1&&(oe.mouse=Z.ADD),A.ui.queueMapClasses(oe),A.ui.updateMapClasses(),V[0]}function tt(b,A){var V=b.x-A.x,oe=b.y-A.y;return Math.sqrt(V*V+oe*oe)}function rt(b,A,V){V===void 0&&(V={});var oe=V.fineTolerance!=null?V.fineTolerance:4,ge=V.grossTolerance!=null?V.grossTolerance:12,ye=V.interval!=null?V.interval:500;b.point=b.point||A.point,b.time=b.time||A.time;var Me=tt(b.point,A.point);return Me<oe||Me<ge&&A.time-b.time<ye}function It(b,A,V){V===void 0&&(V={});var oe=V.tolerance!=null?V.tolerance:25,ge=V.interval!=null?V.interval:250;return b.point=b.point||A.point,b.time=b.time||A.time,tt(b.point,A.point)<oe&&A.time-b.time<ge}var br={exports:{}},Oi=br.exports=function(b,A){if(A||(A=16),b===void 0&&(b=128),b<=0)return"0";for(var V=Math.log(Math.pow(2,b))/Math.log(A),oe=2;V===1/0;oe*=2)V=Math.log(Math.pow(2,b/oe))/Math.log(A)*oe;var ge=V-Math.floor(V),ye="";for(oe=0;oe<Math.floor(V);oe++)ye=Math.floor(Math.random()*A).toString(A)+ye;if(ge){var Me=Math.pow(A,ge);ye=Math.floor(Math.random()*Me).toString(A)+ye}var Ke=parseInt(ye,A);return Ke!==1/0&&Ke>=Math.pow(2,b)?Oi(b,A):ye};Oi.rack=function(b,A,V){var oe=function(ye){var Me=0;do{if(Me++>10){if(!V)throw new Error("too many ID collisions, use more bits");b+=V}var Ke=Oi(b,A)}while(Object.hasOwnProperty.call(ge,Ke));return ge[Ke]=ye,Ke},ge=oe.hats={};return oe.get=function(ye){return oe.hats[ye]},oe.set=function(ye,Me){return oe.hats[ye]=Me,oe},oe.bits=b||128,oe.base=A||16,oe};var Si=u(br.exports),Ni=function(b,A){this.ctx=b,this.properties=A.properties||{},this.coordinates=A.geometry.coordinates,this.id=A.id||Si(),this.type=A.geometry.type};Ni.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},Ni.prototype.incomingCoords=function(b){this.setCoordinates(b)},Ni.prototype.setCoordinates=function(b){this.coordinates=b,this.changed()},Ni.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},Ni.prototype.setProperty=function(b,A){this.properties[b]=A},Ni.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:Y.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},Ni.prototype.internal=function(b){var A={id:this.id,meta:ae.FEATURE,"meta:type":this.type,active:Pe.INACTIVE,mode:b};if(this.ctx.options.userProperties)for(var V in this.properties)A["user_"+V]=this.properties[V];return{type:Y.FEATURE,properties:A,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var Hr=function(b,A){Ni.call(this,b,A)};(Hr.prototype=Object.create(Ni.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},Hr.prototype.updateCoordinate=function(b,A,V){this.coordinates=arguments.length===3?[A,V]:[b,A],this.changed()},Hr.prototype.getCoordinate=function(){return this.getCoordinates()};var lr=function(b,A){Ni.call(this,b,A)};(lr.prototype=Object.create(Ni.prototype)).isValid=function(){return this.coordinates.length>1},lr.prototype.addCoordinate=function(b,A,V){this.changed();var oe=parseInt(b,10);this.coordinates.splice(oe,0,[A,V])},lr.prototype.getCoordinate=function(b){var A=parseInt(b,10);return JSON.parse(JSON.stringify(this.coordinates[A]))},lr.prototype.removeCoordinate=function(b){this.changed(),this.coordinates.splice(parseInt(b,10),1)},lr.prototype.updateCoordinate=function(b,A,V){var oe=parseInt(b,10);this.coordinates[oe]=[A,V],this.changed()};var Ci=function(b,A){Ni.call(this,b,A),this.coordinates=this.coordinates.map(function(V){return V.slice(0,-1)})};(Ci.prototype=Object.create(Ni.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(b){return b.length>2})},Ci.prototype.incomingCoords=function(b){this.coordinates=b.map(function(A){return A.slice(0,-1)}),this.changed()},Ci.prototype.setCoordinates=function(b){this.coordinates=b,this.changed()},Ci.prototype.addCoordinate=function(b,A,V){this.changed();var oe=b.split(".").map(function(ge){return parseInt(ge,10)});this.coordinates[oe[0]].splice(oe[1],0,[A,V])},Ci.prototype.removeCoordinate=function(b){this.changed();var A=b.split(".").map(function(oe){return parseInt(oe,10)}),V=this.coordinates[A[0]];V&&(V.splice(A[1],1),V.length<3&&this.coordinates.splice(A[0],1))},Ci.prototype.getCoordinate=function(b){var A=b.split(".").map(function(oe){return parseInt(oe,10)}),V=this.coordinates[A[0]];return JSON.parse(JSON.stringify(V[A[1]]))},Ci.prototype.getCoordinates=function(){return this.coordinates.map(function(b){return b.concat([b[0]])})},Ci.prototype.updateCoordinate=function(b,A,V){this.changed();var oe=b.split("."),ge=parseInt(oe[0],10),ye=parseInt(oe[1],10);this.coordinates[ge]===void 0&&(this.coordinates[ge]=[]),this.coordinates[ge][ye]=[A,V]};var Ve={MultiPoint:Hr,MultiLineString:lr,MultiPolygon:Ci},St=function(b,A,V,oe,ge){var ye=V.split("."),Me=parseInt(ye[0],10),Ke=ye[1]?ye.slice(1).join("."):null;return b[Me][A](Ke,oe,ge)},lt=function(b,A){if(Ni.call(this,b,A),delete this.coordinates,this.model=Ve[A.geometry.type],this.model===void 0)throw new TypeError(A.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(A.geometry.coordinates)};function Ye(b){this.map=b.map,this.drawConfig=JSON.parse(JSON.stringify(b.options||{})),this._ctx=b}(lt.prototype=Object.create(Ni.prototype))._coordinatesToFeatures=function(b){var A=this,V=this.model.bind(this);return b.map(function(oe){return new V(A.ctx,{id:Si(),type:Y.FEATURE,properties:{},geometry:{coordinates:oe,type:A.type.replace("Multi","")}})})},lt.prototype.isValid=function(){return this.features.every(function(b){return b.isValid()})},lt.prototype.setCoordinates=function(b){this.features=this._coordinatesToFeatures(b),this.changed()},lt.prototype.getCoordinate=function(b){return St(this.features,"getCoordinate",b)},lt.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(b){return b.type===Y.POLYGON?b.getCoordinates():b.coordinates})))},lt.prototype.updateCoordinate=function(b,A,V){St(this.features,"updateCoordinate",b,A,V),this.changed()},lt.prototype.addCoordinate=function(b,A,V){St(this.features,"addCoordinate",b,A,V),this.changed()},lt.prototype.removeCoordinate=function(b){St(this.features,"removeCoordinate",b),this.changed()},lt.prototype.getFeatures=function(){return this.features},Ye.prototype.setSelected=function(b){return this._ctx.store.setSelected(b)},Ye.prototype.setSelectedCoordinates=function(b){var A=this;this._ctx.store.setSelectedCoordinates(b),b.reduce(function(V,oe){return V[oe.feature_id]===void 0&&(V[oe.feature_id]=!0,A._ctx.store.get(oe.feature_id).changed()),V},{})},Ye.prototype.getSelected=function(){return this._ctx.store.getSelected()},Ye.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},Ye.prototype.isSelected=function(b){return this._ctx.store.isSelected(b)},Ye.prototype.getFeature=function(b){return this._ctx.store.get(b)},Ye.prototype.select=function(b){return this._ctx.store.select(b)},Ye.prototype.deselect=function(b){return this._ctx.store.deselect(b)},Ye.prototype.deleteFeature=function(b,A){return A===void 0&&(A={}),this._ctx.store.delete(b,A)},Ye.prototype.addFeature=function(b){return this._ctx.store.add(b)},Ye.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},Ye.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},Ye.prototype.setActionableState=function(b){b===void 0&&(b={});var A={trash:b.trash||!1,combineFeatures:b.combineFeatures||!1,uncombineFeatures:b.uncombineFeatures||!1};return this._ctx.events.actionable(A)},Ye.prototype.changeMode=function(b,A,V){return A===void 0&&(A={}),V===void 0&&(V={}),this._ctx.events.changeMode(b,A,V)},Ye.prototype.updateUIClasses=function(b){return this._ctx.ui.queueMapClasses(b)},Ye.prototype.activateUIButton=function(b){return this._ctx.ui.setActiveButton(b)},Ye.prototype.featuresAt=function(b,A,V){if(V===void 0&&(V="click"),V!=="click"&&V!=="touch")throw new Error("invalid buffer type");return li[V](b,A,this._ctx)},Ye.prototype.newFeature=function(b){var A=b.geometry.type;return A===Y.POINT?new Hr(this._ctx,b):A===Y.LINE_STRING?new lr(this._ctx,b):A===Y.POLYGON?new Ci(this._ctx,b):new lt(this._ctx,b)},Ye.prototype.isInstanceOf=function(b,A){if(b===Y.POINT)return A instanceof Hr;if(b===Y.LINE_STRING)return A instanceof lr;if(b===Y.POLYGON)return A instanceof Ci;if(b==="MultiFeature")return A instanceof lt;throw new Error("Unknown feature class: "+b)},Ye.prototype.doRender=function(b){return this._ctx.store.featureChanged(b)},Ye.prototype.onSetup=function(){},Ye.prototype.onDrag=function(){},Ye.prototype.onClick=function(){},Ye.prototype.onMouseMove=function(){},Ye.prototype.onMouseDown=function(){},Ye.prototype.onMouseUp=function(){},Ye.prototype.onMouseOut=function(){},Ye.prototype.onKeyUp=function(){},Ye.prototype.onKeyDown=function(){},Ye.prototype.onTouchStart=function(){},Ye.prototype.onTouchMove=function(){},Ye.prototype.onTouchEnd=function(){},Ye.prototype.onTap=function(){},Ye.prototype.onStop=function(){},Ye.prototype.onTrash=function(){},Ye.prototype.onCombineFeature=function(){},Ye.prototype.onUncombineFeature=function(){},Ye.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var Ii={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},ki=Object.keys(Ii);function ne(b){var A=Object.keys(b);return function(V,oe){oe===void 0&&(oe={});var ge={},ye=A.reduce(function(Me,Ke){return Me[Ke]=b[Ke],Me},new Ye(V));return{start:function(){var Me=this;ge=ye.onSetup(oe),ki.forEach(function(Ke){var at,bt=Ii[Ke],wt=function(){return!1};b[bt]&&(wt=function(){return!0}),Me.on(Ke,wt,(at=bt,function(ht){return ye[at](ge,ht)}))})},stop:function(){ye.onStop(ge)},trash:function(){ye.onTrash(ge)},combineFeatures:function(){ye.onCombineFeatures(ge)},uncombineFeatures:function(){ye.onUncombineFeatures(ge)},render:function(Me,Ke){ye.toDisplayFeatures(ge,Me,Ke)}}}}function ue(b){return[].concat(b).filter(function(A){return A!==void 0})}function De(){var b=this;if(!(b.ctx.map&&b.ctx.map.getSource(z.HOT)!==void 0))return at();var A=b.ctx.events.currentModeName();b.ctx.ui.queueMapClasses({mode:A});var V=[],oe=[];b.isDirty?oe=b.getAllIds():(V=b.getChangedIds().filter(function(bt){return b.get(bt)!==void 0}),oe=b.sources.hot.filter(function(bt){return bt.properties.id&&V.indexOf(bt.properties.id)===-1&&b.get(bt.properties.id)!==void 0}).map(function(bt){return bt.properties.id})),b.sources.hot=[];var ge=b.sources.cold.length;b.sources.cold=b.isDirty?[]:b.sources.cold.filter(function(bt){var wt=bt.properties.id||bt.properties.parent;return V.indexOf(wt)===-1});var ye=ge!==b.sources.cold.length||oe.length>0;function Me(bt,wt){var ht=b.get(bt).internal(A);b.ctx.events.currentModeRender(ht,function(ni){b.sources[wt].push(ni)})}if(V.forEach(function(bt){return Me(bt,"hot")}),oe.forEach(function(bt){return Me(bt,"cold")}),ye&&b.ctx.map.getSource(z.COLD).setData({type:Y.FEATURE_COLLECTION,features:b.sources.cold}),b.ctx.map.getSource(z.HOT).setData({type:Y.FEATURE_COLLECTION,features:b.sources.hot}),b._emitSelectionChange&&(b.ctx.map.fire(Te.SELECTION_CHANGE,{features:b.getSelected().map(function(bt){return bt.toGeoJSON()}),points:b.getSelectedCoordinates().map(function(bt){return{type:Y.FEATURE,properties:{},geometry:{type:Y.POINT,coordinates:bt.coordinates}}})}),b._emitSelectionChange=!1),b._deletedFeaturesToEmit.length){var Ke=b._deletedFeaturesToEmit.map(function(bt){return bt.toGeoJSON()});b._deletedFeaturesToEmit=[],b.ctx.map.fire(Te.DELETE,{features:Ke})}function at(){b.isDirty=!1,b.clearChangedIds()}at(),b.ctx.map.fire(Te.RENDER,{})}function Oe(b){var A,V=this;this._features={},this._featureIds=new ri,this._selectedFeatureIds=new ri,this._selectedCoordinates=[],this._changedFeatureIds=new ri,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=b,this.sources={hot:[],cold:[]},this.render=function(){A||(A=requestAnimationFrame(function(){A=null,De.call(V)}))},this.isDirty=!1}function ce(b,A){var V=b._selectedCoordinates.filter(function(oe){return b._selectedFeatureIds.has(oe.feature_id)});b._selectedCoordinates.length===V.length||A.silent||(b._emitSelectionChange=!0),b._selectedCoordinates=V}Oe.prototype.createRenderBatch=function(){var b=this,A=this.render,V=0;return this.render=function(){V++},function(){b.render=A,V>0&&b.render()}},Oe.prototype.setDirty=function(){return this.isDirty=!0,this},Oe.prototype.featureChanged=function(b){return this._changedFeatureIds.add(b),this},Oe.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},Oe.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},Oe.prototype.getAllIds=function(){return this._featureIds.values()},Oe.prototype.add=function(b){return this.featureChanged(b.id),this._features[b.id]=b,this._featureIds.add(b.id),this},Oe.prototype.delete=function(b,A){var V=this;return A===void 0&&(A={}),ue(b).forEach(function(oe){V._featureIds.has(oe)&&(V._featureIds.delete(oe),V._selectedFeatureIds.delete(oe),A.silent||V._deletedFeaturesToEmit.indexOf(V._features[oe])===-1&&V._deletedFeaturesToEmit.push(V._features[oe]),delete V._features[oe],V.isDirty=!0)}),ce(this,A),this},Oe.prototype.get=function(b){return this._features[b]},Oe.prototype.getAll=function(){var b=this;return Object.keys(this._features).map(function(A){return b._features[A]})},Oe.prototype.select=function(b,A){var V=this;return A===void 0&&(A={}),ue(b).forEach(function(oe){V._selectedFeatureIds.has(oe)||(V._selectedFeatureIds.add(oe),V._changedFeatureIds.add(oe),A.silent||(V._emitSelectionChange=!0))}),this},Oe.prototype.deselect=function(b,A){var V=this;return A===void 0&&(A={}),ue(b).forEach(function(oe){V._selectedFeatureIds.has(oe)&&(V._selectedFeatureIds.delete(oe),V._changedFeatureIds.add(oe),A.silent||(V._emitSelectionChange=!0))}),ce(this,A),this},Oe.prototype.clearSelected=function(b){return b===void 0&&(b={}),this.deselect(this._selectedFeatureIds.values(),{silent:b.silent}),this},Oe.prototype.setSelected=function(b,A){var V=this;return A===void 0&&(A={}),b=ue(b),this.deselect(this._selectedFeatureIds.values().filter(function(oe){return b.indexOf(oe)===-1}),{silent:A.silent}),this.select(b.filter(function(oe){return!V._selectedFeatureIds.has(oe)}),{silent:A.silent}),this},Oe.prototype.setSelectedCoordinates=function(b){return this._selectedCoordinates=b,this._emitSelectionChange=!0,this},Oe.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},Oe.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},Oe.prototype.getSelected=function(){var b=this;return this._selectedFeatureIds.values().map(function(A){return b.get(A)})},Oe.prototype.getSelectedCoordinates=function(){var b=this;return this._selectedCoordinates.map(function(A){return{coordinates:b.get(A.feature_id).getCoordinate(A.coord_path)}})},Oe.prototype.isSelected=function(b){return this._selectedFeatureIds.has(b)},Oe.prototype.setFeatureProperty=function(b,A,V){this.get(b).setProperty(A,V),this.featureChanged(b)},Oe.prototype.storeMapConfig=function(){var b=this;Ze.forEach(function(A){b.ctx.map[A]&&(b._mapInitialConfig[A]=b.ctx.map[A].isEnabled())})},Oe.prototype.restoreMapConfig=function(){var b=this;Object.keys(this._mapInitialConfig).forEach(function(A){b._mapInitialConfig[A]?b.ctx.map[A].enable():b.ctx.map[A].disable()})},Oe.prototype.getInitialConfigValue=function(b){return this._mapInitialConfig[b]===void 0||this._mapInitialConfig[b]};var ut=function(){for(var b=arguments,A={},V=0;V<arguments.length;V++){var oe=b[V];for(var ge in oe)Ct.call(oe,ge)&&(A[ge]=oe[ge])}return A},Ct=Object.prototype.hasOwnProperty,Be=u(ut),it=["mode","feature","mouse"];function et(b){var A=null,V=null,oe={onRemove:function(){return b.map.off("load",oe.connect),clearInterval(V),oe.removeLayers(),b.store.restoreMapConfig(),b.ui.removeButtons(),b.events.removeEventListeners(),b.ui.clearMapClasses(),b.boxZoomInitial&&b.map.boxZoom.enable(),b.map=null,b.container=null,b.store=null,A&&A.parentNode&&A.parentNode.removeChild(A),A=null,this},connect:function(){b.map.off("load",oe.connect),clearInterval(V),oe.addLayers(),b.store.storeMapConfig(),b.events.addEventListeners()},onAdd:function(ge){var ye=ge.fire;return ge.fire=function(Me,Ke){var at=arguments;return ye.length===1&&arguments.length!==1&&(at=[Be({},{type:Me},Ke)]),ye.apply(ge,at)},b.map=ge,b.events=function(Me){var Ke=Object.keys(Me.options.modes).reduce(function(je,Rt){return je[Rt]=ne(Me.options.modes[Rt]),je},{}),at={},bt={},wt={},ht=null,ni=null;wt.drag=function(je,Rt){Rt({point:je.point,time:new Date().getTime()})?(Me.ui.queueMapClasses({mouse:Z.DRAG}),ni.drag(je)):je.originalEvent.stopPropagation()},wt.mousedrag=function(je){wt.drag(je,function(Rt){return!rt(at,Rt)})},wt.touchdrag=function(je){wt.drag(je,function(Rt){return!It(bt,Rt)})},wt.mousemove=function(je){if((je.originalEvent.buttons!==void 0?je.originalEvent.buttons:je.originalEvent.which)===1)return wt.mousedrag(je);var Rt=si(je,Me);je.featureTarget=Rt,ni.mousemove(je)},wt.mousedown=function(je){at={time:new Date().getTime(),point:je.point};var Rt=si(je,Me);je.featureTarget=Rt,ni.mousedown(je)},wt.mouseup=function(je){var Rt=si(je,Me);je.featureTarget=Rt,rt(at,{point:je.point,time:new Date().getTime()})?ni.click(je):ni.mouseup(je)},wt.mouseout=function(je){ni.mouseout(je)},wt.touchstart=function(je){if(Me.options.touchEnabled){bt={time:new Date().getTime(),point:je.point};var Rt=li.touch(je,null,Me)[0];je.featureTarget=Rt,ni.touchstart(je)}},wt.touchmove=function(je){if(Me.options.touchEnabled)return ni.touchmove(je),wt.touchdrag(je)},wt.touchend=function(je){if(je.originalEvent.preventDefault(),Me.options.touchEnabled){var Rt=li.touch(je,null,Me)[0];je.featureTarget=Rt,It(bt,{time:new Date().getTime(),point:je.point})?ni.tap(je):ni.touchend(je)}};var ur=function(je){return!(je===8||je===46||je>=48&&je<=57)};function oi(je,Rt,gi){gi===void 0&&(gi={}),ni.stop();var Sr=Ke[je];if(Sr===void 0)throw new Error(je+" is not valid");ht=je;var mr=Sr(Me,Rt);ni=a(mr,Me),gi.silent||Me.map.fire(Te.MODE_CHANGE,{mode:je}),Me.store.setDirty(),Me.store.render()}wt.keydown=function(je){(je.srcElement||je.target).classList.contains("mapboxgl-canvas")&&(je.keyCode!==8&&je.keyCode!==46||!Me.options.controls.trash?ur(je.keyCode)?ni.keydown(je):je.keyCode===49&&Me.options.controls.point?oi(me.DRAW_POINT):je.keyCode===50&&Me.options.controls.line_string?oi(me.DRAW_LINE_STRING):je.keyCode===51&&Me.options.controls.polygon&&oi(me.DRAW_POLYGON):(je.preventDefault(),ni.trash()))},wt.keyup=function(je){ur(je.keyCode)&&ni.keyup(je)},wt.zoomend=function(){Me.store.changeZoom()},wt.data=function(je){if(je.dataType==="style"){var Rt=Me.setup,gi=Me.map,Sr=Me.options,mr=Me.store;Sr.styles.some(function(da){return gi.getLayer(da.id)})||(Rt.addLayers(),mr.setDirty(),mr.render())}};var kr={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){ht=Me.options.defaultMode,ni=a(Ke[ht](Me),Me)},changeMode:oi,actionable:function(je){var Rt=!1;Object.keys(je).forEach(function(gi){if(kr[gi]===void 0)throw new Error("Invalid action type");kr[gi]!==je[gi]&&(Rt=!0),kr[gi]=je[gi]}),Rt&&Me.map.fire(Te.ACTIONABLE,{actions:kr})},currentModeName:function(){return ht},currentModeRender:function(je,Rt){return ni.render(je,Rt)},fire:function(je,Rt){wt[je]&&wt[je](Rt)},addEventListeners:function(){Me.map.on("mousemove",wt.mousemove),Me.map.on("mousedown",wt.mousedown),Me.map.on("mouseup",wt.mouseup),Me.map.on("data",wt.data),Me.map.on("touchmove",wt.touchmove),Me.map.on("touchstart",wt.touchstart),Me.map.on("touchend",wt.touchend),Me.container.addEventListener("mouseout",wt.mouseout),Me.options.keybindings&&(Me.container.addEventListener("keydown",wt.keydown),Me.container.addEventListener("keyup",wt.keyup))},removeEventListeners:function(){Me.map.off("mousemove",wt.mousemove),Me.map.off("mousedown",wt.mousedown),Me.map.off("mouseup",wt.mouseup),Me.map.off("data",wt.data),Me.map.off("touchmove",wt.touchmove),Me.map.off("touchstart",wt.touchstart),Me.map.off("touchend",wt.touchend),Me.container.removeEventListener("mouseout",wt.mouseout),Me.options.keybindings&&(Me.container.removeEventListener("keydown",wt.keydown),Me.container.removeEventListener("keyup",wt.keyup))},trash:function(je){ni.trash(je)},combineFeatures:function(){ni.combineFeatures()},uncombineFeatures:function(){ni.uncombineFeatures()},getMode:function(){return ht}}}(b),b.ui=function(Me){var Ke={},at=null,bt={mode:null,feature:null,mouse:null},wt={mode:null,feature:null,mouse:null};function ht(je){wt=Be(wt,je)}function ni(){var je,Rt;if(Me.container){var gi=[],Sr=[];it.forEach(function(mr){wt[mr]!==bt[mr]&&(gi.push(mr+"-"+bt[mr]),wt[mr]!==null&&Sr.push(mr+"-"+wt[mr]))}),gi.length>0&&(je=Me.container.classList).remove.apply(je,gi),Sr.length>0&&(Rt=Me.container.classList).add.apply(Rt,Sr),bt=Be(bt,wt)}}function ur(je,Rt){Rt===void 0&&(Rt={});var gi=document.createElement("button");return gi.className=D.CONTROL_BUTTON+" "+Rt.className,gi.setAttribute("title",Rt.title),Rt.container.appendChild(gi),gi.addEventListener("click",function(Sr){if(Sr.preventDefault(),Sr.stopPropagation(),Sr.target===at)return oi(),void Rt.onDeactivate();kr(je),Rt.onActivate()},!0),gi}function oi(){at&&(at.classList.remove(D.ACTIVE_BUTTON),at=null)}function kr(je){oi();var Rt=Ke[je];Rt&&Rt&&je!=="trash"&&(Rt.classList.add(D.ACTIVE_BUTTON),at=Rt)}return{setActiveButton:kr,queueMapClasses:ht,updateMapClasses:ni,clearMapClasses:function(){ht({mode:null,feature:null,mouse:null}),ni()},addButtons:function(){var je=Me.options.controls,Rt=document.createElement("div");return Rt.className=D.CONTROL_GROUP+" "+D.CONTROL_BASE,je&&(je[K.LINE]&&(Ke[K.LINE]=ur(K.LINE,{container:Rt,className:D.CONTROL_BUTTON_LINE,title:"LineString tool "+(Me.options.keybindings?"(l)":""),onActivate:function(){return Me.events.changeMode(me.DRAW_LINE_STRING)},onDeactivate:function(){return Me.events.trash()}})),je[K.POLYGON]&&(Ke[K.POLYGON]=ur(K.POLYGON,{container:Rt,className:D.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(Me.options.keybindings?"(p)":""),onActivate:function(){return Me.events.changeMode(me.DRAW_POLYGON)},onDeactivate:function(){return Me.events.trash()}})),je[K.POINT]&&(Ke[K.POINT]=ur(K.POINT,{container:Rt,className:D.CONTROL_BUTTON_POINT,title:"Marker tool "+(Me.options.keybindings?"(m)":""),onActivate:function(){return Me.events.changeMode(me.DRAW_POINT)},onDeactivate:function(){return Me.events.trash()}})),je.trash&&(Ke.trash=ur("trash",{container:Rt,className:D.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){Me.events.trash()}})),je.combine_features&&(Ke.combine_features=ur("combineFeatures",{container:Rt,className:D.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){Me.events.combineFeatures()}})),je.uncombine_features&&(Ke.uncombine_features=ur("uncombineFeatures",{container:Rt,className:D.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){Me.events.uncombineFeatures()}}))),Rt},removeButtons:function(){Object.keys(Ke).forEach(function(je){var Rt=Ke[je];Rt.parentNode&&Rt.parentNode.removeChild(Rt),delete Ke[je]})}}}(b),b.container=ge.getContainer(),b.store=new Oe(b),A=b.ui.addButtons(),b.options.boxSelect&&(b.boxZoomInitial=ge.boxZoom.isEnabled(),ge.boxZoom.disable(),ge.dragPan.disable(),ge.dragPan.enable()),ge.loaded()?oe.connect():(ge.on("load",oe.connect),V=setInterval(function(){ge.loaded()&&oe.connect()},16)),b.events.start(),A},addLayers:function(){b.map.addSource(z.COLD,{data:{type:Y.FEATURE_COLLECTION,features:[]},type:"geojson"}),b.map.addSource(z.HOT,{data:{type:Y.FEATURE_COLLECTION,features:[]},type:"geojson"}),b.options.styles.forEach(function(ge){b.map.addLayer(ge)}),b.store.setDirty(!0),b.store.render()},removeLayers:function(){b.options.styles.forEach(function(ge){b.map.getLayer(ge.id)&&b.map.removeLayer(ge.id)}),b.map.getSource(z.COLD)&&b.map.removeSource(z.COLD),b.map.getSource(z.HOT)&&b.map.removeSource(z.HOT)}};return b.setup=oe,oe}var At=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function Gt(b){return function(A){var V=A.featureTarget;return!!V&&!!V.properties&&V.properties.meta===b}}function jt(b){return!!b.originalEvent&&!!b.originalEvent.shiftKey&&b.originalEvent.button===0}function Zt(b){return!!b.featureTarget&&!!b.featureTarget.properties&&b.featureTarget.properties.active===Pe.ACTIVE&&b.featureTarget.properties.meta===ae.FEATURE}function fi(b){return!!b.featureTarget&&!!b.featureTarget.properties&&b.featureTarget.properties.active===Pe.INACTIVE&&b.featureTarget.properties.meta===ae.FEATURE}function bi(b){return b.featureTarget===void 0}function Ue(b){return!!b.featureTarget&&!!b.featureTarget.properties&&b.featureTarget.properties.meta===ae.FEATURE}function Ri(b){var A=b.featureTarget;return!!A&&!!A.properties&&A.properties.meta===ae.VERTEX}function Zi(b){return!!b.originalEvent&&b.originalEvent.shiftKey===!0}function pn(b){return b.keyCode===27}function wr(b){return b.keyCode===13}var nt=Object.freeze({__proto__:null,isOfMetaType:Gt,isShiftMousedown:jt,isActiveFeature:Zt,isInactiveFeature:fi,noTarget:bi,isFeature:Ue,isVertex:Ri,isShiftDown:Zi,isEscapeKey:pn,isEnterKey:wr,isTrue:function(){return!0}}),ai=Ot;function Ot(b,A){this.x=b,this.y=A}Ot.prototype={clone:function(){return new Ot(this.x,this.y)},add:function(b){return this.clone()._add(b)},sub:function(b){return this.clone()._sub(b)},multByPoint:function(b){return this.clone()._multByPoint(b)},divByPoint:function(b){return this.clone()._divByPoint(b)},mult:function(b){return this.clone()._mult(b)},div:function(b){return this.clone()._div(b)},rotate:function(b){return this.clone()._rotate(b)},rotateAround:function(b,A){return this.clone()._rotateAround(b,A)},matMult:function(b){return this.clone()._matMult(b)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(b){return this.x===b.x&&this.y===b.y},dist:function(b){return Math.sqrt(this.distSqr(b))},distSqr:function(b){var A=b.x-this.x,V=b.y-this.y;return A*A+V*V},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(b){return Math.atan2(this.y-b.y,this.x-b.x)},angleWith:function(b){return this.angleWithSep(b.x,b.y)},angleWithSep:function(b,A){return Math.atan2(this.x*A-this.y*b,this.x*b+this.y*A)},_matMult:function(b){var A=b[0]*this.x+b[1]*this.y,V=b[2]*this.x+b[3]*this.y;return this.x=A,this.y=V,this},_add:function(b){return this.x+=b.x,this.y+=b.y,this},_sub:function(b){return this.x-=b.x,this.y-=b.y,this},_mult:function(b){return this.x*=b,this.y*=b,this},_div:function(b){return this.x/=b,this.y/=b,this},_multByPoint:function(b){return this.x*=b.x,this.y*=b.y,this},_divByPoint:function(b){return this.x/=b.x,this.y/=b.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var b=this.y;return this.y=this.x,this.x=-b,this},_rotate:function(b){var A=Math.cos(b),V=Math.sin(b),oe=A*this.x-V*this.y,ge=V*this.x+A*this.y;return this.x=oe,this.y=ge,this},_rotateAround:function(b,A){var V=Math.cos(b),oe=Math.sin(b),ge=A.x+V*(this.x-A.x)-oe*(this.y-A.y),ye=A.y+oe*(this.x-A.x)+V*(this.y-A.y);return this.x=ge,this.y=ye,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ot.convert=function(b){return b instanceof Ot?b:Array.isArray(b)?new Ot(b[0],b[1]):b};var $i=u(ai);function mn(b,A){var V=A.getBoundingClientRect();return new $i(b.clientX-V.left-(A.clientLeft||0),b.clientY-V.top-(A.clientTop||0))}function Jt(b,A,V,oe){return{type:Y.FEATURE,properties:{meta:ae.VERTEX,parent:b,coord_path:V,active:oe?Pe.ACTIVE:Pe.INACTIVE},geometry:{type:Y.POINT,coordinates:A}}}function Ws(b,A,V){var oe=A.geometry.coordinates,ge=V.geometry.coordinates;if(oe[1]>85||oe[1]<Je||ge[1]>85||ge[1]<Je)return null;var ye={lng:(oe[0]+ge[0])/2,lat:(oe[1]+ge[1])/2};return{type:Y.FEATURE,properties:{meta:ae.MIDPOINT,parent:b,lng:ye.lng,lat:ye.lat,coord_path:V.properties.coord_path},geometry:{type:Y.POINT,coordinates:[ye.lng,ye.lat]}}}function Mr(b,A,V){A===void 0&&(A={}),V===void 0&&(V=null);var oe,ge=b.geometry,ye=ge.type,Me=ge.coordinates,Ke=b.properties&&b.properties.id,at=[];function bt(ht,ni){var ur="",oi=null;ht.forEach(function(kr,je){var Rt=ni!=null?ni+"."+je:String(je),gi=Jt(Ke,kr,Rt,wt(Rt));if(A.midpoints&&oi){var Sr=Ws(Ke,oi,gi);Sr&&at.push(Sr)}oi=gi;var mr=JSON.stringify(kr);ur!==mr&&at.push(gi),je===0&&(ur=mr)})}function wt(ht){return!!A.selectedPaths&&A.selectedPaths.indexOf(ht)!==-1}return ye===Y.POINT?at.push(Jt(Ke,Me,V,wt(V))):ye===Y.POLYGON?Me.forEach(function(ht,ni){bt(ht,V!==null?V+"."+ni:String(ni))}):ye===Y.LINE_STRING?bt(Me,V):ye.indexOf(Y.MULTI_PREFIX)===0&&(oe=ye.replace(Y.MULTI_PREFIX,""),Me.forEach(function(ht,ni){var ur={type:Y.FEATURE,properties:b.properties,geometry:{type:oe,coordinates:ht}};at=at.concat(Mr(ur,A,ni))})),at}var ee={enable:function(b){setTimeout(function(){b.map&&b.map.doubleClickZoom&&b._ctx&&b._ctx.store&&b._ctx.store.getInitialConfigValue&&b._ctx.store.getInitialConfigValue("doubleClickZoom")&&b.map.doubleClickZoom.enable()},0)},disable:function(b){setTimeout(function(){b.map&&b.map.doubleClickZoom&&b.map.doubleClickZoom.disable()},0)}},N={exports:{}},U=function(b){if(!b||!b.type)return null;var A=H[b.type];if(!A)return null;if(A==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:b}]};if(A==="feature")return{type:"FeatureCollection",features:[b]};if(A==="featurecollection")return b},H={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},J=u(U),_e=Object.freeze({__proto__:null,default:function b(A){switch(A&&A.type||null){case"FeatureCollection":return A.features=A.features.reduce(function(V,oe){return V.concat(b(oe))},[]),A;case"Feature":return A.geometry?b(A.geometry).map(function(V){var oe={type:"Feature",properties:JSON.parse(JSON.stringify(A.properties)),geometry:V};return A.id!==void 0&&(oe.id=A.id),oe}):[A];case"MultiPoint":return A.coordinates.map(function(V){return{type:"Point",coordinates:V}});case"MultiPolygon":return A.coordinates.map(function(V){return{type:"Polygon",coordinates:V}});case"MultiLineString":return A.coordinates.map(function(V){return{type:"LineString",coordinates:V}});case"GeometryCollection":return A.geometries.map(b).reduce(function(V,oe){return V.concat(oe)},[]);case"Point":case"Polygon":case"LineString":return[A]}}}),ve=U,we=d(_e),de=function(b){return function A(V){return Array.isArray(V)&&V.length&&typeof V[0]=="number"?[V]:V.reduce(function(oe,ge){return Array.isArray(ge)&&Array.isArray(ge[0])?oe.concat(A(ge)):(oe.push(ge),oe)},[])}(b)};we instanceof Function||(we=we.default);var Ce={exports:{}},qe=Ce.exports=function(b){return new Re(b)};function Re(b){this.value=b}function Ne(b,A,V){var oe=[],ge=[],ye=!0;return function Me(Ke){var at=V?Ft(Ke):Ke,bt={},wt=!0,ht={node:at,node_:Ke,path:[].concat(oe),parent:ge[ge.length-1],parents:ge,key:oe.slice(-1)[0],isRoot:oe.length===0,level:oe.length,circular:null,update:function(oi,kr){ht.isRoot||(ht.parent.node[ht.key]=oi),ht.node=oi,kr&&(wt=!1)},delete:function(oi){delete ht.parent.node[ht.key],oi&&(wt=!1)},remove:function(oi){ti(ht.parent.node)?ht.parent.node.splice(ht.key,1):delete ht.parent.node[ht.key],oi&&(wt=!1)},keys:null,before:function(oi){bt.before=oi},after:function(oi){bt.after=oi},pre:function(oi){bt.pre=oi},post:function(oi){bt.post=oi},stop:function(){ye=!1},block:function(){wt=!1}};if(!ye)return ht;function ni(){if(typeof ht.node=="object"&&ht.node!==null){ht.keys&&ht.node_===ht.node||(ht.keys=Ut(ht.node)),ht.isLeaf=ht.keys.length==0;for(var oi=0;oi<ge.length;oi++)if(ge[oi].node_===Ke){ht.circular=ge[oi];break}}else ht.isLeaf=!0,ht.keys=null;ht.notLeaf=!ht.isLeaf,ht.notRoot=!ht.isRoot}ni();var ur=A.call(ht,ht.node);return ur!==void 0&&ht.update&&ht.update(ur),bt.before&&bt.before.call(ht,ht.node),wt&&(typeof ht.node!="object"||ht.node===null||ht.circular||(ge.push(ht),ni(),mi(ht.keys,function(oi,kr){oe.push(oi),bt.pre&&bt.pre.call(ht,ht.node[oi],oi);var je=Me(ht.node[oi]);V&&Fi.call(ht.node,oi)&&(ht.node[oi]=je.node),je.isLast=kr==ht.keys.length-1,je.isFirst=kr==0,bt.post&&bt.post.call(ht,je),oe.pop()}),ge.pop()),bt.after&&bt.after.call(ht,ht.node)),ht}(b).node}function Ft(b){if(typeof b=="object"&&b!==null){var A;if(ti(b))A=[];else if(Qt(b)==="[object Date]")A=new Date(b.getTime?b.getTime():b);else if(function(ge){return Qt(ge)==="[object RegExp]"}(b))A=new RegExp(b);else if(function(ge){return Qt(ge)==="[object Error]"}(b))A={message:b.message};else if(function(ge){return Qt(ge)==="[object Boolean]"}(b))A=new Boolean(b);else if(function(ge){return Qt(ge)==="[object Number]"}(b))A=new Number(b);else if(function(ge){return Qt(ge)==="[object String]"}(b))A=new String(b);else if(Object.create&&Object.getPrototypeOf)A=Object.create(Object.getPrototypeOf(b));else if(b.constructor===Object)A={};else{var V=b.constructor&&b.constructor.prototype||b.__proto__||{},oe=function(){};oe.prototype=V,A=new oe}return mi(Ut(b),function(ge){A[ge]=b[ge]}),A}return b}Re.prototype.get=function(b){for(var A=this.value,V=0;V<b.length;V++){var oe=b[V];if(!A||!Fi.call(A,oe)){A=void 0;break}A=A[oe]}return A},Re.prototype.has=function(b){for(var A=this.value,V=0;V<b.length;V++){var oe=b[V];if(!A||!Fi.call(A,oe))return!1;A=A[oe]}return!0},Re.prototype.set=function(b,A){for(var V=this.value,oe=0;oe<b.length-1;oe++){var ge=b[oe];Fi.call(V,ge)||(V[ge]={}),V=V[ge]}return V[b[oe]]=A,A},Re.prototype.map=function(b){return Ne(this.value,b,!0)},Re.prototype.forEach=function(b){return this.value=Ne(this.value,b,!1),this.value},Re.prototype.reduce=function(b,A){var V=arguments.length===1,oe=V?this.value:A;return this.forEach(function(ge){this.isRoot&&V||(oe=b.call(this,oe,ge))}),oe},Re.prototype.paths=function(){var b=[];return this.forEach(function(A){b.push(this.path)}),b},Re.prototype.nodes=function(){var b=[];return this.forEach(function(A){b.push(this.node)}),b},Re.prototype.clone=function(){var b=[],A=[];return function V(oe){for(var ge=0;ge<b.length;ge++)if(b[ge]===oe)return A[ge];if(typeof oe=="object"&&oe!==null){var ye=Ft(oe);return b.push(oe),A.push(ye),mi(Ut(oe),function(Me){ye[Me]=V(oe[Me])}),b.pop(),A.pop(),ye}return oe}(this.value)};var Ut=Object.keys||function(b){var A=[];for(var V in b)A.push(V);return A};function Qt(b){return Object.prototype.toString.call(b)}var ti=Array.isArray||function(b){return Object.prototype.toString.call(b)==="[object Array]"},mi=function(b,A){if(b.forEach)return b.forEach(A);for(var V=0;V<b.length;V++)A(b[V],V,b)};mi(Ut(Re.prototype),function(b){qe[b]=function(A){var V=[].slice.call(arguments,1),oe=new Re(A);return oe[b].apply(oe,V)}});var Fi=Object.hasOwnProperty||function(b,A){return A in b},ir=Ce.exports,Or=Ht;function Ht(b){if(!(this instanceof Ht))return new Ht(b);this._bbox=b||[1/0,1/0,-1/0,-1/0],this._valid=!!b}Ht.prototype.include=function(b){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],b[0]),this._bbox[1]=Math.min(this._bbox[1],b[1]),this._bbox[2]=Math.max(this._bbox[2],b[0]),this._bbox[3]=Math.max(this._bbox[3],b[1]),this},Ht.prototype.equals=function(b){var A;return A=b instanceof Ht?b.bbox():b,this._bbox[0]==A[0]&&this._bbox[1]==A[1]&&this._bbox[2]==A[2]&&this._bbox[3]==A[3]},Ht.prototype.center=function(b){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},Ht.prototype.union=function(b){var A;return this._valid=!0,A=b instanceof Ht?b.bbox():b,this._bbox[0]=Math.min(this._bbox[0],A[0]),this._bbox[1]=Math.min(this._bbox[1],A[1]),this._bbox[2]=Math.max(this._bbox[2],A[2]),this._bbox[3]=Math.max(this._bbox[3],A[3]),this},Ht.prototype.bbox=function(){return this._valid?this._bbox:null},Ht.prototype.contains=function(b){if(!b)return this._fastContains();if(!this._valid)return null;var A=b[0],V=b[1];return this._bbox[0]<=A&&this._bbox[1]<=V&&this._bbox[2]>=A&&this._bbox[3]>=V},Ht.prototype.intersect=function(b){return this._valid?(A=b instanceof Ht?b.bbox():b,!(this._bbox[0]>A[2]||this._bbox[2]<A[0]||this._bbox[3]<A[1]||this._bbox[1]>A[3])):null;var A},Ht.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var b="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",b)},Ht.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var pr=function(b){if(!b)return[];var A=we(ve(b)),V=[];return A.features.forEach(function(oe){oe.geometry&&(V=V.concat(de(oe.geometry.coordinates)))}),V},Ur=ir,gn=Or,yn={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},Zr=Object.keys(yn);function jn(b){for(var A=gn(),V=pr(b),oe=0;oe<V.length;oe++)A.include(V[oe]);return A}N.exports=function(b){return jn(b).bbox()},N.exports.polygon=function(b){return jn(b).polygon()},N.exports.bboxify=function(b){return Ur(b).map(function(A){A&&Zr.some(function(V){return!!A[V]&&yn[V].indexOf(A.type)!==-1})&&(A.bbox=jn(A).bbox(),this.update(A))})};var fc=u(N.exports),Lo=-90;function Bi(b,A){var V=Lo,oe=90,ge=Lo,ye=90,Me=270,Ke=-270;b.forEach(function(bt){var wt=fc(bt),ht=wt[1],ni=wt[3],ur=wt[0],oi=wt[2];ht>V&&(V=ht),ni<oe&&(oe=ni),ni>ge&&(ge=ni),ht<ye&&(ye=ht),ur<Me&&(Me=ur),oi>Ke&&(Ke=oi)});var at=A;return V+at.lat>85&&(at.lat=85-V),ge+at.lat>90&&(at.lat=90-ge),oe+at.lat<-85&&(at.lat=-85-oe),ye+at.lat<Lo&&(at.lat=Lo-ye),Me+at.lng<=-270&&(at.lng+=360*Math.ceil(Math.abs(at.lng)/360)),Ke+at.lng>=270&&(at.lng-=360*Math.ceil(Math.abs(at.lng)/360)),at}function so(b,A){var V=Bi(b.map(function(oe){return oe.toGeoJSON()}),A);b.forEach(function(oe){var ge,ye=oe.getCoordinates(),Me=function(at){var bt={lng:at[0]+V.lng,lat:at[1]+V.lat};return[bt.lng,bt.lat]},Ke=function(at){return at.map(function(bt){return Me(bt)})};oe.type===Y.POINT?ge=Me(ye):oe.type===Y.LINE_STRING||oe.type===Y.MULTI_POINT?ge=ye.map(Me):oe.type===Y.POLYGON||oe.type===Y.MULTI_LINE_STRING?ge=ye.map(Ke):oe.type===Y.MULTI_POLYGON&&(ge=ye.map(function(at){return at.map(function(bt){return Ke(bt)})})),oe.incomingCoords(ge)})}var Ar={onSetup:function(b){var A=this,V={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:b.featureIds||[]};return this.setSelected(V.initiallySelectedFeatureIds.filter(function(oe){return A.getFeature(oe)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),V},fireUpdate:function(){this.map.fire(Te.UPDATE,{action:Fe.MOVE,features:this.getSelected().map(function(b){return b.toGeoJSON()})})},fireActionable:function(){var b=this,A=this.getSelected(),V=A.filter(function(Ke){return b.isInstanceOf("MultiFeature",Ke)}),oe=!1;if(A.length>1){oe=!0;var ge=A[0].type.replace("Multi","");A.forEach(function(Ke){Ke.type.replace("Multi","")!==ge&&(oe=!1)})}var ye=V.length>0,Me=A.length>0;this.setActionableState({combineFeatures:oe,uncombineFeatures:ye,trash:Me})},getUniqueIds:function(b){return b.length?b.map(function(A){return A.properties.id}).filter(function(A){return A!==void 0}).reduce(function(A,V){return A.add(V),A},new ri).values():[]},stopExtendedInteractions:function(b){b.boxSelectElement&&(b.boxSelectElement.parentNode&&b.boxSelectElement.parentNode.removeChild(b.boxSelectElement),b.boxSelectElement=null),this.map.dragPan.enable(),b.boxSelecting=!1,b.canBoxSelect=!1,b.dragMoving=!1,b.canDragMove=!1},onStop:function(){ee.enable(this)},onMouseMove:function(b,A){return Ue(A)&&b.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(b),!0},onMouseOut:function(b){return!b.dragMoving||this.fireUpdate()}};Ar.onTap=Ar.onClick=function(b,A){return bi(A)?this.clickAnywhere(b,A):Gt(ae.VERTEX)(A)?this.clickOnVertex(b,A):Ue(A)?this.clickOnFeature(b,A):void 0},Ar.clickAnywhere=function(b){var A=this,V=this.getSelectedIds();V.length&&(this.clearSelectedFeatures(),V.forEach(function(oe){return A.doRender(oe)})),ee.enable(this),this.stopExtendedInteractions(b)},Ar.clickOnVertex=function(b,A){this.changeMode(me.DIRECT_SELECT,{featureId:A.featureTarget.properties.parent,coordPath:A.featureTarget.properties.coord_path,startPos:A.lngLat}),this.updateUIClasses({mouse:Z.MOVE})},Ar.startOnActiveFeature=function(b,A){this.stopExtendedInteractions(b),this.map.dragPan.disable(),this.doRender(A.featureTarget.properties.id),b.canDragMove=!0,b.dragMoveLocation=A.lngLat},Ar.clickOnFeature=function(b,A){var V=this;ee.disable(this),this.stopExtendedInteractions(b);var oe=Zi(A),ge=this.getSelectedIds(),ye=A.featureTarget.properties.id,Me=this.isSelected(ye);if(!oe&&Me&&this.getFeature(ye).type!==Y.POINT)return this.changeMode(me.DIRECT_SELECT,{featureId:ye});Me&&oe?(this.deselect(ye),this.updateUIClasses({mouse:Z.POINTER}),ge.length===1&&ee.enable(this)):!Me&&oe?(this.select(ye),this.updateUIClasses({mouse:Z.MOVE})):Me||oe||(ge.forEach(function(Ke){return V.doRender(Ke)}),this.setSelected(ye),this.updateUIClasses({mouse:Z.MOVE})),this.doRender(ye)},Ar.onMouseDown=function(b,A){return Zt(A)?this.startOnActiveFeature(b,A):this.drawConfig.boxSelect&&jt(A)?this.startBoxSelect(b,A):void 0},Ar.startBoxSelect=function(b,A){this.stopExtendedInteractions(b),this.map.dragPan.disable(),b.boxSelectStartLocation=mn(A.originalEvent,this.map.getContainer()),b.canBoxSelect=!0},Ar.onTouchStart=function(b,A){if(Zt(A))return this.startOnActiveFeature(b,A)},Ar.onDrag=function(b,A){return b.canDragMove?this.dragMove(b,A):this.drawConfig.boxSelect&&b.canBoxSelect?this.whileBoxSelect(b,A):void 0},Ar.whileBoxSelect=function(b,A){b.boxSelecting=!0,this.updateUIClasses({mouse:Z.ADD}),b.boxSelectElement||(b.boxSelectElement=document.createElement("div"),b.boxSelectElement.classList.add(D.BOX_SELECT),this.map.getContainer().appendChild(b.boxSelectElement));var V=mn(A.originalEvent,this.map.getContainer()),oe=Math.min(b.boxSelectStartLocation.x,V.x),ge=Math.max(b.boxSelectStartLocation.x,V.x),ye=Math.min(b.boxSelectStartLocation.y,V.y),Me=Math.max(b.boxSelectStartLocation.y,V.y),Ke="translate("+oe+"px, "+ye+"px)";b.boxSelectElement.style.transform=Ke,b.boxSelectElement.style.WebkitTransform=Ke,b.boxSelectElement.style.width=ge-oe+"px",b.boxSelectElement.style.height=Me-ye+"px"},Ar.dragMove=function(b,A){b.dragMoving=!0,A.originalEvent.stopPropagation();var V={lng:A.lngLat.lng-b.dragMoveLocation.lng,lat:A.lngLat.lat-b.dragMoveLocation.lat};so(this.getSelected(),V),b.dragMoveLocation=A.lngLat},Ar.onTouchEnd=Ar.onMouseUp=function(b,A){var V=this;if(b.dragMoving)this.fireUpdate();else if(b.boxSelecting){var oe=[b.boxSelectStartLocation,mn(A.originalEvent,this.map.getContainer())],ge=this.featuresAt(null,oe,"click"),ye=this.getUniqueIds(ge).filter(function(Me){return!V.isSelected(Me)});ye.length&&(this.select(ye),ye.forEach(function(Me){return V.doRender(Me)}),this.updateUIClasses({mouse:Z.MOVE}))}this.stopExtendedInteractions(b)},Ar.toDisplayFeatures=function(b,A,V){A.properties.active=this.isSelected(A.properties.id)?Pe.ACTIVE:Pe.INACTIVE,V(A),this.fireActionable(),A.properties.active===Pe.ACTIVE&&A.geometry.type!==Y.POINT&&Mr(A).forEach(V)},Ar.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},Ar.onCombineFeatures=function(){var b=this.getSelected();if(!(b.length===0||b.length<2)){for(var A=[],V=[],oe=b[0].type.replace("Multi",""),ge=0;ge<b.length;ge++){var ye=b[ge];if(ye.type.replace("Multi","")!==oe)return;ye.type.includes("Multi")?ye.getCoordinates().forEach(function(Ke){A.push(Ke)}):A.push(ye.getCoordinates()),V.push(ye.toGeoJSON())}if(V.length>1){var Me=this.newFeature({type:Y.FEATURE,properties:V[0].properties,geometry:{type:"Multi"+oe,coordinates:A}});this.addFeature(Me),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([Me.id]),this.map.fire(Te.COMBINE_FEATURES,{createdFeatures:[Me.toGeoJSON()],deletedFeatures:V})}this.fireActionable()}},Ar.onUncombineFeatures=function(){var b=this,A=this.getSelected();if(A.length!==0){for(var V=[],oe=[],ge=function(Me){var Ke=A[Me];b.isInstanceOf("MultiFeature",Ke)&&(Ke.getFeatures().forEach(function(at){b.addFeature(at),at.properties=Ke.properties,V.push(at.toGeoJSON()),b.select([at.id])}),b.deleteFeature(Ke.id,{silent:!0}),oe.push(Ke.toGeoJSON()))},ye=0;ye<A.length;ye++)ge(ye);V.length>1&&this.map.fire(Te.UNCOMBINE_FEATURES,{createdFeatures:V,deletedFeatures:oe}),this.fireActionable()}};var An=Gt(ae.VERTEX),_n=Gt(ae.MIDPOINT),qn={fireUpdate:function(){this.map.fire(Te.UPDATE,{action:Fe.CHANGE_COORDINATES,features:this.getSelected().map(function(b){return b.toGeoJSON()})})},fireActionable:function(b){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:b.selectedCoordPaths.length>0})},startDragging:function(b,A){this.map.dragPan.disable(),b.canDragMove=!0,b.dragMoveLocation=A.lngLat},stopDragging:function(b){this.map.dragPan.enable(),b.dragMoving=!1,b.canDragMove=!1,b.dragMoveLocation=null},onVertex:function(b,A){this.startDragging(b,A);var V=A.featureTarget.properties,oe=b.selectedCoordPaths.indexOf(V.coord_path);Zi(A)||oe!==-1?Zi(A)&&oe===-1&&b.selectedCoordPaths.push(V.coord_path):b.selectedCoordPaths=[V.coord_path];var ge=this.pathsToCoordinates(b.featureId,b.selectedCoordPaths);this.setSelectedCoordinates(ge)},onMidpoint:function(b,A){this.startDragging(b,A);var V=A.featureTarget.properties;b.feature.addCoordinate(V.coord_path,V.lng,V.lat),this.fireUpdate(),b.selectedCoordPaths=[V.coord_path]},pathsToCoordinates:function(b,A){return A.map(function(V){return{feature_id:b,coord_path:V}})},onFeature:function(b,A){b.selectedCoordPaths.length===0?this.startDragging(b,A):this.stopDragging(b)},dragFeature:function(b,A,V){so(this.getSelected(),V),b.dragMoveLocation=A.lngLat},dragVertex:function(b,A,V){for(var oe=b.selectedCoordPaths.map(function(Ke){return b.feature.getCoordinate(Ke)}),ge=Bi(oe.map(function(Ke){return{type:Y.FEATURE,properties:{},geometry:{type:Y.POINT,coordinates:Ke}}}),V),ye=0;ye<oe.length;ye++){var Me=oe[ye];b.feature.updateCoordinate(b.selectedCoordPaths[ye],Me[0]+ge.lng,Me[1]+ge.lat)}},clickNoTarget:function(){this.changeMode(me.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(me.SIMPLE_SELECT)},clickActiveFeature:function(b){b.selectedCoordPaths=[],this.clearSelectedCoordinates(),b.feature.changed()},onSetup:function(b){var A=b.featureId,V=this.getFeature(A);if(!V)throw new Error("You must provide a featureId to enter direct_select mode");if(V.type===Y.POINT)throw new TypeError("direct_select mode doesn't handle point features");var oe={featureId:A,feature:V,dragMoveLocation:b.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:b.coordPath?[b.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(A,oe.selectedCoordPaths)),this.setSelected(A),ee.disable(this),this.setActionableState({trash:!0}),oe},onStop:function(){ee.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(b,A,V){b.featureId===A.properties.id?(A.properties.active=Pe.ACTIVE,V(A),Mr(A,{map:this.map,midpoints:!0,selectedPaths:b.selectedCoordPaths}).forEach(V)):(A.properties.active=Pe.INACTIVE,V(A)),this.fireActionable(b)},onTrash:function(b){b.selectedCoordPaths.sort(function(A,V){return V.localeCompare(A,"en",{numeric:!0})}).forEach(function(A){return b.feature.removeCoordinate(A)}),this.fireUpdate(),b.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(b),b.feature.isValid()===!1&&(this.deleteFeature([b.featureId]),this.changeMode(me.SIMPLE_SELECT,{}))},onMouseMove:function(b,A){var V=Zt(A),oe=An(A),ge=_n(A),ye=b.selectedCoordPaths.length===0;return V&&ye||oe&&!ye?this.updateUIClasses({mouse:Z.MOVE}):this.updateUIClasses({mouse:Z.NONE}),(oe||V||ge)&&b.dragMoving&&this.fireUpdate(),this.stopDragging(b),!0},onMouseOut:function(b){return b.dragMoving&&this.fireUpdate(),!0}};qn.onTouchStart=qn.onMouseDown=function(b,A){return An(A)?this.onVertex(b,A):Zt(A)?this.onFeature(b,A):_n(A)?this.onMidpoint(b,A):void 0},qn.onDrag=function(b,A){if(b.canDragMove===!0){b.dragMoving=!0,A.originalEvent.stopPropagation();var V={lng:A.lngLat.lng-b.dragMoveLocation.lng,lat:A.lngLat.lat-b.dragMoveLocation.lat};b.selectedCoordPaths.length>0?this.dragVertex(b,A,V):this.dragFeature(b,A,V),b.dragMoveLocation=A.lngLat}},qn.onClick=function(b,A){return bi(A)?this.clickNoTarget(b,A):Zt(A)?this.clickActiveFeature(b,A):fi(A)?this.clickInactive(b,A):void this.stopDragging(b)},qn.onTap=function(b,A){return bi(A)?this.clickNoTarget(b,A):Zt(A)?this.clickActiveFeature(b,A):fi(A)?this.clickInactive(b,A):void 0},qn.onTouchEnd=qn.onMouseUp=function(b){b.dragMoving&&this.fireUpdate(),this.stopDragging(b)};var Pr={};function vn(b,A){return!!b.lngLat&&b.lngLat.lng===A[0]&&b.lngLat.lat===A[1]}Pr.onSetup=function(){var b=this.newFeature({type:Y.FEATURE,properties:{},geometry:{type:Y.POINT,coordinates:[]}});return this.addFeature(b),this.clearSelectedFeatures(),this.updateUIClasses({mouse:Z.ADD}),this.activateUIButton(K.POINT),this.setActionableState({trash:!0}),{point:b}},Pr.stopDrawingAndRemove=function(b){this.deleteFeature([b.point.id],{silent:!0}),this.changeMode(me.SIMPLE_SELECT)},Pr.onTap=Pr.onClick=function(b,A){this.updateUIClasses({mouse:Z.MOVE}),b.point.updateCoordinate("",A.lngLat.lng,A.lngLat.lat),this.map.fire(Te.CREATE,{features:[b.point.toGeoJSON()]}),this.changeMode(me.SIMPLE_SELECT,{featureIds:[b.point.id]})},Pr.onStop=function(b){this.activateUIButton(),b.point.getCoordinate().length||this.deleteFeature([b.point.id],{silent:!0})},Pr.toDisplayFeatures=function(b,A,V){var oe=A.properties.id===b.point.id;if(A.properties.active=oe?Pe.ACTIVE:Pe.INACTIVE,!oe)return V(A)},Pr.onTrash=Pr.stopDrawingAndRemove,Pr.onKeyUp=function(b,A){if(pn(A)||wr(A))return this.stopDrawingAndRemove(b,A)};var Gn={onSetup:function(){var b=this.newFeature({type:Y.FEATURE,properties:{},geometry:{type:Y.POLYGON,coordinates:[[]]}});return this.addFeature(b),this.clearSelectedFeatures(),ee.disable(this),this.updateUIClasses({mouse:Z.ADD}),this.activateUIButton(K.POLYGON),this.setActionableState({trash:!0}),{polygon:b,currentVertexPosition:0}},clickAnywhere:function(b,A){if(b.currentVertexPosition>0&&vn(A,b.polygon.coordinates[0][b.currentVertexPosition-1]))return this.changeMode(me.SIMPLE_SELECT,{featureIds:[b.polygon.id]});this.updateUIClasses({mouse:Z.ADD}),b.polygon.updateCoordinate("0."+b.currentVertexPosition,A.lngLat.lng,A.lngLat.lat),b.currentVertexPosition++,b.polygon.updateCoordinate("0."+b.currentVertexPosition,A.lngLat.lng,A.lngLat.lat)},clickOnVertex:function(b){return this.changeMode(me.SIMPLE_SELECT,{featureIds:[b.polygon.id]})},onMouseMove:function(b,A){b.polygon.updateCoordinate("0."+b.currentVertexPosition,A.lngLat.lng,A.lngLat.lat),Ri(A)&&this.updateUIClasses({mouse:Z.POINTER})}};Gn.onTap=Gn.onClick=function(b,A){return Ri(A)?this.clickOnVertex(b,A):this.clickAnywhere(b,A)},Gn.onKeyUp=function(b,A){pn(A)?(this.deleteFeature([b.polygon.id],{silent:!0}),this.changeMode(me.SIMPLE_SELECT)):wr(A)&&this.changeMode(me.SIMPLE_SELECT,{featureIds:[b.polygon.id]})},Gn.onStop=function(b){this.updateUIClasses({mouse:Z.NONE}),ee.enable(this),this.activateUIButton(),this.getFeature(b.polygon.id)!==void 0&&(b.polygon.removeCoordinate("0."+b.currentVertexPosition),b.polygon.isValid()?this.map.fire(Te.CREATE,{features:[b.polygon.toGeoJSON()]}):(this.deleteFeature([b.polygon.id],{silent:!0}),this.changeMode(me.SIMPLE_SELECT,{},{silent:!0})))},Gn.toDisplayFeatures=function(b,A,V){var oe=A.properties.id===b.polygon.id;if(A.properties.active=oe?Pe.ACTIVE:Pe.INACTIVE,!oe)return V(A);if(A.geometry.coordinates.length!==0){var ge=A.geometry.coordinates[0].length;if(!(ge<3)){if(A.properties.meta=ae.FEATURE,V(Jt(b.polygon.id,A.geometry.coordinates[0][0],"0.0",!1)),ge>3){var ye=A.geometry.coordinates[0].length-3;V(Jt(b.polygon.id,A.geometry.coordinates[0][ye],"0."+ye,!1))}if(ge<=4){var Me=[[A.geometry.coordinates[0][0][0],A.geometry.coordinates[0][0][1]],[A.geometry.coordinates[0][1][0],A.geometry.coordinates[0][1][1]]];if(V({type:Y.FEATURE,properties:A.properties,geometry:{coordinates:Me,type:Y.LINE_STRING}}),ge===3)return}return V(A)}}},Gn.onTrash=function(b){this.deleteFeature([b.polygon.id],{silent:!0}),this.changeMode(me.SIMPLE_SELECT)};var ys={onSetup:function(b){var A,V,oe=(b=b||{}).featureId,ge="forward";if(oe){if(!(A=this.getFeature(oe)))throw new Error("Could not find a feature with the provided featureId");var ye=b.from;if(ye&&ye.type==="Feature"&&ye.geometry&&ye.geometry.type==="Point"&&(ye=ye.geometry),ye&&ye.type==="Point"&&ye.coordinates&&ye.coordinates.length===2&&(ye=ye.coordinates),!ye||!Array.isArray(ye))throw new Error("Please use the `from` property to indicate which point to continue the line from");var Me=A.coordinates.length-1;if(A.coordinates[Me][0]===ye[0]&&A.coordinates[Me][1]===ye[1])V=Me+1,A.addCoordinate.apply(A,[V].concat(A.coordinates[Me]));else{if(A.coordinates[0][0]!==ye[0]||A.coordinates[0][1]!==ye[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");ge="backwards",V=0,A.addCoordinate.apply(A,[V].concat(A.coordinates[0]))}}else A=this.newFeature({type:Y.FEATURE,properties:{},geometry:{type:Y.LINE_STRING,coordinates:[]}}),V=0,this.addFeature(A);return this.clearSelectedFeatures(),ee.disable(this),this.updateUIClasses({mouse:Z.ADD}),this.activateUIButton(K.LINE),this.setActionableState({trash:!0}),{line:A,currentVertexPosition:V,direction:ge}},clickAnywhere:function(b,A){if(b.currentVertexPosition>0&&vn(A,b.line.coordinates[b.currentVertexPosition-1])||b.direction==="backwards"&&vn(A,b.line.coordinates[b.currentVertexPosition+1]))return this.changeMode(me.SIMPLE_SELECT,{featureIds:[b.line.id]});this.updateUIClasses({mouse:Z.ADD}),b.line.updateCoordinate(b.currentVertexPosition,A.lngLat.lng,A.lngLat.lat),b.direction==="forward"?(b.currentVertexPosition++,b.line.updateCoordinate(b.currentVertexPosition,A.lngLat.lng,A.lngLat.lat)):b.line.addCoordinate(0,A.lngLat.lng,A.lngLat.lat)},clickOnVertex:function(b){return this.changeMode(me.SIMPLE_SELECT,{featureIds:[b.line.id]})},onMouseMove:function(b,A){b.line.updateCoordinate(b.currentVertexPosition,A.lngLat.lng,A.lngLat.lat),Ri(A)&&this.updateUIClasses({mouse:Z.POINTER})}};ys.onTap=ys.onClick=function(b,A){if(Ri(A))return this.clickOnVertex(b,A);this.clickAnywhere(b,A)},ys.onKeyUp=function(b,A){wr(A)?this.changeMode(me.SIMPLE_SELECT,{featureIds:[b.line.id]}):pn(A)&&(this.deleteFeature([b.line.id],{silent:!0}),this.changeMode(me.SIMPLE_SELECT))},ys.onStop=function(b){ee.enable(this),this.activateUIButton(),this.getFeature(b.line.id)!==void 0&&(b.line.removeCoordinate(""+b.currentVertexPosition),b.line.isValid()?this.map.fire(Te.CREATE,{features:[b.line.toGeoJSON()]}):(this.deleteFeature([b.line.id],{silent:!0}),this.changeMode(me.SIMPLE_SELECT,{},{silent:!0})))},ys.onTrash=function(b){this.deleteFeature([b.line.id],{silent:!0}),this.changeMode(me.SIMPLE_SELECT)},ys.toDisplayFeatures=function(b,A,V){var oe=A.properties.id===b.line.id;if(A.properties.active=oe?Pe.ACTIVE:Pe.INACTIVE,!oe)return V(A);A.geometry.coordinates.length<2||(A.properties.meta=ae.FEATURE,V(Jt(b.line.id,A.geometry.coordinates[b.direction==="forward"?A.geometry.coordinates.length-2:1],""+(b.direction==="forward"?A.geometry.coordinates.length-2:1),!1)),V(A))};var Dr={simple_select:Ar,direct_select:qn,draw_point:Pr,draw_polygon:Gn,draw_line_string:ys},ao={defaultMode:me.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:At,modes:Dr,controls:{},userProperties:!1},Xs={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},cr={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function oo(b,A){return b.map(function(V){return V.source?V:Be(V,{id:V.id+"."+A,source:A==="hot"?z.HOT:z.COLD})})}var xn={exports:{}};(function(b,A){var V="__lodash_hash_undefined__",oe=9007199254740991,ge="[object Arguments]",ye="[object Array]",Me="[object Boolean]",Ke="[object Date]",at="[object Error]",bt="[object Function]",wt="[object Map]",ht="[object Number]",ni="[object Object]",ur="[object Promise]",oi="[object RegExp]",kr="[object Set]",je="[object String]",Rt="[object Symbol]",gi="[object WeakMap]",Sr="[object ArrayBuffer]",mr="[object DataView]",da=/^\[object .+?Constructor\]$/,uo=/^(?:0|[1-9]\d*)$/,ji={};ji["[object Float32Array]"]=ji["[object Float64Array]"]=ji["[object Int8Array]"]=ji["[object Int16Array]"]=ji["[object Int32Array]"]=ji["[object Uint8Array]"]=ji["[object Uint8ClampedArray]"]=ji["[object Uint16Array]"]=ji["[object Uint32Array]"]=!0,ji[ge]=ji[ye]=ji[Sr]=ji[Me]=ji[mr]=ji[Ke]=ji[at]=ji[bt]=ji[wt]=ji[ht]=ji[ni]=ji[oi]=ji[kr]=ji[je]=ji[gi]=!1;var za=typeof Hc=="object"&&Hc&&Hc.Object===Object&&Hc,yu=typeof self=="object"&&self&&self.Object===Object&&self,Rs=za||yu||Function("return this")(),Cl=A&&!A.nodeType&&A,pc=Cl&&b&&!b.nodeType&&b,Ks=pc&&pc.exports===Cl,Oa=Ks&&za.process,dn=function(){try{return Oa&&Oa.binding&&Oa.binding("util")}catch{}}(),Jr=dn&&dn.isTypedArray;function Li(Se,Le){for(var ft=-1,qt=Se==null?0:Se.length;++ft<qt;)if(Le(Se[ft],ft,Se))return!0;return!1}function zo(Se){var Le=-1,ft=Array(Se.size);return Se.forEach(function(qt,Ji){ft[++Le]=[Ji,qt]}),ft}function Oo(Se){var Le=-1,ft=Array(Se.size);return Se.forEach(function(qt){ft[++Le]=qt}),ft}var Fo,Bo,ho,Il=Array.prototype,Al=Function.prototype,fa=Object.prototype,No=Rs["__core-js_shared__"],Pl=Al.toString,bn=fa.hasOwnProperty,mc=(Fo=/[^.]+$/.exec(No&&No.keys&&No.keys.IE_PROTO||""))?"Symbol(src)_1."+Fo:"",gc=fa.toString,_u=RegExp("^"+Pl.call(bn).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),yc=Ks?Rs.Buffer:void 0,$o=Rs.Symbol,_c=Rs.Uint8Array,Uo=fa.propertyIsEnumerable,Vo=Il.splice,zs=$o?$o.toStringTag:void 0,jo=Object.getOwnPropertySymbols,Fa=yc?yc.isBuffer:void 0,vc=(Bo=Object.keys,ho=Object,function(Se){return Bo(ho(Se))}),qo=ya(Rs,"DataView"),pa=ya(Rs,"Map"),Os=ya(Rs,"Promise"),Go=ya(Rs,"Set"),Ys=ya(Rs,"WeakMap"),_s=ya(Object,"create"),xc=Qs(qo),Dl=Qs(pa),Ai=Qs(Os),Ho=Qs(Go),vu=Qs(Ys),kl=$o?$o.prototype:void 0,ma=kl?kl.valueOf:void 0;function Yi(Se){var Le=-1,ft=Se==null?0:Se.length;for(this.clear();++Le<ft;){var qt=Se[Le];this.set(qt[0],qt[1])}}function Fs(Se){var Le=-1,ft=Se==null?0:Se.length;for(this.clear();++Le<ft;){var qt=Se[Le];this.set(qt[0],qt[1])}}function hi(Se){var Le=-1,ft=Se==null?0:Se.length;for(this.clear();++Le<ft;){var qt=Se[Le];this.set(qt[0],qt[1])}}function Ba(Se){var Le=-1,ft=Se==null?0:Se.length;for(this.__data__=new hi;++Le<ft;)this.add(Se[Le])}function zi(Se){var Le=this.__data__=new Fs(Se);this.size=Le.size}function Wi(Se,Le){var ft=Na(Se),qt=!ft&&Yo(Se),Ji=!ft&&!qt&&Fl(Se),wi=!ft&&!qt&&!Ji&&Jo(Se),dr=ft||qt||Ji||wi,Er=dr?function(Fr,ns){for(var xs=-1,fn=Array(Fr);++xs<Fr;)fn[xs]=ns(xs);return fn}(Se.length,String):[],wn=Er.length;for(var rr in Se)!Le&&!bn.call(Se,rr)||dr&&(rr=="length"||Ji&&(rr=="offset"||rr=="parent")||wi&&(rr=="buffer"||rr=="byteLength"||rr=="byteOffset")||zl(rr,wn))||Er.push(rr);return Er}function vs(Se,Le){for(var ft=Se.length;ft--;)if(Ol(Se[ft][0],Le))return ft;return-1}function Js(Se){return Se==null?Se===void 0?"[object Undefined]":"[object Null]":zs&&zs in Object(Se)?function(Le){var ft=bn.call(Le,zs),qt=Le[zs];try{Le[zs]=void 0;var Ji=!0}catch{}var wi=gc.call(Le);return Ji&&(ft?Le[zs]=qt:delete Le[zs]),wi}(Se):function(Le){return gc.call(Le)}(Se)}function Zo(Se){return Vr(Se)&&Js(Se)==ge}function Ll(Se,Le,ft,qt,Ji){return Se===Le||(Se==null||Le==null||!Vr(Se)&&!Vr(Le)?Se!=Se&&Le!=Le:function(wi,dr,Er,wn,rr,Fr){var ns=Na(wi),xs=Na(dr),fn=ns?ye:rs(wi),Rn=xs?ye:rs(dr),bs=(fn=fn==ge?ni:fn)==ni,Qr=(Rn=Rn==ge?ni:Rn)==ni,Mn=fn==Rn;if(Mn&&Fl(wi)){if(!Fl(dr))return!1;ns=!0,bs=!1}if(Mn&&!bs)return Fr||(Fr=new zi),ns||Jo(wi)?fo(wi,dr,Er,wn,rr,Fr):function(Ei,Di,el,Ms,Nl,en,zn){switch(el){case mr:if(Ei.byteLength!=Di.byteLength||Ei.byteOffset!=Di.byteOffset)return!1;Ei=Ei.buffer,Di=Di.buffer;case Sr:return!(Ei.byteLength!=Di.byteLength||!en(new _c(Ei),new _c(Di)));case Me:case Ke:case ht:return Ol(+Ei,+Di);case at:return Ei.name==Di.name&&Ei.message==Di.message;case oi:case je:return Ei==Di+"";case wt:var tn=zo;case kr:var Et=1&Ms;if(tn||(tn=Oo),Ei.size!=Di.size&&!Et)return!1;var va=zn.get(Ei);if(va)return va==Di;Ms|=2,zn.set(Ei,Di);var ss=fo(tn(Ei),tn(Di),Ms,Nl,en,zn);return zn.delete(Ei),ss;case Rt:if(ma)return ma.call(Ei)==ma.call(Di)}return!1}(wi,dr,fn,Er,wn,rr,Fr);if(!(1&Er)){var _a=bs&&bn.call(wi,"__wrapped__"),Hn=Qr&&bn.call(dr,"__wrapped__");if(_a||Hn){var ws=_a?wi.value():wi,$a=Hn?dr.value():dr;return Fr||(Fr=new zi),rr(ws,$a,Er,wn,Fr)}}return Mn?(Fr||(Fr=new zi),function(Ei,Di,el,Ms,Nl,en){var zn=1&el,tn=Rl(Ei),Et=tn.length,va=Rl(Di).length;if(Et!=va&&!zn)return!1;for(var ss=Et;ss--;){var Zn=tn[ss];if(!(zn?Zn in Di:bn.call(Di,Zn)))return!1}var $l=en.get(Ei);if($l&&en.get(Di))return $l==Di;var yt=!0;en.set(Ei,Di),en.set(Di,Ei);for(var ea=zn;++ss<Et;){var po=Ei[Zn=tn[ss]],mo=Di[Zn];if(Ms)var go=zn?Ms(mo,po,Zn,Di,Ei,en):Ms(po,mo,Zn,Ei,Di,en);if(!(go===void 0?po===mo||Nl(po,mo,el,Ms,en):go)){yt=!1;break}ea||(ea=Zn=="constructor")}if(yt&&!ea){var Ua=Ei.constructor,xa=Di.constructor;Ua==xa||!("constructor"in Ei)||!("constructor"in Di)||typeof Ua=="function"&&Ua instanceof Ua&&typeof xa=="function"&&xa instanceof xa||(yt=!1)}return en.delete(Ei),en.delete(Di),yt}(wi,dr,Er,wn,rr,Fr)):!1}(Se,Le,ft,qt,Ll,Ji))}function Wo(Se){return!(!Bs(Se)||function(Le){return!!mc&&mc in Le}(Se))&&(Bl(Se)?_u:da).test(Qs(Se))}function Xo(Se){if(ft=(Le=Se)&&Le.constructor,qt=typeof ft=="function"&&ft.prototype||fa,Le!==qt)return vc(Se);var Le,ft,qt,Ji=[];for(var wi in Object(Se))bn.call(Se,wi)&&wi!="constructor"&&Ji.push(wi);return Ji}function fo(Se,Le,ft,qt,Ji,wi){var dr=1&ft,Er=Se.length,wn=Le.length;if(Er!=wn&&!(dr&&wn>Er))return!1;var rr=wi.get(Se);if(rr&&wi.get(Le))return rr==Le;var Fr=-1,ns=!0,xs=2&ft?new Ba:void 0;for(wi.set(Se,Le),wi.set(Le,Se);++Fr<Er;){var fn=Se[Fr],Rn=Le[Fr];if(qt)var bs=dr?qt(Rn,fn,Fr,Le,Se,wi):qt(fn,Rn,Fr,Se,Le,wi);if(bs!==void 0){if(bs)continue;ns=!1;break}if(xs){if(!Li(Le,function(Qr,Mn){if(_a=Mn,!xs.has(_a)&&(fn===Qr||Ji(fn,Qr,ft,qt,wi)))return xs.push(Mn);var _a})){ns=!1;break}}else if(fn!==Rn&&!Ji(fn,Rn,ft,qt,wi)){ns=!1;break}}return wi.delete(Se),wi.delete(Le),ns}function Rl(Se){return function(Le,ft,qt){var Ji=ft(Le);return Na(Le)?Ji:function(wi,dr){for(var Er=-1,wn=dr.length,rr=wi.length;++Er<wn;)wi[rr+Er]=dr[Er];return wi}(Ji,qt(Le))}(Se,Qo,Ko)}function ga(Se,Le){var ft,qt,Ji=Se.__data__;return((qt=typeof(ft=Le))=="string"||qt=="number"||qt=="symbol"||qt=="boolean"?ft!=="__proto__":ft===null)?Ji[typeof Le=="string"?"string":"hash"]:Ji.map}function ya(Se,Le){var ft=function(qt,Ji){return qt==null?void 0:qt[Ji]}(Se,Le);return Wo(ft)?ft:void 0}Yi.prototype.clear=function(){this.__data__=_s?_s(null):{},this.size=0},Yi.prototype.delete=function(Se){var Le=this.has(Se)&&delete this.__data__[Se];return this.size-=Le?1:0,Le},Yi.prototype.get=function(Se){var Le=this.__data__;if(_s){var ft=Le[Se];return ft===V?void 0:ft}return bn.call(Le,Se)?Le[Se]:void 0},Yi.prototype.has=function(Se){var Le=this.__data__;return _s?Le[Se]!==void 0:bn.call(Le,Se)},Yi.prototype.set=function(Se,Le){var ft=this.__data__;return this.size+=this.has(Se)?0:1,ft[Se]=_s&&Le===void 0?V:Le,this},Fs.prototype.clear=function(){this.__data__=[],this.size=0},Fs.prototype.delete=function(Se){var Le=this.__data__,ft=vs(Le,Se);return!(ft<0)&&(ft==Le.length-1?Le.pop():Vo.call(Le,ft,1),--this.size,!0)},Fs.prototype.get=function(Se){var Le=this.__data__,ft=vs(Le,Se);return ft<0?void 0:Le[ft][1]},Fs.prototype.has=function(Se){return vs(this.__data__,Se)>-1},Fs.prototype.set=function(Se,Le){var ft=this.__data__,qt=vs(ft,Se);return qt<0?(++this.size,ft.push([Se,Le])):ft[qt][1]=Le,this},hi.prototype.clear=function(){this.size=0,this.__data__={hash:new Yi,map:new(pa||Fs),string:new Yi}},hi.prototype.delete=function(Se){var Le=ga(this,Se).delete(Se);return this.size-=Le?1:0,Le},hi.prototype.get=function(Se){return ga(this,Se).get(Se)},hi.prototype.has=function(Se){return ga(this,Se).has(Se)},hi.prototype.set=function(Se,Le){var ft=ga(this,Se),qt=ft.size;return ft.set(Se,Le),this.size+=ft.size==qt?0:1,this},Ba.prototype.add=Ba.prototype.push=function(Se){return this.__data__.set(Se,V),this},Ba.prototype.has=function(Se){return this.__data__.has(Se)},zi.prototype.clear=function(){this.__data__=new Fs,this.size=0},zi.prototype.delete=function(Se){var Le=this.__data__,ft=Le.delete(Se);return this.size=Le.size,ft},zi.prototype.get=function(Se){return this.__data__.get(Se)},zi.prototype.has=function(Se){return this.__data__.has(Se)},zi.prototype.set=function(Se,Le){var ft=this.__data__;if(ft instanceof Fs){var qt=ft.__data__;if(!pa||qt.length<199)return qt.push([Se,Le]),this.size=++ft.size,this;ft=this.__data__=new hi(qt)}return ft.set(Se,Le),this.size=ft.size,this};var Ko=jo?function(Se){return Se==null?[]:(Se=Object(Se),function(Le,ft){for(var qt=-1,Ji=Le==null?0:Le.length,wi=0,dr=[];++qt<Ji;){var Er=Le[qt];ft(Er,qt,Le)&&(dr[wi++]=Er)}return dr}(jo(Se),function(Le){return Uo.call(Se,Le)}))}:function(){return[]},rs=Js;function zl(Se,Le){return!!(Le=Le??oe)&&(typeof Se=="number"||uo.test(Se))&&Se>-1&&Se%1==0&&Se<Le}function Qs(Se){if(Se!=null){try{return Pl.call(Se)}catch{}try{return Se+""}catch{}}return""}function Ol(Se,Le){return Se===Le||Se!=Se&&Le!=Le}(qo&&rs(new qo(new ArrayBuffer(1)))!=mr||pa&&rs(new pa)!=wt||Os&&rs(Os.resolve())!=ur||Go&&rs(new Go)!=kr||Ys&&rs(new Ys)!=gi)&&(rs=function(Se){var Le=Js(Se),ft=Le==ni?Se.constructor:void 0,qt=ft?Qs(ft):"";if(qt)switch(qt){case xc:return mr;case Dl:return wt;case Ai:return ur;case Ho:return kr;case vu:return gi}return Le});var Yo=Zo(function(){return arguments}())?Zo:function(Se){return Vr(Se)&&bn.call(Se,"callee")&&!Uo.call(Se,"callee")},Na=Array.isArray,Fl=Fa||function(){return!1};function Bl(Se){if(!Bs(Se))return!1;var Le=Js(Se);return Le==bt||Le=="[object GeneratorFunction]"||Le=="[object AsyncFunction]"||Le=="[object Proxy]"}function hr(Se){return typeof Se=="number"&&Se>-1&&Se%1==0&&Se<=oe}function Bs(Se){var Le=typeof Se;return Se!=null&&(Le=="object"||Le=="function")}function Vr(Se){return Se!=null&&typeof Se=="object"}var Jo=Jr?function(Se){return function(Le){return Se(Le)}}(Jr):function(Se){return Vr(Se)&&hr(Se.length)&&!!ji[Js(Se)]};function Qo(Se){return(Le=Se)!=null&&hr(Le.length)&&!Bl(Le)?Wi(Se):Xo(Se);var Le}b.exports=function(Se,Le){return Ll(Se,Le)}})(xn,xn.exports);var lo=u(xn.exports);function is(b,A){return b.length===A.length&&JSON.stringify(b.map(function(V){return V}).sort())===JSON.stringify(A.map(function(V){return V}).sort())}var co={Polygon:Ci,LineString:lr,Point:Hr,MultiPolygon:lt,MultiLineString:lt,MultiPoint:lt},Ui=Object.freeze({__proto__:null,CommonSelectors:nt,constrainFeatureMovement:Bi,createMidPoint:Ws,createSupplementaryPoints:Mr,createVertex:Jt,doubleClickZoom:ee,euclideanDistance:tt,featuresAt:li,getFeatureAtAndSetCursors:si,isClick:rt,isEventAtCoordinates:vn,isTap:It,mapEventToBoundingBox:kt,ModeHandler:a,moveFeatures:so,sortFeatures:Vt,stringSetsAreEqual:is,StringSet:ri,theme:At,toDenseArray:ue}),Ro=function(b,A){var V={options:b=function(ge){ge===void 0&&(ge={});var ye=Be(ge);return ge.controls||(ye.controls={}),ge.displayControlsDefault===!1?ye.controls=Be(cr,ge.controls):ye.controls=Be(Xs,ge.controls),(ye=Be(ao,ye)).styles=oo(ye.styles,"cold").concat(oo(ye.styles,"hot")),ye}(b)};A=function(ge,ye){return ye.modes=me,ye.getFeatureIdsAt=function(Me){return li.click({point:Me},null,ge).map(function(Ke){return Ke.properties.id})},ye.getSelectedIds=function(){return ge.store.getSelectedIds()},ye.getSelected=function(){return{type:Y.FEATURE_COLLECTION,features:ge.store.getSelectedIds().map(function(Me){return ge.store.get(Me)}).map(function(Me){return Me.toGeoJSON()})}},ye.getSelectedPoints=function(){return{type:Y.FEATURE_COLLECTION,features:ge.store.getSelectedCoordinates().map(function(Me){return{type:Y.FEATURE,properties:{},geometry:{type:Y.POINT,coordinates:Me.coordinates}}})}},ye.set=function(Me){if(Me.type===void 0||Me.type!==Y.FEATURE_COLLECTION||!Array.isArray(Me.features))throw new Error("Invalid FeatureCollection");var Ke=ge.store.createRenderBatch(),at=ge.store.getAllIds().slice(),bt=ye.add(Me),wt=new ri(bt);return(at=at.filter(function(ht){return!wt.has(ht)})).length&&ye.delete(at),Ke(),bt},ye.add=function(Me){var Ke=JSON.parse(JSON.stringify(J(Me))).features.map(function(at){if(at.id=at.id||Si(),at.geometry===null)throw new Error("Invalid geometry: null");if(ge.store.get(at.id)===void 0||ge.store.get(at.id).type!==at.geometry.type){var bt=co[at.geometry.type];if(bt===void 0)throw new Error("Invalid geometry type: "+at.geometry.type+".");var wt=new bt(ge,at);ge.store.add(wt)}else{var ht=ge.store.get(at.id);ht.properties=at.properties,lo(ht.properties,at.properties)||ge.store.featureChanged(ht.id),lo(ht.getCoordinates(),at.geometry.coordinates)||ht.incomingCoords(at.geometry.coordinates)}return at.id});return ge.store.render(),Ke},ye.get=function(Me){var Ke=ge.store.get(Me);if(Ke)return Ke.toGeoJSON()},ye.getAll=function(){return{type:Y.FEATURE_COLLECTION,features:ge.store.getAll().map(function(Me){return Me.toGeoJSON()})}},ye.delete=function(Me){return ge.store.delete(Me,{silent:!0}),ye.getMode()!==me.DIRECT_SELECT||ge.store.getSelectedIds().length?ge.store.render():ge.events.changeMode(me.SIMPLE_SELECT,void 0,{silent:!0}),ye},ye.deleteAll=function(){return ge.store.delete(ge.store.getAllIds(),{silent:!0}),ye.getMode()===me.DIRECT_SELECT?ge.events.changeMode(me.SIMPLE_SELECT,void 0,{silent:!0}):ge.store.render(),ye},ye.changeMode=function(Me,Ke){return Ke===void 0&&(Ke={}),Me===me.SIMPLE_SELECT&&ye.getMode()===me.SIMPLE_SELECT?(is(Ke.featureIds||[],ge.store.getSelectedIds())||(ge.store.setSelected(Ke.featureIds,{silent:!0}),ge.store.render()),ye):(Me===me.DIRECT_SELECT&&ye.getMode()===me.DIRECT_SELECT&&Ke.featureId===ge.store.getSelectedIds()[0]||ge.events.changeMode(Me,Ke,{silent:!0}),ye)},ye.getMode=function(){return ge.events.getMode()},ye.trash=function(){return ge.events.trash({silent:!0}),ye},ye.combineFeatures=function(){return ge.events.combineFeatures({silent:!0}),ye},ye.uncombineFeatures=function(){return ge.events.uncombineFeatures({silent:!0}),ye},ye.setFeatureProperty=function(Me,Ke,at){return ge.store.setFeatureProperty(Me,Ke,at),ye},ye}(V,A),V.api=A;var oe=et(V);return A.onAdd=oe.onAdd,A.onRemove=oe.onRemove,A.types=K,A.options=b,A};function Ls(b){Ro(b,this)}return Ls.modes=Dr,Ls.constants=dt,Ls.lib=Ui,Ls})})(Yx);var GL=Yx.exports;const Ld=Xm(GL),HL=e=>(vf("data-v-acefdfcb"),e=e(),xf(),e),ZL=HL(()=>se("input",null,null,-1)),WL={__name:"AddressSearchControl",setup(e){const r=Bh(),a=ms("");return(u,d)=>(Lt(),Xt(Nr,null,[iv(se("input",{class:"input address-input",type:"text",placeholder:"Search an address","onUpdate:modelValue":d[0]||(d[0]=y=>a.value=y),onKeydown:d[1]||(d[1]=lM(y=>ar(r).replace({name:"search",query:{address:a.value}}),["enter"]))},null,544),[[aM,a.value]]),ZL,se("button",{class:"button",onClick:d[2]||(d[2]=y=>ar(r).replace({name:"search",query:{address:a.value}}))}," Search ")],64))}},XL=El(WL,[["__scopeId","data-v-acefdfcb"]]);function KL(e,r,a,u){u===void 0&&(u={});var d=Rh(e),y=Aa(d[0]),m=Aa(d[1]),l=Aa(a),T=$3(r,u.units),P=Math.asin(Math.sin(m)*Math.cos(T)+Math.cos(m)*Math.sin(T)*Math.cos(l)),R=y+Math.atan2(Math.sin(l)*Math.sin(T)*Math.cos(m),Math.cos(T)-Math.sin(m)*Math.sin(P)),D=bm(R),z=bm(P);return Lh([D,z],u.properties)}function Jx(e,r,a){if(a===void 0&&(a={}),a.final===!0)return YL(e,r);var u=Rh(e),d=Rh(r),y=Aa(u[0]),m=Aa(d[0]),l=Aa(u[1]),T=Aa(d[1]),P=Math.sin(m-y)*Math.cos(T),R=Math.cos(l)*Math.sin(T)-Math.sin(l)*Math.cos(T)*Math.cos(m-y);return bm(Math.atan2(P,R))}function YL(e,r){var a=Jx(r,e);return a=(a+180)%360,a}function m0(e,r){var a=du(e,r),u=Jx(e,r),d=KL(e,a/2,u);return d}var g0=6378137;function JL(e){return j3(e,function(r,a){return r+QL(a)},0)}function QL(e){var r=0,a;switch(e.type){case"Polygon":return y0(e.coordinates);case"MultiPolygon":for(a=0;a<e.coordinates.length;a++)r+=y0(e.coordinates[a]);return r;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function y0(e){var r=0;if(e&&e.length>0){r+=Math.abs(_0(e[0]));for(var a=1;a<e.length;a++)r-=Math.abs(_0(e[a]))}return r}function _0(e){var r,a,u,d,y,m,l,T=0,P=e.length;if(P>2){for(l=0;l<P;l++)l===P-2?(d=P-2,y=P-1,m=0):l===P-1?(d=P-1,y=0,m=1):(d=l,y=l+1,m=l+2),r=e[d],a=e[y],u=e[m],T+=(Zp(u[0])-Zp(r[0]))*Math.sin(Zp(a[1]));T=T*g0*g0/2}return T}function Zp(e){return e*Math.PI/180}const eR={name:"DistanceMeasureControl",props:{position:{type:String,default:"bottom-left"}},data(){return{mode:"simple_select",selected:null,toggledOn:!1,currentShape:null,currentArea:null,labelLayers:[]}},computed:{publicPath(){return"/vue3-atlas2/"},currentOrSelectedShape(){let e;return this.$data.selected?e=this.$data.selected:this.currentShape&&(e=this.currentShape),e},newArea(){let e=this.$data.labelLayers.filter(a=>a.id===this.currentOrSelectedShape);console.log("newArea is recalculating, shape:",e,"this.currentOrSelectedShape:",this.currentOrSelectedShape);let r;return e[0]&&(r=e[0].area),r},currentDistances(){console.log("currentDistances is recalculating");let e=this.$data.labelLayers.filter(a=>a.id===this.currentOrSelectedShape),r;return e[0]&&(r=e[0].distances),r},currentTotalLength(){let e=0;for(let r of this.currentDistances)e=e+r.distance;return e.toFixed(2)+" Ft"},shouldShowDistanceBox(){let e=this.$data.mode!=="simple_select",r=this.$data.selected!==null,a=this.$data.toggledOn,u;return e&&a||r&&a?u=!0:u=!1,u}},methods:{handleDeleteClick(e){const r=Hs();let a=this.labelLayers.indexOf(this.labelLayers.filter(u=>u.id===this.currentShape)[0]);this.labelLayers.splice(a,1),r.draw.delete(this.$data.selected),this.$data.selected=null},deleteDrawDistances(e){let r=this.currentShape.indexOf(this.currentShape.filter(a=>a.id===e)[0]);this.currentShape.splice(r,1),this.$data.selected=null},getDrawDistances(e){console.log("start of getDrawDistances, e:",e);let a=Hs().draw,u=a.getAll(),d,y,m;e&&e.point?(y=e.point,m=a.getFeatureIdsAt(y)[0],m||(m=u.features[u.features.length-1].id)):e&&e.features&&e.features.length&&(m=e.features[0].id),this.currentShape=m;let l,T;if(console.log("shapeId:",m,"draw.getSelectedIds():",a.getSelectedIds()),m?(l=u.features.filter(z=>z.id===m)[0],console.log("if shapeId:",m,"feature:",l,"feature,geometry.coordinates.length:",l.geometry.coordinates.length),l.geometry.type==="LineString"?(d=l.geometry.coordinates,console.log("its a linestring, coordinates.length:",d.length)):(console.log("its not a linestring"),d=l.geometry.coordinates[0])):(l=u.features[u.features.length-1],l&&l.geometry&&l.geometry.type==="LineString"?(console.log("its a linestring"),d=l.geometry.coordinates):l&&l.geometry&&(console.log("its not a linestring"),d=l.geometry.coordinates[0])),console.log("middle of getDrawDistances, draw:",a,"shapeId:",m,"e:",e,"mode is draw_polygon, data:",u,"coordinates:",d),e&&e.point&&(console.log("if e.point is running"),d.splice(d.length-2,1)),l&&l.geometry&&l.geometry.type==="LineString"&&(console.log("if feature.geometry.type === LineString is running"),d.splice(0,1)),d&&d.length>=4){const z=jx([d]),Z=U3(JL(z),"meters","feet");console.log("calculating the area:",Z),T=Z.toFixed(2)+" Sq Feet"}let P,R=[],D=[];if(d)for(P=0;P<d.length;P++){let z=0,Z=null,K=[],Y=[],me;if(d[P+1]?me=d[P+1]:me=d[0],z=parseFloat((du(d[P],me,{units:"miles"})*5280).toFixed(2)),d[P-1]&&(Z=parseFloat((du(d[P-1],d[P],{units:"miles"})*5280).toFixed(2))),Y={firstPoint:[parseFloat(d[P][0].toFixed(5)),parseFloat(d[P][1].toFixed(5))],midPoint:K,distance:Z},R.push(Y),e.point&&d[P][0]!==me[0]&&P<d.length-2&&(K=m0(d[P],me).geometry.coordinates,D.push({type:"Feature",properties:{description:z},geometry:{type:"Point",coordinates:K}})),!e.point&&d[P][0]!==me[0]&&P<d.length-1&&(K=m0(d[P],me).geometry.coordinates,D.push({type:"Feature",properties:{description:z},geometry:{type:"Point",coordinates:K}})),e.point&&P===d.length-2)break}if(console.log("near end of getDrawDistances, currentArea:",T,"distancesArray.length:",R.length,"distancesArray:",R,"features:",D),R.length){let z={};if(m){console.log("if inside if is running, currentArea:",T,"distancesArray[distancesArray.length-1].distance:",R[R.length-1].distance,"distancesArray:",R),z={id:m,area:T,distances:R,source:{type:"geojson",data:{type:"FeatureCollection",features:[]}},layer:{id:m,type:"symbol",source:m,paint:{"text-color":"red"},layout:{"text-size":12,"text-font":["Open Sans Regular"],"text-field":["get","description"],"text-variable-anchor":["center"],"text-radial-offset":.5,"text-justify":"center"}}};let Z=this.labelLayers.filter(K=>K.id===m)[0];Z||(this.labelLayers.push(z),Z=this.labelLayers.filter(K=>K.id===m)[0]),Z.area=T,Z.distances=R,Z.source.data.features=D}}},handleDrawModeChange(e){console.log("handleDrawModeChange is running, e:",e,"e.mode:",e.mode),this.$data.mode=e.mode,e.mode==="draw_polygon"&&(this.$data.toggledOn=!0),this.currentShape},handleDrawCancel(e){console.log("handleDrawCancel is running, e:",e,"this.currentShape:",this.$data.currentShape);const r=Hs();let a=this.currentShape;if(console.log("handleDrawCancel is running, shapeId:",a),a){let u=this.$data.labelLayers.indexOf(this.$data.labelLayers.filter(d=>d.id===a)[0]);this.$data.labelLayers.splice(u,1),r.draw.delete(this.currentShape),this.$data.currentShape=null}r.draw.changeMode("simple_select"),this.$data.toggledOn=!1},handleDrawFinish(e){const r=Hs();let a=this.$data.currentShape,u=this.$data.labelLayers.filter(y=>y.id===this.currentShape)[0].distances;console.log("MapPanel.vue handleDrawFinish 1 is running, MapStore.draw.getMode():",r.draw.getMode(),"currentShape:",a,"fetchedPoints:",u);let d=[];for(let y of u)d.push(y.firstPoint);if(d.length>1&&d.push(u[0].firstPoint),u.length>2)r.draw.changeMode("simple_select"),this.$data.mode="simple_select";else if(u.length===2){r.draw.delete(this.currentShape),r.draw.changeMode("draw_line_string");let y={type:"Feature",geometry:{type:"LineString",coordinates:d},id:this.currentShape,properties:{}};r.draw.add(y),r.draw.changeMode("simple_select"),this.$data.mode="simple_select"}else if(u.length===1){r.draw.delete(this.currentShape),r.draw.changeMode("draw_point");let y={type:"Feature",geometry:{type:"Point",coordinates:d[0]},id:this.currentShape,properties:{}};r.draw.add(y),r.draw.changeMode("simple_select"),this.$data.mode="simple_select"}else r.draw.trash(),this.handleDrawCancel();console.log("MapPanel.vue handleDrawFinish 2 is running, MapStore.draw.getMode():",r.draw.getMode(),"currentShape:",a,"fetchedPoints:",u)},handleDrawSelectionChange(e){let u=Hs().draw.getSelectedIds();console.log("handleDrawSelectionChange, e:",e,"val:",u),e.features[0]?(console.log("there are features"),this.$data.selected=u[0]):(console.log("there are no features"),this.$data.selected=null)}}},tR={key:0,class:Co("measure-tool-popup-bottom-right")},iR={key:0},rR=se("div",{class:"measure-tool-header"}," Measure distances and areas ",-1),nR=se("div",{class:"measure-tool-description"}," Start creating a measurement by adding points to the map. ",-1),sR=se("hr",{class:"popup-line"},null,-1),aR=["src"],oR={key:1},lR=se("tr",null,[se("th",null,"lat"),se("th",null,"lng"),se("th",null,"distance (ft)")],-1),cR=se("hr",{class:"popup-line"},null,-1),uR={key:0},hR=se("hr",{class:"popup-line"},null,-1),dR={key:1},fR=se("hr",{class:"popup-line"},null,-1),pR={key:2,class:"drawn-shape-actions"},mR=["src"],gR={key:3,class:"draw-actions"},yR=["src"],_R=["src"];function vR(e,r,a,u,d,y){return Lt(),Xt("div",null,[y.shouldShowDistanceBox?(Lt(),Xt("div",tR,[y.currentDistances?Ki("",!0):(Lt(),Xt("div",iR,[rR,nR,sR,se("div",null,[se("img",{src:y.publicPath+"images/cancel.png",class:"img-class",alt:"cancel",onClick:r[0]||(r[0]=(...m)=>y.handleDrawCancel&&y.handleDrawCancel(...m))},null,8,aR),se("div",{class:"inline-block-div",onClick:r[1]||(r[1]=(...m)=>y.handleDrawCancel&&y.handleDrawCancel(...m))}," Cancel ")])])),y.currentDistances?(Lt(),Xt("div",oR,[se("table",null,[lR,(Lt(!0),Xt(Nr,null,Ca(y.currentDistances,(m,l)=>(Lt(),Xt("tr",{key:l},[se("td",null,ei(m.firstPoint[1]),1),se("td",null,ei(m.firstPoint[0]),1),se("td",null,ei(m.distance),1)]))),128))]),cR,y.currentDistances.length>=2?(Lt(),Xt("div",uR,[Jd(" Total Length: "+ei(y.currentTotalLength)+" ",1),hR])):Ki("",!0),y.currentDistances.length>=3?(Lt(),Xt("div",dR,[Jd(" Total Area: "+ei(y.newArea)+" ",1),fR])):Ki("",!0),e.mode==="simple_select"?(Lt(),Xt("div",pR,[se("img",{src:y.publicPath+"images/trash.png",class:"img-class",alt:"trash",onClick:r[2]||(r[2]=(...m)=>y.handleDeleteClick&&y.handleDeleteClick(...m))},null,8,mR),se("div",{class:"inline-block-div",onClick:r[3]||(r[3]=(...m)=>y.handleDeleteClick&&y.handleDeleteClick(...m))}," Delete ")])):Ki("",!0),e.mode!=="simple_select"?(Lt(),Xt("div",gR,[se("img",{src:y.publicPath+"images/cancel.png",class:"img-class",alt:"cancel",onClick:r[4]||(r[4]=(...m)=>y.handleDrawCancel&&y.handleDrawCancel(...m))},null,8,yR),se("div",{class:"inline-block-div",onClick:r[5]||(r[5]=(...m)=>y.handleDrawCancel&&y.handleDrawCancel(...m))}," Cancel "),se("img",{src:y.publicPath+"images/check.png",class:"img-class",alt:"finish",onClick:r[6]||(r[6]=(...m)=>y.handleDrawFinish&&y.handleDrawFinish(...m))},null,8,_R),se("div",{class:"inline-block-div",onClick:r[7]||(r[7]=(...m)=>y.handleDrawFinish&&y.handleDrawFinish(...m))}," Finish Measurement ")])):Ki("",!0)])):Ki("",!0)])):Ki("",!0)])}const xR=El(eR,[["render",vR]]),bR={class:"imagery-toggle"},wR=["src"],MR={__name:"ImageryToggleControl",emits:["toggleImagery"],setup(e){const r=Hs(),a=Gi(()=>r.imageryOn?"/vue3-atlas2/images/basemap_small.png":"/vue3-atlas2/images/imagery_small.png");return(u,d)=>(Lt(),Xt("div",bR,[se("button",{type:"button",onClick:d[0]||(d[0]=y=>u.$emit("toggleImagery"))},[se("img",{class:"img-src",src:a.value},null,8,wR)])]))}},SR=El(MR,[["__scopeId","data-v-b293f6b5"]]),ER={class:"dropdown-trigger"},TR={class:"button","aria-haspopup":"true","aria-controls":"dropdown-menu"},CR=se("span",{class:"icon is-small"},[se("i",{class:"fas fa-angle-down","aria-hidden":"true"})],-1),IR={class:"dropdown-menu",id:"dropdown-menu",role:"menu"},AR={class:"dropdown-content"},PR={__name:"ImageryDropdownControl",emits:["setImagery"],setup(e,{emit:r}){Hs();const a=r,u=ms("2023"),d=ms(!1),y=()=>d.value=!d.value,m=l=>{u.value=l,a("setImagery",l),d.value=!1};return(l,T)=>(Lt(),Xt("div",{class:Co([d.value?"is-active":"","imagery-dropdown dropdown"]),onClick:y},[se("div",ER,[se("button",TR,[se("span",null,ei(u.value),1),CR])]),se("div",IR,[se("div",AR,[se("a",{class:"dropdown-item",onClick:T[0]||(T[0]=P=>m("2023"))},"2023"),se("a",{class:"dropdown-item",onClick:T[1]||(T[1]=P=>m("2022"))},"2022"),se("a",{class:"dropdown-item",onClick:T[2]||(T[2]=P=>m("2020"))},"2020"),se("a",{class:"dropdown-item",onClick:T[3]||(T[3]=P=>m("2019"))},"2019"),se("a",{class:"dropdown-item",onClick:T[4]||(T[4]=P=>m("2018"))},"2018"),se("a",{class:"dropdown-item",onClick:T[5]||(T[5]=P=>m("2017"))},"2017"),se("a",{class:"dropdown-item",onClick:T[6]||(T[6]=P=>m("2016"))},"2016"),se("a",{class:"dropdown-item",onClick:T[7]||(T[7]=P=>m("2015"))},"2015"),se("a",{class:"dropdown-item",onClick:T[8]||(T[8]=P=>m("2012"))},"2012"),se("a",{class:"dropdown-item",onClick:T[9]||(T[9]=P=>m("2010"))},"2010"),se("a",{class:"dropdown-item",onClick:T[10]||(T[10]=P=>m("2008"))},"2008"),se("a",{class:"dropdown-item",onClick:T[11]||(T[11]=P=>m("2004"))},"2004"),se("a",{class:"dropdown-item",onClick:T[12]||(T[12]=P=>m("1996"))},"1996"),se("a",{class:"dropdown-item",onClick:T[13]||(T[13]=P=>m("1962"))},"1962"),se("a",{class:"dropdown-item",onClick:T[14]||(T[14]=P=>m("1942"))},"1942"),se("a",{class:"dropdown-item",onClick:T[15]||(T[15]=P=>m("1910"))},"1910"),se("a",{class:"dropdown-item",onClick:T[16]||(T[16]=P=>m("1895"))},"1895"),se("a",{class:"dropdown-item",onClick:T[17]||(T[17]=P=>m("1875"))},"1875"),se("a",{class:"dropdown-item",onClick:T[18]||(T[18]=P=>m("1860"))},"1860")])])],2))}},DR={id:"map",class:"map-class"},kR={__name:"Map",setup(e){console.log("Map.vue $config:",ps);const r=Hs(),a=ha(),u=Ln(),d=Vh(),y=Nh(),m=Bh();let l;const T=Gi(()=>u.addressData.features?u.addressData.features[0].geometry.coordinates:[]),P=Gi(()=>d.dor.features?d.dor.features[0].geometry.coordinates[0]:[]);la(()=>T.value,ae=>{console.log("Map pwdCoordinates watch, newCoords:",ae,"MapStore.addressMarker:",r.addressMarker);const Pe={type:"Feature",geometry:{type:"Point",coordinates:ae}};l.getSource("addressMarker").setData(Pe)}),la(()=>P.value,ae=>{console.log("Map dorCoordinates watch, newCoords:",ae);const Pe={type:"Feature",geometry:{type:"Polygon",coordinates:[ae]}};l.getSource("dorParcel").setData(Pe)}),la(()=>y.params.topic,async ae=>{if(console.log("Map route.params.topic watch, newTopic:",ae),ae){l.setStyle(ps[ps.topicStyles[ae]]);const Pe=l.getSource("addressMarker"),Ze=l.getSource("dorParcel");Pe&&Ze&&(Pe.setData({type:"Feature",geometry:{type:"Point",coordinates:T.value}}),Ze.setData({type:"Feature",geometry:{type:"Polygon",coordinates:[P.value]}}))}}),la(()=>u.addressData,async ae=>{console.log("MapStore route.params.address watch, newAddress:",ae);const Pe=ae.features[0].geometry.coordinates;a.lastSearchMethod==="address"&&(l.setCenter(Pe),l.setZoom(17))});const R=ms({mode:null,selection:null,currentShape:null,labelLayers:[],currentArea:null}),D=ms(null);Oh(async()=>{console.log("Map.vue onMounted route.params.topic:",y.params.topic,"route.params.address:",y.params.address);let ae;y.params.topic?ae=ps.topicStyles[y.params.topic]:ae="pwdDrawnMapStyle";let Pe;y.params.address?Pe=17:Pe=12,l=new qL.Map({container:"map",style:ps[ae],center:[-75.163471,39.953338],zoom:Pe,minZoom:6,maxZoom:22,attributionControl:!1});const Je=await l.loadImage("https://docs.mapbox.com/mapbox-gl-js/assets/custom_marker.png");l.addImage("custom-marker",Je.data),l.on("click",(xt,Vt)=>{console.log("e:",xt,"data:",Vt,"drawInfo.mode:",R.mode,_t.getMode());let kt=R.mode,ri=r.map.queryRenderedFeatures(xt.point).filter(xi=>["mapbox-gl-draw-cold","mapbox-gl-draw-hot"].includes(xi.source));console.log("Map.vue handleMapClick, e:",xt,"drawLayers:",ri,"drawMode:",kt,"e:",xt,"MapStore.map.getStyle():",r.map.getStyle(),"MapStore.drawStart:",r.drawStart),!ri.length&&_t.getMode()!=="draw_polygon"&&m.push({name:"search",query:{lng:xt.lngLat.lng,lat:xt.lngLat.lat}}),_t.getMode()==="draw_polygon"&&D.value.getDrawDistances(xt)});let dt=null;l.on("mouseenter","nearby",xt=>{xt.features.length>0&&(console.log("map.getSource(nearby):",l.getSource("nearby"),"map.getStyle().sources:",l.getStyle().sources),dt=xt.features[0].properties.id,console.log("mouse on Feature hoveredStateId:",dt),l.setPaintProperty("nearby","circle-color",["match",["get","id"],dt,"#FFFF00","#FF0000"]))}),l.on("mouseleave","nearby",()=>{dt&&(console.log("mouse leave Feature hoveredStateId:",dt),l.setPaintProperty("nearby","circle-color","#FF0000")),dt=null}),Ld.constants.classes.CONTROL_BASE="maplibregl-ctrl",Ld.constants.classes.CONTROL_PREFIX="maplibregl-ctrl-",Ld.constants.classes.CONTROL_GROUP="maplibregl-ctrl-group";const _t=new Ld({displayControlsDefault:!1,controls:{polygon:!0}});r.draw=_t,l.addControl(_t,"bottom-right"),l.on("draw.create",z),l.on("draw.selectionchange",Z),l.on("draw.finish",K),l.on("draw.modechange",Y),r.setMap(l)});const z=ae=>{console.log("drawCreate is running, e",ae),D.value.getDrawDistances(ae)},Z=ae=>{console.log("drawSelectionChange is running, e:",ae),D.value.handleDrawSelectionChange(ae)},K=()=>{console.log("drawFinish is running"),R.mode="simple_select"},Y=ae=>{console.log("drawModeChange is running, e",ae),R.mode=ae.mode,D.value.handleDrawModeChange(ae)},me=Gi(()=>r.imagerySelected),Te=()=>{console.log("toggleImagery, map.getStyle:",l.getStyle()),l.getStyle(),r.imageryOn?(console.log("map.getStyle().layers:",l.getStyle().layers),r.imageryOn=!1,l.removeLayer(me.value),l.removeLayer("imageryLabels")):(r.imageryOn=!0,l.addLayer(ps.mapLayers[me.value],"addressMarker"),l.addLayer(ps.mapLayers.imageryLabels,"addressMarker"))},Fe=async ae=>{const Pe=me.value;console.log("setImagery, newImagery:",ae,"oldLayer:",Pe,"imagerySelected.value:",me.value),r.imagerySelected=ae,await l.addLayer(ps.mapLayers[me.value],"addressMarker"),l.removeLayer(Pe)};return(ae,Pe)=>(Lt(),Xt("div",DR,[or(XL),or(SR,{onToggleImagery:Te}),ar(r).imageryOn?(Lt(),Ka(PR,{key:0,onSetImagery:Fe})):Ki("",!0),or(xR,{ref_key:"distanceMeasureControlRef",ref:D},null,512)]))}},LR=El(kR,[["__scopeId","data-v-c39d3748"]]),RR={id:"map-panel"},zR={__name:"MapPanel",setup(e){return Hs(),(r,a)=>(Lt(),Xt("div",RR,[or(LR)]))}},OR=se("div",{class:"container"},[se("h1",{class:"title is-1"},"Vue3 Atlas")],-1),FR={class:"small-container"},BR={class:"columns"},NR={class:"column is-6 pr-0 pb-0"},$R={class:"column is-6 p-0 p-0"},rc={__name:"App",setup(e){console.log("import.meta.env.VITE_PUBLICPATH:","/vue3-atlas2/");const r=ha(),a=Nh(),u=Bh();return ms(""),Oh(async()=>{await u.isReady(),console.log("App onMounted, route.params.topic:",a.params.topic,"route.params.address:",a.params.address),a.name==="not-found"&&u.push({name:"home"}),a.params.topic&&(r.currentTopic=a.params.topic)}),(d,y)=>(Lt(),Xt("main",null,[OR,se("div",FR,[se("div",BR,[se("div",NR,[or(VL)]),se("div",$R,[or(zR)])])])]))}},UR="modulepreload",VR=function(e){return"/vue3-atlas2/"+e},v0={},jR=function(r,a,u){let d=Promise.resolve();if(a&&a.length>0){const y=document.getElementsByTagName("link"),m=document.querySelector("meta[property=csp-nonce]"),l=(m==null?void 0:m.nonce)||(m==null?void 0:m.getAttribute("nonce"));d=Promise.all(a.map(T=>{if(T=VR(T),T in v0)return;v0[T]=!0;const P=T.endsWith(".css"),R=P?'[rel="stylesheet"]':"";if(!!u)for(let Z=y.length-1;Z>=0;Z--){const K=y[Z];if(K.href===T&&(!P||K.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${T}"]${R}`))return;const z=document.createElement("link");if(z.rel=P?"stylesheet":UR,P||(z.as="script",z.crossOrigin=""),z.href=T,l&&z.setAttribute("nonce",l),document.head.appendChild(z),P)return new Promise((Z,K)=>{z.addEventListener("load",Z),z.addEventListener("error",()=>K(new Error(`Unable to preload CSS for ${T}`)))})}))}return d.then(()=>r()).catch(y=>{const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=y,window.dispatchEvent(m),!m.defaultPrevented)throw y})},{routeApp:qR}=ax(),Qx=async e=>{console.log("getAddressAndPutInStore is running, address:",e);const r=ha();r.clearDataSourcesLoadedArray();const a=Ln();if(await a.fillAddressData(e),!a.addressData.features){gu.push({name:"not-found"});return}const u=a.addressData.features[0].properties.street_address;r.setCurrentAddress(u)},GR=async(e,r)=>{let a;const u=ha();let d=u.currentTopic;const y=ps.parcelLayerForTopic[d],m=Vh();if(await m.fillParcelDataByLngLat(e,r,y),!m[y].features[0]){gu.push({name:"not-found"});return}const l=y==="pwd"?"ADDRESS":"ADDR_SOURCE";a=m[y].features[0].properties[l],console.log("getParcelAndPutInStore, currentAddress:",a,"parcelLayer:",y,"addressField",l,"ParcelsStore[parcelLayer].features[0].properties:",m[y].features[0].properties,"ParcelsStore[parcelLayer].features[0].properties[addressField]:",m[y].features[0].properties[l]),u.setCurrentAddress(a)},HR=async(e,r)=>{const a=ha(),u=Ln(),d=a.dataSourcesLoadedArray;if(e.name==="not-found")return;let y,m;if(e.params.address?y=e.params.address:e.query.address&&(y=e.query.address),e.params.topic&&(m=e.params.topic),y!==u.addressData.normalized)await Qx(y);else if(d.includes(m))return;const l=Vh();await l.fillPwdParcelData(),await l.fillDorParcelData();const T=Rf();if(await T.fillCondoData(y),e.params.topic=="Condominiums"&&!T.condosData.length){a.currentTopic="Property",gu.push({name:"address-and-topic",params:{address:e.params.address,topic:"Property"}});return}await ZR(e.params.topic),a.addToDataSourcesLoadedArray(e.params.topic)},ZR=async e=>{if(console.log("topicDataFetch is running, topic:",e),e==="Property"&&await gx().fillOpaData(),e==="Licenses & Inspections"){const r=Ux();await r.fillLiInspections(),await r.fillLiPermits()}if(e==="Deeds"&&await yx().fillDorDocuments(),e==="Nearby Activity"){const a=ha().currentNearbyDataType;await Wx().fetchData(a);const y=Ln().addressData.features[0].geometry.coordinates;await Hs().fillBufferForAddress(y[0],y[1])}},gu=wS({history:JM("/vue3-atlas2"),routes:[{path:"/:pathMatch(.*)*",name:"NotFound",component:()=>jR(()=>import("./NotFound-CAB3CMyi.js"),[])},{path:"/",name:"home",component:rc,props:!0},{path:"/:address",name:"address",component:rc},{path:"/:address/:topic",name:"address-and-topic",component:rc},{path:"/:address/:topic/:data",name:"address-topic-and-data",component:rc},{path:"/not-found",name:"not-found",component:rc},{path:"/search",name:"search",component:rc,beforeEnter:async(e,r)=>{console.log("search route beforeEnter, to.query:",e.query,"from:",r);const{address:a,lat:u,lng:d}=e.query,y=ha();a?(y.setLastSearchMethod("address"),await Qx(a)):u&&d&&(y.setLastSearchMethod("mapClick"),await GR(d,u)),qR(gu)}}]});gu.afterEach(async(e,r)=>{console.log("router afterEach to:",e,"from:",r),e.name!=="not-found"&&e.name!=="search"&&await HR(e)});const sg=hM(rc);sg.use(mM());sg.use(gu);sg.mount("#app");export{El as _,se as a,Jd as b,Xt as c,or as d,Lt as o,WR as r,To as w};
