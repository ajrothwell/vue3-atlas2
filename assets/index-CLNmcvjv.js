(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))h(p);new MutationObserver(p=>{for(const _ of p)if(_.type==="childList")for(const m of _.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&h(m)}).observe(document,{childList:!0,subtree:!0});function a(p){const _={};return p.integrity&&(_.integrity=p.integrity),p.referrerPolicy&&(_.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?_.credentials="include":p.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function h(p){if(p.ep)return;p.ep=!0;const _=a(p);fetch(p.href,_)}})();/**
* @vue/shared v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function pm(t,r){const a=new Set(t.split(","));return r?h=>a.has(h.toLowerCase()):h=>a.has(h)}const ji={},Ll=[],Wr=()=>{},Cb=()=>!1,Bd=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&(t.charCodeAt(2)>122||t.charCodeAt(2)<97),mm=t=>t.startsWith("onUpdate:"),Us=Object.assign,gm=(t,r)=>{const a=t.indexOf(r);a>-1&&t.splice(a,1)},Db=Object.prototype.hasOwnProperty,di=(t,r)=>Db.call(t,r),Ge=Array.isArray,Ol=t=>Nd(t)==="[object Map]",o0=t=>Nd(t)==="[object Set]",Ke=t=>typeof t=="function",Ss=t=>typeof t=="string",Zl=t=>typeof t=="symbol",Hi=t=>t!==null&&typeof t=="object",l0=t=>(Hi(t)||Ke(t))&&Ke(t.then)&&Ke(t.catch),c0=Object.prototype.toString,Nd=t=>c0.call(t),kb=t=>Nd(t).slice(8,-1),h0=t=>Nd(t)==="[object Object]",_m=t=>Ss(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,uh=pm(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),$d=t=>{const r=Object.create(null);return a=>r[a]||(r[a]=t(a))},Rb=/-(\w)/g,Cn=$d(t=>t.replace(Rb,(r,a)=>a?a.toUpperCase():"")),zb=/\B([A-Z])/g,To=$d(t=>t.replace(zb,"-$1").toLowerCase()),Vd=$d(t=>t.charAt(0).toUpperCase()+t.slice(1)),vp=$d(t=>t?`on${Vd(t)}`:""),La=(t,r)=>!Object.is(t,r),cd=(t,r)=>{for(let a=0;a<t.length;a++)t[a](r)},bd=(t,r,a)=>{Object.defineProperty(t,r,{configurable:!0,enumerable:!1,value:a})},Np=t=>{const r=parseFloat(t);return isNaN(r)?t:r};let T_;const u0=()=>T_||(T_=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function ym(t){if(Ge(t)){const r={};for(let a=0;a<t.length;a++){const h=t[a],p=Ss(h)?Bb(h):ym(h);if(p)for(const _ in p)r[_]=p[_]}return r}else if(Ss(t)||Hi(t))return t}const Lb=/;(?![^(]*\))/g,Ob=/:([^]+)/,Fb=/\/\*[^]*?\*\//g;function Bb(t){const r={};return t.replace(Fb,"").split(Lb).forEach(a=>{if(a){const h=a.split(Ob);h.length>1&&(r[h[0].trim()]=h[1].trim())}}),r}function xo(t){let r="";if(Ss(t))r=t;else if(Ge(t))for(let a=0;a<t.length;a++){const h=xo(t[a]);h&&(r+=h+" ")}else if(Hi(t))for(const a in t)t[a]&&(r+=a+" ");return r.trim()}const Nb="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",$b=pm(Nb);function d0(t){return!!t||t===""}const Fe=t=>Ss(t)?t:t==null?"":Ge(t)||Hi(t)&&(t.toString===c0||!Ke(t.toString))?JSON.stringify(t,f0,2):String(t),f0=(t,r)=>r&&r.__v_isRef?f0(t,r.value):Ol(r)?{[`Map(${r.size})`]:[...r.entries()].reduce((a,[h,p],_)=>(a[xp(h,_)+" =>"]=p,a),{})}:o0(r)?{[`Set(${r.size})`]:[...r.values()].map(a=>xp(a))}:Zl(r)?xp(r):Hi(r)&&!Ge(r)&&!h0(r)?String(r):r,xp=(t,r="")=>{var a;return Zl(t)?`Symbol(${(a=t.description)!=null?a:r})`:t};/**
* @vue/reactivity v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let zr;class p0{constructor(r=!1){this.detached=r,this._active=!0,this.effects=[],this.cleanups=[],this.parent=zr,!r&&zr&&(this.index=(zr.scopes||(zr.scopes=[])).push(this)-1)}get active(){return this._active}run(r){if(this._active){const a=zr;try{return zr=this,r()}finally{zr=a}}}on(){zr=this}off(){zr=this.parent}stop(r){if(this._active){let a,h;for(a=0,h=this.effects.length;a<h;a++)this.effects[a].stop();for(a=0,h=this.cleanups.length;a<h;a++)this.cleanups[a]();if(this.scopes)for(a=0,h=this.scopes.length;a<h;a++)this.scopes[a].stop(!0);if(!this.detached&&this.parent&&!r){const p=this.parent.scopes.pop();p&&p!==this&&(this.parent.scopes[this.index]=p,p.index=this.index)}this.parent=void 0,this._active=!1}}}function m0(t){return new p0(t)}function Vb(t,r=zr){r&&r.active&&r.effects.push(t)}function g0(){return zr}function Ub(t){zr&&zr.cleanups.push(t)}let bo;class vm{constructor(r,a,h,p){this.fn=r,this.trigger=a,this.scheduler=h,this.active=!0,this.deps=[],this._dirtyLevel=4,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,Vb(this,p)}get dirty(){if(this._dirtyLevel===2||this._dirtyLevel===3){this._dirtyLevel=1,Ao();for(let r=0;r<this._depsLength;r++){const a=this.deps[r];if(a.computed&&(qb(a.computed),this._dirtyLevel>=4))break}this._dirtyLevel===1&&(this._dirtyLevel=0),Eo()}return this._dirtyLevel>=4}set dirty(r){this._dirtyLevel=r?4:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let r=Da,a=bo;try{return Da=!0,bo=this,this._runnings++,A_(this),this.fn()}finally{E_(this),this._runnings--,bo=a,Da=r}}stop(){var r;this.active&&(A_(this),E_(this),(r=this.onStop)==null||r.call(this),this.active=!1)}}function qb(t){return t.value}function A_(t){t._trackId++,t._depsLength=0}function E_(t){if(t.deps.length>t._depsLength){for(let r=t._depsLength;r<t.deps.length;r++)_0(t.deps[r],t);t.deps.length=t._depsLength}}function _0(t,r){const a=t.get(r);a!==void 0&&r._trackId!==a&&(t.delete(r),t.size===0&&t.cleanup())}let Da=!0,$p=0;const y0=[];function Ao(){y0.push(Da),Da=!1}function Eo(){const t=y0.pop();Da=t===void 0?!0:t}function xm(){$p++}function bm(){for($p--;!$p&&Vp.length;)Vp.shift()()}function v0(t,r,a){if(r.get(t)!==t._trackId){r.set(t,t._trackId);const h=t.deps[t._depsLength];h!==r?(h&&_0(h,t),t.deps[t._depsLength++]=r):t._depsLength++}}const Vp=[];function x0(t,r,a){xm();for(const h of t.keys()){let p;h._dirtyLevel<r&&(p??(p=t.get(h)===h._trackId))&&(h._shouldSchedule||(h._shouldSchedule=h._dirtyLevel===0),h._dirtyLevel=r),h._shouldSchedule&&(p??(p=t.get(h)===h._trackId))&&(h.trigger(),(!h._runnings||h.allowRecurse)&&h._dirtyLevel!==2&&(h._shouldSchedule=!1,h.scheduler&&Vp.push(h.scheduler)))}bm()}const b0=(t,r)=>{const a=new Map;return a.cleanup=t,a.computed=r,a},wd=new WeakMap,wo=Symbol(""),Up=Symbol("");function Mr(t,r,a){if(Da&&bo){let h=wd.get(t);h||wd.set(t,h=new Map);let p=h.get(a);p||h.set(a,p=b0(()=>h.delete(a))),v0(bo,p)}}function Yn(t,r,a,h,p,_){const m=wd.get(t);if(!m)return;let l=[];if(r==="clear")l=[...m.values()];else if(a==="length"&&Ge(t)){const T=Number(h);m.forEach((I,R)=>{(R==="length"||!Zl(R)&&R>=T)&&l.push(I)})}else switch(a!==void 0&&l.push(m.get(a)),r){case"add":Ge(t)?_m(a)&&l.push(m.get("length")):(l.push(m.get(wo)),Ol(t)&&l.push(m.get(Up)));break;case"delete":Ge(t)||(l.push(m.get(wo)),Ol(t)&&l.push(m.get(Up)));break;case"set":Ol(t)&&l.push(m.get(wo));break}xm();for(const T of l)T&&x0(T,4);bm()}function jb(t,r){var a;return(a=wd.get(t))==null?void 0:a.get(r)}const Gb=pm("__proto__,__v_isRef,__isVue"),w0=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(Zl)),I_=Hb();function Hb(){const t={};return["includes","indexOf","lastIndexOf"].forEach(r=>{t[r]=function(...a){const h=ci(this);for(let _=0,m=this.length;_<m;_++)Mr(h,"get",_+"");const p=h[r](...a);return p===-1||p===!1?h[r](...a.map(ci)):p}}),["push","pop","shift","unshift","splice"].forEach(r=>{t[r]=function(...a){Ao(),xm();const h=ci(this)[r].apply(this,a);return bm(),Eo(),h}}),t}function Wb(t){const r=ci(this);return Mr(r,"has",t),r.hasOwnProperty(t)}class M0{constructor(r=!1,a=!1){this._isReadonly=r,this._isShallow=a}get(r,a,h){const p=this._isReadonly,_=this._isShallow;if(a==="__v_isReactive")return!p;if(a==="__v_isReadonly")return p;if(a==="__v_isShallow")return _;if(a==="__v_raw")return h===(p?_?aw:E0:_?A0:T0).get(r)||Object.getPrototypeOf(r)===Object.getPrototypeOf(h)?r:void 0;const m=Ge(r);if(!p){if(m&&di(I_,a))return Reflect.get(I_,a,h);if(a==="hasOwnProperty")return Wb}const l=Reflect.get(r,a,h);return(Zl(a)?w0.has(a):Gb(a))||(p||Mr(r,"get",a),_)?l:ys(l)?m&&_m(a)?l:l.value:Hi(l)?p?P0(l):zh(l):l}}class S0 extends M0{constructor(r=!1){super(!1,r)}set(r,a,h,p){let _=r[a];if(!this._isShallow){const T=Vl(_);if(!Md(h)&&!Vl(h)&&(_=ci(_),h=ci(h)),!Ge(r)&&ys(_)&&!ys(h))return T?!1:(_.value=h,!0)}const m=Ge(r)&&_m(a)?Number(a)<r.length:di(r,a),l=Reflect.set(r,a,h,p);return r===ci(p)&&(m?La(h,_)&&Yn(r,"set",a,h):Yn(r,"add",a,h)),l}deleteProperty(r,a){const h=di(r,a);r[a];const p=Reflect.deleteProperty(r,a);return p&&h&&Yn(r,"delete",a,void 0),p}has(r,a){const h=Reflect.has(r,a);return(!Zl(a)||!w0.has(a))&&Mr(r,"has",a),h}ownKeys(r){return Mr(r,"iterate",Ge(r)?"length":wo),Reflect.ownKeys(r)}}class Zb extends M0{constructor(r=!1){super(!0,r)}set(r,a){return!0}deleteProperty(r,a){return!0}}const Xb=new S0,Kb=new Zb,Yb=new S0(!0),wm=t=>t,Ud=t=>Reflect.getPrototypeOf(t);function Qu(t,r,a=!1,h=!1){t=t.__v_raw;const p=ci(t),_=ci(r);a||(La(r,_)&&Mr(p,"get",r),Mr(p,"get",_));const{has:m}=Ud(p),l=h?wm:a?Tm:Mh;if(m.call(p,r))return l(t.get(r));if(m.call(p,_))return l(t.get(_));t!==p&&t.get(r)}function td(t,r=!1){const a=this.__v_raw,h=ci(a),p=ci(t);return r||(La(t,p)&&Mr(h,"has",t),Mr(h,"has",p)),t===p?a.has(t):a.has(t)||a.has(p)}function ed(t,r=!1){return t=t.__v_raw,!r&&Mr(ci(t),"iterate",wo),Reflect.get(t,"size",t)}function P_(t){t=ci(t);const r=ci(this);return Ud(r).has.call(r,t)||(r.add(t),Yn(r,"add",t,t)),this}function C_(t,r){r=ci(r);const a=ci(this),{has:h,get:p}=Ud(a);let _=h.call(a,t);_||(t=ci(t),_=h.call(a,t));const m=p.call(a,t);return a.set(t,r),_?La(r,m)&&Yn(a,"set",t,r):Yn(a,"add",t,r),this}function D_(t){const r=ci(this),{has:a,get:h}=Ud(r);let p=a.call(r,t);p||(t=ci(t),p=a.call(r,t)),h&&h.call(r,t);const _=r.delete(t);return p&&Yn(r,"delete",t,void 0),_}function k_(){const t=ci(this),r=t.size!==0,a=t.clear();return r&&Yn(t,"clear",void 0,void 0),a}function id(t,r){return function(h,p){const _=this,m=_.__v_raw,l=ci(m),T=r?wm:t?Tm:Mh;return!t&&Mr(l,"iterate",wo),m.forEach((I,R)=>h.call(p,T(I),T(R),_))}}function sd(t,r,a){return function(...h){const p=this.__v_raw,_=ci(p),m=Ol(_),l=t==="entries"||t===Symbol.iterator&&m,T=t==="keys"&&m,I=p[t](...h),R=a?wm:r?Tm:Mh;return!r&&Mr(_,"iterate",T?Up:wo),{next(){const{value:P,done:L}=I.next();return L?{value:P,done:L}:{value:l?[R(P[0]),R(P[1])]:R(P),done:L}},[Symbol.iterator](){return this}}}}function wa(t){return function(...r){return t==="delete"?!1:t==="clear"?void 0:this}}function Jb(){const t={get(_){return Qu(this,_)},get size(){return ed(this)},has:td,add:P_,set:C_,delete:D_,clear:k_,forEach:id(!1,!1)},r={get(_){return Qu(this,_,!1,!0)},get size(){return ed(this)},has:td,add:P_,set:C_,delete:D_,clear:k_,forEach:id(!1,!0)},a={get(_){return Qu(this,_,!0)},get size(){return ed(this,!0)},has(_){return td.call(this,_,!0)},add:wa("add"),set:wa("set"),delete:wa("delete"),clear:wa("clear"),forEach:id(!0,!1)},h={get(_){return Qu(this,_,!0,!0)},get size(){return ed(this,!0)},has(_){return td.call(this,_,!0)},add:wa("add"),set:wa("set"),delete:wa("delete"),clear:wa("clear"),forEach:id(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(_=>{t[_]=sd(_,!1,!1),a[_]=sd(_,!0,!1),r[_]=sd(_,!1,!0),h[_]=sd(_,!0,!0)}),[t,a,r,h]}const[Qb,tw,ew,iw]=Jb();function Mm(t,r){const a=r?t?iw:ew:t?tw:Qb;return(h,p,_)=>p==="__v_isReactive"?!t:p==="__v_isReadonly"?t:p==="__v_raw"?h:Reflect.get(di(a,p)&&p in h?a:h,p,_)}const sw={get:Mm(!1,!1)},rw={get:Mm(!1,!0)},nw={get:Mm(!0,!1)},T0=new WeakMap,A0=new WeakMap,E0=new WeakMap,aw=new WeakMap;function ow(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function lw(t){return t.__v_skip||!Object.isExtensible(t)?0:ow(kb(t))}function zh(t){return Vl(t)?t:Sm(t,!1,Xb,sw,T0)}function I0(t){return Sm(t,!1,Yb,rw,A0)}function P0(t){return Sm(t,!0,Kb,nw,E0)}function Sm(t,r,a,h,p){if(!Hi(t)||t.__v_raw&&!(r&&t.__v_isReactive))return t;const _=p.get(t);if(_)return _;const m=lw(t);if(m===0)return t;const l=new Proxy(t,m===2?h:a);return p.set(t,l),l}function Jn(t){return Vl(t)?Jn(t.__v_raw):!!(t&&t.__v_isReactive)}function Vl(t){return!!(t&&t.__v_isReadonly)}function Md(t){return!!(t&&t.__v_isShallow)}function C0(t){return Jn(t)||Vl(t)}function ci(t){const r=t&&t.__v_raw;return r?ci(r):t}function qd(t){return Object.isExtensible(t)&&bd(t,"__v_skip",!0),t}const Mh=t=>Hi(t)?zh(t):t,Tm=t=>Hi(t)?P0(t):t;class D0{constructor(r,a,h,p){this.getter=r,this._setter=a,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this.effect=new vm(()=>r(this._value),()=>hd(this,this.effect._dirtyLevel===2?2:3)),this.effect.computed=this,this.effect.active=this._cacheable=!p,this.__v_isReadonly=h}get value(){const r=ci(this);return(!r._cacheable||r.effect.dirty)&&La(r._value,r._value=r.effect.run())&&hd(r,4),k0(r),r.effect._dirtyLevel>=2&&hd(r,2),r._value}set value(r){this._setter(r)}get _dirty(){return this.effect.dirty}set _dirty(r){this.effect.dirty=r}}function cw(t,r,a=!1){let h,p;const _=Ke(t);return _?(h=t,p=Wr):(h=t.get,p=t.set),new D0(h,p,_||!p,a)}function k0(t){var r;Da&&bo&&(t=ci(t),v0(bo,(r=t.dep)!=null?r:t.dep=b0(()=>t.dep=void 0,t instanceof D0?t:void 0)))}function hd(t,r=4,a){t=ci(t);const h=t.dep;h&&x0(h,r)}function ys(t){return!!(t&&t.__v_isRef===!0)}function rn(t){return R0(t,!1)}function hw(t){return R0(t,!0)}function R0(t,r){return ys(t)?t:new uw(t,r)}class uw{constructor(r,a){this.__v_isShallow=a,this.dep=void 0,this.__v_isRef=!0,this._rawValue=a?r:ci(r),this._value=a?r:Mh(r)}get value(){return k0(this),this._value}set value(r){const a=this.__v_isShallow||Md(r)||Vl(r);r=a?r:ci(r),La(r,this._rawValue)&&(this._rawValue=r,this._value=a?r:Mh(r),hd(this,4))}}function Ti(t){return ys(t)?t.value:t}const dw={get:(t,r,a)=>Ti(Reflect.get(t,r,a)),set:(t,r,a,h)=>{const p=t[r];return ys(p)&&!ys(a)?(p.value=a,!0):Reflect.set(t,r,a,h)}};function z0(t){return Jn(t)?t:new Proxy(t,dw)}function fw(t){const r=Ge(t)?new Array(t.length):{};for(const a in t)r[a]=L0(t,a);return r}class pw{constructor(r,a,h){this._object=r,this._key=a,this._defaultValue=h,this.__v_isRef=!0}get value(){const r=this._object[this._key];return r===void 0?this._defaultValue:r}set value(r){this._object[this._key]=r}get dep(){return jb(ci(this._object),this._key)}}class mw{constructor(r){this._getter=r,this.__v_isRef=!0,this.__v_isReadonly=!0}get value(){return this._getter()}}function gw(t,r,a){return ys(t)?t:Ke(t)?new mw(t):Hi(t)&&arguments.length>1?L0(t,r,a):rn(t)}function L0(t,r,a){const h=t[r];return ys(h)?h:new pw(t,r,a)}/**
* @vue/runtime-core v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function ka(t,r,a,h){try{return h?t(...h):t()}catch(p){jd(p,r,a)}}function an(t,r,a,h){if(Ke(t)){const _=ka(t,r,a,h);return _&&l0(_)&&_.catch(m=>{jd(m,r,a)}),_}const p=[];for(let _=0;_<t.length;_++)p.push(an(t[_],r,a,h));return p}function jd(t,r,a,h=!0){const p=r?r.vnode:null;if(r){let _=r.parent;const m=r.proxy,l=`https://vuejs.org/error-reference/#runtime-${a}`;for(;_;){const I=_.ec;if(I){for(let R=0;R<I.length;R++)if(I[R](t,m,l)===!1)return}_=_.parent}const T=r.appContext.config.errorHandler;if(T){ka(T,null,10,[t,m,l]);return}}_w(t,a,p,h)}function _w(t,r,a,h=!0){console.error(t)}let Sh=!1,qp=!1;const Qs=[];let Tn=0;const Fl=[];let Ea=null,yo=0;const O0=Promise.resolve();let Am=null;function Em(t){const r=Am||O0;return t?r.then(this?t.bind(this):t):r}function yw(t){let r=Tn+1,a=Qs.length;for(;r<a;){const h=r+a>>>1,p=Qs[h],_=Th(p);_<t||_===t&&p.pre?r=h+1:a=h}return r}function Im(t){(!Qs.length||!Qs.includes(t,Sh&&t.allowRecurse?Tn+1:Tn))&&(t.id==null?Qs.push(t):Qs.splice(yw(t.id),0,t),F0())}function F0(){!Sh&&!qp&&(qp=!0,Am=O0.then(N0))}function vw(t){const r=Qs.indexOf(t);r>Tn&&Qs.splice(r,1)}function xw(t){Ge(t)?Fl.push(...t):(!Ea||!Ea.includes(t,t.allowRecurse?yo+1:yo))&&Fl.push(t),F0()}function R_(t,r,a=Sh?Tn+1:0){for(;a<Qs.length;a++){const h=Qs[a];if(h&&h.pre){if(t&&h.id!==t.uid)continue;Qs.splice(a,1),a--,h()}}}function B0(t){if(Fl.length){const r=[...new Set(Fl)].sort((a,h)=>Th(a)-Th(h));if(Fl.length=0,Ea){Ea.push(...r);return}for(Ea=r,yo=0;yo<Ea.length;yo++)Ea[yo]();Ea=null,yo=0}}const Th=t=>t.id==null?1/0:t.id,bw=(t,r)=>{const a=Th(t)-Th(r);if(a===0){if(t.pre&&!r.pre)return-1;if(r.pre&&!t.pre)return 1}return a};function N0(t){qp=!1,Sh=!0,Qs.sort(bw);try{for(Tn=0;Tn<Qs.length;Tn++){const r=Qs[Tn];r&&r.active!==!1&&ka(r,null,14)}}finally{Tn=0,Qs.length=0,B0(),Sh=!1,Am=null,(Qs.length||Fl.length)&&N0()}}function ww(t,r,...a){if(t.isUnmounted)return;const h=t.vnode.props||ji;let p=a;const _=r.startsWith("update:"),m=_&&r.slice(7);if(m&&m in h){const R=`${m==="modelValue"?"model":m}Modifiers`,{number:P,trim:L}=h[R]||ji;L&&(p=a.map(K=>Ss(K)?K.trim():K)),P&&(p=a.map(Np))}let l,T=h[l=vp(r)]||h[l=vp(Cn(r))];!T&&_&&(T=h[l=vp(To(r))]),T&&an(T,t,6,p);const I=h[l+"Once"];if(I){if(!t.emitted)t.emitted={};else if(t.emitted[l])return;t.emitted[l]=!0,an(I,t,6,p)}}function $0(t,r,a=!1){const h=r.emitsCache,p=h.get(t);if(p!==void 0)return p;const _=t.emits;let m={},l=!1;if(!Ke(t)){const T=I=>{const R=$0(I,r,!0);R&&(l=!0,Us(m,R))};!a&&r.mixins.length&&r.mixins.forEach(T),t.extends&&T(t.extends),t.mixins&&t.mixins.forEach(T)}return!_&&!l?(Hi(t)&&h.set(t,null),null):(Ge(_)?_.forEach(T=>m[T]=null):Us(m,_),Hi(t)&&h.set(t,m),m)}function Gd(t,r){return!t||!Bd(r)?!1:(r=r.slice(2).replace(/Once$/,""),di(t,r[0].toLowerCase()+r.slice(1))||di(t,To(r))||di(t,r))}let Ms=null,Hd=null;function Sd(t){const r=Ms;return Ms=t,Hd=t&&t.type.__scopeId||null,r}function Wd(t){Hd=t}function Zd(){Hd=null}function Xn(t,r=Ms,a){if(!r||t._n)return t;const h=(...p)=>{h._d&&j_(-1);const _=Sd(r);let m;try{m=t(...p)}finally{Sd(_),h._d&&j_(1)}return m};return h._n=!0,h._c=!0,h._d=!0,h}function bp(t){const{type:r,vnode:a,proxy:h,withProxy:p,props:_,propsOptions:[m],slots:l,attrs:T,emit:I,render:R,renderCache:P,data:L,setupState:K,ctx:tt,inheritAttrs:lt}=t;let vt,yt;const Tt=Sd(t);try{if(a.shapeFlag&4){const Dt=p||h,Ot=Dt;vt=Sn(R.call(Ot,Dt,P,_,K,L,tt)),yt=T}else{const Dt=r;vt=Sn(Dt.length>1?Dt(_,{attrs:T,slots:l,emit:I}):Dt(_,null)),yt=r.props?T:Mw(T)}}catch(Dt){ph.length=0,jd(Dt,t,1),vt=Gi(Oa)}let ut=vt;if(yt&&lt!==!1){const Dt=Object.keys(yt),{shapeFlag:Ot}=ut;Dt.length&&Ot&7&&(m&&Dt.some(mm)&&(yt=Sw(yt,m)),ut=Ul(ut,yt))}return a.dirs&&(ut=Ul(ut),ut.dirs=ut.dirs?ut.dirs.concat(a.dirs):a.dirs),a.transition&&(ut.transition=a.transition),vt=ut,Sd(Tt),vt}const Mw=t=>{let r;for(const a in t)(a==="class"||a==="style"||Bd(a))&&((r||(r={}))[a]=t[a]);return r},Sw=(t,r)=>{const a={};for(const h in t)(!mm(h)||!(h.slice(9)in r))&&(a[h]=t[h]);return a};function Tw(t,r,a){const{props:h,children:p,component:_}=t,{props:m,children:l,patchFlag:T}=r,I=_.emitsOptions;if(r.dirs||r.transition)return!0;if(a&&T>=0){if(T&1024)return!0;if(T&16)return h?z_(h,m,I):!!m;if(T&8){const R=r.dynamicProps;for(let P=0;P<R.length;P++){const L=R[P];if(m[L]!==h[L]&&!Gd(I,L))return!0}}}else return(p||l)&&(!l||!l.$stable)?!0:h===m?!1:h?m?z_(h,m,I):!0:!!m;return!1}function z_(t,r,a){const h=Object.keys(r);if(h.length!==Object.keys(t).length)return!0;for(let p=0;p<h.length;p++){const _=h[p];if(r[_]!==t[_]&&!Gd(a,_))return!0}return!1}function Aw({vnode:t,parent:r},a){for(;r;){const h=r.subTree;if(h.suspense&&h.suspense.activeBranch===t&&(h.el=t.el),h===t)(t=r.vnode).el=a,r=r.parent;else break}}const V0="components";function WR(t,r){return Iw(V0,t,!0,r)||t}const Ew=Symbol.for("v-ndc");function Iw(t,r,a=!0,h=!1){const p=Ms||Vs;if(p){const _=p.type;if(t===V0){const l=w2(_,!1);if(l&&(l===r||l===Cn(r)||l===Vd(Cn(r))))return _}const m=L_(p[t]||_[t],r)||L_(p.appContext[t],r);return!m&&h?_:m}}function L_(t,r){return t&&(t[r]||t[Cn(r)]||t[Vd(Cn(r))])}const Pw=t=>t.__isSuspense;function Cw(t,r){r&&r.pendingBranch?Ge(t)?r.effects.push(...t):r.effects.push(t):xw(t)}const Dw=Symbol.for("v-scx"),kw=()=>Zr(Dw),rd={};function Ra(t,r,a){return U0(t,r,a)}function U0(t,r,{immediate:a,deep:h,flush:p,once:_,onTrack:m,onTrigger:l}=ji){if(r&&_){const Ut=r;r=(...ce)=>{Ut(...ce),Ot()}}const T=Vs,I=Ut=>h===!0?Ut:vo(Ut,h===!1?1:void 0);let R,P=!1,L=!1;if(ys(t)?(R=()=>t.value,P=Md(t)):Jn(t)?(R=()=>I(t),P=!0):Ge(t)?(L=!0,P=t.some(Ut=>Jn(Ut)||Md(Ut)),R=()=>t.map(Ut=>{if(ys(Ut))return Ut.value;if(Jn(Ut))return I(Ut);if(Ke(Ut))return ka(Ut,T,2)})):Ke(t)?r?R=()=>ka(t,T,2):R=()=>(K&&K(),an(t,T,3,[tt])):R=Wr,r&&h){const Ut=R;R=()=>vo(Ut())}let K,tt=Ut=>{K=ut.onStop=()=>{ka(Ut,T,4),K=ut.onStop=void 0}},lt;if(Jd)if(tt=Wr,r?a&&an(r,T,3,[R(),L?[]:void 0,tt]):R(),p==="sync"){const Ut=kw();lt=Ut.__watcherHandles||(Ut.__watcherHandles=[])}else return Wr;let vt=L?new Array(t.length).fill(rd):rd;const yt=()=>{if(!(!ut.active||!ut.dirty))if(r){const Ut=ut.run();(h||P||(L?Ut.some((ce,te)=>La(ce,vt[te])):La(Ut,vt)))&&(K&&K(),an(r,T,3,[Ut,vt===rd?void 0:L&&vt[0]===rd?[]:vt,tt]),vt=Ut)}else ut.run()};yt.allowRecurse=!!r;let Tt;p==="sync"?Tt=yt:p==="post"?Tt=()=>wr(yt,T&&T.suspense):(yt.pre=!0,T&&(yt.id=T.uid),Tt=()=>Im(yt));const ut=new vm(R,Wr,Tt),Dt=g0(),Ot=()=>{ut.stop(),Dt&&gm(Dt.effects,ut)};return r?a?yt():vt=ut.run():p==="post"?wr(ut.run.bind(ut),T&&T.suspense):ut.run(),lt&&lt.push(Ot),Ot}function Rw(t,r,a){const h=this.proxy,p=Ss(t)?t.includes(".")?q0(h,t):()=>h[t]:t.bind(h,h);let _;Ke(r)?_=r:(_=r.handler,a=r);const m=Oh(this),l=U0(p,_.bind(h),a);return m(),l}function q0(t,r){const a=r.split(".");return()=>{let h=t;for(let p=0;p<a.length&&h;p++)h=h[a[p]];return h}}function vo(t,r,a=0,h){if(!Hi(t)||t.__v_skip)return t;if(r&&r>0){if(a>=r)return t;a++}if(h=h||new Set,h.has(t))return t;if(h.add(t),ys(t))vo(t.value,r,a,h);else if(Ge(t))for(let p=0;p<t.length;p++)vo(t[p],r,a,h);else if(o0(t)||Ol(t))t.forEach(p=>{vo(p,r,a,h)});else if(h0(t))for(const p in t)vo(t[p],r,a,h);return t}function j0(t,r){if(Ms===null)return t;const a=Qd(Ms)||Ms.proxy,h=t.dirs||(t.dirs=[]);for(let p=0;p<r.length;p++){let[_,m,l,T=ji]=r[p];_&&(Ke(_)&&(_={mounted:_,updated:_}),_.deep&&vo(m),h.push({dir:_,instance:a,value:m,oldValue:void 0,arg:l,modifiers:T}))}return t}function fo(t,r,a,h){const p=t.dirs,_=r&&r.dirs;for(let m=0;m<p.length;m++){const l=p[m];_&&(l.oldValue=_[m].value);let T=l.dir[h];T&&(Ao(),an(T,a,8,[t.el,l,t,r]),Eo())}}/*! #__NO_SIDE_EFFECTS__ */function G0(t,r){return Ke(t)?Us({name:t.name},r,{setup:t}):t}const dh=t=>!!t.type.__asyncLoader,H0=t=>t.type.__isKeepAlive;function zw(t,r){W0(t,"a",r)}function Lw(t,r){W0(t,"da",r)}function W0(t,r,a=Vs){const h=t.__wdc||(t.__wdc=()=>{let p=a;for(;p;){if(p.isDeactivated)return;p=p.parent}return t()});if(Xd(r,h,a),a){let p=a.parent;for(;p&&p.parent;)H0(p.parent.vnode)&&Ow(h,r,a,p),p=p.parent}}function Ow(t,r,a,h){const p=Xd(r,t,h,!0);X0(()=>{gm(h[r],p)},a)}function Xd(t,r,a=Vs,h=!1){if(a){const p=a[t]||(a[t]=[]),_=r.__weh||(r.__weh=(...m)=>{if(a.isUnmounted)return;Ao();const l=Oh(a),T=an(r,a,t,m);return l(),Eo(),T});return h?p.unshift(_):p.push(_),_}}const ta=t=>(r,a=Vs)=>(!Jd||t==="sp")&&Xd(t,(...h)=>r(...h),a),Z0=ta("bm"),Lh=ta("m"),Fw=ta("bu"),Bw=ta("u"),Nw=ta("bum"),X0=ta("um"),$w=ta("sp"),Vw=ta("rtg"),Uw=ta("rtc");function qw(t,r=Vs){Xd("ec",t,r)}function An(t,r,a,h){let p;const _=a&&a[h];if(Ge(t)||Ss(t)){p=new Array(t.length);for(let m=0,l=t.length;m<l;m++)p[m]=r(t[m],m,void 0,_&&_[m])}else if(typeof t=="number"){p=new Array(t);for(let m=0;m<t;m++)p[m]=r(m+1,m,void 0,_&&_[m])}else if(Hi(t))if(t[Symbol.iterator])p=Array.from(t,(m,l)=>r(m,l,void 0,_&&_[l]));else{const m=Object.keys(t);p=new Array(m.length);for(let l=0,T=m.length;l<T;l++){const I=m[l];p[l]=r(t[I],I,l,_&&_[l])}}else p=[];return a&&(a[h]=p),p}function jw(t,r,a={},h,p){if(Ms.isCE||Ms.parent&&dh(Ms.parent)&&Ms.parent.isCE)return r!=="default"&&(a.name=r),Gi("slot",a,h&&h());let _=t[r];_&&_._c&&(_._d=!1),Pe();const m=_&&K0(_(a)),l=Kn(ns,{key:a.key||m&&m.key||`_${r}`},m||(h?h():[]),m&&t._===1?64:-2);return!p&&l.scopeId&&(l.slotScopeIds=[l.scopeId+"-s"]),_&&_._c&&(_._d=!0),l}function K0(t){return t.some(r=>Ad(r)?!(r.type===Oa||r.type===ns&&!K0(r.children)):!0)?t:null}const jp=t=>t?cv(t)?Qd(t)||t.proxy:jp(t.parent):null,fh=Us(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>jp(t.parent),$root:t=>jp(t.root),$emit:t=>t.emit,$options:t=>Pm(t),$forceUpdate:t=>t.f||(t.f=()=>{t.effect.dirty=!0,Im(t.update)}),$nextTick:t=>t.n||(t.n=Em.bind(t.proxy)),$watch:t=>Rw.bind(t)}),wp=(t,r)=>t!==ji&&!t.__isScriptSetup&&di(t,r),Gw={get({_:t},r){const{ctx:a,setupState:h,data:p,props:_,accessCache:m,type:l,appContext:T}=t;let I;if(r[0]!=="$"){const K=m[r];if(K!==void 0)switch(K){case 1:return h[r];case 2:return p[r];case 4:return a[r];case 3:return _[r]}else{if(wp(h,r))return m[r]=1,h[r];if(p!==ji&&di(p,r))return m[r]=2,p[r];if((I=t.propsOptions[0])&&di(I,r))return m[r]=3,_[r];if(a!==ji&&di(a,r))return m[r]=4,a[r];Gp&&(m[r]=0)}}const R=fh[r];let P,L;if(R)return r==="$attrs"&&Mr(t,"get",r),R(t);if((P=l.__cssModules)&&(P=P[r]))return P;if(a!==ji&&di(a,r))return m[r]=4,a[r];if(L=T.config.globalProperties,di(L,r))return L[r]},set({_:t},r,a){const{data:h,setupState:p,ctx:_}=t;return wp(p,r)?(p[r]=a,!0):h!==ji&&di(h,r)?(h[r]=a,!0):di(t.props,r)||r[0]==="$"&&r.slice(1)in t?!1:(_[r]=a,!0)},has({_:{data:t,setupState:r,accessCache:a,ctx:h,appContext:p,propsOptions:_}},m){let l;return!!a[m]||t!==ji&&di(t,m)||wp(r,m)||(l=_[0])&&di(l,m)||di(h,m)||di(fh,m)||di(p.config.globalProperties,m)},defineProperty(t,r,a){return a.get!=null?t._.accessCache[r]=0:di(a,"value")&&this.set(t,r,a.value,null),Reflect.defineProperty(t,r,a)}};function O_(t){return Ge(t)?t.reduce((r,a)=>(r[a]=null,r),{}):t}let Gp=!0;function Hw(t){const r=Pm(t),a=t.proxy,h=t.ctx;Gp=!1,r.beforeCreate&&F_(r.beforeCreate,t,"bc");const{data:p,computed:_,methods:m,watch:l,provide:T,inject:I,created:R,beforeMount:P,mounted:L,beforeUpdate:K,updated:tt,activated:lt,deactivated:vt,beforeDestroy:yt,beforeUnmount:Tt,destroyed:ut,unmounted:Dt,render:Ot,renderTracked:Ut,renderTriggered:ce,errorCaptured:te,serverPrefetch:fe,expose:Ce,inheritAttrs:xe,components:ri,directives:pe,filters:Qt}=r;if(I&&Ww(I,h,null),m)for(const Le in m){const Ye=m[Le];Ke(Ye)&&(h[Le]=Ye.bind(a))}if(p){const Le=p.call(a,a);Hi(Le)&&(t.data=zh(Le))}if(Gp=!0,_)for(const Le in _){const Ye=_[Le],xs=Ke(Ye)?Ye.bind(a,a):Ke(Ye.get)?Ye.get.bind(a,a):Wr,ks=!Ke(Ye)&&Ke(Ye.set)?Ye.set.bind(a):Wr,Ii=wi({get:xs,set:ks});Object.defineProperty(h,Le,{enumerable:!0,configurable:!0,get:()=>Ii.value,set:hi=>Ii.value=hi})}if(l)for(const Le in l)Y0(l[Le],h,a,Le);if(T){const Le=Ke(T)?T.call(a):T;Reflect.ownKeys(Le).forEach(Ye=>{ud(Ye,Le[Ye])})}R&&F_(R,t,"c");function ze(Le,Ye){Ge(Ye)?Ye.forEach(xs=>Le(xs.bind(a))):Ye&&Le(Ye.bind(a))}if(ze(Z0,P),ze(Lh,L),ze(Fw,K),ze(Bw,tt),ze(zw,lt),ze(Lw,vt),ze(qw,te),ze(Uw,Ut),ze(Vw,ce),ze(Nw,Tt),ze(X0,Dt),ze($w,fe),Ge(Ce))if(Ce.length){const Le=t.exposed||(t.exposed={});Ce.forEach(Ye=>{Object.defineProperty(Le,Ye,{get:()=>a[Ye],set:xs=>a[Ye]=xs})})}else t.exposed||(t.exposed={});Ot&&t.render===Wr&&(t.render=Ot),xe!=null&&(t.inheritAttrs=xe),ri&&(t.components=ri),pe&&(t.directives=pe)}function Ww(t,r,a=Wr){Ge(t)&&(t=Hp(t));for(const h in t){const p=t[h];let _;Hi(p)?"default"in p?_=Zr(p.from||h,p.default,!0):_=Zr(p.from||h):_=Zr(p),ys(_)?Object.defineProperty(r,h,{enumerable:!0,configurable:!0,get:()=>_.value,set:m=>_.value=m}):r[h]=_}}function F_(t,r,a){an(Ge(t)?t.map(h=>h.bind(r.proxy)):t.bind(r.proxy),r,a)}function Y0(t,r,a,h){const p=h.includes(".")?q0(a,h):()=>a[h];if(Ss(t)){const _=r[t];Ke(_)&&Ra(p,_)}else if(Ke(t))Ra(p,t.bind(a));else if(Hi(t))if(Ge(t))t.forEach(_=>Y0(_,r,a,h));else{const _=Ke(t.handler)?t.handler.bind(a):r[t.handler];Ke(_)&&Ra(p,_,t)}}function Pm(t){const r=t.type,{mixins:a,extends:h}=r,{mixins:p,optionsCache:_,config:{optionMergeStrategies:m}}=t.appContext,l=_.get(r);let T;return l?T=l:!p.length&&!a&&!h?T=r:(T={},p.length&&p.forEach(I=>Td(T,I,m,!0)),Td(T,r,m)),Hi(r)&&_.set(r,T),T}function Td(t,r,a,h=!1){const{mixins:p,extends:_}=r;_&&Td(t,_,a,!0),p&&p.forEach(m=>Td(t,m,a,!0));for(const m in r)if(!(h&&m==="expose")){const l=Zw[m]||a&&a[m];t[m]=l?l(t[m],r[m]):r[m]}return t}const Zw={data:B_,props:N_,emits:N_,methods:ah,computed:ah,beforeCreate:hr,created:hr,beforeMount:hr,mounted:hr,beforeUpdate:hr,updated:hr,beforeDestroy:hr,beforeUnmount:hr,destroyed:hr,unmounted:hr,activated:hr,deactivated:hr,errorCaptured:hr,serverPrefetch:hr,components:ah,directives:ah,watch:Kw,provide:B_,inject:Xw};function B_(t,r){return r?t?function(){return Us(Ke(t)?t.call(this,this):t,Ke(r)?r.call(this,this):r)}:r:t}function Xw(t,r){return ah(Hp(t),Hp(r))}function Hp(t){if(Ge(t)){const r={};for(let a=0;a<t.length;a++)r[t[a]]=t[a];return r}return t}function hr(t,r){return t?[...new Set([].concat(t,r))]:r}function ah(t,r){return t?Us(Object.create(null),t,r):r}function N_(t,r){return t?Ge(t)&&Ge(r)?[...new Set([...t,...r])]:Us(Object.create(null),O_(t),O_(r??{})):r}function Kw(t,r){if(!t)return r;if(!r)return t;const a=Us(Object.create(null),t);for(const h in r)a[h]=hr(t[h],r[h]);return a}function J0(){return{app:null,config:{isNativeTag:Cb,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Yw=0;function Jw(t,r){return function(h,p=null){Ke(h)||(h=Us({},h)),p!=null&&!Hi(p)&&(p=null);const _=J0(),m=new WeakSet;let l=!1;const T=_.app={_uid:Yw++,_component:h,_props:p,_container:null,_context:_,_instance:null,version:S2,get config(){return _.config},set config(I){},use(I,...R){return m.has(I)||(I&&Ke(I.install)?(m.add(I),I.install(T,...R)):Ke(I)&&(m.add(I),I(T,...R))),T},mixin(I){return _.mixins.includes(I)||_.mixins.push(I),T},component(I,R){return R?(_.components[I]=R,T):_.components[I]},directive(I,R){return R?(_.directives[I]=R,T):_.directives[I]},mount(I,R,P){if(!l){const L=Gi(h,p);return L.appContext=_,P===!0?P="svg":P===!1&&(P=void 0),R&&r?r(L,I):t(L,I,P),l=!0,T._container=I,I.__vue_app__=T,Qd(L.component)||L.component.proxy}},unmount(){l&&(t(null,T._container),delete T._container.__vue_app__)},provide(I,R){return _.provides[I]=R,T},runWithContext(I){const R=Bl;Bl=T;try{return I()}finally{Bl=R}}};return T}}let Bl=null;function ud(t,r){if(Vs){let a=Vs.provides;const h=Vs.parent&&Vs.parent.provides;h===a&&(a=Vs.provides=Object.create(h)),a[t]=r}}function Zr(t,r,a=!1){const h=Vs||Ms;if(h||Bl){const p=h?h.parent==null?h.vnode.appContext&&h.vnode.appContext.provides:h.parent.provides:Bl._context.provides;if(p&&t in p)return p[t];if(arguments.length>1)return a&&Ke(r)?r.call(h&&h.proxy):r}}function Qw(){return!!(Vs||Ms||Bl)}function t2(t,r,a,h=!1){const p={},_={};bd(_,Yd,1),t.propsDefaults=Object.create(null),Q0(t,r,p,_);for(const m in t.propsOptions[0])m in p||(p[m]=void 0);a?t.props=h?p:I0(p):t.type.props?t.props=p:t.props=_,t.attrs=_}function e2(t,r,a,h){const{props:p,attrs:_,vnode:{patchFlag:m}}=t,l=ci(p),[T]=t.propsOptions;let I=!1;if((h||m>0)&&!(m&16)){if(m&8){const R=t.vnode.dynamicProps;for(let P=0;P<R.length;P++){let L=R[P];if(Gd(t.emitsOptions,L))continue;const K=r[L];if(T)if(di(_,L))K!==_[L]&&(_[L]=K,I=!0);else{const tt=Cn(L);p[tt]=Wp(T,l,tt,K,t,!1)}else K!==_[L]&&(_[L]=K,I=!0)}}}else{Q0(t,r,p,_)&&(I=!0);let R;for(const P in l)(!r||!di(r,P)&&((R=To(P))===P||!di(r,R)))&&(T?a&&(a[P]!==void 0||a[R]!==void 0)&&(p[P]=Wp(T,l,P,void 0,t,!0)):delete p[P]);if(_!==l)for(const P in _)(!r||!di(r,P))&&(delete _[P],I=!0)}I&&Yn(t,"set","$attrs")}function Q0(t,r,a,h){const[p,_]=t.propsOptions;let m=!1,l;if(r)for(let T in r){if(uh(T))continue;const I=r[T];let R;p&&di(p,R=Cn(T))?!_||!_.includes(R)?a[R]=I:(l||(l={}))[R]=I:Gd(t.emitsOptions,T)||(!(T in h)||I!==h[T])&&(h[T]=I,m=!0)}if(_){const T=ci(a),I=l||ji;for(let R=0;R<_.length;R++){const P=_[R];a[P]=Wp(p,T,P,I[P],t,!di(I,P))}}return m}function Wp(t,r,a,h,p,_){const m=t[a];if(m!=null){const l=di(m,"default");if(l&&h===void 0){const T=m.default;if(m.type!==Function&&!m.skipFactory&&Ke(T)){const{propsDefaults:I}=p;if(a in I)h=I[a];else{const R=Oh(p);h=I[a]=T.call(null,r),R()}}else h=T}m[0]&&(_&&!l?h=!1:m[1]&&(h===""||h===To(a))&&(h=!0))}return h}function tv(t,r,a=!1){const h=r.propsCache,p=h.get(t);if(p)return p;const _=t.props,m={},l=[];let T=!1;if(!Ke(t)){const R=P=>{T=!0;const[L,K]=tv(P,r,!0);Us(m,L),K&&l.push(...K)};!a&&r.mixins.length&&r.mixins.forEach(R),t.extends&&R(t.extends),t.mixins&&t.mixins.forEach(R)}if(!_&&!T)return Hi(t)&&h.set(t,Ll),Ll;if(Ge(_))for(let R=0;R<_.length;R++){const P=Cn(_[R]);$_(P)&&(m[P]=ji)}else if(_)for(const R in _){const P=Cn(R);if($_(P)){const L=_[R],K=m[P]=Ge(L)||Ke(L)?{type:L}:Us({},L);if(K){const tt=q_(Boolean,K.type),lt=q_(String,K.type);K[0]=tt>-1,K[1]=lt<0||tt<lt,(tt>-1||di(K,"default"))&&l.push(P)}}}const I=[m,l];return Hi(t)&&h.set(t,I),I}function $_(t){return t[0]!=="$"&&!uh(t)}function V_(t){return t===null?"null":typeof t=="function"?t.name||"":typeof t=="object"&&t.constructor&&t.constructor.name||""}function U_(t,r){return V_(t)===V_(r)}function q_(t,r){return Ge(r)?r.findIndex(a=>U_(a,t)):Ke(r)&&U_(r,t)?0:-1}const ev=t=>t[0]==="_"||t==="$stable",Cm=t=>Ge(t)?t.map(Sn):[Sn(t)],i2=(t,r,a)=>{if(r._n)return r;const h=Xn((...p)=>Cm(r(...p)),a);return h._c=!1,h},iv=(t,r,a)=>{const h=t._ctx;for(const p in t){if(ev(p))continue;const _=t[p];if(Ke(_))r[p]=i2(p,_,h);else if(_!=null){const m=Cm(_);r[p]=()=>m}}},sv=(t,r)=>{const a=Cm(r);t.slots.default=()=>a},s2=(t,r)=>{if(t.vnode.shapeFlag&32){const a=r._;a?(t.slots=ci(r),bd(r,"_",a)):iv(r,t.slots={})}else t.slots={},r&&sv(t,r);bd(t.slots,Yd,1)},r2=(t,r,a)=>{const{vnode:h,slots:p}=t;let _=!0,m=ji;if(h.shapeFlag&32){const l=r._;l?a&&l===1?_=!1:(Us(p,r),!a&&l===1&&delete p._):(_=!r.$stable,iv(r,p)),m=r}else r&&(sv(t,r),m={default:1});if(_)for(const l in p)!ev(l)&&m[l]==null&&delete p[l]};function Zp(t,r,a,h,p=!1){if(Ge(t)){t.forEach((L,K)=>Zp(L,r&&(Ge(r)?r[K]:r),a,h,p));return}if(dh(h)&&!p)return;const _=h.shapeFlag&4?Qd(h.component)||h.component.proxy:h.el,m=p?null:_,{i:l,r:T}=t,I=r&&r.r,R=l.refs===ji?l.refs={}:l.refs,P=l.setupState;if(I!=null&&I!==T&&(Ss(I)?(R[I]=null,di(P,I)&&(P[I]=null)):ys(I)&&(I.value=null)),Ke(T))ka(T,l,12,[m,R]);else{const L=Ss(T),K=ys(T);if(L||K){const tt=()=>{if(t.f){const lt=L?di(P,T)?P[T]:R[T]:T.value;p?Ge(lt)&&gm(lt,_):Ge(lt)?lt.includes(_)||lt.push(_):L?(R[T]=[_],di(P,T)&&(P[T]=R[T])):(T.value=[_],t.k&&(R[t.k]=T.value))}else L?(R[T]=m,di(P,T)&&(P[T]=m)):K&&(T.value=m,t.k&&(R[t.k]=m))};m?(tt.id=-1,wr(tt,a)):tt()}}}const wr=Cw;function n2(t){return a2(t)}function a2(t,r){const a=u0();a.__VUE__=!0;const{insert:h,remove:p,patchProp:_,createElement:m,createText:l,createComment:T,setText:I,setElementText:R,parentNode:P,nextSibling:L,setScopeId:K=Wr,insertStaticContent:tt}=t,lt=(Q,rt,Mt,Ft=null,it=null,Xt=null,ne=void 0,Pt=null,qt=!!rt.dynamicChildren)=>{if(Q===rt)return;Q&&!Jc(Q,rt)&&(Ft=kt(Q),hi(Q,it,Xt,!0),Q=null),rt.patchFlag===-2&&(qt=!1,rt.dynamicChildren=null);const{type:Vt,ref:ue,shapeFlag:Ee}=rt;switch(Vt){case Kd:vt(Q,rt,Mt,Ft);break;case Oa:yt(Q,rt,Mt,Ft);break;case dd:Q==null&&Tt(rt,Mt,Ft,ne);break;case ns:ri(Q,rt,Mt,Ft,it,Xt,ne,Pt,qt);break;default:Ee&1?Ot(Q,rt,Mt,Ft,it,Xt,ne,Pt,qt):Ee&6?pe(Q,rt,Mt,Ft,it,Xt,ne,Pt,qt):(Ee&64||Ee&128)&&Vt.process(Q,rt,Mt,Ft,it,Xt,ne,Pt,qt,ye)}ue!=null&&it&&Zp(ue,Q&&Q.ref,Xt,rt||Q,!rt)},vt=(Q,rt,Mt,Ft)=>{if(Q==null)h(rt.el=l(rt.children),Mt,Ft);else{const it=rt.el=Q.el;rt.children!==Q.children&&I(it,rt.children)}},yt=(Q,rt,Mt,Ft)=>{Q==null?h(rt.el=T(rt.children||""),Mt,Ft):rt.el=Q.el},Tt=(Q,rt,Mt,Ft)=>{[Q.el,Q.anchor]=tt(Q.children,rt,Mt,Ft,Q.el,Q.anchor)},ut=({el:Q,anchor:rt},Mt,Ft)=>{let it;for(;Q&&Q!==rt;)it=L(Q),h(Q,Mt,Ft),Q=it;h(rt,Mt,Ft)},Dt=({el:Q,anchor:rt})=>{let Mt;for(;Q&&Q!==rt;)Mt=L(Q),p(Q),Q=Mt;p(rt)},Ot=(Q,rt,Mt,Ft,it,Xt,ne,Pt,qt)=>{rt.type==="svg"?ne="svg":rt.type==="math"&&(ne="mathml"),Q==null?Ut(rt,Mt,Ft,it,Xt,ne,Pt,qt):fe(Q,rt,it,Xt,ne,Pt,qt)},Ut=(Q,rt,Mt,Ft,it,Xt,ne,Pt)=>{let qt,Vt;const{props:ue,shapeFlag:Ee,transition:we,dirs:De}=Q;if(qt=Q.el=m(Q.type,Xt,ue&&ue.is,ue),Ee&8?R(qt,Q.children):Ee&16&&te(Q.children,qt,null,Ft,it,Mp(Q,Xt),ne,Pt),De&&fo(Q,null,Ft,"created"),ce(qt,Q,Q.scopeId,ne,Ft),ue){for(const ii in ue)ii!=="value"&&!uh(ii)&&_(qt,ii,null,ue[ii],Xt,Q.children,Ft,it,Pi);"value"in ue&&_(qt,"value",null,ue.value,Xt),(Vt=ue.onVnodeBeforeMount)&&wn(Vt,Ft,Q)}De&&fo(Q,null,Ft,"beforeMount");const Xe=o2(it,we);Xe&&we.beforeEnter(qt),h(qt,rt,Mt),((Vt=ue&&ue.onVnodeMounted)||Xe||De)&&wr(()=>{Vt&&wn(Vt,Ft,Q),Xe&&we.enter(qt),De&&fo(Q,null,Ft,"mounted")},it)},ce=(Q,rt,Mt,Ft,it)=>{if(Mt&&K(Q,Mt),Ft)for(let Xt=0;Xt<Ft.length;Xt++)K(Q,Ft[Xt]);if(it){let Xt=it.subTree;if(rt===Xt){const ne=it.vnode;ce(Q,ne,ne.scopeId,ne.slotScopeIds,it.parent)}}},te=(Q,rt,Mt,Ft,it,Xt,ne,Pt,qt=0)=>{for(let Vt=qt;Vt<Q.length;Vt++){const ue=Q[Vt]=Pt?Ia(Q[Vt]):Sn(Q[Vt]);lt(null,ue,rt,Mt,Ft,it,Xt,ne,Pt)}},fe=(Q,rt,Mt,Ft,it,Xt,ne)=>{const Pt=rt.el=Q.el;let{patchFlag:qt,dynamicChildren:Vt,dirs:ue}=rt;qt|=Q.patchFlag&16;const Ee=Q.props||ji,we=rt.props||ji;let De;if(Mt&&po(Mt,!1),(De=we.onVnodeBeforeUpdate)&&wn(De,Mt,rt,Q),ue&&fo(rt,Q,Mt,"beforeUpdate"),Mt&&po(Mt,!0),Vt?Ce(Q.dynamicChildren,Vt,Pt,Mt,Ft,Mp(rt,it),Xt):ne||Ye(Q,rt,Pt,null,Mt,Ft,Mp(rt,it),Xt,!1),qt>0){if(qt&16)xe(Pt,rt,Ee,we,Mt,Ft,it);else if(qt&2&&Ee.class!==we.class&&_(Pt,"class",null,we.class,it),qt&4&&_(Pt,"style",Ee.style,we.style,it),qt&8){const Xe=rt.dynamicProps;for(let ii=0;ii<Xe.length;ii++){const Rt=Xe[ii],gi=Ee[Rt],Ci=we[Rt];(Ci!==gi||Rt==="value")&&_(Pt,Rt,gi,Ci,it,Q.children,Mt,Ft,Pi)}}qt&1&&Q.children!==rt.children&&R(Pt,rt.children)}else!ne&&Vt==null&&xe(Pt,rt,Ee,we,Mt,Ft,it);((De=we.onVnodeUpdated)||ue)&&wr(()=>{De&&wn(De,Mt,rt,Q),ue&&fo(rt,Q,Mt,"updated")},Ft)},Ce=(Q,rt,Mt,Ft,it,Xt,ne)=>{for(let Pt=0;Pt<rt.length;Pt++){const qt=Q[Pt],Vt=rt[Pt],ue=qt.el&&(qt.type===ns||!Jc(qt,Vt)||qt.shapeFlag&70)?P(qt.el):Mt;lt(qt,Vt,ue,null,Ft,it,Xt,ne,!0)}},xe=(Q,rt,Mt,Ft,it,Xt,ne)=>{if(Mt!==Ft){if(Mt!==ji)for(const Pt in Mt)!uh(Pt)&&!(Pt in Ft)&&_(Q,Pt,Mt[Pt],null,ne,rt.children,it,Xt,Pi);for(const Pt in Ft){if(uh(Pt))continue;const qt=Ft[Pt],Vt=Mt[Pt];qt!==Vt&&Pt!=="value"&&_(Q,Pt,Vt,qt,ne,rt.children,it,Xt,Pi)}"value"in Ft&&_(Q,"value",Mt.value,Ft.value,ne)}},ri=(Q,rt,Mt,Ft,it,Xt,ne,Pt,qt)=>{const Vt=rt.el=Q?Q.el:l(""),ue=rt.anchor=Q?Q.anchor:l("");let{patchFlag:Ee,dynamicChildren:we,slotScopeIds:De}=rt;De&&(Pt=Pt?Pt.concat(De):De),Q==null?(h(Vt,Mt,Ft),h(ue,Mt,Ft),te(rt.children||[],Mt,ue,it,Xt,ne,Pt,qt)):Ee>0&&Ee&64&&we&&Q.dynamicChildren?(Ce(Q.dynamicChildren,we,Mt,it,Xt,ne,Pt),(rt.key!=null||it&&rt===it.subTree)&&rv(Q,rt,!0)):Ye(Q,rt,Mt,ue,it,Xt,ne,Pt,qt)},pe=(Q,rt,Mt,Ft,it,Xt,ne,Pt,qt)=>{rt.slotScopeIds=Pt,Q==null?rt.shapeFlag&512?it.ctx.activate(rt,Mt,Ft,ne,qt):Qt(rt,Mt,Ft,it,Xt,ne,qt):oe(Q,rt,qt)},Qt=(Q,rt,Mt,Ft,it,Xt,ne)=>{const Pt=Q.component=_2(Q,Ft,it);if(H0(Q)&&(Pt.ctx.renderer=ye),y2(Pt),Pt.asyncDep){if(it&&it.registerDep(Pt,ze),!Q.el){const qt=Pt.subTree=Gi(Oa);yt(null,qt,rt,Mt)}}else ze(Pt,Q,rt,Mt,it,Xt,ne)},oe=(Q,rt,Mt)=>{const Ft=rt.component=Q.component;if(Tw(Q,rt,Mt))if(Ft.asyncDep&&!Ft.asyncResolved){Le(Ft,rt,Mt);return}else Ft.next=rt,vw(Ft.update),Ft.effect.dirty=!0,Ft.update();else rt.el=Q.el,Ft.vnode=rt},ze=(Q,rt,Mt,Ft,it,Xt,ne)=>{const Pt=()=>{if(Q.isMounted){let{next:ue,bu:Ee,u:we,parent:De,vnode:Xe}=Q;{const pr=nv(Q);if(pr){ue&&(ue.el=Xe.el,Le(Q,ue,ne)),pr.asyncDep.then(()=>{Q.isUnmounted||Pt()});return}}let ii=ue,Rt;po(Q,!1),ue?(ue.el=Xe.el,Le(Q,ue,ne)):ue=Xe,Ee&&cd(Ee),(Rt=ue.props&&ue.props.onVnodeBeforeUpdate)&&wn(Rt,De,ue,Xe),po(Q,!0);const gi=bp(Q),Ci=Q.subTree;Q.subTree=gi,lt(Ci,gi,P(Ci.el),kt(Ci),Q,it,Xt),ue.el=gi.el,ii===null&&Aw(Q,gi.el),we&&wr(we,it),(Rt=ue.props&&ue.props.onVnodeUpdated)&&wr(()=>wn(Rt,De,ue,Xe),it)}else{let ue;const{el:Ee,props:we}=rt,{bm:De,m:Xe,parent:ii}=Q,Rt=dh(rt);if(po(Q,!1),De&&cd(De),!Rt&&(ue=we&&we.onVnodeBeforeMount)&&wn(ue,ii,rt),po(Q,!0),Ee&&ai){const gi=()=>{Q.subTree=bp(Q),ai(Ee,Q.subTree,Q,it,null)};Rt?rt.type.__asyncLoader().then(()=>!Q.isUnmounted&&gi()):gi()}else{const gi=Q.subTree=bp(Q);lt(null,gi,Mt,Ft,Q,it,Xt),rt.el=gi.el}if(Xe&&wr(Xe,it),!Rt&&(ue=we&&we.onVnodeMounted)){const gi=rt;wr(()=>wn(ue,ii,gi),it)}(rt.shapeFlag&256||ii&&dh(ii.vnode)&&ii.vnode.shapeFlag&256)&&Q.a&&wr(Q.a,it),Q.isMounted=!0,rt=Mt=Ft=null}},qt=Q.effect=new vm(Pt,Wr,()=>Im(Vt),Q.scope),Vt=Q.update=()=>{qt.dirty&&qt.run()};Vt.id=Q.uid,po(Q,!0),Vt()},Le=(Q,rt,Mt)=>{rt.component=Q;const Ft=Q.vnode.props;Q.vnode=rt,Q.next=null,e2(Q,rt.props,Ft,Mt),r2(Q,rt.children,Mt),Ao(),R_(Q),Eo()},Ye=(Q,rt,Mt,Ft,it,Xt,ne,Pt,qt=!1)=>{const Vt=Q&&Q.children,ue=Q?Q.shapeFlag:0,Ee=rt.children,{patchFlag:we,shapeFlag:De}=rt;if(we>0){if(we&128){ks(Vt,Ee,Mt,Ft,it,Xt,ne,Pt,qt);return}else if(we&256){xs(Vt,Ee,Mt,Ft,it,Xt,ne,Pt,qt);return}}De&8?(ue&16&&Pi(Vt,it,Xt),Ee!==Vt&&R(Mt,Ee)):ue&16?De&16?ks(Vt,Ee,Mt,Ft,it,Xt,ne,Pt,qt):Pi(Vt,it,Xt,!0):(ue&8&&R(Mt,""),De&16&&te(Ee,Mt,Ft,it,Xt,ne,Pt,qt))},xs=(Q,rt,Mt,Ft,it,Xt,ne,Pt,qt)=>{Q=Q||Ll,rt=rt||Ll;const Vt=Q.length,ue=rt.length,Ee=Math.min(Vt,ue);let we;for(we=0;we<Ee;we++){const De=rt[we]=qt?Ia(rt[we]):Sn(rt[we]);lt(Q[we],De,Mt,null,it,Xt,ne,Pt,qt)}Vt>ue?Pi(Q,it,Xt,!0,!1,Ee):te(rt,Mt,Ft,it,Xt,ne,Pt,qt,Ee)},ks=(Q,rt,Mt,Ft,it,Xt,ne,Pt,qt)=>{let Vt=0;const ue=rt.length;let Ee=Q.length-1,we=ue-1;for(;Vt<=Ee&&Vt<=we;){const De=Q[Vt],Xe=rt[Vt]=qt?Ia(rt[Vt]):Sn(rt[Vt]);if(Jc(De,Xe))lt(De,Xe,Mt,null,it,Xt,ne,Pt,qt);else break;Vt++}for(;Vt<=Ee&&Vt<=we;){const De=Q[Ee],Xe=rt[we]=qt?Ia(rt[we]):Sn(rt[we]);if(Jc(De,Xe))lt(De,Xe,Mt,null,it,Xt,ne,Pt,qt);else break;Ee--,we--}if(Vt>Ee){if(Vt<=we){const De=we+1,Xe=De<ue?rt[De].el:Ft;for(;Vt<=we;)lt(null,rt[Vt]=qt?Ia(rt[Vt]):Sn(rt[Vt]),Mt,Xe,it,Xt,ne,Pt,qt),Vt++}}else if(Vt>we)for(;Vt<=Ee;)hi(Q[Vt],it,Xt,!0),Vt++;else{const De=Vt,Xe=Vt,ii=new Map;for(Vt=Xe;Vt<=we;Vt++){const Se=rt[Vt]=qt?Ia(rt[Vt]):Sn(rt[Vt]);Se.key!=null&&ii.set(Se.key,Vt)}let Rt,gi=0;const Ci=we-Xe+1;let pr=!1,as=0;const Gt=new Array(Ci);for(Vt=0;Vt<Ci;Vt++)Gt[Vt]=0;for(Vt=De;Vt<=Ee;Vt++){const Se=Q[Vt];if(gi>=Ci){hi(Se,it,Xt,!0);continue}let ui;if(Se.key!=null)ui=ii.get(Se.key);else for(Rt=Xe;Rt<=we;Rt++)if(Gt[Rt-Xe]===0&&Jc(Se,rt[Rt])){ui=Rt;break}ui===void 0?hi(Se,it,Xt,!0):(Gt[ui-Xe]=Vt+1,ui>=as?as=ui:pr=!0,lt(Se,rt[ui],Mt,null,it,Xt,ne,Pt,qt),gi++)}const Oe=pr?l2(Gt):Ll;for(Rt=Oe.length-1,Vt=Ci-1;Vt>=0;Vt--){const Se=Xe+Vt,ui=rt[Se],tr=Se+1<ue?rt[Se+1].el:Ft;Gt[Vt]===0?lt(null,ui,Mt,tr,it,Xt,ne,Pt,qt):pr&&(Rt<0||Vt!==Oe[Rt]?Ii(ui,Mt,tr,2):Rt--)}}},Ii=(Q,rt,Mt,Ft,it=null)=>{const{el:Xt,type:ne,transition:Pt,children:qt,shapeFlag:Vt}=Q;if(Vt&6){Ii(Q.component.subTree,rt,Mt,Ft);return}if(Vt&128){Q.suspense.move(rt,Mt,Ft);return}if(Vt&64){ne.move(Q,rt,Mt,ye);return}if(ne===ns){h(Xt,rt,Mt);for(let Ee=0;Ee<qt.length;Ee++)Ii(qt[Ee],rt,Mt,Ft);h(Q.anchor,rt,Mt);return}if(ne===dd){ut(Q,rt,Mt);return}if(Ft!==2&&Vt&1&&Pt)if(Ft===0)Pt.beforeEnter(Xt),h(Xt,rt,Mt),wr(()=>Pt.enter(Xt),it);else{const{leave:Ee,delayLeave:we,afterLeave:De}=Pt,Xe=()=>h(Xt,rt,Mt),ii=()=>{Ee(Xt,()=>{Xe(),De&&De()})};we?we(Xt,Xe,ii):ii()}else h(Xt,rt,Mt)},hi=(Q,rt,Mt,Ft=!1,it=!1)=>{const{type:Xt,props:ne,ref:Pt,children:qt,dynamicChildren:Vt,shapeFlag:ue,patchFlag:Ee,dirs:we}=Q;if(Pt!=null&&Zp(Pt,null,Mt,Q,!0),ue&256){rt.ctx.deactivate(Q);return}const De=ue&1&&we,Xe=!dh(Q);let ii;if(Xe&&(ii=ne&&ne.onVnodeBeforeUnmount)&&wn(ii,rt,Q),ue&6)As(Q.component,Mt,Ft);else{if(ue&128){Q.suspense.unmount(Mt,Ft);return}De&&fo(Q,null,rt,"beforeUnmount"),ue&64?Q.type.remove(Q,rt,Mt,it,ye,Ft):Vt&&(Xt!==ns||Ee>0&&Ee&64)?Pi(Vt,rt,Mt,!1,!0):(Xt===ns&&Ee&384||!it&&ue&16)&&Pi(qt,rt,Mt),Ft&&bs(Q)}(Xe&&(ii=ne&&ne.onVnodeUnmounted)||De)&&wr(()=>{ii&&wn(ii,rt,Q),De&&fo(Q,null,rt,"unmounted")},Mt)},bs=Q=>{const{type:rt,el:Mt,anchor:Ft,transition:it}=Q;if(rt===ns){fr(Mt,Ft);return}if(rt===dd){Dt(Q);return}const Xt=()=>{p(Mt),it&&!it.persisted&&it.afterLeave&&it.afterLeave()};if(Q.shapeFlag&1&&it&&!it.persisted){const{leave:ne,delayLeave:Pt}=it,qt=()=>ne(Mt,Xt);Pt?Pt(Q.el,Xt,qt):qt()}else Xt()},fr=(Q,rt)=>{let Mt;for(;Q!==rt;)Mt=L(Q),p(Q),Q=Mt;p(rt)},As=(Q,rt,Mt)=>{const{bum:Ft,scope:it,update:Xt,subTree:ne,um:Pt}=Q;Ft&&cd(Ft),it.stop(),Xt&&(Xt.active=!1,hi(ne,Q,rt,Mt)),Pt&&wr(Pt,rt),wr(()=>{Q.isUnmounted=!0},rt),rt&&rt.pendingBranch&&!rt.isUnmounted&&Q.asyncDep&&!Q.asyncResolved&&Q.suspenseId===rt.pendingId&&(rt.deps--,rt.deps===0&&rt.resolve())},Pi=(Q,rt,Mt,Ft=!1,it=!1,Xt=0)=>{for(let ne=Xt;ne<Q.length;ne++)hi(Q[ne],rt,Mt,Ft,it)},kt=Q=>Q.shapeFlag&6?kt(Q.component.subTree):Q.shapeFlag&128?Q.suspense.next():L(Q.anchor||Q.el);let ae=!1;const re=(Q,rt,Mt)=>{Q==null?rt._vnode&&hi(rt._vnode,null,null,!0):lt(rt._vnode||null,Q,rt,null,null,null,Mt),ae||(ae=!0,R_(),B0(),ae=!1),rt._vnode=Q},ye={p:lt,um:hi,m:Ii,r:bs,mt:Qt,mc:te,pc:Ye,pbc:Ce,n:kt,o:t};let ni,ai;return r&&([ni,ai]=r(ye)),{render:re,hydrate:ni,createApp:Jw(re,ni)}}function Mp({type:t,props:r},a){return a==="svg"&&t==="foreignObject"||a==="mathml"&&t==="annotation-xml"&&r&&r.encoding&&r.encoding.includes("html")?void 0:a}function po({effect:t,update:r},a){t.allowRecurse=r.allowRecurse=a}function o2(t,r){return(!t||t&&!t.pendingBranch)&&r&&!r.persisted}function rv(t,r,a=!1){const h=t.children,p=r.children;if(Ge(h)&&Ge(p))for(let _=0;_<h.length;_++){const m=h[_];let l=p[_];l.shapeFlag&1&&!l.dynamicChildren&&((l.patchFlag<=0||l.patchFlag===32)&&(l=p[_]=Ia(p[_]),l.el=m.el),a||rv(m,l)),l.type===Kd&&(l.el=m.el)}}function l2(t){const r=t.slice(),a=[0];let h,p,_,m,l;const T=t.length;for(h=0;h<T;h++){const I=t[h];if(I!==0){if(p=a[a.length-1],t[p]<I){r[h]=p,a.push(h);continue}for(_=0,m=a.length-1;_<m;)l=_+m>>1,t[a[l]]<I?_=l+1:m=l;I<t[a[_]]&&(_>0&&(r[h]=a[_-1]),a[_]=h)}}for(_=a.length,m=a[_-1];_-- >0;)a[_]=m,m=r[m];return a}function nv(t){const r=t.subTree.component;if(r)return r.asyncDep&&!r.asyncResolved?r:nv(r)}const c2=t=>t.__isTeleport,ns=Symbol.for("v-fgt"),Kd=Symbol.for("v-txt"),Oa=Symbol.for("v-cmt"),dd=Symbol.for("v-stc"),ph=[];let nn=null;function Pe(t=!1){ph.push(nn=t?null:[])}function h2(){ph.pop(),nn=ph[ph.length-1]||null}let Ah=1;function j_(t){Ah+=t}function av(t){return t.dynamicChildren=Ah>0?nn||Ll:null,h2(),Ah>0&&nn&&nn.push(t),t}function Ue(t,r,a,h,p,_){return av(ct(t,r,a,h,p,_,!0))}function Kn(t,r,a,h,p){return av(Gi(t,r,a,h,p,!0))}function Ad(t){return t?t.__v_isVNode===!0:!1}function Jc(t,r){return t.type===r.type&&t.key===r.key}const Yd="__vInternal",ov=({key:t})=>t??null,fd=({ref:t,ref_key:r,ref_for:a})=>(typeof t=="number"&&(t=""+t),t!=null?Ss(t)||ys(t)||Ke(t)?{i:Ms,r:t,k:r,f:!!a}:t:null);function ct(t,r=null,a=null,h=0,p=null,_=t===ns?0:1,m=!1,l=!1){const T={__v_isVNode:!0,__v_skip:!0,type:t,props:r,key:r&&ov(r),ref:r&&fd(r),scopeId:Hd,slotScopeIds:null,children:a,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:_,patchFlag:h,dynamicProps:p,dynamicChildren:null,appContext:null,ctx:Ms};return l?(Dm(T,a),_&128&&t.normalize(T)):a&&(T.shapeFlag|=Ss(a)?8:16),Ah>0&&!m&&nn&&(T.patchFlag>0||_&6)&&T.patchFlag!==32&&nn.push(T),T}const Gi=u2;function u2(t,r=null,a=null,h=0,p=null,_=!1){if((!t||t===Ew)&&(t=Oa),Ad(t)){const l=Ul(t,r,!0);return a&&Dm(l,a),Ah>0&&!_&&nn&&(l.shapeFlag&6?nn[nn.indexOf(t)]=l:nn.push(l)),l.patchFlag|=-2,l}if(M2(t)&&(t=t.__vccOpts),r){r=d2(r);let{class:l,style:T}=r;l&&!Ss(l)&&(r.class=xo(l)),Hi(T)&&(C0(T)&&!Ge(T)&&(T=Us({},T)),r.style=ym(T))}const m=Ss(t)?1:Pw(t)?128:c2(t)?64:Hi(t)?4:Ke(t)?2:0;return ct(t,r,a,h,p,m,_,!0)}function d2(t){return t?C0(t)||Yd in t?Us({},t):t:null}function Ul(t,r,a=!1){const{props:h,ref:p,patchFlag:_,children:m}=t,l=r?p2(h||{},r):h;return{__v_isVNode:!0,__v_skip:!0,type:t.type,props:l,key:l&&ov(l),ref:r&&r.ref?a&&p?Ge(p)?p.concat(fd(r)):[p,fd(r)]:fd(r):p,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:m,target:t.target,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:r&&t.type!==ns?_===-1?16:_|16:_,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:t.transition,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&Ul(t.ssContent),ssFallback:t.ssFallback&&Ul(t.ssFallback),el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce}}function lv(t=" ",r=0){return Gi(Kd,null,t,r)}function f2(t,r){const a=Gi(dd,null,t);return a.staticCount=r,a}function Zi(t="",r=!1){return r?(Pe(),Kn(Oa,null,t)):Gi(Oa,null,t)}function Sn(t){return t==null||typeof t=="boolean"?Gi(Oa):Ge(t)?Gi(ns,null,t.slice()):typeof t=="object"?Ia(t):Gi(Kd,null,String(t))}function Ia(t){return t.el===null&&t.patchFlag!==-1||t.memo?t:Ul(t)}function Dm(t,r){let a=0;const{shapeFlag:h}=t;if(r==null)r=null;else if(Ge(r))a=16;else if(typeof r=="object")if(h&65){const p=r.default;p&&(p._c&&(p._d=!1),Dm(t,p()),p._c&&(p._d=!0));return}else{a=32;const p=r._;!p&&!(Yd in r)?r._ctx=Ms:p===3&&Ms&&(Ms.slots._===1?r._=1:(r._=2,t.patchFlag|=1024))}else Ke(r)?(r={default:r,_ctx:Ms},a=32):(r=String(r),h&64?(a=16,r=[lv(r)]):a=8);t.children=r,t.shapeFlag|=a}function p2(...t){const r={};for(let a=0;a<t.length;a++){const h=t[a];for(const p in h)if(p==="class")r.class!==h.class&&(r.class=xo([r.class,h.class]));else if(p==="style")r.style=ym([r.style,h.style]);else if(Bd(p)){const _=r[p],m=h[p];m&&_!==m&&!(Ge(_)&&_.includes(m))&&(r[p]=_?[].concat(_,m):m)}else p!==""&&(r[p]=h[p])}return r}function wn(t,r,a,h=null){an(t,r,7,[a,h])}const m2=J0();let g2=0;function _2(t,r,a){const h=t.type,p=(r?r.appContext:t.appContext)||m2,_={uid:g2++,vnode:t,type:h,parent:r,appContext:p,root:null,next:null,subTree:null,effect:null,update:null,scope:new p0(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:r?r.provides:Object.create(p.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:tv(h,p),emitsOptions:$0(h,p),emit:null,emitted:null,propsDefaults:ji,inheritAttrs:h.inheritAttrs,ctx:ji,data:ji,props:ji,attrs:ji,slots:ji,refs:ji,setupState:ji,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:a,suspenseId:a?a.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return _.ctx={_},_.root=r?r.root:_,_.emit=ww.bind(null,_),t.ce&&t.ce(_),_}let Vs=null,Ed,Xp;{const t=u0(),r=(a,h)=>{let p;return(p=t[a])||(p=t[a]=[]),p.push(h),_=>{p.length>1?p.forEach(m=>m(_)):p[0](_)}};Ed=r("__VUE_INSTANCE_SETTERS__",a=>Vs=a),Xp=r("__VUE_SSR_SETTERS__",a=>Jd=a)}const Oh=t=>{const r=Vs;return Ed(t),t.scope.on(),()=>{t.scope.off(),Ed(r)}},G_=()=>{Vs&&Vs.scope.off(),Ed(null)};function cv(t){return t.vnode.shapeFlag&4}let Jd=!1;function y2(t,r=!1){r&&Xp(r);const{props:a,children:h}=t.vnode,p=cv(t);t2(t,a,p,r),s2(t,h);const _=p?v2(t,r):void 0;return r&&Xp(!1),_}function v2(t,r){const a=t.type;t.accessCache=Object.create(null),t.proxy=qd(new Proxy(t.ctx,Gw));const{setup:h}=a;if(h){const p=t.setupContext=h.length>1?b2(t):null,_=Oh(t);Ao();const m=ka(h,t,0,[t.props,p]);if(Eo(),_(),l0(m)){if(m.then(G_,G_),r)return m.then(l=>{H_(t,l,r)}).catch(l=>{jd(l,t,0)});t.asyncDep=m}else H_(t,m,r)}else hv(t,r)}function H_(t,r,a){Ke(r)?t.type.__ssrInlineRender?t.ssrRender=r:t.render=r:Hi(r)&&(t.setupState=z0(r)),hv(t,a)}let W_;function hv(t,r,a){const h=t.type;if(!t.render){if(!r&&W_&&!h.render){const p=h.template||Pm(t).template;if(p){const{isCustomElement:_,compilerOptions:m}=t.appContext.config,{delimiters:l,compilerOptions:T}=h,I=Us(Us({isCustomElement:_,delimiters:l},m),T);h.render=W_(p,I)}}t.render=h.render||Wr}{const p=Oh(t);Ao();try{Hw(t)}finally{Eo(),p()}}}function x2(t){return t.attrsProxy||(t.attrsProxy=new Proxy(t.attrs,{get(r,a){return Mr(t,"get","$attrs"),r[a]}}))}function b2(t){const r=a=>{t.exposed=a||{}};return{get attrs(){return x2(t)},slots:t.slots,emit:t.emit,expose:r}}function Qd(t){if(t.exposed)return t.exposeProxy||(t.exposeProxy=new Proxy(z0(qd(t.exposed)),{get(r,a){if(a in r)return r[a];if(a in fh)return fh[a](t)},has(r,a){return a in r||a in fh}}))}function w2(t,r=!0){return Ke(t)?t.displayName||t.name:t.name||r&&t.__name}function M2(t){return Ke(t)&&"__vccOpts"in t}const wi=(t,r)=>cw(t,r,Jd);function uv(t,r,a){const h=arguments.length;return h===2?Hi(r)&&!Ge(r)?Ad(r)?Gi(t,null,[r]):Gi(t,r):Gi(t,null,r):(h>3?a=Array.prototype.slice.call(arguments,2):h===3&&Ad(a)&&(a=[a]),Gi(t,r,a))}const S2="3.4.21";/**
* @vue/runtime-dom v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const T2="http://www.w3.org/2000/svg",A2="http://www.w3.org/1998/Math/MathML",Pa=typeof document<"u"?document:null,Z_=Pa&&Pa.createElement("template"),E2={insert:(t,r,a)=>{r.insertBefore(t,a||null)},remove:t=>{const r=t.parentNode;r&&r.removeChild(t)},createElement:(t,r,a,h)=>{const p=r==="svg"?Pa.createElementNS(T2,t):r==="mathml"?Pa.createElementNS(A2,t):Pa.createElement(t,a?{is:a}:void 0);return t==="select"&&h&&h.multiple!=null&&p.setAttribute("multiple",h.multiple),p},createText:t=>Pa.createTextNode(t),createComment:t=>Pa.createComment(t),setText:(t,r)=>{t.nodeValue=r},setElementText:(t,r)=>{t.textContent=r},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>Pa.querySelector(t),setScopeId(t,r){t.setAttribute(r,"")},insertStaticContent(t,r,a,h,p,_){const m=a?a.previousSibling:r.lastChild;if(p&&(p===_||p.nextSibling))for(;r.insertBefore(p.cloneNode(!0),a),!(p===_||!(p=p.nextSibling)););else{Z_.innerHTML=h==="svg"?`<svg>${t}</svg>`:h==="mathml"?`<math>${t}</math>`:t;const l=Z_.content;if(h==="svg"||h==="mathml"){const T=l.firstChild;for(;T.firstChild;)l.appendChild(T.firstChild);l.removeChild(T)}r.insertBefore(l,a)}return[m?m.nextSibling:r.firstChild,a?a.previousSibling:r.lastChild]}},I2=Symbol("_vtc");function P2(t,r,a){const h=t[I2];h&&(r=(r?[r,...h]:[...h]).join(" ")),r==null?t.removeAttribute("class"):a?t.setAttribute("class",r):t.className=r}const Id=Symbol("_vod"),dv=Symbol("_vsh"),C2={beforeMount(t,{value:r},{transition:a}){t[Id]=t.style.display==="none"?"":t.style.display,a&&r?a.beforeEnter(t):Qc(t,r)},mounted(t,{value:r},{transition:a}){a&&r&&a.enter(t)},updated(t,{value:r,oldValue:a},{transition:h}){!r!=!a&&(h?r?(h.beforeEnter(t),Qc(t,!0),h.enter(t)):h.leave(t,()=>{Qc(t,!1)}):Qc(t,r))},beforeUnmount(t,{value:r}){Qc(t,r)}};function Qc(t,r){t.style.display=r?t[Id]:"none",t[dv]=!r}const D2=Symbol(""),k2=/(^|;)\s*display\s*:/;function R2(t,r,a){const h=t.style,p=Ss(a);let _=!1;if(a&&!p){if(r)if(Ss(r))for(const m of r.split(";")){const l=m.slice(0,m.indexOf(":")).trim();a[l]==null&&pd(h,l,"")}else for(const m in r)a[m]==null&&pd(h,m,"");for(const m in a)m==="display"&&(_=!0),pd(h,m,a[m])}else if(p){if(r!==a){const m=h[D2];m&&(a+=";"+m),h.cssText=a,_=k2.test(a)}}else r&&t.removeAttribute("style");Id in t&&(t[Id]=_?h.display:"",t[dv]&&(h.display="none"))}const X_=/\s*!important$/;function pd(t,r,a){if(Ge(a))a.forEach(h=>pd(t,r,h));else if(a==null&&(a=""),r.startsWith("--"))t.setProperty(r,a);else{const h=z2(t,r);X_.test(a)?t.setProperty(To(h),a.replace(X_,""),"important"):t[h]=a}}const K_=["Webkit","Moz","ms"],Sp={};function z2(t,r){const a=Sp[r];if(a)return a;let h=Cn(r);if(h!=="filter"&&h in t)return Sp[r]=h;h=Vd(h);for(let p=0;p<K_.length;p++){const _=K_[p]+h;if(_ in t)return Sp[r]=_}return r}const Y_="http://www.w3.org/1999/xlink";function L2(t,r,a,h,p){if(h&&r.startsWith("xlink:"))a==null?t.removeAttributeNS(Y_,r.slice(6,r.length)):t.setAttributeNS(Y_,r,a);else{const _=$b(r);a==null||_&&!d0(a)?t.removeAttribute(r):t.setAttribute(r,_?"":a)}}function O2(t,r,a,h,p,_,m){if(r==="innerHTML"||r==="textContent"){h&&m(h,p,_),t[r]=a??"";return}const l=t.tagName;if(r==="value"&&l!=="PROGRESS"&&!l.includes("-")){const I=l==="OPTION"?t.getAttribute("value")||"":t.value,R=a??"";(I!==R||!("_value"in t))&&(t.value=R),a==null&&t.removeAttribute(r),t._value=a;return}let T=!1;if(a===""||a==null){const I=typeof t[r];I==="boolean"?a=d0(a):a==null&&I==="string"?(a="",T=!0):I==="number"&&(a=0,T=!0)}try{t[r]=a}catch{}T&&t.removeAttribute(r)}function El(t,r,a,h){t.addEventListener(r,a,h)}function F2(t,r,a,h){t.removeEventListener(r,a,h)}const J_=Symbol("_vei");function B2(t,r,a,h,p=null){const _=t[J_]||(t[J_]={}),m=_[r];if(h&&m)m.value=h;else{const[l,T]=N2(r);if(h){const I=_[r]=U2(h,p);El(t,l,I,T)}else m&&(F2(t,l,m,T),_[r]=void 0)}}const Q_=/(?:Once|Passive|Capture)$/;function N2(t){let r;if(Q_.test(t)){r={};let h;for(;h=t.match(Q_);)t=t.slice(0,t.length-h[0].length),r[h[0].toLowerCase()]=!0}return[t[2]===":"?t.slice(3):To(t.slice(2)),r]}let Tp=0;const $2=Promise.resolve(),V2=()=>Tp||($2.then(()=>Tp=0),Tp=Date.now());function U2(t,r){const a=h=>{if(!h._vts)h._vts=Date.now();else if(h._vts<=a.attached)return;an(q2(h,a.value),r,5,[h])};return a.value=t,a.attached=V2(),a}function q2(t,r){if(Ge(r)){const a=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{a.call(t),t._stopped=!0},r.map(h=>p=>!p._stopped&&h&&h(p))}else return r}const ty=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&t.charCodeAt(2)>96&&t.charCodeAt(2)<123,j2=(t,r,a,h,p,_,m,l,T)=>{const I=p==="svg";r==="class"?P2(t,h,I):r==="style"?R2(t,a,h):Bd(r)?mm(r)||B2(t,r,a,h,m):(r[0]==="."?(r=r.slice(1),!0):r[0]==="^"?(r=r.slice(1),!1):G2(t,r,h,I))?O2(t,r,h,_,m,l,T):(r==="true-value"?t._trueValue=h:r==="false-value"&&(t._falseValue=h),L2(t,r,h,I))};function G2(t,r,a,h){if(h)return!!(r==="innerHTML"||r==="textContent"||r in t&&ty(r)&&Ke(a));if(r==="spellcheck"||r==="draggable"||r==="translate"||r==="form"||r==="list"&&t.tagName==="INPUT"||r==="type"&&t.tagName==="TEXTAREA")return!1;if(r==="width"||r==="height"){const p=t.tagName;if(p==="IMG"||p==="VIDEO"||p==="CANVAS"||p==="SOURCE")return!1}return ty(r)&&Ss(a)?!1:r in t}const ey=t=>{const r=t.props["onUpdate:modelValue"]||!1;return Ge(r)?a=>cd(r,a):r};function H2(t){t.target.composing=!0}function iy(t){const r=t.target;r.composing&&(r.composing=!1,r.dispatchEvent(new Event("input")))}const Ap=Symbol("_assign"),W2={created(t,{modifiers:{lazy:r,trim:a,number:h}},p){t[Ap]=ey(p);const _=h||p.props&&p.props.type==="number";El(t,r?"change":"input",m=>{if(m.target.composing)return;let l=t.value;a&&(l=l.trim()),_&&(l=Np(l)),t[Ap](l)}),a&&El(t,"change",()=>{t.value=t.value.trim()}),r||(El(t,"compositionstart",H2),El(t,"compositionend",iy),El(t,"change",iy))},mounted(t,{value:r}){t.value=r??""},beforeUpdate(t,{value:r,modifiers:{lazy:a,trim:h,number:p}},_){if(t[Ap]=ey(_),t.composing)return;const m=p||t.type==="number"?Np(t.value):t.value,l=r??"";m!==l&&(document.activeElement===t&&t.type!=="range"&&(a||h&&t.value.trim()===l)||(t.value=l))}},Z2={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},X2=(t,r)=>{const a=t._withKeys||(t._withKeys={}),h=r.join(".");return a[h]||(a[h]=p=>{if(!("key"in p))return;const _=To(p.key);if(r.some(m=>m===_||Z2[m]===_))return t(p)})},K2=Us({patchProp:j2},E2);let sy;function Y2(){return sy||(sy=n2(K2))}const J2=(...t)=>{const r=Y2().createApp(...t),{mount:a}=r;return r.mount=h=>{const p=tM(h);if(!p)return;const _=r._component;!Ke(_)&&!_.render&&!_.template&&(_.template=p.innerHTML),p.innerHTML="";const m=a(p,!1,Q2(p));return p instanceof Element&&(p.removeAttribute("v-cloak"),p.setAttribute("data-v-app","")),m},r};function Q2(t){if(t instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&t instanceof MathMLElement)return"mathml"}function tM(t){return Ss(t)?document.querySelector(t):t}var eM=!1;/*!
 * pinia v2.1.7
 * (c) 2023 Eduardo San Martin Morote
 * @license MIT
 */let fv;const tf=t=>fv=t,pv=Symbol();function Kp(t){return t&&typeof t=="object"&&Object.prototype.toString.call(t)==="[object Object]"&&typeof t.toJSON!="function"}var mh;(function(t){t.direct="direct",t.patchObject="patch object",t.patchFunction="patch function"})(mh||(mh={}));function iM(){const t=m0(!0),r=t.run(()=>rn({}));let a=[],h=[];const p=qd({install(_){tf(p),p._a=_,_.provide(pv,p),_.config.globalProperties.$pinia=p,h.forEach(m=>a.push(m)),h=[]},use(_){return!this._a&&!eM?h.push(_):a.push(_),this},_p:a,_a:null,_e:t,_s:new Map,state:r});return p}const mv=()=>{};function ry(t,r,a,h=mv){t.push(r);const p=()=>{const _=t.indexOf(r);_>-1&&(t.splice(_,1),h())};return!a&&g0()&&Ub(p),p}function Tl(t,...r){t.slice().forEach(a=>{a(...r)})}const sM=t=>t();function Yp(t,r){t instanceof Map&&r instanceof Map&&r.forEach((a,h)=>t.set(h,a)),t instanceof Set&&r instanceof Set&&r.forEach(t.add,t);for(const a in r){if(!r.hasOwnProperty(a))continue;const h=r[a],p=t[a];Kp(p)&&Kp(h)&&t.hasOwnProperty(a)&&!ys(h)&&!Jn(h)?t[a]=Yp(p,h):t[a]=h}return t}const rM=Symbol();function nM(t){return!Kp(t)||!t.hasOwnProperty(rM)}const{assign:Aa}=Object;function aM(t){return!!(ys(t)&&t.effect)}function oM(t,r,a,h){const{state:p,actions:_,getters:m}=r,l=a.state.value[t];let T;function I(){l||(a.state.value[t]=p?p():{});const R=fw(a.state.value[t]);return Aa(R,_,Object.keys(m||{}).reduce((P,L)=>(P[L]=qd(wi(()=>{tf(a);const K=a._s.get(t);return m[L].call(K,K)})),P),{}))}return T=gv(t,I,r,a,h,!0),T}function gv(t,r,a={},h,p,_){let m;const l=Aa({actions:{}},a),T={deep:!0};let I,R,P=[],L=[],K;const tt=h.state.value[t];!_&&!tt&&(h.state.value[t]={}),rn({});let lt;function vt(te){let fe;I=R=!1,typeof te=="function"?(te(h.state.value[t]),fe={type:mh.patchFunction,storeId:t,events:K}):(Yp(h.state.value[t],te),fe={type:mh.patchObject,payload:te,storeId:t,events:K});const Ce=lt=Symbol();Em().then(()=>{lt===Ce&&(I=!0)}),R=!0,Tl(P,fe,h.state.value[t])}const yt=_?function(){const{state:fe}=a,Ce=fe?fe():{};this.$patch(xe=>{Aa(xe,Ce)})}:mv;function Tt(){m.stop(),P=[],L=[],h._s.delete(t)}function ut(te,fe){return function(){tf(h);const Ce=Array.from(arguments),xe=[],ri=[];function pe(ze){xe.push(ze)}function Qt(ze){ri.push(ze)}Tl(L,{args:Ce,name:te,store:Ot,after:pe,onError:Qt});let oe;try{oe=fe.apply(this&&this.$id===t?this:Ot,Ce)}catch(ze){throw Tl(ri,ze),ze}return oe instanceof Promise?oe.then(ze=>(Tl(xe,ze),ze)).catch(ze=>(Tl(ri,ze),Promise.reject(ze))):(Tl(xe,oe),oe)}}const Dt={_p:h,$id:t,$onAction:ry.bind(null,L),$patch:vt,$reset:yt,$subscribe(te,fe={}){const Ce=ry(P,te,fe.detached,()=>xe()),xe=m.run(()=>Ra(()=>h.state.value[t],ri=>{(fe.flush==="sync"?R:I)&&te({storeId:t,type:mh.direct,events:K},ri)},Aa({},T,fe)));return Ce},$dispose:Tt},Ot=zh(Dt);h._s.set(t,Ot);const ce=(h._a&&h._a.runWithContext||sM)(()=>h._e.run(()=>(m=m0()).run(r)));for(const te in ce){const fe=ce[te];if(ys(fe)&&!aM(fe)||Jn(fe))_||(tt&&nM(fe)&&(ys(fe)?fe.value=tt[te]:Yp(fe,tt[te])),h.state.value[t][te]=fe);else if(typeof fe=="function"){const Ce=ut(te,fe);ce[te]=Ce,l.actions[te]=fe}}return Aa(Ot,ce),Aa(ci(Ot),ce),Object.defineProperty(Ot,"$state",{get:()=>h.state.value[t],set:te=>{vt(fe=>{Aa(fe,te)})}}),h._p.forEach(te=>{Aa(Ot,m.run(()=>te({store:Ot,app:h._a,pinia:h,options:l})))}),tt&&_&&a.hydrate&&a.hydrate(Ot.$state,tt),I=!0,R=!0,Ot}function ea(t,r,a){let h,p;const _=typeof r=="function";typeof t=="string"?(h=t,p=_?a:r):(p=t,h=t.id);function m(l,T){const I=Qw();return l=l||(I?Zr(pv,null):null),l&&tf(l),l=fv,l._s.has(h)||(_?gv(h,r,p,l):oM(h,p,l)),l._s.get(h)}return m.$id=h,m}function lM(t){{t=ci(t);const r={};for(const a in t){const h=t[a];(ys(h)||Jn(h))&&(r[a]=gw(t,a))}return r}}const Kr=ea("MainStore",{state:()=>({lastSearchMethod:"",currentAddress:"",currentTopic:"Property",currentNearbyDataType:"nearby311",dataSourcesLoadedArray:[]}),actions:{setCurrentAddress(t){this.currentAddress=t},setLastSearchMethod(t){this.lastSearchMethod=t},setCurrentNearbyDataType(t){this.currentNearbyDataType=t},clearDataSourcesLoadedArray(){this.dataSourcesLoadedArray=[]},addToDataSourcesLoadedArray(t){this.dataSourcesLoadedArray.push(t)}}});/*!
  * vue-router v4.3.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const Il=typeof document<"u";function cM(t){return t.__esModule||t[Symbol.toStringTag]==="Module"}const Si=Object.assign;function Ep(t,r){const a={};for(const h in r){const p=r[h];a[h]=ln(p)?p.map(t):t(p)}return a}const gh=()=>{},ln=Array.isArray,_v=/#/g,hM=/&/g,uM=/\//g,dM=/=/g,fM=/\?/g,yv=/\+/g,pM=/%5B/g,mM=/%5D/g,vv=/%5E/g,gM=/%60/g,xv=/%7B/g,_M=/%7C/g,bv=/%7D/g,yM=/%20/g;function km(t){return encodeURI(""+t).replace(_M,"|").replace(pM,"[").replace(mM,"]")}function vM(t){return km(t).replace(xv,"{").replace(bv,"}").replace(vv,"^")}function Jp(t){return km(t).replace(yv,"%2B").replace(yM,"+").replace(_v,"%23").replace(hM,"%26").replace(gM,"`").replace(xv,"{").replace(bv,"}").replace(vv,"^")}function xM(t){return Jp(t).replace(dM,"%3D")}function bM(t){return km(t).replace(_v,"%23").replace(fM,"%3F")}function wM(t){return t==null?"":bM(t).replace(uM,"%2F")}function Eh(t){try{return decodeURIComponent(""+t)}catch{}return""+t}const MM=/\/$/,SM=t=>t.replace(MM,"");function Ip(t,r,a="/"){let h,p={},_="",m="";const l=r.indexOf("#");let T=r.indexOf("?");return l<T&&l>=0&&(T=-1),T>-1&&(h=r.slice(0,T),_=r.slice(T+1,l>-1?l:r.length),p=t(_)),l>-1&&(h=h||r.slice(0,l),m=r.slice(l,r.length)),h=IM(h??r,a),{fullPath:h+(_&&"?")+_+m,path:h,query:p,hash:Eh(m)}}function TM(t,r){const a=r.query?t(r.query):"";return r.path+(a&&"?")+a+(r.hash||"")}function ny(t,r){return!r||!t.toLowerCase().startsWith(r.toLowerCase())?t:t.slice(r.length)||"/"}function AM(t,r,a){const h=r.matched.length-1,p=a.matched.length-1;return h>-1&&h===p&&ql(r.matched[h],a.matched[p])&&wv(r.params,a.params)&&t(r.query)===t(a.query)&&r.hash===a.hash}function ql(t,r){return(t.aliasOf||t)===(r.aliasOf||r)}function wv(t,r){if(Object.keys(t).length!==Object.keys(r).length)return!1;for(const a in t)if(!EM(t[a],r[a]))return!1;return!0}function EM(t,r){return ln(t)?ay(t,r):ln(r)?ay(r,t):t===r}function ay(t,r){return ln(r)?t.length===r.length&&t.every((a,h)=>a===r[h]):t.length===1&&t[0]===r}function IM(t,r){if(t.startsWith("/"))return t;if(!t)return r;const a=r.split("/"),h=t.split("/"),p=h[h.length-1];(p===".."||p===".")&&h.push("");let _=a.length-1,m,l;for(m=0;m<h.length;m++)if(l=h[m],l!==".")if(l==="..")_>1&&_--;else break;return a.slice(0,_).join("/")+"/"+h.slice(m).join("/")}var Ih;(function(t){t.pop="pop",t.push="push"})(Ih||(Ih={}));var _h;(function(t){t.back="back",t.forward="forward",t.unknown=""})(_h||(_h={}));function PM(t){if(!t)if(Il){const r=document.querySelector("base");t=r&&r.getAttribute("href")||"/",t=t.replace(/^\w+:\/\/[^\/]+/,"")}else t="/";return t[0]!=="/"&&t[0]!=="#"&&(t="/"+t),SM(t)}const CM=/^[^#]+#/;function DM(t,r){return t.replace(CM,"#")+r}function kM(t,r){const a=document.documentElement.getBoundingClientRect(),h=t.getBoundingClientRect();return{behavior:r.behavior,left:h.left-a.left-(r.left||0),top:h.top-a.top-(r.top||0)}}const ef=()=>({left:window.scrollX,top:window.scrollY});function RM(t){let r;if("el"in t){const a=t.el,h=typeof a=="string"&&a.startsWith("#"),p=typeof a=="string"?h?document.getElementById(a.slice(1)):document.querySelector(a):a;if(!p)return;r=kM(p,t)}else r=t;"scrollBehavior"in document.documentElement.style?window.scrollTo(r):window.scrollTo(r.left!=null?r.left:window.scrollX,r.top!=null?r.top:window.scrollY)}function oy(t,r){return(history.state?history.state.position-r:-1)+t}const Qp=new Map;function zM(t,r){Qp.set(t,r)}function LM(t){const r=Qp.get(t);return Qp.delete(t),r}let OM=()=>location.protocol+"//"+location.host;function Mv(t,r){const{pathname:a,search:h,hash:p}=r,_=t.indexOf("#");if(_>-1){let l=p.includes(t.slice(_))?t.slice(_).length:1,T=p.slice(l);return T[0]!=="/"&&(T="/"+T),ny(T,"")}return ny(a,t)+h+p}function FM(t,r,a,h){let p=[],_=[],m=null;const l=({state:L})=>{const K=Mv(t,location),tt=a.value,lt=r.value;let vt=0;if(L){if(a.value=K,r.value=L,m&&m===tt){m=null;return}vt=lt?L.position-lt.position:0}else h(K);p.forEach(yt=>{yt(a.value,tt,{delta:vt,type:Ih.pop,direction:vt?vt>0?_h.forward:_h.back:_h.unknown})})};function T(){m=a.value}function I(L){p.push(L);const K=()=>{const tt=p.indexOf(L);tt>-1&&p.splice(tt,1)};return _.push(K),K}function R(){const{history:L}=window;L.state&&L.replaceState(Si({},L.state,{scroll:ef()}),"")}function P(){for(const L of _)L();_=[],window.removeEventListener("popstate",l),window.removeEventListener("beforeunload",R)}return window.addEventListener("popstate",l),window.addEventListener("beforeunload",R,{passive:!0}),{pauseListeners:T,listen:I,destroy:P}}function ly(t,r,a,h=!1,p=!1){return{back:t,current:r,forward:a,replaced:h,position:window.history.length,scroll:p?ef():null}}function BM(t){const{history:r,location:a}=window,h={value:Mv(t,a)},p={value:r.state};p.value||_(h.value,{back:null,current:h.value,forward:null,position:r.length-1,replaced:!0,scroll:null},!0);function _(T,I,R){const P=t.indexOf("#"),L=P>-1?(a.host&&document.querySelector("base")?t:t.slice(P))+T:OM()+t+T;try{r[R?"replaceState":"pushState"](I,"",L),p.value=I}catch(K){console.error(K),a[R?"replace":"assign"](L)}}function m(T,I){const R=Si({},r.state,ly(p.value.back,T,p.value.forward,!0),I,{position:p.value.position});_(T,R,!0),h.value=T}function l(T,I){const R=Si({},p.value,r.state,{forward:T,scroll:ef()});_(R.current,R,!0);const P=Si({},ly(h.value,T,null),{position:R.position+1},I);_(T,P,!1),h.value=T}return{location:h,state:p,push:l,replace:m}}function NM(t){t=PM(t);const r=BM(t),a=FM(t,r.state,r.location,r.replace);function h(_,m=!0){m||a.pauseListeners(),history.go(_)}const p=Si({location:"",base:t,go:h,createHref:DM.bind(null,t)},r,a);return Object.defineProperty(p,"location",{enumerable:!0,get:()=>r.location.value}),Object.defineProperty(p,"state",{enumerable:!0,get:()=>r.state.value}),p}function $M(t){return t=location.host?t||location.pathname+location.search:"",t.includes("#")||(t+="#"),NM(t)}function VM(t){return typeof t=="string"||t&&typeof t=="object"}function Sv(t){return typeof t=="string"||typeof t=="symbol"}const Ma={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},Tv=Symbol("");var cy;(function(t){t[t.aborted=4]="aborted",t[t.cancelled=8]="cancelled",t[t.duplicated=16]="duplicated"})(cy||(cy={}));function jl(t,r){return Si(new Error,{type:t,[Tv]:!0},r)}function Zn(t,r){return t instanceof Error&&Tv in t&&(r==null||!!(t.type&r))}const hy="[^/]+?",UM={sensitive:!1,strict:!1,start:!0,end:!0},qM=/[.+*?^${}()[\]/\\]/g;function jM(t,r){const a=Si({},UM,r),h=[];let p=a.start?"^":"";const _=[];for(const I of t){const R=I.length?[]:[90];a.strict&&!I.length&&(p+="/");for(let P=0;P<I.length;P++){const L=I[P];let K=40+(a.sensitive?.25:0);if(L.type===0)P||(p+="/"),p+=L.value.replace(qM,"\\$&"),K+=40;else if(L.type===1){const{value:tt,repeatable:lt,optional:vt,regexp:yt}=L;_.push({name:tt,repeatable:lt,optional:vt});const Tt=yt||hy;if(Tt!==hy){K+=10;try{new RegExp(`(${Tt})`)}catch(Dt){throw new Error(`Invalid custom RegExp for param "${tt}" (${Tt}): `+Dt.message)}}let ut=lt?`((?:${Tt})(?:/(?:${Tt}))*)`:`(${Tt})`;P||(ut=vt&&I.length<2?`(?:/${ut})`:"/"+ut),vt&&(ut+="?"),p+=ut,K+=20,vt&&(K+=-8),lt&&(K+=-20),Tt===".*"&&(K+=-50)}R.push(K)}h.push(R)}if(a.strict&&a.end){const I=h.length-1;h[I][h[I].length-1]+=.7000000000000001}a.strict||(p+="/?"),a.end?p+="$":a.strict&&(p+="(?:/|$)");const m=new RegExp(p,a.sensitive?"":"i");function l(I){const R=I.match(m),P={};if(!R)return null;for(let L=1;L<R.length;L++){const K=R[L]||"",tt=_[L-1];P[tt.name]=K&&tt.repeatable?K.split("/"):K}return P}function T(I){let R="",P=!1;for(const L of t){(!P||!R.endsWith("/"))&&(R+="/"),P=!1;for(const K of L)if(K.type===0)R+=K.value;else if(K.type===1){const{value:tt,repeatable:lt,optional:vt}=K,yt=tt in I?I[tt]:"";if(ln(yt)&&!lt)throw new Error(`Provided param "${tt}" is an array but it is not repeatable (* or + modifiers)`);const Tt=ln(yt)?yt.join("/"):yt;if(!Tt)if(vt)L.length<2&&(R.endsWith("/")?R=R.slice(0,-1):P=!0);else throw new Error(`Missing required param "${tt}"`);R+=Tt}}return R||"/"}return{re:m,score:h,keys:_,parse:l,stringify:T}}function GM(t,r){let a=0;for(;a<t.length&&a<r.length;){const h=r[a]-t[a];if(h)return h;a++}return t.length<r.length?t.length===1&&t[0]===80?-1:1:t.length>r.length?r.length===1&&r[0]===80?1:-1:0}function HM(t,r){let a=0;const h=t.score,p=r.score;for(;a<h.length&&a<p.length;){const _=GM(h[a],p[a]);if(_)return _;a++}if(Math.abs(p.length-h.length)===1){if(uy(h))return 1;if(uy(p))return-1}return p.length-h.length}function uy(t){const r=t[t.length-1];return t.length>0&&r[r.length-1]<0}const WM={type:0,value:""},ZM=/[a-zA-Z0-9_]/;function XM(t){if(!t)return[[]];if(t==="/")return[[WM]];if(!t.startsWith("/"))throw new Error(`Invalid path "${t}"`);function r(K){throw new Error(`ERR (${a})/"${I}": ${K}`)}let a=0,h=a;const p=[];let _;function m(){_&&p.push(_),_=[]}let l=0,T,I="",R="";function P(){I&&(a===0?_.push({type:0,value:I}):a===1||a===2||a===3?(_.length>1&&(T==="*"||T==="+")&&r(`A repeatable param (${I}) must be alone in its segment. eg: '/:ids+.`),_.push({type:1,value:I,regexp:R,repeatable:T==="*"||T==="+",optional:T==="*"||T==="?"})):r("Invalid state to consume buffer"),I="")}function L(){I+=T}for(;l<t.length;){if(T=t[l++],T==="\\"&&a!==2){h=a,a=4;continue}switch(a){case 0:T==="/"?(I&&P(),m()):T===":"?(P(),a=1):L();break;case 4:L(),a=h;break;case 1:T==="("?a=2:ZM.test(T)?L():(P(),a=0,T!=="*"&&T!=="?"&&T!=="+"&&l--);break;case 2:T===")"?R[R.length-1]=="\\"?R=R.slice(0,-1)+T:a=3:R+=T;break;case 3:P(),a=0,T!=="*"&&T!=="?"&&T!=="+"&&l--,R="";break;default:r("Unknown state");break}}return a===2&&r(`Unfinished custom RegExp for param "${I}"`),P(),m(),p}function KM(t,r,a){const h=jM(XM(t.path),a),p=Si(h,{record:t,parent:r,children:[],alias:[]});return r&&!p.record.aliasOf==!r.record.aliasOf&&r.children.push(p),p}function YM(t,r){const a=[],h=new Map;r=py({strict:!1,end:!0,sensitive:!1},r);function p(R){return h.get(R)}function _(R,P,L){const K=!L,tt=JM(R);tt.aliasOf=L&&L.record;const lt=py(r,R),vt=[tt];if("alias"in R){const ut=typeof R.alias=="string"?[R.alias]:R.alias;for(const Dt of ut)vt.push(Si({},tt,{components:L?L.record.components:tt.components,path:Dt,aliasOf:L?L.record:tt}))}let yt,Tt;for(const ut of vt){const{path:Dt}=ut;if(P&&Dt[0]!=="/"){const Ot=P.record.path,Ut=Ot[Ot.length-1]==="/"?"":"/";ut.path=P.record.path+(Dt&&Ut+Dt)}if(yt=KM(ut,P,lt),L?L.alias.push(yt):(Tt=Tt||yt,Tt!==yt&&Tt.alias.push(yt),K&&R.name&&!fy(yt)&&m(R.name)),tt.children){const Ot=tt.children;for(let Ut=0;Ut<Ot.length;Ut++)_(Ot[Ut],yt,L&&L.children[Ut])}L=L||yt,(yt.record.components&&Object.keys(yt.record.components).length||yt.record.name||yt.record.redirect)&&T(yt)}return Tt?()=>{m(Tt)}:gh}function m(R){if(Sv(R)){const P=h.get(R);P&&(h.delete(R),a.splice(a.indexOf(P),1),P.children.forEach(m),P.alias.forEach(m))}else{const P=a.indexOf(R);P>-1&&(a.splice(P,1),R.record.name&&h.delete(R.record.name),R.children.forEach(m),R.alias.forEach(m))}}function l(){return a}function T(R){let P=0;for(;P<a.length&&HM(R,a[P])>=0&&(R.record.path!==a[P].record.path||!Av(R,a[P]));)P++;a.splice(P,0,R),R.record.name&&!fy(R)&&h.set(R.record.name,R)}function I(R,P){let L,K={},tt,lt;if("name"in R&&R.name){if(L=h.get(R.name),!L)throw jl(1,{location:R});lt=L.record.name,K=Si(dy(P.params,L.keys.filter(Tt=>!Tt.optional).concat(L.parent?L.parent.keys.filter(Tt=>Tt.optional):[]).map(Tt=>Tt.name)),R.params&&dy(R.params,L.keys.map(Tt=>Tt.name))),tt=L.stringify(K)}else if(R.path!=null)tt=R.path,L=a.find(Tt=>Tt.re.test(tt)),L&&(K=L.parse(tt),lt=L.record.name);else{if(L=P.name?h.get(P.name):a.find(Tt=>Tt.re.test(P.path)),!L)throw jl(1,{location:R,currentLocation:P});lt=L.record.name,K=Si({},P.params,R.params),tt=L.stringify(K)}const vt=[];let yt=L;for(;yt;)vt.unshift(yt.record),yt=yt.parent;return{name:lt,path:tt,params:K,matched:vt,meta:tS(vt)}}return t.forEach(R=>_(R)),{addRoute:_,resolve:I,removeRoute:m,getRoutes:l,getRecordMatcher:p}}function dy(t,r){const a={};for(const h of r)h in t&&(a[h]=t[h]);return a}function JM(t){return{path:t.path,redirect:t.redirect,name:t.name,meta:t.meta||{},aliasOf:void 0,beforeEnter:t.beforeEnter,props:QM(t),children:t.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in t?t.components||null:t.component&&{default:t.component}}}function QM(t){const r={},a=t.props||!1;if("component"in t)r.default=a;else for(const h in t.components)r[h]=typeof a=="object"?a[h]:a;return r}function fy(t){for(;t;){if(t.record.aliasOf)return!0;t=t.parent}return!1}function tS(t){return t.reduce((r,a)=>Si(r,a.meta),{})}function py(t,r){const a={};for(const h in t)a[h]=h in r?r[h]:t[h];return a}function Av(t,r){return r.children.some(a=>a===t||Av(t,a))}function eS(t){const r={};if(t===""||t==="?")return r;const h=(t[0]==="?"?t.slice(1):t).split("&");for(let p=0;p<h.length;++p){const _=h[p].replace(yv," "),m=_.indexOf("="),l=Eh(m<0?_:_.slice(0,m)),T=m<0?null:Eh(_.slice(m+1));if(l in r){let I=r[l];ln(I)||(I=r[l]=[I]),I.push(T)}else r[l]=T}return r}function my(t){let r="";for(let a in t){const h=t[a];if(a=xM(a),h==null){h!==void 0&&(r+=(r.length?"&":"")+a);continue}(ln(h)?h.map(_=>_&&Jp(_)):[h&&Jp(h)]).forEach(_=>{_!==void 0&&(r+=(r.length?"&":"")+a,_!=null&&(r+="="+_))})}return r}function iS(t){const r={};for(const a in t){const h=t[a];h!==void 0&&(r[a]=ln(h)?h.map(p=>p==null?null:""+p):h==null?h:""+h)}return r}const sS=Symbol(""),gy=Symbol(""),sf=Symbol(""),Rm=Symbol(""),tm=Symbol("");function th(){let t=[];function r(h){return t.push(h),()=>{const p=t.indexOf(h);p>-1&&t.splice(p,1)}}function a(){t=[]}return{add:r,list:()=>t.slice(),reset:a}}function Ca(t,r,a,h,p,_=m=>m()){const m=h&&(h.enterCallbacks[p]=h.enterCallbacks[p]||[]);return()=>new Promise((l,T)=>{const I=L=>{L===!1?T(jl(4,{from:a,to:r})):L instanceof Error?T(L):VM(L)?T(jl(2,{from:r,to:L})):(m&&h.enterCallbacks[p]===m&&typeof L=="function"&&m.push(L),l())},R=_(()=>t.call(h&&h.instances[p],r,a,I));let P=Promise.resolve(R);t.length<3&&(P=P.then(I)),P.catch(L=>T(L))})}function Pp(t,r,a,h,p=_=>_()){const _=[];for(const m of t)for(const l in m.components){let T=m.components[l];if(!(r!=="beforeRouteEnter"&&!m.instances[l]))if(rS(T)){const R=(T.__vccOpts||T)[r];R&&_.push(Ca(R,a,h,m,l,p))}else{let I=T();_.push(()=>I.then(R=>{if(!R)return Promise.reject(new Error(`Couldn't resolve component "${l}" at "${m.path}"`));const P=cM(R)?R.default:R;m.components[l]=P;const K=(P.__vccOpts||P)[r];return K&&Ca(K,a,h,m,l,p)()}))}}return _}function rS(t){return typeof t=="object"||"displayName"in t||"props"in t||"__vccOpts"in t}function _y(t){const r=Zr(sf),a=Zr(Rm),h=wi(()=>r.resolve(Ti(t.to))),p=wi(()=>{const{matched:T}=h.value,{length:I}=T,R=T[I-1],P=a.matched;if(!R||!P.length)return-1;const L=P.findIndex(ql.bind(null,R));if(L>-1)return L;const K=yy(T[I-2]);return I>1&&yy(R)===K&&P[P.length-1].path!==K?P.findIndex(ql.bind(null,T[I-2])):L}),_=wi(()=>p.value>-1&&oS(a.params,h.value.params)),m=wi(()=>p.value>-1&&p.value===a.matched.length-1&&wv(a.params,h.value.params));function l(T={}){return aS(T)?r[Ti(t.replace)?"replace":"push"](Ti(t.to)).catch(gh):Promise.resolve()}return{route:h,href:wi(()=>h.value.href),isActive:_,isExactActive:m,navigate:l}}const nS=G0({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:_y,setup(t,{slots:r}){const a=zh(_y(t)),{options:h}=Zr(sf),p=wi(()=>({[vy(t.activeClass,h.linkActiveClass,"router-link-active")]:a.isActive,[vy(t.exactActiveClass,h.linkExactActiveClass,"router-link-exact-active")]:a.isExactActive}));return()=>{const _=r.default&&r.default(a);return t.custom?_:uv("a",{"aria-current":a.isExactActive?t.ariaCurrentValue:null,href:a.href,onClick:a.navigate,class:p.value},_)}}}),Ev=nS;function aS(t){if(!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)&&!t.defaultPrevented&&!(t.button!==void 0&&t.button!==0)){if(t.currentTarget&&t.currentTarget.getAttribute){const r=t.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(r))return}return t.preventDefault&&t.preventDefault(),!0}}function oS(t,r){for(const a in r){const h=r[a],p=t[a];if(typeof h=="string"){if(h!==p)return!1}else if(!ln(p)||p.length!==h.length||h.some((_,m)=>_!==p[m]))return!1}return!0}function yy(t){return t?t.aliasOf?t.aliasOf.path:t.path:""}const vy=(t,r,a)=>t??r??a,lS=G0({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(t,{attrs:r,slots:a}){const h=Zr(tm),p=wi(()=>t.route||h.value),_=Zr(gy,0),m=wi(()=>{let I=Ti(_);const{matched:R}=p.value;let P;for(;(P=R[I])&&!P.components;)I++;return I}),l=wi(()=>p.value.matched[m.value]);ud(gy,wi(()=>m.value+1)),ud(sS,l),ud(tm,p);const T=rn();return Ra(()=>[T.value,l.value,t.name],([I,R,P],[L,K,tt])=>{R&&(R.instances[P]=I,K&&K!==R&&I&&I===L&&(R.leaveGuards.size||(R.leaveGuards=K.leaveGuards),R.updateGuards.size||(R.updateGuards=K.updateGuards))),I&&R&&(!K||!ql(R,K)||!L)&&(R.enterCallbacks[P]||[]).forEach(lt=>lt(I))},{flush:"post"}),()=>{const I=p.value,R=t.name,P=l.value,L=P&&P.components[R];if(!L)return xy(a.default,{Component:L,route:I});const K=P.props[R],tt=K?K===!0?I.params:typeof K=="function"?K(I):K:null,vt=uv(L,Si({},tt,r,{onVnodeUnmounted:yt=>{yt.component.isUnmounted&&(P.instances[R]=null)},ref:T}));return xy(a.default,{Component:vt,route:I})||vt}}});function xy(t,r){if(!t)return null;const a=t(r);return a.length===1?a[0]:a}const cS=lS;function hS(t){const r=YM(t.routes,t),a=t.parseQuery||eS,h=t.stringifyQuery||my,p=t.history,_=th(),m=th(),l=th(),T=hw(Ma);let I=Ma;Il&&t.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const R=Ep.bind(null,kt=>""+kt),P=Ep.bind(null,wM),L=Ep.bind(null,Eh);function K(kt,ae){let re,ye;return Sv(kt)?(re=r.getRecordMatcher(kt),ye=ae):ye=kt,r.addRoute(ye,re)}function tt(kt){const ae=r.getRecordMatcher(kt);ae&&r.removeRoute(ae)}function lt(){return r.getRoutes().map(kt=>kt.record)}function vt(kt){return!!r.getRecordMatcher(kt)}function yt(kt,ae){if(ae=Si({},ae||T.value),typeof kt=="string"){const rt=Ip(a,kt,ae.path),Mt=r.resolve({path:rt.path},ae),Ft=p.createHref(rt.fullPath);return Si(rt,Mt,{params:L(Mt.params),hash:Eh(rt.hash),redirectedFrom:void 0,href:Ft})}let re;if(kt.path!=null)re=Si({},kt,{path:Ip(a,kt.path,ae.path).path});else{const rt=Si({},kt.params);for(const Mt in rt)rt[Mt]==null&&delete rt[Mt];re=Si({},kt,{params:P(rt)}),ae.params=P(ae.params)}const ye=r.resolve(re,ae),ni=kt.hash||"";ye.params=R(L(ye.params));const ai=TM(h,Si({},kt,{hash:vM(ni),path:ye.path})),Q=p.createHref(ai);return Si({fullPath:ai,hash:ni,query:h===my?iS(kt.query):kt.query||{}},ye,{redirectedFrom:void 0,href:Q})}function Tt(kt){return typeof kt=="string"?Ip(a,kt,T.value.path):Si({},kt)}function ut(kt,ae){if(I!==kt)return jl(8,{from:ae,to:kt})}function Dt(kt){return ce(kt)}function Ot(kt){return Dt(Si(Tt(kt),{replace:!0}))}function Ut(kt){const ae=kt.matched[kt.matched.length-1];if(ae&&ae.redirect){const{redirect:re}=ae;let ye=typeof re=="function"?re(kt):re;return typeof ye=="string"&&(ye=ye.includes("?")||ye.includes("#")?ye=Tt(ye):{path:ye},ye.params={}),Si({query:kt.query,hash:kt.hash,params:ye.path!=null?{}:kt.params},ye)}}function ce(kt,ae){const re=I=yt(kt),ye=T.value,ni=kt.state,ai=kt.force,Q=kt.replace===!0,rt=Ut(re);if(rt)return ce(Si(Tt(rt),{state:typeof rt=="object"?Si({},ni,rt.state):ni,force:ai,replace:Q}),ae||re);const Mt=re;Mt.redirectedFrom=ae;let Ft;return!ai&&AM(h,ye,re)&&(Ft=jl(16,{to:Mt,from:ye}),Ii(ye,ye,!0,!1)),(Ft?Promise.resolve(Ft):Ce(Mt,ye)).catch(it=>Zn(it)?Zn(it,2)?it:ks(it):Ye(it,Mt,ye)).then(it=>{if(it){if(Zn(it,2))return ce(Si({replace:Q},Tt(it.to),{state:typeof it.to=="object"?Si({},ni,it.to.state):ni,force:ai}),ae||Mt)}else it=ri(Mt,ye,!0,Q,ni);return xe(Mt,ye,it),it})}function te(kt,ae){const re=ut(kt,ae);return re?Promise.reject(re):Promise.resolve()}function fe(kt){const ae=fr.values().next().value;return ae&&typeof ae.runWithContext=="function"?ae.runWithContext(kt):kt()}function Ce(kt,ae){let re;const[ye,ni,ai]=uS(kt,ae);re=Pp(ye.reverse(),"beforeRouteLeave",kt,ae);for(const rt of ye)rt.leaveGuards.forEach(Mt=>{re.push(Ca(Mt,kt,ae))});const Q=te.bind(null,kt,ae);return re.push(Q),Pi(re).then(()=>{re=[];for(const rt of _.list())re.push(Ca(rt,kt,ae));return re.push(Q),Pi(re)}).then(()=>{re=Pp(ni,"beforeRouteUpdate",kt,ae);for(const rt of ni)rt.updateGuards.forEach(Mt=>{re.push(Ca(Mt,kt,ae))});return re.push(Q),Pi(re)}).then(()=>{re=[];for(const rt of ai)if(rt.beforeEnter)if(ln(rt.beforeEnter))for(const Mt of rt.beforeEnter)re.push(Ca(Mt,kt,ae));else re.push(Ca(rt.beforeEnter,kt,ae));return re.push(Q),Pi(re)}).then(()=>(kt.matched.forEach(rt=>rt.enterCallbacks={}),re=Pp(ai,"beforeRouteEnter",kt,ae,fe),re.push(Q),Pi(re))).then(()=>{re=[];for(const rt of m.list())re.push(Ca(rt,kt,ae));return re.push(Q),Pi(re)}).catch(rt=>Zn(rt,8)?rt:Promise.reject(rt))}function xe(kt,ae,re){l.list().forEach(ye=>fe(()=>ye(kt,ae,re)))}function ri(kt,ae,re,ye,ni){const ai=ut(kt,ae);if(ai)return ai;const Q=ae===Ma,rt=Il?history.state:{};re&&(ye||Q?p.replace(kt.fullPath,Si({scroll:Q&&rt&&rt.scroll},ni)):p.push(kt.fullPath,ni)),T.value=kt,Ii(kt,ae,re,Q),ks()}let pe;function Qt(){pe||(pe=p.listen((kt,ae,re)=>{if(!As.listening)return;const ye=yt(kt),ni=Ut(ye);if(ni){ce(Si(ni,{replace:!0}),ye).catch(gh);return}I=ye;const ai=T.value;Il&&zM(oy(ai.fullPath,re.delta),ef()),Ce(ye,ai).catch(Q=>Zn(Q,12)?Q:Zn(Q,2)?(ce(Q.to,ye).then(rt=>{Zn(rt,20)&&!re.delta&&re.type===Ih.pop&&p.go(-1,!1)}).catch(gh),Promise.reject()):(re.delta&&p.go(-re.delta,!1),Ye(Q,ye,ai))).then(Q=>{Q=Q||ri(ye,ai,!1),Q&&(re.delta&&!Zn(Q,8)?p.go(-re.delta,!1):re.type===Ih.pop&&Zn(Q,20)&&p.go(-1,!1)),xe(ye,ai,Q)}).catch(gh)}))}let oe=th(),ze=th(),Le;function Ye(kt,ae,re){ks(kt);const ye=ze.list();return ye.length?ye.forEach(ni=>ni(kt,ae,re)):console.error(kt),Promise.reject(kt)}function xs(){return Le&&T.value!==Ma?Promise.resolve():new Promise((kt,ae)=>{oe.add([kt,ae])})}function ks(kt){return Le||(Le=!kt,Qt(),oe.list().forEach(([ae,re])=>kt?re(kt):ae()),oe.reset()),kt}function Ii(kt,ae,re,ye){const{scrollBehavior:ni}=t;if(!Il||!ni)return Promise.resolve();const ai=!re&&LM(oy(kt.fullPath,0))||(ye||!re)&&history.state&&history.state.scroll||null;return Em().then(()=>ni(kt,ae,ai)).then(Q=>Q&&RM(Q)).catch(Q=>Ye(Q,kt,ae))}const hi=kt=>p.go(kt);let bs;const fr=new Set,As={currentRoute:T,listening:!0,addRoute:K,removeRoute:tt,hasRoute:vt,getRoutes:lt,resolve:yt,options:t,push:Dt,replace:Ot,go:hi,back:()=>hi(-1),forward:()=>hi(1),beforeEach:_.add,beforeResolve:m.add,afterEach:l.add,onError:ze.add,isReady:xs,install(kt){const ae=this;kt.component("RouterLink",Ev),kt.component("RouterView",cS),kt.config.globalProperties.$router=ae,Object.defineProperty(kt.config.globalProperties,"$route",{enumerable:!0,get:()=>Ti(T)}),Il&&!bs&&T.value===Ma&&(bs=!0,Dt(p.location).catch(ni=>{}));const re={};for(const ni in Ma)Object.defineProperty(re,ni,{get:()=>T.value[ni],enumerable:!0});kt.provide(sf,ae),kt.provide(Rm,I0(re)),kt.provide(tm,T);const ye=kt.unmount;fr.add(kt),kt.unmount=function(){fr.delete(kt),fr.size<1&&(I=Ma,pe&&pe(),pe=null,T.value=Ma,bs=!1,Le=!1),ye()}}};function Pi(kt){return kt.reduce((ae,re)=>ae.then(()=>fe(re)),Promise.resolve())}return As}function uS(t,r){const a=[],h=[],p=[],_=Math.max(r.matched.length,t.matched.length);for(let m=0;m<_;m++){const l=r.matched[m];l&&(t.matched.find(I=>ql(I,l))?h.push(l):a.push(l));const T=t.matched[m];T&&(r.matched.find(I=>ql(I,T))||p.push(T))}return[a,h,p]}function rf(){return Zr(sf)}function Fh(){return Zr(Rm)}const Ds=ea("AddressStore",{state:()=>({addressData:{}}),actions:{async fillAddressData(t){try{console.log("Address - fillAddressData is running, address:",t);const r=await fetch(`https://api.phila.gov/ais/v1/search/${t}?include_units=false`);if(r.ok)console.log("Address - await resolved and HTTP status is successful"),this.addressData=await r.json();else{console.log("Address - await resolved but HTTP status was not successful"),this.addressData={};const a=Kr();a.currentAddress=""}}catch{console.error("Address - await never resolved, failed to fetch address data")}}},getters:{getOpaOwners:t=>t.addressData.features[0].properties.opa_owners.join(", ")}});function Iv(t,r){return function(){return t.apply(r,arguments)}}const{toString:dS}=Object.prototype,{getPrototypeOf:zm}=Object,nf=(t=>r=>{const a=dS.call(r);return t[a]||(t[a]=a.slice(8,-1).toLowerCase())})(Object.create(null)),kn=t=>(t=t.toLowerCase(),r=>nf(r)===t),af=t=>r=>typeof r===t,{isArray:Xl}=Array,Ph=af("undefined");function fS(t){return t!==null&&!Ph(t)&&t.constructor!==null&&!Ph(t.constructor)&&Xr(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const Pv=kn("ArrayBuffer");function pS(t){let r;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?r=ArrayBuffer.isView(t):r=t&&t.buffer&&Pv(t.buffer),r}const mS=af("string"),Xr=af("function"),Cv=af("number"),of=t=>t!==null&&typeof t=="object",gS=t=>t===!0||t===!1,md=t=>{if(nf(t)!=="object")return!1;const r=zm(t);return(r===null||r===Object.prototype||Object.getPrototypeOf(r)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},_S=kn("Date"),yS=kn("File"),vS=kn("Blob"),xS=kn("FileList"),bS=t=>of(t)&&Xr(t.pipe),wS=t=>{let r;return t&&(typeof FormData=="function"&&t instanceof FormData||Xr(t.append)&&((r=nf(t))==="formdata"||r==="object"&&Xr(t.toString)&&t.toString()==="[object FormData]"))},MS=kn("URLSearchParams"),SS=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Bh(t,r,{allOwnKeys:a=!1}={}){if(t===null||typeof t>"u")return;let h,p;if(typeof t!="object"&&(t=[t]),Xl(t))for(h=0,p=t.length;h<p;h++)r.call(null,t[h],h,t);else{const _=a?Object.getOwnPropertyNames(t):Object.keys(t),m=_.length;let l;for(h=0;h<m;h++)l=_[h],r.call(null,t[l],l,t)}}function Dv(t,r){r=r.toLowerCase();const a=Object.keys(t);let h=a.length,p;for(;h-- >0;)if(p=a[h],r===p.toLowerCase())return p;return null}const kv=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Rv=t=>!Ph(t)&&t!==kv;function em(){const{caseless:t}=Rv(this)&&this||{},r={},a=(h,p)=>{const _=t&&Dv(r,p)||p;md(r[_])&&md(h)?r[_]=em(r[_],h):md(h)?r[_]=em({},h):Xl(h)?r[_]=h.slice():r[_]=h};for(let h=0,p=arguments.length;h<p;h++)arguments[h]&&Bh(arguments[h],a);return r}const TS=(t,r,a,{allOwnKeys:h}={})=>(Bh(r,(p,_)=>{a&&Xr(p)?t[_]=Iv(p,a):t[_]=p},{allOwnKeys:h}),t),AS=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),ES=(t,r,a,h)=>{t.prototype=Object.create(r.prototype,h),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:r.prototype}),a&&Object.assign(t.prototype,a)},IS=(t,r,a,h)=>{let p,_,m;const l={};if(r=r||{},t==null)return r;do{for(p=Object.getOwnPropertyNames(t),_=p.length;_-- >0;)m=p[_],(!h||h(m,t,r))&&!l[m]&&(r[m]=t[m],l[m]=!0);t=a!==!1&&zm(t)}while(t&&(!a||a(t,r))&&t!==Object.prototype);return r},PS=(t,r,a)=>{t=String(t),(a===void 0||a>t.length)&&(a=t.length),a-=r.length;const h=t.indexOf(r,a);return h!==-1&&h===a},CS=t=>{if(!t)return null;if(Xl(t))return t;let r=t.length;if(!Cv(r))return null;const a=new Array(r);for(;r-- >0;)a[r]=t[r];return a},DS=(t=>r=>t&&r instanceof t)(typeof Uint8Array<"u"&&zm(Uint8Array)),kS=(t,r)=>{const h=(t&&t[Symbol.iterator]).call(t);let p;for(;(p=h.next())&&!p.done;){const _=p.value;r.call(t,_[0],_[1])}},RS=(t,r)=>{let a;const h=[];for(;(a=t.exec(r))!==null;)h.push(a);return h},zS=kn("HTMLFormElement"),LS=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(a,h,p){return h.toUpperCase()+p}),by=(({hasOwnProperty:t})=>(r,a)=>t.call(r,a))(Object.prototype),OS=kn("RegExp"),zv=(t,r)=>{const a=Object.getOwnPropertyDescriptors(t),h={};Bh(a,(p,_)=>{let m;(m=r(p,_,t))!==!1&&(h[_]=m||p)}),Object.defineProperties(t,h)},FS=t=>{zv(t,(r,a)=>{if(Xr(t)&&["arguments","caller","callee"].indexOf(a)!==-1)return!1;const h=t[a];if(Xr(h)){if(r.enumerable=!1,"writable"in r){r.writable=!1;return}r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+a+"'")})}})},BS=(t,r)=>{const a={},h=p=>{p.forEach(_=>{a[_]=!0})};return Xl(t)?h(t):h(String(t).split(r)),a},NS=()=>{},$S=(t,r)=>(t=+t,Number.isFinite(t)?t:r),Cp="abcdefghijklmnopqrstuvwxyz",wy="0123456789",Lv={DIGIT:wy,ALPHA:Cp,ALPHA_DIGIT:Cp+Cp.toUpperCase()+wy},VS=(t=16,r=Lv.ALPHA_DIGIT)=>{let a="";const{length:h}=r;for(;t--;)a+=r[Math.random()*h|0];return a};function US(t){return!!(t&&Xr(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const qS=t=>{const r=new Array(10),a=(h,p)=>{if(of(h)){if(r.indexOf(h)>=0)return;if(!("toJSON"in h)){r[p]=h;const _=Xl(h)?[]:{};return Bh(h,(m,l)=>{const T=a(m,p+1);!Ph(T)&&(_[l]=T)}),r[p]=void 0,_}}return h};return a(t,0)},jS=kn("AsyncFunction"),GS=t=>t&&(of(t)||Xr(t))&&Xr(t.then)&&Xr(t.catch),Nt={isArray:Xl,isArrayBuffer:Pv,isBuffer:fS,isFormData:wS,isArrayBufferView:pS,isString:mS,isNumber:Cv,isBoolean:gS,isObject:of,isPlainObject:md,isUndefined:Ph,isDate:_S,isFile:yS,isBlob:vS,isRegExp:OS,isFunction:Xr,isStream:bS,isURLSearchParams:MS,isTypedArray:DS,isFileList:xS,forEach:Bh,merge:em,extend:TS,trim:SS,stripBOM:AS,inherits:ES,toFlatObject:IS,kindOf:nf,kindOfTest:kn,endsWith:PS,toArray:CS,forEachEntry:kS,matchAll:RS,isHTMLForm:zS,hasOwnProperty:by,hasOwnProp:by,reduceDescriptors:zv,freezeMethods:FS,toObjectSet:BS,toCamelCase:LS,noop:NS,toFiniteNumber:$S,findKey:Dv,global:kv,isContextDefined:Rv,ALPHABET:Lv,generateString:VS,isSpecCompliantForm:US,toJSONObject:qS,isAsyncFn:jS,isThenable:GS};function li(t,r,a,h,p){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",r&&(this.code=r),a&&(this.config=a),h&&(this.request=h),p&&(this.response=p)}Nt.inherits(li,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Nt.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const Ov=li.prototype,Fv={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{Fv[t]={value:t}});Object.defineProperties(li,Fv);Object.defineProperty(Ov,"isAxiosError",{value:!0});li.from=(t,r,a,h,p,_)=>{const m=Object.create(Ov);return Nt.toFlatObject(t,m,function(T){return T!==Error.prototype},l=>l!=="isAxiosError"),li.call(m,t.message,r,a,h,p),m.cause=t,m.name=t.name,_&&Object.assign(m,_),m};const HS=null;function im(t){return Nt.isPlainObject(t)||Nt.isArray(t)}function Bv(t){return Nt.endsWith(t,"[]")?t.slice(0,-2):t}function My(t,r,a){return t?t.concat(r).map(function(p,_){return p=Bv(p),!a&&_?"["+p+"]":p}).join(a?".":""):r}function WS(t){return Nt.isArray(t)&&!t.some(im)}const ZS=Nt.toFlatObject(Nt,{},null,function(r){return/^is[A-Z]/.test(r)});function lf(t,r,a){if(!Nt.isObject(t))throw new TypeError("target must be an object");r=r||new FormData,a=Nt.toFlatObject(a,{metaTokens:!0,dots:!1,indexes:!1},!1,function(lt,vt){return!Nt.isUndefined(vt[lt])});const h=a.metaTokens,p=a.visitor||R,_=a.dots,m=a.indexes,T=(a.Blob||typeof Blob<"u"&&Blob)&&Nt.isSpecCompliantForm(r);if(!Nt.isFunction(p))throw new TypeError("visitor must be a function");function I(tt){if(tt===null)return"";if(Nt.isDate(tt))return tt.toISOString();if(!T&&Nt.isBlob(tt))throw new li("Blob is not supported. Use a Buffer instead.");return Nt.isArrayBuffer(tt)||Nt.isTypedArray(tt)?T&&typeof Blob=="function"?new Blob([tt]):Buffer.from(tt):tt}function R(tt,lt,vt){let yt=tt;if(tt&&!vt&&typeof tt=="object"){if(Nt.endsWith(lt,"{}"))lt=h?lt:lt.slice(0,-2),tt=JSON.stringify(tt);else if(Nt.isArray(tt)&&WS(tt)||(Nt.isFileList(tt)||Nt.endsWith(lt,"[]"))&&(yt=Nt.toArray(tt)))return lt=Bv(lt),yt.forEach(function(ut,Dt){!(Nt.isUndefined(ut)||ut===null)&&r.append(m===!0?My([lt],Dt,_):m===null?lt:lt+"[]",I(ut))}),!1}return im(tt)?!0:(r.append(My(vt,lt,_),I(tt)),!1)}const P=[],L=Object.assign(ZS,{defaultVisitor:R,convertValue:I,isVisitable:im});function K(tt,lt){if(!Nt.isUndefined(tt)){if(P.indexOf(tt)!==-1)throw Error("Circular reference detected in "+lt.join("."));P.push(tt),Nt.forEach(tt,function(yt,Tt){(!(Nt.isUndefined(yt)||yt===null)&&p.call(r,yt,Nt.isString(Tt)?Tt.trim():Tt,lt,L))===!0&&K(yt,lt?lt.concat(Tt):[Tt])}),P.pop()}}if(!Nt.isObject(t))throw new TypeError("data must be an object");return K(t),r}function Sy(t){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(h){return r[h]})}function Lm(t,r){this._pairs=[],t&&lf(t,this,r)}const Nv=Lm.prototype;Nv.append=function(r,a){this._pairs.push([r,a])};Nv.toString=function(r){const a=r?function(h){return r.call(this,h,Sy)}:Sy;return this._pairs.map(function(p){return a(p[0])+"="+a(p[1])},"").join("&")};function XS(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function $v(t,r,a){if(!r)return t;const h=a&&a.encode||XS,p=a&&a.serialize;let _;if(p?_=p(r,a):_=Nt.isURLSearchParams(r)?r.toString():new Lm(r,a).toString(h),_){const m=t.indexOf("#");m!==-1&&(t=t.slice(0,m)),t+=(t.indexOf("?")===-1?"?":"&")+_}return t}class Ty{constructor(){this.handlers=[]}use(r,a,h){return this.handlers.push({fulfilled:r,rejected:a,synchronous:h?h.synchronous:!1,runWhen:h?h.runWhen:null}),this.handlers.length-1}eject(r){this.handlers[r]&&(this.handlers[r]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(r){Nt.forEach(this.handlers,function(h){h!==null&&r(h)})}}const Vv={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},KS=typeof URLSearchParams<"u"?URLSearchParams:Lm,YS=typeof FormData<"u"?FormData:null,JS=typeof Blob<"u"?Blob:null,QS={isBrowser:!0,classes:{URLSearchParams:KS,FormData:YS,Blob:JS},protocols:["http","https","file","blob","url","data"]},Uv=typeof window<"u"&&typeof document<"u",tT=(t=>Uv&&["ReactNative","NativeScript","NS"].indexOf(t)<0)(typeof navigator<"u"&&navigator.product),eT=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",iT=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Uv,hasStandardBrowserEnv:tT,hasStandardBrowserWebWorkerEnv:eT},Symbol.toStringTag,{value:"Module"})),En={...iT,...QS};function sT(t,r){return lf(t,new En.classes.URLSearchParams,Object.assign({visitor:function(a,h,p,_){return En.isNode&&Nt.isBuffer(a)?(this.append(h,a.toString("base64")),!1):_.defaultVisitor.apply(this,arguments)}},r))}function rT(t){return Nt.matchAll(/\w+|\[(\w*)]/g,t).map(r=>r[0]==="[]"?"":r[1]||r[0])}function nT(t){const r={},a=Object.keys(t);let h;const p=a.length;let _;for(h=0;h<p;h++)_=a[h],r[_]=t[_];return r}function qv(t){function r(a,h,p,_){let m=a[_++];if(m==="__proto__")return!0;const l=Number.isFinite(+m),T=_>=a.length;return m=!m&&Nt.isArray(p)?p.length:m,T?(Nt.hasOwnProp(p,m)?p[m]=[p[m],h]:p[m]=h,!l):((!p[m]||!Nt.isObject(p[m]))&&(p[m]=[]),r(a,h,p[m],_)&&Nt.isArray(p[m])&&(p[m]=nT(p[m])),!l)}if(Nt.isFormData(t)&&Nt.isFunction(t.entries)){const a={};return Nt.forEachEntry(t,(h,p)=>{r(rT(h),p,a,0)}),a}return null}function aT(t,r,a){if(Nt.isString(t))try{return(r||JSON.parse)(t),Nt.trim(t)}catch(h){if(h.name!=="SyntaxError")throw h}return(a||JSON.stringify)(t)}const Om={transitional:Vv,adapter:["xhr","http"],transformRequest:[function(r,a){const h=a.getContentType()||"",p=h.indexOf("application/json")>-1,_=Nt.isObject(r);if(_&&Nt.isHTMLForm(r)&&(r=new FormData(r)),Nt.isFormData(r))return p?JSON.stringify(qv(r)):r;if(Nt.isArrayBuffer(r)||Nt.isBuffer(r)||Nt.isStream(r)||Nt.isFile(r)||Nt.isBlob(r))return r;if(Nt.isArrayBufferView(r))return r.buffer;if(Nt.isURLSearchParams(r))return a.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),r.toString();let l;if(_){if(h.indexOf("application/x-www-form-urlencoded")>-1)return sT(r,this.formSerializer).toString();if((l=Nt.isFileList(r))||h.indexOf("multipart/form-data")>-1){const T=this.env&&this.env.FormData;return lf(l?{"files[]":r}:r,T&&new T,this.formSerializer)}}return _||p?(a.setContentType("application/json",!1),aT(r)):r}],transformResponse:[function(r){const a=this.transitional||Om.transitional,h=a&&a.forcedJSONParsing,p=this.responseType==="json";if(r&&Nt.isString(r)&&(h&&!this.responseType||p)){const m=!(a&&a.silentJSONParsing)&&p;try{return JSON.parse(r)}catch(l){if(m)throw l.name==="SyntaxError"?li.from(l,li.ERR_BAD_RESPONSE,this,null,this.response):l}}return r}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:En.classes.FormData,Blob:En.classes.Blob},validateStatus:function(r){return r>=200&&r<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Nt.forEach(["delete","get","head","post","put","patch"],t=>{Om.headers[t]={}});const Fm=Om,oT=Nt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),lT=t=>{const r={};let a,h,p;return t&&t.split(`
`).forEach(function(m){p=m.indexOf(":"),a=m.substring(0,p).trim().toLowerCase(),h=m.substring(p+1).trim(),!(!a||r[a]&&oT[a])&&(a==="set-cookie"?r[a]?r[a].push(h):r[a]=[h]:r[a]=r[a]?r[a]+", "+h:h)}),r},Ay=Symbol("internals");function eh(t){return t&&String(t).trim().toLowerCase()}function gd(t){return t===!1||t==null?t:Nt.isArray(t)?t.map(gd):String(t)}function cT(t){const r=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let h;for(;h=a.exec(t);)r[h[1]]=h[2];return r}const hT=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function Dp(t,r,a,h,p){if(Nt.isFunction(h))return h.call(this,r,a);if(p&&(r=a),!!Nt.isString(r)){if(Nt.isString(h))return r.indexOf(h)!==-1;if(Nt.isRegExp(h))return h.test(r)}}function uT(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(r,a,h)=>a.toUpperCase()+h)}function dT(t,r){const a=Nt.toCamelCase(" "+r);["get","set","has"].forEach(h=>{Object.defineProperty(t,h+a,{value:function(p,_,m){return this[h].call(this,r,p,_,m)},configurable:!0})})}class cf{constructor(r){r&&this.set(r)}set(r,a,h){const p=this;function _(l,T,I){const R=eh(T);if(!R)throw new Error("header name must be a non-empty string");const P=Nt.findKey(p,R);(!P||p[P]===void 0||I===!0||I===void 0&&p[P]!==!1)&&(p[P||T]=gd(l))}const m=(l,T)=>Nt.forEach(l,(I,R)=>_(I,R,T));return Nt.isPlainObject(r)||r instanceof this.constructor?m(r,a):Nt.isString(r)&&(r=r.trim())&&!hT(r)?m(lT(r),a):r!=null&&_(a,r,h),this}get(r,a){if(r=eh(r),r){const h=Nt.findKey(this,r);if(h){const p=this[h];if(!a)return p;if(a===!0)return cT(p);if(Nt.isFunction(a))return a.call(this,p,h);if(Nt.isRegExp(a))return a.exec(p);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,a){if(r=eh(r),r){const h=Nt.findKey(this,r);return!!(h&&this[h]!==void 0&&(!a||Dp(this,this[h],h,a)))}return!1}delete(r,a){const h=this;let p=!1;function _(m){if(m=eh(m),m){const l=Nt.findKey(h,m);l&&(!a||Dp(h,h[l],l,a))&&(delete h[l],p=!0)}}return Nt.isArray(r)?r.forEach(_):_(r),p}clear(r){const a=Object.keys(this);let h=a.length,p=!1;for(;h--;){const _=a[h];(!r||Dp(this,this[_],_,r,!0))&&(delete this[_],p=!0)}return p}normalize(r){const a=this,h={};return Nt.forEach(this,(p,_)=>{const m=Nt.findKey(h,_);if(m){a[m]=gd(p),delete a[_];return}const l=r?uT(_):String(_).trim();l!==_&&delete a[_],a[l]=gd(p),h[l]=!0}),this}concat(...r){return this.constructor.concat(this,...r)}toJSON(r){const a=Object.create(null);return Nt.forEach(this,(h,p)=>{h!=null&&h!==!1&&(a[p]=r&&Nt.isArray(h)?h.join(", "):h)}),a}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([r,a])=>r+": "+a).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r,...a){const h=new this(r);return a.forEach(p=>h.set(p)),h}static accessor(r){const h=(this[Ay]=this[Ay]={accessors:{}}).accessors,p=this.prototype;function _(m){const l=eh(m);h[l]||(dT(p,m),h[l]=!0)}return Nt.isArray(r)?r.forEach(_):_(r),this}}cf.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Nt.reduceDescriptors(cf.prototype,({value:t},r)=>{let a=r[0].toUpperCase()+r.slice(1);return{get:()=>t,set(h){this[a]=h}}});Nt.freezeMethods(cf);const Qn=cf;function kp(t,r){const a=this||Fm,h=r||a,p=Qn.from(h.headers);let _=h.data;return Nt.forEach(t,function(l){_=l.call(a,_,p.normalize(),r?r.status:void 0)}),p.normalize(),_}function jv(t){return!!(t&&t.__CANCEL__)}function Nh(t,r,a){li.call(this,t??"canceled",li.ERR_CANCELED,r,a),this.name="CanceledError"}Nt.inherits(Nh,li,{__CANCEL__:!0});function fT(t,r,a){const h=a.config.validateStatus;!a.status||!h||h(a.status)?t(a):r(new li("Request failed with status code "+a.status,[li.ERR_BAD_REQUEST,li.ERR_BAD_RESPONSE][Math.floor(a.status/100)-4],a.config,a.request,a))}const pT=En.hasStandardBrowserEnv?{write(t,r,a,h,p,_){const m=[t+"="+encodeURIComponent(r)];Nt.isNumber(a)&&m.push("expires="+new Date(a).toGMTString()),Nt.isString(h)&&m.push("path="+h),Nt.isString(p)&&m.push("domain="+p),_===!0&&m.push("secure"),document.cookie=m.join("; ")},read(t){const r=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function mT(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function gT(t,r){return r?t.replace(/\/?\/$/,"")+"/"+r.replace(/^\/+/,""):t}function Gv(t,r){return t&&!mT(r)?gT(t,r):r}const _T=En.hasStandardBrowserEnv?function(){const r=/(msie|trident)/i.test(navigator.userAgent),a=document.createElement("a");let h;function p(_){let m=_;return r&&(a.setAttribute("href",m),m=a.href),a.setAttribute("href",m),{href:a.href,protocol:a.protocol?a.protocol.replace(/:$/,""):"",host:a.host,search:a.search?a.search.replace(/^\?/,""):"",hash:a.hash?a.hash.replace(/^#/,""):"",hostname:a.hostname,port:a.port,pathname:a.pathname.charAt(0)==="/"?a.pathname:"/"+a.pathname}}return h=p(window.location.href),function(m){const l=Nt.isString(m)?p(m):m;return l.protocol===h.protocol&&l.host===h.host}}():function(){return function(){return!0}}();function yT(t){const r=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return r&&r[1]||""}function vT(t,r){t=t||10;const a=new Array(t),h=new Array(t);let p=0,_=0,m;return r=r!==void 0?r:1e3,function(T){const I=Date.now(),R=h[_];m||(m=I),a[p]=T,h[p]=I;let P=_,L=0;for(;P!==p;)L+=a[P++],P=P%t;if(p=(p+1)%t,p===_&&(_=(_+1)%t),I-m<r)return;const K=R&&I-R;return K?Math.round(L*1e3/K):void 0}}function Ey(t,r){let a=0;const h=vT(50,250);return p=>{const _=p.loaded,m=p.lengthComputable?p.total:void 0,l=_-a,T=h(l),I=_<=m;a=_;const R={loaded:_,total:m,progress:m?_/m:void 0,bytes:l,rate:T||void 0,estimated:T&&m&&I?(m-_)/T:void 0,event:p};R[r?"download":"upload"]=!0,t(R)}}const xT=typeof XMLHttpRequest<"u",bT=xT&&function(t){return new Promise(function(a,h){let p=t.data;const _=Qn.from(t.headers).normalize();let{responseType:m,withXSRFToken:l}=t,T;function I(){t.cancelToken&&t.cancelToken.unsubscribe(T),t.signal&&t.signal.removeEventListener("abort",T)}let R;if(Nt.isFormData(p)){if(En.hasStandardBrowserEnv||En.hasStandardBrowserWebWorkerEnv)_.setContentType(!1);else if((R=_.getContentType())!==!1){const[lt,...vt]=R?R.split(";").map(yt=>yt.trim()).filter(Boolean):[];_.setContentType([lt||"multipart/form-data",...vt].join("; "))}}let P=new XMLHttpRequest;if(t.auth){const lt=t.auth.username||"",vt=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";_.set("Authorization","Basic "+btoa(lt+":"+vt))}const L=Gv(t.baseURL,t.url);P.open(t.method.toUpperCase(),$v(L,t.params,t.paramsSerializer),!0),P.timeout=t.timeout;function K(){if(!P)return;const lt=Qn.from("getAllResponseHeaders"in P&&P.getAllResponseHeaders()),yt={data:!m||m==="text"||m==="json"?P.responseText:P.response,status:P.status,statusText:P.statusText,headers:lt,config:t,request:P};fT(function(ut){a(ut),I()},function(ut){h(ut),I()},yt),P=null}if("onloadend"in P?P.onloadend=K:P.onreadystatechange=function(){!P||P.readyState!==4||P.status===0&&!(P.responseURL&&P.responseURL.indexOf("file:")===0)||setTimeout(K)},P.onabort=function(){P&&(h(new li("Request aborted",li.ECONNABORTED,t,P)),P=null)},P.onerror=function(){h(new li("Network Error",li.ERR_NETWORK,t,P)),P=null},P.ontimeout=function(){let vt=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded";const yt=t.transitional||Vv;t.timeoutErrorMessage&&(vt=t.timeoutErrorMessage),h(new li(vt,yt.clarifyTimeoutError?li.ETIMEDOUT:li.ECONNABORTED,t,P)),P=null},En.hasStandardBrowserEnv&&(l&&Nt.isFunction(l)&&(l=l(t)),l||l!==!1&&_T(L))){const lt=t.xsrfHeaderName&&t.xsrfCookieName&&pT.read(t.xsrfCookieName);lt&&_.set(t.xsrfHeaderName,lt)}p===void 0&&_.setContentType(null),"setRequestHeader"in P&&Nt.forEach(_.toJSON(),function(vt,yt){P.setRequestHeader(yt,vt)}),Nt.isUndefined(t.withCredentials)||(P.withCredentials=!!t.withCredentials),m&&m!=="json"&&(P.responseType=t.responseType),typeof t.onDownloadProgress=="function"&&P.addEventListener("progress",Ey(t.onDownloadProgress,!0)),typeof t.onUploadProgress=="function"&&P.upload&&P.upload.addEventListener("progress",Ey(t.onUploadProgress)),(t.cancelToken||t.signal)&&(T=lt=>{P&&(h(!lt||lt.type?new Nh(null,t,P):lt),P.abort(),P=null)},t.cancelToken&&t.cancelToken.subscribe(T),t.signal&&(t.signal.aborted?T():t.signal.addEventListener("abort",T)));const tt=yT(L);if(tt&&En.protocols.indexOf(tt)===-1){h(new li("Unsupported protocol "+tt+":",li.ERR_BAD_REQUEST,t));return}P.send(p||null)})},sm={http:HS,xhr:bT};Nt.forEach(sm,(t,r)=>{if(t){try{Object.defineProperty(t,"name",{value:r})}catch{}Object.defineProperty(t,"adapterName",{value:r})}});const Iy=t=>`- ${t}`,wT=t=>Nt.isFunction(t)||t===null||t===!1,Hv={getAdapter:t=>{t=Nt.isArray(t)?t:[t];const{length:r}=t;let a,h;const p={};for(let _=0;_<r;_++){a=t[_];let m;if(h=a,!wT(a)&&(h=sm[(m=String(a)).toLowerCase()],h===void 0))throw new li(`Unknown adapter '${m}'`);if(h)break;p[m||"#"+_]=h}if(!h){const _=Object.entries(p).map(([l,T])=>`adapter ${l} `+(T===!1?"is not supported by the environment":"is not available in the build"));let m=r?_.length>1?`since :
`+_.map(Iy).join(`
`):" "+Iy(_[0]):"as no adapter specified";throw new li("There is no suitable adapter to dispatch the request "+m,"ERR_NOT_SUPPORT")}return h},adapters:sm};function Rp(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Nh(null,t)}function Py(t){return Rp(t),t.headers=Qn.from(t.headers),t.data=kp.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Hv.getAdapter(t.adapter||Fm.adapter)(t).then(function(h){return Rp(t),h.data=kp.call(t,t.transformResponse,h),h.headers=Qn.from(h.headers),h},function(h){return jv(h)||(Rp(t),h&&h.response&&(h.response.data=kp.call(t,t.transformResponse,h.response),h.response.headers=Qn.from(h.response.headers))),Promise.reject(h)})}const Cy=t=>t instanceof Qn?{...t}:t;function Gl(t,r){r=r||{};const a={};function h(I,R,P){return Nt.isPlainObject(I)&&Nt.isPlainObject(R)?Nt.merge.call({caseless:P},I,R):Nt.isPlainObject(R)?Nt.merge({},R):Nt.isArray(R)?R.slice():R}function p(I,R,P){if(Nt.isUndefined(R)){if(!Nt.isUndefined(I))return h(void 0,I,P)}else return h(I,R,P)}function _(I,R){if(!Nt.isUndefined(R))return h(void 0,R)}function m(I,R){if(Nt.isUndefined(R)){if(!Nt.isUndefined(I))return h(void 0,I)}else return h(void 0,R)}function l(I,R,P){if(P in r)return h(I,R);if(P in t)return h(void 0,I)}const T={url:_,method:_,data:_,baseURL:m,transformRequest:m,transformResponse:m,paramsSerializer:m,timeout:m,timeoutMessage:m,withCredentials:m,withXSRFToken:m,adapter:m,responseType:m,xsrfCookieName:m,xsrfHeaderName:m,onUploadProgress:m,onDownloadProgress:m,decompress:m,maxContentLength:m,maxBodyLength:m,beforeRedirect:m,transport:m,httpAgent:m,httpsAgent:m,cancelToken:m,socketPath:m,responseEncoding:m,validateStatus:l,headers:(I,R)=>p(Cy(I),Cy(R),!0)};return Nt.forEach(Object.keys(Object.assign({},t,r)),function(R){const P=T[R]||p,L=P(t[R],r[R],R);Nt.isUndefined(L)&&P!==l||(a[R]=L)}),a}const Wv="1.6.8",Bm={};["object","boolean","number","function","string","symbol"].forEach((t,r)=>{Bm[t]=function(h){return typeof h===t||"a"+(r<1?"n ":" ")+t}});const Dy={};Bm.transitional=function(r,a,h){function p(_,m){return"[Axios v"+Wv+"] Transitional option '"+_+"'"+m+(h?". "+h:"")}return(_,m,l)=>{if(r===!1)throw new li(p(m," has been removed"+(a?" in "+a:"")),li.ERR_DEPRECATED);return a&&!Dy[m]&&(Dy[m]=!0,console.warn(p(m," has been deprecated since v"+a+" and will be removed in the near future"))),r?r(_,m,l):!0}};function MT(t,r,a){if(typeof t!="object")throw new li("options must be an object",li.ERR_BAD_OPTION_VALUE);const h=Object.keys(t);let p=h.length;for(;p-- >0;){const _=h[p],m=r[_];if(m){const l=t[_],T=l===void 0||m(l,_,t);if(T!==!0)throw new li("option "+_+" must be "+T,li.ERR_BAD_OPTION_VALUE);continue}if(a!==!0)throw new li("Unknown option "+_,li.ERR_BAD_OPTION)}}const rm={assertOptions:MT,validators:Bm},Sa=rm.validators;class Pd{constructor(r){this.defaults=r,this.interceptors={request:new Ty,response:new Ty}}async request(r,a){try{return await this._request(r,a)}catch(h){if(h instanceof Error){let p;Error.captureStackTrace?Error.captureStackTrace(p={}):p=new Error;const _=p.stack?p.stack.replace(/^.+\n/,""):"";h.stack?_&&!String(h.stack).endsWith(_.replace(/^.+\n.+\n/,""))&&(h.stack+=`
`+_):h.stack=_}throw h}}_request(r,a){typeof r=="string"?(a=a||{},a.url=r):a=r||{},a=Gl(this.defaults,a);const{transitional:h,paramsSerializer:p,headers:_}=a;h!==void 0&&rm.assertOptions(h,{silentJSONParsing:Sa.transitional(Sa.boolean),forcedJSONParsing:Sa.transitional(Sa.boolean),clarifyTimeoutError:Sa.transitional(Sa.boolean)},!1),p!=null&&(Nt.isFunction(p)?a.paramsSerializer={serialize:p}:rm.assertOptions(p,{encode:Sa.function,serialize:Sa.function},!0)),a.method=(a.method||this.defaults.method||"get").toLowerCase();let m=_&&Nt.merge(_.common,_[a.method]);_&&Nt.forEach(["delete","get","head","post","put","patch","common"],tt=>{delete _[tt]}),a.headers=Qn.concat(m,_);const l=[];let T=!0;this.interceptors.request.forEach(function(lt){typeof lt.runWhen=="function"&&lt.runWhen(a)===!1||(T=T&&lt.synchronous,l.unshift(lt.fulfilled,lt.rejected))});const I=[];this.interceptors.response.forEach(function(lt){I.push(lt.fulfilled,lt.rejected)});let R,P=0,L;if(!T){const tt=[Py.bind(this),void 0];for(tt.unshift.apply(tt,l),tt.push.apply(tt,I),L=tt.length,R=Promise.resolve(a);P<L;)R=R.then(tt[P++],tt[P++]);return R}L=l.length;let K=a;for(P=0;P<L;){const tt=l[P++],lt=l[P++];try{K=tt(K)}catch(vt){lt.call(this,vt);break}}try{R=Py.call(this,K)}catch(tt){return Promise.reject(tt)}for(P=0,L=I.length;P<L;)R=R.then(I[P++],I[P++]);return R}getUri(r){r=Gl(this.defaults,r);const a=Gv(r.baseURL,r.url);return $v(a,r.params,r.paramsSerializer)}}Nt.forEach(["delete","get","head","options"],function(r){Pd.prototype[r]=function(a,h){return this.request(Gl(h||{},{method:r,url:a,data:(h||{}).data}))}});Nt.forEach(["post","put","patch"],function(r){function a(h){return function(_,m,l){return this.request(Gl(l||{},{method:r,headers:h?{"Content-Type":"multipart/form-data"}:{},url:_,data:m}))}}Pd.prototype[r]=a(),Pd.prototype[r+"Form"]=a(!0)});const _d=Pd;class Nm{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let a;this.promise=new Promise(function(_){a=_});const h=this;this.promise.then(p=>{if(!h._listeners)return;let _=h._listeners.length;for(;_-- >0;)h._listeners[_](p);h._listeners=null}),this.promise.then=p=>{let _;const m=new Promise(l=>{h.subscribe(l),_=l}).then(p);return m.cancel=function(){h.unsubscribe(_)},m},r(function(_,m,l){h.reason||(h.reason=new Nh(_,m,l),a(h.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){if(this.reason){r(this.reason);return}this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const a=this._listeners.indexOf(r);a!==-1&&this._listeners.splice(a,1)}static source(){let r;return{token:new Nm(function(p){r=p}),cancel:r}}}const ST=Nm;function TT(t){return function(a){return t.apply(null,a)}}function AT(t){return Nt.isObject(t)&&t.isAxiosError===!0}const nm={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(nm).forEach(([t,r])=>{nm[r]=t});const ET=nm;function Zv(t){const r=new _d(t),a=Iv(_d.prototype.request,r);return Nt.extend(a,_d.prototype,r,{allOwnKeys:!0}),Nt.extend(a,r,null,{allOwnKeys:!0}),a.create=function(p){return Zv(Gl(t,p))},a}const Li=Zv(Fm);Li.Axios=_d;Li.CanceledError=Nh;Li.CancelToken=ST;Li.isCancel=jv;Li.VERSION=Wv;Li.toFormData=lf;Li.AxiosError=li;Li.Cancel=Li.CanceledError;Li.all=function(r){return Promise.all(r)};Li.spread=TT;Li.isAxiosError=AT;Li.mergeConfig=Gl;Li.AxiosHeaders=Qn;Li.formToJSON=t=>qv(Nt.isHTMLForm(t)?new FormData(t):t);Li.getAdapter=Hv.getAdapter;Li.HttpStatusCode=ET;Li.default=Li;const $h=ea("CondosStore",{state:()=>({condosData:{}}),actions:{async fillCondoData(t){const a=Ds().addressData.features;if(!a)return;const h=a[0];let p={include_units:!0,opa_only:!0,page:1};const _=await Li(`//api.phila.gov/ais/v1/search/${t}`,{params:p});if(_.data.features.length>0){let m=[];for(let l of _.data.features)l.properties.address_low_frac!==h.properties.address_low_frac||l.properties.street_address===h.properties.street_address?_.data.total_size=_.data.total_size-1:m.push(l);this.condosData=m}}}});function Xv(){return{routeApp:r=>{const a=Kr();a.currentAddress&&a.currentTopic=="Nearby Activity"?r.push({name:"address-topic-and-data",params:{address:a.currentAddress,topic:"Nearby Activity",data:a.currentNearbyDataType}}):a.currentAddress&&a.currentTopic?r.push({name:"address-and-topic",params:{address:a.currentAddress,topic:a.currentTopic}}):a.currentAddress&&r.push({name:"address",params:{address:a.currentAddress}})}}}const Vh=(t,r)=>{const a=t.__vccOpts||t;for(const[h,p]of r)a[h]=p;return a},IT={class:"topic-name has-text-left"},PT={key:0,class:"topic-loading has-text-right"},CT={key:0},DT={class:"inside-topic"},kT={__name:"Topic",props:{topicName:String,loading:Boolean},setup(t){const r=Kr(),a=t;lM(r);const h=Fh(),p=rf(),{routeApp:_}=Xv(),m=wi(()=>h.params.topic==a.topicName),l=()=>{a.topicName==r.currentTopic?r.currentTopic="":r.currentTopic=a.topicName,console.log("topic clicked:",a.topicName),_(p)};return(T,I)=>(Pe(),Ue("section",null,[ct("div",{class:"topic",onClick:l},[ct("span",IT,Fe(t.topicName),1),m.value&&t.loading?(Pe(),Ue("span",PT,"Loading...")):Zi("",!0)]),m.value?(Pe(),Ue("div",CT,[ct("div",DT,[jw(T.$slots,"default",{},void 0,!0)])])):Zi("",!0)]))}},mo=Vh(kT,[["__scopeId","data-v-c0747122"]]);var RT=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Kv(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var am={exports:{}};/*!
 * accounting.js v0.4.1
 * Copyright 2014 Open Exchange Rates
 *
 * Freely distributable under the MIT license.
 * Portions of accounting.js are inspired or borrowed from underscore.js
 *
 * Full details and documentation:
 * http://openexchangerates.github.io/accounting.js/
 */(function(t,r){(function(a,h){var p={};p.version="0.4.1",p.settings={currency:{symbol:"$",format:"%s%v",decimal:".",thousand:",",precision:2,grouping:3},number:{precision:0,grouping:3,thousand:",",decimal:"."}};var _=Array.prototype.map,m=Array.isArray,l=Object.prototype.toString;function T(ut){return!!(ut===""||ut&&ut.charCodeAt&&ut.substr)}function I(ut){return m?m(ut):l.call(ut)==="[object Array]"}function R(ut){return ut&&l.call(ut)==="[object Object]"}function P(ut,Dt){var Ot;ut=ut||{},Dt=Dt||{};for(Ot in Dt)Dt.hasOwnProperty(Ot)&&ut[Ot]==null&&(ut[Ot]=Dt[Ot]);return ut}function L(ut,Dt,Ot){var Ut=[],ce,te;if(!ut)return Ut;if(_&&ut.map===_)return ut.map(Dt,Ot);for(ce=0,te=ut.length;ce<te;ce++)Ut[ce]=Dt.call(Ot,ut[ce],ce,ut);return Ut}function K(ut,Dt){return ut=Math.round(Math.abs(ut)),isNaN(ut)?Dt:ut}function tt(ut){var Dt=p.settings.currency.format;return typeof ut=="function"&&(ut=ut()),T(ut)&&ut.match("%v")?{pos:ut,neg:ut.replace("-","").replace("%v","-%v"),zero:ut}:!ut||!ut.pos||!ut.pos.match("%v")?T(Dt)?p.settings.currency.format={pos:Dt,neg:Dt.replace("%v","-%v"),zero:Dt}:Dt:ut}var lt=p.unformat=p.parse=function(ut,Dt){if(I(ut))return L(ut,function(ce){return lt(ce,Dt)});if(ut=ut||0,typeof ut=="number")return ut;Dt=Dt||p.settings.number.decimal;var Ot=new RegExp("[^0-9-"+Dt+"]",["g"]),Ut=parseFloat((""+ut).replace(/\((.*)\)/,"-$1").replace(Ot,"").replace(Dt,"."));return isNaN(Ut)?0:Ut},vt=p.toFixed=function(ut,Dt){Dt=K(Dt,p.settings.number.precision);var Ot=Math.pow(10,Dt);return(Math.round(p.unformat(ut)*Ot)/Ot).toFixed(Dt)},yt=p.formatNumber=p.format=function(ut,Dt,Ot,Ut){if(I(ut))return L(ut,function(ri){return yt(ri,Dt,Ot,Ut)});ut=lt(ut);var ce=P(R(Dt)?Dt:{precision:Dt,thousand:Ot,decimal:Ut},p.settings.number),te=K(ce.precision),fe=ut<0?"-":"",Ce=parseInt(vt(Math.abs(ut||0),te),10)+"",xe=Ce.length>3?Ce.length%3:0;return fe+(xe?Ce.substr(0,xe)+ce.thousand:"")+Ce.substr(xe).replace(/(\d{3})(?=\d)/g,"$1"+ce.thousand)+(te?ce.decimal+vt(Math.abs(ut),te).split(".")[1]:"")},Tt=p.formatMoney=function(ut,Dt,Ot,Ut,ce,te){if(I(ut))return L(ut,function(ri){return Tt(ri,Dt,Ot,Ut,ce,te)});ut=lt(ut);var fe=P(R(Dt)?Dt:{symbol:Dt,precision:Ot,thousand:Ut,decimal:ce,format:te},p.settings.currency),Ce=tt(fe.format),xe=ut>0?Ce.pos:ut<0?Ce.neg:Ce.zero;return xe.replace("%s",fe.symbol).replace("%v",yt(Math.abs(ut),K(fe.precision),fe.thousand,fe.decimal))};p.formatColumn=function(ut,Dt,Ot,Ut,ce,te){if(!ut)return[];var fe=P(R(Dt)?Dt:{symbol:Dt,precision:Ot,thousand:Ut,decimal:ce,format:te},p.settings.currency),Ce=tt(fe.format),xe=Ce.pos.indexOf("%s")<Ce.pos.indexOf("%v"),ri=0,pe=L(ut,function(Qt,oe){if(I(Qt))return p.formatColumn(Qt,fe);Qt=lt(Qt);var ze=Qt>0?Ce.pos:Qt<0?Ce.neg:Ce.zero,Le=ze.replace("%s",fe.symbol).replace("%v",yt(Math.abs(Qt),K(fe.precision),fe.thousand,fe.decimal));return Le.length>ri&&(ri=Le.length),Le});return L(pe,function(Qt,oe){return T(Qt)&&Qt.length<ri?xe?Qt.replace(fe.symbol,fe.symbol+new Array(ri-Qt.length+1).join(" ")):new Array(ri-Qt.length+1).join(" ")+Qt:Qt})},t.exports&&(r=t.exports=p),r.accounting=p})()})(am,am.exports);var zT=am.exports;const Yv=Kv(zT);function Sr(t){const r=Object.prototype.toString.call(t);return t instanceof Date||typeof t=="object"&&r==="[object Date]"?new t.constructor(+t):typeof t=="number"||r==="[object Number]"||typeof t=="string"||r==="[object String]"?new Date(t):new Date(NaN)}function cn(t,r){return t instanceof Date?new t.constructor(r):new Date(r)}function Jv(t,r){const a=Sr(t);return isNaN(r)?cn(t,NaN):(r&&a.setDate(a.getDate()+r),a)}function Qv(t,r){const a=Sr(t);if(isNaN(r))return cn(t,NaN);if(!r)return a;const h=a.getDate(),p=cn(t,a.getTime());p.setMonth(a.getMonth()+r+1,0);const _=p.getDate();return h>=_?p:(a.setFullYear(p.getFullYear(),p.getMonth(),h),a)}function LT(t,r){const a=+Sr(t);return cn(t,a+r)}const tx=6048e5,OT=864e5,ex=6e4,$m=36e5;function FT(t,r){return LT(t,r*$m)}let BT={};function hf(){return BT}function Ch(t,r){var l,T,I,R;const a=hf(),h=(r==null?void 0:r.weekStartsOn)??((T=(l=r==null?void 0:r.locale)==null?void 0:l.options)==null?void 0:T.weekStartsOn)??a.weekStartsOn??((R=(I=a.locale)==null?void 0:I.options)==null?void 0:R.weekStartsOn)??0,p=Sr(t),_=p.getDay(),m=(_<h?7:0)+_-h;return p.setDate(p.getDate()-m),p.setHours(0,0,0,0),p}function Cd(t){return Ch(t,{weekStartsOn:1})}function ix(t){const r=Sr(t),a=r.getFullYear(),h=cn(t,0);h.setFullYear(a+1,0,4),h.setHours(0,0,0,0);const p=Cd(h),_=cn(t,0);_.setFullYear(a,0,4),_.setHours(0,0,0,0);const m=Cd(_);return r.getTime()>=p.getTime()?a+1:r.getTime()>=m.getTime()?a:a-1}function ky(t){const r=Sr(t);return r.setHours(0,0,0,0),r}function Ry(t){const r=Sr(t),a=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return a.setUTCFullYear(r.getFullYear()),+t-+a}function NT(t,r){const a=ky(t),h=ky(r),p=+a-Ry(a),_=+h-Ry(h);return Math.round((p-_)/OT)}function $T(t){const r=ix(t),a=cn(t,0);return a.setFullYear(r,0,4),a.setHours(0,0,0,0),Cd(a)}function VT(t,r){const a=r*7;return Jv(t,a)}function UT(t,r){return Qv(t,r*12)}function qT(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function jT(t){if(!qT(t)&&typeof t!="number")return!1;const r=Sr(t);return!isNaN(Number(r))}function GT(t){const r=Sr(t),a=cn(t,0);return a.setFullYear(r.getFullYear(),0,1),a.setHours(0,0,0,0),a}const HT={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},WT=(t,r,a)=>{let h;const p=HT[t];return typeof p=="string"?h=p:r===1?h=p.one:h=p.other.replace("{{count}}",r.toString()),a!=null&&a.addSuffix?a.comparison&&a.comparison>0?"in "+h:h+" ago":h};function zp(t){return(r={})=>{const a=r.width?String(r.width):t.defaultWidth;return t.formats[a]||t.formats[t.defaultWidth]}}const ZT={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},XT={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},KT={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},YT={date:zp({formats:ZT,defaultWidth:"full"}),time:zp({formats:XT,defaultWidth:"full"}),dateTime:zp({formats:KT,defaultWidth:"full"})},JT={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},QT=(t,r,a,h)=>JT[t];function ih(t){return(r,a)=>{const h=a!=null&&a.context?String(a.context):"standalone";let p;if(h==="formatting"&&t.formattingValues){const m=t.defaultFormattingWidth||t.defaultWidth,l=a!=null&&a.width?String(a.width):m;p=t.formattingValues[l]||t.formattingValues[m]}else{const m=t.defaultWidth,l=a!=null&&a.width?String(a.width):t.defaultWidth;p=t.values[l]||t.values[m]}const _=t.argumentCallback?t.argumentCallback(r):r;return p[_]}}const tA={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},eA={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},iA={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},sA={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},rA={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},nA={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},aA=(t,r)=>{const a=Number(t),h=a%100;if(h>20||h<10)switch(h%10){case 1:return a+"st";case 2:return a+"nd";case 3:return a+"rd"}return a+"th"},oA={ordinalNumber:aA,era:ih({values:tA,defaultWidth:"wide"}),quarter:ih({values:eA,defaultWidth:"wide",argumentCallback:t=>t-1}),month:ih({values:iA,defaultWidth:"wide"}),day:ih({values:sA,defaultWidth:"wide"}),dayPeriod:ih({values:rA,defaultWidth:"wide",formattingValues:nA,defaultFormattingWidth:"wide"})};function sh(t){return(r,a={})=>{const h=a.width,p=h&&t.matchPatterns[h]||t.matchPatterns[t.defaultMatchWidth],_=r.match(p);if(!_)return null;const m=_[0],l=h&&t.parsePatterns[h]||t.parsePatterns[t.defaultParseWidth],T=Array.isArray(l)?cA(l,P=>P.test(m)):lA(l,P=>P.test(m));let I;I=t.valueCallback?t.valueCallback(T):T,I=a.valueCallback?a.valueCallback(I):I;const R=r.slice(m.length);return{value:I,rest:R}}}function lA(t,r){for(const a in t)if(Object.prototype.hasOwnProperty.call(t,a)&&r(t[a]))return a}function cA(t,r){for(let a=0;a<t.length;a++)if(r(t[a]))return a}function hA(t){return(r,a={})=>{const h=r.match(t.matchPattern);if(!h)return null;const p=h[0],_=r.match(t.parsePattern);if(!_)return null;let m=t.valueCallback?t.valueCallback(_[0]):_[0];m=a.valueCallback?a.valueCallback(m):m;const l=r.slice(p.length);return{value:m,rest:l}}}const uA=/^(\d+)(th|st|nd|rd)?/i,dA=/\d+/i,fA={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},pA={any:[/^b/i,/^(a|c)/i]},mA={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},gA={any:[/1/i,/2/i,/3/i,/4/i]},_A={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},yA={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},vA={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},xA={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},bA={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},wA={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},MA={ordinalNumber:hA({matchPattern:uA,parsePattern:dA,valueCallback:t=>parseInt(t,10)}),era:sh({matchPatterns:fA,defaultMatchWidth:"wide",parsePatterns:pA,defaultParseWidth:"any"}),quarter:sh({matchPatterns:mA,defaultMatchWidth:"wide",parsePatterns:gA,defaultParseWidth:"any",valueCallback:t=>t+1}),month:sh({matchPatterns:_A,defaultMatchWidth:"wide",parsePatterns:yA,defaultParseWidth:"any"}),day:sh({matchPatterns:vA,defaultMatchWidth:"wide",parsePatterns:xA,defaultParseWidth:"any"}),dayPeriod:sh({matchPatterns:bA,defaultMatchWidth:"any",parsePatterns:wA,defaultParseWidth:"any"})},SA={code:"en-US",formatDistance:WT,formatLong:YT,formatRelative:QT,localize:oA,match:MA,options:{weekStartsOn:0,firstWeekContainsDate:1}};function TA(t){const r=Sr(t);return NT(r,GT(r))+1}function AA(t){const r=Sr(t),a=+Cd(r)-+$T(r);return Math.round(a/tx)+1}function sx(t,r){var R,P,L,K;const a=Sr(t),h=a.getFullYear(),p=hf(),_=(r==null?void 0:r.firstWeekContainsDate)??((P=(R=r==null?void 0:r.locale)==null?void 0:R.options)==null?void 0:P.firstWeekContainsDate)??p.firstWeekContainsDate??((K=(L=p.locale)==null?void 0:L.options)==null?void 0:K.firstWeekContainsDate)??1,m=cn(t,0);m.setFullYear(h+1,0,_),m.setHours(0,0,0,0);const l=Ch(m,r),T=cn(t,0);T.setFullYear(h,0,_),T.setHours(0,0,0,0);const I=Ch(T,r);return a.getTime()>=l.getTime()?h+1:a.getTime()>=I.getTime()?h:h-1}function EA(t,r){var l,T,I,R;const a=hf(),h=(r==null?void 0:r.firstWeekContainsDate)??((T=(l=r==null?void 0:r.locale)==null?void 0:l.options)==null?void 0:T.firstWeekContainsDate)??a.firstWeekContainsDate??((R=(I=a.locale)==null?void 0:I.options)==null?void 0:R.firstWeekContainsDate)??1,p=sx(t,r),_=cn(t,0);return _.setFullYear(p,0,h),_.setHours(0,0,0,0),Ch(_,r)}function IA(t,r){const a=Sr(t),h=+Ch(a,r)-+EA(a,r);return Math.round(h/tx)+1}function Mi(t,r){const a=t<0?"-":"",h=Math.abs(t).toString().padStart(r,"0");return a+h}const Ta={y(t,r){const a=t.getFullYear(),h=a>0?a:1-a;return Mi(r==="yy"?h%100:h,r.length)},M(t,r){const a=t.getMonth();return r==="M"?String(a+1):Mi(a+1,2)},d(t,r){return Mi(t.getDate(),r.length)},a(t,r){const a=t.getHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return a.toUpperCase();case"aaa":return a;case"aaaaa":return a[0];case"aaaa":default:return a==="am"?"a.m.":"p.m."}},h(t,r){return Mi(t.getHours()%12||12,r.length)},H(t,r){return Mi(t.getHours(),r.length)},m(t,r){return Mi(t.getMinutes(),r.length)},s(t,r){return Mi(t.getSeconds(),r.length)},S(t,r){const a=r.length,h=t.getMilliseconds(),p=Math.trunc(h*Math.pow(10,a-3));return Mi(p,r.length)}},Al={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},zy={G:function(t,r,a){const h=t.getFullYear()>0?1:0;switch(r){case"G":case"GG":case"GGG":return a.era(h,{width:"abbreviated"});case"GGGGG":return a.era(h,{width:"narrow"});case"GGGG":default:return a.era(h,{width:"wide"})}},y:function(t,r,a){if(r==="yo"){const h=t.getFullYear(),p=h>0?h:1-h;return a.ordinalNumber(p,{unit:"year"})}return Ta.y(t,r)},Y:function(t,r,a,h){const p=sx(t,h),_=p>0?p:1-p;if(r==="YY"){const m=_%100;return Mi(m,2)}return r==="Yo"?a.ordinalNumber(_,{unit:"year"}):Mi(_,r.length)},R:function(t,r){const a=ix(t);return Mi(a,r.length)},u:function(t,r){const a=t.getFullYear();return Mi(a,r.length)},Q:function(t,r,a){const h=Math.ceil((t.getMonth()+1)/3);switch(r){case"Q":return String(h);case"QQ":return Mi(h,2);case"Qo":return a.ordinalNumber(h,{unit:"quarter"});case"QQQ":return a.quarter(h,{width:"abbreviated",context:"formatting"});case"QQQQQ":return a.quarter(h,{width:"narrow",context:"formatting"});case"QQQQ":default:return a.quarter(h,{width:"wide",context:"formatting"})}},q:function(t,r,a){const h=Math.ceil((t.getMonth()+1)/3);switch(r){case"q":return String(h);case"qq":return Mi(h,2);case"qo":return a.ordinalNumber(h,{unit:"quarter"});case"qqq":return a.quarter(h,{width:"abbreviated",context:"standalone"});case"qqqqq":return a.quarter(h,{width:"narrow",context:"standalone"});case"qqqq":default:return a.quarter(h,{width:"wide",context:"standalone"})}},M:function(t,r,a){const h=t.getMonth();switch(r){case"M":case"MM":return Ta.M(t,r);case"Mo":return a.ordinalNumber(h+1,{unit:"month"});case"MMM":return a.month(h,{width:"abbreviated",context:"formatting"});case"MMMMM":return a.month(h,{width:"narrow",context:"formatting"});case"MMMM":default:return a.month(h,{width:"wide",context:"formatting"})}},L:function(t,r,a){const h=t.getMonth();switch(r){case"L":return String(h+1);case"LL":return Mi(h+1,2);case"Lo":return a.ordinalNumber(h+1,{unit:"month"});case"LLL":return a.month(h,{width:"abbreviated",context:"standalone"});case"LLLLL":return a.month(h,{width:"narrow",context:"standalone"});case"LLLL":default:return a.month(h,{width:"wide",context:"standalone"})}},w:function(t,r,a,h){const p=IA(t,h);return r==="wo"?a.ordinalNumber(p,{unit:"week"}):Mi(p,r.length)},I:function(t,r,a){const h=AA(t);return r==="Io"?a.ordinalNumber(h,{unit:"week"}):Mi(h,r.length)},d:function(t,r,a){return r==="do"?a.ordinalNumber(t.getDate(),{unit:"date"}):Ta.d(t,r)},D:function(t,r,a){const h=TA(t);return r==="Do"?a.ordinalNumber(h,{unit:"dayOfYear"}):Mi(h,r.length)},E:function(t,r,a){const h=t.getDay();switch(r){case"E":case"EE":case"EEE":return a.day(h,{width:"abbreviated",context:"formatting"});case"EEEEE":return a.day(h,{width:"narrow",context:"formatting"});case"EEEEEE":return a.day(h,{width:"short",context:"formatting"});case"EEEE":default:return a.day(h,{width:"wide",context:"formatting"})}},e:function(t,r,a,h){const p=t.getDay(),_=(p-h.weekStartsOn+8)%7||7;switch(r){case"e":return String(_);case"ee":return Mi(_,2);case"eo":return a.ordinalNumber(_,{unit:"day"});case"eee":return a.day(p,{width:"abbreviated",context:"formatting"});case"eeeee":return a.day(p,{width:"narrow",context:"formatting"});case"eeeeee":return a.day(p,{width:"short",context:"formatting"});case"eeee":default:return a.day(p,{width:"wide",context:"formatting"})}},c:function(t,r,a,h){const p=t.getDay(),_=(p-h.weekStartsOn+8)%7||7;switch(r){case"c":return String(_);case"cc":return Mi(_,r.length);case"co":return a.ordinalNumber(_,{unit:"day"});case"ccc":return a.day(p,{width:"abbreviated",context:"standalone"});case"ccccc":return a.day(p,{width:"narrow",context:"standalone"});case"cccccc":return a.day(p,{width:"short",context:"standalone"});case"cccc":default:return a.day(p,{width:"wide",context:"standalone"})}},i:function(t,r,a){const h=t.getDay(),p=h===0?7:h;switch(r){case"i":return String(p);case"ii":return Mi(p,r.length);case"io":return a.ordinalNumber(p,{unit:"day"});case"iii":return a.day(h,{width:"abbreviated",context:"formatting"});case"iiiii":return a.day(h,{width:"narrow",context:"formatting"});case"iiiiii":return a.day(h,{width:"short",context:"formatting"});case"iiii":default:return a.day(h,{width:"wide",context:"formatting"})}},a:function(t,r,a){const p=t.getHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return a.dayPeriod(p,{width:"abbreviated",context:"formatting"});case"aaa":return a.dayPeriod(p,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return a.dayPeriod(p,{width:"narrow",context:"formatting"});case"aaaa":default:return a.dayPeriod(p,{width:"wide",context:"formatting"})}},b:function(t,r,a){const h=t.getHours();let p;switch(h===12?p=Al.noon:h===0?p=Al.midnight:p=h/12>=1?"pm":"am",r){case"b":case"bb":return a.dayPeriod(p,{width:"abbreviated",context:"formatting"});case"bbb":return a.dayPeriod(p,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return a.dayPeriod(p,{width:"narrow",context:"formatting"});case"bbbb":default:return a.dayPeriod(p,{width:"wide",context:"formatting"})}},B:function(t,r,a){const h=t.getHours();let p;switch(h>=17?p=Al.evening:h>=12?p=Al.afternoon:h>=4?p=Al.morning:p=Al.night,r){case"B":case"BB":case"BBB":return a.dayPeriod(p,{width:"abbreviated",context:"formatting"});case"BBBBB":return a.dayPeriod(p,{width:"narrow",context:"formatting"});case"BBBB":default:return a.dayPeriod(p,{width:"wide",context:"formatting"})}},h:function(t,r,a){if(r==="ho"){let h=t.getHours()%12;return h===0&&(h=12),a.ordinalNumber(h,{unit:"hour"})}return Ta.h(t,r)},H:function(t,r,a){return r==="Ho"?a.ordinalNumber(t.getHours(),{unit:"hour"}):Ta.H(t,r)},K:function(t,r,a){const h=t.getHours()%12;return r==="Ko"?a.ordinalNumber(h,{unit:"hour"}):Mi(h,r.length)},k:function(t,r,a){let h=t.getHours();return h===0&&(h=24),r==="ko"?a.ordinalNumber(h,{unit:"hour"}):Mi(h,r.length)},m:function(t,r,a){return r==="mo"?a.ordinalNumber(t.getMinutes(),{unit:"minute"}):Ta.m(t,r)},s:function(t,r,a){return r==="so"?a.ordinalNumber(t.getSeconds(),{unit:"second"}):Ta.s(t,r)},S:function(t,r){return Ta.S(t,r)},X:function(t,r,a){const h=t.getTimezoneOffset();if(h===0)return"Z";switch(r){case"X":return Oy(h);case"XXXX":case"XX":return go(h);case"XXXXX":case"XXX":default:return go(h,":")}},x:function(t,r,a){const h=t.getTimezoneOffset();switch(r){case"x":return Oy(h);case"xxxx":case"xx":return go(h);case"xxxxx":case"xxx":default:return go(h,":")}},O:function(t,r,a){const h=t.getTimezoneOffset();switch(r){case"O":case"OO":case"OOO":return"GMT"+Ly(h,":");case"OOOO":default:return"GMT"+go(h,":")}},z:function(t,r,a){const h=t.getTimezoneOffset();switch(r){case"z":case"zz":case"zzz":return"GMT"+Ly(h,":");case"zzzz":default:return"GMT"+go(h,":")}},t:function(t,r,a){const h=Math.trunc(t.getTime()/1e3);return Mi(h,r.length)},T:function(t,r,a){const h=t.getTime();return Mi(h,r.length)}};function Ly(t,r=""){const a=t>0?"-":"+",h=Math.abs(t),p=Math.trunc(h/60),_=h%60;return _===0?a+String(p):a+String(p)+r+Mi(_,2)}function Oy(t,r){return t%60===0?(t>0?"-":"+")+Mi(Math.abs(t)/60,2):go(t,r)}function go(t,r=""){const a=t>0?"-":"+",h=Math.abs(t),p=Mi(Math.trunc(h/60),2),_=Mi(h%60,2);return a+p+r+_}const Fy=(t,r)=>{switch(t){case"P":return r.date({width:"short"});case"PP":return r.date({width:"medium"});case"PPP":return r.date({width:"long"});case"PPPP":default:return r.date({width:"full"})}},rx=(t,r)=>{switch(t){case"p":return r.time({width:"short"});case"pp":return r.time({width:"medium"});case"ppp":return r.time({width:"long"});case"pppp":default:return r.time({width:"full"})}},PA=(t,r)=>{const a=t.match(/(P+)(p+)?/)||[],h=a[1],p=a[2];if(!p)return Fy(t,r);let _;switch(h){case"P":_=r.dateTime({width:"short"});break;case"PP":_=r.dateTime({width:"medium"});break;case"PPP":_=r.dateTime({width:"long"});break;case"PPPP":default:_=r.dateTime({width:"full"});break}return _.replace("{{date}}",Fy(h,r)).replace("{{time}}",rx(p,r))},CA={p:rx,P:PA},DA=/^D+$/,kA=/^Y+$/,RA=["D","DD","YY","YYYY"];function zA(t){return DA.test(t)}function LA(t){return kA.test(t)}function OA(t,r,a){const h=FA(t,r,a);if(console.warn(h),RA.includes(t))throw new RangeError(h)}function FA(t,r,a){const h=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${r}\`) for formatting ${h} to the input \`${a}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const BA=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,NA=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,$A=/^'([^]*?)'?$/,VA=/''/g,UA=/[a-zA-Z]/;function om(t,r,a){var R,P,L,K,tt,lt,vt,yt;const h=hf(),p=(a==null?void 0:a.locale)??h.locale??SA,_=(a==null?void 0:a.firstWeekContainsDate)??((P=(R=a==null?void 0:a.locale)==null?void 0:R.options)==null?void 0:P.firstWeekContainsDate)??h.firstWeekContainsDate??((K=(L=h.locale)==null?void 0:L.options)==null?void 0:K.firstWeekContainsDate)??1,m=(a==null?void 0:a.weekStartsOn)??((lt=(tt=a==null?void 0:a.locale)==null?void 0:tt.options)==null?void 0:lt.weekStartsOn)??h.weekStartsOn??((yt=(vt=h.locale)==null?void 0:vt.options)==null?void 0:yt.weekStartsOn)??0,l=Sr(t);if(!jT(l))throw new RangeError("Invalid time value");let T=r.match(NA).map(Tt=>{const ut=Tt[0];if(ut==="p"||ut==="P"){const Dt=CA[ut];return Dt(Tt,p.formatLong)}return Tt}).join("").match(BA).map(Tt=>{if(Tt==="''")return{isToken:!1,value:"'"};const ut=Tt[0];if(ut==="'")return{isToken:!1,value:qA(Tt)};if(zy[ut])return{isToken:!0,value:Tt};if(ut.match(UA))throw new RangeError("Format string contains an unescaped latin alphabet character `"+ut+"`");return{isToken:!1,value:Tt}});p.localize.preprocessor&&(T=p.localize.preprocessor(l,T));const I={firstWeekContainsDate:_,weekStartsOn:m,locale:p};return T.map(Tt=>{if(!Tt.isToken)return Tt.value;const ut=Tt.value;(!(a!=null&&a.useAdditionalWeekYearTokens)&&LA(ut)||!(a!=null&&a.useAdditionalDayOfYearTokens)&&zA(ut))&&OA(ut,r,String(t));const Dt=zy[ut[0]];return Dt(l,ut,p.localize,I)}).join("")}function qA(t){const r=t.match($A);return r?r[1].replace(VA,"'"):t}function jA(t,r){return Jv(t,-r)}function GA(t,r){const a=(r==null?void 0:r.additionalDigits)??2,h=XA(t);let p;if(h.date){const T=KA(h.date,a);p=YA(T.restDateString,T.year)}if(!p||isNaN(p.getTime()))return new Date(NaN);const _=p.getTime();let m=0,l;if(h.time&&(m=JA(h.time),isNaN(m)))return new Date(NaN);if(h.timezone){if(l=QA(h.timezone),isNaN(l))return new Date(NaN)}else{const T=new Date(_+m),I=new Date(0);return I.setFullYear(T.getUTCFullYear(),T.getUTCMonth(),T.getUTCDate()),I.setHours(T.getUTCHours(),T.getUTCMinutes(),T.getUTCSeconds(),T.getUTCMilliseconds()),I}return new Date(_+m+l)}const nd={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},HA=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,WA=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,ZA=/^([+-])(\d{2})(?::?(\d{2}))?$/;function XA(t){const r={},a=t.split(nd.dateTimeDelimiter);let h;if(a.length>2)return r;if(/:/.test(a[0])?h=a[0]:(r.date=a[0],h=a[1],nd.timeZoneDelimiter.test(r.date)&&(r.date=t.split(nd.timeZoneDelimiter)[0],h=t.substr(r.date.length,t.length))),h){const p=nd.timezone.exec(h);p?(r.time=h.replace(p[1],""),r.timezone=p[1]):r.time=h}return r}function KA(t,r){const a=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+r)+"})|(\\d{2}|[+-]\\d{"+(2+r)+"})$)"),h=t.match(a);if(!h)return{year:NaN,restDateString:""};const p=h[1]?parseInt(h[1]):null,_=h[2]?parseInt(h[2]):null;return{year:_===null?p:_*100,restDateString:t.slice((h[1]||h[2]).length)}}function YA(t,r){if(r===null)return new Date(NaN);const a=t.match(HA);if(!a)return new Date(NaN);const h=!!a[4],p=rh(a[1]),_=rh(a[2])-1,m=rh(a[3]),l=rh(a[4]),T=rh(a[5])-1;if(h)return rE(r,l,T)?tE(r,l,T):new Date(NaN);{const I=new Date(0);return!iE(r,_,m)||!sE(r,p)?new Date(NaN):(I.setUTCFullYear(r,_,Math.max(p,m)),I)}}function rh(t){return t?parseInt(t):1}function JA(t){const r=t.match(WA);if(!r)return NaN;const a=Lp(r[1]),h=Lp(r[2]),p=Lp(r[3]);return nE(a,h,p)?a*$m+h*ex+p*1e3:NaN}function Lp(t){return t&&parseFloat(t.replace(",","."))||0}function QA(t){if(t==="Z")return 0;const r=t.match(ZA);if(!r)return 0;const a=r[1]==="+"?-1:1,h=parseInt(r[2]),p=r[3]&&parseInt(r[3])||0;return aE(h,p)?a*(h*$m+p*ex):NaN}function tE(t,r,a){const h=new Date(0);h.setUTCFullYear(t,0,4);const p=h.getUTCDay()||7,_=(r-1)*7+a+1-p;return h.setUTCDate(h.getUTCDate()+_),h}const eE=[31,null,31,30,31,30,31,31,30,31,30,31];function nx(t){return t%400===0||t%4===0&&t%100!==0}function iE(t,r,a){return r>=0&&r<=11&&a>=1&&a<=(eE[r]||(nx(t)?29:28))}function sE(t,r){return r>=1&&r<=(nx(t)?366:365)}function rE(t,r,a){return r>=1&&r<=53&&a>=0&&a<=6}function nE(t,r,a){return t===24?r===0&&a===0:a>=0&&a<60&&r>=0&&r<60&&t>=0&&t<25}function aE(t,r){return r>=0&&r<=59}function oE(t,r){return Qv(t,-r)}function lE(t,r){return FT(t,-r)}function cE(t,r){return VT(t,-r)}function hE(t,r){return UT(t,-r)}Yv.settings.currency.precision=0;function Vm(){return{bold:h=>"<strong>"+h+"</strong>",currency:h=>Yv.formatMoney(h),date:h=>{let p;return typeof h=="string"?p=om(GA(h),"MM/dd/yyyy"):p=om(h,"MM/dd/yyyy"),p}}}const{currency:By,date:uE}=Vm(),ax=ea("OpaStore",{state:()=>({opaData:{}}),actions:{async fillOpaData(){const r=Ds().addressData.features[0].properties.opa_account_num,a=await fetch(`https://phl.carto.com/api/v2/sql?q=select+*+from+opa_properties_public+where+parcel_number+%3D+%27${r}%27`);this.opaData=await a.json()}},getters:{getMarketValue:t=>By(t.opaData.rows[0].market_value||null),getSaleDate:t=>uE(t.opaData.rows[0].sale_date),getSalePrice:t=>By(t.opaData.rows[0].sale_price)}}),Na=t=>(Wd("data-v-c822a1b7"),t=t(),Zd(),t),dE={key:0,class:"box"},fE={key:1,class:"vert-table"},pE={class:"columns"},mE=Na(()=>ct("div",{class:"column is-4"},"OPA Account #",-1)),gE={class:"column is-8"},_E={class:"columns"},yE=Na(()=>ct("div",{class:"column is-4"},"OPA Address",-1)),vE={class:"column is-8"},xE={class:"columns"},bE=Na(()=>ct("div",{class:"column is-4"},"Owners",-1)),wE={class:"column is-8"},ME={class:"columns"},SE=Na(()=>ct("div",{class:"column is-4"},"Assessed Value",-1)),TE={class:"column is-8"},AE={class:"columns"},EE=Na(()=>ct("div",{class:"column is-4"},"Sale Date",-1)),IE={class:"column is-8"},PE={class:"columns"},CE=Na(()=>ct("div",{class:"column is-4"},"Sale Price",-1)),DE={class:"column is-8"},kE={key:2},RE={class:"title is-5"},zE=Na(()=>ct("p",null,"You can use the Condominiums tab below to see information for an individual unit.",-1)),LE={key:3},OE=Na(()=>ct("p",null,"There is no property assessment record for this address.",-1)),FE=[OE],BE={__name:"Property",setup(t){console.log("Property.vue setup");const r=Ds(),a=ax(),h=$h();return(p,_)=>(Pe(),Ue("section",null,[Ti(a).opaData.rows.length?(Pe(),Ue("div",dE," Property assessment and sale information for this address. Source: Office of Property Assessments (OPA). OPA was formerly a part of the Bureau of Revision of Taxes (BRT) and some City records may still use that name. ")):Zi("",!0),Ti(a).opaData.rows.length?(Pe(),Ue("div",fE,[ct("div",pE,[mE,ct("div",gE,Fe(Ti(r).addressData.features[0].properties.opa_account_num),1)]),ct("div",_E,[yE,ct("div",vE,Fe(Ti(r).addressData.features[0].properties.opa_address),1)]),ct("div",xE,[bE,ct("div",wE,Fe(Ti(r).getOpaOwners),1)]),ct("div",ME,[SE,ct("div",TE,Fe(Ti(a).getMarketValue),1)]),ct("div",AE,[EE,ct("div",IE,Fe(Ti(a).getSaleDate),1)]),ct("div",PE,[CE,ct("div",DE,Fe(Ti(a).getSalePrice),1)])])):Zi("",!0),!Ti(a).opaData.rows.length&&Ti(h).condosData.length?(Pe(),Ue("div",kE,[ct("h5",RE,"There are "+Fe(Ti(h).condosData.length)+" condominium units at this address.",1),zE])):Ti(a).opaData.rows.length?Zi("",!0):(Pe(),Ue("div",LE,FE))]))}},NE=Vh(BE,[["__scopeId","data-v-c822a1b7"]]),$E=ct("div",{class:"box"}," Condominium units at your search address, as recorded for property assessment purposes. Click one of the addresses below to see information for that unit. Use the back button to return to this list. Source: Office of Property Assessment ",-1),VE=ct("h5",{class:"subtitle is-5"},"Condominiums",-1),UE={class:"table is-fullwidth is-striped"},qE=ct("thead",null,[ct("tr",null,[ct("th",null,"Address"),ct("th",null,"OPA Account #")])],-1),jE={__name:"Condos",setup(t){console.log("Condos.vue setup");const r=$h(),a=wi(()=>r.condosData);return(h,p)=>(Pe(),Ue("section",null,[$E,VE,ct("table",UE,[qE,ct("tbody",null,[(Pe(!0),Ue(ns,null,An(a.value,_=>(Pe(),Ue("tr",null,[ct("td",null,[Gi(Ti(Ev),{to:{name:"address-and-topic",params:{address:_.properties.opa_address,topic:"Property"}}},{default:Xn(()=>[lv(Fe(_.properties.opa_address),1)]),_:2},1032,["to"])]),ct("td",null,Fe(_.properties.opa_account_num),1)]))),256))])])]))}},Uh=ea("ParcelsStore",{state:()=>({PWD:{},DOR:{}}),actions:{async fillPwdParcelData(){const r=Ds().addressData.features;if(!r)return;const a=r[0],h=a.properties.pwd_parcel_id;if(!h){console.log("no PWD parcel in AIS"),await this.fillParcelDataByLngLat(a.geometry.coordinates[0],a.geometry.coordinates[1],"PWD");return}try{const p=await fetch(`https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/PWD_PARCELS/FeatureServer/0/query?where=PARCELID=%27${h}%27&outSR=4326&f=geojson&outFields=*&returnGeometry=true`);p.ok?this.PWD=await p.json():console.error("Failed to fetch PWD parcel data")}catch{console.error("Failed to fetch PWD parcel data")}},async fillDorParcelData(){const r=Ds().addressData.features;if(!r)return;const a=r[0],h=a.properties.dor_parcel_id;if(!h){console.log("no DOR parcel in AIS"),await this.fillParcelDataByLngLat(a.geometry.coordinates[0],a.geometry.coordinates[1],"DOR");return}try{const p=await fetch(`https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/DOR_Parcel/FeatureServer/0/query?where=MAPREG=%27${h}%27&outSR=4326&f=geojson&outFields=*&returnGeometry=true`);p.ok?this.DOR=await p.json():console.error("Failed to fetch DOR parcel data")}catch{console.error("Failed to fetch DOR parcel data")}},async fillParcelDataByLngLat(t,r,a){console.log("fillParcelDataByLngLat, lng:",t,"lat:",r,"parcelLayer:",a);let h=a==="PWD"?"PWD_PARCELS":"DOR_Parcel",p={where:"1=1",outSR:4326,f:"geojson",outFields:"*",returnGeometry:!0,geometry:`{ "x": ${t}, "y": ${r}, "spatialReference":{ "wkid":4326 }}`,geometryType:"esriGeometryPoint",spatialRel:"esriSpatialRelWithin"};const _=await Li(`https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/${h}/FeatureServer/0/query`,{params:p});console.log("response",_),_.data.features.length>0&&(this[a]=await _.data)}}}),Pl=function(t){var r=t?String(t):"";return r=r.replace(/\s+/g,""),[null,"0"].indexOf(r)>-1?"":r},GE=function(t,r){console.log("concatDorAddress is running, parcel:",t),r=!!r;var a=["STDIR","STNAM","STDES","STDESSUF"],h=t.properties,p=Pl(h.HOUSE),_=Pl(h.STEX),m=Pl(h.SUF),l=p;l=l+(_?"-"+_:""),l=l+(m||"");var T=Pl(h.UNIT);T&&(T="# "+T);var I=a.map(function(R){return h[R]});return I=I.map(Pl),I=[l].concat(I),r&&(I=I.concat([T])),l=I.filter(Boolean).join(" "),l===""&&(l="Parcel has no address"),console.log("concatDorAddress address result:",l),l},ox=ea("DorStore",{state:()=>({dorDocuments:{}}),actions:{async initializeDorDocuments(){this.dorDocuments={};const t=Uh(),r=Ds(),a="//services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/RTT_SUMMARY/FeatureServer/0/query",h=function(p){console.log("where function is running, feature:",p);var _=GE(p),m=r.addressData.features[0].properties,l;if(!_||_==="null")l="MATCHED_REGMAP = '"+t.DOR.features[0].properties.BASEREG+"'";else{var T=r.addressData.features[0].properties,I=T.address_low,R=Math.floor(I/100,1)*100,P=I-R,L=T.address_high,K=L||I;l="(((ADDRESS_LOW >= "+I+" AND ADDRESS_LOW <= "+K+") OR (ADDRESS_LOW >= "+R+" AND ADDRESS_LOW <= "+K+" AND ADDRESS_HIGH >= "+P+" )) AND STREET_NAME = '"+m.street_name+"' AND STREET_SUFFIX = '"+m.street_suffix+"' AND (MOD(ADDRESS_LOW,2) = MOD( "+I+",2))",m.street_predir!=""&&(l+=" AND STREET_PREDIR = '"+m.street_predir+"'"),m.address_low_suffix!=""&&(l+=" AND ADDRESS_LOW_SUFFIX = '"+m.address_low_suffix+"'"),m.address_low_suffix==""&&(l+=" AND ADDRESS_LOW_SUFFIX = ''"),m.address_low_frac==="1/2"&&(l+=" AND ADDRESS_LOW_SUFFIX = '2'"),m.street_postdir!=""&&(l+=" AND STREET_POSTDIR = '"+m.street_postdir+"'");var tt=Pl(p.properties.UNIT),lt=m.unit_num;tt?l+=" AND UNIT_NUM = '"+tt+"'":lt!==""&&(l+=" AND UNIT_NUM = '"+lt+"'"),l+=") or MATCHED_REGMAP = '"+t.DOR.features[0].properties.BASEREG+"'",l+=" or REG_MAP_ID = '"+t.DOR.features[0].properties.BASEREG+"'"}return l};for(let p of t.DOR.features){const m={where:h(p),outFields:"DOCUMENT_ID, DISPLAY_DATE, DOCUMENT_TYPE, GRANTORS, GRANTEES",returnDistinctValues:"true",returnGeometry:"false",f:"json",sqlFormat:"standard"};console.log("params:",m);const l=await Li(a,{params:m});this.dorDocuments[p.properties.OBJECTID]=l}}}}),hn=t=>(Wd("data-v-8bb204ee"),t=t(),Zd(),t),HE=hn(()=>ct("div",{class:"box"},"Deed information and document transactions for this address. The map faithfully reflects property boundaries as described in recorded deeds including multiple types of easements. The property boundaries displayed on the map are for reference only and should not be used in place of the recorded deeds or land surveys. Source: Department of Records",-1)),WE={class:"columns is-multiline"},ZE=["onClick"],XE=hn(()=>ct("h5",{class:"title is-5"},"Parcel Details",-1)),KE={key:0,class:"vert-table"},YE={class:"columns"},JE=hn(()=>ct("div",{class:"column is-4"},"Map Registry #",-1)),QE={class:"column is-8"},tI={class:"columns"},eI=hn(()=>ct("div",{class:"column is-4"},"Parcel Address",-1)),iI={class:"column is-8"},sI={class:"columns"},rI=hn(()=>ct("div",{class:"column is-4"},"Status",-1)),nI={class:"column is-8"},aI={class:"columns"},oI=hn(()=>ct("div",{class:"column is-4"},"Origination Date",-1)),lI={class:"column is-8"},cI={class:"columns"},hI=hn(()=>ct("div",{class:"column is-4"},"Inactive Date",-1)),uI={class:"column is-8"},dI={class:"columns"},fI=hn(()=>ct("div",{class:"column is-4"},"Has Air Rights",-1)),pI={class:"column is-8"},mI={class:"columns"},gI=hn(()=>ct("div",{class:"column is-4"},"Is Condo",-1)),_I={class:"column is-8"},yI={class:"mt-6"},vI=hn(()=>ct("h5",{class:"subtitle is-5"},"Documents",-1)),xI={class:"table is-fullwidth is-striped"},bI=hn(()=>ct("thead",null,[ct("tr",null,[ct("th",null,"ID"),ct("th",null,"Date"),ct("th",null,"Type"),ct("th",null,"Grantor"),ct("th",null,"Grantee")])],-1)),wI={__name:"Deeds",setup(t){Ds();const r=Uh(),a=ox(),h=rn(""),p=wi(()=>r.DOR.features.filter(l=>l.id===h.value)[0]),_=wi(()=>a.dorDocuments[h.value].data.features);Z0(()=>{console.log("Deeds.vue onBeforeMount"),h.value=r.DOR.features[0].properties.OBJECTID}),Lh(()=>{console.log("Deeds.vue onMounted")});const m={1:"Active",2:"Inactive",3:"Remainder"};return(l,T)=>(Pe(),Ue(ns,null,[HE,ct("div",WE,[(Pe(!0),Ue(ns,null,An(Ti(r).DOR.features,I=>(Pe(),Ue("div",{key:I.properties.OBJECTID,onClick:R=>h.value=I.properties.OBJECTID,class:xo(["column is-3 add-borders",{"is-selected":I.properties.OBJECTID===h.value}])},Fe(I.properties.MAPREG),11,ZE))),128))]),XE,Ti(r).DOR.features.length?(Pe(),Ue("div",KE,[ct("div",YE,[JE,ct("div",QE,Fe(p.value.properties.MAPREG),1)]),ct("div",tI,[eI,ct("div",iI,Fe(p.value.properties.ADDR_SOURCE),1)]),ct("div",sI,[rI,ct("div",nI,Fe(m[p.value.properties.STATUS]),1)]),ct("div",aI,[oI,ct("div",lI,Fe(p.value.properties.ORIG_DATE),1)]),ct("div",cI,[hI,ct("div",uI,Fe(p.value.properties.INACTDATE||"None"),1)]),ct("div",dI,[fI,ct("div",pI,Fe(p.value.properties.SUFFIX?"Yes":"No"),1)]),ct("div",mI,[gI,ct("div",_I,Fe(p.value.properties.CONDOFLAG?"Yes":"No"),1)])])):Zi("",!0),ct("div",yI,[vI,ct("table",xI,[bI,ct("tbody",null,[(Pe(!0),Ue(ns,null,An(_.value,I=>(Pe(),Ue("tr",null,[ct("td",null,Fe(I.attributes.DOCUMENT_ID),1),ct("td",null,Fe(I.attributes.DISPLAY_DATE),1),ct("td",null,Fe(I.attributes.DOCUMENT_TYPE),1),ct("td",null,Fe(I.attributes.GRANTORS),1),ct("td",null,Fe(I.attributes.GRANTEES),1)]))),256))])])])],64))}},MI=Vh(wI,[["__scopeId","data-v-8bb204ee"]]),lx=ea("LiStore",{state:()=>({liInspections:{},liPermits:{}}),actions:{async fillLiInspections(){const r=Ds().addressData.features[0];let a="https://phl.carto.com/api/v2/sql?q=";const h=r.properties.eclipse_location_id.replace(/\|/g,"', '"),p=r.properties.street_address,_=r.properties.opa_account_num?` AND opa_account_num IN ('${r.properties.opa_account_num}')`:"",m=r.properties.pwd_parcel_id,l=r.properties.li_address_key.replace(/\|/g,"', '"),T=a+=`SELECT * FROM case_investigations WHERE (address = '${p}' or addressobjectid IN ('${l}'))           AND systemofrecord IN ('HANSEN') ${_} UNION SELECT * FROM case_investigations WHERE           addressobjectid IN ('${h}') OR parcel_id_num IN ( '${m}' )           AND systemofrecord IN ('ECLIPSE') ${_}`,I=await fetch(T);this.liInspections=await I.json()},async fillLiPermits(){const r=Ds().addressData.features[0];let a="https://phl.carto.com/api/v2/sql?q=";const h=r.properties.eclipse_location_id.replace(/\|/g,"', '"),p=r.properties.street_address,_=r.properties.opa_account_num?` AND opa_account_num IN ('${r.properties.opa_account_num}')`:"",m=r.properties.pwd_parcel_id,l=r.properties.li_address_key.replace(/\|/g,"', '"),T=a+=`SELECT * FROM PERMITS WHERE address = '${p}' or addressobjectid IN ('${l}')       AND systemofrecord IN ('HANSEN') ${_}       UNION SELECT * FROM PERMITS WHERE addressobjectid IN ('${h}') OR parcel_id_num IN ( '${m}' )       AND systemofrecord IN ('ECLIPSE')${_}      ORDER BY permittype`,I=await fetch(T);this.liPermits=await I.json()}},getters:{}}),SI=ct("div",{class:"box"}," Licenses, inspections, permits, property maintenance violations, and zoning permit documents at your search address. Source: Department of Licenses & Inspections ",-1),TI=ct("h5",{class:"subtitle is-5"},"Permits",-1),AI={class:"table is-fullwidth is-striped"},EI=ct("thead",null,[ct("tr",null,[ct("th",null,"Date"),ct("th",null,"ID"),ct("th",null,"Description"),ct("th",null,"Status")])],-1),II=ct("h5",{class:"subtitle is-5"},"Inspections",-1),PI={class:"table is-fullwidth is-striped"},CI=ct("thead",null,[ct("tr",null,[ct("th",null,"Date"),ct("th",null,"ID"),ct("th",null,"Description"),ct("th",null,"Status")])],-1),DI=["innerHTML"],kI={__name:"LI",setup(t){console.log("LI.vue setup");const r=Ds(),a=lx(),{currency:h,date:p}=Vm(),_=(R,P)=>new Date(P.permitissuedate)-new Date(R.permitissuedate),m=wi(()=>a.liPermits.rows.sort(_).slice(0,5)),l=(R,P)=>new Date(P.investigationcompleted)-new Date(R.investigationcompleted),T=wi(()=>a.liInspections.rows.sort(l).slice(0,5)),I=R=>{let P=r.addressData.features[0].properties.street_address;return R.unit_num&&R.unit_num!=null&&(P+=" Unit "+R.unit_num),"<a target='_blank' href='https://li.phila.gov/Property-History/search/Violation-Detail?address="+encodeURIComponent(P)+"&Id="+R.casenumber+"'>"+R.casenumber+" <i class='fa fa-external-link-alt'></i></a>"};return(R,P)=>(Pe(),Ue("section",null,[SI,TI,ct("table",AI,[EI,ct("tbody",null,[(Pe(!0),Ue(ns,null,An(m.value,L=>(Pe(),Ue("tr",null,[ct("td",null,Fe(Ti(p)(L.permitissuedate)),1),ct("td",null,Fe(L.permitnumber),1),ct("td",null,Fe(L.permitdescription),1),ct("td",null,Fe(L.status),1)]))),256))])]),II,ct("table",PI,[CI,ct("tbody",null,[(Pe(!0),Ue(ns,null,An(T.value,L=>(Pe(),Ue("tr",null,[ct("td",null,Fe(Ti(p)(L.investigationcompleted)),1),ct("td",{innerHTML:I(L)},null,8,DI),ct("td",null,Fe(L.investigationtype),1),ct("td",null,Fe(L.investigationstatus),1)]))),256))])])]))}},RI=ct("h1",null,"Zoning Content",-1),zI=[RI],LI={__name:"Zoning",setup(t){return console.log("Zoning.vue setup"),(r,a)=>(Pe(),Ue("section",null,zI))}},OI=ct("h1",null,"Voting Content",-1),FI=[OI],BI={__name:"Voting",setup(t){return console.log("Voting.vue setup"),(r,a)=>(Pe(),Ue("section",null,FI))}};function NI(t){t("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),t("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),t("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),t.WGS84=t["EPSG:4326"],t["EPSG:3785"]=t["EPSG:3857"],t.GOOGLE=t["EPSG:3857"],t["EPSG:900913"]=t["EPSG:3857"],t["EPSG:102113"]=t["EPSG:3857"]}var Mo=1,So=2,Nl=3,$I=4,lm=5,Ny=6378137,VI=6356752314e-3,$y=.0066943799901413165,yh=484813681109536e-20,Zt=Math.PI/2,UI=.16666666666666666,qI=.04722222222222222,jI=.022156084656084655,de=1e-10,$s=.017453292519943295,In=57.29577951308232,xi=Math.PI/4,Dh=Math.PI*2,_s=3.14159265359,Tr={};Tr.greenwich=0;Tr.lisbon=-9.131906111111;Tr.paris=2.337229166667;Tr.bogota=-74.080916666667;Tr.madrid=-3.687938888889;Tr.rome=12.452333333333;Tr.bern=7.439583333333;Tr.jakarta=106.807719444444;Tr.ferro=-17.666666666667;Tr.brussels=4.367975;Tr.stockholm=18.058277777778;Tr.athens=23.7163375;Tr.oslo=10.722916666667;const GI={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var Vy=/[\s_\-\/\(\)]/g;function Fa(t,r){if(t[r])return t[r];for(var a=Object.keys(t),h=r.toLowerCase().replace(Vy,""),p=-1,_,m;++p<a.length;)if(_=a[p],m=_.toLowerCase().replace(Vy,""),m===h)return t[_]}function cm(t){var r={},a=t.split("+").map(function(l){return l.trim()}).filter(function(l){return l}).reduce(function(l,T){var I=T.split("=");return I.push(!0),l[I[0].toLowerCase()]=I[1],l},{}),h,p,_,m={proj:"projName",datum:"datumCode",rf:function(l){r.rf=parseFloat(l)},lat_0:function(l){r.lat0=l*$s},lat_1:function(l){r.lat1=l*$s},lat_2:function(l){r.lat2=l*$s},lat_ts:function(l){r.lat_ts=l*$s},lon_0:function(l){r.long0=l*$s},lon_1:function(l){r.long1=l*$s},lon_2:function(l){r.long2=l*$s},alpha:function(l){r.alpha=parseFloat(l)*$s},gamma:function(l){r.rectified_grid_angle=parseFloat(l)},lonc:function(l){r.longc=l*$s},x_0:function(l){r.x0=parseFloat(l)},y_0:function(l){r.y0=parseFloat(l)},k_0:function(l){r.k0=parseFloat(l)},k:function(l){r.k0=parseFloat(l)},a:function(l){r.a=parseFloat(l)},b:function(l){r.b=parseFloat(l)},r:function(l){r.a=r.b=parseFloat(l)},r_a:function(){r.R_A=!0},zone:function(l){r.zone=parseInt(l,10)},south:function(){r.utmSouth=!0},towgs84:function(l){r.datum_params=l.split(",").map(function(T){return parseFloat(T)})},to_meter:function(l){r.to_meter=parseFloat(l)},units:function(l){r.units=l;var T=Fa(GI,l);T&&(r.to_meter=T.to_meter)},from_greenwich:function(l){r.from_greenwich=l*$s},pm:function(l){var T=Fa(Tr,l);r.from_greenwich=(T||parseFloat(l))*$s},nadgrids:function(l){l==="@null"?r.datumCode="none":r.nadgrids=l},axis:function(l){var T="ewnsud";l.length===3&&T.indexOf(l.substr(0,1))!==-1&&T.indexOf(l.substr(1,1))!==-1&&T.indexOf(l.substr(2,1))!==-1&&(r.axis=l)},approx:function(){r.approx=!0}};for(h in a)p=a[h],h in m?(_=m[h],typeof _=="function"?_(p):r[_]=p):r[h]=p;return typeof r.datumCode=="string"&&r.datumCode!=="WGS84"&&(r.datumCode=r.datumCode.toLowerCase()),r}var kh=1,cx=2,hx=3,Dd=4,ux=5,Um=-1,HI=/\s/,WI=/[A-Za-z]/,ZI=/[A-Za-z84_]/,uf=/[,\]]/,dx=/[\d\.E\-\+]/;function ia(t){if(typeof t!="string")throw new Error("not a string");this.text=t.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=kh}ia.prototype.readCharicter=function(){var t=this.text[this.place++];if(this.state!==Dd)for(;HI.test(t);){if(this.place>=this.text.length)return;t=this.text[this.place++]}switch(this.state){case kh:return this.neutral(t);case cx:return this.keyword(t);case Dd:return this.quoted(t);case ux:return this.afterquote(t);case hx:return this.number(t);case Um:return}};ia.prototype.afterquote=function(t){if(t==='"'){this.word+='"',this.state=Dd;return}if(uf.test(t)){this.word=this.word.trim(),this.afterItem(t);return}throw new Error(`havn't handled "`+t+'" in afterquote yet, index '+this.place)};ia.prototype.afterItem=function(t){if(t===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=kh;return}if(t==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=kh,this.currentObject=this.stack.pop(),this.currentObject||(this.state=Um);return}};ia.prototype.number=function(t){if(dx.test(t)){this.word+=t;return}if(uf.test(t)){this.word=parseFloat(this.word),this.afterItem(t);return}throw new Error(`havn't handled "`+t+'" in number yet, index '+this.place)};ia.prototype.quoted=function(t){if(t==='"'){this.state=ux;return}this.word+=t};ia.prototype.keyword=function(t){if(ZI.test(t)){this.word+=t;return}if(t==="["){var r=[];r.push(this.word),this.level++,this.root===null?this.root=r:this.currentObject.push(r),this.stack.push(this.currentObject),this.currentObject=r,this.state=kh;return}if(uf.test(t)){this.afterItem(t);return}throw new Error(`havn't handled "`+t+'" in keyword yet, index '+this.place)};ia.prototype.neutral=function(t){if(WI.test(t)){this.word=t,this.state=cx;return}if(t==='"'){this.word="",this.state=Dd;return}if(dx.test(t)){this.word=t,this.state=hx;return}if(uf.test(t)){this.afterItem(t);return}throw new Error(`havn't handled "`+t+'" in neutral yet, index '+this.place)};ia.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===Um)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function XI(t){var r=new ia(t);return r.output()}function Uy(t,r,a){Array.isArray(r)&&(a.unshift(r),r=null);var h=r?{}:t,p=a.reduce(function(_,m){return Dl(m,_),_},h);r&&(t[r]=p)}function Dl(t,r){if(!Array.isArray(t)){r[t]=!0;return}var a=t.shift();if(a==="PARAMETER"&&(a=t.shift()),t.length===1){if(Array.isArray(t[0])){r[a]={},Dl(t[0],r[a]);return}r[a]=t[0];return}if(!t.length){r[a]=!0;return}if(a==="TOWGS84"){r[a]=t;return}if(a==="AXIS"){a in r||(r[a]=[]),r[a].push(t);return}Array.isArray(a)||(r[a]={});var h;switch(a){case"UNIT":case"PRIMEM":case"VERT_DATUM":r[a]={name:t[0].toLowerCase(),convert:t[1]},t.length===3&&Dl(t[2],r[a]);return;case"SPHEROID":case"ELLIPSOID":r[a]={name:t[0],a:t[1],rf:t[2]},t.length===4&&Dl(t[3],r[a]);return;case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":t[0]=["name",t[0]],Uy(r,a,t);return;default:for(h=-1;++h<t.length;)if(!Array.isArray(t[h]))return Dl(t,r[a]);return Uy(r,a,t)}}var KI=.017453292519943295;function YI(t,r){var a=r[0],h=r[1];!(a in t)&&h in t&&(t[a]=t[h],r.length===3&&(t[a]=r[2](t[a])))}function Mn(t){return t*KI}function JI(t){if(t.type==="GEOGCS"?t.projName="longlat":t.type==="LOCAL_CS"?(t.projName="identity",t.local=!0):typeof t.PROJECTION=="object"?t.projName=Object.keys(t.PROJECTION)[0]:t.projName=t.PROJECTION,t.AXIS){for(var r="",a=0,h=t.AXIS.length;a<h;++a){var p=[t.AXIS[a][0].toLowerCase(),t.AXIS[a][1].toLowerCase()];p[0].indexOf("north")!==-1||(p[0]==="y"||p[0]==="lat")&&p[1]==="north"?r+="n":p[0].indexOf("south")!==-1||(p[0]==="y"||p[0]==="lat")&&p[1]==="south"?r+="s":p[0].indexOf("east")!==-1||(p[0]==="x"||p[0]==="lon")&&p[1]==="east"?r+="e":(p[0].indexOf("west")!==-1||(p[0]==="x"||p[0]==="lon")&&p[1]==="west")&&(r+="w")}r.length===2&&(r+="u"),r.length===3&&(t.axis=r)}t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),t.units==="metre"&&(t.units="meter"),t.UNIT.convert&&(t.type==="GEOGCS"?t.DATUM&&t.DATUM.SPHEROID&&(t.to_meter=t.UNIT.convert*t.DATUM.SPHEROID.a):t.to_meter=t.UNIT.convert));var _=t.GEOGCS;t.type==="GEOGCS"&&(_=t),_&&(_.DATUM?t.datumCode=_.DATUM.name.toLowerCase():t.datumCode=_.name.toLowerCase(),t.datumCode.slice(0,2)==="d_"&&(t.datumCode=t.datumCode.slice(2)),(t.datumCode==="new_zealand_geodetic_datum_1949"||t.datumCode==="new_zealand_1949")&&(t.datumCode="nzgd49"),(t.datumCode==="wgs_1984"||t.datumCode==="world_geodetic_system_1984")&&(t.PROJECTION==="Mercator_Auxiliary_Sphere"&&(t.sphere=!0),t.datumCode="wgs84"),t.datumCode.slice(-6)==="_ferro"&&(t.datumCode=t.datumCode.slice(0,-6)),t.datumCode.slice(-8)==="_jakarta"&&(t.datumCode=t.datumCode.slice(0,-8)),~t.datumCode.indexOf("belge")&&(t.datumCode="rnb72"),_.DATUM&&_.DATUM.SPHEROID&&(t.ellps=_.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),t.ellps.toLowerCase().slice(0,13)==="international"&&(t.ellps="intl"),t.a=_.DATUM.SPHEROID.a,t.rf=parseFloat(_.DATUM.SPHEROID.rf,10)),_.DATUM&&_.DATUM.TOWGS84&&(t.datum_params=_.DATUM.TOWGS84),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36"),~t.datumCode.indexOf("osni_1952")&&(t.datumCode="osni52"),(~t.datumCode.indexOf("tm65")||~t.datumCode.indexOf("geodetic_datum_of_1965"))&&(t.datumCode="ire65"),t.datumCode==="ch1903+"&&(t.datumCode="ch1903"),~t.datumCode.indexOf("israel")&&(t.datumCode="isr93")),t.b&&!isFinite(t.b)&&(t.b=t.a);function m(I){var R=t.to_meter||1;return I*R}var l=function(I){return YI(t,I)},T=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Mn],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Mn],["x0","false_easting",m],["y0","false_northing",m],["long0","central_meridian",Mn],["lat0","latitude_of_origin",Mn],["lat0","standard_parallel_1",Mn],["lat1","standard_parallel_1",Mn],["lat2","standard_parallel_2",Mn],["azimuth","Azimuth"],["alpha","azimuth",Mn],["srsCode","name"]];T.forEach(l),!t.long0&&t.longc&&(t.projName==="Albers_Conic_Equal_Area"||t.projName==="Lambert_Azimuthal_Equal_Area")&&(t.long0=t.longc),!t.lat_ts&&t.lat1&&(t.projName==="Stereographic_South_Pole"||t.projName==="Polar Stereographic (variant B)")?(t.lat0=Mn(t.lat1>0?90:-90),t.lat_ts=t.lat1):!t.lat_ts&&t.lat0&&t.projName==="Polar_Stereographic"&&(t.lat_ts=t.lat0,t.lat0=Mn(t.lat0>0?90:-90))}function fx(t){var r=XI(t),a=r.shift(),h=r.shift();r.unshift(["name",h]),r.unshift(["type",a]);var p={};return Dl(r,p),JI(p),p}function ur(t){var r=this;if(arguments.length===2){var a=arguments[1];typeof a=="string"?a.charAt(0)==="+"?ur[t]=cm(arguments[1]):ur[t]=fx(arguments[1]):ur[t]=a}else if(arguments.length===1){if(Array.isArray(t))return t.map(function(h){Array.isArray(h)?ur.apply(r,h):ur(h)});if(typeof t=="string"){if(t in ur)return ur[t]}else"EPSG"in t?ur["EPSG:"+t.EPSG]=t:"ESRI"in t?ur["ESRI:"+t.ESRI]=t:"IAU2000"in t?ur["IAU2000:"+t.IAU2000]=t:console.log(t);return}}NI(ur);function QI(t){return typeof t=="string"}function tP(t){return t in ur}var eP=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function iP(t){return eP.some(function(r){return t.indexOf(r)>-1})}var sP=["3857","900913","3785","102113"];function rP(t){var r=Fa(t,"authority");if(r){var a=Fa(r,"epsg");return a&&sP.indexOf(a)>-1}}function nP(t){var r=Fa(t,"extension");if(r)return Fa(r,"proj4")}function aP(t){return t[0]==="+"}function oP(t){if(QI(t)){if(tP(t))return ur[t];if(iP(t)){var r=fx(t);if(rP(r))return ur["EPSG:3857"];var a=nP(r);return a?cm(a):r}if(aP(t))return cm(t)}else return t}function qy(t,r){t=t||{};var a,h;if(!r)return t;for(h in r)a=r[h],a!==void 0&&(t[h]=a);return t}function Dn(t,r,a){var h=t*r;return a/Math.sqrt(1-h*h)}function qh(t){return t<0?-1:1}function _e(t){return Math.abs(t)<=_s?t:t-qh(t)*Dh}function on(t,r,a){var h=t*a,p=.5*t;return h=Math.pow((1-h)/(1+h),p),Math.tan(.5*(Zt-r))/h}function Rh(t,r){for(var a=.5*t,h,p,_=Zt-2*Math.atan(r),m=0;m<=15;m++)if(h=t*Math.sin(_),p=Zt-2*Math.atan(r*Math.pow((1-h)/(1+h),a))-_,_+=p,Math.abs(p)<=1e-10)return _;return-9999}function lP(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=Dn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function cP(t){var r=t.x,a=t.y;if(a*In>90&&a*In<-90&&r*In>180&&r*In<-180)return null;var h,p;if(Math.abs(Math.abs(a)-Zt)<=de)return null;if(this.sphere)h=this.x0+this.a*this.k0*_e(r-this.long0),p=this.y0+this.a*this.k0*Math.log(Math.tan(xi+.5*a));else{var _=Math.sin(a),m=on(this.e,a,_);h=this.x0+this.a*this.k0*_e(r-this.long0),p=this.y0-this.a*this.k0*Math.log(m)}return t.x=h,t.y=p,t}function hP(t){var r=t.x-this.x0,a=t.y-this.y0,h,p;if(this.sphere)p=Zt-2*Math.atan(Math.exp(-a/(this.a*this.k0)));else{var _=Math.exp(-a/(this.a*this.k0));if(p=Rh(this.e,_),p===-9999)return null}return h=_e(this.long0+r/(this.a*this.k0)),t.x=h,t.y=p,t}var uP=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];const dP={init:lP,forward:cP,inverse:hP,names:uP};function fP(){}function jy(t){return t}var pP=["longlat","identity"];const mP={init:fP,forward:jy,inverse:jy,names:pP};var gP=[dP,mP],yd={},kd=[];function px(t,r){var a=kd.length;return t.names?(kd[a]=t,t.names.forEach(function(h){yd[h.toLowerCase()]=a}),this):(console.log(r),!0)}function _P(t){if(!t)return!1;var r=t.toLowerCase();if(typeof yd[r]<"u"&&kd[yd[r]])return kd[yd[r]]}function yP(){gP.forEach(px)}const vP={start:yP,add:px,get:_P};var We={};We.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};We.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};We.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};We.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};We.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"};We.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};We.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};We.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"};We.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};We.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};We.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};We.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"};We.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};We.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"};We.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."};We.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"};We.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"};We.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};We.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};We.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"};We.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"};We.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"};We.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"};We.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"};We.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};We.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};We.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};We.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};We.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};We.hough={a:6378270,rf:297,ellipseName:"Hough"};We.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};We.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};We.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};We.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};We.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"};We.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};We.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};We.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"};We.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"};We.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};We.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};We.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var xP=We.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};We.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function bP(t,r,a,h){var p=t*t,_=r*r,m=(p-_)/p,l=0;h?(t*=1-m*(UI+m*(qI+m*jI)),p=t*t,m=0):l=Math.sqrt(m);var T=(p-_)/_;return{es:m,e:l,ep2:T}}function wP(t,r,a,h,p){if(!t){var _=Fa(We,h);_||(_=xP),t=_.a,r=_.b,a=_.rf}return a&&!r&&(r=(1-1/a)*t),(a===0||Math.abs(t-r)<de)&&(p=!0,r=t),{a:t,b:r,rf:a,sphere:p}}var Ts={};Ts.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"};Ts.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"};Ts.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"};Ts.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"};Ts.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"};Ts.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"};Ts.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"};Ts.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"};Ts.militargeographische_institut={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"};Ts.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"};Ts.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"};Ts.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"};Ts.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"};Ts.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"};Ts.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"};Ts.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"};Ts.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"};Ts.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};function MP(t,r,a,h,p,_,m){var l={};return t===void 0||t==="none"?l.datum_type=lm:l.datum_type=$I,r&&(l.datum_params=r.map(parseFloat),(l.datum_params[0]!==0||l.datum_params[1]!==0||l.datum_params[2]!==0)&&(l.datum_type=Mo),l.datum_params.length>3&&(l.datum_params[3]!==0||l.datum_params[4]!==0||l.datum_params[5]!==0||l.datum_params[6]!==0)&&(l.datum_type=So,l.datum_params[3]*=yh,l.datum_params[4]*=yh,l.datum_params[5]*=yh,l.datum_params[6]=l.datum_params[6]/1e6+1)),m&&(l.datum_type=Nl,l.grids=m),l.a=a,l.b=h,l.es=p,l.ep2=_,l}var mx={};function SP(t,r){var a=new DataView(r),h=EP(a),p=IP(a,h),_=PP(a,p,h),m={header:p,subgrids:_};return mx[t]=m,m}function TP(t){if(t===void 0)return null;var r=t.split(",");return r.map(AP)}function AP(t){if(t.length===0)return null;var r=t[0]==="@";return r&&(t=t.slice(1)),t==="null"?{name:"null",mandatory:!r,grid:null,isNull:!0}:{name:t,mandatory:!r,grid:mx[t]||null,isNull:!1}}function kl(t){return t/3600*Math.PI/180}function EP(t){var r=t.getInt32(8,!1);return r===11?!1:(r=t.getInt32(8,!0),r!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function IP(t,r){return{nFields:t.getInt32(8,r),nSubgridFields:t.getInt32(24,r),nSubgrids:t.getInt32(40,r),shiftType:hm(t,56,64).trim(),fromSemiMajorAxis:t.getFloat64(120,r),fromSemiMinorAxis:t.getFloat64(136,r),toSemiMajorAxis:t.getFloat64(152,r),toSemiMinorAxis:t.getFloat64(168,r)}}function hm(t,r,a){return String.fromCharCode.apply(null,new Uint8Array(t.buffer.slice(r,a)))}function PP(t,r,a){for(var h=176,p=[],_=0;_<r.nSubgrids;_++){var m=DP(t,h,a),l=kP(t,h,m,a),T=Math.round(1+(m.upperLongitude-m.lowerLongitude)/m.longitudeInterval),I=Math.round(1+(m.upperLatitude-m.lowerLatitude)/m.latitudeInterval);p.push({ll:[kl(m.lowerLongitude),kl(m.lowerLatitude)],del:[kl(m.longitudeInterval),kl(m.latitudeInterval)],lim:[T,I],count:m.gridNodeCount,cvs:CP(l)}),h+=176+m.gridNodeCount*16}return p}function CP(t){return t.map(function(r){return[kl(r.longitudeShift),kl(r.latitudeShift)]})}function DP(t,r,a){return{name:hm(t,r+8,r+16).trim(),parent:hm(t,r+24,r+24+8).trim(),lowerLatitude:t.getFloat64(r+72,a),upperLatitude:t.getFloat64(r+88,a),lowerLongitude:t.getFloat64(r+104,a),upperLongitude:t.getFloat64(r+120,a),latitudeInterval:t.getFloat64(r+136,a),longitudeInterval:t.getFloat64(r+152,a),gridNodeCount:t.getInt32(r+168,a)}}function kP(t,r,a,h){for(var p=r+176,_=16,m=[],l=0;l<a.gridNodeCount;l++){var T={latitudeShift:t.getFloat32(p+l*_,h),longitudeShift:t.getFloat32(p+l*_+4,h),latitudeAccuracy:t.getFloat32(p+l*_+8,h),longitudeAccuracy:t.getFloat32(p+l*_+12,h)};m.push(T)}return m}function Pn(t,r){if(!(this instanceof Pn))return new Pn(t);r=r||function(I){if(I)throw I};var a=oP(t);if(typeof a!="object"){r(t);return}var h=Pn.projections.get(a.projName);if(!h){r(t);return}if(a.datumCode&&a.datumCode!=="none"){var p=Fa(Ts,a.datumCode);p&&(a.datum_params=a.datum_params||(p.towgs84?p.towgs84.split(","):null),a.ellps=p.ellipse,a.datumName=p.datumName?p.datumName:a.datumCode)}a.k0=a.k0||1,a.axis=a.axis||"enu",a.ellps=a.ellps||"wgs84",a.lat1=a.lat1||a.lat0;var _=wP(a.a,a.b,a.rf,a.ellps,a.sphere),m=bP(_.a,_.b,_.rf,a.R_A),l=TP(a.nadgrids),T=a.datum||MP(a.datumCode,a.datum_params,_.a,_.b,m.es,m.ep2,l);qy(this,a),qy(this,h),this.a=_.a,this.b=_.b,this.rf=_.rf,this.sphere=_.sphere,this.es=m.es,this.e=m.e,this.ep2=m.ep2,this.datum=T,this.init(),r(null,this)}Pn.projections=vP;Pn.projections.start();function RP(t,r){return t.datum_type!==r.datum_type||t.a!==r.a||Math.abs(t.es-r.es)>5e-11?!1:t.datum_type===Mo?t.datum_params[0]===r.datum_params[0]&&t.datum_params[1]===r.datum_params[1]&&t.datum_params[2]===r.datum_params[2]:t.datum_type===So?t.datum_params[0]===r.datum_params[0]&&t.datum_params[1]===r.datum_params[1]&&t.datum_params[2]===r.datum_params[2]&&t.datum_params[3]===r.datum_params[3]&&t.datum_params[4]===r.datum_params[4]&&t.datum_params[5]===r.datum_params[5]&&t.datum_params[6]===r.datum_params[6]:!0}function gx(t,r,a){var h=t.x,p=t.y,_=t.z?t.z:0,m,l,T,I;if(p<-Zt&&p>-1.001*Zt)p=-Zt;else if(p>Zt&&p<1.001*Zt)p=Zt;else{if(p<-Zt)return{x:-1/0,y:-1/0,z:t.z};if(p>Zt)return{x:1/0,y:1/0,z:t.z}}return h>Math.PI&&(h-=2*Math.PI),l=Math.sin(p),I=Math.cos(p),T=l*l,m=a/Math.sqrt(1-r*T),{x:(m+_)*I*Math.cos(h),y:(m+_)*I*Math.sin(h),z:(m*(1-r)+_)*l}}function _x(t,r,a,h){var p=1e-12,_=p*p,m=30,l,T,I,R,P,L,K,tt,lt,vt,yt,Tt,ut,Dt=t.x,Ot=t.y,Ut=t.z?t.z:0,ce,te,fe;if(l=Math.sqrt(Dt*Dt+Ot*Ot),T=Math.sqrt(Dt*Dt+Ot*Ot+Ut*Ut),l/a<p){if(ce=0,T/a<p)return te=Zt,fe=-h,{x:t.x,y:t.y,z:t.z}}else ce=Math.atan2(Ot,Dt);I=Ut/T,R=l/T,P=1/Math.sqrt(1-r*(2-r)*R*R),tt=R*(1-r)*P,lt=I*P,ut=0;do ut++,K=a/Math.sqrt(1-r*lt*lt),fe=l*tt+Ut*lt-K*(1-r*lt*lt),L=r*K/(K+fe),P=1/Math.sqrt(1-L*(2-L)*R*R),vt=R*(1-L)*P,yt=I*P,Tt=yt*tt-vt*lt,tt=vt,lt=yt;while(Tt*Tt>_&&ut<m);return te=Math.atan(yt/Math.abs(vt)),{x:ce,y:te,z:fe}}function zP(t,r,a){if(r===Mo)return{x:t.x+a[0],y:t.y+a[1],z:t.z+a[2]};if(r===So){var h=a[0],p=a[1],_=a[2],m=a[3],l=a[4],T=a[5],I=a[6];return{x:I*(t.x-T*t.y+l*t.z)+h,y:I*(T*t.x+t.y-m*t.z)+p,z:I*(-l*t.x+m*t.y+t.z)+_}}}function LP(t,r,a){if(r===Mo)return{x:t.x-a[0],y:t.y-a[1],z:t.z-a[2]};if(r===So){var h=a[0],p=a[1],_=a[2],m=a[3],l=a[4],T=a[5],I=a[6],R=(t.x-h)/I,P=(t.y-p)/I,L=(t.z-_)/I;return{x:R+T*P-l*L,y:-T*R+P+m*L,z:l*R-m*P+L}}}function ad(t){return t===Mo||t===So}function OP(t,r,a){if(RP(t,r)||t.datum_type===lm||r.datum_type===lm)return a;var h=t.a,p=t.es;if(t.datum_type===Nl){var _=Gy(t,!1,a);if(_!==0)return;h=Ny,p=$y}var m=r.a,l=r.b,T=r.es;if(r.datum_type===Nl&&(m=Ny,l=VI,T=$y),p===T&&h===m&&!ad(t.datum_type)&&!ad(r.datum_type))return a;if(a=gx(a,p,h),ad(t.datum_type)&&(a=zP(a,t.datum_type,t.datum_params)),ad(r.datum_type)&&(a=LP(a,r.datum_type,r.datum_params)),a=_x(a,T,m,l),r.datum_type===Nl){var I=Gy(r,!0,a);if(I!==0)return}return a}function Gy(t,r,a){if(t.grids===null||t.grids.length===0)return console.log("Grid shift grids not found"),-1;var h={x:-a.x,y:a.y},p={x:Number.NaN,y:Number.NaN},_=[];t:for(var m=0;m<t.grids.length;m++){var l=t.grids[m];if(_.push(l.name),l.isNull){p=h;break}if(l.mandatory,l.grid===null){if(l.mandatory)return console.log("Unable to find mandatory grid '"+l.name+"'"),-1;continue}for(var T=l.grid.subgrids,I=0,R=T.length;I<R;I++){var P=T[I],L=(Math.abs(P.del[1])+Math.abs(P.del[0]))/1e4,K=P.ll[0]-L,tt=P.ll[1]-L,lt=P.ll[0]+(P.lim[0]-1)*P.del[0]+L,vt=P.ll[1]+(P.lim[1]-1)*P.del[1]+L;if(!(tt>h.y||K>h.x||vt<h.y||lt<h.x)&&(p=FP(h,r,P),!isNaN(p.x)))break t}}return isNaN(p.x)?(console.log("Failed to find a grid shift table for location '"+-h.x*In+" "+h.y*In+" tried: '"+_+"'"),-1):(a.x=-p.x,a.y=p.y,0)}function FP(t,r,a){var h={x:Number.NaN,y:Number.NaN};if(isNaN(t.x))return h;var p={x:t.x,y:t.y};p.x-=a.ll[0],p.y-=a.ll[1],p.x=_e(p.x-Math.PI)+Math.PI;var _=Hy(p,a);if(r){if(isNaN(_.x))return h;_.x=p.x-_.x,_.y=p.y-_.y;var m=9,l=1e-12,T,I;do{if(I=Hy(_,a),isNaN(I.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}T={x:p.x-(I.x+_.x),y:p.y-(I.y+_.y)},_.x+=T.x,_.y+=T.y}while(m--&&Math.abs(T.x)>l&&Math.abs(T.y)>l);if(m<0)return console.log("Inverse grid shift iterator failed to converge."),h;h.x=_e(_.x+a.ll[0]),h.y=_.y+a.ll[1]}else isNaN(_.x)||(h.x=t.x+_.x,h.y=t.y+_.y);return h}function Hy(t,r){var a={x:t.x/r.del[0],y:t.y/r.del[1]},h={x:Math.floor(a.x),y:Math.floor(a.y)},p={x:a.x-1*h.x,y:a.y-1*h.y},_={x:Number.NaN,y:Number.NaN},m;if(h.x<0||h.x>=r.lim[0]||h.y<0||h.y>=r.lim[1])return _;m=h.y*r.lim[0]+h.x;var l={x:r.cvs[m][0],y:r.cvs[m][1]};m++;var T={x:r.cvs[m][0],y:r.cvs[m][1]};m+=r.lim[0];var I={x:r.cvs[m][0],y:r.cvs[m][1]};m--;var R={x:r.cvs[m][0],y:r.cvs[m][1]},P=p.x*p.y,L=p.x*(1-p.y),K=(1-p.x)*(1-p.y),tt=(1-p.x)*p.y;return _.x=K*l.x+L*T.x+tt*R.x+P*I.x,_.y=K*l.y+L*T.y+tt*R.y+P*I.y,_}function Wy(t,r,a){var h=a.x,p=a.y,_=a.z||0,m,l,T,I={};for(T=0;T<3;T++)if(!(r&&T===2&&a.z===void 0))switch(T===0?(m=h,"ew".indexOf(t.axis[T])!==-1?l="x":l="y"):T===1?(m=p,"ns".indexOf(t.axis[T])!==-1?l="y":l="x"):(m=_,l="z"),t.axis[T]){case"e":I[l]=m;break;case"w":I[l]=-m;break;case"n":I[l]=m;break;case"s":I[l]=-m;break;case"u":a[l]!==void 0&&(I.z=m);break;case"d":a[l]!==void 0&&(I.z=-m);break;default:return null}return I}function yx(t){var r={x:t[0],y:t[1]};return t.length>2&&(r.z=t[2]),t.length>3&&(r.m=t[3]),r}function BP(t){Zy(t.x),Zy(t.y)}function Zy(t){if(typeof Number.isFinite=="function"){if(Number.isFinite(t))return;throw new TypeError("coordinates must be finite numbers")}if(typeof t!="number"||t!==t||!isFinite(t))throw new TypeError("coordinates must be finite numbers")}function NP(t,r){return(t.datum.datum_type===Mo||t.datum.datum_type===So||t.datum.datum_type===Nl)&&r.datumCode!=="WGS84"||(r.datum.datum_type===Mo||r.datum.datum_type===So||r.datum.datum_type===Nl)&&t.datumCode!=="WGS84"}function Rd(t,r,a,h){var p;Array.isArray(a)?a=yx(a):a={x:a.x,y:a.y,z:a.z,m:a.m};var _=a.z!==void 0;if(BP(a),t.datum&&r.datum&&NP(t,r)&&(p=new Pn("WGS84"),a=Rd(t,p,a,h),t=p),h&&t.axis!=="enu"&&(a=Wy(t,!1,a)),t.projName==="longlat")a={x:a.x*$s,y:a.y*$s,z:a.z||0};else if(t.to_meter&&(a={x:a.x*t.to_meter,y:a.y*t.to_meter,z:a.z||0}),a=t.inverse(a),!a)return;if(t.from_greenwich&&(a.x+=t.from_greenwich),a=OP(t.datum,r.datum,a),!!a)return r.from_greenwich&&(a={x:a.x-r.from_greenwich,y:a.y,z:a.z||0}),r.projName==="longlat"?a={x:a.x*In,y:a.y*In,z:a.z||0}:(a=r.forward(a),r.to_meter&&(a={x:a.x/r.to_meter,y:a.y/r.to_meter,z:a.z||0})),h&&r.axis!=="enu"?Wy(r,!0,a):(a&&!_&&delete a.z,a)}var Xy=Pn("WGS84");function Op(t,r,a,h){var p,_,m;return Array.isArray(a)?(p=Rd(t,r,a,h)||{x:NaN,y:NaN},a.length>2?typeof t.name<"u"&&t.name==="geocent"||typeof r.name<"u"&&r.name==="geocent"?typeof p.z=="number"?[p.x,p.y,p.z].concat(a.splice(3)):[p.x,p.y,a[2]].concat(a.splice(3)):[p.x,p.y].concat(a.splice(2)):[p.x,p.y]):(_=Rd(t,r,a,h),m=Object.keys(a),m.length===2||m.forEach(function(l){if(typeof t.name<"u"&&t.name==="geocent"||typeof r.name<"u"&&r.name==="geocent"){if(l==="x"||l==="y"||l==="z")return}else if(l==="x"||l==="y")return;_[l]=a[l]}),_)}function Ky(t){return t instanceof Pn?t:t.oProj?t.oProj:Pn(t)}function Lr(t,r,a){t=Ky(t);var h=!1,p;return typeof r>"u"?(r=t,t=Xy,h=!0):(typeof r.x<"u"||Array.isArray(r))&&(a=r,r=t,t=Xy,h=!0),r=Ky(r),a?Op(t,r,a):(p={forward:function(_,m){return Op(t,r,_,m)},inverse:function(_,m){return Op(r,t,_,m)}},h&&(p.oProj=r),p)}var Yy=6,vx="AJSAJS",xx="AFAFAF",Rl=65,br=73,Gr=79,oh=86,lh=90;const $P={forward:bx,inverse:VP,toPoint:wx};function bx(t,r){return r=r||5,jP(UP({lat:t[1],lon:t[0]}),r)}function VP(t){var r=qm(Sx(t.toUpperCase()));return r.lat&&r.lon?[r.lon,r.lat,r.lon,r.lat]:[r.left,r.bottom,r.right,r.top]}function wx(t){var r=qm(Sx(t.toUpperCase()));return r.lat&&r.lon?[r.lon,r.lat]:[(r.left+r.right)/2,(r.top+r.bottom)/2]}function Fp(t){return t*(Math.PI/180)}function Jy(t){return 180*(t/Math.PI)}function UP(t){var r=t.lat,a=t.lon,h=6378137,p=.00669438,_=.9996,m,l,T,I,R,P,L,K=Fp(r),tt=Fp(a),lt,vt;vt=Math.floor((a+180)/6)+1,a===180&&(vt=60),r>=56&&r<64&&a>=3&&a<12&&(vt=32),r>=72&&r<84&&(a>=0&&a<9?vt=31:a>=9&&a<21?vt=33:a>=21&&a<33?vt=35:a>=33&&a<42&&(vt=37)),m=(vt-1)*6-180+3,lt=Fp(m),l=p/(1-p),T=h/Math.sqrt(1-p*Math.sin(K)*Math.sin(K)),I=Math.tan(K)*Math.tan(K),R=l*Math.cos(K)*Math.cos(K),P=Math.cos(K)*(tt-lt),L=h*((1-p/4-3*p*p/64-5*p*p*p/256)*K-(3*p/8+3*p*p/32+45*p*p*p/1024)*Math.sin(2*K)+(15*p*p/256+45*p*p*p/1024)*Math.sin(4*K)-35*p*p*p/3072*Math.sin(6*K));var yt=_*T*(P+(1-I+R)*P*P*P/6+(5-18*I+I*I+72*R-58*l)*P*P*P*P*P/120)+5e5,Tt=_*(L+T*Math.tan(K)*(P*P/2+(5-I+9*R+4*R*R)*P*P*P*P/24+(61-58*I+I*I+600*R-330*l)*P*P*P*P*P*P/720));return r<0&&(Tt+=1e7),{northing:Math.round(Tt),easting:Math.round(yt),zoneNumber:vt,zoneLetter:qP(r)}}function qm(t){var r=t.northing,a=t.easting,h=t.zoneLetter,p=t.zoneNumber;if(p<0||p>60)return null;var _=.9996,m=6378137,l=.00669438,T,I=(1-Math.sqrt(1-l))/(1+Math.sqrt(1-l)),R,P,L,K,tt,lt,vt,yt,Tt,ut=a-5e5,Dt=r;h<"N"&&(Dt-=1e7),vt=(p-1)*6-180+3,T=l/(1-l),lt=Dt/_,yt=lt/(m*(1-l/4-3*l*l/64-5*l*l*l/256)),Tt=yt+(3*I/2-27*I*I*I/32)*Math.sin(2*yt)+(21*I*I/16-55*I*I*I*I/32)*Math.sin(4*yt)+151*I*I*I/96*Math.sin(6*yt),R=m/Math.sqrt(1-l*Math.sin(Tt)*Math.sin(Tt)),P=Math.tan(Tt)*Math.tan(Tt),L=T*Math.cos(Tt)*Math.cos(Tt),K=m*(1-l)/Math.pow(1-l*Math.sin(Tt)*Math.sin(Tt),1.5),tt=ut/(R*_);var Ot=Tt-R*Math.tan(Tt)/K*(tt*tt/2-(5+3*P+10*L-4*L*L-9*T)*tt*tt*tt*tt/24+(61+90*P+298*L+45*P*P-252*T-3*L*L)*tt*tt*tt*tt*tt*tt/720);Ot=Jy(Ot);var Ut=(tt-(1+2*P+L)*tt*tt*tt/6+(5-2*L+28*P-3*L*L+8*T+24*P*P)*tt*tt*tt*tt*tt/120)/Math.cos(Tt);Ut=vt+Jy(Ut);var ce;if(t.accuracy){var te=qm({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});ce={top:te.lat,right:te.lon,bottom:Ot,left:Ut}}else ce={lat:Ot,lon:Ut};return ce}function qP(t){var r="Z";return 84>=t&&t>=72?r="X":72>t&&t>=64?r="W":64>t&&t>=56?r="V":56>t&&t>=48?r="U":48>t&&t>=40?r="T":40>t&&t>=32?r="S":32>t&&t>=24?r="R":24>t&&t>=16?r="Q":16>t&&t>=8?r="P":8>t&&t>=0?r="N":0>t&&t>=-8?r="M":-8>t&&t>=-16?r="L":-16>t&&t>=-24?r="K":-24>t&&t>=-32?r="J":-32>t&&t>=-40?r="H":-40>t&&t>=-48?r="G":-48>t&&t>=-56?r="F":-56>t&&t>=-64?r="E":-64>t&&t>=-72?r="D":-72>t&&t>=-80&&(r="C"),r}function jP(t,r){var a="00000"+t.easting,h="00000"+t.northing;return t.zoneNumber+t.zoneLetter+GP(t.easting,t.northing,t.zoneNumber)+a.substr(a.length-5,r)+h.substr(h.length-5,r)}function GP(t,r,a){var h=Mx(a),p=Math.floor(t/1e5),_=Math.floor(r/1e5)%20;return HP(p,_,h)}function Mx(t){var r=t%Yy;return r===0&&(r=Yy),r}function HP(t,r,a){var h=a-1,p=vx.charCodeAt(h),_=xx.charCodeAt(h),m=p+t-1,l=_+r,T=!1;m>lh&&(m=m-lh+Rl-1,T=!0),(m===br||p<br&&m>br||(m>br||p<br)&&T)&&m++,(m===Gr||p<Gr&&m>Gr||(m>Gr||p<Gr)&&T)&&(m++,m===br&&m++),m>lh&&(m=m-lh+Rl-1),l>oh?(l=l-oh+Rl-1,T=!0):T=!1,(l===br||_<br&&l>br||(l>br||_<br)&&T)&&l++,(l===Gr||_<Gr&&l>Gr||(l>Gr||_<Gr)&&T)&&(l++,l===br&&l++),l>oh&&(l=l-oh+Rl-1);var I=String.fromCharCode(m)+String.fromCharCode(l);return I}function Sx(t){if(t&&t.length===0)throw"MGRSPoint coverting from nothing";for(var r=t.length,a=null,h="",p,_=0;!/[A-Z]/.test(p=t.charAt(_));){if(_>=2)throw"MGRSPoint bad conversion from: "+t;h+=p,_++}var m=parseInt(h,10);if(_===0||_+3>r)throw"MGRSPoint bad conversion from: "+t;var l=t.charAt(_++);if(l<="A"||l==="B"||l==="Y"||l>="Z"||l==="I"||l==="O")throw"MGRSPoint zone letter "+l+" not handled: "+t;a=t.substring(_,_+=2);for(var T=Mx(m),I=WP(a.charAt(0),T),R=ZP(a.charAt(1),T);R<XP(l);)R+=2e6;var P=r-_;if(P%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+t;var L=P/2,K=0,tt=0,lt,vt,yt,Tt,ut;return L>0&&(lt=1e5/Math.pow(10,L),vt=t.substring(_,_+L),K=parseFloat(vt)*lt,yt=t.substring(_+L),tt=parseFloat(yt)*lt),Tt=K+I,ut=tt+R,{easting:Tt,northing:ut,zoneLetter:l,zoneNumber:m,accuracy:lt}}function WP(t,r){for(var a=vx.charCodeAt(r-1),h=1e5,p=!1;a!==t.charCodeAt(0);){if(a++,a===br&&a++,a===Gr&&a++,a>lh){if(p)throw"Bad character: "+t;a=Rl,p=!0}h+=1e5}return h}function ZP(t,r){if(t>"V")throw"MGRSPoint given invalid Northing "+t;for(var a=xx.charCodeAt(r-1),h=0,p=!1;a!==t.charCodeAt(0);){if(a++,a===br&&a++,a===Gr&&a++,a>oh){if(p)throw"Bad character: "+t;a=Rl,p=!0}h+=1e5}return h}function XP(t){var r;switch(t){case"C":r=11e5;break;case"D":r=2e6;break;case"E":r=28e5;break;case"F":r=37e5;break;case"G":r=46e5;break;case"H":r=55e5;break;case"J":r=64e5;break;case"K":r=73e5;break;case"L":r=82e5;break;case"M":r=91e5;break;case"N":r=0;break;case"P":r=8e5;break;case"Q":r=17e5;break;case"R":r=26e5;break;case"S":r=35e5;break;case"T":r=44e5;break;case"U":r=53e5;break;case"V":r=62e5;break;case"W":r=7e6;break;case"X":r=79e5;break;default:r=-1}if(r>=0)return r;throw"Invalid zone letter: "+t}function Hl(t,r,a){if(!(this instanceof Hl))return new Hl(t,r,a);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if(typeof t=="object")this.x=t.x,this.y=t.y,this.z=t.z||0;else if(typeof t=="string"&&typeof r>"u"){var h=t.split(",");this.x=parseFloat(h[0],10),this.y=parseFloat(h[1],10),this.z=parseFloat(h[2],10)||0}else this.x=t,this.y=r,this.z=a||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}Hl.fromMGRS=function(t){return new Hl(wx(t))};Hl.prototype.toMGRS=function(t){return bx([this.x,this.y],t)};var KP=1,YP=.25,Qy=.046875,t0=.01953125,e0=.01068115234375,JP=.75,QP=.46875,tC=.013020833333333334,eC=.007120768229166667,iC=.3645833333333333,sC=.005696614583333333,rC=.3076171875;function Tx(t){var r=[];r[0]=KP-t*(YP+t*(Qy+t*(t0+t*e0))),r[1]=t*(JP-t*(Qy+t*(t0+t*e0)));var a=t*t;return r[2]=a*(QP-t*(tC+t*eC)),a*=t,r[3]=a*(iC-t*sC),r[4]=a*t*rC,r}function df(t,r,a,h){return a*=r,r*=r,h[0]*t-a*(h[1]+r*(h[2]+r*(h[3]+r*h[4])))}var nC=20;function Ax(t,r,a){for(var h=1/(1-r),p=t,_=nC;_;--_){var m=Math.sin(p),l=1-r*m*m;if(l=(df(p,m,Math.cos(p),a)-t)*(l*Math.sqrt(l))*h,p-=l,Math.abs(l)<de)return p}return p}function aC(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=Tx(this.es),this.ml0=df(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function oC(t){var r=t.x,a=t.y,h=_e(r-this.long0),p,_,m,l=Math.sin(a),T=Math.cos(a);if(this.es){var R=T*h,P=Math.pow(R,2),L=this.ep2*Math.pow(T,2),K=Math.pow(L,2),tt=Math.abs(T)>de?Math.tan(a):0,lt=Math.pow(tt,2),vt=Math.pow(lt,2);p=1-this.es*Math.pow(l,2),R=R/Math.sqrt(p);var yt=df(a,l,T,this.en);_=this.a*(this.k0*R*(1+P/6*(1-lt+L+P/20*(5-18*lt+vt+14*L-58*lt*L+P/42*(61+179*vt-vt*lt-479*lt)))))+this.x0,m=this.a*(this.k0*(yt-this.ml0+l*h*R/2*(1+P/12*(5-lt+9*L+4*K+P/30*(61+vt-58*lt+270*L-330*lt*L+P/56*(1385+543*vt-vt*lt-3111*lt))))))+this.y0}else{var I=T*Math.sin(h);if(Math.abs(Math.abs(I)-1)<de)return 93;if(_=.5*this.a*this.k0*Math.log((1+I)/(1-I))+this.x0,m=T*Math.cos(h)/Math.sqrt(1-Math.pow(I,2)),I=Math.abs(m),I>=1){if(I-1>de)return 93;m=0}else m=Math.acos(m);a<0&&(m=-m),m=this.a*this.k0*(m-this.lat0)+this.y0}return t.x=_,t.y=m,t}function lC(t){var r,a,h,p,_=(t.x-this.x0)*(1/this.a),m=(t.y-this.y0)*(1/this.a);if(this.es)if(r=this.ml0+m/this.k0,a=Ax(r,this.es,this.en),Math.abs(a)<Zt){var P=Math.sin(a),L=Math.cos(a),K=Math.abs(L)>de?Math.tan(a):0,tt=this.ep2*Math.pow(L,2),lt=Math.pow(tt,2),vt=Math.pow(K,2),yt=Math.pow(vt,2);r=1-this.es*Math.pow(P,2);var Tt=_*Math.sqrt(r)/this.k0,ut=Math.pow(Tt,2);r=r*K,h=a-r*ut/(1-this.es)*.5*(1-ut/12*(5+3*vt-9*tt*vt+tt-4*lt-ut/30*(61+90*vt-252*tt*vt+45*yt+46*tt-ut/56*(1385+3633*vt+4095*yt+1574*yt*vt)))),p=_e(this.long0+Tt*(1-ut/6*(1+2*vt+tt-ut/20*(5+28*vt+24*yt+8*tt*vt+6*tt-ut/42*(61+662*vt+1320*yt+720*yt*vt))))/L)}else h=Zt*qh(m),p=0;else{var l=Math.exp(_/this.k0),T=.5*(l-1/l),I=this.lat0+m/this.k0,R=Math.cos(I);r=Math.sqrt((1-Math.pow(R,2))/(1+Math.pow(T,2))),h=Math.asin(r),m<0&&(h=-h),T===0&&R===0?p=0:p=_e(Math.atan2(T,R)+this.long0)}return t.x=p,t.y=h,t}var cC=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const vd={init:aC,forward:oC,inverse:lC,names:cC};function Ex(t){var r=Math.exp(t);return r=(r-1/r)/2,r}function Hr(t,r){t=Math.abs(t),r=Math.abs(r);var a=Math.max(t,r),h=Math.min(t,r)/(a||1);return a*Math.sqrt(1+Math.pow(h,2))}function hC(t){var r=1+t,a=r-1;return a===0?t:t*Math.log(r)/a}function uC(t){var r=Math.abs(t);return r=hC(r*(1+r/(Hr(1,r)+1))),t<0?-r:r}function jm(t,r){for(var a=2*Math.cos(2*r),h=t.length-1,p=t[h],_=0,m;--h>=0;)m=-_+a*p+t[h],_=p,p=m;return r+m*Math.sin(2*r)}function dC(t,r){for(var a=2*Math.cos(r),h=t.length-1,p=t[h],_=0,m;--h>=0;)m=-_+a*p+t[h],_=p,p=m;return Math.sin(r)*m}function fC(t){var r=Math.exp(t);return r=(r+1/r)/2,r}function Ix(t,r,a){for(var h=Math.sin(r),p=Math.cos(r),_=Ex(a),m=fC(a),l=2*p*m,T=-2*h*_,I=t.length-1,R=t[I],P=0,L=0,K=0,tt,lt;--I>=0;)tt=L,lt=P,L=R,P=K,R=-tt+l*L-T*P+t[I],K=-lt+T*L+l*P;return l=h*m,T=p*_,[l*R-T*K,l*K+T*R]}function pC(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(vd.init.apply(this),this.forward=vd.forward,this.inverse=vd.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var t=this.es/(1+Math.sqrt(1-this.es)),r=t/(2-t),a=r;this.cgb[0]=r*(2+r*(-2/3+r*(-2+r*(116/45+r*(26/45+r*(-2854/675)))))),this.cbg[0]=r*(-2+r*(2/3+r*(4/3+r*(-82/45+r*(32/45+r*(4642/4725)))))),a=a*r,this.cgb[1]=a*(7/3+r*(-8/5+r*(-227/45+r*(2704/315+r*(2323/945))))),this.cbg[1]=a*(5/3+r*(-16/15+r*(-13/9+r*(904/315+r*(-1522/945))))),a=a*r,this.cgb[2]=a*(56/15+r*(-136/35+r*(-1262/105+r*(73814/2835)))),this.cbg[2]=a*(-26/15+r*(34/21+r*(8/5+r*(-12686/2835)))),a=a*r,this.cgb[3]=a*(4279/630+r*(-332/35+r*(-399572/14175))),this.cbg[3]=a*(1237/630+r*(-12/5+r*(-24832/14175))),a=a*r,this.cgb[4]=a*(4174/315+r*(-144838/6237)),this.cbg[4]=a*(-734/315+r*(109598/31185)),a=a*r,this.cgb[5]=a*(601676/22275),this.cbg[5]=a*(444337/155925),a=Math.pow(r,2),this.Qn=this.k0/(1+r)*(1+a*(1/4+a*(1/64+a/256))),this.utg[0]=r*(-.5+r*(2/3+r*(-37/96+r*(1/360+r*(81/512+r*(-96199/604800)))))),this.gtu[0]=r*(.5+r*(-2/3+r*(5/16+r*(41/180+r*(-127/288+r*(7891/37800)))))),this.utg[1]=a*(-1/48+r*(-1/15+r*(437/1440+r*(-46/105+r*(1118711/3870720))))),this.gtu[1]=a*(13/48+r*(-3/5+r*(557/1440+r*(281/630+r*(-1983433/1935360))))),a=a*r,this.utg[2]=a*(-17/480+r*(37/840+r*(209/4480+r*(-5569/90720)))),this.gtu[2]=a*(61/240+r*(-103/140+r*(15061/26880+r*(167603/181440)))),a=a*r,this.utg[3]=a*(-4397/161280+r*(11/504+r*(830251/7257600))),this.gtu[3]=a*(49561/161280+r*(-179/168+r*(6601661/7257600))),a=a*r,this.utg[4]=a*(-4583/161280+r*(108847/3991680)),this.gtu[4]=a*(34729/80640+r*(-3418889/1995840)),a=a*r,this.utg[5]=a*(-20648693/638668800),this.gtu[5]=a*(212378941/319334400);var h=jm(this.cbg,this.lat0);this.Zb=-this.Qn*(h+dC(this.gtu,2*h))}function mC(t){var r=_e(t.x-this.long0),a=t.y;a=jm(this.cbg,a);var h=Math.sin(a),p=Math.cos(a),_=Math.sin(r),m=Math.cos(r);a=Math.atan2(h,m*p),r=Math.atan2(_*p,Hr(h,p*m)),r=uC(Math.tan(r));var l=Ix(this.gtu,2*a,2*r);a=a+l[0],r=r+l[1];var T,I;return Math.abs(r)<=2.623395162778?(T=this.a*(this.Qn*r)+this.x0,I=this.a*(this.Qn*a+this.Zb)+this.y0):(T=1/0,I=1/0),t.x=T,t.y=I,t}function gC(t){var r=(t.x-this.x0)*(1/this.a),a=(t.y-this.y0)*(1/this.a);a=(a-this.Zb)/this.Qn,r=r/this.Qn;var h,p;if(Math.abs(r)<=2.623395162778){var _=Ix(this.utg,2*a,2*r);a=a+_[0],r=r+_[1],r=Math.atan(Ex(r));var m=Math.sin(a),l=Math.cos(a),T=Math.sin(r),I=Math.cos(r);a=Math.atan2(m*I,Hr(T,I*l)),r=Math.atan2(T,I*l),h=_e(r+this.long0),p=jm(this.cgb,a)}else h=1/0,p=1/0;return t.x=h,t.y=p,t}var _C=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const xd={init:pC,forward:mC,inverse:gC,names:_C};function yC(t,r){if(t===void 0){if(t=Math.floor((_e(r)+Math.PI)*30/Math.PI)+1,t<0)return 0;if(t>60)return 60}return t}var vC="etmerc";function xC(){var t=yC(this.zone,this.long0);if(t===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(t)-183)*$s,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,xd.init.apply(this),this.forward=xd.forward,this.inverse=xd.inverse}var bC=["Universal Transverse Mercator System","utm"];const wC={init:xC,names:bC,dependsOn:vC};function Gm(t,r){return Math.pow((1-t)/(1+t),r)}var MC=20;function SC(){var t=Math.sin(this.lat0),r=Math.cos(this.lat0);r*=r,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*r*r/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+xi)/(Math.pow(Math.tan(.5*this.lat0+xi),this.C)*Gm(this.e*t,this.ratexp))}function TC(t){var r=t.x,a=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*a+xi),this.C)*Gm(this.e*Math.sin(a),this.ratexp))-Zt,t.x=this.C*r,t}function AC(t){for(var r=1e-14,a=t.x/this.C,h=t.y,p=Math.pow(Math.tan(.5*h+xi)/this.K,1/this.C),_=MC;_>0&&(h=2*Math.atan(p*Gm(this.e*Math.sin(t.y),-.5*this.e))-Zt,!(Math.abs(h-t.y)<r));--_)t.y=h;return _?(t.x=a,t.y=h,t):null}var EC=["gauss"];const Hm={init:SC,forward:TC,inverse:AC,names:EC};function IC(){Hm.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function PC(t){var r,a,h,p;return t.x=_e(t.x-this.long0),Hm.forward.apply(this,[t]),r=Math.sin(t.y),a=Math.cos(t.y),h=Math.cos(t.x),p=this.k0*this.R2/(1+this.sinc0*r+this.cosc0*a*h),t.x=p*a*Math.sin(t.x),t.y=p*(this.cosc0*r-this.sinc0*a*h),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t}function CC(t){var r,a,h,p,_;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,_=Hr(t.x,t.y)){var m=2*Math.atan2(_,this.R2);r=Math.sin(m),a=Math.cos(m),p=Math.asin(a*this.sinc0+t.y*r*this.cosc0/_),h=Math.atan2(t.x*r,_*this.cosc0*a-t.y*this.sinc0*r)}else p=this.phic0,h=0;return t.x=h,t.y=p,Hm.inverse.apply(this,[t]),t.x=_e(t.x+this.long0),t}var DC=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const kC={init:IC,forward:PC,inverse:CC,names:DC};function RC(t,r,a){return r*=a,Math.tan(.5*(Zt+t))*Math.pow((1-r)/(1+r),.5*a)}function zC(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=de&&(this.k0=.5*(1+qh(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=de&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=de&&Math.abs(Math.cos(this.lat_ts))>de&&(this.k0=.5*this.cons*Dn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/on(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=Dn(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-Zt,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function LC(t){var r=t.x,a=t.y,h=Math.sin(a),p=Math.cos(a),_,m,l,T,I,R,P=_e(r-this.long0);return Math.abs(Math.abs(r-this.long0)-Math.PI)<=de&&Math.abs(a+this.lat0)<=de?(t.x=NaN,t.y=NaN,t):this.sphere?(_=2*this.k0/(1+this.sinlat0*h+this.coslat0*p*Math.cos(P)),t.x=this.a*_*p*Math.sin(P)+this.x0,t.y=this.a*_*(this.coslat0*h-this.sinlat0*p*Math.cos(P))+this.y0,t):(m=2*Math.atan(this.ssfn_(a,h,this.e))-Zt,T=Math.cos(m),l=Math.sin(m),Math.abs(this.coslat0)<=de?(I=on(this.e,a*this.con,this.con*h),R=2*this.a*this.k0*I/this.cons,t.x=this.x0+R*Math.sin(r-this.long0),t.y=this.y0-this.con*R*Math.cos(r-this.long0),t):(Math.abs(this.sinlat0)<de?(_=2*this.a*this.k0/(1+T*Math.cos(P)),t.y=_*l):(_=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*l+this.cosX0*T*Math.cos(P))),t.y=_*(this.cosX0*l-this.sinX0*T*Math.cos(P))+this.y0),t.x=_*T*Math.sin(P)+this.x0,t))}function OC(t){t.x-=this.x0,t.y-=this.y0;var r,a,h,p,_,m=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var l=2*Math.atan(m/(2*this.a*this.k0));return r=this.long0,a=this.lat0,m<=de?(t.x=r,t.y=a,t):(a=Math.asin(Math.cos(l)*this.sinlat0+t.y*Math.sin(l)*this.coslat0/m),Math.abs(this.coslat0)<de?this.lat0>0?r=_e(this.long0+Math.atan2(t.x,-1*t.y)):r=_e(this.long0+Math.atan2(t.x,t.y)):r=_e(this.long0+Math.atan2(t.x*Math.sin(l),m*this.coslat0*Math.cos(l)-t.y*this.sinlat0*Math.sin(l))),t.x=r,t.y=a,t)}else if(Math.abs(this.coslat0)<=de){if(m<=de)return a=this.lat0,r=this.long0,t.x=r,t.y=a,t;t.x*=this.con,t.y*=this.con,h=m*this.cons/(2*this.a*this.k0),a=this.con*Rh(this.e,h),r=this.con*_e(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else p=2*Math.atan(m*this.cosX0/(2*this.a*this.k0*this.ms1)),r=this.long0,m<=de?_=this.X0:(_=Math.asin(Math.cos(p)*this.sinX0+t.y*Math.sin(p)*this.cosX0/m),r=_e(this.long0+Math.atan2(t.x*Math.sin(p),m*this.cosX0*Math.cos(p)-t.y*this.sinX0*Math.sin(p)))),a=-1*Rh(this.e,Math.tan(.5*(Zt+_)));return t.x=r,t.y=a,t}var FC=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"];const BC={init:zC,forward:LC,inverse:OC,names:FC,ssfn_:RC};function NC(){var t=this.lat0;this.lambda0=this.long0;var r=Math.sin(t),a=this.a,h=this.rf,p=1/h,_=2*p-Math.pow(p,2),m=this.e=Math.sqrt(_);this.R=this.k0*a*Math.sqrt(1-_)/(1-_*Math.pow(r,2)),this.alpha=Math.sqrt(1+_/(1-_)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(r/this.alpha);var l=Math.log(Math.tan(Math.PI/4+this.b0/2)),T=Math.log(Math.tan(Math.PI/4+t/2)),I=Math.log((1+m*r)/(1-m*r));this.K=l-this.alpha*T+this.alpha*m/2*I}function $C(t){var r=Math.log(Math.tan(Math.PI/4-t.y/2)),a=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),h=-this.alpha*(r+a)+this.K,p=2*(Math.atan(Math.exp(h))-Math.PI/4),_=this.alpha*(t.x-this.lambda0),m=Math.atan(Math.sin(_)/(Math.sin(this.b0)*Math.tan(p)+Math.cos(this.b0)*Math.cos(_))),l=Math.asin(Math.cos(this.b0)*Math.sin(p)-Math.sin(this.b0)*Math.cos(p)*Math.cos(_));return t.y=this.R/2*Math.log((1+Math.sin(l))/(1-Math.sin(l)))+this.y0,t.x=this.R*m+this.x0,t}function VC(t){for(var r=t.x-this.x0,a=t.y-this.y0,h=r/this.R,p=2*(Math.atan(Math.exp(a/this.R))-Math.PI/4),_=Math.asin(Math.cos(this.b0)*Math.sin(p)+Math.sin(this.b0)*Math.cos(p)*Math.cos(h)),m=Math.atan(Math.sin(h)/(Math.cos(this.b0)*Math.cos(h)-Math.sin(this.b0)*Math.tan(p))),l=this.lambda0+m/this.alpha,T=0,I=_,R=-1e3,P=0;Math.abs(I-R)>1e-7;){if(++P>20)return;T=1/this.alpha*(Math.log(Math.tan(Math.PI/4+_/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(I))/2)),R=I,I=2*Math.atan(Math.exp(T))-Math.PI/2}return t.x=l,t.y=I,t}var UC=["somerc"];const qC={init:NC,forward:$C,inverse:VC,names:UC};var Cl=1e-7;function jC(t){var r=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],a=typeof t.PROJECTION=="object"?Object.keys(t.PROJECTION)[0]:t.PROJECTION;return"no_uoff"in t||"no_off"in t||r.indexOf(a)!==-1}function GC(){var t,r,a,h,p,_,m,l,T,I,R=0,P,L=0,K=0,tt=0,lt=0,vt=0,yt=0;this.no_off=jC(this),this.no_rot="no_rot"in this;var Tt=!1;"alpha"in this&&(Tt=!0);var ut=!1;if("rectified_grid_angle"in this&&(ut=!0),Tt&&(yt=this.alpha),ut&&(R=this.rectified_grid_angle*$s),Tt||ut)L=this.longc;else if(K=this.long1,lt=this.lat1,tt=this.long2,vt=this.lat2,Math.abs(lt-vt)<=Cl||(t=Math.abs(lt))<=Cl||Math.abs(t-Zt)<=Cl||Math.abs(Math.abs(this.lat0)-Zt)<=Cl||Math.abs(Math.abs(vt)-Zt)<=Cl)throw new Error;var Dt=1-this.es;r=Math.sqrt(Dt),Math.abs(this.lat0)>de?(l=Math.sin(this.lat0),a=Math.cos(this.lat0),t=1-this.es*l*l,this.B=a*a,this.B=Math.sqrt(1+this.es*this.B*this.B/Dt),this.A=this.B*this.k0*r/t,h=this.B*r/(a*Math.sqrt(t)),p=h*h-1,p<=0?p=0:(p=Math.sqrt(p),this.lat0<0&&(p=-p)),this.E=p+=h,this.E*=Math.pow(on(this.e,this.lat0,l),this.B)):(this.B=1/r,this.A=this.k0,this.E=h=p=1),Tt||ut?(Tt?(P=Math.asin(Math.sin(yt)/h),ut||(R=yt)):(P=R,yt=Math.asin(h*Math.sin(P))),this.lam0=L-Math.asin(.5*(p-1/p)*Math.tan(P))/this.B):(_=Math.pow(on(this.e,lt,Math.sin(lt)),this.B),m=Math.pow(on(this.e,vt,Math.sin(vt)),this.B),p=this.E/_,T=(m-_)/(m+_),I=this.E*this.E,I=(I-m*_)/(I+m*_),t=K-tt,t<-Math.pi?tt-=Dh:t>Math.pi&&(tt+=Dh),this.lam0=_e(.5*(K+tt)-Math.atan(I*Math.tan(.5*this.B*(K-tt))/T)/this.B),P=Math.atan(2*Math.sin(this.B*_e(K-this.lam0))/(p-1/p)),R=yt=Math.asin(h*Math.sin(P))),this.singam=Math.sin(P),this.cosgam=Math.cos(P),this.sinrot=Math.sin(R),this.cosrot=Math.cos(R),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(h*h-1)/Math.cos(yt))),this.lat0<0&&(this.u_0=-this.u_0)),p=.5*P,this.v_pole_n=this.ArB*Math.log(Math.tan(xi-p)),this.v_pole_s=this.ArB*Math.log(Math.tan(xi+p))}function HC(t){var r={},a,h,p,_,m,l,T,I;if(t.x=t.x-this.lam0,Math.abs(Math.abs(t.y)-Zt)>de){if(m=this.E/Math.pow(on(this.e,t.y,Math.sin(t.y)),this.B),l=1/m,a=.5*(m-l),h=.5*(m+l),_=Math.sin(this.B*t.x),p=(a*this.singam-_*this.cosgam)/h,Math.abs(Math.abs(p)-1)<de)throw new Error;I=.5*this.ArB*Math.log((1-p)/(1+p)),l=Math.cos(this.B*t.x),Math.abs(l)<Cl?T=this.A*t.x:T=this.ArB*Math.atan2(a*this.cosgam+_*this.singam,l)}else I=t.y>0?this.v_pole_n:this.v_pole_s,T=this.ArB*t.y;return this.no_rot?(r.x=T,r.y=I):(T-=this.u_0,r.x=I*this.cosrot+T*this.sinrot,r.y=T*this.cosrot-I*this.sinrot),r.x=this.a*r.x+this.x0,r.y=this.a*r.y+this.y0,r}function WC(t){var r,a,h,p,_,m,l,T={};if(t.x=(t.x-this.x0)*(1/this.a),t.y=(t.y-this.y0)*(1/this.a),this.no_rot?(a=t.y,r=t.x):(a=t.x*this.cosrot-t.y*this.sinrot,r=t.y*this.cosrot+t.x*this.sinrot+this.u_0),h=Math.exp(-this.BrA*a),p=.5*(h-1/h),_=.5*(h+1/h),m=Math.sin(this.BrA*r),l=(m*this.cosgam+p*this.singam)/_,Math.abs(Math.abs(l)-1)<de)T.x=0,T.y=l<0?-Zt:Zt;else{if(T.y=this.E/Math.sqrt((1+l)/(1-l)),T.y=Rh(this.e,Math.pow(T.y,1/this.B)),T.y===1/0)throw new Error;T.x=-this.rB*Math.atan2(p*this.cosgam-m*this.singam,Math.cos(this.BrA*r))}return T.x+=this.lam0,T}var ZC=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const XC={init:GC,forward:HC,inverse:WC,names:ZC};function KC(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<de)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var r=Math.sin(this.lat1),a=Math.cos(this.lat1),h=Dn(this.e,r,a),p=on(this.e,this.lat1,r),_=Math.sin(this.lat2),m=Math.cos(this.lat2),l=Dn(this.e,_,m),T=on(this.e,this.lat2,_),I=on(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>de?this.ns=Math.log(h/l)/Math.log(p/T):this.ns=r,isNaN(this.ns)&&(this.ns=r),this.f0=h/(this.ns*Math.pow(p,this.ns)),this.rh=this.a*this.f0*Math.pow(I,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function YC(t){var r=t.x,a=t.y;Math.abs(2*Math.abs(a)-Math.PI)<=de&&(a=qh(a)*(Zt-2*de));var h=Math.abs(Math.abs(a)-Zt),p,_;if(h>de)p=on(this.e,a,Math.sin(a)),_=this.a*this.f0*Math.pow(p,this.ns);else{if(h=a*this.ns,h<=0)return null;_=0}var m=this.ns*_e(r-this.long0);return t.x=this.k0*(_*Math.sin(m))+this.x0,t.y=this.k0*(this.rh-_*Math.cos(m))+this.y0,t}function JC(t){var r,a,h,p,_,m=(t.x-this.x0)/this.k0,l=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(r=Math.sqrt(m*m+l*l),a=1):(r=-Math.sqrt(m*m+l*l),a=-1);var T=0;if(r!==0&&(T=Math.atan2(a*m,a*l)),r!==0||this.ns>0){if(a=1/this.ns,h=Math.pow(r/(this.a*this.f0),a),p=Rh(this.e,h),p===-9999)return null}else p=-Zt;return _=_e(T/this.ns+this.long0),t.x=_,t.y=p,t}var QC=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const tD={init:KC,forward:YC,inverse:JC,names:QC};function eD(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function iD(t){var r,a,h,p,_,m,l,T=t.x,I=t.y,R=_e(T-this.long0);return r=Math.pow((1+this.e*Math.sin(I))/(1-this.e*Math.sin(I)),this.alfa*this.e/2),a=2*(Math.atan(this.k*Math.pow(Math.tan(I/2+this.s45),this.alfa)/r)-this.s45),h=-R*this.alfa,p=Math.asin(Math.cos(this.ad)*Math.sin(a)+Math.sin(this.ad)*Math.cos(a)*Math.cos(h)),_=Math.asin(Math.cos(a)*Math.sin(h)/Math.cos(p)),m=this.n*_,l=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(p/2+this.s45),this.n),t.y=l*Math.cos(m)/1,t.x=l*Math.sin(m)/1,this.czech||(t.y*=-1,t.x*=-1),t}function sD(t){var r,a,h,p,_,m,l,T,I=t.x;t.x=t.y,t.y=I,this.czech||(t.y*=-1,t.x*=-1),m=Math.sqrt(t.x*t.x+t.y*t.y),_=Math.atan2(t.y,t.x),p=_/Math.sin(this.s0),h=2*(Math.atan(Math.pow(this.ro0/m,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),r=Math.asin(Math.cos(this.ad)*Math.sin(h)-Math.sin(this.ad)*Math.cos(h)*Math.cos(p)),a=Math.asin(Math.cos(h)*Math.sin(p)/Math.cos(r)),t.x=this.long0-a/this.alfa,l=r,T=0;var R=0;do t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(r/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(l))/(1-this.e*Math.sin(l)),this.e/2))-this.s45),Math.abs(l-t.y)<1e-10&&(T=1),l=t.y,R+=1;while(T===0&&R<15);return R>=15?null:t}var rD=["Krovak","krovak"];const nD={init:eD,forward:iD,inverse:sD,names:rD};function dr(t,r,a,h,p){return t*p-r*Math.sin(2*p)+a*Math.sin(4*p)-h*Math.sin(6*p)}function jh(t){return 1-.25*t*(1+t/16*(3+1.25*t))}function Gh(t){return .375*t*(1+.25*t*(1+.46875*t))}function Hh(t){return .05859375*t*t*(1+.75*t)}function Wh(t){return t*t*t*(35/3072)}function Wl(t,r,a){var h=r*a;return t/Math.sqrt(1-h*h)}function Kl(t){return Math.abs(t)<Zt?t:t-qh(t)*Math.PI}function zd(t,r,a,h,p){var _,m;_=t/r;for(var l=0;l<15;l++)if(m=(t-(r*_-a*Math.sin(2*_)+h*Math.sin(4*_)-p*Math.sin(6*_)))/(r-2*a*Math.cos(2*_)+4*h*Math.cos(4*_)-6*p*Math.cos(6*_)),_+=m,Math.abs(m)<=1e-10)return _;return NaN}function aD(){this.sphere||(this.e0=jh(this.es),this.e1=Gh(this.es),this.e2=Hh(this.es),this.e3=Wh(this.es),this.ml0=this.a*dr(this.e0,this.e1,this.e2,this.e3,this.lat0))}function oD(t){var r,a,h=t.x,p=t.y;if(h=_e(h-this.long0),this.sphere)r=this.a*Math.asin(Math.cos(p)*Math.sin(h)),a=this.a*(Math.atan2(Math.tan(p),Math.cos(h))-this.lat0);else{var _=Math.sin(p),m=Math.cos(p),l=Wl(this.a,this.e,_),T=Math.tan(p)*Math.tan(p),I=h*Math.cos(p),R=I*I,P=this.es*m*m/(1-this.es),L=this.a*dr(this.e0,this.e1,this.e2,this.e3,p);r=l*I*(1-R*T*(1/6-(8-T+8*P)*R/120)),a=L-this.ml0+l*_/m*R*(.5+(5-T+6*P)*R/24)}return t.x=r+this.x0,t.y=a+this.y0,t}function lD(t){t.x-=this.x0,t.y-=this.y0;var r=t.x/this.a,a=t.y/this.a,h,p;if(this.sphere){var _=a+this.lat0;h=Math.asin(Math.sin(_)*Math.cos(r)),p=Math.atan2(Math.tan(r),Math.cos(_))}else{var m=this.ml0/this.a+a,l=zd(m,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(l)-Zt)<=de)return t.x=this.long0,t.y=Zt,a<0&&(t.y*=-1),t;var T=Wl(this.a,this.e,Math.sin(l)),I=T*T*T/this.a/this.a*(1-this.es),R=Math.pow(Math.tan(l),2),P=r*this.a/T,L=P*P;h=l-T*Math.tan(l)/I*P*P*(.5-(1+3*R)*P*P/24),p=P*(1-L*(R/3+(1+3*R)*R*L/15))/Math.cos(l)}return t.x=_e(p+this.long0),t.y=Kl(h),t}var cD=["Cassini","Cassini_Soldner","cass"];const hD={init:aD,forward:oD,inverse:lD,names:cD};function za(t,r){var a;return t>1e-7?(a=t*r,(1-t*t)*(r/(1-a*a)-.5/t*Math.log((1-a)/(1+a)))):2*r}var uD=1,dD=2,fD=3,pD=4;function mD(){var t=Math.abs(this.lat0);if(Math.abs(t-Zt)<de?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(t)<de?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var r;switch(this.qp=za(this.e,1),this.mmf=.5/(1-this.es),this.apa=SD(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),r=Math.sin(this.lat0),this.sinb1=za(this.e,r)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*r*r)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function gD(t){var r,a,h,p,_,m,l,T,I,R,P=t.x,L=t.y;if(P=_e(P-this.long0),this.sphere){if(_=Math.sin(L),R=Math.cos(L),h=Math.cos(P),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(a=this.mode===this.EQUIT?1+R*h:1+this.sinph0*_+this.cosph0*R*h,a<=de)return null;a=Math.sqrt(2/a),r=a*R*Math.sin(P),a*=this.mode===this.EQUIT?_:this.cosph0*_-this.sinph0*R*h}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(h=-h),Math.abs(L+this.lat0)<de)return null;a=xi-L*.5,a=2*(this.mode===this.S_POLE?Math.cos(a):Math.sin(a)),r=a*Math.sin(P),a*=h}}else{switch(l=0,T=0,I=0,h=Math.cos(P),p=Math.sin(P),_=Math.sin(L),m=za(this.e,_),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(l=m/this.qp,T=Math.sqrt(1-l*l)),this.mode){case this.OBLIQ:I=1+this.sinb1*l+this.cosb1*T*h;break;case this.EQUIT:I=1+T*h;break;case this.N_POLE:I=Zt+L,m=this.qp-m;break;case this.S_POLE:I=L-Zt,m=this.qp+m;break}if(Math.abs(I)<de)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:I=Math.sqrt(2/I),this.mode===this.OBLIQ?a=this.ymf*I*(this.cosb1*l-this.sinb1*T*h):a=(I=Math.sqrt(2/(1+T*h)))*l*this.ymf,r=this.xmf*I*T*p;break;case this.N_POLE:case this.S_POLE:m>=0?(r=(I=Math.sqrt(m))*p,a=h*(this.mode===this.S_POLE?I:-I)):r=a=0;break}}return t.x=this.a*r+this.x0,t.y=this.a*a+this.y0,t}function _D(t){t.x-=this.x0,t.y-=this.y0;var r=t.x/this.a,a=t.y/this.a,h,p,_,m,l,T,I;if(this.sphere){var R=0,P,L=0;if(P=Math.sqrt(r*r+a*a),p=P*.5,p>1)return null;switch(p=2*Math.asin(p),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(L=Math.sin(p),R=Math.cos(p)),this.mode){case this.EQUIT:p=Math.abs(P)<=de?0:Math.asin(a*L/P),r*=L,a=R*P;break;case this.OBLIQ:p=Math.abs(P)<=de?this.lat0:Math.asin(R*this.sinph0+a*L*this.cosph0/P),r*=L*this.cosph0,a=(R-Math.sin(p)*this.sinph0)*P;break;case this.N_POLE:a=-a,p=Zt-p;break;case this.S_POLE:p-=Zt;break}h=a===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(r,a)}else{if(I=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(r/=this.dd,a*=this.dd,T=Math.sqrt(r*r+a*a),T<de)return t.x=this.long0,t.y=this.lat0,t;m=2*Math.asin(.5*T/this.rq),_=Math.cos(m),r*=m=Math.sin(m),this.mode===this.OBLIQ?(I=_*this.sinb1+a*m*this.cosb1/T,l=this.qp*I,a=T*this.cosb1*_-a*this.sinb1*m):(I=a*m/T,l=this.qp*I,a=T*_)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(a=-a),l=r*r+a*a,!l)return t.x=this.long0,t.y=this.lat0,t;I=1-l/this.qp,this.mode===this.S_POLE&&(I=-I)}h=Math.atan2(r,a),p=TD(Math.asin(I),this.apa)}return t.x=_e(this.long0+h),t.y=p,t}var yD=.3333333333333333,vD=.17222222222222222,xD=.10257936507936508,bD=.06388888888888888,wD=.0664021164021164,MD=.016415012942191543;function SD(t){var r,a=[];return a[0]=t*yD,r=t*t,a[0]+=r*vD,a[1]=r*bD,r*=t,a[0]+=r*xD,a[1]+=r*wD,a[2]=r*MD,a}function TD(t,r){var a=t+t;return t+r[0]*Math.sin(a)+r[1]*Math.sin(a+a)+r[2]*Math.sin(a+a+a)}var AD=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const ED={init:mD,forward:gD,inverse:_D,names:AD,S_POLE:uD,N_POLE:dD,EQUIT:fD,OBLIQ:pD};function Ba(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)}function ID(){Math.abs(this.lat1+this.lat2)<de||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=Dn(this.e3,this.sin_po,this.cos_po),this.qs1=za(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=Dn(this.e3,this.sin_po,this.cos_po),this.qs2=za(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=za(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>de?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function PD(t){var r=t.x,a=t.y;this.sin_phi=Math.sin(a),this.cos_phi=Math.cos(a);var h=za(this.e3,this.sin_phi),p=this.a*Math.sqrt(this.c-this.ns0*h)/this.ns0,_=this.ns0*_e(r-this.long0),m=p*Math.sin(_)+this.x0,l=this.rh-p*Math.cos(_)+this.y0;return t.x=m,t.y=l,t}function CD(t){var r,a,h,p,_,m;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(r=Math.sqrt(t.x*t.x+t.y*t.y),h=1):(r=-Math.sqrt(t.x*t.x+t.y*t.y),h=-1),p=0,r!==0&&(p=Math.atan2(h*t.x,h*t.y)),h=r*this.ns0/this.a,this.sphere?m=Math.asin((this.c-h*h)/(2*this.ns0)):(a=(this.c-h*h)/this.ns0,m=this.phi1z(this.e3,a)),_=_e(p/this.ns0+this.long0),t.x=_,t.y=m,t}function DD(t,r){var a,h,p,_,m,l=Ba(.5*r);if(t<de)return l;for(var T=t*t,I=1;I<=25;I++)if(a=Math.sin(l),h=Math.cos(l),p=t*a,_=1-p*p,m=.5*_*_/h*(r/(1-T)-a/_+.5/t*Math.log((1-p)/(1+p))),l=l+m,Math.abs(m)<=1e-7)return l;return null}var kD=["Albers_Conic_Equal_Area","Albers","aea"];const RD={init:ID,forward:PD,inverse:CD,names:kD,phi1z:DD};function zD(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function LD(t){var r,a,h,p,_,m,l,T,I=t.x,R=t.y;return h=_e(I-this.long0),r=Math.sin(R),a=Math.cos(R),p=Math.cos(h),m=this.sin_p14*r+this.cos_p14*a*p,_=1,m>0||Math.abs(m)<=de?(l=this.x0+this.a*_*a*Math.sin(h)/m,T=this.y0+this.a*_*(this.cos_p14*r-this.sin_p14*a*p)/m):(l=this.x0+this.infinity_dist*a*Math.sin(h),T=this.y0+this.infinity_dist*(this.cos_p14*r-this.sin_p14*a*p)),t.x=l,t.y=T,t}function OD(t){var r,a,h,p,_,m;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(r=Math.sqrt(t.x*t.x+t.y*t.y))?(p=Math.atan2(r,this.rc),a=Math.sin(p),h=Math.cos(p),m=Ba(h*this.sin_p14+t.y*a*this.cos_p14/r),_=Math.atan2(t.x*a,r*this.cos_p14*h-t.y*this.sin_p14*a),_=_e(this.long0+_)):(m=this.phic0,_=0),t.x=_,t.y=m,t}var FD=["gnom"];const BD={init:zD,forward:LD,inverse:OD,names:FD};function ND(t,r){var a=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(r)-a)<1e-6)return r<0?-1*Zt:Zt;for(var h=Math.asin(.5*r),p,_,m,l,T=0;T<30;T++)if(_=Math.sin(h),m=Math.cos(h),l=t*_,p=Math.pow(1-l*l,2)/(2*m)*(r/(1-t*t)-_/(1-l*l)+.5/t*Math.log((1-l)/(1+l))),h+=p,Math.abs(p)<=1e-10)return h;return NaN}function $D(){this.sphere||(this.k0=Dn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function VD(t){var r=t.x,a=t.y,h,p,_=_e(r-this.long0);if(this.sphere)h=this.x0+this.a*_*Math.cos(this.lat_ts),p=this.y0+this.a*Math.sin(a)/Math.cos(this.lat_ts);else{var m=za(this.e,Math.sin(a));h=this.x0+this.a*this.k0*_,p=this.y0+this.a*m*.5/this.k0}return t.x=h,t.y=p,t}function UD(t){t.x-=this.x0,t.y-=this.y0;var r,a;return this.sphere?(r=_e(this.long0+t.x/this.a/Math.cos(this.lat_ts)),a=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(a=ND(this.e,2*t.y*this.k0/this.a),r=_e(this.long0+t.x/(this.a*this.k0))),t.x=r,t.y=a,t}var qD=["cea"];const jD={init:$D,forward:VD,inverse:UD,names:qD};function GD(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function HD(t){var r=t.x,a=t.y,h=_e(r-this.long0),p=Kl(a-this.lat0);return t.x=this.x0+this.a*h*this.rc,t.y=this.y0+this.a*p,t}function WD(t){var r=t.x,a=t.y;return t.x=_e(this.long0+(r-this.x0)/(this.a*this.rc)),t.y=Kl(this.lat0+(a-this.y0)/this.a),t}var ZD=["Equirectangular","Equidistant_Cylindrical","eqc"];const XD={init:GD,forward:HD,inverse:WD,names:ZD};var i0=20;function KD(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=jh(this.es),this.e1=Gh(this.es),this.e2=Hh(this.es),this.e3=Wh(this.es),this.ml0=this.a*dr(this.e0,this.e1,this.e2,this.e3,this.lat0)}function YD(t){var r=t.x,a=t.y,h,p,_,m=_e(r-this.long0);if(_=m*Math.sin(a),this.sphere)Math.abs(a)<=de?(h=this.a*m,p=-1*this.a*this.lat0):(h=this.a*Math.sin(_)/Math.tan(a),p=this.a*(Kl(a-this.lat0)+(1-Math.cos(_))/Math.tan(a)));else if(Math.abs(a)<=de)h=this.a*m,p=-1*this.ml0;else{var l=Wl(this.a,this.e,Math.sin(a))/Math.tan(a);h=l*Math.sin(_),p=this.a*dr(this.e0,this.e1,this.e2,this.e3,a)-this.ml0+l*(1-Math.cos(_))}return t.x=h+this.x0,t.y=p+this.y0,t}function JD(t){var r,a,h,p,_,m,l,T,I;if(h=t.x-this.x0,p=t.y-this.y0,this.sphere)if(Math.abs(p+this.a*this.lat0)<=de)r=_e(h/this.a+this.long0),a=0;else{m=this.lat0+p/this.a,l=h*h/this.a/this.a+m*m,T=m;var R;for(_=i0;_;--_)if(R=Math.tan(T),I=-1*(m*(T*R+1)-T-.5*(T*T+l)*R)/((T-m)/R-1),T+=I,Math.abs(I)<=de){a=T;break}r=_e(this.long0+Math.asin(h*Math.tan(T)/this.a)/Math.sin(a))}else if(Math.abs(p+this.ml0)<=de)a=0,r=_e(this.long0+h/this.a);else{m=(this.ml0+p)/this.a,l=h*h/this.a/this.a+m*m,T=m;var P,L,K,tt,lt;for(_=i0;_;--_)if(lt=this.e*Math.sin(T),P=Math.sqrt(1-lt*lt)*Math.tan(T),L=this.a*dr(this.e0,this.e1,this.e2,this.e3,T),K=this.e0-2*this.e1*Math.cos(2*T)+4*this.e2*Math.cos(4*T)-6*this.e3*Math.cos(6*T),tt=L/this.a,I=(m*(P*tt+1)-tt-.5*P*(tt*tt+l))/(this.es*Math.sin(2*T)*(tt*tt+l-2*m*tt)/(4*P)+(m-tt)*(P*K-2/Math.sin(2*T))-K),T-=I,Math.abs(I)<=de){a=T;break}P=Math.sqrt(1-this.es*Math.pow(Math.sin(a),2))*Math.tan(a),r=_e(this.long0+Math.asin(h*P/this.a)/Math.sin(a))}return t.x=r,t.y=a,t}var QD=["Polyconic","poly"];const tk={init:KD,forward:YD,inverse:JD,names:QD};function ek(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function ik(t){var r,a=t.x,h=t.y,p=h-this.lat0,_=a-this.long0,m=p/yh*1e-5,l=_,T=1,I=0;for(r=1;r<=10;r++)T=T*m,I=I+this.A[r]*T;var R=I,P=l,L=1,K=0,tt,lt,vt=0,yt=0;for(r=1;r<=6;r++)tt=L*R-K*P,lt=K*R+L*P,L=tt,K=lt,vt=vt+this.B_re[r]*L-this.B_im[r]*K,yt=yt+this.B_im[r]*L+this.B_re[r]*K;return t.x=yt*this.a+this.x0,t.y=vt*this.a+this.y0,t}function sk(t){var r,a=t.x,h=t.y,p=a-this.x0,_=h-this.y0,m=_/this.a,l=p/this.a,T=1,I=0,R,P,L=0,K=0;for(r=1;r<=6;r++)R=T*m-I*l,P=I*m+T*l,T=R,I=P,L=L+this.C_re[r]*T-this.C_im[r]*I,K=K+this.C_im[r]*T+this.C_re[r]*I;for(var tt=0;tt<this.iterations;tt++){var lt=L,vt=K,yt,Tt,ut=m,Dt=l;for(r=2;r<=6;r++)yt=lt*L-vt*K,Tt=vt*L+lt*K,lt=yt,vt=Tt,ut=ut+(r-1)*(this.B_re[r]*lt-this.B_im[r]*vt),Dt=Dt+(r-1)*(this.B_im[r]*lt+this.B_re[r]*vt);lt=1,vt=0;var Ot=this.B_re[1],Ut=this.B_im[1];for(r=2;r<=6;r++)yt=lt*L-vt*K,Tt=vt*L+lt*K,lt=yt,vt=Tt,Ot=Ot+r*(this.B_re[r]*lt-this.B_im[r]*vt),Ut=Ut+r*(this.B_im[r]*lt+this.B_re[r]*vt);var ce=Ot*Ot+Ut*Ut;L=(ut*Ot+Dt*Ut)/ce,K=(Dt*Ot-ut*Ut)/ce}var te=L,fe=K,Ce=1,xe=0;for(r=1;r<=9;r++)Ce=Ce*te,xe=xe+this.D[r]*Ce;var ri=this.lat0+xe*yh*1e5,pe=this.long0+fe;return t.x=pe,t.y=ri,t}var rk=["New_Zealand_Map_Grid","nzmg"];const nk={init:ek,forward:ik,inverse:sk,names:rk};function ak(){}function ok(t){var r=t.x,a=t.y,h=_e(r-this.long0),p=this.x0+this.a*h,_=this.y0+this.a*Math.log(Math.tan(Math.PI/4+a/2.5))*1.25;return t.x=p,t.y=_,t}function lk(t){t.x-=this.x0,t.y-=this.y0;var r=_e(this.long0+t.x/this.a),a=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=r,t.y=a,t}var ck=["Miller_Cylindrical","mill"];const hk={init:ak,forward:ok,inverse:lk,names:ck};var uk=20;function dk(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=Tx(this.es)}function fk(t){var r,a,h=t.x,p=t.y;if(h=_e(h-this.long0),this.sphere){if(!this.m)p=this.n!==1?Math.asin(this.n*Math.sin(p)):p;else for(var _=this.n*Math.sin(p),m=uk;m;--m){var l=(this.m*p+Math.sin(p)-_)/(this.m+Math.cos(p));if(p-=l,Math.abs(l)<de)break}r=this.a*this.C_x*h*(this.m+Math.cos(p)),a=this.a*this.C_y*p}else{var T=Math.sin(p),I=Math.cos(p);a=this.a*df(p,T,I,this.en),r=this.a*h*I/Math.sqrt(1-this.es*T*T)}return t.x=r,t.y=a,t}function pk(t){var r,a,h,p;return t.x-=this.x0,h=t.x/this.a,t.y-=this.y0,r=t.y/this.a,this.sphere?(r/=this.C_y,h=h/(this.C_x*(this.m+Math.cos(r))),this.m?r=Ba((this.m*r+Math.sin(r))/this.n):this.n!==1&&(r=Ba(Math.sin(r)/this.n)),h=_e(h+this.long0),r=Kl(r)):(r=Ax(t.y/this.a,this.es,this.en),p=Math.abs(r),p<Zt?(p=Math.sin(r),a=this.long0+t.x*Math.sqrt(1-this.es*p*p)/(this.a*Math.cos(r)),h=_e(a)):p-de<Zt&&(h=this.long0)),t.x=h,t.y=r,t}var mk=["Sinusoidal","sinu"];const gk={init:dk,forward:fk,inverse:pk,names:mk};function _k(){}function yk(t){for(var r=t.x,a=t.y,h=_e(r-this.long0),p=a,_=Math.PI*Math.sin(a);;){var m=-(p+Math.sin(p)-_)/(1+Math.cos(p));if(p+=m,Math.abs(m)<de)break}p/=2,Math.PI/2-Math.abs(a)<de&&(h=0);var l=.900316316158*this.a*h*Math.cos(p)+this.x0,T=1.4142135623731*this.a*Math.sin(p)+this.y0;return t.x=l,t.y=T,t}function vk(t){var r,a;t.x-=this.x0,t.y-=this.y0,a=t.y/(1.4142135623731*this.a),Math.abs(a)>.999999999999&&(a=.999999999999),r=Math.asin(a);var h=_e(this.long0+t.x/(.900316316158*this.a*Math.cos(r)));h<-Math.PI&&(h=-Math.PI),h>Math.PI&&(h=Math.PI),a=(2*r+Math.sin(2*r))/Math.PI,Math.abs(a)>1&&(a=1);var p=Math.asin(a);return t.x=h,t.y=p,t}var xk=["Mollweide","moll"];const bk={init:_k,forward:yk,inverse:vk,names:xk};function wk(){Math.abs(this.lat1+this.lat2)<de||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=jh(this.es),this.e1=Gh(this.es),this.e2=Hh(this.es),this.e3=Wh(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=Dn(this.e,this.sinphi,this.cosphi),this.ml1=dr(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<de?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=Dn(this.e,this.sinphi,this.cosphi),this.ml2=dr(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=dr(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function Mk(t){var r=t.x,a=t.y,h;if(this.sphere)h=this.a*(this.g-a);else{var p=dr(this.e0,this.e1,this.e2,this.e3,a);h=this.a*(this.g-p)}var _=this.ns*_e(r-this.long0),m=this.x0+h*Math.sin(_),l=this.y0+this.rh-h*Math.cos(_);return t.x=m,t.y=l,t}function Sk(t){t.x-=this.x0,t.y=this.rh-t.y+this.y0;var r,a,h,p;this.ns>=0?(a=Math.sqrt(t.x*t.x+t.y*t.y),r=1):(a=-Math.sqrt(t.x*t.x+t.y*t.y),r=-1);var _=0;if(a!==0&&(_=Math.atan2(r*t.x,r*t.y)),this.sphere)return p=_e(this.long0+_/this.ns),h=Kl(this.g-a/this.a),t.x=p,t.y=h,t;var m=this.g-a/this.a;return h=zd(m,this.e0,this.e1,this.e2,this.e3),p=_e(this.long0+_/this.ns),t.x=p,t.y=h,t}var Tk=["Equidistant_Conic","eqdc"];const Ak={init:wk,forward:Mk,inverse:Sk,names:Tk};function Ek(){this.R=this.a}function Ik(t){var r=t.x,a=t.y,h=_e(r-this.long0),p,_;Math.abs(a)<=de&&(p=this.x0+this.R*h,_=this.y0);var m=Ba(2*Math.abs(a/Math.PI));(Math.abs(h)<=de||Math.abs(Math.abs(a)-Zt)<=de)&&(p=this.x0,a>=0?_=this.y0+Math.PI*this.R*Math.tan(.5*m):_=this.y0+Math.PI*this.R*-Math.tan(.5*m));var l=.5*Math.abs(Math.PI/h-h/Math.PI),T=l*l,I=Math.sin(m),R=Math.cos(m),P=R/(I+R-1),L=P*P,K=P*(2/I-1),tt=K*K,lt=Math.PI*this.R*(l*(P-tt)+Math.sqrt(T*(P-tt)*(P-tt)-(tt+T)*(L-tt)))/(tt+T);h<0&&(lt=-lt),p=this.x0+lt;var vt=T+P;return lt=Math.PI*this.R*(K*vt-l*Math.sqrt((tt+T)*(T+1)-vt*vt))/(tt+T),a>=0?_=this.y0+lt:_=this.y0-lt,t.x=p,t.y=_,t}function Pk(t){var r,a,h,p,_,m,l,T,I,R,P,L,K;return t.x-=this.x0,t.y-=this.y0,P=Math.PI*this.R,h=t.x/P,p=t.y/P,_=h*h+p*p,m=-Math.abs(p)*(1+_),l=m-2*p*p+h*h,T=-2*m+1+2*p*p+_*_,K=p*p/T+(2*l*l*l/T/T/T-9*m*l/T/T)/27,I=(m-l*l/3/T)/T,R=2*Math.sqrt(-I/3),P=3*K/I/R,Math.abs(P)>1&&(P>=0?P=1:P=-1),L=Math.acos(P)/3,t.y>=0?a=(-R*Math.cos(L+Math.PI/3)-l/3/T)*Math.PI:a=-(-R*Math.cos(L+Math.PI/3)-l/3/T)*Math.PI,Math.abs(h)<de?r=this.long0:r=_e(this.long0+Math.PI*(_-1+Math.sqrt(1+2*(h*h-p*p)+_*_))/2/h),t.x=r,t.y=a,t}var Ck=["Van_der_Grinten_I","VanDerGrinten","vandg"];const Dk={init:Ek,forward:Ik,inverse:Pk,names:Ck};function kk(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function Rk(t){var r=t.x,a=t.y,h=Math.sin(t.y),p=Math.cos(t.y),_=_e(r-this.long0),m,l,T,I,R,P,L,K,tt,lt,vt,yt,Tt,ut,Dt,Ot,Ut,ce,te,fe,Ce,xe,ri;return this.sphere?Math.abs(this.sin_p12-1)<=de?(t.x=this.x0+this.a*(Zt-a)*Math.sin(_),t.y=this.y0-this.a*(Zt-a)*Math.cos(_),t):Math.abs(this.sin_p12+1)<=de?(t.x=this.x0+this.a*(Zt+a)*Math.sin(_),t.y=this.y0+this.a*(Zt+a)*Math.cos(_),t):(ce=this.sin_p12*h+this.cos_p12*p*Math.cos(_),Ot=Math.acos(ce),Ut=Ot?Ot/Math.sin(Ot):1,t.x=this.x0+this.a*Ut*p*Math.sin(_),t.y=this.y0+this.a*Ut*(this.cos_p12*h-this.sin_p12*p*Math.cos(_)),t):(m=jh(this.es),l=Gh(this.es),T=Hh(this.es),I=Wh(this.es),Math.abs(this.sin_p12-1)<=de?(R=this.a*dr(m,l,T,I,Zt),P=this.a*dr(m,l,T,I,a),t.x=this.x0+(R-P)*Math.sin(_),t.y=this.y0-(R-P)*Math.cos(_),t):Math.abs(this.sin_p12+1)<=de?(R=this.a*dr(m,l,T,I,Zt),P=this.a*dr(m,l,T,I,a),t.x=this.x0+(R+P)*Math.sin(_),t.y=this.y0+(R+P)*Math.cos(_),t):(L=h/p,K=Wl(this.a,this.e,this.sin_p12),tt=Wl(this.a,this.e,h),lt=Math.atan((1-this.es)*L+this.es*K*this.sin_p12/(tt*p)),vt=Math.atan2(Math.sin(_),this.cos_p12*Math.tan(lt)-this.sin_p12*Math.cos(_)),vt===0?te=Math.asin(this.cos_p12*Math.sin(lt)-this.sin_p12*Math.cos(lt)):Math.abs(Math.abs(vt)-Math.PI)<=de?te=-Math.asin(this.cos_p12*Math.sin(lt)-this.sin_p12*Math.cos(lt)):te=Math.asin(Math.sin(_)*Math.cos(lt)/Math.sin(vt)),yt=this.e*this.sin_p12/Math.sqrt(1-this.es),Tt=this.e*this.cos_p12*Math.cos(vt)/Math.sqrt(1-this.es),ut=yt*Tt,Dt=Tt*Tt,fe=te*te,Ce=fe*te,xe=Ce*te,ri=xe*te,Ot=K*te*(1-fe*Dt*(1-Dt)/6+Ce/8*ut*(1-2*Dt)+xe/120*(Dt*(4-7*Dt)-3*yt*yt*(1-7*Dt))-ri/48*ut),t.x=this.x0+Ot*Math.sin(vt),t.y=this.y0+Ot*Math.cos(vt),t))}function zk(t){t.x-=this.x0,t.y-=this.y0;var r,a,h,p,_,m,l,T,I,R,P,L,K,tt,lt,vt,yt,Tt,ut,Dt,Ot,Ut,ce,te;return this.sphere?(r=Math.sqrt(t.x*t.x+t.y*t.y),r>2*Zt*this.a?void 0:(a=r/this.a,h=Math.sin(a),p=Math.cos(a),_=this.long0,Math.abs(r)<=de?m=this.lat0:(m=Ba(p*this.sin_p12+t.y*h*this.cos_p12/r),l=Math.abs(this.lat0)-Zt,Math.abs(l)<=de?this.lat0>=0?_=_e(this.long0+Math.atan2(t.x,-t.y)):_=_e(this.long0-Math.atan2(-t.x,t.y)):_=_e(this.long0+Math.atan2(t.x*h,r*this.cos_p12*p-t.y*this.sin_p12*h))),t.x=_,t.y=m,t)):(T=jh(this.es),I=Gh(this.es),R=Hh(this.es),P=Wh(this.es),Math.abs(this.sin_p12-1)<=de?(L=this.a*dr(T,I,R,P,Zt),r=Math.sqrt(t.x*t.x+t.y*t.y),K=L-r,m=zd(K/this.a,T,I,R,P),_=_e(this.long0+Math.atan2(t.x,-1*t.y)),t.x=_,t.y=m,t):Math.abs(this.sin_p12+1)<=de?(L=this.a*dr(T,I,R,P,Zt),r=Math.sqrt(t.x*t.x+t.y*t.y),K=r-L,m=zd(K/this.a,T,I,R,P),_=_e(this.long0+Math.atan2(t.x,t.y)),t.x=_,t.y=m,t):(r=Math.sqrt(t.x*t.x+t.y*t.y),vt=Math.atan2(t.x,t.y),tt=Wl(this.a,this.e,this.sin_p12),yt=Math.cos(vt),Tt=this.e*this.cos_p12*yt,ut=-Tt*Tt/(1-this.es),Dt=3*this.es*(1-ut)*this.sin_p12*this.cos_p12*yt/(1-this.es),Ot=r/tt,Ut=Ot-ut*(1+ut)*Math.pow(Ot,3)/6-Dt*(1+3*ut)*Math.pow(Ot,4)/24,ce=1-ut*Ut*Ut/2-Ot*Ut*Ut*Ut/6,lt=Math.asin(this.sin_p12*Math.cos(Ut)+this.cos_p12*Math.sin(Ut)*yt),_=_e(this.long0+Math.asin(Math.sin(vt)*Math.sin(Ut)/Math.cos(lt))),te=Math.sin(lt),m=Math.atan2((te-this.es*ce*this.sin_p12)*Math.tan(lt),te*(1-this.es)),t.x=_,t.y=m,t))}var Lk=["Azimuthal_Equidistant","aeqd"];const Ok={init:kk,forward:Rk,inverse:zk,names:Lk};function Fk(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function Bk(t){var r,a,h,p,_,m,l,T,I=t.x,R=t.y;return h=_e(I-this.long0),r=Math.sin(R),a=Math.cos(R),p=Math.cos(h),m=this.sin_p14*r+this.cos_p14*a*p,_=1,(m>0||Math.abs(m)<=de)&&(l=this.a*_*a*Math.sin(h),T=this.y0+this.a*_*(this.cos_p14*r-this.sin_p14*a*p)),t.x=l,t.y=T,t}function Nk(t){var r,a,h,p,_,m,l;return t.x-=this.x0,t.y-=this.y0,r=Math.sqrt(t.x*t.x+t.y*t.y),a=Ba(r/this.a),h=Math.sin(a),p=Math.cos(a),m=this.long0,Math.abs(r)<=de?(l=this.lat0,t.x=m,t.y=l,t):(l=Ba(p*this.sin_p14+t.y*h*this.cos_p14/r),_=Math.abs(this.lat0)-Zt,Math.abs(_)<=de?(this.lat0>=0?m=_e(this.long0+Math.atan2(t.x,-t.y)):m=_e(this.long0-Math.atan2(-t.x,t.y)),t.x=m,t.y=l,t):(m=_e(this.long0+Math.atan2(t.x*h,r*this.cos_p14*p-t.y*this.sin_p14*h)),t.x=m,t.y=l,t))}var $k=["ortho"];const Vk={init:Fk,forward:Bk,inverse:Nk,names:$k};var Ji={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},bi={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function Uk(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=Zt-xi/2?this.face=Ji.TOP:this.lat0<=-(Zt-xi/2)?this.face=Ji.BOTTOM:Math.abs(this.long0)<=xi?this.face=Ji.FRONT:Math.abs(this.long0)<=Zt+xi?this.face=this.long0>0?Ji.RIGHT:Ji.LEFT:this.face=Ji.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function qk(t){var r={x:0,y:0},a,h,p,_,m,l,T={value:0};if(t.x-=this.long0,this.es!==0?a=Math.atan(this.one_minus_f_squared*Math.tan(t.y)):a=t.y,h=t.x,this.face===Ji.TOP)_=Zt-a,h>=xi&&h<=Zt+xi?(T.value=bi.AREA_0,p=h-Zt):h>Zt+xi||h<=-(Zt+xi)?(T.value=bi.AREA_1,p=h>0?h-_s:h+_s):h>-(Zt+xi)&&h<=-xi?(T.value=bi.AREA_2,p=h+Zt):(T.value=bi.AREA_3,p=h);else if(this.face===Ji.BOTTOM)_=Zt+a,h>=xi&&h<=Zt+xi?(T.value=bi.AREA_0,p=-h+Zt):h<xi&&h>=-xi?(T.value=bi.AREA_1,p=-h):h<-xi&&h>=-(Zt+xi)?(T.value=bi.AREA_2,p=-h-Zt):(T.value=bi.AREA_3,p=h>0?-h+_s:-h-_s);else{var I,R,P,L,K,tt,lt;this.face===Ji.RIGHT?h=$l(h,+Zt):this.face===Ji.BACK?h=$l(h,+_s):this.face===Ji.LEFT&&(h=$l(h,-Zt)),L=Math.sin(a),K=Math.cos(a),tt=Math.sin(h),lt=Math.cos(h),I=K*lt,R=K*tt,P=L,this.face===Ji.FRONT?(_=Math.acos(I),p=od(_,P,R,T)):this.face===Ji.RIGHT?(_=Math.acos(R),p=od(_,P,-I,T)):this.face===Ji.BACK?(_=Math.acos(-I),p=od(_,P,-R,T)):this.face===Ji.LEFT?(_=Math.acos(-R),p=od(_,P,I,T)):(_=p=0,T.value=bi.AREA_0)}return l=Math.atan(12/_s*(p+Math.acos(Math.sin(p)*Math.cos(xi))-Zt)),m=Math.sqrt((1-Math.cos(_))/(Math.cos(l)*Math.cos(l))/(1-Math.cos(Math.atan(1/Math.cos(p))))),T.value===bi.AREA_1?l+=Zt:T.value===bi.AREA_2?l+=_s:T.value===bi.AREA_3&&(l+=1.5*_s),r.x=m*Math.cos(l),r.y=m*Math.sin(l),r.x=r.x*this.a+this.x0,r.y=r.y*this.a+this.y0,t.x=r.x,t.y=r.y,t}function jk(t){var r={lam:0,phi:0},a,h,p,_,m,l,T,I,R,P={value:0};if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,h=Math.atan(Math.sqrt(t.x*t.x+t.y*t.y)),a=Math.atan2(t.y,t.x),t.x>=0&&t.x>=Math.abs(t.y)?P.value=bi.AREA_0:t.y>=0&&t.y>=Math.abs(t.x)?(P.value=bi.AREA_1,a-=Zt):t.x<0&&-t.x>=Math.abs(t.y)?(P.value=bi.AREA_2,a=a<0?a+_s:a-_s):(P.value=bi.AREA_3,a+=Zt),R=_s/12*Math.tan(a),m=Math.sin(R)/(Math.cos(R)-1/Math.sqrt(2)),l=Math.atan(m),p=Math.cos(a),_=Math.tan(h),T=1-p*p*_*_*(1-Math.cos(Math.atan(1/Math.cos(l)))),T<-1?T=-1:T>1&&(T=1),this.face===Ji.TOP)I=Math.acos(T),r.phi=Zt-I,P.value===bi.AREA_0?r.lam=l+Zt:P.value===bi.AREA_1?r.lam=l<0?l+_s:l-_s:P.value===bi.AREA_2?r.lam=l-Zt:r.lam=l;else if(this.face===Ji.BOTTOM)I=Math.acos(T),r.phi=I-Zt,P.value===bi.AREA_0?r.lam=-l+Zt:P.value===bi.AREA_1?r.lam=-l:P.value===bi.AREA_2?r.lam=-l-Zt:r.lam=l<0?-l-_s:-l+_s;else{var L,K,tt;L=T,R=L*L,R>=1?tt=0:tt=Math.sqrt(1-R)*Math.sin(l),R+=tt*tt,R>=1?K=0:K=Math.sqrt(1-R),P.value===bi.AREA_1?(R=K,K=-tt,tt=R):P.value===bi.AREA_2?(K=-K,tt=-tt):P.value===bi.AREA_3&&(R=K,K=tt,tt=-R),this.face===Ji.RIGHT?(R=L,L=-K,K=R):this.face===Ji.BACK?(L=-L,K=-K):this.face===Ji.LEFT&&(R=L,L=K,K=-R),r.phi=Math.acos(-tt)-Zt,r.lam=Math.atan2(K,L),this.face===Ji.RIGHT?r.lam=$l(r.lam,-Zt):this.face===Ji.BACK?r.lam=$l(r.lam,-_s):this.face===Ji.LEFT&&(r.lam=$l(r.lam,+Zt))}if(this.es!==0){var lt,vt,yt;lt=r.phi<0?1:0,vt=Math.tan(r.phi),yt=this.b/Math.sqrt(vt*vt+this.one_minus_f_squared),r.phi=Math.atan(Math.sqrt(this.a*this.a-yt*yt)/(this.one_minus_f*yt)),lt&&(r.phi=-r.phi)}return r.lam+=this.long0,t.x=r.lam,t.y=r.phi,t}function od(t,r,a,h){var p;return t<de?(h.value=bi.AREA_0,p=0):(p=Math.atan2(r,a),Math.abs(p)<=xi?h.value=bi.AREA_0:p>xi&&p<=Zt+xi?(h.value=bi.AREA_1,p-=Zt):p>Zt+xi||p<=-(Zt+xi)?(h.value=bi.AREA_2,p=p>=0?p-_s:p+_s):(h.value=bi.AREA_3,p+=Zt)),p}function $l(t,r){var a=t+r;return a<-_s?a+=Dh:a>+_s&&(a-=Dh),a}var Gk=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const Hk={init:Uk,forward:qk,inverse:jk,names:Gk};var um=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],ch=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],Px=.8487,Cx=1.3523,Dx=In/5,Wk=1/Dx,zl=18,Ld=function(t,r){return t[0]+r*(t[1]+r*(t[2]+r*t[3]))},Zk=function(t,r){return t[1]+r*(2*t[2]+r*3*t[3])};function Xk(t,r,a,h){for(var p=r;h;--h){var _=t(p);if(p-=_,Math.abs(_)<a)break}return p}function Kk(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function Yk(t){var r=_e(t.x-this.long0),a=Math.abs(t.y),h=Math.floor(a*Dx);h<0?h=0:h>=zl&&(h=zl-1),a=In*(a-Wk*h);var p={x:Ld(um[h],a)*r,y:Ld(ch[h],a)};return t.y<0&&(p.y=-p.y),p.x=p.x*this.a*Px+this.x0,p.y=p.y*this.a*Cx+this.y0,p}function Jk(t){var r={x:(t.x-this.x0)/(this.a*Px),y:Math.abs(t.y-this.y0)/(this.a*Cx)};if(r.y>=1)r.x/=um[zl][0],r.y=t.y<0?-Zt:Zt;else{var a=Math.floor(r.y*zl);for(a<0?a=0:a>=zl&&(a=zl-1);;)if(ch[a][0]>r.y)--a;else if(ch[a+1][0]<=r.y)++a;else break;var h=ch[a],p=5*(r.y-h[0])/(ch[a+1][0]-h[0]);p=Xk(function(_){return(Ld(h,_)-r.y)/Zk(h,_)},p,de,100),r.x/=Ld(um[a],p),r.y=(5*a+p)*$s,t.y<0&&(r.y=-r.y)}return r.x=_e(r.x+this.long0),r}var Qk=["Robinson","robin"];const t3={init:Kk,forward:Yk,inverse:Jk,names:Qk};function e3(){this.name="geocent"}function i3(t){var r=gx(t,this.es,this.a);return r}function s3(t){var r=_x(t,this.es,this.a,this.b);return r}var r3=["Geocentric","geocentric","geocent","Geocent"];const n3={init:e3,forward:i3,inverse:s3,names:r3};var Js={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},nh={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function a3(){if(Object.keys(nh).forEach((function(a){if(typeof this[a]>"u")this[a]=nh[a].def;else{if(nh[a].num&&isNaN(this[a]))throw new Error("Invalid parameter value, must be numeric "+a+" = "+this[a]);nh[a].num&&(this[a]=parseFloat(this[a]))}nh[a].degrees&&(this[a]=this[a]*$s)}).bind(this)),Math.abs(Math.abs(this.lat0)-Zt)<de?this.mode=this.lat0<0?Js.S_POLE:Js.N_POLE:Math.abs(this.lat0)<de?this.mode=Js.EQUIT:(this.mode=Js.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var t=this.tilt,r=this.azi;this.cg=Math.cos(r),this.sg=Math.sin(r),this.cw=Math.cos(t),this.sw=Math.sin(t)}function o3(t){t.x-=this.long0;var r=Math.sin(t.y),a=Math.cos(t.y),h=Math.cos(t.x),p,_;switch(this.mode){case Js.OBLIQ:_=this.sinph0*r+this.cosph0*a*h;break;case Js.EQUIT:_=a*h;break;case Js.S_POLE:_=-r;break;case Js.N_POLE:_=r;break}switch(_=this.pn1/(this.p-_),p=_*a*Math.sin(t.x),this.mode){case Js.OBLIQ:_*=this.cosph0*r-this.sinph0*a*h;break;case Js.EQUIT:_*=r;break;case Js.N_POLE:_*=-(a*h);break;case Js.S_POLE:_*=a*h;break}var m,l;return m=_*this.cg+p*this.sg,l=1/(m*this.sw*this.h1+this.cw),p=(p*this.cg-_*this.sg)*this.cw*l,_=m*l,t.x=p*this.a,t.y=_*this.a,t}function l3(t){t.x/=this.a,t.y/=this.a;var r={x:t.x,y:t.y},a,h,p;p=1/(this.pn1-t.y*this.sw),a=this.pn1*t.x*p,h=this.pn1*t.y*this.cw*p,t.x=a*this.cg+h*this.sg,t.y=h*this.cg-a*this.sg;var _=Hr(t.x,t.y);if(Math.abs(_)<de)r.x=0,r.y=t.y;else{var m,l;switch(l=1-_*_*this.pfact,l=(this.p-Math.sqrt(l))/(this.pn1/_+_/this.pn1),m=Math.sqrt(1-l*l),this.mode){case Js.OBLIQ:r.y=Math.asin(m*this.sinph0+t.y*l*this.cosph0/_),t.y=(m-this.sinph0*Math.sin(r.y))*_,t.x*=l*this.cosph0;break;case Js.EQUIT:r.y=Math.asin(t.y*l/_),t.y=m*_,t.x*=l;break;case Js.N_POLE:r.y=Math.asin(m),t.y=-t.y;break;case Js.S_POLE:r.y=-Math.asin(m);break}r.x=Math.atan2(t.x,t.y)}return t.x=r.x+this.long0,t.y=r.y,t}var c3=["Tilted_Perspective","tpers"];const h3={init:a3,forward:o3,inverse:l3,names:c3};function u3(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var t=1-this.es,r=1/t;this.radius_p=Math.sqrt(t),this.radius_p2=t,this.radius_p_inv2=r,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function d3(t){var r=t.x,a=t.y,h,p,_,m;if(r=r-this.long0,this.shape==="ellipse"){a=Math.atan(this.radius_p2*Math.tan(a));var l=this.radius_p/Hr(this.radius_p*Math.cos(a),Math.sin(a));if(p=l*Math.cos(r)*Math.cos(a),_=l*Math.sin(r)*Math.cos(a),m=l*Math.sin(a),(this.radius_g-p)*p-_*_-m*m*this.radius_p_inv2<0)return t.x=Number.NaN,t.y=Number.NaN,t;h=this.radius_g-p,this.flip_axis?(t.x=this.radius_g_1*Math.atan(_/Hr(m,h)),t.y=this.radius_g_1*Math.atan(m/h)):(t.x=this.radius_g_1*Math.atan(_/h),t.y=this.radius_g_1*Math.atan(m/Hr(_,h)))}else this.shape==="sphere"&&(h=Math.cos(a),p=Math.cos(r)*h,_=Math.sin(r)*h,m=Math.sin(a),h=this.radius_g-p,this.flip_axis?(t.x=this.radius_g_1*Math.atan(_/Hr(m,h)),t.y=this.radius_g_1*Math.atan(m/h)):(t.x=this.radius_g_1*Math.atan(_/h),t.y=this.radius_g_1*Math.atan(m/Hr(_,h))));return t.x=t.x*this.a,t.y=t.y*this.a,t}function f3(t){var r=-1,a=0,h=0,p,_,m,l;if(t.x=t.x/this.a,t.y=t.y/this.a,this.shape==="ellipse"){this.flip_axis?(h=Math.tan(t.y/this.radius_g_1),a=Math.tan(t.x/this.radius_g_1)*Hr(1,h)):(a=Math.tan(t.x/this.radius_g_1),h=Math.tan(t.y/this.radius_g_1)*Hr(1,a));var T=h/this.radius_p;if(p=a*a+T*T+r*r,_=2*this.radius_g*r,m=_*_-4*p*this.C,m<0)return t.x=Number.NaN,t.y=Number.NaN,t;l=(-_-Math.sqrt(m))/(2*p),r=this.radius_g+l*r,a*=l,h*=l,t.x=Math.atan2(a,r),t.y=Math.atan(h*Math.cos(t.x)/r),t.y=Math.atan(this.radius_p_inv2*Math.tan(t.y))}else if(this.shape==="sphere"){if(this.flip_axis?(h=Math.tan(t.y/this.radius_g_1),a=Math.tan(t.x/this.radius_g_1)*Math.sqrt(1+h*h)):(a=Math.tan(t.x/this.radius_g_1),h=Math.tan(t.y/this.radius_g_1)*Math.sqrt(1+a*a)),p=a*a+h*h+r*r,_=2*this.radius_g*r,m=_*_-4*p*this.C,m<0)return t.x=Number.NaN,t.y=Number.NaN,t;l=(-_-Math.sqrt(m))/(2*p),r=this.radius_g+l*r,a*=l,h*=l,t.x=Math.atan2(a,r),t.y=Math.atan(h*Math.cos(t.x)/r)}return t.x=t.x+this.long0,t}var p3=["Geostationary Satellite View","Geostationary_Satellite","geos"];const m3={init:u3,forward:d3,inverse:f3,names:p3};var vh=1.340264,xh=-.081106,bh=893e-6,wh=.003796,Od=Math.sqrt(3)/2;function g3(){this.es=0,this.long0=this.long0!==void 0?this.long0:0}function _3(t){var r=_e(t.x-this.long0),a=t.y,h=Math.asin(Od*Math.sin(a)),p=h*h,_=p*p*p;return t.x=r*Math.cos(h)/(Od*(vh+3*xh*p+_*(7*bh+9*wh*p))),t.y=h*(vh+xh*p+_*(bh+wh*p)),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t}function y3(t){t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a;var r=1e-9,a=12,h=t.y,p,_,m,l,T,I;for(I=0;I<a&&(p=h*h,_=p*p*p,m=h*(vh+xh*p+_*(bh+wh*p))-t.y,l=vh+3*xh*p+_*(7*bh+9*wh*p),h-=T=m/l,!(Math.abs(T)<r));++I);return p=h*h,_=p*p*p,t.x=Od*t.x*(vh+3*xh*p+_*(7*bh+9*wh*p))/Math.cos(h),t.y=Math.asin(Math.sin(h)/Od),t.x=_e(t.x+this.long0),t}var v3=["eqearth","Equal Earth","Equal_Earth"];const x3={init:g3,forward:_3,inverse:y3,names:v3};function b3(t){t.Proj.projections.add(vd),t.Proj.projections.add(xd),t.Proj.projections.add(wC),t.Proj.projections.add(kC),t.Proj.projections.add(BC),t.Proj.projections.add(qC),t.Proj.projections.add(XC),t.Proj.projections.add(tD),t.Proj.projections.add(nD),t.Proj.projections.add(hD),t.Proj.projections.add(ED),t.Proj.projections.add(RD),t.Proj.projections.add(BD),t.Proj.projections.add(jD),t.Proj.projections.add(XD),t.Proj.projections.add(tk),t.Proj.projections.add(nk),t.Proj.projections.add(hk),t.Proj.projections.add(gk),t.Proj.projections.add(bk),t.Proj.projections.add(Ak),t.Proj.projections.add(Dk),t.Proj.projections.add(Ok),t.Proj.projections.add(Vk),t.Proj.projections.add(Hk),t.Proj.projections.add(t3),t.Proj.projections.add(n3),t.Proj.projections.add(h3),t.Proj.projections.add(m3),t.Proj.projections.add(x3)}Lr.defaultDatum="WGS84";Lr.Proj=Pn;Lr.WGS84=new Lr.Proj("WGS84");Lr.Point=Hl;Lr.toPoint=yx;Lr.defs=ur;Lr.nadgrid=SP;Lr.transform=Rd;Lr.mgrs=$P;Lr.version="__VERSION__";b3(Lr);const ff=ea("MapStore",{state:()=>({map:{},currentMapStyle:"pwdDrawnMapStyle",currentTopicMapStyle:{},bufferForAddress:{},currentMarkersForTopic:[],addressMarker:null}),actions:{setMap(t){this.map=t},setMapStyle(t){this.currentMapStyle=t},async fillBufferForAddress(t,r){const _=Lr("+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs","+proj=lcc +lat_1=40.96666666666667 +lat_2=39.93333333333333 +lat_0=39.33333333333334 +lon_0=-77.75 +x_0=600000 +y_0=0 +ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 +no_defs",[t,r]);console.log("fillBufferForAddress is running, lng:",t,"lat:",r);const m="https://citygeo-geocoder-pub.databridge.phila.gov/arcgis/rest/services/Utilities/Geometry/GeometryServer/buffer",l={geometries:`${_.join(", ")}`,inSR:2272,outSR:4326,bufferSR:2272,distances:500,unionResults:!0,geodesic:!1,f:"json"};let T=await Li.get(m,{params:l});this.bufferForAddress=T.data}}});var xr=63710088e-1,w3={centimeters:xr*100,centimetres:xr*100,degrees:xr/111325,feet:xr*3.28084,inches:xr*39.37,kilometers:xr/1e3,kilometres:xr/1e3,meters:xr,metres:xr,miles:xr/1609.344,millimeters:xr*1e3,millimetres:xr*1e3,nauticalmiles:xr/1852,radians:1,yards:xr*1.0936};function Wm(t,r,a){a===void 0&&(a={});var h={type:"Feature"};return(a.id===0||a.id)&&(h.id=a.id),a.bbox&&(h.bbox=a.bbox),h.properties=r||{},h.geometry=t,h}function Fd(t,r,a){if(a===void 0&&(a={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!s0(t[0])||!s0(t[1]))throw new Error("coordinates must contain numbers");var h={type:"Point",coordinates:t};return Wm(h,r,a)}function M3(t,r,a){a===void 0&&(a={});for(var h=0,p=t;h<p.length;h++){var _=p[h];if(_.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var m=0;m<_[_.length-1].length;m++)if(_[_.length-1][m]!==_[0][m])throw new Error("First and last Position are not equivalent.")}var l={type:"Polygon",coordinates:t};return Wm(l,r,a)}function S3(t,r,a){if(a===void 0&&(a={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");var h={type:"LineString",coordinates:t};return Wm(h,r,a)}function T3(t,r){r===void 0&&(r={});var a={type:"FeatureCollection"};return r.id&&(a.id=r.id),r.bbox&&(a.bbox=r.bbox),a.features=t,a}function A3(t,r){r===void 0&&(r="kilometers");var a=w3[r];if(!a)throw new Error(r+" units is invalid");return t*a}function ld(t){var r=t%360;return r*Math.PI/180}function s0(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function r0(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return t.geometry.coordinates;if(t.type==="Point")return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function dm(t,r,a){a===void 0&&(a={});var h=r0(t),p=r0(r),_=ld(p[1]-h[1]),m=ld(p[0]-h[0]),l=ld(h[1]),T=ld(p[1]),I=Math.pow(Math.sin(_/2),2)+Math.pow(Math.sin(m/2),2)*Math.cos(l)*Math.cos(T);return A3(2*Math.atan2(Math.sqrt(I),Math.sqrt(1-I)),a.units)}function fm(t,r,a){if(t!==null)for(var h,p,_,m,l,T,I,R=0,P=0,L,K=t.type,tt=K==="FeatureCollection",lt=K==="Feature",vt=tt?t.features.length:1,yt=0;yt<vt;yt++){I=tt?t.features[yt].geometry:lt?t.geometry:t,L=I?I.type==="GeometryCollection":!1,l=L?I.geometries.length:1;for(var Tt=0;Tt<l;Tt++){var ut=0,Dt=0;if(m=L?I.geometries[Tt]:I,m!==null){T=m.coordinates;var Ot=m.type;switch(R=a&&(Ot==="Polygon"||Ot==="MultiPolygon")?1:0,Ot){case null:break;case"Point":if(r(T,P,yt,ut,Dt)===!1)return!1;P++,ut++;break;case"LineString":case"MultiPoint":for(h=0;h<T.length;h++){if(r(T[h],P,yt,ut,Dt)===!1)return!1;P++,Ot==="MultiPoint"&&ut++}Ot==="LineString"&&ut++;break;case"Polygon":case"MultiLineString":for(h=0;h<T.length;h++){for(p=0;p<T[h].length-R;p++){if(r(T[h][p],P,yt,ut,Dt)===!1)return!1;P++}Ot==="MultiLineString"&&ut++,Ot==="Polygon"&&Dt++}Ot==="Polygon"&&ut++;break;case"MultiPolygon":for(h=0;h<T.length;h++){for(Dt=0,p=0;p<T[h].length;p++){for(_=0;_<T[h][p].length-R;_++){if(r(T[h][p][_],P,yt,ut,Dt)===!1)return!1;P++}Dt++}ut++}break;case"GeometryCollection":for(h=0;h<m.geometries.length;h++)if(fm(m.geometries[h],r,a)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function kx(t,r){if(t.type==="Feature")r(t,0);else if(t.type==="FeatureCollection")for(var a=0;a<t.features.length&&r(t.features[a],a)!==!1;a++);}function E3(t){var r=[];return t.type==="FeatureCollection"?kx(t,function(a){fm(a,function(h){r.push(Fd(h,a.properties))})}):fm(t,function(a){r.push(Fd(a,t.properties))}),T3(r)}function I3(t){if(!t)throw new Error("geojson is required");switch(t.type){case"Feature":return Rx(t);case"FeatureCollection":return P3(t);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return Zm(t);default:throw new Error("unknown GeoJSON type")}}function Rx(t){var r={type:"Feature"};return Object.keys(t).forEach(function(a){switch(a){case"type":case"properties":case"geometry":return;default:r[a]=t[a]}}),r.properties=zx(t.properties),r.geometry=Zm(t.geometry),r}function zx(t){var r={};return t&&Object.keys(t).forEach(function(a){var h=t[a];typeof h=="object"?h===null?r[a]=null:Array.isArray(h)?r[a]=h.map(function(p){return p}):r[a]=zx(h):r[a]=h}),r}function P3(t){var r={type:"FeatureCollection"};return Object.keys(t).forEach(function(a){switch(a){case"type":case"features":return;default:r[a]=t[a]}}),r.features=t.features.map(function(a){return Rx(a)}),r}function Zm(t){var r={type:t.type};return t.bbox&&(r.bbox=t.bbox),t.type==="GeometryCollection"?(r.geometries=t.geometries.map(function(a){return Zm(a)}),r):(r.coordinates=Lx(t.coordinates),r)}function Lx(t){var r=t;return typeof r[0]!="object"?r.slice():r.map(function(a){return Lx(a)})}function C3(t,r){if(!t)throw new Error("targetPoint is required");if(!r)throw new Error("points is required");var a,h=1/0,p=0;return kx(r,function(_,m){var l=dm(t,_);l<h&&(p=m,h=l)}),a=I3(r.features[p]),a.properties.featureIndex=p,a.properties.distanceToPoint=h,a}const D3=(t,r)=>{const a={};if(!r.options.params)return a;const h=Object.entries(r.options.params);(void 0).store.state;for(let[p,_]of h){let m;typeof _=="function"?m=_(t):m=_,a[p]=m}return a},Bp=(t,r)=>{const a=D3(t,r);r.url;const h=r.options,p=h.table,_=h.dateMinNum||null,m=h.dateMinType||null,l=h.dateField||null;h.success;const T=h.distances||250,I=h.groupby||null,R="ST_Distance(the_geom::geography, ST_SetSRID(ST_Point("+t.geometry.coordinates[0]+","+t.geometry.coordinates[1]+"),4326)::geography)",P="ST_Y(the_geom)",L="ST_X(the_geom)";let K;I?K=I+", the_geom":K="*",K=K+", "+R+"as distance,"+P+"as lat, "+L+"as lng",a.q="select "+K+" from "+p+" where "+R+" < "+T;let tt;if(_){switch(m){case"hour":tt=lE;break;case"day":tt=jA;break;case"week":tt=cE;break;case"month":tt=oE;break;case"year":tt=hE;break}a.q=a.q+" and "+l+" > '"+om(tt(new Date,_),"yyyy-MM-dd")+"'"}return I&&(a.q=a.q+" group by "+I+", the_geom"),a},Ox=ea("NearbyActivityStore",{state:()=>({loadingData:!1,nearby311:{},nearbyCrimeIncidents:null,nearbyZoningAppeals:null,nearbyVacantIndicatorPoints:null,nearbyConstructionPermits:null,nearbyDemolitionPermits:null,nearbyImminentlyDangerous:null}),actions:{setLoadingData(t){this.loadingData=t},async fetchData(t){console.log("fetchData is runnning, dataType:",t),t==="nearby311"?await this.fillNearby311():t==="nearbyCrimeIncidents"?await this.fillNearbyCrimeIncidents():t==="nearbyZoningAppeals"?await this.fillNearbyZoningAppeals():t==="nearbyVacantIndicatorPoints"&&await this.fillNearbyVacantIndicatorPoints()},async fillNearby311(){const t=Ds();this.setLoadingData(!0);const r=t.addressData.features[0];let a={url:"https://phl.carto.com/api/v2/sql?",options:{table:"public_cases_fc",dateMinNum:365,dateMinType:"day",dateField:"requested_datetime"}},h=Bp(r,a);const p=await Li.get(a.url,{params:h});this.nearby311=p,this.setLoadingData(!1)},async fillNearbyCrimeIncidents(){const t=Ds();this.setLoadingData(!0);const r=t.addressData.features[0];let a={url:"https://phl.carto.com/api/v2/sql?",options:{table:"incidents_part1_part2",dateMinNum:90,dateMinType:"day",dateField:"dispatch_date"}},h=Bp(r,a);const p=await Li.get(a.url,{params:h});this.nearbyCrimeIncidents=p,this.setLoadingData(!1)},async fillNearbyZoningAppeals(){const t=Ds();this.setLoadingData(!0);const r=t.addressData.features[0];let a={url:"https://phl.carto.com/api/v2/sql?",options:{table:"appeals",dateMinNum:1,dateMinType:"year",dateField:"scheduleddate"}},h=Bp(r,a);const p=await Li.get(a.url,{params:h});this.nearbyZoningAppeals=p,this.setLoadingData(!1)},async fillNearbyVacantIndicatorPoints(){this.setLoadingData(!0);const r=ff().bufferForAddress,a="https://services.arcgis.com/fLeGjb7u4uXqeF9q/arcgis/rest/services/Vacant_Indicators_Points/FeatureServer/0/query?",h=r.geometries[0].rings[0];let p=[[parseFloat(h[0][0].toFixed(6)),parseFloat(h[0][1].toFixed(6))]];var _;for(_=0;_<h.length;_++)if(_%3==0){let K=[parseFloat(h[_][0].toFixed(6)),parseFloat(h[_][1].toFixed(6))];p.push(K)}p.push([parseFloat(h[0][0].toFixed(6)),parseFloat(h[0][1].toFixed(6))]);const m={returnGeometry:!0,where:"1=1",outSR:4326,outFields:"*",inSr:4326,geometryType:"esriGeometryPolygon",spatialRel:"esriSpatialRelContains",f:"geojson",geometry:JSON.stringify({rings:[p],spatialReference:{wkid:4326}})};let I=(await(await Li.get(a,{params:m})).data||{}).features;const P=Ds().addressData.features[0],L=Fd(P.geometry.coordinates);I=I.map(K=>{const tt=K.geometry.coordinates;let lt;if(Array.isArray(tt[0])){let yt;K.geometry.type==="LineString"?yt=S3([tt[0],tt[1]],{name:"line 1"}):yt=M3([tt[0]]);const Tt=E3(yt),ut=C3(L,Tt);lt=dm(L,ut,{units:"miles"})}else{const yt=Fd(tt);lt=dm(L,yt,{units:"miles"})}const vt=parseInt(lt*5280);return K._distance=vt,K}),this.nearbyVacantIndicatorPoints=I,this.setLoadingData(!1)}}}),k3=ct("div",{class:"box"}," See recent activity near your search address including 311 service requests, crimes, zoning appeals, and more. Hover over a record below to highlight it on the map. ",-1),R3=ct("div",{class:"dropdown-trigger"},[ct("button",{class:"button","aria-haspopup":"true","aria-controls":"dropdown-menu"},[ct("span",null,"What nearby activity would you like to see?"),ct("span",{class:"icon is-small"},[ct("i",{class:"fas fa-angle-down","aria-hidden":"true"})])])],-1),z3={class:"dropdown-menu",id:"dropdown-menu",role:"menu"},L3={class:"dropdown-content"},O3=ct("br",null,null,-1),F3=ct("div",{class:"dropdown-trigger"},[ct("button",{class:"button","aria-haspopup":"true","aria-controls":"dropdown-menu"},[ct("span",null,"From"),ct("span",{class:"icon is-small"},[ct("i",{class:"fas fa-angle-down","aria-hidden":"true"})])])],-1),B3={class:"dropdown-menu",id:"dropdown-menu",role:"menu"},N3={class:"dropdown-content"},$3=["onClick"],V3=ct("div",{class:"dropdown-trigger"},[ct("button",{class:"button","aria-haspopup":"true","aria-controls":"dropdown-menu"},[ct("span",null,"Sort by"),ct("span",{class:"icon is-small"},[ct("i",{class:"fas fa-angle-down","aria-hidden":"true"})])])],-1),U3={class:"dropdown-menu",id:"dropdown-menu",role:"menu"},q3={class:"dropdown-content"},j3=ct("br",null,null,-1),G3={key:0,class:"mt-5"},H3=ct("h5",{class:"subtitle is-5"},"311 Requests",-1),W3={key:0},Z3={class:"table is-fullwidth is-striped"},X3=ct("thead",null,[ct("tr",null,[ct("th",null,"Date"),ct("th",null,"Location"),ct("th",null,"Type"),ct("th",null,"Distance")])],-1),K3={key:1,class:"mt-5"},Y3=ct("h5",{class:"subtitle is-5"},"Crime Incidents",-1),J3={key:0},Q3={class:"table is-fullwidth is-striped"},tR=ct("thead",null,[ct("tr",null,[ct("th",null,"Date"),ct("th",null,"Location"),ct("th",null,"Description"),ct("th",null,"Distance")])],-1),eR={key:2,class:"mt-5"},iR=ct("h5",{class:"subtitle is-5"},"Zoning Appeals",-1),sR={key:0},rR={class:"table is-fullwidth is-striped"},nR=ct("thead",null,[ct("tr",null,[ct("th",null,"Date"),ct("th",null,"Location"),ct("th",null,"Description"),ct("th",null,"Distance")])],-1),aR={key:3,class:"mt-5"},oR=ct("h5",{class:"subtitle is-5"},"Likely Vacant Properties",-1),lR={key:0},cR={class:"table is-fullwidth is-striped"},hR=ct("thead",null,[ct("tr",null,[ct("th",null,"Address"),ct("th",null,"Property Type"),ct("th",null,"Distance")])],-1),uR={__name:"NearbyActivity",setup(t){console.log("Nearby.vue setup");const r=Ox(),a=Kr();ff();const{currency:h,date:p}=Vm(),_=Fh(),m=rf(),l=(pe,Qt,oe)=>new Date(Qt[oe])-new Date(pe[oe]),T={nearby311:"311 Requests",nearbyCrimeIncidents:"Crime Incidents",nearbyZoningAppeals:"Zoning Appeals",nearbyVacantIndicatorPoints:"Vacant Properties",nearbyConstructionPermits:"Construction Permits",nearbyDemolitionPermits:"Demolition Permits",nearbyImminentlyDangerous:"Imminently Dangerous"},I=rn(!1),R=()=>I.value=!I.value,P=wi(()=>a.currentNearbyDataType),L=wi(()=>r.loadingData),K=pe=>{m.push({name:"address-topic-and-data",params:{address:a.currentAddress,topic:_.params.topic,data:pe}})};Ra(()=>_.params.data,async pe=>{pe&&(a.setCurrentNearbyDataType(pe),await tt(pe))});const tt=async pe=>{r[pe]===null&&(console.log("fetching new data"),await r.fetchData(pe)),ce(te[pe].values[0])},lt=rn(!1),vt=()=>lt.value=!lt.value,yt=rn("distance"),Tt=pe=>{yt.value=pe},ut=rn(!1),Dt=()=>ut.value=!ut.value,Ot=rn(null);Lh(()=>{Ot.value=te[P.value].values[0]});const Ut=wi(()=>te[P.value].labels[te[P.value].values.indexOf(Ot.value)]),ce=pe=>{Ot.value=pe},te={nearby311:{labels:["the last 30 days","the last 90 days","1 year"],values:[30,90,365]},nearbyCrimeIncidents:{labels:["the last 30 days","the last 90 days"],values:[30,90]},nearbyZoningAppeals:{labels:["any time","the last 90 days","the next 90 days"],values:[0,-90,90]},nearbyVacantIndicatorPoints:{labels:[],values:[]},nearbyConstructionPermits:{labels:["the last 30 days","the last 90 days","1 year"],values:[30,90,365]},nearbyDemolitionPermits:{labels:["the last 30 days","the last 90 days","1 year"],values:[30,90,365]},nearbyImminentlyDangerous:{labels:["the last 30 days","the last 90 days","1 year"],values:[30,90,365]}},fe=wi(()=>{if(r.nearby311){let pe=[...r.nearby311.data.rows].filter(Qt=>{let oe=new Date(Qt.requested_datetime);return(new Date-oe)/(1e3*60*60*24)<=Ot.value});return yt.value==="distance"?pe.sort((Qt,oe)=>Qt.distance-oe.distance):yt.value==="time"&&pe.sort((Qt,oe)=>l(Qt,oe,"requested_datetime")),pe}}),Ce=wi(()=>{if(r.nearbyCrimeIncidents){let pe=[...r.nearbyCrimeIncidents.data.rows].filter(Qt=>{let oe=new Date(Qt.dispatch_date);return(new Date-oe)/(1e3*60*60*24)<=Ot.value});return yt.value==="distance"?pe.sort((Qt,oe)=>Qt.distance-oe.distance):yt.value==="time"&&pe.sort((Qt,oe)=>l(Qt,oe,"dispatch_date")),pe}}),xe=wi(()=>{if(r.nearbyZoningAppeals){let pe=[...r.nearbyZoningAppeals.data.rows];return console.log(new Date(pe[0].scheduleddate)),Ot.value<0?pe=pe.filter(Qt=>{let oe=new Date(Qt.scheduleddate);return(new Date-oe)/(1e3*60*60*24)>=Ot.value}):Ot.value>0&&(pe=pe.filter(Qt=>{let oe=new Date(Qt.scheduleddate);return(new Date-oe)/(1e3*60*60*24)<=Ot.value})),yt.value==="distance"?pe.sort((Qt,oe)=>Qt.distance-oe.distance):yt.value==="time"&&pe.sort((Qt,oe)=>l(Qt,oe,"dispatch_date")),pe}}),ri=wi(()=>{if(r.nearbyVacantIndicatorPoints){let pe=[...r.nearbyVacantIndicatorPoints];return yt.value==="distance"?pe.sort((Qt,oe)=>Qt._distance-oe._distance):yt.value==="type"&&pe.sort((Qt,oe)=>Qt.distance-oe.distance),pe}});return(pe,Qt)=>(Pe(),Ue("section",null,[k3,ct("div",{class:xo(I.value?"dropdown is-active":"dropdown"),onClick:R},[R3,ct("div",z3,[ct("div",L3,[ct("a",{class:"dropdown-item",onClick:Qt[0]||(Qt[0]=oe=>K("nearby311"))},"311 Requests"),ct("a",{class:"dropdown-item",onClick:Qt[1]||(Qt[1]=oe=>K("nearbyCrimeIncidents"))},"Crime Incidents"),ct("a",{class:"dropdown-item",onClick:Qt[2]||(Qt[2]=oe=>K("nearbyZoningAppeals"))},"Zoning Appeals"),ct("a",{class:"dropdown-item",onClick:Qt[3]||(Qt[3]=oe=>K("nearbyVacantIndicatorPoints"))},"Vacant Properties"),ct("a",{class:"dropdown-item",onClick:Qt[4]||(Qt[4]=oe=>K("nearbyConstructionPermits"))},"Construction Permits"),ct("a",{class:"dropdown-item",onClick:Qt[5]||(Qt[5]=oe=>K("nearbyDemolitionPermits"))},"Demolition Permits"),ct("a",{class:"dropdown-item",onClick:Qt[6]||(Qt[6]=oe=>K("nearbyImminentlyDangerous"))},"Imminently Dangerous")])])],2),ct("span",null,Fe(T[P.value]),1),O3,ct("div",{class:xo(ut.value?"dropdown is-active":"dropdown"),onClick:Dt},[F3,ct("div",B3,[ct("div",N3,[(Pe(!0),Ue(ns,null,An(te[P.value].values,(oe,ze)=>(Pe(),Ue("a",{class:"dropdown-item",onClick:Le=>ce(oe)},Fe(te[P.value].labels[ze]),9,$3))),256))])])],2),ct("span",null,Fe(Ut.value),1),ct("div",{class:xo(lt.value?"dropdown is-active":"dropdown"),onClick:vt},[V3,ct("div",U3,[ct("div",q3,[ct("a",{class:"dropdown-item",onClick:Qt[7]||(Qt[7]=oe=>Tt("distance"))},"distance"),ct("a",{class:"dropdown-item",onClick:Qt[8]||(Qt[8]=oe=>Tt("time"))},"time")])])],2),ct("span",null,Fe(yt.value),1),j3,P.value=="nearby311"?(Pe(),Ue("div",G3,[H3,L.value?(Pe(),Ue("div",W3,"Loading...")):Zi("",!0),ct("table",Z3,[X3,ct("tbody",null,[(Pe(!0),Ue(ns,null,An(fe.value,oe=>(Pe(),Ue("tr",null,[ct("td",null,Fe(Ti(p)(oe.requested_datetime)),1),ct("td",null,Fe(oe.address),1),ct("td",null,Fe(oe.service_name),1),ct("td",null,Fe((oe.distance*3.28084).toFixed(0))+" ft",1)]))),256))])])])):Zi("",!0),P.value=="nearbyCrimeIncidents"?(Pe(),Ue("div",K3,[Y3,L.value?(Pe(),Ue("div",J3,"Loading...")):Zi("",!0),ct("table",Q3,[tR,ct("tbody",null,[(Pe(!0),Ue(ns,null,An(Ce.value,oe=>(Pe(),Ue("tr",null,[ct("td",null,Fe(oe.dispatch_date),1),ct("td",null,Fe(oe.location_block),1),ct("td",null,Fe(oe.text_general_code),1),ct("td",null,Fe((oe.distance*3.28084).toFixed(0))+" ft",1)]))),256))])])])):Zi("",!0),P.value=="nearbyZoningAppeals"?(Pe(),Ue("div",eR,[iR,L.value?(Pe(),Ue("div",sR,"Loading...")):Zi("",!0),ct("table",rR,[nR,ct("tbody",null,[(Pe(!0),Ue(ns,null,An(xe.value,oe=>(Pe(),Ue("tr",null,[ct("td",null,Fe(oe.scheduleddate),1),ct("td",null,Fe(oe.address),1),ct("td",null,Fe(oe.appeal_grounds),1),ct("td",null,Fe((oe.distance*3.28084).toFixed(0))+" ft",1)]))),256))])])])):Zi("",!0),P.value=="nearbyVacantIndicatorPoints"?(Pe(),Ue("div",aR,[oR,L.value?(Pe(),Ue("div",lR,"Loading...")):Zi("",!0),ct("table",cR,[hR,ct("tbody",null,[(Pe(!0),Ue(ns,null,An(ri.value,oe=>(Pe(),Ue("tr",null,[ct("td",null,Fe(oe.properties.ADDRESS),1),ct("td",null,Fe(oe.properties.VACANT_FLAG),1),ct("td",null,Fe((oe._distance*3.28084).toFixed(0))+" ft",1)]))),256))])])])):Zi("",!0)]))}},dR=t=>(Wd("data-v-404bc196"),t=t(),Zd(),t),fR={key:0,class:"columns"},pR=f2('<div class="column is-12" data-v-404bc196><h3 class="subtitle is-3" data-v-404bc196>Atlas is your front door to the City of Philadelphia.</h3><p class="subtitle is-5" data-v-404bc196>Here are some things you can do with Atlas:</p><ul data-v-404bc196><li data-v-404bc196>Find your polling place</li><li data-v-404bc196>Get the history of permits, licenses, and inspections at any address</li><li data-v-404bc196>Research real estate information including property values, zoning, and document archives</li><li data-v-404bc196>Get easy access to a variety of hard-to-find City resources</li><li data-v-404bc196>View recent activity around your address, such as crimes, 311 service requests, and more</li><li data-v-404bc196>Explore historical imagery and maps</li></ul><p data-v-404bc196>To get started, click anywhere on the map, or type an address, intersection, property assessment account number, or Department of Records Map Registry number into the search box.</p></div>',1),mR=[pR],gR={key:1,class:"columns"},_R=dR(()=>ct("div",{class:"column is-12"},[ct("p",null,"We couldn't find that address. Are you sure everything was spelled correctly?"),ct("p",null,"Here are some examples of things you can search for:"),ct("ul",null,[ct("li",null,"1234 Market St"),ct("li",null,"1001 Pine Street #201"),ct("li",null,"12th & Market"),ct("li",null,"12th & Market"),ct("li",null,"883309050 (an OPA number with no hyphens or other characters)")])],-1)),yR=[_R],vR={key:2},xR={class:"columns"},bR={class:"column is-12"},wR={class:"subtitle is-3"},MR={__name:"TopicPanel",setup(t){const r=Kr(),a=$h(),h=Fh(),p=wi(()=>r.currentAddress),_=wi(()=>r.dataSourcesLoadedArray);return(m,l)=>(Pe(),Ue("section",null,[Ti(h).name=="home"?(Pe(),Ue("div",fR,mR)):Zi("",!0),Ti(h).name=="not-found"?(Pe(),Ue("div",gR,yR)):Zi("",!0),p.value?(Pe(),Ue("div",vR,[ct("div",xR,[ct("div",bR,[ct("h3",wR,Fe(p.value),1)])]),Gi(mo,{"topic-name":"Property",loading:!_.value.includes("Property")},{default:Xn(()=>[_.value.includes("Property")?(Pe(),Kn(NE,{key:0})):Zi("",!0)]),_:1},8,["loading"]),j0(Gi(mo,{"topic-name":"Condominiums",loading:!_.value.includes("Condominiums")},{default:Xn(()=>[_.value.includes("Condominiums")?(Pe(),Kn(jE,{key:0})):Zi("",!0)]),_:1},8,["loading"]),[[C2,Ti(a).condosData.length>0]]),Gi(mo,{"topic-name":"Deeds",loading:!_.value.includes("Deeds")},{default:Xn(()=>[_.value.includes("Deeds")?(Pe(),Kn(MI,{key:0})):Zi("",!0)]),_:1},8,["loading"]),Gi(mo,{"topic-name":"Licenses & Inspections",loading:!_.value.includes("Licenses & Inspections")},{default:Xn(()=>[_.value.includes("Licenses & Inspections")?(Pe(),Kn(kI,{key:0})):Zi("",!0)]),_:1},8,["loading"]),Gi(mo,{"topic-name":"Zoning",loading:!_.value.includes("Zoning")},{default:Xn(()=>[_.value.includes("Zoning")?(Pe(),Kn(LI,{key:0})):Zi("",!0)]),_:1},8,["loading"]),Gi(mo,{"topic-name":"Voting",loading:!_.value.includes("Voting")},{default:Xn(()=>[_.value.includes("Voting")?(Pe(),Kn(BI,{key:0})):Zi("",!0)]),_:1},8,["loading"]),Gi(mo,{"topic-name":"Nearby Activity",loading:!_.value.includes("Nearby Activity")},{default:Xn(()=>[_.value.includes("Nearby Activity")?(Pe(),Kn(uR,{key:0})):Zi("",!0)]),_:1},8,["loading"])])):Zi("",!0)]))}},SR=Vh(MR,[["__scopeId","data-v-404bc196"]]),hh={topicStyles:{Property:"pwdDrawnMapStyle",Condos:"pwdDrawnMapStyle",Deeds:"dorDrawnMapStyle","Licenses & Inspections":"pwdDrawnMapStyle",Zoning:"zoningDrawnMapStyle",Voting:"pwdDrawnMapStyle","Nearby Activity":"pwdDrawnMapStyle"},parcelLayerForTopic:{undefined:"PWD",Property:"PWD",Condos:"PWD",Deeds:"DOR","Licenses & Inspections":"PWD",Zoning:"DOR",Voting:"PWD","Nearby Activity":"PWD"},noMapStyle:{version:8,sources:{},glyphs:"//fonts.openmaptiles.org/{fontstack}/{range}.pbf",layers:[]},pwdDrawnMapStyle:{version:8,name:"pwdDrawnMap",sources:{pwd:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityBasemap/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},pwdLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityBasemap_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256}},layers:[{id:"pwd",source:"pwd",type:"raster"},{id:"pwdLabels",source:"pwdLabels",type:"raster"}]},dorDrawnMapStyle:{version:8,name:"dorDrawnMap",sources:{dor:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/DORBasemap/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},dorLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/DORBasemap_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256}},layers:[{id:"dor",source:"dor",type:"raster"},{id:"dorLabels",source:"dorLabels",type:"raster"}]},zoningDrawnMapStyle:{version:8,name:"dorDrawnMap",sources:{dor:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/DORBasemap/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},dorLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/DORBasemap_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},zoning:{tiles:["https://citygeo-geoserver.databridge.phila.gov/geoserver/wms?service=WMS&version=1.1.0&request=GetMap&layers=atlas_zoning_grouped&bbox={bbox-epsg-3857}&width=256&height=256&srs=EPSG%3A3857&styles=&format=image/png&transparent=true"],type:"raster",tileSize:256}},layers:[{id:"dor",source:"dor",type:"raster"},{id:"dorLabels",source:"dorLabels",type:"raster"},{id:"zoning",source:"zoning",type:"raster"}]},imageryMapStyle:{version:8,name:"imageryMap",sources:{imagery:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2022_2in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},imageryLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},stormwater:{tiles:["https://stormwater.phila.gov/arcgis/rest/services/parcel_viewer/pv_data/MapServer/export?dpi=110            &transparent=true            &format=png36            &bbox={bbox-epsg-3857}            &bboxSR=3857            &imageSR=3857            &size=512,512            &f=image          "],type:"raster",tileSize:256}},layers:[{id:"imagery",source:"imagery",type:"raster"},{id:"imageryLabels",source:"imageryLabels",type:"raster"}]}};var Fx={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.3/LICENSE.txt
 */(function(t,r){(function(a,h){t.exports=h()})(RT,function(){var a={},h={};function p(m,l,T){if(h[m]=T,m==="index"){var I="var sharedModule = {}; ("+h.shared+")(sharedModule); ("+h.worker+")(sharedModule);",R={};return h.shared(R),h.index(a,R),typeof window<"u"&&a.setWorkerUrl(window.URL.createObjectURL(new Blob([I],{type:"text/javascript"}))),a}}p("shared",["exports"],function(m){function l(s,e,n,c){return new(n||(n=Promise))(function(f,v){function x(E){try{S(c.next(E))}catch(D){v(D)}}function b(E){try{S(c.throw(E))}catch(D){v(D)}}function S(E){var D;E.done?f(E.value):(D=E.value,D instanceof n?D:new n(function(k){k(D)})).then(x,b)}S((c=c.apply(s,e||[])).next())})}function T(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}typeof SuppressedError=="function"&&SuppressedError;var I=R;function R(s,e){this.x=s,this.y=e}R.prototype={clone:function(){return new R(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,e){return this.clone()._rotateAround(s,e)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var e=s.x-this.x,n=s.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,e){return Math.atan2(this.x*e-this.y*s,this.x*s+this.y*e)},_matMult:function(s){var e=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=e,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var e=Math.cos(s),n=Math.sin(s),c=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=c,this},_rotateAround:function(s,e){var n=Math.cos(s),c=Math.sin(s),f=e.y+c*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-c*(this.y-e.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},R.convert=function(s){return s instanceof R?s:Array.isArray(s)?new R(s[0],s[1]):s};var P=T(I),L=K;function K(s,e,n,c){this.cx=3*s,this.bx=3*(n-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(c-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=e,this.p2x=n,this.p2y=c}K.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,e){if(e===void 0&&(e=1e-6),s<0)return 0;if(s>1)return 1;for(var n=s,c=0;c<8;c++){var f=this.sampleCurveX(n)-s;if(Math.abs(f)<e)return n;var v=this.sampleCurveDerivativeX(n);if(Math.abs(v)<1e-6)break;n-=f/v}var x=0,b=1;for(n=s,c=0;c<20&&(f=this.sampleCurveX(n),!(Math.abs(f-s)<e));c++)s>f?x=n:b=n,n=.5*(b-x)+x;return n},solve:function(s,e){return this.sampleCurveY(this.solveCurveX(s,e))}};var tt=T(L);let lt,vt;function yt(){return lt==null&&(lt=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),lt}function Tt(){if(vt==null&&(vt=!1,yt())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let c=0;c<5*5;c++){const f=4*c;e.fillStyle=`rgb(${f},${f+1},${f+2})`,e.fillRect(c%5,Math.floor(c/5),1,1)}const n=e.getImageData(0,0,5,5).data;for(let c=0;c<5*5*4;c++)if(c%4!=3&&n[c]!==c){vt=!0;break}}}return vt||!1}function ut(s,e,n,c){const f=new tt(s,e,n,c);return function(v){return f.solve(v)}}const Dt=ut(.25,.1,.25,1);function Ot(s,e,n){return Math.min(n,Math.max(e,s))}function Ut(s,e,n){const c=n-e,f=((s-e)%c+c)%c+e;return f===e?n:f}function ce(s,...e){for(const n of e)for(const c in n)s[c]=n[c];return s}let te=1;function fe(s,e,n){const c={};for(const f in s)c[f]=e.call(n||this,s[f],f,s);return c}function Ce(s,e,n){const c={};for(const f in s)e.call(n||this,s[f],f,s)&&(c[f]=s[f]);return c}function xe(s){return Array.isArray(s)?s.map(xe):typeof s=="object"&&s?fe(s,xe):s}const ri={};function pe(s){ri[s]||(typeof console<"u"&&console.warn(s),ri[s]=!0)}function Qt(s,e,n){return(n.y-s.y)*(e.x-s.x)>(e.y-s.y)*(n.x-s.x)}function oe(s){let e=0;for(let n,c,f=0,v=s.length,x=v-1;f<v;x=f++)n=s[f],c=s[x],e+=(c.x-n.x)*(n.y+c.y);return e}function ze(s){return typeof WorkerGlobalScope<"u"&&s!==void 0&&s instanceof WorkerGlobalScope}let Le=null;function Ye(s){return typeof ImageBitmap<"u"&&s instanceof ImageBitmap}const xs="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ks(s,e,n,c,f){return l(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const v=new VideoFrame(s,{timestamp:0});try{const x=v==null?void 0:v.format;if(!x||!x.startsWith("BGR")&&!x.startsWith("RGB"))throw new Error(`Unrecognized format ${x}`);const b=x.startsWith("BGR"),S=new Uint8ClampedArray(c*f*4);if(yield v.copyTo(S,function(E,D,k,B,$){const U=4*Math.max(-D,0),G=(Math.max(0,k)-k)*B*4+U,X=4*B,st=Math.max(0,D),gt=Math.max(0,k);return{rect:{x:st,y:gt,width:Math.min(E.width,D+B)-st,height:Math.min(E.height,k+$)-gt},layout:[{offset:G,stride:X}]}}(s,e,n,c,f)),b)for(let E=0;E<S.length;E+=4){const D=S[E];S[E]=S[E+2],S[E+2]=D}return S}finally{v.close()}})}let Ii,hi;const bs="AbortError";function fr(){return new Error(bs)}const As={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Pi(s){return As.REGISTERED_PROTOCOLS[s.substring(0,s.indexOf("://"))]}const kt="global-dispatcher";class ae extends Error{constructor(e,n,c,f){super(`AJAXError: ${n} (${e}): ${c}`),this.status=e,this.statusText=n,this.url=c,this.body=f}}const re=()=>ze(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,ye=function(s,e){if(/:\/\//.test(s.url)&&!/^https?:|^file:/.test(s.url)){const c=Pi(s.url);if(c)return c(s,e);if(ze(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,targetMapId:kt},e)}if(!(/^file:/.test(n=s.url)||/^file:/.test(re())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(c,f){return l(this,void 0,void 0,function*(){const v=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,cache:c.cache,referrer:re(),signal:f.signal});c.type==="json"&&v.headers.set("Accept","application/json");const x=yield fetch(v);if(!x.ok){const E=yield x.blob();throw new ae(x.status,x.statusText,c.url,E)}let b;b=c.type==="arrayBuffer"||c.type==="image"?x.arrayBuffer():c.type==="json"?x.json():x.text();const S=yield b;if(f.signal.aborted)throw fr();return{data:S,cacheControl:x.headers.get("Cache-Control"),expires:x.headers.get("Expires")}})}(s,e);if(ze(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,mustQueue:!0,targetMapId:kt},e)}var n;return function(c,f){return new Promise((v,x)=>{const b=new XMLHttpRequest;b.open(c.method||"GET",c.url,!0),c.type!=="arrayBuffer"&&c.type!=="image"||(b.responseType="arraybuffer");for(const S in c.headers)b.setRequestHeader(S,c.headers[S]);c.type==="json"&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials=c.credentials==="include",b.onerror=()=>{x(new Error(b.statusText))},b.onload=()=>{if(!f.signal.aborted)if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){let S=b.response;if(c.type==="json")try{S=JSON.parse(b.response)}catch(E){return void x(E)}v({data:S,cacheControl:b.getResponseHeader("Cache-Control"),expires:b.getResponseHeader("Expires")})}else{const S=new Blob([b.response],{type:b.getResponseHeader("Content-Type")});x(new ae(b.status,b.statusText,c.url,S))}},f.signal.addEventListener("abort",()=>{b.abort(),x(fr())}),b.send(c.body)})}(s,e)};function ni(s){if(!s||s.indexOf("://")<=0||s.indexOf("data:image/")===0||s.indexOf("blob:")===0)return!0;const e=new URL(s),n=window.location;return e.protocol===n.protocol&&e.host===n.host}function ai(s,e,n){n[s]&&n[s].indexOf(e)!==-1||(n[s]=n[s]||[],n[s].push(e))}function Q(s,e,n){if(n&&n[s]){const c=n[s].indexOf(e);c!==-1&&n[s].splice(c,1)}}class rt{constructor(e,n={}){ce(this,n),this.type=e}}class Mt extends rt{constructor(e,n={}){super("error",ce({error:e},n))}}class Ft{on(e,n){return this._listeners=this._listeners||{},ai(e,n,this._listeners),this}off(e,n){return Q(e,n,this._listeners),Q(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},ai(e,n,this._oneTimeListeners),this):new Promise(c=>this.once(e,c))}fire(e,n){typeof e=="string"&&(e=new rt(e,n||{}));const c=e.type;if(this.listens(c)){e.target=this;const f=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const b of f)b.call(this,e);const v=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const b of v)Q(c,b,this._oneTimeListeners),b.call(this,e);const x=this._eventedParent;x&&(ce(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(e))}else e instanceof Mt&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var it={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Xt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ne(s,e){const n={};for(const c in s)c!=="ref"&&(n[c]=s[c]);return Xt.forEach(c=>{c in e&&(n[c]=e[c])}),n}function Pt(s,e){if(Array.isArray(s)){if(!Array.isArray(e)||s.length!==e.length)return!1;for(let n=0;n<s.length;n++)if(!Pt(s[n],e[n]))return!1;return!0}if(typeof s=="object"&&s!==null&&e!==null){if(typeof e!="object"||Object.keys(s).length!==Object.keys(e).length)return!1;for(const n in s)if(!Pt(s[n],e[n]))return!1;return!0}return s===e}function qt(s,e){s.push(e)}function Vt(s,e,n){qt(n,{command:"addSource",args:[s,e[s]]})}function ue(s,e,n){qt(e,{command:"removeSource",args:[s]}),n[s]=!0}function Ee(s,e,n,c){ue(s,n,c),Vt(s,e,n)}function we(s,e,n){let c;for(c in s[n])if(Object.prototype.hasOwnProperty.call(s[n],c)&&c!=="data"&&!Pt(s[n][c],e[n][c]))return!1;for(c in e[n])if(Object.prototype.hasOwnProperty.call(e[n],c)&&c!=="data"&&!Pt(s[n][c],e[n][c]))return!1;return!0}function De(s,e,n,c,f,v){s=s||{},e=e||{};for(const x in s)Object.prototype.hasOwnProperty.call(s,x)&&(Pt(s[x],e[x])||n.push({command:v,args:[c,x,e[x],f]}));for(const x in e)Object.prototype.hasOwnProperty.call(e,x)&&!Object.prototype.hasOwnProperty.call(s,x)&&(Pt(s[x],e[x])||n.push({command:v,args:[c,x,e[x],f]}))}function Xe(s){return s.id}function ii(s,e){return s[e.id]=e,s}class Rt{constructor(e,n,c,f){this.message=(e?`${e}: `:"")+c,f&&(this.identifier=f),n!=null&&n.__line__&&(this.line=n.__line__)}}function gi(s,...e){for(const n of e)for(const c in n)s[c]=n[c];return s}class Ci extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class pr{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[c,f]of n)this.bindings[c]=f}concat(e){return new pr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const as={kind:"null"},Gt={kind:"number"},Oe={kind:"string"},Se={kind:"boolean"},ui={kind:"color"},tr={kind:"object"},Be={kind:"value"},Rn={kind:"collator"},os={kind:"formatted"},Y={kind:"padding"},F={kind:"resolvedImage"},N={kind:"variableAnchorOffsetCollection"};function q(s,e){return{kind:"array",itemType:s,N:e}}function H(s){if(s.kind==="array"){const e=H(s.itemType);return typeof s.N=="number"?`array<${e}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${e}>`}return s.kind}const ht=[as,Gt,Oe,Se,ui,os,tr,q(Be),Y,F,N];function dt(s,e){if(e.kind==="error")return null;if(s.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!dt(s.itemType,e.itemType))&&(typeof s.N!="number"||s.N===e.N))return null}else{if(s.kind===e.kind)return null;if(s.kind==="value"){for(const n of ht)if(!dt(n,e))return null}}return`Expected ${H(s)} but found ${H(e)} instead.`}function mt(s,e){return e.some(n=>n.kind===s.kind)}function at(s,e){return e.some(n=>n==="null"?s===null:n==="array"?Array.isArray(s):n==="object"?s&&!Array.isArray(s)&&typeof s=="object":n===typeof s)}function _t(s,e){return s.kind==="array"&&e.kind==="array"?s.itemType.kind===e.itemType.kind&&typeof s.N=="number":s.kind===e.kind}const zt=.96422,Et=.82521,It=4/29,be=6/29,Te=3*be*be,Ne=be*be*be,Re=Math.PI/180,Qe=180/Math.PI;function _i(s){return(s%=360)<0&&(s+=360),s}function Di([s,e,n,c]){let f,v;const x=qe((.2225045*(s=Qi(s))+.7168786*(e=Qi(e))+.0606169*(n=Qi(n)))/1);s===e&&e===n?f=v=x:(f=qe((.4360747*s+.3850649*e+.1430804*n)/zt),v=qe((.0139322*s+.0971045*e+.7141733*n)/Et));const b=116*x-16;return[b<0?0:b,500*(f-x),200*(x-v),c]}function Qi(s){return s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function qe(s){return s>Ne?Math.pow(s,1/3):s/Te+It}function $i([s,e,n,c]){let f=(s+16)/116,v=isNaN(e)?f:f+e/500,x=isNaN(n)?f:f-n/200;return f=1*Rs(f),v=zt*Rs(v),x=Et*Rs(x),[ls(3.1338561*v-1.6168667*f-.4906146*x),ls(-.9787684*v+1.9161415*f+.033454*x),ls(.0719453*v-.2289914*f+1.4052427*x),c]}function ls(s){return(s=s<=.00304?12.92*s:1.055*Math.pow(s,1/2.4)-.055)<0?0:s>1?1:s}function Rs(s){return s>be?s*s*s:Te*(s-It)}function qs(s){return parseInt(s.padEnd(2,s),16)/255}function vs(s,e){return Or(e?s/100:s,0,1)}function Or(s,e,n){return Math.min(Math.max(e,s),n)}function Zh(s){return!s.some(Number.isNaN)}const pf={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class fi{constructor(e,n,c,f=1,v=!0){this.r=e,this.g=n,this.b=c,this.a=f,v||(this.r*=f,this.g*=f,this.b*=f,f||this.overwriteGetter("rgb",[e,n,c,f]))}static parse(e){if(e instanceof fi)return e;if(typeof e!="string")return;const n=function(c){if((c=c.toLowerCase().trim())==="transparent")return[0,0,0,0];const f=pf[c];if(f){const[x,b,S]=f;return[x/255,b/255,S/255,1]}if(c.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(c)){const x=c.length<6?1:2;let b=1;return[qs(c.slice(b,b+=x)),qs(c.slice(b,b+=x)),qs(c.slice(b,b+=x)),qs(c.slice(b,b+x)||"ff")]}if(c.startsWith("rgb")){const x=c.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[b,S,E,D,k,B,$,U,G,X,st,gt]=x,nt=[D||" ",$||" ",X].join("");if(nt==="  "||nt==="  /"||nt===",,"||nt===",,,"){const ft=[E,B,G].join(""),At=ft==="%%%"?100:ft===""?255:0;if(At){const Ct=[Or(+S/At,0,1),Or(+k/At,0,1),Or(+U/At,0,1),st?vs(+st,gt):1];if(Zh(Ct))return Ct}}return}}const v=c.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[x,b,S,E,D,k,B,$,U]=v,G=[S||" ",D||" ",B].join("");if(G==="  "||G==="  /"||G===",,"||G===",,,"){const X=[+b,Or(+E,0,100),Or(+k,0,100),$?vs(+$,U):1];if(Zh(X))return function([st,gt,nt,ft]){function At(Ct){const se=(Ct+st/30)%12,me=gt*Math.min(nt,1-nt);return nt-me*Math.max(-1,Math.min(se-3,9-se,1))}return st=_i(st),gt/=100,nt/=100,[At(0),At(8),At(4),ft]}(X)}}}(e);return n?new fi(...n,!1):void 0}get rgb(){const{r:e,g:n,b:c,a:f}=this,v=f||1/0;return this.overwriteGetter("rgb",[e/v,n/v,c/v,f])}get hcl(){return this.overwriteGetter("hcl",function(e){const[n,c,f,v]=Di(e),x=Math.sqrt(c*c+f*f);return[Math.round(1e4*x)?_i(Math.atan2(f,c)*Qe):NaN,x,n,v]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Di(this.rgb))}overwriteGetter(e,n){return Object.defineProperty(this,e,{value:n}),n}toString(){const[e,n,c,f]=this.rgb;return`rgba(${[e,n,c].map(v=>Math.round(255*v)).join(",")},${f})`}}fi.black=new fi(0,0,0,1),fi.white=new fi(1,1,1,1),fi.transparent=new fi(0,0,0,0),fi.red=new fi(1,0,0,1);class Jl{constructor(e,n,c){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ql{constructor(e,n,c,f,v){this.text=e,this.image=n,this.scale=c,this.fontStack=f,this.textColor=v}}class er{constructor(e){this.sections=e}static fromString(e){return new er([new Ql(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof er?e:er.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class js{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof js)return e;if(typeof e=="number")return new js([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const n of e)if(typeof n!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new js(e)}}toString(){return JSON.stringify(this.values)}}const $a=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class mr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof mr)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let n=0;n<e.length;n+=2){const c=e[n],f=e[n+1];if(typeof c!="string"||!$a.has(c)||!Array.isArray(f)||f.length!==2||typeof f[0]!="number"||typeof f[1]!="number")return}return new mr(e)}}toString(){return JSON.stringify(this.values)}}class gr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new gr({name:e,available:!1}):null}}function sa(s,e,n,c){return typeof s=="number"&&s>=0&&s<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[s,e,n,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[s,e,n,c]:[s,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Io(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof fi||s instanceof Jl||s instanceof er||s instanceof js||s instanceof mr||s instanceof gr)return!0;if(Array.isArray(s)){for(const e of s)if(!Io(e))return!1;return!0}if(typeof s=="object"){for(const e in s)if(!Io(s[e]))return!1;return!0}return!1}function ts(s){if(s===null)return as;if(typeof s=="string")return Oe;if(typeof s=="boolean")return Se;if(typeof s=="number")return Gt;if(s instanceof fi)return ui;if(s instanceof Jl)return Rn;if(s instanceof er)return os;if(s instanceof js)return Y;if(s instanceof mr)return N;if(s instanceof gr)return F;if(Array.isArray(s)){const e=s.length;let n;for(const c of s){const f=ts(c);if(n){if(n===f)continue;n=Be;break}n=f}return q(n||Be,e)}return tr}function Va(s){const e=typeof s;return s===null?"":e==="string"||e==="number"||e==="boolean"?String(s):s instanceof fi||s instanceof er||s instanceof js||s instanceof mr||s instanceof gr?s.toString():JSON.stringify(s)}class un{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Io(e[1]))return n.error("invalid value");const c=e[1];let f=ts(c);const v=n.expectedType;return f.kind!=="array"||f.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(f=v),new un(f,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Oi{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Po={string:Oe,number:Gt,boolean:Se,object:tr};class ir{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let c,f=1;const v=e[0];if(v==="array"){let b,S;if(e.length>2){const E=e[1];if(typeof E!="string"||!(E in Po)||E==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);b=Po[E],f++}else b=Be;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);S=e[2],f++}c=q(b,S)}else{if(!Po[v])throw new Error(`Types doesn't contain name = ${v}`);c=Po[v]}const x=[];for(;f<e.length;f++){const b=n.parse(e[f],f,Be);if(!b)return null;x.push(b)}return new ir(c,x)}evaluate(e){for(let n=0;n<this.args.length;n++){const c=this.args[n].evaluate(e);if(!dt(this.type,ts(c)))return c;if(n===this.args.length-1)throw new Oi(`Expected value to be of type ${H(this.type)}, but found ${H(ts(c))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Co={"to-boolean":Se,"to-color":ui,"to-number":Gt,"to-string":Oe};class Fr{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const c=e[0];if(!Co[c])throw new Error(`Can't parse ${c} as it is not part of the known types`);if((c==="to-boolean"||c==="to-string")&&e.length!==2)return n.error("Expected one argument.");const f=Co[c],v=[];for(let x=1;x<e.length;x++){const b=n.parse(e[x],x,Be);if(!b)return null;v.push(b)}return new Fr(f,v)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let n,c;for(const f of this.args){if(n=f.evaluate(e),c=null,n instanceof fi)return n;if(typeof n=="string"){const v=e.parseColor(n);if(v)return v}else if(Array.isArray(n)&&(c=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:sa(n[0],n[1],n[2],n[3]),!c))return new fi(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Oi(c||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const c of this.args){n=c.evaluate(e);const f=js.parse(n);if(f)return f}throw new Oi(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const c of this.args){n=c.evaluate(e);const f=mr.parse(n);if(f)return f}throw new Oi(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const c of this.args){if(n=c.evaluate(e),n===null)return 0;const f=Number(n);if(!isNaN(f))return f}throw new Oi(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return er.fromString(Va(this.args[0].evaluate(e)));case"resolvedImage":return gr.fromString(Va(this.args[0].evaluate(e)));default:return Va(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Ua=["Unknown","Point","LineString","Polygon"];class pi{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ua[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=fi.parse(e)),n}}class Do{constructor(e,n,c=[],f,v=new pr,x=[]){this.registry=e,this.path=c,this.key=c.map(b=>`[${b}]`).join(""),this.scope=v,this.errors=x,this.expectedType=f,this._isConstant=n}parse(e,n,c,f,v={}){return n?this.concat(n,c,f)._parse(e,v):this._parse(e,v)}_parse(e,n){function c(f,v,x){return x==="assert"?new ir(v,[f]):x==="coerce"?new Fr(v,[f]):f}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=e[0];if(typeof f!="string")return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[f];if(v){let x=v.parse(e,this);if(!x)return null;if(this.expectedType){const b=this.expectedType,S=x.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||S.kind!=="value")if(b.kind!=="color"&&b.kind!=="formatted"&&b.kind!=="resolvedImage"||S.kind!=="value"&&S.kind!=="string")if(b.kind!=="padding"||S.kind!=="value"&&S.kind!=="number"&&S.kind!=="array")if(b.kind!=="variableAnchorOffsetCollection"||S.kind!=="value"&&S.kind!=="array"){if(this.checkSubtype(b,S))return null}else x=c(x,b,n.typeAnnotation||"coerce");else x=c(x,b,n.typeAnnotation||"coerce");else x=c(x,b,n.typeAnnotation||"coerce");else x=c(x,b,n.typeAnnotation||"assert")}if(!(x instanceof un)&&x.type.kind!=="resolvedImage"&&this._isConstant(x)){const b=new pi;try{x=new un(x.type,x.evaluate(b))}catch(S){return this.error(S.message),null}}return x}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,c){const f=typeof e=="number"?this.path.concat(e):this.path,v=c?this.scope.concat(c):this.scope;return new Do(this.registry,this._isConstant,f,n||null,v,this.errors)}error(e,...n){const c=`${this.key}${n.map(f=>`[${f}]`).join("")}`;this.errors.push(new Ci(c,e))}checkSubtype(e,n){const c=dt(e,n);return c&&this.error(c),c}}class ra{constructor(e,n,c){this.type=Rn,this.locale=c,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const c=e[1];if(typeof c!="object"||Array.isArray(c))return n.error("Collator options argument must be an object.");const f=n.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,Se);if(!f)return null;const v=n.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,Se);if(!v)return null;let x=null;return c.locale&&(x=n.parse(c.locale,1,Oe),!x)?null:new ra(f,v,x)}evaluate(e){return new Jl(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const dn=8192;function ko(s,e){s[0]=Math.min(s[0],e[0]),s[1]=Math.min(s[1],e[1]),s[2]=Math.max(s[2],e[0]),s[3]=Math.max(s[3],e[1])}function qa(s,e){return!(s[0]<=e[0]||s[2]>=e[2]||s[1]<=e[1]||s[3]>=e[3])}function mf(s,e){const n=(180+s[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,f=Math.pow(2,e.z);return[Math.round(n*f*dn),Math.round(c*f*dn)]}function Xh(s,e,n){const c=s[0]-e[0],f=s[1]-e[1],v=s[0]-n[0],x=s[1]-n[1];return c*x-v*f==0&&c*v<=0&&f*x<=0}function Ro(s,e){let n=!1;for(let x=0,b=e.length;x<b;x++){const S=e[x];for(let E=0,D=S.length;E<D-1;E++){if(Xh(s,S[E],S[E+1]))return!1;(f=S[E])[1]>(c=s)[1]!=(v=S[E+1])[1]>c[1]&&c[0]<(v[0]-f[0])*(c[1]-f[1])/(v[1]-f[1])+f[0]&&(n=!n)}}var c,f,v;return n}function gf(s,e){for(let n=0;n<e.length;n++)if(Ro(s,e[n]))return!0;return!1}function Kh(s,e,n,c){const f=c[0]-n[0],v=c[1]-n[1],x=(s[0]-n[0])*v-f*(s[1]-n[1]),b=(e[0]-n[0])*v-f*(e[1]-n[1]);return x>0&&b<0||x<0&&b>0}function _f(s,e,n){for(const E of n)for(let D=0;D<E.length-1;++D)if((b=[(x=E[D+1])[0]-(v=E[D])[0],x[1]-v[1]])[0]*(S=[(f=e)[0]-(c=s)[0],f[1]-c[1]])[1]-b[1]*S[0]!=0&&Kh(c,f,v,x)&&Kh(v,x,c,f))return!0;var c,f,v,x,b,S;return!1}function Yh(s,e){for(let n=0;n<s.length;++n)if(!Ro(s[n],e))return!1;for(let n=0;n<s.length-1;++n)if(_f(s[n],s[n+1],e))return!1;return!0}function Jh(s,e){for(let n=0;n<e.length;n++)if(Yh(s,e[n]))return!0;return!1}function zo(s,e,n){const c=[];for(let f=0;f<s.length;f++){const v=[];for(let x=0;x<s[f].length;x++){const b=mf(s[f][x],n);ko(e,b),v.push(b)}c.push(v)}return c}function Qh(s,e,n){const c=[];for(let f=0;f<s.length;f++){const v=zo(s[f],e,n);c.push(v)}return c}function tu(s,e,n,c){if(s[0]<n[0]||s[0]>n[2]){const f=.5*c;let v=s[0]-n[0]>f?-c:n[0]-s[0]>f?c:0;v===0&&(v=s[0]-n[2]>f?-c:n[2]-s[0]>f?c:0),s[0]+=v}ko(e,s)}function Lo(s,e,n,c){const f=Math.pow(2,c.z)*dn,v=[c.x*dn,c.y*dn],x=[];for(const b of s)for(const S of b){const E=[S.x+v[0],S.y+v[1]];tu(E,e,n,f),x.push(E)}return x}function eu(s,e,n,c){const f=Math.pow(2,c.z)*dn,v=[c.x*dn,c.y*dn],x=[];for(const S of s){const E=[];for(const D of S){const k=[D.x+v[0],D.y+v[1]];ko(e,k),E.push(k)}x.push(E)}if(e[2]-e[0]<=f/2){(b=e)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const S of x)for(const E of S)tu(E,e,n,f)}var b;return x}class zn{constructor(e,n){this.type=Se,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Io(e[1])){const c=e[1];if(c.type==="FeatureCollection"){const f=[];for(const v of c.features){const{type:x,coordinates:b}=v.geometry;x==="Polygon"&&f.push(b),x==="MultiPolygon"&&f.push(...b)}if(f.length)return new zn(c,{type:"MultiPolygon",coordinates:f})}else if(c.type==="Feature"){const f=c.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new zn(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new zn(c,c)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,c){const f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=n.canonicalID();if(c.type==="Polygon"){const b=zo(c.coordinates,v,x),S=Lo(n.geometry(),f,v,x);if(!qa(f,v))return!1;for(const E of S)if(!Ro(E,b))return!1}if(c.type==="MultiPolygon"){const b=Qh(c.coordinates,v,x),S=Lo(n.geometry(),f,v,x);if(!qa(f,v))return!1;for(const E of S)if(!gf(E,b))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,c){const f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=n.canonicalID();if(c.type==="Polygon"){const b=zo(c.coordinates,v,x),S=eu(n.geometry(),f,v,x);if(!qa(f,v))return!1;for(const E of S)if(!Yh(E,b))return!1}if(c.type==="MultiPolygon"){const b=Qh(c.coordinates,v,x),S=eu(n.geometry(),f,v,x);if(!qa(f,v))return!1;for(const E of S)if(!Jh(E,b))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Oo{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const c=e[1];return n.scope.has(c)?new Oo(c,n.scope.get(c)):n.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class sr{constructor(e,n,c,f){this.name=e,this.type=n,this._evaluate=c,this.args=f}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,n){const c=e[0],f=sr.definitions[c];if(!f)return n.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(f)?f[0]:f.type,x=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,b=x.filter(([E])=>!Array.isArray(E)||E.length===e.length-1);let S=null;for(const[E,D]of b){S=new Do(n.registry,ja,n.path,null,n.scope);const k=[];let B=!1;for(let $=1;$<e.length;$++){const U=e[$],G=Array.isArray(E)?E[$-1]:E.type,X=S.parse(U,1+k.length,G);if(!X){B=!0;break}k.push(X)}if(!B)if(Array.isArray(E)&&E.length!==k.length)S.error(`Expected ${E.length} arguments, but found ${k.length} instead.`);else{for(let $=0;$<k.length;$++){const U=Array.isArray(E)?E[$]:E.type,G=k[$];S.concat($+1).checkSubtype(U,G.type)}if(S.errors.length===0)return new sr(c,v,D,k)}}if(b.length===1)n.errors.push(...S.errors);else{const E=(b.length?b:x).map(([k])=>{return B=k,Array.isArray(B)?`(${B.map(H).join(", ")})`:`(${H(B.type)}...)`;var B}).join(" | "),D=[];for(let k=1;k<e.length;k++){const B=n.parse(e[k],1+D.length);if(!B)return null;D.push(H(B.type))}n.error(`Expected arguments of type ${E}, but found (${D.join(", ")}) instead.`)}return null}static register(e,n){sr.definitions=n;for(const c in n)e[c]=sr}}function ja(s){if(s instanceof Oo)return ja(s.boundExpression);if(s instanceof sr&&s.name==="error"||s instanceof ra||s instanceof zn)return!1;const e=s instanceof Fr||s instanceof ir;let n=!0;return s.eachChild(c=>{n=e?n&&ja(c):n&&c instanceof un}),!!n&&Fo(s)&&Ha(s,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Fo(s){if(s instanceof sr&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof zn)return!1;let e=!0;return s.eachChild(n=>{e&&!Fo(n)&&(e=!1)}),e}function Ga(s){if(s instanceof sr&&s.name==="feature-state")return!1;let e=!0;return s.eachChild(n=>{e&&!Ga(n)&&(e=!1)}),e}function Ha(s,e){if(s instanceof sr&&e.indexOf(s.name)>=0)return!1;let n=!0;return s.eachChild(c=>{n&&!Ha(c,e)&&(n=!1)}),n}function Wa(s,e){const n=s.length-1;let c,f,v=0,x=n,b=0;for(;v<=x;)if(b=Math.floor((v+x)/2),c=s[b],f=s[b+1],c<=e){if(b===n||e<f)return b;v=b+1}else{if(!(c>e))throw new Oi("Input is not a number.");x=b-1}return 0}class Za{constructor(e,n,c){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[f,v]of c)this.labels.push(f),this.outputs.push(v)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const c=n.parse(e[1],1,Gt);if(!c)return null;const f=[];let v=null;n.expectedType&&n.expectedType.kind!=="value"&&(v=n.expectedType);for(let x=1;x<e.length;x+=2){const b=x===1?-1/0:e[x],S=e[x+1],E=x,D=x+1;if(typeof b!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(f.length&&f[f.length-1][0]>=b)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const k=n.parse(S,D,v);if(!k)return null;v=v||k.type,f.push([b,k])}return new Za(v,c,f)}evaluate(e){const n=this.labels,c=this.outputs;if(n.length===1)return c[0].evaluate(e);const f=this.input.evaluate(e);if(f<=n[0])return c[0].evaluate(e);const v=n.length;return f>=n[v-1]?c[v-1].evaluate(e):c[Wa(n,f)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function yf(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var vf=iu;function iu(s,e,n,c){this.cx=3*s,this.bx=3*(n-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(c-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=e,this.p2x=n,this.p2y=c}iu.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,e){if(e===void 0&&(e=1e-6),s<0)return 0;if(s>1)return 1;for(var n=s,c=0;c<8;c++){var f=this.sampleCurveX(n)-s;if(Math.abs(f)<e)return n;var v=this.sampleCurveDerivativeX(n);if(Math.abs(v)<1e-6)break;n-=f/v}var x=0,b=1;for(n=s,c=0;c<20&&(f=this.sampleCurveX(n),!(Math.abs(f-s)<e));c++)s>f?x=n:b=n,n=.5*(b-x)+x;return n},solve:function(s,e){return this.sampleCurveY(this.solveCurveX(s,e))}};var xf=yf(vf);function Ln(s,e,n){return s+n*(e-s)}function Bo(s,e,n){return s.map((c,f)=>Ln(c,e[f],n))}const zs={number:Ln,color:function(s,e,n,c="rgb"){switch(c){case"rgb":{const[f,v,x,b]=Bo(s.rgb,e.rgb,n);return new fi(f,v,x,b,!1)}case"hcl":{const[f,v,x,b]=s.hcl,[S,E,D,k]=e.hcl;let B,$;if(isNaN(f)||isNaN(S))isNaN(f)?isNaN(S)?B=NaN:(B=S,x!==1&&x!==0||($=E)):(B=f,D!==1&&D!==0||($=v));else{let gt=S-f;S>f&&gt>180?gt-=360:S<f&&f-S>180&&(gt+=360),B=f+n*gt}const[U,G,X,st]=function([gt,nt,ft,At]){return gt=isNaN(gt)?0:gt*Re,$i([ft,Math.cos(gt)*nt,Math.sin(gt)*nt,At])}([B,$??Ln(v,E,n),Ln(x,D,n),Ln(b,k,n)]);return new fi(U,G,X,st,!1)}case"lab":{const[f,v,x,b]=$i(Bo(s.lab,e.lab,n));return new fi(f,v,x,b,!1)}}},array:Bo,padding:function(s,e,n){return new js(Bo(s.values,e.values,n))},variableAnchorOffsetCollection:function(s,e,n){const c=s.values,f=e.values;if(c.length!==f.length)throw new Oi(`Cannot interpolate values of different length. from: ${s.toString()}, to: ${e.toString()}`);const v=[];for(let x=0;x<c.length;x+=2){if(c[x]!==f[x])throw new Oi(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${c[x]}, to[${x}]: ${f[x]}`);v.push(c[x]);const[b,S]=c[x+1],[E,D]=f[x+1];v.push([Ln(b,E,n),Ln(S,D,n)])}return new mr(v)}};class Es{constructor(e,n,c,f,v){this.type=e,this.operator=n,this.interpolation=c,this.input=f,this.labels=[],this.outputs=[];for(const[x,b]of v)this.labels.push(x),this.outputs.push(b)}static interpolationFactor(e,n,c,f){let v=0;if(e.name==="exponential")v=oi(n,e.base,c,f);else if(e.name==="linear")v=oi(n,1,c,f);else if(e.name==="cubic-bezier"){const x=e.controlPoints;v=new xf(x[0],x[1],x[2],x[3]).solve(oi(n,1,c,f))}return v}static parse(e,n){let[c,f,v,...x]=e;if(!Array.isArray(f)||f.length===0)return n.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){const E=f[1];if(typeof E!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:E}}else{if(f[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const E=f.slice(1);if(E.length!==4||E.some(D=>typeof D!="number"||D<0||D>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:E}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(v=n.parse(v,2,Gt),!v)return null;const b=[];let S=null;c==="interpolate-hcl"||c==="interpolate-lab"?S=ui:n.expectedType&&n.expectedType.kind!=="value"&&(S=n.expectedType);for(let E=0;E<x.length;E+=2){const D=x[E],k=x[E+1],B=E+3,$=E+4;if(typeof D!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(b.length&&b[b.length-1][0]>=D)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',B);const U=n.parse(k,$,S);if(!U)return null;S=S||U.type,b.push([D,U])}return _t(S,Gt)||_t(S,ui)||_t(S,Y)||_t(S,N)||_t(S,q(Gt))?new Es(S,c,f,v,b):n.error(`Type ${H(S)} is not interpolatable.`)}evaluate(e){const n=this.labels,c=this.outputs;if(n.length===1)return c[0].evaluate(e);const f=this.input.evaluate(e);if(f<=n[0])return c[0].evaluate(e);const v=n.length;if(f>=n[v-1])return c[v-1].evaluate(e);const x=Wa(n,f),b=Es.interpolationFactor(this.interpolation,f,n[x],n[x+1]),S=c[x].evaluate(e),E=c[x+1].evaluate(e);switch(this.operator){case"interpolate":return zs[this.type.kind](S,E,b);case"interpolate-hcl":return zs.color(S,E,b,"hcl");case"interpolate-lab":return zs.color(S,E,b,"lab")}}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function oi(s,e,n,c){const f=c-n,v=s-n;return f===0?0:e===1?v/f:(Math.pow(e,v)-1)/(Math.pow(e,f)-1)}class No{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let c=null;const f=n.expectedType;f&&f.kind!=="value"&&(c=f);const v=[];for(const b of e.slice(1)){const S=n.parse(b,1+v.length,c,void 0,{typeAnnotation:"omit"});if(!S)return null;c=c||S.type,v.push(S)}if(!c)throw new Error("No output type");const x=f&&v.some(b=>dt(f,b.type));return new No(x?Be:c,v)}evaluate(e){let n,c=null,f=0;for(const v of this.args)if(f++,c=v.evaluate(e),c&&c instanceof gr&&!c.available&&(n||(n=c.name),c=null,f===this.args.length&&(c=n)),c!==null)break;return c}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class $o{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const c=[];for(let v=1;v<e.length-1;v+=2){const x=e[v];if(typeof x!="string")return n.error(`Expected string, but found ${typeof x} instead.`,v);if(/[^a-zA-Z0-9_]/.test(x))return n.error("Variable names must contain only alphanumeric characters or '_'.",v);const b=n.parse(e[v+1],v+1);if(!b)return null;c.push([x,b])}const f=n.parse(e[e.length-1],e.length-1,n.expectedType,c);return f?new $o(c,f):null}outputDefined(){return this.result.outputDefined()}}class tc{constructor(e,n,c){this.type=e,this.index=n,this.input=c}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const c=n.parse(e[1],1,Gt),f=n.parse(e[2],2,q(n.expectedType||Be));return c&&f?new tc(f.type.itemType,c,f):null}evaluate(e){const n=this.index.evaluate(e),c=this.input.evaluate(e);if(n<0)throw new Oi(`Array index out of bounds: ${n} < 0.`);if(n>=c.length)throw new Oi(`Array index out of bounds: ${n} > ${c.length-1}.`);if(n!==Math.floor(n))throw new Oi(`Array index must be an integer, but found ${n} instead.`);return c[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class ec{constructor(e,n){this.type=Se,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const c=n.parse(e[1],1,Be),f=n.parse(e[2],2,Be);return c&&f?mt(c.type,[Se,Oe,Gt,as,Be])?new ec(c,f):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${H(c.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(!c)return!1;if(!at(n,["boolean","string","number","null"]))throw new Oi(`Expected first argument to be of type boolean, string, number or null, but found ${H(ts(n))} instead.`);if(!at(c,["string","array"]))throw new Oi(`Expected second argument to be of type array or string, but found ${H(ts(c))} instead.`);return c.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Vo{constructor(e,n,c){this.type=Gt,this.needle=e,this.haystack=n,this.fromIndex=c}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const c=n.parse(e[1],1,Be),f=n.parse(e[2],2,Be);if(!c||!f)return null;if(!mt(c.type,[Se,Oe,Gt,as,Be]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${H(c.type)} instead`);if(e.length===4){const v=n.parse(e[3],3,Gt);return v?new Vo(c,f,v):null}return new Vo(c,f)}evaluate(e){const n=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(!at(n,["boolean","string","number","null"]))throw new Oi(`Expected first argument to be of type boolean, string, number or null, but found ${H(ts(n))} instead.`);if(!at(c,["string","array"]))throw new Oi(`Expected second argument to be of type array or string, but found ${H(ts(c))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(e);return c.indexOf(n,f)}return c.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class ic{constructor(e,n,c,f,v,x){this.inputType=e,this.type=n,this.input=c,this.cases=f,this.outputs=v,this.otherwise=x}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let c,f;n.expectedType&&n.expectedType.kind!=="value"&&(f=n.expectedType);const v={},x=[];for(let E=2;E<e.length-1;E+=2){let D=e[E];const k=e[E+1];Array.isArray(D)||(D=[D]);const B=n.concat(E);if(D.length===0)return B.error("Expected at least one branch label.");for(const U of D){if(typeof U!="number"&&typeof U!="string")return B.error("Branch labels must be numbers or strings.");if(typeof U=="number"&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return B.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof U=="number"&&Math.floor(U)!==U)return B.error("Numeric branch labels must be integer values.");if(c){if(B.checkSubtype(c,ts(U)))return null}else c=ts(U);if(v[String(U)]!==void 0)return B.error("Branch labels must be unique.");v[String(U)]=x.length}const $=n.parse(k,E,f);if(!$)return null;f=f||$.type,x.push($)}const b=n.parse(e[1],1,Be);if(!b)return null;const S=n.parse(e[e.length-1],e.length-1,f);return S?b.type.kind!=="value"&&n.concat(1).checkSubtype(c,b.type)?null:new ic(c,f,b,v,x,S):null}evaluate(e){const n=this.input.evaluate(e);return(ts(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class sc{constructor(e,n,c){this.type=e,this.branches=n,this.otherwise=c}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);const f=[];for(let x=1;x<e.length-1;x+=2){const b=n.parse(e[x],x,Se);if(!b)return null;const S=n.parse(e[x+1],x+1,c);if(!S)return null;f.push([b,S]),c=c||S.type}const v=n.parse(e[e.length-1],e.length-1,c);if(!v)return null;if(!c)throw new Error("Can't infer output type");return new sc(c,f,v)}evaluate(e){for(const[n,c]of this.branches)if(n.evaluate(e))return c.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,c]of this.branches)e(n),e(c);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class Uo{constructor(e,n,c,f){this.type=e,this.input=n,this.beginIndex=c,this.endIndex=f}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const c=n.parse(e[1],1,Be),f=n.parse(e[2],2,Gt);if(!c||!f)return null;if(!mt(c.type,[q(Be),Oe,Be]))return n.error(`Expected first argument to be of type array or string, but found ${H(c.type)} instead`);if(e.length===4){const v=n.parse(e[3],3,Gt);return v?new Uo(c.type,c,f,v):null}return new Uo(c.type,c,f)}evaluate(e){const n=this.input.evaluate(e),c=this.beginIndex.evaluate(e);if(!at(n,["string","array"]))throw new Oi(`Expected first argument to be of type array or string, but found ${H(ts(n))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(e);return n.slice(c,f)}return n.slice(c)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function su(s,e){return s==="=="||s==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function ru(s,e,n,c){return c.compare(e,n)===0}function na(s,e,n){const c=s!=="=="&&s!=="!=";return class Bx{constructor(v,x,b){this.type=Se,this.lhs=v,this.rhs=x,this.collator=b,this.hasUntypedArgument=v.type.kind==="value"||x.type.kind==="value"}static parse(v,x){if(v.length!==3&&v.length!==4)return x.error("Expected two or three arguments.");const b=v[0];let S=x.parse(v[1],1,Be);if(!S)return null;if(!su(b,S.type))return x.concat(1).error(`"${b}" comparisons are not supported for type '${H(S.type)}'.`);let E=x.parse(v[2],2,Be);if(!E)return null;if(!su(b,E.type))return x.concat(2).error(`"${b}" comparisons are not supported for type '${H(E.type)}'.`);if(S.type.kind!==E.type.kind&&S.type.kind!=="value"&&E.type.kind!=="value")return x.error(`Cannot compare types '${H(S.type)}' and '${H(E.type)}'.`);c&&(S.type.kind==="value"&&E.type.kind!=="value"?S=new ir(E.type,[S]):S.type.kind!=="value"&&E.type.kind==="value"&&(E=new ir(S.type,[E])));let D=null;if(v.length===4){if(S.type.kind!=="string"&&E.type.kind!=="string"&&S.type.kind!=="value"&&E.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(D=x.parse(v[3],3,Rn),!D)return null}return new Bx(S,E,D)}evaluate(v){const x=this.lhs.evaluate(v),b=this.rhs.evaluate(v);if(c&&this.hasUntypedArgument){const S=ts(x),E=ts(b);if(S.kind!==E.kind||S.kind!=="string"&&S.kind!=="number")throw new Oi(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${S.kind}, ${E.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const S=ts(x),E=ts(b);if(S.kind!=="string"||E.kind!=="string")return e(v,x,b)}return this.collator?n(v,x,b,this.collator.evaluate(v)):e(v,x,b)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}}}const bf=na("==",function(s,e,n){return e===n},ru),wf=na("!=",function(s,e,n){return e!==n},function(s,e,n,c){return!ru(0,e,n,c)}),Mf=na("<",function(s,e,n){return e<n},function(s,e,n,c){return c.compare(e,n)<0}),Sf=na(">",function(s,e,n){return e>n},function(s,e,n,c){return c.compare(e,n)>0}),Tf=na("<=",function(s,e,n){return e<=n},function(s,e,n,c){return c.compare(e,n)<=0}),Af=na(">=",function(s,e,n){return e>=n},function(s,e,n,c){return c.compare(e,n)>=0});class rc{constructor(e,n,c,f,v){this.type=Oe,this.number=e,this.locale=n,this.currency=c,this.minFractionDigits=f,this.maxFractionDigits=v}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const c=n.parse(e[1],1,Gt);if(!c)return null;const f=e[2];if(typeof f!="object"||Array.isArray(f))return n.error("NumberFormat options argument must be an object.");let v=null;if(f.locale&&(v=n.parse(f.locale,1,Oe),!v))return null;let x=null;if(f.currency&&(x=n.parse(f.currency,1,Oe),!x))return null;let b=null;if(f["min-fraction-digits"]&&(b=n.parse(f["min-fraction-digits"],1,Gt),!b))return null;let S=null;return f["max-fraction-digits"]&&(S=n.parse(f["max-fraction-digits"],1,Gt),!S)?null:new rc(c,v,x,b,S)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class qo{constructor(e){this.type=os,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const c=e[1];if(!Array.isArray(c)&&typeof c=="object")return n.error("First argument must be an image or text section.");const f=[];let v=!1;for(let x=1;x<=e.length-1;++x){const b=e[x];if(v&&typeof b=="object"&&!Array.isArray(b)){v=!1;let S=null;if(b["font-scale"]&&(S=n.parse(b["font-scale"],1,Gt),!S))return null;let E=null;if(b["text-font"]&&(E=n.parse(b["text-font"],1,q(Oe)),!E))return null;let D=null;if(b["text-color"]&&(D=n.parse(b["text-color"],1,ui),!D))return null;const k=f[f.length-1];k.scale=S,k.font=E,k.textColor=D}else{const S=n.parse(e[x],1,Be);if(!S)return null;const E=S.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,f.push({content:S,scale:null,font:null,textColor:null})}}return new qo(f)}evaluate(e){return new er(this.sections.map(n=>{const c=n.content.evaluate(e);return ts(c)===F?new Ql("",c,null,null,null):new Ql(Va(c),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}}class nc{constructor(e){this.type=F,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const c=n.parse(e[1],1,Oe);return c?new nc(c):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),c=gr.fromString(n);return c&&e.availableImages&&(c.available=e.availableImages.indexOf(n)>-1),c}eachChild(e){e(this.input)}outputDefined(){return!1}}class ac{constructor(e){this.type=Gt,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const c=n.parse(e[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${H(c.type)} instead.`):new ac(c):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new Oi(`Expected value to be of type string or array, but found ${H(ts(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const aa={"==":bf,"!=":wf,">":Sf,"<":Mf,">=":Af,"<=":Tf,array:ir,at:tc,boolean:ir,case:sc,coalesce:No,collator:ra,format:qo,image:nc,in:ec,"index-of":Vo,interpolate:Es,"interpolate-hcl":Es,"interpolate-lab":Es,length:ac,let:$o,literal:un,match:ic,number:ir,"number-format":rc,object:ir,slice:Uo,step:Za,string:ir,"to-boolean":Fr,"to-color":Fr,"to-number":Fr,"to-string":Fr,var:Oo,within:zn};function nu(s,[e,n,c,f]){e=e.evaluate(s),n=n.evaluate(s),c=c.evaluate(s);const v=f?f.evaluate(s):1,x=sa(e,n,c,v);if(x)throw new Oi(x);return new fi(e/255,n/255,c/255,v,!1)}function au(s,e){return s in e}function oc(s,e){const n=e[s];return n===void 0?null:n}function On(s){return{type:s}}function ou(s){return{result:"success",value:s}}function oa(s){return{result:"error",value:s}}function la(s){return s["property-type"]==="data-driven"||s["property-type"]==="cross-faded-data-driven"}function lu(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function lc(s){return!!s.expression&&s.expression.interpolated}function si(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function jo(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function Ef(s){return s}function cu(s,e){const n=e.type==="color",c=s.stops&&typeof s.stops[0][0]=="object",f=c||!(c||s.property!==void 0),v=s.type||(lc(e)?"exponential":"interval");if(n||e.type==="padding"){const D=n?fi.parse:js.parse;(s=gi({},s)).stops&&(s.stops=s.stops.map(k=>[k[0],D(k[1])])),s.default=D(s.default?s.default:e.default)}if(s.colorSpace&&(x=s.colorSpace)!=="rgb"&&x!=="hcl"&&x!=="lab")throw new Error(`Unknown color space: "${s.colorSpace}"`);var x;let b,S,E;if(v==="exponential")b=ti;else if(v==="interval")b=If;else if(v==="categorical"){b=Xi,S=Object.create(null);for(const D of s.stops)S[D[0]]=D[1];E=typeof s.stops[0][0]}else{if(v!=="identity")throw new Error(`Unknown function type "${v}"`);b=cc}if(c){const D={},k=[];for(let U=0;U<s.stops.length;U++){const G=s.stops[U],X=G[0].zoom;D[X]===void 0&&(D[X]={zoom:X,type:s.type,property:s.property,default:s.default,stops:[]},k.push(X)),D[X].stops.push([G[0].value,G[1]])}const B=[];for(const U of k)B.push([D[U].zoom,cu(D[U],e)]);const $={name:"linear"};return{kind:"composite",interpolationType:$,interpolationFactor:Es.interpolationFactor.bind(void 0,$),zoomStops:B.map(U=>U[0]),evaluate:({zoom:U},G)=>ti({stops:B,base:s.base},e,U).evaluate(U,G)}}if(f){const D=v==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:Es.interpolationFactor.bind(void 0,D),zoomStops:s.stops.map(k=>k[0]),evaluate:({zoom:k})=>b(s,e,k,S,E)}}return{kind:"source",evaluate(D,k){const B=k&&k.properties?k.properties[s.property]:void 0;return B===void 0?Xa(s.default,e.default):b(s,e,B,S,E)}}}function Xa(s,e,n){return s!==void 0?s:e!==void 0?e:n!==void 0?n:void 0}function Xi(s,e,n,c,f){return Xa(typeof n===f?c[n]:void 0,s.default,e.default)}function If(s,e,n){if(si(n)!=="number")return Xa(s.default,e.default);const c=s.stops.length;if(c===1||n<=s.stops[0][0])return s.stops[0][1];if(n>=s.stops[c-1][0])return s.stops[c-1][1];const f=Wa(s.stops.map(v=>v[0]),n);return s.stops[f][1]}function ti(s,e,n){const c=s.base!==void 0?s.base:1;if(si(n)!=="number")return Xa(s.default,e.default);const f=s.stops.length;if(f===1||n<=s.stops[0][0])return s.stops[0][1];if(n>=s.stops[f-1][0])return s.stops[f-1][1];const v=Wa(s.stops.map(D=>D[0]),n),x=function(D,k,B,$){const U=$-B,G=D-B;return U===0?0:k===1?G/U:(Math.pow(k,G)-1)/(Math.pow(k,U)-1)}(n,c,s.stops[v][0],s.stops[v+1][0]),b=s.stops[v][1],S=s.stops[v+1][1],E=zs[e.type]||Ef;return typeof b.evaluate=="function"?{evaluate(...D){const k=b.evaluate.apply(void 0,D),B=S.evaluate.apply(void 0,D);if(k!==void 0&&B!==void 0)return E(k,B,x,s.colorSpace)}}:E(b,S,x,s.colorSpace)}function cc(s,e,n){switch(e.type){case"color":n=fi.parse(n);break;case"formatted":n=er.fromString(n.toString());break;case"resolvedImage":n=gr.fromString(n.toString());break;case"padding":n=js.parse(n);break;default:si(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0)}return Xa(n,s.default,e.default)}sr.register(aa,{error:[{kind:"error"},[Oe],(s,[e])=>{throw new Oi(e.evaluate(s))}],typeof:[Oe,[Be],(s,[e])=>H(ts(e.evaluate(s)))],"to-rgba":[q(Gt,4),[ui],(s,[e])=>{const[n,c,f,v]=e.evaluate(s).rgb;return[255*n,255*c,255*f,v]}],rgb:[ui,[Gt,Gt,Gt],nu],rgba:[ui,[Gt,Gt,Gt,Gt],nu],has:{type:Se,overloads:[[[Oe],(s,[e])=>au(e.evaluate(s),s.properties())],[[Oe,tr],(s,[e,n])=>au(e.evaluate(s),n.evaluate(s))]]},get:{type:Be,overloads:[[[Oe],(s,[e])=>oc(e.evaluate(s),s.properties())],[[Oe,tr],(s,[e,n])=>oc(e.evaluate(s),n.evaluate(s))]]},"feature-state":[Be,[Oe],(s,[e])=>oc(e.evaluate(s),s.featureState||{})],properties:[tr,[],s=>s.properties()],"geometry-type":[Oe,[],s=>s.geometryType()],id:[Be,[],s=>s.id()],zoom:[Gt,[],s=>s.globals.zoom],"heatmap-density":[Gt,[],s=>s.globals.heatmapDensity||0],"line-progress":[Gt,[],s=>s.globals.lineProgress||0],accumulated:[Be,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[Gt,On(Gt),(s,e)=>{let n=0;for(const c of e)n+=c.evaluate(s);return n}],"*":[Gt,On(Gt),(s,e)=>{let n=1;for(const c of e)n*=c.evaluate(s);return n}],"-":{type:Gt,overloads:[[[Gt,Gt],(s,[e,n])=>e.evaluate(s)-n.evaluate(s)],[[Gt],(s,[e])=>-e.evaluate(s)]]},"/":[Gt,[Gt,Gt],(s,[e,n])=>e.evaluate(s)/n.evaluate(s)],"%":[Gt,[Gt,Gt],(s,[e,n])=>e.evaluate(s)%n.evaluate(s)],ln2:[Gt,[],()=>Math.LN2],pi:[Gt,[],()=>Math.PI],e:[Gt,[],()=>Math.E],"^":[Gt,[Gt,Gt],(s,[e,n])=>Math.pow(e.evaluate(s),n.evaluate(s))],sqrt:[Gt,[Gt],(s,[e])=>Math.sqrt(e.evaluate(s))],log10:[Gt,[Gt],(s,[e])=>Math.log(e.evaluate(s))/Math.LN10],ln:[Gt,[Gt],(s,[e])=>Math.log(e.evaluate(s))],log2:[Gt,[Gt],(s,[e])=>Math.log(e.evaluate(s))/Math.LN2],sin:[Gt,[Gt],(s,[e])=>Math.sin(e.evaluate(s))],cos:[Gt,[Gt],(s,[e])=>Math.cos(e.evaluate(s))],tan:[Gt,[Gt],(s,[e])=>Math.tan(e.evaluate(s))],asin:[Gt,[Gt],(s,[e])=>Math.asin(e.evaluate(s))],acos:[Gt,[Gt],(s,[e])=>Math.acos(e.evaluate(s))],atan:[Gt,[Gt],(s,[e])=>Math.atan(e.evaluate(s))],min:[Gt,On(Gt),(s,e)=>Math.min(...e.map(n=>n.evaluate(s)))],max:[Gt,On(Gt),(s,e)=>Math.max(...e.map(n=>n.evaluate(s)))],abs:[Gt,[Gt],(s,[e])=>Math.abs(e.evaluate(s))],round:[Gt,[Gt],(s,[e])=>{const n=e.evaluate(s);return n<0?-Math.round(-n):Math.round(n)}],floor:[Gt,[Gt],(s,[e])=>Math.floor(e.evaluate(s))],ceil:[Gt,[Gt],(s,[e])=>Math.ceil(e.evaluate(s))],"filter-==":[Se,[Oe,Be],(s,[e,n])=>s.properties()[e.value]===n.value],"filter-id-==":[Se,[Be],(s,[e])=>s.id()===e.value],"filter-type-==":[Se,[Oe],(s,[e])=>s.geometryType()===e.value],"filter-<":[Se,[Oe,Be],(s,[e,n])=>{const c=s.properties()[e.value],f=n.value;return typeof c==typeof f&&c<f}],"filter-id-<":[Se,[Be],(s,[e])=>{const n=s.id(),c=e.value;return typeof n==typeof c&&n<c}],"filter->":[Se,[Oe,Be],(s,[e,n])=>{const c=s.properties()[e.value],f=n.value;return typeof c==typeof f&&c>f}],"filter-id->":[Se,[Be],(s,[e])=>{const n=s.id(),c=e.value;return typeof n==typeof c&&n>c}],"filter-<=":[Se,[Oe,Be],(s,[e,n])=>{const c=s.properties()[e.value],f=n.value;return typeof c==typeof f&&c<=f}],"filter-id-<=":[Se,[Be],(s,[e])=>{const n=s.id(),c=e.value;return typeof n==typeof c&&n<=c}],"filter->=":[Se,[Oe,Be],(s,[e,n])=>{const c=s.properties()[e.value],f=n.value;return typeof c==typeof f&&c>=f}],"filter-id->=":[Se,[Be],(s,[e])=>{const n=s.id(),c=e.value;return typeof n==typeof c&&n>=c}],"filter-has":[Se,[Be],(s,[e])=>e.value in s.properties()],"filter-has-id":[Se,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[Se,[q(Oe)],(s,[e])=>e.value.indexOf(s.geometryType())>=0],"filter-id-in":[Se,[q(Be)],(s,[e])=>e.value.indexOf(s.id())>=0],"filter-in-small":[Se,[Oe,q(Be)],(s,[e,n])=>n.value.indexOf(s.properties()[e.value])>=0],"filter-in-large":[Se,[Oe,q(Be)],(s,[e,n])=>function(c,f,v,x){for(;v<=x;){const b=v+x>>1;if(f[b]===c)return!0;f[b]>c?x=b-1:v=b+1}return!1}(s.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Se,overloads:[[[Se,Se],(s,[e,n])=>e.evaluate(s)&&n.evaluate(s)],[On(Se),(s,e)=>{for(const n of e)if(!n.evaluate(s))return!1;return!0}]]},any:{type:Se,overloads:[[[Se,Se],(s,[e,n])=>e.evaluate(s)||n.evaluate(s)],[On(Se),(s,e)=>{for(const n of e)if(n.evaluate(s))return!0;return!1}]]},"!":[Se,[Se],(s,[e])=>!e.evaluate(s)],"is-supported-script":[Se,[Oe],(s,[e])=>{const n=s.globals&&s.globals.isSupportedScript;return!n||n(e.evaluate(s))}],upcase:[Oe,[Oe],(s,[e])=>e.evaluate(s).toUpperCase()],downcase:[Oe,[Oe],(s,[e])=>e.evaluate(s).toLowerCase()],concat:[Oe,On(Be),(s,e)=>e.map(n=>Va(n.evaluate(s))).join("")],"resolved-locale":[Oe,[Rn],(s,[e])=>e.evaluate(s).resolvedLocale()]});class Ai{constructor(e,n){var c;this.expression=e,this._warningHistory={},this._evaluator=new pi,this._defaultValue=n?(c=n).type==="color"&&jo(c.default)?new fi(0,0,0,0):c.type==="color"?fi.parse(c.default)||null:c.type==="padding"?js.parse(c.default)||null:c.type==="variableAnchorOffsetCollection"?mr.parse(c.default)||null:c.default===void 0?null:c.default:null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,c,f,v,x){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=c,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(e,n,c,f,v,x){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=c||null,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x||null;try{const b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new Oi(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function vi(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in aa}function Fn(s,e){const n=new Do(aa,ja,[],e?function(f){const v={color:ui,string:Oe,number:Gt,enum:Oe,boolean:Se,formatted:os,padding:Y,resolvedImage:F,variableAnchorOffsetCollection:N};return f.type==="array"?q(v[f.value]||Be,f.length):v[f.type]}(e):void 0),c=n.parse(s,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?ou(new Ai(c,e)):oa(n.errors)}class Go{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!Ga(n.expression)}evaluateWithoutErrorHandling(e,n,c,f,v,x){return this._styleExpression.evaluateWithoutErrorHandling(e,n,c,f,v,x)}evaluate(e,n,c,f,v,x){return this._styleExpression.evaluate(e,n,c,f,v,x)}}class hc{constructor(e,n,c,f){this.kind=e,this.zoomStops=c,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!Ga(n.expression),this.interpolationType=f}evaluateWithoutErrorHandling(e,n,c,f,v,x){return this._styleExpression.evaluateWithoutErrorHandling(e,n,c,f,v,x)}evaluate(e,n,c,f,v,x){return this._styleExpression.evaluate(e,n,c,f,v,x)}interpolationFactor(e,n,c){return this.interpolationType?Es.interpolationFactor(this.interpolationType,e,n,c):0}}function hu(s,e){const n=Fn(s,e);if(n.result==="error")return n;const c=n.value.expression,f=Fo(c);if(!f&&!la(e))return oa([new Ci("","data expressions not supported")]);const v=Ha(c,["zoom"]);if(!v&&!lu(e))return oa([new Ci("","zoom expressions not supported")]);const x=Wo(c);return x||v?x instanceof Ci?oa([x]):x instanceof Es&&!lc(e)?oa([new Ci("",'"interpolate" expressions cannot be used with this property')]):ou(x?new hc(f?"camera":"composite",n.value,x.labels,x instanceof Es?x.interpolation:void 0):new Go(f?"constant":"source",n.value)):oa([new Ci("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ho{constructor(e,n){this._parameters=e,this._specification=n,gi(this,cu(this._parameters,this._specification))}static deserialize(e){return new Ho(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Wo(s){let e=null;if(s instanceof $o)e=Wo(s.result);else if(s instanceof No){for(const n of s.args)if(e=Wo(n),e)break}else(s instanceof Za||s instanceof Es)&&s.input instanceof sr&&s.input.name==="zoom"&&(e=s);return e instanceof Ci||s.eachChild(n=>{const c=Wo(n);c instanceof Ci?e=c:!e&&c?e=new Ci("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&c&&e!==c&&(e=new Ci("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Zo(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const e of s.slice(1))if(!Zo(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const uu={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Xo(s){if(s==null)return{filter:()=>!0,needGeometry:!1};Zo(s)||(s=Yo(s));const e=Fn(s,uu);if(e.result==="error")throw new Error(e.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,c,f)=>e.value.evaluate(n,c,{},f),needGeometry:Ko(s)}}function du(s,e){return s<e?-1:s>e?1:0}function Ko(s){if(!Array.isArray(s))return!1;if(s[0]==="within")return!0;for(let e=1;e<s.length;e++)if(Ko(s[e]))return!0;return!1}function Yo(s){if(!s)return!0;const e=s[0];return s.length<=1?e!=="any":e==="=="?uc(s[1],s[2],"=="):e==="!="?Jo(uc(s[1],s[2],"==")):e==="<"||e===">"||e==="<="||e===">="?uc(s[1],s[2],e):e==="any"?(n=s.slice(1),["any"].concat(n.map(Yo))):e==="all"?["all"].concat(s.slice(1).map(Yo)):e==="none"?["all"].concat(s.slice(1).map(Yo).map(Jo)):e==="in"?fu(s[1],s.slice(2)):e==="!in"?Jo(fu(s[1],s.slice(2))):e==="has"?pu(s[1]):e==="!has"?Jo(pu(s[1])):e!=="within"||s;var n}function uc(s,e,n){switch(s){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,s,e]}}function fu(s,e){if(e.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",s,["literal",e.sort(du)]]:["filter-in-small",s,["literal",e]]}}function pu(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function Jo(s){return["!",s]}function dc(s){const e=typeof s;if(e==="number"||e==="boolean"||e==="string"||s==null)return JSON.stringify(s);if(Array.isArray(s)){let f="[";for(const v of s)f+=`${dc(v)},`;return`${f}]`}const n=Object.keys(s).sort();let c="{";for(let f=0;f<n.length;f++)c+=`${JSON.stringify(n[f])}:${dc(s[n[f]])},`;return`${c}}`}function Pf(s){let e="";for(const n of Xt)e+=`/${dc(s[n])}`;return e}function mu(s){const e=s.value;return e?[new Rt(s.key,e,"constants have been deprecated as of v8")]:[]}function Vi(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function fn(s){if(Array.isArray(s))return s.map(fn);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const e={};for(const n in s)e[n]=fn(s[n]);return e}return Vi(s)}function Ls(s){const e=s.key,n=s.value,c=s.valueSpec||{},f=s.objectElementValidators||{},v=s.style,x=s.styleSpec,b=s.validateSpec;let S=[];const E=si(n);if(E!=="object")return[new Rt(e,n,`object expected, ${E} found`)];for(const D in n){const k=D.split(".")[0],B=c[k]||c["*"];let $;if(f[k])$=f[k];else if(c[k])$=b;else if(f["*"])$=f["*"];else{if(!c["*"]){S.push(new Rt(e,n[D],`unknown property "${D}"`));continue}$=b}S=S.concat($({key:(e&&`${e}.`)+D,value:n[D],valueSpec:B,style:v,styleSpec:x,object:n,objectKey:D,validateSpec:b},n))}for(const D in c)f[D]||c[D].required&&c[D].default===void 0&&n[D]===void 0&&S.push(new Rt(e,n,`missing required property "${D}"`));return S}function fc(s){const e=s.value,n=s.valueSpec,c=s.style,f=s.styleSpec,v=s.key,x=s.arrayElementValidator||s.validateSpec;if(si(e)!=="array")return[new Rt(v,e,`array expected, ${si(e)} found`)];if(n.length&&e.length!==n.length)return[new Rt(v,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new Rt(v,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let b={type:n.value,values:n.values};f.$version<7&&(b.function=n.function),si(n.value)==="object"&&(b=n.value);let S=[];for(let E=0;E<e.length;E++)S=S.concat(x({array:e,arrayIndex:E,value:e[E],valueSpec:b,validateSpec:s.validateSpec,style:c,styleSpec:f,key:`${v}[${E}]`}));return S}function Qo(s){const e=s.key,n=s.value,c=s.valueSpec;let f=si(n);return f==="number"&&n!=n&&(f="NaN"),f!=="number"?[new Rt(e,n,`number expected, ${f} found`)]:"minimum"in c&&n<c.minimum?[new Rt(e,n,`${n} is less than the minimum value ${c.minimum}`)]:"maximum"in c&&n>c.maximum?[new Rt(e,n,`${n} is greater than the maximum value ${c.maximum}`)]:[]}function gu(s){const e=s.valueSpec,n=Vi(s.value.type);let c,f,v,x={};const b=n!=="categorical"&&s.value.property===void 0,S=!b,E=si(s.value.stops)==="array"&&si(s.value.stops[0])==="array"&&si(s.value.stops[0][0])==="object",D=Ls({key:s.key,value:s.value,valueSpec:s.styleSpec.function,validateSpec:s.validateSpec,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function($){if(n==="identity")return[new Rt($.key,$.value,'identity function may not have a "stops" property')];let U=[];const G=$.value;return U=U.concat(fc({key:$.key,value:G,valueSpec:$.valueSpec,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec,arrayElementValidator:k})),si(G)==="array"&&G.length===0&&U.push(new Rt($.key,G,"array must have at least one stop")),U},default:function($){return $.validateSpec({key:$.key,value:$.value,valueSpec:e,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec})}}});return n==="identity"&&b&&D.push(new Rt(s.key,s.value,'missing required property "property"')),n==="identity"||s.value.stops||D.push(new Rt(s.key,s.value,'missing required property "stops"')),n==="exponential"&&s.valueSpec.expression&&!lc(s.valueSpec)&&D.push(new Rt(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(S&&!la(s.valueSpec)?D.push(new Rt(s.key,s.value,"property functions not supported")):b&&!lu(s.valueSpec)&&D.push(new Rt(s.key,s.value,"zoom functions not supported"))),n!=="categorical"&&!E||s.value.property!==void 0||D.push(new Rt(s.key,s.value,'"property" property is required')),D;function k($){let U=[];const G=$.value,X=$.key;if(si(G)!=="array")return[new Rt(X,G,`array expected, ${si(G)} found`)];if(G.length!==2)return[new Rt(X,G,`array length 2 expected, length ${G.length} found`)];if(E){if(si(G[0])!=="object")return[new Rt(X,G,`object expected, ${si(G[0])} found`)];if(G[0].zoom===void 0)return[new Rt(X,G,"object stop key must have zoom")];if(G[0].value===void 0)return[new Rt(X,G,"object stop key must have value")];if(v&&v>Vi(G[0].zoom))return[new Rt(X,G[0].zoom,"stop zoom values must appear in ascending order")];Vi(G[0].zoom)!==v&&(v=Vi(G[0].zoom),f=void 0,x={}),U=U.concat(Ls({key:`${X}[0]`,value:G[0],valueSpec:{zoom:{}},validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec,objectElementValidators:{zoom:Qo,value:B}}))}else U=U.concat(B({key:`${X}[0]`,value:G[0],valueSpec:{},validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec},G));return vi(fn(G[1]))?U.concat([new Rt(`${X}[1]`,G[1],"expressions are not allowed in function stops.")]):U.concat($.validateSpec({key:`${X}[1]`,value:G[1],valueSpec:e,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec}))}function B($,U){const G=si($.value),X=Vi($.value),st=$.value!==null?$.value:U;if(c){if(G!==c)return[new Rt($.key,st,`${G} stop domain type must match previous stop domain type ${c}`)]}else c=G;if(G!=="number"&&G!=="string"&&G!=="boolean")return[new Rt($.key,st,"stop domain value must be a number, string, or boolean")];if(G!=="number"&&n!=="categorical"){let gt=`number expected, ${G} found`;return la(e)&&n===void 0&&(gt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Rt($.key,st,gt)]}return n!=="categorical"||G!=="number"||isFinite(X)&&Math.floor(X)===X?n!=="categorical"&&G==="number"&&f!==void 0&&X<f?[new Rt($.key,st,"stop domain values must appear in ascending order")]:(f=X,n==="categorical"&&X in x?[new Rt($.key,st,"stop domain values must be unique")]:(x[X]=!0,[])):[new Rt($.key,st,`integer expected, found ${X}`)]}}function pn(s){const e=(s.expressionContext==="property"?hu:Fn)(fn(s.value),s.valueSpec);if(e.result==="error")return e.value.map(c=>new Rt(`${s.key}${c.key}`,s.value,c.message));const n=e.value.expression||e.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!n.outputDefined())return[new Rt(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!Ga(n))return[new Rt(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter"&&!Ga(n))return[new Rt(s.key,s.value,'"feature-state" data expressions are not supported with filters.')];if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!Ha(n,["zoom","feature-state"]))return[new Rt(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!Fo(n))return[new Rt(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function mn(s){const e=s.key,n=s.value,c=s.valueSpec,f=[];return Array.isArray(c.values)?c.values.indexOf(Vi(n))===-1&&f.push(new Rt(e,n,`expected one of [${c.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(c.values).indexOf(Vi(n))===-1&&f.push(new Rt(e,n,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(n)} found`)),f}function ca(s){return Zo(fn(s.value))?pn(gi({},s,{expressionContext:"filter",valueSpec:{value:"boolean"}})):pc(s)}function pc(s){const e=s.value,n=s.key;if(si(e)!=="array")return[new Rt(n,e,`array expected, ${si(e)} found`)];const c=s.styleSpec;let f,v=[];if(e.length<1)return[new Rt(n,e,"filter array must have at least 1 element")];switch(v=v.concat(mn({key:`${n}[0]`,value:e[0],valueSpec:c.filter_operator,style:s.style,styleSpec:s.styleSpec})),Vi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Vi(e[1])==="$type"&&v.push(new Rt(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&v.push(new Rt(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(f=si(e[1]),f!=="string"&&v.push(new Rt(`${n}[1]`,e[1],`string expected, ${f} found`)));for(let x=2;x<e.length;x++)f=si(e[x]),Vi(e[1])==="$type"?v=v.concat(mn({key:`${n}[${x}]`,value:e[x],valueSpec:c.geometry_type,style:s.style,styleSpec:s.styleSpec})):f!=="string"&&f!=="number"&&f!=="boolean"&&v.push(new Rt(`${n}[${x}]`,e[x],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let x=1;x<e.length;x++)v=v.concat(pc({key:`${n}[${x}]`,value:e[x],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":f=si(e[1]),e.length!==2?v.push(new Rt(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):f!=="string"&&v.push(new Rt(`${n}[1]`,e[1],`string expected, ${f} found`));break;case"within":f=si(e[1]),e.length!==2?v.push(new Rt(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):f!=="object"&&v.push(new Rt(`${n}[1]`,e[1],`object expected, ${f} found`))}return v}function tl(s,e){const n=s.key,c=s.validateSpec,f=s.style,v=s.styleSpec,x=s.value,b=s.objectKey,S=v[`${e}_${s.layerType}`];if(!S)return[];const E=b.match(/^(.*)-transition$/);if(e==="paint"&&E&&S[E[1]]&&S[E[1]].transition)return c({key:n,value:x,valueSpec:v.transition,style:f,styleSpec:v});const D=s.valueSpec||S[b];if(!D)return[new Rt(n,x,`unknown property "${b}"`)];let k;if(si(x)==="string"&&la(D)&&!D.tokens&&(k=/^{([^}]+)}$/.exec(x)))return[new Rt(n,x,`"${b}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(k[1])} }\`.`)];const B=[];return s.layerType==="symbol"&&(b==="text-field"&&f&&!f.glyphs&&B.push(new Rt(n,x,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&jo(fn(x))&&Vi(x.type)==="identity"&&B.push(new Rt(n,x,'"text-font" does not support identity functions'))),B.concat(c({key:s.key,value:x,valueSpec:D,style:f,styleSpec:v,expressionContext:"property",propertyType:e,propertyKey:b}))}function mc(s){return tl(s,"paint")}function gc(s){return tl(s,"layout")}function Ka(s){let e=[];const n=s.value,c=s.key,f=s.style,v=s.styleSpec;n.type||n.ref||e.push(new Rt(c,n,'either "type" or "ref" is required'));let x=Vi(n.type);const b=Vi(n.ref);if(n.id){const S=Vi(n.id);for(let E=0;E<s.arrayIndex;E++){const D=f.layers[E];Vi(D.id)===S&&e.push(new Rt(c,n.id,`duplicate layer id "${n.id}", previously used at line ${D.id.__line__}`))}}if("ref"in n){let S;["type","source","source-layer","filter","layout"].forEach(E=>{E in n&&e.push(new Rt(c,n[E],`"${E}" is prohibited for ref layers`))}),f.layers.forEach(E=>{Vi(E.id)===b&&(S=E)}),S?S.ref?e.push(new Rt(c,n.ref,"ref cannot reference another ref layer")):x=Vi(S.type):e.push(new Rt(c,n.ref,`ref layer "${b}" not found`))}else if(x!=="background")if(n.source){const S=f.sources&&f.sources[n.source],E=S&&Vi(S.type);S?E==="vector"&&x==="raster"?e.push(new Rt(c,n.source,`layer "${n.id}" requires a raster source`)):E!=="raster-dem"&&x==="hillshade"?e.push(new Rt(c,n.source,`layer "${n.id}" requires a raster-dem source`)):E==="raster"&&x!=="raster"?e.push(new Rt(c,n.source,`layer "${n.id}" requires a vector source`)):E!=="vector"||n["source-layer"]?E==="raster-dem"&&x!=="hillshade"?e.push(new Rt(c,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!n.paint||!n.paint["line-gradient"]||E==="geojson"&&S.lineMetrics||e.push(new Rt(c,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Rt(c,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new Rt(c,n.source,`source "${n.source}" not found`))}else e.push(new Rt(c,n,'missing required property "source"'));return e=e.concat(Ls({key:c,value:n,valueSpec:v.layer,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,objectElementValidators:{"*":()=>[],type:()=>s.validateSpec({key:`${c}.type`,value:n.type,valueSpec:v.layer.type,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,object:n,objectKey:"type"}),filter:ca,layout:S=>Ls({layer:n,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":E=>gc(gi({layerType:x},E))}}),paint:S=>Ls({layer:n,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":E=>mc(gi({layerType:x},E))}})}})),e}function Bn(s){const e=s.value,n=s.key,c=si(e);return c!=="string"?[new Rt(n,e,`string expected, ${c} found`)]:[]}const _u={promoteId:function({key:s,value:e}){if(si(e)==="string")return Bn({key:s,value:e});{const n=[];for(const c in e)n.push(...Bn({key:`${s}.${c}`,value:e[c]}));return n}}};function yu(s){const e=s.value,n=s.key,c=s.styleSpec,f=s.style,v=s.validateSpec;if(!e.type)return[new Rt(n,e,'"type" is required')];const x=Vi(e.type);let b;switch(x){case"vector":case"raster":return b=Ls({key:n,value:e,valueSpec:c[`source_${x.replace("-","_")}`],style:s.style,styleSpec:c,objectElementValidators:_u,validateSpec:v}),b;case"raster-dem":return b=function(S){var E;const D=(E=S.sourceName)!==null&&E!==void 0?E:"",k=S.value,B=S.styleSpec,$=B.source_raster_dem,U=S.style;let G=[];const X=si(k);if(k===void 0)return G;if(X!=="object")return G.push(new Rt("source_raster_dem",k,`object expected, ${X} found`)),G;const st=Vi(k.encoding)==="custom",gt=["redFactor","greenFactor","blueFactor","baseShift"],nt=S.value.encoding?`"${S.value.encoding}"`:"Default";for(const ft in k)!st&&gt.includes(ft)?G.push(new Rt(ft,k[ft],`In "${D}": "${ft}" is only valid when "encoding" is set to "custom". ${nt} encoding found`)):$[ft]?G=G.concat(S.validateSpec({key:ft,value:k[ft],valueSpec:$[ft],validateSpec:S.validateSpec,style:U,styleSpec:B})):G.push(new Rt(ft,k[ft],`unknown property "${ft}"`));return G}({sourceName:n,value:e,style:s.style,styleSpec:c,validateSpec:v}),b;case"geojson":if(b=Ls({key:n,value:e,valueSpec:c.source_geojson,style:f,styleSpec:c,validateSpec:v,objectElementValidators:_u}),e.cluster)for(const S in e.clusterProperties){const[E,D]=e.clusterProperties[S],k=typeof E=="string"?[E,["accumulated"],["get",S]]:E;b.push(...pn({key:`${n}.${S}.map`,value:D,validateSpec:v,expressionContext:"cluster-map"})),b.push(...pn({key:`${n}.${S}.reduce`,value:k,validateSpec:v,expressionContext:"cluster-reduce"}))}return b;case"video":return Ls({key:n,value:e,valueSpec:c.source_video,style:f,validateSpec:v,styleSpec:c});case"image":return Ls({key:n,value:e,valueSpec:c.source_image,style:f,validateSpec:v,styleSpec:c});case"canvas":return[new Rt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return mn({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:f,validateSpec:v,styleSpec:c})}}function vu(s){const e=s.value,n=s.styleSpec,c=n.light,f=s.style;let v=[];const x=si(e);if(e===void 0)return v;if(x!=="object")return v=v.concat([new Rt("light",e,`object expected, ${x} found`)]),v;for(const b in e){const S=b.match(/^(.*)-transition$/);v=v.concat(S&&c[S[1]]&&c[S[1]].transition?s.validateSpec({key:b,value:e[b],valueSpec:n.transition,validateSpec:s.validateSpec,style:f,styleSpec:n}):c[b]?s.validateSpec({key:b,value:e[b],valueSpec:c[b],validateSpec:s.validateSpec,style:f,styleSpec:n}):[new Rt(b,e[b],`unknown property "${b}"`)])}return v}function xu(s){const e=s.value,n=s.styleSpec,c=n.sky,f=s.style,v=si(e);if(e===void 0)return[];if(v!=="object")return[new Rt("sky",e,`object expected, ${v} found`)];let x=[];for(const b in e)x=x.concat(c[b]?Br({key:b,value:e[b],valueSpec:c[b],style:f,styleSpec:n}):[new Rt(b,e[b],`unknown property "${b}"`)]);return x}function Ya(s){const e=s.value,n=s.styleSpec,c=n.terrain,f=s.style;let v=[];const x=si(e);if(e===void 0)return v;if(x!=="object")return v=v.concat([new Rt("terrain",e,`object expected, ${x} found`)]),v;for(const b in e)v=v.concat(c[b]?s.validateSpec({key:b,value:e[b],valueSpec:c[b],validateSpec:s.validateSpec,style:f,styleSpec:n}):[new Rt(b,e[b],`unknown property "${b}"`)]);return v}function Ja(s){let e=[];const n=s.value,c=s.key;if(Array.isArray(n)){const f=[],v=[];for(const x in n)n[x].id&&f.includes(n[x].id)&&e.push(new Rt(c,n,`all the sprites' ids must be unique, but ${n[x].id} is duplicated`)),f.push(n[x].id),n[x].url&&v.includes(n[x].url)&&e.push(new Rt(c,n,`all the sprites' URLs must be unique, but ${n[x].url} is duplicated`)),v.push(n[x].url),e=e.concat(Ls({key:`${c}[${x}]`,value:n[x],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:s.validateSpec}));return e}return Bn({key:c,value:n})}const Gs={"*":()=>[],array:fc,boolean:function(s){const e=s.value,n=s.key,c=si(e);return c!=="boolean"?[new Rt(n,e,`boolean expected, ${c} found`)]:[]},number:Qo,color:function(s){const e=s.key,n=s.value,c=si(n);return c!=="string"?[new Rt(e,n,`color expected, ${c} found`)]:fi.parse(String(n))?[]:[new Rt(e,n,`color expected, "${n}" found`)]},constants:mu,enum:mn,filter:ca,function:gu,layer:Ka,object:Ls,source:yu,light:vu,sky:xu,terrain:Ya,string:Bn,formatted:function(s){return Bn(s).length===0?[]:pn(s)},resolvedImage:function(s){return Bn(s).length===0?[]:pn(s)},padding:function(s){const e=s.key,n=s.value;if(si(n)==="array"){if(n.length<1||n.length>4)return[new Rt(e,n,`padding requires 1 to 4 values; ${n.length} values found`)];const c={type:"number"};let f=[];for(let v=0;v<n.length;v++)f=f.concat(s.validateSpec({key:`${e}[${v}]`,value:n[v],validateSpec:s.validateSpec,valueSpec:c}));return f}return Qo({key:e,value:n,valueSpec:{}})},variableAnchorOffsetCollection:function(s){const e=s.key,n=s.value,c=si(n),f=s.styleSpec;if(c!=="array"||n.length<1||n.length%2!=0)return[new Rt(e,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let v=[];for(let x=0;x<n.length;x+=2)v=v.concat(mn({key:`${e}[${x}]`,value:n[x],valueSpec:f.layout_symbol["text-anchor"]})),v=v.concat(fc({key:`${e}[${x+1}]`,value:n[x+1],valueSpec:{length:2,value:"number"},validateSpec:s.validateSpec,style:s.style,styleSpec:f}));return v},sprite:Ja};function Br(s){const e=s.value,n=s.valueSpec,c=s.styleSpec;return s.validateSpec=Br,n.expression&&jo(Vi(e))?gu(s):n.expression&&vi(fn(e))?pn(s):n.type&&Gs[n.type]?Gs[n.type](s):Ls(gi({},s,{valueSpec:n.type?c[n.type]:n}))}function _c(s){const e=s.value,n=s.key,c=Bn(s);return c.length||(e.indexOf("{fontstack}")===-1&&c.push(new Rt(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&c.push(new Rt(n,e,'"glyphs" url must include a "{range}" token'))),c}function Ar(s,e=it){let n=[];return n=n.concat(Br({key:"",value:s,valueSpec:e.$root,styleSpec:e,style:s,validateSpec:Br,objectElementValidators:{glyphs:_c,"*":()=>[]}})),s.constants&&(n=n.concat(mu({key:"constants",value:s.constants,style:s,styleSpec:e,validateSpec:Br}))),ha(n)}function Nr(s){return function(e){return s({...e,validateSpec:Br})}}function ha(s){return[].concat(s).sort((e,n)=>e.line-n.line)}function Er(s){return function(...e){return ha(s.apply(this,e))}}Ar.source=Er(Nr(yu)),Ar.sprite=Er(Nr(Ja)),Ar.glyphs=Er(Nr(_c)),Ar.light=Er(Nr(vu)),Ar.sky=Er(Nr(xu)),Ar.terrain=Er(Nr(Ya)),Ar.layer=Er(Nr(Ka)),Ar.filter=Er(Nr(ca)),Ar.paintProperty=Er(Nr(mc)),Ar.layoutProperty=Er(Nr(gc));const Nn=Ar,Cf=Nn.light,yc=Nn.paintProperty,Df=Nn.layoutProperty;function ua(s,e){let n=!1;if(e&&e.length)for(const c of e)s.fire(new Mt(new Error(c.message))),n=!0;return n}class Qa{constructor(e,n,c){const f=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const x=new Int32Array(this.arrayBuffer);e=x[0],this.d=(n=x[1])+2*(c=x[2]);for(let S=0;S<this.d*this.d;S++){const E=x[3+S],D=x[3+S+1];f.push(E===D?null:x.subarray(E,D))}const b=x[3+f.length+1];this.keys=x.subarray(x[3+f.length],b),this.bboxes=x.subarray(b),this.insert=this._insertReadonly}else{this.d=n+2*c;for(let x=0;x<this.d*this.d;x++)f.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=e,this.padding=c,this.scale=n/e,this.uid=0;const v=c/n*e;this.min=-v,this.max=e+v}insert(e,n,c,f,v){this._forEachCell(n,c,f,v,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(n),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(v)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,n,c,f,v,x){this.cells[v].push(x)}query(e,n,c,f,v){const x=this.min,b=this.max;if(e<=x&&n<=x&&b<=c&&b<=f&&!v)return Array.prototype.slice.call(this.keys);{const S=[];return this._forEachCell(e,n,c,f,this._queryCell,S,{},v),S}}_queryCell(e,n,c,f,v,x,b,S){const E=this.cells[v];if(E!==null){const D=this.keys,k=this.bboxes;for(let B=0;B<E.length;B++){const $=E[B];if(b[$]===void 0){const U=4*$;(S?S(k[U+0],k[U+1],k[U+2],k[U+3]):e<=k[U+2]&&n<=k[U+3]&&c>=k[U+0]&&f>=k[U+1])?(b[$]=!0,x.push(D[$])):b[$]=!1}}}}_forEachCell(e,n,c,f,v,x,b,S){const E=this._convertToCellCoord(e),D=this._convertToCellCoord(n),k=this._convertToCellCoord(c),B=this._convertToCellCoord(f);for(let $=E;$<=k;$++)for(let U=D;U<=B;U++){const G=this.d*U+$;if((!S||S(this._convertFromCellCoord($),this._convertFromCellCoord(U),this._convertFromCellCoord($+1),this._convertFromCellCoord(U+1)))&&v.call(this,e,n,c,f,G,x,b,S))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,n=3+this.cells.length+1+1;let c=0;for(let x=0;x<this.cells.length;x++)c+=this.cells[x].length;const f=new Int32Array(n+c+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;let v=n;for(let x=0;x<e.length;x++){const b=e[x];f[3+x]=v,f.set(b,v),v+=b.length}return f[3+e.length]=v,f.set(this.keys,v),v+=this.keys.length,f[3+e.length+1]=v,f.set(this.bboxes,v),v+=this.bboxes.length,f.buffer}static serialize(e,n){const c=e.toArrayBuffer();return n&&n.push(c),{buffer:c}}static deserialize(e){return new Qa(e.buffer)}}const $r={};function le(s,e,n={}){if($r[s])throw new Error(`${s} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:s,writeable:!1}),$r[s]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}le("Object",Object),le("TransferableGridIndex",Qa),le("Color",fi),le("Error",Error),le("AJAXError",ae),le("ResolvedImage",gr),le("StylePropertyFunction",Ho),le("StyleExpression",Ai,{omit:["_evaluator"]}),le("ZoomDependentExpression",hc),le("ZoomConstantExpression",Go),le("CompoundExpression",sr,{omit:["_evaluate"]});for(const s in aa)aa[s]._classRegistryKey||le(`Expression_${s}`,aa[s]);function el(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function da(s,e){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||s instanceof Error)return s;if(el(s)||Ye(s))return e&&e.push(s),s;if(ArrayBuffer.isView(s)){const n=s;return e&&e.push(n.buffer),n}if(s instanceof ImageData)return e&&e.push(s.data.buffer),s;if(Array.isArray(s)){const n=[];for(const c of s)n.push(da(c,e));return n}if(typeof s=="object"){const n=s.constructor,c=n._classRegistryKey;if(!c)throw new Error(`can't serialize object of unregistered class ${n.name}`);if(!$r[c])throw new Error(`${c} is not registered.`);const f=n.serialize?n.serialize(s,e):{};if(n.serialize){if(e&&f===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const v in s){if(!s.hasOwnProperty(v)||$r[c].omit.indexOf(v)>=0)continue;const x=s[v];f[v]=$r[c].shallow.indexOf(v)>=0?x:da(x,e)}s instanceof Error&&(f.message=s.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(f.$name=c),f}throw new Error("can't serialize object of type "+typeof s)}function fa(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||s instanceof Error||el(s)||Ye(s)||ArrayBuffer.isView(s)||s instanceof ImageData)return s;if(Array.isArray(s))return s.map(fa);if(typeof s=="object"){const e=s.$name||"Object";if(!$r[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:n}=$r[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(s);const c=Object.create(n.prototype);for(const f of Object.keys(s)){if(f==="$name")continue;const v=s[f];c[f]=$r[e].shallow.indexOf(f)>=0?v:fa(v)}return c}throw new Error("can't deserialize object of type "+typeof s)}class bu{constructor(){this.first=!0}update(e,n){const c=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=n),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=c,!0))}}const ee={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function pa(s){for(const e of s)if(il(e.charCodeAt(0)))return!0;return!1}function wu(s){for(const e of s)if(!Mu(e.charCodeAt(0)))return!1;return!0}function Mu(s){return!(ee.Arabic(s)||ee["Arabic Supplement"](s)||ee["Arabic Extended-A"](s)||ee["Arabic Presentation Forms-A"](s)||ee["Arabic Presentation Forms-B"](s))}function il(s){return!(s!==746&&s!==747&&(s<4352||!(ee["Bopomofo Extended"](s)||ee.Bopomofo(s)||ee["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||ee["CJK Compatibility Ideographs"](s)||ee["CJK Compatibility"](s)||ee["CJK Radicals Supplement"](s)||ee["CJK Strokes"](s)||!(!ee["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||ee["CJK Unified Ideographs Extension A"](s)||ee["CJK Unified Ideographs"](s)||ee["Enclosed CJK Letters and Months"](s)||ee["Hangul Compatibility Jamo"](s)||ee["Hangul Jamo Extended-A"](s)||ee["Hangul Jamo Extended-B"](s)||ee["Hangul Jamo"](s)||ee["Hangul Syllables"](s)||ee.Hiragana(s)||ee["Ideographic Description Characters"](s)||ee.Kanbun(s)||ee["Kangxi Radicals"](s)||ee["Katakana Phonetic Extensions"](s)||ee.Katakana(s)&&s!==12540||!(!ee["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!ee["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||ee["Unified Canadian Aboriginal Syllabics"](s)||ee["Unified Canadian Aboriginal Syllabics Extended"](s)||ee["Vertical Forms"](s)||ee["Yijing Hexagram Symbols"](s)||ee["Yi Syllables"](s)||ee["Yi Radicals"](s))))}function vc(s){return!(il(s)||function(e){return!!(ee["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||ee["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||ee["Letterlike Symbols"](e)||ee["Number Forms"](e)||ee["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||ee["Control Pictures"](e)&&e!==9251||ee["Optical Character Recognition"](e)||ee["Enclosed Alphanumerics"](e)||ee["Geometric Shapes"](e)||ee["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ee["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ee["CJK Symbols and Punctuation"](e)||ee.Katakana(e)||ee["Private Use Area"](e)||ee["CJK Compatibility Forms"](e)||ee["Small Form Variants"](e)||ee["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(s))}function sl(s){return s>=1424&&s<=2303||ee["Arabic Presentation Forms-A"](s)||ee["Arabic Presentation Forms-B"](s)}function Su(s,e){return!(!e&&sl(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||ee.Khmer(s))}function kf(s){for(const e of s)if(sl(e.charCodeAt(0)))return!0;return!1}const gn=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(s){this.pluginStatus=s.pluginStatus,this.pluginURL=s.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(s){this.applyArabicShaping=s.applyArabicShaping,this.processBidirectionalText=s.processBidirectionalText,this.processStyledBidirectionalText=s.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class ki{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new bu,this.transition={})}isSupportedScript(e){return function(n,c){for(const f of n)if(!Su(f.charCodeAt(0),c))return!1;return!0}(e,gn.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,n=e-Math.floor(e),c=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*n}}}class to{constructor(e,n){this.property=e,this.value=n,this.expression=function(c,f){if(jo(c))return new Ho(c,f);if(vi(c)){const v=hu(c,f);if(v.result==="error")throw new Error(v.value.map(x=>`${x.key}: ${x.message}`).join(", "));return v.value}{let v=c;return f.type==="color"&&typeof c=="string"?v=fi.parse(c):f.type!=="padding"||typeof c!="number"&&!Array.isArray(c)?f.type==="variableAnchorOffsetCollection"&&Array.isArray(c)&&(v=mr.parse(c)):v=js.parse(c),{kind:"constant",evaluate:()=>v}}}(n===void 0?e.specification.default:n,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,c){return this.property.possiblyEvaluate(this,e,n,c)}}class rl{constructor(e){this.property=e,this.value=new to(e,void 0)}transitioned(e,n){return new Tu(this.property,this.value,n,ce({},e.transition,this.transition),e.now)}untransitioned(){return new Tu(this.property,this.value,null,{},0)}}class xc{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return xe(this._values[e].value.value)}setValue(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new rl(this._values[e].property)),this._values[e].value=new to(this._values[e].property,n===null?void 0:xe(n))}getTransition(e){return xe(this._values[e].transition)}setTransition(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new rl(this._values[e].property)),this._values[e].transition=xe(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const c=this.getValue(n);c!==void 0&&(e[n]=c);const f=this.getTransition(n);f!==void 0&&(e[`${n}-transition`]=f)}return e}transitioned(e,n){const c=new Au(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].transitioned(e,n._values[f]);return c}untransitioned(){const e=new Au(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class Tu{constructor(e,n,c,f,v){this.property=e,this.value=n,this.begin=v+f.delay||0,this.end=this.begin+f.duration||0,e.specification.transition&&(f.delay||f.duration)&&(this.prior=c)}possiblyEvaluate(e,n,c){const f=e.now||0,v=this.value.possiblyEvaluate(e,n,c),x=this.prior;if(x){if(f>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(f<this.begin)return x.possiblyEvaluate(e,n,c);{const b=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(e,n,c),v,function(S){if(S<=0)return 0;if(S>=1)return 1;const E=S*S,D=E*S;return 4*(S<.5?D:3*(S-E)+D-.75)}(b))}}return v}}class Au{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,c){const f=new eo(this._properties);for(const v of Object.keys(this._values))f._values[v]=this._values[v].possiblyEvaluate(e,n,c);return f}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Eu{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return xe(this._values[e].value)}setValue(e,n){this._values[e]=new to(this._values[e].property,n===null?void 0:xe(n))}serialize(){const e={};for(const n of Object.keys(this._values)){const c=this.getValue(n);c!==void 0&&(e[n]=c)}return e}possiblyEvaluate(e,n,c){const f=new eo(this._properties);for(const v of Object.keys(this._values))f._values[v]=this._values[v].possiblyEvaluate(e,n,c);return f}}class Ir{constructor(e,n,c){this.property=e,this.value=n,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,c,f){return this.property.evaluate(this.value,this.parameters,e,n,c,f)}}class eo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ve{constructor(e){this.specification=e}possiblyEvaluate(e,n){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(n)}interpolate(e,n,c){const f=zs[this.specification.type];return f?f(e,n,c):e}}class Ae{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,c,f){return new Ir(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},c,f)}:e.expression,n)}interpolate(e,n,c){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new Ir(this,{kind:"constant",value:void 0},e.parameters);const f=zs[this.specification.type];if(f){const v=f(e.value.value,n.value.value,c);return new Ir(this,{kind:"constant",value:v},e.parameters)}return e}evaluate(e,n,c,f,v,x){return e.kind==="constant"?e.value:e.evaluate(n,c,f,v,x)}}class nl extends Ae{possiblyEvaluate(e,n,c,f){if(e.value===void 0)return new Ir(this,{kind:"constant",value:void 0},n);if(e.expression.kind==="constant"){const v=e.expression.evaluate(n,null,{},c,f),x=e.property.specification.type==="resolvedImage"&&typeof v!="string"?v.name:v,b=this._calculate(x,x,x,n);return new Ir(this,{kind:"constant",value:b},n)}if(e.expression.kind==="camera"){const v=this._calculate(e.expression.evaluate({zoom:n.zoom-1}),e.expression.evaluate({zoom:n.zoom}),e.expression.evaluate({zoom:n.zoom+1}),n);return new Ir(this,{kind:"constant",value:v},n)}return new Ir(this,e.expression,n)}evaluate(e,n,c,f,v,x){if(e.kind==="source"){const b=e.evaluate(n,c,f,v,x);return this._calculate(b,b,b,n)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(n.zoom)-1},c,f),e.evaluate({zoom:Math.floor(n.zoom)},c,f),e.evaluate({zoom:Math.floor(n.zoom)+1},c,f),n):e.value}_calculate(e,n,c,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:c,to:n}}interpolate(e){return e}}class io{constructor(e){this.specification=e}possiblyEvaluate(e,n,c,f){if(e.value!==void 0){if(e.expression.kind==="constant"){const v=e.expression.evaluate(n,null,{},c,f);return this._calculate(v,v,v,n)}return this._calculate(e.expression.evaluate(new ki(Math.floor(n.zoom-1),n)),e.expression.evaluate(new ki(Math.floor(n.zoom),n)),e.expression.evaluate(new ki(Math.floor(n.zoom+1),n)),n)}}_calculate(e,n,c,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:c,to:n}}interpolate(e){return e}}class bc{constructor(e){this.specification=e}possiblyEvaluate(e,n,c,f){return!!e.expression.evaluate(n,null,{},c,f)}interpolate(){return!1}}class Hs{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in e){const c=e[n];c.specification.overridable&&this.overridableProperties.push(n);const f=this.defaultPropertyValues[n]=new to(c,void 0),v=this.defaultTransitionablePropertyValues[n]=new rl(c);this.defaultTransitioningPropertyValues[n]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=f.possiblyEvaluate({})}}}le("DataDrivenProperty",Ae),le("DataConstantProperty",ve),le("CrossFadedDataDrivenProperty",nl),le("CrossFadedProperty",io),le("ColorRampProperty",bc);const wc="-transition";class Pr extends Ft{constructor(e,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new Eu(n.layout)),n.paint)){this._transitionablePaint=new xc(n.paint);for(const c in e.paint)this.setPaintProperty(c,e.paint[c],{validate:!1});for(const c in e.layout)this.setLayoutProperty(c,e.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new eo(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,c={}){n!=null&&this._validate(Df,`layers.${this.id}.layout.${e}`,e,n,c)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return e.endsWith(wc)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,c={}){if(n!=null&&this._validate(yc,`layers.${this.id}.paint.${e}`,e,n,c))return!1;if(e.endsWith(wc))return this._transitionablePaint.setTransition(e.slice(0,-11),n||void 0),!1;{const f=this._transitionablePaint._values[e],v=f.property.specification["property-type"]==="cross-faded-data-driven",x=f.value.isDataDriven(),b=f.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const S=this._transitionablePaint._values[e].value;return S.isDataDriven()||x||v||this._handleOverridablePaintPropertyUpdate(e,b,S)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,n,c){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Ce(e,(n,c)=>!(n===void 0||c==="layout"&&!Object.keys(n).length||c==="paint"&&!Object.keys(n).length))}_validate(e,n,c,f,v={}){return(!v||v.validate!==!1)&&ua(this,e.call(Nn,{key:n,layerType:this.type,objectKey:c,value:f,styleSpec:it,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof Ir&&la(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const Iu={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class so{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ui{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ki(s,e=1){let n=0,c=0;return{members:s.map(f=>{const v=Iu[f.type].BYTES_PER_ELEMENT,x=n=Pu(n,Math.max(e,v)),b=f.components||1;return c=Math.max(c,v),n+=v*b,{name:f.name,type:f.type,components:b,offset:x}}),size:Pu(n,Math.max(c,e)),alignment:e}}function Pu(s,e){return Math.ceil(s/e)*e}class ro extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const c=this.length;return this.resize(c+1),this.emplace(c,e,n)}emplace(e,n,c){const f=2*e;return this.int16[f+0]=n,this.int16[f+1]=c,e}}ro.prototype.bytesPerElement=4,le("StructArrayLayout2i4",ro);class Yr extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,c)}emplace(e,n,c,f){const v=3*e;return this.int16[v+0]=n,this.int16[v+1]=c,this.int16[v+2]=f,e}}Yr.prototype.bytesPerElement=6,le("StructArrayLayout3i6",Yr);class Mc extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,c,f){const v=this.length;return this.resize(v+1),this.emplace(v,e,n,c,f)}emplace(e,n,c,f,v){const x=4*e;return this.int16[x+0]=n,this.int16[x+1]=c,this.int16[x+2]=f,this.int16[x+3]=v,e}}Mc.prototype.bytesPerElement=8,le("StructArrayLayout4i8",Mc);class Sc extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,c,f,v,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,c,f,v,x)}emplace(e,n,c,f,v,x,b){const S=6*e;return this.int16[S+0]=n,this.int16[S+1]=c,this.int16[S+2]=f,this.int16[S+3]=v,this.int16[S+4]=x,this.int16[S+5]=b,e}}Sc.prototype.bytesPerElement=12,le("StructArrayLayout2i4i12",Sc);class Tc extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,c,f,v,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,c,f,v,x)}emplace(e,n,c,f,v,x,b){const S=4*e,E=8*e;return this.int16[S+0]=n,this.int16[S+1]=c,this.uint8[E+4]=f,this.uint8[E+5]=v,this.uint8[E+6]=x,this.uint8[E+7]=b,e}}Tc.prototype.bytesPerElement=8,le("StructArrayLayout2i4ub8",Tc);class no extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const c=this.length;return this.resize(c+1),this.emplace(c,e,n)}emplace(e,n,c){const f=2*e;return this.float32[f+0]=n,this.float32[f+1]=c,e}}no.prototype.bytesPerElement=8,le("StructArrayLayout2f8",no);class al extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,c,f,v,x,b,S,E,D){const k=this.length;return this.resize(k+1),this.emplace(k,e,n,c,f,v,x,b,S,E,D)}emplace(e,n,c,f,v,x,b,S,E,D,k){const B=10*e;return this.uint16[B+0]=n,this.uint16[B+1]=c,this.uint16[B+2]=f,this.uint16[B+3]=v,this.uint16[B+4]=x,this.uint16[B+5]=b,this.uint16[B+6]=S,this.uint16[B+7]=E,this.uint16[B+8]=D,this.uint16[B+9]=k,e}}al.prototype.bytesPerElement=20,le("StructArrayLayout10ui20",al);class Ac extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,c,f,v,x,b,S,E,D,k,B){const $=this.length;return this.resize($+1),this.emplace($,e,n,c,f,v,x,b,S,E,D,k,B)}emplace(e,n,c,f,v,x,b,S,E,D,k,B,$){const U=12*e;return this.int16[U+0]=n,this.int16[U+1]=c,this.int16[U+2]=f,this.int16[U+3]=v,this.uint16[U+4]=x,this.uint16[U+5]=b,this.uint16[U+6]=S,this.uint16[U+7]=E,this.int16[U+8]=D,this.int16[U+9]=k,this.int16[U+10]=B,this.int16[U+11]=$,e}}Ac.prototype.bytesPerElement=24,le("StructArrayLayout4i4ui4i24",Ac);class Ec extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,c)}emplace(e,n,c,f){const v=3*e;return this.float32[v+0]=n,this.float32[v+1]=c,this.float32[v+2]=f,e}}Ec.prototype.bytesPerElement=12,le("StructArrayLayout3f12",Ec);class Jr extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}Jr.prototype.bytesPerElement=4,le("StructArrayLayout1ul4",Jr);class ol extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,c,f,v,x,b,S,E){const D=this.length;return this.resize(D+1),this.emplace(D,e,n,c,f,v,x,b,S,E)}emplace(e,n,c,f,v,x,b,S,E,D){const k=10*e,B=5*e;return this.int16[k+0]=n,this.int16[k+1]=c,this.int16[k+2]=f,this.int16[k+3]=v,this.int16[k+4]=x,this.int16[k+5]=b,this.uint32[B+3]=S,this.uint16[k+8]=E,this.uint16[k+9]=D,e}}ol.prototype.bytesPerElement=20,le("StructArrayLayout6i1ul2ui20",ol);class ao extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,c,f,v,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,c,f,v,x)}emplace(e,n,c,f,v,x,b){const S=6*e;return this.int16[S+0]=n,this.int16[S+1]=c,this.int16[S+2]=f,this.int16[S+3]=v,this.int16[S+4]=x,this.int16[S+5]=b,e}}ao.prototype.bytesPerElement=12,le("StructArrayLayout2i2i2i12",ao);class ll extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,c,f,v){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,c,f,v)}emplace(e,n,c,f,v,x){const b=4*e,S=8*e;return this.float32[b+0]=n,this.float32[b+1]=c,this.float32[b+2]=f,this.int16[S+6]=v,this.int16[S+7]=x,e}}ll.prototype.bytesPerElement=16,le("StructArrayLayout2f1f2i16",ll);class oo extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,f){const v=this.length;return this.resize(v+1),this.emplace(v,e,n,c,f)}emplace(e,n,c,f,v){const x=12*e,b=3*e;return this.uint8[x+0]=n,this.uint8[x+1]=c,this.float32[b+1]=f,this.float32[b+2]=v,e}}oo.prototype.bytesPerElement=12,le("StructArrayLayout2ub2f12",oo);class cl extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,c)}emplace(e,n,c,f){const v=3*e;return this.uint16[v+0]=n,this.uint16[v+1]=c,this.uint16[v+2]=f,e}}cl.prototype.bytesPerElement=6,le("StructArrayLayout3ui6",cl);class ma extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,f,v,x,b,S,E,D,k,B,$,U,G,X,st){const gt=this.length;return this.resize(gt+1),this.emplace(gt,e,n,c,f,v,x,b,S,E,D,k,B,$,U,G,X,st)}emplace(e,n,c,f,v,x,b,S,E,D,k,B,$,U,G,X,st,gt){const nt=24*e,ft=12*e,At=48*e;return this.int16[nt+0]=n,this.int16[nt+1]=c,this.uint16[nt+2]=f,this.uint16[nt+3]=v,this.uint32[ft+2]=x,this.uint32[ft+3]=b,this.uint32[ft+4]=S,this.uint16[nt+10]=E,this.uint16[nt+11]=D,this.uint16[nt+12]=k,this.float32[ft+7]=B,this.float32[ft+8]=$,this.uint8[At+36]=U,this.uint8[At+37]=G,this.uint8[At+38]=X,this.uint32[ft+10]=st,this.int16[nt+22]=gt,e}}ma.prototype.bytesPerElement=48,le("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ma);class $n extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,f,v,x,b,S,E,D,k,B,$,U,G,X,st,gt,nt,ft,At,Ct,se,me,ie,Jt,Ht,he){const Yt=this.length;return this.resize(Yt+1),this.emplace(Yt,e,n,c,f,v,x,b,S,E,D,k,B,$,U,G,X,st,gt,nt,ft,At,Ct,se,me,ie,Jt,Ht,he)}emplace(e,n,c,f,v,x,b,S,E,D,k,B,$,U,G,X,st,gt,nt,ft,At,Ct,se,me,ie,Jt,Ht,he,Yt){const $t=32*e,Me=16*e;return this.int16[$t+0]=n,this.int16[$t+1]=c,this.int16[$t+2]=f,this.int16[$t+3]=v,this.int16[$t+4]=x,this.int16[$t+5]=b,this.int16[$t+6]=S,this.int16[$t+7]=E,this.uint16[$t+8]=D,this.uint16[$t+9]=k,this.uint16[$t+10]=B,this.uint16[$t+11]=$,this.uint16[$t+12]=U,this.uint16[$t+13]=G,this.uint16[$t+14]=X,this.uint16[$t+15]=st,this.uint16[$t+16]=gt,this.uint16[$t+17]=nt,this.uint16[$t+18]=ft,this.uint16[$t+19]=At,this.uint16[$t+20]=Ct,this.uint16[$t+21]=se,this.uint16[$t+22]=me,this.uint32[Me+12]=ie,this.float32[Me+13]=Jt,this.float32[Me+14]=Ht,this.uint16[$t+30]=he,this.uint16[$t+31]=Yt,e}}$n.prototype.bytesPerElement=64,le("StructArrayLayout8i15ui1ul2f2ui64",$n);class hl extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}hl.prototype.bytesPerElement=4,le("StructArrayLayout1f4",hl);class ul extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,c)}emplace(e,n,c,f){const v=3*e;return this.uint16[6*e+0]=n,this.float32[v+1]=c,this.float32[v+2]=f,e}}ul.prototype.bytesPerElement=12,le("StructArrayLayout1ui2f12",ul);class Vn extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,c)}emplace(e,n,c,f){const v=4*e;return this.uint32[2*e+0]=n,this.uint16[v+2]=c,this.uint16[v+3]=f,e}}Vn.prototype.bytesPerElement=8,le("StructArrayLayout1ul2ui8",Vn);class Ic extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const c=this.length;return this.resize(c+1),this.emplace(c,e,n)}emplace(e,n,c){const f=2*e;return this.uint16[f+0]=n,this.uint16[f+1]=c,e}}Ic.prototype.bytesPerElement=4,le("StructArrayLayout2ui4",Ic);class Pc extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}Pc.prototype.bytesPerElement=2,le("StructArrayLayout1ui2",Pc);class dl extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,f){const v=this.length;return this.resize(v+1),this.emplace(v,e,n,c,f)}emplace(e,n,c,f,v){const x=4*e;return this.float32[x+0]=n,this.float32[x+1]=c,this.float32[x+2]=f,this.float32[x+3]=v,e}}dl.prototype.bytesPerElement=16,le("StructArrayLayout4f16",dl);class Cu extends so{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new P(this.anchorPointX,this.anchorPointY)}}Cu.prototype.size=20;class g extends ol{get(e){return new Cu(this,e)}}le("CollisionBoxArray",g);class i extends so{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}i.prototype.size=48;class o extends ma{get(e){return new i(this,e)}}le("PlacedSymbolArray",o);class u extends so{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}u.prototype.size=64;class d extends $n{get(e){return new u(this,e)}}le("SymbolInstanceArray",d);class y extends hl{getoffsetX(e){return this.float32[1*e+0]}}le("GlyphOffsetArray",y);class w extends Yr{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}le("SymbolLineVertexArray",w);class M extends so{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}M.prototype.size=12;class A extends ul{get(e){return new M(this,e)}}le("TextAnchorOffsetArray",A);class C extends so{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}C.prototype.size=8;class z extends Vn{get(e){return new C(this,e)}}le("FeatureIndexArray",z);class O extends ro{}class V extends ro{}class Z extends ro{}class W extends Sc{}class J extends Tc{}class j extends no{}class ot extends al{}class xt extends Ac{}class et extends Ec{}class pt extends Jr{}class bt extends ao{}class wt extends oo{}class St extends cl{}class Bt extends Ic{}const Lt=Ki([{name:"a_pos",components:2,type:"Int16"}],4),{members:jt}=Lt;class Wt{constructor(e=[]){this.segments=e}prepareSegment(e,n,c,f){let v=this.segments[this.segments.length-1];return e>Wt.MAX_VERTEX_ARRAY_LENGTH&&pe(`Max vertices per segment is ${Wt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!v||v.vertexLength+e>Wt.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==f)&&(v={vertexOffset:n.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},f!==void 0&&(v.sortKey=f),this.segments.push(v)),v}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,c,f){return new Wt([{vertexOffset:e,primitiveOffset:n,vertexLength:c,primitiveLength:f,vaos:{},sortKey:0}])}}function $e(s,e){return 256*(s=Ot(Math.floor(s),0,255))+Ot(Math.floor(e),0,255)}Wt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,le("SegmentVector",Wt);const Kt=Ki([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Ie={exports:{}},Ve={exports:{}};Ve.exports=function(s,e){var n,c,f,v,x,b,S,E;for(c=s.length-(n=3&s.length),f=e,x=3432918353,b=461845907,E=0;E<c;)S=255&s.charCodeAt(E)|(255&s.charCodeAt(++E))<<8|(255&s.charCodeAt(++E))<<16|(255&s.charCodeAt(++E))<<24,++E,f=27492+(65535&(v=5*(65535&(f=(f^=S=(65535&(S=(S=(65535&S)*x+(((S>>>16)*x&65535)<<16)&4294967295)<<15|S>>>17))*b+(((S>>>16)*b&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(S=0,n){case 3:S^=(255&s.charCodeAt(E+2))<<16;case 2:S^=(255&s.charCodeAt(E+1))<<8;case 1:f^=S=(65535&(S=(S=(65535&(S^=255&s.charCodeAt(E)))*x+(((S>>>16)*x&65535)<<16)&4294967295)<<15|S>>>17))*b+(((S>>>16)*b&65535)<<16)&4294967295}return f^=s.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0};var ei=Ve.exports,ke={exports:{}};ke.exports=function(s,e){for(var n,c=s.length,f=e^c,v=0;c>=4;)n=1540483477*(65535&(n=255&s.charCodeAt(v)|(255&s.charCodeAt(++v))<<8|(255&s.charCodeAt(++v))<<16|(255&s.charCodeAt(++v))<<24))+((1540483477*(n>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),c-=4,++v;switch(c){case 3:f^=(255&s.charCodeAt(v+2))<<16;case 2:f^=(255&s.charCodeAt(v+1))<<8;case 1:f=1540483477*(65535&(f^=255&s.charCodeAt(v)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0};var je=ei,He=ke.exports;Ie.exports=je,Ie.exports.murmur3=je,Ie.exports.murmur2=He;var qi=T(Ie.exports);class mi{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,c,f){this.ids.push(rr(e)),this.positions.push(n,c,f)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=rr(e);let c=0,f=this.ids.length-1;for(;c<f;){const x=c+f>>1;this.ids[x]>=n?f=x:c=x+1}const v=[];for(;this.ids[c]===n;)v.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return v}static serialize(e,n){const c=new Float64Array(e.ids),f=new Uint32Array(e.positions);return cs(c,f,0,c.length-1),n&&n.push(c.buffer,f.buffer),{ids:c,positions:f}}static deserialize(e){const n=new mi;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function rr(s){const e=+s;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:qi(String(s))}function cs(s,e,n,c){for(;n<c;){const f=s[n+c>>1];let v=n-1,x=c+1;for(;;){do v++;while(s[v]<f);do x--;while(s[x]>f);if(v>=x)break;Fi(s,v,x),Fi(e,3*v,3*x),Fi(e,3*v+1,3*x+1),Fi(e,3*v+2,3*x+2)}x-n<c-x?(cs(s,e,n,x),n=x+1):(cs(s,e,x+1,c),c=x)}}function Fi(s,e,n){const c=s[e];s[e]=s[n],s[n]=c}le("FeaturePositionMap",mi);class hs{constructor(e,n){this.gl=e.gl,this.location=n}}class nr extends hs{constructor(e,n){super(e,n),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Vr extends hs{constructor(e,n){super(e,n),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class _n extends hs{constructor(e,n){super(e,n),this.current=fi.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const lo=new Float32Array(16);function yn(s){return[$e(255*s.r,255*s.g),$e(255*s.b,255*s.a)]}class Ur{constructor(e,n,c){this.value=e,this.uniformNames=n.map(f=>`u_${f}`),this.type=c}setUniform(e,n,c){e.set(c.constantOr(this.value))}getBinding(e,n,c){return this.type==="color"?new _n(e,n):new nr(e,n)}}class es{constructor(e,n){this.uniformNames=n.map(c=>`u_${c}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=e.tlbr}setUniform(e,n,c,f){const v=f==="u_pattern_to"?this.patternTo:f==="u_pattern_from"?this.patternFrom:f==="u_pixel_ratio_to"?this.pixelRatioTo:f==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&e.set(v)}getBinding(e,n,c){return c.substr(0,9)==="u_pattern"?new Vr(e,n):new nr(e,n)}}class Bi{constructor(e,n,c,f){this.expression=e,this.type=c,this.maxValue=0,this.paintVertexAttributes=n.map(v=>({name:`a_${v}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,n,c,f,v){const x=this.paintVertexArray.length,b=this.expression.evaluate(new ki(0),n,{},f,[],v);this.paintVertexArray.resize(e),this._setPaintValue(x,e,b)}updatePaintArray(e,n,c,f){const v=this.expression.evaluate({zoom:0},c,f);this._setPaintValue(e,n,v)}_setPaintValue(e,n,c){if(this.type==="color"){const f=yn(c);for(let v=e;v<n;v++)this.paintVertexArray.emplace(v,f[0],f[1])}else{for(let f=e;f<n;f++)this.paintVertexArray.emplace(f,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ri{constructor(e,n,c,f,v,x){this.expression=e,this.uniformNames=n.map(b=>`u_${b}_t`),this.type=c,this.useIntegerZoom=f,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=n.map(b=>({name:`a_${b}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(e,n,c,f,v){const x=this.expression.evaluate(new ki(this.zoom),n,{},f,[],v),b=this.expression.evaluate(new ki(this.zoom+1),n,{},f,[],v),S=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(S,e,x,b)}updatePaintArray(e,n,c,f){const v=this.expression.evaluate({zoom:this.zoom},c,f),x=this.expression.evaluate({zoom:this.zoom+1},c,f);this._setPaintValue(e,n,v,x)}_setPaintValue(e,n,c,f){if(this.type==="color"){const v=yn(c),x=yn(f);for(let b=e;b<n;b++)this.paintVertexArray.emplace(b,v[0],v[1],x[0],x[1])}else{for(let v=e;v<n;v++)this.paintVertexArray.emplace(v,c,f);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(f))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n){const c=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,f=Ot(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);e.set(f)}getBinding(e,n,c){return new nr(e,n)}}class _r{constructor(e,n,c,f,v,x){this.expression=e,this.type=n,this.useIntegerZoom=c,this.zoom=f,this.layerId=x,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v}populatePaintArray(e,n,c){const f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(f,e,n.patterns&&n.patterns[this.layerId],c)}updatePaintArray(e,n,c,f,v){this._setPaintValues(e,n,c.patterns&&c.patterns[this.layerId],v)}_setPaintValues(e,n,c,f){if(!f||!c)return;const{min:v,mid:x,max:b}=c,S=f[v],E=f[x],D=f[b];if(S&&E&&D)for(let k=e;k<n;k++)this.zoomInPaintVertexArray.emplace(k,E.tl[0],E.tl[1],E.br[0],E.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],E.pixelRatio,S.pixelRatio),this.zoomOutPaintVertexArray.emplace(k,E.tl[0],E.tl[1],E.br[0],E.br[1],D.tl[0],D.tl[1],D.br[0],D.br[1],E.pixelRatio,D.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Kt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Kt.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class is{constructor(e,n,c){this.binders={},this._buffers=[];const f=[];for(const v in e.paint._values){if(!c(v))continue;const x=e.paint.get(v);if(!(x instanceof Ir&&la(x.property.specification)))continue;const b=yr(v,e.type),S=x.value,E=x.property.specification.type,D=x.property.useIntegerZoom,k=x.property.specification["property-type"],B=k==="cross-faded"||k==="cross-faded-data-driven";if(S.kind==="constant")this.binders[v]=B?new es(S.value,b):new Ur(S.value,b,E),f.push(`/u_${v}`);else if(S.kind==="source"||B){const $=ss(v,E,"source");this.binders[v]=B?new _r(S,E,D,n,$,e.id):new Bi(S,b,E,$),f.push(`/a_${v}`)}else{const $=ss(v,E,"composite");this.binders[v]=new Ri(S,b,E,D,n,$),f.push(`/z_${v}`)}}this.cacheKey=f.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof Bi||n instanceof Ri?n.maxValue:0}populatePaintArrays(e,n,c,f,v){for(const x in this.binders){const b=this.binders[x];(b instanceof Bi||b instanceof Ri||b instanceof _r)&&b.populatePaintArray(e,n,c,f,v)}}setConstantPatternPositions(e,n){for(const c in this.binders){const f=this.binders[c];f instanceof es&&f.setConstantPatternPositions(e,n)}}updatePaintArrays(e,n,c,f,v){let x=!1;for(const b in e){const S=n.getPositions(b);for(const E of S){const D=c.feature(E.index);for(const k in this.binders){const B=this.binders[k];if((B instanceof Bi||B instanceof Ri||B instanceof _r)&&B.expression.isStateDependent===!0){const $=f.paint.get(k);B.expression=$.value,B.updatePaintArray(E.start,E.end,D,e[b],v),x=!0}}}}return x}defines(){const e=[];for(const n in this.binders){const c=this.binders[n];(c instanceof Ur||c instanceof es)&&e.push(...c.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const c=this.binders[n];if(c instanceof Bi||c instanceof Ri)for(let f=0;f<c.paintVertexAttributes.length;f++)e.push(c.paintVertexAttributes[f].name);else if(c instanceof _r)for(let f=0;f<Kt.members.length;f++)e.push(Kt.members[f].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const c=this.binders[n];if(c instanceof Ur||c instanceof es||c instanceof Ri)for(const f of c.uniformNames)e.push(f)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,n){const c=[];for(const f in this.binders){const v=this.binders[f];if(v instanceof Ur||v instanceof es||v instanceof Ri){for(const x of v.uniformNames)if(n[x]){const b=v.getBinding(e,n[x],x);c.push({name:x,property:f,binding:b})}}}return c}setUniforms(e,n,c,f){for(const{name:v,property:x,binding:b}of n)this.binders[x].setUniform(b,f,c.get(x),v)}updatePaintBuffers(e){this._buffers=[];for(const n in this.binders){const c=this.binders[n];if(e&&c instanceof _r){const f=e.fromScale===2?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(c instanceof Bi||c instanceof Ri)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}}upload(e){for(const n in this.binders){const c=this.binders[n];(c instanceof Bi||c instanceof Ri||c instanceof _r)&&c.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof Bi||n instanceof Ri||n instanceof _r)&&n.destroy()}}}class Ni{constructor(e,n,c=()=>!0){this.programConfigurations={};for(const f of e)this.programConfigurations[f.id]=new is(f,n,c);this.needsUpload=!1,this._featureMap=new mi,this._bufferOffset=0}populatePaintArrays(e,n,c,f,v,x){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,n,f,v,x);n.id!==void 0&&this._featureMap.add(n.id,c,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,c,f){for(const v of c)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(e,this._featureMap,n,v,f)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function yr(s,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[s]||[s.replace(`${e}-`,"").replace(/-/g,"_")]}function ss(s,e,n){const c={color:{source:no,composite:dl},number:{source:hl,composite:no}},f=function(v){return{"line-pattern":{source:ot,composite:ot},"fill-pattern":{source:ot,composite:ot},"fill-extrusion-pattern":{source:ot,composite:ot}}[v]}(s);return f&&f[n]||c[e][n]}le("ConstantBinder",Ur),le("CrossFadedConstantBinder",es),le("SourceExpressionBinder",Bi),le("CrossFadedCompositeBinder",_r),le("CompositeExpressionBinder",Ri),le("ProgramConfiguration",is,{omit:["_buffers"]}),le("ProgramConfigurationSet",Ni);const Wi=8192,Cc=Math.pow(2,14)-1,Du=-Cc-1;function Un(s){const e=Wi/s.extent,n=s.loadGeometry();for(let c=0;c<n.length;c++){const f=n[c];for(let v=0;v<f.length;v++){const x=f[v],b=Math.round(x.x*e),S=Math.round(x.y*e);x.x=Ot(b,Du,Cc),x.y=Ot(S,Du,Cc),(b<x.x||b>x.x+1||S<x.y||S>x.y+1)&&pe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function qn(s,e){return{type:s.type,id:s.id,properties:s.properties,geometry:e?Un(s):[]}}function fl(s,e,n,c,f){s.emplaceBack(2*e+(c+1)/2,2*n+(f+1)/2)}class vn{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new V,this.indexArray=new St,this.segments=new Wt,this.programConfigurations=new Ni(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,c){const f=this.layers[0],v=[];let x=null,b=!1;f.type==="circle"&&(x=f.layout.get("circle-sort-key"),b=!x.isConstant());for(const{feature:S,id:E,index:D,sourceLayerIndex:k}of e){const B=this.layers[0]._featureFilter.needGeometry,$=qn(S,B);if(!this.layers[0]._featureFilter.filter(new ki(this.zoom),$,c))continue;const U=b?x.evaluate($,{},c):void 0,G={id:E,properties:S.properties,type:S.type,sourceLayerIndex:k,index:D,geometry:B?$.geometry:Un(S),patterns:{},sortKey:U};v.push(G)}b&&v.sort((S,E)=>S.sortKey-E.sortKey);for(const S of v){const{geometry:E,index:D,sourceLayerIndex:k}=S,B=e[D].feature;this.addFeature(S,E,D,c),n.featureIndex.insert(B,E,D,k,this.index)}}update(e,n,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,jt),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,c,f){for(const v of n)for(const x of v){const b=x.x,S=x.y;if(b<0||b>=Wi||S<0||S>=Wi)continue;const E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),D=E.vertexLength;fl(this.layoutVertexArray,b,S,-1,-1),fl(this.layoutVertexArray,b,S,1,-1),fl(this.layoutVertexArray,b,S,1,1),fl(this.layoutVertexArray,b,S,-1,1),this.indexArray.emplaceBack(D,D+1,D+2),this.indexArray.emplaceBack(D,D+3,D+2),E.vertexLength+=4,E.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,{},f)}}function Dc(s,e){for(let n=0;n<s.length;n++)if(ml(e,s[n]))return!0;for(let n=0;n<e.length;n++)if(ml(s,e[n]))return!0;return!!pl(s,e)}function ku(s,e,n){return!!ml(s,e)||!!Rf(e,s,n)}function kc(s,e){if(s.length===1)return Ym(e,s[0]);for(let n=0;n<e.length;n++){const c=e[n];for(let f=0;f<c.length;f++)if(ml(s,c[f]))return!0}for(let n=0;n<s.length;n++)if(Ym(e,s[n]))return!0;for(let n=0;n<e.length;n++)if(pl(s,e[n]))return!0;return!1}function Rc(s,e,n){if(s.length>1){if(pl(s,e))return!0;for(let c=0;c<e.length;c++)if(Rf(e[c],s,n))return!0}for(let c=0;c<s.length;c++)if(Rf(s[c],e,n))return!0;return!1}function pl(s,e){if(s.length===0||e.length===0)return!1;for(let n=0;n<s.length-1;n++){const c=s[n],f=s[n+1];for(let v=0;v<e.length-1;v++)if(zc(c,f,e[v],e[v+1]))return!0}return!1}function zc(s,e,n,c){return Qt(s,n,c)!==Qt(e,n,c)&&Qt(s,e,n)!==Qt(s,e,c)}function Rf(s,e,n){const c=n*n;if(e.length===1)return s.distSqr(e[0])<c;for(let f=1;f<e.length;f++)if(Km(s,e[f-1],e[f])<c)return!0;return!1}function Km(s,e,n){const c=e.distSqr(n);if(c===0)return s.distSqr(e);const f=((s.x-e.x)*(n.x-e.x)+(s.y-e.y)*(n.y-e.y))/c;return s.distSqr(f<0?e:f>1?n:n.sub(e)._mult(f)._add(e))}function Ym(s,e){let n,c,f,v=!1;for(let x=0;x<s.length;x++){n=s[x];for(let b=0,S=n.length-1;b<n.length;S=b++)c=n[b],f=n[S],c.y>e.y!=f.y>e.y&&e.x<(f.x-c.x)*(e.y-c.y)/(f.y-c.y)+c.x&&(v=!v)}return v}function ml(s,e){let n=!1;for(let c=0,f=s.length-1;c<s.length;f=c++){const v=s[c],x=s[f];v.y>e.y!=x.y>e.y&&e.x<(x.x-v.x)*(e.y-v.y)/(x.y-v.y)+v.x&&(n=!n)}return n}function $x(s,e,n){const c=n[0],f=n[2];if(s.x<c.x&&e.x<c.x||s.x>f.x&&e.x>f.x||s.y<c.y&&e.y<c.y||s.y>f.y&&e.y>f.y)return!1;const v=Qt(s,e,n[0]);return v!==Qt(s,e,n[1])||v!==Qt(s,e,n[2])||v!==Qt(s,e,n[3])}function Lc(s,e,n){const c=e.paint.get(s).value;return c.kind==="constant"?c.value:n.programConfigurations.get(e.id).getMaxValue(s)}function Ru(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function zu(s,e,n,c,f){if(!e[0]&&!e[1])return s;const v=P.convert(e)._mult(f);n==="viewport"&&v._rotate(-c);const x=[];for(let b=0;b<s.length;b++)x.push(s[b].sub(v));return x}let Jm,Qm;le("CircleBucket",vn,{omit:["layers"]});var Vx={get paint(){return Qm=Qm||new Hs({"circle-radius":new Ae(it.paint_circle["circle-radius"]),"circle-color":new Ae(it.paint_circle["circle-color"]),"circle-blur":new Ae(it.paint_circle["circle-blur"]),"circle-opacity":new Ae(it.paint_circle["circle-opacity"]),"circle-translate":new ve(it.paint_circle["circle-translate"]),"circle-translate-anchor":new ve(it.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ve(it.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ve(it.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ae(it.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ae(it.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ae(it.paint_circle["circle-stroke-opacity"])})},get layout(){return Jm=Jm||new Hs({"circle-sort-key":new Ae(it.layout_circle["circle-sort-key"])})}},Ws=1e-6,gl=typeof Float32Array<"u"?Float32Array:Array;function zf(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function tg(s,e,n){var c=e[0],f=e[1],v=e[2],x=e[3],b=e[4],S=e[5],E=e[6],D=e[7],k=e[8],B=e[9],$=e[10],U=e[11],G=e[12],X=e[13],st=e[14],gt=e[15],nt=n[0],ft=n[1],At=n[2],Ct=n[3];return s[0]=nt*c+ft*b+At*k+Ct*G,s[1]=nt*f+ft*S+At*B+Ct*X,s[2]=nt*v+ft*E+At*$+Ct*st,s[3]=nt*x+ft*D+At*U+Ct*gt,s[4]=(nt=n[4])*c+(ft=n[5])*b+(At=n[6])*k+(Ct=n[7])*G,s[5]=nt*f+ft*S+At*B+Ct*X,s[6]=nt*v+ft*E+At*$+Ct*st,s[7]=nt*x+ft*D+At*U+Ct*gt,s[8]=(nt=n[8])*c+(ft=n[9])*b+(At=n[10])*k+(Ct=n[11])*G,s[9]=nt*f+ft*S+At*B+Ct*X,s[10]=nt*v+ft*E+At*$+Ct*st,s[11]=nt*x+ft*D+At*U+Ct*gt,s[12]=(nt=n[12])*c+(ft=n[13])*b+(At=n[14])*k+(Ct=n[15])*G,s[13]=nt*f+ft*S+At*B+Ct*X,s[14]=nt*v+ft*E+At*$+Ct*st,s[15]=nt*x+ft*D+At*U+Ct*gt,s}Math.hypot||(Math.hypot=function(){for(var s=0,e=arguments.length;e--;)s+=arguments[e]*arguments[e];return Math.sqrt(s)});var Oc,Ux=tg;function Lu(s,e,n){var c=e[0],f=e[1],v=e[2],x=e[3];return s[0]=n[0]*c+n[4]*f+n[8]*v+n[12]*x,s[1]=n[1]*c+n[5]*f+n[9]*v+n[13]*x,s[2]=n[2]*c+n[6]*f+n[10]*v+n[14]*x,s[3]=n[3]*c+n[7]*f+n[11]*v+n[15]*x,s}Oc=new gl(4),gl!=Float32Array&&(Oc[0]=0,Oc[1]=0,Oc[2]=0,Oc[3]=0);class qx extends Pr{constructor(e){super(e,Vx)}createBucket(e){return new vn(e)}queryRadius(e){const n=e;return Lc("circle-radius",this,n)+Lc("circle-stroke-width",this,n)+Ru(this.paint.get("circle-translate"))}queryIntersectsFeature(e,n,c,f,v,x,b,S){const E=zu(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,b),D=this.paint.get("circle-radius").evaluate(n,c)+this.paint.get("circle-stroke-width").evaluate(n,c),k=this.paint.get("circle-pitch-alignment")==="map",B=k?E:function(U,G){return U.map(X=>eg(X,G))}(E,S),$=k?D*b:D;for(const U of f)for(const G of U){const X=k?G:eg(G,S);let st=$;const gt=Lu([],[G.x,G.y,0,1],S);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?st*=gt[3]/x.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(st*=x.cameraToCenterDistance/gt[3]),ku(B,X,st))return!0}return!1}}function eg(s,e){const n=Lu([],[s.x,s.y,0,1],e);return new P(n[0]/n[3],n[1]/n[3])}class ig extends vn{}let sg;le("HeatmapBucket",ig,{omit:["layers"]});var jx={get paint(){return sg=sg||new Hs({"heatmap-radius":new Ae(it.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ae(it.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ve(it.paint_heatmap["heatmap-intensity"]),"heatmap-color":new bc(it.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ve(it.paint_heatmap["heatmap-opacity"])})}};function Lf(s,{width:e,height:n},c,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==e*n*c)throw new RangeError(`mismatched image size. expected: ${f.length} but got: ${e*n*c}`)}else f=new Uint8Array(e*n*c);return s.width=e,s.height=n,s.data=f,s}function rg(s,{width:e,height:n},c){if(e===s.width&&n===s.height)return;const f=Lf({},{width:e,height:n},c);Of(s,f,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,e),height:Math.min(s.height,n)},c),s.width=e,s.height=n,s.data=f.data}function Of(s,e,n,c,f,v){if(f.width===0||f.height===0)return e;if(f.width>s.width||f.height>s.height||n.x>s.width-f.width||n.y>s.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>e.width||f.height>e.height||c.x>e.width-f.width||c.y>e.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const x=s.data,b=e.data;if(x===b)throw new Error("srcData equals dstData, so image is already copied");for(let S=0;S<f.height;S++){const E=((n.y+S)*s.width+n.x)*v,D=((c.y+S)*e.width+c.x)*v;for(let k=0;k<f.width*v;k++)b[D+k]=x[E+k]}return e}class Fc{constructor(e,n){Lf(this,e,1,n)}resize(e){rg(this,e,1)}clone(){return new Fc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,c,f,v){Of(e,n,c,f,v,1)}}class Cr{constructor(e,n){Lf(this,e,4,n)}resize(e){rg(this,e,4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Cr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,c,f,v){Of(e,n,c,f,v,4)}}function ng(s){const e={},n=s.resolution||256,c=s.clips?s.clips.length:1,f=s.image||new Cr({width:n,height:c});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const v=(x,b,S)=>{e[s.evaluationKey]=S;const E=s.expression.evaluate(e);f.data[x+b+0]=Math.floor(255*E.r/E.a),f.data[x+b+1]=Math.floor(255*E.g/E.a),f.data[x+b+2]=Math.floor(255*E.b/E.a),f.data[x+b+3]=Math.floor(255*E.a)};if(s.clips)for(let x=0,b=0;x<c;++x,b+=4*n)for(let S=0,E=0;S<n;S++,E+=4){const D=S/(n-1),{start:k,end:B}=s.clips[x];v(b,E,k*(1-D)+B*D)}else for(let x=0,b=0;x<n;x++,b+=4)v(0,b,x/(n-1));return f}le("AlphaImage",Fc),le("RGBAImage",Cr);class Gx extends Pr{createBucket(e){return new ig(e)}constructor(e){super(e,jx),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ng({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let ag;var Hx={get paint(){return ag=ag||new Hs({"hillshade-illumination-direction":new ve(it.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ve(it.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ve(it.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ve(it.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ve(it.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ve(it.paint_hillshade["hillshade-accent-color"])})}};class Wx extends Pr{constructor(e){super(e,Hx)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Zx=Ki([{name:"a_pos",components:2,type:"Int16"}],4),{members:Xx}=Zx;var Ff={exports:{}};function Ou(s,e,n){n=n||2;var c,f,v,x,b,S,E,D=e&&e.length,k=D?e[0]*n:s.length,B=og(s,0,k,n,!0),$=[];if(!B||B.next===B.prev)return $;if(D&&(B=function(G,X,st,gt){var nt,ft,At,Ct=[];for(nt=0,ft=X.length;nt<ft;nt++)(At=og(G,X[nt]*gt,nt<ft-1?X[nt+1]*gt:G.length,gt,!1))===At.next&&(At.steiner=!0),Ct.push(s1(At));for(Ct.sort(t1),nt=0;nt<Ct.length;nt++)st=e1(Ct[nt],st);return st}(s,e,B,n)),s.length>80*n){c=v=s[0],f=x=s[1];for(var U=n;U<k;U+=n)(b=s[U])<c&&(c=b),(S=s[U+1])<f&&(f=S),b>v&&(v=b),S>x&&(x=S);E=(E=Math.max(v-c,x-f))!==0?32767/E:0}return Bc(B,$,n,c,f,E,0),$}function og(s,e,n,c,f){var v,x;if(f===$f(s,e,n,c)>0)for(v=e;v<n;v+=c)x=hg(v,s[v],s[v+1],x);else for(v=n-c;v>=e;v-=c)x=hg(v,s[v],s[v+1],x);return x&&Fu(x,x.next)&&($c(x),x=x.next),x}function co(s,e){if(!s)return s;e||(e=s);var n,c=s;do if(n=!1,c.steiner||!Fu(c,c.next)&&Yi(c.prev,c,c.next)!==0)c=c.next;else{if($c(c),(c=e=c.prev)===c.next)break;n=!0}while(n||c!==e);return e}function Bc(s,e,n,c,f,v,x){if(s){!x&&v&&function(D,k,B,$){var U=D;do U.z===0&&(U.z=Bf(U.x,U.y,k,B,$)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next;while(U!==D);U.prevZ.nextZ=null,U.prevZ=null,function(G){var X,st,gt,nt,ft,At,Ct,se,me=1;do{for(st=G,G=null,ft=null,At=0;st;){for(At++,gt=st,Ct=0,X=0;X<me&&(Ct++,gt=gt.nextZ);X++);for(se=me;Ct>0||se>0&&gt;)Ct!==0&&(se===0||!gt||st.z<=gt.z)?(nt=st,st=st.nextZ,Ct--):(nt=gt,gt=gt.nextZ,se--),ft?ft.nextZ=nt:G=nt,nt.prevZ=ft,ft=nt;st=gt}ft.nextZ=null,me*=2}while(At>1)}(U)}(s,c,f,v);for(var b,S,E=s;s.prev!==s.next;)if(b=s.prev,S=s.next,v?Yx(s,c,f,v):Kx(s))e.push(b.i/n|0),e.push(s.i/n|0),e.push(S.i/n|0),$c(s),s=S.next,E=S.next;else if((s=S)===E){x?x===1?Bc(s=Jx(co(s),e,n),e,n,c,f,v,2):x===2&&Qx(s,e,n,c,f,v):Bc(co(s),e,n,c,f,v,1);break}}}function Kx(s){var e=s.prev,n=s,c=s.next;if(Yi(e,n,c)>=0)return!1;for(var f=e.x,v=n.x,x=c.x,b=e.y,S=n.y,E=c.y,D=f<v?f<x?f:x:v<x?v:x,k=b<S?b<E?b:E:S<E?S:E,B=f>v?f>x?f:x:v>x?v:x,$=b>S?b>E?b:E:S>E?S:E,U=c.next;U!==e;){if(U.x>=D&&U.x<=B&&U.y>=k&&U.y<=$&&_l(f,b,v,S,x,E,U.x,U.y)&&Yi(U.prev,U,U.next)>=0)return!1;U=U.next}return!0}function Yx(s,e,n,c){var f=s.prev,v=s,x=s.next;if(Yi(f,v,x)>=0)return!1;for(var b=f.x,S=v.x,E=x.x,D=f.y,k=v.y,B=x.y,$=b<S?b<E?b:E:S<E?S:E,U=D<k?D<B?D:B:k<B?k:B,G=b>S?b>E?b:E:S>E?S:E,X=D>k?D>B?D:B:k>B?k:B,st=Bf($,U,e,n,c),gt=Bf(G,X,e,n,c),nt=s.prevZ,ft=s.nextZ;nt&&nt.z>=st&&ft&&ft.z<=gt;){if(nt.x>=$&&nt.x<=G&&nt.y>=U&&nt.y<=X&&nt!==f&&nt!==x&&_l(b,D,S,k,E,B,nt.x,nt.y)&&Yi(nt.prev,nt,nt.next)>=0||(nt=nt.prevZ,ft.x>=$&&ft.x<=G&&ft.y>=U&&ft.y<=X&&ft!==f&&ft!==x&&_l(b,D,S,k,E,B,ft.x,ft.y)&&Yi(ft.prev,ft,ft.next)>=0))return!1;ft=ft.nextZ}for(;nt&&nt.z>=st;){if(nt.x>=$&&nt.x<=G&&nt.y>=U&&nt.y<=X&&nt!==f&&nt!==x&&_l(b,D,S,k,E,B,nt.x,nt.y)&&Yi(nt.prev,nt,nt.next)>=0)return!1;nt=nt.prevZ}for(;ft&&ft.z<=gt;){if(ft.x>=$&&ft.x<=G&&ft.y>=U&&ft.y<=X&&ft!==f&&ft!==x&&_l(b,D,S,k,E,B,ft.x,ft.y)&&Yi(ft.prev,ft,ft.next)>=0)return!1;ft=ft.nextZ}return!0}function Jx(s,e,n){var c=s;do{var f=c.prev,v=c.next.next;!Fu(f,v)&&lg(f,c,c.next,v)&&Nc(f,v)&&Nc(v,f)&&(e.push(f.i/n|0),e.push(c.i/n|0),e.push(v.i/n|0),$c(c),$c(c.next),c=s=v),c=c.next}while(c!==s);return co(c)}function Qx(s,e,n,c,f,v){var x=s;do{for(var b=x.next.next;b!==x.prev;){if(x.i!==b.i&&r1(x,b)){var S=cg(x,b);return x=co(x,x.next),S=co(S,S.next),Bc(x,e,n,c,f,v,0),void Bc(S,e,n,c,f,v,0)}b=b.next}x=x.next}while(x!==s)}function t1(s,e){return s.x-e.x}function e1(s,e){var n=function(f,v){var x,b=v,S=f.x,E=f.y,D=-1/0;do{if(E<=b.y&&E>=b.next.y&&b.next.y!==b.y){var k=b.x+(E-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(k<=S&&k>D&&(D=k,x=b.x<b.next.x?b:b.next,k===S))return x}b=b.next}while(b!==v);if(!x)return null;var B,$=x,U=x.x,G=x.y,X=1/0;b=x;do S>=b.x&&b.x>=U&&S!==b.x&&_l(E<G?S:D,E,U,G,E<G?D:S,E,b.x,b.y)&&(B=Math.abs(E-b.y)/(S-b.x),Nc(b,f)&&(B<X||B===X&&(b.x>x.x||b.x===x.x&&i1(x,b)))&&(x=b,X=B)),b=b.next;while(b!==$);return x}(s,e);if(!n)return e;var c=cg(n,s);return co(c,c.next),co(n,n.next)}function i1(s,e){return Yi(s.prev,s,e.prev)<0&&Yi(e.next,s,s.next)<0}function Bf(s,e,n,c,f){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-n)*f|0)|s<<8))|s<<4))|s<<2))|s<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-c)*f|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function s1(s){var e=s,n=s;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==s);return n}function _l(s,e,n,c,f,v,x,b){return(f-x)*(e-b)>=(s-x)*(v-b)&&(s-x)*(c-b)>=(n-x)*(e-b)&&(n-x)*(v-b)>=(f-x)*(c-b)}function r1(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!function(n,c){var f=n;do{if(f.i!==n.i&&f.next.i!==n.i&&f.i!==c.i&&f.next.i!==c.i&&lg(f,f.next,n,c))return!0;f=f.next}while(f!==n);return!1}(s,e)&&(Nc(s,e)&&Nc(e,s)&&function(n,c){var f=n,v=!1,x=(n.x+c.x)/2,b=(n.y+c.y)/2;do f.y>b!=f.next.y>b&&f.next.y!==f.y&&x<(f.next.x-f.x)*(b-f.y)/(f.next.y-f.y)+f.x&&(v=!v),f=f.next;while(f!==n);return v}(s,e)&&(Yi(s.prev,s,e.prev)||Yi(s,e.prev,e))||Fu(s,e)&&Yi(s.prev,s,s.next)>0&&Yi(e.prev,e,e.next)>0)}function Yi(s,e,n){return(e.y-s.y)*(n.x-e.x)-(e.x-s.x)*(n.y-e.y)}function Fu(s,e){return s.x===e.x&&s.y===e.y}function lg(s,e,n,c){var f=Nu(Yi(s,e,n)),v=Nu(Yi(s,e,c)),x=Nu(Yi(n,c,s)),b=Nu(Yi(n,c,e));return f!==v&&x!==b||!(f!==0||!Bu(s,n,e))||!(v!==0||!Bu(s,c,e))||!(x!==0||!Bu(n,s,c))||!(b!==0||!Bu(n,e,c))}function Bu(s,e,n){return e.x<=Math.max(s.x,n.x)&&e.x>=Math.min(s.x,n.x)&&e.y<=Math.max(s.y,n.y)&&e.y>=Math.min(s.y,n.y)}function Nu(s){return s>0?1:s<0?-1:0}function Nc(s,e){return Yi(s.prev,s,s.next)<0?Yi(s,e,s.next)>=0&&Yi(s,s.prev,e)>=0:Yi(s,e,s.prev)<0||Yi(s,s.next,e)<0}function cg(s,e){var n=new Nf(s.i,s.x,s.y),c=new Nf(e.i,e.x,e.y),f=s.next,v=e.prev;return s.next=e,e.prev=s,n.next=f,f.prev=n,c.next=n,n.prev=c,v.next=c,c.prev=v,c}function hg(s,e,n,c){var f=new Nf(s,e,n);return c?(f.next=c.next,f.prev=c,c.next.prev=f,c.next=f):(f.prev=f,f.next=f),f}function $c(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Nf(s,e,n){this.i=s,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function $f(s,e,n,c){for(var f=0,v=e,x=n-c;v<n;v+=c)f+=(s[x]-s[v])*(s[v+1]+s[x+1]),x=v;return f}Ff.exports=Ou,Ff.exports.default=Ou,Ou.deviation=function(s,e,n,c){var f=e&&e.length,v=Math.abs($f(s,0,f?e[0]*n:s.length,n));if(f)for(var x=0,b=e.length;x<b;x++)v-=Math.abs($f(s,e[x]*n,x<b-1?e[x+1]*n:s.length,n));var S=0;for(x=0;x<c.length;x+=3){var E=c[x]*n,D=c[x+1]*n,k=c[x+2]*n;S+=Math.abs((s[E]-s[k])*(s[D+1]-s[E+1])-(s[E]-s[D])*(s[k+1]-s[E+1]))}return v===0&&S===0?0:Math.abs((S-v)/v)},Ou.flatten=function(s){for(var e=s[0][0].length,n={vertices:[],holes:[],dimensions:e},c=0,f=0;f<s.length;f++){for(var v=0;v<s[f].length;v++)for(var x=0;x<e;x++)n.vertices.push(s[f][v][x]);f>0&&n.holes.push(c+=s[f-1].length)}return n};var ug=T(Ff.exports);function n1(s,e,n,c,f){dg(s,e,n||0,c||s.length-1,f||a1)}function dg(s,e,n,c,f){for(;c>n;){if(c-n>600){var v=c-n+1,x=e-n+1,b=Math.log(v),S=.5*Math.exp(2*b/3),E=.5*Math.sqrt(b*S*(v-S)/v)*(x-v/2<0?-1:1);dg(s,e,Math.max(n,Math.floor(e-x*S/v+E)),Math.min(c,Math.floor(e+(v-x)*S/v+E)),f)}var D=s[e],k=n,B=c;for(Vc(s,n,e),f(s[c],D)>0&&Vc(s,n,c);k<B;){for(Vc(s,k,B),k++,B--;f(s[k],D)<0;)k++;for(;f(s[B],D)>0;)B--}f(s[n],D)===0?Vc(s,n,B):Vc(s,++B,c),B<=e&&(n=B+1),e<=B&&(c=B-1)}}function Vc(s,e,n){var c=s[e];s[e]=s[n],s[n]=c}function a1(s,e){return s<e?-1:s>e?1:0}function Vf(s,e){const n=s.length;if(n<=1)return[s];const c=[];let f,v;for(let x=0;x<n;x++){const b=oe(s[x]);b!==0&&(s[x].area=Math.abs(b),v===void 0&&(v=b<0),v===b<0?(f&&c.push(f),f=[s[x]]):f.push(s[x]))}if(f&&c.push(f),e>1)for(let x=0;x<c.length;x++)c[x].length<=e||(n1(c[x],e,1,c[x].length-1,o1),c[x]=c[x].slice(0,e));return c}function o1(s,e){return e.area-s.area}function Uf(s,e,n){const c=n.patternDependencies;let f=!1;for(const v of e){const x=v.paint.get(`${s}-pattern`);x.isConstant()||(f=!0);const b=x.constantOr(null);b&&(f=!0,c[b.to]=!0,c[b.from]=!0)}return f}function qf(s,e,n,c,f){const v=f.patternDependencies;for(const x of e){const b=x.paint.get(`${s}-pattern`).value;if(b.kind!=="constant"){let S=b.evaluate({zoom:c-1},n,{},f.availableImages),E=b.evaluate({zoom:c},n,{},f.availableImages),D=b.evaluate({zoom:c+1},n,{},f.availableImages);S=S&&S.name?S.name:S,E=E&&E.name?E.name:E,D=D&&D.name?D.name:D,v[S]=!0,v[E]=!0,v[D]=!0,n.patterns[x.id]={min:S,mid:E,max:D}}}return n}class jf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Z,this.indexArray=new St,this.indexArray2=new Bt,this.programConfigurations=new Ni(e.layers,e.zoom),this.segments=new Wt,this.segments2=new Wt,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,c){this.hasPattern=Uf("fill",this.layers,n);const f=this.layers[0].layout.get("fill-sort-key"),v=!f.isConstant(),x=[];for(const{feature:b,id:S,index:E,sourceLayerIndex:D}of e){const k=this.layers[0]._featureFilter.needGeometry,B=qn(b,k);if(!this.layers[0]._featureFilter.filter(new ki(this.zoom),B,c))continue;const $=v?f.evaluate(B,{},c,n.availableImages):void 0,U={id:S,properties:b.properties,type:b.type,sourceLayerIndex:D,index:E,geometry:k?B.geometry:Un(b),patterns:{},sortKey:$};x.push(U)}v&&x.sort((b,S)=>b.sortKey-S.sortKey);for(const b of x){const{geometry:S,index:E,sourceLayerIndex:D}=b;if(this.hasPattern){const k=qf("fill",this.layers,b,this.zoom,n);this.patternFeatures.push(k)}else this.addFeature(b,S,E,c,{});n.featureIndex.insert(e[E].feature,S,E,D,this.index)}}update(e,n,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,c)}addFeatures(e,n,c){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,n,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Xx),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,c,f,v){for(const x of Vf(n,500)){let b=0;for(const $ of x)b+=$.length;const S=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),E=S.vertexLength,D=[],k=[];for(const $ of x){if($.length===0)continue;$!==x[0]&&k.push(D.length/2);const U=this.segments2.prepareSegment($.length,this.layoutVertexArray,this.indexArray2),G=U.vertexLength;this.layoutVertexArray.emplaceBack($[0].x,$[0].y),this.indexArray2.emplaceBack(G+$.length-1,G),D.push($[0].x),D.push($[0].y);for(let X=1;X<$.length;X++)this.layoutVertexArray.emplaceBack($[X].x,$[X].y),this.indexArray2.emplaceBack(G+X-1,G+X),D.push($[X].x),D.push($[X].y);U.vertexLength+=$.length,U.primitiveLength+=$.length}const B=ug(D,k);for(let $=0;$<B.length;$+=3)this.indexArray.emplaceBack(E+B[$],E+B[$+1],E+B[$+2]);S.vertexLength+=b,S.primitiveLength+=B.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,v,f)}}let fg,pg;le("FillBucket",jf,{omit:["layers","patternFeatures"]});var l1={get paint(){return pg=pg||new Hs({"fill-antialias":new ve(it.paint_fill["fill-antialias"]),"fill-opacity":new Ae(it.paint_fill["fill-opacity"]),"fill-color":new Ae(it.paint_fill["fill-color"]),"fill-outline-color":new Ae(it.paint_fill["fill-outline-color"]),"fill-translate":new ve(it.paint_fill["fill-translate"]),"fill-translate-anchor":new ve(it.paint_fill["fill-translate-anchor"]),"fill-pattern":new nl(it.paint_fill["fill-pattern"])})},get layout(){return fg=fg||new Hs({"fill-sort-key":new Ae(it.layout_fill["fill-sort-key"])})}};class c1 extends Pr{constructor(e){super(e,l1)}recalculate(e,n){super.recalculate(e,n);const c=this.paint._values["fill-outline-color"];c.value.kind==="constant"&&c.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new jf(e)}queryRadius(){return Ru(this.paint.get("fill-translate"))}queryIntersectsFeature(e,n,c,f,v,x,b){return kc(zu(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,b),f)}isTileClipped(){return!0}}const h1=Ki([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),u1=Ki([{name:"a_centroid",components:2,type:"Int16"}],4),{members:d1}=h1;var ga={},f1=I,mg=yl;function yl(s,e,n,c,f){this.properties={},this.extent=n,this.type=0,this._pbf=s,this._geometry=-1,this._keys=c,this._values=f,s.readFields(p1,this,e)}function p1(s,e,n){s==1?e.id=n.readVarint():s==2?function(c,f){for(var v=c.readVarint()+c.pos;c.pos<v;){var x=f._keys[c.readVarint()],b=f._values[c.readVarint()];f.properties[x]=b}}(n,e):s==3?e.type=n.readVarint():s==4&&(e._geometry=n.pos)}function m1(s){for(var e,n,c=0,f=0,v=s.length,x=v-1;f<v;x=f++)c+=((n=s[x]).x-(e=s[f]).x)*(e.y+n.y);return c}yl.types=["Unknown","Point","LineString","Polygon"],yl.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var e,n=s.readVarint()+s.pos,c=1,f=0,v=0,x=0,b=[];s.pos<n;){if(f<=0){var S=s.readVarint();c=7&S,f=S>>3}if(f--,c===1||c===2)v+=s.readSVarint(),x+=s.readSVarint(),c===1&&(e&&b.push(e),e=[]),e.push(new f1(v,x));else{if(c!==7)throw new Error("unknown command "+c);e&&e.push(e[0].clone())}}return e&&b.push(e),b},yl.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var e=s.readVarint()+s.pos,n=1,c=0,f=0,v=0,x=1/0,b=-1/0,S=1/0,E=-1/0;s.pos<e;){if(c<=0){var D=s.readVarint();n=7&D,c=D>>3}if(c--,n===1||n===2)(f+=s.readSVarint())<x&&(x=f),f>b&&(b=f),(v+=s.readSVarint())<S&&(S=v),v>E&&(E=v);else if(n!==7)throw new Error("unknown command "+n)}return[x,S,b,E]},yl.prototype.toGeoJSON=function(s,e,n){var c,f,v=this.extent*Math.pow(2,n),x=this.extent*s,b=this.extent*e,S=this.loadGeometry(),E=yl.types[this.type];function D($){for(var U=0;U<$.length;U++){var G=$[U];$[U]=[360*(G.x+x)/v-180,360/Math.PI*Math.atan(Math.exp((180-360*(G.y+b)/v)*Math.PI/180))-90]}}switch(this.type){case 1:var k=[];for(c=0;c<S.length;c++)k[c]=S[c][0];D(S=k);break;case 2:for(c=0;c<S.length;c++)D(S[c]);break;case 3:for(S=function($){var U=$.length;if(U<=1)return[$];for(var G,X,st=[],gt=0;gt<U;gt++){var nt=m1($[gt]);nt!==0&&(X===void 0&&(X=nt<0),X===nt<0?(G&&st.push(G),G=[$[gt]]):G.push($[gt]))}return G&&st.push(G),st}(S),c=0;c<S.length;c++)for(f=0;f<S[c].length;f++)D(S[c][f])}S.length===1?S=S[0]:E="Multi"+E;var B={type:"Feature",geometry:{type:E,coordinates:S},properties:this.properties};return"id"in this&&(B.id=this.id),B};var g1=mg,gg=_g;function _g(s,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(_1,this,e),this.length=this._features.length}function _1(s,e,n){s===15?e.version=n.readVarint():s===1?e.name=n.readString():s===5?e.extent=n.readVarint():s===2?e._features.push(n.pos):s===3?e._keys.push(n.readString()):s===4&&e._values.push(function(c){for(var f=null,v=c.readVarint()+c.pos;c.pos<v;){var x=c.readVarint()>>3;f=x===1?c.readString():x===2?c.readFloat():x===3?c.readDouble():x===4?c.readVarint64():x===5?c.readVarint():x===6?c.readSVarint():x===7?c.readBoolean():null}return f}(n))}_g.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var e=this._pbf.readVarint()+this._pbf.pos;return new g1(this._pbf,e,this.extent,this._keys,this._values)};var y1=gg;function v1(s,e,n){if(s===3){var c=new y1(n,n.readVarint()+n.pos);c.length&&(e[c.name]=c)}}ga.VectorTile=function(s,e){this.layers=s.readFields(v1,{},e)},ga.VectorTileFeature=mg,ga.VectorTileLayer=gg;const x1=ga.VectorTileFeature.types,Gf=Math.pow(2,13);function Uc(s,e,n,c,f,v,x,b){s.emplaceBack(e,n,2*Math.floor(c*Gf)+x,f*Gf*2,v*Gf*2,Math.round(b))}class Hf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new W,this.centroidVertexArray=new O,this.indexArray=new St,this.programConfigurations=new Ni(e.layers,e.zoom),this.segments=new Wt,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,c){this.features=[],this.hasPattern=Uf("fill-extrusion",this.layers,n);for(const{feature:f,id:v,index:x,sourceLayerIndex:b}of e){const S=this.layers[0]._featureFilter.needGeometry,E=qn(f,S);if(!this.layers[0]._featureFilter.filter(new ki(this.zoom),E,c))continue;const D={id:v,sourceLayerIndex:b,index:x,geometry:S?E.geometry:Un(f),properties:f.properties,type:f.type,patterns:{}};this.hasPattern?this.features.push(qf("fill-extrusion",this.layers,D,this.zoom,n)):this.addFeature(D,D.geometry,x,c,{}),n.featureIndex.insert(f,D.geometry,x,b,this.index,!0)}}addFeatures(e,n,c){for(const f of this.features){const{geometry:v}=f;this.addFeature(f,v,f.index,n,c)}}update(e,n,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,c)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,d1),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,u1.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,n,c,f,v){const x={x:0,y:0,vertexCount:0};for(const b of Vf(n,500)){let S=0;for(const U of b)S+=U.length;let E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const U of b){if(U.length===0||w1(U))continue;let G=0;for(let X=0;X<U.length;X++){const st=U[X];if(X>=1){const gt=U[X-1];if(!b1(st,gt)){E.vertexLength+4>Wt.MAX_VERTEX_ARRAY_LENGTH&&(E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const nt=st.sub(gt)._perp()._unit(),ft=gt.dist(st);G+ft>32768&&(G=0),Uc(this.layoutVertexArray,st.x,st.y,nt.x,nt.y,0,0,G),Uc(this.layoutVertexArray,st.x,st.y,nt.x,nt.y,0,1,G),x.x+=2*st.x,x.y+=2*st.y,x.vertexCount+=2,G+=ft,Uc(this.layoutVertexArray,gt.x,gt.y,nt.x,nt.y,0,0,G),Uc(this.layoutVertexArray,gt.x,gt.y,nt.x,nt.y,0,1,G),x.x+=2*gt.x,x.y+=2*gt.y,x.vertexCount+=2;const At=E.vertexLength;this.indexArray.emplaceBack(At,At+2,At+1),this.indexArray.emplaceBack(At+1,At+2,At+3),E.vertexLength+=4,E.primitiveLength+=2}}}}if(E.vertexLength+S>Wt.MAX_VERTEX_ARRAY_LENGTH&&(E=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray)),x1[e.type]!=="Polygon")continue;const D=[],k=[],B=E.vertexLength;for(const U of b)if(U.length!==0){U!==b[0]&&k.push(D.length/2);for(let G=0;G<U.length;G++){const X=U[G];Uc(this.layoutVertexArray,X.x,X.y,0,0,1,1,0),x.x+=X.x,x.y+=X.y,x.vertexCount+=1,D.push(X.x),D.push(X.y)}}const $=ug(D,k);for(let U=0;U<$.length;U+=3)this.indexArray.emplaceBack(B+$[U],B+$[U+2],B+$[U+1]);E.primitiveLength+=$.length/3,E.vertexLength+=S}for(let b=0;b<x.vertexCount;b++)this.centroidVertexArray.emplaceBack(Math.floor(x.x/x.vertexCount),Math.floor(x.y/x.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,v,f)}}function b1(s,e){return s.x===e.x&&(s.x<0||s.x>Wi)||s.y===e.y&&(s.y<0||s.y>Wi)}function w1(s){return s.every(e=>e.x<0)||s.every(e=>e.x>Wi)||s.every(e=>e.y<0)||s.every(e=>e.y>Wi)}let yg;le("FillExtrusionBucket",Hf,{omit:["layers","features"]});var M1={get paint(){return yg=yg||new Hs({"fill-extrusion-opacity":new ve(it["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ae(it["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ve(it["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ve(it["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new nl(it["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ae(it["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ae(it["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ve(it["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class S1 extends Pr{constructor(e){super(e,M1)}createBucket(e){return new Hf(e)}queryRadius(){return Ru(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,n,c,f,v,x,b,S){const E=zu(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,b),D=this.paint.get("fill-extrusion-height").evaluate(n,c),k=this.paint.get("fill-extrusion-base").evaluate(n,c),B=function(U,G,X,st){const gt=[];for(const nt of U){const ft=[nt.x,nt.y,0,1];Lu(ft,ft,G),gt.push(new P(ft[0]/ft[3],ft[1]/ft[3]))}return gt}(E,S),$=function(U,G,X,st){const gt=[],nt=[],ft=st[8]*G,At=st[9]*G,Ct=st[10]*G,se=st[11]*G,me=st[8]*X,ie=st[9]*X,Jt=st[10]*X,Ht=st[11]*X;for(const he of U){const Yt=[],$t=[];for(const Me of he){const ge=Me.x,Ze=Me.y,Ei=st[0]*ge+st[4]*Ze+st[12],zi=st[1]*ge+st[5]*Ze+st[13],ds=st[2]*ge+st[6]*Ze+st[14],vr=st[3]*ge+st[7]*Ze+st[15],Zs=ds+Ct,rs=vr+se,ws=Ei+me,Ps=zi+ie,Xs=ds+Jt,Ks=vr+Ht,fs=new P((Ei+ft)/rs,(zi+At)/rs);fs.z=Zs/rs,Yt.push(fs);const ps=new P(ws/Ks,Ps/Ks);ps.z=Xs/Ks,$t.push(ps)}gt.push(Yt),nt.push($t)}return[gt,nt]}(f,k,D,S);return function(U,G,X){let st=1/0;kc(X,G)&&(st=vg(X,G[0]));for(let gt=0;gt<G.length;gt++){const nt=G[gt],ft=U[gt];for(let At=0;At<nt.length-1;At++){const Ct=nt[At],se=[Ct,nt[At+1],ft[At+1],ft[At],Ct];Dc(X,se)&&(st=Math.min(st,vg(X,se)))}}return st!==1/0&&st}($[0],$[1],B)}}function qc(s,e){return s.x*e.x+s.y*e.y}function vg(s,e){if(s.length===1){let n=0;const c=e[n++];let f;for(;!f||c.equals(f);)if(f=e[n++],!f)return 1/0;for(;n<e.length;n++){const v=e[n],x=s[0],b=f.sub(c),S=v.sub(c),E=x.sub(c),D=qc(b,b),k=qc(b,S),B=qc(S,S),$=qc(E,b),U=qc(E,S),G=D*B-k*k,X=(B*$-k*U)/G,st=(D*U-k*$)/G,gt=c.z*(1-X-st)+f.z*X+v.z*st;if(isFinite(gt))return gt}return 1/0}{let n=1/0;for(const c of e)n=Math.min(n,c.z);return n}}const T1=Ki([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:A1}=T1,E1=Ki([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:I1}=E1,P1=ga.VectorTileFeature.types,C1=Math.cos(Math.PI/180*37.5),xg=Math.pow(2,14)/.5;class Wf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new J,this.layoutVertexArray2=new j,this.indexArray=new St,this.programConfigurations=new Ni(e.layers,e.zoom),this.segments=new Wt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,c){this.hasPattern=Uf("line",this.layers,n);const f=this.layers[0].layout.get("line-sort-key"),v=!f.isConstant(),x=[];for(const{feature:b,id:S,index:E,sourceLayerIndex:D}of e){const k=this.layers[0]._featureFilter.needGeometry,B=qn(b,k);if(!this.layers[0]._featureFilter.filter(new ki(this.zoom),B,c))continue;const $=v?f.evaluate(B,{},c):void 0,U={id:S,properties:b.properties,type:b.type,sourceLayerIndex:D,index:E,geometry:k?B.geometry:Un(b),patterns:{},sortKey:$};x.push(U)}v&&x.sort((b,S)=>b.sortKey-S.sortKey);for(const b of x){const{geometry:S,index:E,sourceLayerIndex:D}=b;if(this.hasPattern){const k=qf("line",this.layers,b,this.zoom,n);this.patternFeatures.push(k)}else this.addFeature(b,S,E,c,{});n.featureIndex.insert(e[E].feature,S,E,D,this.index)}}update(e,n,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,c)}addFeatures(e,n,c){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,n,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,I1)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,A1),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,c,f,v){const x=this.layers[0].layout,b=x.get("line-join").evaluate(e,{}),S=x.get("line-cap"),E=x.get("line-miter-limit"),D=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const k of n)this.addLine(k,e,b,S,E,D);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,v,f)}addLine(e,n,c,f,v,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let st=0;st<e.length-1;st++)this.totalDistance+=e[st].dist(e[st+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const b=P1[n.type]==="Polygon";let S=e.length;for(;S>=2&&e[S-1].equals(e[S-2]);)S--;let E=0;for(;E<S-1&&e[E].equals(e[E+1]);)E++;if(S<(b?3:2))return;c==="bevel"&&(v=1.05);const D=this.overscaling<=16?15*Wi/(512*this.overscaling):0,k=this.segments.prepareSegment(10*S,this.layoutVertexArray,this.indexArray);let B,$,U,G,X;this.e1=this.e2=-1,b&&(B=e[S-2],X=e[E].sub(B)._unit()._perp());for(let st=E;st<S;st++){if(U=st===S-1?b?e[E+1]:void 0:e[st+1],U&&e[st].equals(U))continue;X&&(G=X),B&&($=B),B=e[st],X=U?U.sub(B)._unit()._perp():G,G=G||X;let gt=G.add(X);gt.x===0&&gt.y===0||gt._unit();const nt=G.x*X.x+G.y*X.y,ft=gt.x*X.x+gt.y*X.y,At=ft!==0?1/ft:1/0,Ct=2*Math.sqrt(2-2*ft),se=ft<C1&&$&&U,me=G.x*X.y-G.y*X.x>0;if(se&&st>E){const Ht=B.dist($);if(Ht>2*D){const he=B.sub(B.sub($)._mult(D/Ht)._round());this.updateDistance($,he),this.addCurrentVertex(he,G,0,0,k),$=he}}const ie=$&&U;let Jt=ie?c:b?"butt":f;if(ie&&Jt==="round"&&(At<x?Jt="miter":At<=2&&(Jt="fakeround")),Jt==="miter"&&At>v&&(Jt="bevel"),Jt==="bevel"&&(At>2&&(Jt="flipbevel"),At<v&&(Jt="miter")),$&&this.updateDistance($,B),Jt==="miter")gt._mult(At),this.addCurrentVertex(B,gt,0,0,k);else if(Jt==="flipbevel"){if(At>100)gt=X.mult(-1);else{const Ht=At*G.add(X).mag()/G.sub(X).mag();gt._perp()._mult(Ht*(me?-1:1))}this.addCurrentVertex(B,gt,0,0,k),this.addCurrentVertex(B,gt.mult(-1),0,0,k)}else if(Jt==="bevel"||Jt==="fakeround"){const Ht=-Math.sqrt(At*At-1),he=me?Ht:0,Yt=me?0:Ht;if($&&this.addCurrentVertex(B,G,he,Yt,k),Jt==="fakeround"){const $t=Math.round(180*Ct/Math.PI/20);for(let Me=1;Me<$t;Me++){let ge=Me/$t;if(ge!==.5){const Ei=ge-.5;ge+=ge*Ei*(ge-1)*((1.0904+nt*(nt*(3.55645-1.43519*nt)-3.2452))*Ei*Ei+(.848013+nt*(.215638*nt-1.06021)))}const Ze=X.sub(G)._mult(ge)._add(G)._unit()._mult(me?-1:1);this.addHalfVertex(B,Ze.x,Ze.y,!1,me,0,k)}}U&&this.addCurrentVertex(B,X,-he,-Yt,k)}else if(Jt==="butt")this.addCurrentVertex(B,gt,0,0,k);else if(Jt==="square"){const Ht=$?1:-1;this.addCurrentVertex(B,gt,Ht,Ht,k)}else Jt==="round"&&($&&(this.addCurrentVertex(B,G,0,0,k),this.addCurrentVertex(B,G,1,1,k,!0)),U&&(this.addCurrentVertex(B,X,-1,-1,k,!0),this.addCurrentVertex(B,X,0,0,k)));if(se&&st<S-1){const Ht=B.dist(U);if(Ht>2*D){const he=B.add(U.sub(B)._mult(D/Ht)._round());this.updateDistance(B,he),this.addCurrentVertex(he,X,0,0,k),B=he}}}}addCurrentVertex(e,n,c,f,v,x=!1){const b=n.y*f-n.x,S=-n.y-n.x*f;this.addHalfVertex(e,n.x+n.y*c,n.y-n.x*c,x,!1,c,v),this.addHalfVertex(e,b,S,x,!0,-f,v),this.distance>xg/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,n,c,f,v,x))}addHalfVertex({x:e,y:n},c,f,v,x,b,S){const E=.5*(this.lineClips?this.scaledDistance*(xg-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(v?1:0),(n<<1)+(x?1:0),Math.round(63*c)+128,Math.round(63*f)+128,1+(b===0?0:b<0?-1:1)|(63&E)<<2,E>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const D=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),S.primitiveLength++),x?this.e2=D:this.e1=D}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}let bg,wg;le("LineBucket",Wf,{omit:["layers","patternFeatures"]});var Mg={get paint(){return wg=wg||new Hs({"line-opacity":new Ae(it.paint_line["line-opacity"]),"line-color":new Ae(it.paint_line["line-color"]),"line-translate":new ve(it.paint_line["line-translate"]),"line-translate-anchor":new ve(it.paint_line["line-translate-anchor"]),"line-width":new Ae(it.paint_line["line-width"]),"line-gap-width":new Ae(it.paint_line["line-gap-width"]),"line-offset":new Ae(it.paint_line["line-offset"]),"line-blur":new Ae(it.paint_line["line-blur"]),"line-dasharray":new io(it.paint_line["line-dasharray"]),"line-pattern":new nl(it.paint_line["line-pattern"]),"line-gradient":new bc(it.paint_line["line-gradient"])})},get layout(){return bg=bg||new Hs({"line-cap":new ve(it.layout_line["line-cap"]),"line-join":new Ae(it.layout_line["line-join"]),"line-miter-limit":new ve(it.layout_line["line-miter-limit"]),"line-round-limit":new ve(it.layout_line["line-round-limit"]),"line-sort-key":new Ae(it.layout_line["line-sort-key"])})}};class D1 extends Ae{possiblyEvaluate(e,n){return n=new ki(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(e,n)}evaluate(e,n,c,f){return n=ce({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,c,f)}}let $u;class k1 extends Pr{constructor(e){super(e,Mg),this.gradientVersion=0,$u||($u=new D1(Mg.paint.properties["line-width"].specification),$u.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!function(c){return c._styleExpression!==void 0}(n)&&n._styleExpression.expression instanceof Za,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,n){super.recalculate(e,n),this.paint._values["line-floorwidth"]=$u.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Wf(e)}queryRadius(e){const n=e,c=Sg(Lc("line-width",this,n),Lc("line-gap-width",this,n)),f=Lc("line-offset",this,n);return c/2+Math.abs(f)+Ru(this.paint.get("line-translate"))}queryIntersectsFeature(e,n,c,f,v,x,b){const S=zu(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,b),E=b/2*Sg(this.paint.get("line-width").evaluate(n,c),this.paint.get("line-gap-width").evaluate(n,c)),D=this.paint.get("line-offset").evaluate(n,c);return D&&(f=function(k,B){const $=[];for(let U=0;U<k.length;U++){const G=k[U],X=[];for(let st=0;st<G.length;st++){const gt=G[st-1],nt=G[st],ft=G[st+1],At=st===0?new P(0,0):nt.sub(gt)._unit()._perp(),Ct=st===G.length-1?new P(0,0):ft.sub(nt)._unit()._perp(),se=At._add(Ct)._unit(),me=se.x*Ct.x+se.y*Ct.y;me!==0&&se._mult(1/me),X.push(se._mult(B)._add(nt))}$.push(X)}return $}(f,D*b)),function(k,B,$){for(let U=0;U<B.length;U++){const G=B[U];if(k.length>=3){for(let X=0;X<G.length;X++)if(ml(k,G[X]))return!0}if(Rc(k,G,$))return!0}return!1}(S,f,E)}isTileClipped(){return!0}}function Sg(s,e){return e>0?e+2*s:s}const R1=Ki([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),z1=Ki([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ki([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const L1=Ki([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Ki([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Tg=Ki([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),O1=Ki([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function F1(s,e,n){return s.sections.forEach(c=>{c.text=function(f,v,x){const b=v.layout.get("text-transform").evaluate(x,{});return b==="uppercase"?f=f.toLocaleUpperCase():b==="lowercase"&&(f=f.toLocaleLowerCase()),gn.applyArabicShaping&&(f=gn.applyArabicShaping(f)),f}(c.text,e,n)}),s}Ki([{name:"triangle",components:3,type:"Uint16"}]),Ki([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ki([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Ki([{type:"Float32",name:"offsetX"}]),Ki([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Ki([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const jc={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var us=24,Ag=yi,Eg=function(s,e,n,c,f){var v,x,b=8*f-c-1,S=(1<<b)-1,E=S>>1,D=-7,k=n?f-1:0,B=n?-1:1,$=s[e+k];for(k+=B,v=$&(1<<-D)-1,$>>=-D,D+=b;D>0;v=256*v+s[e+k],k+=B,D-=8);for(x=v&(1<<-D)-1,v>>=-D,D+=c;D>0;x=256*x+s[e+k],k+=B,D-=8);if(v===0)v=1-E;else{if(v===S)return x?NaN:1/0*($?-1:1);x+=Math.pow(2,c),v-=E}return($?-1:1)*x*Math.pow(2,v-c)},Ig=function(s,e,n,c,f,v){var x,b,S,E=8*v-f-1,D=(1<<E)-1,k=D>>1,B=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,$=c?0:v-1,U=c?1:-1,G=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(b=isNaN(e)?1:0,x=D):(x=Math.floor(Math.log(e)/Math.LN2),e*(S=Math.pow(2,-x))<1&&(x--,S*=2),(e+=x+k>=1?B/S:B*Math.pow(2,1-k))*S>=2&&(x++,S/=2),x+k>=D?(b=0,x=D):x+k>=1?(b=(e*S-1)*Math.pow(2,f),x+=k):(b=e*Math.pow(2,k-1)*Math.pow(2,f),x=0));f>=8;s[n+$]=255&b,$+=U,b/=256,f-=8);for(x=x<<f|b,E+=f;E>0;s[n+$]=255&x,$+=U,x/=256,E-=8);s[n+$-U]|=128*G};function yi(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}yi.Varint=0,yi.Fixed64=1,yi.Bytes=2,yi.Fixed32=5;var Zf=4294967296,Pg=1/Zf,Cg=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function jn(s){return s.type===yi.Bytes?s.readVarint()+s.pos:s.pos+1}function vl(s,e,n){return n?4294967296*e+(s>>>0):4294967296*(e>>>0)+(s>>>0)}function Dg(s,e,n){var c=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(c);for(var f=n.pos-1;f>=s;f--)n.buf[f+c]=n.buf[f]}function B1(s,e){for(var n=0;n<s.length;n++)e.writeVarint(s[n])}function N1(s,e){for(var n=0;n<s.length;n++)e.writeSVarint(s[n])}function $1(s,e){for(var n=0;n<s.length;n++)e.writeFloat(s[n])}function V1(s,e){for(var n=0;n<s.length;n++)e.writeDouble(s[n])}function U1(s,e){for(var n=0;n<s.length;n++)e.writeBoolean(s[n])}function q1(s,e){for(var n=0;n<s.length;n++)e.writeFixed32(s[n])}function j1(s,e){for(var n=0;n<s.length;n++)e.writeSFixed32(s[n])}function G1(s,e){for(var n=0;n<s.length;n++)e.writeFixed64(s[n])}function H1(s,e){for(var n=0;n<s.length;n++)e.writeSFixed64(s[n])}function Vu(s,e){return(s[e]|s[e+1]<<8|s[e+2]<<16)+16777216*s[e+3]}function xl(s,e,n){s[n]=e,s[n+1]=e>>>8,s[n+2]=e>>>16,s[n+3]=e>>>24}function kg(s,e){return(s[e]|s[e+1]<<8|s[e+2]<<16)+(s[e+3]<<24)}yi.prototype={destroy:function(){this.buf=null},readFields:function(s,e,n){for(n=n||this.length;this.pos<n;){var c=this.readVarint(),f=c>>3,v=this.pos;this.type=7&c,s(f,e,this),this.pos===v&&this.skip(c)}return e},readMessage:function(s,e){return this.readFields(s,e,this.readVarint()+this.pos)},readFixed32:function(){var s=Vu(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=kg(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=Vu(this.buf,this.pos)+Vu(this.buf,this.pos+4)*Zf;return this.pos+=8,s},readSFixed64:function(){var s=Vu(this.buf,this.pos)+kg(this.buf,this.pos+4)*Zf;return this.pos+=8,s},readFloat:function(){var s=Eg(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=Eg(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var e,n,c=this.buf;return e=127&(n=c[this.pos++]),n<128?e:(e|=(127&(n=c[this.pos++]))<<7,n<128?e:(e|=(127&(n=c[this.pos++]))<<14,n<128?e:(e|=(127&(n=c[this.pos++]))<<21,n<128?e:function(f,v,x){var b,S,E=x.buf;if(b=(112&(S=E[x.pos++]))>>4,S<128||(b|=(127&(S=E[x.pos++]))<<3,S<128)||(b|=(127&(S=E[x.pos++]))<<10,S<128)||(b|=(127&(S=E[x.pos++]))<<17,S<128)||(b|=(127&(S=E[x.pos++]))<<24,S<128)||(b|=(1&(S=E[x.pos++]))<<31,S<128))return vl(f,b,v);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=c[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,e=this.pos;return this.pos=s,s-e>=12&&Cg?function(n,c,f){return Cg.decode(n.subarray(c,f))}(this.buf,e,s):function(n,c,f){for(var v="",x=c;x<f;){var b,S,E,D=n[x],k=null,B=D>239?4:D>223?3:D>191?2:1;if(x+B>f)break;B===1?D<128&&(k=D):B===2?(192&(b=n[x+1]))==128&&(k=(31&D)<<6|63&b)<=127&&(k=null):B===3?(S=n[x+2],(192&(b=n[x+1]))==128&&(192&S)==128&&((k=(15&D)<<12|(63&b)<<6|63&S)<=2047||k>=55296&&k<=57343)&&(k=null)):B===4&&(S=n[x+2],E=n[x+3],(192&(b=n[x+1]))==128&&(192&S)==128&&(192&E)==128&&((k=(15&D)<<18|(63&b)<<12|(63&S)<<6|63&E)<=65535||k>=1114112)&&(k=null)),k===null?(k=65533,B=1):k>65535&&(k-=65536,v+=String.fromCharCode(k>>>10&1023|55296),k=56320|1023&k),v+=String.fromCharCode(k),x+=B}return v}(this.buf,e,s)},readBytes:function(){var s=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,s);return this.pos=s,e},readPackedVarint:function(s,e){if(this.type!==yi.Bytes)return s.push(this.readVarint(e));var n=jn(this);for(s=s||[];this.pos<n;)s.push(this.readVarint(e));return s},readPackedSVarint:function(s){if(this.type!==yi.Bytes)return s.push(this.readSVarint());var e=jn(this);for(s=s||[];this.pos<e;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==yi.Bytes)return s.push(this.readBoolean());var e=jn(this);for(s=s||[];this.pos<e;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==yi.Bytes)return s.push(this.readFloat());var e=jn(this);for(s=s||[];this.pos<e;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==yi.Bytes)return s.push(this.readDouble());var e=jn(this);for(s=s||[];this.pos<e;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==yi.Bytes)return s.push(this.readFixed32());var e=jn(this);for(s=s||[];this.pos<e;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==yi.Bytes)return s.push(this.readSFixed32());var e=jn(this);for(s=s||[];this.pos<e;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==yi.Bytes)return s.push(this.readFixed64());var e=jn(this);for(s=s||[];this.pos<e;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==yi.Bytes)return s.push(this.readSFixed64());var e=jn(this);for(s=s||[];this.pos<e;)s.push(this.readSFixed64());return s},skip:function(s){var e=7&s;if(e===yi.Varint)for(;this.buf[this.pos++]>127;);else if(e===yi.Bytes)this.pos=this.readVarint()+this.pos;else if(e===yi.Fixed32)this.pos+=4;else{if(e!==yi.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(s,e){this.writeVarint(s<<3|e)},realloc:function(s){for(var e=this.length||16;e<this.pos+s;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),xl(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),xl(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),xl(this.buf,-1&s,this.pos),xl(this.buf,Math.floor(s*Pg),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),xl(this.buf,-1&s,this.pos),xl(this.buf,Math.floor(s*Pg),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(e,n){var c,f;if(e>=0?(c=e%4294967296|0,f=e/4294967296|0):(f=~(-e/4294967296),4294967295^(c=~(-e%4294967296))?c=c+1|0:(c=0,f=f+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(v,x,b){b.buf[b.pos++]=127&v|128,v>>>=7,b.buf[b.pos++]=127&v|128,v>>>=7,b.buf[b.pos++]=127&v|128,v>>>=7,b.buf[b.pos++]=127&v|128,b.buf[b.pos]=127&(v>>>=7)}(c,0,n),function(v,x){var b=(7&v)<<4;x.buf[x.pos++]|=b|((v>>>=3)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v)))))}(f,n)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var e=this.pos;this.pos=function(c,f,v){for(var x,b,S=0;S<f.length;S++){if((x=f.charCodeAt(S))>55295&&x<57344){if(!b){x>56319||S+1===f.length?(c[v++]=239,c[v++]=191,c[v++]=189):b=x;continue}if(x<56320){c[v++]=239,c[v++]=191,c[v++]=189,b=x;continue}x=b-55296<<10|x-56320|65536,b=null}else b&&(c[v++]=239,c[v++]=191,c[v++]=189,b=null);x<128?c[v++]=x:(x<2048?c[v++]=x>>6|192:(x<65536?c[v++]=x>>12|224:(c[v++]=x>>18|240,c[v++]=x>>12&63|128),c[v++]=x>>6&63|128),c[v++]=63&x|128)}return v}(this.buf,s,this.pos);var n=this.pos-e;n>=128&&Dg(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(s){this.realloc(4),Ig(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),Ig(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var e=s.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=s[n]},writeRawMessage:function(s,e){this.pos++;var n=this.pos;s(e,this);var c=this.pos-n;c>=128&&Dg(n,c,this),this.pos=n-1,this.writeVarint(c),this.pos+=c},writeMessage:function(s,e,n){this.writeTag(s,yi.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(s,e){e.length&&this.writeMessage(s,B1,e)},writePackedSVarint:function(s,e){e.length&&this.writeMessage(s,N1,e)},writePackedBoolean:function(s,e){e.length&&this.writeMessage(s,U1,e)},writePackedFloat:function(s,e){e.length&&this.writeMessage(s,$1,e)},writePackedDouble:function(s,e){e.length&&this.writeMessage(s,V1,e)},writePackedFixed32:function(s,e){e.length&&this.writeMessage(s,q1,e)},writePackedSFixed32:function(s,e){e.length&&this.writeMessage(s,j1,e)},writePackedFixed64:function(s,e){e.length&&this.writeMessage(s,G1,e)},writePackedSFixed64:function(s,e){e.length&&this.writeMessage(s,H1,e)},writeBytesField:function(s,e){this.writeTag(s,yi.Bytes),this.writeBytes(e)},writeFixed32Field:function(s,e){this.writeTag(s,yi.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(s,e){this.writeTag(s,yi.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(s,e){this.writeTag(s,yi.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(s,e){this.writeTag(s,yi.Fixed64),this.writeSFixed64(e)},writeVarintField:function(s,e){this.writeTag(s,yi.Varint),this.writeVarint(e)},writeSVarintField:function(s,e){this.writeTag(s,yi.Varint),this.writeSVarint(e)},writeStringField:function(s,e){this.writeTag(s,yi.Bytes),this.writeString(e)},writeFloatField:function(s,e){this.writeTag(s,yi.Fixed32),this.writeFloat(e)},writeDoubleField:function(s,e){this.writeTag(s,yi.Fixed64),this.writeDouble(e)},writeBooleanField:function(s,e){this.writeVarintField(s,!!e)}};var Xf=T(Ag);const Kf=3;function W1(s,e,n){s===1&&n.readMessage(Z1,e)}function Z1(s,e,n){if(s===3){const{id:c,bitmap:f,width:v,height:x,left:b,top:S,advance:E}=n.readMessage(X1,{});e.push({id:c,bitmap:new Fc({width:v+2*Kf,height:x+2*Kf},f),metrics:{width:v,height:x,left:b,top:S,advance:E}})}}function X1(s,e,n){s===1?e.id=n.readVarint():s===2?e.bitmap=n.readBytes():s===3?e.width=n.readVarint():s===4?e.height=n.readVarint():s===5?e.left=n.readSVarint():s===6?e.top=n.readSVarint():s===7&&(e.advance=n.readVarint())}const Rg=Kf;function zg(s){let e=0,n=0;for(const x of s)e+=x.w*x.h,n=Math.max(n,x.w);s.sort((x,b)=>b.h-x.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let f=0,v=0;for(const x of s)for(let b=c.length-1;b>=0;b--){const S=c[b];if(!(x.w>S.w||x.h>S.h)){if(x.x=S.x,x.y=S.y,v=Math.max(v,x.y+x.h),f=Math.max(f,x.x+x.w),x.w===S.w&&x.h===S.h){const E=c.pop();b<c.length&&(c[b]=E)}else x.h===S.h?(S.x+=x.w,S.w-=x.w):x.w===S.w?(S.y+=x.h,S.h-=x.h):(c.push({x:S.x+x.w,y:S.y,w:S.w-x.w,h:x.h}),S.y+=x.h,S.h-=x.h);break}}return{w:f,h:v,fill:e/(f*v)||0}}const ar=1;class Yf{constructor(e,{pixelRatio:n,version:c,stretchX:f,stretchY:v,content:x}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=f,this.stretchY=v,this.content=x,this.version=c}get tl(){return[this.paddedRect.x+ar,this.paddedRect.y+ar]}get br(){return[this.paddedRect.x+this.paddedRect.w-ar,this.paddedRect.y+this.paddedRect.h-ar]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*ar)/this.pixelRatio,(this.paddedRect.h-2*ar)/this.pixelRatio]}}class Lg{constructor(e,n){const c={},f={};this.haveRenderCallbacks=[];const v=[];this.addImages(e,c,v),this.addImages(n,f,v);const{w:x,h:b}=zg(v),S=new Cr({width:x||1,height:b||1});for(const E in e){const D=e[E],k=c[E].paddedRect;Cr.copy(D.data,S,{x:0,y:0},{x:k.x+ar,y:k.y+ar},D.data)}for(const E in n){const D=n[E],k=f[E].paddedRect,B=k.x+ar,$=k.y+ar,U=D.data.width,G=D.data.height;Cr.copy(D.data,S,{x:0,y:0},{x:B,y:$},D.data),Cr.copy(D.data,S,{x:0,y:G-1},{x:B,y:$-1},{width:U,height:1}),Cr.copy(D.data,S,{x:0,y:0},{x:B,y:$+G},{width:U,height:1}),Cr.copy(D.data,S,{x:U-1,y:0},{x:B-1,y:$},{width:1,height:G}),Cr.copy(D.data,S,{x:0,y:0},{x:B+U,y:$},{width:1,height:G})}this.image=S,this.iconPositions=c,this.patternPositions=f}addImages(e,n,c){for(const f in e){const v=e[f],x={x:0,y:0,w:v.data.width+2*ar,h:v.data.height+2*ar};c.push(x),n[f]=new Yf(x,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(e,n){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in e.updatedImages)this.patchUpdatedImage(this.iconPositions[c],e.getImage(c),n),this.patchUpdatedImage(this.patternPositions[c],e.getImage(c),n)}patchUpdatedImage(e,n,c){if(!e||!n||e.version===n.version)return;e.version=n.version;const[f,v]=e.tl;c.update(n.data,void 0,{x:f,y:v})}}var _a;le("ImagePosition",Yf),le("ImageAtlas",Lg),m.ah=void 0,(_a=m.ah||(m.ah={}))[_a.none=0]="none",_a[_a.horizontal=1]="horizontal",_a[_a.vertical=2]="vertical",_a[_a.horizontalOnly=3]="horizontalOnly";const Gc=-17;class Hc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const c=new Hc;return c.scale=e||1,c.fontStack=n,c}static forImage(e){const n=new Hc;return n.imageName=e,n}}class bl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const c=new bl;for(let f=0;f<e.sections.length;f++){const v=e.sections[f];v.image?c.addImageSection(v):c.addTextSection(v,n)}return c}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let n="";for(let c=0;c<e.length;c++){const f=e.charCodeAt(c+1)||null,v=e.charCodeAt(c-1)||null;n+=f&&vc(f)&&!jc[e[c+1]]||v&&vc(v)&&!jc[e[c-1]]||!jc[e[c]]?e[c]:jc[e[c]]}return n}(this.text)}trim(){let e=0;for(let c=0;c<this.text.length&&qu[this.text.charCodeAt(c)];c++)e++;let n=this.text.length;for(let c=this.text.length-1;c>=0&&c>=e&&qu[this.text.charCodeAt(c)];c--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const c=new bl;return c.text=this.text.substring(e,n),c.sectionIndex=this.sectionIndex.slice(e,n),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Hc.forText(e.scale,e.fontStack||n));const c=this.sections.length-1;for(let f=0;f<e.text.length;++f)this.sectionIndex.push(c)}addImageSection(e){const n=e.image?e.image.name:"";if(n.length===0)return void pe("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Hc.forImage(n)),this.sectionIndex.push(this.sections.length-1)):pe("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Uu(s,e,n,c,f,v,x,b,S,E,D,k,B,$,U,G){const X=bl.fromFeature(s,f);let st;k===m.ah.vertical&&X.verticalizePunctuation();const{processBidirectionalText:gt,processStyledBidirectionalText:nt}=gn;if(gt&&X.sections.length===1){st=[];const Ct=gt(X.toString(),Jf(X,E,v,e,c,$,U));for(const se of Ct){const me=new bl;me.text=se,me.sections=X.sections;for(let ie=0;ie<se.length;ie++)me.sectionIndex.push(0);st.push(me)}}else if(nt){st=[];const Ct=nt(X.text,X.sectionIndex,Jf(X,E,v,e,c,$,U));for(const se of Ct){const me=new bl;me.text=se[0],me.sectionIndex=se[1],me.sections=X.sections,st.push(me)}}else st=function(Ct,se){const me=[],ie=Ct.text;let Jt=0;for(const Ht of se)me.push(Ct.substring(Jt,Ht)),Jt=Ht;return Jt<ie.length&&me.push(Ct.substring(Jt,ie.length)),me}(X,Jf(X,E,v,e,c,$,U));const ft=[],At={positionedLines:ft,text:X.toString(),top:D[1],bottom:D[1],left:D[0],right:D[0],writingMode:k,iconsInText:!1,verticalizable:!1};return function(Ct,se,me,ie,Jt,Ht,he,Yt,$t,Me,ge,Ze){let Ei=0,zi=Gc,ds=0,vr=0;const Zs=Yt==="right"?1:Yt==="left"?0:.5;let rs=0;for(const fs of Jt){fs.trim();const ps=fs.getMaxScale(),Os=(ps-1)*us,Ys={positionedGlyphs:[],lineOffset:0};Ct.positionedLines[rs]=Ys;const Fs=Ys.positionedGlyphs;let or=0;if(!fs.length()){zi+=Ht,++rs;continue}for(let ms=0;ms<fs.length();ms++){const Je=fs.getSection(ms),Bs=fs.getSectionIndex(ms),Cs=fs.getCharCode(ms);let gs=0,qr=null,Qr=null,tn=null,Gn=us;const jr=!($t===m.ah.horizontal||!ge&&!il(Cs)||ge&&(qu[Cs]||(ws=Cs,ee.Arabic(ws)||ee["Arabic Supplement"](ws)||ee["Arabic Extended-A"](ws)||ee["Arabic Presentation Forms-A"](ws)||ee["Arabic Presentation Forms-B"](ws))));if(Je.imageName){const kr=ie[Je.imageName];if(!kr)continue;tn=Je.imageName,Ct.iconsInText=Ct.iconsInText||!0,Qr=kr.paddedRect;const cr=kr.displaySize;Je.scale=Je.scale*us/Ze,qr={width:cr[0],height:cr[1],left:ar,top:-Rg,advance:jr?cr[1]:cr[0]},gs=Os+(us-cr[1]*Je.scale),Gn=qr.advance;const Hn=jr?cr[0]*Je.scale-us*ps:cr[1]*Je.scale-us*ps;Hn>0&&Hn>or&&(or=Hn)}else{const kr=me[Je.fontStack],cr=kr&&kr[Cs];if(cr&&cr.rect)Qr=cr.rect,qr=cr.metrics;else{const Hn=se[Je.fontStack],Yc=Hn&&Hn[Cs];if(!Yc)continue;qr=Yc.metrics}gs=(ps-Je.scale)*us}jr?(Ct.verticalizable=!0,Fs.push({glyph:Cs,imageName:tn,x:Ei,y:zi+gs,vertical:jr,scale:Je.scale,fontStack:Je.fontStack,sectionIndex:Bs,metrics:qr,rect:Qr}),Ei+=Gn*Je.scale+Me):(Fs.push({glyph:Cs,imageName:tn,x:Ei,y:zi+gs,vertical:jr,scale:Je.scale,fontStack:Je.fontStack,sectionIndex:Bs,metrics:qr,rect:Qr}),Ei+=qr.advance*Je.scale+Me)}Fs.length!==0&&(ds=Math.max(Ei-Me,ds),J1(Fs,0,Fs.length-1,Zs,or)),Ei=0;const lr=Ht*ps+or;Ys.lineOffset=Math.max(or,Os),zi+=lr,vr=Math.max(lr,vr),++rs}var ws;const Ps=zi-Gc,{horizontalAlign:Xs,verticalAlign:Ks}=Qf(he);(function(fs,ps,Os,Ys,Fs,or,lr,ms,Je){const Bs=(ps-Os)*Fs;let Cs=0;Cs=or!==lr?-ms*Ys-Gc:(-Ys*Je+.5)*lr;for(const gs of fs)for(const qr of gs.positionedGlyphs)qr.x+=Bs,qr.y+=Cs})(Ct.positionedLines,Zs,Xs,Ks,ds,vr,Ht,Ps,Jt.length),Ct.top+=-Ks*Ps,Ct.bottom=Ct.top+Ps,Ct.left+=-Xs*ds,Ct.right=Ct.left+ds}(At,e,n,c,st,x,b,S,k,E,B,G),!function(Ct){for(const se of Ct)if(se.positionedGlyphs.length!==0)return!1;return!0}(ft)&&At}const qu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},K1={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Og(s,e,n,c,f,v){if(e.imageName){const x=c[e.imageName];return x?x.displaySize[0]*e.scale*us/v+f:0}{const x=n[e.fontStack],b=x&&x[s];return b?b.metrics.advance*e.scale+f:0}}function Fg(s,e,n,c){const f=Math.pow(s-e,2);return c?s<e?f/2:2*f:f+Math.abs(n)*n}function Y1(s,e,n){let c=0;return s===10&&(c-=1e4),n&&(c+=150),s!==40&&s!==65288||(c+=50),e!==41&&e!==65289||(c+=50),c}function Bg(s,e,n,c,f,v){let x=null,b=Fg(e,n,f,v);for(const S of c){const E=Fg(e-S.x,n,f,v)+S.badness;E<=b&&(x=S,b=E)}return{index:s,x:e,priorBreak:x,badness:b}}function Ng(s){return s?Ng(s.priorBreak).concat(s.index):[]}function Jf(s,e,n,c,f,v,x){if(v!=="point")return[];if(!s)return[];const b=[],S=function(B,$,U,G,X,st){let gt=0;for(let nt=0;nt<B.length();nt++){const ft=B.getSection(nt);gt+=Og(B.getCharCode(nt),ft,G,X,$,st)}return gt/Math.max(1,Math.ceil(gt/U))}(s,e,n,c,f,x),E=s.text.indexOf("​")>=0;let D=0;for(let B=0;B<s.length();B++){const $=s.getSection(B),U=s.getCharCode(B);if(qu[U]||(D+=Og(U,$,c,f,e,x)),B<s.length()-1){const G=!((k=U)<11904||!(ee["Bopomofo Extended"](k)||ee.Bopomofo(k)||ee["CJK Compatibility Forms"](k)||ee["CJK Compatibility Ideographs"](k)||ee["CJK Compatibility"](k)||ee["CJK Radicals Supplement"](k)||ee["CJK Strokes"](k)||ee["CJK Symbols and Punctuation"](k)||ee["CJK Unified Ideographs Extension A"](k)||ee["CJK Unified Ideographs"](k)||ee["Enclosed CJK Letters and Months"](k)||ee["Halfwidth and Fullwidth Forms"](k)||ee.Hiragana(k)||ee["Ideographic Description Characters"](k)||ee["Kangxi Radicals"](k)||ee["Katakana Phonetic Extensions"](k)||ee.Katakana(k)||ee["Vertical Forms"](k)||ee["Yi Radicals"](k)||ee["Yi Syllables"](k)));(K1[U]||G||$.imageName)&&b.push(Bg(B+1,D,S,b,Y1(U,s.getCharCode(B+1),G&&E),!1))}}var k;return Ng(Bg(s.length(),D,S,b,0,!0))}function Qf(s){let e=.5,n=.5;switch(s){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function J1(s,e,n,c,f){if(!c&&!f)return;const v=s[n],x=(s[n].x+v.metrics.advance*v.scale)*c;for(let b=e;b<=n;b++)s[b].x-=x,s[b].y+=f}function Q1(s,e,n){const{horizontalAlign:c,verticalAlign:f}=Qf(n),v=e[0]-s.displaySize[0]*c,x=e[1]-s.displaySize[1]*f;return{image:s,top:x,bottom:x+s.displaySize[1],left:v,right:v+s.displaySize[0]}}function $g(s,e,n,c,f,v){const x=s.image;let b;if(x.content){const X=x.content,st=x.pixelRatio||1;b=[X[0]/st,X[1]/st,x.displaySize[0]-X[2]/st,x.displaySize[1]-X[3]/st]}const S=e.left*v,E=e.right*v;let D,k,B,$;n==="width"||n==="both"?($=f[0]+S-c[3],k=f[0]+E+c[1]):($=f[0]+(S+E-x.displaySize[0])/2,k=$+x.displaySize[0]);const U=e.top*v,G=e.bottom*v;return n==="height"||n==="both"?(D=f[1]+U-c[0],B=f[1]+G+c[2]):(D=f[1]+(U+G-x.displaySize[1])/2,B=D+x.displaySize[1]),{image:x,top:D,right:k,bottom:B,left:$,collisionPadding:b}}const Wc=255,xn=128,ya=Wc*xn;function Vg(s,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new ki(s+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:f}=n;let v=0;for(;v<c.length&&c[v]<=s;)v++;v=Math.max(0,v-1);let x=v;for(;x<c.length&&c[x]<s+1;)x++;x=Math.min(c.length-1,x);const b=c[v],S=c[x];return n.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:S,interpolationType:f}:{kind:"camera",minZoom:b,maxZoom:S,minSize:n.evaluate(new ki(b)),maxSize:n.evaluate(new ki(S)),interpolationType:f}}}function tp(s,e,n){let c="never";const f=s.get(e);return f?c=f:s.get(n)&&(c="always"),c}const tb=ga.VectorTileFeature.types,eb=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ju(s,e,n,c,f,v,x,b,S,E,D,k,B){const $=b?Math.min(ya,Math.round(b[0])):0,U=b?Math.min(ya,Math.round(b[1])):0;s.emplaceBack(e,n,Math.round(32*c),Math.round(32*f),v,x,($<<1)+(S?1:0),U,16*E,16*D,256*k,256*B)}function ep(s,e,n){s.emplaceBack(e.x,e.y,n),s.emplaceBack(e.x,e.y,n),s.emplaceBack(e.x,e.y,n),s.emplaceBack(e.x,e.y,n)}function ib(s){for(const e of s.sections)if(kf(e.text))return!0;return!1}class ip{constructor(e){this.layoutVertexArray=new xt,this.indexArray=new St,this.programConfigurations=e,this.segments=new Wt,this.dynamicLayoutVertexArray=new et,this.opacityVertexArray=new pt,this.hasVisibleVertices=!1,this.placedSymbolArray=new o}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,c,f){this.isEmpty()||(c&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,R1.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,z1.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,eb,!0),this.opacityVertexBuffer.itemSize=1),(c||f)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}le("SymbolBuffers",ip);class sp{constructor(e,n,c){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new c,this.segments=new Wt,this.collisionVertexArray=new wt}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,L1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}le("CollisionBuffers",sp);class wl{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(x=>x.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=zf([]),this.placementViewportMatrix=zf([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Vg(this.zoom,n["text-size"]),this.iconSizeData=Vg(this.zoom,n["icon-size"]);const c=this.layers[0].layout,f=c.get("symbol-sort-key"),v=c.get("symbol-z-order");this.canOverlap=tp(c,"text-overlap","text-allow-overlap")!=="never"||tp(c,"icon-overlap","icon-allow-overlap")!=="never"||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&!f.isConstant(),this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,c.get("symbol-placement")==="point"&&(this.writingModes=c.get("text-writing-mode").map(x=>m.ah[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=e.sourceID}createArrays(){this.text=new ip(new Ni(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new ip(new Ni(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new y,this.lineVertexArray=new w,this.symbolInstances=new d,this.textAnchorOffsets=new A}calculateGlyphDependencies(e,n,c,f,v){for(let x=0;x<e.length;x++)if(n[e.charCodeAt(x)]=!0,(c||f)&&v){const b=jc[e.charAt(x)];b&&(n[b.charCodeAt(0)]=!0)}}populate(e,n,c){const f=this.layers[0],v=f.layout,x=v.get("text-font"),b=v.get("text-field"),S=v.get("icon-image"),E=(b.value.kind!=="constant"||b.value.value instanceof er&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),D=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,k=v.get("symbol-sort-key");if(this.features=[],!E&&!D)return;const B=n.iconDependencies,$=n.glyphDependencies,U=n.availableImages,G=new ki(this.zoom);for(const{feature:X,id:st,index:gt,sourceLayerIndex:nt}of e){const ft=f._featureFilter.needGeometry,At=qn(X,ft);if(!f._featureFilter.filter(G,At,c))continue;let Ct,se;if(ft||(At.geometry=Un(X)),E){const ie=f.getValueAndResolveTokens("text-field",At,c,U),Jt=er.factory(ie),Ht=this.hasRTLText=this.hasRTLText||ib(Jt);(!Ht||gn.getRTLTextPluginStatus()==="unavailable"||Ht&&gn.isParsed())&&(Ct=F1(Jt,f,At))}if(D){const ie=f.getValueAndResolveTokens("icon-image",At,c,U);se=ie instanceof gr?ie:gr.fromString(ie)}if(!Ct&&!se)continue;const me=this.sortFeaturesByKey?k.evaluate(At,{},c):void 0;if(this.features.push({id:st,text:Ct,icon:se,index:gt,sourceLayerIndex:nt,geometry:At.geometry,properties:X.properties,type:tb[X.type],sortKey:me}),se&&(B[se.name]=!0),Ct){const ie=x.evaluate(At,{},c).join(","),Jt=v.get("text-rotation-alignment")!=="viewport"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(m.ah.vertical)>=0;for(const Ht of Ct.sections)if(Ht.image)B[Ht.image.name]=!0;else{const he=pa(Ct.toString()),Yt=Ht.fontStack||ie,$t=$[Yt]=$[Yt]||{};this.calculateGlyphDependencies(Ht.text,$t,Jt,this.allowVerticalPlacement,he)}}}v.get("symbol-placement")==="line"&&(this.features=function(X){const st={},gt={},nt=[];let ft=0;function At(ie){nt.push(X[ie]),ft++}function Ct(ie,Jt,Ht){const he=gt[ie];return delete gt[ie],gt[Jt]=he,nt[he].geometry[0].pop(),nt[he].geometry[0]=nt[he].geometry[0].concat(Ht[0]),he}function se(ie,Jt,Ht){const he=st[Jt];return delete st[Jt],st[ie]=he,nt[he].geometry[0].shift(),nt[he].geometry[0]=Ht[0].concat(nt[he].geometry[0]),he}function me(ie,Jt,Ht){const he=Ht?Jt[0][Jt[0].length-1]:Jt[0][0];return`${ie}:${he.x}:${he.y}`}for(let ie=0;ie<X.length;ie++){const Jt=X[ie],Ht=Jt.geometry,he=Jt.text?Jt.text.toString():null;if(!he){At(ie);continue}const Yt=me(he,Ht),$t=me(he,Ht,!0);if(Yt in gt&&$t in st&&gt[Yt]!==st[$t]){const Me=se(Yt,$t,Ht),ge=Ct(Yt,$t,nt[Me].geometry);delete st[Yt],delete gt[$t],gt[me(he,nt[ge].geometry,!0)]=ge,nt[Me].geometry=null}else Yt in gt?Ct(Yt,$t,Ht):$t in st?se(Yt,$t,Ht):(At(ie),st[Yt]=ft-1,gt[$t]=ft-1)}return nt.filter(ie=>ie.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((X,st)=>X.sortKey-st.sortKey)}update(e,n,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,c),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,c))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const c=this.lineVertexArray.length;if(e.segment!==void 0){let f=e.dist(n[e.segment+1]),v=e.dist(n[e.segment]);const x={};for(let b=e.segment+1;b<n.length;b++)x[b]={x:n[b].x,y:n[b].y,tileUnitDistanceFromAnchor:f},b<n.length-1&&(f+=n[b+1].dist(n[b]));for(let b=e.segment||0;b>=0;b--)x[b]={x:n[b].x,y:n[b].y,tileUnitDistanceFromAnchor:v},b>0&&(v+=n[b-1].dist(n[b]));for(let b=0;b<n.length;b++){const S=x[b];this.lineVertexArray.emplaceBack(S.x,S.y,S.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(e,n,c,f,v,x,b,S,E,D,k,B){const $=e.indexArray,U=e.layoutVertexArray,G=e.segments.prepareSegment(4*n.length,U,$,this.canOverlap?x.sortKey:void 0),X=this.glyphOffsetArray.length,st=G.vertexLength,gt=this.allowVerticalPlacement&&b===m.ah.vertical?Math.PI/2:0,nt=x.text&&x.text.sections;for(let ft=0;ft<n.length;ft++){const{tl:At,tr:Ct,bl:se,br:me,tex:ie,pixelOffsetTL:Jt,pixelOffsetBR:Ht,minFontScaleX:he,minFontScaleY:Yt,glyphOffset:$t,isSDF:Me,sectionIndex:ge}=n[ft],Ze=G.vertexLength,Ei=$t[1];ju(U,S.x,S.y,At.x,Ei+At.y,ie.x,ie.y,c,Me,Jt.x,Jt.y,he,Yt),ju(U,S.x,S.y,Ct.x,Ei+Ct.y,ie.x+ie.w,ie.y,c,Me,Ht.x,Jt.y,he,Yt),ju(U,S.x,S.y,se.x,Ei+se.y,ie.x,ie.y+ie.h,c,Me,Jt.x,Ht.y,he,Yt),ju(U,S.x,S.y,me.x,Ei+me.y,ie.x+ie.w,ie.y+ie.h,c,Me,Ht.x,Ht.y,he,Yt),ep(e.dynamicLayoutVertexArray,S,gt),$.emplaceBack(Ze,Ze+1,Ze+2),$.emplaceBack(Ze+1,Ze+2,Ze+3),G.vertexLength+=4,G.primitiveLength+=2,this.glyphOffsetArray.emplaceBack($t[0]),ft!==n.length-1&&ge===n[ft+1].sectionIndex||e.programConfigurations.populatePaintArrays(U.length,x,x.index,{},B,nt&&nt[ge])}e.placedSymbolArray.emplaceBack(S.x,S.y,X,this.glyphOffsetArray.length-X,st,E,D,S.segment,c?c[0]:0,c?c[1]:0,f[0],f[1],b,0,!1,0,k)}_addCollisionDebugVertex(e,n,c,f,v,x){return n.emplaceBack(0,0),e.emplaceBack(c.x,c.y,f,v,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(e,n,c,f,v,x,b){const S=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),E=S.vertexLength,D=v.layoutVertexArray,k=v.collisionVertexArray,B=b.anchorX,$=b.anchorY;this._addCollisionDebugVertex(D,k,x,B,$,new P(e,n)),this._addCollisionDebugVertex(D,k,x,B,$,new P(c,n)),this._addCollisionDebugVertex(D,k,x,B,$,new P(c,f)),this._addCollisionDebugVertex(D,k,x,B,$,new P(e,f)),S.vertexLength+=4;const U=v.indexArray;U.emplaceBack(E,E+1),U.emplaceBack(E+1,E+2),U.emplaceBack(E+2,E+3),U.emplaceBack(E+3,E),S.primitiveLength+=4}addDebugCollisionBoxes(e,n,c,f){for(let v=e;v<n;v++){const x=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,f?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,c)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new sp(bt,Tg.members,Bt),this.iconCollisionBox=new sp(bt,Tg.members,Bt);for(let e=0;e<this.symbolInstances.length;e++){const n=this.symbolInstances.get(e);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(e,n,c,f,v,x,b,S,E){const D={};for(let k=n;k<c;k++){const B=e.get(k);D.textBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},D.textFeatureIndex=B.featureIndex;break}for(let k=f;k<v;k++){const B=e.get(k);D.verticalTextBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},D.verticalTextFeatureIndex=B.featureIndex;break}for(let k=x;k<b;k++){const B=e.get(k);D.iconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},D.iconFeatureIndex=B.featureIndex;break}for(let k=S;k<E;k++){const B=e.get(k);D.verticalIconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},D.verticalIconFeatureIndex=B.featureIndex;break}return D}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const c=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const c=e.placedSymbolArray.get(n),f=c.vertexStartIndex+4*c.numGlyphs;for(let v=c.vertexStartIndex;v<f;v+=4)e.indexArray.emplaceBack(v,v+1,v+2),e.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),c=Math.cos(e),f=[],v=[],x=[];for(let b=0;b<this.symbolInstances.length;++b){x.push(b);const S=this.symbolInstances.get(b);f.push(0|Math.round(n*S.anchorX+c*S.anchorY)),v.push(S.featureIndex)}return x.sort((b,S)=>f[b]-f[S]||v[S]-v[b]),x}addToSortKeyRanges(e,n){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===n?c.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const c=this.symbolInstances.get(n);this.featureSortOrder.push(c.featureIndex),[c.rightJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.leftJustifiedTextSymbolIndex].forEach((f,v,x)=>{f>=0&&x.indexOf(f)===v&&this.addIndicesForPlacedSymbol(this.text,f)}),c.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,c.verticalPlacedTextSymbolIndex),c.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.placedIconSymbolIndex),c.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Ug,qg;le("SymbolBucket",wl,{omit:["layers","collisionBoxArray","features","compareText"]}),wl.MAX_GLYPHS=65535,wl.addDynamicAttributes=ep;var rp={get paint(){return qg=qg||new Hs({"icon-opacity":new Ae(it.paint_symbol["icon-opacity"]),"icon-color":new Ae(it.paint_symbol["icon-color"]),"icon-halo-color":new Ae(it.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ae(it.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ae(it.paint_symbol["icon-halo-blur"]),"icon-translate":new ve(it.paint_symbol["icon-translate"]),"icon-translate-anchor":new ve(it.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ae(it.paint_symbol["text-opacity"]),"text-color":new Ae(it.paint_symbol["text-color"],{runtimeType:ui,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new Ae(it.paint_symbol["text-halo-color"]),"text-halo-width":new Ae(it.paint_symbol["text-halo-width"]),"text-halo-blur":new Ae(it.paint_symbol["text-halo-blur"]),"text-translate":new ve(it.paint_symbol["text-translate"]),"text-translate-anchor":new ve(it.paint_symbol["text-translate-anchor"])})},get layout(){return Ug=Ug||new Hs({"symbol-placement":new ve(it.layout_symbol["symbol-placement"]),"symbol-spacing":new ve(it.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ve(it.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ae(it.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ve(it.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ve(it.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ve(it.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ve(it.layout_symbol["icon-ignore-placement"]),"icon-optional":new ve(it.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ve(it.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ae(it.layout_symbol["icon-size"]),"icon-text-fit":new ve(it.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ve(it.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ae(it.layout_symbol["icon-image"]),"icon-rotate":new Ae(it.layout_symbol["icon-rotate"]),"icon-padding":new Ae(it.layout_symbol["icon-padding"]),"icon-keep-upright":new ve(it.layout_symbol["icon-keep-upright"]),"icon-offset":new Ae(it.layout_symbol["icon-offset"]),"icon-anchor":new Ae(it.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ve(it.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ve(it.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ve(it.layout_symbol["text-rotation-alignment"]),"text-field":new Ae(it.layout_symbol["text-field"]),"text-font":new Ae(it.layout_symbol["text-font"]),"text-size":new Ae(it.layout_symbol["text-size"]),"text-max-width":new Ae(it.layout_symbol["text-max-width"]),"text-line-height":new ve(it.layout_symbol["text-line-height"]),"text-letter-spacing":new Ae(it.layout_symbol["text-letter-spacing"]),"text-justify":new Ae(it.layout_symbol["text-justify"]),"text-radial-offset":new Ae(it.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ve(it.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ae(it.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ae(it.layout_symbol["text-anchor"]),"text-max-angle":new ve(it.layout_symbol["text-max-angle"]),"text-writing-mode":new ve(it.layout_symbol["text-writing-mode"]),"text-rotate":new Ae(it.layout_symbol["text-rotate"]),"text-padding":new ve(it.layout_symbol["text-padding"]),"text-keep-upright":new ve(it.layout_symbol["text-keep-upright"]),"text-transform":new Ae(it.layout_symbol["text-transform"]),"text-offset":new Ae(it.layout_symbol["text-offset"]),"text-allow-overlap":new ve(it.layout_symbol["text-allow-overlap"]),"text-overlap":new ve(it.layout_symbol["text-overlap"]),"text-ignore-placement":new ve(it.layout_symbol["text-ignore-placement"]),"text-optional":new ve(it.layout_symbol["text-optional"])})}};class jg{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:as,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}le("FormatSectionOverride",jg,{omit:["defaultValue"]});class Gu extends Pr{constructor(e){super(e,rp)}recalculate(e,n){if(super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const c=this.layout.get("text-writing-mode");if(c){const f=[];for(const v of c)f.indexOf(v)<0&&f.push(v);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,n,c,f){const v=this.layout.get(e).evaluate(n,{},c,f),x=this._unevaluatedLayout._values[e];return x.isDataDriven()||vi(x.value)||!v?v:function(b,S){return S.replace(/{([^{}]+)}/g,(E,D)=>b&&D in b?String(b[D]):"")}(n.properties,v)}createBucket(e){return new wl(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of rp.paint.overridableProperties){if(!Gu.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),c=new jg(n),f=new Ai(c,n.property.specification);let v=null;v=n.value.kind==="constant"||n.value.kind==="source"?new Go("source",f):new hc("composite",f,n.value.zoomStops),this.paint._values[e]=new Ir(n.property,v,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,c){return!(!this.layout||n.isDataDriven()||c.isDataDriven())&&Gu.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const c=e.get("text-field"),f=rp.paint.properties[n];let v=!1;const x=b=>{for(const S of b)if(f.overrides&&f.overrides.hasOverride(S))return void(v=!0)};if(c.value.kind==="constant"&&c.value.value instanceof er)x(c.value.value.sections);else if(c.value.kind==="source"){const b=E=>{v||(E instanceof un&&ts(E.value)===os?x(E.value.sections):E instanceof qo?x(E.sections):E.eachChild(b))},S=c.value;S._styleExpression&&b(S._styleExpression.expression)}return v}}let Gg;var sb={get paint(){return Gg=Gg||new Hs({"background-color":new ve(it.paint_background["background-color"]),"background-pattern":new io(it.paint_background["background-pattern"]),"background-opacity":new ve(it.paint_background["background-opacity"])})}};class rb extends Pr{constructor(e){super(e,sb)}}let Hg;var nb={get paint(){return Hg=Hg||new Hs({"raster-opacity":new ve(it.paint_raster["raster-opacity"]),"raster-hue-rotate":new ve(it.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ve(it.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ve(it.paint_raster["raster-brightness-max"]),"raster-saturation":new ve(it.paint_raster["raster-saturation"]),"raster-contrast":new ve(it.paint_raster["raster-contrast"]),"raster-resampling":new ve(it.paint_raster["raster-resampling"]),"raster-fade-duration":new ve(it.paint_raster["raster-fade-duration"])})}};class ab extends Pr{constructor(e){super(e,nb)}}class ob extends Pr{constructor(e){super(e,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class lb{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const np=63710088e-1;class va{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new va(Ut(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,c=this.lat*n,f=e.lat*n,v=Math.sin(c)*Math.sin(f)+Math.cos(c)*Math.cos(f)*Math.cos((e.lng-this.lng)*n);return np*Math.acos(Math.min(v,1))}static convert(e){if(e instanceof va)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new va(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new va(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Wg=2*Math.PI*np;function Zg(s){return Wg*Math.cos(s*Math.PI/180)}function Xg(s){return(180+s)/360}function Kg(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function Yg(s,e){return s/Zg(e)}function ap(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}class Hu{constructor(e,n,c=0){this.x=+e,this.y=+n,this.z=+c}static fromLngLat(e,n=0){const c=va.convert(e);return new Hu(Xg(c.lng),Kg(c.lat),Yg(n,c.lat))}toLngLat(){return new va(360*this.x-180,ap(this.y))}toAltitude(){return this.z*Zg(ap(this.y))}meterInMercatorCoordinateUnits(){return 1/Wg*(e=ap(this.y),1/Math.cos(e*Math.PI/180));var e}}function Jg(s,e,n){var c=2*Math.PI*6378137/256/Math.pow(2,n);return[s*c-2*Math.PI*6378137/2,e*c-2*Math.PI*6378137/2]}class op{constructor(e,n,c){if(e<0||e>25||c<0||c>=Math.pow(2,e)||n<0||n>=Math.pow(2,e))throw new Error(`x=${n}, y=${c}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=n,this.y=c,this.key=Zc(0,e,e,n,c)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n,c){const f=(x=this.y,b=this.z,S=Jg(256*(v=this.x),256*(x=Math.pow(2,b)-x-1),b),E=Jg(256*(v+1),256*(x+1),b),S[0]+","+S[1]+","+E[0]+","+E[1]);var v,x,b,S,E;const D=function(k,B,$){let U,G="";for(let X=k;X>0;X--)U=1<<X-1,G+=(B&U?1:0)+($&U?2:0);return G}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(c==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,D).replace(/{bbox-epsg-3857}/g,f)}isChildOf(e){const n=this.z-e.z;return n>0&&e.x===this.x>>n&&e.y===this.y>>n}getTilePoint(e){const n=Math.pow(2,this.z);return new P((e.x*n-this.x)*Wi,(e.y*n-this.y)*Wi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Qg{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Zc(e,n.z,n.z,n.x,n.y)}}class Dr{constructor(e,n,c,f,v){if(e<c)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${c}`);this.overscaledZ=e,this.wrap=n,this.canonical=new op(c,+f,+v),this.key=Zc(n,e,c,f,v)}clone(){return new Dr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-e;return e>this.canonical.z?new Dr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Dr(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-e;return e>this.canonical.z?Zc(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y):Zc(this.wrap*+n,e,e,this.canonical.x>>c,this.canonical.y>>c)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new Dr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,c=2*this.canonical.x,f=2*this.canonical.y;return[new Dr(n,this.wrap,n,c,f),new Dr(n,this.wrap,n,c+1,f),new Dr(n,this.wrap,n,c,f+1),new Dr(n,this.wrap,n,c+1,f+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Dr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Dr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Qg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Hu(e.x-this.wrap,e.y))}}function Zc(s,e,n,c,f){(s*=2)<0&&(s=-1*s-1);const v=1<<n;return(v*v*s+v*f+c).toString(36)+n.toString(36)+e.toString(36)}le("CanonicalTileID",op),le("OverscaledTileID",Dr,{omit:["posMatrix"]});class t_{constructor(e,n,c,f=1,v=1,x=1,b=0){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(c&&!["mapbox","terrarium","custom"].includes(c))return void pe(`"${c}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const S=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),c){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=f,this.greenFactor=v,this.blueFactor=x,this.baseShift=b;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let E=0;E<S;E++)this.data[this._idx(-1,E)]=this.data[this._idx(0,E)],this.data[this._idx(S,E)]=this.data[this._idx(S-1,E)],this.data[this._idx(E,-1)]=this.data[this._idx(E,0)],this.data[this._idx(E,S)]=this.data[this._idx(E,S-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(S,-1)]=this.data[this._idx(S-1,0)],this.data[this._idx(-1,S)]=this.data[this._idx(0,S-1)],this.data[this._idx(S,S)]=this.data[this._idx(S-1,S-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let E=0;E<S;E++)for(let D=0;D<S;D++){const k=this.get(E,D);k>this.max&&(this.max=k),k<this.min&&(this.min=k)}}get(e,n){const c=new Uint8Array(this.data.buffer),f=4*this._idx(e,n);return this.unpack(c[f],c[f+1],c[f+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}unpack(e,n,c){return e*this.redFactor+n*this.greenFactor+c*this.blueFactor-this.baseShift}getPixels(){return new Cr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,n,c){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let f=n*this.dim,v=n*this.dim+this.dim,x=c*this.dim,b=c*this.dim+this.dim;switch(n){case-1:f=v-1;break;case 1:v=f+1}switch(c){case-1:x=b-1;break;case 1:b=x+1}const S=-n*this.dim,E=-c*this.dim;for(let D=x;D<b;D++)for(let k=f;k<v;k++)this.data[this._idx(k,D)]=e.data[this._idx(k+S,D+E)]}}le("DEMData",t_);class e_{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const c=e[n];this._stringToNumber[c]=n,this._numberToString[n]=c}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class i_{constructor(e,n,c,f,v){this.type="Feature",this._vectorTileFeature=e,e._z=n,e._x=c,e._y=f,this.properties=e.properties,this.id=v}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(e[n]=this[n]);return e}}class s_{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Qa(Wi,16,0),this.grid3D=new Qa(Wi,16,0),this.featureIndexArray=new z,this.promoteId=n}insert(e,n,c,f,v,x){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,f,v);const S=x?this.grid3D:this.grid;for(let E=0;E<n.length;E++){const D=n[E],k=[1/0,1/0,-1/0,-1/0];for(let B=0;B<D.length;B++){const $=D[B];k[0]=Math.min(k[0],$.x),k[1]=Math.min(k[1],$.y),k[2]=Math.max(k[2],$.x),k[3]=Math.max(k[3],$.y)}k[0]<Wi&&k[1]<Wi&&k[2]>=0&&k[3]>=0&&S.insert(b,k[0],k[1],k[2],k[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ga.VectorTile(new Xf(this.rawTileData)).layers,this.sourceLayerCoder=new e_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,n,c,f){this.loadVTLayers();const v=e.params||{},x=Wi/e.tileSize/e.scale,b=Xo(v.filter),S=e.queryGeometry,E=e.queryPadding*x,D=n_(S),k=this.grid.query(D.minX-E,D.minY-E,D.maxX+E,D.maxY+E),B=n_(e.cameraQueryGeometry),$=this.grid3D.query(B.minX-E,B.minY-E,B.maxX+E,B.maxY+E,(X,st,gt,nt)=>function(ft,At,Ct,se,me){for(const Jt of ft)if(At<=Jt.x&&Ct<=Jt.y&&se>=Jt.x&&me>=Jt.y)return!0;const ie=[new P(At,Ct),new P(At,me),new P(se,me),new P(se,Ct)];if(ft.length>2){for(const Jt of ie)if(ml(ft,Jt))return!0}for(let Jt=0;Jt<ft.length-1;Jt++)if($x(ft[Jt],ft[Jt+1],ie))return!0;return!1}(e.cameraQueryGeometry,X-E,st-E,gt+E,nt+E));for(const X of $)k.push(X);k.sort(cb);const U={};let G;for(let X=0;X<k.length;X++){const st=k[X];if(st===G)continue;G=st;const gt=this.featureIndexArray.get(st);let nt=null;this.loadMatchingFeature(U,gt.bucketIndex,gt.sourceLayerIndex,gt.featureIndex,b,v.layers,v.availableImages,n,c,f,(ft,At,Ct)=>(nt||(nt=Un(ft)),At.queryIntersectsFeature(S,ft,Ct,nt,this.z,e.transform,x,e.pixelPosMatrix)))}return U}loadMatchingFeature(e,n,c,f,v,x,b,S,E,D,k){const B=this.bucketLayerIDs[n];if(x&&!function(X,st){for(let gt=0;gt<X.length;gt++)if(st.indexOf(X[gt])>=0)return!0;return!1}(x,B))return;const $=this.sourceLayerCoder.decode(c),U=this.vtLayers[$].feature(f);if(v.needGeometry){const X=qn(U,!0);if(!v.filter(new ki(this.tileID.overscaledZ),X,this.tileID.canonical))return}else if(!v.filter(new ki(this.tileID.overscaledZ),U))return;const G=this.getId(U,$);for(let X=0;X<B.length;X++){const st=B[X];if(x&&x.indexOf(st)<0)continue;const gt=S[st];if(!gt)continue;let nt={};G&&D&&(nt=D.getState(gt.sourceLayer||"_geojsonTileLayer",G));const ft=ce({},E[st]);ft.paint=r_(ft.paint,gt.paint,U,nt,b),ft.layout=r_(ft.layout,gt.layout,U,nt,b);const At=!k||k(U,gt,nt);if(!At)continue;const Ct=new i_(U,this.z,this.x,this.y,G);Ct.layer=ft;let se=e[st];se===void 0&&(se=e[st]=[]),se.push({featureIndex:f,feature:Ct,intersectionZ:At})}}lookupSymbolFeatures(e,n,c,f,v,x,b,S){const E={};this.loadVTLayers();const D=Xo(v);for(const k of e)this.loadMatchingFeature(E,c,f,k,D,x,b,S,n);return E}hasLayer(e){for(const n of this.bucketLayerIDs)for(const c of n)if(e===c)return!0;return!1}getId(e,n){let c=e.id;return this.promoteId&&(c=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof c=="boolean"&&(c=Number(c))),c}}function r_(s,e,n,c,f){return fe(s,(v,x)=>{const b=e instanceof eo?e.get(x):null;return b&&b.evaluate?b.evaluate(n,c,f):b})}function n_(s){let e=1/0,n=1/0,c=-1/0,f=-1/0;for(const v of s)e=Math.min(e,v.x),n=Math.min(n,v.y),c=Math.max(c,v.x),f=Math.max(f,v.y);return{minX:e,minY:n,maxX:c,maxY:f}}function cb(s,e){return e-s}function a_(s,e,n,c,f){const v=[];for(let x=0;x<s.length;x++){const b=s[x];let S;for(let E=0;E<b.length-1;E++){let D=b[E],k=b[E+1];D.x<e&&k.x<e||(D.x<e?D=new P(e,D.y+(e-D.x)/(k.x-D.x)*(k.y-D.y))._round():k.x<e&&(k=new P(e,D.y+(e-D.x)/(k.x-D.x)*(k.y-D.y))._round()),D.y<n&&k.y<n||(D.y<n?D=new P(D.x+(n-D.y)/(k.y-D.y)*(k.x-D.x),n)._round():k.y<n&&(k=new P(D.x+(n-D.y)/(k.y-D.y)*(k.x-D.x),n)._round()),D.x>=c&&k.x>=c||(D.x>=c?D=new P(c,D.y+(c-D.x)/(k.x-D.x)*(k.y-D.y))._round():k.x>=c&&(k=new P(c,D.y+(c-D.x)/(k.x-D.x)*(k.y-D.y))._round()),D.y>=f&&k.y>=f||(D.y>=f?D=new P(D.x+(f-D.y)/(k.y-D.y)*(k.x-D.x),f)._round():k.y>=f&&(k=new P(D.x+(f-D.y)/(k.y-D.y)*(k.x-D.x),f)._round()),S&&D.equals(S[S.length-1])||(S=[D],v.push(S)),S.push(k)))))}}return v}le("FeatureIndex",s_,{omit:["rawTileData","sourceLayerCoder"]});class xa extends P{constructor(e,n,c,f){super(e,n),this.angle=c,f!==void 0&&(this.segment=f)}clone(){return new xa(this.x,this.y,this.angle,this.segment)}}function o_(s,e,n,c,f){if(e.segment===void 0||n===0)return!0;let v=e,x=e.segment+1,b=0;for(;b>-n/2;){if(x--,x<0)return!1;b-=s[x].dist(v),v=s[x]}b+=s[x].dist(s[x+1]),x++;const S=[];let E=0;for(;b<n/2;){const D=s[x],k=s[x+1];if(!k)return!1;let B=s[x-1].angleTo(D)-D.angleTo(k);for(B=Math.abs((B+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:b,angleDelta:B}),E+=B;b-S[0].distance>c;)E-=S.shift().angleDelta;if(E>f)return!1;x++,b+=D.dist(k)}return!0}function l_(s){let e=0;for(let n=0;n<s.length-1;n++)e+=s[n].dist(s[n+1]);return e}function c_(s,e,n){return s?.6*e*n:0}function h_(s,e){return Math.max(s?s.right-s.left:0,e?e.right-e.left:0)}function hb(s,e,n,c,f,v){const x=c_(n,f,v),b=h_(n,c)*v;let S=0;const E=l_(s)/2;for(let D=0;D<s.length-1;D++){const k=s[D],B=s[D+1],$=k.dist(B);if(S+$>E){const U=(E-S)/$,G=zs.number(k.x,B.x,U),X=zs.number(k.y,B.y,U),st=new xa(G,X,B.angleTo(k),D);return st._round(),!x||o_(s,st,b,x,e)?st:void 0}S+=$}}function ub(s,e,n,c,f,v,x,b,S){const E=c_(c,v,x),D=h_(c,f),k=D*x,B=s[0].x===0||s[0].x===S||s[0].y===0||s[0].y===S;return e-k<e/4&&(e=k+e/4),u_(s,B?e/2*b%e:(D/2+2*v)*x*b%e,e,E,n,k,B,!1,S)}function u_(s,e,n,c,f,v,x,b,S){const E=v/2,D=l_(s);let k=0,B=e-n,$=[];for(let U=0;U<s.length-1;U++){const G=s[U],X=s[U+1],st=G.dist(X),gt=X.angleTo(G);for(;B+n<k+st;){B+=n;const nt=(B-k)/st,ft=zs.number(G.x,X.x,nt),At=zs.number(G.y,X.y,nt);if(ft>=0&&ft<S&&At>=0&&At<S&&B-E>=0&&B+E<=D){const Ct=new xa(ft,At,gt,U);Ct._round(),c&&!o_(s,Ct,v,c,f)||$.push(Ct)}}k+=st}return b||$.length||x||($=u_(s,k/2,n,c,f,v,x,!0,S)),$}le("Anchor",xa);const Ml=ar;function d_(s,e,n,c){const f=[],v=s.image,x=v.pixelRatio,b=v.paddedRect.w-2*Ml,S=v.paddedRect.h-2*Ml,E=s.right-s.left,D=s.bottom-s.top,k=v.stretchX||[[0,b]],B=v.stretchY||[[0,S]],$=(Ht,he)=>Ht+he[1]-he[0],U=k.reduce($,0),G=B.reduce($,0),X=b-U,st=S-G;let gt=0,nt=U,ft=0,At=G,Ct=0,se=X,me=0,ie=st;if(v.content&&c){const Ht=v.content;gt=Wu(k,0,Ht[0]),ft=Wu(B,0,Ht[1]),nt=Wu(k,Ht[0],Ht[2]),At=Wu(B,Ht[1],Ht[3]),Ct=Ht[0]-gt,me=Ht[1]-ft,se=Ht[2]-Ht[0]-nt,ie=Ht[3]-Ht[1]-At}const Jt=(Ht,he,Yt,$t)=>{const Me=Zu(Ht.stretch-gt,nt,E,s.left),ge=Xu(Ht.fixed-Ct,se,Ht.stretch,U),Ze=Zu(he.stretch-ft,At,D,s.top),Ei=Xu(he.fixed-me,ie,he.stretch,G),zi=Zu(Yt.stretch-gt,nt,E,s.left),ds=Xu(Yt.fixed-Ct,se,Yt.stretch,U),vr=Zu($t.stretch-ft,At,D,s.top),Zs=Xu($t.fixed-me,ie,$t.stretch,G),rs=new P(Me,Ze),ws=new P(zi,Ze),Ps=new P(zi,vr),Xs=new P(Me,vr),Ks=new P(ge/x,Ei/x),fs=new P(ds/x,Zs/x),ps=e*Math.PI/180;if(ps){const Fs=Math.sin(ps),or=Math.cos(ps),lr=[or,-Fs,Fs,or];rs._matMult(lr),ws._matMult(lr),Xs._matMult(lr),Ps._matMult(lr)}const Os=Ht.stretch+Ht.fixed,Ys=he.stretch+he.fixed;return{tl:rs,tr:ws,bl:Xs,br:Ps,tex:{x:v.paddedRect.x+Ml+Os,y:v.paddedRect.y+Ml+Ys,w:Yt.stretch+Yt.fixed-Os,h:$t.stretch+$t.fixed-Ys},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ks,pixelOffsetBR:fs,minFontScaleX:se/x/E,minFontScaleY:ie/x/D,isSDF:n}};if(c&&(v.stretchX||v.stretchY)){const Ht=f_(k,X,U),he=f_(B,st,G);for(let Yt=0;Yt<Ht.length-1;Yt++){const $t=Ht[Yt],Me=Ht[Yt+1];for(let ge=0;ge<he.length-1;ge++)f.push(Jt($t,he[ge],Me,he[ge+1]))}}else f.push(Jt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:S+1}));return f}function Wu(s,e,n){let c=0;for(const f of s)c+=Math.max(e,Math.min(n,f[1]))-Math.max(e,Math.min(n,f[0]));return c}function f_(s,e,n){const c=[{fixed:-Ml,stretch:0}];for(const[f,v]of s){const x=c[c.length-1];c.push({fixed:f-x.stretch,stretch:x.stretch}),c.push({fixed:f-x.stretch,stretch:x.stretch+(v-f)})}return c.push({fixed:e+Ml,stretch:n}),c}function Zu(s,e,n,c){return s/e*n+c}function Xu(s,e,n,c){return s-e*n/c}class Ku{constructor(e,n,c,f,v,x,b,S,E,D){if(this.boxStartIndex=e.length,E){let k=x.top,B=x.bottom;const $=x.collisionPadding;$&&(k-=$[1],B+=$[3]);let U=B-k;U>0&&(U=Math.max(10,U),this.circleDiameter=U)}else{let k=x.top*b-S[0],B=x.bottom*b+S[2],$=x.left*b-S[3],U=x.right*b+S[1];const G=x.collisionPadding;if(G&&($-=G[0]*b,k-=G[1]*b,U+=G[2]*b,B+=G[3]*b),D){const X=new P($,k),st=new P(U,k),gt=new P($,B),nt=new P(U,B),ft=D*Math.PI/180;X._rotate(ft),st._rotate(ft),gt._rotate(ft),nt._rotate(ft),$=Math.min(X.x,st.x,gt.x,nt.x),U=Math.max(X.x,st.x,gt.x,nt.x),k=Math.min(X.y,st.y,gt.y,nt.y),B=Math.max(X.y,st.y,gt.y,nt.y)}e.emplaceBack(n.x,n.y,$,k,U,B,c,f,v)}this.boxEndIndex=e.length}}class db{constructor(e=[],n=fb){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:c}=this,f=n[e];for(;e>0;){const v=e-1>>1,x=n[v];if(c(f,x)>=0)break;n[e]=x,e=v}n[e]=f}_down(e){const{data:n,compare:c}=this,f=this.length>>1,v=n[e];for(;e<f;){let x=1+(e<<1),b=n[x];const S=x+1;if(S<this.length&&c(n[S],b)<0&&(x=S,b=n[S]),c(b,v)>=0)break;n[e]=b,e=x}n[e]=v}}function fb(s,e){return s<e?-1:s>e?1:0}function pb(s,e=1,n=!1){let c=1/0,f=1/0,v=-1/0,x=-1/0;const b=s[0];for(let $=0;$<b.length;$++){const U=b[$];(!$||U.x<c)&&(c=U.x),(!$||U.y<f)&&(f=U.y),(!$||U.x>v)&&(v=U.x),(!$||U.y>x)&&(x=U.y)}const S=Math.min(v-c,x-f);let E=S/2;const D=new db([],mb);if(S===0)return new P(c,f);for(let $=c;$<v;$+=S)for(let U=f;U<x;U+=S)D.push(new Sl($+E,U+E,E,s));let k=function($){let U=0,G=0,X=0;const st=$[0];for(let gt=0,nt=st.length,ft=nt-1;gt<nt;ft=gt++){const At=st[gt],Ct=st[ft],se=At.x*Ct.y-Ct.x*At.y;G+=(At.x+Ct.x)*se,X+=(At.y+Ct.y)*se,U+=3*se}return new Sl(G/U,X/U,0,$)}(s),B=D.length;for(;D.length;){const $=D.pop();($.d>k.d||!k.d)&&(k=$,n&&console.log("found best %d after %d probes",Math.round(1e4*$.d)/1e4,B)),$.max-k.d<=e||(E=$.h/2,D.push(new Sl($.p.x-E,$.p.y-E,E,s)),D.push(new Sl($.p.x+E,$.p.y-E,E,s)),D.push(new Sl($.p.x-E,$.p.y+E,E,s)),D.push(new Sl($.p.x+E,$.p.y+E,E,s)),B+=4)}return n&&(console.log(`num probes: ${B}`),console.log(`best distance: ${k.d}`)),k.p}function mb(s,e){return e.max-s.max}function Sl(s,e,n,c){this.p=new P(s,e),this.h=n,this.d=function(f,v){let x=!1,b=1/0;for(let S=0;S<v.length;S++){const E=v[S];for(let D=0,k=E.length,B=k-1;D<k;B=D++){const $=E[D],U=E[B];$.y>f.y!=U.y>f.y&&f.x<(U.x-$.x)*(f.y-$.y)/(U.y-$.y)+$.x&&(x=!x),b=Math.min(b,Km(f,$,U))}}return(x?1:-1)*Math.sqrt(b)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}var Is;m.ap=void 0,(Is=m.ap||(m.ap={}))[Is.center=1]="center",Is[Is.left=2]="left",Is[Is.right=3]="right",Is[Is.top=4]="top",Is[Is.bottom=5]="bottom",Is[Is["top-left"]=6]="top-left",Is[Is["top-right"]=7]="top-right",Is[Is["bottom-left"]=8]="bottom-left",Is[Is["bottom-right"]=9]="bottom-right";const ba=7,lp=Number.POSITIVE_INFINITY;function p_(s,e){return e[1]!==lp?function(n,c,f){let v=0,x=0;switch(c=Math.abs(c),f=Math.abs(f),n){case"top-right":case"top-left":case"top":x=f-ba;break;case"bottom-right":case"bottom-left":case"bottom":x=-f+ba}switch(n){case"top-right":case"bottom-right":case"right":v=-c;break;case"top-left":case"bottom-left":case"left":v=c}return[v,x]}(s,e[0],e[1]):function(n,c){let f=0,v=0;c<0&&(c=0);const x=c/Math.SQRT2;switch(n){case"top-right":case"top-left":v=x-ba;break;case"bottom-right":case"bottom-left":v=-x+ba;break;case"bottom":v=-c+ba;break;case"top":v=c-ba}switch(n){case"top-right":case"bottom-right":f=-x;break;case"top-left":case"bottom-left":f=x;break;case"left":f=c;break;case"right":f=-c}return[f,v]}(s,e[0])}function m_(s,e,n){var c;const f=s.layout,v=(c=f.get("text-variable-anchor-offset"))===null||c===void 0?void 0:c.evaluate(e,{},n);if(v){const b=v.values,S=[];for(let E=0;E<b.length;E+=2){const D=S[E]=b[E],k=b[E+1].map(B=>B*us);D.startsWith("top")?k[1]-=ba:D.startsWith("bottom")&&(k[1]+=ba),S[E+1]=k}return new mr(S)}const x=f.get("text-variable-anchor");if(x){let b;b=s._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[f.get("text-radial-offset").evaluate(e,{},n)*us,lp]:f.get("text-offset").evaluate(e,{},n).map(E=>E*us);const S=[];for(const E of x)S.push(E,p_(E,b));return new mr(S)}return null}function cp(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function gb(s,e,n,c,f,v,x,b,S,E,D){let k=v.textMaxSize.evaluate(e,{});k===void 0&&(k=x);const B=s.layers[0].layout,$=B.get("icon-offset").evaluate(e,{},D),U=__(n.horizontal),G=x/24,X=s.tilePixelRatio*G,st=s.tilePixelRatio*k/24,gt=s.tilePixelRatio*b,nt=s.tilePixelRatio*B.get("symbol-spacing"),ft=B.get("text-padding")*s.tilePixelRatio,At=function($t,Me,ge,Ze=1){const Ei=$t.get("icon-padding").evaluate(Me,{},ge),zi=Ei&&Ei.values;return[zi[0]*Ze,zi[1]*Ze,zi[2]*Ze,zi[3]*Ze]}(B,e,D,s.tilePixelRatio),Ct=B.get("text-max-angle")/180*Math.PI,se=B.get("text-rotation-alignment")!=="viewport"&&B.get("symbol-placement")!=="point",me=B.get("icon-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",ie=B.get("symbol-placement"),Jt=nt/2,Ht=B.get("icon-text-fit");let he;c&&Ht!=="none"&&(s.allowVerticalPlacement&&n.vertical&&(he=$g(c,n.vertical,Ht,B.get("icon-text-fit-padding"),$,G)),U&&(c=$g(c,U,Ht,B.get("icon-text-fit-padding"),$,G)));const Yt=($t,Me)=>{Me.x<0||Me.x>=Wi||Me.y<0||Me.y>=Wi||function(ge,Ze,Ei,zi,ds,vr,Zs,rs,ws,Ps,Xs,Ks,fs,ps,Os,Ys,Fs,or,lr,ms,Je,Bs,Cs,gs,qr){const Qr=ge.addToLineVertexArray(Ze,Ei);let tn,Gn,jr,kr,cr=0,Hn=0,Yc=0,b_=0,_p=-1,yp=-1;const Wn={};let w_=qi("");if(ge.allowVerticalPlacement&&zi.vertical){const Ns=rs.layout.get("text-rotate").evaluate(Je,{},gs)+90;jr=new Ku(ws,Ze,Ps,Xs,Ks,zi.vertical,fs,ps,Os,Ns),Zs&&(kr=new Ku(ws,Ze,Ps,Xs,Ks,Zs,Fs,or,Os,Ns))}if(ds){const Ns=rs.layout.get("icon-rotate").evaluate(Je,{}),Rr=rs.layout.get("icon-text-fit")!=="none",ho=d_(ds,Ns,Cs,Rr),sn=Zs?d_(Zs,Ns,Cs,Rr):void 0;Gn=new Ku(ws,Ze,Ps,Xs,Ks,ds,Fs,or,!1,Ns),cr=4*ho.length;const uo=ge.iconSizeData;let bn=null;uo.kind==="source"?(bn=[xn*rs.layout.get("icon-size").evaluate(Je,{})],bn[0]>ya&&pe(`${ge.layerIds[0]}: Value for "icon-size" is >= ${Wc}. Reduce your "icon-size".`)):uo.kind==="composite"&&(bn=[xn*Bs.compositeIconSizes[0].evaluate(Je,{},gs),xn*Bs.compositeIconSizes[1].evaluate(Je,{},gs)],(bn[0]>ya||bn[1]>ya)&&pe(`${ge.layerIds[0]}: Value for "icon-size" is >= ${Wc}. Reduce your "icon-size".`)),ge.addSymbols(ge.icon,ho,bn,ms,lr,Je,m.ah.none,Ze,Qr.lineStartIndex,Qr.lineLength,-1,gs),_p=ge.icon.placedSymbolArray.length-1,sn&&(Hn=4*sn.length,ge.addSymbols(ge.icon,sn,bn,ms,lr,Je,m.ah.vertical,Ze,Qr.lineStartIndex,Qr.lineLength,-1,gs),yp=ge.icon.placedSymbolArray.length-1)}const M_=Object.keys(zi.horizontal);for(const Ns of M_){const Rr=zi.horizontal[Ns];if(!tn){w_=qi(Rr.text);const sn=rs.layout.get("text-rotate").evaluate(Je,{},gs);tn=new Ku(ws,Ze,Ps,Xs,Ks,Rr,fs,ps,Os,sn)}const ho=Rr.positionedLines.length===1;if(Yc+=g_(ge,Ze,Rr,vr,rs,Os,Je,Ys,Qr,zi.vertical?m.ah.horizontal:m.ah.horizontalOnly,ho?M_:[Ns],Wn,_p,Bs,gs),ho)break}zi.vertical&&(b_+=g_(ge,Ze,zi.vertical,vr,rs,Os,Je,Ys,Qr,m.ah.vertical,["vertical"],Wn,yp,Bs,gs));const vb=tn?tn.boxStartIndex:ge.collisionBoxArray.length,xb=tn?tn.boxEndIndex:ge.collisionBoxArray.length,bb=jr?jr.boxStartIndex:ge.collisionBoxArray.length,wb=jr?jr.boxEndIndex:ge.collisionBoxArray.length,Mb=Gn?Gn.boxStartIndex:ge.collisionBoxArray.length,Sb=Gn?Gn.boxEndIndex:ge.collisionBoxArray.length,Tb=kr?kr.boxStartIndex:ge.collisionBoxArray.length,Ab=kr?kr.boxEndIndex:ge.collisionBoxArray.length;let en=-1;const Ju=(Ns,Rr)=>Ns&&Ns.circleDiameter?Math.max(Ns.circleDiameter,Rr):Rr;en=Ju(tn,en),en=Ju(jr,en),en=Ju(Gn,en),en=Ju(kr,en);const S_=en>-1?1:0;S_&&(en*=qr/us),ge.glyphOffsetArray.length>=wl.MAX_GLYPHS&&pe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Je.sortKey!==void 0&&ge.addToSortKeyRanges(ge.symbolInstances.length,Je.sortKey);const Eb=m_(rs,Je,gs),[Ib,Pb]=function(Ns,Rr){const ho=Ns.length,sn=Rr==null?void 0:Rr.values;if((sn==null?void 0:sn.length)>0)for(let uo=0;uo<sn.length;uo+=2){const bn=sn[uo+1];Ns.emplaceBack(m.ap[sn[uo]],bn[0],bn[1])}return[ho,Ns.length]}(ge.textAnchorOffsets,Eb);ge.symbolInstances.emplaceBack(Ze.x,Ze.y,Wn.right>=0?Wn.right:-1,Wn.center>=0?Wn.center:-1,Wn.left>=0?Wn.left:-1,Wn.vertical||-1,_p,yp,w_,vb,xb,bb,wb,Mb,Sb,Tb,Ab,Ps,Yc,b_,cr,Hn,S_,0,fs,en,Ib,Pb)}(s,Me,$t,n,c,f,he,s.layers[0],s.collisionBoxArray,e.index,e.sourceLayerIndex,s.index,X,[ft,ft,ft,ft],se,S,gt,At,me,$,e,v,E,D,x)};if(ie==="line")for(const $t of a_(e.geometry,0,0,Wi,Wi)){const Me=ub($t,nt,Ct,n.vertical||U,c,24,st,s.overscaling,Wi);for(const ge of Me)U&&_b(s,U.text,Jt,ge)||Yt($t,ge)}else if(ie==="line-center"){for(const $t of e.geometry)if($t.length>1){const Me=hb($t,Ct,n.vertical||U,c,24,st);Me&&Yt($t,Me)}}else if(e.type==="Polygon")for(const $t of Vf(e.geometry,0)){const Me=pb($t,16);Yt($t[0],new xa(Me.x,Me.y,0))}else if(e.type==="LineString")for(const $t of e.geometry)Yt($t,new xa($t[0].x,$t[0].y,0));else if(e.type==="Point")for(const $t of e.geometry)for(const Me of $t)Yt([Me],new xa(Me.x,Me.y,0))}function g_(s,e,n,c,f,v,x,b,S,E,D,k,B,$,U){const G=function(gt,nt,ft,At,Ct,se,me,ie){const Jt=At.layout.get("text-rotate").evaluate(se,{})*Math.PI/180,Ht=[];for(const he of nt.positionedLines)for(const Yt of he.positionedGlyphs){if(!Yt.rect)continue;const $t=Yt.rect||{};let Me=Rg+1,ge=!0,Ze=1,Ei=0;const zi=(Ct||ie)&&Yt.vertical,ds=Yt.metrics.advance*Yt.scale/2;if(ie&&nt.verticalizable&&(Ei=he.lineOffset/2-(Yt.imageName?-(us-Yt.metrics.width*Yt.scale)/2:(Yt.scale-1)*us)),Yt.imageName){const ms=me[Yt.imageName];ge=ms.sdf,Ze=ms.pixelRatio,Me=ar/Ze}const vr=Ct?[Yt.x+ds,Yt.y]:[0,0];let Zs=Ct?[0,0]:[Yt.x+ds+ft[0],Yt.y+ft[1]-Ei],rs=[0,0];zi&&(rs=Zs,Zs=[0,0]);const ws=Yt.metrics.isDoubleResolution?2:1,Ps=(Yt.metrics.left-Me)*Yt.scale-ds+Zs[0],Xs=(-Yt.metrics.top-Me)*Yt.scale+Zs[1],Ks=Ps+$t.w/ws*Yt.scale/Ze,fs=Xs+$t.h/ws*Yt.scale/Ze,ps=new P(Ps,Xs),Os=new P(Ks,Xs),Ys=new P(Ps,fs),Fs=new P(Ks,fs);if(zi){const ms=new P(-ds,ds-Gc),Je=-Math.PI/2,Bs=us/2-ds,Cs=new P(5-Gc-Bs,-(Yt.imageName?Bs:0)),gs=new P(...rs);ps._rotateAround(Je,ms)._add(Cs)._add(gs),Os._rotateAround(Je,ms)._add(Cs)._add(gs),Ys._rotateAround(Je,ms)._add(Cs)._add(gs),Fs._rotateAround(Je,ms)._add(Cs)._add(gs)}if(Jt){const ms=Math.sin(Jt),Je=Math.cos(Jt),Bs=[Je,-ms,ms,Je];ps._matMult(Bs),Os._matMult(Bs),Ys._matMult(Bs),Fs._matMult(Bs)}const or=new P(0,0),lr=new P(0,0);Ht.push({tl:ps,tr:Os,bl:Ys,br:Fs,tex:$t,writingMode:nt.writingMode,glyphOffset:vr,sectionIndex:Yt.sectionIndex,isSDF:ge,pixelOffsetTL:or,pixelOffsetBR:lr,minFontScaleX:0,minFontScaleY:0})}return Ht}(0,n,b,f,v,x,c,s.allowVerticalPlacement),X=s.textSizeData;let st=null;X.kind==="source"?(st=[xn*f.layout.get("text-size").evaluate(x,{})],st[0]>ya&&pe(`${s.layerIds[0]}: Value for "text-size" is >= ${Wc}. Reduce your "text-size".`)):X.kind==="composite"&&(st=[xn*$.compositeTextSizes[0].evaluate(x,{},U),xn*$.compositeTextSizes[1].evaluate(x,{},U)],(st[0]>ya||st[1]>ya)&&pe(`${s.layerIds[0]}: Value for "text-size" is >= ${Wc}. Reduce your "text-size".`)),s.addSymbols(s.text,G,st,b,v,x,E,e,S.lineStartIndex,S.lineLength,B,U);for(const gt of D)k[gt]=s.text.placedSymbolArray.length-1;return 4*G.length}function __(s){for(const e in s)return s[e];return null}function _b(s,e,n,c){const f=s.compareText;if(e in f){const v=f[e];for(let x=v.length-1;x>=0;x--)if(c.dist(v[x])<n)return!0}else f[e]=[];return f[e].push(c),!1}const y_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class hp{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,c]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const f=c>>4;if(f!==1)throw new Error(`Got v${f} data when expected v1.`);const v=y_[15&c];if(!v)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(e,2,1),[b]=new Uint32Array(e,4,1);return new hp(b,x,v,e)}constructor(e,n=64,c=Float64Array,f){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=c,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const v=y_.indexOf(this.ArrayType),x=2*e*this.ArrayType.BYTES_PER_ELEMENT,b=e*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-b%8)%8;if(v<0)throw new Error(`Unexpected typed array class: ${c}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+S,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+x+b+S),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+S,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+v]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=e,this.coords[this._pos++]=n,c}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return up(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,c,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:x,nodeSize:b}=this,S=[0,v.length-1,0],E=[];for(;S.length;){const D=S.pop()||0,k=S.pop()||0,B=S.pop()||0;if(k-B<=b){for(let X=B;X<=k;X++){const st=x[2*X],gt=x[2*X+1];st>=e&&st<=c&&gt>=n&&gt<=f&&E.push(v[X])}continue}const $=B+k>>1,U=x[2*$],G=x[2*$+1];U>=e&&U<=c&&G>=n&&G<=f&&E.push(v[$]),(D===0?e<=U:n<=G)&&(S.push(B),S.push($-1),S.push(1-D)),(D===0?c>=U:f>=G)&&(S.push($+1),S.push(k),S.push(1-D))}return E}within(e,n,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:v,nodeSize:x}=this,b=[0,f.length-1,0],S=[],E=c*c;for(;b.length;){const D=b.pop()||0,k=b.pop()||0,B=b.pop()||0;if(k-B<=x){for(let X=B;X<=k;X++)x_(v[2*X],v[2*X+1],e,n)<=E&&S.push(f[X]);continue}const $=B+k>>1,U=v[2*$],G=v[2*$+1];x_(U,G,e,n)<=E&&S.push(f[$]),(D===0?e-c<=U:n-c<=G)&&(b.push(B),b.push($-1),b.push(1-D)),(D===0?e+c>=U:n+c>=G)&&(b.push($+1),b.push(k),b.push(1-D))}return S}}function up(s,e,n,c,f,v){if(f-c<=n)return;const x=c+f>>1;v_(s,e,x,c,f,v),up(s,e,n,c,x-1,1-v),up(s,e,n,x+1,f,1-v)}function v_(s,e,n,c,f,v){for(;f>c;){if(f-c>600){const E=f-c+1,D=n-c+1,k=Math.log(E),B=.5*Math.exp(2*k/3),$=.5*Math.sqrt(k*B*(E-B)/E)*(D-E/2<0?-1:1);v_(s,e,n,Math.max(c,Math.floor(n-D*B/E+$)),Math.min(f,Math.floor(n+(E-D)*B/E+$)),v)}const x=e[2*n+v];let b=c,S=f;for(Xc(s,e,c,n),e[2*f+v]>x&&Xc(s,e,c,f);b<S;){for(Xc(s,e,b,S),b++,S--;e[2*b+v]<x;)b++;for(;e[2*S+v]>x;)S--}e[2*c+v]===x?Xc(s,e,c,S):(S++,Xc(s,e,S,f)),S<=n&&(c=S+1),n<=S&&(f=S-1)}}function Xc(s,e,n,c){dp(s,n,c),dp(e,2*n,2*c),dp(e,2*n+1,2*c+1)}function dp(s,e,n){const c=s[e];s[e]=s[n],s[n]=c}function x_(s,e,n,c){const f=s-n,v=e-c;return f*f+v*v}var fp;m.bd=void 0,(fp=m.bd||(m.bd={})).create="create",fp.load="load",fp.fullLoad="fullLoad";let Yu=null,Kc=[];const pp=1e3/60,mp="loadTime",gp="fullLoadTime",yb={mark(s){performance.mark(s)},frame(s){const e=s;Yu!=null&&Kc.push(e-Yu),Yu=e},clearMetrics(){Yu=null,Kc=[],performance.clearMeasures(mp),performance.clearMeasures(gp);for(const s in m.bd)performance.clearMarks(m.bd[s])},getPerformanceMetrics(){performance.measure(mp,m.bd.create,m.bd.load),performance.measure(gp,m.bd.create,m.bd.fullLoad);const s=performance.getEntriesByName(mp)[0].duration,e=performance.getEntriesByName(gp)[0].duration,n=Kc.length,c=1/(Kc.reduce((v,x)=>v+x,0)/n/1e3),f=Kc.filter(v=>v>pp).reduce((v,x)=>v+(x-pp)/pp,0);return{loadTime:s,fullLoadTime:e,fps:c,percentDroppedFrames:f/(n+f)*100,totalFrames:n}}};m.$=Wt,m.A=gl,m.B=function(s){if(Le==null){const e=s.navigator?s.navigator.userAgent:null;Le=!!s.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Le},m.C=class{constructor(s,e){this.target=s,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new lb(()=>this.process()),this.subscription=function(n,c,f,v){return n.addEventListener(c,f,!1),{unsubscribe:()=>{n.removeEventListener(c,f,!1)}}}(this.target,"message",n=>this.receive(n)),this.globalScope=ze(self)?s:window}registerMessageHandler(s,e){this.messageHandlers[s]=e}sendAsync(s,e){return new Promise((n,c)=>{const f=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[f]={resolve:n,reject:c},e&&e.signal.addEventListener("abort",()=>{delete this.resolveRejects[f];const b={id:f,type:"<cancel>",origin:location.origin,targetMapId:s.targetMapId,sourceMapId:this.mapId};this.target.postMessage(b)},{once:!0});const v=[],x=Object.assign(Object.assign({},s),{id:f,sourceMapId:this.mapId,origin:location.origin,data:da(s.data,v)});this.target.postMessage(x,{transfer:v})})}receive(s){const e=s.data,n=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[n];const c=this.abortControllers[n];return delete this.abortControllers[n],void(c&&c.abort())}if(ze(self)||e.mustQueue)return this.tasks[n]=e,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,e)}}process(){if(this.taskQueue.length===0)return;const s=this.taskQueue.shift(),e=this.tasks[s];delete this.tasks[s],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(s,e)}processTask(s,e){return l(this,void 0,void 0,function*(){if(e.type==="<response>"){const f=this.resolveRejects[s];return delete this.resolveRejects[s],f?void(e.error?f.reject(fa(e.error)):f.resolve(fa(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(s,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=fa(e.data),c=new AbortController;this.abortControllers[s]=c;try{const f=yield this.messageHandlers[e.type](e.sourceMapId,n,c);this.completeTask(s,null,f)}catch(f){this.completeTask(s,f)}})}completeTask(s,e,n){const c=[];delete this.abortControllers[s];const f={id:s,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?da(e):null,data:da(n,c)};this.target.postMessage(f,{transfer:c})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},m.D=ve,m.E=Ft,m.F=function(){var s=new gl(16);return gl!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},m.G=kt,m.H=function(s,e,n){var c,f,v,x,b,S,E,D,k,B,$,U,G=n[0],X=n[1],st=n[2];return e===s?(s[12]=e[0]*G+e[4]*X+e[8]*st+e[12],s[13]=e[1]*G+e[5]*X+e[9]*st+e[13],s[14]=e[2]*G+e[6]*X+e[10]*st+e[14],s[15]=e[3]*G+e[7]*X+e[11]*st+e[15]):(f=e[1],v=e[2],x=e[3],b=e[4],S=e[5],E=e[6],D=e[7],k=e[8],B=e[9],$=e[10],U=e[11],s[0]=c=e[0],s[1]=f,s[2]=v,s[3]=x,s[4]=b,s[5]=S,s[6]=E,s[7]=D,s[8]=k,s[9]=B,s[10]=$,s[11]=U,s[12]=c*G+b*X+k*st+e[12],s[13]=f*G+S*X+B*st+e[13],s[14]=v*G+E*X+$*st+e[14],s[15]=x*G+D*X+U*st+e[15]),s},m.I=Yf,m.J=function(s,e,n){var c=n[0],f=n[1],v=n[2];return s[0]=e[0]*c,s[1]=e[1]*c,s[2]=e[2]*c,s[3]=e[3]*c,s[4]=e[4]*f,s[5]=e[5]*f,s[6]=e[6]*f,s[7]=e[7]*f,s[8]=e[8]*v,s[9]=e[9]*v,s[10]=e[10]*v,s[11]=e[11]*v,s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15],s},m.K=tg,m.L=function(s,e){const n={};for(let c=0;c<e.length;c++){const f=e[c];f in s&&(n[f]=s[f])}return n},m.M=va,m.N=Xg,m.O=Kg,m.P=P,m.Q=Dr,m.R=Cr,m.S=yt,m.T=xc,m.U=Tt,m.V=ks,m.W=Wi,m.X=Ki,m.Y=Hu,m.Z=class extends Mc{},m._=l,m.a=As,m.a$=function(s,e,n){return s[0]=e[0]*n[0],s[1]=e[1]*n[1],s[2]=e[2]*n[2],s[3]=e[3]*n[3],s},m.a0=op,m.a1=Rt,m.a2=s=>{const e=window.document.createElement("video");return e.muted=!0,new Promise(n=>{e.onloadstart=()=>{n(e)};for(const c of s){const f=window.document.createElement("source");ni(c)||(e.crossOrigin="Anonymous"),f.src=c,e.appendChild(f)}})},m.a3=function(){return te++},m.a4=g,m.a5=wl,m.a6=Xo,m.a7=qn,m.a8=ki,m.a9=i_,m.aA=xe,m.aB=function(s,e){if(!s)return[{command:"setStyle",args:[e]}];let n=[];try{if(!Pt(s.version,e.version))return[{command:"setStyle",args:[e]}];Pt(s.center,e.center)||n.push({command:"setCenter",args:[e.center]}),Pt(s.zoom,e.zoom)||n.push({command:"setZoom",args:[e.zoom]}),Pt(s.bearing,e.bearing)||n.push({command:"setBearing",args:[e.bearing]}),Pt(s.pitch,e.pitch)||n.push({command:"setPitch",args:[e.pitch]}),Pt(s.sprite,e.sprite)||n.push({command:"setSprite",args:[e.sprite]}),Pt(s.glyphs,e.glyphs)||n.push({command:"setGlyphs",args:[e.glyphs]}),Pt(s.transition,e.transition)||n.push({command:"setTransition",args:[e.transition]}),Pt(s.light,e.light)||n.push({command:"setLight",args:[e.light]}),Pt(s.terrain,e.terrain)||n.push({command:"setTerrain",args:[e.terrain]}),Pt(s.sky,e.sky)||n.push({command:"setSky",args:[e.sky]});const c={},f=[];(function(x,b,S,E){let D;for(D in b=b||{},x=x||{})Object.prototype.hasOwnProperty.call(x,D)&&(Object.prototype.hasOwnProperty.call(b,D)||ue(D,S,E));for(D in b)Object.prototype.hasOwnProperty.call(b,D)&&(Object.prototype.hasOwnProperty.call(x,D)?Pt(x[D],b[D])||(x[D].type==="geojson"&&b[D].type==="geojson"&&we(x,b,D)?qt(S,{command:"setGeoJSONSourceData",args:[D,b[D].data]}):Ee(D,b,S,E)):Vt(D,b,S))})(s.sources,e.sources,f,c);const v=[];s.layers&&s.layers.forEach(x=>{"source"in x&&c[x.source]?n.push({command:"removeLayer",args:[x.id]}):v.push(x)}),n=n.concat(f),function(x,b,S){b=b||[];const E=(x=x||[]).map(Xe),D=b.map(Xe),k=x.reduce(ii,{}),B=b.reduce(ii,{}),$=E.slice(),U=Object.create(null);let G,X,st,gt,nt;for(let ft=0,At=0;ft<E.length;ft++)G=E[ft],Object.prototype.hasOwnProperty.call(B,G)?At++:(qt(S,{command:"removeLayer",args:[G]}),$.splice($.indexOf(G,At),1));for(let ft=0,At=0;ft<D.length;ft++)G=D[D.length-1-ft],$[$.length-1-ft]!==G&&(Object.prototype.hasOwnProperty.call(k,G)?(qt(S,{command:"removeLayer",args:[G]}),$.splice($.lastIndexOf(G,$.length-At),1)):At++,gt=$[$.length-ft],qt(S,{command:"addLayer",args:[B[G],gt]}),$.splice($.length-ft,0,G),U[G]=!0);for(let ft=0;ft<D.length;ft++)if(G=D[ft],X=k[G],st=B[G],!U[G]&&!Pt(X,st))if(Pt(X.source,st.source)&&Pt(X["source-layer"],st["source-layer"])&&Pt(X.type,st.type)){for(nt in De(X.layout,st.layout,S,G,null,"setLayoutProperty"),De(X.paint,st.paint,S,G,null,"setPaintProperty"),Pt(X.filter,st.filter)||qt(S,{command:"setFilter",args:[G,st.filter]}),Pt(X.minzoom,st.minzoom)&&Pt(X.maxzoom,st.maxzoom)||qt(S,{command:"setLayerZoomRange",args:[G,st.minzoom,st.maxzoom]}),X)Object.prototype.hasOwnProperty.call(X,nt)&&nt!=="layout"&&nt!=="paint"&&nt!=="filter"&&nt!=="metadata"&&nt!=="minzoom"&&nt!=="maxzoom"&&(nt.indexOf("paint.")===0?De(X[nt],st[nt],S,G,nt.slice(6),"setPaintProperty"):Pt(X[nt],st[nt])||qt(S,{command:"setLayerProperty",args:[G,nt,st[nt]]}));for(nt in st)Object.prototype.hasOwnProperty.call(st,nt)&&!Object.prototype.hasOwnProperty.call(X,nt)&&nt!=="layout"&&nt!=="paint"&&nt!=="filter"&&nt!=="metadata"&&nt!=="minzoom"&&nt!=="maxzoom"&&(nt.indexOf("paint.")===0?De(X[nt],st[nt],S,G,nt.slice(6),"setPaintProperty"):Pt(X[nt],st[nt])||qt(S,{command:"setLayerProperty",args:[G,nt,st[nt]]}))}else qt(S,{command:"removeLayer",args:[G]}),gt=$[$.lastIndexOf(G)+1],qt(S,{command:"addLayer",args:[st,gt]})}(v,e.layers,n)}catch(c){console.warn("Unable to compute style diff:",c),n=[{command:"setStyle",args:[e]}]}return n},m.aC=function(s){const e=[],n=s.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),s.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},m.aD=function s(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(let c=0;c<e.length;c++)if(!s(e[c],n[c]))return!1;return!0}if(typeof e=="object"&&e!==null&&n!==null){if(typeof n!="object"||Object.keys(e).length!==Object.keys(n).length)return!1;for(const c in e)if(!s(e[c],n[c]))return!1;return!0}return e===n},m.aE=fe,m.aF=Ce,m.aG=class extends hs{constructor(s,e){super(s,e),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},m.aH=nr,m.aI=class extends hs{constructor(s,e){super(s,e),this.current=lo}set(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let e=1;e<16;e++)if(s[e]!==this.current[e]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}},m.aJ=Vr,m.aK=class extends hs{constructor(s,e){super(s,e),this.current=[0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))}},m.aL=class extends hs{constructor(s,e){super(s,e),this.current=[0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))}},m.aM=_n,m.aN=function(s,e,n,c,f,v,x){var b=1/(e-n),S=1/(c-f),E=1/(v-x);return s[0]=-2*b,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*S,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*E,s[11]=0,s[12]=(e+n)*b,s[13]=(f+c)*S,s[14]=(x+v)*E,s[15]=1,s},m.aO=fi,m.aP=Ux,m.aQ=class extends ll{},m.aR=O1,m.aS=class extends cl{},m.aT=function(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))},m.aU=ng,m.aV=O,m.aW=class extends Pc{},m.aX=St,m.aY=function(s,e){return s[0]===e[0]&&s[1]===e[1]&&s[2]===e[2]&&s[3]===e[3]&&s[4]===e[4]&&s[5]===e[5]&&s[6]===e[6]&&s[7]===e[7]&&s[8]===e[8]&&s[9]===e[9]&&s[10]===e[10]&&s[11]===e[11]&&s[12]===e[12]&&s[13]===e[13]&&s[14]===e[14]&&s[15]===e[15]},m.aZ=function(s,e){var n=s[0],c=s[1],f=s[2],v=s[3],x=s[4],b=s[5],S=s[6],E=s[7],D=s[8],k=s[9],B=s[10],$=s[11],U=s[12],G=s[13],X=s[14],st=s[15],gt=e[0],nt=e[1],ft=e[2],At=e[3],Ct=e[4],se=e[5],me=e[6],ie=e[7],Jt=e[8],Ht=e[9],he=e[10],Yt=e[11],$t=e[12],Me=e[13],ge=e[14],Ze=e[15];return Math.abs(n-gt)<=Ws*Math.max(1,Math.abs(n),Math.abs(gt))&&Math.abs(c-nt)<=Ws*Math.max(1,Math.abs(c),Math.abs(nt))&&Math.abs(f-ft)<=Ws*Math.max(1,Math.abs(f),Math.abs(ft))&&Math.abs(v-At)<=Ws*Math.max(1,Math.abs(v),Math.abs(At))&&Math.abs(x-Ct)<=Ws*Math.max(1,Math.abs(x),Math.abs(Ct))&&Math.abs(b-se)<=Ws*Math.max(1,Math.abs(b),Math.abs(se))&&Math.abs(S-me)<=Ws*Math.max(1,Math.abs(S),Math.abs(me))&&Math.abs(E-ie)<=Ws*Math.max(1,Math.abs(E),Math.abs(ie))&&Math.abs(D-Jt)<=Ws*Math.max(1,Math.abs(D),Math.abs(Jt))&&Math.abs(k-Ht)<=Ws*Math.max(1,Math.abs(k),Math.abs(Ht))&&Math.abs(B-he)<=Ws*Math.max(1,Math.abs(B),Math.abs(he))&&Math.abs($-Yt)<=Ws*Math.max(1,Math.abs($),Math.abs(Yt))&&Math.abs(U-$t)<=Ws*Math.max(1,Math.abs(U),Math.abs($t))&&Math.abs(G-Me)<=Ws*Math.max(1,Math.abs(G),Math.abs(Me))&&Math.abs(X-ge)<=Ws*Math.max(1,Math.abs(X),Math.abs(ge))&&Math.abs(st-Ze)<=Ws*Math.max(1,Math.abs(st),Math.abs(Ze))},m.a_=function(s,e){return s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[3],s[4]=e[4],s[5]=e[5],s[6]=e[6],s[7]=e[7],s[8]=e[8],s[9]=e[9],s[10]=e[10],s[11]=e[11],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15],s},m.aa=function(s){const e={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,c,f,v)=>{const x=f||v;return e[c]=!x||x.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e},m.ab=function(s,e){const n=[];for(const c in s)c in e||n.push(c);return n},m.ac=Ot,m.ad=function(s,e,n){var c=Math.sin(n),f=Math.cos(n),v=e[0],x=e[1],b=e[2],S=e[3],E=e[4],D=e[5],k=e[6],B=e[7];return e!==s&&(s[8]=e[8],s[9]=e[9],s[10]=e[10],s[11]=e[11],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[0]=v*f+E*c,s[1]=x*f+D*c,s[2]=b*f+k*c,s[3]=S*f+B*c,s[4]=E*f-v*c,s[5]=D*f-x*c,s[6]=k*f-b*c,s[7]=B*f-S*c,s},m.ae=function(s){var e=new gl(16);return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],e[9]=s[9],e[10]=s[10],e[11]=s[11],e[12]=s[12],e[13]=s[13],e[14]=s[14],e[15]=s[15],e},m.af=Lu,m.ag=function(s,e){let n=0,c=0;if(s.kind==="constant")c=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:f,minZoom:v,maxZoom:x}=s,b=f?Ot(Es.interpolationFactor(f,e,v,x),0,1):0;s.kind==="camera"?c=zs.number(s.minSize,s.maxSize,b):n=b}return{uSizeT:n,uSize:c}},m.ai=function(s,{uSize:e,uSizeT:n},{lowerSize:c,upperSize:f}){return s.kind==="source"?c/xn:s.kind==="composite"?zs.number(c/xn,f/xn,n):e},m.aj=ep,m.ak=function(s,e,n,c){const f=e.y-s.y,v=e.x-s.x,x=c.y-n.y,b=c.x-n.x,S=x*v-b*f;if(S===0)return null;const E=(b*(s.y-n.y)-x*(s.x-n.x))/S;return new P(s.x+E*v,s.y+E*f)},m.al=a_,m.am=Dc,m.an=zf,m.ao=us,m.aq=tp,m.ar=function(s,e){var n=e[0],c=e[1],f=e[2],v=e[3],x=e[4],b=e[5],S=e[6],E=e[7],D=e[8],k=e[9],B=e[10],$=e[11],U=e[12],G=e[13],X=e[14],st=e[15],gt=n*b-c*x,nt=n*S-f*x,ft=n*E-v*x,At=c*S-f*b,Ct=c*E-v*b,se=f*E-v*S,me=D*G-k*U,ie=D*X-B*U,Jt=D*st-$*U,Ht=k*X-B*G,he=k*st-$*G,Yt=B*st-$*X,$t=gt*Yt-nt*he+ft*Ht+At*Jt-Ct*ie+se*me;return $t?(s[0]=(b*Yt-S*he+E*Ht)*($t=1/$t),s[1]=(f*he-c*Yt-v*Ht)*$t,s[2]=(G*se-X*Ct+st*At)*$t,s[3]=(B*Ct-k*se-$*At)*$t,s[4]=(S*Jt-x*Yt-E*ie)*$t,s[5]=(n*Yt-f*Jt+v*ie)*$t,s[6]=(X*ft-U*se-st*nt)*$t,s[7]=(D*se-B*ft+$*nt)*$t,s[8]=(x*he-b*Jt+E*me)*$t,s[9]=(c*Jt-n*he-v*me)*$t,s[10]=(U*Ct-G*ft+st*gt)*$t,s[11]=(k*ft-D*Ct-$*gt)*$t,s[12]=(b*ie-x*Ht-S*me)*$t,s[13]=(n*Ht-c*ie+f*me)*$t,s[14]=(G*nt-U*At-X*gt)*$t,s[15]=(D*At-k*nt+B*gt)*$t,s):null},m.as=cp,m.at=Qf,m.au=hp,m.av=function(){const s={},e=it.$version;for(const n in it.$root){const c=it.$root[n];if(c.required){let f=null;f=n==="version"?e:c.type==="array"?[]:{},f!=null&&(s[n]=f)}}return s},m.aw=bu,m.ax=re,m.ay=function(s){s=s.slice();const e=Object.create(null);for(let n=0;n<s.length;n++)e[s[n].id]=s[n];for(let n=0;n<s.length;n++)"ref"in s[n]&&(s[n]=ne(s[n],e[s[n].ref]));return s},m.az=function(s){if(s.type==="custom")return new ob(s);switch(s.type){case"background":return new rb(s);case"circle":return new qx(s);case"fill":return new c1(s);case"fill-extrusion":return new S1(s);case"heatmap":return new Gx(s);case"hillshade":return new Wx(s);case"line":return new k1(s);case"raster":return new ab(s);case"symbol":return new Gu(s)}},m.b=Ye,m.b0=function(s,e){return s[0]*e[0]+s[1]*e[1]+s[2]*e[2]+s[3]*e[3]},m.b1=Ut,m.b2=Qg,m.b3=Yg,m.b4=function(s,e,n,c,f){var v,x=1/Math.tan(e/2);return s[0]=x/n,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=x,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,f!=null&&f!==1/0?(s[10]=(f+c)*(v=1/(c-f)),s[14]=2*f*c*v):(s[10]=-1,s[14]=-2*c),s},m.b5=function(s,e,n){var c=Math.sin(n),f=Math.cos(n),v=e[4],x=e[5],b=e[6],S=e[7],E=e[8],D=e[9],k=e[10],B=e[11];return e!==s&&(s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[3],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[4]=v*f+E*c,s[5]=x*f+D*c,s[6]=b*f+k*c,s[7]=S*f+B*c,s[8]=E*f-v*c,s[9]=D*f-x*c,s[10]=k*f-b*c,s[11]=B*f-S*c,s},m.b6=ut,m.b7=Dt,m.b8=function(s){return s*Math.PI/180},m.b9=function(s,e){return s[0]=e[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=e[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=e[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},m.bA=gn,m.ba=class extends Yr{},m.bb=np,m.bc=yb,m.be=ae,m.bf=function(s,e){As.REGISTERED_PROTOCOLS[s]=e},m.bg=function(s){delete As.REGISTERED_PROTOCOLS[s]},m.bh=function(s,e){const n={};for(let f=0;f<s.length;f++){const v=e&&e[s[f].id]||Pf(s[f]);e&&(e[s[f].id]=v);let x=n[v];x||(x=n[v]=[]),x.push(s[f])}const c=[];for(const f in n)c.push(n[f]);return c},m.bi=le,m.bj=e_,m.bk=s_,m.bl=Lg,m.bm=function(s){s.bucket.createArrays(),s.bucket.tilePixelRatio=Wi/(512*s.bucket.overscaling),s.bucket.compareText={},s.bucket.iconsNeedLinear=!1;const e=s.bucket.layers[0],n=e.layout,c=e._unevaluatedLayout._values,f={layoutIconSize:c["icon-size"].possiblyEvaluate(new ki(s.bucket.zoom+1),s.canonical),layoutTextSize:c["text-size"].possiblyEvaluate(new ki(s.bucket.zoom+1),s.canonical),textMaxSize:c["text-size"].possiblyEvaluate(new ki(18))};if(s.bucket.textSizeData.kind==="composite"){const{minZoom:E,maxZoom:D}=s.bucket.textSizeData;f.compositeTextSizes=[c["text-size"].possiblyEvaluate(new ki(E),s.canonical),c["text-size"].possiblyEvaluate(new ki(D),s.canonical)]}if(s.bucket.iconSizeData.kind==="composite"){const{minZoom:E,maxZoom:D}=s.bucket.iconSizeData;f.compositeIconSizes=[c["icon-size"].possiblyEvaluate(new ki(E),s.canonical),c["icon-size"].possiblyEvaluate(new ki(D),s.canonical)]}const v=n.get("text-line-height")*us,x=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",b=n.get("text-keep-upright"),S=n.get("text-size");for(const E of s.bucket.features){const D=n.get("text-font").evaluate(E,{},s.canonical).join(","),k=S.evaluate(E,{},s.canonical),B=f.layoutTextSize.evaluate(E,{},s.canonical),$=f.layoutIconSize.evaluate(E,{},s.canonical),U={horizontal:{},vertical:void 0},G=E.text;let X,st=[0,0];if(G){const ft=G.toString(),At=n.get("text-letter-spacing").evaluate(E,{},s.canonical)*us,Ct=wu(ft)?At:0,se=n.get("text-anchor").evaluate(E,{},s.canonical),me=m_(e,E,s.canonical);if(!me){const Yt=n.get("text-radial-offset").evaluate(E,{},s.canonical);st=Yt?p_(se,[Yt*us,lp]):n.get("text-offset").evaluate(E,{},s.canonical).map($t=>$t*us)}let ie=x?"center":n.get("text-justify").evaluate(E,{},s.canonical);const Jt=n.get("symbol-placement"),Ht=Jt==="point"?n.get("text-max-width").evaluate(E,{},s.canonical)*us:0,he=()=>{s.bucket.allowVerticalPlacement&&pa(ft)&&(U.vertical=Uu(G,s.glyphMap,s.glyphPositions,s.imagePositions,D,Ht,v,se,"left",Ct,st,m.ah.vertical,!0,Jt,B,k))};if(!x&&me){const Yt=new Set;if(ie==="auto")for(let Me=0;Me<me.values.length;Me+=2)Yt.add(cp(me.values[Me]));else Yt.add(ie);let $t=!1;for(const Me of Yt)if(!U.horizontal[Me])if($t)U.horizontal[Me]=U.horizontal[0];else{const ge=Uu(G,s.glyphMap,s.glyphPositions,s.imagePositions,D,Ht,v,"center",Me,Ct,st,m.ah.horizontal,!1,Jt,B,k);ge&&(U.horizontal[Me]=ge,$t=ge.positionedLines.length===1)}he()}else{ie==="auto"&&(ie=cp(se));const Yt=Uu(G,s.glyphMap,s.glyphPositions,s.imagePositions,D,Ht,v,se,ie,Ct,st,m.ah.horizontal,!1,Jt,B,k);Yt&&(U.horizontal[ie]=Yt),he(),pa(ft)&&x&&b&&(U.vertical=Uu(G,s.glyphMap,s.glyphPositions,s.imagePositions,D,Ht,v,se,ie,Ct,st,m.ah.vertical,!1,Jt,B,k))}}let gt=!1;if(E.icon&&E.icon.name){const ft=s.imageMap[E.icon.name];ft&&(X=Q1(s.imagePositions[E.icon.name],n.get("icon-offset").evaluate(E,{},s.canonical),n.get("icon-anchor").evaluate(E,{},s.canonical)),gt=!!ft.sdf,s.bucket.sdfIcons===void 0?s.bucket.sdfIcons=gt:s.bucket.sdfIcons!==gt&&pe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ft.pixelRatio!==s.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(s.bucket.iconsNeedLinear=!0))}const nt=__(U.horizontal)||U.vertical;s.bucket.iconsInText=!!nt&&nt.iconsInText,(nt||X)&&gb(s.bucket,E,U,X,s.imageMap,f,B,$,st,gt,s.canonical)}s.showCollisionBoxes&&s.bucket.generateCollisionDebugBuffers()},m.bn=Wf,m.bo=jf,m.bp=Hf,m.bq=ga,m.br=Xf,m.bs=class{constructor(s){this._marks={start:[s.url,"start"].join("#"),end:[s.url,"end"].join("#"),measure:s.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let s=performance.getEntriesByName(this._marks.measure);return s.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),s=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),s}},m.bt=function(s,e,n,c,f){return l(this,void 0,void 0,function*(){if(Tt())try{return yield ks(s,e,n,c,f)}catch{}return function(v,x,b,S,E){const D=v.width,k=v.height;Ii&&hi||(Ii=new OffscreenCanvas(D,k),hi=Ii.getContext("2d",{willReadFrequently:!0})),Ii.width=D,Ii.height=k,hi.drawImage(v,0,0,D,k);const B=hi.getImageData(x,b,S,E);return hi.clearRect(0,0,D,k),B.data}(s,e,n,c,f)})},m.bu=t_,m.bv=T,m.bw=I,m.bx=Ag,m.by=Fn,m.bz=function(s){return s.message===bs},m.c=fr,m.d=s=>l(void 0,void 0,void 0,function*(){if(s.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(s)],{type:"image/png"});try{return createImageBitmap(e)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),m.e=ce,m.f=s=>new Promise((e,n)=>{const c=new Image;c.onload=()=>{e(c),URL.revokeObjectURL(c.src),c.onload=null,window.requestAnimationFrame(()=>{c.src=xs})},c.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const f=new Blob([new Uint8Array(s)],{type:"image/png"});c.src=s.byteLength?URL.createObjectURL(f):xs}),m.g=Pi,m.h=(s,e)=>ye(ce(s,{type:"json"}),e),m.i=ze,m.j=Mt,m.k=rt,m.l=(s,e)=>ye(ce(s,{type:"arrayBuffer"}),e),m.m=ye,m.n=function(s){return new Xf(s).readFields(W1,[])},m.o=Fc,m.p=zg,m.q=Hs,m.r=Cf,m.s=ni,m.t=ua,m.u=ee,m.v=it,m.w=pe,m.x=Nn,m.y=function([s,e,n]){return e+=90,e*=Math.PI/180,n*=Math.PI/180,{x:s*Math.cos(e)*Math.sin(n),y:s*Math.sin(e)*Math.sin(n),z:s*Math.cos(n)}},m.z=zs}),p("worker",["./shared"],function(m){class l{constructor(F){this.keyCache={},F&&this.replace(F)}replace(F){this._layerConfigs={},this._layers={},this.update(F,[])}update(F,N){for(const H of F){this._layerConfigs[H.id]=H;const ht=this._layers[H.id]=m.az(H);ht._featureFilter=m.a6(ht.filter),this.keyCache[H.id]&&delete this.keyCache[H.id]}for(const H of N)delete this.keyCache[H],delete this._layerConfigs[H],delete this._layers[H];this.familiesBySource={};const q=m.bh(Object.values(this._layerConfigs),this.keyCache);for(const H of q){const ht=H.map(Et=>this._layers[Et.id]),dt=ht[0];if(dt.visibility==="none")continue;const mt=dt.source||"";let at=this.familiesBySource[mt];at||(at=this.familiesBySource[mt]={});const _t=dt.sourceLayer||"_geojsonTileLayer";let zt=at[_t];zt||(zt=at[_t]=[]),zt.push(ht)}}}class T{constructor(F){const N={},q=[];for(const mt in F){const at=F[mt],_t=N[mt]={};for(const zt in at){const Et=at[+zt];if(!Et||Et.bitmap.width===0||Et.bitmap.height===0)continue;const It={x:0,y:0,w:Et.bitmap.width+2,h:Et.bitmap.height+2};q.push(It),_t[zt]={rect:It,metrics:Et.metrics}}}const{w:H,h:ht}=m.p(q),dt=new m.o({width:H||1,height:ht||1});for(const mt in F){const at=F[mt];for(const _t in at){const zt=at[+_t];if(!zt||zt.bitmap.width===0||zt.bitmap.height===0)continue;const Et=N[mt][_t].rect;m.o.copy(zt.bitmap,dt,{x:0,y:0},{x:Et.x+1,y:Et.y+1},zt.bitmap)}}this.image=dt,this.positions=N}}m.bi("GlyphAtlas",T);class I{constructor(F){this.tileID=new m.Q(F.tileID.overscaledZ,F.tileID.wrap,F.tileID.canonical.z,F.tileID.canonical.x,F.tileID.canonical.y),this.uid=F.uid,this.zoom=F.zoom,this.pixelRatio=F.pixelRatio,this.tileSize=F.tileSize,this.source=F.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=F.showCollisionBoxes,this.collectResourceTiming=!!F.collectResourceTiming,this.returnDependencies=!!F.returnDependencies,this.promoteId=F.promoteId,this.inFlightDependencies=[]}parse(F,N,q,H){return m._(this,void 0,void 0,function*(){this.status="parsing",this.data=F,this.collisionBoxArray=new m.a4;const ht=new m.bj(Object.keys(F.layers).sort()),dt=new m.bk(this.tileID,this.promoteId);dt.bucketLayerIDs=[];const mt={},at={featureIndex:dt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:q},_t=N.familiesBySource[this.source];for(const qe in _t){const $i=F.layers[qe];if(!$i)continue;$i.version===1&&m.w(`Vector tile source "${this.source}" layer "${qe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ls=ht.encode(qe),Rs=[];for(let qs=0;qs<$i.length;qs++){const vs=$i.feature(qs),Or=dt.getId(vs,qe);Rs.push({feature:vs,id:Or,index:qs,sourceLayerIndex:ls})}for(const qs of _t[qe]){const vs=qs[0];vs.source!==this.source&&m.w(`layer.source = ${vs.source} does not equal this.source = ${this.source}`),vs.minzoom&&this.zoom<Math.floor(vs.minzoom)||vs.maxzoom&&this.zoom>=vs.maxzoom||vs.visibility!=="none"&&(R(qs,this.zoom,q),(mt[vs.id]=vs.createBucket({index:dt.bucketLayerIDs.length,layers:qs,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ls,sourceID:this.source})).populate(Rs,at,this.tileID.canonical),dt.bucketLayerIDs.push(qs.map(Or=>Or.id)))}}const zt=m.aE(at.glyphDependencies,qe=>Object.keys(qe).map(Number));this.inFlightDependencies.forEach(qe=>qe==null?void 0:qe.abort()),this.inFlightDependencies=[];let Et=Promise.resolve({});if(Object.keys(zt).length){const qe=new AbortController;this.inFlightDependencies.push(qe),Et=H.sendAsync({type:"GG",data:{stacks:zt,source:this.source,tileID:this.tileID,type:"glyphs"}},qe)}const It=Object.keys(at.iconDependencies);let be=Promise.resolve({});if(It.length){const qe=new AbortController;this.inFlightDependencies.push(qe),be=H.sendAsync({type:"GI",data:{icons:It,source:this.source,tileID:this.tileID,type:"icons"}},qe)}const Te=Object.keys(at.patternDependencies);let Ne=Promise.resolve({});if(Te.length){const qe=new AbortController;this.inFlightDependencies.push(qe),Ne=H.sendAsync({type:"GI",data:{icons:Te,source:this.source,tileID:this.tileID,type:"patterns"}},qe)}const[Re,Qe,_i]=yield Promise.all([Et,be,Ne]),Di=new T(Re),Qi=new m.bl(Qe,_i);for(const qe in mt){const $i=mt[qe];$i instanceof m.a5?(R($i.layers,this.zoom,q),m.bm({bucket:$i,glyphMap:Re,glyphPositions:Di.positions,imageMap:Qe,imagePositions:Qi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):$i.hasPattern&&($i instanceof m.bn||$i instanceof m.bo||$i instanceof m.bp)&&(R($i.layers,this.zoom,q),$i.addFeatures(at,this.tileID.canonical,Qi.patternPositions))}return this.status="done",{buckets:Object.values(mt).filter(qe=>!qe.isEmpty()),featureIndex:dt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Di.image,imageAtlas:Qi,glyphMap:this.returnDependencies?Re:null,iconMap:this.returnDependencies?Qe:null,glyphPositions:this.returnDependencies?Di.positions:null}})}}function R(Y,F,N){const q=new m.a8(F);for(const H of Y)H.recalculate(q,N)}class P{constructor(F,N,q){this.actor=F,this.layerIndex=N,this.availableImages=q,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(F,N){return m._(this,void 0,void 0,function*(){const q=yield m.l(F.request,N);try{return{vectorTile:new m.bq.VectorTile(new m.br(q.data)),rawData:q.data,cacheControl:q.cacheControl,expires:q.expires}}catch(H){const ht=new Uint8Array(q.data);let dt=`Unable to parse the tile at ${F.request.url}, `;throw dt+=ht[0]===31&&ht[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${H.messge}`,new Error(dt)}})}loadTile(F){return m._(this,void 0,void 0,function*(){const N=F.uid,q=!!(F&&F.request&&F.request.collectResourceTiming)&&new m.bs(F.request),H=new I(F);this.loading[N]=H;const ht=new AbortController;H.abort=ht;try{const dt=yield this.loadVectorTile(F,ht);if(delete this.loading[N],!dt)return null;const mt=dt.rawData,at={};dt.expires&&(at.expires=dt.expires),dt.cacheControl&&(at.cacheControl=dt.cacheControl);const _t={};if(q){const Et=q.finish();Et&&(_t.resourceTiming=JSON.parse(JSON.stringify(Et)))}H.vectorTile=dt.vectorTile;const zt=H.parse(dt.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[N]=H,this.fetching[N]={rawTileData:mt,cacheControl:at,resourceTiming:_t};try{const Et=yield zt;return m.e({rawTileData:mt.slice(0)},Et,at,_t)}finally{delete this.fetching[N]}}catch(dt){throw delete this.loading[N],H.status="done",this.loaded[N]=H,dt}})}reloadTile(F){return m._(this,void 0,void 0,function*(){const N=F.uid;if(!this.loaded||!this.loaded[N])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const q=this.loaded[N];if(q.showCollisionBoxes=F.showCollisionBoxes,q.status==="parsing"){const H=yield q.parse(q.vectorTile,this.layerIndex,this.availableImages,this.actor);let ht;if(this.fetching[N]){const{rawTileData:dt,cacheControl:mt,resourceTiming:at}=this.fetching[N];delete this.fetching[N],ht=m.e({rawTileData:dt.slice(0)},H,mt,at)}else ht=H;return ht}if(q.status==="done"&&q.vectorTile)return q.parse(q.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(F){return m._(this,void 0,void 0,function*(){const N=this.loading,q=F.uid;N&&N[q]&&N[q].abort&&(N[q].abort.abort(),delete N[q])})}removeTile(F){return m._(this,void 0,void 0,function*(){this.loaded&&this.loaded[F.uid]&&delete this.loaded[F.uid]})}}class L{constructor(){this.loaded={}}loadTile(F){return m._(this,void 0,void 0,function*(){const{uid:N,encoding:q,rawImageData:H,redFactor:ht,greenFactor:dt,blueFactor:mt,baseShift:at}=F,_t=H.width+2,zt=H.height+2,Et=m.b(H)?new m.R({width:_t,height:zt},yield m.bt(H,-1,-1,_t,zt)):H,It=new m.bu(N,Et,q,ht,dt,mt,at);return this.loaded=this.loaded||{},this.loaded[N]=It,It})}removeTile(F){const N=this.loaded,q=F.uid;N&&N[q]&&delete N[q]}}function K(Y,F){if(Y.length!==0){tt(Y[0],F);for(var N=1;N<Y.length;N++)tt(Y[N],!F)}}function tt(Y,F){for(var N=0,q=0,H=0,ht=Y.length,dt=ht-1;H<ht;dt=H++){var mt=(Y[H][0]-Y[dt][0])*(Y[dt][1]+Y[H][1]),at=N+mt;q+=Math.abs(N)>=Math.abs(mt)?N-at+mt:mt-at+N,N=at}N+q>=0!=!!F&&Y.reverse()}var lt=m.bv(function Y(F,N){var q,H=F&&F.type;if(H==="FeatureCollection")for(q=0;q<F.features.length;q++)Y(F.features[q],N);else if(H==="GeometryCollection")for(q=0;q<F.geometries.length;q++)Y(F.geometries[q],N);else if(H==="Feature")Y(F.geometry,N);else if(H==="Polygon")K(F.coordinates,N);else if(H==="MultiPolygon")for(q=0;q<F.coordinates.length;q++)K(F.coordinates[q],N);return F});const vt=m.bq.VectorTileFeature.prototype.toGeoJSON;var yt={exports:{}},Tt=m.bw,ut=m.bq.VectorTileFeature,Dt=Ot;function Ot(Y,F){this.options=F||{},this.features=Y,this.length=Y.length}function Ut(Y,F){this.id=typeof Y.id=="number"?Y.id:void 0,this.type=Y.type,this.rawGeometry=Y.type===1?[Y.geometry]:Y.geometry,this.properties=Y.tags,this.extent=F||4096}Ot.prototype.feature=function(Y){return new Ut(this.features[Y],this.options.extent)},Ut.prototype.loadGeometry=function(){var Y=this.rawGeometry;this.geometry=[];for(var F=0;F<Y.length;F++){for(var N=Y[F],q=[],H=0;H<N.length;H++)q.push(new Tt(N[H][0],N[H][1]));this.geometry.push(q)}return this.geometry},Ut.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Y=this.geometry,F=1/0,N=-1/0,q=1/0,H=-1/0,ht=0;ht<Y.length;ht++)for(var dt=Y[ht],mt=0;mt<dt.length;mt++){var at=dt[mt];F=Math.min(F,at.x),N=Math.max(N,at.x),q=Math.min(q,at.y),H=Math.max(H,at.y)}return[F,q,N,H]},Ut.prototype.toGeoJSON=ut.prototype.toGeoJSON;var ce=m.bx,te=Dt;function fe(Y){var F=new ce;return function(N,q){for(var H in N.layers)q.writeMessage(3,Ce,N.layers[H])}(Y,F),F.finish()}function Ce(Y,F){var N;F.writeVarintField(15,Y.version||1),F.writeStringField(1,Y.name||""),F.writeVarintField(5,Y.extent||4096);var q={keys:[],values:[],keycache:{},valuecache:{}};for(N=0;N<Y.length;N++)q.feature=Y.feature(N),F.writeMessage(2,xe,q);var H=q.keys;for(N=0;N<H.length;N++)F.writeStringField(3,H[N]);var ht=q.values;for(N=0;N<ht.length;N++)F.writeMessage(4,ze,ht[N])}function xe(Y,F){var N=Y.feature;N.id!==void 0&&F.writeVarintField(1,N.id),F.writeMessage(2,ri,Y),F.writeVarintField(3,N.type),F.writeMessage(4,oe,N)}function ri(Y,F){var N=Y.feature,q=Y.keys,H=Y.values,ht=Y.keycache,dt=Y.valuecache;for(var mt in N.properties){var at=N.properties[mt],_t=ht[mt];if(at!==null){_t===void 0&&(q.push(mt),ht[mt]=_t=q.length-1),F.writeVarint(_t);var zt=typeof at;zt!=="string"&&zt!=="boolean"&&zt!=="number"&&(at=JSON.stringify(at));var Et=zt+":"+at,It=dt[Et];It===void 0&&(H.push(at),dt[Et]=It=H.length-1),F.writeVarint(It)}}}function pe(Y,F){return(F<<3)+(7&Y)}function Qt(Y){return Y<<1^Y>>31}function oe(Y,F){for(var N=Y.loadGeometry(),q=Y.type,H=0,ht=0,dt=N.length,mt=0;mt<dt;mt++){var at=N[mt],_t=1;q===1&&(_t=at.length),F.writeVarint(pe(1,_t));for(var zt=q===3?at.length-1:at.length,Et=0;Et<zt;Et++){Et===1&&q!==1&&F.writeVarint(pe(2,zt-1));var It=at[Et].x-H,be=at[Et].y-ht;F.writeVarint(Qt(It)),F.writeVarint(Qt(be)),H+=It,ht+=be}q===3&&F.writeVarint(pe(7,1))}}function ze(Y,F){var N=typeof Y;N==="string"?F.writeStringField(1,Y):N==="boolean"?F.writeBooleanField(7,Y):N==="number"&&(Y%1!=0?F.writeDoubleField(3,Y):Y<0?F.writeSVarintField(6,Y):F.writeVarintField(5,Y))}yt.exports=fe,yt.exports.fromVectorTileJs=fe,yt.exports.fromGeojsonVt=function(Y,F){F=F||{};var N={};for(var q in Y)N[q]=new te(Y[q].features,F),N[q].name=q,N[q].version=F.version,N[q].extent=F.extent;return fe({layers:N})},yt.exports.GeoJSONWrapper=te;var Le=m.bv(yt.exports);const Ye={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Y=>Y},xs=Math.fround||(ks=new Float32Array(1),Y=>(ks[0]=+Y,ks[0]));var ks;const Ii=3,hi=5,bs=6;class fr{constructor(F){this.options=Object.assign(Object.create(Ye),F),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(F){const{log:N,minZoom:q,maxZoom:H}=this.options;N&&console.time("total time");const ht=`prepare ${F.length} points`;N&&console.time(ht),this.points=F;const dt=[];for(let at=0;at<F.length;at++){const _t=F[at];if(!_t.geometry)continue;const[zt,Et]=_t.geometry.coordinates,It=xs(kt(zt)),be=xs(ae(Et));dt.push(It,be,1/0,at,-1,1),this.options.reduce&&dt.push(0)}let mt=this.trees[H+1]=this._createTree(dt);N&&console.timeEnd(ht);for(let at=H;at>=q;at--){const _t=+Date.now();mt=this.trees[at]=this._createTree(this._cluster(mt,at)),N&&console.log("z%d: %d clusters in %dms",at,mt.numItems,+Date.now()-_t)}return N&&console.timeEnd("total time"),this}getClusters(F,N){let q=((F[0]+180)%360+360)%360-180;const H=Math.max(-90,Math.min(90,F[1]));let ht=F[2]===180?180:((F[2]+180)%360+360)%360-180;const dt=Math.max(-90,Math.min(90,F[3]));if(F[2]-F[0]>=360)q=-180,ht=180;else if(q>ht){const Et=this.getClusters([q,H,180,dt],N),It=this.getClusters([-180,H,ht,dt],N);return Et.concat(It)}const mt=this.trees[this._limitZoom(N)],at=mt.range(kt(q),ae(dt),kt(ht),ae(H)),_t=mt.data,zt=[];for(const Et of at){const It=this.stride*Et;zt.push(_t[It+hi]>1?As(_t,It,this.clusterProps):this.points[_t[It+Ii]])}return zt}getChildren(F){const N=this._getOriginId(F),q=this._getOriginZoom(F),H="No cluster with the specified id.",ht=this.trees[q];if(!ht)throw new Error(H);const dt=ht.data;if(N*this.stride>=dt.length)throw new Error(H);const mt=this.options.radius/(this.options.extent*Math.pow(2,q-1)),at=ht.within(dt[N*this.stride],dt[N*this.stride+1],mt),_t=[];for(const zt of at){const Et=zt*this.stride;dt[Et+4]===F&&_t.push(dt[Et+hi]>1?As(dt,Et,this.clusterProps):this.points[dt[Et+Ii]])}if(_t.length===0)throw new Error(H);return _t}getLeaves(F,N,q){const H=[];return this._appendLeaves(H,F,N=N||10,q=q||0,0),H}getTile(F,N,q){const H=this.trees[this._limitZoom(F)],ht=Math.pow(2,F),{extent:dt,radius:mt}=this.options,at=mt/dt,_t=(q-at)/ht,zt=(q+1+at)/ht,Et={features:[]};return this._addTileFeatures(H.range((N-at)/ht,_t,(N+1+at)/ht,zt),H.data,N,q,ht,Et),N===0&&this._addTileFeatures(H.range(1-at/ht,_t,1,zt),H.data,ht,q,ht,Et),N===ht-1&&this._addTileFeatures(H.range(0,_t,at/ht,zt),H.data,-1,q,ht,Et),Et.features.length?Et:null}getClusterExpansionZoom(F){let N=this._getOriginZoom(F)-1;for(;N<=this.options.maxZoom;){const q=this.getChildren(F);if(N++,q.length!==1)break;F=q[0].properties.cluster_id}return N}_appendLeaves(F,N,q,H,ht){const dt=this.getChildren(N);for(const mt of dt){const at=mt.properties;if(at&&at.cluster?ht+at.point_count<=H?ht+=at.point_count:ht=this._appendLeaves(F,at.cluster_id,q,H,ht):ht<H?ht++:F.push(mt),F.length===q)break}return ht}_createTree(F){const N=new m.au(F.length/this.stride|0,this.options.nodeSize,Float32Array);for(let q=0;q<F.length;q+=this.stride)N.add(F[q],F[q+1]);return N.finish(),N.data=F,N}_addTileFeatures(F,N,q,H,ht,dt){for(const mt of F){const at=mt*this.stride,_t=N[at+hi]>1;let zt,Et,It;if(_t)zt=Pi(N,at,this.clusterProps),Et=N[at],It=N[at+1];else{const Ne=this.points[N[at+Ii]];zt=Ne.properties;const[Re,Qe]=Ne.geometry.coordinates;Et=kt(Re),It=ae(Qe)}const be={type:1,geometry:[[Math.round(this.options.extent*(Et*ht-q)),Math.round(this.options.extent*(It*ht-H))]],tags:zt};let Te;Te=_t||this.options.generateId?N[at+Ii]:this.points[N[at+Ii]].id,Te!==void 0&&(be.id=Te),dt.features.push(be)}}_limitZoom(F){return Math.max(this.options.minZoom,Math.min(Math.floor(+F),this.options.maxZoom+1))}_cluster(F,N){const{radius:q,extent:H,reduce:ht,minPoints:dt}=this.options,mt=q/(H*Math.pow(2,N)),at=F.data,_t=[],zt=this.stride;for(let Et=0;Et<at.length;Et+=zt){if(at[Et+2]<=N)continue;at[Et+2]=N;const It=at[Et],be=at[Et+1],Te=F.within(at[Et],at[Et+1],mt),Ne=at[Et+hi];let Re=Ne;for(const Qe of Te){const _i=Qe*zt;at[_i+2]>N&&(Re+=at[_i+hi])}if(Re>Ne&&Re>=dt){let Qe,_i=It*Ne,Di=be*Ne,Qi=-1;const qe=((Et/zt|0)<<5)+(N+1)+this.points.length;for(const $i of Te){const ls=$i*zt;if(at[ls+2]<=N)continue;at[ls+2]=N;const Rs=at[ls+hi];_i+=at[ls]*Rs,Di+=at[ls+1]*Rs,at[ls+4]=qe,ht&&(Qe||(Qe=this._map(at,Et,!0),Qi=this.clusterProps.length,this.clusterProps.push(Qe)),ht(Qe,this._map(at,ls)))}at[Et+4]=qe,_t.push(_i/Re,Di/Re,1/0,qe,-1,Re),ht&&_t.push(Qi)}else{for(let Qe=0;Qe<zt;Qe++)_t.push(at[Et+Qe]);if(Re>1)for(const Qe of Te){const _i=Qe*zt;if(!(at[_i+2]<=N)){at[_i+2]=N;for(let Di=0;Di<zt;Di++)_t.push(at[_i+Di])}}}}return _t}_getOriginId(F){return F-this.points.length>>5}_getOriginZoom(F){return(F-this.points.length)%32}_map(F,N,q){if(F[N+hi]>1){const dt=this.clusterProps[F[N+bs]];return q?Object.assign({},dt):dt}const H=this.points[F[N+Ii]].properties,ht=this.options.map(H);return q&&ht===H?Object.assign({},ht):ht}}function As(Y,F,N){return{type:"Feature",id:Y[F+Ii],properties:Pi(Y,F,N),geometry:{type:"Point",coordinates:[(q=Y[F],360*(q-.5)),re(Y[F+1])]}};var q}function Pi(Y,F,N){const q=Y[F+hi],H=q>=1e4?`${Math.round(q/1e3)}k`:q>=1e3?Math.round(q/100)/10+"k":q,ht=Y[F+bs],dt=ht===-1?{}:Object.assign({},N[ht]);return Object.assign(dt,{cluster:!0,cluster_id:Y[F+Ii],point_count:q,point_count_abbreviated:H})}function kt(Y){return Y/360+.5}function ae(Y){const F=Math.sin(Y*Math.PI/180),N=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return N<0?0:N>1?1:N}function re(Y){const F=(180-360*Y)*Math.PI/180;return 360*Math.atan(Math.exp(F))/Math.PI-90}function ye(Y,F,N,q){for(var H,ht=q,dt=N-F>>1,mt=N-F,at=Y[F],_t=Y[F+1],zt=Y[N],Et=Y[N+1],It=F+3;It<N;It+=3){var be=ni(Y[It],Y[It+1],at,_t,zt,Et);if(be>ht)H=It,ht=be;else if(be===ht){var Te=Math.abs(It-dt);Te<mt&&(H=It,mt=Te)}}ht>q&&(H-F>3&&ye(Y,F,H,q),Y[H+2]=ht,N-H>3&&ye(Y,H,N,q))}function ni(Y,F,N,q,H,ht){var dt=H-N,mt=ht-q;if(dt!==0||mt!==0){var at=((Y-N)*dt+(F-q)*mt)/(dt*dt+mt*mt);at>1?(N=H,q=ht):at>0&&(N+=dt*at,q+=mt*at)}return(dt=Y-N)*dt+(mt=F-q)*mt}function ai(Y,F,N,q){var H={id:Y===void 0?null:Y,type:F,geometry:N,tags:q,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ht){var dt=ht.geometry,mt=ht.type;if(mt==="Point"||mt==="MultiPoint"||mt==="LineString")Q(ht,dt);else if(mt==="Polygon"||mt==="MultiLineString")for(var at=0;at<dt.length;at++)Q(ht,dt[at]);else if(mt==="MultiPolygon")for(at=0;at<dt.length;at++)for(var _t=0;_t<dt[at].length;_t++)Q(ht,dt[at][_t])}(H),H}function Q(Y,F){for(var N=0;N<F.length;N+=3)Y.minX=Math.min(Y.minX,F[N]),Y.minY=Math.min(Y.minY,F[N+1]),Y.maxX=Math.max(Y.maxX,F[N]),Y.maxY=Math.max(Y.maxY,F[N+1])}function rt(Y,F,N,q){if(F.geometry){var H=F.geometry.coordinates,ht=F.geometry.type,dt=Math.pow(N.tolerance/((1<<N.maxZoom)*N.extent),2),mt=[],at=F.id;if(N.promoteId?at=F.properties[N.promoteId]:N.generateId&&(at=q||0),ht==="Point")Mt(H,mt);else if(ht==="MultiPoint")for(var _t=0;_t<H.length;_t++)Mt(H[_t],mt);else if(ht==="LineString")Ft(H,mt,dt,!1);else if(ht==="MultiLineString"){if(N.lineMetrics){for(_t=0;_t<H.length;_t++)Ft(H[_t],mt=[],dt,!1),Y.push(ai(at,"LineString",mt,F.properties));return}it(H,mt,dt,!1)}else if(ht==="Polygon")it(H,mt,dt,!0);else{if(ht!=="MultiPolygon"){if(ht==="GeometryCollection"){for(_t=0;_t<F.geometry.geometries.length;_t++)rt(Y,{id:at,geometry:F.geometry.geometries[_t],properties:F.properties},N,q);return}throw new Error("Input data is not a valid GeoJSON object.")}for(_t=0;_t<H.length;_t++){var zt=[];it(H[_t],zt,dt,!0),mt.push(zt)}}Y.push(ai(at,ht,mt,F.properties))}}function Mt(Y,F){F.push(Xt(Y[0])),F.push(ne(Y[1])),F.push(0)}function Ft(Y,F,N,q){for(var H,ht,dt=0,mt=0;mt<Y.length;mt++){var at=Xt(Y[mt][0]),_t=ne(Y[mt][1]);F.push(at),F.push(_t),F.push(0),mt>0&&(dt+=q?(H*_t-at*ht)/2:Math.sqrt(Math.pow(at-H,2)+Math.pow(_t-ht,2))),H=at,ht=_t}var zt=F.length-3;F[2]=1,ye(F,0,zt,N),F[zt+2]=1,F.size=Math.abs(dt),F.start=0,F.end=F.size}function it(Y,F,N,q){for(var H=0;H<Y.length;H++){var ht=[];Ft(Y[H],ht,N,q),F.push(ht)}}function Xt(Y){return Y/360+.5}function ne(Y){var F=Math.sin(Y*Math.PI/180),N=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return N<0?0:N>1?1:N}function Pt(Y,F,N,q,H,ht,dt,mt){if(q/=F,ht>=(N/=F)&&dt<q)return Y;if(dt<N||ht>=q)return null;for(var at=[],_t=0;_t<Y.length;_t++){var zt=Y[_t],Et=zt.geometry,It=zt.type,be=H===0?zt.minX:zt.minY,Te=H===0?zt.maxX:zt.maxY;if(be>=N&&Te<q)at.push(zt);else if(!(Te<N||be>=q)){var Ne=[];if(It==="Point"||It==="MultiPoint")qt(Et,Ne,N,q,H);else if(It==="LineString")Vt(Et,Ne,N,q,H,!1,mt.lineMetrics);else if(It==="MultiLineString")Ee(Et,Ne,N,q,H,!1);else if(It==="Polygon")Ee(Et,Ne,N,q,H,!0);else if(It==="MultiPolygon")for(var Re=0;Re<Et.length;Re++){var Qe=[];Ee(Et[Re],Qe,N,q,H,!0),Qe.length&&Ne.push(Qe)}if(Ne.length){if(mt.lineMetrics&&It==="LineString"){for(Re=0;Re<Ne.length;Re++)at.push(ai(zt.id,It,Ne[Re],zt.tags));continue}It!=="LineString"&&It!=="MultiLineString"||(Ne.length===1?(It="LineString",Ne=Ne[0]):It="MultiLineString"),It!=="Point"&&It!=="MultiPoint"||(It=Ne.length===3?"Point":"MultiPoint"),at.push(ai(zt.id,It,Ne,zt.tags))}}}return at.length?at:null}function qt(Y,F,N,q,H){for(var ht=0;ht<Y.length;ht+=3){var dt=Y[ht+H];dt>=N&&dt<=q&&(F.push(Y[ht]),F.push(Y[ht+1]),F.push(Y[ht+2]))}}function Vt(Y,F,N,q,H,ht,dt){for(var mt,at,_t=ue(Y),zt=H===0?De:Xe,Et=Y.start,It=0;It<Y.length-3;It+=3){var be=Y[It],Te=Y[It+1],Ne=Y[It+2],Re=Y[It+3],Qe=Y[It+4],_i=H===0?be:Te,Di=H===0?Re:Qe,Qi=!1;dt&&(mt=Math.sqrt(Math.pow(be-Re,2)+Math.pow(Te-Qe,2))),_i<N?Di>N&&(at=zt(_t,be,Te,Re,Qe,N),dt&&(_t.start=Et+mt*at)):_i>q?Di<q&&(at=zt(_t,be,Te,Re,Qe,q),dt&&(_t.start=Et+mt*at)):we(_t,be,Te,Ne),Di<N&&_i>=N&&(at=zt(_t,be,Te,Re,Qe,N),Qi=!0),Di>q&&_i<=q&&(at=zt(_t,be,Te,Re,Qe,q),Qi=!0),!ht&&Qi&&(dt&&(_t.end=Et+mt*at),F.push(_t),_t=ue(Y)),dt&&(Et+=mt)}var qe=Y.length-3;be=Y[qe],Te=Y[qe+1],Ne=Y[qe+2],(_i=H===0?be:Te)>=N&&_i<=q&&we(_t,be,Te,Ne),qe=_t.length-3,ht&&qe>=3&&(_t[qe]!==_t[0]||_t[qe+1]!==_t[1])&&we(_t,_t[0],_t[1],_t[2]),_t.length&&F.push(_t)}function ue(Y){var F=[];return F.size=Y.size,F.start=Y.start,F.end=Y.end,F}function Ee(Y,F,N,q,H,ht){for(var dt=0;dt<Y.length;dt++)Vt(Y[dt],F,N,q,H,ht,!1)}function we(Y,F,N,q){Y.push(F),Y.push(N),Y.push(q)}function De(Y,F,N,q,H,ht){var dt=(ht-F)/(q-F);return Y.push(ht),Y.push(N+(H-N)*dt),Y.push(1),dt}function Xe(Y,F,N,q,H,ht){var dt=(ht-N)/(H-N);return Y.push(F+(q-F)*dt),Y.push(ht),Y.push(1),dt}function ii(Y,F){for(var N=[],q=0;q<Y.length;q++){var H,ht=Y[q],dt=ht.type;if(dt==="Point"||dt==="MultiPoint"||dt==="LineString")H=Rt(ht.geometry,F);else if(dt==="MultiLineString"||dt==="Polygon"){H=[];for(var mt=0;mt<ht.geometry.length;mt++)H.push(Rt(ht.geometry[mt],F))}else if(dt==="MultiPolygon")for(H=[],mt=0;mt<ht.geometry.length;mt++){for(var at=[],_t=0;_t<ht.geometry[mt].length;_t++)at.push(Rt(ht.geometry[mt][_t],F));H.push(at)}N.push(ai(ht.id,dt,H,ht.tags))}return N}function Rt(Y,F){var N=[];N.size=Y.size,Y.start!==void 0&&(N.start=Y.start,N.end=Y.end);for(var q=0;q<Y.length;q+=3)N.push(Y[q]+F,Y[q+1],Y[q+2]);return N}function gi(Y,F){if(Y.transformed)return Y;var N,q,H,ht=1<<Y.z,dt=Y.x,mt=Y.y;for(N=0;N<Y.features.length;N++){var at=Y.features[N],_t=at.geometry,zt=at.type;if(at.geometry=[],zt===1)for(q=0;q<_t.length;q+=2)at.geometry.push(Ci(_t[q],_t[q+1],F,ht,dt,mt));else for(q=0;q<_t.length;q++){var Et=[];for(H=0;H<_t[q].length;H+=2)Et.push(Ci(_t[q][H],_t[q][H+1],F,ht,dt,mt));at.geometry.push(Et)}}return Y.transformed=!0,Y}function Ci(Y,F,N,q,H,ht){return[Math.round(N*(Y*q-H)),Math.round(N*(F*q-ht))]}function pr(Y,F,N,q,H){for(var ht=F===H.maxZoom?0:H.tolerance/((1<<F)*H.extent),dt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:N,y:q,z:F,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},mt=0;mt<Y.length;mt++){dt.numFeatures++,as(dt,Y[mt],ht,H);var at=Y[mt].minX,_t=Y[mt].minY,zt=Y[mt].maxX,Et=Y[mt].maxY;at<dt.minX&&(dt.minX=at),_t<dt.minY&&(dt.minY=_t),zt>dt.maxX&&(dt.maxX=zt),Et>dt.maxY&&(dt.maxY=Et)}return dt}function as(Y,F,N,q){var H=F.geometry,ht=F.type,dt=[];if(ht==="Point"||ht==="MultiPoint")for(var mt=0;mt<H.length;mt+=3)dt.push(H[mt]),dt.push(H[mt+1]),Y.numPoints++,Y.numSimplified++;else if(ht==="LineString")Gt(dt,H,Y,N,!1,!1);else if(ht==="MultiLineString"||ht==="Polygon")for(mt=0;mt<H.length;mt++)Gt(dt,H[mt],Y,N,ht==="Polygon",mt===0);else if(ht==="MultiPolygon")for(var at=0;at<H.length;at++){var _t=H[at];for(mt=0;mt<_t.length;mt++)Gt(dt,_t[mt],Y,N,!0,mt===0)}if(dt.length){var zt=F.tags||null;if(ht==="LineString"&&q.lineMetrics){for(var Et in zt={},F.tags)zt[Et]=F.tags[Et];zt.mapbox_clip_start=H.start/H.size,zt.mapbox_clip_end=H.end/H.size}var It={geometry:dt,type:ht==="Polygon"||ht==="MultiPolygon"?3:ht==="LineString"||ht==="MultiLineString"?2:1,tags:zt};F.id!==null&&(It.id=F.id),Y.features.push(It)}}function Gt(Y,F,N,q,H,ht){var dt=q*q;if(q>0&&F.size<(H?dt:q))N.numPoints+=F.length/3;else{for(var mt=[],at=0;at<F.length;at+=3)(q===0||F[at+2]>dt)&&(N.numSimplified++,mt.push(F[at]),mt.push(F[at+1])),N.numPoints++;H&&function(_t,zt){for(var Et=0,It=0,be=_t.length,Te=be-2;It<be;Te=It,It+=2)Et+=(_t[It]-_t[Te])*(_t[It+1]+_t[Te+1]);if(Et>0===zt)for(It=0,be=_t.length;It<be/2;It+=2){var Ne=_t[It],Re=_t[It+1];_t[It]=_t[be-2-It],_t[It+1]=_t[be-1-It],_t[be-2-It]=Ne,_t[be-1-It]=Re}}(mt,ht),Y.push(mt)}}function Oe(Y,F){var N=(F=this.options=function(H,ht){for(var dt in ht)H[dt]=ht[dt];return H}(Object.create(this.options),F)).debug;if(N&&console.time("preprocess data"),F.maxZoom<0||F.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(F.promoteId&&F.generateId)throw new Error("promoteId and generateId cannot be used together.");var q=function(H,ht){var dt=[];if(H.type==="FeatureCollection")for(var mt=0;mt<H.features.length;mt++)rt(dt,H.features[mt],ht,mt);else rt(dt,H.type==="Feature"?H:{geometry:H},ht);return dt}(Y,F);this.tiles={},this.tileCoords=[],N&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",F.indexMaxZoom,F.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),q=function(H,ht){var dt=ht.buffer/ht.extent,mt=H,at=Pt(H,1,-1-dt,dt,0,-1,2,ht),_t=Pt(H,1,1-dt,2+dt,0,-1,2,ht);return(at||_t)&&(mt=Pt(H,1,-dt,1+dt,0,-1,2,ht)||[],at&&(mt=ii(at,1).concat(mt)),_t&&(mt=mt.concat(ii(_t,-1)))),mt}(q,F),q.length&&this.splitTile(q,0,0,0),N&&(q.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Se(Y,F,N){return 32*((1<<Y)*N+F)+Y}function ui(Y,F){return F?Y.properties[F]:Y.id}function tr(Y,F){if(Y==null)return!0;if(Y.type==="Feature")return ui(Y,F)!=null;if(Y.type==="FeatureCollection"){const N=new Set;for(const q of Y.features){const H=ui(q,F);if(H==null||N.has(H))return!1;N.add(H)}return!0}return!1}function Be(Y,F){const N=new Map;if(Y!=null)if(Y.type==="Feature")N.set(ui(Y,F),Y);else for(const q of Y.features)N.set(ui(q,F),q);return N}Oe.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Oe.prototype.splitTile=function(Y,F,N,q,H,ht,dt){for(var mt=[Y,F,N,q],at=this.options,_t=at.debug;mt.length;){q=mt.pop(),N=mt.pop(),F=mt.pop(),Y=mt.pop();var zt=1<<F,Et=Se(F,N,q),It=this.tiles[Et];if(!It&&(_t>1&&console.time("creation"),It=this.tiles[Et]=pr(Y,F,N,q,at),this.tileCoords.push({z:F,x:N,y:q}),_t)){_t>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",F,N,q,It.numFeatures,It.numPoints,It.numSimplified),console.timeEnd("creation"));var be="z"+F;this.stats[be]=(this.stats[be]||0)+1,this.total++}if(It.source=Y,H){if(F===at.maxZoom||F===H)continue;var Te=1<<H-F;if(N!==Math.floor(ht/Te)||q!==Math.floor(dt/Te))continue}else if(F===at.indexMaxZoom||It.numPoints<=at.indexMaxPoints)continue;if(It.source=null,Y.length!==0){_t>1&&console.time("clipping");var Ne,Re,Qe,_i,Di,Qi,qe=.5*at.buffer/at.extent,$i=.5-qe,ls=.5+qe,Rs=1+qe;Ne=Re=Qe=_i=null,Di=Pt(Y,zt,N-qe,N+ls,0,It.minX,It.maxX,at),Qi=Pt(Y,zt,N+$i,N+Rs,0,It.minX,It.maxX,at),Y=null,Di&&(Ne=Pt(Di,zt,q-qe,q+ls,1,It.minY,It.maxY,at),Re=Pt(Di,zt,q+$i,q+Rs,1,It.minY,It.maxY,at),Di=null),Qi&&(Qe=Pt(Qi,zt,q-qe,q+ls,1,It.minY,It.maxY,at),_i=Pt(Qi,zt,q+$i,q+Rs,1,It.minY,It.maxY,at),Qi=null),_t>1&&console.timeEnd("clipping"),mt.push(Ne||[],F+1,2*N,2*q),mt.push(Re||[],F+1,2*N,2*q+1),mt.push(Qe||[],F+1,2*N+1,2*q),mt.push(_i||[],F+1,2*N+1,2*q+1)}}},Oe.prototype.getTile=function(Y,F,N){var q=this.options,H=q.extent,ht=q.debug;if(Y<0||Y>24)return null;var dt=1<<Y,mt=Se(Y,F=(F%dt+dt)%dt,N);if(this.tiles[mt])return gi(this.tiles[mt],H);ht>1&&console.log("drilling down to z%d-%d-%d",Y,F,N);for(var at,_t=Y,zt=F,Et=N;!at&&_t>0;)_t--,zt=Math.floor(zt/2),Et=Math.floor(Et/2),at=this.tiles[Se(_t,zt,Et)];return at&&at.source?(ht>1&&console.log("found parent tile z%d-%d-%d",_t,zt,Et),ht>1&&console.time("drilling down"),this.splitTile(at.source,_t,zt,Et,Y,F,N),ht>1&&console.timeEnd("drilling down"),this.tiles[mt]?gi(this.tiles[mt],H):null):null};class Rn extends P{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(F,N){return m._(this,void 0,void 0,function*(){const q=F.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const H=this._geoJSONIndex.getTile(q.z,q.x,q.y);if(!H)return null;const ht=new class{constructor(mt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.W,this.length=mt.length,this._features=mt}feature(mt){return new class{constructor(at){this._feature=at,this.extent=m.W,this.type=at.type,this.properties=at.tags,"id"in at&&!isNaN(at.id)&&(this.id=parseInt(at.id,10))}loadGeometry(){if(this._feature.type===1){const at=[];for(const _t of this._feature.geometry)at.push([new m.P(_t[0],_t[1])]);return at}{const at=[];for(const _t of this._feature.geometry){const zt=[];for(const Et of _t)zt.push(new m.P(Et[0],Et[1]));at.push(zt)}return at}}toGeoJSON(at,_t,zt){return vt.call(this,at,_t,zt)}}(this._features[mt])}}(H.features);let dt=Le(ht);return dt.byteOffset===0&&dt.byteLength===dt.buffer.byteLength||(dt=new Uint8Array(dt)),{vectorTile:ht,rawData:dt.buffer}})}loadData(F){return m._(this,void 0,void 0,function*(){var N;(N=this._pendingRequest)===null||N===void 0||N.abort();const q=!!(F&&F.request&&F.request.collectResourceTiming)&&new m.bs(F.request);this._pendingRequest=new AbortController;try{let H=yield this.loadGeoJSON(F,this._pendingRequest);if(delete this._pendingRequest,typeof H!="object")throw new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`);if(lt(H,!0),F.filter){const dt=m.by(F.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(dt.result==="error")throw new Error(dt.value.map(at=>`${at.key}: ${at.message}`).join(", "));H={type:"FeatureCollection",features:H.features.filter(at=>dt.value.evaluate({zoom:0},at))}}this._geoJSONIndex=F.cluster?new fr(function({superclusterOptions:dt,clusterProperties:mt}){if(!mt||!dt)return dt;const at={},_t={},zt={accumulated:null,zoom:0},Et={properties:null},It=Object.keys(mt);for(const be of It){const[Te,Ne]=mt[be],Re=m.by(Ne),Qe=m.by(typeof Te=="string"?[Te,["accumulated"],["get",be]]:Te);at[be]=Re.value,_t[be]=Qe.value}return dt.map=be=>{Et.properties=be;const Te={};for(const Ne of It)Te[Ne]=at[Ne].evaluate(zt,Et);return Te},dt.reduce=(be,Te)=>{Et.properties=Te;for(const Ne of It)zt.accumulated=be[Ne],be[Ne]=_t[Ne].evaluate(zt,Et)},dt}(F)).load(H.features):function(dt,mt){return new Oe(dt,mt)}(H,F.geojsonVtOptions),this.loaded={};const ht={};if(q){const dt=q.finish();dt&&(ht.resourceTiming={},ht.resourceTiming[F.source]=JSON.parse(JSON.stringify(dt)))}return ht}catch(H){if(delete this._pendingRequest,m.bz(H))return{abandoned:!0};throw H}})}reloadTile(F){const N=this.loaded;return N&&N[F.uid]?super.reloadTile(F):this.loadTile(F)}loadGeoJSON(F,N){return m._(this,void 0,void 0,function*(){const{promoteId:q}=F;if(F.request){const H=yield m.h(F.request,N);return this._dataUpdateable=tr(H.data,q)?Be(H.data,q):void 0,H.data}if(typeof F.data=="string")try{const H=JSON.parse(F.data);return this._dataUpdateable=tr(H,q)?Be(H,q):void 0,H}catch{throw new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`)}if(!F.dataDiff)throw new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${F.source}`);return function(H,ht,dt){var mt,at,_t,zt;if(ht.removeAll&&H.clear(),ht.remove)for(const Et of ht.remove)H.delete(Et);if(ht.add)for(const Et of ht.add){const It=ui(Et,dt);It!=null&&H.set(It,Et)}if(ht.update)for(const Et of ht.update){let It=H.get(Et.id);if(It==null)continue;const be=!Et.removeAllProperties&&(((mt=Et.removeProperties)===null||mt===void 0?void 0:mt.length)>0||((at=Et.addOrUpdateProperties)===null||at===void 0?void 0:at.length)>0);if((Et.newGeometry||Et.removeAllProperties||be)&&(It=Object.assign({},It),H.set(Et.id,It),be&&(It.properties=Object.assign({},It.properties))),Et.newGeometry&&(It.geometry=Et.newGeometry),Et.removeAllProperties)It.properties={};else if(((_t=Et.removeProperties)===null||_t===void 0?void 0:_t.length)>0)for(const Te of Et.removeProperties)Object.prototype.hasOwnProperty.call(It.properties,Te)&&delete It.properties[Te];if(((zt=Et.addOrUpdateProperties)===null||zt===void 0?void 0:zt.length)>0)for(const{key:Te,value:Ne}of Et.addOrUpdateProperties)It.properties[Te]=Ne}}(this._dataUpdateable,F.dataDiff,q),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(F){return m._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(F){return this._geoJSONIndex.getClusterExpansionZoom(F.clusterId)}getClusterChildren(F){return this._geoJSONIndex.getChildren(F.clusterId)}getClusterLeaves(F){return this._geoJSONIndex.getLeaves(F.clusterId,F.limit,F.offset)}}class os{constructor(F){this.self=F,this.actor=new m.C(F),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(N,q)=>{if(this.externalWorkerSourceTypes[N])throw new Error(`Worker source with name "${N}" already registered.`);this.externalWorkerSourceTypes[N]=q},this.self.addProtocol=m.bf,this.self.removeProtocol=m.bg,this.self.registerRTLTextPlugin=N=>{if(m.bA.isParsed())throw new Error("RTL text plugin already registered.");m.bA.setMethods(N)},this.actor.registerMessageHandler("LDT",(N,q)=>this._getDEMWorkerSource(N,q.source).loadTile(q)),this.actor.registerMessageHandler("RDT",(N,q)=>m._(this,void 0,void 0,function*(){this._getDEMWorkerSource(N,q.source).removeTile(q)})),this.actor.registerMessageHandler("GCEZ",(N,q)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(N,q.type,q.source).getClusterExpansionZoom(q)})),this.actor.registerMessageHandler("GCC",(N,q)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(N,q.type,q.source).getClusterChildren(q)})),this.actor.registerMessageHandler("GCL",(N,q)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(N,q.type,q.source).getClusterLeaves(q)})),this.actor.registerMessageHandler("LD",(N,q)=>this._getWorkerSource(N,q.type,q.source).loadData(q)),this.actor.registerMessageHandler("LT",(N,q)=>this._getWorkerSource(N,q.type,q.source).loadTile(q)),this.actor.registerMessageHandler("RT",(N,q)=>this._getWorkerSource(N,q.type,q.source).reloadTile(q)),this.actor.registerMessageHandler("AT",(N,q)=>this._getWorkerSource(N,q.type,q.source).abortTile(q)),this.actor.registerMessageHandler("RMT",(N,q)=>this._getWorkerSource(N,q.type,q.source).removeTile(q)),this.actor.registerMessageHandler("RS",(N,q)=>m._(this,void 0,void 0,function*(){if(!this.workerSources[N]||!this.workerSources[N][q.type]||!this.workerSources[N][q.type][q.source])return;const H=this.workerSources[N][q.type][q.source];delete this.workerSources[N][q.type][q.source],H.removeSource!==void 0&&H.removeSource(q)})),this.actor.registerMessageHandler("RM",N=>m._(this,void 0,void 0,function*(){delete this.layerIndexes[N],delete this.availableImages[N],delete this.workerSources[N],delete this.demWorkerSources[N]})),this.actor.registerMessageHandler("SR",(N,q)=>m._(this,void 0,void 0,function*(){this.referrer=q})),this.actor.registerMessageHandler("SRPS",(N,q)=>this._syncRTLPluginState(N,q)),this.actor.registerMessageHandler("IS",(N,q)=>m._(this,void 0,void 0,function*(){this.self.importScripts(q)})),this.actor.registerMessageHandler("SI",(N,q)=>this._setImages(N,q)),this.actor.registerMessageHandler("UL",(N,q)=>m._(this,void 0,void 0,function*(){this._getLayerIndex(N).update(q.layers,q.removedIds)})),this.actor.registerMessageHandler("SL",(N,q)=>m._(this,void 0,void 0,function*(){this._getLayerIndex(N).replace(q)}))}_setImages(F,N){return m._(this,void 0,void 0,function*(){this.availableImages[F]=N;for(const q in this.workerSources[F]){const H=this.workerSources[F][q];for(const ht in H)H[ht].availableImages=N}})}_syncRTLPluginState(F,N){return m._(this,void 0,void 0,function*(){if(m.bA.isParsed())return m.bA.getState();if(N.pluginStatus!=="loading")return m.bA.setState(N),N;const q=N.pluginURL;if(this.self.importScripts(q),m.bA.isParsed()){const H={pluginStatus:"loaded",pluginURL:q};return m.bA.setState(H),H}throw m.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${q}`)})}_getAvailableImages(F){let N=this.availableImages[F];return N||(N=[]),N}_getLayerIndex(F){let N=this.layerIndexes[F];return N||(N=this.layerIndexes[F]=new l),N}_getWorkerSource(F,N,q){if(this.workerSources[F]||(this.workerSources[F]={}),this.workerSources[F][N]||(this.workerSources[F][N]={}),!this.workerSources[F][N][q]){const H={sendAsync:(ht,dt)=>(ht.targetMapId=F,this.actor.sendAsync(ht,dt))};switch(N){case"vector":this.workerSources[F][N][q]=new P(H,this._getLayerIndex(F),this._getAvailableImages(F));break;case"geojson":this.workerSources[F][N][q]=new Rn(H,this._getLayerIndex(F),this._getAvailableImages(F));break;default:this.workerSources[F][N][q]=new this.externalWorkerSourceTypes[N](H,this._getLayerIndex(F),this._getAvailableImages(F))}}return this.workerSources[F][N][q]}_getDEMWorkerSource(F,N){return this.demWorkerSources[F]||(this.demWorkerSources[F]={}),this.demWorkerSources[F][N]||(this.demWorkerSources[F][N]=new L),this.demWorkerSources[F][N]}}return m.i(self)&&(self.worker=new os(self)),os}),p("index",["exports","./shared"],function(m,l){var T="4.1.3";let I,R;const P={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:g=>new Promise((i,o)=>{const u=requestAnimationFrame(i);g.signal.addEventListener("abort",()=>{cancelAnimationFrame(u),o(l.c())})}),getImageData(g,i=0){return this.getImageCanvasContext(g).getImageData(-i,-i,g.width+2*i,g.height+2*i)},getImageCanvasContext(g){const i=window.document.createElement("canvas"),o=i.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return i.width=g.width,i.height=g.height,o.drawImage(g,0,0,g.width,g.height),o},resolveURL:g=>(I||(I=document.createElement("a")),I.href=g,I.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(R==null&&(R=matchMedia("(prefers-reduced-motion: reduce)")),R.matches)}};class L{static testProp(i){if(!L.docStyle)return i[0];for(let o=0;o<i.length;o++)if(i[o]in L.docStyle)return i[o];return i[0]}static create(i,o,u){const d=window.document.createElement(i);return o!==void 0&&(d.className=o),u&&u.appendChild(d),d}static createNS(i,o){return window.document.createElementNS(i,o)}static disableDrag(){L.docStyle&&L.selectProp&&(L.userSelect=L.docStyle[L.selectProp],L.docStyle[L.selectProp]="none")}static enableDrag(){L.docStyle&&L.selectProp&&(L.docStyle[L.selectProp]=L.userSelect)}static setTransform(i,o){i.style[L.transformProp]=o}static addEventListener(i,o,u,d={}){i.addEventListener(o,u,"passive"in d?d:d.capture)}static removeEventListener(i,o,u,d={}){i.removeEventListener(o,u,"passive"in d?d:d.capture)}static suppressClickInternal(i){i.preventDefault(),i.stopPropagation(),window.removeEventListener("click",L.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",L.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",L.suppressClickInternal,!0)},0)}static getScale(i){const o=i.getBoundingClientRect();return{x:o.width/i.offsetWidth||1,y:o.height/i.offsetHeight||1,boundingClientRect:o}}static getPoint(i,o,u){const d=o.boundingClientRect;return new l.P((u.clientX-d.left)/o.x-i.clientLeft,(u.clientY-d.top)/o.y-i.clientTop)}static mousePos(i,o){const u=L.getScale(i);return L.getPoint(i,u,o)}static touchPos(i,o){const u=[],d=L.getScale(i);for(let y=0;y<o.length;y++)u.push(L.getPoint(i,d,o[y]));return u}static mouseButton(i){return i.button}static remove(i){i.parentNode&&i.parentNode.removeChild(i)}}L.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,L.selectProp=L.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),L.transformProp=L.testProp(["transform","WebkitTransform"]);const K={supported:!1,testSupport:function(g){!vt&&lt&&(yt?Tt(g):tt=g)}};let tt,lt,vt=!1,yt=!1;function Tt(g){const i=g.createTexture();g.bindTexture(g.TEXTURE_2D,i);try{if(g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,lt),g.isContextLost())return;K.supported=!0}catch{}g.deleteTexture(i),vt=!0}var ut;typeof document<"u"&&(lt=document.createElement("img"),lt.onload=function(){tt&&Tt(tt),tt=null,yt=!0},lt.onerror=function(){vt=!0,tt=null},lt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(g){let i,o,u,d;g.resetRequestQueue=()=>{i=[],o=0,u=0,d={}},g.addThrottleControl=A=>{const C=u++;return d[C]=A,C},g.removeThrottleControl=A=>{delete d[A],w()},g.getImage=(A,C,z=!0)=>new Promise((O,V)=>{K.supported&&(A.headers||(A.headers={}),A.headers.accept="image/webp,*/*"),l.e(A,{type:"image"}),i.push({abortController:C,requestParameters:A,supportImageRefresh:z,state:"queued",onError:Z=>{V(Z)},onSuccess:Z=>{O(Z)}}),w()});const y=A=>l._(this,void 0,void 0,function*(){A.state="running";const{requestParameters:C,supportImageRefresh:z,onError:O,onSuccess:V,abortController:Z}=A,W=z===!1&&!l.i(self)&&!l.g(C.url)&&(!C.headers||Object.keys(C.headers).reduce((ot,xt)=>ot&&xt==="accept",!0));o++;const J=W?M(C,Z):l.m(C,Z);try{const ot=yield J;delete A.abortController,A.state="completed",ot.data instanceof HTMLImageElement||l.b(ot.data)?V(ot):ot.data&&V({data:yield(j=ot.data,typeof createImageBitmap=="function"?l.d(j):l.f(j)),cacheControl:ot.cacheControl,expires:ot.expires})}catch(ot){delete A.abortController,O(ot)}finally{o--,w()}var j}),w=()=>{const A=(()=>{for(const C of Object.keys(d))if(d[C]())return!0;return!1})()?l.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let C=o;C<A&&i.length>0;C++){const z=i.shift();z.abortController.signal.aborted?C--:y(z)}},M=(A,C)=>new Promise((z,O)=>{const V=new Image,Z=A.url,W=A.credentials;W&&W==="include"?V.crossOrigin="use-credentials":(W&&W==="same-origin"||!l.s(Z))&&(V.crossOrigin="anonymous"),C.signal.addEventListener("abort",()=>{V.src="",O(l.c())}),V.fetchPriority="high",V.onload=()=>{V.onerror=V.onload=null,z({data:V})},V.onerror=()=>{V.onerror=V.onload=null,C.signal.aborted||O(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},V.src=Z})}(ut||(ut={})),ut.resetRequestQueue();class Dt{constructor(i){this._transformRequestFn=i}transformRequest(i,o){return this._transformRequestFn&&this._transformRequestFn(i,o)||{url:i}}normalizeSpriteURL(i,o,u){const d=function(y){const w=y.match(Ot);if(!w)throw new Error(`Unable to parse URL "${y}"`);return{protocol:w[1],authority:w[2],path:w[3]||"/",params:w[4]?w[4].split("&"):[]}}(i);return d.path+=`${o}${u}`,function(y){const w=y.params.length?`?${y.params.join("&")}`:"";return`${y.protocol}://${y.authority}${y.path}${w}`}(d)}setTransformRequest(i){this._transformRequestFn=i}}const Ot=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ut(g){var i=new l.A(3);return i[0]=g[0],i[1]=g[1],i[2]=g[2],i}var ce,te=function(g,i,o){return g[0]=i[0]-o[0],g[1]=i[1]-o[1],g[2]=i[2]-o[2],g};ce=new l.A(3),l.A!=Float32Array&&(ce[0]=0,ce[1]=0,ce[2]=0);var fe=function(g){var i=g[0],o=g[1];return i*i+o*o};function Ce(g){const i=[];if(typeof g=="string")i.push({id:"default",url:g});else if(g&&g.length>0){const o=[];for(const{id:u,url:d}of g){const y=`${u}${d}`;o.indexOf(y)===-1&&(o.push(y),i.push({id:u,url:d}))}}return i}(function(){var g=new l.A(2);l.A!=Float32Array&&(g[0]=0,g[1]=0)})();class xe{constructor(i,o,u,d){this.context=i,this.format=u,this.texture=i.gl.createTexture(),this.update(o,d)}update(i,o,u){const{width:d,height:y}=i,w=!(this.size&&this.size[0]===d&&this.size[1]===y||u),{context:M}=this,{gl:A}=M;if(this.useMipmap=!!(o&&o.useMipmap),A.bindTexture(A.TEXTURE_2D,this.texture),M.pixelStoreUnpackFlipY.set(!1),M.pixelStoreUnpack.set(1),M.pixelStoreUnpackPremultiplyAlpha.set(this.format===A.RGBA&&(!o||o.premultiply!==!1)),w)this.size=[d,y],i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||l.b(i)?A.texImage2D(A.TEXTURE_2D,0,this.format,this.format,A.UNSIGNED_BYTE,i):A.texImage2D(A.TEXTURE_2D,0,this.format,d,y,0,this.format,A.UNSIGNED_BYTE,i.data);else{const{x:C,y:z}=u||{x:0,y:0};i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||l.b(i)?A.texSubImage2D(A.TEXTURE_2D,0,C,z,A.RGBA,A.UNSIGNED_BYTE,i):A.texSubImage2D(A.TEXTURE_2D,0,C,z,d,y,A.RGBA,A.UNSIGNED_BYTE,i.data)}this.useMipmap&&this.isSizePowerOfTwo()&&A.generateMipmap(A.TEXTURE_2D)}bind(i,o,u){const{context:d}=this,{gl:y}=d;y.bindTexture(y.TEXTURE_2D,this.texture),u!==y.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=y.LINEAR),i!==this.filter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,i),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,u||i),this.filter=i),o!==this.wrap&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,o),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}function ri(g){const{userImage:i}=g;return!!(i&&i.render&&i.render())&&(g.data.replace(new Uint8Array(i.data.buffer)),!0)}class pe extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:o,promiseResolve:u}of this.requestors)u(this._getImagesForIds(o));this.requestors=[]}}getImage(i){const o=this.images[i];if(o&&!o.data&&o.spriteData){const u=o.spriteData;o.data=new l.R({width:u.width,height:u.height},u.context.getImageData(u.x,u.y,u.width,u.height).data),o.spriteData=null}return o}addImage(i,o){if(this.images[i])throw new Error(`Image id ${i} already exist, use updateImage instead`);this._validate(i,o)&&(this.images[i]=o)}_validate(i,o){let u=!0;const d=o.data||o.spriteData;return this._validateStretch(o.stretchX,d&&d.width)||(this.fire(new l.j(new Error(`Image "${i}" has invalid "stretchX" value`))),u=!1),this._validateStretch(o.stretchY,d&&d.height)||(this.fire(new l.j(new Error(`Image "${i}" has invalid "stretchY" value`))),u=!1),this._validateContent(o.content,o)||(this.fire(new l.j(new Error(`Image "${i}" has invalid "content" value`))),u=!1),u}_validateStretch(i,o){if(!i)return!0;let u=0;for(const d of i){if(d[0]<u||d[1]<d[0]||o<d[1])return!1;u=d[1]}return!0}_validateContent(i,o){if(!i)return!0;if(i.length!==4)return!1;const u=o.spriteData,d=u&&u.width||o.data.width,y=u&&u.height||o.data.height;return!(i[0]<0||d<i[0]||i[1]<0||y<i[1]||i[2]<0||d<i[2]||i[3]<0||y<i[3]||i[2]<i[0]||i[3]<i[1])}updateImage(i,o,u=!0){const d=this.getImage(i);if(u&&(d.data.width!==o.data.width||d.data.height!==o.data.height))throw new Error(`size mismatch between old image (${d.data.width}x${d.data.height}) and new image (${o.data.width}x${o.data.height}).`);o.version=d.version+1,this.images[i]=o,this.updatedImages[i]=!0}removeImage(i){const o=this.images[i];delete this.images[i],delete this.patterns[i],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i){return new Promise((o,u)=>{let d=!0;if(!this.isLoaded())for(const y of i)this.images[y]||(d=!1);this.isLoaded()||d?o(this._getImagesForIds(i)):this.requestors.push({ids:i,promiseResolve:o})})}_getImagesForIds(i){const o={};for(const u of i){let d=this.getImage(u);d||(this.fire(new l.k("styleimagemissing",{id:u})),d=this.getImage(u)),d?o[u]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,hasRenderCallback:!!(d.userImage&&d.userImage.render)}:l.w(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return o}getPixelSize(){const{width:i,height:o}=this.atlasImage;return{width:i,height:o}}getPattern(i){const o=this.patterns[i],u=this.getImage(i);if(!u)return null;if(o&&o.position.version===u.version)return o.position;if(o)o.position.version=u.version;else{const d={w:u.data.width+2,h:u.data.height+2,x:0,y:0},y=new l.I(d,u);this.patterns[i]={bin:d,position:y}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const o=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new xe(i,this.atlasImage,o.RGBA),this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const y in this.patterns)i.push(this.patterns[y].bin);const{w:o,h:u}=l.p(i),d=this.atlasImage;d.resize({width:o||1,height:u||1});for(const y in this.patterns){const{bin:w}=this.patterns[y],M=w.x+1,A=w.y+1,C=this.getImage(y).data,z=C.width,O=C.height;l.R.copy(C,d,{x:0,y:0},{x:M,y:A},{width:z,height:O}),l.R.copy(C,d,{x:0,y:O-1},{x:M,y:A-1},{width:z,height:1}),l.R.copy(C,d,{x:0,y:0},{x:M,y:A+O},{width:z,height:1}),l.R.copy(C,d,{x:z-1,y:0},{x:M-1,y:A},{width:1,height:O}),l.R.copy(C,d,{x:0,y:0},{x:M+z,y:A},{width:1,height:O})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const o of i){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;const u=this.getImage(o);u||l.w(`Image with ID: "${o}" was not found`),ri(u)&&this.updateImage(o,u)}}}const Qt=1e20;function oe(g,i,o,u,d,y,w,M,A){for(let C=i;C<i+u;C++)ze(g,o*y+C,y,d,w,M,A);for(let C=o;C<o+d;C++)ze(g,C*y+i,1,u,w,M,A)}function ze(g,i,o,u,d,y,w){y[0]=0,w[0]=-Qt,w[1]=Qt,d[0]=g[i];for(let M=1,A=0,C=0;M<u;M++){d[M]=g[i+M*o];const z=M*M;do{const O=y[A];C=(d[M]-d[O]+z-O*O)/(M-O)/2}while(C<=w[A]&&--A>-1);A++,y[A]=M,w[A]=C,w[A+1]=Qt}for(let M=0,A=0;M<u;M++){for(;w[A+1]<M;)A++;const C=y[A],z=M-C;g[i+M*o]=d[C]+z*z}}class Le{constructor(i,o){this.requestManager=i,this.localIdeographFontFamily=o,this.entries={}}setURL(i){this.url=i}getGlyphs(i){return l._(this,void 0,void 0,function*(){const o=[];for(const y in i)for(const w of i[y])o.push(this._getAndCacheGlyphsPromise(y,w));const u=yield Promise.all(o),d={};for(const{stack:y,id:w,glyph:M}of u)d[y]||(d[y]={}),d[y][w]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics};return d})}_getAndCacheGlyphsPromise(i,o){return l._(this,void 0,void 0,function*(){let u=this.entries[i];u||(u=this.entries[i]={glyphs:{},requests:{},ranges:{}});let d=u.glyphs[o];if(d!==void 0)return{stack:i,id:o,glyph:d};if(d=this._tinySDF(u,i,o),d)return u.glyphs[o]=d,{stack:i,id:o,glyph:d};const y=Math.floor(o/256);if(256*y>65535)throw new Error("glyphs > 65535 not supported");if(u.ranges[y])return{stack:i,id:o,glyph:d};if(!this.url)throw new Error("glyphsUrl is not set");if(!u.requests[y]){const M=Le.loadGlyphRange(i,y,this.url,this.requestManager);u.requests[y]=M}const w=yield u.requests[y];for(const M in w)this._doesCharSupportLocalGlyph(+M)||(u.glyphs[+M]=w[+M]);return u.ranges[y]=!0,{stack:i,id:o,glyph:w[o]||null}})}_doesCharSupportLocalGlyph(i){return!!this.localIdeographFontFamily&&(l.u["CJK Unified Ideographs"](i)||l.u["Hangul Syllables"](i)||l.u.Hiragana(i)||l.u.Katakana(i))}_tinySDF(i,o,u){const d=this.localIdeographFontFamily;if(!d||!this._doesCharSupportLocalGlyph(u))return;let y=i.tinySDF;if(!y){let M="400";/bold/i.test(o)?M="900":/medium/i.test(o)?M="500":/light/i.test(o)&&(M="200"),y=i.tinySDF=new Le.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:d,fontWeight:M})}const w=y.draw(String.fromCharCode(u));return{id:u,bitmap:new l.o({width:w.width||60,height:w.height||60},w.data),metrics:{width:w.glyphWidth/2||24,height:w.glyphHeight/2||24,left:w.glyphLeft/2+.5||0,top:w.glyphTop/2-27.5||-8,advance:w.glyphAdvance/2||24,isDoubleResolution:!0}}}}Le.loadGlyphRange=function(g,i,o,u){return l._(this,void 0,void 0,function*(){const d=256*i,y=d+255,w=u.transformRequest(o.replace("{fontstack}",g).replace("{range}",`${d}-${y}`),"Glyphs"),M=yield l.l(w,new AbortController);if(!M||!M.data)throw new Error(`Could not load glyph range. range: ${i}, ${d}-${y}`);const A={};for(const C of l.n(M.data))A[C.id]=C;return A})},Le.TinySDF=class{constructor({fontSize:g=24,buffer:i=3,radius:o=8,cutoff:u=.25,fontFamily:d="sans-serif",fontWeight:y="normal",fontStyle:w="normal"}={}){this.buffer=i,this.cutoff=u,this.radius=o;const M=this.size=g+4*i,A=this._createCanvas(M),C=this.ctx=A.getContext("2d",{willReadFrequently:!0});C.font=`${w} ${y} ${g}px ${d}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M)}_createCanvas(g){const i=document.createElement("canvas");return i.width=i.height=g,i}draw(g){const{width:i,actualBoundingBoxAscent:o,actualBoundingBoxDescent:u,actualBoundingBoxLeft:d,actualBoundingBoxRight:y}=this.ctx.measureText(g),w=Math.ceil(o),M=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-d))),A=Math.min(this.size-this.buffer,w+Math.ceil(u)),C=M+2*this.buffer,z=A+2*this.buffer,O=Math.max(C*z,0),V=new Uint8ClampedArray(O),Z={data:V,width:C,height:z,glyphWidth:M,glyphHeight:A,glyphTop:w,glyphLeft:0,glyphAdvance:i};if(M===0||A===0)return Z;const{ctx:W,buffer:J,gridInner:j,gridOuter:ot}=this;W.clearRect(J,J,M,A),W.fillText(g,J,J+w);const xt=W.getImageData(J,J,M,A);ot.fill(Qt,0,O),j.fill(0,0,O);for(let et=0;et<A;et++)for(let pt=0;pt<M;pt++){const bt=xt.data[4*(et*M+pt)+3]/255;if(bt===0)continue;const wt=(et+J)*C+pt+J;if(bt===1)ot[wt]=0,j[wt]=Qt;else{const St=.5-bt;ot[wt]=St>0?St*St:0,j[wt]=St<0?St*St:0}}oe(ot,0,0,C,z,C,this.f,this.v,this.z),oe(j,J,J,M,A,C,this.f,this.v,this.z);for(let et=0;et<O;et++){const pt=Math.sqrt(ot[et])-Math.sqrt(j[et]);V[et]=Math.round(255-255*(pt/this.radius+this.cutoff))}return Z}};class Ye{constructor(){this.specification=l.v.light.position}possiblyEvaluate(i,o){return l.y(i.expression.evaluate(o))}interpolate(i,o,u){return{x:l.z.number(i.x,o.x,u),y:l.z.number(i.y,o.y,u),z:l.z.number(i.z,o.z,u)}}}let xs;class ks extends l.E{constructor(i){super(),xs=xs||new l.q({anchor:new l.D(l.v.light.anchor),position:new Ye,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.T(xs),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,o={}){if(!this._validate(l.r,i,o))for(const u in i){const d=i[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),d):this._transitionable.setValue(u,d)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,o,u){return(!u||u.validate!==!1)&&l.t(this,i.call(l.x,{value:o,style:{glyphs:!0,sprite:!0},styleSpec:l.v}))}}class Ii{constructor(i,o){this.width=i,this.height=o,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(i,o){const u=i.join(",")+String(o);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(i,o)),this.dashEntry[u]}getDashRanges(i,o,u){const d=[];let y=i.length%2==1?-i[i.length-1]*u:0,w=i[0]*u,M=!0;d.push({left:y,right:w,isDash:M,zeroLength:i[0]===0});let A=i[0];for(let C=1;C<i.length;C++){M=!M;const z=i[C];y=A*u,A+=z,w=A*u,d.push({left:y,right:w,isDash:M,zeroLength:z===0})}return d}addRoundDash(i,o,u){const d=o/2;for(let y=-u;y<=u;y++){const w=this.width*(this.nextRow+u+y);let M=0,A=i[M];for(let C=0;C<this.width;C++){C/A.right>1&&(A=i[++M]);const z=Math.abs(C-A.left),O=Math.abs(C-A.right),V=Math.min(z,O);let Z;const W=y/u*(d+1);if(A.isDash){const J=d-Math.abs(W);Z=Math.sqrt(V*V+J*J)}else Z=d-Math.sqrt(V*V+W*W);this.data[w+C]=Math.max(0,Math.min(255,Z+128))}}}addRegularDash(i){for(let M=i.length-1;M>=0;--M){const A=i[M],C=i[M+1];A.zeroLength?i.splice(M,1):C&&C.isDash===A.isDash&&(C.left=A.left,i.splice(M,1))}const o=i[0],u=i[i.length-1];o.isDash===u.isDash&&(o.left=u.left-this.width,u.right=o.right+this.width);const d=this.width*this.nextRow;let y=0,w=i[y];for(let M=0;M<this.width;M++){M/w.right>1&&(w=i[++y]);const A=Math.abs(M-w.left),C=Math.abs(M-w.right),z=Math.min(A,C);this.data[d+M]=Math.max(0,Math.min(255,(w.isDash?z:-z)+128))}}addDash(i,o){const u=o?7:0,d=2*u+1;if(this.nextRow+d>this.height)return l.w("LineAtlas out of space"),null;let y=0;for(let M=0;M<i.length;M++)y+=i[M];if(y!==0){const M=this.width/y,A=this.getDashRanges(i,this.width,M);o?this.addRoundDash(A,M,u):this.addRegularDash(A)}const w={y:(this.nextRow+u+.5)/this.height,height:2*u/this.height,width:y};return this.nextRow+=d,this.dirty=!0,w}bind(i){const o=i.gl;this.texture?(o.bindTexture(o.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,o.texSubImage2D(o.TEXTURE_2D,0,0,0,this.width,this.height,o.ALPHA,o.UNSIGNED_BYTE,this.data))):(this.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.ALPHA,this.width,this.height,0,o.ALPHA,o.UNSIGNED_BYTE,this.data))}}const hi="maplibre_preloaded_worker_pool";class bs{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<bs.workerCount;)this.workers.push(new Worker(l.a.WORKER_URL));return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[hi]}numActive(){return Object.keys(this.active).length}}const fr=Math.floor(P.hardwareConcurrency/2);let As,Pi;function kt(){return As||(As=new bs),As}bs.workerCount=l.B(globalThis)?Math.max(Math.min(fr,3),1):1;class ae{constructor(i,o){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=o;const u=this.workerPool.acquire(o);for(let d=0;d<u.length;d++){const y=new l.C(u[d],o);y.name=`Worker ${d}`,this.actors.push(y)}if(!this.actors.length)throw new Error("No actors found")}broadcast(i,o){const u=[];for(const d of this.actors)u.push(d.sendAsync({type:i,data:o}));return Promise.all(u)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(i=!0){this.actors.forEach(o=>{o.remove()}),this.actors=[],i&&this.workerPool.release(this.id)}registerMessageHandler(i,o){for(const u of this.actors)u.registerMessageHandler(i,o)}}function re(){return Pi||(Pi=new ae(kt(),l.G),Pi.registerMessageHandler("GR",(g,i,o)=>l.m(i,o))),Pi}function ye(g,i){const o=l.F();return l.H(o,o,[1,1,0]),l.J(o,o,[.5*g.width,.5*g.height,1]),l.K(o,o,g.calculatePosMatrix(i.toUnwrapped()))}function ni(g,i,o,u,d,y){const w=function(O,V,Z){if(O)for(const W of O){const J=V[W];if(J&&J.source===Z&&J.type==="fill-extrusion")return!0}else for(const W in V){const J=V[W];if(J.source===Z&&J.type==="fill-extrusion")return!0}return!1}(d&&d.layers,i,g.id),M=y.maxPitchScaleFactor(),A=g.tilesIn(u,M,w);A.sort(ai);const C=[];for(const O of A)C.push({wrappedTileID:O.tileID.wrapped().key,queryResults:O.tile.queryRenderedFeatures(i,o,g._state,O.queryGeometry,O.cameraQueryGeometry,O.scale,d,y,M,ye(g.transform,O.tileID))});const z=function(O){const V={},Z={};for(const W of O){const J=W.queryResults,j=W.wrappedTileID,ot=Z[j]=Z[j]||{};for(const xt in J){const et=J[xt],pt=ot[xt]=ot[xt]||{},bt=V[xt]=V[xt]||[];for(const wt of et)pt[wt.featureIndex]||(pt[wt.featureIndex]=!0,bt.push(wt))}}return V}(C);for(const O in z)z[O].forEach(V=>{const Z=V.feature,W=g.getFeatureState(Z.layer["source-layer"],Z.id);Z.source=Z.layer.source,Z.layer["source-layer"]&&(Z.sourceLayer=Z.layer["source-layer"]),Z.state=W});return z}function ai(g,i){const o=g.tileID,u=i.tileID;return o.overscaledZ-u.overscaledZ||o.canonical.y-u.canonical.y||o.wrap-u.wrap||o.canonical.x-u.canonical.x}function Q(g,i,o){return l._(this,void 0,void 0,function*(){let u=g;if(g.url?u=(yield l.h(i.transformRequest(g.url,"Source"),o)).data:yield P.frameAsync(o),!u)return null;const d=l.L(l.e(u,g),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in u&&u.vector_layers&&(d.vectorLayerIds=u.vector_layers.map(y=>y.id)),d})}class rt{constructor(i,o){i&&(o?this.setSouthWest(i).setNorthEast(o):Array.isArray(i)&&(i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1])))}setNorthEast(i){return this._ne=i instanceof l.M?new l.M(i.lng,i.lat):l.M.convert(i),this}setSouthWest(i){return this._sw=i instanceof l.M?new l.M(i.lng,i.lat):l.M.convert(i),this}extend(i){const o=this._sw,u=this._ne;let d,y;if(i instanceof l.M)d=i,y=i;else{if(!(i instanceof rt))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(rt.convert(i)):this.extend(l.M.convert(i)):i&&("lng"in i||"lon"in i)&&"lat"in i?this.extend(l.M.convert(i)):this;if(d=i._sw,y=i._ne,!d||!y)return this}return o||u?(o.lng=Math.min(d.lng,o.lng),o.lat=Math.min(d.lat,o.lat),u.lng=Math.max(y.lng,u.lng),u.lat=Math.max(y.lat,u.lat)):(this._sw=new l.M(d.lng,d.lat),this._ne=new l.M(y.lng,y.lat)),this}getCenter(){return new l.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.M(this.getWest(),this.getNorth())}getSouthEast(){return new l.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:o,lat:u}=l.M.convert(i);let d=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&d}static convert(i){return i instanceof rt?i:i&&new rt(i)}static fromLngLat(i,o=0){const u=360*o/40075017,d=u/Math.cos(Math.PI/180*i.lat);return new rt(new l.M(i.lng-d,i.lat-u),new l.M(i.lng+d,i.lat+u))}}class Mt{constructor(i,o,u){this.bounds=rt.convert(this.validateBounds(i)),this.minzoom=o||0,this.maxzoom=u||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const o=Math.pow(2,i.z),u=Math.floor(l.N(this.bounds.getWest())*o),d=Math.floor(l.O(this.bounds.getNorth())*o),y=Math.ceil(l.N(this.bounds.getEast())*o),w=Math.ceil(l.O(this.bounds.getSouth())*o);return i.x>=u&&i.x<y&&i.y>=d&&i.y<w}}class Ft extends l.E{constructor(i,o,u,d){if(super(),this.id=i,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.L(o,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d)}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield Q(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),i&&(l.e(this,i),i.bounds&&(this.tileBounds=new Mt(i.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(i){this._tileJSONRequest=null,this.fire(new l.j(i))}})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}setSourceProperty(i){this._tileJSONRequest&&this._tileJSONRequest.abort(),i(),this.load()}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}setUrl(i){return this.setSourceProperty(()=>{this.url=i,this._options.url=i}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(i){return l._(this,void 0,void 0,function*(){const o=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(o,"Tile"),uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};u.request.collectResourceTiming=this._collectResourceTiming;let d="RT";if(i.actor&&i.state!=="expired"){if(i.state==="loading")return new Promise((y,w)=>{i.reloadPromise={resolve:y,reject:w}})}else i.actor=this.dispatcher.getActor(),d="LT";i.abortController=new AbortController;try{const y=yield i.actor.sendAsync({type:d,data:u},i.abortController);if(delete i.abortController,i.aborted)return;this._afterTileLoadWorkerResponse(i,y)}catch(y){if(delete i.abortController,i.aborted)return;if(y&&y.status!==404)throw y;this._afterTileLoadWorkerResponse(i,null)}})}_afterTileLoadWorkerResponse(i,o){if(o&&o.resourceTiming&&(i.resourceTiming=o.resourceTiming),o&&this.map._refreshExpiredTiles&&i.setExpiryData(o),i.loadVectorData(o,this.map.painter),i.reloadPromise){const u=i.reloadPromise;i.reloadPromise=null,this.loadTile(i).then(u.resolve).catch(u.reject)}}abortTile(i){return l._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.actor&&(yield i.actor.sendAsync({type:"AT",data:{uid:i.uid,type:this.type,source:this.id}}))})}unloadTile(i){return l._(this,void 0,void 0,function*(){i.unloadVectorData(),i.actor&&(yield i.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class it extends l.E{constructor(i,o,u,d){super(),this.id=i,this.dispatcher=u,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},o),l.e(this,l.L(o,["url","scheme","tileSize"]))}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield Q(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,i&&(l.e(this,i),i.bounds&&(this.tileBounds=new Mt(i.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(i){this._tileJSONRequest=null,this.fire(new l.j(i))}})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(i){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),i(),this.load()}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}setUrl(i){return this.setSourceProperty(()=>{this.url=i,this._options.url=i}),this}serialize(){return l.e({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i){return l._(this,void 0,void 0,function*(){const o=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);i.abortController=new AbortController;try{const u=yield ut.getImage(this.map._requestManager.transformRequest(o,"Tile"),i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(u&&u.data){this.map._refreshExpiredTiles&&u.cacheControl&&u.expires&&i.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const d=this.map.painter.context,y=d.gl,w=u.data;i.texture=this.map.painter.getTileTexture(w.width),i.texture?i.texture.update(w,{useMipmap:!0}):(i.texture=new xe(d,w,y.RGBA,{useMipmap:!0}),i.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST),d.extTextureFilterAnisotropic&&y.texParameterf(y.TEXTURE_2D,d.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,d.extTextureFilterAnisotropicMax)),i.state="loaded"}}catch(u){if(delete i.abortController,i.aborted)i.state="unloaded";else if(u)throw i.state="errored",u}})}abortTile(i){return l._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController)})}unloadTile(i){return l._(this,void 0,void 0,function*(){i.texture&&this.map.painter.saveTileTexture(i.texture)})}hasTransition(){return!1}}class Xt extends it{constructor(i,o,u,d){super(i,o,u,d),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox",this.redFactor=o.redFactor,this.greenFactor=o.greenFactor,this.blueFactor=o.blueFactor,this.baseShift=o.baseShift}loadTile(i){return l._(this,void 0,void 0,function*(){const o=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u=this.map._requestManager.transformRequest(o,"Tile");i.neighboringTiles=this._getNeighboringTiles(i.tileID),i.abortController=new AbortController;try{const d=yield ut.getImage(u,i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(d&&d.data){const y=d.data;this.map._refreshExpiredTiles&&d.cacheControl&&d.expires&&i.setExpiryData({cacheControl:d.cacheControl,expires:d.expires});const w=l.b(y)&&l.S()?y:yield this.readImageNow(y),M={type:this.type,uid:i.uid,source:this.id,rawImageData:w,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!i.actor||i.state==="expired"){i.actor=this.dispatcher.getActor();const A=yield i.actor.sendAsync({type:"LDT",data:M});i.dem=A,i.needsHillshadePrepare=!0,i.needsTerrainPrepare=!0,i.state="loaded"}}}catch(d){if(delete i.abortController,i.aborted)i.state="unloaded";else if(d)throw i.state="errored",d}})}readImageNow(i){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.U()){const o=i.width+2,u=i.height+2;try{return new l.R({width:o,height:u},yield l.V(i,-1,-1,o,u))}catch{}}return P.getImageData(i,1)})}_getNeighboringTiles(i){const o=i.canonical,u=Math.pow(2,o.z),d=(o.x-1+u)%u,y=o.x===0?i.wrap-1:i.wrap,w=(o.x+1+u)%u,M=o.x+1===u?i.wrap+1:i.wrap,A={};return A[new l.Q(i.overscaledZ,y,o.z,d,o.y).key]={backfilled:!1},A[new l.Q(i.overscaledZ,M,o.z,w,o.y).key]={backfilled:!1},o.y>0&&(A[new l.Q(i.overscaledZ,y,o.z,d,o.y-1).key]={backfilled:!1},A[new l.Q(i.overscaledZ,i.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},A[new l.Q(i.overscaledZ,M,o.z,w,o.y-1).key]={backfilled:!1}),o.y+1<u&&(A[new l.Q(i.overscaledZ,y,o.z,d,o.y+1).key]={backfilled:!1},A[new l.Q(i.overscaledZ,i.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},A[new l.Q(i.overscaledZ,M,o.z,w,o.y+1).key]={backfilled:!1}),A}unloadTile(i){return l._(this,void 0,void 0,function*(){i.demTexture&&this.map.painter.saveTileTexture(i.demTexture),i.fbo&&(i.fbo.destroy(),delete i.fbo),i.dem&&delete i.dem,delete i.neighboringTiles,i.state="unloaded",i.actor&&(yield i.actor.sendAsync({type:"RDT",data:{type:this.type,uid:i.uid,source:this.id}}))})}}class ne extends l.E{constructor(i,o,u,d){super(),this.id=i,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=u.getActor(),this.setEventedParent(d),this._data=o.data,this._options=l.e({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const y=l.W/this.tileSize;this.workerOptions=l.e({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*y,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*y,extent:l.W,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:l.W,radius:(o.clusterRadius||50)*y,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return l._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(i){this.map=i,this.load()}setData(i){return this._data=i,this._updateWorkerData(),this}updateData(i){return this._updateWorkerData(i),this}setClusterOptions(i){return this.workerOptions.cluster=i.cluster,i&&(i.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=i.clusterRadius),i.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=i.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(i){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:i,source:this.id}})}getClusterChildren(i){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:i,source:this.id}})}getClusterLeaves(i,o,u){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:i,limit:o,offset:u}})}_updateWorkerData(i){return l._(this,void 0,void 0,function*(){const o=l.e({type:this.type},this.workerOptions);i?o.dataDiff=i:typeof this._data=="string"?(o.request=this.map._requestManager.transformRequest(P.resolveURL(this._data),"Source"),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.k("dataloading",{dataType:"source"}));try{const u=yield this.actor.sendAsync({type:"LD",data:o});if(this._pendingLoads--,this._removed||u.abandoned)return void this.fire(new l.k("dataabort",{dataType:"source"}));let d=null;u.resourceTiming&&u.resourceTiming[this.id]&&(d=u.resourceTiming[this.id].slice(0));const y={dataType:"source"};this._collectResourceTiming&&d&&d.length>0&&l.e(y,{resourceTiming:d}),this.fire(new l.k("data",Object.assign(Object.assign({},y),{sourceDataType:"metadata"}))),this.fire(new l.k("data",Object.assign(Object.assign({},y),{sourceDataType:"content"})))}catch(u){if(this._pendingLoads--,this._removed)return void this.fire(new l.k("dataabort",{dataType:"source"}));this.fire(new l.j(u))}})}loaded(){return this._pendingLoads===0}loadTile(i){return l._(this,void 0,void 0,function*(){const o=i.actor?"RT":"LT";i.actor=this.actor;const u={type:this.type,uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};i.abortController=new AbortController;const d=yield this.actor.sendAsync({type:o,data:u},i.abortController);delete i.abortController,i.unloadVectorData(),i.aborted||i.loadVectorData(d,this.map.painter,o==="RT")})}abortTile(i){return l._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.aborted=!0})}unloadTile(i){return l._(this,void 0,void 0,function*(){i.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Pt=l.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class qt extends l.E{constructor(i,o,u,d){super(),this.id=i,this.dispatcher=u,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=o}load(i){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const o=yield ut.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,o&&o.data&&(this.image=o.data,i&&(this.coordinates=i),this._finishLoading())}catch(o){this._request=null,this._loaded=!0,this.fire(new l.j(o))}})}loaded(){return this._loaded}updateImage(i){return i.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=i.url,this.load(i.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(i){this.coordinates=i;const o=i.map(l.Y.fromLngLat);this.tileID=function(d){let y=1/0,w=1/0,M=-1/0,A=-1/0;for(const V of d)y=Math.min(y,V.x),w=Math.min(w,V.y),M=Math.max(M,V.x),A=Math.max(A,V.y);const C=Math.max(M-y,A-w),z=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),O=Math.pow(2,z);return new l.a0(z,Math.floor((y+M)/2*O),Math.floor((w+A)/2*O))}(o),this.minzoom=this.maxzoom=this.tileID.z;const u=o.map(d=>this.tileID.getTilePoint(d)._round());return this._boundsArray=new l.Z,this._boundsArray.emplaceBack(u[0].x,u[0].y,0,0),this._boundsArray.emplaceBack(u[1].x,u[1].y,l.W,0),this._boundsArray.emplaceBack(u[3].x,u[3].y,0,l.W),this._boundsArray.emplaceBack(u[2].x,u[2].y,l.W,l.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const i=this.map.painter.context,o=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,Pt.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new xe(i,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let u=!1;for(const d in this.tiles){const y=this.tiles[d];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,u=!0)}u&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(i){return l._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={}):i.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Vt extends qt{constructor(i,o,u,d){super(i,o,u,d),this.roundZoom=!0,this.type="video",this.options=o}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1;const i=this.options;this.urls=[];for(const o of i.urls)this.urls.push(this.map._requestManager.transformRequest(o,"Source").url);try{const o=yield l.a2(this.urls);if(this._loaded=!0,!o)return;this.video=o,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(o){this.fire(new l.j(o))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(i){if(this.video){const o=this.video.seekable;i<o.start(0)||i>o.end(0)?this.fire(new l.j(new l.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=i}}getVideo(){return this.video}onAdd(i){this.map||(this.map=i,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const i=this.map.painter.context,o=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,Pt.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new xe(i,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let u=!1;for(const d in this.tiles){const y=this.tiles[d];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,u=!0)}u&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ue extends qt{constructor(i,o,u,d){super(i,o,u,d),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(w=>typeof w!="number"))||this.fire(new l.j(new l.a1(`sources.${i}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.j(new l.a1(`sources.${i}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new l.j(new l.a1(`sources.${i}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new l.j(new l.a1(`sources.${i}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.j(new l.a1(`sources.${i}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){return l._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(i){this.map=i,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let i=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,i=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,i=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context,u=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Pt.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture?(i||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new xe(o,this.canvas,u.RGBA,{premultiply:!0});let d=!1;for(const y in this.tiles){const w=this.tiles[y];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,d=!0)}d&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const i of[this.canvas.width,this.canvas.height])if(isNaN(i)||i<=0)return!0;return!1}}const Ee={},we=g=>{switch(g){case"geojson":return ne;case"image":return qt;case"raster":return it;case"raster-dem":return Xt;case"vector":return Ft;case"video":return Vt;case"canvas":return ue}return Ee[g]},De="RTLPluginLoaded";class Xe extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=re()}_syncState(i){return this.status=i,this.dispatcher.broadcast("SRPS",{pluginStatus:i,pluginURL:this.url}).catch(o=>{throw this.status="error",o})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(i){return l._(this,arguments,void 0,function*(o,u=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=P.resolveURL(o),!this.url)throw new Error(`requested url ${o} is invalid`);if(this.status==="unavailable"){if(!u)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return l._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.k(De))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let ii=null;function Rt(){return ii||(ii=new Xe),ii}class gi{constructor(i,o){this.timeAdded=0,this.fadeEndTime=0,this.tileID=i,this.uid=l.a3(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(i){const o=i+this.timeAdded;o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(i){this.demTexture&&i.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(i,o,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(d,y){const w={};if(!y)return w;for(const M of d){const A=M.layerIds.map(C=>y.getLayer(C)).filter(Boolean);if(A.length!==0){M.layers=A,M.stateDependentLayerIds&&(M.stateDependentLayers=M.stateDependentLayerIds.map(C=>A.filter(z=>z.id===C)[0]));for(const C of A)w[C.id]=M}}return w}(i.buckets,o.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const y=this.buckets[d];if(y instanceof l.a5){if(this.hasSymbolBuckets=!0,!u)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const y=this.buckets[d];if(y instanceof l.a5&&y.hasRTLText){this.hasRTLText=!0,Rt().lazyLoad();break}}this.queryPadding=0;for(const d in this.buckets){const y=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(d).queryRadius(y))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage)}else this.collisionBoxArray=new l.a4}unloadVectorData(){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(i){return this.buckets[i.id]}upload(i){for(const u in this.buckets){const d=this.buckets[u];d.uploadPending()&&d.upload(i)}const o=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new xe(i,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new xe(i,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,o,u,d,y,w,M,A,C,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:y,scale:w,tileSize:this.tileSize,pixelPosMatrix:z,transform:A,params:M,queryPadding:this.queryPadding*C},i,o,u):{}}querySourceFeatures(i,o){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const d=u.loadVTLayers(),y=o&&o.sourceLayer?o.sourceLayer:"",w=d._geojsonTileLayer||d[y];if(!w)return;const M=l.a6(o&&o.filter),{z:A,x:C,y:z}=this.tileID.canonical,O={z:A,x:C,y:z};for(let V=0;V<w.length;V++){const Z=w.feature(V);if(M.needGeometry){const j=l.a7(Z,!0);if(!M.filter(new l.a8(this.tileID.overscaledZ),j,this.tileID.canonical))continue}else if(!M.filter(new l.a8(this.tileID.overscaledZ),Z))continue;const W=u.getId(Z,y),J=new l.a9(Z,A,C,z,W);J.tile=O,i.push(J)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const o=this.expirationTime;if(i.cacheControl){const u=l.aa(i.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const u=Date.now();let d=!1;if(this.expirationTime>u)d=!1;else if(o)if(this.expirationTime<o)d=!0;else{const y=this.expirationTime-o;y?this.expirationTime=u+Math.max(y,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(i,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(i).length===0)return;const u=this.latestFeatureIndex.loadVTLayers();for(const d in this.buckets){if(!o.style.hasLayer(d))continue;const y=this.buckets[d],w=y.layers[0].sourceLayer||"_geojsonTileLayer",M=u[w],A=i[w];if(!M||!A||Object.keys(A).length===0)continue;y.update(A,M,this.imageAtlas&&this.imageAtlas.patternPositions||{});const C=o&&o.style&&o.style.getLayer(d);C&&(this.queryPadding=Math.max(this.queryPadding,C.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<P.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=P.now()+i}setDependencies(i,o){const u={};for(const d of o)u[d]=!0;this.dependencies[i]=u}hasDependency(i,o){for(const u of i){const d=this.dependencies[u];if(d){for(const y of o)if(d[y])return!0}}return!1}}class Ci{constructor(i,o){this.max=i,this.onRemove=o,this.reset()}reset(){for(const i in this.data)for(const o of this.data[i])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(i,o,u){const d=i.wrapped().key;this.data[d]===void 0&&(this.data[d]=[]);const y={value:o,timeout:void 0};if(u!==void 0&&(y.timeout=setTimeout(()=>{this.remove(i,y)},u)),this.data[d].push(y),this.order.push(d),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const o=this.data[i].shift();return o.timeout&&clearTimeout(o.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),o.value}getByKey(i){const o=this.data[i];return o?o[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,o){if(!this.has(i))return this;const u=i.wrapped().key,d=o===void 0?0:this.data[u].indexOf(o),y=this.data[u][d];return this.data[u].splice(d,1),y.timeout&&clearTimeout(y.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(y.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(i){const o=[];for(const u in this.data)for(const d of this.data[u])i(d.value)||o.push(d);for(const u of o)this.remove(u.value.tileID,u)}}class pr{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,o,u){const d=String(o);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][d]=this.stateChanges[i][d]||{},l.e(this.stateChanges[i][d],u),this.deletedStates[i]===null){this.deletedStates[i]={};for(const y in this.state[i])y!==d&&(this.deletedStates[i][y]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][d]===null){this.deletedStates[i][d]={};for(const y in this.state[i][d])u[y]||(this.deletedStates[i][d][y]=null)}else for(const y in u)this.deletedStates[i]&&this.deletedStates[i][d]&&this.deletedStates[i][d][y]===null&&delete this.deletedStates[i][d][y]}removeFeatureState(i,o,u){if(this.deletedStates[i]===null)return;const d=String(o);if(this.deletedStates[i]=this.deletedStates[i]||{},u&&o!==void 0)this.deletedStates[i][d]!==null&&(this.deletedStates[i][d]=this.deletedStates[i][d]||{},this.deletedStates[i][d][u]=null);else if(o!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][d])for(u in this.deletedStates[i][d]={},this.stateChanges[i][d])this.deletedStates[i][d][u]=null;else this.deletedStates[i][d]=null;else this.deletedStates[i]=null}getState(i,o){const u=String(o),d=l.e({},(this.state[i]||{})[u],(this.stateChanges[i]||{})[u]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){const y=this.deletedStates[i][o];if(y===null)return{};for(const w in y)delete d[w]}return d}initializeTileState(i,o){i.setFeatureState(this.state,o)}coalesceChanges(i,o){const u={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const y={};for(const w in this.stateChanges[d])this.state[d][w]||(this.state[d][w]={}),l.e(this.state[d][w],this.stateChanges[d][w]),y[w]=this.state[d][w];u[d]=y}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const y={};if(this.deletedStates[d]===null)for(const w in this.state[d])y[w]={},this.state[d][w]={};else for(const w in this.deletedStates[d]){if(this.deletedStates[d][w]===null)this.state[d][w]={};else for(const M of Object.keys(this.deletedStates[d][w]))delete this.state[d][w][M];y[w]=this.state[d][w]}u[d]=u[d]||{},l.e(u[d],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const d in i)i[d].setFeatureState(u,o)}}class as extends l.E{constructor(i,o,u){super(),this.id=i,this.dispatcher=u,this.on("data",d=>this._dataHandler(d)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((d,y,w,M)=>{const A=new(we(y.type))(d,y,w,M);if(A.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${A.id}`);return A})(i,o,u,this),this._tiles={},this._cache=new Ci(0,d=>this._unloadTile(d)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new pr,this._didEmitContent=!1,this._updated=!1}onAdd(i){this.map=i,this._maxTileCacheSize=i?i._maxTileCacheSize:null,this._maxTileCacheZoomLevels=i?i._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(i)}onRemove(i){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(i)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const i in this._tiles){const o=this._tiles[i];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(i,o,u){return l._(this,void 0,void 0,function*(){try{yield this._source.loadTile(i),this._tileLoaded(i,o,u)}catch(d){i.state="errored",d.status!==404?this._source.fire(new l.j(d,{tile:i})):this.update(this.transform,this.terrain)}})}_unloadTile(i){this._source.unloadTile&&this._source.unloadTile(i)}_abortTile(i){this._source.abortTile&&this._source.abortTile(i),this._source.fire(new l.k("dataabort",{tile:i,coord:i.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const u=this._tiles[o];u.upload(i),u.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(i=>i.tileID).sort(Gt).map(i=>i.key)}getRenderableIds(i){const o=[];for(const u in this._tiles)this._isIdRenderable(u,i)&&o.push(this._tiles[u]);return i?o.sort((u,d)=>{const y=u.tileID,w=d.tileID,M=new l.P(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),A=new l.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-w.overscaledZ||A.y-M.y||A.x-M.x}).map(u=>u.tileID.key):o.map(u=>u.tileID).sort(Gt).map(u=>u.key)}hasRenderableParent(i){const o=this.findLoadedParent(i,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(i,o){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(o||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(i,"reloading")}}_reloadTile(i,o){return l._(this,void 0,void 0,function*(){const u=this._tiles[i];u&&(u.state!=="loading"&&(u.state=o),yield this._loadTile(u,i,o))})}_tileLoaded(i,o,u){i.timeAdded=P.now(),u==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(o,i),this.getSource().type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),i.aborted||this._source.fire(new l.k("data",{dataType:"source",tile:i,coord:i.tileID}))}_backfillDEM(i){const o=this.getRenderableIds();for(let d=0;d<o.length;d++){const y=o[d];if(i.neighboringTiles&&i.neighboringTiles[y]){const w=this.getTileByID(y);u(i,w),u(w,i)}}function u(d,y){d.needsHillshadePrepare=!0,d.needsTerrainPrepare=!0;let w=y.tileID.canonical.x-d.tileID.canonical.x;const M=y.tileID.canonical.y-d.tileID.canonical.y,A=Math.pow(2,d.tileID.canonical.z),C=y.tileID.key;w===0&&M===0||Math.abs(M)>1||(Math.abs(w)>1&&(Math.abs(w+A)===1?w+=A:Math.abs(w-A)===1&&(w-=A)),y.dem&&d.dem&&(d.dem.backfillBorder(y.dem,w,M),d.neighboringTiles&&d.neighboringTiles[C]&&(d.neighboringTiles[C].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,o,u,d){for(const y in this._tiles){let w=this._tiles[y];if(d[y]||!w.hasData()||w.tileID.overscaledZ<=o||w.tileID.overscaledZ>u)continue;let M=w.tileID;for(;w&&w.tileID.overscaledZ>o+1;){const C=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[C.key],w&&w.hasData()&&(M=C)}let A=M;for(;A.overscaledZ>o;)if(A=A.scaledTo(A.overscaledZ-1),i[A.key]){d[M.key]=M;break}}}findLoadedParent(i,o){if(i.key in this._loadedParentTiles){const u=this._loadedParentTiles[i.key];return u&&u.tileID.overscaledZ>=o?u:null}for(let u=i.overscaledZ-1;u>=o;u--){const d=i.scaledTo(u),y=this._getLoadedTile(d);if(y)return y}}_getLoadedTile(i){const o=this._tiles[i.key];return o&&o.hasData()?o:this._cache.getByKey(i.wrapped().key)}updateCacheSize(i){const o=Math.ceil(i.width/this._source.tileSize)+1,u=Math.ceil(i.height/this._source.tileSize)+1,d=Math.floor(o*u*(this._maxTileCacheZoomLevels===null?l.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(y)}handleWrapJump(i){const o=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,o){const u={};for(const d in this._tiles){const y=this._tiles[d];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+o),u[y.tileID.key]=y}this._tiles=u;for(const d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(const d in this._tiles)this._setTileReloadTimer(d,this._tiles[d])}}update(i,o){if(!this._sourceLoaded||this._paused)return;let u;this.transform=i,this.terrain=o,this.updateCacheSize(i),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(z=>new l.Q(z.canonical.z,z.wrap,z.canonical.z,z.canonical.x,z.canonical.y)):(u=i.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:o}),this._source.hasTile&&(u=u.filter(z=>this._source.hasTile(z)))):u=[];const d=i.coveringZoomLevel(this._source),y=Math.max(d-as.maxOverzooming,this._source.minzoom),w=Math.max(d+as.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const z={};for(const O of u)if(O.canonical.z>this._source.minzoom){const V=O.scaledTo(O.canonical.z-1);z[V.key]=V;const Z=O.scaledTo(Math.max(this._source.minzoom,Math.min(O.canonical.z,5)));z[Z.key]=Z}u=u.concat(Object.values(z))}const M=u.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,M&&this.fire(new l.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const A=this._updateRetainedTiles(u,d);if(Oe(this._source.type)){const z={},O={},V=Object.keys(A),Z=P.now();for(const W of V){const J=A[W],j=this._tiles[W];if(!j||j.fadeEndTime!==0&&j.fadeEndTime<=Z)continue;const ot=this.findLoadedParent(J,y);ot&&(this._addTile(ot.tileID),z[ot.tileID.key]=ot.tileID),O[W]=J}this._retainLoadedChildren(O,d,w,A);for(const W in z)A[W]||(this._coveredTiles[W]=!0,A[W]=z[W]);if(o){const W={},J={};for(const j of u)this._tiles[j.key].hasData()?W[j.key]=j:J[j.key]=j;for(const j in J){const ot=J[j].children(this._source.maxzoom);this._tiles[ot[0].key]&&this._tiles[ot[1].key]&&this._tiles[ot[2].key]&&this._tiles[ot[3].key]&&(W[ot[0].key]=A[ot[0].key]=ot[0],W[ot[1].key]=A[ot[1].key]=ot[1],W[ot[2].key]=A[ot[2].key]=ot[2],W[ot[3].key]=A[ot[3].key]=ot[3],delete J[j])}for(const j in J){const ot=this.findLoadedParent(J[j],this._source.minzoom);if(ot){W[ot.tileID.key]=A[ot.tileID.key]=ot.tileID;for(const xt in W)W[xt].isChildOf(ot.tileID)&&delete W[xt]}}for(const j in this._tiles)W[j]||(this._coveredTiles[j]=!0)}}for(const z in A)this._tiles[z].clearFadeHold();const C=l.ab(this._tiles,A);for(const z of C){const O=this._tiles[z];O.hasSymbolBuckets&&!O.holdingForFade()?O.setHoldDuration(this.map._fadeDuration):O.hasSymbolBuckets&&!O.symbolFadeFinished()||this._removeTile(z)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(i)}_updateRetainedTiles(i,o){const u={},d={},y=Math.max(o-as.maxOverzooming,this._source.minzoom),w=Math.max(o+as.maxUnderzooming,this._source.minzoom),M={};for(const A of i){const C=this._addTile(A);u[A.key]=A,C.hasData()||o<this._source.maxzoom&&(M[A.key]=A)}this._retainLoadedChildren(M,o,w,u);for(const A of i){let C=this._tiles[A.key];if(C.hasData())continue;if(o+1>this._source.maxzoom){const O=A.children(this._source.maxzoom)[0],V=this.getTile(O);if(V&&V.hasData()){u[O.key]=O;continue}}else{const O=A.children(this._source.maxzoom);if(u[O[0].key]&&u[O[1].key]&&u[O[2].key]&&u[O[3].key])continue}let z=C.wasRequested();for(let O=A.overscaledZ-1;O>=y;--O){const V=A.scaledTo(O);if(d[V.key])break;if(d[V.key]=!0,C=this.getTile(V),!C&&z&&(C=this._addTile(V)),C){const Z=C.hasData();if((z||Z)&&(u[V.key]=V),z=C.wasRequested(),Z)break}}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const o=[];let u,d=this._tiles[i].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){u=this._loadedParentTiles[d.key];break}o.push(d.key);const y=d.scaledTo(d.overscaledZ-1);if(u=this._getLoadedTile(y),u)break;d=y}for(const y of o)this._loadedParentTiles[y]=u}}_addTile(i){let o=this._tiles[i.key];if(o)return o;o=this._cache.getAndRemove(i),o&&(this._setTileReloadTimer(i.key,o),o.tileID=i,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,o)));const u=o;return o||(o=new gi(i,this._source.tileSize*i.overscaleFactor()),this._loadTile(o,i.key,o.state)),o.uses++,this._tiles[i.key]=o,u||this._source.fire(new l.k("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o}_setTileReloadTimer(i,o){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const u=o.getExpiryTimeout();u&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},u))}_removeTile(i){const o=this._tiles[i];o&&(o.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),o.uses>0||(o.hasData()&&o.state!=="reloading"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}_dataHandler(i){const o=i.sourceDataType;i.dataType==="source"&&o==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&i.dataType==="source"&&o==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(i);this._cache.reset()}tilesIn(i,o,u){const d=[],y=this.transform;if(!y)return d;const w=u?y.getCameraQueryGeometry(i):i,M=i.map(W=>y.pointCoordinate(W,this.terrain)),A=w.map(W=>y.pointCoordinate(W,this.terrain)),C=this.getIds();let z=1/0,O=1/0,V=-1/0,Z=-1/0;for(const W of A)z=Math.min(z,W.x),O=Math.min(O,W.y),V=Math.max(V,W.x),Z=Math.max(Z,W.y);for(let W=0;W<C.length;W++){const J=this._tiles[C[W]];if(J.holdingForFade())continue;const j=J.tileID,ot=Math.pow(2,y.zoom-J.tileID.overscaledZ),xt=o*J.queryPadding*l.W/J.tileSize/ot,et=[j.getTilePoint(new l.Y(z,O)),j.getTilePoint(new l.Y(V,Z))];if(et[0].x-xt<l.W&&et[0].y-xt<l.W&&et[1].x+xt>=0&&et[1].y+xt>=0){const pt=M.map(wt=>j.getTilePoint(wt)),bt=A.map(wt=>j.getTilePoint(wt));d.push({tile:J,tileID:j,queryGeometry:pt,cameraQueryGeometry:bt,scale:ot})}}return d}getVisibleCoordinates(i){const o=this.getRenderableIds(i).map(u=>this._tiles[u].tileID);for(const u of o)u.posMatrix=this.transform.calculatePosMatrix(u.toUnwrapped());return o}hasTransition(){if(this._source.hasTransition())return!0;if(Oe(this._source.type)){const i=P.now();for(const o in this._tiles)if(this._tiles[o].fadeEndTime>=i)return!0}return!1}setFeatureState(i,o,u){this._state.updateState(i=i||"_geojsonTileLayer",o,u)}removeFeatureState(i,o,u){this._state.removeFeatureState(i=i||"_geojsonTileLayer",o,u)}getFeatureState(i,o){return this._state.getState(i=i||"_geojsonTileLayer",o)}setDependencies(i,o,u){const d=this._tiles[i];d&&d.setDependencies(o,u)}reloadTilesForDependencies(i,o){for(const u in this._tiles)this._tiles[u].hasDependency(i,o)&&this._reloadTile(u,"reloading");this._cache.filter(u=>!u.hasDependency(i,o))}}function Gt(g,i){const o=Math.abs(2*g.wrap)-+(g.wrap<0),u=Math.abs(2*i.wrap)-+(i.wrap<0);return g.overscaledZ-i.overscaledZ||u-o||i.canonical.y-g.canonical.y||i.canonical.x-g.canonical.x}function Oe(g){return g==="raster"||g==="image"||g==="video"}as.maxOverzooming=10,as.maxUnderzooming=3;class Se{constructor(i,o){this.reset(i,o)}reset(i,o){this.points=i||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=l.ac(i,0,1);let o=1,u=this._distances[o];const d=i*this.paddedLength+this.padding;for(;u<d&&o<this._distances.length;)u=this._distances[++o];const y=o-1,w=this._distances[y],M=u-w,A=M>0?(d-w)/M:0;return this.points[y].mult(1-A).add(this.points[o].mult(A))}}function ui(g,i){let o=!0;return g==="always"||g!=="never"&&i!=="never"||(o=!1),o}class tr{constructor(i,o,u){const d=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(i/u),this.yCellCount=Math.ceil(o/u);for(let w=0;w<this.xCellCount*this.yCellCount;w++)d.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=o,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,o,u,d,y){this._forEachCell(o,u,d,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(d),this.bboxes.push(y)}insertCircle(i,o,u,d){this._forEachCell(o-d,u-d,o+d,u+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(o),this.circles.push(u),this.circles.push(d)}_insertBoxCell(i,o,u,d,y,w){this.boxCells[y].push(w)}_insertCircleCell(i,o,u,d,y,w){this.circleCells[y].push(w)}_query(i,o,u,d,y,w,M){if(u<0||i>this.width||d<0||o>this.height)return[];const A=[];if(i<=0&&o<=0&&this.width<=u&&this.height<=d){if(y)return[{key:null,x1:i,y1:o,x2:u,y2:d}];for(let C=0;C<this.boxKeys.length;C++)A.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const z=this.circles[3*C],O=this.circles[3*C+1],V=this.circles[3*C+2];A.push({key:this.circleKeys[C],x1:z-V,y1:O-V,x2:z+V,y2:O+V})}}else this._forEachCell(i,o,u,d,this._queryCell,A,{hitTest:y,overlapMode:w,seenUids:{box:{},circle:{}}},M);return A}query(i,o,u,d){return this._query(i,o,u,d,!1,null)}hitTest(i,o,u,d,y,w){return this._query(i,o,u,d,!0,y,w).length>0}hitTestCircle(i,o,u,d,y){const w=i-u,M=i+u,A=o-u,C=o+u;if(M<0||w>this.width||C<0||A>this.height)return!1;const z=[];return this._forEachCell(w,A,M,C,this._queryCellCircle,z,{hitTest:!0,overlapMode:d,circle:{x:i,y:o,radius:u},seenUids:{box:{},circle:{}}},y),z.length>0}_queryCell(i,o,u,d,y,w,M,A){const{seenUids:C,hitTest:z,overlapMode:O}=M,V=this.boxCells[y];if(V!==null){const W=this.bboxes;for(const J of V)if(!C.box[J]){C.box[J]=!0;const j=4*J,ot=this.boxKeys[J];if(i<=W[j+2]&&o<=W[j+3]&&u>=W[j+0]&&d>=W[j+1]&&(!A||A(ot))&&(!z||!ui(O,ot.overlapMode))&&(w.push({key:ot,x1:W[j],y1:W[j+1],x2:W[j+2],y2:W[j+3]}),z))return!0}}const Z=this.circleCells[y];if(Z!==null){const W=this.circles;for(const J of Z)if(!C.circle[J]){C.circle[J]=!0;const j=3*J,ot=this.circleKeys[J];if(this._circleAndRectCollide(W[j],W[j+1],W[j+2],i,o,u,d)&&(!A||A(ot))&&(!z||!ui(O,ot.overlapMode))){const xt=W[j],et=W[j+1],pt=W[j+2];if(w.push({key:ot,x1:xt-pt,y1:et-pt,x2:xt+pt,y2:et+pt}),z)return!0}}}return!1}_queryCellCircle(i,o,u,d,y,w,M,A){const{circle:C,seenUids:z,overlapMode:O}=M,V=this.boxCells[y];if(V!==null){const W=this.bboxes;for(const J of V)if(!z.box[J]){z.box[J]=!0;const j=4*J,ot=this.boxKeys[J];if(this._circleAndRectCollide(C.x,C.y,C.radius,W[j+0],W[j+1],W[j+2],W[j+3])&&(!A||A(ot))&&!ui(O,ot.overlapMode))return w.push(!0),!0}}const Z=this.circleCells[y];if(Z!==null){const W=this.circles;for(const J of Z)if(!z.circle[J]){z.circle[J]=!0;const j=3*J,ot=this.circleKeys[J];if(this._circlesCollide(W[j],W[j+1],W[j+2],C.x,C.y,C.radius)&&(!A||A(ot))&&!ui(O,ot.overlapMode))return w.push(!0),!0}}}_forEachCell(i,o,u,d,y,w,M,A){const C=this._convertToXCellCoord(i),z=this._convertToYCellCoord(o),O=this._convertToXCellCoord(u),V=this._convertToYCellCoord(d);for(let Z=C;Z<=O;Z++)for(let W=z;W<=V;W++)if(y.call(this,i,o,u,d,this.xCellCount*W+Z,w,M,A))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,o,u,d,y,w){const M=d-i,A=y-o,C=u+w;return C*C>M*M+A*A}_circleAndRectCollide(i,o,u,d,y,w,M){const A=(w-d)/2,C=Math.abs(i-(d+A));if(C>A+u)return!1;const z=(M-y)/2,O=Math.abs(o-(y+z));if(O>z+u)return!1;if(C<=A||O<=z)return!0;const V=C-A,Z=O-z;return V*V+Z*Z<=u*u}}function Be(g,i,o,u,d){const y=l.F();return i?(l.J(y,y,[1/d,1/d,1]),o||l.ad(y,y,u.angle)):l.K(y,u.labelPlaneMatrix,g),y}function Rn(g,i,o,u,d){if(i){const y=l.ae(g);return l.J(y,y,[d,d,1]),o||l.ad(y,y,-u.angle),y}return u.glCoordMatrix}function os(g,i,o){let u;o?(u=[g.x,g.y,o(g.x,g.y),1],l.af(u,u,i)):(u=[g.x,g.y,0,1],be(u,u,i));const d=u[3];return{point:new l.P(u[0]/d,u[1]/d),signedDistanceFromCamera:d}}function Y(g,i){return .5+g/i*.5}function F(g,i){const o=g[0]/g[3],u=g[1]/g[3];return o>=-i[0]&&o<=i[0]&&u>=-i[1]&&u<=i[1]}function N(g,i,o,u,d,y,w,M,A,C){const z=u?g.textSizeData:g.iconSizeData,O=l.ag(z,o.transform.zoom),V=[256/o.width*2+1,256/o.height*2+1],Z=u?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;Z.clear();const W=g.lineVertexArray,J=u?g.text.placedSymbolArray:g.icon.placedSymbolArray,j=o.transform.width/o.transform.height;let ot=!1;for(let xt=0;xt<J.length;xt++){const et=J.get(xt);if(et.hidden||et.writingMode===l.ah.vertical&&!ot){It(et.numGlyphs,Z);continue}let pt;if(ot=!1,C?(pt=[et.anchorX,et.anchorY,C(et.anchorX,et.anchorY),1],l.af(pt,pt,i)):(pt=[et.anchorX,et.anchorY,0,1],be(pt,pt,i)),!F(pt,V)){It(et.numGlyphs,Z);continue}const bt=Y(o.transform.cameraToCenterDistance,pt[3]),wt=l.ai(z,O,et),St=w?wt/bt:wt*bt,Bt=new l.P(et.anchorX,et.anchorY),Lt=os(Bt,d,C).point,jt={projections:{},offsets:{}},Wt=ht(et,St,!1,M,i,d,y,g.glyphOffsetArray,W,Z,Lt,Bt,jt,j,A,C);ot=Wt.useVertical,(Wt.notEnoughRoom||ot||Wt.needsFlipping&&ht(et,St,!0,M,i,d,y,g.glyphOffsetArray,W,Z,Lt,Bt,jt,j,A,C).notEnoughRoom)&&It(et.numGlyphs,Z)}u?g.text.dynamicLayoutVertexBuffer.updateData(Z):g.icon.dynamicLayoutVertexBuffer.updateData(Z)}function q(g,i,o,u,d,y,w,M,A,C,z,O,V){const Z=M.glyphStartIndex+M.numGlyphs,W=M.lineStartIndex,J=M.lineStartIndex+M.lineLength,j=i.getoffsetX(M.glyphStartIndex),ot=i.getoffsetX(Z-1),xt=zt(g*j,o,u,d,y,w,M.segment,W,J,A,C,z,O,V);if(!xt)return null;const et=zt(g*ot,o,u,d,y,w,M.segment,W,J,A,C,z,O,V);return et?{first:xt,last:et}:null}function H(g,i,o,u){return g===l.ah.horizontal&&Math.abs(o.y-i.y)>Math.abs(o.x-i.x)*u?{useVertical:!0}:(g===l.ah.vertical?i.y<o.y:i.x>o.x)?{needsFlipping:!0}:null}function ht(g,i,o,u,d,y,w,M,A,C,z,O,V,Z,W,J){const j=i/24,ot=g.lineOffsetX*j,xt=g.lineOffsetY*j;let et;if(g.numGlyphs>1){const pt=g.glyphStartIndex+g.numGlyphs,bt=g.lineStartIndex,wt=g.lineStartIndex+g.lineLength,St=q(j,M,ot,xt,o,z,O,g,A,y,V,W,J);if(!St)return{notEnoughRoom:!0};const Bt=os(St.first.point,w,J).point,Lt=os(St.last.point,w,J).point;if(u&&!o){const jt=H(g.writingMode,Bt,Lt,Z);if(jt)return jt}et=[St.first];for(let jt=g.glyphStartIndex+1;jt<pt-1;jt++)et.push(zt(j*M.getoffsetX(jt),ot,xt,o,z,O,g.segment,bt,wt,A,y,V,W,J));et.push(St.last)}else{if(u&&!o){const bt=os(O,d,J).point,wt=g.lineStartIndex+g.segment+1,St=new l.P(A.getx(wt),A.gety(wt)),Bt=os(St,d,J),Lt=Bt.signedDistanceFromCamera>0?Bt.point:dt(O,St,bt,1,d,J),jt=H(g.writingMode,bt,Lt,Z);if(jt)return jt}const pt=zt(j*M.getoffsetX(g.glyphStartIndex),ot,xt,o,z,O,g.segment,g.lineStartIndex,g.lineStartIndex+g.lineLength,A,y,V,W,J);if(!pt)return{notEnoughRoom:!0};et=[pt]}for(const pt of et)l.aj(C,pt.point,pt.angle);return{}}function dt(g,i,o,u,d,y){const w=os(g.add(g.sub(i)._unit()),d,y).point,M=o.sub(w);return o.add(M._mult(u/M.mag()))}function mt(g,i){const{projectionCache:o,lineVertexArray:u,labelPlaneMatrix:d,tileAnchorPoint:y,distanceFromAnchor:w,getElevation:M,previousVertex:A,direction:C,absOffsetX:z}=i;if(o.projections[g])return o.projections[g];const O=new l.P(u.getx(g),u.gety(g)),V=os(O,d,M);if(V.signedDistanceFromCamera>0)return o.projections[g]=V.point,V.point;const Z=g-C;return dt(w===0?y:new l.P(u.getx(Z),u.gety(Z)),O,A,z-w+1,d,M)}function at(g,i,o){return g._unit()._perp()._mult(i*o)}function _t(g,i,o,u,d,y,w,M){const{projectionCache:A,direction:C}=M;if(A.offsets[g])return A.offsets[g];const z=o.add(i);if(g+C<u||g+C>=d)return A.offsets[g]=z,z;const O=mt(g+C,M),V=at(O.sub(o),w,C),Z=o.add(V),W=O.add(V);return A.offsets[g]=l.ak(y,z,Z,W)||z,A.offsets[g]}function zt(g,i,o,u,d,y,w,M,A,C,z,O,V,Z){const W=u?g-i:g+i;let J=W>0?1:-1,j=0;u&&(J*=-1,j=Math.PI),J<0&&(j+=Math.PI);let ot,xt,et=J>0?M+w:M+w+1,pt=d,bt=d,wt=0,St=0;const Bt=Math.abs(W),Lt=[];let jt;for(;wt+St<=Bt;){if(et+=J,et<M||et>=A)return null;wt+=St,bt=pt,xt=ot;const Kt={projectionCache:O,lineVertexArray:C,labelPlaneMatrix:z,tileAnchorPoint:y,distanceFromAnchor:wt,getElevation:Z,previousVertex:bt,direction:J,absOffsetX:Bt};if(pt=mt(et,Kt),o===0)Lt.push(bt),jt=pt.sub(bt);else{let Ie;const Ve=pt.sub(bt);Ie=Ve.mag()===0?at(mt(et+J,Kt).sub(pt),o,J):at(Ve,o,J),xt||(xt=bt.add(Ie)),ot=_t(et,Ie,pt,M,A,xt,o,Kt),Lt.push(xt),jt=ot.sub(xt)}St=jt.mag()}const Wt=jt._mult((Bt-wt)/St)._add(xt||bt),$e=j+Math.atan2(pt.y-bt.y,pt.x-bt.x);return Lt.push(Wt),{point:Wt,angle:V?$e:0,path:Lt}}const Et=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function It(g,i){for(let o=0;o<g;o++){const u=i.length;i.resize(u+4),i.float32.set(Et,3*u)}}function be(g,i,o){const u=i[0],d=i[1];return g[0]=o[0]*u+o[4]*d+o[12],g[1]=o[1]*u+o[5]*d+o[13],g[3]=o[3]*u+o[7]*d+o[15],g}const Te=100;class Ne{constructor(i,o=new tr(i.width+200,i.height+200,25),u=new tr(i.width+200,i.height+200,25)){this.transform=i,this.grid=o,this.ignoredGrid=u,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Te,this.screenBottomBoundary=i.height+Te,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(i,o,u,d,y,w){const M=this.projectAndGetPerspectiveRatio(d,i.anchorPointX,i.anchorPointY,w),A=u*M.perspectiveRatio,C=i.x1*A+M.point.x,z=i.y1*A+M.point.y,O=i.x2*A+M.point.x,V=i.y2*A+M.point.y;return!this.isInsideGrid(C,z,O,V)||o!=="always"&&this.grid.hitTest(C,z,O,V,o,y)||M.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[C,z,O,V],offscreen:this.isOffscreen(C,z,O,V)}}placeCollisionCircles(i,o,u,d,y,w,M,A,C,z,O,V,Z,W){const J=[],j=new l.P(o.anchorX,o.anchorY),ot=os(j,w,W),xt=Y(this.transform.cameraToCenterDistance,ot.signedDistanceFromCamera),et=(z?y/xt:y*xt)/l.ao,pt=os(j,M,W).point,bt=q(et,d,o.lineOffsetX*et,o.lineOffsetY*et,!1,pt,j,o,u,M,{projections:{},offsets:{}},!1,W);let wt=!1,St=!1,Bt=!0;if(bt){const Lt=.5*V*xt+Z,jt=new l.P(-100,-100),Wt=new l.P(this.screenRightBoundary,this.screenBottomBoundary),$e=new Se,Kt=bt.first,Ie=bt.last;let Ve=[];for(let je=Kt.path.length-1;je>=1;je--)Ve.push(Kt.path[je]);for(let je=1;je<Ie.path.length;je++)Ve.push(Ie.path[je]);const ei=2.5*Lt;if(A){const je=Ve.map(He=>os(He,A,W));Ve=je.some(He=>He.signedDistanceFromCamera<=0)?[]:je.map(He=>He.point)}let ke=[];if(Ve.length>0){const je=Ve[0].clone(),He=Ve[0].clone();for(let qi=1;qi<Ve.length;qi++)je.x=Math.min(je.x,Ve[qi].x),je.y=Math.min(je.y,Ve[qi].y),He.x=Math.max(He.x,Ve[qi].x),He.y=Math.max(He.y,Ve[qi].y);ke=je.x>=jt.x&&He.x<=Wt.x&&je.y>=jt.y&&He.y<=Wt.y?[Ve]:He.x<jt.x||je.x>Wt.x||He.y<jt.y||je.y>Wt.y?[]:l.al([Ve],jt.x,jt.y,Wt.x,Wt.y)}for(const je of ke){$e.reset(je,.25*Lt);let He=0;He=$e.length<=.5*Lt?1:Math.ceil($e.paddedLength/ei)+1;for(let qi=0;qi<He;qi++){const mi=qi/Math.max(He-1,1),rr=$e.lerp(mi),cs=rr.x+Te,Fi=rr.y+Te;J.push(cs,Fi,Lt,0);const hs=cs-Lt,nr=Fi-Lt,Vr=cs+Lt,_n=Fi+Lt;if(Bt=Bt&&this.isOffscreen(hs,nr,Vr,_n),St=St||this.isInsideGrid(hs,nr,Vr,_n),i!=="always"&&this.grid.hitTestCircle(cs,Fi,Lt,i,O)&&(wt=!0,!C))return{circles:[],offscreen:!1,collisionDetected:wt}}}}return{circles:!C&&wt||!St||xt<this.perspectiveRatioCutoff?[]:J,offscreen:Bt,collisionDetected:wt}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let u=1/0,d=1/0,y=-1/0,w=-1/0;for(const z of i){const O=new l.P(z.x+Te,z.y+Te);u=Math.min(u,O.x),d=Math.min(d,O.y),y=Math.max(y,O.x),w=Math.max(w,O.y),o.push(O)}const M=this.grid.query(u,d,y,w).concat(this.ignoredGrid.query(u,d,y,w)),A={},C={};for(const z of M){const O=z.key;if(A[O.bucketInstanceId]===void 0&&(A[O.bucketInstanceId]={}),A[O.bucketInstanceId][O.featureIndex])continue;const V=[new l.P(z.x1,z.y1),new l.P(z.x2,z.y1),new l.P(z.x2,z.y2),new l.P(z.x1,z.y2)];l.am(o,V)&&(A[O.bucketInstanceId][O.featureIndex]=!0,C[O.bucketInstanceId]===void 0&&(C[O.bucketInstanceId]=[]),C[O.bucketInstanceId].push(O.featureIndex))}return C}insertCollisionBox(i,o,u,d,y,w){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:y,collisionGroupID:w,overlapMode:o},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,o,u,d,y,w){const M=u?this.ignoredGrid:this.grid,A={bucketInstanceId:d,featureIndex:y,collisionGroupID:w,overlapMode:o};for(let C=0;C<i.length;C+=4)M.insertCircle(A,i[C],i[C+1],i[C+2])}projectAndGetPerspectiveRatio(i,o,u,d){let y;return d?(y=[o,u,d(o,u),1],l.af(y,y,i)):(y=[o,u,0,1],be(y,y,i)),{point:new l.P((y[0]/y[3]+1)/2*this.transform.width+Te,(-y[1]/y[3]+1)/2*this.transform.height+Te),perspectiveRatio:.5+this.transform.cameraToCenterDistance/y[3]*.5}}isOffscreen(i,o,u,d){return u<Te||i>=this.screenRightBoundary||d<Te||o>this.screenBottomBoundary}isInsideGrid(i,o,u,d){return u>=0&&i<this.gridRightBoundary&&d>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const i=l.an([]);return l.H(i,i,[-100,-100,0]),i}}function Re(g,i,o){return i*(l.W/(g.tileSize*Math.pow(2,o-g.tileID.overscaledZ)))}class Qe{constructor(i,o,u,d){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?o:-o))):d&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class _i{constructor(i,o,u,d,y){this.text=new Qe(i?i.text:null,o,u,y),this.icon=new Qe(i?i.icon:null,o,d,y)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Di{constructor(i,o,u){this.text=i,this.icon=o,this.skipFade=u}}class Qi{constructor(){this.invProjMatrix=l.F(),this.viewportMatrix=l.F(),this.circles=[]}}class qe{constructor(i,o,u,d,y){this.bucketInstanceId=i,this.featureIndex=o,this.sourceLayerIndex=u,this.bucketIndex=d,this.tileID=y}}class $i{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const o=++this.maxGroupID;this.collisionGroups[i]={ID:o,predicate:u=>u.collisionGroupID===o}}return this.collisionGroups[i]}}function ls(g,i,o,u,d){const{horizontalAlign:y,verticalAlign:w}=l.at(g);return new l.P(-(y-.5)*i+u[0]*d,-(w-.5)*o+u[1]*d)}function Rs(g,i,o,u,d,y){const{x1:w,x2:M,y1:A,y2:C,anchorPointX:z,anchorPointY:O}=g,V=new l.P(i,o);return u&&V._rotate(d?y:-y),{x1:w+V.x,y1:A+V.y,x2:M+V.x,y2:C+V.y,anchorPointX:z,anchorPointY:O}}class qs{constructor(i,o,u,d,y){this.transform=i.clone(),this.terrain=o,this.collisionIndex=new Ne(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new $i(d),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,o,u,d){const y=u.getBucket(o),w=u.latestFeatureIndex;if(!y||!w||o.id!==y.layerIds[0])return;const M=u.collisionBoxArray,A=y.layers[0].layout,C=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),z=u.tileSize/l.W,O=this.transform.calculatePosMatrix(u.tileID.toUnwrapped()),V=A.get("text-pitch-alignment")==="map",Z=A.get("text-rotation-alignment")==="map",W=Re(u,1,this.transform.zoom),J=Be(O,V,Z,this.transform,W);let j=null;if(V){const xt=Rn(O,V,Z,this.transform,W);j=l.K([],this.transform.labelPlaneMatrix,xt)}this.retainedQueryData[y.bucketInstanceId]=new qe(y.bucketInstanceId,w,y.sourceLayerIndex,y.index,u.tileID);const ot={bucket:y,layout:A,posMatrix:O,textLabelPlaneMatrix:J,labelToScreenMatrix:j,scale:C,textPixelRatio:z,holdingForFade:u.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:l.ag(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(d)for(const xt of y.sortKeyRanges){const{sortKey:et,symbolInstanceStart:pt,symbolInstanceEnd:bt}=xt;i.push({sortKey:et,symbolInstanceStart:pt,symbolInstanceEnd:bt,parameters:ot})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:ot})}attemptAnchorPlacement(i,o,u,d,y,w,M,A,C,z,O,V,Z,W,J,j){const ot=l.ap[i.textAnchor],xt=[i.textOffset0,i.textOffset1],et=ls(ot,u,d,xt,y),pt=this.collisionIndex.placeCollisionBox(Rs(o,et.x,et.y,w,M,this.transform.angle),O,A,C,z.predicate,j);if((!J||this.collisionIndex.placeCollisionBox(Rs(J,et.x,et.y,w,M,this.transform.angle),O,A,C,z.predicate,j).box.length!==0)&&pt.box.length>0){let bt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID].text&&(bt=this.prevPlacement.variableOffsets[V.crossTileID].anchor),V.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[V.crossTileID]={textOffset:xt,width:u,height:d,anchor:ot,textBoxScale:y,prevAnchor:bt},this.markUsedJustification(Z,ot,V,W),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,W,V),this.placedOrientations[V.crossTileID]=W),{shift:et,placedGlyphBoxes:pt}}}placeLayerBucketPart(i,o,u){const{bucket:d,layout:y,posMatrix:w,textLabelPlaneMatrix:M,labelToScreenMatrix:A,textPixelRatio:C,holdingForFade:z,collisionBoxArray:O,partiallyEvaluatedTextSize:V,collisionGroup:Z}=i.parameters,W=y.get("text-optional"),J=y.get("icon-optional"),j=l.aq(y,"text-overlap","text-allow-overlap"),ot=j==="always",xt=l.aq(y,"icon-overlap","icon-allow-overlap"),et=xt==="always",pt=y.get("text-rotation-alignment")==="map",bt=y.get("text-pitch-alignment")==="map",wt=y.get("icon-text-fit")!=="none",St=y.get("symbol-z-order")==="viewport-y",Bt=ot&&(et||!d.hasIconData()||J),Lt=et&&(ot||!d.hasTextData()||W);!d.collisionArrays&&O&&d.deserializeCollisionBoxes(O);const jt=this.retainedQueryData[d.bucketInstanceId].tileID,Wt=this.terrain?(Kt,Ie)=>this.terrain.getElevation(jt,Kt,Ie):null,$e=(Kt,Ie)=>{var Ve,ei;if(o[Kt.crossTileID])return;if(z)return void(this.placements[Kt.crossTileID]=new Di(!1,!1,!1));let ke=!1,je=!1,He=!0,qi=null,mi={box:null,offscreen:null},rr={box:null,offscreen:null},cs=null,Fi=null,hs=null,nr=0,Vr=0,_n=0;Ie.textFeatureIndex?nr=Ie.textFeatureIndex:Kt.useRuntimeCollisionCircles&&(nr=Kt.featureIndex),Ie.verticalTextFeatureIndex&&(Vr=Ie.verticalTextFeatureIndex);const lo=Ie.textBox;if(lo){const es=is=>{let Ni=l.ah.horizontal;if(d.allowVerticalPlacement&&!is&&this.prevPlacement){const yr=this.prevPlacement.placedOrientations[Kt.crossTileID];yr&&(this.placedOrientations[Kt.crossTileID]=yr,Ni=yr,this.markUsedOrientation(d,Ni,Kt))}return Ni},Bi=(is,Ni)=>{if(d.allowVerticalPlacement&&Kt.numVerticalGlyphVertices>0&&Ie.verticalTextBox){for(const yr of d.writingModes)if(yr===l.ah.vertical?(mi=Ni(),rr=mi):mi=is(),mi&&mi.box&&mi.box.length)break}else mi=is()},Ri=Kt.textAnchorOffsetStartIndex,_r=Kt.textAnchorOffsetEndIndex;if(_r===Ri){const is=(Ni,yr)=>{const ss=this.collisionIndex.placeCollisionBox(Ni,j,C,w,Z.predicate,Wt);return ss&&ss.box&&ss.box.length&&(this.markUsedOrientation(d,yr,Kt),this.placedOrientations[Kt.crossTileID]=yr),ss};Bi(()=>is(lo,l.ah.horizontal),()=>{const Ni=Ie.verticalTextBox;return d.allowVerticalPlacement&&Kt.numVerticalGlyphVertices>0&&Ni?is(Ni,l.ah.vertical):{box:null,offscreen:null}}),es(mi&&mi.box&&mi.box.length)}else{let is=l.ap[(ei=(Ve=this.prevPlacement)===null||Ve===void 0?void 0:Ve.variableOffsets[Kt.crossTileID])===null||ei===void 0?void 0:ei.anchor];const Ni=(ss,Wi,Cc)=>{const Du=ss.x2-ss.x1,Un=ss.y2-ss.y1,qn=Kt.textBoxScale,fl=wt&&xt==="never"?Wi:null;let vn={box:[],offscreen:!1},Dc=j==="never"?1:2,ku="never";is&&Dc++;for(let kc=0;kc<Dc;kc++){for(let Rc=Ri;Rc<_r;Rc++){const pl=d.textAnchorOffsets.get(Rc);if(is&&pl.textAnchor!==is)continue;const zc=this.attemptAnchorPlacement(pl,ss,Du,Un,qn,pt,bt,C,w,Z,ku,Kt,d,Cc,fl,Wt);if(zc&&(vn=zc.placedGlyphBoxes,vn&&vn.box&&vn.box.length))return ke=!0,qi=zc.shift,vn}is?is=null:ku=j}return vn};Bi(()=>Ni(lo,Ie.iconBox,l.ah.horizontal),()=>{const ss=Ie.verticalTextBox;return d.allowVerticalPlacement&&!(mi&&mi.box&&mi.box.length)&&Kt.numVerticalGlyphVertices>0&&ss?Ni(ss,Ie.verticalIconBox,l.ah.vertical):{box:null,offscreen:null}}),mi&&(ke=mi.box,He=mi.offscreen);const yr=es(mi&&mi.box);if(!ke&&this.prevPlacement){const ss=this.prevPlacement.variableOffsets[Kt.crossTileID];ss&&(this.variableOffsets[Kt.crossTileID]=ss,this.markUsedJustification(d,ss.anchor,Kt,yr))}}}if(cs=mi,ke=cs&&cs.box&&cs.box.length>0,He=cs&&cs.offscreen,Kt.useRuntimeCollisionCircles){const es=d.text.placedSymbolArray.get(Kt.centerJustifiedTextSymbolIndex),Bi=l.ai(d.textSizeData,V,es),Ri=y.get("text-padding");Fi=this.collisionIndex.placeCollisionCircles(j,es,d.lineVertexArray,d.glyphOffsetArray,Bi,w,M,A,u,bt,Z.predicate,Kt.collisionCircleDiameter,Ri,Wt),Fi.circles.length&&Fi.collisionDetected&&!u&&l.w("Collisions detected, but collision boxes are not shown"),ke=ot||Fi.circles.length>0&&!Fi.collisionDetected,He=He&&Fi.offscreen}if(Ie.iconFeatureIndex&&(_n=Ie.iconFeatureIndex),Ie.iconBox){const es=Bi=>{const Ri=wt&&qi?Rs(Bi,qi.x,qi.y,pt,bt,this.transform.angle):Bi;return this.collisionIndex.placeCollisionBox(Ri,xt,C,w,Z.predicate,Wt)};rr&&rr.box&&rr.box.length&&Ie.verticalIconBox?(hs=es(Ie.verticalIconBox),je=hs.box.length>0):(hs=es(Ie.iconBox),je=hs.box.length>0),He=He&&hs.offscreen}const yn=W||Kt.numHorizontalGlyphVertices===0&&Kt.numVerticalGlyphVertices===0,Ur=J||Kt.numIconVertices===0;if(yn||Ur?Ur?yn||(je=je&&ke):ke=je&&ke:je=ke=je&&ke,ke&&cs&&cs.box&&this.collisionIndex.insertCollisionBox(cs.box,j,y.get("text-ignore-placement"),d.bucketInstanceId,rr&&rr.box&&Vr?Vr:nr,Z.ID),je&&hs&&this.collisionIndex.insertCollisionBox(hs.box,xt,y.get("icon-ignore-placement"),d.bucketInstanceId,_n,Z.ID),Fi&&(ke&&this.collisionIndex.insertCollisionCircles(Fi.circles,j,y.get("text-ignore-placement"),d.bucketInstanceId,nr,Z.ID),u)){const es=d.bucketInstanceId;let Bi=this.collisionCircleArrays[es];Bi===void 0&&(Bi=this.collisionCircleArrays[es]=new Qi);for(let Ri=0;Ri<Fi.circles.length;Ri+=4)Bi.circles.push(Fi.circles[Ri+0]),Bi.circles.push(Fi.circles[Ri+1]),Bi.circles.push(Fi.circles[Ri+2]),Bi.circles.push(Fi.collisionDetected?1:0)}if(Kt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(d.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Kt.crossTileID]=new Di(ke||Bt,je||Lt,He||d.justReloaded),o[Kt.crossTileID]=!0};if(St){if(i.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Kt=d.getSortedSymbolIndexes(this.transform.angle);for(let Ie=Kt.length-1;Ie>=0;--Ie){const Ve=Kt[Ie];$e(d.symbolInstances.get(Ve),d.collisionArrays[Ve])}}else for(let Kt=i.symbolInstanceStart;Kt<i.symbolInstanceEnd;Kt++)$e(d.symbolInstances.get(Kt),d.collisionArrays[Kt]);if(u&&d.bucketInstanceId in this.collisionCircleArrays){const Kt=this.collisionCircleArrays[d.bucketInstanceId];l.ar(Kt.invProjMatrix,w),Kt.viewportMatrix=this.collisionIndex.getViewportMatrix()}d.justReloaded=!1}markUsedJustification(i,o,u,d){let y;y=d===l.ah.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[l.as(o)];const w=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const M of w)M>=0&&(i.text.placedSymbolArray.get(M).crossTileID=y>=0&&M!==y?0:u.crossTileID)}markUsedOrientation(i,o,u){const d=o===l.ah.horizontal||o===l.ah.horizontalOnly?o:0,y=o===l.ah.vertical?o:0,w=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const M of w)i.text.placedSymbolArray.get(M).placedOrientation=d;u.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let u=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const d=o?o.symbolFadeChange(i):1,y=o?o.opacities:{},w=o?o.variableOffsets:{},M=o?o.placedOrientations:{};for(const A in this.placements){const C=this.placements[A],z=y[A];z?(this.opacities[A]=new _i(z,d,C.text,C.icon),u=u||C.text!==z.text.placed||C.icon!==z.icon.placed):(this.opacities[A]=new _i(null,d,C.text,C.icon,C.skipFade),u=u||C.text||C.icon)}for(const A in y){const C=y[A];if(!this.opacities[A]){const z=new _i(C,d,!1,!1);z.isHidden()||(this.opacities[A]=z,u=u||C.text.placed||C.icon.placed)}}for(const A in w)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=w[A]);for(const A in M)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=M[A]);if(o&&o.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");u?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:i)}updateLayerOpacities(i,o){const u={};for(const d of o){const y=d.getBucket(i);y&&d.latestFeatureIndex&&i.id===y.layerIds[0]&&this.updateBucketOpacities(y,u,d.collisionBoxArray)}}updateBucketOpacities(i,o,u){i.hasTextData()&&(i.text.opacityVertexArray.clear(),i.text.hasVisibleVertices=!1),i.hasIconData()&&(i.icon.opacityVertexArray.clear(),i.icon.hasVisibleVertices=!1),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const d=i.layers[0],y=d.layout,w=new _i(null,0,!1,!1,!0),M=y.get("text-allow-overlap"),A=y.get("icon-allow-overlap"),C=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),z=y.get("text-rotation-alignment")==="map",O=y.get("text-pitch-alignment")==="map",V=y.get("icon-text-fit")!=="none",Z=new _i(null,0,M&&(A||!i.hasIconData()||y.get("icon-optional")),A&&(M||!i.hasTextData()||y.get("text-optional")),!0);!i.collisionArrays&&u&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(u);const W=(J,j,ot)=>{for(let xt=0;xt<j/4;xt++)J.opacityVertexArray.emplaceBack(ot);J.hasVisibleVertices=J.hasVisibleVertices||ot!==$a};for(let J=0;J<i.symbolInstances.length;J++){const j=i.symbolInstances.get(J),{numHorizontalGlyphVertices:ot,numVerticalGlyphVertices:xt,crossTileID:et}=j;let pt=this.opacities[et];o[et]?pt=w:pt||(pt=Z,this.opacities[et]=pt),o[et]=!0;const bt=j.numIconVertices>0,wt=this.placedOrientations[j.crossTileID],St=wt===l.ah.vertical,Bt=wt===l.ah.horizontal||wt===l.ah.horizontalOnly;if(ot>0||xt>0){const Lt=js(pt.text);W(i.text,ot,St?$a:Lt),W(i.text,xt,Bt?$a:Lt);const jt=pt.text.isHidden();[j.rightJustifiedTextSymbolIndex,j.centerJustifiedTextSymbolIndex,j.leftJustifiedTextSymbolIndex].forEach(Kt=>{Kt>=0&&(i.text.placedSymbolArray.get(Kt).hidden=jt||St?1:0)}),j.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(j.verticalPlacedTextSymbolIndex).hidden=jt||Bt?1:0);const Wt=this.variableOffsets[j.crossTileID];Wt&&this.markUsedJustification(i,Wt.anchor,j,wt);const $e=this.placedOrientations[j.crossTileID];$e&&(this.markUsedJustification(i,"left",j,$e),this.markUsedOrientation(i,$e,j))}if(bt){const Lt=js(pt.icon),jt=!(V&&j.verticalPlacedIconSymbolIndex&&St);j.placedIconSymbolIndex>=0&&(W(i.icon,j.numIconVertices,jt?Lt:$a),i.icon.placedSymbolArray.get(j.placedIconSymbolIndex).hidden=pt.icon.isHidden()),j.verticalPlacedIconSymbolIndex>=0&&(W(i.icon,j.numVerticalIconVertices,jt?$a:Lt),i.icon.placedSymbolArray.get(j.verticalPlacedIconSymbolIndex).hidden=pt.icon.isHidden())}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Lt=i.collisionArrays[J];if(Lt){let jt=new l.P(0,0);if(Lt.textBox||Lt.verticalTextBox){let $e=!0;if(C){const Kt=this.variableOffsets[et];Kt?(jt=ls(Kt.anchor,Kt.width,Kt.height,Kt.textOffset,Kt.textBoxScale),z&&jt._rotate(O?this.transform.angle:-this.transform.angle)):$e=!1}Lt.textBox&&vs(i.textCollisionBox.collisionVertexArray,pt.text.placed,!$e||St,jt.x,jt.y),Lt.verticalTextBox&&vs(i.textCollisionBox.collisionVertexArray,pt.text.placed,!$e||Bt,jt.x,jt.y)}const Wt=!!(!Bt&&Lt.verticalIconBox);Lt.iconBox&&vs(i.iconCollisionBox.collisionVertexArray,pt.icon.placed,Wt,V?jt.x:0,V?jt.y:0),Lt.verticalIconBox&&vs(i.iconCollisionBox.collisionVertexArray,pt.icon.placed,!Wt,V?jt.x:0,V?jt.y:0)}}}if(i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.text.opacityVertexArray.length!==i.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${i.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${i.text.layoutVertexArray.length}) / 4`);if(i.icon.opacityVertexArray.length!==i.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${i.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${i.icon.layoutVertexArray.length}) / 4`);if(i.bucketInstanceId in this.collisionCircleArrays){const J=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=J.invProjMatrix,i.placementViewportMatrix=J.viewportMatrix,i.collisionCircleArray=J.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,o){const u=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*u>i}setStale(){this.stale=!0}}function vs(g,i,o,u,d){g.emplaceBack(i?1:0,o?1:0,u||0,d||0),g.emplaceBack(i?1:0,o?1:0,u||0,d||0),g.emplaceBack(i?1:0,o?1:0,u||0,d||0),g.emplaceBack(i?1:0,o?1:0,u||0,d||0)}const Or=Math.pow(2,25),Zh=Math.pow(2,24),pf=Math.pow(2,17),fi=Math.pow(2,16),Jl=Math.pow(2,9),Ql=Math.pow(2,8),er=Math.pow(2,1);function js(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const i=g.placed?1:0,o=Math.floor(127*g.opacity);return o*Or+i*Zh+o*pf+i*fi+o*Jl+i*Ql+o*er+i}const $a=0;class mr{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&!i.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,o,u,d,y){const w=this._bucketParts;for(;this._currentTileIndex<i.length;)if(o.getBucketParts(w,d,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((M,A)=>M.sortKey-A.sortKey));this._currentPartIndex<w.length;)if(o.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,y())return!0;return!1}}class gr{constructor(i,o,u,d,y,w,M,A){this.placement=new qs(i,o,w,M,A),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(i,o,u){const d=P.now(),y=()=>!this._forceFullPlacement&&P.now()-d>2;for(;this._currentPlacementIndex>=0;){const w=o[i[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=M)&&(!w.maxzoom||w.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new mr(w)),this._inProgressLayer.continuePlacement(u[w.source],this.placement,this._showCollisionBoxes,w,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const sa=512/l.W/2;class Io{constructor(i,o,u){this.tileID=i,this.bucketInstanceId=u,this._symbolsByKey={};const d=new Map;for(let y=0;y<o.length;y++){const w=o.get(y),M=w.key,A=d.get(M);A?A.push(w):d.set(M,[w])}for(const[y,w]of d){const M={positions:w.map(A=>({x:Math.floor(A.anchorX*sa),y:Math.floor(A.anchorY*sa)})),crossTileIDs:w.map(A=>A.crossTileID)};if(M.positions.length>128){const A=new l.au(M.positions.length,16,Uint16Array);for(const{x:C,y:z}of M.positions)A.add(C,z);A.finish(),delete M.positions,M.index=A}this._symbolsByKey[y]=M}}getScaledCoordinates(i,o){const{x:u,y:d,z:y}=this.tileID.canonical,{x:w,y:M,z:A}=o.canonical,C=sa/Math.pow(2,A-y),z=(M*l.W+i.anchorY)*C,O=d*l.W*sa;return{x:Math.floor((w*l.W+i.anchorX)*C-u*l.W*sa),y:Math.floor(z-O)}}findMatches(i,o,u){const d=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z);for(let y=0;y<i.length;y++){const w=i.get(y);if(w.crossTileID)continue;const M=this._symbolsByKey[w.key];if(!M)continue;const A=this.getScaledCoordinates(w,o);if(M.index){const C=M.index.range(A.x-d,A.y-d,A.x+d,A.y+d).sort();for(const z of C){const O=M.crossTileIDs[z];if(!u[O]){u[O]=!0,w.crossTileID=O;break}}}else if(M.positions)for(let C=0;C<M.positions.length;C++){const z=M.positions[C],O=M.crossTileIDs[C];if(Math.abs(z.x-A.x)<=d&&Math.abs(z.y-A.y)<=d&&!u[O]){u[O]=!0,w.crossTileID=O;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:i})=>i)}}class ts{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Va{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const o=Math.round((i-this.lng)/360);if(o!==0)for(const u in this.indexes){const d=this.indexes[u],y={};for(const w in d){const M=d[w];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+o),y[M.tileID.key]=M}this.indexes[u]=y}this.lng=i}addBucket(i,o,u){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let y=0;y<o.symbolInstances.length;y++)o.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const d=this.usedCrossTileIDs[i.overscaledZ];for(const y in this.indexes){const w=this.indexes[y];if(Number(y)>i.overscaledZ)for(const M in w){const A=w[M];A.tileID.isChildOf(i)&&A.findMatches(o.symbolInstances,i,d)}else{const M=w[i.scaledTo(Number(y)).key];M&&M.findMatches(o.symbolInstances,i,d)}}for(let y=0;y<o.symbolInstances.length;y++){const w=o.symbolInstances.get(y);w.crossTileID||(w.crossTileID=u.generate(),d[w.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Io(i,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(i,o){for(const u of o.getCrossTileIDsLists())for(const d of u)delete this.usedCrossTileIDs[i][d]}removeStaleBuckets(i){let o=!1;for(const u in this.indexes){const d=this.indexes[u];for(const y in d)i[d[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,d[y]),delete d[y],o=!0)}return o}}class un{constructor(){this.layerIndexes={},this.crossTileIDs=new ts,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,o,u){let d=this.layerIndexes[i.id];d===void 0&&(d=this.layerIndexes[i.id]=new Va);let y=!1;const w={};d.handleWrapJump(u);for(const M of o){const A=M.getBucket(i);A&&i.id===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(M.tileID,A,this.crossTileIDs)&&(y=!0),w[A.bucketInstanceId]=!0)}return d.removeStaleBuckets(w)&&(y=!0),y}pruneUnusedLayers(i){const o={};i.forEach(u=>{o[u]=!0});for(const u in this.layerIndexes)o[u]||delete this.layerIndexes[u]}}const Oi=(g,i)=>l.t(g,i&&i.filter(o=>o.identifier!=="source.canvas")),Po=l.av();class ir extends l.E{constructor(i,o={}){super(),this._rtlPluginLoaded=()=>{for(const u in this.sourceCaches){const d=this.sourceCaches[u].getSource().type;d!=="vector"&&d!=="geojson"||this.sourceCaches[u].reload()}},this.map=i,this.dispatcher=new ae(kt(),i._getMapId()),this.dispatcher.registerMessageHandler("GG",(u,d)=>this.getGlyphs(u,d)),this.dispatcher.registerMessageHandler("GI",(u,d)=>this.getImages(u,d)),this.imageManager=new pe,this.imageManager.setEventedParent(this),this.glyphManager=new Le(i._requestManager,o.localIdeographFontFamily),this.lineAtlas=new Ii(256,512),this.crossTileSymbolIndex=new un,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",l.ax()),Rt().on(De,this._rtlPluginLoaded),this.on("data",u=>{if(u.dataType!=="source"||u.sourceDataType!=="metadata")return;const d=this.sourceCaches[u.sourceId];if(!d)return;const y=d.getSource();if(y&&y.vectorLayerIds)for(const w in this._layers){const M=this._layers[w];M.source===y.id&&this._validateLayer(M)}})}loadURL(i,o={},u){this.fire(new l.k("dataloading",{dataType:"style"})),o.validate=typeof o.validate!="boolean"||o.validate;const d=this.map._requestManager.transformRequest(i,"Style");this._loadStyleRequest=new AbortController,l.h(d,this._loadStyleRequest).then(y=>{this._loadStyleRequest=null,this._load(y.data,o,u)}).catch(y=>{this._loadStyleRequest=null,y&&this.fire(new l.j(y))})}loadJSON(i,o={},u){this.fire(new l.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,P.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,o.validate=o.validate!==!1,this._load(i,o,u)}).catch(()=>{})}loadEmpty(){this.fire(new l.k("dataloading",{dataType:"style"})),this._load(Po,{validate:!1})}_load(i,o,u){var d;const y=o.transformStyle?o.transformStyle(u,i):i;if(!o.validate||!Oi(this,l.x(y))){this._loaded=!0,this.stylesheet=y;for(const w in y.sources)this.addSource(w,y.sources[w],{validate:!1});y.sprite?this._loadSprite(y.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(y.glyphs),this._createLayers(),this.light=new ks(this.stylesheet.light),this.map.setTerrain((d=this.stylesheet.terrain)!==null&&d!==void 0?d:null),this.fire(new l.k("data",{dataType:"style"})),this.fire(new l.k("style.load"))}}_createLayers(){const i=l.ay(this.stylesheet.layers);this.dispatcher.broadcast("SL",i),this._order=i.map(o=>o.id),this._layers={},this._serializedLayers=null;for(const o of i){const u=l.az(o);u.setEventedParent(this,{layer:{id:o.id}}),this._layers[o.id]=u}}_loadSprite(i,o=!1,u=void 0){let d;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(y,w,M,A){return l._(this,void 0,void 0,function*(){const C=Ce(y),z=M>1?"@2x":"",O={},V={};for(const{id:Z,url:W}of C){const J=w.transformRequest(w.normalizeSpriteURL(W,z,".json"),"SpriteJSON");O[Z]=l.h(J,A);const j=w.transformRequest(w.normalizeSpriteURL(W,z,".png"),"SpriteImage");V[Z]=ut.getImage(j,A)}return yield Promise.all([...Object.values(O),...Object.values(V)]),function(Z,W){return l._(this,void 0,void 0,function*(){const J={};for(const j in Z){J[j]={};const ot=P.getImageCanvasContext((yield W[j]).data),xt=(yield Z[j]).data;for(const et in xt){const{width:pt,height:bt,x:wt,y:St,sdf:Bt,pixelRatio:Lt,stretchX:jt,stretchY:Wt,content:$e}=xt[et];J[j][et]={data:null,pixelRatio:Lt,sdf:Bt,stretchX:jt,stretchY:Wt,content:$e,spriteData:{width:pt,height:bt,x:wt,y:St,context:ot}}}}return J})}(O,V)})}(i,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(y=>{if(this._spriteRequest=null,y)for(const w in y){this._spritesImagesIds[w]=[];const M=this._spritesImagesIds[w]?this._spritesImagesIds[w].filter(A=>!(A in y)):[];for(const A of M)this.imageManager.removeImage(A),this._changedImages[A]=!0;for(const A in y[w]){const C=w==="default"?A:`${w}:${A}`;this._spritesImagesIds[w].push(C),C in this.imageManager.images?this.imageManager.updateImage(C,y[w][A],!1):this.imageManager.addImage(C,y[w][A]),o&&(this._changedImages[C]=!0)}}}).catch(y=>{this._spriteRequest=null,d=y,this.fire(new l.j(d))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),o&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"})),u&&u(d)})}_unloadSprite(){for(const i of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(i),this._changedImages[i]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}_validateLayer(i){const o=this.sourceCaches[i.source];if(!o)return;const u=i.sourceLayer;if(!u)return;const d=o.getSource();(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(u)===-1)&&this.fire(new l.j(new Error(`Source layer "${u}" does not exist on source "${d.id}" as specified by style layer "${i.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this.sourceCaches)if(!this.sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(i){const o=this._serializedAllLayers();if(!i||i.length===0)return Object.values(o);const u=[];for(const d of i)o[d]&&u.push(o[d]);return u}_serializedAllLayers(){let i=this._serializedLayers;if(i)return i;i=this._serializedLayers={};const o=Object.keys(this._layers);for(const u of o){const d=this._layers[u];d.type!=="custom"&&(i[u]=d.serialize())}return i}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const i in this.sourceCaches)if(this.sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(i){if(!this._loaded)return;const o=this._changed;if(o){const d=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(d.length||y.length)&&this._updateWorkerLayers(d,y);for(const w in this._updatedSources){const M=this._updatedSources[w];if(M==="reload")this._reloadSource(w);else{if(M!=="clear")throw new Error(`Invalid action ${M}`);this._clearSource(w)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(i);this.light.updateTransitions(i),this._resetUpdates()}const u={};for(const d in this.sourceCaches){const y=this.sourceCaches[d];u[d]=y.used,y.used=!1}for(const d of this._order){const y=this._layers[d];y.recalculate(i,this._availableImages),!y.isHidden(i.zoom)&&y.source&&(this.sourceCaches[y.source].used=!0)}for(const d in u){const y=this.sourceCaches[d];!!u[d]!=!!y.used&&y.fire(new l.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:d}))}this.light.recalculate(i),this.z=i.zoom,o&&this.fire(new l.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const i in this.sourceCaches)this.sourceCaches[i].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(i,o){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(i),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(i,o={}){var u;this._checkLoaded();const d=this.serialize();if(i=o.transformStyle?o.transformStyle(d,i):i,((u=o.validate)===null||u===void 0||u)&&Oi(this,l.x(i)))return!1;(i=l.aA(i)).layers=l.ay(i.layers);const y=l.aB(d,i),w=this._getOperationsToPerform(y);if(w.unimplemented.length>0)throw new Error(`Unimplemented: ${w.unimplemented.join(", ")}.`);if(w.operations.length===0)return!1;for(const M of w.operations)M();return this.stylesheet=i,this._serializedLayers=null,!0}_getOperationsToPerform(i){const o=[],u=[];for(const d of i)switch(d.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":o.push(()=>this.addLayer.apply(this,d.args));break;case"removeLayer":o.push(()=>this.removeLayer.apply(this,d.args));break;case"setPaintProperty":o.push(()=>this.setPaintProperty.apply(this,d.args));break;case"setLayoutProperty":o.push(()=>this.setLayoutProperty.apply(this,d.args));break;case"setFilter":o.push(()=>this.setFilter.apply(this,d.args));break;case"addSource":o.push(()=>this.addSource.apply(this,d.args));break;case"removeSource":o.push(()=>this.removeSource.apply(this,d.args));break;case"setLayerZoomRange":o.push(()=>this.setLayerZoomRange.apply(this,d.args));break;case"setLight":o.push(()=>this.setLight.apply(this,d.args));break;case"setGeoJSONSourceData":o.push(()=>this.setGeoJSONSourceData.apply(this,d.args));break;case"setGlyphs":o.push(()=>this.setGlyphs.apply(this,d.args));break;case"setSprite":o.push(()=>this.setSprite.apply(this,d.args));break;case"setTerrain":o.push(()=>this.map.setTerrain.apply(this,d.args));break;case"setTransition":o.push(()=>{});break;default:u.push(d.command)}return{operations:o,unimplemented:u}}addImage(i,o){if(this.getImage(i))return this.fire(new l.j(new Error(`An image named "${i}" already exists.`)));this.imageManager.addImage(i,o),this._afterImageUpdated(i)}updateImage(i,o){this.imageManager.updateImage(i,o)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){if(!this.getImage(i))return this.fire(new l.j(new Error(`An image named "${i}" does not exist.`)));this.imageManager.removeImage(i),this._afterImageUpdated(i)}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(i,o,u={}){if(this._checkLoaded(),this.sourceCaches[i]!==void 0)throw new Error(`Source "${i}" already exists.`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(l.x.source,`sources.${i}`,o,null,u))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const d=this.sourceCaches[i]=new as(i,o,this.dispatcher);d.style=this,d.setEventedParent(this,()=>({isSourceLoaded:d.loaded(),source:d.serialize(),sourceId:i})),d.onAdd(this.map),this._changed=!0}removeSource(i){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error("There is no source with this ID");for(const u in this._layers)if(this._layers[u].source===i)return this.fire(new l.j(new Error(`Source "${i}" cannot be removed while layer "${u}" is using it.`)));const o=this.sourceCaches[i];delete this.sourceCaches[i],delete this._updatedSources[i],o.fire(new l.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:i})),o.setEventedParent(null),o.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(i,o){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error(`There is no source with this ID=${i}`);const u=this.sourceCaches[i].getSource();if(u.type!=="geojson")throw new Error(`geojsonSource.type is ${u.type}, which is !== 'geojson`);u.setData(o),this._changed=!0}getSource(i){return this.sourceCaches[i]&&this.sourceCaches[i].getSource()}addLayer(i,o,u={}){this._checkLoaded();const d=i.id;if(this.getLayer(d))return void this.fire(new l.j(new Error(`Layer "${d}" already exists on this map.`)));let y;if(i.type==="custom"){if(Oi(this,l.aC(i)))return;y=l.az(i)}else{if("source"in i&&typeof i.source=="object"&&(this.addSource(d,i.source),i=l.aA(i),i=l.e(i,{source:d})),this._validate(l.x.layer,`layers.${d}`,i,{arrayIndex:-1},u))return;y=l.az(i),this._validateLayer(y),y.setEventedParent(this,{layer:{id:d}})}const w=o?this._order.indexOf(o):this._order.length;if(o&&w===-1)this.fire(new l.j(new Error(`Cannot add layer "${d}" before non-existing layer "${o}".`)));else{if(this._order.splice(w,0,d),this._layerOrderChanged=!0,this._layers[d]=y,this._removedLayers[d]&&y.source&&y.type!=="custom"){const M=this._removedLayers[d];delete this._removedLayers[d],M.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",this.sourceCaches[y.source].pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map)}}moveLayer(i,o){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new l.j(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===o)return;const u=this._order.indexOf(i);this._order.splice(u,1);const d=o?this._order.indexOf(o):this._order.length;o&&d===-1?this.fire(new l.j(new Error(`Cannot move layer "${i}" before non-existing layer "${o}".`))):(this._order.splice(d,0,i),this._layerOrderChanged=!0)}removeLayer(i){this._checkLoaded();const o=this._layers[i];if(!o)return void this.fire(new l.j(new Error(`Cannot remove non-existing layer "${i}".`)));o.setEventedParent(null);const u=this._order.indexOf(i);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=o,delete this._layers[i],this._serializedLayers&&delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],o.onRemove&&o.onRemove(this.map)}getLayer(i){return this._layers[i]}getLayersOrder(){return[...this._order]}hasLayer(i){return i in this._layers}setLayerZoomRange(i,o,u){this._checkLoaded();const d=this.getLayer(i);d?d.minzoom===o&&d.maxzoom===u||(o!=null&&(d.minzoom=o),u!=null&&(d.maxzoom=u),this._updateLayer(d)):this.fire(new l.j(new Error(`Cannot set the zoom range of non-existing layer "${i}".`)))}setFilter(i,o,u={}){this._checkLoaded();const d=this.getLayer(i);if(d){if(!l.aD(d.filter,o))return o==null?(d.filter=void 0,void this._updateLayer(d)):void(this._validate(l.x.filter,`layers.${d.id}.filter`,o,null,u)||(d.filter=l.aA(o),this._updateLayer(d)))}else this.fire(new l.j(new Error(`Cannot filter non-existing layer "${i}".`)))}getFilter(i){return l.aA(this.getLayer(i).filter)}setLayoutProperty(i,o,u,d={}){this._checkLoaded();const y=this.getLayer(i);y?l.aD(y.getLayoutProperty(o),u)||(y.setLayoutProperty(o,u,d),this._updateLayer(y)):this.fire(new l.j(new Error(`Cannot style non-existing layer "${i}".`)))}getLayoutProperty(i,o){const u=this.getLayer(i);if(u)return u.getLayoutProperty(o);this.fire(new l.j(new Error(`Cannot get style of non-existing layer "${i}".`)))}setPaintProperty(i,o,u,d={}){this._checkLoaded();const y=this.getLayer(i);y?l.aD(y.getPaintProperty(o),u)||(y.setPaintProperty(o,u,d)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[i]=!0,this._serializedLayers=null):this.fire(new l.j(new Error(`Cannot style non-existing layer "${i}".`)))}getPaintProperty(i,o){return this.getLayer(i).getPaintProperty(o)}setFeatureState(i,o){this._checkLoaded();const u=i.source,d=i.sourceLayer,y=this.sourceCaches[u];if(y===void 0)return void this.fire(new l.j(new Error(`The source '${u}' does not exist in the map's style.`)));const w=y.getSource().type;w==="geojson"&&d?this.fire(new l.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):w!=="vector"||d?(i.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),y.setFeatureState(d,i.id,o)):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(i,o){this._checkLoaded();const u=i.source,d=this.sourceCaches[u];if(d===void 0)return void this.fire(new l.j(new Error(`The source '${u}' does not exist in the map's style.`)));const y=d.getSource().type,w=y==="vector"?i.sourceLayer:void 0;y!=="vector"||w?o&&typeof i.id!="string"&&typeof i.id!="number"?this.fire(new l.j(new Error("A feature id is required to remove its specific state property."))):d.removeFeatureState(w,i.id,o):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(i){this._checkLoaded();const o=i.source,u=i.sourceLayer,d=this.sourceCaches[o];if(d!==void 0)return d.getSource().type!=="vector"||u?(i.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),d.getFeatureState(u,i.id)):void this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.j(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const i=l.aE(this.sourceCaches,y=>y.serialize()),o=this._serializeByIds(this._order),u=this.map.getTerrain()||void 0,d=this.stylesheet;return l.aF({version:d.version,name:d.name,metadata:d.metadata,light:d.light,center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch,sprite:d.sprite,glyphs:d.glyphs,transition:d.transition,sources:i,layers:o,terrain:u},y=>y!==void 0)}_updateLayer(i){this._updatedLayers[i.id]=!0,i.source&&!this._updatedSources[i.source]&&this.sourceCaches[i.source].getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",this.sourceCaches[i.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(i){const o=w=>this._layers[w].type==="fill-extrusion",u={},d=[];for(let w=this._order.length-1;w>=0;w--){const M=this._order[w];if(o(M)){u[M]=w;for(const A of i){const C=A[M];if(C)for(const z of C)d.push(z)}}}d.sort((w,M)=>M.intersectionZ-w.intersectionZ);const y=[];for(let w=this._order.length-1;w>=0;w--){const M=this._order[w];if(o(M))for(let A=d.length-1;A>=0;A--){const C=d[A].feature;if(u[C.layer.id]<w)break;y.push(C),d.pop()}else for(const A of i){const C=A[M];if(C)for(const z of C)y.push(z.feature)}}return y}queryRenderedFeatures(i,o,u){o&&o.filter&&this._validate(l.x.filter,"queryRenderedFeatures.filter",o.filter,null,o);const d={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new l.j(new Error("parameters.layers must be an Array."))),[];for(const M of o.layers){const A=this._layers[M];if(!A)return this.fire(new l.j(new Error(`The layer '${M}' does not exist in the map's style and cannot be queried for features.`))),[];d[A.source]=!0}}const y=[];o.availableImages=this._availableImages;const w=this._serializedAllLayers();for(const M in this.sourceCaches)o.layers&&!d[M]||y.push(ni(this.sourceCaches[M],this._layers,w,i,o,u));return this.placement&&y.push(function(M,A,C,z,O,V,Z){const W={},J=V.queryRenderedSymbols(z),j=[];for(const ot of Object.keys(J).map(Number))j.push(Z[ot]);j.sort(ai);for(const ot of j){const xt=ot.featureIndex.lookupSymbolFeatures(J[ot.bucketInstanceId],A,ot.bucketIndex,ot.sourceLayerIndex,O.filter,O.layers,O.availableImages,M);for(const et in xt){const pt=W[et]=W[et]||[],bt=xt[et];bt.sort((wt,St)=>{const Bt=ot.featureSortOrder;if(Bt){const Lt=Bt.indexOf(wt.featureIndex);return Bt.indexOf(St.featureIndex)-Lt}return St.featureIndex-wt.featureIndex});for(const wt of bt)pt.push(wt)}}for(const ot in W)W[ot].forEach(xt=>{const et=xt.feature,pt=C[M[ot].source].getFeatureState(et.layer["source-layer"],et.id);et.source=et.layer.source,et.layer["source-layer"]&&(et.sourceLayer=et.layer["source-layer"]),et.state=pt});return W}(this._layers,w,this.sourceCaches,i,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(i,o){o&&o.filter&&this._validate(l.x.filter,"querySourceFeatures.filter",o.filter,null,o);const u=this.sourceCaches[i];return u?function(d,y){const w=d.getRenderableIds().map(C=>d.getTileByID(C)),M=[],A={};for(let C=0;C<w.length;C++){const z=w[C],O=z.tileID.canonical.key;A[O]||(A[O]=!0,z.querySourceFeatures(M,y))}return M}(u,o):[]}getLight(){return this.light.getLight()}setLight(i,o={}){this._checkLoaded();const u=this.light.getLight();let d=!1;for(const w in i)if(!l.aD(i[w],u[w])){d=!0;break}if(!d)return;const y={now:P.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,o),this.light.updateTransitions(y)}_validate(i,o,u,d,y={}){return(!y||y.validate!==!1)&&Oi(this,i.call(l.x,l.e({key:o,style:this.serialize(),value:u,styleSpec:l.v},d)))}_remove(i=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Rt().off(De,this._rtlPluginLoaded);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this.sourceCaches){const u=this.sourceCaches[o];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),i&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(i)}_clearSource(i){this.sourceCaches[i].clearTiles()}_reloadSource(i){this.sourceCaches[i].resume(),this.sourceCaches[i].reload()}_updateSources(i){for(const o in this.sourceCaches)this.sourceCaches[o].update(i,this.map.terrain)}_generateCollisionBoxes(){for(const i in this.sourceCaches)this._reloadSource(i)}_updatePlacement(i,o,u,d,y=!1){let w=!1,M=!1;const A={};for(const C of this._order){const z=this._layers[C];if(z.type!=="symbol")continue;if(!A[z.source]){const V=this.sourceCaches[z.source];A[z.source]=V.getRenderableIds(!0).map(Z=>V.getTileByID(Z)).sort((Z,W)=>W.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(W.tileID)?-1:1))}const O=this.crossTileSymbolIndex.addLayer(z,A[z.source],i.center.lng);w=w||O}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((y=y||this._layerOrderChanged||u===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(P.now(),i.zoom))&&(this.pauseablePlacement=new gr(i,this.map.terrain,this._order,y,o,u,d,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(P.now()),M=!0),w&&this.pauseablePlacement.placement.setStale()),M||w)for(const C of this._order){const z=this._layers[C];z.type==="symbol"&&this.placement.updateLayerOpacities(z,A[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(P.now())}_releaseSymbolFadeTiles(){for(const i in this.sourceCaches)this.sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,o){return l._(this,void 0,void 0,function*(){const u=yield this.imageManager.getImages(o.icons);this._updateTilesForChangedImages();const d=this.sourceCaches[o.source];return d&&d.setDependencies(o.tileID.key,o.type,o.icons),u})}getGlyphs(i,o){return l._(this,void 0,void 0,function*(){const u=yield this.glyphManager.getGlyphs(o.stacks),d=this.sourceCaches[o.source];return d&&d.setDependencies(o.tileID.key,o.type,[""]),u})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(i,o={}){this._checkLoaded(),i&&this._validate(l.x.glyphs,"glyphs",i,null,o)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=i,this.glyphManager.entries={},this.glyphManager.setURL(i))}addSprite(i,o,u={},d){this._checkLoaded();const y=[{id:i,url:o}],w=[...Ce(this.stylesheet.sprite),...y];this._validate(l.x.sprite,"sprite",w,null,u)||(this.stylesheet.sprite=w,this._loadSprite(y,!0,d))}removeSprite(i){this._checkLoaded();const o=Ce(this.stylesheet.sprite);if(o.find(u=>u.id===i)){if(this._spritesImagesIds[i])for(const u of this._spritesImagesIds[i])this.imageManager.removeImage(u),this._changedImages[u]=!0;o.splice(o.findIndex(u=>u.id===i),1),this.stylesheet.sprite=o.length>0?o:void 0,delete this._spritesImagesIds[i],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}else this.fire(new l.j(new Error(`Sprite "${i}" doesn't exists on this map.`)))}getSprite(){return Ce(this.stylesheet.sprite)}setSprite(i,o={},u){this._checkLoaded(),i&&this._validate(l.x.sprite,"sprite",i,null,o)||(this.stylesheet.sprite=i,i?this._loadSprite(i,!0,u):(this._unloadSprite(),u&&u(null)))}}var Co=l.X([{name:"a_pos",type:"Int16",components:2}]),Fr="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Ua={prelude:pi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:pi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:pi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:pi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:pi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:pi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:pi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:pi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:pi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:pi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:pi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:pi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:pi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:pi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:pi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:pi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:pi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:pi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:pi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:pi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:pi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:pi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:pi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:pi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:pi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:pi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:pi("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Fr),terrainDepth:pi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Fr),terrainCoords:pi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Fr)};function pi(g,i){const o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=i.match(/attribute ([\w]+) ([\w]+)/g),d=g.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=i.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=y?y.concat(d):d,M={};return{fragmentSource:g=g.replace(o,(A,C,z,O,V)=>(M[V]=!0,C==="define"?`
#ifndef HAS_UNIFORM_u_${V}
varying ${z} ${O} ${V};
#else
uniform ${z} ${O} u_${V};
#endif
`:`
#ifdef HAS_UNIFORM_u_${V}
    ${z} ${O} ${V} = u_${V};
#endif
`)),vertexSource:i=i.replace(o,(A,C,z,O,V)=>{const Z=O==="float"?"vec2":"vec4",W=V.match(/color/)?"color":Z;return M[V]?C==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
attribute ${z} ${Z} a_${V};
varying ${z} ${O} ${V};
#else
uniform ${z} ${O} u_${V};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = a_${V};
#else
    ${z} ${O} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = unpack_mix_${W}(a_${V}, u_${V}_t);
#else
    ${z} ${O} ${V} = u_${V};
#endif
`:C==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
attribute ${z} ${Z} a_${V};
#else
uniform ${z} ${O} u_${V};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${z} ${O} ${V} = a_${V};
#else
    ${z} ${O} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${z} ${O} ${V} = unpack_mix_${W}(a_${V}, u_${V}_t);
#else
    ${z} ${O} ${V} = u_${V};
#endif
`}),staticAttributes:u,staticUniforms:w}}class Do{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(i,o,u,d,y,w,M,A,C){this.context=i;let z=this.boundPaintVertexBuffers.length!==d.length;for(let O=0;!z&&O<d.length;O++)this.boundPaintVertexBuffers[O]!==d[O]&&(z=!0);!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==u||z||this.boundIndexBuffer!==y||this.boundVertexOffset!==w||this.boundDynamicVertexBuffer!==M||this.boundDynamicVertexBuffer2!==A||this.boundDynamicVertexBuffer3!==C?this.freshBind(o,u,d,y,w,M,A,C):(i.bindVertexArray.set(this.vao),M&&M.bind(),y&&y.dynamicDraw&&y.bind(),A&&A.bind(),C&&C.bind())}freshBind(i,o,u,d,y,w,M,A){const C=i.numAttributes,z=this.context,O=z.gl;this.vao&&this.destroy(),this.vao=z.createVertexArray(),z.bindVertexArray.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=d,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=M,this.boundDynamicVertexBuffer3=A,o.enableAttributes(O,i);for(const V of u)V.enableAttributes(O,i);w&&w.enableAttributes(O,i),M&&M.enableAttributes(O,i),A&&A.enableAttributes(O,i),o.bind(),o.setVertexAttribPointers(O,i,y);for(const V of u)V.bind(),V.setVertexAttribPointers(O,i,y);w&&(w.bind(),w.setVertexAttribPointers(O,i,y)),d&&d.bind(),M&&(M.bind(),M.setVertexAttribPointers(O,i,y)),A&&(A.bind(),A.setVertexAttribPointers(O,i,y)),z.currentNumAttributes=C}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function ra(g){const i=[];for(let o=0;o<g.length;o++){if(g[o]===null)continue;const u=g[o].split(" ");i.push(u.pop())}return i}class dn{constructor(i,o,u,d,y,w){const M=i.gl;this.program=M.createProgram();const A=ra(o.staticAttributes),C=u?u.getBinderAttributes():[],z=A.concat(C),O=Ua.prelude.staticUniforms?ra(Ua.prelude.staticUniforms):[],V=o.staticUniforms?ra(o.staticUniforms):[],Z=u?u.getBinderUniforms():[],W=O.concat(V).concat(Z),J=[];for(const wt of W)J.indexOf(wt)<0&&J.push(wt);const j=u?u.defines():[];y&&j.push("#define OVERDRAW_INSPECTOR;"),w&&j.push("#define TERRAIN3D;");const ot=j.concat(Ua.prelude.fragmentSource,o.fragmentSource).join(`
`),xt=j.concat(Ua.prelude.vertexSource,o.vertexSource).join(`
`),et=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);if(M.shaderSource(et,ot),M.compileShader(et),!M.getShaderParameter(et,M.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${M.getShaderInfoLog(et)}`);M.attachShader(this.program,et);const pt=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);if(M.shaderSource(pt,xt),M.compileShader(pt),!M.getShaderParameter(pt,M.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${M.getShaderInfoLog(pt)}`);M.attachShader(this.program,pt),this.attributes={};const bt={};this.numAttributes=z.length;for(let wt=0;wt<this.numAttributes;wt++)z[wt]&&(M.bindAttribLocation(this.program,wt,z[wt]),this.attributes[z[wt]]=wt);if(M.linkProgram(this.program),!M.getProgramParameter(this.program,M.LINK_STATUS))throw new Error(`Program failed to link: ${M.getProgramInfoLog(this.program)}`);M.deleteShader(pt),M.deleteShader(et);for(let wt=0;wt<J.length;wt++){const St=J[wt];if(St&&!bt[St]){const Bt=M.getUniformLocation(this.program,St);Bt&&(bt[St]=Bt)}}this.fixedUniforms=d(i,bt),this.terrainUniforms=((wt,St)=>({u_depth:new l.aG(wt,St.u_depth),u_terrain:new l.aG(wt,St.u_terrain),u_terrain_dim:new l.aH(wt,St.u_terrain_dim),u_terrain_matrix:new l.aI(wt,St.u_terrain_matrix),u_terrain_unpack:new l.aJ(wt,St.u_terrain_unpack),u_terrain_exaggeration:new l.aH(wt,St.u_terrain_exaggeration)}))(i,bt),this.binderUniforms=u?u.getUniforms(i,bt):[]}draw(i,o,u,d,y,w,M,A,C,z,O,V,Z,W,J,j,ot,xt){const et=i.gl;if(this.failedToCreate)return;if(i.program.set(this.program),i.setDepthMode(u),i.setStencilMode(d),i.setColorMode(y),i.setCullFace(w),A){i.activeTexture.set(et.TEXTURE2),et.bindTexture(et.TEXTURE_2D,A.depthTexture),i.activeTexture.set(et.TEXTURE3),et.bindTexture(et.TEXTURE_2D,A.texture);for(const bt in this.terrainUniforms)this.terrainUniforms[bt].set(A[bt])}for(const bt in this.fixedUniforms)this.fixedUniforms[bt].set(M[bt]);J&&J.setUniforms(i,this.binderUniforms,Z,{zoom:W});let pt=0;switch(o){case et.LINES:pt=2;break;case et.TRIANGLES:pt=3;break;case et.LINE_STRIP:pt=1}for(const bt of V.get()){const wt=bt.vaos||(bt.vaos={});(wt[C]||(wt[C]=new Do)).bind(i,this,z,J?J.getPaintVertexBuffers():[],O,bt.vertexOffset,j,ot,xt),et.drawElements(o,bt.primitiveLength*pt,et.UNSIGNED_SHORT,bt.primitiveOffset*pt*2)}}}function ko(g,i,o){const u=1/Re(o,1,i.transform.tileZoom),d=Math.pow(2,o.tileID.overscaledZ),y=o.tileSize*Math.pow(2,i.transform.tileZoom)/d,w=y*(o.tileID.canonical.x+o.tileID.wrap*d),M=y*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[u,g.fromScale,g.toScale],u_fade:g.t,u_pixel_coord_upper:[w>>16,M>>16],u_pixel_coord_lower:[65535&w,65535&M]}}const qa=(g,i,o,u)=>{const d=i.style.light,y=d.properties.get("position"),w=[y.x,y.y,y.z],M=function(){var C=new l.A(9);return l.A!=Float32Array&&(C[1]=0,C[2]=0,C[3]=0,C[5]=0,C[6]=0,C[7]=0),C[0]=1,C[4]=1,C[8]=1,C}();d.properties.get("anchor")==="viewport"&&function(C,z){var O=Math.sin(z),V=Math.cos(z);C[0]=V,C[1]=O,C[2]=0,C[3]=-O,C[4]=V,C[5]=0,C[6]=0,C[7]=0,C[8]=1}(M,-i.transform.angle),function(C,z,O){var V=z[0],Z=z[1],W=z[2];C[0]=V*O[0]+Z*O[3]+W*O[6],C[1]=V*O[1]+Z*O[4]+W*O[7],C[2]=V*O[2]+Z*O[5]+W*O[8]}(w,w,M);const A=d.properties.get("color");return{u_matrix:g,u_lightpos:w,u_lightintensity:d.properties.get("intensity"),u_lightcolor:[A.r,A.g,A.b],u_vertical_gradient:+o,u_opacity:u}},mf=(g,i,o,u,d,y,w)=>l.e(qa(g,i,o,u),ko(y,i,w),{u_height_factor:-Math.pow(2,d.overscaledZ)/w.tileSize/8}),Xh=g=>({u_matrix:g}),Ro=(g,i,o,u)=>l.e(Xh(g),ko(o,i,u)),gf=(g,i)=>({u_matrix:g,u_world:i}),Kh=(g,i,o,u,d)=>l.e(Ro(g,i,o,u),{u_world:d}),_f=(g,i,o,u)=>{const d=g.transform;let y,w;if(u.paint.get("circle-pitch-alignment")==="map"){const M=Re(o,1,d.zoom);y=!0,w=[M,M]}else y=!1,w=d.pixelsToGLUnits;return{u_camera_to_center_distance:d.cameraToCenterDistance,u_scale_with_map:+(u.paint.get("circle-pitch-scale")==="map"),u_matrix:g.translatePosMatrix(i.posMatrix,o,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_pitch_with_map:+y,u_device_pixel_ratio:g.pixelRatio,u_extrude_scale:w}},Yh=(g,i,o)=>{const u=Re(o,1,i.zoom),d=Math.pow(2,i.zoom-o.tileID.overscaledZ),y=o.tileID.overscaleFactor();return{u_matrix:g,u_camera_to_center_distance:i.cameraToCenterDistance,u_pixels_to_tile_units:u,u_extrude_scale:[i.pixelsToGLUnits[0]/(u*d),i.pixelsToGLUnits[1]/(u*d)],u_overscale_factor:y}},Jh=(g,i,o=1)=>({u_matrix:g,u_color:i,u_overlay:0,u_overlay_scale:o}),zo=g=>({u_matrix:g}),Qh=(g,i,o,u)=>({u_matrix:g,u_extrude_scale:Re(i,1,o),u_intensity:u});function tu(g,i){const o=Math.pow(2,i.canonical.z),u=i.canonical.y;return[new l.Y(0,u/o).toLngLat().lat,new l.Y(0,(u+1)/o).toLngLat().lat]}const Lo=(g,i,o,u)=>{const d=g.transform;return{u_matrix:ja(g,i,o,u),u_ratio:1/Re(i,1,d.zoom),u_device_pixel_ratio:g.pixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},eu=(g,i,o,u,d)=>l.e(Lo(g,i,o,d),{u_image:0,u_image_height:u}),zn=(g,i,o,u,d)=>{const y=g.transform,w=sr(i,y);return{u_matrix:ja(g,i,o,d),u_texsize:i.imageAtlasTexture.size,u_ratio:1/Re(i,1,y.zoom),u_device_pixel_ratio:g.pixelRatio,u_image:0,u_scale:[w,u.fromScale,u.toScale],u_fade:u.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},Oo=(g,i,o,u,d,y)=>{const w=g.lineAtlas,M=sr(i,g.transform),A=o.layout.get("line-cap")==="round",C=w.getDash(u.from,A),z=w.getDash(u.to,A),O=C.width*d.fromScale,V=z.width*d.toScale;return l.e(Lo(g,i,o,y),{u_patternscale_a:[M/O,-C.height/2],u_patternscale_b:[M/V,-z.height/2],u_sdfgamma:w.width/(256*Math.min(O,V)*g.pixelRatio)/2,u_image:0,u_tex_y_a:C.y,u_tex_y_b:z.y,u_mix:d.t})};function sr(g,i){return 1/Re(g,1,i.tileZoom)}function ja(g,i,o,u){return g.translatePosMatrix(u?u.posMatrix:i.tileID.posMatrix,i,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const Fo=(g,i,o,u,d)=>{return{u_matrix:g,u_tl_parent:i,u_scale_parent:o,u_buffer_scale:1,u_fade_t:u.mix,u_opacity:u.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:(w=d.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(y=d.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:Ga(d.paint.get("raster-hue-rotate"))};var y,w};function Ga(g){g*=Math.PI/180;const i=Math.sin(g),o=Math.cos(g);return[(2*o+1)/3,(-Math.sqrt(3)*i-o+1)/3,(Math.sqrt(3)*i-o+1)/3]}const Ha=(g,i,o,u,d,y,w,M,A,C)=>{const z=d.transform;return{u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:z.cameraToCenterDistance,u_pitch:z.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:z.width/z.height,u_fade_change:d.options.fadeDuration?d.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:w,u_coord_matrix:M,u_is_text:+A,u_pitch_with_map:+u,u_texsize:C,u_texture:0}},Wa=(g,i,o,u,d,y,w,M,A,C,z)=>{const O=d.transform;return l.e(Ha(g,i,o,u,d,y,w,M,A,C),{u_gamma_scale:u?Math.cos(O._pitch)*O.cameraToCenterDistance:1,u_device_pixel_ratio:d.pixelRatio,u_is_halo:+z})},Za=(g,i,o,u,d,y,w,M,A,C)=>l.e(Wa(g,i,o,u,d,y,w,M,!0,A,!0),{u_texsize_icon:C,u_texture_icon:1}),yf=(g,i,o)=>({u_matrix:g,u_opacity:i,u_color:o}),vf=(g,i,o,u,d,y)=>l.e(function(w,M,A,C){const z=A.imageManager.getPattern(w.from.toString()),O=A.imageManager.getPattern(w.to.toString()),{width:V,height:Z}=A.imageManager.getPixelSize(),W=Math.pow(2,C.tileID.overscaledZ),J=C.tileSize*Math.pow(2,A.transform.tileZoom)/W,j=J*(C.tileID.canonical.x+C.tileID.wrap*W),ot=J*C.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:O.tl,u_pattern_br_b:O.br,u_texsize:[V,Z],u_mix:M.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:O.displaySize,u_scale_a:M.fromScale,u_scale_b:M.toScale,u_tile_units_to_pixels:1/Re(C,1,A.transform.tileZoom),u_pixel_coord_upper:[j>>16,ot>>16],u_pixel_coord_lower:[65535&j,65535&ot]}}(u,y,o,d),{u_matrix:g,u_opacity:i}),iu={fillExtrusion:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_lightpos:new l.aK(g,i.u_lightpos),u_lightintensity:new l.aH(g,i.u_lightintensity),u_lightcolor:new l.aK(g,i.u_lightcolor),u_vertical_gradient:new l.aH(g,i.u_vertical_gradient),u_opacity:new l.aH(g,i.u_opacity)}),fillExtrusionPattern:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_lightpos:new l.aK(g,i.u_lightpos),u_lightintensity:new l.aH(g,i.u_lightintensity),u_lightcolor:new l.aK(g,i.u_lightcolor),u_vertical_gradient:new l.aH(g,i.u_vertical_gradient),u_height_factor:new l.aH(g,i.u_height_factor),u_image:new l.aG(g,i.u_image),u_texsize:new l.aL(g,i.u_texsize),u_pixel_coord_upper:new l.aL(g,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(g,i.u_pixel_coord_lower),u_scale:new l.aK(g,i.u_scale),u_fade:new l.aH(g,i.u_fade),u_opacity:new l.aH(g,i.u_opacity)}),fill:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix)}),fillPattern:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_image:new l.aG(g,i.u_image),u_texsize:new l.aL(g,i.u_texsize),u_pixel_coord_upper:new l.aL(g,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(g,i.u_pixel_coord_lower),u_scale:new l.aK(g,i.u_scale),u_fade:new l.aH(g,i.u_fade)}),fillOutline:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_world:new l.aL(g,i.u_world)}),fillOutlinePattern:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_world:new l.aL(g,i.u_world),u_image:new l.aG(g,i.u_image),u_texsize:new l.aL(g,i.u_texsize),u_pixel_coord_upper:new l.aL(g,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(g,i.u_pixel_coord_lower),u_scale:new l.aK(g,i.u_scale),u_fade:new l.aH(g,i.u_fade)}),circle:(g,i)=>({u_camera_to_center_distance:new l.aH(g,i.u_camera_to_center_distance),u_scale_with_map:new l.aG(g,i.u_scale_with_map),u_pitch_with_map:new l.aG(g,i.u_pitch_with_map),u_extrude_scale:new l.aL(g,i.u_extrude_scale),u_device_pixel_ratio:new l.aH(g,i.u_device_pixel_ratio),u_matrix:new l.aI(g,i.u_matrix)}),collisionBox:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_camera_to_center_distance:new l.aH(g,i.u_camera_to_center_distance),u_pixels_to_tile_units:new l.aH(g,i.u_pixels_to_tile_units),u_extrude_scale:new l.aL(g,i.u_extrude_scale),u_overscale_factor:new l.aH(g,i.u_overscale_factor)}),collisionCircle:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_inv_matrix:new l.aI(g,i.u_inv_matrix),u_camera_to_center_distance:new l.aH(g,i.u_camera_to_center_distance),u_viewport_size:new l.aL(g,i.u_viewport_size)}),debug:(g,i)=>({u_color:new l.aM(g,i.u_color),u_matrix:new l.aI(g,i.u_matrix),u_overlay:new l.aG(g,i.u_overlay),u_overlay_scale:new l.aH(g,i.u_overlay_scale)}),clippingMask:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix)}),heatmap:(g,i)=>({u_extrude_scale:new l.aH(g,i.u_extrude_scale),u_intensity:new l.aH(g,i.u_intensity),u_matrix:new l.aI(g,i.u_matrix)}),heatmapTexture:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_world:new l.aL(g,i.u_world),u_image:new l.aG(g,i.u_image),u_color_ramp:new l.aG(g,i.u_color_ramp),u_opacity:new l.aH(g,i.u_opacity)}),hillshade:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_image:new l.aG(g,i.u_image),u_latrange:new l.aL(g,i.u_latrange),u_light:new l.aL(g,i.u_light),u_shadow:new l.aM(g,i.u_shadow),u_highlight:new l.aM(g,i.u_highlight),u_accent:new l.aM(g,i.u_accent)}),hillshadePrepare:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_image:new l.aG(g,i.u_image),u_dimension:new l.aL(g,i.u_dimension),u_zoom:new l.aH(g,i.u_zoom),u_unpack:new l.aJ(g,i.u_unpack)}),line:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_ratio:new l.aH(g,i.u_ratio),u_device_pixel_ratio:new l.aH(g,i.u_device_pixel_ratio),u_units_to_pixels:new l.aL(g,i.u_units_to_pixels)}),lineGradient:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_ratio:new l.aH(g,i.u_ratio),u_device_pixel_ratio:new l.aH(g,i.u_device_pixel_ratio),u_units_to_pixels:new l.aL(g,i.u_units_to_pixels),u_image:new l.aG(g,i.u_image),u_image_height:new l.aH(g,i.u_image_height)}),linePattern:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_texsize:new l.aL(g,i.u_texsize),u_ratio:new l.aH(g,i.u_ratio),u_device_pixel_ratio:new l.aH(g,i.u_device_pixel_ratio),u_image:new l.aG(g,i.u_image),u_units_to_pixels:new l.aL(g,i.u_units_to_pixels),u_scale:new l.aK(g,i.u_scale),u_fade:new l.aH(g,i.u_fade)}),lineSDF:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_ratio:new l.aH(g,i.u_ratio),u_device_pixel_ratio:new l.aH(g,i.u_device_pixel_ratio),u_units_to_pixels:new l.aL(g,i.u_units_to_pixels),u_patternscale_a:new l.aL(g,i.u_patternscale_a),u_patternscale_b:new l.aL(g,i.u_patternscale_b),u_sdfgamma:new l.aH(g,i.u_sdfgamma),u_image:new l.aG(g,i.u_image),u_tex_y_a:new l.aH(g,i.u_tex_y_a),u_tex_y_b:new l.aH(g,i.u_tex_y_b),u_mix:new l.aH(g,i.u_mix)}),raster:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_tl_parent:new l.aL(g,i.u_tl_parent),u_scale_parent:new l.aH(g,i.u_scale_parent),u_buffer_scale:new l.aH(g,i.u_buffer_scale),u_fade_t:new l.aH(g,i.u_fade_t),u_opacity:new l.aH(g,i.u_opacity),u_image0:new l.aG(g,i.u_image0),u_image1:new l.aG(g,i.u_image1),u_brightness_low:new l.aH(g,i.u_brightness_low),u_brightness_high:new l.aH(g,i.u_brightness_high),u_saturation_factor:new l.aH(g,i.u_saturation_factor),u_contrast_factor:new l.aH(g,i.u_contrast_factor),u_spin_weights:new l.aK(g,i.u_spin_weights)}),symbolIcon:(g,i)=>({u_is_size_zoom_constant:new l.aG(g,i.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(g,i.u_is_size_feature_constant),u_size_t:new l.aH(g,i.u_size_t),u_size:new l.aH(g,i.u_size),u_camera_to_center_distance:new l.aH(g,i.u_camera_to_center_distance),u_pitch:new l.aH(g,i.u_pitch),u_rotate_symbol:new l.aG(g,i.u_rotate_symbol),u_aspect_ratio:new l.aH(g,i.u_aspect_ratio),u_fade_change:new l.aH(g,i.u_fade_change),u_matrix:new l.aI(g,i.u_matrix),u_label_plane_matrix:new l.aI(g,i.u_label_plane_matrix),u_coord_matrix:new l.aI(g,i.u_coord_matrix),u_is_text:new l.aG(g,i.u_is_text),u_pitch_with_map:new l.aG(g,i.u_pitch_with_map),u_texsize:new l.aL(g,i.u_texsize),u_texture:new l.aG(g,i.u_texture)}),symbolSDF:(g,i)=>({u_is_size_zoom_constant:new l.aG(g,i.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(g,i.u_is_size_feature_constant),u_size_t:new l.aH(g,i.u_size_t),u_size:new l.aH(g,i.u_size),u_camera_to_center_distance:new l.aH(g,i.u_camera_to_center_distance),u_pitch:new l.aH(g,i.u_pitch),u_rotate_symbol:new l.aG(g,i.u_rotate_symbol),u_aspect_ratio:new l.aH(g,i.u_aspect_ratio),u_fade_change:new l.aH(g,i.u_fade_change),u_matrix:new l.aI(g,i.u_matrix),u_label_plane_matrix:new l.aI(g,i.u_label_plane_matrix),u_coord_matrix:new l.aI(g,i.u_coord_matrix),u_is_text:new l.aG(g,i.u_is_text),u_pitch_with_map:new l.aG(g,i.u_pitch_with_map),u_texsize:new l.aL(g,i.u_texsize),u_texture:new l.aG(g,i.u_texture),u_gamma_scale:new l.aH(g,i.u_gamma_scale),u_device_pixel_ratio:new l.aH(g,i.u_device_pixel_ratio),u_is_halo:new l.aG(g,i.u_is_halo)}),symbolTextAndIcon:(g,i)=>({u_is_size_zoom_constant:new l.aG(g,i.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(g,i.u_is_size_feature_constant),u_size_t:new l.aH(g,i.u_size_t),u_size:new l.aH(g,i.u_size),u_camera_to_center_distance:new l.aH(g,i.u_camera_to_center_distance),u_pitch:new l.aH(g,i.u_pitch),u_rotate_symbol:new l.aG(g,i.u_rotate_symbol),u_aspect_ratio:new l.aH(g,i.u_aspect_ratio),u_fade_change:new l.aH(g,i.u_fade_change),u_matrix:new l.aI(g,i.u_matrix),u_label_plane_matrix:new l.aI(g,i.u_label_plane_matrix),u_coord_matrix:new l.aI(g,i.u_coord_matrix),u_is_text:new l.aG(g,i.u_is_text),u_pitch_with_map:new l.aG(g,i.u_pitch_with_map),u_texsize:new l.aL(g,i.u_texsize),u_texsize_icon:new l.aL(g,i.u_texsize_icon),u_texture:new l.aG(g,i.u_texture),u_texture_icon:new l.aG(g,i.u_texture_icon),u_gamma_scale:new l.aH(g,i.u_gamma_scale),u_device_pixel_ratio:new l.aH(g,i.u_device_pixel_ratio),u_is_halo:new l.aG(g,i.u_is_halo)}),background:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_opacity:new l.aH(g,i.u_opacity),u_color:new l.aM(g,i.u_color)}),backgroundPattern:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_opacity:new l.aH(g,i.u_opacity),u_image:new l.aG(g,i.u_image),u_pattern_tl_a:new l.aL(g,i.u_pattern_tl_a),u_pattern_br_a:new l.aL(g,i.u_pattern_br_a),u_pattern_tl_b:new l.aL(g,i.u_pattern_tl_b),u_pattern_br_b:new l.aL(g,i.u_pattern_br_b),u_texsize:new l.aL(g,i.u_texsize),u_mix:new l.aH(g,i.u_mix),u_pattern_size_a:new l.aL(g,i.u_pattern_size_a),u_pattern_size_b:new l.aL(g,i.u_pattern_size_b),u_scale_a:new l.aH(g,i.u_scale_a),u_scale_b:new l.aH(g,i.u_scale_b),u_pixel_coord_upper:new l.aL(g,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(g,i.u_pixel_coord_lower),u_tile_units_to_pixels:new l.aH(g,i.u_tile_units_to_pixels)}),terrain:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_texture:new l.aG(g,i.u_texture),u_ele_delta:new l.aH(g,i.u_ele_delta)}),terrainDepth:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_ele_delta:new l.aH(g,i.u_ele_delta)}),terrainCoords:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_texture:new l.aG(g,i.u_texture),u_terrain_coords_id:new l.aH(g,i.u_terrain_coords_id),u_ele_delta:new l.aH(g,i.u_ele_delta)})};class xf{constructor(i,o,u){this.context=i;const d=i.gl;this.buffer=d.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const o=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ln={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Bo{constructor(i,o,u,d){this.length=o.length,this.attributes=u,this.itemSize=o.bytesPerElement,this.dynamicDraw=d,this.context=i;const y=i.gl;this.buffer=y.createBuffer(),i.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){if(i.length!==this.length)throw new Error(`Length of new data is ${i.length}, which doesn't match current length of ${this.length}`);const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,o){for(let u=0;u<this.attributes.length;u++){const d=o.attributes[this.attributes[u].name];d!==void 0&&i.enableVertexAttribArray(d)}}setVertexAttribPointers(i,o,u){for(let d=0;d<this.attributes.length;d++){const y=this.attributes[d],w=o.attributes[y.name];w!==void 0&&i.vertexAttribPointer(w,y.components,i[Ln[y.type]],!1,this.itemSize,y.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const zs=new WeakMap;function Es(g){var i;if(zs.has(g))return zs.get(g);{const o=(i=g.getParameter(g.VERSION))===null||i===void 0?void 0:i.startsWith("WebGL 2.0");return zs.set(g,o),o}}class oi{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class No extends oi{getDefault(){return l.aO.transparent}set(i){const o=this.current;(i.r!==o.r||i.g!==o.g||i.b!==o.b||i.a!==o.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class $o extends oi{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class tc extends oi{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class ec extends oi{getDefault(){return[!0,!0,!0,!0]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Vo extends oi{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class ic extends oi{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class sc extends oi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const o=this.current;(i.func!==o.func||i.ref!==o.ref||i.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class Uo extends oi{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class su extends oi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=i,this.dirty=!1}}class ru extends oi{getDefault(){return[0,1]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class na extends oi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=i,this.dirty=!1}}class bf extends oi{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class wf extends oi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.BLEND):o.disable(o.BLEND),this.current=i,this.dirty=!1}}class Mf extends oi{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class Sf extends oi{getDefault(){return l.aO.transparent}set(i){const o=this.current;(i.r!==o.r||i.g!==o.g||i.b!==o.b||i.a!==o.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Tf extends oi{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class Af extends oi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=i,this.dirty=!1}}class rc extends oi{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class qo extends oi{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class nc extends oi{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class ac extends oi{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class aa extends oi{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class nu extends oi{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class au extends oi{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class oc extends oi{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class On extends oi{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class ou extends oi{getDefault(){return null}set(i){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class oa extends oi{getDefault(){return null}set(i){var o;if(i===this.current&&!this.dirty)return;const u=this.gl;Es(u)?u.bindVertexArray(i):(o=u.getExtension("OES_vertex_array_object"))===null||o===void 0||o.bindVertexArrayOES(i),this.current=i,this.dirty=!1}}class la extends oi{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class lu extends oi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class lc extends oi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class si extends oi{constructor(i,o){super(i),this.context=i,this.parent=o}getDefault(){return null}}class jo extends si{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Ef extends si{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class cu extends si{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Xa{constructor(i,o,u,d,y){this.context=i,this.width=o,this.height=u;const w=i.gl,M=this.framebuffer=w.createFramebuffer();if(this.colorAttachment=new jo(i,M),d)this.depthAttachment=y?new cu(i,M):new Ef(i,M);else if(y)throw new Error("Stencil cannot be set without depth");if(w.checkFramebufferStatus(w.FRAMEBUFFER)!==w.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const i=this.context.gl,o=this.colorAttachment.get();if(o&&i.deleteTexture(o),this.depthAttachment){const u=this.depthAttachment.get();u&&i.deleteRenderbuffer(u)}i.deleteFramebuffer(this.framebuffer)}}class Xi{constructor(i,o,u){this.blendFunction=i,this.blendColor=o,this.mask=u}}Xi.Replace=[1,0],Xi.disabled=new Xi(Xi.Replace,l.aO.transparent,[!1,!1,!1,!1]),Xi.unblended=new Xi(Xi.Replace,l.aO.transparent,[!0,!0,!0,!0]),Xi.alphaBlended=new Xi([1,771],l.aO.transparent,[!0,!0,!0,!0]);class If{constructor(i){var o,u;if(this.gl=i,this.clearColor=new No(this),this.clearDepth=new $o(this),this.clearStencil=new tc(this),this.colorMask=new ec(this),this.depthMask=new Vo(this),this.stencilMask=new ic(this),this.stencilFunc=new sc(this),this.stencilOp=new Uo(this),this.stencilTest=new su(this),this.depthRange=new ru(this),this.depthTest=new na(this),this.depthFunc=new bf(this),this.blend=new wf(this),this.blendFunc=new Mf(this),this.blendColor=new Sf(this),this.blendEquation=new Tf(this),this.cullFace=new Af(this),this.cullFaceSide=new rc(this),this.frontFace=new qo(this),this.program=new nc(this),this.activeTexture=new ac(this),this.viewport=new aa(this),this.bindFramebuffer=new nu(this),this.bindRenderbuffer=new au(this),this.bindTexture=new oc(this),this.bindVertexBuffer=new On(this),this.bindElementBuffer=new ou(this),this.bindVertexArray=new oa(this),this.pixelStoreUnpack=new la(this),this.pixelStoreUnpackPremultiplyAlpha=new lu(this),this.pixelStoreUnpackFlipY=new lc(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),Es(i)){this.HALF_FLOAT=i.HALF_FLOAT;const d=i.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(o=i.RGBA16F)!==null&&o!==void 0?o:d==null?void 0:d.RGBA16F_EXT,this.RGB16F=(u=i.RGB16F)!==null&&u!==void 0?u:d==null?void 0:d.RGB16F_EXT,i.getExtension("EXT_color_buffer_float")}else{i.getExtension("EXT_color_buffer_half_float"),i.getExtension("OES_texture_half_float_linear");const d=i.getExtension("OES_texture_half_float");this.HALF_FLOAT=d==null?void 0:d.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,o){return new xf(this,i,o)}createVertexBuffer(i,o,u){return new Bo(this,i,o,u)}createRenderbuffer(i,o,u){const d=this.gl,y=d.createRenderbuffer();return this.bindRenderbuffer.set(y),d.renderbufferStorage(d.RENDERBUFFER,i,o,u),this.bindRenderbuffer.set(null),y}createFramebuffer(i,o,u,d){return new Xa(this,i,o,u,d)}clear({color:i,depth:o,stencil:u}){const d=this.gl;let y=0;i&&(y|=d.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(y|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),u!==void 0&&(y|=d.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),d.clear(y)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){l.aD(i.blendFunction,Xi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}createVertexArray(){var i;return Es(this.gl)?this.gl.createVertexArray():(i=this.gl.getExtension("OES_vertex_array_object"))===null||i===void 0?void 0:i.createVertexArrayOES()}deleteVertexArray(i){var o;return Es(this.gl)?this.gl.deleteVertexArray(i):(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.deleteVertexArrayOES(i)}unbindVAO(){this.bindVertexArray.set(null)}}class ti{constructor(i,o,u){this.func=i,this.mask=o,this.range=u}}ti.ReadOnly=!1,ti.ReadWrite=!0,ti.disabled=new ti(519,ti.ReadOnly,[0,1]);const cc=7680;class Ai{constructor(i,o,u,d,y,w){this.test=i,this.ref=o,this.mask=u,this.fail=d,this.depthFail=y,this.pass=w}}Ai.disabled=new Ai({func:519,mask:0},0,0,cc,cc,cc);class vi{constructor(i,o,u){this.enable=i,this.mode=o,this.frontFace=u}}let Fn;function Go(g,i,o,u,d,y,w){const M=g.context,A=M.gl,C=g.useProgram("collisionBox"),z=[];let O=0,V=0;for(let et=0;et<u.length;et++){const pt=u[et],bt=i.getTile(pt),wt=bt.getBucket(o);if(!wt)continue;let St=pt.posMatrix;d[0]===0&&d[1]===0||(St=g.translatePosMatrix(pt.posMatrix,bt,d,y));const Bt=w?wt.textCollisionBox:wt.iconCollisionBox,Lt=wt.collisionCircleArray;if(Lt.length>0){const jt=l.F(),Wt=St;l.aP(jt,wt.placementInvProjMatrix,g.transform.glCoordMatrix),l.aP(jt,jt,wt.placementViewportMatrix),z.push({circleArray:Lt,circleOffset:V,transform:Wt,invTransform:jt,coord:pt}),O+=Lt.length/4,V=O}Bt&&C.draw(M,A.LINES,ti.disabled,Ai.disabled,g.colorModeForRenderPass(),vi.disabled,Yh(St,g.transform,bt),g.style.map.terrain&&g.style.map.terrain.getTerrainData(pt),o.id,Bt.layoutVertexBuffer,Bt.indexBuffer,Bt.segments,null,g.transform.zoom,null,null,Bt.collisionVertexBuffer)}if(!w||!z.length)return;const Z=g.useProgram("collisionCircle"),W=new l.aQ;W.resize(4*O),W._trim();let J=0;for(const et of z)for(let pt=0;pt<et.circleArray.length/4;pt++){const bt=4*pt,wt=et.circleArray[bt+0],St=et.circleArray[bt+1],Bt=et.circleArray[bt+2],Lt=et.circleArray[bt+3];W.emplace(J++,wt,St,Bt,Lt,0),W.emplace(J++,wt,St,Bt,Lt,1),W.emplace(J++,wt,St,Bt,Lt,2),W.emplace(J++,wt,St,Bt,Lt,3)}(!Fn||Fn.length<2*O)&&(Fn=function(et){const pt=2*et,bt=new l.aS;bt.resize(pt),bt._trim();for(let wt=0;wt<pt;wt++){const St=6*wt;bt.uint16[St+0]=4*wt+0,bt.uint16[St+1]=4*wt+1,bt.uint16[St+2]=4*wt+2,bt.uint16[St+3]=4*wt+2,bt.uint16[St+4]=4*wt+3,bt.uint16[St+5]=4*wt+0}return bt}(O));const j=M.createIndexBuffer(Fn,!0),ot=M.createVertexBuffer(W,l.aR.members,!0);for(const et of z){const pt={u_matrix:et.transform,u_inv_matrix:et.invTransform,u_camera_to_center_distance:(xt=g.transform).cameraToCenterDistance,u_viewport_size:[xt.width,xt.height]};Z.draw(M,A.TRIANGLES,ti.disabled,Ai.disabled,g.colorModeForRenderPass(),vi.disabled,pt,g.style.map.terrain&&g.style.map.terrain.getTerrainData(et.coord),o.id,ot,j,l.$.simpleSegment(0,2*et.circleOffset,et.circleArray.length,et.circleArray.length/2),null,g.transform.zoom,null,null,null)}var xt;ot.destroy(),j.destroy()}vi.disabled=new vi(!1,1029,2305),vi.backCCW=new vi(!0,1029,2305);const hc=l.an(new Float32Array(16));function hu(g,i,o,u,d,y){const{horizontalAlign:w,verticalAlign:M}=l.at(g);return new l.P((-(w-.5)*i/d+u[0])*y,(-(M-.5)*o/d+u[1])*y)}function Ho(g,i,o,u,d,y,w,M,A,C,z){const O=g.text.placedSymbolArray,V=g.text.dynamicLayoutVertexArray,Z=g.icon.dynamicLayoutVertexArray,W={};V.clear();for(let J=0;J<O.length;J++){const j=O.get(J),ot=j.hidden||!j.crossTileID||g.allowVerticalPlacement&&!j.placedOrientation?null:u[j.crossTileID];if(ot){const xt=new l.P(j.anchorX,j.anchorY),et=os(xt,o?w:y,z),pt=Y(d.cameraToCenterDistance,et.signedDistanceFromCamera);let bt=l.ai(g.textSizeData,A,j)*pt/l.ao;o&&(bt*=g.tilePixelRatio/M);const{width:wt,height:St,anchor:Bt,textOffset:Lt,textBoxScale:jt}=ot,Wt=hu(Bt,wt,St,Lt,jt,bt),$e=o?os(xt.add(Wt),y,z).point:et.point.add(i?Wt.rotate(-d.angle):Wt),Kt=g.allowVerticalPlacement&&j.placedOrientation===l.ah.vertical?Math.PI/2:0;for(let Ie=0;Ie<j.numGlyphs;Ie++)l.aj(V,$e,Kt);C&&j.associatedIconIndex>=0&&(W[j.associatedIconIndex]={shiftedAnchor:$e,angle:Kt})}else It(j.numGlyphs,V)}if(C){Z.clear();const J=g.icon.placedSymbolArray;for(let j=0;j<J.length;j++){const ot=J.get(j);if(ot.hidden)It(ot.numGlyphs,Z);else{const xt=W[j];if(xt)for(let et=0;et<ot.numGlyphs;et++)l.aj(Z,xt.shiftedAnchor,xt.angle);else It(ot.numGlyphs,Z)}}g.icon.dynamicLayoutVertexBuffer.updateData(Z)}g.text.dynamicLayoutVertexBuffer.updateData(V)}function Wo(g,i,o){return o.iconsInText&&i?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function Zo(g,i,o,u,d,y,w,M,A,C,z,O){const V=g.context,Z=V.gl,W=g.transform,J=M==="map",j=A==="map",ot=M!=="viewport"&&o.layout.get("symbol-placement")!=="point",xt=J&&!j&&!ot,et=!o.layout.get("symbol-sort-key").isConstant();let pt=!1;const bt=g.depthModeForSublayer(0,ti.ReadOnly),wt=o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"),St=[];for(const Bt of u){const Lt=i.getTile(Bt),jt=Lt.getBucket(o);if(!jt)continue;const Wt=d?jt.text:jt.icon;if(!Wt||!Wt.segments.get().length||!Wt.hasVisibleVertices)continue;const $e=Wt.programConfigurations.get(o.id),Kt=d||jt.sdfIcons,Ie=d?jt.textSizeData:jt.iconSizeData,Ve=j||W.pitch!==0,ei=g.useProgram(Wo(Kt,d,jt),$e),ke=l.ag(Ie,W.zoom),je=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Bt);let He,qi,mi,rr,cs=[0,0],Fi=null;if(d)qi=Lt.glyphAtlasTexture,mi=Z.LINEAR,He=Lt.glyphAtlasTexture.size,jt.iconsInText&&(cs=Lt.imageAtlasTexture.size,Fi=Lt.imageAtlasTexture,rr=Ve||g.options.rotating||g.options.zooming||Ie.kind==="composite"||Ie.kind==="camera"?Z.LINEAR:Z.NEAREST);else{const is=o.layout.get("icon-size").constantOr(0)!==1||jt.iconsNeedLinear;qi=Lt.imageAtlasTexture,mi=Kt||g.options.rotating||g.options.zooming||is||Ve?Z.LINEAR:Z.NEAREST,He=Lt.imageAtlasTexture.size}const hs=Re(Lt,1,g.transform.zoom),nr=Be(Bt.posMatrix,j,J,g.transform,hs),Vr=Rn(Bt.posMatrix,j,J,g.transform,hs),_n=wt&&jt.hasTextData(),lo=o.layout.get("icon-text-fit")!=="none"&&_n&&jt.hasIconData();if(ot){const is=g.style.map.terrain?(yr,ss)=>g.style.map.terrain.getElevation(Bt,yr,ss):null,Ni=o.layout.get("text-rotation-alignment")==="map";N(jt,Bt.posMatrix,g,d,nr,Vr,j,C,Ni,is)}const yn=g.translatePosMatrix(Bt.posMatrix,Lt,y,w),Ur=ot||d&&wt||lo?hc:nr,es=g.translatePosMatrix(Vr,Lt,y,w,!0),Bi=Kt&&o.paint.get(d?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ri;Ri=Kt?jt.iconsInText?Za(Ie.kind,ke,xt,j,g,yn,Ur,es,He,cs):Wa(Ie.kind,ke,xt,j,g,yn,Ur,es,d,He,!0):Ha(Ie.kind,ke,xt,j,g,yn,Ur,es,d,He);const _r={program:ei,buffers:Wt,uniformValues:Ri,atlasTexture:qi,atlasTextureIcon:Fi,atlasInterpolation:mi,atlasInterpolationIcon:rr,isSDF:Kt,hasHalo:Bi};if(et&&jt.canOverlap){pt=!0;const is=Wt.segments.get();for(const Ni of is)St.push({segments:new l.$([Ni]),sortKey:Ni.sortKey,state:_r,terrainData:je})}else St.push({segments:Wt.segments,sortKey:0,state:_r,terrainData:je})}pt&&St.sort((Bt,Lt)=>Bt.sortKey-Lt.sortKey);for(const Bt of St){const Lt=Bt.state;if(V.activeTexture.set(Z.TEXTURE0),Lt.atlasTexture.bind(Lt.atlasInterpolation,Z.CLAMP_TO_EDGE),Lt.atlasTextureIcon&&(V.activeTexture.set(Z.TEXTURE1),Lt.atlasTextureIcon&&Lt.atlasTextureIcon.bind(Lt.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),Lt.isSDF){const jt=Lt.uniformValues;Lt.hasHalo&&(jt.u_is_halo=1,uu(Lt.buffers,Bt.segments,o,g,Lt.program,bt,z,O,jt,Bt.terrainData)),jt.u_is_halo=0}uu(Lt.buffers,Bt.segments,o,g,Lt.program,bt,z,O,Lt.uniformValues,Bt.terrainData)}}function uu(g,i,o,u,d,y,w,M,A,C){const z=u.context;d.draw(z,z.gl.TRIANGLES,y,w,M,vi.disabled,A,C,o.id,g.layoutVertexBuffer,g.indexBuffer,i,o.paint,u.transform.zoom,g.programConfigurations.get(o.id),g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer)}function Xo(g,i,o,u,d){if(!o||!u||!u.imageAtlas)return;const y=u.imageAtlas.patternPositions;let w=y[o.to.toString()],M=y[o.from.toString()];if(!w&&M&&(w=M),!M&&w&&(M=w),!w||!M){const A=d.getPaintProperty(i);w=y[A],M=y[A]}w&&M&&g.setConstantPatternPositions(w,M)}function du(g,i,o,u,d,y,w){const M=g.context.gl,A="fill-pattern",C=o.paint.get(A),z=C&&C.constantOr(1),O=o.getCrossfadeParameters();let V,Z,W,J,j;w?(Z=z&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",V=M.LINES):(Z=z?"fillPattern":"fill",V=M.TRIANGLES);const ot=C.constantOr(null);for(const xt of u){const et=i.getTile(xt);if(z&&!et.patternsLoaded())continue;const pt=et.getBucket(o);if(!pt)continue;const bt=pt.programConfigurations.get(o.id),wt=g.useProgram(Z,bt),St=g.style.map.terrain&&g.style.map.terrain.getTerrainData(xt);z&&(g.context.activeTexture.set(M.TEXTURE0),et.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),bt.updatePaintBuffers(O)),Xo(bt,A,ot,et,o);const Bt=St?xt:null,Lt=g.translatePosMatrix(Bt?Bt.posMatrix:xt.posMatrix,et,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(w){J=pt.indexBuffer2,j=pt.segments2;const jt=[M.drawingBufferWidth,M.drawingBufferHeight];W=Z==="fillOutlinePattern"&&z?Kh(Lt,g,O,et,jt):gf(Lt,jt)}else J=pt.indexBuffer,j=pt.segments,W=z?Ro(Lt,g,O,et):Xh(Lt);wt.draw(g.context,V,d,g.stencilModeForClipping(xt),y,vi.disabled,W,St,o.id,pt.layoutVertexBuffer,J,j,o.paint,g.transform.zoom,bt)}}function Ko(g,i,o,u,d,y,w){const M=g.context,A=M.gl,C="fill-extrusion-pattern",z=o.paint.get(C),O=z.constantOr(1),V=o.getCrossfadeParameters(),Z=o.paint.get("fill-extrusion-opacity"),W=z.constantOr(null);for(const J of u){const j=i.getTile(J),ot=j.getBucket(o);if(!ot)continue;const xt=g.style.map.terrain&&g.style.map.terrain.getTerrainData(J),et=ot.programConfigurations.get(o.id),pt=g.useProgram(O?"fillExtrusionPattern":"fillExtrusion",et);O&&(g.context.activeTexture.set(A.TEXTURE0),j.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),et.updatePaintBuffers(V)),Xo(et,C,W,j,o);const bt=g.translatePosMatrix(J.posMatrix,j,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),wt=o.paint.get("fill-extrusion-vertical-gradient"),St=O?mf(bt,g,wt,Z,J,V,j):qa(bt,g,wt,Z);pt.draw(M,M.gl.TRIANGLES,d,y,w,vi.backCCW,St,xt,o.id,ot.layoutVertexBuffer,ot.indexBuffer,ot.segments,o.paint,g.transform.zoom,et,g.style.map.terrain&&ot.centroidVertexBuffer)}}function Yo(g,i,o,u,d,y,w){const M=g.context,A=M.gl,C=o.fbo;if(!C)return;const z=g.useProgram("hillshade"),O=g.style.map.terrain&&g.style.map.terrain.getTerrainData(i);M.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,C.colorAttachment.get()),z.draw(M,A.TRIANGLES,d,y,w,vi.disabled,((V,Z,W,J)=>{const j=W.paint.get("hillshade-shadow-color"),ot=W.paint.get("hillshade-highlight-color"),xt=W.paint.get("hillshade-accent-color");let et=W.paint.get("hillshade-illumination-direction")*(Math.PI/180);W.paint.get("hillshade-illumination-anchor")==="viewport"&&(et-=V.transform.angle);const pt=!V.options.moving;return{u_matrix:J?J.posMatrix:V.transform.calculatePosMatrix(Z.tileID.toUnwrapped(),pt),u_image:0,u_latrange:tu(0,Z.tileID),u_light:[W.paint.get("hillshade-exaggeration"),et],u_shadow:j,u_highlight:ot,u_accent:xt}})(g,o,u,O?i:null),O,u.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments)}function uc(g,i,o,u,d,y){const w=g.context,M=w.gl,A=i.dem;if(A&&A.data){const C=A.dim,z=A.stride,O=A.getPixels();if(w.activeTexture.set(M.TEXTURE1),w.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||g.getTileTexture(z),i.demTexture){const Z=i.demTexture;Z.update(O,{premultiply:!1}),Z.bind(M.NEAREST,M.CLAMP_TO_EDGE)}else i.demTexture=new xe(w,O,M.RGBA,{premultiply:!1}),i.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE);w.activeTexture.set(M.TEXTURE0);let V=i.fbo;if(!V){const Z=new xe(w,{width:C,height:C,data:null},M.RGBA);Z.bind(M.LINEAR,M.CLAMP_TO_EDGE),V=i.fbo=w.createFramebuffer(C,C,!0,!1),V.colorAttachment.set(Z.texture)}w.bindFramebuffer.set(V.framebuffer),w.viewport.set([0,0,C,C]),g.useProgram("hillshadePrepare").draw(w,M.TRIANGLES,u,d,y,vi.disabled,((Z,W)=>{const J=W.stride,j=l.F();return l.aN(j,0,l.W,-l.W,0,0,1),l.H(j,j,[0,-l.W,0]),{u_matrix:j,u_image:1,u_dimension:[J,J],u_zoom:Z.overscaledZ,u_unpack:W.getUnpackVector()}})(i.tileID,A),null,o.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments),i.needsHillshadePrepare=!1}}function fu(g,i,o,u,d,y){const w=u.paint.get("raster-fade-duration");if(!y&&w>0){const M=P.now(),A=(M-g.timeAdded)/w,C=i?(M-i.timeAdded)/w:-1,z=o.getSource(),O=d.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),V=!i||Math.abs(i.tileID.overscaledZ-O)>Math.abs(g.tileID.overscaledZ-O),Z=V&&g.refreshedUponExpiration?1:l.ac(V?A:1-C,0,1);return g.refreshedUponExpiration&&A>=1&&(g.refreshedUponExpiration=!1),i?{opacity:1,mix:1-Z}:{opacity:Z,mix:0}}return{opacity:1,mix:0}}const pu=new l.aO(1,0,0,1),Jo=new l.aO(0,1,0,1),dc=new l.aO(0,0,1,1),Pf=new l.aO(1,0,1,1),mu=new l.aO(0,1,1,1);function Vi(g,i,o,u){Ls(g,0,i+o/2,g.transform.width,o,u)}function fn(g,i,o,u){Ls(g,i-o/2,0,o,g.transform.height,u)}function Ls(g,i,o,u,d,y){const w=g.context,M=w.gl;M.enable(M.SCISSOR_TEST),M.scissor(i*g.pixelRatio,o*g.pixelRatio,u*g.pixelRatio,d*g.pixelRatio),w.clear({color:y}),M.disable(M.SCISSOR_TEST)}function fc(g,i,o){const u=g.context,d=u.gl,y=o.posMatrix,w=g.useProgram("debug"),M=ti.disabled,A=Ai.disabled,C=g.colorModeForRenderPass(),z="$debug",O=g.style.map.terrain&&g.style.map.terrain.getTerrainData(o);u.activeTexture.set(d.TEXTURE0);const V=i.getTileByID(o.key).latestRawTileData,Z=Math.floor((V&&V.byteLength||0)/1024),W=i.getTile(o).tileSize,J=512/Math.min(W,512)*(o.overscaledZ/g.transform.zoom)*.5;let j=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(j+=` => ${o.overscaledZ}`),function(ot,xt){ot.initDebugOverlayCanvas();const et=ot.debugOverlayCanvas,pt=ot.context.gl,bt=ot.debugOverlayCanvas.getContext("2d");bt.clearRect(0,0,et.width,et.height),bt.shadowColor="white",bt.shadowBlur=2,bt.lineWidth=1.5,bt.strokeStyle="white",bt.textBaseline="top",bt.font="bold 36px Open Sans, sans-serif",bt.fillText(xt,5,5),bt.strokeText(xt,5,5),ot.debugOverlayTexture.update(et),ot.debugOverlayTexture.bind(pt.LINEAR,pt.CLAMP_TO_EDGE)}(g,`${j} ${Z}kB`),w.draw(u,d.TRIANGLES,M,A,Xi.alphaBlended,vi.disabled,Jh(y,l.aO.transparent,J),null,z,g.debugBuffer,g.quadTriangleIndexBuffer,g.debugSegments),w.draw(u,d.LINE_STRIP,M,A,C,vi.disabled,Jh(y,l.aO.red),O,z,g.debugBuffer,g.tileBorderIndexBuffer,g.debugSegments)}function Qo(g,i,o){const u=g.context,d=u.gl,y=g.colorModeForRenderPass(),w=new ti(d.LEQUAL,ti.ReadWrite,g.depthRangeFor3D),M=g.useProgram("terrain"),A=i.getTerrainMesh();u.bindFramebuffer.set(null),u.viewport.set([0,0,g.width,g.height]);for(const C of o){const z=g.renderToTexture.getTexture(C),O=i.getTerrainData(C.tileID);u.activeTexture.set(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,z.texture);const V={u_matrix:g.transform.calculatePosMatrix(C.tileID.toUnwrapped()),u_texture:0,u_ele_delta:i.getMeshFrameDelta(g.transform.zoom)};M.draw(u,d.TRIANGLES,w,Ai.disabled,y,vi.backCCW,V,O,"terrain",A.vertexBuffer,A.indexBuffer,A.segments)}}class gu{constructor(i,o){this.context=new If(i),this.transform=o,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=as.maxUnderzooming+as.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new un}resize(i,o,u){if(this.width=Math.floor(i*u),this.height=Math.floor(o*u),this.pixelRatio=u,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style._order)this.style._layers[d].resize()}setup(){const i=this.context,o=new l.aV;o.emplaceBack(0,0),o.emplaceBack(l.W,0),o.emplaceBack(0,l.W),o.emplaceBack(l.W,l.W),this.tileExtentBuffer=i.createVertexBuffer(o,Co.members),this.tileExtentSegments=l.$.simpleSegment(0,0,4,2);const u=new l.aV;u.emplaceBack(0,0),u.emplaceBack(l.W,0),u.emplaceBack(0,l.W),u.emplaceBack(l.W,l.W),this.debugBuffer=i.createVertexBuffer(u,Co.members),this.debugSegments=l.$.simpleSegment(0,0,4,5);const d=new l.Z;d.emplaceBack(0,0,0,0),d.emplaceBack(l.W,0,l.W,0),d.emplaceBack(0,l.W,0,l.W),d.emplaceBack(l.W,l.W,l.W,l.W),this.rasterBoundsBuffer=i.createVertexBuffer(d,Pt.members),this.rasterBoundsSegments=l.$.simpleSegment(0,0,4,2);const y=new l.aV;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(y,Co.members),this.viewportSegments=l.$.simpleSegment(0,0,4,2);const w=new l.aW;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=i.createIndexBuffer(w);const M=new l.aX;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(M);const A=this.context.gl;this.stencilClearMode=new Ai({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO)}clearStencil(){const i=this.context,o=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const u=l.F();l.aN(u,0,this.width,this.height,0,0,1),l.J(u,u,[o.drawingBufferWidth,o.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(i,o.TRIANGLES,ti.disabled,this.stencilClearMode,Xi.disabled,vi.disabled,zo(u),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(i,o){if(this.currentStencilSource===i.source||!i.isTileClipped()||!o||!o.length)return;this.currentStencilSource=i.source;const u=this.context,d=u.gl;this.nextStencilID+o.length>256&&this.clearStencil(),u.setColorMode(Xi.disabled),u.setDepthMode(ti.disabled);const y=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const w of o){const M=this._tileClippingMaskIDs[w.key]=this.nextStencilID++,A=this.style.map.terrain&&this.style.map.terrain.getTerrainData(w);y.draw(u,d.TRIANGLES,ti.disabled,new Ai({func:d.ALWAYS,mask:0},M,255,d.KEEP,d.KEEP,d.REPLACE),Xi.disabled,vi.disabled,zo(w.posMatrix),A,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,o=this.context.gl;return new Ai({func:o.NOTEQUAL,mask:255},i,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(i){const o=this.context.gl;return new Ai({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(i){const o=this.context.gl,u=i.sort((w,M)=>M.overscaledZ-w.overscaledZ),d=u[u.length-1].overscaledZ,y=u[0].overscaledZ-d+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const w={};for(let M=0;M<y;M++)w[M+d]=new Ai({func:o.GEQUAL,mask:255},M+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=y,[w,u]}return[{[d]:Ai.disabled},u]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new Xi([i.CONSTANT_COLOR,i.ONE],new l.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Xi.unblended:Xi.alphaBlended}depthModeForSublayer(i,o,u){if(!this.opaquePassEnabledForLayer())return ti.disabled;const d=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new ti(u||this.context.gl.LEQUAL,o,[d,d])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,o){this.style=i,this.options=o,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(P.now()),this.imageManager.beginFrame();const u=this.style._order,d=this.style.sourceCaches,y={},w={},M={};for(const A in d){const C=d[A];C.used&&C.prepare(this.context),y[A]=C.getVisibleCoordinates(),w[A]=y[A].slice().reverse(),M[A]=C.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let A=0;A<u.length;A++)if(this.style._layers[u[A]].is3D()){this.opaquePassCutoff=A;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const A of u){const C=this.style._layers[A];if(!C.hasOffscreenPass()||C.isHidden(this.transform.zoom))continue;const z=w[C.source];(C.type==="custom"||z.length)&&this.renderLayer(this,d[C.source],C,z)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:o.showOverdrawInspector?l.aO.black:l.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.depthRangeFor3D=[0,1-(i._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=u.length-1;this.currentLayer>=0;this.currentLayer--){const A=this.style._layers[u[this.currentLayer]],C=d[A.source],z=y[A.source];this._renderTileClippingMasks(A,z),this.renderLayer(this,C,A,z)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<u.length;this.currentLayer++){const A=this.style._layers[u[this.currentLayer]],C=d[A.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(A))continue;const z=(A.type==="symbol"?M:w)[A.source];this._renderTileClippingMasks(A,y[A.source]),this.renderLayer(this,C,A,z)}if(this.options.showTileBoundaries){const A=function(C,z){let O=null;const V=Object.values(C._layers).flatMap(j=>j.source&&!j.isHidden(z)?[C.sourceCaches[j.source]]:[]),Z=V.filter(j=>j.getSource().type==="vector"),W=V.filter(j=>j.getSource().type!=="vector"),J=j=>{(!O||O.getSource().maxzoom<j.getSource().maxzoom)&&(O=j)};return Z.forEach(j=>J(j)),O||W.forEach(j=>J(j)),O}(this.style,this.transform.zoom);A&&function(C,z,O){for(let V=0;V<O.length;V++)fc(C,z,O[V])}(this,A,A.getVisibleCoordinates())}this.options.showPadding&&function(A){const C=A.transform.padding;Vi(A,A.transform.height-(C.top||0),3,pu),Vi(A,C.bottom||0,3,Jo),fn(A,C.left||0,3,dc),fn(A,A.transform.width-(C.right||0),3,Pf);const z=A.transform.centerPoint;(function(O,V,Z,W){Ls(O,V-1,Z-10,2,20,W),Ls(O,V-10,Z-1,20,2,W)})(A,z.x,A.transform.height-z.y,mu)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(i){if(!this.style||!this.style.map||!this.style.map.terrain)return;const o=this.terrainFacilitator.matrix,u=this.transform.projMatrix;let d=this.terrainFacilitator.dirty;d||(d=i?!l.aY(o,u):!l.aZ(o,u)),d||(d=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),d&&(l.a_(o,u),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(y,w){const M=y.context,A=M.gl,C=Xi.unblended,z=new ti(A.LEQUAL,ti.ReadWrite,[0,1]),O=w.getTerrainMesh(),V=w.sourceCache.getRenderableTiles(),Z=y.useProgram("terrainDepth");M.bindFramebuffer.set(w.getFramebuffer("depth").framebuffer),M.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),M.clear({color:l.aO.transparent,depth:1});for(const W of V){const J=w.getTerrainData(W.tileID),j={u_matrix:y.transform.calculatePosMatrix(W.tileID.toUnwrapped()),u_ele_delta:w.getMeshFrameDelta(y.transform.zoom)};Z.draw(M,A.TRIANGLES,z,Ai.disabled,C,vi.backCCW,j,J,"terrain",O.vertexBuffer,O.indexBuffer,O.segments)}M.bindFramebuffer.set(null),M.viewport.set([0,0,y.width,y.height])}(this,this.style.map.terrain),function(y,w){const M=y.context,A=M.gl,C=Xi.unblended,z=new ti(A.LEQUAL,ti.ReadWrite,[0,1]),O=w.getTerrainMesh(),V=w.getCoordsTexture(),Z=w.sourceCache.getRenderableTiles(),W=y.useProgram("terrainCoords");M.bindFramebuffer.set(w.getFramebuffer("coords").framebuffer),M.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),M.clear({color:l.aO.transparent,depth:1}),w.coordsIndex=[];for(const J of Z){const j=w.getTerrainData(J.tileID);M.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,V.texture);const ot={u_matrix:y.transform.calculatePosMatrix(J.tileID.toUnwrapped()),u_terrain_coords_id:(255-w.coordsIndex.length)/255,u_texture:0,u_ele_delta:w.getMeshFrameDelta(y.transform.zoom)};W.draw(M,A.TRIANGLES,z,Ai.disabled,C,vi.backCCW,ot,j,"terrain",O.vertexBuffer,O.indexBuffer,O.segments),w.coordsIndex.push(J.tileID.key)}M.bindFramebuffer.set(null),M.viewport.set([0,0,y.width,y.height])}(this,this.style.map.terrain))}renderLayer(i,o,u,d){if(!u.isHidden(this.transform.zoom)&&(u.type==="background"||u.type==="custom"||(d||[]).length))switch(this.id=u.id,u.type){case"symbol":(function(y,w,M,A,C){if(y.renderPass!=="translucent")return;const z=Ai.disabled,O=y.colorModeForRenderPass();(M._unevaluatedLayout.hasValue("text-variable-anchor")||M._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(V,Z,W,J,j,ot,xt){const et=Z.transform,pt=j==="map",bt=ot==="map";for(const wt of V){const St=J.getTile(wt),Bt=St.getBucket(W);if(!Bt||!Bt.text||!Bt.text.segments.get().length)continue;const Lt=l.ag(Bt.textSizeData,et.zoom),jt=Re(St,1,Z.transform.zoom),Wt=Be(wt.posMatrix,bt,pt,Z.transform,jt),$e=W.layout.get("icon-text-fit")!=="none"&&Bt.hasIconData();if(Lt){const Kt=Math.pow(2,et.zoom-St.tileID.overscaledZ);Ho(Bt,pt,bt,xt,et,Wt,wt.posMatrix,Kt,Lt,$e,Z.style.map.terrain?(Ie,Ve)=>Z.style.map.terrain.getElevation(wt,Ie,Ve):null)}}}(A,y,M,w,M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),C),M.paint.get("icon-opacity").constantOr(1)!==0&&Zo(y,w,M,A,!1,M.paint.get("icon-translate"),M.paint.get("icon-translate-anchor"),M.layout.get("icon-rotation-alignment"),M.layout.get("icon-pitch-alignment"),M.layout.get("icon-keep-upright"),z,O),M.paint.get("text-opacity").constantOr(1)!==0&&Zo(y,w,M,A,!0,M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),M.layout.get("text-keep-upright"),z,O),w.map.showCollisionBoxes&&(Go(y,w,M,A,M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),!0),Go(y,w,M,A,M.paint.get("icon-translate"),M.paint.get("icon-translate-anchor"),!1))})(i,o,u,d,this.style.placement.variableOffsets);break;case"circle":(function(y,w,M,A){if(y.renderPass!=="translucent")return;const C=M.paint.get("circle-opacity"),z=M.paint.get("circle-stroke-width"),O=M.paint.get("circle-stroke-opacity"),V=!M.layout.get("circle-sort-key").isConstant();if(C.constantOr(1)===0&&(z.constantOr(1)===0||O.constantOr(1)===0))return;const Z=y.context,W=Z.gl,J=y.depthModeForSublayer(0,ti.ReadOnly),j=Ai.disabled,ot=y.colorModeForRenderPass(),xt=[];for(let et=0;et<A.length;et++){const pt=A[et],bt=w.getTile(pt),wt=bt.getBucket(M);if(!wt)continue;const St=wt.programConfigurations.get(M.id),Bt=y.useProgram("circle",St),Lt=wt.layoutVertexBuffer,jt=wt.indexBuffer,Wt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(pt),$e={programConfiguration:St,program:Bt,layoutVertexBuffer:Lt,indexBuffer:jt,uniformValues:_f(y,pt,bt,M),terrainData:Wt};if(V){const Kt=wt.segments.get();for(const Ie of Kt)xt.push({segments:new l.$([Ie]),sortKey:Ie.sortKey,state:$e})}else xt.push({segments:wt.segments,sortKey:0,state:$e})}V&&xt.sort((et,pt)=>et.sortKey-pt.sortKey);for(const et of xt){const{programConfiguration:pt,program:bt,layoutVertexBuffer:wt,indexBuffer:St,uniformValues:Bt,terrainData:Lt}=et.state;bt.draw(Z,W.TRIANGLES,J,j,ot,vi.disabled,Bt,Lt,M.id,wt,St,et.segments,M.paint,y.transform.zoom,pt)}})(i,o,u,d);break;case"heatmap":(function(y,w,M,A){if(M.paint.get("heatmap-opacity")!==0)if(y.renderPass==="offscreen"){const C=y.context,z=C.gl,O=Ai.disabled,V=new Xi([z.ONE,z.ONE],l.aO.transparent,[!0,!0,!0,!0]);(function(Z,W,J){const j=Z.gl;Z.activeTexture.set(j.TEXTURE1),Z.viewport.set([0,0,W.width/4,W.height/4]);let ot=J.heatmapFbo;if(ot)j.bindTexture(j.TEXTURE_2D,ot.colorAttachment.get()),Z.bindFramebuffer.set(ot.framebuffer);else{const xt=j.createTexture();j.bindTexture(j.TEXTURE_2D,xt),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,j.LINEAR),ot=J.heatmapFbo=Z.createFramebuffer(W.width/4,W.height/4,!1,!1),function(et,pt,bt,wt){var St,Bt;const Lt=et.gl,jt=(St=et.HALF_FLOAT)!==null&&St!==void 0?St:Lt.UNSIGNED_BYTE,Wt=(Bt=et.RGBA16F)!==null&&Bt!==void 0?Bt:Lt.RGBA;Lt.texImage2D(Lt.TEXTURE_2D,0,Wt,pt.width/4,pt.height/4,0,Lt.RGBA,jt,null),wt.colorAttachment.set(bt)}(Z,W,xt,ot)}})(C,y,M),C.clear({color:l.aO.transparent});for(let Z=0;Z<A.length;Z++){const W=A[Z];if(w.hasRenderableParent(W))continue;const J=w.getTile(W),j=J.getBucket(M);if(!j)continue;const ot=j.programConfigurations.get(M.id),xt=y.useProgram("heatmap",ot),{zoom:et}=y.transform;xt.draw(C,z.TRIANGLES,ti.disabled,O,V,vi.disabled,Qh(W.posMatrix,J,et,M.paint.get("heatmap-intensity")),null,M.id,j.layoutVertexBuffer,j.indexBuffer,j.segments,M.paint,y.transform.zoom,ot)}C.viewport.set([0,0,y.width,y.height])}else y.renderPass==="translucent"&&(y.context.setColorMode(y.colorModeForRenderPass()),function(C,z){const O=C.context,V=O.gl,Z=z.heatmapFbo;if(!Z)return;O.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,Z.colorAttachment.get()),O.activeTexture.set(V.TEXTURE1);let W=z.colorRampTexture;W||(W=z.colorRampTexture=new xe(O,z.colorRamp,V.RGBA)),W.bind(V.LINEAR,V.CLAMP_TO_EDGE),C.useProgram("heatmapTexture").draw(O,V.TRIANGLES,ti.disabled,Ai.disabled,C.colorModeForRenderPass(),vi.disabled,((J,j,ot,xt)=>{const et=l.F();l.aN(et,0,J.width,J.height,0,0,1);const pt=J.context.gl;return{u_matrix:et,u_world:[pt.drawingBufferWidth,pt.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:j.paint.get("heatmap-opacity")}})(C,z),null,z.id,C.viewportBuffer,C.quadTriangleIndexBuffer,C.viewportSegments,z.paint,C.transform.zoom)}(y,M))})(i,o,u,d);break;case"line":(function(y,w,M,A){if(y.renderPass!=="translucent")return;const C=M.paint.get("line-opacity"),z=M.paint.get("line-width");if(C.constantOr(1)===0||z.constantOr(1)===0)return;const O=y.depthModeForSublayer(0,ti.ReadOnly),V=y.colorModeForRenderPass(),Z=M.paint.get("line-dasharray"),W=M.paint.get("line-pattern"),J=W.constantOr(1),j=M.paint.get("line-gradient"),ot=M.getCrossfadeParameters(),xt=J?"linePattern":Z?"lineSDF":j?"lineGradient":"line",et=y.context,pt=et.gl;let bt=!0;for(const wt of A){const St=w.getTile(wt);if(J&&!St.patternsLoaded())continue;const Bt=St.getBucket(M);if(!Bt)continue;const Lt=Bt.programConfigurations.get(M.id),jt=y.context.program.get(),Wt=y.useProgram(xt,Lt),$e=bt||Wt.program!==jt,Kt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(wt),Ie=W.constantOr(null);if(Ie&&St.imageAtlas){const ke=St.imageAtlas,je=ke.patternPositions[Ie.to.toString()],He=ke.patternPositions[Ie.from.toString()];je&&He&&Lt.setConstantPatternPositions(je,He)}const Ve=Kt?wt:null,ei=J?zn(y,St,M,ot,Ve):Z?Oo(y,St,M,Z,ot,Ve):j?eu(y,St,M,Bt.lineClipsArray.length,Ve):Lo(y,St,M,Ve);if(J)et.activeTexture.set(pt.TEXTURE0),St.imageAtlasTexture.bind(pt.LINEAR,pt.CLAMP_TO_EDGE),Lt.updatePaintBuffers(ot);else if(Z&&($e||y.lineAtlas.dirty))et.activeTexture.set(pt.TEXTURE0),y.lineAtlas.bind(et);else if(j){const ke=Bt.gradients[M.id];let je=ke.texture;if(M.gradientVersion!==ke.version){let He=256;if(M.stepInterpolant){const qi=w.getSource().maxzoom,mi=wt.canonical.z===qi?Math.ceil(1<<y.transform.maxZoom-wt.canonical.z):1;He=l.ac(l.aT(Bt.maxLineLength/l.W*1024*mi),256,et.maxTextureSize)}ke.gradient=l.aU({expression:M.gradientExpression(),evaluationKey:"lineProgress",resolution:He,image:ke.gradient||void 0,clips:Bt.lineClipsArray}),ke.texture?ke.texture.update(ke.gradient):ke.texture=new xe(et,ke.gradient,pt.RGBA),ke.version=M.gradientVersion,je=ke.texture}et.activeTexture.set(pt.TEXTURE0),je.bind(M.stepInterpolant?pt.NEAREST:pt.LINEAR,pt.CLAMP_TO_EDGE)}Wt.draw(et,pt.TRIANGLES,O,y.stencilModeForClipping(wt),V,vi.disabled,ei,Kt,M.id,Bt.layoutVertexBuffer,Bt.indexBuffer,Bt.segments,M.paint,y.transform.zoom,Lt,Bt.layoutVertexBuffer2),bt=!1}})(i,o,u,d);break;case"fill":(function(y,w,M,A){const C=M.paint.get("fill-color"),z=M.paint.get("fill-opacity");if(z.constantOr(1)===0)return;const O=y.colorModeForRenderPass(),V=M.paint.get("fill-pattern"),Z=y.opaquePassEnabledForLayer()&&!V.constantOr(1)&&C.constantOr(l.aO.transparent).a===1&&z.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===Z){const W=y.depthModeForSublayer(1,y.renderPass==="opaque"?ti.ReadWrite:ti.ReadOnly);du(y,w,M,A,W,O,!1)}if(y.renderPass==="translucent"&&M.paint.get("fill-antialias")){const W=y.depthModeForSublayer(M.getPaintProperty("fill-outline-color")?2:0,ti.ReadOnly);du(y,w,M,A,W,O,!0)}})(i,o,u,d);break;case"fill-extrusion":(function(y,w,M,A){const C=M.paint.get("fill-extrusion-opacity");if(C!==0&&y.renderPass==="translucent"){const z=new ti(y.context.gl.LEQUAL,ti.ReadWrite,y.depthRangeFor3D);if(C!==1||M.paint.get("fill-extrusion-pattern").constantOr(1))Ko(y,w,M,A,z,Ai.disabled,Xi.disabled),Ko(y,w,M,A,z,y.stencilModeFor3D(),y.colorModeForRenderPass());else{const O=y.colorModeForRenderPass();Ko(y,w,M,A,z,Ai.disabled,O)}}})(i,o,u,d);break;case"hillshade":(function(y,w,M,A){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const C=y.context,z=y.depthModeForSublayer(0,ti.ReadOnly),O=y.colorModeForRenderPass(),[V,Z]=y.renderPass==="translucent"?y.stencilConfigForOverlap(A):[{},A];for(const W of Z){const J=w.getTile(W);J.needsHillshadePrepare!==void 0&&J.needsHillshadePrepare&&y.renderPass==="offscreen"?uc(y,J,M,z,Ai.disabled,O):y.renderPass==="translucent"&&Yo(y,W,J,M,z,V[W.overscaledZ],O)}C.viewport.set([0,0,y.width,y.height])})(i,o,u,d);break;case"raster":(function(y,w,M,A){if(y.renderPass!=="translucent"||M.paint.get("raster-opacity")===0||!A.length)return;const C=y.context,z=C.gl,O=w.getSource(),V=y.useProgram("raster"),Z=y.colorModeForRenderPass(),[W,J]=O instanceof qt?[{},A]:y.stencilConfigForOverlap(A),j=J[J.length-1].overscaledZ,ot=!y.options.moving;for(const xt of J){const et=y.depthModeForSublayer(xt.overscaledZ-j,M.paint.get("raster-opacity")===1?ti.ReadWrite:ti.ReadOnly,z.LESS),pt=w.getTile(xt);pt.registerFadeDuration(M.paint.get("raster-fade-duration"));const bt=w.findLoadedParent(xt,0),wt=fu(pt,bt,w,M,y.transform,y.style.map.terrain);let St,Bt;const Lt=M.paint.get("raster-resampling")==="nearest"?z.NEAREST:z.LINEAR;C.activeTexture.set(z.TEXTURE0),pt.texture.bind(Lt,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),C.activeTexture.set(z.TEXTURE1),bt?(bt.texture.bind(Lt,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),St=Math.pow(2,bt.tileID.overscaledZ-pt.tileID.overscaledZ),Bt=[pt.tileID.canonical.x*St%1,pt.tileID.canonical.y*St%1]):pt.texture.bind(Lt,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST);const jt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(xt),Wt=jt?xt:null,$e=Wt?Wt.posMatrix:y.transform.calculatePosMatrix(xt.toUnwrapped(),ot),Kt=Fo($e,Bt||[0,0],St||1,wt,M);O instanceof qt?V.draw(C,z.TRIANGLES,et,Ai.disabled,Z,vi.disabled,Kt,jt,M.id,O.boundsBuffer,y.quadTriangleIndexBuffer,O.boundsSegments):V.draw(C,z.TRIANGLES,et,W[xt.overscaledZ],Z,vi.disabled,Kt,jt,M.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}})(i,o,u,d);break;case"background":(function(y,w,M,A){const C=M.paint.get("background-color"),z=M.paint.get("background-opacity");if(z===0)return;const O=y.context,V=O.gl,Z=y.transform,W=Z.tileSize,J=M.paint.get("background-pattern");if(y.isPatternMissing(J))return;const j=!J&&C.a===1&&z===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==j)return;const ot=Ai.disabled,xt=y.depthModeForSublayer(0,j==="opaque"?ti.ReadWrite:ti.ReadOnly),et=y.colorModeForRenderPass(),pt=y.useProgram(J?"backgroundPattern":"background"),bt=A||Z.coveringTiles({tileSize:W,terrain:y.style.map.terrain});J&&(O.activeTexture.set(V.TEXTURE0),y.imageManager.bind(y.context));const wt=M.getCrossfadeParameters();for(const St of bt){const Bt=A?St.posMatrix:y.transform.calculatePosMatrix(St.toUnwrapped()),Lt=J?vf(Bt,z,y,J,{tileID:St,tileSize:W},wt):yf(Bt,z,C),jt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(St);pt.draw(O,V.TRIANGLES,xt,ot,et,vi.disabled,Lt,jt,M.id,y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}})(i,0,u,d);break;case"custom":(function(y,w,M){const A=y.context,C=M.implementation;if(y.renderPass==="offscreen"){const z=C.prerender;z&&(y.setCustomLayerDefaults(),A.setColorMode(y.colorModeForRenderPass()),z.call(C,A.gl,y.transform.customLayerMatrix()),A.setDirty(),y.setBaseState())}else if(y.renderPass==="translucent"){y.setCustomLayerDefaults(),A.setColorMode(y.colorModeForRenderPass()),A.setStencilMode(Ai.disabled);const z=C.renderingMode==="3d"?new ti(y.context.gl.LEQUAL,ti.ReadWrite,y.depthRangeFor3D):y.depthModeForSublayer(0,ti.ReadOnly);A.setDepthMode(z),C.render(A.gl,y.transform.customLayerMatrix()),A.setDirty(),y.setBaseState(),A.bindFramebuffer.set(null)}})(i,0,u)}}translatePosMatrix(i,o,u,d,y){if(!u[0]&&!u[1])return i;const w=y?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(w){const C=Math.sin(w),z=Math.cos(w);u=[u[0]*z-u[1]*C,u[0]*C+u[1]*z]}const M=[y?u[0]:Re(o,u[0],this.transform.zoom),y?u[1]:Re(o,u[1],this.transform.zoom),0],A=new Float32Array(16);return l.H(A,i,M),A}saveTileTexture(i){const o=this._tileTextures[i.size[0]];o?o.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const o=this._tileTextures[i];return o&&o.length>0?o.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const o=this.imageManager.getPattern(i.from.toString()),u=this.imageManager.getPattern(i.to.toString());return!o||!u}useProgram(i,o){this.cache=this.cache||{};const u=i+(o?o.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[u]||(this.cache[u]=new dn(this.context,Ua[i],o,iu[i],this._showOverdrawInspector,this.style.map.terrain)),this.cache[u]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new xe(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:i,drawingBufferHeight:o}=this.context.gl;return this.width!==i||this.height!==o}}class pn{constructor(i,o){this.points=i,this.planes=o}static fromInvProjectionMatrix(i,o,u){const d=Math.pow(2,u),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(M=>{const A=1/(M=l.af([],M,i))[3]/o*d;return l.a$(M,M,[A,A,1/M[3],A])}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(M=>{const A=function(V,Z){var W=Z[0],J=Z[1],j=Z[2],ot=W*W+J*J+j*j;return ot>0&&(ot=1/Math.sqrt(ot)),V[0]=Z[0]*ot,V[1]=Z[1]*ot,V[2]=Z[2]*ot,V}([],function(V,Z,W){var J=Z[0],j=Z[1],ot=Z[2],xt=W[0],et=W[1],pt=W[2];return V[0]=j*pt-ot*et,V[1]=ot*xt-J*pt,V[2]=J*et-j*xt,V}([],te([],y[M[0]],y[M[1]]),te([],y[M[2]],y[M[1]]))),C=-((z=A)[0]*(O=y[M[1]])[0]+z[1]*O[1]+z[2]*O[2]);var z,O;return A.concat(C)});return new pn(y,w)}}class mn{constructor(i,o){this.min=i,this.max=o,this.center=function(u,d,y){return u[0]=.5*d[0],u[1]=.5*d[1],u[2]=.5*d[2],u}([],function(u,d,y){return u[0]=d[0]+y[0],u[1]=d[1]+y[1],u[2]=d[2]+y[2],u}([],this.min,this.max))}quadrant(i){const o=[i%2==0,i<2],u=Ut(this.min),d=Ut(this.max);for(let y=0;y<o.length;y++)u[y]=o[y]?this.min[y]:this.center[y],d[y]=o[y]?this.center[y]:this.max[y];return d[2]=this.max[2],new mn(u,d)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}intersects(i){const o=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let u=!0;for(let d=0;d<i.planes.length;d++){const y=i.planes[d];let w=0;for(let M=0;M<o.length;M++)l.b0(y,o[M])>=0&&w++;if(w===0)return 0;w!==o.length&&(u=!1)}if(u)return 2;for(let d=0;d<3;d++){let y=Number.MAX_VALUE,w=-Number.MAX_VALUE;for(let M=0;M<i.points.length;M++){const A=i.points[M][d]-this.min[d];y=Math.min(y,A),w=Math.max(w,A)}if(w<0||y>this.max[d]-this.min[d])return 0}return 1}}class ca{constructor(i=0,o=0,u=0,d=0){if(isNaN(i)||i<0||isNaN(o)||o<0||isNaN(u)||u<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=o,this.left=u,this.right=d}interpolate(i,o,u){return o.top!=null&&i.top!=null&&(this.top=l.z.number(i.top,o.top,u)),o.bottom!=null&&i.bottom!=null&&(this.bottom=l.z.number(i.bottom,o.bottom,u)),o.left!=null&&i.left!=null&&(this.left=l.z.number(i.left,o.left,u)),o.right!=null&&i.right!=null&&(this.right=l.z.number(i.right,o.right,u)),this}getCenter(i,o){const u=l.ac((this.left+i-this.right)/2,0,i),d=l.ac((this.top+o-this.bottom)/2,0,o);return new l.P(u,d)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new ca(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const pc=85.051129;class tl{constructor(i,o,u,d,y){this.tileSize=512,this._renderWorldCopies=y===void 0||!!y,this._minZoom=i||0,this._maxZoom=o||22,this._minPitch=u??0,this._maxPitch=d??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ca,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const i=new tl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return i.apply(this),i}apply(i){this.tileSize=i.tileSize,this.latRange=i.latRange,this.width=i.width,this.height=i.height,this._center=i._center,this._elevation=i._elevation,this.minElevationForCurrentTile=i.minElevationForCurrentTile,this.zoom=i.zoom,this.angle=i.angle,this._fov=i._fov,this._pitch=i._pitch,this._unmodified=i._unmodified,this._edgeInsets=i._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(i){const o=-l.b1(i,-180,180)*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=function(){var u=new l.A(4);return l.A!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u}(),function(u,d,y){var w=d[0],M=d[1],A=d[2],C=d[3],z=Math.sin(y),O=Math.cos(y);u[0]=w*O+A*z,u[1]=M*O+C*z,u[2]=w*-z+A*O,u[3]=M*-z+C*O}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const o=l.ac(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(i){const o=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._zoom=o,this.tileZoom=Math.max(0,Math.floor(o)),this.scale=this.zoomScale(o),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(i){i!==this._elevation&&(this._elevation=i,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,o,u){this._unmodified=!1,this._edgeInsets.interpolate(i,o,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const o=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(i){const o=[new l.b2(0,i)];if(this._renderWorldCopies){const u=this.pointCoordinate(new l.P(0,0)),d=this.pointCoordinate(new l.P(this.width,0)),y=this.pointCoordinate(new l.P(this.width,this.height)),w=this.pointCoordinate(new l.P(0,this.height)),M=Math.floor(Math.min(u.x,d.x,y.x,w.x)),A=Math.floor(Math.max(u.x,d.x,y.x,w.x)),C=1;for(let z=M-C;z<=A+C;z++)z!==0&&o.push(new l.b2(z,i))}return o}coveringTiles(i){var o,u;let d=this.coveringZoomLevel(i);const y=d;if(i.minzoom!==void 0&&d<i.minzoom)return[];i.maxzoom!==void 0&&d>i.maxzoom&&(d=i.maxzoom);const w=this.pointCoordinate(this.getCameraPoint()),M=l.Y.fromLngLat(this.center),A=Math.pow(2,d),C=[A*w.x,A*w.y,0],z=[A*M.x,A*M.y,0],O=pn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d);let V=i.minzoom||0;!i.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(V=d);const Z=i.terrain?2/Math.min(this.tileSize,i.tileSize)*this.tileSize:3,W=et=>({aabb:new mn([et*A,0,0],[(et+1)*A,A,0]),zoom:0,x:0,y:0,wrap:et,fullyVisible:!1}),J=[],j=[],ot=d,xt=i.reparseOverscaled?y:d;if(this._renderWorldCopies)for(let et=1;et<=3;et++)J.push(W(-et)),J.push(W(et));for(J.push(W(0));J.length>0;){const et=J.pop(),pt=et.x,bt=et.y;let wt=et.fullyVisible;if(!wt){const Wt=et.aabb.intersects(O);if(Wt===0)continue;wt=Wt===2}const St=i.terrain?C:z,Bt=et.aabb.distanceX(St),Lt=et.aabb.distanceY(St),jt=Math.max(Math.abs(Bt),Math.abs(Lt));if(et.zoom===ot||jt>Z+(1<<ot-et.zoom)-2&&et.zoom>=V){const Wt=ot-et.zoom,$e=C[0]-.5-(pt<<Wt),Kt=C[1]-.5-(bt<<Wt);j.push({tileID:new l.Q(et.zoom===ot?xt:et.zoom,et.wrap,et.zoom,pt,bt),distanceSq:fe([z[0]-.5-pt,z[1]-.5-bt]),tileDistanceToCamera:Math.sqrt($e*$e+Kt*Kt)})}else for(let Wt=0;Wt<4;Wt++){const $e=(pt<<1)+Wt%2,Kt=(bt<<1)+(Wt>>1),Ie=et.zoom+1;let Ve=et.aabb.quadrant(Wt);if(i.terrain){const ei=new l.Q(Ie,et.wrap,Ie,$e,Kt),ke=i.terrain.getMinMaxElevation(ei),je=(o=ke.minElevation)!==null&&o!==void 0?o:this.elevation,He=(u=ke.maxElevation)!==null&&u!==void 0?u:this.elevation;Ve=new mn([Ve.min[0],Ve.min[1],je],[Ve.max[0],Ve.max[1],He])}J.push({aabb:Ve,zoom:Ie,x:$e,y:Kt,wrap:et.wrap,fullyVisible:wt})}}return j.sort((et,pt)=>et.distanceSq-pt.distanceSq).map(et=>et.tileID)}resize(i,o){this.width=i,this.height=o,this.pixelsToGLUnits=[2/i,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const o=l.ac(i.lat,-85.051129,pc);return new l.P(l.N(i.lng)*this.worldSize,l.O(o)*this.worldSize)}unproject(i){return new l.Y(i.x/this.worldSize,i.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(i){const o=this.elevation,u=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,d=this.pointLocation(this.centerPoint,i),y=i.getElevationForLngLatZoom(d,this.tileZoom);if(!(this.elevation-y))return;const w=u+o-y,M=Math.cos(this._pitch)*this.cameraToCenterDistance/w/l.b3(1,d.lat),A=this.scaleZoom(M/this.tileSize);this._elevation=y,this._center=d,this.zoom=A}setLocationAtPoint(i,o){const u=this.pointCoordinate(o),d=this.pointCoordinate(this.centerPoint),y=this.locationCoordinate(i),w=new l.Y(y.x-(u.x-d.x),y.y-(u.y-d.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(i,o){return o?this.coordinatePoint(this.locationCoordinate(i),o.getElevationForLngLatZoom(i,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(i))}pointLocation(i,o){return this.coordinateLocation(this.pointCoordinate(i,o))}locationCoordinate(i){return l.Y.fromLngLat(i)}coordinateLocation(i){return i&&i.toLngLat()}pointCoordinate(i,o){if(o){const V=o.pointCoordinate(i);if(V!=null)return V}const u=[i.x,i.y,0,1],d=[i.x,i.y,1,1];l.af(u,u,this.pixelMatrixInverse),l.af(d,d,this.pixelMatrixInverse);const y=u[3],w=d[3],M=u[1]/y,A=d[1]/w,C=u[2]/y,z=d[2]/w,O=C===z?0:(0-C)/(z-C);return new l.Y(l.z.number(u[0]/y,d[0]/w,O)/this.worldSize,l.z.number(M,A,O)/this.worldSize)}coordinatePoint(i,o=0,u=this.pixelMatrix){const d=[i.x*this.worldSize,i.y*this.worldSize,o,1];return l.af(d,d,u),new l.P(d[0]/d[3],d[1]/d[3])}getBounds(){const i=Math.max(0,this.height/2-this.getHorizon());return new rt().extend(this.pointLocation(new l.P(0,i))).extend(this.pointLocation(new l.P(this.width,i))).extend(this.pointLocation(new l.P(this.width,this.height))).extend(this.pointLocation(new l.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new rt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(i){i?(this.lngRange=[i.getWest(),i.getEast()],this.latRange=[i.getSouth(),i.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,pc])}calculatePosMatrix(i,o=!1){const u=i.key,d=o?this._alignedPosMatrixCache:this._posMatrixCache;if(d[u])return d[u];const y=i.canonical,w=this.worldSize/this.zoomScale(y.z),M=y.x+Math.pow(2,y.z)*i.wrap,A=l.an(new Float64Array(16));return l.H(A,A,[M*w,y.y*w,0]),l.J(A,A,[w/l.W,w/l.W,1]),l.K(A,o?this.alignedProjMatrix:this.projMatrix,A),d[u]=new Float32Array(A),d[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(i,o){o=l.ac(+o,this.minZoom,this.maxZoom);const u={center:new l.M(i.lng,i.lat),zoom:o};let d=this.lngRange;if(!this._renderWorldCopies&&d===null){const et=179.9999999999;d=[-et,et]}const y=this.tileSize*this.zoomScale(u.zoom);let w=0,M=y,A=0,C=y,z=0,O=0;const{x:V,y:Z}=this.size;if(this.latRange){const et=this.latRange;w=l.O(et[1])*y,M=l.O(et[0])*y,M-w<Z&&(z=Z/(M-w))}d&&(A=l.b1(l.N(d[0])*y,0,y),C=l.b1(l.N(d[1])*y,0,y),C<A&&(C+=y),C-A<V&&(O=V/(C-A)));const{x:W,y:J}=this.project.call({worldSize:y},i);let j,ot;const xt=Math.max(O||0,z||0);if(xt){const et=new l.P(O?(C+A)/2:W,z?(M+w)/2:J);return u.center=this.unproject.call({worldSize:y},et).wrap(),u.zoom+=this.scaleZoom(xt),u}if(this.latRange){const et=Z/2;J-et<w&&(ot=w+et),J+et>M&&(ot=M-et)}if(d){const et=(A+C)/2;let pt=W;this._renderWorldCopies&&(pt=l.b1(W,et-y/2,et+y/2));const bt=V/2;pt-bt<A&&(j=A+bt),pt+bt>C&&(j=C-bt)}if(j!==void 0||ot!==void 0){const et=new l.P(j??W,ot??J);u.center=this.unproject.call({worldSize:y},et).wrap()}return u}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this._unmodified,{center:o,zoom:u}=this.getConstrained(this.center,this.zoom);this.center=o,this.zoom=u,this._unmodified=i,this._constraining=!1}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,o=this.point.x,u=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.b3(1,this.center.lat)*this.worldSize;let d=l.an(new Float64Array(16));l.J(d,d,[this.width/2,-this.height/2,1]),l.H(d,d,[1,-1,0]),this.labelPlaneMatrix=d,d=l.an(new Float64Array(16)),l.J(d,d,[1,-1,1]),l.H(d,d,[-1,-1,0]),l.J(d,d,[2/this.width,2/this.height,1]),this.glCoordMatrix=d;const y=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),w=Math.min(this.elevation,this.minElevationForCurrentTile),M=y-w*this._pixelPerMeter/Math.cos(this._pitch),A=w<0?M:y,C=Math.PI/2+this._pitch,z=this._fov*(.5+i.y/this.height),O=Math.sin(z)*A/Math.sin(l.ac(Math.PI-C-z,.01,Math.PI-.01)),V=this.getHorizon(),Z=2*Math.atan(V/this.cameraToCenterDistance)*(.5+i.y/(2*V)),W=Math.sin(Z)*A/Math.sin(l.ac(Math.PI-C-Z,.01,Math.PI-.01)),J=Math.min(O,W),j=1.01*(Math.cos(Math.PI/2-this._pitch)*J+A),ot=this.height/50;d=new Float64Array(16),l.b4(d,this._fov,this.width/this.height,ot,j),d[8]=2*-i.x/this.width,d[9]=2*i.y/this.height,l.J(d,d,[1,-1,1]),l.H(d,d,[0,0,-this.cameraToCenterDistance]),l.b5(d,d,this._pitch),l.ad(d,d,this.angle),l.H(d,d,[-o,-u,0]),this.mercatorMatrix=l.J([],d,[this.worldSize,this.worldSize,this.worldSize]),l.J(d,d,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.K(new Float64Array(16),this.labelPlaneMatrix,d),l.H(d,d,[0,0,-this.elevation]),this.projMatrix=d,this.invProjMatrix=l.ar([],d),this.pixelMatrix3D=l.K(new Float64Array(16),this.labelPlaneMatrix,d);const xt=this.width%2/2,et=this.height%2/2,pt=Math.cos(this.angle),bt=Math.sin(this.angle),wt=o-Math.round(o)+pt*xt+bt*et,St=u-Math.round(u)+pt*et+bt*xt,Bt=new Float64Array(d);if(l.H(Bt,Bt,[wt>.5?wt-1:wt,St>.5?St-1:St,0]),this.alignedProjMatrix=Bt,d=l.ar(new Float64Array(16),this.pixelMatrix),!d)throw new Error("failed to invert matrix");this.pixelMatrixInverse=d,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const i=this.pointCoordinate(new l.P(0,0)),o=[i.x*this.worldSize,i.y*this.worldSize,0,1];return l.af(o,o,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(0,i))}getCameraQueryGeometry(i){const o=this.getCameraPoint();if(i.length===1)return[i[0],o];{let u=o.x,d=o.y,y=o.x,w=o.y;for(const M of i)u=Math.min(u,M.x),d=Math.min(d,M.y),y=Math.max(y,M.x),w=Math.max(w,M.y);return[new l.P(u,d),new l.P(y,d),new l.P(y,w),new l.P(u,w),new l.P(u,d)]}}lngLatToCameraDepth(i,o){const u=this.locationCoordinate(i),d=[u.x*this.worldSize,u.y*this.worldSize,o,1];return l.af(d,d,this.projMatrix),d[2]/d[3]}}function mc(g,i){let o,u=!1,d=null,y=null;const w=()=>{d=null,u&&(g.apply(y,o),d=setTimeout(w,i),u=!1)};return(...M)=>(u=!0,y=this,o=M,d||w(),d)}class gc{constructor(i){this._getCurrentHash=()=>{const o=window.location.hash.replace("#","");if(this._hashName){let u;return o.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(u=d)}),(u&&u[1]||"").split("/")}return o.split("/")},this._onHashChange=()=>{const o=this._getCurrentHash();if(o.length>=3&&!o.some(u=>isNaN(u))){const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:u,pitch:+(o[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const o=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,o)}catch{}},this._updateHash=mc(this._updateHashUnthrottled,300),this._hashName=i&&encodeURIComponent(i)}addTo(i){return this._map=i,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(i){const o=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,d=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,d),w=Math.round(o.lng*y)/y,M=Math.round(o.lat*y)/y,A=this._map.getBearing(),C=this._map.getPitch();let z="";if(z+=i?`/${w}/${M}/${u}`:`${u}/${M}/${w}`,(A||C)&&(z+="/"+Math.round(10*A)/10),C&&(z+=`/${Math.round(C)}`),this._hashName){const O=this._hashName;let V=!1;const Z=window.location.hash.slice(1).split("&").map(W=>{const J=W.split("=")[0];return J===O?(V=!0,`${J}=${z}`):W}).filter(W=>W);return V||Z.push(`${O}=${z}`),`#${Z.join("&")}`}return`#${z}`}}const Ka={linearity:.3,easing:l.b6(0,0,.3,1)},Bn=l.e({deceleration:2500,maxSpeed:1400},Ka),_u=l.e({deceleration:20,maxSpeed:1400},Ka),yu=l.e({deceleration:1e3,maxSpeed:360},Ka),vu=l.e({deceleration:1e3,maxSpeed:90},Ka);class xu{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:P.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,o=P.now();for(;i.length>0&&o-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const o={zoom:0,bearing:0,pitch:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)o.zoom+=y.zoomDelta||0,o.bearing+=y.bearingDelta||0,o.pitch+=y.pitchDelta||0,y.panDelta&&o.pan._add(y.panDelta),y.around&&(o.around=y.around),y.pinchAround&&(o.pinchAround=y.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(o.pan.mag()){const y=Ja(o.pan.mag(),u,l.e({},Bn,i||{}));d.offset=o.pan.mult(y.amount/o.pan.mag()),d.center=this._map.transform.center,Ya(d,y)}if(o.zoom){const y=Ja(o.zoom,u,_u);d.zoom=this._map.transform.zoom+y.amount,Ya(d,y)}if(o.bearing){const y=Ja(o.bearing,u,yu);d.bearing=this._map.transform.bearing+l.ac(y.amount,-179,179),Ya(d,y)}if(o.pitch){const y=Ja(o.pitch,u,vu);d.pitch=this._map.transform.pitch+y.amount,Ya(d,y)}if(d.zoom||d.bearing){const y=o.pinchAround===void 0?o.around:o.pinchAround;d.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),l.e(d,{noMoveStart:!0})}}function Ya(g,i){(!g.duration||g.duration<i.duration)&&(g.duration=i.duration,g.easing=i.easing)}function Ja(g,i,o){const{maxSpeed:u,linearity:d,deceleration:y}=o,w=l.ac(g*d/(i/1e3),-u,u),M=Math.abs(w)/(y*d);return{easing:o.easing,duration:1e3*M,amount:w*(M/2)}}class Gs extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,u,d={}){const y=L.mousePos(o.getCanvas(),u),w=o.unproject(y);super(i,l.e({point:y,lngLat:w,originalEvent:u},d)),this._defaultPrevented=!1,this.target=o}}class Br extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,u){const d=i==="touchend"?u.changedTouches:u.touches,y=L.touchPos(o.getCanvasContainer(),d),w=y.map(A=>o.unproject(A)),M=y.reduce((A,C,z,O)=>A.add(C.div(O.length)),new l.P(0,0));super(i,{points:y,point:M,lngLats:w,lngLat:o.unproject(M),originalEvent:u}),this._defaultPrevented=!1}}class _c extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,u){super(i,{originalEvent:u}),this._defaultPrevented=!1}}class Ar{constructor(i,o){this._map=i,this._clickTolerance=o.clickTolerance}reset(){delete this._mousedownPos}wheel(i){return this._firePreventable(new _c(i.type,this._map,i))}mousedown(i,o){return this._mousedownPos=o,this._firePreventable(new Gs(i.type,this._map,i))}mouseup(i){this._map.fire(new Gs(i.type,this._map,i))}click(i,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||this._map.fire(new Gs(i.type,this._map,i))}dblclick(i){return this._firePreventable(new Gs(i.type,this._map,i))}mouseover(i){this._map.fire(new Gs(i.type,this._map,i))}mouseout(i){this._map.fire(new Gs(i.type,this._map,i))}touchstart(i){return this._firePreventable(new Br(i.type,this._map,i))}touchmove(i){this._map.fire(new Br(i.type,this._map,i))}touchend(i){this._map.fire(new Br(i.type,this._map,i))}touchcancel(i){this._map.fire(new Br(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Nr{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(i){this._map.fire(new Gs(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Gs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._ignoreContextMenu||this._map.fire(new Gs(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ha{constructor(i){this._map=i}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(i){return this.transform.pointLocation(l.P.convert(i),this._map.terrain)}}class Er{constructor(i,o){this._map=i,this._tr=new ha(i),this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,o){this.isEnabled()&&i.shiftKey&&i.button===0&&(L.disableDrag(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(i,o){if(!this._active)return;const u=o;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const d=this._startPos;this._lastPos=u,this._box||(this._box=L.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",i));const y=Math.min(d.x,u.x),w=Math.max(d.x,u.x),M=Math.min(d.y,u.y),A=Math.max(d.y,u.y);L.setTransform(this._box,`translate(${y}px,${M}px)`),this._box.style.width=w-y+"px",this._box.style.height=A-M+"px"}mouseupWindow(i,o){if(!this._active||i.button!==0)return;const u=this._startPos,d=o;if(this.reset(),L.suppressClick(),u.x!==d.x||u.y!==d.y)return this._map.fire(new l.k("boxzoomend",{originalEvent:i})),{cameraAnimation:y=>y.fitScreenCoordinates(u,d,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",i)}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(L.remove(this._box),this._box=null),L.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(i,o){return this._map.fire(new l.k(i,{originalEvent:o}))}}function Nn(g,i){if(g.length!==i.length)throw new Error(`The number of touches and points are not equal - touches ${g.length}, points ${i.length}`);const o={};for(let u=0;u<g.length;u++)o[g[u].identifier]=i[u];return o}class Cf{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(i,o,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),u.length===this.numTouches&&(this.centroid=function(d){const y=new l.P(0,0);for(const w of d)y._add(w);return y.div(d.length)}(o),this.touches=Nn(u,o)))}touchmove(i,o,u){if(this.aborted||!this.centroid)return;const d=Nn(u,o);for(const y in this.touches){const w=d[y];(!w||w.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(i,o,u){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const d=!this.aborted&&this.centroid;if(this.reset(),d)return d}}}class yc{constructor(i){this.singleTap=new Cf(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(i,o,u){this.singleTap.touchstart(i,o,u)}touchmove(i,o,u){this.singleTap.touchmove(i,o,u)}touchend(i,o,u){const d=this.singleTap.touchend(i,o,u);if(d){const y=i.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(d)<30;if(y&&w||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class Df{constructor(i){this._tr=new ha(i),this._zoomIn=new yc({numTouches:1,numTaps:2}),this._zoomOut=new yc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,o,u){this._zoomIn.touchstart(i,o,u),this._zoomOut.touchstart(i,o,u)}touchmove(i,o,u){this._zoomIn.touchmove(i,o,u),this._zoomOut.touchmove(i,o,u)}touchend(i,o,u){const d=this._zoomIn.touchend(i,o,u),y=this._zoomOut.touchend(i,o,u),w=this._tr;return d?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:w.zoom+1,around:w.unproject(d)},{originalEvent:i})}):y?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:w.zoom-1,around:w.unproject(y)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ua{constructor(i){this._enabled=!!i.enable,this._moveStateManager=i.moveStateManager,this._clickTolerance=i.clickTolerance||1,this._moveFunction=i.move,this._activateOnStart=!!i.activateOnStart,i.assignEvents(this),this.reset()}reset(i){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(i)}_move(...i){const o=this._moveFunction(...i);if(o.bearingDelta||o.pitchDelta||o.around||o.panDelta)return this._active=!0,o}dragStart(i,o){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(i)&&(this._moveStateManager.startMove(i),this._lastPoint=o.length?o[0]:o,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(i,o){if(!this.isEnabled())return;const u=this._lastPoint;if(!u)return;if(i.preventDefault(),!this._moveStateManager.isValidMoveEvent(i))return void this.reset(i);const d=o.length?o[0]:o;return!this._moved&&d.dist(u)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=d,this._move(u,d))}dragEnd(i){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(i)&&(this._moved&&L.suppressClick(),this.reset(i))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Qa={0:1,2:2};class $r{constructor(i){this._correctEvent=i.checkCorrectEvent}startMove(i){const o=L.mouseButton(i);this._eventButton=o}endMove(i){delete this._eventButton}isValidStartEvent(i){return this._correctEvent(i)}isValidMoveEvent(i){return!function(o,u){const d=Qa[u];return o.buttons===void 0||(o.buttons&d)!==d}(i,this._eventButton)}isValidEndEvent(i){return L.mouseButton(i)===this._eventButton}}class le{constructor(){this._firstTouch=void 0}_isOneFingerTouch(i){return i.targetTouches.length===1}_isSameTouchEvent(i){return i.targetTouches[0].identifier===this._firstTouch}startMove(i){this._firstTouch=i.targetTouches[0].identifier}endMove(i){delete this._firstTouch}isValidStartEvent(i){return this._isOneFingerTouch(i)}isValidMoveEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}isValidEndEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}}const el=g=>{g.mousedown=g.dragStart,g.mousemoveWindow=g.dragMove,g.mouseup=g.dragEnd,g.contextmenu=function(i){i.preventDefault()}},da=({enable:g,clickTolerance:i,bearingDegreesPerPixelMoved:o=.8})=>{const u=new $r({checkCorrectEvent:d=>L.mouseButton(d)===0&&d.ctrlKey||L.mouseButton(d)===2});return new ua({clickTolerance:i,move:(d,y)=>({bearingDelta:(y.x-d.x)*o}),moveStateManager:u,enable:g,assignEvents:el})},fa=({enable:g,clickTolerance:i,pitchDegreesPerPixelMoved:o=-.5})=>{const u=new $r({checkCorrectEvent:d=>L.mouseButton(d)===0&&d.ctrlKey||L.mouseButton(d)===2});return new ua({clickTolerance:i,move:(d,y)=>({pitchDelta:(y.y-d.y)*o}),moveStateManager:u,enable:g,assignEvents:el})};class bu{constructor(i,o){this._clickTolerance=i.clickTolerance||1,this._map=o,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(i,o,u){return this._calculateTransform(i,o,u)}touchmove(i,o,u){if(this._active&&!(u.length<this.minTouchs()))return i.preventDefault(),this._calculateTransform(i,o,u)}touchend(i,o,u){this._calculateTransform(i,o,u),this._active&&u.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,o,u){u.length>0&&(this._active=!0);const d=Nn(u,o),y=new l.P(0,0),w=new l.P(0,0);let M=0;for(const C in d){const z=d[C],O=this._touches[C];O&&(y._add(z),w._add(z.sub(O)),M++,d[C]=z)}if(this._touches=d,M<this.minTouchs()||!w.mag())return;const A=w.div(M);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(M),panDelta:A}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ee{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(i,o,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([o[0],o[1]]))}touchmove(i,o,u){if(!this._firstTwoTouches)return;i.preventDefault();const[d,y]=this._firstTwoTouches,w=pa(u,o,d),M=pa(u,o,y);if(!w||!M)return;const A=this._aroundCenter?null:w.add(M).div(2);return this._move([w,M],A,i)}touchend(i,o,u){if(!this._firstTwoTouches)return;const[d,y]=this._firstTwoTouches,w=pa(u,o,d),M=pa(u,o,y);w&&M||(this._active&&L.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function pa(g,i,o){for(let u=0;u<g.length;u++)if(g[u].identifier===o)return i[u]}function wu(g,i){return Math.log(g/i)/Math.LN2}class Mu extends ee{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,o){const u=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(wu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:wu(this._distance,u),pinchAround:o}}}function il(g,i){return 180*g.angleWith(i)/Math.PI}class vc extends ee{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,o,u){const d=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:il(this._vector,d),pinchAround:o}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const o=25/(Math.PI*this._minDiameter)*360,u=il(i,this._startVector);return Math.abs(u)<o}}function sl(g){return Math.abs(g.y)>Math.abs(g.x)}class Su extends ee{constructor(i){super(),this._currentTouchCount=0,this._map=i}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(i,o,u){super.touchstart(i,o,u),this._currentTouchCount=u.length}_start(i){this._lastPoints=i,sl(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,o,u){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const d=i[0].sub(this._lastPoints[0]),y=i[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(d,y,u.timeStamp),this._valid?(this._lastPoints=i,this._active=!0,{pitchDelta:(d.y+y.y)/2*-.5}):void 0}gestureBeginsVertically(i,o,u){if(this._valid!==void 0)return this._valid;const d=i.mag()>=2,y=o.mag()>=2;if(!d&&!y)return;if(!d||!y)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;const w=i.y>0==o.y>0;return sl(i)&&sl(o)&&w}}const kf={panStep:100,bearingStep:15,pitchStep:10};class gn{constructor(i){this._tr=new ha(i);const o=kf;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let o=0,u=0,d=0,y=0,w=0;switch(i.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:i.shiftKey?u=-1:(i.preventDefault(),y=-1);break;case 39:i.shiftKey?u=1:(i.preventDefault(),y=1);break;case 38:i.shiftKey?d=1:(i.preventDefault(),w=-1);break;case 40:i.shiftKey?d=-1:(i.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(u=0,d=0),{cameraAnimation:M=>{const A=this._tr;M.easeTo({duration:300,easeId:"keyboardHandler",easing:ki,zoom:o?Math.round(A.zoom)+o*(i.shiftKey?2:1):A.zoom,bearing:A.bearing+u*this._bearingStep,pitch:A.pitch+d*this._pitchStep,offset:[-y*this._panStep,-w*this._panStep],center:A.center},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ki(g){return g*(2-g)}const to=4.000244140625;class rl{constructor(i,o){this._onTimeout=u=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},this._map=i,this._tr=new ha(i),this._triggerRenderFrame=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(i){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!i[this._map.cooperativeGestures._bypassKey])return;let o=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const u=P.now(),d=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,o!==0&&o%to==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(d*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),i.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=i,this._delta-=o,this._active||this._start(i)),i.preventDefault()}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=L.mousePos(this._map.getCanvas(),i),u=this._tr;this._around=o.y>u.transform.height/2-u.transform.getHorizon()?l.M.convert(this._aroundCenter?u.center:u.unproject(o)):l.M.convert(u.center),this._aroundPoint=u.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._tr.transform;if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>to?this._wheelZoomRate:this._defaultZoomRate;let A=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&A!==0&&(A=1/A);const C=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):i.scale;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(C*A))),this._type==="wheel"&&(this._startZoom=i.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const o=typeof this._targetZoom=="number"?this._targetZoom:i.zoom,u=this._startZoom,d=this._easing;let y,w=!1;if(this._type==="wheel"&&u&&d){const M=Math.min((P.now()-this._lastWheelEventTime)/200,1),A=d(M);y=l.z.number(u,o,A),M<1?this._frameId||(this._frameId=!0):w=!0}else y=o,w=!0;return this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!w,zoomDelta:y-i.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let o=l.b7;if(this._prevEase){const u=this._prevEase,d=(P.now()-u.start)/u.duration,y=u.easing(d+.01)-u.easing(d),w=.27/Math.sqrt(y*y+1e-4)*.01,M=Math.sqrt(.0729-w*w);o=l.b6(w,M,.25,1)}return this._prevEase={start:P.now(),duration:i,easing:o},o}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class xc{constructor(i,o){this._clickZoom=i,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Tu{constructor(i){this._tr=new ha(i),this.reset()}reset(){this._active=!1}dblclick(i,o){return i.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:this._tr.zoom+(i.shiftKey?-1:1),around:this._tr.unproject(o)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Au{constructor(){this._tap=new yc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(i,o,u){if(!this._swipePoint)if(this._tapTime){const d=o[0],y=i.timeStamp-this._tapTime<500,w=this._tapPoint.dist(d)<30;y&&w?u.length>0&&(this._swipePoint=d,this._swipeTouch=u[0].identifier):this.reset()}else this._tap.touchstart(i,o,u)}touchmove(i,o,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const d=o[0],y=d.y-this._swipePoint.y;return this._swipePoint=d,i.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(i,o,u)}touchend(i,o,u){if(this._tapTime)this._swipePoint&&u.length===0&&this.reset();else{const d=this._tap.touchend(i,o,u);d&&(this._tapTime=i.timeStamp,this._tapPoint=d)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Eu{constructor(i,o,u){this._el=i,this._mousePan=o,this._touchPan=u}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ir{constructor(i,o,u){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=o,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class eo{constructor(i,o,u,d){this._el=i,this._touchZoom=o,this._touchRotate=u,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class ve{constructor(i,o){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=i,this._options=o,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const i=this._map.getCanvasContainer();i.classList.add("maplibregl-cooperative-gestures"),this._container=L.create("div","maplibregl-cooperative-gesture-screen",i);let o=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(o=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const u=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),d=document.createElement("div");d.className="maplibregl-desktop-message",d.textContent=o,this._container.appendChild(d);const y=document.createElement("div");y.className="maplibregl-mobile-message",y.textContent=u,this._container.appendChild(y),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(L.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(i){this._onCooperativeGesture(i.touches.length===1)}wheel(i){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!i[this._bypassKey])}_onCooperativeGesture(i){this._enabled&&i&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Ae=g=>g.zoom||g.drag||g.pitch||g.rotate;class nl extends l.k{}function io(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class bc{constructor(i,o){this.handleWindowEvent=d=>{this.handleEvent(d,`${d.type}Window`)},this.handleEvent=(d,y)=>{if(d.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const w=d.type==="renderFrame"?void 0:d,M={needsRenderFrame:!1},A={},C={},z=d.touches,O=z?this._getMapTouches(z):void 0,V=O?L.touchPos(this._map.getCanvas(),O):L.mousePos(this._map.getCanvas(),d);for(const{handlerName:J,handler:j,allowed:ot}of this._handlers){if(!j.isEnabled())continue;let xt;this._blockedByActive(C,ot,J)?j.reset():j[y||d.type]&&(xt=j[y||d.type](d,V,O),this.mergeHandlerResult(M,A,xt,J,w),xt&&xt.needsRenderFrame&&this._triggerRenderFrame()),(xt||j.isActive())&&(C[J]=j)}const Z={};for(const J in this._previousActiveHandlers)C[J]||(Z[J]=w);this._previousActiveHandlers=C,(Object.keys(Z).length||io(M))&&(this._changes.push([M,A,Z]),this._triggerRenderFrame()),(Object.keys(C).length||io(M))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:W}=M;W&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],W(this._map))},this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new xu(i),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(o);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[d,y,w]of this._listeners)L.addEventListener(d,y,d===document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[i,o,u]of this._listeners)L.removeEventListener(i,o,i===document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(i){const o=this._map,u=o.getCanvasContainer();this._add("mapEvent",new Ar(o,i));const d=o.boxZoom=new Er(o,i);this._add("boxZoom",d),i.interactive&&i.boxZoom&&d.enable();const y=o.cooperativeGestures=new ve(o,i.cooperativeGestures);this._add("cooperativeGestures",y),i.cooperativeGestures&&y.enable();const w=new Df(o),M=new Tu(o);o.doubleClickZoom=new xc(M,w),this._add("tapZoom",w),this._add("clickZoom",M),i.interactive&&i.doubleClickZoom&&o.doubleClickZoom.enable();const A=new Au;this._add("tapDragZoom",A);const C=o.touchPitch=new Su(o);this._add("touchPitch",C),i.interactive&&i.touchPitch&&o.touchPitch.enable(i.touchPitch);const z=da(i),O=fa(i);o.dragRotate=new Ir(i,z,O),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",O,["mouseRotate"]),i.interactive&&i.dragRotate&&o.dragRotate.enable();const V=(({enable:xt,clickTolerance:et})=>{const pt=new $r({checkCorrectEvent:bt=>L.mouseButton(bt)===0&&!bt.ctrlKey});return new ua({clickTolerance:et,move:(bt,wt)=>({around:wt,panDelta:wt.sub(bt)}),activateOnStart:!0,moveStateManager:pt,enable:xt,assignEvents:el})})(i),Z=new bu(i,o);o.dragPan=new Eu(u,V,Z),this._add("mousePan",V),this._add("touchPan",Z,["touchZoom","touchRotate"]),i.interactive&&i.dragPan&&o.dragPan.enable(i.dragPan);const W=new vc,J=new Mu;o.touchZoomRotate=new eo(u,J,W,A),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",J,["touchPan","touchRotate"]),i.interactive&&i.touchZoomRotate&&o.touchZoomRotate.enable(i.touchZoomRotate);const j=o.scrollZoom=new rl(o,()=>this._triggerRenderFrame());this._add("scrollZoom",j,["mousePan"]),i.interactive&&i.scrollZoom&&o.scrollZoom.enable(i.scrollZoom);const ot=o.keyboard=new gn(o);this._add("keyboard",ot),i.interactive&&i.keyboard&&o.keyboard.enable(),this._add("blockableMapEvent",new Nr(o))}_add(i,o,u){this._handlers.push({handlerName:i,handler:o,allowed:u}),this._handlersById[i]=o}stop(i){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ae(this._eventsInProgress)||this.isZooming()}_blockedByActive(i,o,u){for(const d in i)if(d!==u&&(!o||o.indexOf(d)<0))return!0;return!1}_getMapTouches(i){const o=[];for(const u of i)this._el.contains(u.target)&&o.push(u);return o}mergeHandlerResult(i,o,u,d,y){if(!u)return;l.e(i,u);const w={handlerName:d,originalEvent:u.originalEvent||y};u.zoomDelta!==void 0&&(o.zoom=w),u.panDelta!==void 0&&(o.drag=w),u.pitchDelta!==void 0&&(o.pitch=w),u.bearingDelta!==void 0&&(o.rotate=w)}_applyChanges(){const i={},o={},u={};for(const[d,y,w]of this._changes)d.panDelta&&(i.panDelta=(i.panDelta||new l.P(0,0))._add(d.panDelta)),d.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+d.pitchDelta),d.around!==void 0&&(i.around=d.around),d.pinchAround!==void 0&&(i.pinchAround=d.pinchAround),d.noInertia&&(i.noInertia=d.noInertia),l.e(o,y),l.e(u,w);this._updateMapTransform(i,o,u),this._changes=[]}_updateMapTransform(i,o,u){const d=this._map,y=d._getTransformForUpdate(),w=d.terrain;if(!(io(i)||w&&this._terrainMovement))return this._fireEvents(o,u,!0);let{panDelta:M,zoomDelta:A,bearingDelta:C,pitchDelta:z,around:O,pinchAround:V}=i;V!==void 0&&(O=V),d._stop(!0),O=O||d.transform.centerPoint;const Z=y.pointLocation(M?O.sub(M):O);C&&(y.bearing+=C),z&&(y.pitch+=z),A&&(y.zoom+=A),w?this._terrainMovement||!o.drag&&!o.zoom?o.drag&&this._terrainMovement?y.center=y.pointLocation(y.centerPoint.sub(M)):y.setLocationAtPoint(Z,O):(this._terrainMovement=!0,this._map._elevationFreeze=!0,y.setLocationAtPoint(Z,O),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,y.recalculateZoom(d.terrain)})):y.setLocationAtPoint(Z,O),d._applyUpdatedTransform(y),this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(o,u,!0)}_fireEvents(i,o,u){const d=Ae(this._eventsInProgress),y=Ae(i),w={};for(const z in i){const{originalEvent:O}=i[z];this._eventsInProgress[z]||(w[`${z}start`]=O),this._eventsInProgress[z]=i[z]}!d&&y&&this._fireEvent("movestart",y.originalEvent);for(const z in w)this._fireEvent(z,w[z]);y&&this._fireEvent("move",y.originalEvent);for(const z in i){const{originalEvent:O}=i[z];this._fireEvent(z,O)}const M={};let A;for(const z in this._eventsInProgress){const{handlerName:O,originalEvent:V}=this._eventsInProgress[z];this._handlersById[O].isActive()||(delete this._eventsInProgress[z],A=o[O]||V,M[`${z}end`]=A)}for(const z in M)this._fireEvent(z,M[z]);const C=Ae(this._eventsInProgress);if(u&&(d||y)&&!C){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=V=>V!==0&&-this._bearingSnap<V&&V<this._bearingSnap;!z||!z.essential&&P.prefersReducedMotion?(this._map.fire(new l.k("moveend",{originalEvent:A})),O(this._map.getBearing())&&this._map.resetNorth()):(O(z.bearing||this._map.getBearing())&&(z.bearing=0),z.freezeElevation=!0,this._map.easeTo(z,{originalEvent:A})),this._updatingCamera=!1}}_fireEvent(i,o){this._map.fire(new l.k(i,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{delete this._frameId,this.handleEvent(new nl("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Hs extends l.E{constructor(i,o){super(),this._renderFrameCallback=()=>{const u=Math.min((P.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(u)),u<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=o.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new l.M(this.transform.center.lng,this.transform.center.lat)}setCenter(i,o){return this.jumpTo({center:i},o)}panBy(i,o,u){return i=l.P.convert(i).mult(-1),this.panTo(this.transform.center,l.e({offset:i},o),u)}panTo(i,o,u){return this.easeTo(l.e({center:i},o),u)}getZoom(){return this.transform.zoom}setZoom(i,o){return this.jumpTo({zoom:i},o),this}zoomTo(i,o,u){return this.easeTo(l.e({zoom:i},o),u)}zoomIn(i,o){return this.zoomTo(this.getZoom()+1,i,o),this}zoomOut(i,o){return this.zoomTo(this.getZoom()-1,i,o),this}getBearing(){return this.transform.bearing}setBearing(i,o){return this.jumpTo({bearing:i},o),this}getPadding(){return this.transform.padding}setPadding(i,o){return this.jumpTo({padding:i},o),this}rotateTo(i,o,u){return this.easeTo(l.e({bearing:i},o),u)}resetNorth(i,o){return this.rotateTo(0,l.e({duration:1e3},i),o),this}resetNorthPitch(i,o){return this.easeTo(l.e({bearing:0,pitch:0,duration:1e3},i),o),this}snapToNorth(i,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,o):this}getPitch(){return this.transform.pitch}setPitch(i,o){return this.jumpTo({pitch:i},o),this}cameraForBounds(i,o){i=rt.convert(i);const u=o&&o.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),u,o)}_cameraForBoxAndBearing(i,o,u,d){const y={top:0,bottom:0,right:0,left:0};if(typeof(d=l.e({padding:y,offset:[0,0],maxZoom:this.transform.maxZoom},d)).padding=="number"){const Wt=d.padding;d.padding={top:Wt,bottom:Wt,right:Wt,left:Wt}}d.padding=l.e(y,d.padding);const w=this.transform,M=w.padding,A=new rt(i,o),C=w.project(A.getNorthWest()),z=w.project(A.getNorthEast()),O=w.project(A.getSouthEast()),V=w.project(A.getSouthWest()),Z=l.b8(-u),W=C.rotate(Z),J=z.rotate(Z),j=O.rotate(Z),ot=V.rotate(Z),xt=new l.P(Math.max(W.x,J.x,ot.x,j.x),Math.max(W.y,J.y,ot.y,j.y)),et=new l.P(Math.min(W.x,J.x,ot.x,j.x),Math.min(W.y,J.y,ot.y,j.y)),pt=xt.sub(et),bt=(w.width-(M.left+M.right+d.padding.left+d.padding.right))/pt.x,wt=(w.height-(M.top+M.bottom+d.padding.top+d.padding.bottom))/pt.y;if(wt<0||bt<0)return void l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const St=Math.min(w.scaleZoom(w.scale*Math.min(bt,wt)),d.maxZoom),Bt=l.P.convert(d.offset),Lt=new l.P((d.padding.left-d.padding.right)/2,(d.padding.top-d.padding.bottom)/2).rotate(l.b8(u)),jt=Bt.add(Lt).mult(w.scale/w.zoomScale(St));return{center:w.unproject(C.add(O).div(2).sub(jt)),zoom:St,bearing:u}}fitBounds(i,o,u){return this._fitInternal(this.cameraForBounds(i,o),o,u)}fitScreenCoordinates(i,o,u,d,y){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.P.convert(i)),this.transform.pointLocation(l.P.convert(o)),u,d),d,y)}_fitInternal(i,o,u){return i?(delete(o=l.e(i,o)).padding,o.linear?this.easeTo(o,u):this.flyTo(o,u)):this}jumpTo(i,o){this.stop();const u=this._getTransformForUpdate();let d=!1,y=!1,w=!1;return"zoom"in i&&u.zoom!==+i.zoom&&(d=!0,u.zoom=+i.zoom),i.center!==void 0&&(u.center=l.M.convert(i.center)),"bearing"in i&&u.bearing!==+i.bearing&&(y=!0,u.bearing=+i.bearing),"pitch"in i&&u.pitch!==+i.pitch&&(w=!0,u.pitch=+i.pitch),i.padding==null||u.isPaddingEqual(i.padding)||(u.padding=i.padding),this._applyUpdatedTransform(u),this.fire(new l.k("movestart",o)).fire(new l.k("move",o)),d&&this.fire(new l.k("zoomstart",o)).fire(new l.k("zoom",o)).fire(new l.k("zoomend",o)),y&&this.fire(new l.k("rotatestart",o)).fire(new l.k("rotate",o)).fire(new l.k("rotateend",o)),w&&this.fire(new l.k("pitchstart",o)).fire(new l.k("pitch",o)).fire(new l.k("pitchend",o)),this.fire(new l.k("moveend",o))}calculateCameraOptionsFromTo(i,o,u,d=0){const y=l.Y.fromLngLat(i,o),w=l.Y.fromLngLat(u,d),M=w.x-y.x,A=w.y-y.y,C=w.z-y.z,z=Math.hypot(M,A,C);if(z===0)throw new Error("Can't calculate camera options with same From and To");const O=Math.hypot(M,A),V=this.transform.scaleZoom(this.transform.cameraToCenterDistance/z/this.transform.tileSize),Z=180*Math.atan2(M,-A)/Math.PI;let W=180*Math.acos(O/z)/Math.PI;return W=C<0?90-W:90+W,{center:w.toLngLat(),zoom:V,pitch:W,bearing:Z}}easeTo(i,o){var u;this._stop(!1,i.easeId),((i=l.e({offset:[0,0],duration:500,easing:l.b7},i)).animate===!1||!i.essential&&P.prefersReducedMotion)&&(i.duration=0);const d=this._getTransformForUpdate(),y=this.getZoom(),w=this.getBearing(),M=this.getPitch(),A=this.getPadding(),C="bearing"in i?this._normalizeBearing(i.bearing,w):w,z="pitch"in i?+i.pitch:M,O="padding"in i?i.padding:d.padding,V=l.P.convert(i.offset);let Z=d.centerPoint.add(V);const W=d.pointLocation(Z),{center:J,zoom:j}=d.getConstrained(l.M.convert(i.center||W),(u=i.zoom)!==null&&u!==void 0?u:y);this._normalizeCenter(J);const ot=d.project(W),xt=d.project(J).sub(ot),et=d.zoomScale(j-y);let pt,bt;i.around&&(pt=l.M.convert(i.around),bt=d.locationPoint(pt));const wt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||j!==y,this._rotating=this._rotating||w!==C,this._pitching=this._pitching||z!==M,this._padding=!d.isPaddingEqual(O),this._easeId=i.easeId,this._prepareEase(o,i.noMoveStart,wt),this.terrain&&this._prepareElevation(J),this._ease(St=>{if(this._zooming&&(d.zoom=l.z.number(y,j,St)),this._rotating&&(d.bearing=l.z.number(w,C,St)),this._pitching&&(d.pitch=l.z.number(M,z,St)),this._padding&&(d.interpolatePadding(A,O,St),Z=d.centerPoint.add(V)),this.terrain&&!i.freezeElevation&&this._updateElevation(St),pt)d.setLocationAtPoint(pt,bt);else{const Bt=d.zoomScale(d.zoom-y),Lt=j>y?Math.min(2,et):Math.max(.5,et),jt=Math.pow(Lt,1-St),Wt=d.unproject(ot.add(xt.mult(St*jt)).mult(Bt));d.setLocationAtPoint(d.renderWorldCopies?Wt.wrap():Wt,Z)}this._applyUpdatedTransform(d),this._fireMoveEvents(o)},St=>{this.terrain&&this._finalizeElevation(),this._afterEase(o,St)},i),this}_prepareEase(i,o,u={}){this._moving=!0,o||u.moving||this.fire(new l.k("movestart",i)),this._zooming&&!u.zooming&&this.fire(new l.k("zoomstart",i)),this._rotating&&!u.rotating&&this.fire(new l.k("rotatestart",i)),this._pitching&&!u.pitching&&this.fire(new l.k("pitchstart",i))}_prepareElevation(i){this._elevationCenter=i,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(i){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const o=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(i<1&&o!==this._elevationTarget){const u=this._elevationTarget-this._elevationStart;this._elevationStart+=i*(u-(o-(u*i+this._elevationStart))/(1-i)),this._elevationTarget=o}this.transform.elevation=l.z.number(this._elevationStart,this._elevationTarget,i)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(i){if(!this.transformCameraUpdate)return;const o=i.clone(),{center:u,zoom:d,pitch:y,bearing:w,elevation:M}=this.transformCameraUpdate(o);u&&(o.center=u),d!==void 0&&(o.zoom=d),y!==void 0&&(o.pitch=y),w!==void 0&&(o.bearing=w),M!==void 0&&(o.elevation=M),this.transform.apply(o)}_fireMoveEvents(i){this.fire(new l.k("move",i)),this._zooming&&this.fire(new l.k("zoom",i)),this._rotating&&this.fire(new l.k("rotate",i)),this._pitching&&this.fire(new l.k("pitch",i))}_afterEase(i,o){if(this._easeId&&o&&this._easeId===o)return;delete this._easeId;const u=this._zooming,d=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new l.k("zoomend",i)),d&&this.fire(new l.k("rotateend",i)),y&&this.fire(new l.k("pitchend",i)),this.fire(new l.k("moveend",i))}flyTo(i,o){var u;if(!i.essential&&P.prefersReducedMotion){const ei=l.L(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ei,o)}this.stop(),i=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.b7},i);const d=this._getTransformForUpdate(),y=this.getZoom(),w=this.getBearing(),M=this.getPitch(),A=this.getPadding(),C="bearing"in i?this._normalizeBearing(i.bearing,w):w,z="pitch"in i?+i.pitch:M,O="padding"in i?i.padding:d.padding,V=l.P.convert(i.offset);let Z=d.centerPoint.add(V);const W=d.pointLocation(Z),{center:J,zoom:j}=d.getConstrained(l.M.convert(i.center||W),(u=i.zoom)!==null&&u!==void 0?u:y);this._normalizeCenter(J);const ot=d.zoomScale(j-y),xt=d.project(W),et=d.project(J).sub(xt);let pt=i.curve;const bt=Math.max(d.width,d.height),wt=bt/ot,St=et.mag();if("minZoom"in i){const ei=l.ac(Math.min(i.minZoom,y,j),d.minZoom,d.maxZoom),ke=bt/d.zoomScale(ei-y);pt=Math.sqrt(ke/St*2)}const Bt=pt*pt;function Lt(ei){const ke=(wt*wt-bt*bt+(ei?-1:1)*Bt*Bt*St*St)/(2*(ei?wt:bt)*Bt*St);return Math.log(Math.sqrt(ke*ke+1)-ke)}function jt(ei){return(Math.exp(ei)-Math.exp(-ei))/2}function Wt(ei){return(Math.exp(ei)+Math.exp(-ei))/2}const $e=Lt(!1);let Kt=function(ei){return Wt($e)/Wt($e+pt*ei)},Ie=function(ei){return bt*((Wt($e)*(jt(ke=$e+pt*ei)/Wt(ke))-jt($e))/Bt)/St;var ke},Ve=(Lt(!0)-$e)/pt;if(Math.abs(St)<1e-6||!isFinite(Ve)){if(Math.abs(bt-wt)<1e-6)return this.easeTo(i,o);const ei=wt<bt?-1:1;Ve=Math.abs(Math.log(wt/bt))/pt,Ie=function(){return 0},Kt=function(ke){return Math.exp(ei*pt*ke)}}return i.duration="duration"in i?+i.duration:1e3*Ve/("screenSpeed"in i?+i.screenSpeed/pt:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0),this._zooming=!0,this._rotating=w!==C,this._pitching=z!==M,this._padding=!d.isPaddingEqual(O),this._prepareEase(o,!1),this.terrain&&this._prepareElevation(J),this._ease(ei=>{const ke=ei*Ve,je=1/Kt(ke);d.zoom=ei===1?j:y+d.scaleZoom(je),this._rotating&&(d.bearing=l.z.number(w,C,ei)),this._pitching&&(d.pitch=l.z.number(M,z,ei)),this._padding&&(d.interpolatePadding(A,O,ei),Z=d.centerPoint.add(V)),this.terrain&&!i.freezeElevation&&this._updateElevation(ei);const He=ei===1?J:d.unproject(xt.add(et.mult(Ie(ke))).mult(je));d.setLocationAtPoint(d.renderWorldCopies?He.wrap():He,Z),this._applyUpdatedTransform(d),this._fireMoveEvents(o)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(o)},i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const u=this._onEaseEnd;delete this._onEaseEnd,u.call(this,o)}if(!i){const u=this.handlers;u&&u.stop(!1)}return this}_ease(i,o,u){u.animate===!1||u.duration===0?(i(1),o()):(this._easeStart=P.now(),this._easeOptions=u,this._onEaseFrame=i,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(i,o){i=l.b1(i,-180,180);const u=Math.abs(i-o);return Math.abs(i-360-o)<u&&(i-=360),Math.abs(i+360-o)<u&&(i+=360),i}_normalizeCenter(i){const o=this.transform;if(!o.renderWorldCopies||o.lngRange)return;const u=i.lng-o.center.lng;i.lng+=u>180?-360:u<-180?360:0}queryTerrainElevation(i){return this.terrain?this.terrain.getElevationForLngLatZoom(l.M.convert(i),this.transform.tileZoom)-this.transform.elevation:null}}const wc={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Pr{constructor(i=wc){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=o=>{!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"&&o.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=i}getDefaultPosition(){return"bottom-right"}onAdd(i){return this._map=i,this._compact=this.options.compact,this._container=L.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=L.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=L.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){L.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(i,o){const u=this._map._getUIString(`AttributionControl.${o}`);i.title=u,i.setAttribute("aria-label",u)}_updateAttributions(){if(!this._map.style)return;let i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map(d=>typeof d!="string"?"":d)):typeof this.options.customAttribution=="string"&&i.push(this.options.customAttribution)),this._map.style.stylesheet){const d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}const o=this._map.style.sourceCaches;for(const d in o){const y=o[d];if(y.used||y.usedForTerrain){const w=y.getSource();w.attribution&&i.indexOf(w.attribution)<0&&i.push(w.attribution)}}i=i.filter(d=>String(d).trim()),i.sort((d,y)=>d.length-y.length),i=i.filter((d,y)=>{for(let w=y+1;w<i.length;w++)if(i[w].indexOf(d)>=0)return!1;return!0});const u=i.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,i.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Iu{constructor(i={}){this._updateCompact=()=>{const o=this._container.children;if(o.length){const u=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&u.classList.add("maplibregl-compact"):u.classList.remove("maplibregl-compact")}},this.options=i}getDefaultPosition(){return"bottom-left"}onAdd(i){this._map=i,this._compact=this.options&&this.options.compact,this._container=L.create("div","maplibregl-ctrl");const o=L.create("a","maplibregl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://maplibre.org/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){L.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class so{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const o=++this._id;return this._queue.push({callback:i,id:o,cancelled:!1}),o}remove(i){const o=this._currentlyRunning,u=o?this._queue.concat(o):this._queue;for(const d of u)if(d.id===i)return void(d.cancelled=!0)}run(i=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const o=this._currentlyRunning=this._queue;this._queue=[];for(const u of o)if(!u.cancelled&&(u.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Ui=l.X([{name:"a_pos3d",type:"Int16",components:3}]);class Ki extends l.E{constructor(i){super(),this.sourceCache=i,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,i.usedForTerrain=!0,i.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(i,o){this.sourceCache.update(i,o),this._renderableTilesKeys=[];const u={};for(const d of i.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:o}))u[d.key]=!0,this._renderableTilesKeys.push(d.key),this._tiles[d.key]||(d.posMatrix=new Float64Array(16),l.aN(d.posMatrix,0,l.W,0,l.W,0,1),this._tiles[d.key]=new gi(d,this.tileSize));for(const d in this._tiles)u[d]||delete this._tiles[d]}freeRtt(i){for(const o in this._tiles){const u=this._tiles[o];(!i||u.tileID.equals(i)||u.tileID.isChildOf(i)||i.isChildOf(u.tileID))&&(u.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(i=>this.getTileByID(i))}getTileByID(i){return this._tiles[i]}getTerrainCoords(i){const o={};for(const u of this._renderableTilesKeys){const d=this._tiles[u].tileID;if(d.canonical.equals(i.canonical)){const y=i.clone();y.posMatrix=new Float64Array(16),l.aN(y.posMatrix,0,l.W,0,l.W,0,1),o[u]=y}else if(d.canonical.isChildOf(i.canonical)){const y=i.clone();y.posMatrix=new Float64Array(16);const w=d.canonical.z-i.canonical.z,M=d.canonical.x-(d.canonical.x>>w<<w),A=d.canonical.y-(d.canonical.y>>w<<w),C=l.W>>w;l.aN(y.posMatrix,0,C,0,C,0,1),l.H(y.posMatrix,y.posMatrix,[-M*C,-A*C,0]),o[u]=y}else if(i.canonical.isChildOf(d.canonical)){const y=i.clone();y.posMatrix=new Float64Array(16);const w=i.canonical.z-d.canonical.z,M=i.canonical.x-(i.canonical.x>>w<<w),A=i.canonical.y-(i.canonical.y>>w<<w),C=l.W>>w;l.aN(y.posMatrix,0,l.W,0,l.W,0,1),l.H(y.posMatrix,y.posMatrix,[M*C,A*C,0]),l.J(y.posMatrix,y.posMatrix,[1/2**w,1/2**w,0]),o[u]=y}}return o}getSourceTile(i,o){const u=this.sourceCache._source;let d=i.overscaledZ-this.deltaZoom;if(d>u.maxzoom&&(d=u.maxzoom),d<u.minzoom)return null;this._sourceTileCache[i.key]||(this._sourceTileCache[i.key]=i.scaledTo(d).key);let y=this.sourceCache.getTileByID(this._sourceTileCache[i.key]);if((!y||!y.dem)&&o)for(;d>=u.minzoom&&(!y||!y.dem);)y=this.sourceCache.getTileByID(i.scaledTo(d--).key);return y}tilesAfterTime(i=Date.now()){return Object.values(this._tiles).filter(o=>o.timeAdded>=i)}}class Pu{constructor(i,o,u){this.painter=i,this.sourceCache=new Ki(o),this.options=u,this.exaggeration=typeof u.exaggeration=="number"?u.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(i,o,u,d=l.W){var y;if(!(o>=0&&o<d&&u>=0&&u<d))return 0;const w=this.getTerrainData(i),M=(y=w.tile)===null||y===void 0?void 0:y.dem;if(!M)return 0;const A=function(W,J,j){var ot=J[0],xt=J[1];return W[0]=j[0]*ot+j[4]*xt+j[12],W[1]=j[1]*ot+j[5]*xt+j[13],W}([],[o/d*l.W,u/d*l.W],w.u_terrain_matrix),C=[A[0]*M.dim,A[1]*M.dim],z=Math.floor(C[0]),O=Math.floor(C[1]),V=C[0]-z,Z=C[1]-O;return M.get(z,O)*(1-V)*(1-Z)+M.get(z+1,O)*V*(1-Z)+M.get(z,O+1)*(1-V)*Z+M.get(z+1,O+1)*V*Z}getElevationForLngLatZoom(i,o){const{tileID:u,mercatorX:d,mercatorY:y}=this._getOverscaledTileIDFromLngLatZoom(i,o);return this.getElevation(u,d%l.W,y%l.W,l.W)}getElevation(i,o,u,d=l.W){return this.getDEMElevation(i,o,u,d)*this.exaggeration}getTerrainData(i){if(!this._emptyDemTexture){const d=this.painter.context,y=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new xe(d,y,d.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new xe(d,new l.R({width:1,height:1}),d.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.an([])}const o=this.sourceCache.getSourceTile(i,!0);if(o&&o.dem&&(!o.demTexture||o.needsTerrainPrepare)){const d=this.painter.context;o.demTexture=this.painter.getTileTexture(o.dem.stride),o.demTexture?o.demTexture.update(o.dem.getPixels(),{premultiply:!1}):o.demTexture=new xe(d,o.dem.getPixels(),d.gl.RGBA,{premultiply:!1}),o.demTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),o.needsTerrainPrepare=!1}const u=o&&o+o.tileID.key+i.key;if(u&&!this._demMatrixCache[u]){const d=this.sourceCache.sourceCache._source.maxzoom;let y=i.canonical.z-o.tileID.canonical.z;i.overscaledZ>i.canonical.z&&(i.canonical.z>=d?y=i.canonical.z-d:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const w=i.canonical.x-(i.canonical.x>>y<<y),M=i.canonical.y-(i.canonical.y>>y<<y),A=l.b9(new Float64Array(16),[1/(l.W<<y),1/(l.W<<y),0]);l.H(A,A,[w*l.W,M*l.W,0]),this._demMatrixCache[i.key]={matrix:A,coord:i}}return{u_depth:2,u_terrain:3,u_terrain_dim:o&&o.dem&&o.dem.dim||1,u_terrain_matrix:u?this._demMatrixCache[i.key].matrix:this._emptyDemMatrix,u_terrain_unpack:o&&o.dem&&o.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(o&&o.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:o}}getFramebuffer(i){const o=this.painter,u=o.width/devicePixelRatio,d=o.height/devicePixelRatio;return!this._fbo||this._fbo.width===u&&this._fbo.height===d||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new xe(o.context,{width:u,height:d,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new xe(o.context,{width:u,height:d,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=o.context.createFramebuffer(u,d,!0,!1),this._fbo.depthAttachment.set(o.context.createRenderbuffer(o.context.gl.DEPTH_COMPONENT16,u,d))),this._fbo.colorAttachment.set(i==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const i=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const o=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let y=0,w=0;y<this._coordsTextureSize;y++)for(let M=0;M<this._coordsTextureSize;M++,w+=4)o[w+0]=255&M,o[w+1]=255&y,o[w+2]=M>>8<<4|y>>8,o[w+3]=0;const u=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(o.buffer)),d=new xe(i,u,i.gl.RGBA,{premultiply:!1});return d.bind(i.gl.NEAREST,i.gl.CLAMP_TO_EDGE),this._coordsTexture=d,d}pointCoordinate(i){this.painter.maybeDrawDepthAndCoords(!0);const o=new Uint8Array(4),u=this.painter.context,d=u.gl,y=Math.round(i.x*this.painter.pixelRatio/devicePixelRatio),w=Math.round(i.y*this.painter.pixelRatio/devicePixelRatio),M=Math.round(this.painter.height/devicePixelRatio);u.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),d.readPixels(y,M-w-1,1,1,d.RGBA,d.UNSIGNED_BYTE,o),u.bindFramebuffer.set(null);const A=o[0]+(o[2]>>4<<8),C=o[1]+((15&o[2])<<8),z=this.coordsIndex[255-o[3]],O=z&&this.sourceCache.getTileByID(z);if(!O)return null;const V=this._coordsTextureSize,Z=(1<<O.tileID.canonical.z)*V;return new l.Y((O.tileID.canonical.x*V+A)/Z+O.tileID.wrap,(O.tileID.canonical.y*V+C)/Z,this.getElevation(O.tileID,A,C,V))}depthAtPoint(i){const o=new Uint8Array(4),u=this.painter.context,d=u.gl;return u.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),d.readPixels(i.x,this.painter.height/devicePixelRatio-i.y-1,1,1,d.RGBA,d.UNSIGNED_BYTE,o),u.bindFramebuffer.set(null),(o[0]/16777216+o[1]/65536+o[2]/256+o[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const i=this.painter.context,o=new l.ba,u=new l.aX,d=this.meshSize,y=l.W/d,w=d*d;for(let O=0;O<=d;O++)for(let V=0;V<=d;V++)o.emplaceBack(V*y,O*y,0);for(let O=0;O<w;O+=d+1)for(let V=0;V<d;V++)u.emplaceBack(V+O,d+V+O+1,d+V+O+2),u.emplaceBack(V+O,d+V+O+2,V+O+1);const M=o.length,A=M+2*(d+1);for(const O of[0,1])for(let V=0;V<=d;V++)for(const Z of[0,1])o.emplaceBack(V*y,O*l.W,Z);for(let O=0;O<2*d;O+=2)u.emplaceBack(A+O,A+O+1,A+O+3),u.emplaceBack(A+O,A+O+3,A+O+2),u.emplaceBack(M+O,M+O+3,M+O+1),u.emplaceBack(M+O,M+O+2,M+O+3);const C=o.length,z=C+2*(d+1);for(const O of[0,1])for(let V=0;V<=d;V++)for(const Z of[0,1])o.emplaceBack(O*l.W,V*y,Z);for(let O=0;O<2*d;O+=2)u.emplaceBack(C+O,C+O+1,C+O+3),u.emplaceBack(C+O,C+O+3,C+O+2),u.emplaceBack(z+O,z+O+3,z+O+1),u.emplaceBack(z+O,z+O+2,z+O+3);return this._mesh={indexBuffer:i.createIndexBuffer(u),vertexBuffer:i.createVertexBuffer(o,Ui.members),segments:l.$.simpleSegment(0,0,o.length,u.length)},this._mesh}getMeshFrameDelta(i){return 2*Math.PI*l.bb/Math.pow(2,i)/5}getMinTileElevationForLngLatZoom(i,o){var u;const{tileID:d}=this._getOverscaledTileIDFromLngLatZoom(i,o);return(u=this.getMinMaxElevation(d).minElevation)!==null&&u!==void 0?u:0}getMinMaxElevation(i){const o=this.getTerrainData(i).tile,u={minElevation:null,maxElevation:null};return o&&o.dem&&(u.minElevation=o.dem.min*this.exaggeration,u.maxElevation=o.dem.max*this.exaggeration),u}_getOverscaledTileIDFromLngLatZoom(i,o){const u=l.Y.fromLngLat(i.wrap()),d=(1<<o)*l.W,y=u.x*d,w=u.y*d,M=Math.floor(y/l.W),A=Math.floor(w/l.W);return{tileID:new l.Q(o,0,o,M,A),mercatorX:y,mercatorY:w}}}class ro{constructor(i,o,u){this._context=i,this._size=o,this._tileSize=u,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const i of this._objects)i.texture.destroy(),i.fbo.destroy()}_createObject(i){const o=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),u=new xe(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return u.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),o.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),o.colorAttachment.set(u.texture),{id:i,fbo:o,texture:u,stamp:-1,inUse:!1}}getObjectForId(i){return this._objects[i]}useObject(i){i.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(o=>i.id!==o),this._recentlyUsed.push(i.id)}stampObject(i){i.stamp=++this._stamp}getOrCreateFreeObject(){for(const o of this._recentlyUsed)if(!this._objects[o].inUse)return this._objects[o];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const i=this._createObject(this._objects.length);return this._objects.push(i),i}freeObject(i){i.inUse=!1}freeAllObjects(){for(const i of this._objects)this.freeObject(i)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(i=>!i.inUse)===!1}}const Yr={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Mc{constructor(i,o){this.painter=i,this.terrain=o,this.pool=new ro(i.context,30,o.sourceCache.tileSize*o.qualityFactor)}destruct(){this.pool.destruct()}getTexture(i){return this.pool.getObjectForId(i.rtt[this._stacks.length-1].id).texture}prepareForRender(i,o){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=i._order.filter(u=>!i._layers[u].isHidden(o)),this._coordsDescendingInv={};for(const u in i.sourceCaches){this._coordsDescendingInv[u]={};const d=i.sourceCaches[u].getVisibleCoordinates();for(const y of d){const w=this.terrain.sourceCache.getTerrainCoords(y);for(const M in w)this._coordsDescendingInv[u][M]||(this._coordsDescendingInv[u][M]=[]),this._coordsDescendingInv[u][M].push(w[M])}}this._coordsDescendingInvStr={};for(const u of i._order){const d=i._layers[u],y=d.source;if(Yr[d.type]&&!this._coordsDescendingInvStr[y]){this._coordsDescendingInvStr[y]={};for(const w in this._coordsDescendingInv[y])this._coordsDescendingInvStr[y][w]=this._coordsDescendingInv[y][w].map(M=>M.key).sort().join()}}for(const u of this._renderableTiles)for(const d in this._coordsDescendingInvStr){const y=this._coordsDescendingInvStr[d][u.tileID.key];y&&y!==u.rttCoords[d]&&(u.rtt=[])}}renderLayer(i){if(i.isHidden(this.painter.transform.zoom))return!1;const o=i.type,u=this.painter,d=this._renderableLayerIds[this._renderableLayerIds.length-1]===i.id;if(Yr[o]&&(this._prevType&&Yr[this._prevType]||this._stacks.push([]),this._prevType=o,this._stacks[this._stacks.length-1].push(i.id),!d))return!0;if(Yr[this._prevType]||Yr[o]&&d){this._prevType=o;const y=this._stacks.length-1,w=this._stacks[y]||[];for(const M of this._renderableTiles){if(this.pool.isFull()&&(Qo(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(M),M.rtt[y]){const C=this.pool.getObjectForId(M.rtt[y].id);if(C.stamp===M.rtt[y].stamp){this.pool.useObject(C);continue}}const A=this.pool.getOrCreateFreeObject();this.pool.useObject(A),this.pool.stampObject(A),M.rtt[y]={id:A.id,stamp:A.stamp},u.context.bindFramebuffer.set(A.fbo.framebuffer),u.context.clear({color:l.aO.transparent,stencil:0}),u.currentStencilSource=void 0;for(let C=0;C<w.length;C++){const z=u.style._layers[w[C]],O=z.source?this._coordsDescendingInv[z.source][M.tileID.key]:[M.tileID];u.context.viewport.set([0,0,A.fbo.width,A.fbo.height]),u._renderTileClippingMasks(z,O),u.renderLayer(u,u.style.sourceCaches[z.source],z,O),z.source&&(M.rttCoords[z.source]=this._coordsDescendingInvStr[z.source][M.tileID.key])}}return Qo(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Yr[o]}return!1}}const Sc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Tc=T,no={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:wc,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},al=g=>{g.touchstart=g.dragStart,g.touchmoveWindow=g.dragMove,g.touchend=g.dragEnd},Ac={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ec{constructor(i,o,u=!1){this.mousedown=w=>{this.startMouse(l.e({},w,{ctrlKey:!0,preventDefault:()=>w.preventDefault()}),L.mousePos(this.element,w)),L.addEventListener(window,"mousemove",this.mousemove),L.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=w=>{this.moveMouse(w,L.mousePos(this.element,w))},this.mouseup=w=>{this.mouseRotate.dragEnd(w),this.mousePitch&&this.mousePitch.dragEnd(w),this.offTemp()},this.touchstart=w=>{w.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=L.touchPos(this.element,w.targetTouches)[0],this.startTouch(w,this._startPos),L.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),L.addEventListener(window,"touchend",this.touchend))},this.touchmove=w=>{w.targetTouches.length!==1?this.reset():(this._lastPos=L.touchPos(this.element,w.targetTouches)[0],this.moveTouch(w,this._lastPos))},this.touchend=w=>{w.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const d=i.dragRotate._mouseRotate.getClickTolerance(),y=i.dragRotate._mousePitch.getClickTolerance();this.element=o,this.mouseRotate=da({clickTolerance:d,enable:!0}),this.touchRotate=(({enable:w,clickTolerance:M,bearingDegreesPerPixelMoved:A=.8})=>{const C=new le;return new ua({clickTolerance:M,move:(z,O)=>({bearingDelta:(O.x-z.x)*A}),moveStateManager:C,enable:w,assignEvents:al})})({clickTolerance:d,enable:!0}),this.map=i,u&&(this.mousePitch=fa({clickTolerance:y,enable:!0}),this.touchPitch=(({enable:w,clickTolerance:M,pitchDegreesPerPixelMoved:A=-.5})=>{const C=new le;return new ua({clickTolerance:M,move:(z,O)=>({pitchDelta:(O.y-z.y)*A}),moveStateManager:C,enable:w,assignEvents:al})})({clickTolerance:y,enable:!0})),L.addEventListener(o,"mousedown",this.mousedown),L.addEventListener(o,"touchstart",this.touchstart,{passive:!1}),L.addEventListener(o,"touchcancel",this.reset)}startMouse(i,o){this.mouseRotate.dragStart(i,o),this.mousePitch&&this.mousePitch.dragStart(i,o),L.disableDrag()}startTouch(i,o){this.touchRotate.dragStart(i,o),this.touchPitch&&this.touchPitch.dragStart(i,o),L.disableDrag()}moveMouse(i,o){const u=this.map,{bearingDelta:d}=this.mouseRotate.dragMove(i,o)||{};if(d&&u.setBearing(u.getBearing()+d),this.mousePitch){const{pitchDelta:y}=this.mousePitch.dragMove(i,o)||{};y&&u.setPitch(u.getPitch()+y)}}moveTouch(i,o){const u=this.map,{bearingDelta:d}=this.touchRotate.dragMove(i,o)||{};if(d&&u.setBearing(u.getBearing()+d),this.touchPitch){const{pitchDelta:y}=this.touchPitch.dragMove(i,o)||{};y&&u.setPitch(u.getPitch()+y)}}off(){const i=this.element;L.removeEventListener(i,"mousedown",this.mousedown),L.removeEventListener(i,"touchstart",this.touchstart,{passive:!1}),L.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),L.removeEventListener(window,"touchend",this.touchend),L.removeEventListener(i,"touchcancel",this.reset),this.offTemp()}offTemp(){L.enableDrag(),L.removeEventListener(window,"mousemove",this.mousemove),L.removeEventListener(window,"mouseup",this.mouseup),L.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),L.removeEventListener(window,"touchend",this.touchend)}}let Jr;function ol(g,i,o){const u=new l.M(g.lng,g.lat);if(g=new l.M(g.lng,g.lat),i){const d=new l.M(g.lng-360,g.lat),y=new l.M(g.lng+360,g.lat),w=o.locationPoint(g).distSqr(i);o.locationPoint(d).distSqr(i)<w?g=d:o.locationPoint(y).distSqr(i)<w&&(g=y)}for(;Math.abs(g.lng-o.center.lng)>180;){const d=o.locationPoint(g);if(d.x>=0&&d.y>=0&&d.x<=o.width&&d.y<=o.height)break;g.lng>o.center.lng?g.lng-=360:g.lng+=360}return g.lng!==u.lng&&o.locationPoint(g).y>o.height/2-o.getHorizon()?g:u}const ao={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ll(g,i,o){const u=g.classList;for(const d in ao)u.remove(`maplibregl-${o}-anchor-${d}`);u.add(`maplibregl-${o}-anchor-${i}`)}class oo extends l.E{constructor(i){if(super(),this._onKeyPress=o=>{const u=o.code,d=o.charCode||o.keyCode;u!=="Space"&&u!=="Enter"&&d!==32&&d!==13||this.togglePopup()},this._onMapClick=o=>{const u=o.originalEvent.target,d=this._element;this._popup&&(u===d||d.contains(u))&&this.togglePopup()},this._update=o=>{var u;if(!this._map)return;const d=this._map.loaded()&&!this._map.isMoving();((o==null?void 0:o.type)==="terrain"||(o==null?void 0:o.type)==="render"&&!d)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?ol(this._lngLat,this._flatPos,this._map.transform):(u=this._lngLat)===null||u===void 0?void 0:u.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let y="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?y=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(y=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let w="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?w="rotateX(0deg)":this._pitchAlignment==="map"&&(w=`rotateX(${this._map.getPitch()}deg)`),o&&o.type!=="moveend"||(this._pos=this._pos.round()),L.setTransform(this._element,`${ao[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${w} ${y}`),P.frameAsync(new AbortController).then(()=>{this._updateOpacity(o&&o.type==="moveend")}).catch(()=>{})},this._onMove=o=>{if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.k("dragstart"))),this.fire(new l.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.k("dragend")),this._state="inactive"},this._addDragHandler=o=>{this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment!=="auto"?i.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(i==null?void 0:i.opacity,i==null?void 0:i.opacityWhenCovered),i&&i.element)this._element=i.element,this._offset=l.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=L.create("div"),this._element.setAttribute("aria-label","Map marker");const o=L.createNS("http://www.w3.org/2000/svg","svg"),u=41,d=27;o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height",`${u}px`),o.setAttributeNS(null,"width",`${d}px`),o.setAttributeNS(null,"viewBox",`0 0 ${d} ${u}`);const y=L.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd");const w=L.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"fill-rule","nonzero");const M=L.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"transform","translate(3.0, 29.0)"),M.setAttributeNS(null,"fill","#000000");const A=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ot of A){const xt=L.createNS("http://www.w3.org/2000/svg","ellipse");xt.setAttributeNS(null,"opacity","0.04"),xt.setAttributeNS(null,"cx","10.5"),xt.setAttributeNS(null,"cy","5.80029008"),xt.setAttributeNS(null,"rx",ot.rx),xt.setAttributeNS(null,"ry",ot.ry),M.appendChild(xt)}const C=L.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill",this._color);const z=L.createNS("http://www.w3.org/2000/svg","path");z.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),C.appendChild(z);const O=L.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"opacity","0.25"),O.setAttributeNS(null,"fill","#000000");const V=L.createNS("http://www.w3.org/2000/svg","path");V.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),O.appendChild(V);const Z=L.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Z.setAttributeNS(null,"fill","#FFFFFF");const W=L.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"transform","translate(8.0, 8.0)");const J=L.createNS("http://www.w3.org/2000/svg","circle");J.setAttributeNS(null,"fill","#000000"),J.setAttributeNS(null,"opacity","0.25"),J.setAttributeNS(null,"cx","5.5"),J.setAttributeNS(null,"cy","5.5"),J.setAttributeNS(null,"r","5.4999962");const j=L.createNS("http://www.w3.org/2000/svg","circle");j.setAttributeNS(null,"fill","#FFFFFF"),j.setAttributeNS(null,"cx","5.5"),j.setAttributeNS(null,"cy","5.5"),j.setAttributeNS(null,"r","5.4999962"),W.appendChild(J),W.appendChild(j),w.appendChild(M),w.appendChild(C),w.appendChild(O),w.appendChild(Z),w.appendChild(W),o.appendChild(w),o.setAttributeNS(null,"height",u*this._scale+"px"),o.setAttributeNS(null,"width",d*this._scale+"px"),this._element.appendChild(o),this._offset=l.P.convert(i&&i.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",o=>{o.preventDefault()}),this._element.addEventListener("mousedown",o=>{o.preventDefault()}),ll(this._element,this._anchor,"marker"),i&&i.className)for(const o of i.className.split(" "))this._element.classList.add(o);this._popup=null}addTo(i){return this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._update),i.on("moveend",this._update),i.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),L.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=l.M.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const d=Math.abs(13.5)/Math.SQRT2;i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(38.1-13.5+d)],"bottom-right":[-d,-1*(38.1-13.5+d)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const i=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:i?(i.isOpen()?i.remove():(i.setLngLat(this._lngLat),i.addTo(this._map)),this):this}_updateOpacity(i=!1){var o,u;if(!(!((o=this._map)===null||o===void 0)&&o.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(i)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const d=this._map,y=d.terrain.depthAtPoint(this._pos),w=d.terrain.getElevationForLngLatZoom(this._lngLat,d.transform.tileZoom);if(d.transform.lngLatToCameraDepth(this._lngLat,w)-y<.006)return void(this._element.style.opacity=this._opacity);const M=-this._offset.y/d.transform._pixelPerMeter,A=Math.sin(d.getPitch()*Math.PI/180)*M,C=d.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),z=d.transform.lngLatToCameraDepth(this._lngLat,w+A)-C>.006;!((u=this._popup)===null||u===void 0)&&u.isOpen()&&z&&this._popup.remove(),this._element.style.opacity=z?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(i){return this._offset=l.P.convert(i),this._update(),this}addClassName(i){this._element.classList.add(i)}removeClassName(i){this._element.classList.remove(i)}toggleClassName(i){return this._element.classList.toggle(i)}setDraggable(i){return this._draggable=!!i,this._map&&(i?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i&&i!=="auto"?i:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(i,o){return i===void 0&&o===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),i!==void 0&&(this._opacity=i),o!==void 0&&(this._opacityWhenCovered=o),this._map&&this._updateOpacity(!0),this}}const cl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ma=0,$n=!1;const hl={maxWidth:100,unit:"metric"};function ul(g,i,o){const u=o&&o.maxWidth||100,d=g._container.clientHeight/2,y=g.unproject([0,d]),w=g.unproject([u,d]),M=y.distanceTo(w);if(o&&o.unit==="imperial"){const A=3.2808*M;A>5280?Vn(i,u,A/5280,g._getUIString("ScaleControl.Miles")):Vn(i,u,A,g._getUIString("ScaleControl.Feet"))}else o&&o.unit==="nautical"?Vn(i,u,M/1852,g._getUIString("ScaleControl.NauticalMiles")):M>=1e3?Vn(i,u,M/1e3,g._getUIString("ScaleControl.Kilometers")):Vn(i,u,M,g._getUIString("ScaleControl.Meters"))}function Vn(g,i,o,u){const d=function(y){const w=Math.pow(10,`${Math.floor(y)}`.length-1);let M=y/w;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(A){const C=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*C)/C}(M),w*M}(o);g.style.width=i*(d/o)+"px",g.innerHTML=`${d}&nbsp;${u}`}const Ic={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Pc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function dl(g){if(g){if(typeof g=="number"){const i=Math.round(Math.abs(g)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,g),"top-left":new l.P(i,i),"top-right":new l.P(-i,i),bottom:new l.P(0,-g),"bottom-left":new l.P(i,-i),"bottom-right":new l.P(-i,-i),left:new l.P(g,0),right:new l.P(-g,0)}}if(g instanceof l.P||Array.isArray(g)){const i=l.P.convert(g);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:l.P.convert(g.center||[0,0]),top:l.P.convert(g.top||[0,0]),"top-left":l.P.convert(g["top-left"]||[0,0]),"top-right":l.P.convert(g["top-right"]||[0,0]),bottom:l.P.convert(g.bottom||[0,0]),"bottom-left":l.P.convert(g["bottom-left"]||[0,0]),"bottom-right":l.P.convert(g["bottom-right"]||[0,0]),left:l.P.convert(g.left||[0,0]),right:l.P.convert(g.right||[0,0])}}return dl(new l.P(0,0))}const Cu=T;m.AJAXError=l.be,m.Evented=l.E,m.LngLat=l.M,m.MercatorCoordinate=l.Y,m.Point=l.P,m.addProtocol=l.bf,m.config=l.a,m.removeProtocol=l.bg,m.AttributionControl=Pr,m.BoxZoomHandler=Er,m.CanvasSource=ue,m.CooperativeGesturesHandler=ve,m.DoubleClickZoomHandler=xc,m.DragPanHandler=Eu,m.DragRotateHandler=Ir,m.EdgeInsets=ca,m.FullscreenControl=class extends l.E{constructor(g={}){super(),this._onFullscreenChange=()=>{var i;let o=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((i=o==null?void 0:o.shadowRoot)===null||i===void 0)&&i.fullscreenElement;)o=o.shadowRoot.fullscreenElement;o===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){L.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const g=this._fullscreenButton=L.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);L.create("span","maplibregl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.title=g}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},m.GeoJSONSource=ne,m.GeolocateControl=class extends l.E{constructor(g){super(),this._onSuccess=i=>{if(this._map){if(this._isOutOfMapMaxBounds(i))return this._setErrorState(),this.fire(new l.k("outofmaxbounds",i)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=i,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(i),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(i),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.k("geolocate",i)),this._finish()}},this._updateCamera=i=>{const o=new l.M(i.coords.longitude,i.coords.latitude),u=i.coords.accuracy,d=this._map.getBearing(),y=l.e({bearing:d},this.options.fitBoundsOptions),w=rt.fromLngLat(o,u);this._map.fitBounds(w,y,{geolocateSource:!0})},this._updateMarker=i=>{if(i){const o=new l.M(i.coords.longitude,i.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=i.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=i=>{if(this._map){if(this.options.trackUserLocation)if(i.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(i.code===3&&$n)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.k("error",i)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=i=>{if(this._map){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=L.create("button","maplibregl-ctrl-geolocate",this._container),L.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",i===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=L.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new oo({element:this._dotElement}),this._circleElement=L.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new oo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.k("trackuserlocationend")))})}},this.options=l.e({},cl,g)}onAdd(g){return this._map=g,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return l._(this,arguments,void 0,function*(i=!1){if(Jr!==void 0&&!i)return Jr;if(window.navigator.permissions===void 0)return Jr=!!window.navigator.geolocation,Jr;try{Jr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Jr=!!window.navigator.geolocation}return Jr})}().then(i=>this._setupUI(i)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),L.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ma=0,$n=!1}_isOutOfMapMaxBounds(g){const i=this._map.getMaxBounds(),o=g.coords;return i&&(o.longitude<i.getWest()||o.longitude>i.getEast()||o.latitude<i.getSouth()||o.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const g=this._map.getBounds(),i=g.getSouthEast(),o=g.getNorthEast(),u=i.distanceTo(o),d=Math.ceil(this._accuracy/(u/this._map._container.clientHeight)*2);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ma--,$n=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ma++,ma>1?(g={maximumAge:6e5,timeout:0},$n=!0):(g=this.options.positionOptions,$n=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,g)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},m.Hash=gc,m.ImageSource=qt,m.KeyboardHandler=gn,m.LngLatBounds=rt,m.LogoControl=Iu,m.Map=class extends Hs{constructor(g){if(l.bc.mark(l.bd.create),(g=l.e({},no,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new tl(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),{bearingSnap:g.bearingSnap}),this._contextLost=i=>{i.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new l.k("webglcontextlost",{originalEvent:i}))},this._contextRestored=i=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.k("webglcontextrestored",{originalEvent:i}))},this._onMapScroll=i=>{if(i.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=g.interactive,this._maxTileCacheSize=g.maxTileCacheSize,this._maxTileCacheZoomLevels=g.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._renderTaskQueue=new so,this._controls=[],this._mapId=l.a3(),this._locale=l.e({},Sc,g.locale),this._clickTolerance=g.clickTolerance,this._overridePixelRatio=g.pixelRatio,this._maxCanvasSize=g.maxCanvasSize,this.transformCameraUpdate=g.transformCameraUpdate,this._imageQueueHandle=ut.addThrottleControl(()=>this.isMoving()),this._requestManager=new Dt(g.transformRequest),typeof g.container=="string"){if(this._container=document.getElementById(g.container),!this._container)throw new Error(`Container '${g.container}' not found.`)}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(g.maxBounds&&this.setMaxBounds(g.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let i=!1;const o=mc(u=>{this._trackResize&&!this._removed&&this.resize(u)._update()},50);this._resizeObserver=new ResizeObserver(u=>{i?o(u):i=!0}),this._resizeObserver.observe(this._container)}this.handlers=new bc(this,g),this._hash=g.hash&&new gc(typeof g.hash=="string"&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,l.e({},g.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=g.localIdeographFontFamily,this._validateStyle=g.validateStyle,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new Pr(typeof g.attributionControl=="boolean"?void 0:g.attributionControl)),g.maplibreLogo&&this.addControl(new Iu,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update(i.dataType==="style"),this.fire(new l.k(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new l.k(`${i.dataType}dataloading`,i))}),this.on("dataabort",i=>{this.fire(new l.k("sourcedataabort",i))})}_getMapId(){return this._mapId}addControl(g,i){if(i===void 0&&(i=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new l.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=g.onAdd(this);this._controls.push(g);const u=this._controlPositions[i];return i.indexOf("bottom")!==-1?u.insertBefore(o,u.firstChild):u.appendChild(o),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new l.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(g);return i>-1&&this._controls.splice(i,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}calculateCameraOptionsFromTo(g,i,o,u){return u==null&&this.terrain&&(u=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(g,i,o,u)}resize(g){var i;const o=this._containerDimensions(),u=o[0],d=o[1],y=this._getClampedPixelRatio(u,d);if(this._resizeCanvas(u,d,y),this.painter.resize(u,d,y),this.painter.overLimit()){const M=this.painter.context.gl;this._maxCanvasSize=[M.drawingBufferWidth,M.drawingBufferHeight];const A=this._getClampedPixelRatio(u,d);this._resizeCanvas(u,d,A),this.painter.resize(u,d,A)}this.transform.resize(u,d),(i=this._requestedCameraState)===null||i===void 0||i.resize(u,d);const w=!this._moving;return w&&(this.stop(),this.fire(new l.k("movestart",g)).fire(new l.k("move",g))),this.fire(new l.k("resize",g)),w&&this.fire(new l.k("moveend",g)),this}_getClampedPixelRatio(g,i){const{0:o,1:u}=this._maxCanvasSize,d=this.getPixelRatio(),y=g*d,w=i*d;return Math.min(y>o?o/y:1,w>u?u/w:1)*d}getPixelRatio(){var g;return(g=this._overridePixelRatio)!==null&&g!==void 0?g:devicePixelRatio}setPixelRatio(g){this._overridePixelRatio=g,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(g){return this.transform.setMaxBounds(rt.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this._update()}project(g){return this.transform.locationPoint(l.M.convert(g),this.style&&this.terrain)}unproject(g){return this.transform.pointLocation(l.P.convert(g),this.terrain)}isMoving(){var g;return this._moving||((g=this.handlers)===null||g===void 0?void 0:g.isMoving())}isZooming(){var g;return this._zooming||((g=this.handlers)===null||g===void 0?void 0:g.isZooming())}isRotating(){var g;return this._rotating||((g=this.handlers)===null||g===void 0?void 0:g.isRotating())}_createDelegatedListener(g,i,o){if(g==="mouseenter"||g==="mouseover"){let u=!1;return{layer:i,listener:o,delegates:{mousemove:y=>{const w=this.getLayer(i)?this.queryRenderedFeatures(y.point,{layers:[i]}):[];w.length?u||(u=!0,o.call(this,new Gs(g,this,y.originalEvent,{features:w}))):u=!1},mouseout:()=>{u=!1}}}}if(g==="mouseleave"||g==="mouseout"){let u=!1;return{layer:i,listener:o,delegates:{mousemove:w=>{(this.getLayer(i)?this.queryRenderedFeatures(w.point,{layers:[i]}):[]).length?u=!0:u&&(u=!1,o.call(this,new Gs(g,this,w.originalEvent)))},mouseout:w=>{u&&(u=!1,o.call(this,new Gs(g,this,w.originalEvent)))}}}}{const u=d=>{const y=this.getLayer(i)?this.queryRenderedFeatures(d.point,{layers:[i]}):[];y.length&&(d.features=y,o.call(this,d),delete d.features)};return{layer:i,listener:o,delegates:{[g]:u}}}}on(g,i,o){if(o===void 0)return super.on(g,i);const u=this._createDelegatedListener(g,i,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(u);for(const d in u.delegates)this.on(d,u.delegates[d]);return this}once(g,i,o){if(o===void 0)return super.once(g,i);const u=this._createDelegatedListener(g,i,o);for(const d in u.delegates)this.once(d,u.delegates[d]);return this}off(g,i,o){return o===void 0?super.off(g,i):(this._delegatedListeners&&this._delegatedListeners[g]&&(u=>{const d=this._delegatedListeners[g];for(let y=0;y<d.length;y++){const w=d[y];if(w.layer===i&&w.listener===o){for(const M in w.delegates)this.off(M,w.delegates[M]);return d.splice(y,1),this}}})(),this)}queryRenderedFeatures(g,i){if(!this.style)return[];let o;const u=g instanceof l.P||Array.isArray(g),d=u?g:[[0,0],[this.transform.width,this.transform.height]];if(i=i||(u?{}:g)||{},d instanceof l.P||typeof d[0]=="number")o=[l.P.convert(d)];else{const y=l.P.convert(d[0]),w=l.P.convert(d[1]);o=[y,new l.P(w.x,y.y),w,new l.P(y.x,w.y),y]}return this.style.queryRenderedFeatures(o,i,this.transform)}querySourceFeatures(g,i){return this.style.querySourceFeatures(g,i)}setStyle(g,i){return(i=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},i)).diff!==!1&&i.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._updateStyle(g,i))}setTransformRequest(g){return this._requestManager.setTransformRequest(g),this}_getUIString(g){const i=this._locale[g];if(i==null)throw new Error(`Missing UI string '${g}'`);return i}_updateStyle(g,i){if(i.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(g,i));const o=this.style&&i.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!g)),g?(this.style=new ir(this,i||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g,i,o):this.style.loadJSON(g,i,o),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ir(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,i){if(typeof g=="string"){const o=this._requestManager.transformRequest(g,"Style");l.h(o,new AbortController).then(u=>{this._updateDiff(u.data,i)}).catch(u=>{u&&this.fire(new l.j(u))})}else typeof g=="object"&&this._updateDiff(g,i)}_updateDiff(g,i){try{this.style.setState(g,i)&&this._update(!0)}catch(o){l.w(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(g,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(g,i){return this._lazyInitEmptyStyle(),this.style.addSource(g,i),this._update(!0)}isSourceLoaded(g){const i=this.style&&this.style.sourceCaches[g];if(i!==void 0)return i.loaded();this.fire(new l.j(new Error(`There is no source with ID '${g}'`)))}setTerrain(g){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),g){const i=this.style.sourceCaches[g.source];if(!i)throw new Error(`cannot load terrain, because there exists no source with ID: ${g.source}`);this.terrain===null&&i.reload();for(const o in this.style._layers){const u=this.style._layers[o];u.type==="hillshade"&&u.source===g.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Pu(this.painter,i,g),this.painter.renderToTexture=new Mc(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=o=>{o.dataType==="style"?this.terrain.sourceCache.freeRtt():o.dataType==="source"&&o.tile&&(o.sourceId!==g.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(o.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new l.k("terrain",{terrain:g})),this}getTerrain(){var g,i;return(i=(g=this.terrain)===null||g===void 0?void 0:g.options)!==null&&i!==void 0?i:null}areTilesLoaded(){const g=this.style&&this.style.sourceCaches;for(const i in g){const o=g[i]._tiles;for(const u in o){const d=o[u];if(d.state!=="loaded"&&d.state!=="errored")return!1}}return!0}removeSource(g){return this.style.removeSource(g),this._update(!0)}getSource(g){return this.style.getSource(g)}addImage(g,i,o={}){const{pixelRatio:u=1,sdf:d=!1,stretchX:y,stretchY:w,content:M}=o;if(this._lazyInitEmptyStyle(),!(i instanceof HTMLImageElement||l.b(i))){if(i.width===void 0||i.height===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:C,data:z}=i,O=i;return this.style.addImage(g,{data:new l.R({width:A,height:C},new Uint8Array(z)),pixelRatio:u,stretchX:y,stretchY:w,content:M,sdf:d,version:0,userImage:O}),O.onAdd&&O.onAdd(this,g),this}}{const{width:A,height:C,data:z}=P.getImageData(i);this.style.addImage(g,{data:new l.R({width:A,height:C},z),pixelRatio:u,stretchX:y,stretchY:w,content:M,sdf:d,version:0})}}updateImage(g,i){const o=this.style.getImage(g);if(!o)return this.fire(new l.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=i instanceof HTMLImageElement||l.b(i)?P.getImageData(i):i,{width:d,height:y,data:w}=u;if(d===void 0||y===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(d!==o.data.width||y!==o.data.height)return this.fire(new l.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const M=!(i instanceof HTMLImageElement||l.b(i));return o.data.replace(w,M),this.style.updateImage(g,o),this}getImage(g){return this.style.getImage(g)}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new l.j(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g){return ut.getImage(this._requestManager.transformRequest(g,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(g,i){return this._lazyInitEmptyStyle(),this.style.addLayer(g,i),this._update(!0)}moveLayer(g,i){return this.style.moveLayer(g,i),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(g,i,o){return this.style.setLayerZoomRange(g,i,o),this._update(!0)}setFilter(g,i,o={}){return this.style.setFilter(g,i,o),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,i,o,u={}){return this.style.setPaintProperty(g,i,o,u),this._update(!0)}getPaintProperty(g,i){return this.style.getPaintProperty(g,i)}setLayoutProperty(g,i,o,u={}){return this.style.setLayoutProperty(g,i,o,u),this._update(!0)}getLayoutProperty(g,i){return this.style.getLayoutProperty(g,i)}setGlyphs(g,i={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(g,i),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(g,i,o={}){return this._lazyInitEmptyStyle(),this.style.addSprite(g,i,o,u=>{u||this._update(!0)}),this}removeSprite(g){return this._lazyInitEmptyStyle(),this.style.removeSprite(g),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(g,i={}){return this._lazyInitEmptyStyle(),this.style.setSprite(g,i,o=>{o||this._update(!0)}),this}setLight(g,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,i),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(g,i){return this.style.setFeatureState(g,i),this._update()}removeFeatureState(g,i){return this.style.removeFeatureState(g,i),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let g=0,i=0;return this._container&&(g=this._container.clientWidth||400,i=this._container.clientHeight||300),[g,i]}_setupContainer(){const g=this._container;g.classList.add("maplibregl-map");const i=this._canvasContainer=L.create("div","maplibregl-canvas-container",g);this._interactive&&i.classList.add("maplibregl-interactive"),this._canvas=L.create("canvas","maplibregl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const o=this._containerDimensions(),u=this._getClampedPixelRatio(o[0],o[1]);this._resizeCanvas(o[0],o[1],u);const d=this._controlContainer=L.create("div","maplibregl-control-container",g),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{y[w]=L.create("div",`maplibregl-ctrl-${w} `,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,i,o){this._canvas.width=Math.floor(o*g),this._canvas.height=Math.floor(o*i),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${i}px`}_setupPainter(){const g={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let i=null;this._canvas.addEventListener("webglcontextcreationerror",u=>{i={requestedAttributes:g},u&&(i.statusMessage=u.statusMessage,i.type=u.type)},{once:!0});const o=this._canvas.getContext("webgl2",g)||this._canvas.getContext("webgl",g);if(!o){const u="Failed to initialize WebGL";throw i?(i.message=u,new Error(JSON.stringify(i))):new Error(u)}this.painter=new gu(o,this.transform),K.testSupport(o)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_render(g){const i=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),this._removed)return;let o=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const d=this.transform.zoom,y=P.now();this.style.zoomHistory.update(d,y);const w=new l.a8(d,{now:y,fadeDuration:i,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),M=w.crossFadingFactor();M===1&&M===this._crossFadingFactor||(o=!0,this._crossFadingFactor=M),this.style.update(w)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,i,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:i,showPadding:this.showPadding}),this.fire(new l.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.bc.mark(l.bd.load),this.fire(new l.k("load"))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const u=this._sourcesDirty||this._styleDirty||this._placementDirty;return u||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.k("idle")),!this._loaded||this._fullyLoaded||u||(this._fullyLoaded=!0,l.bc.mark(l.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var g;this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ut.removeThrottleControl(this._imageQueueHandle),(g=this._resizeObserver)===null||g===void 0||g.disconnect();const i=this.painter.context.gl.getExtension("WEBGL_lose_context");i&&i.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),L.remove(this._canvasContainer),L.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),l.bc.clearMetrics(),this._removed=!0,this.fire(new l.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,P.frameAsync(this._frameRequest).then(g=>{l.bc.frame(g),this._frameRequest=null,this._render(g)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get version(){return Tc}getCameraTargetElevation(){return this.transform.elevation}},m.MapMouseEvent=Gs,m.MapTouchEvent=Br,m.MapWheelEvent=_c,m.Marker=oo,m.NavigationControl=class{constructor(g){this._updateZoomButtons=()=>{const i=this._map.getZoom(),o=i===this._map.getMaxZoom(),u=i===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},this._rotateCompassArrow=()=>{const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=i},this._setButtonTitle=(i,o)=>{const u=this._map._getUIString(`NavigationControl.${o}`);i.title=u,i.setAttribute("aria-label",u)},this.options=l.e({},Ac,g),this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",i=>this._map.zoomIn({},{originalEvent:i})),L.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",i=>this._map.zoomOut({},{originalEvent:i})),L.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",i=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:i}):this._map.resetNorth({},{originalEvent:i})}),this._compassIcon=L.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ec(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){L.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(g,i){const o=L.create("button",g,this._container);return o.type="button",o.addEventListener("click",i),o}},m.Popup=class extends l.E{constructor(g){super(),this.remove=()=>(this._content&&L.remove(this._content),this._container&&(L.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.k("close"))),this),this._onMouseUp=i=>{this._update(i.point)},this._onMouseMove=i=>{this._update(i.point)},this._onDrag=i=>{this._update(i.point)},this._update=i=>{var o;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=L.create("div","maplibregl-popup",this._map.getContainer()),this._tip=L.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const M of this.options.className.split(" "))this._container.classList.add(M);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?ol(this._lngLat,this._flatPos,this._map.transform):(o=this._lngLat)===null||o===void 0?void 0:o.wrap(),this._trackPointer&&!i)return;const u=this._flatPos=this._pos=this._trackPointer&&i?i:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&i?i:this._map.transform.locationPoint(this._lngLat));let d=this.options.anchor;const y=dl(this.options.offset);if(!d){const M=this._container.offsetWidth,A=this._container.offsetHeight;let C;C=u.y+y.bottom.y<A?["top"]:u.y>this._map.transform.height-A?["bottom"]:[],u.x<M/2?C.push("left"):u.x>this._map.transform.width-M/2&&C.push("right"),d=C.length===0?"bottom":C.join("-")}let w=u.add(y[d]);this.options.subpixelPositioning||(w=w.round()),L.setTransform(this._container,`${ao[d]} translate(${w.x}px,${w.y}px)`),ll(this._container,d,"popup")},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(Ic),g)}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(g){return this._lngLat=l.M.convert(g),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const i=document.createDocumentFragment(),o=document.createElement("body");let u;for(o.innerHTML=g;u=o.firstChild,u;)i.appendChild(u);return this.setDOMContent(i)}getMaxWidth(){var g;return(g=this._container)===null||g===void 0?void 0:g.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=L.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(g),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(g){this._container&&this._container.classList.add(g)}removeClassName(g){this._container&&this._container.classList.remove(g)}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){if(this._container)return this._container.classList.toggle(g)}setSubpixelPositioning(g){this.options.subpixelPositioning=g}_createCloseButton(){this.options.closeButton&&(this._closeButton=L.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(Pc);g&&g.focus()}},m.RasterDEMTileSource=Xt,m.RasterTileSource=it,m.ScaleControl=class{constructor(g){this._onMove=()=>{ul(this._map,this._container,this.options)},this.setUnit=i=>{this.options.unit=i,ul(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},hl),g)}getDefaultPosition(){return"bottom-left"}onAdd(g){return this._map=g,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-scale",g.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){L.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},m.ScrollZoomHandler=rl,m.Style=ir,m.TerrainControl=class{constructor(g){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=g}onAdd(g){return this._map=g,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=L.create("button","maplibregl-ctrl-terrain",this._container),L.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){L.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},m.TwoFingersTouchPitchHandler=Su,m.TwoFingersTouchRotateHandler=vc,m.TwoFingersTouchZoomHandler=Mu,m.TwoFingersTouchZoomRotateHandler=eo,m.VectorTileSource=Ft,m.VideoSource=Vt,m.addSourceType=(g,i)=>l._(void 0,void 0,void 0,function*(){if(we(g))throw new Error(`A source type called "${g}" already exists.`);((o,u)=>{Ee[o]=u})(g,i)}),m.clearPrewarmedResources=function(){const g=As;g&&(g.isPreloaded()&&g.numActive()===1?(g.release(hi),As=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},m.getMaxParallelImageRequests=function(){return l.a.MAX_PARALLEL_IMAGE_REQUESTS},m.getRTLTextPluginStatus=function(){return Rt().getRTLTextPluginStatus()},m.getVersion=function(){return Cu},m.getWorkerCount=function(){return bs.workerCount},m.getWorkerUrl=function(){return l.a.WORKER_URL},m.importScriptInWorkers=function(g){return re().broadcast("IS",g)},m.prewarm=function(){kt().acquire(hi)},m.setMaxParallelImageRequests=function(g){l.a.MAX_PARALLEL_IMAGE_REQUESTS=g},m.setRTLTextPlugin=function(g,i){return Rt().setRTLTextPlugin(g,i)},m.setWorkerCount=function(g){bs.workerCount=g},m.setWorkerUrl=function(g){l.a.WORKER_URL=g}});var _=a;return _})})(Fx);var TR=Fx.exports;const n0=Kv(TR),AR=t=>(Wd("data-v-63a30c34"),t=t(),Zd(),t),ER={id:"map-panel"},IR=AR(()=>ct("div",{id:"map",class:"map-class"},null,-1)),PR=[IR],CR={__name:"MapPanel",setup(t){const r=ff(),a=Kr(),h=Ds();$h(),Uh();const p=Fh(),_=rf();let m;return wi(()=>r.currentMarkersForTopic),wi(()=>r.addressMarker),wi(()=>a.currentAddress),Ra(()=>h.addressData,l=>{console.log("MapStore address watch, newAddress:",l,"MapStore.addressMarker:",r.addressMarker);const T=r.addressMarker;T&&T.remove();const I=h.addressData.features[0].geometry.coordinates,R=new n0.Marker().setLngLat(I).addTo(m);r.addressMarker=R,a.lastSearchMethod==="address"&&(m.setCenter(I),m.setZoom(17))}),Ra(()=>p.params.topic,async l=>{console.log("MapStore watch topic, newTopic:",l),l&&(r.currentTopicMapStyle=hh.topicStyles[l],m.setStyle(hh[r.currentTopicMapStyle]))}),Lh(async()=>{let l;p.params.topic?l=hh.topicStyles[p.params.topic]:l="pwdDrawnMapStyle",r.currentTopicMapStyle=l;let T;p.params.address?T=17:T=12,m=new n0.Map({container:"map",style:hh[l],center:[-75.163471,39.953338],zoom:T,minZoom:6,maxZoom:22}),m.on("click",async I=>{console.log("map click event:",I.lngLat,"route.params.topic:",p.params.topic),a.setLastSearchMethod("mapClick"),_.push({name:"search",query:{lng:I.lngLat.lng,lat:I.lngLat.lat}})}),r.setMap(m)}),(l,T)=>(Pe(),Ue("div",ER,PR))}},DR=Vh(CR,[["__scopeId","data-v-63a30c34"]]),kR=ct("div",{class:"container"},[ct("h1",{class:"title is-1"},"Vue3 Atlas")],-1),RR={class:"container"},zR={class:"columns"},LR={class:"column is-10"},OR={class:"small-container"},FR={class:"columns"},BR={class:"column is-6"},NR={class:"column is-6"},_o={__name:"App",setup(t){Kr();const r=Fh(),a=rf(),h=rn("");return Lh(async()=>{r.name==="not-found"&&a.push({name:"home"}),r.params.address&&(h.value=r.params.address)}),(p,_)=>(Pe(),Ue("main",null,[kR,ct("div",RR,[ct("div",zR,[ct("div",LR,[j0(ct("input",{class:"input",type:"text",placeholder:"Search an address","onUpdate:modelValue":_[0]||(_[0]=m=>h.value=m),onKeydown:_[1]||(_[1]=X2(m=>Ti(a).replace({name:"search",query:{address:h.value}}),["enter"]))},null,544),[[W2,h.value]])]),ct("button",{class:"button",onClick:_[2]||(_[2]=m=>Ti(a).replace({name:"search",query:{address:h.value}}))}," Search "),ct("button",{class:"button",onClick:_[3]||(_[3]=(...m)=>p.toggleImagery&&p.toggleImagery(...m))},"Toggle Imagery")])]),ct("div",OR,[ct("div",FR,[ct("div",BR,[Gi(SR)]),ct("div",NR,[Gi(DR)])])])]))}},$R="modulepreload",VR=function(t){return"/vue3-atlas2/"+t},a0={},UR=function(r,a,h){let p=Promise.resolve();if(a&&a.length>0){const _=document.getElementsByTagName("link"),m=document.querySelector("meta[property=csp-nonce]"),l=(m==null?void 0:m.nonce)||(m==null?void 0:m.getAttribute("nonce"));p=Promise.all(a.map(T=>{if(T=VR(T),T in a0)return;a0[T]=!0;const I=T.endsWith(".css"),R=I?'[rel="stylesheet"]':"";if(!!h)for(let K=_.length-1;K>=0;K--){const tt=_[K];if(tt.href===T&&(!I||tt.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${T}"]${R}`))return;const L=document.createElement("link");if(L.rel=I?"stylesheet":$R,I||(L.as="script",L.crossOrigin=""),L.href=T,l&&L.setAttribute("nonce",l),document.head.appendChild(L),I)return new Promise((K,tt)=>{L.addEventListener("load",K),L.addEventListener("error",()=>tt(new Error(`Unable to preload CSS for ${T}`)))})}))}return p.then(()=>r()).catch(_=>{const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=_,window.dispatchEvent(m),!m.defaultPrevented)throw _})},{routeApp:qR}=Xv(),Nx=async t=>{console.log("getAddressAndPutInStore is running, address:",t);const r=Kr();r.clearDataSourcesLoadedArray();const a=Ds();if(await a.fillAddressData(t),!a.addressData.features){Yl.push({name:"not-found"});return}const h=a.addressData.features[0].properties.street_address;r.setCurrentAddress(h)},jR=async(t,r)=>{let a;const h=Kr();let p=h.currentTopic;const _=hh.parcelLayerForTopic[p],m=Uh();if(await m.fillParcelDataByLngLat(t,r,_),!m[_].features[0]){Yl.push({name:"not-found"});return}const l=_==="PWD"?"ADDRESS":"ADDR_SOURCE";a=m[_].features[0].properties[l],console.log("getParcelAndPutInStore, currentAddress:",a,"parcelLayer:",_,"addressField",l,"ParcelsStore[parcelLayer].features[0].properties:",m[_].features[0].properties,"ParcelsStore[parcelLayer].features[0].properties[addressField]:",m[_].features[0].properties[l]),h.setCurrentAddress(a)},GR=async(t,r)=>{const a=Kr(),h=Ds(),p=a.dataSourcesLoadedArray;if(t.name==="not-found")return;let _,m;if(t.params.address?_=t.params.address:t.query.address&&(_=t.query.address),t.params.topic&&(m=t.params.topic),_!==h.addressData.normalized)await Nx(_);else if(p.includes(m))return;const l=Uh();await l.fillPwdParcelData(),await l.fillDorParcelData();const T=$h();if(await T.fillCondoData(_),t.params.topic=="Condominiums"&&!T.condosData.length){a.currentTopic="Property",Yl.push({name:"address-and-topic",params:{address:t.params.address,topic:"Property"}});return}await HR(t.params.topic),a.addToDataSourcesLoadedArray(t.params.topic)},HR=async t=>{if(console.log("topicDataFetch is running, topic:",t),t==="Property"&&await ax().fillOpaData(),t==="Licenses & Inspections"){const r=lx();await r.fillLiInspections(),await r.fillLiPermits()}if(t==="Deeds"&&await ox().initializeDorDocuments(),t==="Nearby Activity"){const a=Kr().currentNearbyDataType;await Ox().fetchData(a);const _=Ds().addressData.features[0].geometry.coordinates;await ff().fillBufferForAddress(_[0],_[1])}},Yl=hS({history:$M("/vue3-atlas2"),routes:[{path:"/:pathMatch(.*)*",name:"NotFound",component:()=>UR(()=>import("./NotFound-BWGAwLcy.js"),[])},{path:"/",name:"home",component:_o,props:!0},{path:"/:address",name:"address",component:_o},{path:"/:address/:topic",name:"address-and-topic",component:_o},{path:"/:address/:topic/:data",name:"address-topic-and-data",component:_o},{path:"/not-found",name:"not-found",component:_o},{path:"/search",name:"search",component:_o,beforeEnter:async(t,r)=>{console.log("search route beforeEnter, to.query:",t.query,"from:",r);const{address:a,lat:h,lng:p}=t.query,_=Kr();a?(_.setLastSearchMethod("address"),await Nx(a)):h&&p&&(_.setLastSearchMethod("mapClick"),await jR(p,h)),qR(Yl)}}]});Yl.afterEach(async(t,r)=>{console.log("router afterEach to:",t,"from:",r),t.name!=="not-found"&&t.name!=="search"&&await GR(t)});const Xm=J2(_o);Xm.use(iM());Xm.use(Yl);Xm.mount("#app");export{Vh as _,ct as a,lv as b,Ue as c,Gi as d,Pe as o,WR as r,Xn as w};
