(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))u(d);new MutationObserver(d=>{for(const g of d)if(g.type==="childList")for(const m of g.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&u(m)}).observe(document,{childList:!0,subtree:!0});function a(d){const g={};return d.integrity&&(g.integrity=d.integrity),d.referrerPolicy&&(g.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?g.credentials="include":d.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function u(d){if(d.ep)return;d.ep=!0;const g=a(d);fetch(d.href,g)}})();/**
* @vue/shared v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Am(e,r){const a=new Set(e.split(","));return r?u=>a.has(u.toLowerCase()):u=>a.has(u)}const Fr={},ru=[],ma=()=>{},tw=()=>!1,mp=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&(e.charCodeAt(2)>122||e.charCodeAt(2)<97),Pm=e=>e.startsWith("onUpdate:"),Gn=Object.assign,km=(e,r)=>{const a=e.indexOf(r);a>-1&&e.splice(a,1)},iw=Object.prototype.hasOwnProperty,Yi=(e,r)=>iw.call(e,r),_i=Array.isArray,nu=e=>Vh(e)==="[object Map]",P0=e=>Vh(e)==="[object Set]",rw=e=>Vh(e)==="[object RegExp]",Ii=e=>typeof e=="function",yn=e=>typeof e=="string",vu=e=>typeof e=="symbol",Ur=e=>e!==null&&typeof e=="object",k0=e=>(Ur(e)||Ii(e))&&Ii(e.then)&&Ii(e.catch),D0=Object.prototype.toString,Vh=e=>D0.call(e),nw=e=>Vh(e).slice(8,-1),L0=e=>Vh(e)==="[object Object]",Dm=e=>yn(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,yh=Am(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),gp=e=>{const r=Object.create(null);return a=>r[a]||(r[a]=e(a))},sw=/-(\w)/g,so=gp(e=>e.replace(sw,(r,a)=>a?a.toUpperCase():"")),aw=/\B([A-Z])/g,dc=gp(e=>e.replace(aw,"-$1").toLowerCase()),yp=gp(e=>e.charAt(0).toUpperCase()+e.slice(1)),If=gp(e=>e?`on${yp(e)}`:""),Ml=(e,r)=>!Object.is(e,r),su=(e,r)=>{for(let a=0;a<e.length;a++)e[a](r)},Qd=(e,r,a)=>{Object.defineProperty(e,r,{configurable:!0,enumerable:!1,value:a})},Qf=e=>{const r=parseFloat(e);return isNaN(r)?e:r};let qy;const R0=()=>qy||(qy=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Lm(e){if(_i(e)){const r={};for(let a=0;a<e.length;a++){const u=e[a],d=yn(u)?uw(u):Lm(u);if(d)for(const g in d)r[g]=d[g]}return r}else if(yn(e)||Ur(e))return e}const ow=/;(?![^(]*\))/g,lw=/:([^]+)/,cw=/\/\*[^]*?\*\//g;function uw(e){const r={};return e.replace(cw,"").split(ow).forEach(a=>{if(a){const u=a.split(lw);u.length>1&&(r[u[0].trim()]=u[1].trim())}}),r}function ns(e){let r="";if(yn(e))r=e;else if(_i(e))for(let a=0;a<e.length;a++){const u=ns(e[a]);u&&(r+=u+" ")}else if(Ur(e))for(const a in e)e[a]&&(r+=a+" ");return r.trim()}const hw="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",dw=Am(hw);function z0(e){return!!e||e===""}const Ht=e=>yn(e)?e:e==null?"":_i(e)||Ur(e)&&(e.toString===D0||!Ii(e.toString))?JSON.stringify(e,O0,2):String(e),O0=(e,r)=>r&&r.__v_isRef?O0(e,r.value):nu(r)?{[`Map(${r.size})`]:[...r.entries()].reduce((a,[u,d],g)=>(a[Af(u,g)+" =>"]=d,a),{})}:P0(r)?{[`Set(${r.size})`]:[...r.values()].map(a=>Af(a))}:vu(r)?Af(r):Ur(r)&&!_i(r)&&!L0(r)?String(r):r,Af=(e,r="")=>{var a;return vu(e)?`Symbol(${(a=e.description)!=null?a:r})`:e};/**
* @vue/reactivity v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Qs;class F0{constructor(r=!1){this.detached=r,this._active=!0,this.effects=[],this.cleanups=[],this.parent=Qs,!r&&Qs&&(this.index=(Qs.scopes||(Qs.scopes=[])).push(this)-1)}get active(){return this._active}run(r){if(this._active){const a=Qs;try{return Qs=this,r()}finally{Qs=a}}}on(){Qs=this}off(){Qs=this.parent}stop(r){if(this._active){let a,u;for(a=0,u=this.effects.length;a<u;a++)this.effects[a].stop();for(a=0,u=this.cleanups.length;a<u;a++)this.cleanups[a]();if(this.scopes)for(a=0,u=this.scopes.length;a<u;a++)this.scopes[a].stop(!0);if(!this.detached&&this.parent&&!r){const d=this.parent.scopes.pop();d&&d!==this&&(this.parent.scopes[this.index]=d,d.index=this.index)}this.parent=void 0,this._active=!1}}}function B0(e){return new F0(e)}function pw(e,r=Qs){r&&r.active&&r.effects.push(e)}function N0(){return Qs}function fw(e){Qs&&Qs.cleanups.push(e)}let oc;class Rm{constructor(r,a,u,d){this.fn=r,this.trigger=a,this.scheduler=u,this.active=!0,this.deps=[],this._dirtyLevel=4,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,pw(this,d)}get dirty(){if(this._dirtyLevel===2||this._dirtyLevel===3){this._dirtyLevel=1,pc();for(let r=0;r<this._depsLength;r++){const a=this.deps[r];if(a.computed&&(mw(a.computed),this._dirtyLevel>=4))break}this._dirtyLevel===1&&(this._dirtyLevel=0),fc()}return this._dirtyLevel>=4}set dirty(r){this._dirtyLevel=r?4:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let r=vl,a=oc;try{return vl=!0,oc=this,this._runnings++,Gy(this),this.fn()}finally{Hy(this),this._runnings--,oc=a,vl=r}}stop(){var r;this.active&&(Gy(this),Hy(this),(r=this.onStop)==null||r.call(this),this.active=!1)}}function mw(e){return e.value}function Gy(e){e._trackId++,e._depsLength=0}function Hy(e){if(e.deps.length>e._depsLength){for(let r=e._depsLength;r<e.deps.length;r++)$0(e.deps[r],e);e.deps.length=e._depsLength}}function $0(e,r){const a=e.get(r);a!==void 0&&r._trackId!==a&&(e.delete(r),e.size===0&&e.cleanup())}let vl=!0,em=0;const U0=[];function pc(){U0.push(vl),vl=!1}function fc(){const e=U0.pop();vl=e===void 0?!0:e}function zm(){em++}function Om(){for(em--;!em&&tm.length;)tm.shift()()}function V0(e,r,a){if(r.get(e)!==e._trackId){r.set(e,e._trackId);const u=e.deps[e._depsLength];u!==r?(u&&$0(u,e),e.deps[e._depsLength++]=r):e._depsLength++}}const tm=[];function j0(e,r,a){zm();for(const u of e.keys()){let d;u._dirtyLevel<r&&(d??(d=e.get(u)===u._trackId))&&(u._shouldSchedule||(u._shouldSchedule=u._dirtyLevel===0),u._dirtyLevel=r),u._shouldSchedule&&(d??(d=e.get(u)===u._trackId))&&(u.trigger(),(!u._runnings||u.allowRecurse)&&u._dirtyLevel!==2&&(u._shouldSchedule=!1,u.scheduler&&tm.push(u.scheduler)))}Om()}const q0=(e,r)=>{const a=new Map;return a.cleanup=e,a.computed=r,a},ep=new WeakMap,lc=Symbol(""),im=Symbol("");function zs(e,r,a){if(vl&&oc){let u=ep.get(e);u||ep.set(e,u=new Map);let d=u.get(a);d||u.set(a,d=q0(()=>u.delete(a))),V0(oc,d)}}function Po(e,r,a,u,d,g){const m=ep.get(e);if(!m)return;let l=[];if(r==="clear")l=[...m.values()];else if(a==="length"&&_i(e)){const M=Number(u);m.forEach((A,R)=>{(R==="length"||!vu(R)&&R>=M)&&l.push(A)})}else switch(a!==void 0&&l.push(m.get(a)),r){case"add":_i(e)?Dm(a)&&l.push(m.get("length")):(l.push(m.get(lc)),nu(e)&&l.push(m.get(im)));break;case"delete":_i(e)||(l.push(m.get(lc)),nu(e)&&l.push(m.get(im)));break;case"set":nu(e)&&l.push(m.get(lc));break}zm();for(const M of l)M&&j0(M,4);Om()}function gw(e,r){var a;return(a=ep.get(e))==null?void 0:a.get(r)}const yw=Am("__proto__,__v_isRef,__isVue"),G0=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(vu)),Wy=_w();function _w(){const e={};return["includes","indexOf","lastIndexOf"].forEach(r=>{e[r]=function(...a){const u=Ji(this);for(let g=0,m=this.length;g<m;g++)zs(u,"get",g+"");const d=u[r](...a);return d===-1||d===!1?u[r](...a.map(Ji)):d}}),["push","pop","shift","unshift","splice"].forEach(r=>{e[r]=function(...a){pc(),zm();const u=Ji(this)[r].apply(this,a);return Om(),fc(),u}}),e}function vw(e){const r=Ji(this);return zs(r,"has",e),r.hasOwnProperty(e)}class H0{constructor(r=!1,a=!1){this._isReadonly=r,this._isShallow=a}get(r,a,u){const d=this._isReadonly,g=this._isShallow;if(a==="__v_isReactive")return!d;if(a==="__v_isReadonly")return d;if(a==="__v_isShallow")return g;if(a==="__v_raw")return u===(d?g?Dw:K0:g?X0:Z0).get(r)||Object.getPrototypeOf(r)===Object.getPrototypeOf(u)?r:void 0;const m=_i(r);if(!d){if(m&&Yi(Wy,a))return Reflect.get(Wy,a,u);if(a==="hasOwnProperty")return vw}const l=Reflect.get(r,a,u);return(vu(a)?G0.has(a):yw(a))||(d||zs(r,"get",a),g)?l:An(l)?m&&Dm(a)?l:l.value:Ur(l)?d?J0(l):jh(l):l}}class W0 extends H0{constructor(r=!1){super(!1,r)}set(r,a,u,d){let g=r[a];if(!this._isShallow){const M=hu(g);if(!tp(u)&&!hu(u)&&(g=Ji(g),u=Ji(u)),!_i(r)&&An(g)&&!An(u))return M?!1:(g.value=u,!0)}const m=_i(r)&&Dm(a)?Number(a)<r.length:Yi(r,a),l=Reflect.set(r,a,u,d);return r===Ji(d)&&(m?Ml(u,g)&&Po(r,"set",a,u):Po(r,"add",a,u)),l}deleteProperty(r,a){const u=Yi(r,a);r[a];const d=Reflect.deleteProperty(r,a);return d&&u&&Po(r,"delete",a,void 0),d}has(r,a){const u=Reflect.has(r,a);return(!vu(a)||!G0.has(a))&&zs(r,"has",a),u}ownKeys(r){return zs(r,"iterate",_i(r)?"length":lc),Reflect.ownKeys(r)}}class xw extends H0{constructor(r=!1){super(!0,r)}set(r,a){return!0}deleteProperty(r,a){return!0}}const bw=new W0,ww=new xw,Mw=new W0(!0),Fm=e=>e,_p=e=>Reflect.getPrototypeOf(e);function Dd(e,r,a=!1,u=!1){e=e.__v_raw;const d=Ji(e),g=Ji(r);a||(Ml(r,g)&&zs(d,"get",r),zs(d,"get",g));const{has:m}=_p(d),l=u?Fm:a?$m:Ih;if(m.call(d,r))return l(e.get(r));if(m.call(d,g))return l(e.get(g));e!==d&&e.get(r)}function Ld(e,r=!1){const a=this.__v_raw,u=Ji(a),d=Ji(e);return r||(Ml(e,d)&&zs(u,"has",e),zs(u,"has",d)),e===d?a.has(e):a.has(e)||a.has(d)}function Rd(e,r=!1){return e=e.__v_raw,!r&&zs(Ji(e),"iterate",lc),Reflect.get(e,"size",e)}function Zy(e){e=Ji(e);const r=Ji(this);return _p(r).has.call(r,e)||(r.add(e),Po(r,"add",e,e)),this}function Xy(e,r){r=Ji(r);const a=Ji(this),{has:u,get:d}=_p(a);let g=u.call(a,e);g||(e=Ji(e),g=u.call(a,e));const m=d.call(a,e);return a.set(e,r),g?Ml(r,m)&&Po(a,"set",e,r):Po(a,"add",e,r),this}function Ky(e){const r=Ji(this),{has:a,get:u}=_p(r);let d=a.call(r,e);d||(e=Ji(e),d=a.call(r,e)),u&&u.call(r,e);const g=r.delete(e);return d&&Po(r,"delete",e,void 0),g}function Yy(){const e=Ji(this),r=e.size!==0,a=e.clear();return r&&Po(e,"clear",void 0,void 0),a}function zd(e,r){return function(u,d){const g=this,m=g.__v_raw,l=Ji(m),M=r?Fm:e?$m:Ih;return!e&&zs(l,"iterate",lc),m.forEach((A,R)=>u.call(d,M(A),M(R),g))}}function Od(e,r,a){return function(...u){const d=this.__v_raw,g=Ji(d),m=nu(g),l=e==="entries"||e===Symbol.iterator&&m,M=e==="keys"&&m,A=d[e](...u),R=a?Fm:r?$m:Ih;return!r&&zs(g,"iterate",M?im:lc),{next(){const{value:k,done:z}=A.next();return z?{value:k,done:z}:{value:l?[R(k[0]),R(k[1])]:R(k),done:z}},[Symbol.iterator](){return this}}}}function ul(e){return function(...r){return e==="delete"?!1:e==="clear"?void 0:this}}function Sw(){const e={get(g){return Dd(this,g)},get size(){return Rd(this)},has:Ld,add:Zy,set:Xy,delete:Ky,clear:Yy,forEach:zd(!1,!1)},r={get(g){return Dd(this,g,!1,!0)},get size(){return Rd(this)},has:Ld,add:Zy,set:Xy,delete:Ky,clear:Yy,forEach:zd(!1,!0)},a={get(g){return Dd(this,g,!0)},get size(){return Rd(this,!0)},has(g){return Ld.call(this,g,!0)},add:ul("add"),set:ul("set"),delete:ul("delete"),clear:ul("clear"),forEach:zd(!0,!1)},u={get(g){return Dd(this,g,!0,!0)},get size(){return Rd(this,!0)},has(g){return Ld.call(this,g,!0)},add:ul("add"),set:ul("set"),delete:ul("delete"),clear:ul("clear"),forEach:zd(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(g=>{e[g]=Od(g,!1,!1),a[g]=Od(g,!0,!1),r[g]=Od(g,!1,!0),u[g]=Od(g,!0,!0)}),[e,a,r,u]}const[Ew,Tw,Cw,Iw]=Sw();function Bm(e,r){const a=r?e?Iw:Cw:e?Tw:Ew;return(u,d,g)=>d==="__v_isReactive"?!e:d==="__v_isReadonly"?e:d==="__v_raw"?u:Reflect.get(Yi(a,d)&&d in u?a:u,d,g)}const Aw={get:Bm(!1,!1)},Pw={get:Bm(!1,!0)},kw={get:Bm(!0,!1)},Z0=new WeakMap,X0=new WeakMap,K0=new WeakMap,Dw=new WeakMap;function Lw(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Rw(e){return e.__v_skip||!Object.isExtensible(e)?0:Lw(nw(e))}function jh(e){return hu(e)?e:Nm(e,!1,bw,Aw,Z0)}function Y0(e){return Nm(e,!1,Mw,Pw,X0)}function J0(e){return Nm(e,!0,ww,kw,K0)}function Nm(e,r,a,u,d){if(!Ur(e)||e.__v_raw&&!(r&&e.__v_isReactive))return e;const g=d.get(e);if(g)return g;const m=Rw(e);if(m===0)return e;const l=new Proxy(e,m===2?u:a);return d.set(e,l),l}function xl(e){return hu(e)?xl(e.__v_raw):!!(e&&e.__v_isReactive)}function hu(e){return!!(e&&e.__v_isReadonly)}function tp(e){return!!(e&&e.__v_isShallow)}function Q0(e){return xl(e)||hu(e)}function Ji(e){const r=e&&e.__v_raw;return r?Ji(r):e}function vp(e){return Object.isExtensible(e)&&Qd(e,"__v_skip",!0),e}const Ih=e=>Ur(e)?jh(e):e,$m=e=>Ur(e)?J0(e):e;class ev{constructor(r,a,u,d){this.getter=r,this._setter=a,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this.effect=new Rm(()=>r(this._value),()=>Vd(this,this.effect._dirtyLevel===2?2:3)),this.effect.computed=this,this.effect.active=this._cacheable=!d,this.__v_isReadonly=u}get value(){const r=Ji(this);return(!r._cacheable||r.effect.dirty)&&Ml(r._value,r._value=r.effect.run())&&Vd(r,4),tv(r),r.effect._dirtyLevel>=2&&Vd(r,2),r._value}set value(r){this._setter(r)}get _dirty(){return this.effect.dirty}set _dirty(r){this.effect.dirty=r}}function zw(e,r,a=!1){let u,d;const g=Ii(e);return g?(u=e,d=ma):(u=e.get,d=e.set),new ev(u,d,g||!d,a)}function tv(e){var r;vl&&oc&&(e=Ji(e),V0(oc,(r=e.dep)!=null?r:e.dep=q0(()=>e.dep=void 0,e instanceof ev?e:void 0)))}function Vd(e,r=4,a){e=Ji(e);const u=e.dep;u&&j0(u,r)}function An(e){return!!(e&&e.__v_isRef===!0)}function vs(e){return iv(e,!1)}function Ow(e){return iv(e,!0)}function iv(e,r){return An(e)?e:new Fw(e,r)}class Fw{constructor(r,a){this.__v_isShallow=a,this.dep=void 0,this.__v_isRef=!0,this._rawValue=a?r:Ji(r),this._value=a?r:Ih(r)}get value(){return tv(this),this._value}set value(r){const a=this.__v_isShallow||tp(r)||hu(r);r=a?r:Ji(r),Ml(r,this._rawValue)&&(this._rawValue=r,this._value=a?r:Ih(r),Vd(this,4))}}function zi(e){return An(e)?e.value:e}const Bw={get:(e,r,a)=>zi(Reflect.get(e,r,a)),set:(e,r,a,u)=>{const d=e[r];return An(d)&&!An(a)?(d.value=a,!0):Reflect.set(e,r,a,u)}};function rv(e){return xl(e)?e:new Proxy(e,Bw)}function Nw(e){const r=_i(e)?new Array(e.length):{};for(const a in e)r[a]=Uw(e,a);return r}class $w{constructor(r,a,u){this._object=r,this._key=a,this._defaultValue=u,this.__v_isRef=!0}get value(){const r=this._object[this._key];return r===void 0?this._defaultValue:r}set value(r){this._object[this._key]=r}get dep(){return gw(Ji(this._object),this._key)}}function Uw(e,r,a){const u=e[r];return An(u)?u:new $w(e,r,a)}/**
* @vue/runtime-core v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function bl(e,r,a,u){try{return u?e(...u):e()}catch(d){xp(d,r,a)}}function Oa(e,r,a,u){if(Ii(e)){const g=bl(e,r,a,u);return g&&k0(g)&&g.catch(m=>{xp(m,r,a)}),g}const d=[];for(let g=0;g<e.length;g++)d.push(Oa(e[g],r,a,u));return d}function xp(e,r,a,u=!0){const d=r?r.vnode:null;if(r){let g=r.parent;const m=r.proxy,l=`https://vuejs.org/error-reference/#runtime-${a}`;for(;g;){const A=g.ec;if(A){for(let R=0;R<A.length;R++)if(A[R](e,m,l)===!1)return}g=g.parent}const M=r.appContext.config.errorHandler;if(M){bl(M,null,10,[e,m,l]);return}}Vw(e,a,d,u)}function Vw(e,r,a,u=!0){console.error(e)}let Ah=!1,rm=!1;const ss=[];let to=0;const au=[];let ml=null,sc=0;const nv=Promise.resolve();let Um=null;function Vm(e){const r=Um||nv;return e?r.then(this?e.bind(this):e):r}function jw(e){let r=to+1,a=ss.length;for(;r<a;){const u=r+a>>>1,d=ss[u],g=Ph(d);g<e||g===e&&d.pre?r=u+1:a=u}return r}function jm(e){(!ss.length||!ss.includes(e,Ah&&e.allowRecurse?to+1:to))&&(e.id==null?ss.push(e):ss.splice(jw(e.id),0,e),sv())}function sv(){!Ah&&!rm&&(rm=!0,Um=nv.then(ov))}function qw(e){const r=ss.indexOf(e);r>to&&ss.splice(r,1)}function Gw(e){_i(e)?au.push(...e):(!ml||!ml.includes(e,e.allowRecurse?sc+1:sc))&&au.push(e),sv()}function Jy(e,r,a=Ah?to+1:0){for(;a<ss.length;a++){const u=ss[a];if(u&&u.pre){if(e&&u.id!==e.uid)continue;ss.splice(a,1),a--,u()}}}function av(e){if(au.length){const r=[...new Set(au)].sort((a,u)=>Ph(a)-Ph(u));if(au.length=0,ml){ml.push(...r);return}for(ml=r,sc=0;sc<ml.length;sc++)ml[sc]();ml=null,sc=0}}const Ph=e=>e.id==null?1/0:e.id,Hw=(e,r)=>{const a=Ph(e)-Ph(r);if(a===0){if(e.pre&&!r.pre)return-1;if(r.pre&&!e.pre)return 1}return a};function ov(e){rm=!1,Ah=!0,ss.sort(Hw);try{for(to=0;to<ss.length;to++){const r=ss[to];r&&r.active!==!1&&bl(r,null,14)}}finally{to=0,ss.length=0,av(),Ah=!1,Um=null,(ss.length||au.length)&&ov()}}function Ww(e,r,...a){if(e.isUnmounted)return;const u=e.vnode.props||Fr;let d=a;const g=r.startsWith("update:"),m=g&&r.slice(7);if(m&&m in u){const R=`${m==="modelValue"?"model":m}Modifiers`,{number:k,trim:z}=u[R]||Fr;z&&(d=a.map(W=>yn(W)?W.trim():W)),k&&(d=a.map(Qf))}let l,M=u[l=If(r)]||u[l=If(so(r))];!M&&g&&(M=u[l=If(dc(r))]),M&&Oa(M,e,6,d);const A=u[l+"Once"];if(A){if(!e.emitted)e.emitted={};else if(e.emitted[l])return;e.emitted[l]=!0,Oa(A,e,6,d)}}function lv(e,r,a=!1){const u=r.emitsCache,d=u.get(e);if(d!==void 0)return d;const g=e.emits;let m={},l=!1;if(!Ii(e)){const M=A=>{const R=lv(A,r,!0);R&&(l=!0,Gn(m,R))};!a&&r.mixins.length&&r.mixins.forEach(M),e.extends&&M(e.extends),e.mixins&&e.mixins.forEach(M)}return!g&&!l?(Ur(e)&&u.set(e,null),null):(_i(g)?g.forEach(M=>m[M]=null):Gn(m,g),Ur(e)&&u.set(e,m),m)}function bp(e,r){return!e||!mp(r)?!1:(r=r.slice(2).replace(/Once$/,""),Yi(e,r[0].toLowerCase()+r.slice(1))||Yi(e,dc(r))||Yi(e,r))}let gn=null,wp=null;function ip(e){const r=gn;return gn=e,wp=e&&e.type.__scopeId||null,r}function qh(e){wp=e}function Gh(){wp=null}function Ao(e,r=gn,a){if(!r||e._n)return e;const u=(...d)=>{u._d&&c_(-1);const g=ip(r);let m;try{m=e(...d)}finally{ip(g),u._d&&c_(1)}return m};return u._n=!0,u._c=!0,u._d=!0,u}function Pf(e){const{type:r,vnode:a,proxy:u,withProxy:d,props:g,propsOptions:[m],slots:l,attrs:M,emit:A,render:R,renderCache:k,data:z,setupState:W,ctx:Z,inheritAttrs:X}=e;let fe,ye;const we=ip(e);try{if(a.shapeFlag&4){const Ie=d||u,Ue=Ie;fe=eo(R.call(Ue,Ie,k,g,W,z,Z)),ye=M}else{const Ie=r;fe=eo(Ie.length>1?Ie(g,{attrs:M,slots:l,emit:A}):Ie(g,null)),ye=r.props?M:Zw(M)}}catch(Ie){vh.length=0,xp(Ie,e,1),fe=sr(Sl)}let ee=fe;if(ye&&X!==!1){const Ie=Object.keys(ye),{shapeFlag:Ue}=ee;Ie.length&&Ue&7&&(m&&Ie.some(Pm)&&(ye=Xw(ye,m)),ee=cc(ee,ye))}return a.dirs&&(ee=cc(ee),ee.dirs=ee.dirs?ee.dirs.concat(a.dirs):a.dirs),a.transition&&(ee.transition=a.transition),fe=ee,ip(we),fe}const Zw=e=>{let r;for(const a in e)(a==="class"||a==="style"||mp(a))&&((r||(r={}))[a]=e[a]);return r},Xw=(e,r)=>{const a={};for(const u in e)(!Pm(u)||!(u.slice(9)in r))&&(a[u]=e[u]);return a};function Kw(e,r,a){const{props:u,children:d,component:g}=e,{props:m,children:l,patchFlag:M}=r,A=g.emitsOptions;if(r.dirs||r.transition)return!0;if(a&&M>=0){if(M&1024)return!0;if(M&16)return u?Qy(u,m,A):!!m;if(M&8){const R=r.dynamicProps;for(let k=0;k<R.length;k++){const z=R[k];if(m[z]!==u[z]&&!bp(A,z))return!0}}}else return(d||l)&&(!l||!l.$stable)?!0:u===m?!1:u?m?Qy(u,m,A):!0:!!m;return!1}function Qy(e,r,a){const u=Object.keys(r);if(u.length!==Object.keys(e).length)return!0;for(let d=0;d<u.length;d++){const g=u[d];if(r[g]!==e[g]&&!bp(a,g))return!0}return!1}function Yw({vnode:e,parent:r},a){for(;r;){const u=r.subTree;if(u.suspense&&u.suspense.activeBranch===e&&(u.el=e.el),u===e)(e=r.vnode).el=a,r=r.parent;else break}}const cv="components";function rO(e,r){return Qw(cv,e,!0,r)||e}const Jw=Symbol.for("v-ndc");function Qw(e,r,a=!0,u=!1){const d=gn||On;if(d){const g=d.type;if(e===cv){const l=um(g,!1);if(l&&(l===r||l===so(r)||l===yp(so(r))))return g}const m=e_(d[e]||g[e],r)||e_(d.appContext[e],r);return!m&&u?g:m}}function e_(e,r){return e&&(e[r]||e[so(r)]||e[yp(so(r))])}const uv=e=>e.__isSuspense;function e2(e,r){r&&r.pendingBranch?_i(e)?r.effects.push(...e):r.effects.push(e):Gw(e)}const t2=Symbol.for("v-scx"),i2=()=>ga(t2),Fd={};function zn(e,r,a){return hv(e,r,a)}function hv(e,r,{immediate:a,deep:u,flush:d,once:g,onTrack:m,onTrigger:l}=Fr){if(r&&g){const Xe=r;r=(...nt)=>{Xe(...nt),Ue()}}const M=On,A=Xe=>u===!0?Xe:ac(Xe,u===!1?1:void 0);let R,k=!1,z=!1;if(An(e)?(R=()=>e.value,k=tp(e)):xl(e)?(R=()=>A(e),k=!0):_i(e)?(z=!0,k=e.some(Xe=>xl(Xe)||tp(Xe)),R=()=>e.map(Xe=>{if(An(Xe))return Xe.value;if(xl(Xe))return A(Xe);if(Ii(Xe))return bl(Xe,M,2)})):Ii(e)?r?R=()=>bl(e,M,2):R=()=>(W&&W(),Oa(e,M,3,[Z])):R=ma,r&&u){const Xe=R;R=()=>ac(Xe())}let W,Z=Xe=>{W=ee.onStop=()=>{bl(Xe,M,4),W=ee.onStop=void 0}},X;if(Tp)if(Z=ma,r?a&&Oa(r,M,3,[R(),z?[]:void 0,Z]):R(),d==="sync"){const Xe=i2();X=Xe.__watcherHandles||(Xe.__watcherHandles=[])}else return ma;let fe=z?new Array(e.length).fill(Fd):Fd;const ye=()=>{if(!(!ee.active||!ee.dirty))if(r){const Xe=ee.run();(u||k||(z?Xe.some((nt,ft)=>Ml(nt,fe[ft])):Ml(Xe,fe)))&&(W&&W(),Oa(r,M,3,[Xe,fe===Fd?void 0:z&&fe[0]===Fd?[]:fe,Z]),fe=Xe)}else ee.run()};ye.allowRecurse=!!r;let we;d==="sync"?we=ye:d==="post"?we=()=>jn(ye,M&&M.suspense):(ye.pre=!0,M&&(ye.id=M.uid),we=()=>jm(ye));const ee=new Rm(R,ma,we),Ie=N0(),Ue=()=>{ee.stop(),Ie&&km(Ie.effects,ee)};return r?a?ye():fe=ee.run():d==="post"?jn(ee.run.bind(ee),M&&M.suspense):ee.run(),X&&X.push(Ue),Ue}function r2(e,r,a){const u=this.proxy,d=yn(e)?e.includes(".")?dv(u,e):()=>u[e]:e.bind(u,u);let g;Ii(r)?g=r:(g=r.handler,a=r);const m=Hh(this),l=hv(d,g.bind(u),a);return m(),l}function dv(e,r){const a=r.split(".");return()=>{let u=e;for(let d=0;d<a.length&&u;d++)u=u[a[d]];return u}}function ac(e,r,a=0,u){if(!Ur(e)||e.__v_skip)return e;if(r&&r>0){if(a>=r)return e;a++}if(u=u||new Set,u.has(e))return e;if(u.add(e),An(e))ac(e.value,r,a,u);else if(_i(e))for(let d=0;d<e.length;d++)ac(e[d],r,a,u);else if(P0(e)||nu(e))e.forEach(d=>{ac(d,r,a,u)});else if(L0(e))for(const d in e)ac(e[d],r,a,u);return e}function pv(e,r){if(gn===null)return e;const a=Cp(gn)||gn.proxy,u=e.dirs||(e.dirs=[]);for(let d=0;d<r.length;d++){let[g,m,l,M=Fr]=r[d];g&&(Ii(g)&&(g={mounted:g,updated:g}),g.deep&&ac(m),u.push({dir:g,instance:a,value:m,oldValue:void 0,arg:l,modifiers:M}))}return e}function ec(e,r,a,u){const d=e.dirs,g=r&&r.dirs;for(let m=0;m<d.length;m++){const l=d[m];g&&(l.oldValue=g[m].value);let M=l.dir[u];M&&(pc(),Oa(M,a,8,[e.el,l,e,r]),fc())}}function fv(e,r){e.shapeFlag&6&&e.component?fv(e.component.subTree,r):e.shapeFlag&128?(e.ssContent.transition=r.clone(e.ssContent),e.ssFallback.transition=r.clone(e.ssFallback)):e.transition=r}/*! #__NO_SIDE_EFFECTS__ */function mv(e,r){return Ii(e)?Gn({name:e.name},r,{setup:e}):e}const ou=e=>!!e.type.__asyncLoader,gv=e=>e.type.__isKeepAlive,n2={name:"KeepAlive",__isKeepAlive:!0,props:{include:[String,RegExp,Array],exclude:[String,RegExp,Array],max:[String,Number]},setup(e,{slots:r}){const a=V2(),u=a.ctx;if(!u.renderer)return()=>{const we=r.default&&r.default();return we&&we.length===1?we[0]:we};const d=new Map,g=new Set;let m=null;const l=a.suspense,{renderer:{p:M,m:A,um:R,o:{createElement:k}}}=u,z=k("div");u.activate=(we,ee,Ie,Ue,Xe)=>{const nt=we.component;A(we,ee,Ie,0,l),M(nt.vnode,we,ee,Ie,nt,l,Ue,we.slotScopeIds,Xe),jn(()=>{nt.isDeactivated=!1,nt.a&&su(nt.a);const ft=we.props&&we.props.onVnodeMounted;ft&&da(ft,nt.parent,we)},l)},u.deactivate=we=>{const ee=we.component;A(we,z,null,1,l),jn(()=>{ee.da&&su(ee.da);const Ie=we.props&&we.props.onVnodeUnmounted;Ie&&da(Ie,ee.parent,we),ee.isDeactivated=!0},l)};function W(we){kf(we),R(we,a,l,!0)}function Z(we){d.forEach((ee,Ie)=>{const Ue=um(ee.type);Ue&&(!we||!we(Ue))&&X(Ie)})}function X(we){const ee=d.get(we);!m||!Wc(ee,m)?W(ee):m&&kf(m),d.delete(we),g.delete(we)}zn(()=>[e.include,e.exclude],([we,ee])=>{we&&Z(Ie=>dh(we,Ie)),ee&&Z(Ie=>!dh(ee,Ie))},{flush:"post",deep:!0});let fe=null;const ye=()=>{fe!=null&&d.set(fe,Df(a.subTree))};return mc(ye),_v(ye),vv(()=>{d.forEach(we=>{const{subTree:ee,suspense:Ie}=a,Ue=Df(ee);if(we.type===Ue.type&&we.key===Ue.key){kf(Ue);const Xe=Ue.component.da;Xe&&jn(Xe,Ie);return}W(we)})}),()=>{if(fe=null,!r.default)return null;const we=r.default(),ee=we[0];if(we.length>1)return m=null,we;if(!Dh(ee)||!(ee.shapeFlag&4)&&!(ee.shapeFlag&128))return m=null,ee;let Ie=Df(ee);const Ue=Ie.type,Xe=um(ou(Ie)?Ie.type.__asyncResolved||{}:Ue),{include:nt,exclude:ft,max:At}=e;if(nt&&(!Xe||!dh(nt,Xe))||ft&&Xe&&dh(ft,Xe))return m=Ie,ee;const Ot=Ie.key==null?Ue:Ie.key,Lt=d.get(Ot);return Ie.el&&(Ie=cc(Ie),ee.shapeFlag&128&&(ee.ssContent=Ie)),fe=Ot,Lt?(Ie.el=Lt.el,Ie.component=Lt.component,Ie.transition&&fv(Ie,Ie.transition),Ie.shapeFlag|=512,g.delete(Ot),g.add(Ot)):(g.add(Ot),At&&g.size>parseInt(At,10)&&X(g.values().next().value)),Ie.shapeFlag|=256,m=Ie,uv(ee.type)?ee:Ie}}},s2=n2;function dh(e,r){return _i(e)?e.some(a=>dh(a,r)):yn(e)?e.split(",").includes(r):rw(e)?e.test(r):!1}function a2(e,r){yv(e,"a",r)}function o2(e,r){yv(e,"da",r)}function yv(e,r,a=On){const u=e.__wdc||(e.__wdc=()=>{let d=a;for(;d;){if(d.isDeactivated)return;d=d.parent}return e()});if(Mp(r,u,a),a){let d=a.parent;for(;d&&d.parent;)gv(d.parent.vnode)&&l2(u,r,a,d),d=d.parent}}function l2(e,r,a,u){const d=Mp(r,e,u,!0);xv(()=>{km(u[r],d)},a)}function kf(e){e.shapeFlag&=-257,e.shapeFlag&=-513}function Df(e){return e.shapeFlag&128?e.ssContent:e}function Mp(e,r,a=On,u=!1){if(a){const d=a[e]||(a[e]=[]),g=r.__weh||(r.__weh=(...m)=>{if(a.isUnmounted)return;pc();const l=Hh(a),M=Oa(r,a,e,m);return l(),fc(),M});return u?d.unshift(g):d.push(g),g}}const Do=e=>(r,a=On)=>(!Tp||e==="sp")&&Mp(e,(...u)=>r(...u),a),qm=Do("bm"),mc=Do("m"),c2=Do("bu"),_v=Do("u"),vv=Do("bum"),xv=Do("um"),u2=Do("sp"),h2=Do("rtg"),d2=Do("rtc");function p2(e,r=On){Mp("ec",e,r)}function Rs(e,r,a,u){let d;const g=a&&a[u];if(_i(e)||yn(e)){d=new Array(e.length);for(let m=0,l=e.length;m<l;m++)d[m]=r(e[m],m,void 0,g&&g[m])}else if(typeof e=="number"){d=new Array(e);for(let m=0;m<e;m++)d[m]=r(m+1,m,void 0,g&&g[m])}else if(Ur(e))if(e[Symbol.iterator])d=Array.from(e,(m,l)=>r(m,l,void 0,g&&g[l]));else{const m=Object.keys(e);d=new Array(m.length);for(let l=0,M=m.length;l<M;l++){const A=m[l];d[l]=r(e[A],A,l,g&&g[l])}}else d=[];return a&&(a[u]=d),d}function f2(e,r,a={},u,d){if(gn.isCE||gn.parent&&ou(gn.parent)&&gn.parent.isCE)return r!=="default"&&(a.name=r),sr("slot",a,u&&u());let g=e[r];g&&g._c&&(g._d=!1),wt();const m=g&&bv(g(a)),l=Ls(Mr,{key:a.key||m&&m.key||`_${r}`},m||(u?u():[]),m&&e._===1?64:-2);return!d&&l.scopeId&&(l.slotScopeIds=[l.scopeId+"-s"]),g&&g._c&&(g._d=!0),l}function bv(e){return e.some(r=>Dh(r)?!(r.type===Sl||r.type===Mr&&!bv(r.children)):!0)?e:null}const nm=e=>e?Lv(e)?Cp(e)||e.proxy:nm(e.parent):null,_h=Gn(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>nm(e.parent),$root:e=>nm(e.root),$emit:e=>e.emit,$options:e=>Gm(e),$forceUpdate:e=>e.f||(e.f=()=>{e.effect.dirty=!0,jm(e.update)}),$nextTick:e=>e.n||(e.n=Vm.bind(e.proxy)),$watch:e=>r2.bind(e)}),Lf=(e,r)=>e!==Fr&&!e.__isScriptSetup&&Yi(e,r),m2={get({_:e},r){const{ctx:a,setupState:u,data:d,props:g,accessCache:m,type:l,appContext:M}=e;let A;if(r[0]!=="$"){const W=m[r];if(W!==void 0)switch(W){case 1:return u[r];case 2:return d[r];case 4:return a[r];case 3:return g[r]}else{if(Lf(u,r))return m[r]=1,u[r];if(d!==Fr&&Yi(d,r))return m[r]=2,d[r];if((A=e.propsOptions[0])&&Yi(A,r))return m[r]=3,g[r];if(a!==Fr&&Yi(a,r))return m[r]=4,a[r];sm&&(m[r]=0)}}const R=_h[r];let k,z;if(R)return r==="$attrs"&&zs(e,"get",r),R(e);if((k=l.__cssModules)&&(k=k[r]))return k;if(a!==Fr&&Yi(a,r))return m[r]=4,a[r];if(z=M.config.globalProperties,Yi(z,r))return z[r]},set({_:e},r,a){const{data:u,setupState:d,ctx:g}=e;return Lf(d,r)?(d[r]=a,!0):u!==Fr&&Yi(u,r)?(u[r]=a,!0):Yi(e.props,r)||r[0]==="$"&&r.slice(1)in e?!1:(g[r]=a,!0)},has({_:{data:e,setupState:r,accessCache:a,ctx:u,appContext:d,propsOptions:g}},m){let l;return!!a[m]||e!==Fr&&Yi(e,m)||Lf(r,m)||(l=g[0])&&Yi(l,m)||Yi(u,m)||Yi(_h,m)||Yi(d.config.globalProperties,m)},defineProperty(e,r,a){return a.get!=null?e._.accessCache[r]=0:Yi(a,"value")&&this.set(e,r,a.value,null),Reflect.defineProperty(e,r,a)}};function t_(e){return _i(e)?e.reduce((r,a)=>(r[a]=null,r),{}):e}let sm=!0;function g2(e){const r=Gm(e),a=e.proxy,u=e.ctx;sm=!1,r.beforeCreate&&i_(r.beforeCreate,e,"bc");const{data:d,computed:g,methods:m,watch:l,provide:M,inject:A,created:R,beforeMount:k,mounted:z,beforeUpdate:W,updated:Z,activated:X,deactivated:fe,beforeDestroy:ye,beforeUnmount:we,destroyed:ee,unmounted:Ie,render:Ue,renderTracked:Xe,renderTriggered:nt,errorCaptured:ft,serverPrefetch:At,expose:Ot,inheritAttrs:Lt,components:li,directives:Ei,filters:ci}=r;if(A&&y2(A,u,null),m)for(const $t in m){const ai=m[$t];Ii(ai)&&(u[$t]=ai.bind(a))}if(d){const $t=d.call(a,a);Ur($t)&&(e.data=jh($t))}if(sm=!0,g)for(const $t in g){const ai=g[$t],Zi=Ii(ai)?ai.bind(a,a):Ii(ai.get)?ai.get.bind(a,a):ma,Bi=!Ii(ai)&&Ii(ai.set)?ai.set.bind(a):ma,We=gi({get:Zi,set:Bi});Object.defineProperty(u,$t,{enumerable:!0,configurable:!0,get:()=>We.value,set:it=>We.value=it})}if(l)for(const $t in l)wv(l[$t],u,a,$t);if(M){const $t=Ii(M)?M.call(a):M;Reflect.ownKeys($t).forEach(ai=>{jd(ai,$t[ai])})}R&&i_(R,e,"c");function kt($t,ai){_i(ai)?ai.forEach(Zi=>$t(Zi.bind(a))):ai&&$t(ai.bind(a))}if(kt(qm,k),kt(mc,z),kt(c2,W),kt(_v,Z),kt(a2,X),kt(o2,fe),kt(p2,ft),kt(d2,Xe),kt(h2,nt),kt(vv,we),kt(xv,Ie),kt(u2,At),_i(Ot))if(Ot.length){const $t=e.exposed||(e.exposed={});Ot.forEach(ai=>{Object.defineProperty($t,ai,{get:()=>a[ai],set:Zi=>a[ai]=Zi})})}else e.exposed||(e.exposed={});Ue&&e.render===ma&&(e.render=Ue),Lt!=null&&(e.inheritAttrs=Lt),li&&(e.components=li),Ei&&(e.directives=Ei)}function y2(e,r,a=ma){_i(e)&&(e=am(e));for(const u in e){const d=e[u];let g;Ur(d)?"default"in d?g=ga(d.from||u,d.default,!0):g=ga(d.from||u):g=ga(d),An(g)?Object.defineProperty(r,u,{enumerable:!0,configurable:!0,get:()=>g.value,set:m=>g.value=m}):r[u]=g}}function i_(e,r,a){Oa(_i(e)?e.map(u=>u.bind(r.proxy)):e.bind(r.proxy),r,a)}function wv(e,r,a,u){const d=u.includes(".")?dv(a,u):()=>a[u];if(yn(e)){const g=r[e];Ii(g)&&zn(d,g)}else if(Ii(e))zn(d,e.bind(a));else if(Ur(e))if(_i(e))e.forEach(g=>wv(g,r,a,u));else{const g=Ii(e.handler)?e.handler.bind(a):r[e.handler];Ii(g)&&zn(d,g,e)}}function Gm(e){const r=e.type,{mixins:a,extends:u}=r,{mixins:d,optionsCache:g,config:{optionMergeStrategies:m}}=e.appContext,l=g.get(r);let M;return l?M=l:!d.length&&!a&&!u?M=r:(M={},d.length&&d.forEach(A=>rp(M,A,m,!0)),rp(M,r,m)),Ur(r)&&g.set(r,M),M}function rp(e,r,a,u=!1){const{mixins:d,extends:g}=r;g&&rp(e,g,a,!0),d&&d.forEach(m=>rp(e,m,a,!0));for(const m in r)if(!(u&&m==="expose")){const l=_2[m]||a&&a[m];e[m]=l?l(e[m],r[m]):r[m]}return e}const _2={data:r_,props:n_,emits:n_,methods:ph,computed:ph,beforeCreate:ys,created:ys,beforeMount:ys,mounted:ys,beforeUpdate:ys,updated:ys,beforeDestroy:ys,beforeUnmount:ys,destroyed:ys,unmounted:ys,activated:ys,deactivated:ys,errorCaptured:ys,serverPrefetch:ys,components:ph,directives:ph,watch:x2,provide:r_,inject:v2};function r_(e,r){return r?e?function(){return Gn(Ii(e)?e.call(this,this):e,Ii(r)?r.call(this,this):r)}:r:e}function v2(e,r){return ph(am(e),am(r))}function am(e){if(_i(e)){const r={};for(let a=0;a<e.length;a++)r[e[a]]=e[a];return r}return e}function ys(e,r){return e?[...new Set([].concat(e,r))]:r}function ph(e,r){return e?Gn(Object.create(null),e,r):r}function n_(e,r){return e?_i(e)&&_i(r)?[...new Set([...e,...r])]:Gn(Object.create(null),t_(e),t_(r??{})):r}function x2(e,r){if(!e)return r;if(!r)return e;const a=Gn(Object.create(null),e);for(const u in r)a[u]=ys(e[u],r[u]);return a}function Mv(){return{app:null,config:{isNativeTag:tw,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let b2=0;function w2(e,r){return function(u,d=null){Ii(u)||(u=Gn({},u)),d!=null&&!Ur(d)&&(d=null);const g=Mv(),m=new WeakSet;let l=!1;const M=g.app={_uid:b2++,_component:u,_props:d,_container:null,_context:g,_instance:null,version:Z2,get config(){return g.config},set config(A){},use(A,...R){return m.has(A)||(A&&Ii(A.install)?(m.add(A),A.install(M,...R)):Ii(A)&&(m.add(A),A(M,...R))),M},mixin(A){return g.mixins.includes(A)||g.mixins.push(A),M},component(A,R){return R?(g.components[A]=R,M):g.components[A]},directive(A,R){return R?(g.directives[A]=R,M):g.directives[A]},mount(A,R,k){if(!l){const z=sr(u,d);return z.appContext=g,k===!0?k="svg":k===!1&&(k=void 0),R&&r?r(z,A):e(z,A,k),l=!0,M._container=A,A.__vue_app__=M,Cp(z.component)||z.component.proxy}},unmount(){l&&(e(null,M._container),delete M._container.__vue_app__)},provide(A,R){return g.provides[A]=R,M},runWithContext(A){const R=lu;lu=M;try{return A()}finally{lu=R}}};return M}}let lu=null;function jd(e,r){if(On){let a=On.provides;const u=On.parent&&On.parent.provides;u===a&&(a=On.provides=Object.create(u)),a[e]=r}}function ga(e,r,a=!1){const u=On||gn;if(u||lu){const d=u?u.parent==null?u.vnode.appContext&&u.vnode.appContext.provides:u.parent.provides:lu._context.provides;if(d&&e in d)return d[e];if(arguments.length>1)return a&&Ii(r)?r.call(u&&u.proxy):r}}function M2(){return!!(On||gn||lu)}function S2(e,r,a,u=!1){const d={},g={};Qd(g,Ep,1),e.propsDefaults=Object.create(null),Sv(e,r,d,g);for(const m in e.propsOptions[0])m in d||(d[m]=void 0);a?e.props=u?d:Y0(d):e.type.props?e.props=d:e.props=g,e.attrs=g}function E2(e,r,a,u){const{props:d,attrs:g,vnode:{patchFlag:m}}=e,l=Ji(d),[M]=e.propsOptions;let A=!1;if((u||m>0)&&!(m&16)){if(m&8){const R=e.vnode.dynamicProps;for(let k=0;k<R.length;k++){let z=R[k];if(bp(e.emitsOptions,z))continue;const W=r[z];if(M)if(Yi(g,z))W!==g[z]&&(g[z]=W,A=!0);else{const Z=so(z);d[Z]=om(M,l,Z,W,e,!1)}else W!==g[z]&&(g[z]=W,A=!0)}}}else{Sv(e,r,d,g)&&(A=!0);let R;for(const k in l)(!r||!Yi(r,k)&&((R=dc(k))===k||!Yi(r,R)))&&(M?a&&(a[k]!==void 0||a[R]!==void 0)&&(d[k]=om(M,l,k,void 0,e,!0)):delete d[k]);if(g!==l)for(const k in g)(!r||!Yi(r,k))&&(delete g[k],A=!0)}A&&Po(e,"set","$attrs")}function Sv(e,r,a,u){const[d,g]=e.propsOptions;let m=!1,l;if(r)for(let M in r){if(yh(M))continue;const A=r[M];let R;d&&Yi(d,R=so(M))?!g||!g.includes(R)?a[R]=A:(l||(l={}))[R]=A:bp(e.emitsOptions,M)||(!(M in u)||A!==u[M])&&(u[M]=A,m=!0)}if(g){const M=Ji(a),A=l||Fr;for(let R=0;R<g.length;R++){const k=g[R];a[k]=om(d,M,k,A[k],e,!Yi(A,k))}}return m}function om(e,r,a,u,d,g){const m=e[a];if(m!=null){const l=Yi(m,"default");if(l&&u===void 0){const M=m.default;if(m.type!==Function&&!m.skipFactory&&Ii(M)){const{propsDefaults:A}=d;if(a in A)u=A[a];else{const R=Hh(d);u=A[a]=M.call(null,r),R()}}else u=M}m[0]&&(g&&!l?u=!1:m[1]&&(u===""||u===dc(a))&&(u=!0))}return u}function Ev(e,r,a=!1){const u=r.propsCache,d=u.get(e);if(d)return d;const g=e.props,m={},l=[];let M=!1;if(!Ii(e)){const R=k=>{M=!0;const[z,W]=Ev(k,r,!0);Gn(m,z),W&&l.push(...W)};!a&&r.mixins.length&&r.mixins.forEach(R),e.extends&&R(e.extends),e.mixins&&e.mixins.forEach(R)}if(!g&&!M)return Ur(e)&&u.set(e,ru),ru;if(_i(g))for(let R=0;R<g.length;R++){const k=so(g[R]);s_(k)&&(m[k]=Fr)}else if(g)for(const R in g){const k=so(R);if(s_(k)){const z=g[R],W=m[k]=_i(z)||Ii(z)?{type:z}:Gn({},z);if(W){const Z=l_(Boolean,W.type),X=l_(String,W.type);W[0]=Z>-1,W[1]=X<0||Z<X,(Z>-1||Yi(W,"default"))&&l.push(k)}}}const A=[m,l];return Ur(e)&&u.set(e,A),A}function s_(e){return e[0]!=="$"&&!yh(e)}function a_(e){return e===null?"null":typeof e=="function"?e.name||"":typeof e=="object"&&e.constructor&&e.constructor.name||""}function o_(e,r){return a_(e)===a_(r)}function l_(e,r){return _i(r)?r.findIndex(a=>o_(a,e)):Ii(r)&&o_(r,e)?0:-1}const Tv=e=>e[0]==="_"||e==="$stable",Hm=e=>_i(e)?e.map(eo):[eo(e)],T2=(e,r,a)=>{if(r._n)return r;const u=Ao((...d)=>Hm(r(...d)),a);return u._c=!1,u},Cv=(e,r,a)=>{const u=e._ctx;for(const d in e){if(Tv(d))continue;const g=e[d];if(Ii(g))r[d]=T2(d,g,u);else if(g!=null){const m=Hm(g);r[d]=()=>m}}},Iv=(e,r)=>{const a=Hm(r);e.slots.default=()=>a},C2=(e,r)=>{if(e.vnode.shapeFlag&32){const a=r._;a?(e.slots=Ji(r),Qd(r,"_",a)):Cv(r,e.slots={})}else e.slots={},r&&Iv(e,r);Qd(e.slots,Ep,1)},I2=(e,r,a)=>{const{vnode:u,slots:d}=e;let g=!0,m=Fr;if(u.shapeFlag&32){const l=r._;l?a&&l===1?g=!1:(Gn(d,r),!a&&l===1&&delete d._):(g=!r.$stable,Cv(r,d)),m=r}else r&&(Iv(e,r),m={default:1});if(g)for(const l in d)!Tv(l)&&m[l]==null&&delete d[l]};function lm(e,r,a,u,d=!1){if(_i(e)){e.forEach((z,W)=>lm(z,r&&(_i(r)?r[W]:r),a,u,d));return}if(ou(u)&&!d)return;const g=u.shapeFlag&4?Cp(u.component)||u.component.proxy:u.el,m=d?null:g,{i:l,r:M}=e,A=r&&r.r,R=l.refs===Fr?l.refs={}:l.refs,k=l.setupState;if(A!=null&&A!==M&&(yn(A)?(R[A]=null,Yi(k,A)&&(k[A]=null)):An(A)&&(A.value=null)),Ii(M))bl(M,l,12,[m,R]);else{const z=yn(M),W=An(M);if(z||W){const Z=()=>{if(e.f){const X=z?Yi(k,M)?k[M]:R[M]:M.value;d?_i(X)&&km(X,g):_i(X)?X.includes(g)||X.push(g):z?(R[M]=[g],Yi(k,M)&&(k[M]=R[M])):(M.value=[g],e.k&&(R[e.k]=M.value))}else z?(R[M]=m,Yi(k,M)&&(k[M]=m)):W&&(M.value=m,e.k&&(R[e.k]=m))};m?(Z.id=-1,jn(Z,a)):Z()}}}const jn=e2;function A2(e){return P2(e)}function P2(e,r){const a=R0();a.__VUE__=!0;const{insert:u,remove:d,patchProp:g,createElement:m,createText:l,createComment:M,setText:A,setElementText:R,parentNode:k,nextSibling:z,setScopeId:W=ma,insertStaticContent:Z}=e,X=(ae,ue,De,Fe=null,ce=null,dt=null,Pt=void 0,Be=null,st=!!ue.dynamicChildren)=>{if(ae===ue)return;ae&&!Wc(ae,ue)&&(Fe=je(ae),it(ae,ce,dt,!0),ae=null),ue.patchFlag===-2&&(st=!1,ue.dynamicChildren=null);const{type:rt,ref:Dt,shapeFlag:Kt}=ue;switch(rt){case Sp:fe(ae,ue,De,Fe);break;case Sl:ye(ae,ue,De,Fe);break;case qd:ae==null&&we(ue,De,Fe,Pt);break;case Mr:li(ae,ue,De,Fe,ce,dt,Pt,Be,st);break;default:Kt&1?Ue(ae,ue,De,Fe,ce,dt,Pt,Be,st):Kt&6?Ei(ae,ue,De,Fe,ce,dt,Pt,Be,st):(Kt&64||Kt&128)&&rt.process(ae,ue,De,Fe,ce,dt,Pt,Be,st,et)}Dt!=null&&ce&&lm(Dt,ae&&ae.ref,dt,ue||ae,!ue)},fe=(ae,ue,De,Fe)=>{if(ae==null)u(ue.el=l(ue.children),De,Fe);else{const ce=ue.el=ae.el;ue.children!==ae.children&&A(ce,ue.children)}},ye=(ae,ue,De,Fe)=>{ae==null?u(ue.el=M(ue.children||""),De,Fe):ue.el=ae.el},we=(ae,ue,De,Fe)=>{[ae.el,ae.anchor]=Z(ae.children,ue,De,Fe,ae.el,ae.anchor)},ee=({el:ae,anchor:ue},De,Fe)=>{let ce;for(;ae&&ae!==ue;)ce=z(ae),u(ae,De,Fe),ae=ce;u(ue,De,Fe)},Ie=({el:ae,anchor:ue})=>{let De;for(;ae&&ae!==ue;)De=z(ae),d(ae),ae=De;d(ue)},Ue=(ae,ue,De,Fe,ce,dt,Pt,Be,st)=>{ue.type==="svg"?Pt="svg":ue.type==="math"&&(Pt="mathml"),ae==null?Xe(ue,De,Fe,ce,dt,Pt,Be,st):At(ae,ue,ce,dt,Pt,Be,st)},Xe=(ae,ue,De,Fe,ce,dt,Pt,Be)=>{let st,rt;const{props:Dt,shapeFlag:Kt,transition:Zt,dirs:Jt}=ae;if(st=ae.el=m(ae.type,dt,Dt&&Dt.is,Dt),Kt&8?R(st,ae.children):Kt&16&&ft(ae.children,st,null,Fe,ce,Rf(ae,dt),Pt,Be),Jt&&ec(ae,null,Fe,"created"),nt(st,ae,ae.scopeId,Pt,Fe),Dt){for(const Ti in Dt)Ti!=="value"&&!yh(Ti)&&g(st,Ti,null,Dt[Ti],dt,ae.children,Fe,ce,Mi);"value"in Dt&&g(st,"value",null,Dt.value,dt),(rt=Dt.onVnodeBeforeMount)&&da(rt,Fe,ae)}Jt&&ec(ae,null,Fe,"beforeMount");const yi=k2(ce,Zt);yi&&Zt.beforeEnter(st),u(st,ue,De),((rt=Dt&&Dt.onVnodeMounted)||yi||Jt)&&jn(()=>{rt&&da(rt,Fe,ae),yi&&Zt.enter(st),Jt&&ec(ae,null,Fe,"mounted")},ce)},nt=(ae,ue,De,Fe,ce)=>{if(De&&W(ae,De),Fe)for(let dt=0;dt<Fe.length;dt++)W(ae,Fe[dt]);if(ce){let dt=ce.subTree;if(ue===dt){const Pt=ce.vnode;nt(ae,Pt,Pt.scopeId,Pt.slotScopeIds,ce.parent)}}},ft=(ae,ue,De,Fe,ce,dt,Pt,Be,st=0)=>{for(let rt=st;rt<ae.length;rt++){const Dt=ae[rt]=Be?gl(ae[rt]):eo(ae[rt]);X(null,Dt,ue,De,Fe,ce,dt,Pt,Be)}},At=(ae,ue,De,Fe,ce,dt,Pt)=>{const Be=ue.el=ae.el;let{patchFlag:st,dynamicChildren:rt,dirs:Dt}=ue;st|=ae.patchFlag&16;const Kt=ae.props||Fr,Zt=ue.props||Fr;let Jt;if(De&&tc(De,!1),(Jt=Zt.onVnodeBeforeUpdate)&&da(Jt,De,ue,ae),Dt&&ec(ue,ae,De,"beforeUpdate"),De&&tc(De,!0),rt?Ot(ae.dynamicChildren,rt,Be,De,Fe,Rf(ue,ce),dt):Pt||ai(ae,ue,Be,null,De,Fe,Rf(ue,ce),dt,!1),st>0){if(st&16)Lt(Be,ue,Kt,Zt,De,Fe,ce);else if(st&2&&Kt.class!==Zt.class&&g(Be,"class",null,Zt.class,ce),st&4&&g(Be,"style",Kt.style,Zt.style,ce),st&8){const yi=ue.dynamicProps;for(let Ti=0;Ti<yi.length;Ti++){const Ve=yi[Ti],Ni=Kt[Ve],Qi=Zt[Ve];(Qi!==Ni||Ve==="value")&&g(Be,Ve,Ni,Qi,ce,ae.children,De,Fe,Mi)}}st&1&&ae.children!==ue.children&&R(Be,ue.children)}else!Pt&&rt==null&&Lt(Be,ue,Kt,Zt,De,Fe,ce);((Jt=Zt.onVnodeUpdated)||Dt)&&jn(()=>{Jt&&da(Jt,De,ue,ae),Dt&&ec(ue,ae,De,"updated")},Fe)},Ot=(ae,ue,De,Fe,ce,dt,Pt)=>{for(let Be=0;Be<ue.length;Be++){const st=ae[Be],rt=ue[Be],Dt=st.el&&(st.type===Mr||!Wc(st,rt)||st.shapeFlag&70)?k(st.el):De;X(st,rt,Dt,null,Fe,ce,dt,Pt,!0)}},Lt=(ae,ue,De,Fe,ce,dt,Pt)=>{if(De!==Fe){if(De!==Fr)for(const Be in De)!yh(Be)&&!(Be in Fe)&&g(ae,Be,De[Be],null,Pt,ue.children,ce,dt,Mi);for(const Be in Fe){if(yh(Be))continue;const st=Fe[Be],rt=De[Be];st!==rt&&Be!=="value"&&g(ae,Be,rt,st,Pt,ue.children,ce,dt,Mi)}"value"in Fe&&g(ae,"value",De.value,Fe.value,Pt)}},li=(ae,ue,De,Fe,ce,dt,Pt,Be,st)=>{const rt=ue.el=ae?ae.el:l(""),Dt=ue.anchor=ae?ae.anchor:l("");let{patchFlag:Kt,dynamicChildren:Zt,slotScopeIds:Jt}=ue;Jt&&(Be=Be?Be.concat(Jt):Jt),ae==null?(u(rt,De,Fe),u(Dt,De,Fe),ft(ue.children||[],De,Dt,ce,dt,Pt,Be,st)):Kt>0&&Kt&64&&Zt&&ae.dynamicChildren?(Ot(ae.dynamicChildren,Zt,De,ce,dt,Pt,Be),(ue.key!=null||ce&&ue===ce.subTree)&&Av(ae,ue,!0)):ai(ae,ue,De,Dt,ce,dt,Pt,Be,st)},Ei=(ae,ue,De,Fe,ce,dt,Pt,Be,st)=>{ue.slotScopeIds=Be,ae==null?ue.shapeFlag&512?ce.ctx.activate(ue,De,Fe,Pt,st):ci(ue,De,Fe,ce,dt,Pt,st):xt(ae,ue,st)},ci=(ae,ue,De,Fe,ce,dt,Pt)=>{const Be=ae.component=U2(ae,Fe,ce);if(gv(ae)&&(Be.ctx.renderer=et),j2(Be),Be.asyncDep){if(ce&&ce.registerDep(Be,kt),!ae.el){const st=Be.subTree=sr(Sl);ye(null,st,ue,De)}}else kt(Be,ae,ue,De,ce,dt,Pt)},xt=(ae,ue,De)=>{const Fe=ue.component=ae.component;if(Kw(ae,ue,De))if(Fe.asyncDep&&!Fe.asyncResolved){$t(Fe,ue,De);return}else Fe.next=ue,qw(Fe.update),Fe.effect.dirty=!0,Fe.update();else ue.el=ae.el,Fe.vnode=ue},kt=(ae,ue,De,Fe,ce,dt,Pt)=>{const Be=()=>{if(ae.isMounted){let{next:Dt,bu:Kt,u:Zt,parent:Jt,vnode:yi}=ae;{const _n=Pv(ae);if(_n){Dt&&(Dt.el=yi.el,$t(ae,Dt,Pt)),_n.asyncDep.then(()=>{ae.isUnmounted||Be()});return}}let Ti=Dt,Ve;tc(ae,!1),Dt?(Dt.el=yi.el,$t(ae,Dt,Pt)):Dt=yi,Kt&&su(Kt),(Ve=Dt.props&&Dt.props.onVnodeBeforeUpdate)&&da(Ve,Jt,Dt,yi),tc(ae,!0);const Ni=Pf(ae),Qi=ae.subTree;ae.subTree=Ni,X(Qi,Ni,k(Qi.el),je(Qi),ae,ce,dt),Dt.el=Ni.el,Ti===null&&Yw(ae,Ni.el),Zt&&jn(Zt,ce),(Ve=Dt.props&&Dt.props.onVnodeUpdated)&&jn(()=>da(Ve,Jt,Dt,yi),ce)}else{let Dt;const{el:Kt,props:Zt}=ue,{bm:Jt,m:yi,parent:Ti}=ae,Ve=ou(ue);if(tc(ae,!1),Jt&&su(Jt),!Ve&&(Dt=Zt&&Zt.onVnodeBeforeMount)&&da(Dt,Ti,ue),tc(ae,!0),Kt&&Oi){const Ni=()=>{ae.subTree=Pf(ae),Oi(Kt,ae.subTree,ae,ce,null)};Ve?ue.type.__asyncLoader().then(()=>!ae.isUnmounted&&Ni()):Ni()}else{const Ni=ae.subTree=Pf(ae);X(null,Ni,De,Fe,ae,ce,dt),ue.el=Ni.el}if(yi&&jn(yi,ce),!Ve&&(Dt=Zt&&Zt.onVnodeMounted)){const Ni=ue;jn(()=>da(Dt,Ti,Ni),ce)}(ue.shapeFlag&256||Ti&&ou(Ti.vnode)&&Ti.vnode.shapeFlag&256)&&ae.a&&jn(ae.a,ce),ae.isMounted=!0,ue=De=Fe=null}},st=ae.effect=new Rm(Be,ma,()=>jm(rt),ae.scope),rt=ae.update=()=>{st.dirty&&st.run()};rt.id=ae.uid,tc(ae,!0),rt()},$t=(ae,ue,De)=>{ue.component=ae;const Fe=ae.vnode.props;ae.vnode=ue,ae.next=null,E2(ae,ue.props,Fe,De),I2(ae,ue.children,De),pc(),Jy(ae),fc()},ai=(ae,ue,De,Fe,ce,dt,Pt,Be,st=!1)=>{const rt=ae&&ae.children,Dt=ae?ae.shapeFlag:0,Kt=ue.children,{patchFlag:Zt,shapeFlag:Jt}=ue;if(Zt>0){if(Zt&128){Bi(rt,Kt,De,Fe,ce,dt,Pt,Be,st);return}else if(Zt&256){Zi(rt,Kt,De,Fe,ce,dt,Pt,Be,st);return}}Jt&8?(Dt&16&&Mi(rt,ce,dt),Kt!==rt&&R(De,Kt)):Dt&16?Jt&16?Bi(rt,Kt,De,Fe,ce,dt,Pt,Be,st):Mi(rt,ce,dt,!0):(Dt&8&&R(De,""),Jt&16&&ft(Kt,De,Fe,ce,dt,Pt,Be,st))},Zi=(ae,ue,De,Fe,ce,dt,Pt,Be,st)=>{ae=ae||ru,ue=ue||ru;const rt=ae.length,Dt=ue.length,Kt=Math.min(rt,Dt);let Zt;for(Zt=0;Zt<Kt;Zt++){const Jt=ue[Zt]=st?gl(ue[Zt]):eo(ue[Zt]);X(ae[Zt],Jt,De,null,ce,dt,Pt,Be,st)}rt>Dt?Mi(ae,ce,dt,!0,!1,Kt):ft(ue,De,Fe,ce,dt,Pt,Be,st,Kt)},Bi=(ae,ue,De,Fe,ce,dt,Pt,Be,st)=>{let rt=0;const Dt=ue.length;let Kt=ae.length-1,Zt=Dt-1;for(;rt<=Kt&&rt<=Zt;){const Jt=ae[rt],yi=ue[rt]=st?gl(ue[rt]):eo(ue[rt]);if(Wc(Jt,yi))X(Jt,yi,De,null,ce,dt,Pt,Be,st);else break;rt++}for(;rt<=Kt&&rt<=Zt;){const Jt=ae[Kt],yi=ue[Zt]=st?gl(ue[Zt]):eo(ue[Zt]);if(Wc(Jt,yi))X(Jt,yi,De,null,ce,dt,Pt,Be,st);else break;Kt--,Zt--}if(rt>Kt){if(rt<=Zt){const Jt=Zt+1,yi=Jt<Dt?ue[Jt].el:Fe;for(;rt<=Zt;)X(null,ue[rt]=st?gl(ue[rt]):eo(ue[rt]),De,yi,ce,dt,Pt,Be,st),rt++}}else if(rt>Zt)for(;rt<=Kt;)it(ae[rt],ce,dt,!0),rt++;else{const Jt=rt,yi=rt,Ti=new Map;for(rt=yi;rt<=Zt;rt++){const Ut=ue[rt]=st?gl(ue[rt]):eo(ue[rt]);Ut.key!=null&&Ti.set(Ut.key,rt)}let Ve,Ni=0;const Qi=Zt-yi+1;let _n=!1,Sr=0;const at=new Array(Qi);for(rt=0;rt<Qi;rt++)at[rt]=0;for(rt=Jt;rt<=Kt;rt++){const Ut=ae[rt];if(Ni>=Qi){it(Ut,ce,dt,!0);continue}let qi;if(Ut.key!=null)qi=Ti.get(Ut.key);else for(Ve=yi;Ve<=Zt;Ve++)if(at[Ve-yi]===0&&Wc(Ut,ue[Ve])){qi=Ve;break}qi===void 0?it(Ut,ce,dt,!0):(at[qi-yi]=rt+1,qi>=Sr?Sr=qi:_n=!0,X(Ut,ue[qi],De,null,ce,dt,Pt,Be,st),Ni++)}const ui=_n?D2(at):ru;for(Ve=ui.length-1,rt=Qi-1;rt>=0;rt--){const Ut=yi+rt,qi=ue[Ut],vn=Ut+1<Dt?ue[Ut+1].el:Fe;at[rt]===0?X(null,qi,De,vn,ce,dt,Pt,Be,st):_n&&(Ve<0||rt!==ui[Ve]?We(qi,De,vn,2):Ve--)}}},We=(ae,ue,De,Fe,ce=null)=>{const{el:dt,type:Pt,transition:Be,children:st,shapeFlag:rt}=ae;if(rt&6){We(ae.component.subTree,ue,De,Fe);return}if(rt&128){ae.suspense.move(ue,De,Fe);return}if(rt&64){Pt.move(ae,ue,De,et);return}if(Pt===Mr){u(dt,ue,De);for(let Kt=0;Kt<st.length;Kt++)We(st[Kt],ue,De,Fe);u(ae.anchor,ue,De);return}if(Pt===qd){ee(ae,ue,De);return}if(Fe!==2&&rt&1&&Be)if(Fe===0)Be.beforeEnter(dt),u(dt,ue,De),jn(()=>Be.enter(dt),ce);else{const{leave:Kt,delayLeave:Zt,afterLeave:Jt}=Be,yi=()=>u(dt,ue,De),Ti=()=>{Kt(dt,()=>{yi(),Jt&&Jt()})};Zt?Zt(dt,yi,Ti):Ti()}else u(dt,ue,De)},it=(ae,ue,De,Fe=!1,ce=!1)=>{const{type:dt,props:Pt,ref:Be,children:st,dynamicChildren:rt,shapeFlag:Dt,patchFlag:Kt,dirs:Zt}=ae;if(Be!=null&&lm(Be,null,De,ae,!0),Dt&256){ue.ctx.deactivate(ae);return}const Jt=Dt&1&&Zt,yi=!ou(ae);let Ti;if(yi&&(Ti=Pt&&Pt.onVnodeBeforeUnmount)&&da(Ti,ue,ae),Dt&6)ji(ae.component,De,Fe);else{if(Dt&128){ae.suspense.unmount(De,Fe);return}Jt&&ec(ae,null,ue,"beforeUnmount"),Dt&64?ae.type.remove(ae,ue,De,ce,et,Fe):rt&&(dt!==Mr||Kt>0&&Kt&64)?Mi(rt,ue,De,!1,!0):(dt===Mr&&Kt&384||!ce&&Dt&16)&&Mi(st,ue,De),Fe&&Qe(ae)}(yi&&(Ti=Pt&&Pt.onVnodeUnmounted)||Jt)&&jn(()=>{Ti&&da(Ti,ue,ae),Jt&&ec(ae,null,ue,"unmounted")},De)},Qe=ae=>{const{type:ue,el:De,anchor:Fe,transition:ce}=ae;if(ue===Mr){Xi(De,Fe);return}if(ue===qd){Ie(ae);return}const dt=()=>{d(De),ce&&!ce.persisted&&ce.afterLeave&&ce.afterLeave()};if(ae.shapeFlag&1&&ce&&!ce.persisted){const{leave:Pt,delayLeave:Be}=ce,st=()=>Pt(De,dt);Be?Be(ae.el,dt,st):st()}else dt()},Xi=(ae,ue)=>{let De;for(;ae!==ue;)De=z(ae),d(ae),ae=De;d(ue)},ji=(ae,ue,De)=>{const{bum:Fe,scope:ce,update:dt,subTree:Pt,um:Be}=ae;Fe&&su(Fe),ce.stop(),dt&&(dt.active=!1,it(Pt,ae,ue,De)),Be&&jn(Be,ue),jn(()=>{ae.isUnmounted=!0},ue),ue&&ue.pendingBranch&&!ue.isUnmounted&&ae.asyncDep&&!ae.asyncResolved&&ae.suspenseId===ue.pendingId&&(ue.deps--,ue.deps===0&&ue.resolve())},Mi=(ae,ue,De,Fe=!1,ce=!1,dt=0)=>{for(let Pt=dt;Pt<ae.length;Pt++)it(ae[Pt],ue,De,Fe,ce)},je=ae=>ae.shapeFlag&6?je(ae.component.subTree):ae.shapeFlag&128?ae.suspense.next():z(ae.anchor||ae.el);let Tt=!1;const ut=(ae,ue,De)=>{ae==null?ue._vnode&&it(ue._vnode,null,null,!0):X(ue._vnode||null,ae,ue,null,null,null,De),Tt||(Tt=!0,Jy(),av(),Tt=!1),ue._vnode=ae},et={p:X,um:it,m:We,r:Qe,mt:ci,mc:ft,pc:ai,pbc:Ot,n:je,o:e};let ki,Oi;return r&&([ki,Oi]=r(et)),{render:ut,hydrate:ki,createApp:w2(ut,ki)}}function Rf({type:e,props:r},a){return a==="svg"&&e==="foreignObject"||a==="mathml"&&e==="annotation-xml"&&r&&r.encoding&&r.encoding.includes("html")?void 0:a}function tc({effect:e,update:r},a){e.allowRecurse=r.allowRecurse=a}function k2(e,r){return(!e||e&&!e.pendingBranch)&&r&&!r.persisted}function Av(e,r,a=!1){const u=e.children,d=r.children;if(_i(u)&&_i(d))for(let g=0;g<u.length;g++){const m=u[g];let l=d[g];l.shapeFlag&1&&!l.dynamicChildren&&((l.patchFlag<=0||l.patchFlag===32)&&(l=d[g]=gl(d[g]),l.el=m.el),a||Av(m,l)),l.type===Sp&&(l.el=m.el)}}function D2(e){const r=e.slice(),a=[0];let u,d,g,m,l;const M=e.length;for(u=0;u<M;u++){const A=e[u];if(A!==0){if(d=a[a.length-1],e[d]<A){r[u]=d,a.push(u);continue}for(g=0,m=a.length-1;g<m;)l=g+m>>1,e[a[l]]<A?g=l+1:m=l;A<e[a[g]]&&(g>0&&(r[u]=a[g-1]),a[g]=u)}}for(g=a.length,m=a[g-1];g-- >0;)a[g]=m,m=r[m];return a}function Pv(e){const r=e.subTree.component;if(r)return r.asyncDep&&!r.asyncResolved?r:Pv(r)}const L2=e=>e.__isTeleport,Mr=Symbol.for("v-fgt"),Sp=Symbol.for("v-txt"),Sl=Symbol.for("v-cmt"),qd=Symbol.for("v-stc"),vh=[];let Ra=null;function wt(e=!1){vh.push(Ra=e?null:[])}function R2(){vh.pop(),Ra=vh[vh.length-1]||null}let kh=1;function c_(e){kh+=e}function kv(e){return e.dynamicChildren=kh>0?Ra||ru:null,R2(),kh>0&&Ra&&Ra.push(e),e}function Ft(e,r,a,u,d,g){return kv(J(e,r,a,u,d,g,!0))}function Ls(e,r,a,u,d){return kv(sr(e,r,a,u,d,!0))}function Dh(e){return e?e.__v_isVNode===!0:!1}function Wc(e,r){return e.type===r.type&&e.key===r.key}const Ep="__vInternal",Dv=({key:e})=>e??null,Gd=({ref:e,ref_key:r,ref_for:a})=>(typeof e=="number"&&(e=""+e),e!=null?yn(e)||An(e)||Ii(e)?{i:gn,r:e,k:r,f:!!a}:e:null);function J(e,r=null,a=null,u=0,d=null,g=e===Mr?0:1,m=!1,l=!1){const M={__v_isVNode:!0,__v_skip:!0,type:e,props:r,key:r&&Dv(r),ref:r&&Gd(r),scopeId:wp,slotScopeIds:null,children:a,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:g,patchFlag:u,dynamicProps:d,dynamicChildren:null,appContext:null,ctx:gn};return l?(Wm(M,a),g&128&&e.normalize(M)):a&&(M.shapeFlag|=yn(a)?8:16),kh>0&&!m&&Ra&&(M.patchFlag>0||g&6)&&M.patchFlag!==32&&Ra.push(M),M}const sr=z2;function z2(e,r=null,a=null,u=0,d=null,g=!1){if((!e||e===Jw)&&(e=Sl),Dh(e)){const l=cc(e,r,!0);return a&&Wm(l,a),kh>0&&!g&&Ra&&(l.shapeFlag&6?Ra[Ra.indexOf(e)]=l:Ra.push(l)),l.patchFlag|=-2,l}if(W2(e)&&(e=e.__vccOpts),r){r=O2(r);let{class:l,style:M}=r;l&&!yn(l)&&(r.class=ns(l)),Ur(M)&&(Q0(M)&&!_i(M)&&(M=Gn({},M)),r.style=Lm(M))}const m=yn(e)?1:uv(e)?128:L2(e)?64:Ur(e)?4:Ii(e)?2:0;return J(e,r,a,u,d,m,g,!0)}function O2(e){return e?Q0(e)||Ep in e?Gn({},e):e:null}function cc(e,r,a=!1){const{props:u,ref:d,patchFlag:g,children:m}=e,l=r?B2(u||{},r):u;return{__v_isVNode:!0,__v_skip:!0,type:e.type,props:l,key:l&&Dv(l),ref:r&&r.ref?a&&d?_i(d)?d.concat(Gd(r)):[d,Gd(r)]:Gd(r):d,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:m,target:e.target,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:r&&e.type!==Mr?g===-1?16:g|16:g,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:e.transition,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&cc(e.ssContent),ssFallback:e.ssFallback&&cc(e.ssFallback),el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce}}function np(e=" ",r=0){return sr(Sp,null,e,r)}function F2(e,r){const a=sr(qd,null,e);return a.staticCount=r,a}function Gi(e="",r=!1){return r?(wt(),Ls(Sl,null,e)):sr(Sl,null,e)}function eo(e){return e==null||typeof e=="boolean"?sr(Sl):_i(e)?sr(Mr,null,e.slice()):typeof e=="object"?gl(e):sr(Sp,null,String(e))}function gl(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:cc(e)}function Wm(e,r){let a=0;const{shapeFlag:u}=e;if(r==null)r=null;else if(_i(r))a=16;else if(typeof r=="object")if(u&65){const d=r.default;d&&(d._c&&(d._d=!1),Wm(e,d()),d._c&&(d._d=!0));return}else{a=32;const d=r._;!d&&!(Ep in r)?r._ctx=gn:d===3&&gn&&(gn.slots._===1?r._=1:(r._=2,e.patchFlag|=1024))}else Ii(r)?(r={default:r,_ctx:gn},a=32):(r=String(r),u&64?(a=16,r=[np(r)]):a=8);e.children=r,e.shapeFlag|=a}function B2(...e){const r={};for(let a=0;a<e.length;a++){const u=e[a];for(const d in u)if(d==="class")r.class!==u.class&&(r.class=ns([r.class,u.class]));else if(d==="style")r.style=Lm([r.style,u.style]);else if(mp(d)){const g=r[d],m=u[d];m&&g!==m&&!(_i(g)&&g.includes(m))&&(r[d]=g?[].concat(g,m):m)}else d!==""&&(r[d]=u[d])}return r}function da(e,r,a,u=null){Oa(e,r,7,[a,u])}const N2=Mv();let $2=0;function U2(e,r,a){const u=e.type,d=(r?r.appContext:e.appContext)||N2,g={uid:$2++,vnode:e,type:u,parent:r,appContext:d,root:null,next:null,subTree:null,effect:null,update:null,scope:new F0(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:r?r.provides:Object.create(d.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Ev(u,d),emitsOptions:lv(u,d),emit:null,emitted:null,propsDefaults:Fr,inheritAttrs:u.inheritAttrs,ctx:Fr,data:Fr,props:Fr,attrs:Fr,slots:Fr,refs:Fr,setupState:Fr,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:a,suspenseId:a?a.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return g.ctx={_:g},g.root=r?r.root:g,g.emit=Ww.bind(null,g),e.ce&&e.ce(g),g}let On=null;const V2=()=>On||gn;let sp,cm;{const e=R0(),r=(a,u)=>{let d;return(d=e[a])||(d=e[a]=[]),d.push(u),g=>{d.length>1?d.forEach(m=>m(g)):d[0](g)}};sp=r("__VUE_INSTANCE_SETTERS__",a=>On=a),cm=r("__VUE_SSR_SETTERS__",a=>Tp=a)}const Hh=e=>{const r=On;return sp(e),e.scope.on(),()=>{e.scope.off(),sp(r)}},u_=()=>{On&&On.scope.off(),sp(null)};function Lv(e){return e.vnode.shapeFlag&4}let Tp=!1;function j2(e,r=!1){r&&cm(r);const{props:a,children:u}=e.vnode,d=Lv(e);S2(e,a,d,r),C2(e,u);const g=d?q2(e,r):void 0;return r&&cm(!1),g}function q2(e,r){const a=e.type;e.accessCache=Object.create(null),e.proxy=vp(new Proxy(e.ctx,m2));const{setup:u}=a;if(u){const d=e.setupContext=u.length>1?H2(e):null,g=Hh(e);pc();const m=bl(u,e,0,[e.props,d]);if(fc(),g(),k0(m)){if(m.then(u_,u_),r)return m.then(l=>{h_(e,l,r)}).catch(l=>{xp(l,e,0)});e.asyncDep=m}else h_(e,m,r)}else Rv(e,r)}function h_(e,r,a){Ii(r)?e.type.__ssrInlineRender?e.ssrRender=r:e.render=r:Ur(r)&&(e.setupState=rv(r)),Rv(e,a)}let d_;function Rv(e,r,a){const u=e.type;if(!e.render){if(!r&&d_&&!u.render){const d=u.template||Gm(e).template;if(d){const{isCustomElement:g,compilerOptions:m}=e.appContext.config,{delimiters:l,compilerOptions:M}=u,A=Gn(Gn({isCustomElement:g,delimiters:l},m),M);u.render=d_(d,A)}}e.render=u.render||ma}{const d=Hh(e);pc();try{g2(e)}finally{fc(),d()}}}function G2(e){return e.attrsProxy||(e.attrsProxy=new Proxy(e.attrs,{get(r,a){return zs(e,"get","$attrs"),r[a]}}))}function H2(e){const r=a=>{e.exposed=a||{}};return{get attrs(){return G2(e)},slots:e.slots,emit:e.emit,expose:r}}function Cp(e){if(e.exposed)return e.exposeProxy||(e.exposeProxy=new Proxy(rv(vp(e.exposed)),{get(r,a){if(a in r)return r[a];if(a in _h)return _h[a](e)},has(r,a){return a in r||a in _h}}))}function um(e,r=!0){return Ii(e)?e.displayName||e.name:e.name||r&&e.__name}function W2(e){return Ii(e)&&"__vccOpts"in e}const gi=(e,r)=>zw(e,r,Tp);function zv(e,r,a){const u=arguments.length;return u===2?Ur(r)&&!_i(r)?Dh(r)?sr(e,null,[r]):sr(e,r):sr(e,null,r):(u>3?a=Array.prototype.slice.call(arguments,2):u===3&&Dh(a)&&(a=[a]),sr(e,r,a))}const Z2="3.4.21";/**
* @vue/runtime-dom v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const X2="http://www.w3.org/2000/svg",K2="http://www.w3.org/1998/Math/MathML",yl=typeof document<"u"?document:null,p_=yl&&yl.createElement("template"),Y2={insert:(e,r,a)=>{r.insertBefore(e,a||null)},remove:e=>{const r=e.parentNode;r&&r.removeChild(e)},createElement:(e,r,a,u)=>{const d=r==="svg"?yl.createElementNS(X2,e):r==="mathml"?yl.createElementNS(K2,e):yl.createElement(e,a?{is:a}:void 0);return e==="select"&&u&&u.multiple!=null&&d.setAttribute("multiple",u.multiple),d},createText:e=>yl.createTextNode(e),createComment:e=>yl.createComment(e),setText:(e,r)=>{e.nodeValue=r},setElementText:(e,r)=>{e.textContent=r},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>yl.querySelector(e),setScopeId(e,r){e.setAttribute(r,"")},insertStaticContent(e,r,a,u,d,g){const m=a?a.previousSibling:r.lastChild;if(d&&(d===g||d.nextSibling))for(;r.insertBefore(d.cloneNode(!0),a),!(d===g||!(d=d.nextSibling)););else{p_.innerHTML=u==="svg"?`<svg>${e}</svg>`:u==="mathml"?`<math>${e}</math>`:e;const l=p_.content;if(u==="svg"||u==="mathml"){const M=l.firstChild;for(;M.firstChild;)l.appendChild(M.firstChild);l.removeChild(M)}r.insertBefore(l,a)}return[m?m.nextSibling:r.firstChild,a?a.previousSibling:r.lastChild]}},J2=Symbol("_vtc");function Q2(e,r,a){const u=e[J2];u&&(r=(r?[r,...u]:[...u]).join(" ")),r==null?e.removeAttribute("class"):a?e.setAttribute("class",r):e.className=r}const ap=Symbol("_vod"),Ov=Symbol("_vsh"),eM={beforeMount(e,{value:r},{transition:a}){e[ap]=e.style.display==="none"?"":e.style.display,a&&r?a.beforeEnter(e):sh(e,r)},mounted(e,{value:r},{transition:a}){a&&r&&a.enter(e)},updated(e,{value:r,oldValue:a},{transition:u}){!r!=!a&&(u?r?(u.beforeEnter(e),sh(e,!0),u.enter(e)):u.leave(e,()=>{sh(e,!1)}):sh(e,r))},beforeUnmount(e,{value:r}){sh(e,r)}};function sh(e,r){e.style.display=r?e[ap]:"none",e[Ov]=!r}const tM=Symbol(""),iM=/(^|;)\s*display\s*:/;function rM(e,r,a){const u=e.style,d=yn(a);let g=!1;if(a&&!d){if(r)if(yn(r))for(const m of r.split(";")){const l=m.slice(0,m.indexOf(":")).trim();a[l]==null&&Hd(u,l,"")}else for(const m in r)a[m]==null&&Hd(u,m,"");for(const m in a)m==="display"&&(g=!0),Hd(u,m,a[m])}else if(d){if(r!==a){const m=u[tM];m&&(a+=";"+m),u.cssText=a,g=iM.test(a)}}else r&&e.removeAttribute("style");ap in e&&(e[ap]=g?u.display:"",e[Ov]&&(u.display="none"))}const f_=/\s*!important$/;function Hd(e,r,a){if(_i(a))a.forEach(u=>Hd(e,r,u));else if(a==null&&(a=""),r.startsWith("--"))e.setProperty(r,a);else{const u=nM(e,r);f_.test(a)?e.setProperty(dc(u),a.replace(f_,""),"important"):e[u]=a}}const m_=["Webkit","Moz","ms"],zf={};function nM(e,r){const a=zf[r];if(a)return a;let u=so(r);if(u!=="filter"&&u in e)return zf[r]=u;u=yp(u);for(let d=0;d<m_.length;d++){const g=m_[d]+u;if(g in e)return zf[r]=g}return r}const g_="http://www.w3.org/1999/xlink";function sM(e,r,a,u,d){if(u&&r.startsWith("xlink:"))a==null?e.removeAttributeNS(g_,r.slice(6,r.length)):e.setAttributeNS(g_,r,a);else{const g=dw(r);a==null||g&&!z0(a)?e.removeAttribute(r):e.setAttribute(r,g?"":a)}}function aM(e,r,a,u,d,g,m){if(r==="innerHTML"||r==="textContent"){u&&m(u,d,g),e[r]=a??"";return}const l=e.tagName;if(r==="value"&&l!=="PROGRESS"&&!l.includes("-")){const A=l==="OPTION"?e.getAttribute("value")||"":e.value,R=a??"";(A!==R||!("_value"in e))&&(e.value=R),a==null&&e.removeAttribute(r),e._value=a;return}let M=!1;if(a===""||a==null){const A=typeof e[r];A==="boolean"?a=z0(a):a==null&&A==="string"?(a="",M=!0):A==="number"&&(a=0,M=!0)}try{e[r]=a}catch{}M&&e.removeAttribute(r)}function Zc(e,r,a,u){e.addEventListener(r,a,u)}function oM(e,r,a,u){e.removeEventListener(r,a,u)}const y_=Symbol("_vei");function lM(e,r,a,u,d=null){const g=e[y_]||(e[y_]={}),m=g[r];if(u&&m)m.value=u;else{const[l,M]=cM(r);if(u){const A=g[r]=dM(u,d);Zc(e,l,A,M)}else m&&(oM(e,l,m,M),g[r]=void 0)}}const __=/(?:Once|Passive|Capture)$/;function cM(e){let r;if(__.test(e)){r={};let u;for(;u=e.match(__);)e=e.slice(0,e.length-u[0].length),r[u[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):dc(e.slice(2)),r]}let Of=0;const uM=Promise.resolve(),hM=()=>Of||(uM.then(()=>Of=0),Of=Date.now());function dM(e,r){const a=u=>{if(!u._vts)u._vts=Date.now();else if(u._vts<=a.attached)return;Oa(pM(u,a.value),r,5,[u])};return a.value=e,a.attached=hM(),a}function pM(e,r){if(_i(r)){const a=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{a.call(e),e._stopped=!0},r.map(u=>d=>!d._stopped&&u&&u(d))}else return r}const v_=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&e.charCodeAt(2)>96&&e.charCodeAt(2)<123,fM=(e,r,a,u,d,g,m,l,M)=>{const A=d==="svg";r==="class"?Q2(e,u,A):r==="style"?rM(e,a,u):mp(r)?Pm(r)||lM(e,r,a,u,m):(r[0]==="."?(r=r.slice(1),!0):r[0]==="^"?(r=r.slice(1),!1):mM(e,r,u,A))?aM(e,r,u,g,m,l,M):(r==="true-value"?e._trueValue=u:r==="false-value"&&(e._falseValue=u),sM(e,r,u,A))};function mM(e,r,a,u){if(u)return!!(r==="innerHTML"||r==="textContent"||r in e&&v_(r)&&Ii(a));if(r==="spellcheck"||r==="draggable"||r==="translate"||r==="form"||r==="list"&&e.tagName==="INPUT"||r==="type"&&e.tagName==="TEXTAREA")return!1;if(r==="width"||r==="height"){const d=e.tagName;if(d==="IMG"||d==="VIDEO"||d==="CANVAS"||d==="SOURCE")return!1}return v_(r)&&yn(a)?!1:r in e}const x_=e=>{const r=e.props["onUpdate:modelValue"]||!1;return _i(r)?a=>su(r,a):r};function gM(e){e.target.composing=!0}function b_(e){const r=e.target;r.composing&&(r.composing=!1,r.dispatchEvent(new Event("input")))}const Ff=Symbol("_assign"),yM={created(e,{modifiers:{lazy:r,trim:a,number:u}},d){e[Ff]=x_(d);const g=u||d.props&&d.props.type==="number";Zc(e,r?"change":"input",m=>{if(m.target.composing)return;let l=e.value;a&&(l=l.trim()),g&&(l=Qf(l)),e[Ff](l)}),a&&Zc(e,"change",()=>{e.value=e.value.trim()}),r||(Zc(e,"compositionstart",gM),Zc(e,"compositionend",b_),Zc(e,"change",b_))},mounted(e,{value:r}){e.value=r??""},beforeUpdate(e,{value:r,modifiers:{lazy:a,trim:u,number:d}},g){if(e[Ff]=x_(g),e.composing)return;const m=d||e.type==="number"?Qf(e.value):e.value,l=r??"";m!==l&&(document.activeElement===e&&e.type!=="range"&&(a||u&&e.value.trim()===l)||(e.value=l))}},_M={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},vM=(e,r)=>{const a=e._withKeys||(e._withKeys={}),u=r.join(".");return a[u]||(a[u]=d=>{if(!("key"in d))return;const g=dc(d.key);if(r.some(m=>m===g||_M[m]===g))return e(d)})},xM=Gn({patchProp:fM},Y2);let w_;function bM(){return w_||(w_=A2(xM))}const wM=(...e)=>{const r=bM().createApp(...e),{mount:a}=r;return r.mount=u=>{const d=SM(u);if(!d)return;const g=r._component;!Ii(g)&&!g.render&&!g.template&&(g.template=d.innerHTML),d.innerHTML="";const m=a(d,!1,MM(d));return d instanceof Element&&(d.removeAttribute("v-cloak"),d.setAttribute("data-v-app","")),m},r};function MM(e){if(e instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&e instanceof MathMLElement)return"mathml"}function SM(e){return yn(e)?document.querySelector(e):e}var EM=!1;/*!
 * pinia v2.1.7
 * (c) 2023 Eduardo San Martin Morote
 * @license MIT
 */let Fv;const Ip=e=>Fv=e,Bv=Symbol();function hm(e){return e&&typeof e=="object"&&Object.prototype.toString.call(e)==="[object Object]"&&typeof e.toJSON!="function"}var xh;(function(e){e.direct="direct",e.patchObject="patch object",e.patchFunction="patch function"})(xh||(xh={}));function TM(){const e=B0(!0),r=e.run(()=>vs({}));let a=[],u=[];const d=vp({install(g){Ip(d),d._a=g,g.provide(Bv,d),g.config.globalProperties.$pinia=d,u.forEach(m=>a.push(m)),u=[]},use(g){return!this._a&&!EM?u.push(g):a.push(g),this},_p:a,_a:null,_e:e,_s:new Map,state:r});return d}const Nv=()=>{};function M_(e,r,a,u=Nv){e.push(r);const d=()=>{const g=e.indexOf(r);g>-1&&(e.splice(g,1),u())};return!a&&N0()&&fw(d),d}function Gc(e,...r){e.slice().forEach(a=>{a(...r)})}const CM=e=>e();function dm(e,r){e instanceof Map&&r instanceof Map&&r.forEach((a,u)=>e.set(u,a)),e instanceof Set&&r instanceof Set&&r.forEach(e.add,e);for(const a in r){if(!r.hasOwnProperty(a))continue;const u=r[a],d=e[a];hm(d)&&hm(u)&&e.hasOwnProperty(a)&&!An(u)&&!xl(u)?e[a]=dm(d,u):e[a]=u}return e}const IM=Symbol();function AM(e){return!hm(e)||!e.hasOwnProperty(IM)}const{assign:fl}=Object;function PM(e){return!!(An(e)&&e.effect)}function kM(e,r,a,u){const{state:d,actions:g,getters:m}=r,l=a.state.value[e];let M;function A(){l||(a.state.value[e]=d?d():{});const R=Nw(a.state.value[e]);return fl(R,g,Object.keys(m||{}).reduce((k,z)=>(k[z]=vp(gi(()=>{Ip(a);const W=a._s.get(e);return m[z].call(W,W)})),k),{}))}return M=$v(e,A,r,a,u,!0),M}function $v(e,r,a={},u,d,g){let m;const l=fl({actions:{}},a),M={deep:!0};let A,R,k=[],z=[],W;const Z=u.state.value[e];!g&&!Z&&(u.state.value[e]={}),vs({});let X;function fe(ft){let At;A=R=!1,typeof ft=="function"?(ft(u.state.value[e]),At={type:xh.patchFunction,storeId:e,events:W}):(dm(u.state.value[e],ft),At={type:xh.patchObject,payload:ft,storeId:e,events:W});const Ot=X=Symbol();Vm().then(()=>{X===Ot&&(A=!0)}),R=!0,Gc(k,At,u.state.value[e])}const ye=g?function(){const{state:At}=a,Ot=At?At():{};this.$patch(Lt=>{fl(Lt,Ot)})}:Nv;function we(){m.stop(),k=[],z=[],u._s.delete(e)}function ee(ft,At){return function(){Ip(u);const Ot=Array.from(arguments),Lt=[],li=[];function Ei(kt){Lt.push(kt)}function ci(kt){li.push(kt)}Gc(z,{args:Ot,name:ft,store:Ue,after:Ei,onError:ci});let xt;try{xt=At.apply(this&&this.$id===e?this:Ue,Ot)}catch(kt){throw Gc(li,kt),kt}return xt instanceof Promise?xt.then(kt=>(Gc(Lt,kt),kt)).catch(kt=>(Gc(li,kt),Promise.reject(kt))):(Gc(Lt,xt),xt)}}const Ie={_p:u,$id:e,$onAction:M_.bind(null,z),$patch:fe,$reset:ye,$subscribe(ft,At={}){const Ot=M_(k,ft,At.detached,()=>Lt()),Lt=m.run(()=>zn(()=>u.state.value[e],li=>{(At.flush==="sync"?R:A)&&ft({storeId:e,type:xh.direct,events:W},li)},fl({},M,At)));return Ot},$dispose:we},Ue=jh(Ie);u._s.set(e,Ue);const nt=(u._a&&u._a.runWithContext||CM)(()=>u._e.run(()=>(m=B0()).run(r)));for(const ft in nt){const At=nt[ft];if(An(At)&&!PM(At)||xl(At))g||(Z&&AM(At)&&(An(At)?At.value=Z[ft]:dm(At,Z[ft])),u.state.value[e][ft]=At);else if(typeof At=="function"){const Ot=ee(ft,At);nt[ft]=Ot,l.actions[ft]=At}}return fl(Ue,nt),fl(Ji(Ue),nt),Object.defineProperty(Ue,"$state",{get:()=>u.state.value[e],set:ft=>{fe(At=>{fl(At,ft)})}}),u._p.forEach(ft=>{fl(Ue,m.run(()=>ft({store:Ue,app:u._a,pinia:u,options:l})))}),Z&&g&&a.hydrate&&a.hydrate(Ue.$state,Z),A=!0,R=!0,Ue}function Lo(e,r,a){let u,d;const g=typeof r=="function";typeof e=="string"?(u=e,d=g?a:r):(d=e,u=e.id);function m(l,M){const A=M2();return l=l||(A?ga(Bv,null):null),l&&Ip(l),l=Fv,l._s.has(u)||(g?$v(u,r,d,l):kM(u,d,l)),l._s.get(u)}return m.$id=u,m}const ea=Lo("MainStore",{state:()=>({lastSearchMethod:"address",currentAddress:"",currentTopic:"Property",currentNearbyDataType:"nearby311",dataSourcesLoadedArray:[],hoveredStateId:null,selectedParcelId:null}),actions:{setCurrentAddress(e){this.currentAddress=e},setLastSearchMethod(e){this.lastSearchMethod=e},setCurrentNearbyDataType(e){this.currentNearbyDataType=e},clearDataSourcesLoadedArray(){this.dataSourcesLoadedArray=[]},addToDataSourcesLoadedArray(e){this.dataSourcesLoadedArray.push(e)}}});/*!
  * vue-router v4.3.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const Xc=typeof document<"u";function DM(e){return e.__esModule||e[Symbol.toStringTag]==="Module"}const dr=Object.assign;function Bf(e,r){const a={};for(const u in r){const d=r[u];a[u]=Ba(d)?d.map(e):e(d)}return a}const bh=()=>{},Ba=Array.isArray,Uv=/#/g,LM=/&/g,RM=/\//g,zM=/=/g,OM=/\?/g,Vv=/\+/g,FM=/%5B/g,BM=/%5D/g,jv=/%5E/g,NM=/%60/g,qv=/%7B/g,$M=/%7C/g,Gv=/%7D/g,UM=/%20/g;function Zm(e){return encodeURI(""+e).replace($M,"|").replace(FM,"[").replace(BM,"]")}function VM(e){return Zm(e).replace(qv,"{").replace(Gv,"}").replace(jv,"^")}function pm(e){return Zm(e).replace(Vv,"%2B").replace(UM,"+").replace(Uv,"%23").replace(LM,"%26").replace(NM,"`").replace(qv,"{").replace(Gv,"}").replace(jv,"^")}function jM(e){return pm(e).replace(zM,"%3D")}function qM(e){return Zm(e).replace(Uv,"%23").replace(OM,"%3F")}function GM(e){return e==null?"":qM(e).replace(RM,"%2F")}function Lh(e){try{return decodeURIComponent(""+e)}catch{}return""+e}const HM=/\/$/,WM=e=>e.replace(HM,"");function Nf(e,r,a="/"){let u,d={},g="",m="";const l=r.indexOf("#");let M=r.indexOf("?");return l<M&&l>=0&&(M=-1),M>-1&&(u=r.slice(0,M),g=r.slice(M+1,l>-1?l:r.length),d=e(g)),l>-1&&(u=u||r.slice(0,l),m=r.slice(l,r.length)),u=YM(u??r,a),{fullPath:u+(g&&"?")+g+m,path:u,query:d,hash:Lh(m)}}function ZM(e,r){const a=r.query?e(r.query):"";return r.path+(a&&"?")+a+(r.hash||"")}function S_(e,r){return!r||!e.toLowerCase().startsWith(r.toLowerCase())?e:e.slice(r.length)||"/"}function XM(e,r,a){const u=r.matched.length-1,d=a.matched.length-1;return u>-1&&u===d&&du(r.matched[u],a.matched[d])&&Hv(r.params,a.params)&&e(r.query)===e(a.query)&&r.hash===a.hash}function du(e,r){return(e.aliasOf||e)===(r.aliasOf||r)}function Hv(e,r){if(Object.keys(e).length!==Object.keys(r).length)return!1;for(const a in e)if(!KM(e[a],r[a]))return!1;return!0}function KM(e,r){return Ba(e)?E_(e,r):Ba(r)?E_(r,e):e===r}function E_(e,r){return Ba(r)?e.length===r.length&&e.every((a,u)=>a===r[u]):e.length===1&&e[0]===r}function YM(e,r){if(e.startsWith("/"))return e;if(!e)return r;const a=r.split("/"),u=e.split("/"),d=u[u.length-1];(d===".."||d===".")&&u.push("");let g=a.length-1,m,l;for(m=0;m<u.length;m++)if(l=u[m],l!==".")if(l==="..")g>1&&g--;else break;return a.slice(0,g).join("/")+"/"+u.slice(m).join("/")}var Rh;(function(e){e.pop="pop",e.push="push"})(Rh||(Rh={}));var wh;(function(e){e.back="back",e.forward="forward",e.unknown=""})(wh||(wh={}));function JM(e){if(!e)if(Xc){const r=document.querySelector("base");e=r&&r.getAttribute("href")||"/",e=e.replace(/^\w+:\/\/[^\/]+/,"")}else e="/";return e[0]!=="/"&&e[0]!=="#"&&(e="/"+e),WM(e)}const QM=/^[^#]+#/;function eS(e,r){return e.replace(QM,"#")+r}function tS(e,r){const a=document.documentElement.getBoundingClientRect(),u=e.getBoundingClientRect();return{behavior:r.behavior,left:u.left-a.left-(r.left||0),top:u.top-a.top-(r.top||0)}}const Ap=()=>({left:window.scrollX,top:window.scrollY});function iS(e){let r;if("el"in e){const a=e.el,u=typeof a=="string"&&a.startsWith("#"),d=typeof a=="string"?u?document.getElementById(a.slice(1)):document.querySelector(a):a;if(!d)return;r=tS(d,e)}else r=e;"scrollBehavior"in document.documentElement.style?window.scrollTo(r):window.scrollTo(r.left!=null?r.left:window.scrollX,r.top!=null?r.top:window.scrollY)}function T_(e,r){return(history.state?history.state.position-r:-1)+e}const fm=new Map;function rS(e,r){fm.set(e,r)}function nS(e){const r=fm.get(e);return fm.delete(e),r}let sS=()=>location.protocol+"//"+location.host;function Wv(e,r){const{pathname:a,search:u,hash:d}=r,g=e.indexOf("#");if(g>-1){let l=d.includes(e.slice(g))?e.slice(g).length:1,M=d.slice(l);return M[0]!=="/"&&(M="/"+M),S_(M,"")}return S_(a,e)+u+d}function aS(e,r,a,u){let d=[],g=[],m=null;const l=({state:z})=>{const W=Wv(e,location),Z=a.value,X=r.value;let fe=0;if(z){if(a.value=W,r.value=z,m&&m===Z){m=null;return}fe=X?z.position-X.position:0}else u(W);d.forEach(ye=>{ye(a.value,Z,{delta:fe,type:Rh.pop,direction:fe?fe>0?wh.forward:wh.back:wh.unknown})})};function M(){m=a.value}function A(z){d.push(z);const W=()=>{const Z=d.indexOf(z);Z>-1&&d.splice(Z,1)};return g.push(W),W}function R(){const{history:z}=window;z.state&&z.replaceState(dr({},z.state,{scroll:Ap()}),"")}function k(){for(const z of g)z();g=[],window.removeEventListener("popstate",l),window.removeEventListener("beforeunload",R)}return window.addEventListener("popstate",l),window.addEventListener("beforeunload",R,{passive:!0}),{pauseListeners:M,listen:A,destroy:k}}function C_(e,r,a,u=!1,d=!1){return{back:e,current:r,forward:a,replaced:u,position:window.history.length,scroll:d?Ap():null}}function oS(e){const{history:r,location:a}=window,u={value:Wv(e,a)},d={value:r.state};d.value||g(u.value,{back:null,current:u.value,forward:null,position:r.length-1,replaced:!0,scroll:null},!0);function g(M,A,R){const k=e.indexOf("#"),z=k>-1?(a.host&&document.querySelector("base")?e:e.slice(k))+M:sS()+e+M;try{r[R?"replaceState":"pushState"](A,"",z),d.value=A}catch(W){console.error(W),a[R?"replace":"assign"](z)}}function m(M,A){const R=dr({},r.state,C_(d.value.back,M,d.value.forward,!0),A,{position:d.value.position});g(M,R,!0),u.value=M}function l(M,A){const R=dr({},d.value,r.state,{forward:M,scroll:Ap()});g(R.current,R,!0);const k=dr({},C_(u.value,M,null),{position:R.position+1},A);g(M,k,!1),u.value=M}return{location:u,state:d,push:l,replace:m}}function lS(e){e=JM(e);const r=oS(e),a=aS(e,r.state,r.location,r.replace);function u(g,m=!0){m||a.pauseListeners(),history.go(g)}const d=dr({location:"",base:e,go:u,createHref:eS.bind(null,e)},r,a);return Object.defineProperty(d,"location",{enumerable:!0,get:()=>r.location.value}),Object.defineProperty(d,"state",{enumerable:!0,get:()=>r.state.value}),d}function cS(e){return e=location.host?e||location.pathname+location.search:"",e.includes("#")||(e+="#"),lS(e)}function uS(e){return typeof e=="string"||e&&typeof e=="object"}function Zv(e){return typeof e=="string"||typeof e=="symbol"}const hl={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},Xv=Symbol("");var I_;(function(e){e[e.aborted=4]="aborted",e[e.cancelled=8]="cancelled",e[e.duplicated=16]="duplicated"})(I_||(I_={}));function pu(e,r){return dr(new Error,{type:e,[Xv]:!0},r)}function Io(e,r){return e instanceof Error&&Xv in e&&(r==null||!!(e.type&r))}const A_="[^/]+?",hS={sensitive:!1,strict:!1,start:!0,end:!0},dS=/[.+*?^${}()[\]/\\]/g;function pS(e,r){const a=dr({},hS,r),u=[];let d=a.start?"^":"";const g=[];for(const A of e){const R=A.length?[]:[90];a.strict&&!A.length&&(d+="/");for(let k=0;k<A.length;k++){const z=A[k];let W=40+(a.sensitive?.25:0);if(z.type===0)k||(d+="/"),d+=z.value.replace(dS,"\\$&"),W+=40;else if(z.type===1){const{value:Z,repeatable:X,optional:fe,regexp:ye}=z;g.push({name:Z,repeatable:X,optional:fe});const we=ye||A_;if(we!==A_){W+=10;try{new RegExp(`(${we})`)}catch(Ie){throw new Error(`Invalid custom RegExp for param "${Z}" (${we}): `+Ie.message)}}let ee=X?`((?:${we})(?:/(?:${we}))*)`:`(${we})`;k||(ee=fe&&A.length<2?`(?:/${ee})`:"/"+ee),fe&&(ee+="?"),d+=ee,W+=20,fe&&(W+=-8),X&&(W+=-20),we===".*"&&(W+=-50)}R.push(W)}u.push(R)}if(a.strict&&a.end){const A=u.length-1;u[A][u[A].length-1]+=.7000000000000001}a.strict||(d+="/?"),a.end?d+="$":a.strict&&(d+="(?:/|$)");const m=new RegExp(d,a.sensitive?"":"i");function l(A){const R=A.match(m),k={};if(!R)return null;for(let z=1;z<R.length;z++){const W=R[z]||"",Z=g[z-1];k[Z.name]=W&&Z.repeatable?W.split("/"):W}return k}function M(A){let R="",k=!1;for(const z of e){(!k||!R.endsWith("/"))&&(R+="/"),k=!1;for(const W of z)if(W.type===0)R+=W.value;else if(W.type===1){const{value:Z,repeatable:X,optional:fe}=W,ye=Z in A?A[Z]:"";if(Ba(ye)&&!X)throw new Error(`Provided param "${Z}" is an array but it is not repeatable (* or + modifiers)`);const we=Ba(ye)?ye.join("/"):ye;if(!we)if(fe)z.length<2&&(R.endsWith("/")?R=R.slice(0,-1):k=!0);else throw new Error(`Missing required param "${Z}"`);R+=we}}return R||"/"}return{re:m,score:u,keys:g,parse:l,stringify:M}}function fS(e,r){let a=0;for(;a<e.length&&a<r.length;){const u=r[a]-e[a];if(u)return u;a++}return e.length<r.length?e.length===1&&e[0]===80?-1:1:e.length>r.length?r.length===1&&r[0]===80?1:-1:0}function mS(e,r){let a=0;const u=e.score,d=r.score;for(;a<u.length&&a<d.length;){const g=fS(u[a],d[a]);if(g)return g;a++}if(Math.abs(d.length-u.length)===1){if(P_(u))return 1;if(P_(d))return-1}return d.length-u.length}function P_(e){const r=e[e.length-1];return e.length>0&&r[r.length-1]<0}const gS={type:0,value:""},yS=/[a-zA-Z0-9_]/;function _S(e){if(!e)return[[]];if(e==="/")return[[gS]];if(!e.startsWith("/"))throw new Error(`Invalid path "${e}"`);function r(W){throw new Error(`ERR (${a})/"${A}": ${W}`)}let a=0,u=a;const d=[];let g;function m(){g&&d.push(g),g=[]}let l=0,M,A="",R="";function k(){A&&(a===0?g.push({type:0,value:A}):a===1||a===2||a===3?(g.length>1&&(M==="*"||M==="+")&&r(`A repeatable param (${A}) must be alone in its segment. eg: '/:ids+.`),g.push({type:1,value:A,regexp:R,repeatable:M==="*"||M==="+",optional:M==="*"||M==="?"})):r("Invalid state to consume buffer"),A="")}function z(){A+=M}for(;l<e.length;){if(M=e[l++],M==="\\"&&a!==2){u=a,a=4;continue}switch(a){case 0:M==="/"?(A&&k(),m()):M===":"?(k(),a=1):z();break;case 4:z(),a=u;break;case 1:M==="("?a=2:yS.test(M)?z():(k(),a=0,M!=="*"&&M!=="?"&&M!=="+"&&l--);break;case 2:M===")"?R[R.length-1]=="\\"?R=R.slice(0,-1)+M:a=3:R+=M;break;case 3:k(),a=0,M!=="*"&&M!=="?"&&M!=="+"&&l--,R="";break;default:r("Unknown state");break}}return a===2&&r(`Unfinished custom RegExp for param "${A}"`),k(),m(),d}function vS(e,r,a){const u=pS(_S(e.path),a),d=dr(u,{record:e,parent:r,children:[],alias:[]});return r&&!d.record.aliasOf==!r.record.aliasOf&&r.children.push(d),d}function xS(e,r){const a=[],u=new Map;r=L_({strict:!1,end:!0,sensitive:!1},r);function d(R){return u.get(R)}function g(R,k,z){const W=!z,Z=bS(R);Z.aliasOf=z&&z.record;const X=L_(r,R),fe=[Z];if("alias"in R){const ee=typeof R.alias=="string"?[R.alias]:R.alias;for(const Ie of ee)fe.push(dr({},Z,{components:z?z.record.components:Z.components,path:Ie,aliasOf:z?z.record:Z}))}let ye,we;for(const ee of fe){const{path:Ie}=ee;if(k&&Ie[0]!=="/"){const Ue=k.record.path,Xe=Ue[Ue.length-1]==="/"?"":"/";ee.path=k.record.path+(Ie&&Xe+Ie)}if(ye=vS(ee,k,X),z?z.alias.push(ye):(we=we||ye,we!==ye&&we.alias.push(ye),W&&R.name&&!D_(ye)&&m(R.name)),Z.children){const Ue=Z.children;for(let Xe=0;Xe<Ue.length;Xe++)g(Ue[Xe],ye,z&&z.children[Xe])}z=z||ye,(ye.record.components&&Object.keys(ye.record.components).length||ye.record.name||ye.record.redirect)&&M(ye)}return we?()=>{m(we)}:bh}function m(R){if(Zv(R)){const k=u.get(R);k&&(u.delete(R),a.splice(a.indexOf(k),1),k.children.forEach(m),k.alias.forEach(m))}else{const k=a.indexOf(R);k>-1&&(a.splice(k,1),R.record.name&&u.delete(R.record.name),R.children.forEach(m),R.alias.forEach(m))}}function l(){return a}function M(R){let k=0;for(;k<a.length&&mS(R,a[k])>=0&&(R.record.path!==a[k].record.path||!Kv(R,a[k]));)k++;a.splice(k,0,R),R.record.name&&!D_(R)&&u.set(R.record.name,R)}function A(R,k){let z,W={},Z,X;if("name"in R&&R.name){if(z=u.get(R.name),!z)throw pu(1,{location:R});X=z.record.name,W=dr(k_(k.params,z.keys.filter(we=>!we.optional).concat(z.parent?z.parent.keys.filter(we=>we.optional):[]).map(we=>we.name)),R.params&&k_(R.params,z.keys.map(we=>we.name))),Z=z.stringify(W)}else if(R.path!=null)Z=R.path,z=a.find(we=>we.re.test(Z)),z&&(W=z.parse(Z),X=z.record.name);else{if(z=k.name?u.get(k.name):a.find(we=>we.re.test(k.path)),!z)throw pu(1,{location:R,currentLocation:k});X=z.record.name,W=dr({},k.params,R.params),Z=z.stringify(W)}const fe=[];let ye=z;for(;ye;)fe.unshift(ye.record),ye=ye.parent;return{name:X,path:Z,params:W,matched:fe,meta:MS(fe)}}return e.forEach(R=>g(R)),{addRoute:g,resolve:A,removeRoute:m,getRoutes:l,getRecordMatcher:d}}function k_(e,r){const a={};for(const u of r)u in e&&(a[u]=e[u]);return a}function bS(e){return{path:e.path,redirect:e.redirect,name:e.name,meta:e.meta||{},aliasOf:void 0,beforeEnter:e.beforeEnter,props:wS(e),children:e.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in e?e.components||null:e.component&&{default:e.component}}}function wS(e){const r={},a=e.props||!1;if("component"in e)r.default=a;else for(const u in e.components)r[u]=typeof a=="object"?a[u]:a;return r}function D_(e){for(;e;){if(e.record.aliasOf)return!0;e=e.parent}return!1}function MS(e){return e.reduce((r,a)=>dr(r,a.meta),{})}function L_(e,r){const a={};for(const u in e)a[u]=u in r?r[u]:e[u];return a}function Kv(e,r){return r.children.some(a=>a===e||Kv(e,a))}function SS(e){const r={};if(e===""||e==="?")return r;const u=(e[0]==="?"?e.slice(1):e).split("&");for(let d=0;d<u.length;++d){const g=u[d].replace(Vv," "),m=g.indexOf("="),l=Lh(m<0?g:g.slice(0,m)),M=m<0?null:Lh(g.slice(m+1));if(l in r){let A=r[l];Ba(A)||(A=r[l]=[A]),A.push(M)}else r[l]=M}return r}function R_(e){let r="";for(let a in e){const u=e[a];if(a=jM(a),u==null){u!==void 0&&(r+=(r.length?"&":"")+a);continue}(Ba(u)?u.map(g=>g&&pm(g)):[u&&pm(u)]).forEach(g=>{g!==void 0&&(r+=(r.length?"&":"")+a,g!=null&&(r+="="+g))})}return r}function ES(e){const r={};for(const a in e){const u=e[a];u!==void 0&&(r[a]=Ba(u)?u.map(d=>d==null?null:""+d):u==null?u:""+u)}return r}const TS=Symbol(""),z_=Symbol(""),Pp=Symbol(""),Xm=Symbol(""),mm=Symbol("");function ah(){let e=[];function r(u){return e.push(u),()=>{const d=e.indexOf(u);d>-1&&e.splice(d,1)}}function a(){e=[]}return{add:r,list:()=>e.slice(),reset:a}}function _l(e,r,a,u,d,g=m=>m()){const m=u&&(u.enterCallbacks[d]=u.enterCallbacks[d]||[]);return()=>new Promise((l,M)=>{const A=z=>{z===!1?M(pu(4,{from:a,to:r})):z instanceof Error?M(z):uS(z)?M(pu(2,{from:r,to:z})):(m&&u.enterCallbacks[d]===m&&typeof z=="function"&&m.push(z),l())},R=g(()=>e.call(u&&u.instances[d],r,a,A));let k=Promise.resolve(R);e.length<3&&(k=k.then(A)),k.catch(z=>M(z))})}function $f(e,r,a,u,d=g=>g()){const g=[];for(const m of e)for(const l in m.components){let M=m.components[l];if(!(r!=="beforeRouteEnter"&&!m.instances[l]))if(CS(M)){const R=(M.__vccOpts||M)[r];R&&g.push(_l(R,a,u,m,l,d))}else{let A=M();g.push(()=>A.then(R=>{if(!R)return Promise.reject(new Error(`Couldn't resolve component "${l}" at "${m.path}"`));const k=DM(R)?R.default:R;m.components[l]=k;const W=(k.__vccOpts||k)[r];return W&&_l(W,a,u,m,l,d)()}))}}return g}function CS(e){return typeof e=="object"||"displayName"in e||"props"in e||"__vccOpts"in e}function O_(e){const r=ga(Pp),a=ga(Xm),u=gi(()=>r.resolve(zi(e.to))),d=gi(()=>{const{matched:M}=u.value,{length:A}=M,R=M[A-1],k=a.matched;if(!R||!k.length)return-1;const z=k.findIndex(du.bind(null,R));if(z>-1)return z;const W=F_(M[A-2]);return A>1&&F_(R)===W&&k[k.length-1].path!==W?k.findIndex(du.bind(null,M[A-2])):z}),g=gi(()=>d.value>-1&&PS(a.params,u.value.params)),m=gi(()=>d.value>-1&&d.value===a.matched.length-1&&Hv(a.params,u.value.params));function l(M={}){return AS(M)?r[zi(e.replace)?"replace":"push"](zi(e.to)).catch(bh):Promise.resolve()}return{route:u,href:gi(()=>u.value.href),isActive:g,isExactActive:m,navigate:l}}const IS=mv({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:O_,setup(e,{slots:r}){const a=jh(O_(e)),{options:u}=ga(Pp),d=gi(()=>({[B_(e.activeClass,u.linkActiveClass,"router-link-active")]:a.isActive,[B_(e.exactActiveClass,u.linkExactActiveClass,"router-link-exact-active")]:a.isExactActive}));return()=>{const g=r.default&&r.default(a);return e.custom?g:zv("a",{"aria-current":a.isExactActive?e.ariaCurrentValue:null,href:a.href,onClick:a.navigate,class:d.value},g)}}}),Yv=IS;function AS(e){if(!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)&&!e.defaultPrevented&&!(e.button!==void 0&&e.button!==0)){if(e.currentTarget&&e.currentTarget.getAttribute){const r=e.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(r))return}return e.preventDefault&&e.preventDefault(),!0}}function PS(e,r){for(const a in r){const u=r[a],d=e[a];if(typeof u=="string"){if(u!==d)return!1}else if(!Ba(d)||d.length!==u.length||u.some((g,m)=>g!==d[m]))return!1}return!0}function F_(e){return e?e.aliasOf?e.aliasOf.path:e.path:""}const B_=(e,r,a)=>e??r??a,kS=mv({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(e,{attrs:r,slots:a}){const u=ga(mm),d=gi(()=>e.route||u.value),g=ga(z_,0),m=gi(()=>{let A=zi(g);const{matched:R}=d.value;let k;for(;(k=R[A])&&!k.components;)A++;return A}),l=gi(()=>d.value.matched[m.value]);jd(z_,gi(()=>m.value+1)),jd(TS,l),jd(mm,d);const M=vs();return zn(()=>[M.value,l.value,e.name],([A,R,k],[z,W,Z])=>{R&&(R.instances[k]=A,W&&W!==R&&A&&A===z&&(R.leaveGuards.size||(R.leaveGuards=W.leaveGuards),R.updateGuards.size||(R.updateGuards=W.updateGuards))),A&&R&&(!W||!du(R,W)||!z)&&(R.enterCallbacks[k]||[]).forEach(X=>X(A))},{flush:"post"}),()=>{const A=d.value,R=e.name,k=l.value,z=k&&k.components[R];if(!z)return N_(a.default,{Component:z,route:A});const W=k.props[R],Z=W?W===!0?A.params:typeof W=="function"?W(A):W:null,fe=zv(z,dr({},Z,r,{onVnodeUnmounted:ye=>{ye.component.isUnmounted&&(k.instances[R]=null)},ref:M}));return N_(a.default,{Component:fe,route:A})||fe}}});function N_(e,r){if(!e)return null;const a=e(r);return a.length===1?a[0]:a}const DS=kS;function LS(e){const r=xS(e.routes,e),a=e.parseQuery||SS,u=e.stringifyQuery||R_,d=e.history,g=ah(),m=ah(),l=ah(),M=Ow(hl);let A=hl;Xc&&e.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const R=Bf.bind(null,je=>""+je),k=Bf.bind(null,GM),z=Bf.bind(null,Lh);function W(je,Tt){let ut,et;return Zv(je)?(ut=r.getRecordMatcher(je),et=Tt):et=je,r.addRoute(et,ut)}function Z(je){const Tt=r.getRecordMatcher(je);Tt&&r.removeRoute(Tt)}function X(){return r.getRoutes().map(je=>je.record)}function fe(je){return!!r.getRecordMatcher(je)}function ye(je,Tt){if(Tt=dr({},Tt||M.value),typeof je=="string"){const ue=Nf(a,je,Tt.path),De=r.resolve({path:ue.path},Tt),Fe=d.createHref(ue.fullPath);return dr(ue,De,{params:z(De.params),hash:Lh(ue.hash),redirectedFrom:void 0,href:Fe})}let ut;if(je.path!=null)ut=dr({},je,{path:Nf(a,je.path,Tt.path).path});else{const ue=dr({},je.params);for(const De in ue)ue[De]==null&&delete ue[De];ut=dr({},je,{params:k(ue)}),Tt.params=k(Tt.params)}const et=r.resolve(ut,Tt),ki=je.hash||"";et.params=R(z(et.params));const Oi=ZM(u,dr({},je,{hash:VM(ki),path:et.path})),ae=d.createHref(Oi);return dr({fullPath:Oi,hash:ki,query:u===R_?ES(je.query):je.query||{}},et,{redirectedFrom:void 0,href:ae})}function we(je){return typeof je=="string"?Nf(a,je,M.value.path):dr({},je)}function ee(je,Tt){if(A!==je)return pu(8,{from:Tt,to:je})}function Ie(je){return nt(je)}function Ue(je){return Ie(dr(we(je),{replace:!0}))}function Xe(je){const Tt=je.matched[je.matched.length-1];if(Tt&&Tt.redirect){const{redirect:ut}=Tt;let et=typeof ut=="function"?ut(je):ut;return typeof et=="string"&&(et=et.includes("?")||et.includes("#")?et=we(et):{path:et},et.params={}),dr({query:je.query,hash:je.hash,params:et.path!=null?{}:je.params},et)}}function nt(je,Tt){const ut=A=ye(je),et=M.value,ki=je.state,Oi=je.force,ae=je.replace===!0,ue=Xe(ut);if(ue)return nt(dr(we(ue),{state:typeof ue=="object"?dr({},ki,ue.state):ki,force:Oi,replace:ae}),Tt||ut);const De=ut;De.redirectedFrom=Tt;let Fe;return!Oi&&XM(u,et,ut)&&(Fe=pu(16,{to:De,from:et}),We(et,et,!0,!1)),(Fe?Promise.resolve(Fe):Ot(De,et)).catch(ce=>Io(ce)?Io(ce,2)?ce:Bi(ce):ai(ce,De,et)).then(ce=>{if(ce){if(Io(ce,2))return nt(dr({replace:ae},we(ce.to),{state:typeof ce.to=="object"?dr({},ki,ce.to.state):ki,force:Oi}),Tt||De)}else ce=li(De,et,!0,ae,ki);return Lt(De,et,ce),ce})}function ft(je,Tt){const ut=ee(je,Tt);return ut?Promise.reject(ut):Promise.resolve()}function At(je){const Tt=Xi.values().next().value;return Tt&&typeof Tt.runWithContext=="function"?Tt.runWithContext(je):je()}function Ot(je,Tt){let ut;const[et,ki,Oi]=RS(je,Tt);ut=$f(et.reverse(),"beforeRouteLeave",je,Tt);for(const ue of et)ue.leaveGuards.forEach(De=>{ut.push(_l(De,je,Tt))});const ae=ft.bind(null,je,Tt);return ut.push(ae),Mi(ut).then(()=>{ut=[];for(const ue of g.list())ut.push(_l(ue,je,Tt));return ut.push(ae),Mi(ut)}).then(()=>{ut=$f(ki,"beforeRouteUpdate",je,Tt);for(const ue of ki)ue.updateGuards.forEach(De=>{ut.push(_l(De,je,Tt))});return ut.push(ae),Mi(ut)}).then(()=>{ut=[];for(const ue of Oi)if(ue.beforeEnter)if(Ba(ue.beforeEnter))for(const De of ue.beforeEnter)ut.push(_l(De,je,Tt));else ut.push(_l(ue.beforeEnter,je,Tt));return ut.push(ae),Mi(ut)}).then(()=>(je.matched.forEach(ue=>ue.enterCallbacks={}),ut=$f(Oi,"beforeRouteEnter",je,Tt,At),ut.push(ae),Mi(ut))).then(()=>{ut=[];for(const ue of m.list())ut.push(_l(ue,je,Tt));return ut.push(ae),Mi(ut)}).catch(ue=>Io(ue,8)?ue:Promise.reject(ue))}function Lt(je,Tt,ut){l.list().forEach(et=>At(()=>et(je,Tt,ut)))}function li(je,Tt,ut,et,ki){const Oi=ee(je,Tt);if(Oi)return Oi;const ae=Tt===hl,ue=Xc?history.state:{};ut&&(et||ae?d.replace(je.fullPath,dr({scroll:ae&&ue&&ue.scroll},ki)):d.push(je.fullPath,ki)),M.value=je,We(je,Tt,ut,ae),Bi()}let Ei;function ci(){Ei||(Ei=d.listen((je,Tt,ut)=>{if(!ji.listening)return;const et=ye(je),ki=Xe(et);if(ki){nt(dr(ki,{replace:!0}),et).catch(bh);return}A=et;const Oi=M.value;Xc&&rS(T_(Oi.fullPath,ut.delta),Ap()),Ot(et,Oi).catch(ae=>Io(ae,12)?ae:Io(ae,2)?(nt(ae.to,et).then(ue=>{Io(ue,20)&&!ut.delta&&ut.type===Rh.pop&&d.go(-1,!1)}).catch(bh),Promise.reject()):(ut.delta&&d.go(-ut.delta,!1),ai(ae,et,Oi))).then(ae=>{ae=ae||li(et,Oi,!1),ae&&(ut.delta&&!Io(ae,8)?d.go(-ut.delta,!1):ut.type===Rh.pop&&Io(ae,20)&&d.go(-1,!1)),Lt(et,Oi,ae)}).catch(bh)}))}let xt=ah(),kt=ah(),$t;function ai(je,Tt,ut){Bi(je);const et=kt.list();return et.length?et.forEach(ki=>ki(je,Tt,ut)):console.error(je),Promise.reject(je)}function Zi(){return $t&&M.value!==hl?Promise.resolve():new Promise((je,Tt)=>{xt.add([je,Tt])})}function Bi(je){return $t||($t=!je,ci(),xt.list().forEach(([Tt,ut])=>je?ut(je):Tt()),xt.reset()),je}function We(je,Tt,ut,et){const{scrollBehavior:ki}=e;if(!Xc||!ki)return Promise.resolve();const Oi=!ut&&nS(T_(je.fullPath,0))||(et||!ut)&&history.state&&history.state.scroll||null;return Vm().then(()=>ki(je,Tt,Oi)).then(ae=>ae&&iS(ae)).catch(ae=>ai(ae,je,Tt))}const it=je=>d.go(je);let Qe;const Xi=new Set,ji={currentRoute:M,listening:!0,addRoute:W,removeRoute:Z,hasRoute:fe,getRoutes:X,resolve:ye,options:e,push:Ie,replace:Ue,go:it,back:()=>it(-1),forward:()=>it(1),beforeEach:g.add,beforeResolve:m.add,afterEach:l.add,onError:kt.add,isReady:Zi,install(je){const Tt=this;je.component("RouterLink",Yv),je.component("RouterView",DS),je.config.globalProperties.$router=Tt,Object.defineProperty(je.config.globalProperties,"$route",{enumerable:!0,get:()=>zi(M)}),Xc&&!Qe&&M.value===hl&&(Qe=!0,Ie(d.location).catch(ki=>{}));const ut={};for(const ki in hl)Object.defineProperty(ut,ki,{get:()=>M.value[ki],enumerable:!0});je.provide(Pp,Tt),je.provide(Xm,Y0(ut)),je.provide(mm,M);const et=je.unmount;Xi.add(je),je.unmount=function(){Xi.delete(je),Xi.size<1&&(A=hl,Ei&&Ei(),Ei=null,M.value=hl,Qe=!1,$t=!1),et()}}};function Mi(je){return je.reduce((Tt,ut)=>Tt.then(()=>At(ut)),Promise.resolve())}return ji}function RS(e,r){const a=[],u=[],d=[],g=Math.max(r.matched.length,e.matched.length);for(let m=0;m<g;m++){const l=r.matched[m];l&&(e.matched.find(A=>du(A,l))?u.push(l):a.push(l));const M=e.matched[m];M&&(r.matched.find(A=>du(A,M))||d.push(M))}return[a,u,d]}function Wh(){return ga(Pp)}function Zh(){return ga(Xm)}const Qr=Lo("AddressStore",{state:()=>({addressData:{}}),actions:{async fillAddressData(e){try{console.log("Address - fillAddressData is running, address:",e);const r=await fetch(`https://api.phila.gov/ais/v1/search/${e}?include_units=false`);if(r.ok)console.log("Address - await resolved and HTTP status is successful"),this.addressData=await r.json();else{console.log("Address - await resolved but HTTP status was not successful"),this.addressData={};const a=ea();a.currentAddress=""}}catch{console.error("Address - await never resolved, failed to fetch address data")}}},getters:{getOpaOwners:e=>e.addressData.features[0].properties.opa_owners.join(", ")}});function Jv(e,r){return function(){return e.apply(r,arguments)}}const{toString:zS}=Object.prototype,{getPrototypeOf:Km}=Object,kp=(e=>r=>{const a=zS.call(r);return e[a]||(e[a]=a.slice(8,-1).toLowerCase())})(Object.create(null)),oo=e=>(e=e.toLowerCase(),r=>kp(r)===e),Dp=e=>r=>typeof r===e,{isArray:xu}=Array,zh=Dp("undefined");function OS(e){return e!==null&&!zh(e)&&e.constructor!==null&&!zh(e.constructor)&&ya(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const Qv=oo("ArrayBuffer");function FS(e){let r;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?r=ArrayBuffer.isView(e):r=e&&e.buffer&&Qv(e.buffer),r}const BS=Dp("string"),ya=Dp("function"),ex=Dp("number"),Lp=e=>e!==null&&typeof e=="object",NS=e=>e===!0||e===!1,Wd=e=>{if(kp(e)!=="object")return!1;const r=Km(e);return(r===null||r===Object.prototype||Object.getPrototypeOf(r)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},$S=oo("Date"),US=oo("File"),VS=oo("Blob"),jS=oo("FileList"),qS=e=>Lp(e)&&ya(e.pipe),GS=e=>{let r;return e&&(typeof FormData=="function"&&e instanceof FormData||ya(e.append)&&((r=kp(e))==="formdata"||r==="object"&&ya(e.toString)&&e.toString()==="[object FormData]"))},HS=oo("URLSearchParams"),WS=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Xh(e,r,{allOwnKeys:a=!1}={}){if(e===null||typeof e>"u")return;let u,d;if(typeof e!="object"&&(e=[e]),xu(e))for(u=0,d=e.length;u<d;u++)r.call(null,e[u],u,e);else{const g=a?Object.getOwnPropertyNames(e):Object.keys(e),m=g.length;let l;for(u=0;u<m;u++)l=g[u],r.call(null,e[l],l,e)}}function tx(e,r){r=r.toLowerCase();const a=Object.keys(e);let u=a.length,d;for(;u-- >0;)if(d=a[u],r===d.toLowerCase())return d;return null}const ix=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,rx=e=>!zh(e)&&e!==ix;function gm(){const{caseless:e}=rx(this)&&this||{},r={},a=(u,d)=>{const g=e&&tx(r,d)||d;Wd(r[g])&&Wd(u)?r[g]=gm(r[g],u):Wd(u)?r[g]=gm({},u):xu(u)?r[g]=u.slice():r[g]=u};for(let u=0,d=arguments.length;u<d;u++)arguments[u]&&Xh(arguments[u],a);return r}const ZS=(e,r,a,{allOwnKeys:u}={})=>(Xh(r,(d,g)=>{a&&ya(d)?e[g]=Jv(d,a):e[g]=d},{allOwnKeys:u}),e),XS=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),KS=(e,r,a,u)=>{e.prototype=Object.create(r.prototype,u),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:r.prototype}),a&&Object.assign(e.prototype,a)},YS=(e,r,a,u)=>{let d,g,m;const l={};if(r=r||{},e==null)return r;do{for(d=Object.getOwnPropertyNames(e),g=d.length;g-- >0;)m=d[g],(!u||u(m,e,r))&&!l[m]&&(r[m]=e[m],l[m]=!0);e=a!==!1&&Km(e)}while(e&&(!a||a(e,r))&&e!==Object.prototype);return r},JS=(e,r,a)=>{e=String(e),(a===void 0||a>e.length)&&(a=e.length),a-=r.length;const u=e.indexOf(r,a);return u!==-1&&u===a},QS=e=>{if(!e)return null;if(xu(e))return e;let r=e.length;if(!ex(r))return null;const a=new Array(r);for(;r-- >0;)a[r]=e[r];return a},eE=(e=>r=>e&&r instanceof e)(typeof Uint8Array<"u"&&Km(Uint8Array)),tE=(e,r)=>{const u=(e&&e[Symbol.iterator]).call(e);let d;for(;(d=u.next())&&!d.done;){const g=d.value;r.call(e,g[0],g[1])}},iE=(e,r)=>{let a;const u=[];for(;(a=e.exec(r))!==null;)u.push(a);return u},rE=oo("HTMLFormElement"),nE=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(a,u,d){return u.toUpperCase()+d}),$_=(({hasOwnProperty:e})=>(r,a)=>e.call(r,a))(Object.prototype),sE=oo("RegExp"),nx=(e,r)=>{const a=Object.getOwnPropertyDescriptors(e),u={};Xh(a,(d,g)=>{let m;(m=r(d,g,e))!==!1&&(u[g]=m||d)}),Object.defineProperties(e,u)},aE=e=>{nx(e,(r,a)=>{if(ya(e)&&["arguments","caller","callee"].indexOf(a)!==-1)return!1;const u=e[a];if(ya(u)){if(r.enumerable=!1,"writable"in r){r.writable=!1;return}r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+a+"'")})}})},oE=(e,r)=>{const a={},u=d=>{d.forEach(g=>{a[g]=!0})};return xu(e)?u(e):u(String(e).split(r)),a},lE=()=>{},cE=(e,r)=>(e=+e,Number.isFinite(e)?e:r),Uf="abcdefghijklmnopqrstuvwxyz",U_="0123456789",sx={DIGIT:U_,ALPHA:Uf,ALPHA_DIGIT:Uf+Uf.toUpperCase()+U_},uE=(e=16,r=sx.ALPHA_DIGIT)=>{let a="";const{length:u}=r;for(;e--;)a+=r[Math.random()*u|0];return a};function hE(e){return!!(e&&ya(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])}const dE=e=>{const r=new Array(10),a=(u,d)=>{if(Lp(u)){if(r.indexOf(u)>=0)return;if(!("toJSON"in u)){r[d]=u;const g=xu(u)?[]:{};return Xh(u,(m,l)=>{const M=a(m,d+1);!zh(M)&&(g[l]=M)}),r[d]=void 0,g}}return u};return a(e,0)},pE=oo("AsyncFunction"),fE=e=>e&&(Lp(e)||ya(e))&&ya(e.then)&&ya(e.catch),Ye={isArray:xu,isArrayBuffer:Qv,isBuffer:OS,isFormData:GS,isArrayBufferView:FS,isString:BS,isNumber:ex,isBoolean:NS,isObject:Lp,isPlainObject:Wd,isUndefined:zh,isDate:$S,isFile:US,isBlob:VS,isRegExp:sE,isFunction:ya,isStream:qS,isURLSearchParams:HS,isTypedArray:eE,isFileList:jS,forEach:Xh,merge:gm,extend:ZS,trim:WS,stripBOM:XS,inherits:KS,toFlatObject:YS,kindOf:kp,kindOfTest:oo,endsWith:JS,toArray:QS,forEachEntry:tE,matchAll:iE,isHTMLForm:rE,hasOwnProperty:$_,hasOwnProp:$_,reduceDescriptors:nx,freezeMethods:aE,toObjectSet:oE,toCamelCase:nE,noop:lE,toFiniteNumber:cE,findKey:tx,global:ix,isContextDefined:rx,ALPHABET:sx,generateString:uE,isSpecCompliantForm:hE,toJSONObject:dE,isAsyncFn:pE,isThenable:fE};function Wi(e,r,a,u,d){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",r&&(this.code=r),a&&(this.config=a),u&&(this.request=u),d&&(this.response=d)}Ye.inherits(Wi,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ye.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const ax=Wi.prototype,ox={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{ox[e]={value:e}});Object.defineProperties(Wi,ox);Object.defineProperty(ax,"isAxiosError",{value:!0});Wi.from=(e,r,a,u,d,g)=>{const m=Object.create(ax);return Ye.toFlatObject(e,m,function(M){return M!==Error.prototype},l=>l!=="isAxiosError"),Wi.call(m,e.message,r,a,u,d),m.cause=e,m.name=e.name,g&&Object.assign(m,g),m};const mE=null;function ym(e){return Ye.isPlainObject(e)||Ye.isArray(e)}function lx(e){return Ye.endsWith(e,"[]")?e.slice(0,-2):e}function V_(e,r,a){return e?e.concat(r).map(function(d,g){return d=lx(d),!a&&g?"["+d+"]":d}).join(a?".":""):r}function gE(e){return Ye.isArray(e)&&!e.some(ym)}const yE=Ye.toFlatObject(Ye,{},null,function(r){return/^is[A-Z]/.test(r)});function Rp(e,r,a){if(!Ye.isObject(e))throw new TypeError("target must be an object");r=r||new FormData,a=Ye.toFlatObject(a,{metaTokens:!0,dots:!1,indexes:!1},!1,function(X,fe){return!Ye.isUndefined(fe[X])});const u=a.metaTokens,d=a.visitor||R,g=a.dots,m=a.indexes,M=(a.Blob||typeof Blob<"u"&&Blob)&&Ye.isSpecCompliantForm(r);if(!Ye.isFunction(d))throw new TypeError("visitor must be a function");function A(Z){if(Z===null)return"";if(Ye.isDate(Z))return Z.toISOString();if(!M&&Ye.isBlob(Z))throw new Wi("Blob is not supported. Use a Buffer instead.");return Ye.isArrayBuffer(Z)||Ye.isTypedArray(Z)?M&&typeof Blob=="function"?new Blob([Z]):Buffer.from(Z):Z}function R(Z,X,fe){let ye=Z;if(Z&&!fe&&typeof Z=="object"){if(Ye.endsWith(X,"{}"))X=u?X:X.slice(0,-2),Z=JSON.stringify(Z);else if(Ye.isArray(Z)&&gE(Z)||(Ye.isFileList(Z)||Ye.endsWith(X,"[]"))&&(ye=Ye.toArray(Z)))return X=lx(X),ye.forEach(function(ee,Ie){!(Ye.isUndefined(ee)||ee===null)&&r.append(m===!0?V_([X],Ie,g):m===null?X:X+"[]",A(ee))}),!1}return ym(Z)?!0:(r.append(V_(fe,X,g),A(Z)),!1)}const k=[],z=Object.assign(yE,{defaultVisitor:R,convertValue:A,isVisitable:ym});function W(Z,X){if(!Ye.isUndefined(Z)){if(k.indexOf(Z)!==-1)throw Error("Circular reference detected in "+X.join("."));k.push(Z),Ye.forEach(Z,function(ye,we){(!(Ye.isUndefined(ye)||ye===null)&&d.call(r,ye,Ye.isString(we)?we.trim():we,X,z))===!0&&W(ye,X?X.concat(we):[we])}),k.pop()}}if(!Ye.isObject(e))throw new TypeError("data must be an object");return W(e),r}function j_(e){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(u){return r[u]})}function Ym(e,r){this._pairs=[],e&&Rp(e,this,r)}const cx=Ym.prototype;cx.append=function(r,a){this._pairs.push([r,a])};cx.toString=function(r){const a=r?function(u){return r.call(this,u,j_)}:j_;return this._pairs.map(function(d){return a(d[0])+"="+a(d[1])},"").join("&")};function _E(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function ux(e,r,a){if(!r)return e;const u=a&&a.encode||_E,d=a&&a.serialize;let g;if(d?g=d(r,a):g=Ye.isURLSearchParams(r)?r.toString():new Ym(r,a).toString(u),g){const m=e.indexOf("#");m!==-1&&(e=e.slice(0,m)),e+=(e.indexOf("?")===-1?"?":"&")+g}return e}class q_{constructor(){this.handlers=[]}use(r,a,u){return this.handlers.push({fulfilled:r,rejected:a,synchronous:u?u.synchronous:!1,runWhen:u?u.runWhen:null}),this.handlers.length-1}eject(r){this.handlers[r]&&(this.handlers[r]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(r){Ye.forEach(this.handlers,function(u){u!==null&&r(u)})}}const hx={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},vE=typeof URLSearchParams<"u"?URLSearchParams:Ym,xE=typeof FormData<"u"?FormData:null,bE=typeof Blob<"u"?Blob:null,wE={isBrowser:!0,classes:{URLSearchParams:vE,FormData:xE,Blob:bE},protocols:["http","https","file","blob","url","data"]},dx=typeof window<"u"&&typeof document<"u",ME=(e=>dx&&["ReactNative","NativeScript","NS"].indexOf(e)<0)(typeof navigator<"u"&&navigator.product),SE=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",EE=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:dx,hasStandardBrowserEnv:ME,hasStandardBrowserWebWorkerEnv:SE},Symbol.toStringTag,{value:"Module"})),io={...EE,...wE};function TE(e,r){return Rp(e,new io.classes.URLSearchParams,Object.assign({visitor:function(a,u,d,g){return io.isNode&&Ye.isBuffer(a)?(this.append(u,a.toString("base64")),!1):g.defaultVisitor.apply(this,arguments)}},r))}function CE(e){return Ye.matchAll(/\w+|\[(\w*)]/g,e).map(r=>r[0]==="[]"?"":r[1]||r[0])}function IE(e){const r={},a=Object.keys(e);let u;const d=a.length;let g;for(u=0;u<d;u++)g=a[u],r[g]=e[g];return r}function px(e){function r(a,u,d,g){let m=a[g++];if(m==="__proto__")return!0;const l=Number.isFinite(+m),M=g>=a.length;return m=!m&&Ye.isArray(d)?d.length:m,M?(Ye.hasOwnProp(d,m)?d[m]=[d[m],u]:d[m]=u,!l):((!d[m]||!Ye.isObject(d[m]))&&(d[m]=[]),r(a,u,d[m],g)&&Ye.isArray(d[m])&&(d[m]=IE(d[m])),!l)}if(Ye.isFormData(e)&&Ye.isFunction(e.entries)){const a={};return Ye.forEachEntry(e,(u,d)=>{r(CE(u),d,a,0)}),a}return null}function AE(e,r,a){if(Ye.isString(e))try{return(r||JSON.parse)(e),Ye.trim(e)}catch(u){if(u.name!=="SyntaxError")throw u}return(a||JSON.stringify)(e)}const Jm={transitional:hx,adapter:["xhr","http"],transformRequest:[function(r,a){const u=a.getContentType()||"",d=u.indexOf("application/json")>-1,g=Ye.isObject(r);if(g&&Ye.isHTMLForm(r)&&(r=new FormData(r)),Ye.isFormData(r))return d?JSON.stringify(px(r)):r;if(Ye.isArrayBuffer(r)||Ye.isBuffer(r)||Ye.isStream(r)||Ye.isFile(r)||Ye.isBlob(r))return r;if(Ye.isArrayBufferView(r))return r.buffer;if(Ye.isURLSearchParams(r))return a.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),r.toString();let l;if(g){if(u.indexOf("application/x-www-form-urlencoded")>-1)return TE(r,this.formSerializer).toString();if((l=Ye.isFileList(r))||u.indexOf("multipart/form-data")>-1){const M=this.env&&this.env.FormData;return Rp(l?{"files[]":r}:r,M&&new M,this.formSerializer)}}return g||d?(a.setContentType("application/json",!1),AE(r)):r}],transformResponse:[function(r){const a=this.transitional||Jm.transitional,u=a&&a.forcedJSONParsing,d=this.responseType==="json";if(r&&Ye.isString(r)&&(u&&!this.responseType||d)){const m=!(a&&a.silentJSONParsing)&&d;try{return JSON.parse(r)}catch(l){if(m)throw l.name==="SyntaxError"?Wi.from(l,Wi.ERR_BAD_RESPONSE,this,null,this.response):l}}return r}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:io.classes.FormData,Blob:io.classes.Blob},validateStatus:function(r){return r>=200&&r<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ye.forEach(["delete","get","head","post","put","patch"],e=>{Jm.headers[e]={}});const Qm=Jm,PE=Ye.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),kE=e=>{const r={};let a,u,d;return e&&e.split(`
`).forEach(function(m){d=m.indexOf(":"),a=m.substring(0,d).trim().toLowerCase(),u=m.substring(d+1).trim(),!(!a||r[a]&&PE[a])&&(a==="set-cookie"?r[a]?r[a].push(u):r[a]=[u]:r[a]=r[a]?r[a]+", "+u:u)}),r},G_=Symbol("internals");function oh(e){return e&&String(e).trim().toLowerCase()}function Zd(e){return e===!1||e==null?e:Ye.isArray(e)?e.map(Zd):String(e)}function DE(e){const r=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let u;for(;u=a.exec(e);)r[u[1]]=u[2];return r}const LE=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function Vf(e,r,a,u,d){if(Ye.isFunction(u))return u.call(this,r,a);if(d&&(r=a),!!Ye.isString(r)){if(Ye.isString(u))return r.indexOf(u)!==-1;if(Ye.isRegExp(u))return u.test(r)}}function RE(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(r,a,u)=>a.toUpperCase()+u)}function zE(e,r){const a=Ye.toCamelCase(" "+r);["get","set","has"].forEach(u=>{Object.defineProperty(e,u+a,{value:function(d,g,m){return this[u].call(this,r,d,g,m)},configurable:!0})})}class zp{constructor(r){r&&this.set(r)}set(r,a,u){const d=this;function g(l,M,A){const R=oh(M);if(!R)throw new Error("header name must be a non-empty string");const k=Ye.findKey(d,R);(!k||d[k]===void 0||A===!0||A===void 0&&d[k]!==!1)&&(d[k||M]=Zd(l))}const m=(l,M)=>Ye.forEach(l,(A,R)=>g(A,R,M));return Ye.isPlainObject(r)||r instanceof this.constructor?m(r,a):Ye.isString(r)&&(r=r.trim())&&!LE(r)?m(kE(r),a):r!=null&&g(a,r,u),this}get(r,a){if(r=oh(r),r){const u=Ye.findKey(this,r);if(u){const d=this[u];if(!a)return d;if(a===!0)return DE(d);if(Ye.isFunction(a))return a.call(this,d,u);if(Ye.isRegExp(a))return a.exec(d);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,a){if(r=oh(r),r){const u=Ye.findKey(this,r);return!!(u&&this[u]!==void 0&&(!a||Vf(this,this[u],u,a)))}return!1}delete(r,a){const u=this;let d=!1;function g(m){if(m=oh(m),m){const l=Ye.findKey(u,m);l&&(!a||Vf(u,u[l],l,a))&&(delete u[l],d=!0)}}return Ye.isArray(r)?r.forEach(g):g(r),d}clear(r){const a=Object.keys(this);let u=a.length,d=!1;for(;u--;){const g=a[u];(!r||Vf(this,this[g],g,r,!0))&&(delete this[g],d=!0)}return d}normalize(r){const a=this,u={};return Ye.forEach(this,(d,g)=>{const m=Ye.findKey(u,g);if(m){a[m]=Zd(d),delete a[g];return}const l=r?RE(g):String(g).trim();l!==g&&delete a[g],a[l]=Zd(d),u[l]=!0}),this}concat(...r){return this.constructor.concat(this,...r)}toJSON(r){const a=Object.create(null);return Ye.forEach(this,(u,d)=>{u!=null&&u!==!1&&(a[d]=r&&Ye.isArray(u)?u.join(", "):u)}),a}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([r,a])=>r+": "+a).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r,...a){const u=new this(r);return a.forEach(d=>u.set(d)),u}static accessor(r){const u=(this[G_]=this[G_]={accessors:{}}).accessors,d=this.prototype;function g(m){const l=oh(m);u[l]||(zE(d,m),u[l]=!0)}return Ye.isArray(r)?r.forEach(g):g(r),this}}zp.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Ye.reduceDescriptors(zp.prototype,({value:e},r)=>{let a=r[0].toUpperCase()+r.slice(1);return{get:()=>e,set(u){this[a]=u}}});Ye.freezeMethods(zp);const ko=zp;function jf(e,r){const a=this||Qm,u=r||a,d=ko.from(u.headers);let g=u.data;return Ye.forEach(e,function(l){g=l.call(a,g,d.normalize(),r?r.status:void 0)}),d.normalize(),g}function fx(e){return!!(e&&e.__CANCEL__)}function Kh(e,r,a){Wi.call(this,e??"canceled",Wi.ERR_CANCELED,r,a),this.name="CanceledError"}Ye.inherits(Kh,Wi,{__CANCEL__:!0});function OE(e,r,a){const u=a.config.validateStatus;!a.status||!u||u(a.status)?e(a):r(new Wi("Request failed with status code "+a.status,[Wi.ERR_BAD_REQUEST,Wi.ERR_BAD_RESPONSE][Math.floor(a.status/100)-4],a.config,a.request,a))}const FE=io.hasStandardBrowserEnv?{write(e,r,a,u,d,g){const m=[e+"="+encodeURIComponent(r)];Ye.isNumber(a)&&m.push("expires="+new Date(a).toGMTString()),Ye.isString(u)&&m.push("path="+u),Ye.isString(d)&&m.push("domain="+d),g===!0&&m.push("secure"),document.cookie=m.join("; ")},read(e){const r=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function BE(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function NE(e,r){return r?e.replace(/\/?\/$/,"")+"/"+r.replace(/^\/+/,""):e}function mx(e,r){return e&&!BE(r)?NE(e,r):r}const $E=io.hasStandardBrowserEnv?function(){const r=/(msie|trident)/i.test(navigator.userAgent),a=document.createElement("a");let u;function d(g){let m=g;return r&&(a.setAttribute("href",m),m=a.href),a.setAttribute("href",m),{href:a.href,protocol:a.protocol?a.protocol.replace(/:$/,""):"",host:a.host,search:a.search?a.search.replace(/^\?/,""):"",hash:a.hash?a.hash.replace(/^#/,""):"",hostname:a.hostname,port:a.port,pathname:a.pathname.charAt(0)==="/"?a.pathname:"/"+a.pathname}}return u=d(window.location.href),function(m){const l=Ye.isString(m)?d(m):m;return l.protocol===u.protocol&&l.host===u.host}}():function(){return function(){return!0}}();function UE(e){const r=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return r&&r[1]||""}function VE(e,r){e=e||10;const a=new Array(e),u=new Array(e);let d=0,g=0,m;return r=r!==void 0?r:1e3,function(M){const A=Date.now(),R=u[g];m||(m=A),a[d]=M,u[d]=A;let k=g,z=0;for(;k!==d;)z+=a[k++],k=k%e;if(d=(d+1)%e,d===g&&(g=(g+1)%e),A-m<r)return;const W=R&&A-R;return W?Math.round(z*1e3/W):void 0}}function H_(e,r){let a=0;const u=VE(50,250);return d=>{const g=d.loaded,m=d.lengthComputable?d.total:void 0,l=g-a,M=u(l),A=g<=m;a=g;const R={loaded:g,total:m,progress:m?g/m:void 0,bytes:l,rate:M||void 0,estimated:M&&m&&A?(m-g)/M:void 0,event:d};R[r?"download":"upload"]=!0,e(R)}}const jE=typeof XMLHttpRequest<"u",qE=jE&&function(e){return new Promise(function(a,u){let d=e.data;const g=ko.from(e.headers).normalize();let{responseType:m,withXSRFToken:l}=e,M;function A(){e.cancelToken&&e.cancelToken.unsubscribe(M),e.signal&&e.signal.removeEventListener("abort",M)}let R;if(Ye.isFormData(d)){if(io.hasStandardBrowserEnv||io.hasStandardBrowserWebWorkerEnv)g.setContentType(!1);else if((R=g.getContentType())!==!1){const[X,...fe]=R?R.split(";").map(ye=>ye.trim()).filter(Boolean):[];g.setContentType([X||"multipart/form-data",...fe].join("; "))}}let k=new XMLHttpRequest;if(e.auth){const X=e.auth.username||"",fe=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";g.set("Authorization","Basic "+btoa(X+":"+fe))}const z=mx(e.baseURL,e.url);k.open(e.method.toUpperCase(),ux(z,e.params,e.paramsSerializer),!0),k.timeout=e.timeout;function W(){if(!k)return;const X=ko.from("getAllResponseHeaders"in k&&k.getAllResponseHeaders()),ye={data:!m||m==="text"||m==="json"?k.responseText:k.response,status:k.status,statusText:k.statusText,headers:X,config:e,request:k};OE(function(ee){a(ee),A()},function(ee){u(ee),A()},ye),k=null}if("onloadend"in k?k.onloadend=W:k.onreadystatechange=function(){!k||k.readyState!==4||k.status===0&&!(k.responseURL&&k.responseURL.indexOf("file:")===0)||setTimeout(W)},k.onabort=function(){k&&(u(new Wi("Request aborted",Wi.ECONNABORTED,e,k)),k=null)},k.onerror=function(){u(new Wi("Network Error",Wi.ERR_NETWORK,e,k)),k=null},k.ontimeout=function(){let fe=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";const ye=e.transitional||hx;e.timeoutErrorMessage&&(fe=e.timeoutErrorMessage),u(new Wi(fe,ye.clarifyTimeoutError?Wi.ETIMEDOUT:Wi.ECONNABORTED,e,k)),k=null},io.hasStandardBrowserEnv&&(l&&Ye.isFunction(l)&&(l=l(e)),l||l!==!1&&$E(z))){const X=e.xsrfHeaderName&&e.xsrfCookieName&&FE.read(e.xsrfCookieName);X&&g.set(e.xsrfHeaderName,X)}d===void 0&&g.setContentType(null),"setRequestHeader"in k&&Ye.forEach(g.toJSON(),function(fe,ye){k.setRequestHeader(ye,fe)}),Ye.isUndefined(e.withCredentials)||(k.withCredentials=!!e.withCredentials),m&&m!=="json"&&(k.responseType=e.responseType),typeof e.onDownloadProgress=="function"&&k.addEventListener("progress",H_(e.onDownloadProgress,!0)),typeof e.onUploadProgress=="function"&&k.upload&&k.upload.addEventListener("progress",H_(e.onUploadProgress)),(e.cancelToken||e.signal)&&(M=X=>{k&&(u(!X||X.type?new Kh(null,e,k):X),k.abort(),k=null)},e.cancelToken&&e.cancelToken.subscribe(M),e.signal&&(e.signal.aborted?M():e.signal.addEventListener("abort",M)));const Z=UE(z);if(Z&&io.protocols.indexOf(Z)===-1){u(new Wi("Unsupported protocol "+Z+":",Wi.ERR_BAD_REQUEST,e));return}k.send(d||null)})},_m={http:mE,xhr:qE};Ye.forEach(_m,(e,r)=>{if(e){try{Object.defineProperty(e,"name",{value:r})}catch{}Object.defineProperty(e,"adapterName",{value:r})}});const W_=e=>`- ${e}`,GE=e=>Ye.isFunction(e)||e===null||e===!1,gx={getAdapter:e=>{e=Ye.isArray(e)?e:[e];const{length:r}=e;let a,u;const d={};for(let g=0;g<r;g++){a=e[g];let m;if(u=a,!GE(a)&&(u=_m[(m=String(a)).toLowerCase()],u===void 0))throw new Wi(`Unknown adapter '${m}'`);if(u)break;d[m||"#"+g]=u}if(!u){const g=Object.entries(d).map(([l,M])=>`adapter ${l} `+(M===!1?"is not supported by the environment":"is not available in the build"));let m=r?g.length>1?`since :
`+g.map(W_).join(`
`):" "+W_(g[0]):"as no adapter specified";throw new Wi("There is no suitable adapter to dispatch the request "+m,"ERR_NOT_SUPPORT")}return u},adapters:_m};function qf(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Kh(null,e)}function Z_(e){return qf(e),e.headers=ko.from(e.headers),e.data=jf.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),gx.getAdapter(e.adapter||Qm.adapter)(e).then(function(u){return qf(e),u.data=jf.call(e,e.transformResponse,u),u.headers=ko.from(u.headers),u},function(u){return fx(u)||(qf(e),u&&u.response&&(u.response.data=jf.call(e,e.transformResponse,u.response),u.response.headers=ko.from(u.response.headers))),Promise.reject(u)})}const X_=e=>e instanceof ko?{...e}:e;function fu(e,r){r=r||{};const a={};function u(A,R,k){return Ye.isPlainObject(A)&&Ye.isPlainObject(R)?Ye.merge.call({caseless:k},A,R):Ye.isPlainObject(R)?Ye.merge({},R):Ye.isArray(R)?R.slice():R}function d(A,R,k){if(Ye.isUndefined(R)){if(!Ye.isUndefined(A))return u(void 0,A,k)}else return u(A,R,k)}function g(A,R){if(!Ye.isUndefined(R))return u(void 0,R)}function m(A,R){if(Ye.isUndefined(R)){if(!Ye.isUndefined(A))return u(void 0,A)}else return u(void 0,R)}function l(A,R,k){if(k in r)return u(A,R);if(k in e)return u(void 0,A)}const M={url:g,method:g,data:g,baseURL:m,transformRequest:m,transformResponse:m,paramsSerializer:m,timeout:m,timeoutMessage:m,withCredentials:m,withXSRFToken:m,adapter:m,responseType:m,xsrfCookieName:m,xsrfHeaderName:m,onUploadProgress:m,onDownloadProgress:m,decompress:m,maxContentLength:m,maxBodyLength:m,beforeRedirect:m,transport:m,httpAgent:m,httpsAgent:m,cancelToken:m,socketPath:m,responseEncoding:m,validateStatus:l,headers:(A,R)=>d(X_(A),X_(R),!0)};return Ye.forEach(Object.keys(Object.assign({},e,r)),function(R){const k=M[R]||d,z=k(e[R],r[R],R);Ye.isUndefined(z)&&k!==l||(a[R]=z)}),a}const yx="1.6.8",eg={};["object","boolean","number","function","string","symbol"].forEach((e,r)=>{eg[e]=function(u){return typeof u===e||"a"+(r<1?"n ":" ")+e}});const K_={};eg.transitional=function(r,a,u){function d(g,m){return"[Axios v"+yx+"] Transitional option '"+g+"'"+m+(u?". "+u:"")}return(g,m,l)=>{if(r===!1)throw new Wi(d(m," has been removed"+(a?" in "+a:"")),Wi.ERR_DEPRECATED);return a&&!K_[m]&&(K_[m]=!0,console.warn(d(m," has been deprecated since v"+a+" and will be removed in the near future"))),r?r(g,m,l):!0}};function HE(e,r,a){if(typeof e!="object")throw new Wi("options must be an object",Wi.ERR_BAD_OPTION_VALUE);const u=Object.keys(e);let d=u.length;for(;d-- >0;){const g=u[d],m=r[g];if(m){const l=e[g],M=l===void 0||m(l,g,e);if(M!==!0)throw new Wi("option "+g+" must be "+M,Wi.ERR_BAD_OPTION_VALUE);continue}if(a!==!0)throw new Wi("Unknown option "+g,Wi.ERR_BAD_OPTION)}}const vm={assertOptions:HE,validators:eg},dl=vm.validators;class op{constructor(r){this.defaults=r,this.interceptors={request:new q_,response:new q_}}async request(r,a){try{return await this._request(r,a)}catch(u){if(u instanceof Error){let d;Error.captureStackTrace?Error.captureStackTrace(d={}):d=new Error;const g=d.stack?d.stack.replace(/^.+\n/,""):"";u.stack?g&&!String(u.stack).endsWith(g.replace(/^.+\n.+\n/,""))&&(u.stack+=`
`+g):u.stack=g}throw u}}_request(r,a){typeof r=="string"?(a=a||{},a.url=r):a=r||{},a=fu(this.defaults,a);const{transitional:u,paramsSerializer:d,headers:g}=a;u!==void 0&&vm.assertOptions(u,{silentJSONParsing:dl.transitional(dl.boolean),forcedJSONParsing:dl.transitional(dl.boolean),clarifyTimeoutError:dl.transitional(dl.boolean)},!1),d!=null&&(Ye.isFunction(d)?a.paramsSerializer={serialize:d}:vm.assertOptions(d,{encode:dl.function,serialize:dl.function},!0)),a.method=(a.method||this.defaults.method||"get").toLowerCase();let m=g&&Ye.merge(g.common,g[a.method]);g&&Ye.forEach(["delete","get","head","post","put","patch","common"],Z=>{delete g[Z]}),a.headers=ko.concat(m,g);const l=[];let M=!0;this.interceptors.request.forEach(function(X){typeof X.runWhen=="function"&&X.runWhen(a)===!1||(M=M&&X.synchronous,l.unshift(X.fulfilled,X.rejected))});const A=[];this.interceptors.response.forEach(function(X){A.push(X.fulfilled,X.rejected)});let R,k=0,z;if(!M){const Z=[Z_.bind(this),void 0];for(Z.unshift.apply(Z,l),Z.push.apply(Z,A),z=Z.length,R=Promise.resolve(a);k<z;)R=R.then(Z[k++],Z[k++]);return R}z=l.length;let W=a;for(k=0;k<z;){const Z=l[k++],X=l[k++];try{W=Z(W)}catch(fe){X.call(this,fe);break}}try{R=Z_.call(this,W)}catch(Z){return Promise.reject(Z)}for(k=0,z=A.length;k<z;)R=R.then(A[k++],A[k++]);return R}getUri(r){r=fu(this.defaults,r);const a=mx(r.baseURL,r.url);return ux(a,r.params,r.paramsSerializer)}}Ye.forEach(["delete","get","head","options"],function(r){op.prototype[r]=function(a,u){return this.request(fu(u||{},{method:r,url:a,data:(u||{}).data}))}});Ye.forEach(["post","put","patch"],function(r){function a(u){return function(g,m,l){return this.request(fu(l||{},{method:r,headers:u?{"Content-Type":"multipart/form-data"}:{},url:g,data:m}))}}op.prototype[r]=a(),op.prototype[r+"Form"]=a(!0)});const Xd=op;class tg{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let a;this.promise=new Promise(function(g){a=g});const u=this;this.promise.then(d=>{if(!u._listeners)return;let g=u._listeners.length;for(;g-- >0;)u._listeners[g](d);u._listeners=null}),this.promise.then=d=>{let g;const m=new Promise(l=>{u.subscribe(l),g=l}).then(d);return m.cancel=function(){u.unsubscribe(g)},m},r(function(g,m,l){u.reason||(u.reason=new Kh(g,m,l),a(u.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){if(this.reason){r(this.reason);return}this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const a=this._listeners.indexOf(r);a!==-1&&this._listeners.splice(a,1)}static source(){let r;return{token:new tg(function(d){r=d}),cancel:r}}}const WE=tg;function ZE(e){return function(a){return e.apply(null,a)}}function XE(e){return Ye.isObject(e)&&e.isAxiosError===!0}const xm={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(xm).forEach(([e,r])=>{xm[r]=e});const KE=xm;function _x(e){const r=new Xd(e),a=Jv(Xd.prototype.request,r);return Ye.extend(a,Xd.prototype,r,{allOwnKeys:!0}),Ye.extend(a,r,null,{allOwnKeys:!0}),a.create=function(d){return _x(fu(e,d))},a}const ar=_x(Qm);ar.Axios=Xd;ar.CanceledError=Kh;ar.CancelToken=WE;ar.isCancel=fx;ar.VERSION=yx;ar.toFormData=Rp;ar.AxiosError=Wi;ar.Cancel=ar.CanceledError;ar.all=function(r){return Promise.all(r)};ar.spread=ZE;ar.isAxiosError=XE;ar.mergeConfig=fu;ar.AxiosHeaders=ko;ar.formToJSON=e=>px(Ye.isHTMLForm(e)?new FormData(e):e);ar.getAdapter=gx.getAdapter;ar.HttpStatusCode=KE;ar.default=ar;const Op=Lo("CondosStore",{state:()=>({condosData:{}}),actions:{async fillCondoData(e){const a=Qr().addressData.features;if(!a)return;const u=a[0];let d={include_units:!0,opa_only:!0,page:1};const g=await ar(`//api.phila.gov/ais/v1/search/${e}`,{params:d});if(g.data.features.length>0){let m=[];for(let l of g.data.features)l.properties.address_low_frac!==u.properties.address_low_frac||l.properties.street_address===u.properties.street_address?g.data.total_size=g.data.total_size-1:m.push(l);this.condosData=m}}}});function vx(){return{routeApp:r=>{const a=ea();a.currentAddress&&a.currentTopic=="Nearby Activity"?r.push({name:"address-topic-and-data",params:{address:a.currentAddress,topic:"Nearby Activity",data:a.currentNearbyDataType}}):a.currentAddress&&a.currentTopic?r.push({name:"address-and-topic",params:{address:a.currentAddress,topic:a.currentTopic}}):a.currentAddress&&r.push({name:"address",params:{address:a.currentAddress}})}}}const Fs=(e,r)=>{const a=e.__vccOpts||e;for(const[u,d]of r)a[u]=d;return a},YE={class:"topic-name has-text-left"},JE={key:0,class:"topic-loading has-text-right"},QE={key:0},eT={class:"inside-topic"},tT={__name:"Topic",props:{topicName:String,loading:Boolean},setup(e){const r=ea(),a=e,u=Zh(),d=Wh(),{routeApp:g}=vx(),m=gi(()=>u.params.topic==a.topicName),l=()=>{a.topicName==u.params.topic?r.currentTopic="":r.currentTopic=a.topicName,console.log("topic clicked:",a.topicName),g(d)};return(M,A)=>(wt(),Ft("section",null,[J("div",{class:"topic",onClick:l},[J("span",YE,Ht(e.topicName),1),m.value&&e.loading?(wt(),Ft("span",JE,"Loading...")):Gi("",!0)]),m.value?(wt(),Ft("div",QE,[J("div",eT,[f2(M.$slots,"default",{},void 0,!0)])])):Gi("",!0)]))}},ic=Fs(tT,[["__scopeId","data-v-ac8be1cb"]]);var Kc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ig(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var bm={exports:{}};/*!
 * accounting.js v0.4.1
 * Copyright 2014 Open Exchange Rates
 *
 * Freely distributable under the MIT license.
 * Portions of accounting.js are inspired or borrowed from underscore.js
 *
 * Full details and documentation:
 * http://openexchangerates.github.io/accounting.js/
 */(function(e,r){(function(a,u){var d={};d.version="0.4.1",d.settings={currency:{symbol:"$",format:"%s%v",decimal:".",thousand:",",precision:2,grouping:3},number:{precision:0,grouping:3,thousand:",",decimal:"."}};var g=Array.prototype.map,m=Array.isArray,l=Object.prototype.toString;function M(ee){return!!(ee===""||ee&&ee.charCodeAt&&ee.substr)}function A(ee){return m?m(ee):l.call(ee)==="[object Array]"}function R(ee){return ee&&l.call(ee)==="[object Object]"}function k(ee,Ie){var Ue;ee=ee||{},Ie=Ie||{};for(Ue in Ie)Ie.hasOwnProperty(Ue)&&ee[Ue]==null&&(ee[Ue]=Ie[Ue]);return ee}function z(ee,Ie,Ue){var Xe=[],nt,ft;if(!ee)return Xe;if(g&&ee.map===g)return ee.map(Ie,Ue);for(nt=0,ft=ee.length;nt<ft;nt++)Xe[nt]=Ie.call(Ue,ee[nt],nt,ee);return Xe}function W(ee,Ie){return ee=Math.round(Math.abs(ee)),isNaN(ee)?Ie:ee}function Z(ee){var Ie=d.settings.currency.format;return typeof ee=="function"&&(ee=ee()),M(ee)&&ee.match("%v")?{pos:ee,neg:ee.replace("-","").replace("%v","-%v"),zero:ee}:!ee||!ee.pos||!ee.pos.match("%v")?M(Ie)?d.settings.currency.format={pos:Ie,neg:Ie.replace("%v","-%v"),zero:Ie}:Ie:ee}var X=d.unformat=d.parse=function(ee,Ie){if(A(ee))return z(ee,function(nt){return X(nt,Ie)});if(ee=ee||0,typeof ee=="number")return ee;Ie=Ie||d.settings.number.decimal;var Ue=new RegExp("[^0-9-"+Ie+"]",["g"]),Xe=parseFloat((""+ee).replace(/\((.*)\)/,"-$1").replace(Ue,"").replace(Ie,"."));return isNaN(Xe)?0:Xe},fe=d.toFixed=function(ee,Ie){Ie=W(Ie,d.settings.number.precision);var Ue=Math.pow(10,Ie);return(Math.round(d.unformat(ee)*Ue)/Ue).toFixed(Ie)},ye=d.formatNumber=d.format=function(ee,Ie,Ue,Xe){if(A(ee))return z(ee,function(li){return ye(li,Ie,Ue,Xe)});ee=X(ee);var nt=k(R(Ie)?Ie:{precision:Ie,thousand:Ue,decimal:Xe},d.settings.number),ft=W(nt.precision),At=ee<0?"-":"",Ot=parseInt(fe(Math.abs(ee||0),ft),10)+"",Lt=Ot.length>3?Ot.length%3:0;return At+(Lt?Ot.substr(0,Lt)+nt.thousand:"")+Ot.substr(Lt).replace(/(\d{3})(?=\d)/g,"$1"+nt.thousand)+(ft?nt.decimal+fe(Math.abs(ee),ft).split(".")[1]:"")},we=d.formatMoney=function(ee,Ie,Ue,Xe,nt,ft){if(A(ee))return z(ee,function(li){return we(li,Ie,Ue,Xe,nt,ft)});ee=X(ee);var At=k(R(Ie)?Ie:{symbol:Ie,precision:Ue,thousand:Xe,decimal:nt,format:ft},d.settings.currency),Ot=Z(At.format),Lt=ee>0?Ot.pos:ee<0?Ot.neg:Ot.zero;return Lt.replace("%s",At.symbol).replace("%v",ye(Math.abs(ee),W(At.precision),At.thousand,At.decimal))};d.formatColumn=function(ee,Ie,Ue,Xe,nt,ft){if(!ee)return[];var At=k(R(Ie)?Ie:{symbol:Ie,precision:Ue,thousand:Xe,decimal:nt,format:ft},d.settings.currency),Ot=Z(At.format),Lt=Ot.pos.indexOf("%s")<Ot.pos.indexOf("%v"),li=0,Ei=z(ee,function(ci,xt){if(A(ci))return d.formatColumn(ci,At);ci=X(ci);var kt=ci>0?Ot.pos:ci<0?Ot.neg:Ot.zero,$t=kt.replace("%s",At.symbol).replace("%v",ye(Math.abs(ci),W(At.precision),At.thousand,At.decimal));return $t.length>li&&(li=$t.length),$t});return z(Ei,function(ci,xt){return M(ci)&&ci.length<li?Lt?ci.replace(At.symbol,At.symbol+new Array(li-ci.length+1).join(" ")):new Array(li-ci.length+1).join(" ")+ci:ci})},e.exports&&(r=e.exports=d),r.accounting=d})()})(bm,bm.exports);var iT=bm.exports;const xx=ig(iT);function Bs(e){const r=Object.prototype.toString.call(e);return e instanceof Date||typeof e=="object"&&r==="[object Date]"?new e.constructor(+e):typeof e=="number"||r==="[object Number]"||typeof e=="string"||r==="[object String]"?new Date(e):new Date(NaN)}function Na(e,r){return e instanceof Date?new e.constructor(r):new Date(r)}function bx(e,r){const a=Bs(e);return isNaN(r)?Na(e,NaN):(r&&a.setDate(a.getDate()+r),a)}function wx(e,r){const a=Bs(e);if(isNaN(r))return Na(e,NaN);if(!r)return a;const u=a.getDate(),d=Na(e,a.getTime());d.setMonth(a.getMonth()+r+1,0);const g=d.getDate();return u>=g?d:(a.setFullYear(d.getFullYear(),d.getMonth(),u),a)}function rT(e,r){const a=+Bs(e);return Na(e,a+r)}const Mx=6048e5,nT=864e5,Sx=6e4,rg=36e5;function sT(e,r){return rT(e,r*rg)}let aT={};function Fp(){return aT}function Oh(e,r){var l,M,A,R;const a=Fp(),u=(r==null?void 0:r.weekStartsOn)??((M=(l=r==null?void 0:r.locale)==null?void 0:l.options)==null?void 0:M.weekStartsOn)??a.weekStartsOn??((R=(A=a.locale)==null?void 0:A.options)==null?void 0:R.weekStartsOn)??0,d=Bs(e),g=d.getDay(),m=(g<u?7:0)+g-u;return d.setDate(d.getDate()-m),d.setHours(0,0,0,0),d}function lp(e){return Oh(e,{weekStartsOn:1})}function Ex(e){const r=Bs(e),a=r.getFullYear(),u=Na(e,0);u.setFullYear(a+1,0,4),u.setHours(0,0,0,0);const d=lp(u),g=Na(e,0);g.setFullYear(a,0,4),g.setHours(0,0,0,0);const m=lp(g);return r.getTime()>=d.getTime()?a+1:r.getTime()>=m.getTime()?a:a-1}function Y_(e){const r=Bs(e);return r.setHours(0,0,0,0),r}function J_(e){const r=Bs(e),a=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return a.setUTCFullYear(r.getFullYear()),+e-+a}function oT(e,r){const a=Y_(e),u=Y_(r),d=+a-J_(a),g=+u-J_(u);return Math.round((d-g)/nT)}function lT(e){const r=Ex(e),a=Na(e,0);return a.setFullYear(r,0,4),a.setHours(0,0,0,0),lp(a)}function cT(e,r){const a=r*7;return bx(e,a)}function uT(e,r){return wx(e,r*12)}function hT(e){return e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}function dT(e){if(!hT(e)&&typeof e!="number")return!1;const r=Bs(e);return!isNaN(Number(r))}function pT(e){const r=Bs(e),a=Na(e,0);return a.setFullYear(r.getFullYear(),0,1),a.setHours(0,0,0,0),a}const fT={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},mT=(e,r,a)=>{let u;const d=fT[e];return typeof d=="string"?u=d:r===1?u=d.one:u=d.other.replace("{{count}}",r.toString()),a!=null&&a.addSuffix?a.comparison&&a.comparison>0?"in "+u:u+" ago":u};function Gf(e){return(r={})=>{const a=r.width?String(r.width):e.defaultWidth;return e.formats[a]||e.formats[e.defaultWidth]}}const gT={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},yT={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},_T={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},vT={date:Gf({formats:gT,defaultWidth:"full"}),time:Gf({formats:yT,defaultWidth:"full"}),dateTime:Gf({formats:_T,defaultWidth:"full"})},xT={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},bT=(e,r,a,u)=>xT[e];function lh(e){return(r,a)=>{const u=a!=null&&a.context?String(a.context):"standalone";let d;if(u==="formatting"&&e.formattingValues){const m=e.defaultFormattingWidth||e.defaultWidth,l=a!=null&&a.width?String(a.width):m;d=e.formattingValues[l]||e.formattingValues[m]}else{const m=e.defaultWidth,l=a!=null&&a.width?String(a.width):e.defaultWidth;d=e.values[l]||e.values[m]}const g=e.argumentCallback?e.argumentCallback(r):r;return d[g]}}const wT={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},MT={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},ST={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},ET={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},TT={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},CT={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},IT=(e,r)=>{const a=Number(e),u=a%100;if(u>20||u<10)switch(u%10){case 1:return a+"st";case 2:return a+"nd";case 3:return a+"rd"}return a+"th"},AT={ordinalNumber:IT,era:lh({values:wT,defaultWidth:"wide"}),quarter:lh({values:MT,defaultWidth:"wide",argumentCallback:e=>e-1}),month:lh({values:ST,defaultWidth:"wide"}),day:lh({values:ET,defaultWidth:"wide"}),dayPeriod:lh({values:TT,defaultWidth:"wide",formattingValues:CT,defaultFormattingWidth:"wide"})};function ch(e){return(r,a={})=>{const u=a.width,d=u&&e.matchPatterns[u]||e.matchPatterns[e.defaultMatchWidth],g=r.match(d);if(!g)return null;const m=g[0],l=u&&e.parsePatterns[u]||e.parsePatterns[e.defaultParseWidth],M=Array.isArray(l)?kT(l,k=>k.test(m)):PT(l,k=>k.test(m));let A;A=e.valueCallback?e.valueCallback(M):M,A=a.valueCallback?a.valueCallback(A):A;const R=r.slice(m.length);return{value:A,rest:R}}}function PT(e,r){for(const a in e)if(Object.prototype.hasOwnProperty.call(e,a)&&r(e[a]))return a}function kT(e,r){for(let a=0;a<e.length;a++)if(r(e[a]))return a}function DT(e){return(r,a={})=>{const u=r.match(e.matchPattern);if(!u)return null;const d=u[0],g=r.match(e.parsePattern);if(!g)return null;let m=e.valueCallback?e.valueCallback(g[0]):g[0];m=a.valueCallback?a.valueCallback(m):m;const l=r.slice(d.length);return{value:m,rest:l}}}const LT=/^(\d+)(th|st|nd|rd)?/i,RT=/\d+/i,zT={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},OT={any:[/^b/i,/^(a|c)/i]},FT={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},BT={any:[/1/i,/2/i,/3/i,/4/i]},NT={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},$T={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},UT={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},VT={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},jT={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},qT={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},GT={ordinalNumber:DT({matchPattern:LT,parsePattern:RT,valueCallback:e=>parseInt(e,10)}),era:ch({matchPatterns:zT,defaultMatchWidth:"wide",parsePatterns:OT,defaultParseWidth:"any"}),quarter:ch({matchPatterns:FT,defaultMatchWidth:"wide",parsePatterns:BT,defaultParseWidth:"any",valueCallback:e=>e+1}),month:ch({matchPatterns:NT,defaultMatchWidth:"wide",parsePatterns:$T,defaultParseWidth:"any"}),day:ch({matchPatterns:UT,defaultMatchWidth:"wide",parsePatterns:VT,defaultParseWidth:"any"}),dayPeriod:ch({matchPatterns:jT,defaultMatchWidth:"any",parsePatterns:qT,defaultParseWidth:"any"})},HT={code:"en-US",formatDistance:mT,formatLong:vT,formatRelative:bT,localize:AT,match:GT,options:{weekStartsOn:0,firstWeekContainsDate:1}};function WT(e){const r=Bs(e);return oT(r,pT(r))+1}function ZT(e){const r=Bs(e),a=+lp(r)-+lT(r);return Math.round(a/Mx)+1}function Tx(e,r){var R,k,z,W;const a=Bs(e),u=a.getFullYear(),d=Fp(),g=(r==null?void 0:r.firstWeekContainsDate)??((k=(R=r==null?void 0:r.locale)==null?void 0:R.options)==null?void 0:k.firstWeekContainsDate)??d.firstWeekContainsDate??((W=(z=d.locale)==null?void 0:z.options)==null?void 0:W.firstWeekContainsDate)??1,m=Na(e,0);m.setFullYear(u+1,0,g),m.setHours(0,0,0,0);const l=Oh(m,r),M=Na(e,0);M.setFullYear(u,0,g),M.setHours(0,0,0,0);const A=Oh(M,r);return a.getTime()>=l.getTime()?u+1:a.getTime()>=A.getTime()?u:u-1}function XT(e,r){var l,M,A,R;const a=Fp(),u=(r==null?void 0:r.firstWeekContainsDate)??((M=(l=r==null?void 0:r.locale)==null?void 0:l.options)==null?void 0:M.firstWeekContainsDate)??a.firstWeekContainsDate??((R=(A=a.locale)==null?void 0:A.options)==null?void 0:R.firstWeekContainsDate)??1,d=Tx(e,r),g=Na(e,0);return g.setFullYear(d,0,u),g.setHours(0,0,0,0),Oh(g,r)}function KT(e,r){const a=Bs(e),u=+Oh(a,r)-+XT(a,r);return Math.round(u/Mx)+1}function hr(e,r){const a=e<0?"-":"",u=Math.abs(e).toString().padStart(r,"0");return a+u}const pl={y(e,r){const a=e.getFullYear(),u=a>0?a:1-a;return hr(r==="yy"?u%100:u,r.length)},M(e,r){const a=e.getMonth();return r==="M"?String(a+1):hr(a+1,2)},d(e,r){return hr(e.getDate(),r.length)},a(e,r){const a=e.getHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return a.toUpperCase();case"aaa":return a;case"aaaaa":return a[0];case"aaaa":default:return a==="am"?"a.m.":"p.m."}},h(e,r){return hr(e.getHours()%12||12,r.length)},H(e,r){return hr(e.getHours(),r.length)},m(e,r){return hr(e.getMinutes(),r.length)},s(e,r){return hr(e.getSeconds(),r.length)},S(e,r){const a=r.length,u=e.getMilliseconds(),d=Math.trunc(u*Math.pow(10,a-3));return hr(d,r.length)}},Hc={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Q_={G:function(e,r,a){const u=e.getFullYear()>0?1:0;switch(r){case"G":case"GG":case"GGG":return a.era(u,{width:"abbreviated"});case"GGGGG":return a.era(u,{width:"narrow"});case"GGGG":default:return a.era(u,{width:"wide"})}},y:function(e,r,a){if(r==="yo"){const u=e.getFullYear(),d=u>0?u:1-u;return a.ordinalNumber(d,{unit:"year"})}return pl.y(e,r)},Y:function(e,r,a,u){const d=Tx(e,u),g=d>0?d:1-d;if(r==="YY"){const m=g%100;return hr(m,2)}return r==="Yo"?a.ordinalNumber(g,{unit:"year"}):hr(g,r.length)},R:function(e,r){const a=Ex(e);return hr(a,r.length)},u:function(e,r){const a=e.getFullYear();return hr(a,r.length)},Q:function(e,r,a){const u=Math.ceil((e.getMonth()+1)/3);switch(r){case"Q":return String(u);case"QQ":return hr(u,2);case"Qo":return a.ordinalNumber(u,{unit:"quarter"});case"QQQ":return a.quarter(u,{width:"abbreviated",context:"formatting"});case"QQQQQ":return a.quarter(u,{width:"narrow",context:"formatting"});case"QQQQ":default:return a.quarter(u,{width:"wide",context:"formatting"})}},q:function(e,r,a){const u=Math.ceil((e.getMonth()+1)/3);switch(r){case"q":return String(u);case"qq":return hr(u,2);case"qo":return a.ordinalNumber(u,{unit:"quarter"});case"qqq":return a.quarter(u,{width:"abbreviated",context:"standalone"});case"qqqqq":return a.quarter(u,{width:"narrow",context:"standalone"});case"qqqq":default:return a.quarter(u,{width:"wide",context:"standalone"})}},M:function(e,r,a){const u=e.getMonth();switch(r){case"M":case"MM":return pl.M(e,r);case"Mo":return a.ordinalNumber(u+1,{unit:"month"});case"MMM":return a.month(u,{width:"abbreviated",context:"formatting"});case"MMMMM":return a.month(u,{width:"narrow",context:"formatting"});case"MMMM":default:return a.month(u,{width:"wide",context:"formatting"})}},L:function(e,r,a){const u=e.getMonth();switch(r){case"L":return String(u+1);case"LL":return hr(u+1,2);case"Lo":return a.ordinalNumber(u+1,{unit:"month"});case"LLL":return a.month(u,{width:"abbreviated",context:"standalone"});case"LLLLL":return a.month(u,{width:"narrow",context:"standalone"});case"LLLL":default:return a.month(u,{width:"wide",context:"standalone"})}},w:function(e,r,a,u){const d=KT(e,u);return r==="wo"?a.ordinalNumber(d,{unit:"week"}):hr(d,r.length)},I:function(e,r,a){const u=ZT(e);return r==="Io"?a.ordinalNumber(u,{unit:"week"}):hr(u,r.length)},d:function(e,r,a){return r==="do"?a.ordinalNumber(e.getDate(),{unit:"date"}):pl.d(e,r)},D:function(e,r,a){const u=WT(e);return r==="Do"?a.ordinalNumber(u,{unit:"dayOfYear"}):hr(u,r.length)},E:function(e,r,a){const u=e.getDay();switch(r){case"E":case"EE":case"EEE":return a.day(u,{width:"abbreviated",context:"formatting"});case"EEEEE":return a.day(u,{width:"narrow",context:"formatting"});case"EEEEEE":return a.day(u,{width:"short",context:"formatting"});case"EEEE":default:return a.day(u,{width:"wide",context:"formatting"})}},e:function(e,r,a,u){const d=e.getDay(),g=(d-u.weekStartsOn+8)%7||7;switch(r){case"e":return String(g);case"ee":return hr(g,2);case"eo":return a.ordinalNumber(g,{unit:"day"});case"eee":return a.day(d,{width:"abbreviated",context:"formatting"});case"eeeee":return a.day(d,{width:"narrow",context:"formatting"});case"eeeeee":return a.day(d,{width:"short",context:"formatting"});case"eeee":default:return a.day(d,{width:"wide",context:"formatting"})}},c:function(e,r,a,u){const d=e.getDay(),g=(d-u.weekStartsOn+8)%7||7;switch(r){case"c":return String(g);case"cc":return hr(g,r.length);case"co":return a.ordinalNumber(g,{unit:"day"});case"ccc":return a.day(d,{width:"abbreviated",context:"standalone"});case"ccccc":return a.day(d,{width:"narrow",context:"standalone"});case"cccccc":return a.day(d,{width:"short",context:"standalone"});case"cccc":default:return a.day(d,{width:"wide",context:"standalone"})}},i:function(e,r,a){const u=e.getDay(),d=u===0?7:u;switch(r){case"i":return String(d);case"ii":return hr(d,r.length);case"io":return a.ordinalNumber(d,{unit:"day"});case"iii":return a.day(u,{width:"abbreviated",context:"formatting"});case"iiiii":return a.day(u,{width:"narrow",context:"formatting"});case"iiiiii":return a.day(u,{width:"short",context:"formatting"});case"iiii":default:return a.day(u,{width:"wide",context:"formatting"})}},a:function(e,r,a){const d=e.getHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return a.dayPeriod(d,{width:"abbreviated",context:"formatting"});case"aaa":return a.dayPeriod(d,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return a.dayPeriod(d,{width:"narrow",context:"formatting"});case"aaaa":default:return a.dayPeriod(d,{width:"wide",context:"formatting"})}},b:function(e,r,a){const u=e.getHours();let d;switch(u===12?d=Hc.noon:u===0?d=Hc.midnight:d=u/12>=1?"pm":"am",r){case"b":case"bb":return a.dayPeriod(d,{width:"abbreviated",context:"formatting"});case"bbb":return a.dayPeriod(d,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return a.dayPeriod(d,{width:"narrow",context:"formatting"});case"bbbb":default:return a.dayPeriod(d,{width:"wide",context:"formatting"})}},B:function(e,r,a){const u=e.getHours();let d;switch(u>=17?d=Hc.evening:u>=12?d=Hc.afternoon:u>=4?d=Hc.morning:d=Hc.night,r){case"B":case"BB":case"BBB":return a.dayPeriod(d,{width:"abbreviated",context:"formatting"});case"BBBBB":return a.dayPeriod(d,{width:"narrow",context:"formatting"});case"BBBB":default:return a.dayPeriod(d,{width:"wide",context:"formatting"})}},h:function(e,r,a){if(r==="ho"){let u=e.getHours()%12;return u===0&&(u=12),a.ordinalNumber(u,{unit:"hour"})}return pl.h(e,r)},H:function(e,r,a){return r==="Ho"?a.ordinalNumber(e.getHours(),{unit:"hour"}):pl.H(e,r)},K:function(e,r,a){const u=e.getHours()%12;return r==="Ko"?a.ordinalNumber(u,{unit:"hour"}):hr(u,r.length)},k:function(e,r,a){let u=e.getHours();return u===0&&(u=24),r==="ko"?a.ordinalNumber(u,{unit:"hour"}):hr(u,r.length)},m:function(e,r,a){return r==="mo"?a.ordinalNumber(e.getMinutes(),{unit:"minute"}):pl.m(e,r)},s:function(e,r,a){return r==="so"?a.ordinalNumber(e.getSeconds(),{unit:"second"}):pl.s(e,r)},S:function(e,r){return pl.S(e,r)},X:function(e,r,a){const u=e.getTimezoneOffset();if(u===0)return"Z";switch(r){case"X":return t0(u);case"XXXX":case"XX":return rc(u);case"XXXXX":case"XXX":default:return rc(u,":")}},x:function(e,r,a){const u=e.getTimezoneOffset();switch(r){case"x":return t0(u);case"xxxx":case"xx":return rc(u);case"xxxxx":case"xxx":default:return rc(u,":")}},O:function(e,r,a){const u=e.getTimezoneOffset();switch(r){case"O":case"OO":case"OOO":return"GMT"+e0(u,":");case"OOOO":default:return"GMT"+rc(u,":")}},z:function(e,r,a){const u=e.getTimezoneOffset();switch(r){case"z":case"zz":case"zzz":return"GMT"+e0(u,":");case"zzzz":default:return"GMT"+rc(u,":")}},t:function(e,r,a){const u=Math.trunc(e.getTime()/1e3);return hr(u,r.length)},T:function(e,r,a){const u=e.getTime();return hr(u,r.length)}};function e0(e,r=""){const a=e>0?"-":"+",u=Math.abs(e),d=Math.trunc(u/60),g=u%60;return g===0?a+String(d):a+String(d)+r+hr(g,2)}function t0(e,r){return e%60===0?(e>0?"-":"+")+hr(Math.abs(e)/60,2):rc(e,r)}function rc(e,r=""){const a=e>0?"-":"+",u=Math.abs(e),d=hr(Math.trunc(u/60),2),g=hr(u%60,2);return a+d+r+g}const i0=(e,r)=>{switch(e){case"P":return r.date({width:"short"});case"PP":return r.date({width:"medium"});case"PPP":return r.date({width:"long"});case"PPPP":default:return r.date({width:"full"})}},Cx=(e,r)=>{switch(e){case"p":return r.time({width:"short"});case"pp":return r.time({width:"medium"});case"ppp":return r.time({width:"long"});case"pppp":default:return r.time({width:"full"})}},YT=(e,r)=>{const a=e.match(/(P+)(p+)?/)||[],u=a[1],d=a[2];if(!d)return i0(e,r);let g;switch(u){case"P":g=r.dateTime({width:"short"});break;case"PP":g=r.dateTime({width:"medium"});break;case"PPP":g=r.dateTime({width:"long"});break;case"PPPP":default:g=r.dateTime({width:"full"});break}return g.replace("{{date}}",i0(u,r)).replace("{{time}}",Cx(d,r))},JT={p:Cx,P:YT},QT=/^D+$/,eC=/^Y+$/,tC=["D","DD","YY","YYYY"];function iC(e){return QT.test(e)}function rC(e){return eC.test(e)}function nC(e,r,a){const u=sC(e,r,a);if(console.warn(u),tC.includes(e))throw new RangeError(u)}function sC(e,r,a){const u=e[0]==="Y"?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${r}\`) for formatting ${u} to the input \`${a}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const aC=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,oC=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,lC=/^'([^]*?)'?$/,cC=/''/g,uC=/[a-zA-Z]/;function wm(e,r,a){var R,k,z,W,Z,X,fe,ye;const u=Fp(),d=(a==null?void 0:a.locale)??u.locale??HT,g=(a==null?void 0:a.firstWeekContainsDate)??((k=(R=a==null?void 0:a.locale)==null?void 0:R.options)==null?void 0:k.firstWeekContainsDate)??u.firstWeekContainsDate??((W=(z=u.locale)==null?void 0:z.options)==null?void 0:W.firstWeekContainsDate)??1,m=(a==null?void 0:a.weekStartsOn)??((X=(Z=a==null?void 0:a.locale)==null?void 0:Z.options)==null?void 0:X.weekStartsOn)??u.weekStartsOn??((ye=(fe=u.locale)==null?void 0:fe.options)==null?void 0:ye.weekStartsOn)??0,l=Bs(e);if(!dT(l))throw new RangeError("Invalid time value");let M=r.match(oC).map(we=>{const ee=we[0];if(ee==="p"||ee==="P"){const Ie=JT[ee];return Ie(we,d.formatLong)}return we}).join("").match(aC).map(we=>{if(we==="''")return{isToken:!1,value:"'"};const ee=we[0];if(ee==="'")return{isToken:!1,value:hC(we)};if(Q_[ee])return{isToken:!0,value:we};if(ee.match(uC))throw new RangeError("Format string contains an unescaped latin alphabet character `"+ee+"`");return{isToken:!1,value:we}});d.localize.preprocessor&&(M=d.localize.preprocessor(l,M));const A={firstWeekContainsDate:g,weekStartsOn:m,locale:d};return M.map(we=>{if(!we.isToken)return we.value;const ee=we.value;(!(a!=null&&a.useAdditionalWeekYearTokens)&&rC(ee)||!(a!=null&&a.useAdditionalDayOfYearTokens)&&iC(ee))&&nC(ee,r,String(e));const Ie=Q_[ee[0]];return Ie(l,ee,d.localize,A)}).join("")}function hC(e){const r=e.match(lC);return r?r[1].replace(cC,"'"):e}function dC(e,r){return bx(e,-r)}function pC(e,r){const a=(r==null?void 0:r.additionalDigits)??2,u=yC(e);let d;if(u.date){const M=_C(u.date,a);d=vC(M.restDateString,M.year)}if(!d||isNaN(d.getTime()))return new Date(NaN);const g=d.getTime();let m=0,l;if(u.time&&(m=xC(u.time),isNaN(m)))return new Date(NaN);if(u.timezone){if(l=bC(u.timezone),isNaN(l))return new Date(NaN)}else{const M=new Date(g+m),A=new Date(0);return A.setFullYear(M.getUTCFullYear(),M.getUTCMonth(),M.getUTCDate()),A.setHours(M.getUTCHours(),M.getUTCMinutes(),M.getUTCSeconds(),M.getUTCMilliseconds()),A}return new Date(g+m+l)}const Bd={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},fC=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,mC=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,gC=/^([+-])(\d{2})(?::?(\d{2}))?$/;function yC(e){const r={},a=e.split(Bd.dateTimeDelimiter);let u;if(a.length>2)return r;if(/:/.test(a[0])?u=a[0]:(r.date=a[0],u=a[1],Bd.timeZoneDelimiter.test(r.date)&&(r.date=e.split(Bd.timeZoneDelimiter)[0],u=e.substr(r.date.length,e.length))),u){const d=Bd.timezone.exec(u);d?(r.time=u.replace(d[1],""),r.timezone=d[1]):r.time=u}return r}function _C(e,r){const a=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+r)+"})|(\\d{2}|[+-]\\d{"+(2+r)+"})$)"),u=e.match(a);if(!u)return{year:NaN,restDateString:""};const d=u[1]?parseInt(u[1]):null,g=u[2]?parseInt(u[2]):null;return{year:g===null?d:g*100,restDateString:e.slice((u[1]||u[2]).length)}}function vC(e,r){if(r===null)return new Date(NaN);const a=e.match(fC);if(!a)return new Date(NaN);const u=!!a[4],d=uh(a[1]),g=uh(a[2])-1,m=uh(a[3]),l=uh(a[4]),M=uh(a[5])-1;if(u)return TC(r,l,M)?wC(r,l,M):new Date(NaN);{const A=new Date(0);return!SC(r,g,m)||!EC(r,d)?new Date(NaN):(A.setUTCFullYear(r,g,Math.max(d,m)),A)}}function uh(e){return e?parseInt(e):1}function xC(e){const r=e.match(mC);if(!r)return NaN;const a=Hf(r[1]),u=Hf(r[2]),d=Hf(r[3]);return CC(a,u,d)?a*rg+u*Sx+d*1e3:NaN}function Hf(e){return e&&parseFloat(e.replace(",","."))||0}function bC(e){if(e==="Z")return 0;const r=e.match(gC);if(!r)return 0;const a=r[1]==="+"?-1:1,u=parseInt(r[2]),d=r[3]&&parseInt(r[3])||0;return IC(u,d)?a*(u*rg+d*Sx):NaN}function wC(e,r,a){const u=new Date(0);u.setUTCFullYear(e,0,4);const d=u.getUTCDay()||7,g=(r-1)*7+a+1-d;return u.setUTCDate(u.getUTCDate()+g),u}const MC=[31,null,31,30,31,30,31,31,30,31,30,31];function Ix(e){return e%400===0||e%4===0&&e%100!==0}function SC(e,r,a){return r>=0&&r<=11&&a>=1&&a<=(MC[r]||(Ix(e)?29:28))}function EC(e,r){return r>=1&&r<=(Ix(e)?366:365)}function TC(e,r,a){return r>=1&&r<=53&&a>=0&&a<=6}function CC(e,r,a){return e===24?r===0&&a===0:a>=0&&a<60&&r>=0&&r<60&&e>=0&&e<25}function IC(e,r){return r>=0&&r<=59}function AC(e,r){return wx(e,-r)}function PC(e,r){return sT(e,-r)}function kC(e,r){return cT(e,-r)}function DC(e,r){return uT(e,-r)}xx.settings.currency.precision=0;function ng(){return{bold:u=>"<strong>"+u+"</strong>",currency:u=>xx.formatMoney(u),date:u=>{let d;return typeof u=="string"?d=wm(pC(u),"MM/dd/yyyy"):d=wm(u,"MM/dd/yyyy"),d}}}const{currency:r0,date:LC}=ng(),Ax=Lo("OpaStore",{state:()=>({opaData:{}}),actions:{async fillOpaData(){const r=Qr().addressData.features[0].properties.opa_account_num,a=await fetch(`https://phl.carto.com/api/v2/sql?q=select+*+from+opa_properties_public+where+parcel_number+%3D+%27${r}%27`);this.opaData=await a.json()}},getters:{getMarketValue:e=>r0(e.opaData.rows[0].market_value||null),getSaleDate:e=>LC(e.opaData.rows[0].sale_date),getSalePrice:e=>r0(e.opaData.rows[0].sale_price)}}),Cl=e=>(qh("data-v-d679c3e2"),e=e(),Gh(),e),RC={key:0,class:"box"},zC={key:1,class:"vert-table"},OC={class:"columns"},FC=Cl(()=>J("div",{class:"column is-4"},"OPA Account #",-1)),BC={class:"column is-8"},NC={class:"columns"},$C=Cl(()=>J("div",{class:"column is-4"},"OPA Address",-1)),UC={class:"column is-8"},VC={class:"columns"},jC=Cl(()=>J("div",{class:"column is-4"},"Owners",-1)),qC={class:"column is-8"},GC={class:"columns"},HC=Cl(()=>J("div",{class:"column is-4"},"Assessed Value",-1)),WC={class:"column is-8"},ZC={class:"columns"},XC=Cl(()=>J("div",{class:"column is-4"},"Sale Date",-1)),KC={class:"column is-8"},YC={class:"columns"},JC=Cl(()=>J("div",{class:"column is-4"},"Sale Price",-1)),QC={class:"column is-8"},eI={key:2},tI={class:"title is-5"},iI=Cl(()=>J("p",null,"You can use the Condominiums tab below to see information for an individual unit.",-1)),rI={key:3},nI=Cl(()=>J("p",null,"There is no property assessment record for this address.",-1)),sI=[nI],aI={__name:"Property",setup(e){console.log("Property.vue setup");const r=Qr(),a=Ax(),u=Op();return(d,g)=>(wt(),Ft("section",null,[zi(a).opaData.rows.length?(wt(),Ft("div",RC," Property assessment and sale information for this address. Source: Office of Property Assessments (OPA). OPA was formerly a part of the Bureau of Revision of Taxes (BRT) and some City records may still use that name. ")):Gi("",!0),zi(a).opaData.rows.length?(wt(),Ft("div",zC,[J("div",OC,[FC,J("div",BC,Ht(zi(r).addressData.features[0].properties.opa_account_num),1)]),J("div",NC,[$C,J("div",UC,Ht(zi(r).addressData.features[0].properties.opa_address),1)]),J("div",VC,[jC,J("div",qC,Ht(zi(r).getOpaOwners),1)]),J("div",GC,[HC,J("div",WC,Ht(zi(a).getMarketValue),1)]),J("div",ZC,[XC,J("div",KC,Ht(zi(a).getSaleDate),1)]),J("div",YC,[JC,J("div",QC,Ht(zi(a).getSalePrice),1)])])):Gi("",!0),!zi(a).opaData.rows.length&&zi(u).condosData.length?(wt(),Ft("div",eI,[J("h5",tI,"There are "+Ht(zi(u).condosData.length)+" condominium units at this address.",1),iI])):zi(a).opaData.rows.length?Gi("",!0):(wt(),Ft("div",rI,sI))]))}},oI=Fs(aI,[["__scopeId","data-v-d679c3e2"]]),lI=J("div",{class:"box"}," Condominium units at your search address, as recorded for property assessment purposes. Click one of the addresses below to see information for that unit. Use the back button to return to this list. Source: Office of Property Assessment ",-1),cI=J("h5",{class:"subtitle is-5"},"Condominiums",-1),uI={class:"table is-fullwidth is-striped"},hI=J("thead",null,[J("tr",null,[J("th",null,"Address"),J("th",null,"OPA Account #")])],-1),dI={__name:"Condos",setup(e){console.log("Condos.vue setup");const r=Op(),a=gi(()=>r.condosData);return(u,d)=>(wt(),Ft("section",null,[lI,cI,J("table",uI,[hI,J("tbody",null,[(wt(!0),Ft(Mr,null,Rs(a.value,g=>(wt(),Ft("tr",null,[J("td",null,[sr(zi(Yv),{to:{name:"address-and-topic",params:{address:g.properties.opa_address,topic:"Property"}}},{default:Ao(()=>[np(Ht(g.properties.opa_address),1)]),_:2},1032,["to"])]),J("td",null,Ht(g.properties.opa_account_num),1)]))),256))])])]))}};function Wf(e){return e&&typeof e=="object"&&!Array.isArray(e)&&e!==null}function bu(e,r){let a=Object.assign({},e);return Wf(e)&&Wf(r)&&Object.keys(r).forEach(u=>{Wf(r[u])?u in e?a[u]=bu(e[u],r[u]):Object.assign(a,{[u]:r[u]}):Object.assign(a,{[u]:r[u]})}),a}const Yh={sources:{imageryLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2023:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2023/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2022:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2022_2in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2020:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2020_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2019:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2019_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2018:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2018_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2017:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2017_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2016:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2016_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2015:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2015_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2012:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2012_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2010:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2010_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2008:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2008_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2004:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2004_6in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},1996:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_1996_6in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},1962:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/HistoricLandUse_1962/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},1942:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/HistoricLandUse_1942/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},1910:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/HistoricBromleyAtlas_1910/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},1895:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/HistoricBromleyAtlas_1895/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},1875:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/HistoricGMHopkinsAtlas_1875/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},1860:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/HistoricHexamerLocherAtlas_1860/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},cyclomediaRecordings:{type:"geojson",data:{type:"FeatureCollection",features:[]}},camera:{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[]}}},viewCone:{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[]]]}}}}},pI=bu(Yh,{version:8,name:"pwdDrawnMap",sources:{pwd:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityBasemap/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},pwdLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityBasemap_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},addressMarker:{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[]}}},dorParcel:{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[]]]}}}},layers:[{id:"pwd",source:"pwd",type:"raster"},{id:"pwdLabels",source:"pwdLabels",type:"raster"},{id:"addressMarker",source:"addressMarker",type:"symbol",layout:{"icon-image":"marker-blue","icon-anchor":"bottom","icon-size":.05},paint:{"icon-color":"#ff0000","icon-opacity":1}},{id:"cyclomediaRecordings",source:"cyclomediaRecordings",type:"circle",paint:{"circle-radius":6,"circle-color":"#80A5E6","circle-stroke-width":1,"circle-stroke-color":"black","circle-opacity":.5}}]}),fI=bu(Yh,{version:8,name:"liDrawnMap",sources:{pwd:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityBasemap/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},pwdLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityBasemap_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},liBuildingFootprints:{type:"geojson",data:{type:"FeatureCollection",features:[]}},addressMarker:{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[]}}},dorParcel:{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[]]]}}}},layers:[{id:"pwd",source:"pwd",type:"raster"},{id:"pwdLabels",source:"pwdLabels",type:"raster"},{id:"liBuildingFootprints",type:"fill",source:"liBuildingFootprints",layout:{},paint:{"fill-color":["match",["get","type"],"nearby311","#FF0000","#C2B7FF"],"fill-opacity":.5}},{id:"cyclomediaRecordings",source:"cyclomediaRecordings",type:"circle",paint:{"circle-radius":6,"circle-color":"#80A5E6","circle-stroke-width":1,"circle-stroke-color":"black","circle-opacity":.5}},{id:"addressMarker",source:"addressMarker",type:"symbol",layout:{"icon-image":"marker-blue","icon-anchor":"bottom","icon-size":.05},paint:{"icon-color":"#ff0000","icon-opacity":1}}]}),mI=bu(Yh,{version:8,name:"dorDrawnMap",sources:{dor:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/DORBasemap/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},dorLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/DORBasemap_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},addressMarker:{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[]}}},dorParcel:{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[]]]}}}},layers:[{id:"dor",source:"dor",type:"raster"},{id:"dorLabels",source:"dorLabels",type:"raster"},{id:"cyclomediaRecordings",source:"cyclomediaRecordings",type:"circle",paint:{"circle-radius":6,"circle-color":"#80A5E6","circle-stroke-width":1,"circle-stroke-color":"black","circle-opacity":.5}},{id:"dorParcel",type:"fill",source:"dorParcel",layout:{},paint:{"fill-color":"#088","fill-opacity":.4}}]}),gI=bu(Yh,{version:8,name:"dorDrawnMap",sources:{dor:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/DORBasemap/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},dorLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/DORBasemap_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},zoning:{tiles:["https://citygeo-geoserver.databridge.phila.gov/geoserver/wms?service=WMS&version=1.1.0&request=GetMap&layers=atlas_zoning_grouped&bbox={bbox-epsg-3857}&width=256&height=256&srs=EPSG%3A3857&styles=&format=image/png&transparent=true"],type:"raster",tileSize:256},addressMarker:{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[]}}},dorParcel:{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[]]]}}}},layers:[{id:"dor",source:"dor",type:"raster"},{id:"dorLabels",source:"dorLabels",type:"raster"},{id:"zoning",source:"zoning",type:"raster",paint:{"raster-opacity":1}},{id:"cyclomediaRecordings",source:"cyclomediaRecordings",type:"circle",paint:{"circle-radius":6,"circle-color":"#80A5E6","circle-stroke-width":1,"circle-stroke-color":"black","circle-opacity":.5}},{id:"dorParcel",type:"fill",source:"dorParcel",layout:{},paint:{"fill-color":"#088","fill-opacity":.4}}]}),yI=bu(Yh,{version:8,name:"pwdDrawnMap",sources:{pwd:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityBasemap/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},pwdLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityBasemap_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},addressMarker:{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[]}}},dorParcel:{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[]]]}}},nearby:{type:"geojson",data:{type:"FeatureCollection",features:[]}}},layers:[{id:"pwd",source:"pwd",type:"raster"},{id:"pwdLabels",source:"pwdLabels",type:"raster"},{id:"cyclomediaRecordings",source:"cyclomediaRecordings",type:"circle",paint:{"circle-radius":6,"circle-color":"#80A5E6","circle-stroke-width":1,"circle-stroke-color":"black","circle-opacity":.5}},{id:"nearby",source:"nearby",type:"circle",paint:{"circle-radius":7,"circle-color":["match",["get","type"],"nearby311","#FF0000","nearbyCrimeIncidents","#0096FF","#000000"],"circle-stroke-width":1,"circle-stroke-color":"white"}},{id:"addressMarker",source:"addressMarker",type:"symbol",layout:{"icon-image":"marker-blue","icon-anchor":"bottom","icon-size":.05}}]}),Hr={topicStyles:{Property:"pwdDrawnMapStyle",Condos:"pwdDrawnMapStyle",Deeds:"dorDrawnMapStyle","Licenses & Inspections":"liDrawnMapStyle",Zoning:"zoningDrawnMapStyle",Voting:"pwdDrawnMapStyle","Nearby Activity":"nearbyDrawnMapStyle"},parcelLayerForTopic:{undefined:"pwd",Property:"pwd",Condos:"pwd",Deeds:"dor","Licenses & Inspections":"pwd",Zoning:"dor",Voting:"pwd","Nearby Activity":"pwd"},mapLayers:{pwdBasemap:{id:"pwdBasemap",source:"pwdBasemap",type:"raster"},pwdLabels:{id:"pwdLabels",source:"pwdLabels",type:"raster"},dorBasemap:{id:"dorBasemap",source:"dorBasemap",type:"raster"},dorLabels:{id:"dorLabels",source:"dorLabels",type:"raster"},zoning:{id:"zoning",source:"zoning",type:"raster"},addressMarker:{id:"addressMarker",source:"addressMarker",type:"circle"},dorParcel:{id:"dorParcel",type:"fill",source:"dorParcel",layout:{},paint:{"fill-color":"#088","fill-opacity":.4}},imageryLabels:{id:"imageryLabels",source:"imageryLabels",type:"raster"},2023:{id:"2023",source:"2023",type:"raster"},2022:{id:"2022",source:"2022",type:"raster"},2020:{id:"2020",source:"2020",type:"raster"},2019:{id:"2019",source:"2019",type:"raster"},2018:{id:"2018",source:"2018",type:"raster"},2017:{id:"2017",source:"2017",type:"raster"},2016:{id:"2016",source:"2016",type:"raster"},2015:{id:"2015",source:"2015",type:"raster"},2012:{id:"2012",source:"2012",type:"raster"},2010:{id:"2010",source:"2010",type:"raster"},2008:{id:"2008",source:"2008",type:"raster"},2004:{id:"2004",source:"2004",type:"raster"},1996:{id:"1996",source:"1996",type:"raster"},1962:{id:"1962",source:"1962",type:"raster"},1942:{id:"1942",source:"1942",type:"raster"},1910:{id:"1910",source:"1910",type:"raster"},1895:{id:"1895",source:"1895",type:"raster"},1875:{id:"1875",source:"1875",type:"raster"},1860:{id:"1860",source:"1860",type:"raster"}}};Hr.pwdDrawnMapStyle=pI;Hr.dorDrawnMapStyle=mI;Hr.liDrawnMapStyle=fI;Hr.zoningDrawnMapStyle=gI;Hr.nearbyDrawnMapStyle=yI;const mu=Lo("ParcelsStore",{state:()=>({pwd:{},dor:{}}),actions:{async fillPwdParcelData(){const r=Qr().addressData.features;if(!r)return;const a=r[0],u=a.properties.pwd_parcel_id;if(!u){console.log("no pwd parcel in AIS"),await this.fillParcelDataByLngLat(a.geometry.coordinates[0],a.geometry.coordinates[1],"pwd");return}try{const d=await fetch(`https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/PWD_PARCELS/FeatureServer/0/query?where=PARCELID=%27${u}%27&outSR=4326&f=geojson&outFields=*&returnGeometry=true`);d.ok?this.pwd=await d.json():console.error("Failed to fetch pwd parcel data")}catch{console.error("Failed to fetch pwd parcel data")}},async fillDorParcelData(){const r=Qr().addressData.features;if(!r)return;const a=r[0],u=a.properties.dor_parcel_id;if(!u){console.log("no dor parcel in AIS"),await this.fillParcelDataByLngLat(a.geometry.coordinates[0],a.geometry.coordinates[1],"dor");return}const d="https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/DOR_Parcel/FeatureServer/0/query";let g;if(u.includes("|")){const l=u.split("|");let M="MAPREG = '",A;for(A=0;A<l.length;A++)M=M+l[A]+"'",A<l.length-1&&(M=M+" or MAPREG = '");g=d+"?where="+M}else Array.isArray(u)?g=d+"?where=MAPREG IN ("+u+")":g=d+"?where=MAPREG='"+u+"'";let m={outSR:4326,f:"geojson",outFields:"*",returnGeometry:!0};try{const l=await ar(g,{params:m});if(l.status===200){console.log("response",l);const M=await l.data,A=M.features.filter(z=>z.properties.STATUS===1),R=M.features.filter(z=>z.properties.STATUS===2),k=M.features.filter(z=>z.properties.STATUS===3);M.features=A.concat(R).concat(k),this.dor=M}else console.error("Failed to fetch dor parcel data 1")}catch{console.error("Failed to fetch dor parcel data 2")}},async fillParcelDataByLngLat(e,r,a){console.log("fillParcelDataByLngLat, lng:",e,"lat:",r,"parcelLayer:",a);let u=a==="pwd"?"PWD_PARCELS":"DOR_Parcel",d={where:"1=1",outSR:4326,f:"geojson",outFields:"*",returnGeometry:!0,geometry:`{ "x": ${e}, "y": ${r}, "spatialReference":{ "wkid":4326 }}`,geometryType:"esriGeometryPoint",spatialRel:"esriSpatialRelWithin"};const g=await ar(`https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/${u}/FeatureServer/0/query`,{params:d});console.log("response",g),g.data.features.length>0&&(this[a]=await g.data)}}});var ks=63710088e-1,Px={centimeters:ks*100,centimetres:ks*100,degrees:ks/111325,feet:ks*3.28084,inches:ks*39.37,kilometers:ks/1e3,kilometres:ks/1e3,meters:ks,metres:ks,miles:ks/1609.344,millimeters:ks*1e3,millimetres:ks*1e3,nauticalmiles:ks/1852,radians:1,yards:ks*1.0936},n0={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function sg(e,r,a){a===void 0&&(a={});var u={type:"Feature"};return(a.id===0||a.id)&&(u.id=a.id),a.bbox&&(u.bbox=a.bbox),u.properties=r||{},u.geometry=e,u}function Fh(e,r,a){if(a===void 0&&(a={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!s0(e[0])||!s0(e[1]))throw new Error("coordinates must contain numbers");var u={type:"Point",coordinates:e};return sg(u,r,a)}function ag(e,r,a){a===void 0&&(a={});for(var u=0,d=e;u<d.length;u++){var g=d[u];if(g.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var m=0;m<g[g.length-1].length;m++)if(g[g.length-1][m]!==g[0][m])throw new Error("First and last Position are not equivalent.")}var l={type:"Polygon",coordinates:e};return sg(l,r,a)}function _I(e,r,a){if(a===void 0&&(a={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var u={type:"LineString",coordinates:e};return sg(u,r,a)}function vI(e,r){r===void 0&&(r={});var a={type:"FeatureCollection"};return r.id&&(a.id=r.id),r.bbox&&(a.bbox=r.bbox),a.features=e,a}function xI(e,r){r===void 0&&(r="kilometers");var a=Px[r];if(!a)throw new Error(r+" units is invalid");return e*a}function bI(e,r){r===void 0&&(r="kilometers");var a=Px[r];if(!a)throw new Error(r+" units is invalid");return e/a}function Mm(e){var r=e%(2*Math.PI);return r*180/Math.PI}function za(e){var r=e%360;return r*Math.PI/180}function wI(e,r,a){if(r===void 0&&(r="meters"),a===void 0&&(a="kilometers"),!(e>=0))throw new Error("area must be a positive number");var u=n0[r];if(!u)throw new Error("invalid original units");var d=n0[a];if(!d)throw new Error("invalid final units");return e/u*d}function s0(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function MI(e,r){r===void 0&&(r={});var a=Number(e[0]),u=Number(e[1]),d=Number(e[2]),g=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var m=[a,u],l=[a,g],M=[d,g],A=[d,u];return ag([[m,A,M,l,m]],r.properties,{bbox:e,id:r.id})}const Yc=function(e){var r=e?String(e):"";return r=r.replace(/\s+/g,""),[null,"0"].indexOf(r)>-1?"":r},SI=function(e,r){console.log("concatDorAddress is running, parcel:",e),r=!!r;var a=["STDIR","STNAM","STDES","STDESSUF"],u=e.properties,d=Yc(u.HOUSE),g=Yc(u.STEX),m=Yc(u.SUF),l=d;l=l+(g?"-"+g:""),l=l+(m||"");var M=Yc(u.UNIT);M&&(M="# "+M);var A=a.map(function(R){return u[R]});return A=A.map(Yc),A=[l].concat(A),r&&(A=A.concat([M])),l=A.filter(Boolean).join(" "),l===""&&(l="Parcel has no address"),console.log("concatDorAddress address result:",l),l},kx=Lo("DorStore",{state:()=>({dorDocuments:{},regmaps:{}}),actions:{async fillRegmaps(){console.log("fillRegmaps is running");const r=mu().dor.features;var a=[],u=[];r.forEach(function(Z){var X=Z.geometry,fe=X.coordinates;fe.forEach(function(ye){ye.forEach(function(we){var ee=Array.isArray(we[0]);if(ee)we.forEach(function(Xe){var nt=Xe[0],ft=Xe[1];a.push(nt),u.push(ft)});else{var Ie=we[0],Ue=we[1];a.push(Ie),u.push(Ue)}})})});var d=Math.min.apply(null,a),g=Math.max.apply(null,a),m=Math.min.apply(null,u),l=Math.max.apply(null,u),M=[d,g,m,l].every(function(Z){return Z});if(!M)return null;var A=[d,m,g,l],R=MI(A).geometry;console.log("regmaps.js, bounds:",R);let k="//services.arcgis.com/fLeGjb7u4uXqeF9q/arcgis/rest/services/MASTERMAPINDEX/FeatureServer/0/query",z={returnGeometry:!0,where:"1=1",outSR:4326,outFields:"*",inSr:4326,geometryType:"esriGeometryEnvelope",spatialRel:"esriSpatialRelIntersects",f:"geojson",geometry:`{ "xmin": ${R.coordinates[0][0][0]}, "ymin": ${R.coordinates[0][0][1]}, "xmax": ${R.coordinates[0][2][0]}, "ymax": ${R.coordinates[0][2][1]}, "spatialReference": { "wkid":4326 }}`};const W=await ar.get(k,{params:z});this.regmaps=W},async fillDorDocuments(){console.log("fillDorDocuments is running"),this.dorDocuments={};const e=mu(),r=Qr(),a="//services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/RTT_SUMMARY/FeatureServer/0/query",u=function(d){console.log("where function is running, feature:",d);var g=SI(d),m=r.addressData.features[0].properties,l;if(!g||g==="null")l="MATCHED_REGMAP = '"+e.dor.features[0].properties.BASEREG+"'";else{var M=r.addressData.features[0].properties,A=M.address_low,R=Math.floor(A/100,1)*100,k=A-R,z=M.address_high,W=z||A;l="(((ADDRESS_LOW >= "+A+" AND ADDRESS_LOW <= "+W+") OR (ADDRESS_LOW >= "+R+" AND ADDRESS_LOW <= "+W+" AND ADDRESS_HIGH >= "+k+" )) AND STREET_NAME = '"+m.street_name+"' AND STREET_SUFFIX = '"+m.street_suffix+"' AND (MOD(ADDRESS_LOW,2) = MOD( "+A+",2))",m.street_predir!=""&&(l+=" AND STREET_PREDIR = '"+m.street_predir+"'"),m.address_low_suffix!=""&&(l+=" AND ADDRESS_LOW_SUFFIX = '"+m.address_low_suffix+"'"),m.address_low_suffix==""&&(l+=" AND ADDRESS_LOW_SUFFIX = ''"),m.address_low_frac==="1/2"&&(l+=" AND ADDRESS_LOW_SUFFIX = '2'"),m.street_postdir!=""&&(l+=" AND STREET_POSTDIR = '"+m.street_postdir+"'");var Z=Yc(d.properties.UNIT),X=m.unit_num;Z?l+=" AND UNIT_NUM = '"+Z+"'":X!==""&&(l+=" AND UNIT_NUM = '"+X+"'"),l+=") or MATCHED_REGMAP = '"+e.dor.features[0].properties.BASEREG+"'",l+=" or REG_MAP_ID = '"+e.dor.features[0].properties.BASEREG+"'"}return l};for(let d of e.dor.features){const m={where:u(d),outFields:"DOCUMENT_ID, DISPLAY_DATE, DOCUMENT_TYPE, GRANTORS, GRANTEES",returnDistinctValues:"true",returnGeometry:"false",f:"json",sqlFormat:"standard"};console.log("params:",m);const l=await ar(a,{params:m});this.dorDocuments[d.properties.OBJECTID]=l}}}});function EI(e){e("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),e("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),e("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),e.WGS84=e["EPSG:4326"],e["EPSG:3785"]=e["EPSG:3857"],e.GOOGLE=e["EPSG:3857"],e["EPSG:900913"]=e["EPSG:3857"],e["EPSG:102113"]=e["EPSG:3857"]}var uc=1,hc=2,cu=3,TI=4,Sm=5,a0=6378137,CI=6356752314e-3,o0=.0066943799901413165,Mh=484813681109536e-20,gt=Math.PI/2,II=.16666666666666666,AI=.04722222222222222,PI=.022156084656084655,zt=1e-10,qn=.017453292519943295,ro=57.29577951308232,or=Math.PI/4,Bh=Math.PI*2,pn=3.14159265359,Ns={};Ns.greenwich=0;Ns.lisbon=-9.131906111111;Ns.paris=2.337229166667;Ns.bogota=-74.080916666667;Ns.madrid=-3.687938888889;Ns.rome=12.452333333333;Ns.bern=7.439583333333;Ns.jakarta=106.807719444444;Ns.ferro=-17.666666666667;Ns.brussels=4.367975;Ns.stockholm=18.058277777778;Ns.athens=23.7163375;Ns.oslo=10.722916666667;const kI={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var l0=/[\s_\-\/\(\)]/g;function El(e,r){if(e[r])return e[r];for(var a=Object.keys(e),u=r.toLowerCase().replace(l0,""),d=-1,g,m;++d<a.length;)if(g=a[d],m=g.toLowerCase().replace(l0,""),m===u)return e[g]}function Em(e){var r={},a=e.split("+").map(function(l){return l.trim()}).filter(function(l){return l}).reduce(function(l,M){var A=M.split("=");return A.push(!0),l[A[0].toLowerCase()]=A[1],l},{}),u,d,g,m={proj:"projName",datum:"datumCode",rf:function(l){r.rf=parseFloat(l)},lat_0:function(l){r.lat0=l*qn},lat_1:function(l){r.lat1=l*qn},lat_2:function(l){r.lat2=l*qn},lat_ts:function(l){r.lat_ts=l*qn},lon_0:function(l){r.long0=l*qn},lon_1:function(l){r.long1=l*qn},lon_2:function(l){r.long2=l*qn},alpha:function(l){r.alpha=parseFloat(l)*qn},gamma:function(l){r.rectified_grid_angle=parseFloat(l)},lonc:function(l){r.longc=l*qn},x_0:function(l){r.x0=parseFloat(l)},y_0:function(l){r.y0=parseFloat(l)},k_0:function(l){r.k0=parseFloat(l)},k:function(l){r.k0=parseFloat(l)},a:function(l){r.a=parseFloat(l)},b:function(l){r.b=parseFloat(l)},r:function(l){r.a=r.b=parseFloat(l)},r_a:function(){r.R_A=!0},zone:function(l){r.zone=parseInt(l,10)},south:function(){r.utmSouth=!0},towgs84:function(l){r.datum_params=l.split(",").map(function(M){return parseFloat(M)})},to_meter:function(l){r.to_meter=parseFloat(l)},units:function(l){r.units=l;var M=El(kI,l);M&&(r.to_meter=M.to_meter)},from_greenwich:function(l){r.from_greenwich=l*qn},pm:function(l){var M=El(Ns,l);r.from_greenwich=(M||parseFloat(l))*qn},nadgrids:function(l){l==="@null"?r.datumCode="none":r.nadgrids=l},axis:function(l){var M="ewnsud";l.length===3&&M.indexOf(l.substr(0,1))!==-1&&M.indexOf(l.substr(1,1))!==-1&&M.indexOf(l.substr(2,1))!==-1&&(r.axis=l)},approx:function(){r.approx=!0}};for(u in a)d=a[u],u in m?(g=m[u],typeof g=="function"?g(d):r[g]=d):r[u]=d;return typeof r.datumCode=="string"&&r.datumCode!=="WGS84"&&(r.datumCode=r.datumCode.toLowerCase()),r}var Nh=1,Dx=2,Lx=3,cp=4,Rx=5,og=-1,DI=/\s/,LI=/[A-Za-z]/,RI=/[A-Za-z84_]/,Bp=/[,\]]/,zx=/[\d\.E\-\+]/;function Ro(e){if(typeof e!="string")throw new Error("not a string");this.text=e.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=Nh}Ro.prototype.readCharicter=function(){var e=this.text[this.place++];if(this.state!==cp)for(;DI.test(e);){if(this.place>=this.text.length)return;e=this.text[this.place++]}switch(this.state){case Nh:return this.neutral(e);case Dx:return this.keyword(e);case cp:return this.quoted(e);case Rx:return this.afterquote(e);case Lx:return this.number(e);case og:return}};Ro.prototype.afterquote=function(e){if(e==='"'){this.word+='"',this.state=cp;return}if(Bp.test(e)){this.word=this.word.trim(),this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in afterquote yet, index '+this.place)};Ro.prototype.afterItem=function(e){if(e===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=Nh;return}if(e==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=Nh,this.currentObject=this.stack.pop(),this.currentObject||(this.state=og);return}};Ro.prototype.number=function(e){if(zx.test(e)){this.word+=e;return}if(Bp.test(e)){this.word=parseFloat(this.word),this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in number yet, index '+this.place)};Ro.prototype.quoted=function(e){if(e==='"'){this.state=Rx;return}this.word+=e};Ro.prototype.keyword=function(e){if(RI.test(e)){this.word+=e;return}if(e==="["){var r=[];r.push(this.word),this.level++,this.root===null?this.root=r:this.currentObject.push(r),this.stack.push(this.currentObject),this.currentObject=r,this.state=Nh;return}if(Bp.test(e)){this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in keyword yet, index '+this.place)};Ro.prototype.neutral=function(e){if(LI.test(e)){this.word=e,this.state=Dx;return}if(e==='"'){this.word="",this.state=cp;return}if(zx.test(e)){this.word=e,this.state=Lx;return}if(Bp.test(e)){this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in neutral yet, index '+this.place)};Ro.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===og)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function zI(e){var r=new Ro(e);return r.output()}function c0(e,r,a){Array.isArray(r)&&(a.unshift(r),r=null);var u=r?{}:e,d=a.reduce(function(g,m){return Qc(m,g),g},u);r&&(e[r]=d)}function Qc(e,r){if(!Array.isArray(e)){r[e]=!0;return}var a=e.shift();if(a==="PARAMETER"&&(a=e.shift()),e.length===1){if(Array.isArray(e[0])){r[a]={},Qc(e[0],r[a]);return}r[a]=e[0];return}if(!e.length){r[a]=!0;return}if(a==="TOWGS84"){r[a]=e;return}if(a==="AXIS"){a in r||(r[a]=[]),r[a].push(e);return}Array.isArray(a)||(r[a]={});var u;switch(a){case"UNIT":case"PRIMEM":case"VERT_DATUM":r[a]={name:e[0].toLowerCase(),convert:e[1]},e.length===3&&Qc(e[2],r[a]);return;case"SPHEROID":case"ELLIPSOID":r[a]={name:e[0],a:e[1],rf:e[2]},e.length===4&&Qc(e[3],r[a]);return;case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":e[0]=["name",e[0]],c0(r,a,e);return;default:for(u=-1;++u<e.length;)if(!Array.isArray(e[u]))return Qc(e,r[a]);return c0(r,a,e)}}var OI=.017453292519943295;function FI(e,r){var a=r[0],u=r[1];!(a in e)&&u in e&&(e[a]=e[u],r.length===3&&(e[a]=r[2](e[a])))}function Qa(e){return e*OI}function BI(e){if(e.type==="GEOGCS"?e.projName="longlat":e.type==="LOCAL_CS"?(e.projName="identity",e.local=!0):typeof e.PROJECTION=="object"?e.projName=Object.keys(e.PROJECTION)[0]:e.projName=e.PROJECTION,e.AXIS){for(var r="",a=0,u=e.AXIS.length;a<u;++a){var d=[e.AXIS[a][0].toLowerCase(),e.AXIS[a][1].toLowerCase()];d[0].indexOf("north")!==-1||(d[0]==="y"||d[0]==="lat")&&d[1]==="north"?r+="n":d[0].indexOf("south")!==-1||(d[0]==="y"||d[0]==="lat")&&d[1]==="south"?r+="s":d[0].indexOf("east")!==-1||(d[0]==="x"||d[0]==="lon")&&d[1]==="east"?r+="e":(d[0].indexOf("west")!==-1||(d[0]==="x"||d[0]==="lon")&&d[1]==="west")&&(r+="w")}r.length===2&&(r+="u"),r.length===3&&(e.axis=r)}e.UNIT&&(e.units=e.UNIT.name.toLowerCase(),e.units==="metre"&&(e.units="meter"),e.UNIT.convert&&(e.type==="GEOGCS"?e.DATUM&&e.DATUM.SPHEROID&&(e.to_meter=e.UNIT.convert*e.DATUM.SPHEROID.a):e.to_meter=e.UNIT.convert));var g=e.GEOGCS;e.type==="GEOGCS"&&(g=e),g&&(g.DATUM?e.datumCode=g.DATUM.name.toLowerCase():e.datumCode=g.name.toLowerCase(),e.datumCode.slice(0,2)==="d_"&&(e.datumCode=e.datumCode.slice(2)),(e.datumCode==="new_zealand_geodetic_datum_1949"||e.datumCode==="new_zealand_1949")&&(e.datumCode="nzgd49"),(e.datumCode==="wgs_1984"||e.datumCode==="world_geodetic_system_1984")&&(e.PROJECTION==="Mercator_Auxiliary_Sphere"&&(e.sphere=!0),e.datumCode="wgs84"),e.datumCode.slice(-6)==="_ferro"&&(e.datumCode=e.datumCode.slice(0,-6)),e.datumCode.slice(-8)==="_jakarta"&&(e.datumCode=e.datumCode.slice(0,-8)),~e.datumCode.indexOf("belge")&&(e.datumCode="rnb72"),g.DATUM&&g.DATUM.SPHEROID&&(e.ellps=g.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),e.ellps.toLowerCase().slice(0,13)==="international"&&(e.ellps="intl"),e.a=g.DATUM.SPHEROID.a,e.rf=parseFloat(g.DATUM.SPHEROID.rf,10)),g.DATUM&&g.DATUM.TOWGS84&&(e.datum_params=g.DATUM.TOWGS84),~e.datumCode.indexOf("osgb_1936")&&(e.datumCode="osgb36"),~e.datumCode.indexOf("osni_1952")&&(e.datumCode="osni52"),(~e.datumCode.indexOf("tm65")||~e.datumCode.indexOf("geodetic_datum_of_1965"))&&(e.datumCode="ire65"),e.datumCode==="ch1903+"&&(e.datumCode="ch1903"),~e.datumCode.indexOf("israel")&&(e.datumCode="isr93")),e.b&&!isFinite(e.b)&&(e.b=e.a);function m(A){var R=e.to_meter||1;return A*R}var l=function(A){return FI(e,A)},M=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Qa],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Qa],["x0","false_easting",m],["y0","false_northing",m],["long0","central_meridian",Qa],["lat0","latitude_of_origin",Qa],["lat0","standard_parallel_1",Qa],["lat1","standard_parallel_1",Qa],["lat2","standard_parallel_2",Qa],["azimuth","Azimuth"],["alpha","azimuth",Qa],["srsCode","name"]];M.forEach(l),!e.long0&&e.longc&&(e.projName==="Albers_Conic_Equal_Area"||e.projName==="Lambert_Azimuthal_Equal_Area")&&(e.long0=e.longc),!e.lat_ts&&e.lat1&&(e.projName==="Stereographic_South_Pole"||e.projName==="Polar Stereographic (variant B)")?(e.lat0=Qa(e.lat1>0?90:-90),e.lat_ts=e.lat1):!e.lat_ts&&e.lat0&&e.projName==="Polar_Stereographic"&&(e.lat_ts=e.lat0,e.lat0=Qa(e.lat0>0?90:-90))}function Ox(e){var r=zI(e),a=r.shift(),u=r.shift();r.unshift(["name",u]),r.unshift(["type",a]);var d={};return Qc(r,d),BI(d),d}function _s(e){var r=this;if(arguments.length===2){var a=arguments[1];typeof a=="string"?a.charAt(0)==="+"?_s[e]=Em(arguments[1]):_s[e]=Ox(arguments[1]):_s[e]=a}else if(arguments.length===1){if(Array.isArray(e))return e.map(function(u){Array.isArray(u)?_s.apply(r,u):_s(u)});if(typeof e=="string"){if(e in _s)return _s[e]}else"EPSG"in e?_s["EPSG:"+e.EPSG]=e:"ESRI"in e?_s["ESRI:"+e.ESRI]=e:"IAU2000"in e?_s["IAU2000:"+e.IAU2000]=e:console.log(e);return}}EI(_s);function NI(e){return typeof e=="string"}function $I(e){return e in _s}var UI=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function VI(e){return UI.some(function(r){return e.indexOf(r)>-1})}var jI=["3857","900913","3785","102113"];function qI(e){var r=El(e,"authority");if(r){var a=El(r,"epsg");return a&&jI.indexOf(a)>-1}}function GI(e){var r=El(e,"extension");if(r)return El(r,"proj4")}function HI(e){return e[0]==="+"}function WI(e){if(NI(e)){if($I(e))return _s[e];if(VI(e)){var r=Ox(e);if(qI(r))return _s["EPSG:3857"];var a=GI(r);return a?Em(a):r}if(HI(e))return Em(e)}else return e}function u0(e,r){e=e||{};var a,u;if(!r)return e;for(u in r)a=r[u],a!==void 0&&(e[u]=a);return e}function ao(e,r,a){var u=e*r;return a/Math.sqrt(1-u*u)}function Jh(e){return e<0?-1:1}function qt(e){return Math.abs(e)<=pn?e:e-Jh(e)*Bh}function Fa(e,r,a){var u=e*a,d=.5*e;return u=Math.pow((1-u)/(1+u),d),Math.tan(.5*(gt-r))/u}function $h(e,r){for(var a=.5*e,u,d,g=gt-2*Math.atan(r),m=0;m<=15;m++)if(u=e*Math.sin(g),d=gt-2*Math.atan(r*Math.pow((1-u)/(1+u),a))-g,g+=d,Math.abs(d)<=1e-10)return g;return-9999}function ZI(){var e=this.b/this.a;this.es=1-e*e,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=ao(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function XI(e){var r=e.x,a=e.y;if(a*ro>90&&a*ro<-90&&r*ro>180&&r*ro<-180)return null;var u,d;if(Math.abs(Math.abs(a)-gt)<=zt)return null;if(this.sphere)u=this.x0+this.a*this.k0*qt(r-this.long0),d=this.y0+this.a*this.k0*Math.log(Math.tan(or+.5*a));else{var g=Math.sin(a),m=Fa(this.e,a,g);u=this.x0+this.a*this.k0*qt(r-this.long0),d=this.y0-this.a*this.k0*Math.log(m)}return e.x=u,e.y=d,e}function KI(e){var r=e.x-this.x0,a=e.y-this.y0,u,d;if(this.sphere)d=gt-2*Math.atan(Math.exp(-a/(this.a*this.k0)));else{var g=Math.exp(-a/(this.a*this.k0));if(d=$h(this.e,g),d===-9999)return null}return u=qt(this.long0+r/(this.a*this.k0)),e.x=u,e.y=d,e}var YI=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];const JI={init:ZI,forward:XI,inverse:KI,names:YI};function QI(){}function h0(e){return e}var eA=["longlat","identity"];const tA={init:QI,forward:h0,inverse:h0,names:eA};var iA=[JI,tA],Kd={},up=[];function Fx(e,r){var a=up.length;return e.names?(up[a]=e,e.names.forEach(function(u){Kd[u.toLowerCase()]=a}),this):(console.log(r),!0)}function rA(e){if(!e)return!1;var r=e.toLowerCase();if(typeof Kd[r]<"u"&&up[Kd[r]])return up[Kd[r]]}function nA(){iA.forEach(Fx)}const sA={start:nA,add:Fx,get:rA};var wi={};wi.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};wi.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};wi.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};wi.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};wi.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"};wi.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};wi.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};wi.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"};wi.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};wi.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};wi.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};wi.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"};wi.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};wi.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"};wi.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."};wi.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"};wi.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"};wi.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};wi.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};wi.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"};wi.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"};wi.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"};wi.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"};wi.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"};wi.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};wi.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};wi.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};wi.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};wi.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};wi.hough={a:6378270,rf:297,ellipseName:"Hough"};wi.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};wi.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};wi.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};wi.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};wi.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"};wi.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};wi.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};wi.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"};wi.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"};wi.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};wi.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};wi.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var aA=wi.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};wi.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function oA(e,r,a,u){var d=e*e,g=r*r,m=(d-g)/d,l=0;u?(e*=1-m*(II+m*(AI+m*PI)),d=e*e,m=0):l=Math.sqrt(m);var M=(d-g)/g;return{es:m,e:l,ep2:M}}function lA(e,r,a,u,d){if(!e){var g=El(wi,u);g||(g=aA),e=g.a,r=g.b,a=g.rf}return a&&!r&&(r=(1-1/a)*e),(a===0||Math.abs(e-r)<zt)&&(d=!0,r=e),{a:e,b:r,rf:a,sphere:d}}var Pn={};Pn.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"};Pn.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"};Pn.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"};Pn.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"};Pn.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"};Pn.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"};Pn.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"};Pn.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"};Pn.militargeographische_institut={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"};Pn.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"};Pn.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"};Pn.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"};Pn.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"};Pn.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"};Pn.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"};Pn.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"};Pn.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"};Pn.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};function cA(e,r,a,u,d,g,m){var l={};return e===void 0||e==="none"?l.datum_type=Sm:l.datum_type=TI,r&&(l.datum_params=r.map(parseFloat),(l.datum_params[0]!==0||l.datum_params[1]!==0||l.datum_params[2]!==0)&&(l.datum_type=uc),l.datum_params.length>3&&(l.datum_params[3]!==0||l.datum_params[4]!==0||l.datum_params[5]!==0||l.datum_params[6]!==0)&&(l.datum_type=hc,l.datum_params[3]*=Mh,l.datum_params[4]*=Mh,l.datum_params[5]*=Mh,l.datum_params[6]=l.datum_params[6]/1e6+1)),m&&(l.datum_type=cu,l.grids=m),l.a=a,l.b=u,l.es=d,l.ep2=g,l}var Bx={};function uA(e,r){var a=new DataView(r),u=pA(a),d=fA(a,u),g=mA(a,d,u),m={header:d,subgrids:g};return Bx[e]=m,m}function hA(e){if(e===void 0)return null;var r=e.split(",");return r.map(dA)}function dA(e){if(e.length===0)return null;var r=e[0]==="@";return r&&(e=e.slice(1)),e==="null"?{name:"null",mandatory:!r,grid:null,isNull:!0}:{name:e,mandatory:!r,grid:Bx[e]||null,isNull:!1}}function eu(e){return e/3600*Math.PI/180}function pA(e){var r=e.getInt32(8,!1);return r===11?!1:(r=e.getInt32(8,!0),r!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function fA(e,r){return{nFields:e.getInt32(8,r),nSubgridFields:e.getInt32(24,r),nSubgrids:e.getInt32(40,r),shiftType:Tm(e,56,64).trim(),fromSemiMajorAxis:e.getFloat64(120,r),fromSemiMinorAxis:e.getFloat64(136,r),toSemiMajorAxis:e.getFloat64(152,r),toSemiMinorAxis:e.getFloat64(168,r)}}function Tm(e,r,a){return String.fromCharCode.apply(null,new Uint8Array(e.buffer.slice(r,a)))}function mA(e,r,a){for(var u=176,d=[],g=0;g<r.nSubgrids;g++){var m=yA(e,u,a),l=_A(e,u,m,a),M=Math.round(1+(m.upperLongitude-m.lowerLongitude)/m.longitudeInterval),A=Math.round(1+(m.upperLatitude-m.lowerLatitude)/m.latitudeInterval);d.push({ll:[eu(m.lowerLongitude),eu(m.lowerLatitude)],del:[eu(m.longitudeInterval),eu(m.latitudeInterval)],lim:[M,A],count:m.gridNodeCount,cvs:gA(l)}),u+=176+m.gridNodeCount*16}return d}function gA(e){return e.map(function(r){return[eu(r.longitudeShift),eu(r.latitudeShift)]})}function yA(e,r,a){return{name:Tm(e,r+8,r+16).trim(),parent:Tm(e,r+24,r+24+8).trim(),lowerLatitude:e.getFloat64(r+72,a),upperLatitude:e.getFloat64(r+88,a),lowerLongitude:e.getFloat64(r+104,a),upperLongitude:e.getFloat64(r+120,a),latitudeInterval:e.getFloat64(r+136,a),longitudeInterval:e.getFloat64(r+152,a),gridNodeCount:e.getInt32(r+168,a)}}function _A(e,r,a,u){for(var d=r+176,g=16,m=[],l=0;l<a.gridNodeCount;l++){var M={latitudeShift:e.getFloat32(d+l*g,u),longitudeShift:e.getFloat32(d+l*g+4,u),latitudeAccuracy:e.getFloat32(d+l*g+8,u),longitudeAccuracy:e.getFloat32(d+l*g+12,u)};m.push(M)}return m}function no(e,r){if(!(this instanceof no))return new no(e);r=r||function(A){if(A)throw A};var a=WI(e);if(typeof a!="object"){r(e);return}var u=no.projections.get(a.projName);if(!u){r(e);return}if(a.datumCode&&a.datumCode!=="none"){var d=El(Pn,a.datumCode);d&&(a.datum_params=a.datum_params||(d.towgs84?d.towgs84.split(","):null),a.ellps=d.ellipse,a.datumName=d.datumName?d.datumName:a.datumCode)}a.k0=a.k0||1,a.axis=a.axis||"enu",a.ellps=a.ellps||"wgs84",a.lat1=a.lat1||a.lat0;var g=lA(a.a,a.b,a.rf,a.ellps,a.sphere),m=oA(g.a,g.b,g.rf,a.R_A),l=hA(a.nadgrids),M=a.datum||cA(a.datumCode,a.datum_params,g.a,g.b,m.es,m.ep2,l);u0(this,a),u0(this,u),this.a=g.a,this.b=g.b,this.rf=g.rf,this.sphere=g.sphere,this.es=m.es,this.e=m.e,this.ep2=m.ep2,this.datum=M,this.init(),r(null,this)}no.projections=sA;no.projections.start();function vA(e,r){return e.datum_type!==r.datum_type||e.a!==r.a||Math.abs(e.es-r.es)>5e-11?!1:e.datum_type===uc?e.datum_params[0]===r.datum_params[0]&&e.datum_params[1]===r.datum_params[1]&&e.datum_params[2]===r.datum_params[2]:e.datum_type===hc?e.datum_params[0]===r.datum_params[0]&&e.datum_params[1]===r.datum_params[1]&&e.datum_params[2]===r.datum_params[2]&&e.datum_params[3]===r.datum_params[3]&&e.datum_params[4]===r.datum_params[4]&&e.datum_params[5]===r.datum_params[5]&&e.datum_params[6]===r.datum_params[6]:!0}function Nx(e,r,a){var u=e.x,d=e.y,g=e.z?e.z:0,m,l,M,A;if(d<-gt&&d>-1.001*gt)d=-gt;else if(d>gt&&d<1.001*gt)d=gt;else{if(d<-gt)return{x:-1/0,y:-1/0,z:e.z};if(d>gt)return{x:1/0,y:1/0,z:e.z}}return u>Math.PI&&(u-=2*Math.PI),l=Math.sin(d),A=Math.cos(d),M=l*l,m=a/Math.sqrt(1-r*M),{x:(m+g)*A*Math.cos(u),y:(m+g)*A*Math.sin(u),z:(m*(1-r)+g)*l}}function $x(e,r,a,u){var d=1e-12,g=d*d,m=30,l,M,A,R,k,z,W,Z,X,fe,ye,we,ee,Ie=e.x,Ue=e.y,Xe=e.z?e.z:0,nt,ft,At;if(l=Math.sqrt(Ie*Ie+Ue*Ue),M=Math.sqrt(Ie*Ie+Ue*Ue+Xe*Xe),l/a<d){if(nt=0,M/a<d)return ft=gt,At=-u,{x:e.x,y:e.y,z:e.z}}else nt=Math.atan2(Ue,Ie);A=Xe/M,R=l/M,k=1/Math.sqrt(1-r*(2-r)*R*R),Z=R*(1-r)*k,X=A*k,ee=0;do ee++,W=a/Math.sqrt(1-r*X*X),At=l*Z+Xe*X-W*(1-r*X*X),z=r*W/(W+At),k=1/Math.sqrt(1-z*(2-z)*R*R),fe=R*(1-z)*k,ye=A*k,we=ye*Z-fe*X,Z=fe,X=ye;while(we*we>g&&ee<m);return ft=Math.atan(ye/Math.abs(fe)),{x:nt,y:ft,z:At}}function xA(e,r,a){if(r===uc)return{x:e.x+a[0],y:e.y+a[1],z:e.z+a[2]};if(r===hc){var u=a[0],d=a[1],g=a[2],m=a[3],l=a[4],M=a[5],A=a[6];return{x:A*(e.x-M*e.y+l*e.z)+u,y:A*(M*e.x+e.y-m*e.z)+d,z:A*(-l*e.x+m*e.y+e.z)+g}}}function bA(e,r,a){if(r===uc)return{x:e.x-a[0],y:e.y-a[1],z:e.z-a[2]};if(r===hc){var u=a[0],d=a[1],g=a[2],m=a[3],l=a[4],M=a[5],A=a[6],R=(e.x-u)/A,k=(e.y-d)/A,z=(e.z-g)/A;return{x:R+M*k-l*z,y:-M*R+k+m*z,z:l*R-m*k+z}}}function Nd(e){return e===uc||e===hc}function wA(e,r,a){if(vA(e,r)||e.datum_type===Sm||r.datum_type===Sm)return a;var u=e.a,d=e.es;if(e.datum_type===cu){var g=d0(e,!1,a);if(g!==0)return;u=a0,d=o0}var m=r.a,l=r.b,M=r.es;if(r.datum_type===cu&&(m=a0,l=CI,M=o0),d===M&&u===m&&!Nd(e.datum_type)&&!Nd(r.datum_type))return a;if(a=Nx(a,d,u),Nd(e.datum_type)&&(a=xA(a,e.datum_type,e.datum_params)),Nd(r.datum_type)&&(a=bA(a,r.datum_type,r.datum_params)),a=$x(a,M,m,l),r.datum_type===cu){var A=d0(r,!0,a);if(A!==0)return}return a}function d0(e,r,a){if(e.grids===null||e.grids.length===0)return console.log("Grid shift grids not found"),-1;var u={x:-a.x,y:a.y},d={x:Number.NaN,y:Number.NaN},g=[];e:for(var m=0;m<e.grids.length;m++){var l=e.grids[m];if(g.push(l.name),l.isNull){d=u;break}if(l.mandatory,l.grid===null){if(l.mandatory)return console.log("Unable to find mandatory grid '"+l.name+"'"),-1;continue}for(var M=l.grid.subgrids,A=0,R=M.length;A<R;A++){var k=M[A],z=(Math.abs(k.del[1])+Math.abs(k.del[0]))/1e4,W=k.ll[0]-z,Z=k.ll[1]-z,X=k.ll[0]+(k.lim[0]-1)*k.del[0]+z,fe=k.ll[1]+(k.lim[1]-1)*k.del[1]+z;if(!(Z>u.y||W>u.x||fe<u.y||X<u.x)&&(d=MA(u,r,k),!isNaN(d.x)))break e}}return isNaN(d.x)?(console.log("Failed to find a grid shift table for location '"+-u.x*ro+" "+u.y*ro+" tried: '"+g+"'"),-1):(a.x=-d.x,a.y=d.y,0)}function MA(e,r,a){var u={x:Number.NaN,y:Number.NaN};if(isNaN(e.x))return u;var d={x:e.x,y:e.y};d.x-=a.ll[0],d.y-=a.ll[1],d.x=qt(d.x-Math.PI)+Math.PI;var g=p0(d,a);if(r){if(isNaN(g.x))return u;g.x=d.x-g.x,g.y=d.y-g.y;var m=9,l=1e-12,M,A;do{if(A=p0(g,a),isNaN(A.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}M={x:d.x-(A.x+g.x),y:d.y-(A.y+g.y)},g.x+=M.x,g.y+=M.y}while(m--&&Math.abs(M.x)>l&&Math.abs(M.y)>l);if(m<0)return console.log("Inverse grid shift iterator failed to converge."),u;u.x=qt(g.x+a.ll[0]),u.y=g.y+a.ll[1]}else isNaN(g.x)||(u.x=e.x+g.x,u.y=e.y+g.y);return u}function p0(e,r){var a={x:e.x/r.del[0],y:e.y/r.del[1]},u={x:Math.floor(a.x),y:Math.floor(a.y)},d={x:a.x-1*u.x,y:a.y-1*u.y},g={x:Number.NaN,y:Number.NaN},m;if(u.x<0||u.x>=r.lim[0]||u.y<0||u.y>=r.lim[1])return g;m=u.y*r.lim[0]+u.x;var l={x:r.cvs[m][0],y:r.cvs[m][1]};m++;var M={x:r.cvs[m][0],y:r.cvs[m][1]};m+=r.lim[0];var A={x:r.cvs[m][0],y:r.cvs[m][1]};m--;var R={x:r.cvs[m][0],y:r.cvs[m][1]},k=d.x*d.y,z=d.x*(1-d.y),W=(1-d.x)*(1-d.y),Z=(1-d.x)*d.y;return g.x=W*l.x+z*M.x+Z*R.x+k*A.x,g.y=W*l.y+z*M.y+Z*R.y+k*A.y,g}function f0(e,r,a){var u=a.x,d=a.y,g=a.z||0,m,l,M,A={};for(M=0;M<3;M++)if(!(r&&M===2&&a.z===void 0))switch(M===0?(m=u,"ew".indexOf(e.axis[M])!==-1?l="x":l="y"):M===1?(m=d,"ns".indexOf(e.axis[M])!==-1?l="y":l="x"):(m=g,l="z"),e.axis[M]){case"e":A[l]=m;break;case"w":A[l]=-m;break;case"n":A[l]=m;break;case"s":A[l]=-m;break;case"u":a[l]!==void 0&&(A.z=m);break;case"d":a[l]!==void 0&&(A.z=-m);break;default:return null}return A}function Ux(e){var r={x:e[0],y:e[1]};return e.length>2&&(r.z=e[2]),e.length>3&&(r.m=e[3]),r}function SA(e){m0(e.x),m0(e.y)}function m0(e){if(typeof Number.isFinite=="function"){if(Number.isFinite(e))return;throw new TypeError("coordinates must be finite numbers")}if(typeof e!="number"||e!==e||!isFinite(e))throw new TypeError("coordinates must be finite numbers")}function EA(e,r){return(e.datum.datum_type===uc||e.datum.datum_type===hc||e.datum.datum_type===cu)&&r.datumCode!=="WGS84"||(r.datum.datum_type===uc||r.datum.datum_type===hc||r.datum.datum_type===cu)&&e.datumCode!=="WGS84"}function hp(e,r,a,u){var d;Array.isArray(a)?a=Ux(a):a={x:a.x,y:a.y,z:a.z,m:a.m};var g=a.z!==void 0;if(SA(a),e.datum&&r.datum&&EA(e,r)&&(d=new no("WGS84"),a=hp(e,d,a,u),e=d),u&&e.axis!=="enu"&&(a=f0(e,!1,a)),e.projName==="longlat")a={x:a.x*qn,y:a.y*qn,z:a.z||0};else if(e.to_meter&&(a={x:a.x*e.to_meter,y:a.y*e.to_meter,z:a.z||0}),a=e.inverse(a),!a)return;if(e.from_greenwich&&(a.x+=e.from_greenwich),a=wA(e.datum,r.datum,a),!!a)return r.from_greenwich&&(a={x:a.x-r.from_greenwich,y:a.y,z:a.z||0}),r.projName==="longlat"?a={x:a.x*ro,y:a.y*ro,z:a.z||0}:(a=r.forward(a),r.to_meter&&(a={x:a.x/r.to_meter,y:a.y/r.to_meter,z:a.z||0})),u&&r.axis!=="enu"?f0(r,!0,a):(a&&!g&&delete a.z,a)}var g0=no("WGS84");function Zf(e,r,a,u){var d,g,m;return Array.isArray(a)?(d=hp(e,r,a,u)||{x:NaN,y:NaN},a.length>2?typeof e.name<"u"&&e.name==="geocent"||typeof r.name<"u"&&r.name==="geocent"?typeof d.z=="number"?[d.x,d.y,d.z].concat(a.splice(3)):[d.x,d.y,a[2]].concat(a.splice(3)):[d.x,d.y].concat(a.splice(2)):[d.x,d.y]):(g=hp(e,r,a,u),m=Object.keys(a),m.length===2||m.forEach(function(l){if(typeof e.name<"u"&&e.name==="geocent"||typeof r.name<"u"&&r.name==="geocent"){if(l==="x"||l==="y"||l==="z")return}else if(l==="x"||l==="y")return;g[l]=a[l]}),g)}function y0(e){return e instanceof no?e:e.oProj?e.oProj:no(e)}function Os(e,r,a){e=y0(e);var u=!1,d;return typeof r>"u"?(r=e,e=g0,u=!0):(typeof r.x<"u"||Array.isArray(r))&&(a=r,r=e,e=g0,u=!0),r=y0(r),a?Zf(e,r,a):(d={forward:function(g,m){return Zf(e,r,g,m)},inverse:function(g,m){return Zf(r,e,g,m)}},u&&(d.oProj=r),d)}var _0=6,Vx="AJSAJS",jx="AFAFAF",tu=65,Ds=73,pa=79,fh=86,mh=90;const TA={forward:qx,inverse:CA,toPoint:Gx};function qx(e,r){return r=r||5,PA(IA({lat:e[1],lon:e[0]}),r)}function CA(e){var r=lg(Wx(e.toUpperCase()));return r.lat&&r.lon?[r.lon,r.lat,r.lon,r.lat]:[r.left,r.bottom,r.right,r.top]}function Gx(e){var r=lg(Wx(e.toUpperCase()));return r.lat&&r.lon?[r.lon,r.lat]:[(r.left+r.right)/2,(r.top+r.bottom)/2]}function Xf(e){return e*(Math.PI/180)}function v0(e){return 180*(e/Math.PI)}function IA(e){var r=e.lat,a=e.lon,u=6378137,d=.00669438,g=.9996,m,l,M,A,R,k,z,W=Xf(r),Z=Xf(a),X,fe;fe=Math.floor((a+180)/6)+1,a===180&&(fe=60),r>=56&&r<64&&a>=3&&a<12&&(fe=32),r>=72&&r<84&&(a>=0&&a<9?fe=31:a>=9&&a<21?fe=33:a>=21&&a<33?fe=35:a>=33&&a<42&&(fe=37)),m=(fe-1)*6-180+3,X=Xf(m),l=d/(1-d),M=u/Math.sqrt(1-d*Math.sin(W)*Math.sin(W)),A=Math.tan(W)*Math.tan(W),R=l*Math.cos(W)*Math.cos(W),k=Math.cos(W)*(Z-X),z=u*((1-d/4-3*d*d/64-5*d*d*d/256)*W-(3*d/8+3*d*d/32+45*d*d*d/1024)*Math.sin(2*W)+(15*d*d/256+45*d*d*d/1024)*Math.sin(4*W)-35*d*d*d/3072*Math.sin(6*W));var ye=g*M*(k+(1-A+R)*k*k*k/6+(5-18*A+A*A+72*R-58*l)*k*k*k*k*k/120)+5e5,we=g*(z+M*Math.tan(W)*(k*k/2+(5-A+9*R+4*R*R)*k*k*k*k/24+(61-58*A+A*A+600*R-330*l)*k*k*k*k*k*k/720));return r<0&&(we+=1e7),{northing:Math.round(we),easting:Math.round(ye),zoneNumber:fe,zoneLetter:AA(r)}}function lg(e){var r=e.northing,a=e.easting,u=e.zoneLetter,d=e.zoneNumber;if(d<0||d>60)return null;var g=.9996,m=6378137,l=.00669438,M,A=(1-Math.sqrt(1-l))/(1+Math.sqrt(1-l)),R,k,z,W,Z,X,fe,ye,we,ee=a-5e5,Ie=r;u<"N"&&(Ie-=1e7),fe=(d-1)*6-180+3,M=l/(1-l),X=Ie/g,ye=X/(m*(1-l/4-3*l*l/64-5*l*l*l/256)),we=ye+(3*A/2-27*A*A*A/32)*Math.sin(2*ye)+(21*A*A/16-55*A*A*A*A/32)*Math.sin(4*ye)+151*A*A*A/96*Math.sin(6*ye),R=m/Math.sqrt(1-l*Math.sin(we)*Math.sin(we)),k=Math.tan(we)*Math.tan(we),z=M*Math.cos(we)*Math.cos(we),W=m*(1-l)/Math.pow(1-l*Math.sin(we)*Math.sin(we),1.5),Z=ee/(R*g);var Ue=we-R*Math.tan(we)/W*(Z*Z/2-(5+3*k+10*z-4*z*z-9*M)*Z*Z*Z*Z/24+(61+90*k+298*z+45*k*k-252*M-3*z*z)*Z*Z*Z*Z*Z*Z/720);Ue=v0(Ue);var Xe=(Z-(1+2*k+z)*Z*Z*Z/6+(5-2*z+28*k-3*z*z+8*M+24*k*k)*Z*Z*Z*Z*Z/120)/Math.cos(we);Xe=fe+v0(Xe);var nt;if(e.accuracy){var ft=lg({northing:e.northing+e.accuracy,easting:e.easting+e.accuracy,zoneLetter:e.zoneLetter,zoneNumber:e.zoneNumber});nt={top:ft.lat,right:ft.lon,bottom:Ue,left:Xe}}else nt={lat:Ue,lon:Xe};return nt}function AA(e){var r="Z";return 84>=e&&e>=72?r="X":72>e&&e>=64?r="W":64>e&&e>=56?r="V":56>e&&e>=48?r="U":48>e&&e>=40?r="T":40>e&&e>=32?r="S":32>e&&e>=24?r="R":24>e&&e>=16?r="Q":16>e&&e>=8?r="P":8>e&&e>=0?r="N":0>e&&e>=-8?r="M":-8>e&&e>=-16?r="L":-16>e&&e>=-24?r="K":-24>e&&e>=-32?r="J":-32>e&&e>=-40?r="H":-40>e&&e>=-48?r="G":-48>e&&e>=-56?r="F":-56>e&&e>=-64?r="E":-64>e&&e>=-72?r="D":-72>e&&e>=-80&&(r="C"),r}function PA(e,r){var a="00000"+e.easting,u="00000"+e.northing;return e.zoneNumber+e.zoneLetter+kA(e.easting,e.northing,e.zoneNumber)+a.substr(a.length-5,r)+u.substr(u.length-5,r)}function kA(e,r,a){var u=Hx(a),d=Math.floor(e/1e5),g=Math.floor(r/1e5)%20;return DA(d,g,u)}function Hx(e){var r=e%_0;return r===0&&(r=_0),r}function DA(e,r,a){var u=a-1,d=Vx.charCodeAt(u),g=jx.charCodeAt(u),m=d+e-1,l=g+r,M=!1;m>mh&&(m=m-mh+tu-1,M=!0),(m===Ds||d<Ds&&m>Ds||(m>Ds||d<Ds)&&M)&&m++,(m===pa||d<pa&&m>pa||(m>pa||d<pa)&&M)&&(m++,m===Ds&&m++),m>mh&&(m=m-mh+tu-1),l>fh?(l=l-fh+tu-1,M=!0):M=!1,(l===Ds||g<Ds&&l>Ds||(l>Ds||g<Ds)&&M)&&l++,(l===pa||g<pa&&l>pa||(l>pa||g<pa)&&M)&&(l++,l===Ds&&l++),l>fh&&(l=l-fh+tu-1);var A=String.fromCharCode(m)+String.fromCharCode(l);return A}function Wx(e){if(e&&e.length===0)throw"MGRSPoint coverting from nothing";for(var r=e.length,a=null,u="",d,g=0;!/[A-Z]/.test(d=e.charAt(g));){if(g>=2)throw"MGRSPoint bad conversion from: "+e;u+=d,g++}var m=parseInt(u,10);if(g===0||g+3>r)throw"MGRSPoint bad conversion from: "+e;var l=e.charAt(g++);if(l<="A"||l==="B"||l==="Y"||l>="Z"||l==="I"||l==="O")throw"MGRSPoint zone letter "+l+" not handled: "+e;a=e.substring(g,g+=2);for(var M=Hx(m),A=LA(a.charAt(0),M),R=RA(a.charAt(1),M);R<zA(l);)R+=2e6;var k=r-g;if(k%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+e;var z=k/2,W=0,Z=0,X,fe,ye,we,ee;return z>0&&(X=1e5/Math.pow(10,z),fe=e.substring(g,g+z),W=parseFloat(fe)*X,ye=e.substring(g+z),Z=parseFloat(ye)*X),we=W+A,ee=Z+R,{easting:we,northing:ee,zoneLetter:l,zoneNumber:m,accuracy:X}}function LA(e,r){for(var a=Vx.charCodeAt(r-1),u=1e5,d=!1;a!==e.charCodeAt(0);){if(a++,a===Ds&&a++,a===pa&&a++,a>mh){if(d)throw"Bad character: "+e;a=tu,d=!0}u+=1e5}return u}function RA(e,r){if(e>"V")throw"MGRSPoint given invalid Northing "+e;for(var a=jx.charCodeAt(r-1),u=0,d=!1;a!==e.charCodeAt(0);){if(a++,a===Ds&&a++,a===pa&&a++,a>fh){if(d)throw"Bad character: "+e;a=tu,d=!0}u+=1e5}return u}function zA(e){var r;switch(e){case"C":r=11e5;break;case"D":r=2e6;break;case"E":r=28e5;break;case"F":r=37e5;break;case"G":r=46e5;break;case"H":r=55e5;break;case"J":r=64e5;break;case"K":r=73e5;break;case"L":r=82e5;break;case"M":r=91e5;break;case"N":r=0;break;case"P":r=8e5;break;case"Q":r=17e5;break;case"R":r=26e5;break;case"S":r=35e5;break;case"T":r=44e5;break;case"U":r=53e5;break;case"V":r=62e5;break;case"W":r=7e6;break;case"X":r=79e5;break;default:r=-1}if(r>=0)return r;throw"Invalid zone letter: "+e}function gu(e,r,a){if(!(this instanceof gu))return new gu(e,r,a);if(Array.isArray(e))this.x=e[0],this.y=e[1],this.z=e[2]||0;else if(typeof e=="object")this.x=e.x,this.y=e.y,this.z=e.z||0;else if(typeof e=="string"&&typeof r>"u"){var u=e.split(",");this.x=parseFloat(u[0],10),this.y=parseFloat(u[1],10),this.z=parseFloat(u[2],10)||0}else this.x=e,this.y=r,this.z=a||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}gu.fromMGRS=function(e){return new gu(Gx(e))};gu.prototype.toMGRS=function(e){return qx([this.x,this.y],e)};var OA=1,FA=.25,x0=.046875,b0=.01953125,w0=.01068115234375,BA=.75,NA=.46875,$A=.013020833333333334,UA=.007120768229166667,VA=.3645833333333333,jA=.005696614583333333,qA=.3076171875;function Zx(e){var r=[];r[0]=OA-e*(FA+e*(x0+e*(b0+e*w0))),r[1]=e*(BA-e*(x0+e*(b0+e*w0)));var a=e*e;return r[2]=a*(NA-e*($A+e*UA)),a*=e,r[3]=a*(VA-e*jA),r[4]=a*e*qA,r}function Np(e,r,a,u){return a*=r,r*=r,u[0]*e-a*(u[1]+r*(u[2]+r*(u[3]+r*u[4])))}var GA=20;function Xx(e,r,a){for(var u=1/(1-r),d=e,g=GA;g;--g){var m=Math.sin(d),l=1-r*m*m;if(l=(Np(d,m,Math.cos(d),a)-e)*(l*Math.sqrt(l))*u,d-=l,Math.abs(l)<zt)return d}return d}function HA(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=Zx(this.es),this.ml0=Np(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function WA(e){var r=e.x,a=e.y,u=qt(r-this.long0),d,g,m,l=Math.sin(a),M=Math.cos(a);if(this.es){var R=M*u,k=Math.pow(R,2),z=this.ep2*Math.pow(M,2),W=Math.pow(z,2),Z=Math.abs(M)>zt?Math.tan(a):0,X=Math.pow(Z,2),fe=Math.pow(X,2);d=1-this.es*Math.pow(l,2),R=R/Math.sqrt(d);var ye=Np(a,l,M,this.en);g=this.a*(this.k0*R*(1+k/6*(1-X+z+k/20*(5-18*X+fe+14*z-58*X*z+k/42*(61+179*fe-fe*X-479*X)))))+this.x0,m=this.a*(this.k0*(ye-this.ml0+l*u*R/2*(1+k/12*(5-X+9*z+4*W+k/30*(61+fe-58*X+270*z-330*X*z+k/56*(1385+543*fe-fe*X-3111*X))))))+this.y0}else{var A=M*Math.sin(u);if(Math.abs(Math.abs(A)-1)<zt)return 93;if(g=.5*this.a*this.k0*Math.log((1+A)/(1-A))+this.x0,m=M*Math.cos(u)/Math.sqrt(1-Math.pow(A,2)),A=Math.abs(m),A>=1){if(A-1>zt)return 93;m=0}else m=Math.acos(m);a<0&&(m=-m),m=this.a*this.k0*(m-this.lat0)+this.y0}return e.x=g,e.y=m,e}function ZA(e){var r,a,u,d,g=(e.x-this.x0)*(1/this.a),m=(e.y-this.y0)*(1/this.a);if(this.es)if(r=this.ml0+m/this.k0,a=Xx(r,this.es,this.en),Math.abs(a)<gt){var k=Math.sin(a),z=Math.cos(a),W=Math.abs(z)>zt?Math.tan(a):0,Z=this.ep2*Math.pow(z,2),X=Math.pow(Z,2),fe=Math.pow(W,2),ye=Math.pow(fe,2);r=1-this.es*Math.pow(k,2);var we=g*Math.sqrt(r)/this.k0,ee=Math.pow(we,2);r=r*W,u=a-r*ee/(1-this.es)*.5*(1-ee/12*(5+3*fe-9*Z*fe+Z-4*X-ee/30*(61+90*fe-252*Z*fe+45*ye+46*Z-ee/56*(1385+3633*fe+4095*ye+1574*ye*fe)))),d=qt(this.long0+we*(1-ee/6*(1+2*fe+Z-ee/20*(5+28*fe+24*ye+8*Z*fe+6*Z-ee/42*(61+662*fe+1320*ye+720*ye*fe))))/z)}else u=gt*Jh(m),d=0;else{var l=Math.exp(g/this.k0),M=.5*(l-1/l),A=this.lat0+m/this.k0,R=Math.cos(A);r=Math.sqrt((1-Math.pow(R,2))/(1+Math.pow(M,2))),u=Math.asin(r),m<0&&(u=-u),M===0&&R===0?d=0:d=qt(Math.atan2(M,R)+this.long0)}return e.x=d,e.y=u,e}var XA=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const Yd={init:HA,forward:WA,inverse:ZA,names:XA};function Kx(e){var r=Math.exp(e);return r=(r-1/r)/2,r}function fa(e,r){e=Math.abs(e),r=Math.abs(r);var a=Math.max(e,r),u=Math.min(e,r)/(a||1);return a*Math.sqrt(1+Math.pow(u,2))}function KA(e){var r=1+e,a=r-1;return a===0?e:e*Math.log(r)/a}function YA(e){var r=Math.abs(e);return r=KA(r*(1+r/(fa(1,r)+1))),e<0?-r:r}function cg(e,r){for(var a=2*Math.cos(2*r),u=e.length-1,d=e[u],g=0,m;--u>=0;)m=-g+a*d+e[u],g=d,d=m;return r+m*Math.sin(2*r)}function JA(e,r){for(var a=2*Math.cos(r),u=e.length-1,d=e[u],g=0,m;--u>=0;)m=-g+a*d+e[u],g=d,d=m;return Math.sin(r)*m}function QA(e){var r=Math.exp(e);return r=(r+1/r)/2,r}function Yx(e,r,a){for(var u=Math.sin(r),d=Math.cos(r),g=Kx(a),m=QA(a),l=2*d*m,M=-2*u*g,A=e.length-1,R=e[A],k=0,z=0,W=0,Z,X;--A>=0;)Z=z,X=k,z=R,k=W,R=-Z+l*z-M*k+e[A],W=-X+M*z+l*k;return l=u*m,M=d*g,[l*R-M*W,l*W+M*R]}function eP(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(Yd.init.apply(this),this.forward=Yd.forward,this.inverse=Yd.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var e=this.es/(1+Math.sqrt(1-this.es)),r=e/(2-e),a=r;this.cgb[0]=r*(2+r*(-2/3+r*(-2+r*(116/45+r*(26/45+r*(-2854/675)))))),this.cbg[0]=r*(-2+r*(2/3+r*(4/3+r*(-82/45+r*(32/45+r*(4642/4725)))))),a=a*r,this.cgb[1]=a*(7/3+r*(-8/5+r*(-227/45+r*(2704/315+r*(2323/945))))),this.cbg[1]=a*(5/3+r*(-16/15+r*(-13/9+r*(904/315+r*(-1522/945))))),a=a*r,this.cgb[2]=a*(56/15+r*(-136/35+r*(-1262/105+r*(73814/2835)))),this.cbg[2]=a*(-26/15+r*(34/21+r*(8/5+r*(-12686/2835)))),a=a*r,this.cgb[3]=a*(4279/630+r*(-332/35+r*(-399572/14175))),this.cbg[3]=a*(1237/630+r*(-12/5+r*(-24832/14175))),a=a*r,this.cgb[4]=a*(4174/315+r*(-144838/6237)),this.cbg[4]=a*(-734/315+r*(109598/31185)),a=a*r,this.cgb[5]=a*(601676/22275),this.cbg[5]=a*(444337/155925),a=Math.pow(r,2),this.Qn=this.k0/(1+r)*(1+a*(1/4+a*(1/64+a/256))),this.utg[0]=r*(-.5+r*(2/3+r*(-37/96+r*(1/360+r*(81/512+r*(-96199/604800)))))),this.gtu[0]=r*(.5+r*(-2/3+r*(5/16+r*(41/180+r*(-127/288+r*(7891/37800)))))),this.utg[1]=a*(-1/48+r*(-1/15+r*(437/1440+r*(-46/105+r*(1118711/3870720))))),this.gtu[1]=a*(13/48+r*(-3/5+r*(557/1440+r*(281/630+r*(-1983433/1935360))))),a=a*r,this.utg[2]=a*(-17/480+r*(37/840+r*(209/4480+r*(-5569/90720)))),this.gtu[2]=a*(61/240+r*(-103/140+r*(15061/26880+r*(167603/181440)))),a=a*r,this.utg[3]=a*(-4397/161280+r*(11/504+r*(830251/7257600))),this.gtu[3]=a*(49561/161280+r*(-179/168+r*(6601661/7257600))),a=a*r,this.utg[4]=a*(-4583/161280+r*(108847/3991680)),this.gtu[4]=a*(34729/80640+r*(-3418889/1995840)),a=a*r,this.utg[5]=a*(-20648693/638668800),this.gtu[5]=a*(212378941/319334400);var u=cg(this.cbg,this.lat0);this.Zb=-this.Qn*(u+JA(this.gtu,2*u))}function tP(e){var r=qt(e.x-this.long0),a=e.y;a=cg(this.cbg,a);var u=Math.sin(a),d=Math.cos(a),g=Math.sin(r),m=Math.cos(r);a=Math.atan2(u,m*d),r=Math.atan2(g*d,fa(u,d*m)),r=YA(Math.tan(r));var l=Yx(this.gtu,2*a,2*r);a=a+l[0],r=r+l[1];var M,A;return Math.abs(r)<=2.623395162778?(M=this.a*(this.Qn*r)+this.x0,A=this.a*(this.Qn*a+this.Zb)+this.y0):(M=1/0,A=1/0),e.x=M,e.y=A,e}function iP(e){var r=(e.x-this.x0)*(1/this.a),a=(e.y-this.y0)*(1/this.a);a=(a-this.Zb)/this.Qn,r=r/this.Qn;var u,d;if(Math.abs(r)<=2.623395162778){var g=Yx(this.utg,2*a,2*r);a=a+g[0],r=r+g[1],r=Math.atan(Kx(r));var m=Math.sin(a),l=Math.cos(a),M=Math.sin(r),A=Math.cos(r);a=Math.atan2(m*A,fa(M,A*l)),r=Math.atan2(M,A*l),u=qt(r+this.long0),d=cg(this.cgb,a)}else u=1/0,d=1/0;return e.x=u,e.y=d,e}var rP=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const Jd={init:eP,forward:tP,inverse:iP,names:rP};function nP(e,r){if(e===void 0){if(e=Math.floor((qt(r)+Math.PI)*30/Math.PI)+1,e<0)return 0;if(e>60)return 60}return e}var sP="etmerc";function aP(){var e=nP(this.zone,this.long0);if(e===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(e)-183)*qn,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Jd.init.apply(this),this.forward=Jd.forward,this.inverse=Jd.inverse}var oP=["Universal Transverse Mercator System","utm"];const lP={init:aP,names:oP,dependsOn:sP};function ug(e,r){return Math.pow((1-e)/(1+e),r)}var cP=20;function uP(){var e=Math.sin(this.lat0),r=Math.cos(this.lat0);r*=r,this.rc=Math.sqrt(1-this.es)/(1-this.es*e*e),this.C=Math.sqrt(1+this.es*r*r/(1-this.es)),this.phic0=Math.asin(e/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+or)/(Math.pow(Math.tan(.5*this.lat0+or),this.C)*ug(this.e*e,this.ratexp))}function hP(e){var r=e.x,a=e.y;return e.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*a+or),this.C)*ug(this.e*Math.sin(a),this.ratexp))-gt,e.x=this.C*r,e}function dP(e){for(var r=1e-14,a=e.x/this.C,u=e.y,d=Math.pow(Math.tan(.5*u+or)/this.K,1/this.C),g=cP;g>0&&(u=2*Math.atan(d*ug(this.e*Math.sin(e.y),-.5*this.e))-gt,!(Math.abs(u-e.y)<r));--g)e.y=u;return g?(e.x=a,e.y=u,e):null}var pP=["gauss"];const hg={init:uP,forward:hP,inverse:dP,names:pP};function fP(){hg.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function mP(e){var r,a,u,d;return e.x=qt(e.x-this.long0),hg.forward.apply(this,[e]),r=Math.sin(e.y),a=Math.cos(e.y),u=Math.cos(e.x),d=this.k0*this.R2/(1+this.sinc0*r+this.cosc0*a*u),e.x=d*a*Math.sin(e.x),e.y=d*(this.cosc0*r-this.sinc0*a*u),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function gP(e){var r,a,u,d,g;if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,g=fa(e.x,e.y)){var m=2*Math.atan2(g,this.R2);r=Math.sin(m),a=Math.cos(m),d=Math.asin(a*this.sinc0+e.y*r*this.cosc0/g),u=Math.atan2(e.x*r,g*this.cosc0*a-e.y*this.sinc0*r)}else d=this.phic0,u=0;return e.x=u,e.y=d,hg.inverse.apply(this,[e]),e.x=qt(e.x+this.long0),e}var yP=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const _P={init:fP,forward:mP,inverse:gP,names:yP};function vP(e,r,a){return r*=a,Math.tan(.5*(gt+e))*Math.pow((1-r)/(1+r),.5*a)}function xP(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=zt&&(this.k0=.5*(1+Jh(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=zt&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=zt&&Math.abs(Math.cos(this.lat_ts))>zt&&(this.k0=.5*this.cons*ao(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Fa(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=ao(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-gt,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function bP(e){var r=e.x,a=e.y,u=Math.sin(a),d=Math.cos(a),g,m,l,M,A,R,k=qt(r-this.long0);return Math.abs(Math.abs(r-this.long0)-Math.PI)<=zt&&Math.abs(a+this.lat0)<=zt?(e.x=NaN,e.y=NaN,e):this.sphere?(g=2*this.k0/(1+this.sinlat0*u+this.coslat0*d*Math.cos(k)),e.x=this.a*g*d*Math.sin(k)+this.x0,e.y=this.a*g*(this.coslat0*u-this.sinlat0*d*Math.cos(k))+this.y0,e):(m=2*Math.atan(this.ssfn_(a,u,this.e))-gt,M=Math.cos(m),l=Math.sin(m),Math.abs(this.coslat0)<=zt?(A=Fa(this.e,a*this.con,this.con*u),R=2*this.a*this.k0*A/this.cons,e.x=this.x0+R*Math.sin(r-this.long0),e.y=this.y0-this.con*R*Math.cos(r-this.long0),e):(Math.abs(this.sinlat0)<zt?(g=2*this.a*this.k0/(1+M*Math.cos(k)),e.y=g*l):(g=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*l+this.cosX0*M*Math.cos(k))),e.y=g*(this.cosX0*l-this.sinX0*M*Math.cos(k))+this.y0),e.x=g*M*Math.sin(k)+this.x0,e))}function wP(e){e.x-=this.x0,e.y-=this.y0;var r,a,u,d,g,m=Math.sqrt(e.x*e.x+e.y*e.y);if(this.sphere){var l=2*Math.atan(m/(2*this.a*this.k0));return r=this.long0,a=this.lat0,m<=zt?(e.x=r,e.y=a,e):(a=Math.asin(Math.cos(l)*this.sinlat0+e.y*Math.sin(l)*this.coslat0/m),Math.abs(this.coslat0)<zt?this.lat0>0?r=qt(this.long0+Math.atan2(e.x,-1*e.y)):r=qt(this.long0+Math.atan2(e.x,e.y)):r=qt(this.long0+Math.atan2(e.x*Math.sin(l),m*this.coslat0*Math.cos(l)-e.y*this.sinlat0*Math.sin(l))),e.x=r,e.y=a,e)}else if(Math.abs(this.coslat0)<=zt){if(m<=zt)return a=this.lat0,r=this.long0,e.x=r,e.y=a,e;e.x*=this.con,e.y*=this.con,u=m*this.cons/(2*this.a*this.k0),a=this.con*$h(this.e,u),r=this.con*qt(this.con*this.long0+Math.atan2(e.x,-1*e.y))}else d=2*Math.atan(m*this.cosX0/(2*this.a*this.k0*this.ms1)),r=this.long0,m<=zt?g=this.X0:(g=Math.asin(Math.cos(d)*this.sinX0+e.y*Math.sin(d)*this.cosX0/m),r=qt(this.long0+Math.atan2(e.x*Math.sin(d),m*this.cosX0*Math.cos(d)-e.y*this.sinX0*Math.sin(d)))),a=-1*$h(this.e,Math.tan(.5*(gt+g)));return e.x=r,e.y=a,e}var MP=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"];const SP={init:xP,forward:bP,inverse:wP,names:MP,ssfn_:vP};function EP(){var e=this.lat0;this.lambda0=this.long0;var r=Math.sin(e),a=this.a,u=this.rf,d=1/u,g=2*d-Math.pow(d,2),m=this.e=Math.sqrt(g);this.R=this.k0*a*Math.sqrt(1-g)/(1-g*Math.pow(r,2)),this.alpha=Math.sqrt(1+g/(1-g)*Math.pow(Math.cos(e),4)),this.b0=Math.asin(r/this.alpha);var l=Math.log(Math.tan(Math.PI/4+this.b0/2)),M=Math.log(Math.tan(Math.PI/4+e/2)),A=Math.log((1+m*r)/(1-m*r));this.K=l-this.alpha*M+this.alpha*m/2*A}function TP(e){var r=Math.log(Math.tan(Math.PI/4-e.y/2)),a=this.e/2*Math.log((1+this.e*Math.sin(e.y))/(1-this.e*Math.sin(e.y))),u=-this.alpha*(r+a)+this.K,d=2*(Math.atan(Math.exp(u))-Math.PI/4),g=this.alpha*(e.x-this.lambda0),m=Math.atan(Math.sin(g)/(Math.sin(this.b0)*Math.tan(d)+Math.cos(this.b0)*Math.cos(g))),l=Math.asin(Math.cos(this.b0)*Math.sin(d)-Math.sin(this.b0)*Math.cos(d)*Math.cos(g));return e.y=this.R/2*Math.log((1+Math.sin(l))/(1-Math.sin(l)))+this.y0,e.x=this.R*m+this.x0,e}function CP(e){for(var r=e.x-this.x0,a=e.y-this.y0,u=r/this.R,d=2*(Math.atan(Math.exp(a/this.R))-Math.PI/4),g=Math.asin(Math.cos(this.b0)*Math.sin(d)+Math.sin(this.b0)*Math.cos(d)*Math.cos(u)),m=Math.atan(Math.sin(u)/(Math.cos(this.b0)*Math.cos(u)-Math.sin(this.b0)*Math.tan(d))),l=this.lambda0+m/this.alpha,M=0,A=g,R=-1e3,k=0;Math.abs(A-R)>1e-7;){if(++k>20)return;M=1/this.alpha*(Math.log(Math.tan(Math.PI/4+g/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(A))/2)),R=A,A=2*Math.atan(Math.exp(M))-Math.PI/2}return e.x=l,e.y=A,e}var IP=["somerc"];const AP={init:EP,forward:TP,inverse:CP,names:IP};var Jc=1e-7;function PP(e){var r=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],a=typeof e.PROJECTION=="object"?Object.keys(e.PROJECTION)[0]:e.PROJECTION;return"no_uoff"in e||"no_off"in e||r.indexOf(a)!==-1}function kP(){var e,r,a,u,d,g,m,l,M,A,R=0,k,z=0,W=0,Z=0,X=0,fe=0,ye=0;this.no_off=PP(this),this.no_rot="no_rot"in this;var we=!1;"alpha"in this&&(we=!0);var ee=!1;if("rectified_grid_angle"in this&&(ee=!0),we&&(ye=this.alpha),ee&&(R=this.rectified_grid_angle*qn),we||ee)z=this.longc;else if(W=this.long1,X=this.lat1,Z=this.long2,fe=this.lat2,Math.abs(X-fe)<=Jc||(e=Math.abs(X))<=Jc||Math.abs(e-gt)<=Jc||Math.abs(Math.abs(this.lat0)-gt)<=Jc||Math.abs(Math.abs(fe)-gt)<=Jc)throw new Error;var Ie=1-this.es;r=Math.sqrt(Ie),Math.abs(this.lat0)>zt?(l=Math.sin(this.lat0),a=Math.cos(this.lat0),e=1-this.es*l*l,this.B=a*a,this.B=Math.sqrt(1+this.es*this.B*this.B/Ie),this.A=this.B*this.k0*r/e,u=this.B*r/(a*Math.sqrt(e)),d=u*u-1,d<=0?d=0:(d=Math.sqrt(d),this.lat0<0&&(d=-d)),this.E=d+=u,this.E*=Math.pow(Fa(this.e,this.lat0,l),this.B)):(this.B=1/r,this.A=this.k0,this.E=u=d=1),we||ee?(we?(k=Math.asin(Math.sin(ye)/u),ee||(R=ye)):(k=R,ye=Math.asin(u*Math.sin(k))),this.lam0=z-Math.asin(.5*(d-1/d)*Math.tan(k))/this.B):(g=Math.pow(Fa(this.e,X,Math.sin(X)),this.B),m=Math.pow(Fa(this.e,fe,Math.sin(fe)),this.B),d=this.E/g,M=(m-g)/(m+g),A=this.E*this.E,A=(A-m*g)/(A+m*g),e=W-Z,e<-Math.pi?Z-=Bh:e>Math.pi&&(Z+=Bh),this.lam0=qt(.5*(W+Z)-Math.atan(A*Math.tan(.5*this.B*(W-Z))/M)/this.B),k=Math.atan(2*Math.sin(this.B*qt(W-this.lam0))/(d-1/d)),R=ye=Math.asin(u*Math.sin(k))),this.singam=Math.sin(k),this.cosgam=Math.cos(k),this.sinrot=Math.sin(R),this.cosrot=Math.cos(R),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(u*u-1)/Math.cos(ye))),this.lat0<0&&(this.u_0=-this.u_0)),d=.5*k,this.v_pole_n=this.ArB*Math.log(Math.tan(or-d)),this.v_pole_s=this.ArB*Math.log(Math.tan(or+d))}function DP(e){var r={},a,u,d,g,m,l,M,A;if(e.x=e.x-this.lam0,Math.abs(Math.abs(e.y)-gt)>zt){if(m=this.E/Math.pow(Fa(this.e,e.y,Math.sin(e.y)),this.B),l=1/m,a=.5*(m-l),u=.5*(m+l),g=Math.sin(this.B*e.x),d=(a*this.singam-g*this.cosgam)/u,Math.abs(Math.abs(d)-1)<zt)throw new Error;A=.5*this.ArB*Math.log((1-d)/(1+d)),l=Math.cos(this.B*e.x),Math.abs(l)<Jc?M=this.A*e.x:M=this.ArB*Math.atan2(a*this.cosgam+g*this.singam,l)}else A=e.y>0?this.v_pole_n:this.v_pole_s,M=this.ArB*e.y;return this.no_rot?(r.x=M,r.y=A):(M-=this.u_0,r.x=A*this.cosrot+M*this.sinrot,r.y=M*this.cosrot-A*this.sinrot),r.x=this.a*r.x+this.x0,r.y=this.a*r.y+this.y0,r}function LP(e){var r,a,u,d,g,m,l,M={};if(e.x=(e.x-this.x0)*(1/this.a),e.y=(e.y-this.y0)*(1/this.a),this.no_rot?(a=e.y,r=e.x):(a=e.x*this.cosrot-e.y*this.sinrot,r=e.y*this.cosrot+e.x*this.sinrot+this.u_0),u=Math.exp(-this.BrA*a),d=.5*(u-1/u),g=.5*(u+1/u),m=Math.sin(this.BrA*r),l=(m*this.cosgam+d*this.singam)/g,Math.abs(Math.abs(l)-1)<zt)M.x=0,M.y=l<0?-gt:gt;else{if(M.y=this.E/Math.sqrt((1+l)/(1-l)),M.y=$h(this.e,Math.pow(M.y,1/this.B)),M.y===1/0)throw new Error;M.x=-this.rB*Math.atan2(d*this.cosgam-m*this.singam,Math.cos(this.BrA*r))}return M.x+=this.lam0,M}var RP=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const zP={init:kP,forward:DP,inverse:LP,names:RP};function OP(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<zt)){var e=this.b/this.a;this.e=Math.sqrt(1-e*e);var r=Math.sin(this.lat1),a=Math.cos(this.lat1),u=ao(this.e,r,a),d=Fa(this.e,this.lat1,r),g=Math.sin(this.lat2),m=Math.cos(this.lat2),l=ao(this.e,g,m),M=Fa(this.e,this.lat2,g),A=Fa(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>zt?this.ns=Math.log(u/l)/Math.log(d/M):this.ns=r,isNaN(this.ns)&&(this.ns=r),this.f0=u/(this.ns*Math.pow(d,this.ns)),this.rh=this.a*this.f0*Math.pow(A,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function FP(e){var r=e.x,a=e.y;Math.abs(2*Math.abs(a)-Math.PI)<=zt&&(a=Jh(a)*(gt-2*zt));var u=Math.abs(Math.abs(a)-gt),d,g;if(u>zt)d=Fa(this.e,a,Math.sin(a)),g=this.a*this.f0*Math.pow(d,this.ns);else{if(u=a*this.ns,u<=0)return null;g=0}var m=this.ns*qt(r-this.long0);return e.x=this.k0*(g*Math.sin(m))+this.x0,e.y=this.k0*(this.rh-g*Math.cos(m))+this.y0,e}function BP(e){var r,a,u,d,g,m=(e.x-this.x0)/this.k0,l=this.rh-(e.y-this.y0)/this.k0;this.ns>0?(r=Math.sqrt(m*m+l*l),a=1):(r=-Math.sqrt(m*m+l*l),a=-1);var M=0;if(r!==0&&(M=Math.atan2(a*m,a*l)),r!==0||this.ns>0){if(a=1/this.ns,u=Math.pow(r/(this.a*this.f0),a),d=$h(this.e,u),d===-9999)return null}else d=-gt;return g=qt(M/this.ns+this.long0),e.x=g,e.y=d,e}var NP=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const $P={init:OP,forward:FP,inverse:BP,names:NP};function UP(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function VP(e){var r,a,u,d,g,m,l,M=e.x,A=e.y,R=qt(M-this.long0);return r=Math.pow((1+this.e*Math.sin(A))/(1-this.e*Math.sin(A)),this.alfa*this.e/2),a=2*(Math.atan(this.k*Math.pow(Math.tan(A/2+this.s45),this.alfa)/r)-this.s45),u=-R*this.alfa,d=Math.asin(Math.cos(this.ad)*Math.sin(a)+Math.sin(this.ad)*Math.cos(a)*Math.cos(u)),g=Math.asin(Math.cos(a)*Math.sin(u)/Math.cos(d)),m=this.n*g,l=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(d/2+this.s45),this.n),e.y=l*Math.cos(m)/1,e.x=l*Math.sin(m)/1,this.czech||(e.y*=-1,e.x*=-1),e}function jP(e){var r,a,u,d,g,m,l,M,A=e.x;e.x=e.y,e.y=A,this.czech||(e.y*=-1,e.x*=-1),m=Math.sqrt(e.x*e.x+e.y*e.y),g=Math.atan2(e.y,e.x),d=g/Math.sin(this.s0),u=2*(Math.atan(Math.pow(this.ro0/m,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),r=Math.asin(Math.cos(this.ad)*Math.sin(u)-Math.sin(this.ad)*Math.cos(u)*Math.cos(d)),a=Math.asin(Math.cos(u)*Math.sin(d)/Math.cos(r)),e.x=this.long0-a/this.alfa,l=r,M=0;var R=0;do e.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(r/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(l))/(1-this.e*Math.sin(l)),this.e/2))-this.s45),Math.abs(l-e.y)<1e-10&&(M=1),l=e.y,R+=1;while(M===0&&R<15);return R>=15?null:e}var qP=["Krovak","krovak"];const GP={init:UP,forward:VP,inverse:jP,names:qP};function xs(e,r,a,u,d){return e*d-r*Math.sin(2*d)+a*Math.sin(4*d)-u*Math.sin(6*d)}function Qh(e){return 1-.25*e*(1+e/16*(3+1.25*e))}function ed(e){return .375*e*(1+.25*e*(1+.46875*e))}function td(e){return .05859375*e*e*(1+.75*e)}function id(e){return e*e*e*(35/3072)}function yu(e,r,a){var u=r*a;return e/Math.sqrt(1-u*u)}function wu(e){return Math.abs(e)<gt?e:e-Jh(e)*Math.PI}function dp(e,r,a,u,d){var g,m;g=e/r;for(var l=0;l<15;l++)if(m=(e-(r*g-a*Math.sin(2*g)+u*Math.sin(4*g)-d*Math.sin(6*g)))/(r-2*a*Math.cos(2*g)+4*u*Math.cos(4*g)-6*d*Math.cos(6*g)),g+=m,Math.abs(m)<=1e-10)return g;return NaN}function HP(){this.sphere||(this.e0=Qh(this.es),this.e1=ed(this.es),this.e2=td(this.es),this.e3=id(this.es),this.ml0=this.a*xs(this.e0,this.e1,this.e2,this.e3,this.lat0))}function WP(e){var r,a,u=e.x,d=e.y;if(u=qt(u-this.long0),this.sphere)r=this.a*Math.asin(Math.cos(d)*Math.sin(u)),a=this.a*(Math.atan2(Math.tan(d),Math.cos(u))-this.lat0);else{var g=Math.sin(d),m=Math.cos(d),l=yu(this.a,this.e,g),M=Math.tan(d)*Math.tan(d),A=u*Math.cos(d),R=A*A,k=this.es*m*m/(1-this.es),z=this.a*xs(this.e0,this.e1,this.e2,this.e3,d);r=l*A*(1-R*M*(1/6-(8-M+8*k)*R/120)),a=z-this.ml0+l*g/m*R*(.5+(5-M+6*k)*R/24)}return e.x=r+this.x0,e.y=a+this.y0,e}function ZP(e){e.x-=this.x0,e.y-=this.y0;var r=e.x/this.a,a=e.y/this.a,u,d;if(this.sphere){var g=a+this.lat0;u=Math.asin(Math.sin(g)*Math.cos(r)),d=Math.atan2(Math.tan(r),Math.cos(g))}else{var m=this.ml0/this.a+a,l=dp(m,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(l)-gt)<=zt)return e.x=this.long0,e.y=gt,a<0&&(e.y*=-1),e;var M=yu(this.a,this.e,Math.sin(l)),A=M*M*M/this.a/this.a*(1-this.es),R=Math.pow(Math.tan(l),2),k=r*this.a/M,z=k*k;u=l-M*Math.tan(l)/A*k*k*(.5-(1+3*R)*k*k/24),d=k*(1-z*(R/3+(1+3*R)*R*z/15))/Math.cos(l)}return e.x=qt(d+this.long0),e.y=wu(u),e}var XP=["Cassini","Cassini_Soldner","cass"];const KP={init:HP,forward:WP,inverse:ZP,names:XP};function wl(e,r){var a;return e>1e-7?(a=e*r,(1-e*e)*(r/(1-a*a)-.5/e*Math.log((1-a)/(1+a)))):2*r}var YP=1,JP=2,QP=3,ek=4;function tk(){var e=Math.abs(this.lat0);if(Math.abs(e-gt)<zt?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<zt?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var r;switch(this.qp=wl(this.e,1),this.mmf=.5/(1-this.es),this.apa=uk(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),r=Math.sin(this.lat0),this.sinb1=wl(this.e,r)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*r*r)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function ik(e){var r,a,u,d,g,m,l,M,A,R,k=e.x,z=e.y;if(k=qt(k-this.long0),this.sphere){if(g=Math.sin(z),R=Math.cos(z),u=Math.cos(k),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(a=this.mode===this.EQUIT?1+R*u:1+this.sinph0*g+this.cosph0*R*u,a<=zt)return null;a=Math.sqrt(2/a),r=a*R*Math.sin(k),a*=this.mode===this.EQUIT?g:this.cosph0*g-this.sinph0*R*u}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(u=-u),Math.abs(z+this.lat0)<zt)return null;a=or-z*.5,a=2*(this.mode===this.S_POLE?Math.cos(a):Math.sin(a)),r=a*Math.sin(k),a*=u}}else{switch(l=0,M=0,A=0,u=Math.cos(k),d=Math.sin(k),g=Math.sin(z),m=wl(this.e,g),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(l=m/this.qp,M=Math.sqrt(1-l*l)),this.mode){case this.OBLIQ:A=1+this.sinb1*l+this.cosb1*M*u;break;case this.EQUIT:A=1+M*u;break;case this.N_POLE:A=gt+z,m=this.qp-m;break;case this.S_POLE:A=z-gt,m=this.qp+m;break}if(Math.abs(A)<zt)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:A=Math.sqrt(2/A),this.mode===this.OBLIQ?a=this.ymf*A*(this.cosb1*l-this.sinb1*M*u):a=(A=Math.sqrt(2/(1+M*u)))*l*this.ymf,r=this.xmf*A*M*d;break;case this.N_POLE:case this.S_POLE:m>=0?(r=(A=Math.sqrt(m))*d,a=u*(this.mode===this.S_POLE?A:-A)):r=a=0;break}}return e.x=this.a*r+this.x0,e.y=this.a*a+this.y0,e}function rk(e){e.x-=this.x0,e.y-=this.y0;var r=e.x/this.a,a=e.y/this.a,u,d,g,m,l,M,A;if(this.sphere){var R=0,k,z=0;if(k=Math.sqrt(r*r+a*a),d=k*.5,d>1)return null;switch(d=2*Math.asin(d),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(z=Math.sin(d),R=Math.cos(d)),this.mode){case this.EQUIT:d=Math.abs(k)<=zt?0:Math.asin(a*z/k),r*=z,a=R*k;break;case this.OBLIQ:d=Math.abs(k)<=zt?this.lat0:Math.asin(R*this.sinph0+a*z*this.cosph0/k),r*=z*this.cosph0,a=(R-Math.sin(d)*this.sinph0)*k;break;case this.N_POLE:a=-a,d=gt-d;break;case this.S_POLE:d-=gt;break}u=a===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(r,a)}else{if(A=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(r/=this.dd,a*=this.dd,M=Math.sqrt(r*r+a*a),M<zt)return e.x=this.long0,e.y=this.lat0,e;m=2*Math.asin(.5*M/this.rq),g=Math.cos(m),r*=m=Math.sin(m),this.mode===this.OBLIQ?(A=g*this.sinb1+a*m*this.cosb1/M,l=this.qp*A,a=M*this.cosb1*g-a*this.sinb1*m):(A=a*m/M,l=this.qp*A,a=M*g)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(a=-a),l=r*r+a*a,!l)return e.x=this.long0,e.y=this.lat0,e;A=1-l/this.qp,this.mode===this.S_POLE&&(A=-A)}u=Math.atan2(r,a),d=hk(Math.asin(A),this.apa)}return e.x=qt(this.long0+u),e.y=d,e}var nk=.3333333333333333,sk=.17222222222222222,ak=.10257936507936508,ok=.06388888888888888,lk=.0664021164021164,ck=.016415012942191543;function uk(e){var r,a=[];return a[0]=e*nk,r=e*e,a[0]+=r*sk,a[1]=r*ok,r*=e,a[0]+=r*ak,a[1]+=r*lk,a[2]=r*ck,a}function hk(e,r){var a=e+e;return e+r[0]*Math.sin(a)+r[1]*Math.sin(a+a)+r[2]*Math.sin(a+a+a)}var dk=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const pk={init:tk,forward:ik,inverse:rk,names:dk,S_POLE:YP,N_POLE:JP,EQUIT:QP,OBLIQ:ek};function Tl(e){return Math.abs(e)>1&&(e=e>1?1:-1),Math.asin(e)}function fk(){Math.abs(this.lat1+this.lat2)<zt||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=ao(this.e3,this.sin_po,this.cos_po),this.qs1=wl(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=ao(this.e3,this.sin_po,this.cos_po),this.qs2=wl(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=wl(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>zt?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function mk(e){var r=e.x,a=e.y;this.sin_phi=Math.sin(a),this.cos_phi=Math.cos(a);var u=wl(this.e3,this.sin_phi),d=this.a*Math.sqrt(this.c-this.ns0*u)/this.ns0,g=this.ns0*qt(r-this.long0),m=d*Math.sin(g)+this.x0,l=this.rh-d*Math.cos(g)+this.y0;return e.x=m,e.y=l,e}function gk(e){var r,a,u,d,g,m;return e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns0>=0?(r=Math.sqrt(e.x*e.x+e.y*e.y),u=1):(r=-Math.sqrt(e.x*e.x+e.y*e.y),u=-1),d=0,r!==0&&(d=Math.atan2(u*e.x,u*e.y)),u=r*this.ns0/this.a,this.sphere?m=Math.asin((this.c-u*u)/(2*this.ns0)):(a=(this.c-u*u)/this.ns0,m=this.phi1z(this.e3,a)),g=qt(d/this.ns0+this.long0),e.x=g,e.y=m,e}function yk(e,r){var a,u,d,g,m,l=Tl(.5*r);if(e<zt)return l;for(var M=e*e,A=1;A<=25;A++)if(a=Math.sin(l),u=Math.cos(l),d=e*a,g=1-d*d,m=.5*g*g/u*(r/(1-M)-a/g+.5/e*Math.log((1-d)/(1+d))),l=l+m,Math.abs(m)<=1e-7)return l;return null}var _k=["Albers_Conic_Equal_Area","Albers","aea"];const vk={init:fk,forward:mk,inverse:gk,names:_k,phi1z:yk};function xk(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function bk(e){var r,a,u,d,g,m,l,M,A=e.x,R=e.y;return u=qt(A-this.long0),r=Math.sin(R),a=Math.cos(R),d=Math.cos(u),m=this.sin_p14*r+this.cos_p14*a*d,g=1,m>0||Math.abs(m)<=zt?(l=this.x0+this.a*g*a*Math.sin(u)/m,M=this.y0+this.a*g*(this.cos_p14*r-this.sin_p14*a*d)/m):(l=this.x0+this.infinity_dist*a*Math.sin(u),M=this.y0+this.infinity_dist*(this.cos_p14*r-this.sin_p14*a*d)),e.x=l,e.y=M,e}function wk(e){var r,a,u,d,g,m;return e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,(r=Math.sqrt(e.x*e.x+e.y*e.y))?(d=Math.atan2(r,this.rc),a=Math.sin(d),u=Math.cos(d),m=Tl(u*this.sin_p14+e.y*a*this.cos_p14/r),g=Math.atan2(e.x*a,r*this.cos_p14*u-e.y*this.sin_p14*a),g=qt(this.long0+g)):(m=this.phic0,g=0),e.x=g,e.y=m,e}var Mk=["gnom"];const Sk={init:xk,forward:bk,inverse:wk,names:Mk};function Ek(e,r){var a=1-(1-e*e)/(2*e)*Math.log((1-e)/(1+e));if(Math.abs(Math.abs(r)-a)<1e-6)return r<0?-1*gt:gt;for(var u=Math.asin(.5*r),d,g,m,l,M=0;M<30;M++)if(g=Math.sin(u),m=Math.cos(u),l=e*g,d=Math.pow(1-l*l,2)/(2*m)*(r/(1-e*e)-g/(1-l*l)+.5/e*Math.log((1-l)/(1+l))),u+=d,Math.abs(d)<=1e-10)return u;return NaN}function Tk(){this.sphere||(this.k0=ao(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function Ck(e){var r=e.x,a=e.y,u,d,g=qt(r-this.long0);if(this.sphere)u=this.x0+this.a*g*Math.cos(this.lat_ts),d=this.y0+this.a*Math.sin(a)/Math.cos(this.lat_ts);else{var m=wl(this.e,Math.sin(a));u=this.x0+this.a*this.k0*g,d=this.y0+this.a*m*.5/this.k0}return e.x=u,e.y=d,e}function Ik(e){e.x-=this.x0,e.y-=this.y0;var r,a;return this.sphere?(r=qt(this.long0+e.x/this.a/Math.cos(this.lat_ts)),a=Math.asin(e.y/this.a*Math.cos(this.lat_ts))):(a=Ek(this.e,2*e.y*this.k0/this.a),r=qt(this.long0+e.x/(this.a*this.k0))),e.x=r,e.y=a,e}var Ak=["cea"];const Pk={init:Tk,forward:Ck,inverse:Ik,names:Ak};function kk(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function Dk(e){var r=e.x,a=e.y,u=qt(r-this.long0),d=wu(a-this.lat0);return e.x=this.x0+this.a*u*this.rc,e.y=this.y0+this.a*d,e}function Lk(e){var r=e.x,a=e.y;return e.x=qt(this.long0+(r-this.x0)/(this.a*this.rc)),e.y=wu(this.lat0+(a-this.y0)/this.a),e}var Rk=["Equirectangular","Equidistant_Cylindrical","eqc"];const zk={init:kk,forward:Dk,inverse:Lk,names:Rk};var M0=20;function Ok(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Qh(this.es),this.e1=ed(this.es),this.e2=td(this.es),this.e3=id(this.es),this.ml0=this.a*xs(this.e0,this.e1,this.e2,this.e3,this.lat0)}function Fk(e){var r=e.x,a=e.y,u,d,g,m=qt(r-this.long0);if(g=m*Math.sin(a),this.sphere)Math.abs(a)<=zt?(u=this.a*m,d=-1*this.a*this.lat0):(u=this.a*Math.sin(g)/Math.tan(a),d=this.a*(wu(a-this.lat0)+(1-Math.cos(g))/Math.tan(a)));else if(Math.abs(a)<=zt)u=this.a*m,d=-1*this.ml0;else{var l=yu(this.a,this.e,Math.sin(a))/Math.tan(a);u=l*Math.sin(g),d=this.a*xs(this.e0,this.e1,this.e2,this.e3,a)-this.ml0+l*(1-Math.cos(g))}return e.x=u+this.x0,e.y=d+this.y0,e}function Bk(e){var r,a,u,d,g,m,l,M,A;if(u=e.x-this.x0,d=e.y-this.y0,this.sphere)if(Math.abs(d+this.a*this.lat0)<=zt)r=qt(u/this.a+this.long0),a=0;else{m=this.lat0+d/this.a,l=u*u/this.a/this.a+m*m,M=m;var R;for(g=M0;g;--g)if(R=Math.tan(M),A=-1*(m*(M*R+1)-M-.5*(M*M+l)*R)/((M-m)/R-1),M+=A,Math.abs(A)<=zt){a=M;break}r=qt(this.long0+Math.asin(u*Math.tan(M)/this.a)/Math.sin(a))}else if(Math.abs(d+this.ml0)<=zt)a=0,r=qt(this.long0+u/this.a);else{m=(this.ml0+d)/this.a,l=u*u/this.a/this.a+m*m,M=m;var k,z,W,Z,X;for(g=M0;g;--g)if(X=this.e*Math.sin(M),k=Math.sqrt(1-X*X)*Math.tan(M),z=this.a*xs(this.e0,this.e1,this.e2,this.e3,M),W=this.e0-2*this.e1*Math.cos(2*M)+4*this.e2*Math.cos(4*M)-6*this.e3*Math.cos(6*M),Z=z/this.a,A=(m*(k*Z+1)-Z-.5*k*(Z*Z+l))/(this.es*Math.sin(2*M)*(Z*Z+l-2*m*Z)/(4*k)+(m-Z)*(k*W-2/Math.sin(2*M))-W),M-=A,Math.abs(A)<=zt){a=M;break}k=Math.sqrt(1-this.es*Math.pow(Math.sin(a),2))*Math.tan(a),r=qt(this.long0+Math.asin(u*k/this.a)/Math.sin(a))}return e.x=r,e.y=a,e}var Nk=["Polyconic","poly"];const $k={init:Ok,forward:Fk,inverse:Bk,names:Nk};function Uk(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function Vk(e){var r,a=e.x,u=e.y,d=u-this.lat0,g=a-this.long0,m=d/Mh*1e-5,l=g,M=1,A=0;for(r=1;r<=10;r++)M=M*m,A=A+this.A[r]*M;var R=A,k=l,z=1,W=0,Z,X,fe=0,ye=0;for(r=1;r<=6;r++)Z=z*R-W*k,X=W*R+z*k,z=Z,W=X,fe=fe+this.B_re[r]*z-this.B_im[r]*W,ye=ye+this.B_im[r]*z+this.B_re[r]*W;return e.x=ye*this.a+this.x0,e.y=fe*this.a+this.y0,e}function jk(e){var r,a=e.x,u=e.y,d=a-this.x0,g=u-this.y0,m=g/this.a,l=d/this.a,M=1,A=0,R,k,z=0,W=0;for(r=1;r<=6;r++)R=M*m-A*l,k=A*m+M*l,M=R,A=k,z=z+this.C_re[r]*M-this.C_im[r]*A,W=W+this.C_im[r]*M+this.C_re[r]*A;for(var Z=0;Z<this.iterations;Z++){var X=z,fe=W,ye,we,ee=m,Ie=l;for(r=2;r<=6;r++)ye=X*z-fe*W,we=fe*z+X*W,X=ye,fe=we,ee=ee+(r-1)*(this.B_re[r]*X-this.B_im[r]*fe),Ie=Ie+(r-1)*(this.B_im[r]*X+this.B_re[r]*fe);X=1,fe=0;var Ue=this.B_re[1],Xe=this.B_im[1];for(r=2;r<=6;r++)ye=X*z-fe*W,we=fe*z+X*W,X=ye,fe=we,Ue=Ue+r*(this.B_re[r]*X-this.B_im[r]*fe),Xe=Xe+r*(this.B_im[r]*X+this.B_re[r]*fe);var nt=Ue*Ue+Xe*Xe;z=(ee*Ue+Ie*Xe)/nt,W=(Ie*Ue-ee*Xe)/nt}var ft=z,At=W,Ot=1,Lt=0;for(r=1;r<=9;r++)Ot=Ot*ft,Lt=Lt+this.D[r]*Ot;var li=this.lat0+Lt*Mh*1e5,Ei=this.long0+At;return e.x=Ei,e.y=li,e}var qk=["New_Zealand_Map_Grid","nzmg"];const Gk={init:Uk,forward:Vk,inverse:jk,names:qk};function Hk(){}function Wk(e){var r=e.x,a=e.y,u=qt(r-this.long0),d=this.x0+this.a*u,g=this.y0+this.a*Math.log(Math.tan(Math.PI/4+a/2.5))*1.25;return e.x=d,e.y=g,e}function Zk(e){e.x-=this.x0,e.y-=this.y0;var r=qt(this.long0+e.x/this.a),a=2.5*(Math.atan(Math.exp(.8*e.y/this.a))-Math.PI/4);return e.x=r,e.y=a,e}var Xk=["Miller_Cylindrical","mill"];const Kk={init:Hk,forward:Wk,inverse:Zk,names:Xk};var Yk=20;function Jk(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=Zx(this.es)}function Qk(e){var r,a,u=e.x,d=e.y;if(u=qt(u-this.long0),this.sphere){if(!this.m)d=this.n!==1?Math.asin(this.n*Math.sin(d)):d;else for(var g=this.n*Math.sin(d),m=Yk;m;--m){var l=(this.m*d+Math.sin(d)-g)/(this.m+Math.cos(d));if(d-=l,Math.abs(l)<zt)break}r=this.a*this.C_x*u*(this.m+Math.cos(d)),a=this.a*this.C_y*d}else{var M=Math.sin(d),A=Math.cos(d);a=this.a*Np(d,M,A,this.en),r=this.a*u*A/Math.sqrt(1-this.es*M*M)}return e.x=r,e.y=a,e}function eD(e){var r,a,u,d;return e.x-=this.x0,u=e.x/this.a,e.y-=this.y0,r=e.y/this.a,this.sphere?(r/=this.C_y,u=u/(this.C_x*(this.m+Math.cos(r))),this.m?r=Tl((this.m*r+Math.sin(r))/this.n):this.n!==1&&(r=Tl(Math.sin(r)/this.n)),u=qt(u+this.long0),r=wu(r)):(r=Xx(e.y/this.a,this.es,this.en),d=Math.abs(r),d<gt?(d=Math.sin(r),a=this.long0+e.x*Math.sqrt(1-this.es*d*d)/(this.a*Math.cos(r)),u=qt(a)):d-zt<gt&&(u=this.long0)),e.x=u,e.y=r,e}var tD=["Sinusoidal","sinu"];const iD={init:Jk,forward:Qk,inverse:eD,names:tD};function rD(){}function nD(e){for(var r=e.x,a=e.y,u=qt(r-this.long0),d=a,g=Math.PI*Math.sin(a);;){var m=-(d+Math.sin(d)-g)/(1+Math.cos(d));if(d+=m,Math.abs(m)<zt)break}d/=2,Math.PI/2-Math.abs(a)<zt&&(u=0);var l=.900316316158*this.a*u*Math.cos(d)+this.x0,M=1.4142135623731*this.a*Math.sin(d)+this.y0;return e.x=l,e.y=M,e}function sD(e){var r,a;e.x-=this.x0,e.y-=this.y0,a=e.y/(1.4142135623731*this.a),Math.abs(a)>.999999999999&&(a=.999999999999),r=Math.asin(a);var u=qt(this.long0+e.x/(.900316316158*this.a*Math.cos(r)));u<-Math.PI&&(u=-Math.PI),u>Math.PI&&(u=Math.PI),a=(2*r+Math.sin(2*r))/Math.PI,Math.abs(a)>1&&(a=1);var d=Math.asin(a);return e.x=u,e.y=d,e}var aD=["Mollweide","moll"];const oD={init:rD,forward:nD,inverse:sD,names:aD};function lD(){Math.abs(this.lat1+this.lat2)<zt||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Qh(this.es),this.e1=ed(this.es),this.e2=td(this.es),this.e3=id(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=ao(this.e,this.sinphi,this.cosphi),this.ml1=xs(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<zt?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=ao(this.e,this.sinphi,this.cosphi),this.ml2=xs(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=xs(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function cD(e){var r=e.x,a=e.y,u;if(this.sphere)u=this.a*(this.g-a);else{var d=xs(this.e0,this.e1,this.e2,this.e3,a);u=this.a*(this.g-d)}var g=this.ns*qt(r-this.long0),m=this.x0+u*Math.sin(g),l=this.y0+this.rh-u*Math.cos(g);return e.x=m,e.y=l,e}function uD(e){e.x-=this.x0,e.y=this.rh-e.y+this.y0;var r,a,u,d;this.ns>=0?(a=Math.sqrt(e.x*e.x+e.y*e.y),r=1):(a=-Math.sqrt(e.x*e.x+e.y*e.y),r=-1);var g=0;if(a!==0&&(g=Math.atan2(r*e.x,r*e.y)),this.sphere)return d=qt(this.long0+g/this.ns),u=wu(this.g-a/this.a),e.x=d,e.y=u,e;var m=this.g-a/this.a;return u=dp(m,this.e0,this.e1,this.e2,this.e3),d=qt(this.long0+g/this.ns),e.x=d,e.y=u,e}var hD=["Equidistant_Conic","eqdc"];const dD={init:lD,forward:cD,inverse:uD,names:hD};function pD(){this.R=this.a}function fD(e){var r=e.x,a=e.y,u=qt(r-this.long0),d,g;Math.abs(a)<=zt&&(d=this.x0+this.R*u,g=this.y0);var m=Tl(2*Math.abs(a/Math.PI));(Math.abs(u)<=zt||Math.abs(Math.abs(a)-gt)<=zt)&&(d=this.x0,a>=0?g=this.y0+Math.PI*this.R*Math.tan(.5*m):g=this.y0+Math.PI*this.R*-Math.tan(.5*m));var l=.5*Math.abs(Math.PI/u-u/Math.PI),M=l*l,A=Math.sin(m),R=Math.cos(m),k=R/(A+R-1),z=k*k,W=k*(2/A-1),Z=W*W,X=Math.PI*this.R*(l*(k-Z)+Math.sqrt(M*(k-Z)*(k-Z)-(Z+M)*(z-Z)))/(Z+M);u<0&&(X=-X),d=this.x0+X;var fe=M+k;return X=Math.PI*this.R*(W*fe-l*Math.sqrt((Z+M)*(M+1)-fe*fe))/(Z+M),a>=0?g=this.y0+X:g=this.y0-X,e.x=d,e.y=g,e}function mD(e){var r,a,u,d,g,m,l,M,A,R,k,z,W;return e.x-=this.x0,e.y-=this.y0,k=Math.PI*this.R,u=e.x/k,d=e.y/k,g=u*u+d*d,m=-Math.abs(d)*(1+g),l=m-2*d*d+u*u,M=-2*m+1+2*d*d+g*g,W=d*d/M+(2*l*l*l/M/M/M-9*m*l/M/M)/27,A=(m-l*l/3/M)/M,R=2*Math.sqrt(-A/3),k=3*W/A/R,Math.abs(k)>1&&(k>=0?k=1:k=-1),z=Math.acos(k)/3,e.y>=0?a=(-R*Math.cos(z+Math.PI/3)-l/3/M)*Math.PI:a=-(-R*Math.cos(z+Math.PI/3)-l/3/M)*Math.PI,Math.abs(u)<zt?r=this.long0:r=qt(this.long0+Math.PI*(g-1+Math.sqrt(1+2*(u*u-d*d)+g*g))/2/u),e.x=r,e.y=a,e}var gD=["Van_der_Grinten_I","VanDerGrinten","vandg"];const yD={init:pD,forward:fD,inverse:mD,names:gD};function _D(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function vD(e){var r=e.x,a=e.y,u=Math.sin(e.y),d=Math.cos(e.y),g=qt(r-this.long0),m,l,M,A,R,k,z,W,Z,X,fe,ye,we,ee,Ie,Ue,Xe,nt,ft,At,Ot,Lt,li;return this.sphere?Math.abs(this.sin_p12-1)<=zt?(e.x=this.x0+this.a*(gt-a)*Math.sin(g),e.y=this.y0-this.a*(gt-a)*Math.cos(g),e):Math.abs(this.sin_p12+1)<=zt?(e.x=this.x0+this.a*(gt+a)*Math.sin(g),e.y=this.y0+this.a*(gt+a)*Math.cos(g),e):(nt=this.sin_p12*u+this.cos_p12*d*Math.cos(g),Ue=Math.acos(nt),Xe=Ue?Ue/Math.sin(Ue):1,e.x=this.x0+this.a*Xe*d*Math.sin(g),e.y=this.y0+this.a*Xe*(this.cos_p12*u-this.sin_p12*d*Math.cos(g)),e):(m=Qh(this.es),l=ed(this.es),M=td(this.es),A=id(this.es),Math.abs(this.sin_p12-1)<=zt?(R=this.a*xs(m,l,M,A,gt),k=this.a*xs(m,l,M,A,a),e.x=this.x0+(R-k)*Math.sin(g),e.y=this.y0-(R-k)*Math.cos(g),e):Math.abs(this.sin_p12+1)<=zt?(R=this.a*xs(m,l,M,A,gt),k=this.a*xs(m,l,M,A,a),e.x=this.x0+(R+k)*Math.sin(g),e.y=this.y0+(R+k)*Math.cos(g),e):(z=u/d,W=yu(this.a,this.e,this.sin_p12),Z=yu(this.a,this.e,u),X=Math.atan((1-this.es)*z+this.es*W*this.sin_p12/(Z*d)),fe=Math.atan2(Math.sin(g),this.cos_p12*Math.tan(X)-this.sin_p12*Math.cos(g)),fe===0?ft=Math.asin(this.cos_p12*Math.sin(X)-this.sin_p12*Math.cos(X)):Math.abs(Math.abs(fe)-Math.PI)<=zt?ft=-Math.asin(this.cos_p12*Math.sin(X)-this.sin_p12*Math.cos(X)):ft=Math.asin(Math.sin(g)*Math.cos(X)/Math.sin(fe)),ye=this.e*this.sin_p12/Math.sqrt(1-this.es),we=this.e*this.cos_p12*Math.cos(fe)/Math.sqrt(1-this.es),ee=ye*we,Ie=we*we,At=ft*ft,Ot=At*ft,Lt=Ot*ft,li=Lt*ft,Ue=W*ft*(1-At*Ie*(1-Ie)/6+Ot/8*ee*(1-2*Ie)+Lt/120*(Ie*(4-7*Ie)-3*ye*ye*(1-7*Ie))-li/48*ee),e.x=this.x0+Ue*Math.sin(fe),e.y=this.y0+Ue*Math.cos(fe),e))}function xD(e){e.x-=this.x0,e.y-=this.y0;var r,a,u,d,g,m,l,M,A,R,k,z,W,Z,X,fe,ye,we,ee,Ie,Ue,Xe,nt,ft;return this.sphere?(r=Math.sqrt(e.x*e.x+e.y*e.y),r>2*gt*this.a?void 0:(a=r/this.a,u=Math.sin(a),d=Math.cos(a),g=this.long0,Math.abs(r)<=zt?m=this.lat0:(m=Tl(d*this.sin_p12+e.y*u*this.cos_p12/r),l=Math.abs(this.lat0)-gt,Math.abs(l)<=zt?this.lat0>=0?g=qt(this.long0+Math.atan2(e.x,-e.y)):g=qt(this.long0-Math.atan2(-e.x,e.y)):g=qt(this.long0+Math.atan2(e.x*u,r*this.cos_p12*d-e.y*this.sin_p12*u))),e.x=g,e.y=m,e)):(M=Qh(this.es),A=ed(this.es),R=td(this.es),k=id(this.es),Math.abs(this.sin_p12-1)<=zt?(z=this.a*xs(M,A,R,k,gt),r=Math.sqrt(e.x*e.x+e.y*e.y),W=z-r,m=dp(W/this.a,M,A,R,k),g=qt(this.long0+Math.atan2(e.x,-1*e.y)),e.x=g,e.y=m,e):Math.abs(this.sin_p12+1)<=zt?(z=this.a*xs(M,A,R,k,gt),r=Math.sqrt(e.x*e.x+e.y*e.y),W=r-z,m=dp(W/this.a,M,A,R,k),g=qt(this.long0+Math.atan2(e.x,e.y)),e.x=g,e.y=m,e):(r=Math.sqrt(e.x*e.x+e.y*e.y),fe=Math.atan2(e.x,e.y),Z=yu(this.a,this.e,this.sin_p12),ye=Math.cos(fe),we=this.e*this.cos_p12*ye,ee=-we*we/(1-this.es),Ie=3*this.es*(1-ee)*this.sin_p12*this.cos_p12*ye/(1-this.es),Ue=r/Z,Xe=Ue-ee*(1+ee)*Math.pow(Ue,3)/6-Ie*(1+3*ee)*Math.pow(Ue,4)/24,nt=1-ee*Xe*Xe/2-Ue*Xe*Xe*Xe/6,X=Math.asin(this.sin_p12*Math.cos(Xe)+this.cos_p12*Math.sin(Xe)*ye),g=qt(this.long0+Math.asin(Math.sin(fe)*Math.sin(Xe)/Math.cos(X))),ft=Math.sin(X),m=Math.atan2((ft-this.es*nt*this.sin_p12)*Math.tan(X),ft*(1-this.es)),e.x=g,e.y=m,e))}var bD=["Azimuthal_Equidistant","aeqd"];const wD={init:_D,forward:vD,inverse:xD,names:bD};function MD(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function SD(e){var r,a,u,d,g,m,l,M,A=e.x,R=e.y;return u=qt(A-this.long0),r=Math.sin(R),a=Math.cos(R),d=Math.cos(u),m=this.sin_p14*r+this.cos_p14*a*d,g=1,(m>0||Math.abs(m)<=zt)&&(l=this.a*g*a*Math.sin(u),M=this.y0+this.a*g*(this.cos_p14*r-this.sin_p14*a*d)),e.x=l,e.y=M,e}function ED(e){var r,a,u,d,g,m,l;return e.x-=this.x0,e.y-=this.y0,r=Math.sqrt(e.x*e.x+e.y*e.y),a=Tl(r/this.a),u=Math.sin(a),d=Math.cos(a),m=this.long0,Math.abs(r)<=zt?(l=this.lat0,e.x=m,e.y=l,e):(l=Tl(d*this.sin_p14+e.y*u*this.cos_p14/r),g=Math.abs(this.lat0)-gt,Math.abs(g)<=zt?(this.lat0>=0?m=qt(this.long0+Math.atan2(e.x,-e.y)):m=qt(this.long0-Math.atan2(-e.x,e.y)),e.x=m,e.y=l,e):(m=qt(this.long0+Math.atan2(e.x*u,r*this.cos_p14*d-e.y*this.sin_p14*u)),e.x=m,e.y=l,e))}var TD=["ortho"];const CD={init:MD,forward:SD,inverse:ED,names:TD};var Wr={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},lr={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function ID(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=gt-or/2?this.face=Wr.TOP:this.lat0<=-(gt-or/2)?this.face=Wr.BOTTOM:Math.abs(this.long0)<=or?this.face=Wr.FRONT:Math.abs(this.long0)<=gt+or?this.face=this.long0>0?Wr.RIGHT:Wr.LEFT:this.face=Wr.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function AD(e){var r={x:0,y:0},a,u,d,g,m,l,M={value:0};if(e.x-=this.long0,this.es!==0?a=Math.atan(this.one_minus_f_squared*Math.tan(e.y)):a=e.y,u=e.x,this.face===Wr.TOP)g=gt-a,u>=or&&u<=gt+or?(M.value=lr.AREA_0,d=u-gt):u>gt+or||u<=-(gt+or)?(M.value=lr.AREA_1,d=u>0?u-pn:u+pn):u>-(gt+or)&&u<=-or?(M.value=lr.AREA_2,d=u+gt):(M.value=lr.AREA_3,d=u);else if(this.face===Wr.BOTTOM)g=gt+a,u>=or&&u<=gt+or?(M.value=lr.AREA_0,d=-u+gt):u<or&&u>=-or?(M.value=lr.AREA_1,d=-u):u<-or&&u>=-(gt+or)?(M.value=lr.AREA_2,d=-u-gt):(M.value=lr.AREA_3,d=u>0?-u+pn:-u-pn);else{var A,R,k,z,W,Z,X;this.face===Wr.RIGHT?u=uu(u,+gt):this.face===Wr.BACK?u=uu(u,+pn):this.face===Wr.LEFT&&(u=uu(u,-gt)),z=Math.sin(a),W=Math.cos(a),Z=Math.sin(u),X=Math.cos(u),A=W*X,R=W*Z,k=z,this.face===Wr.FRONT?(g=Math.acos(A),d=$d(g,k,R,M)):this.face===Wr.RIGHT?(g=Math.acos(R),d=$d(g,k,-A,M)):this.face===Wr.BACK?(g=Math.acos(-A),d=$d(g,k,-R,M)):this.face===Wr.LEFT?(g=Math.acos(-R),d=$d(g,k,A,M)):(g=d=0,M.value=lr.AREA_0)}return l=Math.atan(12/pn*(d+Math.acos(Math.sin(d)*Math.cos(or))-gt)),m=Math.sqrt((1-Math.cos(g))/(Math.cos(l)*Math.cos(l))/(1-Math.cos(Math.atan(1/Math.cos(d))))),M.value===lr.AREA_1?l+=gt:M.value===lr.AREA_2?l+=pn:M.value===lr.AREA_3&&(l+=1.5*pn),r.x=m*Math.cos(l),r.y=m*Math.sin(l),r.x=r.x*this.a+this.x0,r.y=r.y*this.a+this.y0,e.x=r.x,e.y=r.y,e}function PD(e){var r={lam:0,phi:0},a,u,d,g,m,l,M,A,R,k={value:0};if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,u=Math.atan(Math.sqrt(e.x*e.x+e.y*e.y)),a=Math.atan2(e.y,e.x),e.x>=0&&e.x>=Math.abs(e.y)?k.value=lr.AREA_0:e.y>=0&&e.y>=Math.abs(e.x)?(k.value=lr.AREA_1,a-=gt):e.x<0&&-e.x>=Math.abs(e.y)?(k.value=lr.AREA_2,a=a<0?a+pn:a-pn):(k.value=lr.AREA_3,a+=gt),R=pn/12*Math.tan(a),m=Math.sin(R)/(Math.cos(R)-1/Math.sqrt(2)),l=Math.atan(m),d=Math.cos(a),g=Math.tan(u),M=1-d*d*g*g*(1-Math.cos(Math.atan(1/Math.cos(l)))),M<-1?M=-1:M>1&&(M=1),this.face===Wr.TOP)A=Math.acos(M),r.phi=gt-A,k.value===lr.AREA_0?r.lam=l+gt:k.value===lr.AREA_1?r.lam=l<0?l+pn:l-pn:k.value===lr.AREA_2?r.lam=l-gt:r.lam=l;else if(this.face===Wr.BOTTOM)A=Math.acos(M),r.phi=A-gt,k.value===lr.AREA_0?r.lam=-l+gt:k.value===lr.AREA_1?r.lam=-l:k.value===lr.AREA_2?r.lam=-l-gt:r.lam=l<0?-l-pn:-l+pn;else{var z,W,Z;z=M,R=z*z,R>=1?Z=0:Z=Math.sqrt(1-R)*Math.sin(l),R+=Z*Z,R>=1?W=0:W=Math.sqrt(1-R),k.value===lr.AREA_1?(R=W,W=-Z,Z=R):k.value===lr.AREA_2?(W=-W,Z=-Z):k.value===lr.AREA_3&&(R=W,W=Z,Z=-R),this.face===Wr.RIGHT?(R=z,z=-W,W=R):this.face===Wr.BACK?(z=-z,W=-W):this.face===Wr.LEFT&&(R=z,z=W,W=-R),r.phi=Math.acos(-Z)-gt,r.lam=Math.atan2(W,z),this.face===Wr.RIGHT?r.lam=uu(r.lam,-gt):this.face===Wr.BACK?r.lam=uu(r.lam,-pn):this.face===Wr.LEFT&&(r.lam=uu(r.lam,+gt))}if(this.es!==0){var X,fe,ye;X=r.phi<0?1:0,fe=Math.tan(r.phi),ye=this.b/Math.sqrt(fe*fe+this.one_minus_f_squared),r.phi=Math.atan(Math.sqrt(this.a*this.a-ye*ye)/(this.one_minus_f*ye)),X&&(r.phi=-r.phi)}return r.lam+=this.long0,e.x=r.lam,e.y=r.phi,e}function $d(e,r,a,u){var d;return e<zt?(u.value=lr.AREA_0,d=0):(d=Math.atan2(r,a),Math.abs(d)<=or?u.value=lr.AREA_0:d>or&&d<=gt+or?(u.value=lr.AREA_1,d-=gt):d>gt+or||d<=-(gt+or)?(u.value=lr.AREA_2,d=d>=0?d-pn:d+pn):(u.value=lr.AREA_3,d+=gt)),d}function uu(e,r){var a=e+r;return a<-pn?a+=Bh:a>+pn&&(a-=Bh),a}var kD=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const DD={init:ID,forward:AD,inverse:PD,names:kD};var Cm=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],gh=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],Jx=.8487,Qx=1.3523,e1=ro/5,LD=1/e1,iu=18,pp=function(e,r){return e[0]+r*(e[1]+r*(e[2]+r*e[3]))},RD=function(e,r){return e[1]+r*(2*e[2]+r*3*e[3])};function zD(e,r,a,u){for(var d=r;u;--u){var g=e(d);if(d-=g,Math.abs(g)<a)break}return d}function OD(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function FD(e){var r=qt(e.x-this.long0),a=Math.abs(e.y),u=Math.floor(a*e1);u<0?u=0:u>=iu&&(u=iu-1),a=ro*(a-LD*u);var d={x:pp(Cm[u],a)*r,y:pp(gh[u],a)};return e.y<0&&(d.y=-d.y),d.x=d.x*this.a*Jx+this.x0,d.y=d.y*this.a*Qx+this.y0,d}function BD(e){var r={x:(e.x-this.x0)/(this.a*Jx),y:Math.abs(e.y-this.y0)/(this.a*Qx)};if(r.y>=1)r.x/=Cm[iu][0],r.y=e.y<0?-gt:gt;else{var a=Math.floor(r.y*iu);for(a<0?a=0:a>=iu&&(a=iu-1);;)if(gh[a][0]>r.y)--a;else if(gh[a+1][0]<=r.y)++a;else break;var u=gh[a],d=5*(r.y-u[0])/(gh[a+1][0]-u[0]);d=zD(function(g){return(pp(u,g)-r.y)/RD(u,g)},d,zt,100),r.x/=pp(Cm[a],d),r.y=(5*a+d)*qn,e.y<0&&(r.y=-r.y)}return r.x=qt(r.x+this.long0),r}var ND=["Robinson","robin"];const $D={init:OD,forward:FD,inverse:BD,names:ND};function UD(){this.name="geocent"}function VD(e){var r=Nx(e,this.es,this.a);return r}function jD(e){var r=$x(e,this.es,this.a,this.b);return r}var qD=["Geocentric","geocentric","geocent","Geocent"];const GD={init:UD,forward:VD,inverse:jD,names:qD};var rs={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},hh={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function HD(){if(Object.keys(hh).forEach((function(a){if(typeof this[a]>"u")this[a]=hh[a].def;else{if(hh[a].num&&isNaN(this[a]))throw new Error("Invalid parameter value, must be numeric "+a+" = "+this[a]);hh[a].num&&(this[a]=parseFloat(this[a]))}hh[a].degrees&&(this[a]=this[a]*qn)}).bind(this)),Math.abs(Math.abs(this.lat0)-gt)<zt?this.mode=this.lat0<0?rs.S_POLE:rs.N_POLE:Math.abs(this.lat0)<zt?this.mode=rs.EQUIT:(this.mode=rs.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var e=this.tilt,r=this.azi;this.cg=Math.cos(r),this.sg=Math.sin(r),this.cw=Math.cos(e),this.sw=Math.sin(e)}function WD(e){e.x-=this.long0;var r=Math.sin(e.y),a=Math.cos(e.y),u=Math.cos(e.x),d,g;switch(this.mode){case rs.OBLIQ:g=this.sinph0*r+this.cosph0*a*u;break;case rs.EQUIT:g=a*u;break;case rs.S_POLE:g=-r;break;case rs.N_POLE:g=r;break}switch(g=this.pn1/(this.p-g),d=g*a*Math.sin(e.x),this.mode){case rs.OBLIQ:g*=this.cosph0*r-this.sinph0*a*u;break;case rs.EQUIT:g*=r;break;case rs.N_POLE:g*=-(a*u);break;case rs.S_POLE:g*=a*u;break}var m,l;return m=g*this.cg+d*this.sg,l=1/(m*this.sw*this.h1+this.cw),d=(d*this.cg-g*this.sg)*this.cw*l,g=m*l,e.x=d*this.a,e.y=g*this.a,e}function ZD(e){e.x/=this.a,e.y/=this.a;var r={x:e.x,y:e.y},a,u,d;d=1/(this.pn1-e.y*this.sw),a=this.pn1*e.x*d,u=this.pn1*e.y*this.cw*d,e.x=a*this.cg+u*this.sg,e.y=u*this.cg-a*this.sg;var g=fa(e.x,e.y);if(Math.abs(g)<zt)r.x=0,r.y=e.y;else{var m,l;switch(l=1-g*g*this.pfact,l=(this.p-Math.sqrt(l))/(this.pn1/g+g/this.pn1),m=Math.sqrt(1-l*l),this.mode){case rs.OBLIQ:r.y=Math.asin(m*this.sinph0+e.y*l*this.cosph0/g),e.y=(m-this.sinph0*Math.sin(r.y))*g,e.x*=l*this.cosph0;break;case rs.EQUIT:r.y=Math.asin(e.y*l/g),e.y=m*g,e.x*=l;break;case rs.N_POLE:r.y=Math.asin(m),e.y=-e.y;break;case rs.S_POLE:r.y=-Math.asin(m);break}r.x=Math.atan2(e.x,e.y)}return e.x=r.x+this.long0,e.y=r.y,e}var XD=["Tilted_Perspective","tpers"];const KD={init:HD,forward:WD,inverse:ZD,names:XD};function YD(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var e=1-this.es,r=1/e;this.radius_p=Math.sqrt(e),this.radius_p2=e,this.radius_p_inv2=r,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function JD(e){var r=e.x,a=e.y,u,d,g,m;if(r=r-this.long0,this.shape==="ellipse"){a=Math.atan(this.radius_p2*Math.tan(a));var l=this.radius_p/fa(this.radius_p*Math.cos(a),Math.sin(a));if(d=l*Math.cos(r)*Math.cos(a),g=l*Math.sin(r)*Math.cos(a),m=l*Math.sin(a),(this.radius_g-d)*d-g*g-m*m*this.radius_p_inv2<0)return e.x=Number.NaN,e.y=Number.NaN,e;u=this.radius_g-d,this.flip_axis?(e.x=this.radius_g_1*Math.atan(g/fa(m,u)),e.y=this.radius_g_1*Math.atan(m/u)):(e.x=this.radius_g_1*Math.atan(g/u),e.y=this.radius_g_1*Math.atan(m/fa(g,u)))}else this.shape==="sphere"&&(u=Math.cos(a),d=Math.cos(r)*u,g=Math.sin(r)*u,m=Math.sin(a),u=this.radius_g-d,this.flip_axis?(e.x=this.radius_g_1*Math.atan(g/fa(m,u)),e.y=this.radius_g_1*Math.atan(m/u)):(e.x=this.radius_g_1*Math.atan(g/u),e.y=this.radius_g_1*Math.atan(m/fa(g,u))));return e.x=e.x*this.a,e.y=e.y*this.a,e}function QD(e){var r=-1,a=0,u=0,d,g,m,l;if(e.x=e.x/this.a,e.y=e.y/this.a,this.shape==="ellipse"){this.flip_axis?(u=Math.tan(e.y/this.radius_g_1),a=Math.tan(e.x/this.radius_g_1)*fa(1,u)):(a=Math.tan(e.x/this.radius_g_1),u=Math.tan(e.y/this.radius_g_1)*fa(1,a));var M=u/this.radius_p;if(d=a*a+M*M+r*r,g=2*this.radius_g*r,m=g*g-4*d*this.C,m<0)return e.x=Number.NaN,e.y=Number.NaN,e;l=(-g-Math.sqrt(m))/(2*d),r=this.radius_g+l*r,a*=l,u*=l,e.x=Math.atan2(a,r),e.y=Math.atan(u*Math.cos(e.x)/r),e.y=Math.atan(this.radius_p_inv2*Math.tan(e.y))}else if(this.shape==="sphere"){if(this.flip_axis?(u=Math.tan(e.y/this.radius_g_1),a=Math.tan(e.x/this.radius_g_1)*Math.sqrt(1+u*u)):(a=Math.tan(e.x/this.radius_g_1),u=Math.tan(e.y/this.radius_g_1)*Math.sqrt(1+a*a)),d=a*a+u*u+r*r,g=2*this.radius_g*r,m=g*g-4*d*this.C,m<0)return e.x=Number.NaN,e.y=Number.NaN,e;l=(-g-Math.sqrt(m))/(2*d),r=this.radius_g+l*r,a*=l,u*=l,e.x=Math.atan2(a,r),e.y=Math.atan(u*Math.cos(e.x)/r)}return e.x=e.x+this.long0,e}var e3=["Geostationary Satellite View","Geostationary_Satellite","geos"];const t3={init:YD,forward:JD,inverse:QD,names:e3};var Sh=1.340264,Eh=-.081106,Th=893e-6,Ch=.003796,fp=Math.sqrt(3)/2;function i3(){this.es=0,this.long0=this.long0!==void 0?this.long0:0}function r3(e){var r=qt(e.x-this.long0),a=e.y,u=Math.asin(fp*Math.sin(a)),d=u*u,g=d*d*d;return e.x=r*Math.cos(u)/(fp*(Sh+3*Eh*d+g*(7*Th+9*Ch*d))),e.y=u*(Sh+Eh*d+g*(Th+Ch*d)),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function n3(e){e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a;var r=1e-9,a=12,u=e.y,d,g,m,l,M,A;for(A=0;A<a&&(d=u*u,g=d*d*d,m=u*(Sh+Eh*d+g*(Th+Ch*d))-e.y,l=Sh+3*Eh*d+g*(7*Th+9*Ch*d),u-=M=m/l,!(Math.abs(M)<r));++A);return d=u*u,g=d*d*d,e.x=fp*e.x*(Sh+3*Eh*d+g*(7*Th+9*Ch*d))/Math.cos(u),e.y=Math.asin(Math.sin(u)/fp),e.x=qt(e.x+this.long0),e}var s3=["eqearth","Equal Earth","Equal_Earth"];const a3={init:i3,forward:r3,inverse:n3,names:s3};function o3(e){e.Proj.projections.add(Yd),e.Proj.projections.add(Jd),e.Proj.projections.add(lP),e.Proj.projections.add(_P),e.Proj.projections.add(SP),e.Proj.projections.add(AP),e.Proj.projections.add(zP),e.Proj.projections.add($P),e.Proj.projections.add(GP),e.Proj.projections.add(KP),e.Proj.projections.add(pk),e.Proj.projections.add(vk),e.Proj.projections.add(Sk),e.Proj.projections.add(Pk),e.Proj.projections.add(zk),e.Proj.projections.add($k),e.Proj.projections.add(Gk),e.Proj.projections.add(Kk),e.Proj.projections.add(iD),e.Proj.projections.add(oD),e.Proj.projections.add(dD),e.Proj.projections.add(yD),e.Proj.projections.add(wD),e.Proj.projections.add(CD),e.Proj.projections.add(DD),e.Proj.projections.add($D),e.Proj.projections.add(GD),e.Proj.projections.add(KD),e.Proj.projections.add(t3),e.Proj.projections.add(a3)}Os.defaultDatum="WGS84";Os.Proj=no;Os.WGS84=new Os.Proj("WGS84");Os.Point=gu;Os.toPoint=Ux;Os.defs=_s;Os.nadgrid=uA;Os.transform=hp;Os.mgrs=TA;Os.version="__VERSION__";o3(Os);const as=Lo("MapStore",{state:()=>({map:{},currentMapStyle:"pwdDrawnMapStyle",bufferForAddress:{},currentMarkersForTopic:[],addressMarker:null,addressParcel:null,initialized:!1,draw:null,imageryOn:!1,imagerySelected:"2023",cyclomediaOn:!1,cyclomediaInitialized:!1,clickedCyclomediaRecordingCoords:null,pictometryOn:!1,selectedRegmap:null,regmapOpacity:.5,zoningOpacity:1}),actions:{setMap(e){this.map=e},setMapStyle(e){this.currentMapStyle=e},async fillBufferForAddress(e,r){const g=Os("+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs","+proj=lcc +lat_1=40.96666666666667 +lat_2=39.93333333333333 +lat_0=39.33333333333334 +lon_0=-77.75 +x_0=600000 +y_0=0 +ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 +no_defs",[e,r]);console.log("fillBufferForAddress is running, lng:",e,"lat:",r);const m="https://citygeo-geocoder-pub.databridge.phila.gov/arcgis/rest/services/Utilities/Geometry/GeometryServer/buffer",l={geometries:`${g.join(", ")}`,inSR:2272,outSR:4326,bufferSR:2272,distances:500,unionResults:!0,geodesic:!1,f:"json"};let M=await ar.get(m,{params:l});this.bufferForAddress=M.data}}}),_a=e=>(qh("data-v-d5ae50c3"),e=e(),Gh(),e),l3=_a(()=>J("div",{class:"box"},"Deed information and document transactions for this address. The map faithfully reflects property boundaries as described in recorded deeds including multiple types of easements. The property boundaries displayed on the map are for reference only and should not be used in place of the recorded deeds or land surveys. Source: Department of Records",-1)),c3={class:"columns is-multiline"},u3=["onClick"],h3=_a(()=>J("h5",{class:"title is-5"},"Parcel Details",-1)),d3={key:0,class:"vert-table"},p3={class:"columns"},f3=_a(()=>J("div",{class:"column is-4"},"Map Registry #",-1)),m3={class:"column is-8"},g3={class:"columns"},y3=_a(()=>J("div",{class:"column is-4"},"Parcel Address",-1)),_3={class:"column is-8"},v3={class:"columns"},x3=_a(()=>J("div",{class:"column is-4"},"Status",-1)),b3={class:"column is-8"},w3={class:"columns"},M3=_a(()=>J("div",{class:"column is-4"},"Origination Date",-1)),S3={class:"column is-8"},E3={class:"columns"},T3=_a(()=>J("div",{class:"column is-4"},"Inactive Date",-1)),C3={class:"column is-8"},I3={class:"columns"},A3=_a(()=>J("div",{class:"column is-4"},"Has Air Rights",-1)),P3={class:"column is-8"},k3={class:"columns"},D3=_a(()=>J("div",{class:"column is-4"},"Is Condo",-1)),L3={class:"column is-8"},R3={class:"mt-6"},z3=_a(()=>J("h5",{class:"subtitle is-5"},"Documents",-1)),O3={class:"table is-fullwidth is-striped"},F3=_a(()=>J("thead",null,[J("tr",null,[J("th",null,"ID"),J("th",null,"Date"),J("th",null,"Type"),J("th",null,"Grantor"),J("th",null,"Grantee")])],-1)),B3={class:"mt-6"},N3=_a(()=>J("h5",{class:"subtitle is-5"},"Registry Maps",-1)),$3={class:"columns is-multiline"},U3=["onClick"],V3={__name:"Deeds",setup(e){Qr();const r=mu(),a=kx(),u=ea(),d=as();d.map;let g=gi(()=>u.selectedParcelId);const m=gi(()=>r.dor.features.filter(z=>z.id===g.value)[0]),l=gi(()=>g.value?(console.log("selected.value:",g.value),a.dorDocuments[g.value].data.features):null),M=gi(()=>a.regmaps.data.features);qm(()=>{console.log("Deeds.vue onBeforeMount"),r.dor.features.length>0&&(u.selectedParcelId=r.dor.features[0].properties.OBJECTID)});const A={1:"Active",2:"Inactive",3:"Remainder"},R=z=>{d.selectedRegmap===z?d.selectedRegmap=null:d.selectedRegmap=z},k=gi(()=>d.selectedRegmap);return(z,W)=>(wt(),Ft(Mr,null,[l3,J("div",c3,[(wt(!0),Ft(Mr,null,Rs(zi(r).dor.features,Z=>(wt(),Ft("div",{key:Z.properties.OBJECTID,onClick:X=>zi(u).selectedParcelId=Z.properties.OBJECTID,class:ns(["column is-2 add-borders has-text-centered",{"is-selected":Z.properties.OBJECTID===zi(g)}])},Ht(Z.properties.MAPREG),11,u3))),128))]),h3,m.value?(wt(),Ft("div",d3,[J("div",p3,[f3,J("div",m3,Ht(m.value.properties.MAPREG),1)]),J("div",g3,[y3,J("div",_3,Ht(m.value.properties.ADDR_SOURCE),1)]),J("div",v3,[x3,J("div",b3,Ht(A[m.value.properties.STATUS]),1)]),J("div",w3,[M3,J("div",S3,Ht(m.value.properties.ORIG_DATE),1)]),J("div",E3,[T3,J("div",C3,Ht(m.value.properties.INACTDATE||"None"),1)]),J("div",I3,[A3,J("div",P3,Ht(m.value.properties.SUFFIX?"Yes":"No"),1)]),J("div",k3,[D3,J("div",L3,Ht(m.value.properties.CONDOFLAG?"Yes":"No"),1)])])):Gi("",!0),J("div",R3,[z3,J("table",O3,[F3,J("tbody",null,[(wt(!0),Ft(Mr,null,Rs(l.value,Z=>(wt(),Ft("tr",null,[J("td",null,Ht(Z.attributes.DOCUMENT_ID),1),J("td",null,Ht(Z.attributes.DISPLAY_DATE),1),J("td",null,Ht(Z.attributes.DOCUMENT_TYPE),1),J("td",null,Ht(Z.attributes.GRANTORS),1),J("td",null,Ht(Z.attributes.GRANTEES),1)]))),256))])])]),J("div",B3,[N3,J("div",$3,[(wt(!0),Ft(Mr,null,Rs(M.value,Z=>(wt(),Ft("div",{class:ns(["column is-2 add-borders has-text-centered regmap-div",{"is-selected":Z.properties.RECMAP===k.value}]),onClick:X=>R(Z.properties.RECMAP)},Ht(Z.properties.RECMAP),11,U3))),256))])])],64))}},j3=Fs(V3,[["__scopeId","data-v-d5ae50c3"]]),dg=Lo("LiStore",{state:()=>({selectedLiBuildingNumber:null,liInspections:{},liPermits:{},liBuildingFootprints:{},liBuildingCertSummary:{},liBuildingCerts:{}}),actions:{async fillLiBuildingFootprints(){console.log("fillLiBuildingFootprints is running");const r=Qr().addressData.features[0].properties.bin.split("|"),a="https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/LI_BUILDING_FOOTPRINTS/FeatureServer/0/query";let u,d,g="";if(r.length){for(let M=0;M<r.length;M++)g+=r[M],M<r.length-1&&(g+="', '");d="BIN IN ('"+g+"')"}else u=r.properties.li_parcel_id,d="PARCEL_ID_NUM = '"+u+"'";console.log("where:",d);const m={where:d,outFields:"*",outSR:4326,f:"pjson"},l=await ar.get(a,{params:m});this.liBuildingFootprints=await l.data},async fillLiBuildingCertSummary(){console.log("fillLiBuildingCertSummary is running");const r=Qr().addressData.features[0].properties.bin.split("|");let a="https://phl.carto.com/api/v2/sql?q=",u="";if(r.length)for(let m=0;m<r.length;m++)u+=r[m],m<r.length-1&&(u+="', '");else this.liBuildingFootprints.data.features.length?u=this.liBuildingFootprints.data.features[0].attributes.BIN:u="";const d=a+=`SELECT * FROM building_cert_summary WHERE structure_id IN ('${u}')`,g=await fetch(d);this.liBuildingCertSummary=await g.json()},async fillLiBuildingCerts(){console.log("fillLiBuildingCerts is running");const r=Qr().addressData.features[0].properties.bin.split("|");let a="https://phl.carto.com/api/v2/sql?q=",u="";if(r.length)for(let m=0;m<r.length;m++)u+=r[m],m<r.length-1&&(u+="', '");else this.liBuildingFootprints.data.features.length?u=this.liBuildingFootprints.data.features[0].attributes.BIN:u="";const d=a+=`SELECT * FROM building_certs WHERE bin IN ('${u}')`,g=await fetch(d);this.liBuildingCerts=await g.json()},async fillLiInspections(){const r=Qr().addressData.features[0];let a="https://phl.carto.com/api/v2/sql?q=";const u=r.properties.eclipse_location_id.replace(/\|/g,"', '"),d=r.properties.street_address,g=r.properties.opa_account_num?` AND opa_account_num IN ('${r.properties.opa_account_num}')`:"",m=r.properties.pwd_parcel_id,l=r.properties.li_address_key.replace(/\|/g,"', '"),M=a+=`SELECT * FROM case_investigations WHERE (address = '${d}' or addressobjectid IN ('${l}'))           AND systemofrecord IN ('HANSEN') ${g} UNION SELECT * FROM case_investigations WHERE           addressobjectid IN ('${u}') OR parcel_id_num IN ( '${m}' )           AND systemofrecord IN ('ECLIPSE') ${g}`,A=await fetch(M);this.liInspections=await A.json()},async fillLiPermits(){const r=Qr().addressData.features[0];let a="https://phl.carto.com/api/v2/sql?q=";const u=r.properties.eclipse_location_id.replace(/\|/g,"', '"),d=r.properties.street_address,g=r.properties.opa_account_num?` AND opa_account_num IN ('${r.properties.opa_account_num}')`:"",m=r.properties.pwd_parcel_id,l=r.properties.li_address_key.replace(/\|/g,"', '"),M=a+=`SELECT * FROM PERMITS WHERE address = '${d}' or addressobjectid IN ('${l}')       AND systemofrecord IN ('HANSEN') ${g}       UNION SELECT * FROM PERMITS WHERE addressobjectid IN ('${u}') OR parcel_id_num IN ( '${m}' )       AND systemofrecord IN ('ECLIPSE')${g}      ORDER BY permittype`,A=await fetch(M);this.liPermits=await A.json()}},getters:{}}),q3=J("div",{class:"box"}," Licenses, inspections, permits, property maintenance violations, and zoning permit documents at your search address. Source: Department of Licenses & Inspections ",-1),G3={class:"subtitle is-5"},H3={class:"columns is-multiline"},W3=["onClick"],Z3={class:"vert-table"},X3={class:"columns"},K3=J("div",{class:"column is-4"},"Building ID",-1),Y3={class:"column is-8"},J3={class:"columns"},Q3=J("div",{class:"column is-4"},"Building Name",-1),eL={class:"column is-8"},tL={class:"columns"},iL=J("div",{class:"column is-4"},"Parcel Address",-1),rL={class:"column is-8"},nL={class:"columns"},sL=J("div",{class:"column is-4"},"Building Height (approx)",-1),aL={class:"column is-8"},oL={class:"columns"},lL=J("div",{class:"column is-4"},"Building Footprint (approx)",-1),cL={class:"column is-8"},uL=J("h5",{class:"subtitle is-5"},"Building Certifications",-1),hL={class:"table is-fullwidth is-striped"},dL=J("thead",null,[J("tr",null,[J("th",null,"InspectionType"),J("th",null,"Date Inspected"),J("th",null,"Inspection Result"),J("th",null,"Expiration Date")])],-1),pL=J("h5",{class:"subtitle is-5"},"Permits",-1),fL={class:"table is-fullwidth is-striped"},mL=J("thead",null,[J("tr",null,[J("th",null,"Date"),J("th",null,"ID"),J("th",null,"Description"),J("th",null,"Status")])],-1),gL=J("h5",{class:"subtitle is-5"},"Inspections",-1),yL={class:"table is-fullwidth is-striped"},_L=J("thead",null,[J("tr",null,[J("th",null,"Date"),J("th",null,"ID"),J("th",null,"Description"),J("th",null,"Status")])],-1),vL=["innerHTML"],xL={__name:"LI",setup(e){console.log("LI.vue setup");const r=Qr(),a=dg(),d=as().map,{currency:g,date:m}=ng(),l=(ye,we)=>new Date(we.expirationdate)-new Date(ye.expirationdate),M=gi(()=>a.liBuildingCerts.rows.filter(ye=>ye.bin==Z.value).sort(l)),A=(ye,we)=>new Date(we.permitissuedate)-new Date(ye.permitissuedate),R=gi(()=>a.liPermits.rows.sort(A).slice(0,5)),k=(ye,we)=>new Date(we.investigationcompleted)-new Date(ye.investigationcompleted),z=gi(()=>a.liInspections.rows.sort(k).slice(0,5)),W=ye=>{let we=r.addressData.features[0].properties.street_address;return ye.unit_num&&ye.unit_num!=null&&(we+=" Unit "+ye.unit_num),"<a target='_blank' href='https://li.phila.gov/Property-History/search/Violation-Detail?address="+encodeURIComponent(we)+"&Id="+ye.casenumber+"'>"+ye.casenumber+" <i class='fa fa-external-link-alt'></i></a>"};qm(async()=>{a.selectedLiBuildingNumber=a.liBuildingFootprints.features[0].attributes.BIN}),mc(async()=>{let ye=[];if(!a.liBuildingFootprints.features)return ye;for(let ee of a.liBuildingFootprints.features)ye.push({type:"Feature",geometry:{type:"Polygon",coordinates:[ee.geometry.rings[0]]},properties:{id:ee.attributes.BIN,type:"liBuildingFootprints"}});let we={type:"FeatureCollection",features:ye};console.log("geojson:",we,'map.getSource("liBuildingFootprints"):',d.getSource("liBuildingFootprints"),'map.getLayer("liBuildingFootprints"):',d.getLayer("liBuildingFootprints")),await d.getSource("liBuildingFootprints").setData(we)});const Z=gi(()=>a.selectedLiBuildingNumber),X=gi(()=>a.liBuildingFootprints.features.filter(ye=>ye.attributes.BIN===Z.value)[0]),fe=ye=>{a.selectedLiBuildingNumber=ye};return(ye,we)=>(wt(),Ft("section",null,[q3,J("h5",G3,"There are "+Ht(zi(a).liBuildingFootprints.features.length)+" buildings at this address",1),J("div",H3,[(wt(!0),Ft(Mr,null,Rs(zi(a).liBuildingFootprints.features,ee=>(wt(),Ft("div",{key:ee.attributes.BIN,onClick:Ie=>fe(ee.attributes.BIN),class:ns(["column is-2 add-borders has-text-centered",{"is-selected":ee.attributes.BIN===Z.value}])},Ht(ee.attributes.BIN),11,W3))),128))]),J("div",Z3,[J("div",X3,[K3,J("div",Y3,Ht(X.value.attributes.BIN||"N/A"),1)]),J("div",J3,[Q3,J("div",eL,Ht(X.value.attributes.BUILDING_NAME||"N/A"),1)]),J("div",tL,[iL,J("div",rL,Ht(X.value.attributes.ADDRESS||"N/A"),1)]),J("div",nL,[sL,J("div",aL,Ht(X.value.attributes.APPROX_HEIGHT||"N/A")+" ft",1)]),J("div",oL,[lL,J("div",cL,Ht((X.value.attributes.Shape__Area*6.3225).toFixed(0)||"N/A")+" sq ft",1)])]),uL,J("table",hL,[dL,J("tbody",null,[(wt(!0),Ft(Mr,null,Rs(M.value,ee=>(wt(),Ft("tr",null,[J("td",null,Ht(ee.buildingcerttype),1),J("td",null,Ht(zi(m)(ee.inspectiondate)),1),J("td",null,Ht(ee.inspectionresult),1),J("td",null,Ht(zi(m)(ee.expirationdate)),1)]))),256))])]),pL,J("table",fL,[mL,J("tbody",null,[(wt(!0),Ft(Mr,null,Rs(R.value,ee=>(wt(),Ft("tr",null,[J("td",null,Ht(zi(m)(ee.permitissuedate)),1),J("td",null,Ht(ee.permitnumber),1),J("td",null,Ht(ee.permitdescription),1),J("td",null,Ht(ee.status),1)]))),256))])]),gL,J("table",yL,[_L,J("tbody",null,[(wt(!0),Ft(Mr,null,Rs(z.value,ee=>(wt(),Ft("tr",null,[J("td",null,Ht(zi(m)(ee.investigationcompleted)),1),J("td",{innerHTML:W(ee)},null,8,vL),J("td",null,Ht(ee.investigationtype),1),J("td",null,Ht(ee.investigationstatus),1)]))),256))])])]))}},bL=J("h1",null,"Zoning Content",-1),wL=[bL],ML={__name:"Zoning",setup(e){return console.log("Zoning.vue setup"),(r,a)=>(wt(),Ft("section",null,wL))}},SL=J("h1",null,"Voting Content",-1),EL=[SL],TL={__name:"Voting",setup(e){return console.log("Voting.vue setup"),(r,a)=>(wt(),Ft("section",null,EL))}};function Uh(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function _u(e,r,a){a===void 0&&(a={});var u=Uh(e),d=Uh(r),g=za(d[1]-u[1]),m=za(d[0]-u[0]),l=za(u[1]),M=za(d[1]),A=Math.pow(Math.sin(g/2),2)+Math.pow(Math.sin(m/2),2)*Math.cos(l)*Math.cos(M);return xI(2*Math.atan2(Math.sqrt(A),Math.sqrt(1-A)),a.units)}function Im(e,r,a){if(e!==null)for(var u,d,g,m,l,M,A,R=0,k=0,z,W=e.type,Z=W==="FeatureCollection",X=W==="Feature",fe=Z?e.features.length:1,ye=0;ye<fe;ye++){A=Z?e.features[ye].geometry:X?e.geometry:e,z=A?A.type==="GeometryCollection":!1,l=z?A.geometries.length:1;for(var we=0;we<l;we++){var ee=0,Ie=0;if(m=z?A.geometries[we]:A,m!==null){M=m.coordinates;var Ue=m.type;switch(R=a&&(Ue==="Polygon"||Ue==="MultiPolygon")?1:0,Ue){case null:break;case"Point":if(r(M,k,ye,ee,Ie)===!1)return!1;k++,ee++;break;case"LineString":case"MultiPoint":for(u=0;u<M.length;u++){if(r(M[u],k,ye,ee,Ie)===!1)return!1;k++,Ue==="MultiPoint"&&ee++}Ue==="LineString"&&ee++;break;case"Polygon":case"MultiLineString":for(u=0;u<M.length;u++){for(d=0;d<M[u].length-R;d++){if(r(M[u][d],k,ye,ee,Ie)===!1)return!1;k++}Ue==="MultiLineString"&&ee++,Ue==="Polygon"&&Ie++}Ue==="Polygon"&&ee++;break;case"MultiPolygon":for(u=0;u<M.length;u++){for(Ie=0,d=0;d<M[u].length;d++){for(g=0;g<M[u][d].length-R;g++){if(r(M[u][d][g],k,ye,ee,Ie)===!1)return!1;k++}Ie++}ee++}break;case"GeometryCollection":for(u=0;u<m.geometries.length;u++)if(Im(m.geometries[u],r,a)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function t1(e,r){if(e.type==="Feature")r(e,0);else if(e.type==="FeatureCollection")for(var a=0;a<e.features.length&&r(e.features[a],a)!==!1;a++);}function CL(e,r){var a,u,d,g,m,l,M,A,R,k,z=0,W=e.type==="FeatureCollection",Z=e.type==="Feature",X=W?e.features.length:1;for(a=0;a<X;a++){for(l=W?e.features[a].geometry:Z?e.geometry:e,A=W?e.features[a].properties:Z?e.properties:{},R=W?e.features[a].bbox:Z?e.bbox:void 0,k=W?e.features[a].id:Z?e.id:void 0,M=l?l.type==="GeometryCollection":!1,m=M?l.geometries.length:1,d=0;d<m;d++){if(g=M?l.geometries[d]:l,g===null){if(r(null,z,A,R,k)===!1)return!1;continue}switch(g.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(r(g,z,A,R,k)===!1)return!1;break}case"GeometryCollection":{for(u=0;u<g.geometries.length;u++)if(r(g.geometries[u],z,A,R,k)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}z++}}function IL(e,r,a){var u=a;return CL(e,function(d,g,m,l,M){g===0&&a===void 0?u=d:u=r(u,d,g,m,l,M)}),u}function AL(e){var r=[];return e.type==="FeatureCollection"?t1(e,function(a){Im(a,function(u){r.push(Fh(u,a.properties))})}):Im(e,function(a){r.push(Fh(a,e.properties))}),vI(r)}function PL(e){if(!e)throw new Error("geojson is required");switch(e.type){case"Feature":return i1(e);case"FeatureCollection":return kL(e);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return pg(e);default:throw new Error("unknown GeoJSON type")}}function i1(e){var r={type:"Feature"};return Object.keys(e).forEach(function(a){switch(a){case"type":case"properties":case"geometry":return;default:r[a]=e[a]}}),r.properties=r1(e.properties),r.geometry=pg(e.geometry),r}function r1(e){var r={};return e&&Object.keys(e).forEach(function(a){var u=e[a];typeof u=="object"?u===null?r[a]=null:Array.isArray(u)?r[a]=u.map(function(d){return d}):r[a]=r1(u):r[a]=u}),r}function kL(e){var r={type:"FeatureCollection"};return Object.keys(e).forEach(function(a){switch(a){case"type":case"features":return;default:r[a]=e[a]}}),r.features=e.features.map(function(a){return i1(a)}),r}function pg(e){var r={type:e.type};return e.bbox&&(r.bbox=e.bbox),e.type==="GeometryCollection"?(r.geometries=e.geometries.map(function(a){return pg(a)}),r):(r.coordinates=n1(e.coordinates),r)}function n1(e){var r=e;return typeof r[0]!="object"?r.slice():r.map(function(a){return n1(a)})}function DL(e,r){if(!e)throw new Error("targetPoint is required");if(!r)throw new Error("points is required");var a,u=1/0,d=0;return t1(r,function(g,m){var l=_u(e,g);l<u&&(d=m,u=l)}),a=PL(r.features[d]),a.properties.featureIndex=d,a.properties.distanceToPoint=u,a}const LL=(e,r)=>{const a={};if(!r.options.params)return a;const u=Object.entries(r.options.params);(void 0).store.state;for(let[d,g]of u){let m;typeof g=="function"?m=g(e):m=g,a[d]=m}return a},Kf=(e,r)=>{const a=LL(e,r);r.url;const u=r.options,d=u.table,g=u.dateMinNum||null,m=u.dateMinType||null,l=u.dateField||null;u.success;const M=u.distances||250,A=u.groupby||null,R="ST_Distance(the_geom::geography, ST_SetSRID(ST_Point("+e.geometry.coordinates[0]+","+e.geometry.coordinates[1]+"),4326)::geography)",k="ST_Y(the_geom)",z="ST_X(the_geom)";let W;A?W=A+", the_geom":W="*",W=W+", "+R+"as distance,"+k+"as lat, "+z+"as lng",a.q="select "+W+" from "+d+" where "+R+" < "+M;let Z;if(g){switch(m){case"hour":Z=PC;break;case"day":Z=dC;break;case"week":Z=kC;break;case"month":Z=AC;break;case"year":Z=DC;break}a.q=a.q+" and "+l+" > '"+wm(Z(new Date,g),"yyyy-MM-dd")+"'"}return A&&(a.q=a.q+" group by "+A+", the_geom"),a},s1=Lo("NearbyActivityStore",{state:()=>({loadingData:!1,nearby311:{},nearbyCrimeIncidents:null,nearbyZoningAppeals:null,nearbyVacantIndicatorPoints:null,nearbyConstructionPermits:null,nearbyDemolitionPermits:null,nearbyImminentlyDangerous:null}),actions:{setLoadingData(e){this.loadingData=e},async fetchData(e){console.log("fetchData is runnning, dataType:",e),e==="nearby311"?await this.fillNearby311():e==="nearbyCrimeIncidents"?await this.fillNearbyCrimeIncidents():e==="nearbyZoningAppeals"?await this.fillNearbyZoningAppeals():e==="nearbyVacantIndicatorPoints"&&await this.fillNearbyVacantIndicatorPoints()},async fillNearby311(){const e=Qr();this.setLoadingData(!0);const r=e.addressData.features[0];let a={url:"https://phl.carto.com/api/v2/sql?",options:{table:"public_cases_fc",dateMinNum:365,dateMinType:"day",dateField:"requested_datetime"}},u=Kf(r,a);const d=await ar.get(a.url,{params:u});this.nearby311=d,this.setLoadingData(!1)},async fillNearbyCrimeIncidents(){const e=Qr();this.setLoadingData(!0);const r=e.addressData.features[0];let a={url:"https://phl.carto.com/api/v2/sql?",options:{table:"incidents_part1_part2",dateMinNum:90,dateMinType:"day",dateField:"dispatch_date"}},u=Kf(r,a);const d=await ar.get(a.url,{params:u});this.nearbyCrimeIncidents=d,this.setLoadingData(!1)},async fillNearbyZoningAppeals(){const e=Qr();this.setLoadingData(!0);const r=e.addressData.features[0];let a={url:"https://phl.carto.com/api/v2/sql?",options:{table:"appeals",dateMinNum:1,dateMinType:"year",dateField:"scheduleddate"}},u=Kf(r,a);const d=await ar.get(a.url,{params:u});this.nearbyZoningAppeals=d,this.setLoadingData(!1)},async fillNearbyVacantIndicatorPoints(){this.setLoadingData(!0);const r=as().bufferForAddress,a="https://services.arcgis.com/fLeGjb7u4uXqeF9q/arcgis/rest/services/Vacant_Indicators_Points/FeatureServer/0/query?",u=r.geometries[0].rings[0];let d=[[parseFloat(u[0][0].toFixed(6)),parseFloat(u[0][1].toFixed(6))]];var g;for(g=0;g<u.length;g++)if(g%3==0){let W=[parseFloat(u[g][0].toFixed(6)),parseFloat(u[g][1].toFixed(6))];d.push(W)}d.push([parseFloat(u[0][0].toFixed(6)),parseFloat(u[0][1].toFixed(6))]);const m={returnGeometry:!0,where:"1=1",outSR:4326,outFields:"*",inSr:4326,geometryType:"esriGeometryPolygon",spatialRel:"esriSpatialRelContains",f:"geojson",geometry:JSON.stringify({rings:[d],spatialReference:{wkid:4326}})};let A=(await(await ar.get(a,{params:m})).data||{}).features;const k=Qr().addressData.features[0],z=Fh(k.geometry.coordinates);A=A.map(W=>{const Z=W.geometry.coordinates;let X;if(Array.isArray(Z[0])){let ye;W.geometry.type==="LineString"?ye=_I([Z[0],Z[1]],{name:"line 1"}):ye=ag([Z[0]]);const we=AL(ye),ee=DL(z,we);X=_u(z,ee,{units:"miles"})}else{const ye=Fh(Z);X=_u(z,ye,{units:"miles"})}const fe=parseInt(X*5280);return W._distance=fe,W}),this.nearbyVacantIndicatorPoints=A,this.setLoadingData(!1)}}}),$s=e=>(qh("data-v-5a0417bf"),e=e(),Gh(),e),RL=$s(()=>J("div",{class:"box"}," See recent activity near your search address including 311 service requests, crimes, zoning appeals, and more. Hover over a record below to highlight it on the map. ",-1)),zL=$s(()=>J("div",{class:"dropdown-trigger"},[J("button",{class:"button","aria-haspopup":"true","aria-controls":"dropdown-menu"},[J("span",null,"What nearby activity would you like to see?"),J("span",{class:"icon is-small"},[J("i",{class:"fas fa-angle-down","aria-hidden":"true"})])])],-1)),OL={class:"dropdown-menu",id:"dropdown-menu",role:"menu"},FL={class:"dropdown-content"},BL=$s(()=>J("br",null,null,-1)),NL=$s(()=>J("div",{class:"dropdown-trigger"},[J("button",{class:"button","aria-haspopup":"true","aria-controls":"dropdown-menu"},[J("span",null,"From"),J("span",{class:"icon is-small"},[J("i",{class:"fas fa-angle-down","aria-hidden":"true"})])])],-1)),$L={class:"dropdown-menu",id:"dropdown-menu",role:"menu"},UL={class:"dropdown-content"},VL=["onClick"],jL=$s(()=>J("div",{class:"dropdown-trigger"},[J("button",{class:"button","aria-haspopup":"true","aria-controls":"dropdown-menu"},[J("span",null,"Sort by"),J("span",{class:"icon is-small"},[J("i",{class:"fas fa-angle-down","aria-hidden":"true"})])])],-1)),qL={class:"dropdown-menu",id:"dropdown-menu",role:"menu"},GL={class:"dropdown-content"},HL=$s(()=>J("br",null,null,-1)),WL={key:0,class:"mt-5"},ZL=$s(()=>J("h5",{class:"subtitle is-5"},"311 Requests",-1)),XL={key:0},KL={class:"table is-fullwidth is-striped"},YL=$s(()=>J("thead",null,[J("tr",null,[J("th",null,"Date"),J("th",null,"Location"),J("th",null,"Type"),J("th",null,"Distance")])],-1)),JL=["id"],QL={key:1,class:"mt-5"},eR=$s(()=>J("h5",{class:"subtitle is-5"},"Crime Incidents",-1)),tR={key:0},iR={class:"table is-fullwidth is-striped"},rR=$s(()=>J("thead",null,[J("tr",null,[J("th",null,"Date"),J("th",null,"Location"),J("th",null,"Description"),J("th",null,"Distance")])],-1)),nR=["id"],sR={key:2,class:"mt-5"},aR=$s(()=>J("h5",{class:"subtitle is-5"},"Zoning Appeals",-1)),oR={key:0},lR={class:"table is-fullwidth is-striped"},cR=$s(()=>J("thead",null,[J("tr",null,[J("th",null,"Date"),J("th",null,"Location"),J("th",null,"Description"),J("th",null,"Distance")])],-1)),uR=["id"],hR={key:3,class:"mt-5"},dR=$s(()=>J("h5",{class:"subtitle is-5"},"Likely Vacant Properties",-1)),pR={key:0},fR={class:"table is-fullwidth is-striped"},mR=$s(()=>J("thead",null,[J("tr",null,[J("th",null,"Address"),J("th",null,"Property Type"),J("th",null,"Distance")])],-1)),gR=["id"],yR={__name:"NearbyActivity",setup(e){console.log("Nearby.vue setup");const r=s1(),a=ea(),d=as().map,{currency:g,date:m}=ng(),l=Zh(),M=Wh(),A=(We,it,Qe)=>new Date(it[Qe])-new Date(We[Qe]),R={nearby311:"311 Requests",nearbyCrimeIncidents:"Crime Incidents",nearbyZoningAppeals:"Zoning Appeals",nearbyVacantIndicatorPoints:"Vacant Properties",nearbyConstructionPermits:"Construction Permits",nearbyDemolitionPermits:"Demolition Permits",nearbyImminentlyDangerous:"Imminently Dangerous"},k=vs(!1),z=()=>k.value=!k.value,W=gi(()=>a.currentNearbyDataType),Z=gi(()=>r.loadingData),X=We=>{M.push({name:"address-topic-and-data",params:{address:a.currentAddress,topic:l.params.topic,data:We}})};zn(()=>l.params.data,async We=>{We&&(a.setCurrentNearbyDataType(We),await fe(We))});const fe=async We=>{r[We]===null&&(console.log("fetching new data"),await r.fetchData(We)),At(Ot[We].values[0])},ye=vs(!1),we=()=>ye.value=!ye.value,ee=vs("distance"),Ie=We=>{ee.value=We},Ue=vs(!1),Xe=()=>Ue.value=!Ue.value,nt=vs(null);mc(()=>{nt.value=Ot[W.value].values[0]});const ft=gi(()=>Ot[W.value].labels[Ot[W.value].values.indexOf(nt.value)]),At=We=>{nt.value=We},Ot={nearby311:{labels:["the last 30 days","the last 90 days","1 year"],values:[30,90,365]},nearbyCrimeIncidents:{labels:["the last 30 days","the last 90 days"],values:[30,90]},nearbyZoningAppeals:{labels:["any time","the last 90 days","the next 90 days"],values:[0,-90,90]},nearbyVacantIndicatorPoints:{labels:[],values:[]},nearbyConstructionPermits:{labels:["the last 30 days","the last 90 days","1 year"],values:[30,90,365]},nearbyDemolitionPermits:{labels:["the last 30 days","the last 90 days","1 year"],values:[30,90,365]},nearbyImminentlyDangerous:{labels:["the last 30 days","the last 90 days","1 year"],values:[30,90,365]}},Lt=gi(()=>{if(r.nearby311){let We=[...r.nearby311.data.rows].filter(it=>{let Qe=new Date(it.requested_datetime);return(new Date-Qe)/(1e3*60*60*24)<=nt.value});return ee.value==="distance"?We.sort((it,Qe)=>it.distance-Qe.distance):ee.value==="time"&&We.sort((it,Qe)=>A(it,Qe,"requested_datetime")),We}}),li=gi(()=>{let We=[];if(!Lt.value)return We;for(let it of Lt.value)We.push({type:"Feature",geometry:{type:"Point",coordinates:[it.lng,it.lat]},properties:{id:it.service_request_id,type:"nearby311"}});return We});zn(()=>li.value,We=>{if(console.log("nearby311Geojson watch, newGeojson:",We),We.length>0){console.log("$config:",Hr,"map.getStyle().sources:",d.getStyle().sources,"map.getStyle().layers:",d.getStyle().layers);let it={type:"FeatureCollection",features:We};console.log("geojson:",it,"map.getSource(nearby):",d.getSource("nearby")),d.getSource("nearby").setData(it)}});const Ei=gi(()=>{if(r.nearbyCrimeIncidents){let We=[...r.nearbyCrimeIncidents.data.rows].filter(it=>{let Qe=new Date(it.dispatch_date);return(new Date-Qe)/(1e3*60*60*24)<=nt.value});return ee.value==="distance"?We.sort((it,Qe)=>it.distance-Qe.distance):ee.value==="time"&&We.sort((it,Qe)=>A(it,Qe,"dispatch_date")),We}}),ci=gi(()=>{let We=[];if(!Ei.value)return We;for(let it of Ei.value)We.push({type:"Feature",geometry:{type:"Point",coordinates:[it.lng,it.lat]},properties:{id:it.objectid,type:"nearbyCrimeIncidents"}});return We});zn(()=>ci.value,async We=>{if(console.log("nearbyCrimeIncidents watch, newGeojson:",We),We.length>0){console.log("$config:",Hr,"map.getStyle().sources:",d.getStyle().sources,"map.getStyle().layers:",d.getStyle().layers);let it={type:"FeatureCollection",features:We};await d.getSource("nearby").setData(it)}});const xt=gi(()=>{if(r.nearbyZoningAppeals){let We=[...r.nearbyZoningAppeals.data.rows];return console.log(new Date(We[0].scheduleddate)),nt.value<0?We=We.filter(it=>{let Qe=new Date(it.scheduleddate);return(new Date-Qe)/(1e3*60*60*24)>=nt.value}):nt.value>0&&(We=We.filter(it=>{let Qe=new Date(it.scheduleddate);return(new Date-Qe)/(1e3*60*60*24)<=nt.value})),ee.value==="distance"?We.sort((it,Qe)=>it.distance-Qe.distance):ee.value==="time"&&We.sort((it,Qe)=>A(it,Qe,"dispatch_date")),We}}),kt=gi(()=>{if(r.nearbyVacantIndicatorPoints){let We=[...r.nearbyVacantIndicatorPoints];return ee.value==="distance"?We.sort((it,Qe)=>it._distance-Qe._distance):ee.value==="type"&&We.sort((it,Qe)=>it.distance-Qe.distance),We}}),$t=gi(()=>a.hoveredStateId),ai=We=>{const it=We.getBoundingClientRect(),Qe={top:it.top>=108,left:it.left>=0,bottom:it.bottom<=(window.innerHeight||document.documentElement.clientHeight),right:it.right<=(window.innerWidth||document.documentElement.clientWidth)};return Object.values(Qe).every(Xi=>Xi)};zn(()=>$t.value,We=>{if(console.log("hoveredStateId watch, newHoveredStateId:",We),We){const it=document.getElementById(We);ai(it)||it.scrollIntoView({block:"center"})}});const Zi=We=>{console.log("handleRowMouseover, e.target.parentElement.id:",We.target.parentElement.id),a.hoveredStateId=parseInt(We.target.parentElement.id)},Bi=We=>{console.log("handleRowMouseleave, e.target.id:",We.target.id),a.hoveredStateId=""};return(We,it)=>(wt(),Ft("section",null,[RL,J("div",{class:ns(k.value?"dropdown is-active":"dropdown"),onClick:z},[zL,J("div",OL,[J("div",FL,[J("a",{class:"dropdown-item",onClick:it[0]||(it[0]=Qe=>X("nearby311"))},"311 Requests"),J("a",{class:"dropdown-item",onClick:it[1]||(it[1]=Qe=>X("nearbyCrimeIncidents"))},"Crime Incidents"),J("a",{class:"dropdown-item",onClick:it[2]||(it[2]=Qe=>X("nearbyZoningAppeals"))},"Zoning Appeals"),J("a",{class:"dropdown-item",onClick:it[3]||(it[3]=Qe=>X("nearbyVacantIndicatorPoints"))},"Vacant Properties"),J("a",{class:"dropdown-item",onClick:it[4]||(it[4]=Qe=>X("nearbyConstructionPermits"))},"Construction Permits"),J("a",{class:"dropdown-item",onClick:it[5]||(it[5]=Qe=>X("nearbyDemolitionPermits"))},"Demolition Permits"),J("a",{class:"dropdown-item",onClick:it[6]||(it[6]=Qe=>X("nearbyImminentlyDangerous"))},"Imminently Dangerous")])])],2),J("span",null,Ht(R[W.value]),1),BL,J("div",{class:ns(Ue.value?"dropdown is-active":"dropdown"),onClick:Xe},[NL,J("div",$L,[J("div",UL,[(wt(!0),Ft(Mr,null,Rs(Ot[W.value].values,(Qe,Xi)=>(wt(),Ft("a",{class:"dropdown-item",onClick:ji=>At(Qe)},Ht(Ot[W.value].labels[Xi]),9,VL))),256))])])],2),J("span",null,Ht(ft.value),1),J("div",{class:ns(ye.value?"dropdown is-active":"dropdown"),onClick:we},[jL,J("div",qL,[J("div",GL,[J("a",{class:"dropdown-item",onClick:it[7]||(it[7]=Qe=>Ie("distance"))},"distance"),J("a",{class:"dropdown-item",onClick:it[8]||(it[8]=Qe=>Ie("time"))},"time")])])],2),J("span",null,Ht(ee.value),1),HL,W.value=="nearby311"?(wt(),Ft("div",WL,[ZL,Z.value?(wt(),Ft("div",XL,"Loading...")):Gi("",!0),J("table",KL,[YL,J("tbody",null,[(wt(!0),Ft(Mr,null,Rs(Lt.value,Qe=>(wt(),Ft("tr",{key:Qe.service_request_id,id:Qe.service_request_id,onMouseover:Zi,onMouseleave:Bi,class:ns($t.value==Qe.service_request_id?"active":"inactive")},[J("td",null,Ht(zi(m)(Qe.requested_datetime)),1),J("td",null,Ht(Qe.address),1),J("td",null,Ht(Qe.service_name),1),J("td",null,Ht((Qe.distance*3.28084).toFixed(0))+" ft",1)],42,JL))),128))])])])):Gi("",!0),W.value=="nearbyCrimeIncidents"?(wt(),Ft("div",QL,[eR,Z.value?(wt(),Ft("div",tR,"Loading...")):Gi("",!0),J("table",iR,[rR,J("tbody",null,[(wt(!0),Ft(Mr,null,Rs(Ei.value,Qe=>(wt(),Ft("tr",{key:Qe.objectid,id:Qe.objectid,onMouseover:Zi,onMouseleave:Bi,class:ns($t.value==Qe.objectid?"active":"inactive")},[J("td",null,Ht(Qe.dispatch_date),1),J("td",null,Ht(Qe.location_block),1),J("td",null,Ht(Qe.text_general_code),1),J("td",null,Ht((Qe.distance*3.28084).toFixed(0))+" ft",1)],42,nR))),128))])])])):Gi("",!0),W.value=="nearbyZoningAppeals"?(wt(),Ft("div",sR,[aR,Z.value?(wt(),Ft("div",oR,"Loading...")):Gi("",!0),J("table",lR,[cR,J("tbody",null,[(wt(!0),Ft(Mr,null,Rs(xt.value,Qe=>(wt(),Ft("tr",{key:Qe.objectid,id:Qe.objectid,onMouseover:Zi,onMouseleave:Bi,class:ns($t.value==Qe.objectid?"active":"inactive")},[J("td",null,Ht(Qe.scheduleddate),1),J("td",null,Ht(Qe.address),1),J("td",null,Ht(Qe.appeal_grounds),1),J("td",null,Ht((Qe.distance*3.28084).toFixed(0))+" ft",1)],42,uR))),128))])])])):Gi("",!0),W.value=="nearbyVacantIndicatorPoints"?(wt(),Ft("div",hR,[dR,Z.value?(wt(),Ft("div",pR,"Loading...")):Gi("",!0),J("table",fR,[mR,J("tbody",null,[(wt(!0),Ft(Mr,null,Rs(kt.value,Qe=>(wt(),Ft("tr",{key:Qe.OBJECTID,id:Qe.OBJECTID,onMouseover:Zi,onMouseleave:Bi,class:ns($t.value==Qe.OBJECTID?"active":"inactive")},[J("td",null,Ht(Qe.properties.ADDRESS),1),J("td",null,Ht(Qe.properties.VACANT_FLAG),1),J("td",null,Ht((Qe._distance*3.28084).toFixed(0))+" ft",1)],42,gR))),128))])])])):Gi("",!0)]))}},_R=Fs(yR,[["__scopeId","data-v-5a0417bf"]]),vR=e=>(qh("data-v-92e70966"),e=e(),Gh(),e),xR={key:0,class:"columns"},bR=F2('<div class="column is-12" data-v-92e70966><h3 class="subtitle is-3" data-v-92e70966>Atlas is your front door to the City of Philadelphia.</h3><p class="subtitle is-5" data-v-92e70966>Here are some things you can do with Atlas:</p><ul data-v-92e70966><li data-v-92e70966>Find your polling place</li><li data-v-92e70966>Get the history of permits, licenses, and inspections at any address</li><li data-v-92e70966>Research real estate information including property values, zoning, and document archives</li><li data-v-92e70966>Get easy access to a variety of hard-to-find City resources</li><li data-v-92e70966>View recent activity around your address, such as crimes, 311 service requests, and more</li><li data-v-92e70966>Explore historical imagery and maps</li></ul><p data-v-92e70966>To get started, click anywhere on the map, or type an address, intersection, property assessment account number, or Department of Records Map Registry number into the search box.</p></div>',1),wR=[bR],MR={key:1,class:"columns"},SR=vR(()=>J("div",{class:"column is-12"},[J("p",null,"We couldn't find that address. Are you sure everything was spelled correctly?"),J("p",null,"Here are some examples of things you can search for:"),J("ul",null,[J("li",null,"1234 Market St"),J("li",null,"1001 Pine Street #201"),J("li",null,"12th & Market"),J("li",null,"12th & Market"),J("li",null,"883309050 (an OPA number with no hyphens or other characters)")])],-1)),ER=[SR],TR={key:2},CR={class:"columns"},IR={class:"column is-12"},AR={class:"subtitle is-3"},PR={class:"topics pr-4"},kR={__name:"TopicPanel",setup(e){const r=ea(),a=Op(),u=Zh(),d=gi(()=>r.currentAddress),g=gi(()=>r.dataSourcesLoadedArray);return(m,l)=>(wt(),Ft("section",null,[zi(u).name=="home"?(wt(),Ft("div",xR,wR)):Gi("",!0),zi(u).name=="not-found"?(wt(),Ft("div",MR,ER)):Gi("",!0),d.value?(wt(),Ft("div",TR,[J("div",CR,[J("div",IR,[J("h3",AR,Ht(d.value),1)])]),J("div",PR,[sr(ic,{"topic-name":"Property",loading:!g.value.includes("Property")},{default:Ao(()=>[g.value.includes("Property")?(wt(),Ls(oI,{key:0})):Gi("",!0)]),_:1},8,["loading"]),pv(sr(ic,{"topic-name":"Condominiums",loading:!g.value.includes("Condominiums")},{default:Ao(()=>[g.value.includes("Condominiums")?(wt(),Ls(dI,{key:0})):Gi("",!0)]),_:1},8,["loading"]),[[eM,zi(a).condosData.length>0]]),sr(ic,{"topic-name":"Deeds",loading:!g.value.includes("Deeds")},{default:Ao(()=>[g.value.includes("Deeds")?(wt(),Ls(j3,{key:0})):Gi("",!0)]),_:1},8,["loading"]),sr(ic,{"topic-name":"Licenses & Inspections",loading:!g.value.includes("Licenses & Inspections")},{default:Ao(()=>[g.value.includes("Licenses & Inspections")?(wt(),Ls(xL,{key:0})):Gi("",!0)]),_:1},8,["loading"]),sr(ic,{"topic-name":"Zoning",loading:!g.value.includes("Zoning")},{default:Ao(()=>[g.value.includes("Zoning")?(wt(),Ls(ML,{key:0})):Gi("",!0)]),_:1},8,["loading"]),sr(ic,{"topic-name":"Voting",loading:!g.value.includes("Voting")},{default:Ao(()=>[g.value.includes("Voting")?(wt(),Ls(TL,{key:0})):Gi("",!0)]),_:1},8,["loading"]),sr(ic,{"topic-name":"Nearby Activity",loading:!g.value.includes("Nearby Activity")},{default:Ao(()=>[g.value.includes("Nearby Activity")?(wt(),Ls(_R,{key:0})):Gi("",!0)]),_:1},8,["loading"])])])):Gi("",!0)]))}},DR=Fs(kR,[["__scopeId","data-v-92e70966"]]);class LR{constructor(r,a,u,d=3857,g){this.baseUrl=r,this.username=a,this.password=u,this.srid=d,this.proxy=g}getRecordings(r,a){console.log("recordings-client.js, getRecordings is running, bounds:",r);const u=r.getSouthWest(),d=r.getNorthEast(),g=`<wfs:GetFeature service="WFS" version="1.1.0" resultType="results" outputFormat="text/xml; subtype=gml/3.1.1" xmlns:wfs="http://www.opengis.net/wfs">
											<wfs:Query typeName="atlas:Recording" srsName="EPSG:${this.srid}" xmlns:atlas="http://www.cyclomedia.com/atlas">
												<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc">
						    					<ogc:And>
						      					<ogc:BBOX>
											        <gml:Envelope srsName="EPSG:${this.srid}" xmlns:gml="http://www.opengis.net/gml">
											          <gml:lowerCorner>${u.lng} ${u.lat}</gml:lowerCorner>
											          <gml:upperCorner>${d.lng} ${d.lat}</gml:upperCorner>
											        </gml:Envelope>
											      </ogc:BBOX>
											      <ogc:PropertyIsNull>
											        <ogc:PropertyName>expiredAt</ogc:PropertyName>
											      </ogc:PropertyIsNull>
											    </ogc:And>
											  </ogc:Filter>
											 </wfs:Query>
											</wfs:GetFeature>`,m=(this.proxy||"")+this.baseUrl,l={"Content-Type":"text/xml",Authorization:"Basic "+window.btoa(this.username+":"+this.password)};ar.post(m,g,{headers:l}).then(M=>{console.log("getRecordings axios ran");let A=M.data;function R(Z){return new window.DOMParser().parseFromString(Z,"text/xml")}A=R(A);const k=A.getElementsByTagNameNS("*","Recording"),z=[].slice.call(k);if(z.length<1){console.log("no cyclomedia recordings for bounds");return}const W=z.map(Z=>{const X=Z.getElementsByTagNameNS("*","imageId")[0].firstChild.data,fe=Z.getElementsByTagNameNS("*","pos")[0].firstChild.data,[ye,we]=fe.split(" ").map(parseFloat);return{imageId:X,lng:ye,lat:we}});a(W)})}}var a1={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.3/LICENSE.txt
 */(function(e,r){(function(a,u){e.exports=u()})(Kc,function(){var a={},u={};function d(m,l,M){if(u[m]=M,m==="index"){var A="var sharedModule = {}; ("+u.shared+")(sharedModule); ("+u.worker+")(sharedModule);",R={};return u.shared(R),u.index(a,R),typeof window<"u"&&a.setWorkerUrl(window.URL.createObjectURL(new Blob([A],{type:"text/javascript"}))),a}}d("shared",["exports"],function(m){function l(n,t,s,c){return new(s||(s=Promise))(function(f,v){function x(I){try{T(c.next(I))}catch(L){v(L)}}function w(I){try{T(c.throw(I))}catch(L){v(L)}}function T(I){var L;I.done?f(I.value):(L=I.value,L instanceof s?L:new s(function(O){O(L)})).then(x,w)}T((c=c.apply(n,t||[])).next())})}function M(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}typeof SuppressedError=="function"&&SuppressedError;var A=R;function R(n,t){this.x=n,this.y=t}R.prototype={clone:function(){return new R(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,t){return this.clone()._rotateAround(n,t)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var t=n.x-this.x,s=n.y-this.y;return t*t+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,t){return Math.atan2(this.x*t-this.y*n,this.x*n+this.y*t)},_matMult:function(n){var t=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=t,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var t=Math.cos(n),s=Math.sin(n),c=s*this.x+t*this.y;return this.x=t*this.x-s*this.y,this.y=c,this},_rotateAround:function(n,t){var s=Math.cos(n),c=Math.sin(n),f=t.y+c*(this.x-t.x)+s*(this.y-t.y);return this.x=t.x+s*(this.x-t.x)-c*(this.y-t.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},R.convert=function(n){return n instanceof R?n:Array.isArray(n)?new R(n[0],n[1]):n};var k=M(A),z=W;function W(n,t,s,c){this.cx=3*n,this.bx=3*(s-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(c-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=t,this.p2x=s,this.p2y=c}W.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,t){if(t===void 0&&(t=1e-6),n<0)return 0;if(n>1)return 1;for(var s=n,c=0;c<8;c++){var f=this.sampleCurveX(s)-n;if(Math.abs(f)<t)return s;var v=this.sampleCurveDerivativeX(s);if(Math.abs(v)<1e-6)break;s-=f/v}var x=0,w=1;for(s=n,c=0;c<20&&(f=this.sampleCurveX(s),!(Math.abs(f-n)<t));c++)n>f?x=s:w=s,s=.5*(w-x)+x;return s},solve:function(n,t){return this.sampleCurveY(this.solveCurveX(n,t))}};var Z=M(z);let X,fe;function ye(){return X==null&&(X=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),X}function we(){if(fe==null&&(fe=!1,ye())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let c=0;c<5*5;c++){const f=4*c;t.fillStyle=`rgb(${f},${f+1},${f+2})`,t.fillRect(c%5,Math.floor(c/5),1,1)}const s=t.getImageData(0,0,5,5).data;for(let c=0;c<5*5*4;c++)if(c%4!=3&&s[c]!==c){fe=!0;break}}}return fe||!1}function ee(n,t,s,c){const f=new Z(n,t,s,c);return function(v){return f.solve(v)}}const Ie=ee(.25,.1,.25,1);function Ue(n,t,s){return Math.min(s,Math.max(t,n))}function Xe(n,t,s){const c=s-t,f=((n-t)%c+c)%c+t;return f===t?s:f}function nt(n,...t){for(const s of t)for(const c in s)n[c]=s[c];return n}let ft=1;function At(n,t,s){const c={};for(const f in n)c[f]=t.call(s||this,n[f],f,n);return c}function Ot(n,t,s){const c={};for(const f in n)t.call(s||this,n[f],f,n)&&(c[f]=n[f]);return c}function Lt(n){return Array.isArray(n)?n.map(Lt):typeof n=="object"&&n?At(n,Lt):n}const li={};function Ei(n){li[n]||(typeof console<"u"&&console.warn(n),li[n]=!0)}function ci(n,t,s){return(s.y-n.y)*(t.x-n.x)>(t.y-n.y)*(s.x-n.x)}function xt(n){let t=0;for(let s,c,f=0,v=n.length,x=v-1;f<v;x=f++)s=n[f],c=n[x],t+=(c.x-s.x)*(s.y+c.y);return t}function kt(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let $t=null;function ai(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const Zi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Bi(n,t,s,c,f){return l(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const v=new VideoFrame(n,{timestamp:0});try{const x=v==null?void 0:v.format;if(!x||!x.startsWith("BGR")&&!x.startsWith("RGB"))throw new Error(`Unrecognized format ${x}`);const w=x.startsWith("BGR"),T=new Uint8ClampedArray(c*f*4);if(yield v.copyTo(T,function(I,L,O,$,j){const G=4*Math.max(-L,0),Y=(Math.max(0,O)-O)*$*4+G,ne=4*$,he=Math.max(0,L),Ce=Math.max(0,O);return{rect:{x:he,y:Ce,width:Math.min(I.width,L+$)-he,height:Math.min(I.height,O+j)-Ce},layout:[{offset:Y,stride:ne}]}}(n,t,s,c,f)),w)for(let I=0;I<T.length;I+=4){const L=T[I];T[I]=T[I+2],T[I+2]=L}return T}finally{v.close()}})}let We,it;const Qe="AbortError";function Xi(){return new Error(Qe)}const ji={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Mi(n){return ji.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const je="global-dispatcher";class Tt extends Error{constructor(t,s,c,f){super(`AJAXError: ${s} (${t}): ${c}`),this.status=t,this.statusText=s,this.url=c,this.body=f}}const ut=()=>kt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,et=function(n,t){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const c=Mi(n.url);if(c)return c(n,t);if(kt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:je},t)}if(!(/^file:/.test(s=n.url)||/^file:/.test(ut())&&!/^\w+:/.test(s))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(c,f){return l(this,void 0,void 0,function*(){const v=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,cache:c.cache,referrer:ut(),signal:f.signal});c.type==="json"&&v.headers.set("Accept","application/json");const x=yield fetch(v);if(!x.ok){const I=yield x.blob();throw new Tt(x.status,x.statusText,c.url,I)}let w;w=c.type==="arrayBuffer"||c.type==="image"?x.arrayBuffer():c.type==="json"?x.json():x.text();const T=yield w;if(f.signal.aborted)throw Xi();return{data:T,cacheControl:x.headers.get("Cache-Control"),expires:x.headers.get("Expires")}})}(n,t);if(kt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:je},t)}var s;return function(c,f){return new Promise((v,x)=>{const w=new XMLHttpRequest;w.open(c.method||"GET",c.url,!0),c.type!=="arrayBuffer"&&c.type!=="image"||(w.responseType="arraybuffer");for(const T in c.headers)w.setRequestHeader(T,c.headers[T]);c.type==="json"&&(w.responseType="text",w.setRequestHeader("Accept","application/json")),w.withCredentials=c.credentials==="include",w.onerror=()=>{x(new Error(w.statusText))},w.onload=()=>{if(!f.signal.aborted)if((w.status>=200&&w.status<300||w.status===0)&&w.response!==null){let T=w.response;if(c.type==="json")try{T=JSON.parse(w.response)}catch(I){return void x(I)}v({data:T,cacheControl:w.getResponseHeader("Cache-Control"),expires:w.getResponseHeader("Expires")})}else{const T=new Blob([w.response],{type:w.getResponseHeader("Content-Type")});x(new Tt(w.status,w.statusText,c.url,T))}},f.signal.addEventListener("abort",()=>{w.abort(),x(Xi())}),w.send(c.body)})}(n,t)};function ki(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const t=new URL(n),s=window.location;return t.protocol===s.protocol&&t.host===s.host}function Oi(n,t,s){s[n]&&s[n].indexOf(t)!==-1||(s[n]=s[n]||[],s[n].push(t))}function ae(n,t,s){if(s&&s[n]){const c=s[n].indexOf(t);c!==-1&&s[n].splice(c,1)}}class ue{constructor(t,s={}){nt(this,s),this.type=t}}class De extends ue{constructor(t,s={}){super("error",nt({error:t},s))}}class Fe{on(t,s){return this._listeners=this._listeners||{},Oi(t,s,this._listeners),this}off(t,s){return ae(t,s,this._listeners),ae(t,s,this._oneTimeListeners),this}once(t,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},Oi(t,s,this._oneTimeListeners),this):new Promise(c=>this.once(t,c))}fire(t,s){typeof t=="string"&&(t=new ue(t,s||{}));const c=t.type;if(this.listens(c)){t.target=this;const f=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const w of f)w.call(this,t);const v=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const w of v)ae(c,w,this._oneTimeListeners),w.call(this,t);const x=this._eventedParent;x&&(nt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(t))}else t instanceof De&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,s){return this._eventedParent=t,this._eventedParentData=s,this}}var ce={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const dt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Pt(n,t){const s={};for(const c in n)c!=="ref"&&(s[c]=n[c]);return dt.forEach(c=>{c in t&&(s[c]=t[c])}),s}function Be(n,t){if(Array.isArray(n)){if(!Array.isArray(t)||n.length!==t.length)return!1;for(let s=0;s<n.length;s++)if(!Be(n[s],t[s]))return!1;return!0}if(typeof n=="object"&&n!==null&&t!==null){if(typeof t!="object"||Object.keys(n).length!==Object.keys(t).length)return!1;for(const s in n)if(!Be(n[s],t[s]))return!1;return!0}return n===t}function st(n,t){n.push(t)}function rt(n,t,s){st(s,{command:"addSource",args:[n,t[n]]})}function Dt(n,t,s){st(t,{command:"removeSource",args:[n]}),s[n]=!0}function Kt(n,t,s,c){Dt(n,s,c),rt(n,t,s)}function Zt(n,t,s){let c;for(c in n[s])if(Object.prototype.hasOwnProperty.call(n[s],c)&&c!=="data"&&!Be(n[s][c],t[s][c]))return!1;for(c in t[s])if(Object.prototype.hasOwnProperty.call(t[s],c)&&c!=="data"&&!Be(n[s][c],t[s][c]))return!1;return!0}function Jt(n,t,s,c,f,v){n=n||{},t=t||{};for(const x in n)Object.prototype.hasOwnProperty.call(n,x)&&(Be(n[x],t[x])||s.push({command:v,args:[c,x,t[x],f]}));for(const x in t)Object.prototype.hasOwnProperty.call(t,x)&&!Object.prototype.hasOwnProperty.call(n,x)&&(Be(n[x],t[x])||s.push({command:v,args:[c,x,t[x],f]}))}function yi(n){return n.id}function Ti(n,t){return n[t.id]=t,n}class Ve{constructor(t,s,c,f){this.message=(t?`${t}: `:"")+c,f&&(this.identifier=f),s!=null&&s.__line__&&(this.line=s.__line__)}}function Ni(n,...t){for(const s of t)for(const c in s)n[c]=s[c];return n}class Qi extends Error{constructor(t,s){super(s),this.message=s,this.key=t}}class _n{constructor(t,s=[]){this.parent=t,this.bindings={};for(const[c,f]of s)this.bindings[c]=f}concat(t){return new _n(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Sr={kind:"null"},at={kind:"number"},ui={kind:"string"},Ut={kind:"boolean"},qi={kind:"color"},vn={kind:"object"},ii={kind:"value"},ta={kind:"collator"},Er={kind:"formatted"},ie={kind:"padding"},N={kind:"resolvedImage"},U={kind:"variableAnchorOffsetCollection"};function H(n,t){return{kind:"array",itemType:n,N:t}}function Q(n){if(n.kind==="array"){const t=Q(n.itemType);return typeof n.N=="number"?`array<${t}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${t}>`}return n.kind}const ve=[Sr,at,ui,Ut,qi,Er,vn,H(ii),ie,N,U];function xe(n,t){if(t.kind==="error")return null;if(n.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!xe(n.itemType,t.itemType))&&(typeof n.N!="number"||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if(n.kind==="value"){for(const s of ve)if(!xe(s,t))return null}}return`Expected ${Q(n)} but found ${Q(t)} instead.`}function Se(n,t){return t.some(s=>s.kind===n.kind)}function de(n,t){return t.some(s=>s==="null"?n===null:s==="array"?Array.isArray(n):s==="object"?n&&!Array.isArray(n)&&typeof n=="object":s===typeof n)}function Ae(n,t){return n.kind==="array"&&t.kind==="array"?n.itemType.kind===t.itemType.kind&&typeof n.N=="number":n.kind===t.kind}const Ge=.96422,ze=.82521,Ne=4/29,Vt=6/29,Wt=3*Vt*Vt,ri=Vt*Vt*Vt,ni=Math.PI/180,vi=180/Math.PI;function Ui(n){return(n%=360)<0&&(n+=360),n}function cr([n,t,s,c]){let f,v;const x=Yt((.2225045*(n=Br(n))+.7168786*(t=Br(t))+.0606169*(s=Br(s)))/1);n===t&&t===s?f=v=x:(f=Yt((.4360747*n+.3850649*t+.1430804*s)/Ge),v=Yt((.0139322*n+.0971045*t+.7141733*s)/ze));const w=116*x-16;return[w<0?0:w,500*(f-x),200*(x-v),c]}function Br(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Yt(n){return n>ri?Math.pow(n,1/3):n/Wt+Ne}function _r([n,t,s,c]){let f=(n+16)/116,v=isNaN(t)?f:f+t/500,x=isNaN(s)?f:f-s/200;return f=1*xn(f),v=Ge*xn(v),x=ze*xn(x),[Vr(3.1338561*v-1.6168667*f-.4906146*x),Vr(-.9787684*v+1.9161415*f+.033454*x),Vr(.0719453*v-.2289914*f+1.4052427*x),c]}function Vr(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function xn(n){return n>Vt?n*n*n:Wt*(n-Ne)}function bn(n){return parseInt(n.padEnd(2,n),16)/255}function Zr(n,t){return Hn(t?n/100:n,0,1)}function Hn(n,t,s){return Math.min(Math.max(t,n),s)}function gc(n){return!n.some(Number.isNaN)}const zo={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Vi{constructor(t,s,c,f=1,v=!0){this.r=t,this.g=s,this.b=c,this.a=f,v||(this.r*=f,this.g*=f,this.b*=f,f||this.overwriteGetter("rgb",[t,s,c,f]))}static parse(t){if(t instanceof Vi)return t;if(typeof t!="string")return;const s=function(c){if((c=c.toLowerCase().trim())==="transparent")return[0,0,0,0];const f=zo[c];if(f){const[x,w,T]=f;return[x/255,w/255,T/255,1]}if(c.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(c)){const x=c.length<6?1:2;let w=1;return[bn(c.slice(w,w+=x)),bn(c.slice(w,w+=x)),bn(c.slice(w,w+=x)),bn(c.slice(w,w+x)||"ff")]}if(c.startsWith("rgb")){const x=c.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[w,T,I,L,O,$,j,G,Y,ne,he,Ce]=x,pe=[L||" ",j||" ",ne].join("");if(pe==="  "||pe==="  /"||pe===",,"||pe===",,,"){const be=[I,$,Y].join(""),$e=be==="%%%"?100:be===""?255:0;if($e){const He=[Hn(+T/$e,0,1),Hn(+O/$e,0,1),Hn(+G/$e,0,1),he?Zr(+he,Ce):1];if(gc(He))return He}}return}}const v=c.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[x,w,T,I,L,O,$,j,G]=v,Y=[T||" ",L||" ",$].join("");if(Y==="  "||Y==="  /"||Y===",,"||Y===",,,"){const ne=[+w,Hn(+I,0,100),Hn(+O,0,100),j?Zr(+j,G):1];if(gc(ne))return function([he,Ce,pe,be]){function $e(He){const It=(He+he/30)%12,Nt=Ce*Math.min(pe,1-pe);return pe-Nt*Math.max(-1,Math.min(It-3,9-It,1))}return he=Ui(he),Ce/=100,pe/=100,[$e(0),$e(8),$e(4),be]}(ne)}}}(t);return s?new Vi(...s,!1):void 0}get rgb(){const{r:t,g:s,b:c,a:f}=this,v=f||1/0;return this.overwriteGetter("rgb",[t/v,s/v,c/v,f])}get hcl(){return this.overwriteGetter("hcl",function(t){const[s,c,f,v]=cr(t),x=Math.sqrt(c*c+f*f);return[Math.round(1e4*x)?Ui(Math.atan2(f,c)*vi):NaN,x,s,v]}(this.rgb))}get lab(){return this.overwriteGetter("lab",cr(this.rgb))}overwriteGetter(t,s){return Object.defineProperty(this,t,{value:s}),s}toString(){const[t,s,c,f]=this.rgb;return`rgba(${[t,s,c].map(v=>Math.round(255*v)).join(",")},${f})`}}Vi.black=new Vi(0,0,0,1),Vi.white=new Vi(1,1,1,1),Vi.transparent=new Vi(0,0,0,0),Vi.red=new Vi(1,0,0,1);class lo{constructor(t,s,c){this.sensitivity=t?s?"variant":"case":s?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,s){return this.collator.compare(t,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class kr{constructor(t,s,c,f,v){this.text=t,this.image=s,this.scale=c,this.fontStack=f,this.textColor=v}}class kn{constructor(t){this.sections=t}static fromString(t){return new kn([new kr(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof kn?t:kn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class wn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof wn)return t;if(typeof t=="number")return new wn([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const s of t)if(typeof s!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new wn(t)}}toString(){return JSON.stringify(this.values)}}const Wn=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Dr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Dr)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let s=0;s<t.length;s+=2){const c=t[s],f=t[s+1];if(typeof c!="string"||!Wn.has(c)||!Array.isArray(f)||f.length!==2||typeof f[0]!="number"||typeof f[1]!="number")return}return new Dr(t)}}toString(){return JSON.stringify(this.values)}}class Mn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Mn({name:t,available:!1}):null}}function Zn(n,t,s,c){return typeof n=="number"&&n>=0&&n<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof s=="number"&&s>=0&&s<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[n,t,s,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[n,t,s,c]:[n,t,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function bs(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Vi||n instanceof lo||n instanceof kn||n instanceof wn||n instanceof Dr||n instanceof Mn)return!0;if(Array.isArray(n)){for(const t of n)if(!bs(t))return!1;return!0}if(typeof n=="object"){for(const t in n)if(!bs(n[t]))return!1;return!0}return!1}function Lr(n){if(n===null)return Sr;if(typeof n=="string")return ui;if(typeof n=="boolean")return Ut;if(typeof n=="number")return at;if(n instanceof Vi)return qi;if(n instanceof lo)return ta;if(n instanceof kn)return Er;if(n instanceof wn)return ie;if(n instanceof Dr)return U;if(n instanceof Mn)return N;if(Array.isArray(n)){const t=n.length;let s;for(const c of n){const f=Lr(c);if(s){if(s===f)continue;s=ii;break}s=f}return H(s||ii,t)}return vn}function co(n){const t=typeof n;return n===null?"":t==="string"||t==="number"||t==="boolean"?String(n):n instanceof Vi||n instanceof kn||n instanceof wn||n instanceof Dr||n instanceof Mn?n.toString():JSON.stringify(n)}class ia{constructor(t,s){this.type=t,this.value=s}static parse(t,s){if(t.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!bs(t[1]))return s.error("invalid value");const c=t[1];let f=Lr(c);const v=s.expectedType;return f.kind!=="array"||f.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(f=v),new ia(f,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class pr{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const uo={string:ui,number:at,boolean:Ut,object:vn};class Sn{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");let c,f=1;const v=t[0];if(v==="array"){let w,T;if(t.length>2){const I=t[1];if(typeof I!="string"||!(I in uo)||I==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);w=uo[I],f++}else w=ii;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return s.error('The length argument to "array" must be a positive integer literal',2);T=t[2],f++}c=H(w,T)}else{if(!uo[v])throw new Error(`Types doesn't contain name = ${v}`);c=uo[v]}const x=[];for(;f<t.length;f++){const w=s.parse(t[f],f,ii);if(!w)return null;x.push(w)}return new Sn(c,x)}evaluate(t){for(let s=0;s<this.args.length;s++){const c=this.args[s].evaluate(t);if(!xe(this.type,Lr(c)))return c;if(s===this.args.length-1)throw new pr(`Expected value to be of type ${Q(this.type)}, but found ${Q(Lr(c))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const ho={"to-boolean":Ut,"to-color":qi,"to-number":at,"to-string":ui};class os{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const c=t[0];if(!ho[c])throw new Error(`Can't parse ${c} as it is not part of the known types`);if((c==="to-boolean"||c==="to-string")&&t.length!==2)return s.error("Expected one argument.");const f=ho[c],v=[];for(let x=1;x<t.length;x++){const w=s.parse(t[x],x,ii);if(!w)return null;v.push(w)}return new os(f,v)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let s,c;for(const f of this.args){if(s=f.evaluate(t),c=null,s instanceof Vi)return s;if(typeof s=="string"){const v=t.parseColor(s);if(v)return v}else if(Array.isArray(s)&&(c=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Zn(s[0],s[1],s[2],s[3]),!c))return new Vi(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new pr(c||`Could not parse color from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"padding":{let s;for(const c of this.args){s=c.evaluate(t);const f=wn.parse(s);if(f)return f}throw new pr(`Could not parse padding from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"variableAnchorOffsetCollection":{let s;for(const c of this.args){s=c.evaluate(t);const f=Dr.parse(s);if(f)return f}throw new pr(`Could not parse variableAnchorOffsetCollection from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"number":{let s=null;for(const c of this.args){if(s=c.evaluate(t),s===null)return 0;const f=Number(s);if(!isNaN(f))return f}throw new pr(`Could not convert ${JSON.stringify(s)} to number.`)}case"formatted":return kn.fromString(co(this.args[0].evaluate(t)));case"resolvedImage":return Mn.fromString(co(this.args[0].evaluate(t)));default:return co(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const po=["Unknown","Point","LineString","Polygon"];class Hi{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?po[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let s=this._parseColorCache[t];return s||(s=this._parseColorCache[t]=Vi.parse(t)),s}}class Oo{constructor(t,s,c=[],f,v=new _n,x=[]){this.registry=t,this.path=c,this.key=c.map(w=>`[${w}]`).join(""),this.scope=v,this.errors=x,this.expectedType=f,this._isConstant=s}parse(t,s,c,f,v={}){return s?this.concat(s,c,f)._parse(t,v):this._parse(t,v)}_parse(t,s){function c(f,v,x){return x==="assert"?new Sn(v,[f]):x==="coerce"?new os(v,[f]):f}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=t[0];if(typeof f!="string")return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[f];if(v){let x=v.parse(t,this);if(!x)return null;if(this.expectedType){const w=this.expectedType,T=x.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||T.kind!=="value")if(w.kind!=="color"&&w.kind!=="formatted"&&w.kind!=="resolvedImage"||T.kind!=="value"&&T.kind!=="string")if(w.kind!=="padding"||T.kind!=="value"&&T.kind!=="number"&&T.kind!=="array")if(w.kind!=="variableAnchorOffsetCollection"||T.kind!=="value"&&T.kind!=="array"){if(this.checkSubtype(w,T))return null}else x=c(x,w,s.typeAnnotation||"coerce");else x=c(x,w,s.typeAnnotation||"coerce");else x=c(x,w,s.typeAnnotation||"coerce");else x=c(x,w,s.typeAnnotation||"assert")}if(!(x instanceof ia)&&x.type.kind!=="resolvedImage"&&this._isConstant(x)){const w=new Hi;try{x=new ia(x.type,x.evaluate(w))}catch(T){return this.error(T.message),null}}return x}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,s,c){const f=typeof t=="number"?this.path.concat(t):this.path,v=c?this.scope.concat(c):this.scope;return new Oo(this.registry,this._isConstant,f,s||null,v,this.errors)}error(t,...s){const c=`${this.key}${s.map(f=>`[${f}]`).join("")}`;this.errors.push(new Qi(c,t))}checkSubtype(t,s){const c=xe(t,s);return c&&this.error(c),c}}class Us{constructor(t,s,c){this.type=ta,this.locale=c,this.caseSensitive=t,this.diacriticSensitive=s}static parse(t,s){if(t.length!==2)return s.error("Expected one argument.");const c=t[1];if(typeof c!="object"||Array.isArray(c))return s.error("Collator options argument must be an object.");const f=s.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,Ut);if(!f)return null;const v=s.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,Ut);if(!v)return null;let x=null;return c.locale&&(x=s.parse(c.locale,1,ui),!x)?null:new Us(f,v,x)}evaluate(t){return new lo(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}const b=8192;function P(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function V(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function oe(n,t){const s=(180+n[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,f=Math.pow(2,t.z);return[Math.round(s*f*b),Math.round(c*f*b)]}function ge(n,t,s){const c=n[0]-t[0],f=n[1]-t[1],v=n[0]-s[0],x=n[1]-s[1];return c*x-v*f==0&&c*v<=0&&f*x<=0}function _e(n,t){let s=!1;for(let x=0,w=t.length;x<w;x++){const T=t[x];for(let I=0,L=T.length;I<L-1;I++){if(ge(n,T[I],T[I+1]))return!1;(f=T[I])[1]>(c=n)[1]!=(v=T[I+1])[1]>c[1]&&c[0]<(v[0]-f[0])*(c[1]-f[1])/(v[1]-f[1])+f[0]&&(s=!s)}}var c,f,v;return s}function Ee(n,t){for(let s=0;s<t.length;s++)if(_e(n,t[s]))return!0;return!1}function Je(n,t,s,c){const f=c[0]-s[0],v=c[1]-s[1],x=(n[0]-s[0])*v-f*(n[1]-s[1]),w=(t[0]-s[0])*v-f*(t[1]-s[1]);return x>0&&w<0||x<0&&w>0}function lt(n,t,s){for(const I of s)for(let L=0;L<I.length-1;++L)if((w=[(x=I[L+1])[0]-(v=I[L])[0],x[1]-v[1]])[0]*(T=[(f=t)[0]-(c=n)[0],f[1]-c[1]])[1]-w[1]*T[0]!=0&&Je(c,f,v,x)&&Je(v,x,c,f))return!0;var c,f,v,x,w,T;return!1}function Mt(n,t){for(let s=0;s<n.length;++s)if(!_e(n[s],t))return!1;for(let s=0;s<n.length-1;++s)if(lt(n[s],n[s+1],t))return!1;return!0}function St(n,t){for(let s=0;s<t.length;s++)if(Mt(n,t[s]))return!0;return!1}function pt(n,t,s){const c=[];for(let f=0;f<n.length;f++){const v=[];for(let x=0;x<n[f].length;x++){const w=oe(n[f][x],s);P(t,w),v.push(w)}c.push(v)}return c}function oi(n,t,s){const c=[];for(let f=0;f<n.length;f++){const v=pt(n[f],t,s);c.push(v)}return c}function fr(n,t,s,c){if(n[0]<s[0]||n[0]>s[2]){const f=.5*c;let v=n[0]-s[0]>f?-c:s[0]-n[0]>f?c:0;v===0&&(v=n[0]-s[2]>f?-c:s[2]-n[0]>f?c:0),n[0]+=v}P(t,n)}function hi(n,t,s,c){const f=Math.pow(2,c.z)*b,v=[c.x*b,c.y*b],x=[];for(const w of n)for(const T of w){const I=[T.x+v[0],T.y+v[1]];fr(I,t,s,f),x.push(I)}return x}function Rr(n,t,s,c){const f=Math.pow(2,c.z)*b,v=[c.x*b,c.y*b],x=[];for(const T of n){const I=[];for(const L of T){const O=[L.x+v[0],L.y+v[1]];P(t,O),I.push(O)}x.push(I)}if(t[2]-t[0]<=f/2){(w=t)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const T of x)for(const I of T)fr(I,t,s,f)}var w;return x}class qe{constructor(t,s){this.type=Ut,this.geojson=t,this.geometries=s}static parse(t,s){if(t.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(bs(t[1])){const c=t[1];if(c.type==="FeatureCollection"){const f=[];for(const v of c.features){const{type:x,coordinates:w}=v.geometry;x==="Polygon"&&f.push(w),x==="MultiPolygon"&&f.push(...w)}if(f.length)return new qe(c,{type:"MultiPolygon",coordinates:f})}else if(c.type==="Feature"){const f=c.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new qe(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new qe(c,c)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(s,c){const f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=s.canonicalID();if(c.type==="Polygon"){const w=pt(c.coordinates,v,x),T=hi(s.geometry(),f,v,x);if(!V(f,v))return!1;for(const I of T)if(!_e(I,w))return!1}if(c.type==="MultiPolygon"){const w=oi(c.coordinates,v,x),T=hi(s.geometry(),f,v,x);if(!V(f,v))return!1;for(const I of T)if(!Ee(I,w))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(s,c){const f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=s.canonicalID();if(c.type==="Polygon"){const w=pt(c.coordinates,v,x),T=Rr(s.geometry(),f,v,x);if(!V(f,v))return!1;for(const I of T)if(!Mt(I,w))return!1}if(c.type==="MultiPolygon"){const w=oi(c.coordinates,v,x),T=Rr(s.geometry(),f,v,x);if(!V(f,v))return!1;for(const I of T)if(!St(I,w))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Bt{constructor(t,s){this.type=s.type,this.name=t,this.boundExpression=s}static parse(t,s){if(t.length!==2||typeof t[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const c=t[1];return s.scope.has(c)?new Bt(c,s.scope.get(c)):s.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class xi{constructor(t,s,c,f){this.name=t,this.type=s,this._evaluate=c,this.args=f}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,s){const c=t[0],f=xi.definitions[c];if(!f)return s.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(f)?f[0]:f.type,x=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,w=x.filter(([I])=>!Array.isArray(I)||I.length===t.length-1);let T=null;for(const[I,L]of w){T=new Oo(s.registry,Tr,s.path,null,s.scope);const O=[];let $=!1;for(let j=1;j<t.length;j++){const G=t[j],Y=Array.isArray(I)?I[j-1]:I.type,ne=T.parse(G,1+O.length,Y);if(!ne){$=!0;break}O.push(ne)}if(!$)if(Array.isArray(I)&&I.length!==O.length)T.error(`Expected ${I.length} arguments, but found ${O.length} instead.`);else{for(let j=0;j<O.length;j++){const G=Array.isArray(I)?I[j]:I.type,Y=O[j];T.concat(j+1).checkSubtype(G,Y.type)}if(T.errors.length===0)return new xi(c,v,L,O)}}if(w.length===1)s.errors.push(...T.errors);else{const I=(w.length?w:x).map(([O])=>{return $=O,Array.isArray($)?`(${$.map(Q).join(", ")})`:`(${Q($.type)}...)`;var $}).join(" | "),L=[];for(let O=1;O<t.length;O++){const $=s.parse(t[O],1+L.length);if(!$)return null;L.push(Q($.type))}s.error(`Expected arguments of type ${I}, but found (${L.join(", ")}) instead.`)}return null}static register(t,s){xi.definitions=s;for(const c in s)t[c]=xi}}function Tr(n){if(n instanceof Bt)return Tr(n.boundExpression);if(n instanceof xi&&n.name==="error"||n instanceof Us||n instanceof qe)return!1;const t=n instanceof os||n instanceof Sn;let s=!0;return n.eachChild(c=>{s=t?s&&Tr(c):s&&c instanceof ia}),!!s&&vr(n)&&fo(n,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function vr(n){if(n instanceof xi&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof qe)return!1;let t=!0;return n.eachChild(s=>{t&&!vr(s)&&(t=!1)}),t}function va(n){if(n instanceof xi&&n.name==="feature-state")return!1;let t=!0;return n.eachChild(s=>{t&&!va(s)&&(t=!1)}),t}function fo(n,t){if(n instanceof xi&&t.indexOf(n.name)>=0)return!1;let s=!0;return n.eachChild(c=>{s&&!fo(c,t)&&(s=!1)}),s}function Ki(n,t){const s=n.length-1;let c,f,v=0,x=s,w=0;for(;v<=x;)if(w=Math.floor((v+x)/2),c=n[w],f=n[w+1],c<=t){if(w===s||t<f)return w;v=w+1}else{if(!(c>t))throw new pr("Input is not a number.");x=w-1}return 0}class $a{constructor(t,s,c){this.type=t,this.input=s,this.labels=[],this.outputs=[];for(const[f,v]of c)this.labels.push(f),this.outputs.push(v)}static parse(t,s){if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");const c=s.parse(t[1],1,at);if(!c)return null;const f=[];let v=null;s.expectedType&&s.expectedType.kind!=="value"&&(v=s.expectedType);for(let x=1;x<t.length;x+=2){const w=x===1?-1/0:t[x],T=t[x+1],I=x,L=x+1;if(typeof w!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(f.length&&f[f.length-1][0]>=w)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const O=s.parse(T,L,v);if(!O)return null;v=v||O.type,f.push([w,O])}return new $a(v,c,f)}evaluate(t){const s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(t);const f=this.input.evaluate(t);if(f<=s[0])return c[0].evaluate(t);const v=s.length;return f>=s[v-1]?c[v-1].evaluate(t):c[Ki(s,f)].evaluate(t)}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Su(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Vs=Il;function Il(n,t,s,c){this.cx=3*n,this.bx=3*(s-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(c-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=t,this.p2x=s,this.p2y=c}Il.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,t){if(t===void 0&&(t=1e-6),n<0)return 0;if(n>1)return 1;for(var s=n,c=0;c<8;c++){var f=this.sampleCurveX(s)-n;if(Math.abs(f)<t)return s;var v=this.sampleCurveDerivativeX(s);if(Math.abs(v)<1e-6)break;s-=f/v}var x=0,w=1;for(s=n,c=0;c<20&&(f=this.sampleCurveX(s),!(Math.abs(f-n)<t));c++)n>f?x=s:w=s,s=.5*(w-x)+x;return s},solve:function(n,t){return this.sampleCurveY(this.solveCurveX(n,t))}};var yc=Su(Vs);function ra(n,t,s){return n+s*(t-n)}function Ua(n,t,s){return n.map((c,f)=>ra(c,t[f],s))}const fn={number:ra,color:function(n,t,s,c="rgb"){switch(c){case"rgb":{const[f,v,x,w]=Ua(n.rgb,t.rgb,s);return new Vi(f,v,x,w,!1)}case"hcl":{const[f,v,x,w]=n.hcl,[T,I,L,O]=t.hcl;let $,j;if(isNaN(f)||isNaN(T))isNaN(f)?isNaN(T)?$=NaN:($=T,x!==1&&x!==0||(j=I)):($=f,L!==1&&L!==0||(j=v));else{let Ce=T-f;T>f&&Ce>180?Ce-=360:T<f&&f-T>180&&(Ce+=360),$=f+s*Ce}const[G,Y,ne,he]=function([Ce,pe,be,$e]){return Ce=isNaN(Ce)?0:Ce*ni,_r([be,Math.cos(Ce)*pe,Math.sin(Ce)*pe,$e])}([$,j??ra(v,I,s),ra(x,L,s),ra(w,O,s)]);return new Vi(G,Y,ne,he,!1)}case"lab":{const[f,v,x,w]=_r(Ua(n.lab,t.lab,s));return new Vi(f,v,x,w,!1)}}},array:Ua,padding:function(n,t,s){return new wn(Ua(n.values,t.values,s))},variableAnchorOffsetCollection:function(n,t,s){const c=n.values,f=t.values;if(c.length!==f.length)throw new pr(`Cannot interpolate values of different length. from: ${n.toString()}, to: ${t.toString()}`);const v=[];for(let x=0;x<c.length;x+=2){if(c[x]!==f[x])throw new pr(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${c[x]}, to[${x}]: ${f[x]}`);v.push(c[x]);const[w,T]=c[x+1],[I,L]=f[x+1];v.push([ra(w,I,s),ra(T,L,s)])}return new Dr(v)}};class en{constructor(t,s,c,f,v){this.type=t,this.operator=s,this.interpolation=c,this.input=f,this.labels=[],this.outputs=[];for(const[x,w]of v)this.labels.push(x),this.outputs.push(w)}static interpolationFactor(t,s,c,f){let v=0;if(t.name==="exponential")v=Fi(s,t.base,c,f);else if(t.name==="linear")v=Fi(s,1,c,f);else if(t.name==="cubic-bezier"){const x=t.controlPoints;v=new yc(x[0],x[1],x[2],x[3]).solve(Fi(s,1,c,f))}return v}static parse(t,s){let[c,f,v,...x]=t;if(!Array.isArray(f)||f.length===0)return s.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){const I=f[1];if(typeof I!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:I}}else{if(f[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const I=f.slice(1);if(I.length!==4||I.some(L=>typeof L!="number"||L<0||L>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:I}}}if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(v=s.parse(v,2,at),!v)return null;const w=[];let T=null;c==="interpolate-hcl"||c==="interpolate-lab"?T=qi:s.expectedType&&s.expectedType.kind!=="value"&&(T=s.expectedType);for(let I=0;I<x.length;I+=2){const L=x[I],O=x[I+1],$=I+3,j=I+4;if(typeof L!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',$);if(w.length&&w[w.length-1][0]>=L)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',$);const G=s.parse(O,j,T);if(!G)return null;T=T||G.type,w.push([L,G])}return Ae(T,at)||Ae(T,qi)||Ae(T,ie)||Ae(T,U)||Ae(T,H(at))?new en(T,c,f,v,w):s.error(`Type ${Q(T)} is not interpolatable.`)}evaluate(t){const s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(t);const f=this.input.evaluate(t);if(f<=s[0])return c[0].evaluate(t);const v=s.length;if(f>=s[v-1])return c[v-1].evaluate(t);const x=Ki(s,f),w=en.interpolationFactor(this.interpolation,f,s[x],s[x+1]),T=c[x].evaluate(t),I=c[x+1].evaluate(t);switch(this.operator){case"interpolate":return fn[this.type.kind](T,I,w);case"interpolate-hcl":return fn.color(T,I,w,"hcl");case"interpolate-lab":return fn.color(T,I,w,"lab")}}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Fi(n,t,s,c){const f=c-s,v=n-s;return f===0?0:t===1?v/f:(Math.pow(t,v)-1)/(Math.pow(t,f)-1)}class Fo{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expectected at least one argument.");let c=null;const f=s.expectedType;f&&f.kind!=="value"&&(c=f);const v=[];for(const w of t.slice(1)){const T=s.parse(w,1+v.length,c,void 0,{typeAnnotation:"omit"});if(!T)return null;c=c||T.type,v.push(T)}if(!c)throw new Error("No output type");const x=f&&v.some(w=>xe(f,w.type));return new Fo(x?ii:c,v)}evaluate(t){let s,c=null,f=0;for(const v of this.args)if(f++,c=v.evaluate(t),c&&c instanceof Mn&&!c.available&&(s||(s=c.name),c=null,f===this.args.length&&(c=s)),c!==null)break;return c}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}class Bo{constructor(t,s){this.type=s.type,this.bindings=[].concat(t),this.result=s}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const s of this.bindings)t(s[1]);t(this.result)}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const c=[];for(let v=1;v<t.length-1;v+=2){const x=t[v];if(typeof x!="string")return s.error(`Expected string, but found ${typeof x} instead.`,v);if(/[^a-zA-Z0-9_]/.test(x))return s.error("Variable names must contain only alphanumeric characters or '_'.",v);const w=s.parse(t[v+1],v+1);if(!w)return null;c.push([x,w])}const f=s.parse(t[t.length-1],t.length-1,s.expectedType,c);return f?new Bo(c,f):null}outputDefined(){return this.result.outputDefined()}}class No{constructor(t,s,c){this.type=t,this.index=s,this.input=c}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,at),f=s.parse(t[2],2,H(s.expectedType||ii));return c&&f?new No(f.type.itemType,c,f):null}evaluate(t){const s=this.index.evaluate(t),c=this.input.evaluate(t);if(s<0)throw new pr(`Array index out of bounds: ${s} < 0.`);if(s>=c.length)throw new pr(`Array index out of bounds: ${s} > ${c.length-1}.`);if(s!==Math.floor(s))throw new pr(`Array index must be an integer, but found ${s} instead.`);return c[s]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class $o{constructor(t,s){this.type=Ut,this.needle=t,this.haystack=s}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,ii),f=s.parse(t[2],2,ii);return c&&f?Se(c.type,[Ut,ui,at,Sr,ii])?new $o(c,f):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Q(c.type)} instead`):null}evaluate(t){const s=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(!c)return!1;if(!de(s,["boolean","string","number","null"]))throw new pr(`Expected first argument to be of type boolean, string, number or null, but found ${Q(Lr(s))} instead.`);if(!de(c,["string","array"]))throw new pr(`Expected second argument to be of type array or string, but found ${Q(Lr(c))} instead.`);return c.indexOf(s)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class mo{constructor(t,s,c){this.type=at,this.needle=t,this.haystack=s,this.fromIndex=c}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,ii),f=s.parse(t[2],2,ii);if(!c||!f)return null;if(!Se(c.type,[Ut,ui,at,Sr,ii]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Q(c.type)} instead`);if(t.length===4){const v=s.parse(t[3],3,at);return v?new mo(c,f,v):null}return new mo(c,f)}evaluate(t){const s=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(!de(s,["boolean","string","number","null"]))throw new pr(`Expected first argument to be of type boolean, string, number or null, but found ${Q(Lr(s))} instead.`);if(!de(c,["string","array"]))throw new pr(`Expected second argument to be of type array or string, but found ${Q(Lr(c))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(t);return c.indexOf(s,f)}return c.indexOf(s)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Al{constructor(t,s,c,f,v,x){this.inputType=t,this.type=s,this.input=c,this.cases=f,this.outputs=v,this.otherwise=x}static parse(t,s){if(t.length<5)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return s.error("Expected an even number of arguments.");let c,f;s.expectedType&&s.expectedType.kind!=="value"&&(f=s.expectedType);const v={},x=[];for(let I=2;I<t.length-1;I+=2){let L=t[I];const O=t[I+1];Array.isArray(L)||(L=[L]);const $=s.concat(I);if(L.length===0)return $.error("Expected at least one branch label.");for(const G of L){if(typeof G!="number"&&typeof G!="string")return $.error("Branch labels must be numbers or strings.");if(typeof G=="number"&&Math.abs(G)>Number.MAX_SAFE_INTEGER)return $.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof G=="number"&&Math.floor(G)!==G)return $.error("Numeric branch labels must be integer values.");if(c){if($.checkSubtype(c,Lr(G)))return null}else c=Lr(G);if(v[String(G)]!==void 0)return $.error("Branch labels must be unique.");v[String(G)]=x.length}const j=s.parse(O,I,f);if(!j)return null;f=f||j.type,x.push(j)}const w=s.parse(t[1],1,ii);if(!w)return null;const T=s.parse(t[t.length-1],t.length-1,f);return T?w.type.kind!=="value"&&s.concat(1).checkSubtype(c,w.type)?null:new Al(c,f,w,v,x,T):null}evaluate(t){const s=this.input.evaluate(t);return(Lr(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Pl{constructor(t,s,c){this.type=t,this.branches=s,this.otherwise=c}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return s.error("Expected an odd number of arguments.");let c;s.expectedType&&s.expectedType.kind!=="value"&&(c=s.expectedType);const f=[];for(let x=1;x<t.length-1;x+=2){const w=s.parse(t[x],x,Ut);if(!w)return null;const T=s.parse(t[x+1],x+1,c);if(!T)return null;f.push([w,T]),c=c||T.type}const v=s.parse(t[t.length-1],t.length-1,c);if(!v)return null;if(!c)throw new Error("Can't infer output type");return new Pl(c,f,v)}evaluate(t){for(const[s,c]of this.branches)if(s.evaluate(t))return c.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[s,c]of this.branches)t(s),t(c);t(this.otherwise)}outputDefined(){return this.branches.every(([t,s])=>s.outputDefined())&&this.otherwise.outputDefined()}}class xa{constructor(t,s,c,f){this.type=t,this.input=s,this.beginIndex=c,this.endIndex=f}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,ii),f=s.parse(t[2],2,at);if(!c||!f)return null;if(!Se(c.type,[H(ii),ui,ii]))return s.error(`Expected first argument to be of type array or string, but found ${Q(c.type)} instead`);if(t.length===4){const v=s.parse(t[3],3,at);return v?new xa(c.type,c,f,v):null}return new xa(c.type,c,f)}evaluate(t){const s=this.input.evaluate(t),c=this.beginIndex.evaluate(t);if(!de(s,["string","array"]))throw new pr(`Expected first argument to be of type array or string, but found ${Q(Lr(s))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(t);return s.slice(c,f)}return s.slice(c)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Uo(n,t){return n==="=="||n==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function kl(n,t,s,c){return c.compare(t,s)===0}function En(n,t,s){const c=n!=="=="&&n!=="!=";return class o1{constructor(v,x,w){this.type=Ut,this.lhs=v,this.rhs=x,this.collator=w,this.hasUntypedArgument=v.type.kind==="value"||x.type.kind==="value"}static parse(v,x){if(v.length!==3&&v.length!==4)return x.error("Expected two or three arguments.");const w=v[0];let T=x.parse(v[1],1,ii);if(!T)return null;if(!Uo(w,T.type))return x.concat(1).error(`"${w}" comparisons are not supported for type '${Q(T.type)}'.`);let I=x.parse(v[2],2,ii);if(!I)return null;if(!Uo(w,I.type))return x.concat(2).error(`"${w}" comparisons are not supported for type '${Q(I.type)}'.`);if(T.type.kind!==I.type.kind&&T.type.kind!=="value"&&I.type.kind!=="value")return x.error(`Cannot compare types '${Q(T.type)}' and '${Q(I.type)}'.`);c&&(T.type.kind==="value"&&I.type.kind!=="value"?T=new Sn(I.type,[T]):T.type.kind!=="value"&&I.type.kind==="value"&&(I=new Sn(T.type,[I])));let L=null;if(v.length===4){if(T.type.kind!=="string"&&I.type.kind!=="string"&&T.type.kind!=="value"&&I.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(L=x.parse(v[3],3,ta),!L)return null}return new o1(T,I,L)}evaluate(v){const x=this.lhs.evaluate(v),w=this.rhs.evaluate(v);if(c&&this.hasUntypedArgument){const T=Lr(x),I=Lr(w);if(T.kind!==I.kind||T.kind!=="string"&&T.kind!=="number")throw new pr(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${T.kind}, ${I.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const T=Lr(x),I=Lr(w);if(T.kind!=="string"||I.kind!=="string")return t(v,x,w)}return this.collator?s(v,x,w,this.collator.evaluate(v)):t(v,x,w)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}}}const _c=En("==",function(n,t,s){return t===s},kl),vc=En("!=",function(n,t,s){return t!==s},function(n,t,s,c){return!kl(0,t,s,c)}),Eu=En("<",function(n,t,s){return t<s},function(n,t,s,c){return c.compare(t,s)<0}),xc=En(">",function(n,t,s){return t>s},function(n,t,s,c){return c.compare(t,s)>0}),Vo=En("<=",function(n,t,s){return t<=s},function(n,t,s,c){return c.compare(t,s)<=0}),bc=En(">=",function(n,t,s){return t>=s},function(n,t,s,c){return c.compare(t,s)>=0});class jo{constructor(t,s,c,f,v){this.type=ui,this.number=t,this.locale=s,this.currency=c,this.minFractionDigits=f,this.maxFractionDigits=v}static parse(t,s){if(t.length!==3)return s.error("Expected two arguments.");const c=s.parse(t[1],1,at);if(!c)return null;const f=t[2];if(typeof f!="object"||Array.isArray(f))return s.error("NumberFormat options argument must be an object.");let v=null;if(f.locale&&(v=s.parse(f.locale,1,ui),!v))return null;let x=null;if(f.currency&&(x=s.parse(f.currency,1,ui),!x))return null;let w=null;if(f["min-fraction-digits"]&&(w=s.parse(f["min-fraction-digits"],1,at),!w))return null;let T=null;return f["max-fraction-digits"]&&(T=s.parse(f["max-fraction-digits"],1,at),!T)?null:new jo(c,v,x,w,T)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class qo{constructor(t){this.type=Er,this.sections=t}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const c=t[1];if(!Array.isArray(c)&&typeof c=="object")return s.error("First argument must be an image or text section.");const f=[];let v=!1;for(let x=1;x<=t.length-1;++x){const w=t[x];if(v&&typeof w=="object"&&!Array.isArray(w)){v=!1;let T=null;if(w["font-scale"]&&(T=s.parse(w["font-scale"],1,at),!T))return null;let I=null;if(w["text-font"]&&(I=s.parse(w["text-font"],1,H(ui)),!I))return null;let L=null;if(w["text-color"]&&(L=s.parse(w["text-color"],1,qi),!L))return null;const O=f[f.length-1];O.scale=T,O.font=I,O.textColor=L}else{const T=s.parse(t[x],1,ii);if(!T)return null;const I=T.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,f.push({content:T,scale:null,font:null,textColor:null})}}return new qo(f)}evaluate(t){return new kn(this.sections.map(s=>{const c=s.content.evaluate(t);return Lr(c)===N?new kr("",c,null,null,null):new kr(co(c),null,s.scale?s.scale.evaluate(t):null,s.font?s.font.evaluate(t).join(","):null,s.textColor?s.textColor.evaluate(t):null)}))}eachChild(t){for(const s of this.sections)t(s.content),s.scale&&t(s.scale),s.font&&t(s.font),s.textColor&&t(s.textColor)}outputDefined(){return!1}}class js{constructor(t){this.type=N,this.input=t}static parse(t,s){if(t.length!==2)return s.error("Expected two arguments.");const c=s.parse(t[1],1,ui);return c?new js(c):s.error("No image name provided.")}evaluate(t){const s=this.input.evaluate(t),c=Mn.fromString(s);return c&&t.availableImages&&(c.available=t.availableImages.indexOf(s)>-1),c}eachChild(t){t(this.input)}outputDefined(){return!1}}class Go{constructor(t){this.type=at,this.input=t}static parse(t,s){if(t.length!==2)return s.error(`Expected 1 argument, but found ${t.length-1} instead.`);const c=s.parse(t[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${Q(c.type)} instead.`):new Go(c):null}evaluate(t){const s=this.input.evaluate(t);if(typeof s=="string"||Array.isArray(s))return s.length;throw new pr(`Expected value to be of type string or array, but found ${Q(Lr(s))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Va={"==":_c,"!=":vc,">":xc,"<":Eu,">=":bc,"<=":Vo,array:Sn,at:No,boolean:Sn,case:Pl,coalesce:Fo,collator:Us,format:qo,image:js,in:$o,"index-of":mo,interpolate:en,"interpolate-hcl":en,"interpolate-lab":en,length:Go,let:Bo,literal:ia,match:Al,number:Sn,"number-format":jo,object:Sn,slice:xa,step:$a,string:Sn,"to-boolean":os,"to-color":os,"to-number":os,"to-string":os,var:Bt,within:qe};function wc(n,[t,s,c,f]){t=t.evaluate(n),s=s.evaluate(n),c=c.evaluate(n);const v=f?f.evaluate(n):1,x=Zn(t,s,c,v);if(x)throw new pr(x);return new Vi(t/255,s/255,c/255,v,!1)}function Ho(n,t){return n in t}function ba(n,t){const s=t[n];return s===void 0?null:s}function qs(n){return{type:n}}function Wo(n){return{result:"success",value:n}}function na(n){return{result:"error",value:n}}function ws(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function Mc(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Dl(n){return!!n.expression&&n.expression.interpolated}function Di(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function Zo(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function Tu(n){return n}function Ll(n,t){const s=t.type==="color",c=n.stops&&typeof n.stops[0][0]=="object",f=c||!(c||n.property!==void 0),v=n.type||(Dl(t)?"exponential":"interval");if(s||t.type==="padding"){const L=s?Vi.parse:wn.parse;(n=Ni({},n)).stops&&(n.stops=n.stops.map(O=>[O[0],L(O[1])])),n.default=L(n.default?n.default:t.default)}if(n.colorSpace&&(x=n.colorSpace)!=="rgb"&&x!=="hcl"&&x!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var x;let w,T,I;if(v==="exponential")w=fi;else if(v==="interval")w=Gs;else if(v==="categorical"){w=ir,T=Object.create(null);for(const L of n.stops)T[L[0]]=L[1];I=typeof n.stops[0][0]}else{if(v!=="identity")throw new Error(`Unknown function type "${v}"`);w=ja}if(c){const L={},O=[];for(let G=0;G<n.stops.length;G++){const Y=n.stops[G],ne=Y[0].zoom;L[ne]===void 0&&(L[ne]={zoom:ne,type:n.type,property:n.property,default:n.default,stops:[]},O.push(ne)),L[ne].stops.push([Y[0].value,Y[1]])}const $=[];for(const G of O)$.push([L[G].zoom,Ll(L[G],t)]);const j={name:"linear"};return{kind:"composite",interpolationType:j,interpolationFactor:en.interpolationFactor.bind(void 0,j),zoomStops:$.map(G=>G[0]),evaluate:({zoom:G},Y)=>fi({stops:$,base:n.base},t,G).evaluate(G,Y)}}if(f){const L=v==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:L,interpolationFactor:en.interpolationFactor.bind(void 0,L),zoomStops:n.stops.map(O=>O[0]),evaluate:({zoom:O})=>w(n,t,O,T,I)}}return{kind:"source",evaluate(L,O){const $=O&&O.properties?O.properties[n.property]:void 0;return $===void 0?wa(n.default,t.default):w(n,t,$,T,I)}}}function wa(n,t,s){return n!==void 0?n:t!==void 0?t:s!==void 0?s:void 0}function ir(n,t,s,c,f){return wa(typeof s===f?c[s]:void 0,n.default,t.default)}function Gs(n,t,s){if(Di(s)!=="number")return wa(n.default,t.default);const c=n.stops.length;if(c===1||s<=n.stops[0][0])return n.stops[0][1];if(s>=n.stops[c-1][0])return n.stops[c-1][1];const f=Ki(n.stops.map(v=>v[0]),s);return n.stops[f][1]}function fi(n,t,s){const c=n.base!==void 0?n.base:1;if(Di(s)!=="number")return wa(n.default,t.default);const f=n.stops.length;if(f===1||s<=n.stops[0][0])return n.stops[0][1];if(s>=n.stops[f-1][0])return n.stops[f-1][1];const v=Ki(n.stops.map(L=>L[0]),s),x=function(L,O,$,j){const G=j-$,Y=L-$;return G===0?0:O===1?Y/G:(Math.pow(O,Y)-1)/(Math.pow(O,G)-1)}(s,c,n.stops[v][0],n.stops[v+1][0]),w=n.stops[v][1],T=n.stops[v+1][1],I=fn[t.type]||Tu;return typeof w.evaluate=="function"?{evaluate(...L){const O=w.evaluate.apply(void 0,L),$=T.evaluate.apply(void 0,L);if(O!==void 0&&$!==void 0)return I(O,$,x,n.colorSpace)}}:I(w,T,x,n.colorSpace)}function ja(n,t,s){switch(t.type){case"color":s=Vi.parse(s);break;case"formatted":s=kn.fromString(s.toString());break;case"resolvedImage":s=Mn.fromString(s.toString());break;case"padding":s=wn.parse(s);break;default:Di(s)===t.type||t.type==="enum"&&t.values[s]||(s=void 0)}return wa(s,n.default,t.default)}xi.register(Va,{error:[{kind:"error"},[ui],(n,[t])=>{throw new pr(t.evaluate(n))}],typeof:[ui,[ii],(n,[t])=>Q(Lr(t.evaluate(n)))],"to-rgba":[H(at,4),[qi],(n,[t])=>{const[s,c,f,v]=t.evaluate(n).rgb;return[255*s,255*c,255*f,v]}],rgb:[qi,[at,at,at],wc],rgba:[qi,[at,at,at,at],wc],has:{type:Ut,overloads:[[[ui],(n,[t])=>Ho(t.evaluate(n),n.properties())],[[ui,vn],(n,[t,s])=>Ho(t.evaluate(n),s.evaluate(n))]]},get:{type:ii,overloads:[[[ui],(n,[t])=>ba(t.evaluate(n),n.properties())],[[ui,vn],(n,[t,s])=>ba(t.evaluate(n),s.evaluate(n))]]},"feature-state":[ii,[ui],(n,[t])=>ba(t.evaluate(n),n.featureState||{})],properties:[vn,[],n=>n.properties()],"geometry-type":[ui,[],n=>n.geometryType()],id:[ii,[],n=>n.id()],zoom:[at,[],n=>n.globals.zoom],"heatmap-density":[at,[],n=>n.globals.heatmapDensity||0],"line-progress":[at,[],n=>n.globals.lineProgress||0],accumulated:[ii,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[at,qs(at),(n,t)=>{let s=0;for(const c of t)s+=c.evaluate(n);return s}],"*":[at,qs(at),(n,t)=>{let s=1;for(const c of t)s*=c.evaluate(n);return s}],"-":{type:at,overloads:[[[at,at],(n,[t,s])=>t.evaluate(n)-s.evaluate(n)],[[at],(n,[t])=>-t.evaluate(n)]]},"/":[at,[at,at],(n,[t,s])=>t.evaluate(n)/s.evaluate(n)],"%":[at,[at,at],(n,[t,s])=>t.evaluate(n)%s.evaluate(n)],ln2:[at,[],()=>Math.LN2],pi:[at,[],()=>Math.PI],e:[at,[],()=>Math.E],"^":[at,[at,at],(n,[t,s])=>Math.pow(t.evaluate(n),s.evaluate(n))],sqrt:[at,[at],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[at,[at],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[at,[at],(n,[t])=>Math.log(t.evaluate(n))],log2:[at,[at],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[at,[at],(n,[t])=>Math.sin(t.evaluate(n))],cos:[at,[at],(n,[t])=>Math.cos(t.evaluate(n))],tan:[at,[at],(n,[t])=>Math.tan(t.evaluate(n))],asin:[at,[at],(n,[t])=>Math.asin(t.evaluate(n))],acos:[at,[at],(n,[t])=>Math.acos(t.evaluate(n))],atan:[at,[at],(n,[t])=>Math.atan(t.evaluate(n))],min:[at,qs(at),(n,t)=>Math.min(...t.map(s=>s.evaluate(n)))],max:[at,qs(at),(n,t)=>Math.max(...t.map(s=>s.evaluate(n)))],abs:[at,[at],(n,[t])=>Math.abs(t.evaluate(n))],round:[at,[at],(n,[t])=>{const s=t.evaluate(n);return s<0?-Math.round(-s):Math.round(s)}],floor:[at,[at],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[at,[at],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[Ut,[ui,ii],(n,[t,s])=>n.properties()[t.value]===s.value],"filter-id-==":[Ut,[ii],(n,[t])=>n.id()===t.value],"filter-type-==":[Ut,[ui],(n,[t])=>n.geometryType()===t.value],"filter-<":[Ut,[ui,ii],(n,[t,s])=>{const c=n.properties()[t.value],f=s.value;return typeof c==typeof f&&c<f}],"filter-id-<":[Ut,[ii],(n,[t])=>{const s=n.id(),c=t.value;return typeof s==typeof c&&s<c}],"filter->":[Ut,[ui,ii],(n,[t,s])=>{const c=n.properties()[t.value],f=s.value;return typeof c==typeof f&&c>f}],"filter-id->":[Ut,[ii],(n,[t])=>{const s=n.id(),c=t.value;return typeof s==typeof c&&s>c}],"filter-<=":[Ut,[ui,ii],(n,[t,s])=>{const c=n.properties()[t.value],f=s.value;return typeof c==typeof f&&c<=f}],"filter-id-<=":[Ut,[ii],(n,[t])=>{const s=n.id(),c=t.value;return typeof s==typeof c&&s<=c}],"filter->=":[Ut,[ui,ii],(n,[t,s])=>{const c=n.properties()[t.value],f=s.value;return typeof c==typeof f&&c>=f}],"filter-id->=":[Ut,[ii],(n,[t])=>{const s=n.id(),c=t.value;return typeof s==typeof c&&s>=c}],"filter-has":[Ut,[ii],(n,[t])=>t.value in n.properties()],"filter-has-id":[Ut,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Ut,[H(ui)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[Ut,[H(ii)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[Ut,[ui,H(ii)],(n,[t,s])=>s.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[Ut,[ui,H(ii)],(n,[t,s])=>function(c,f,v,x){for(;v<=x;){const w=v+x>>1;if(f[w]===c)return!0;f[w]>c?x=w-1:v=w+1}return!1}(n.properties()[t.value],s.value,0,s.value.length-1)],all:{type:Ut,overloads:[[[Ut,Ut],(n,[t,s])=>t.evaluate(n)&&s.evaluate(n)],[qs(Ut),(n,t)=>{for(const s of t)if(!s.evaluate(n))return!1;return!0}]]},any:{type:Ut,overloads:[[[Ut,Ut],(n,[t,s])=>t.evaluate(n)||s.evaluate(n)],[qs(Ut),(n,t)=>{for(const s of t)if(s.evaluate(n))return!0;return!1}]]},"!":[Ut,[Ut],(n,[t])=>!t.evaluate(n)],"is-supported-script":[Ut,[ui],(n,[t])=>{const s=n.globals&&n.globals.isSupportedScript;return!s||s(t.evaluate(n))}],upcase:[ui,[ui],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[ui,[ui],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[ui,qs(ii),(n,t)=>t.map(s=>co(s.evaluate(n))).join("")],"resolved-locale":[ui,[ta],(n,[t])=>t.evaluate(n).resolvedLocale()]});class $i{constructor(t,s){var c;this.expression=t,this._warningHistory={},this._evaluator=new Hi,this._defaultValue=s?(c=s).type==="color"&&Zo(c.default)?new Vi(0,0,0,0):c.type==="color"?Vi.parse(c.default)||null:c.type==="padding"?wn.parse(c.default)||null:c.type==="variableAnchorOffsetCollection"?Dr.parse(c.default)||null:c.default===void 0?null:c.default:null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(t,s,c,f,v,x){return this._evaluator.globals=t,this._evaluator.feature=s,this._evaluator.featureState=c,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(t,s,c,f,v,x){this._evaluator.globals=t,this._evaluator.feature=s||null,this._evaluator.featureState=c||null,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new pr(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function er(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Va}function Ms(n,t){const s=new Oo(Va,Tr,[],t?function(f){const v={color:qi,string:ui,number:at,enum:ui,boolean:Ut,formatted:Er,padding:ie,resolvedImage:N,variableAnchorOffsetCollection:U};return f.type==="array"?H(v[f.value]||ii,f.length):v[f.type]}(t):void 0),c=s.parse(n,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?Wo(new $i(c,t)):na(s.errors)}class sa{constructor(t,s){this.kind=t,this._styleExpression=s,this.isStateDependent=t!=="constant"&&!va(s.expression)}evaluateWithoutErrorHandling(t,s,c,f,v,x){return this._styleExpression.evaluateWithoutErrorHandling(t,s,c,f,v,x)}evaluate(t,s,c,f,v,x){return this._styleExpression.evaluate(t,s,c,f,v,x)}}class Xo{constructor(t,s,c,f){this.kind=t,this.zoomStops=c,this._styleExpression=s,this.isStateDependent=t!=="camera"&&!va(s.expression),this.interpolationType=f}evaluateWithoutErrorHandling(t,s,c,f,v,x){return this._styleExpression.evaluateWithoutErrorHandling(t,s,c,f,v,x)}evaluate(t,s,c,f,v,x){return this._styleExpression.evaluate(t,s,c,f,v,x)}interpolationFactor(t,s,c){return this.interpolationType?en.interpolationFactor(this.interpolationType,t,s,c):0}}function Rl(n,t){const s=Ms(n,t);if(s.result==="error")return s;const c=s.value.expression,f=vr(c);if(!f&&!ws(t))return na([new Qi("","data expressions not supported")]);const v=fo(c,["zoom"]);if(!v&&!Mc(t))return na([new Qi("","zoom expressions not supported")]);const x=Yo(c);return x||v?x instanceof Qi?na([x]):x instanceof en&&!Dl(t)?na([new Qi("",'"interpolate" expressions cannot be used with this property')]):Wo(x?new Xo(f?"camera":"composite",s.value,x.labels,x instanceof en?x.interpolation:void 0):new sa(f?"constant":"source",s.value)):na([new Qi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ko{constructor(t,s){this._parameters=t,this._specification=s,Ni(this,Ll(this._parameters,this._specification))}static deserialize(t){return new Ko(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Yo(n){let t=null;if(n instanceof Bo)t=Yo(n.result);else if(n instanceof Fo){for(const s of n.args)if(t=Yo(s),t)break}else(n instanceof $a||n instanceof en)&&n.input instanceof xi&&n.input.name==="zoom"&&(t=n);return t instanceof Qi||n.eachChild(s=>{const c=Yo(s);c instanceof Qi?t=c:!t&&c?t=new Qi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&c&&t!==c&&(t=new Qi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function go(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const t of n.slice(1))if(!go(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const zl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ma(n){if(n==null)return{filter:()=>!0,needGeometry:!1};go(n)||(n=ls(n));const t=Ms(n,zl);if(t.result==="error")throw new Error(t.value.map(s=>`${s.key}: ${s.message}`).join(", "));return{filter:(s,c,f)=>t.value.evaluate(s,c,{},f),needGeometry:Jo(n)}}function Sa(n,t){return n<t?-1:n>t?1:0}function Jo(n){if(!Array.isArray(n))return!1;if(n[0]==="within")return!0;for(let t=1;t<n.length;t++)if(Jo(n[t]))return!0;return!1}function ls(n){if(!n)return!0;const t=n[0];return n.length<=1?t!=="any":t==="=="?Ol(n[1],n[2],"=="):t==="!="?Qo(Ol(n[1],n[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Ol(n[1],n[2],t):t==="any"?(s=n.slice(1),["any"].concat(s.map(ls))):t==="all"?["all"].concat(n.slice(1).map(ls)):t==="none"?["all"].concat(n.slice(1).map(ls).map(Qo)):t==="in"?aa(n[1],n.slice(2)):t==="!in"?Qo(aa(n[1],n.slice(2))):t==="has"?Fl(n[1]):t==="!has"?Qo(Fl(n[1])):t!=="within"||n;var s}function Ol(n,t,s){switch(n){case"$type":return[`filter-type-${s}`,t];case"$id":return[`filter-id-${s}`,t];default:return[`filter-${s}`,n,t]}}function aa(n,t){if(t.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(s=>typeof s!=typeof t[0])?["filter-in-large",n,["literal",t.sort(Sa)]]:["filter-in-small",n,["literal",t]]}}function Fl(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Qo(n){return["!",n]}function qa(n){const t=typeof n;if(t==="number"||t==="boolean"||t==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let f="[";for(const v of n)f+=`${qa(v)},`;return`${f}]`}const s=Object.keys(n).sort();let c="{";for(let f=0;f<s.length;f++)c+=`${JSON.stringify(s[f])}:${qa(n[s[f]])},`;return`${c}}`}function Bl(n){let t="";for(const s of dt)t+=`/${qa(n[s])}`;return t}function Nl(n){const t=n.value;return t?[new Ve(n.key,t,"constants have been deprecated as of v8")]:[]}function mr(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Hs(n){if(Array.isArray(n))return n.map(Hs);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const t={};for(const s in n)t[s]=Hs(n[s]);return t}return mr(n)}function jr(n){const t=n.key,s=n.value,c=n.valueSpec||{},f=n.objectElementValidators||{},v=n.style,x=n.styleSpec,w=n.validateSpec;let T=[];const I=Di(s);if(I!=="object")return[new Ve(t,s,`object expected, ${I} found`)];for(const L in s){const O=L.split(".")[0],$=c[O]||c["*"];let j;if(f[O])j=f[O];else if(c[O])j=w;else if(f["*"])j=f["*"];else{if(!c["*"]){T.push(new Ve(t,s[L],`unknown property "${L}"`));continue}j=w}T=T.concat(j({key:(t&&`${t}.`)+L,value:s[L],valueSpec:$,style:v,styleSpec:x,object:s,objectKey:L,validateSpec:w},s))}for(const L in c)f[L]||c[L].required&&c[L].default===void 0&&s[L]===void 0&&T.push(new Ve(t,s,`missing required property "${L}"`));return T}function el(n){const t=n.value,s=n.valueSpec,c=n.style,f=n.styleSpec,v=n.key,x=n.arrayElementValidator||n.validateSpec;if(Di(t)!=="array")return[new Ve(v,t,`array expected, ${Di(t)} found`)];if(s.length&&t.length!==s.length)return[new Ve(v,t,`array length ${s.length} expected, length ${t.length} found`)];if(s["min-length"]&&t.length<s["min-length"])return[new Ve(v,t,`array length at least ${s["min-length"]} expected, length ${t.length} found`)];let w={type:s.value,values:s.values};f.$version<7&&(w.function=s.function),Di(s.value)==="object"&&(w=s.value);let T=[];for(let I=0;I<t.length;I++)T=T.concat(x({array:t,arrayIndex:I,value:t[I],valueSpec:w,validateSpec:n.validateSpec,style:c,styleSpec:f,key:`${v}[${I}]`}));return T}function tl(n){const t=n.key,s=n.value,c=n.valueSpec;let f=Di(s);return f==="number"&&s!=s&&(f="NaN"),f!=="number"?[new Ve(t,s,`number expected, ${f} found`)]:"minimum"in c&&s<c.minimum?[new Ve(t,s,`${s} is less than the minimum value ${c.minimum}`)]:"maximum"in c&&s>c.maximum?[new Ve(t,s,`${s} is greater than the maximum value ${c.maximum}`)]:[]}function Te(n){const t=n.valueSpec,s=mr(n.value.type);let c,f,v,x={};const w=s!=="categorical"&&n.value.property===void 0,T=!w,I=Di(n.value.stops)==="array"&&Di(n.value.stops[0])==="array"&&Di(n.value.stops[0][0])==="object",L=jr({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(j){if(s==="identity")return[new Ve(j.key,j.value,'identity function may not have a "stops" property')];let G=[];const Y=j.value;return G=G.concat(el({key:j.key,value:Y,valueSpec:j.valueSpec,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:O})),Di(Y)==="array"&&Y.length===0&&G.push(new Ve(j.key,Y,"array must have at least one stop")),G},default:function(j){return j.validateSpec({key:j.key,value:j.value,valueSpec:t,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec})}}});return s==="identity"&&w&&L.push(new Ve(n.key,n.value,'missing required property "property"')),s==="identity"||n.value.stops||L.push(new Ve(n.key,n.value,'missing required property "stops"')),s==="exponential"&&n.valueSpec.expression&&!Dl(n.valueSpec)&&L.push(new Ve(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(T&&!ws(n.valueSpec)?L.push(new Ve(n.key,n.value,"property functions not supported")):w&&!Mc(n.valueSpec)&&L.push(new Ve(n.key,n.value,"zoom functions not supported"))),s!=="categorical"&&!I||n.value.property!==void 0||L.push(new Ve(n.key,n.value,'"property" property is required')),L;function O(j){let G=[];const Y=j.value,ne=j.key;if(Di(Y)!=="array")return[new Ve(ne,Y,`array expected, ${Di(Y)} found`)];if(Y.length!==2)return[new Ve(ne,Y,`array length 2 expected, length ${Y.length} found`)];if(I){if(Di(Y[0])!=="object")return[new Ve(ne,Y,`object expected, ${Di(Y[0])} found`)];if(Y[0].zoom===void 0)return[new Ve(ne,Y,"object stop key must have zoom")];if(Y[0].value===void 0)return[new Ve(ne,Y,"object stop key must have value")];if(v&&v>mr(Y[0].zoom))return[new Ve(ne,Y[0].zoom,"stop zoom values must appear in ascending order")];mr(Y[0].zoom)!==v&&(v=mr(Y[0].zoom),f=void 0,x={}),G=G.concat(jr({key:`${ne}[0]`,value:Y[0],valueSpec:{zoom:{}},validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:tl,value:$}}))}else G=G.concat($({key:`${ne}[0]`,value:Y[0],valueSpec:{},validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec},Y));return er(Hs(Y[1]))?G.concat([new Ve(`${ne}[1]`,Y[1],"expressions are not allowed in function stops.")]):G.concat(j.validateSpec({key:`${ne}[1]`,value:Y[1],valueSpec:t,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec}))}function $(j,G){const Y=Di(j.value),ne=mr(j.value),he=j.value!==null?j.value:G;if(c){if(Y!==c)return[new Ve(j.key,he,`${Y} stop domain type must match previous stop domain type ${c}`)]}else c=Y;if(Y!=="number"&&Y!=="string"&&Y!=="boolean")return[new Ve(j.key,he,"stop domain value must be a number, string, or boolean")];if(Y!=="number"&&s!=="categorical"){let Ce=`number expected, ${Y} found`;return ws(t)&&s===void 0&&(Ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ve(j.key,he,Ce)]}return s!=="categorical"||Y!=="number"||isFinite(ne)&&Math.floor(ne)===ne?s!=="categorical"&&Y==="number"&&f!==void 0&&ne<f?[new Ve(j.key,he,"stop domain values must appear in ascending order")]:(f=ne,s==="categorical"&&ne in x?[new Ve(j.key,he,"stop domain values must be unique")]:(x[ne]=!0,[])):[new Ve(j.key,he,`integer expected, found ${ne}`)]}}function Re(n){const t=(n.expressionContext==="property"?Rl:Ms)(Hs(n.value),n.valueSpec);if(t.result==="error")return t.value.map(c=>new Ve(`${n.key}${c.key}`,n.value,c.message));const s=t.value.expression||t.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!s.outputDefined())return[new Ve(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!va(s))return[new Ve(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!va(s))return[new Ve(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!fo(s,["zoom","feature-state"]))return[new Ve(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!vr(s))return[new Ve(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function mt(n){const t=n.key,s=n.value,c=n.valueSpec,f=[];return Array.isArray(c.values)?c.values.indexOf(mr(s))===-1&&f.push(new Ve(t,s,`expected one of [${c.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(c.values).indexOf(mr(s))===-1&&f.push(new Ve(t,s,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(s)} found`)),f}function Xt(n){return go(Hs(n.value))?Re(Ni({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):rr(n)}function rr(n){const t=n.value,s=n.key;if(Di(t)!=="array")return[new Ve(s,t,`array expected, ${Di(t)} found`)];const c=n.styleSpec;let f,v=[];if(t.length<1)return[new Ve(s,t,"filter array must have at least 1 element")];switch(v=v.concat(mt({key:`${s}[0]`,value:t[0],valueSpec:c.filter_operator,style:n.style,styleSpec:n.styleSpec})),mr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&mr(t[1])==="$type"&&v.push(new Ve(s,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&v.push(new Ve(s,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(f=Di(t[1]),f!=="string"&&v.push(new Ve(`${s}[1]`,t[1],`string expected, ${f} found`)));for(let x=2;x<t.length;x++)f=Di(t[x]),mr(t[1])==="$type"?v=v.concat(mt({key:`${s}[${x}]`,value:t[x],valueSpec:c.geometry_type,style:n.style,styleSpec:n.styleSpec})):f!=="string"&&f!=="number"&&f!=="boolean"&&v.push(new Ve(`${s}[${x}]`,t[x],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let x=1;x<t.length;x++)v=v.concat(rr({key:`${s}[${x}]`,value:t[x],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":f=Di(t[1]),t.length!==2?v.push(new Ve(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):f!=="string"&&v.push(new Ve(`${s}[1]`,t[1],`string expected, ${f} found`));break;case"within":f=Di(t[1]),t.length!==2?v.push(new Ve(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):f!=="object"&&v.push(new Ve(`${s}[1]`,t[1],`object expected, ${f} found`))}return v}function Ci(n,t){const s=n.key,c=n.validateSpec,f=n.style,v=n.styleSpec,x=n.value,w=n.objectKey,T=v[`${t}_${n.layerType}`];if(!T)return[];const I=w.match(/^(.*)-transition$/);if(t==="paint"&&I&&T[I[1]]&&T[I[1]].transition)return c({key:s,value:x,valueSpec:v.transition,style:f,styleSpec:v});const L=n.valueSpec||T[w];if(!L)return[new Ve(s,x,`unknown property "${w}"`)];let O;if(Di(x)==="string"&&ws(L)&&!L.tokens&&(O=/^{([^}]+)}$/.exec(x)))return[new Ve(s,x,`"${w}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(O[1])} }\`.`)];const $=[];return n.layerType==="symbol"&&(w==="text-field"&&f&&!f.glyphs&&$.push(new Ve(s,x,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&Zo(Hs(x))&&mr(x.type)==="identity"&&$.push(new Ve(s,x,'"text-font" does not support identity functions'))),$.concat(c({key:n.key,value:x,valueSpec:L,style:f,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:w}))}function gr(n){return Ci(n,"paint")}function Cr(n){return Ci(n,"layout")}function Tn(n){let t=[];const s=n.value,c=n.key,f=n.style,v=n.styleSpec;s.type||s.ref||t.push(new Ve(c,s,'either "type" or "ref" is required'));let x=mr(s.type);const w=mr(s.ref);if(s.id){const T=mr(s.id);for(let I=0;I<n.arrayIndex;I++){const L=f.layers[I];mr(L.id)===T&&t.push(new Ve(c,s.id,`duplicate layer id "${s.id}", previously used at line ${L.id.__line__}`))}}if("ref"in s){let T;["type","source","source-layer","filter","layout"].forEach(I=>{I in s&&t.push(new Ve(c,s[I],`"${I}" is prohibited for ref layers`))}),f.layers.forEach(I=>{mr(I.id)===w&&(T=I)}),T?T.ref?t.push(new Ve(c,s.ref,"ref cannot reference another ref layer")):x=mr(T.type):t.push(new Ve(c,s.ref,`ref layer "${w}" not found`))}else if(x!=="background")if(s.source){const T=f.sources&&f.sources[s.source],I=T&&mr(T.type);T?I==="vector"&&x==="raster"?t.push(new Ve(c,s.source,`layer "${s.id}" requires a raster source`)):I!=="raster-dem"&&x==="hillshade"?t.push(new Ve(c,s.source,`layer "${s.id}" requires a raster-dem source`)):I==="raster"&&x!=="raster"?t.push(new Ve(c,s.source,`layer "${s.id}" requires a vector source`)):I!=="vector"||s["source-layer"]?I==="raster-dem"&&x!=="hillshade"?t.push(new Ve(c,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!s.paint||!s.paint["line-gradient"]||I==="geojson"&&T.lineMetrics||t.push(new Ve(c,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Ve(c,s,`layer "${s.id}" must specify a "source-layer"`)):t.push(new Ve(c,s.source,`source "${s.source}" not found`))}else t.push(new Ve(c,s,'missing required property "source"'));return t=t.concat(jr({key:c,value:s,valueSpec:v.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${c}.type`,value:s.type,valueSpec:v.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:s,objectKey:"type"}),filter:Xt,layout:T=>jr({layer:s,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":I=>Cr(Ni({layerType:x},I))}}),paint:T=>jr({layer:s,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":I=>gr(Ni({layerType:x},I))}})}})),t}function ur(n){const t=n.value,s=n.key,c=Di(t);return c!=="string"?[new Ve(s,t,`string expected, ${c} found`)]:[]}const Nr={promoteId:function({key:n,value:t}){if(Di(t)==="string")return ur({key:n,value:t});{const s=[];for(const c in t)s.push(...ur({key:`${n}.${c}`,value:t[c]}));return s}}};function cs(n){const t=n.value,s=n.key,c=n.styleSpec,f=n.style,v=n.validateSpec;if(!t.type)return[new Ve(s,t,'"type" is required')];const x=mr(t.type);let w;switch(x){case"vector":case"raster":return w=jr({key:s,value:t,valueSpec:c[`source_${x.replace("-","_")}`],style:n.style,styleSpec:c,objectElementValidators:Nr,validateSpec:v}),w;case"raster-dem":return w=function(T){var I;const L=(I=T.sourceName)!==null&&I!==void 0?I:"",O=T.value,$=T.styleSpec,j=$.source_raster_dem,G=T.style;let Y=[];const ne=Di(O);if(O===void 0)return Y;if(ne!=="object")return Y.push(new Ve("source_raster_dem",O,`object expected, ${ne} found`)),Y;const he=mr(O.encoding)==="custom",Ce=["redFactor","greenFactor","blueFactor","baseShift"],pe=T.value.encoding?`"${T.value.encoding}"`:"Default";for(const be in O)!he&&Ce.includes(be)?Y.push(new Ve(be,O[be],`In "${L}": "${be}" is only valid when "encoding" is set to "custom". ${pe} encoding found`)):j[be]?Y=Y.concat(T.validateSpec({key:be,value:O[be],valueSpec:j[be],validateSpec:T.validateSpec,style:G,styleSpec:$})):Y.push(new Ve(be,O[be],`unknown property "${be}"`));return Y}({sourceName:s,value:t,style:n.style,styleSpec:c,validateSpec:v}),w;case"geojson":if(w=jr({key:s,value:t,valueSpec:c.source_geojson,style:f,styleSpec:c,validateSpec:v,objectElementValidators:Nr}),t.cluster)for(const T in t.clusterProperties){const[I,L]=t.clusterProperties[T],O=typeof I=="string"?[I,["accumulated"],["get",T]]:I;w.push(...Re({key:`${s}.${T}.map`,value:L,validateSpec:v,expressionContext:"cluster-map"})),w.push(...Re({key:`${s}.${T}.reduce`,value:O,validateSpec:v,expressionContext:"cluster-reduce"}))}return w;case"video":return jr({key:s,value:t,valueSpec:c.source_video,style:f,validateSpec:v,styleSpec:c});case"image":return jr({key:s,value:t,valueSpec:c.source_image,style:f,validateSpec:v,styleSpec:c});case"canvas":return[new Ve(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return mt({key:`${s}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:f,validateSpec:v,styleSpec:c})}}function Ss(n){const t=n.value,s=n.styleSpec,c=s.light,f=n.style;let v=[];const x=Di(t);if(t===void 0)return v;if(x!=="object")return v=v.concat([new Ve("light",t,`object expected, ${x} found`)]),v;for(const w in t){const T=w.match(/^(.*)-transition$/);v=v.concat(T&&c[T[1]]&&c[T[1]].transition?n.validateSpec({key:w,value:t[w],valueSpec:s.transition,validateSpec:n.validateSpec,style:f,styleSpec:s}):c[w]?n.validateSpec({key:w,value:t[w],valueSpec:c[w],validateSpec:n.validateSpec,style:f,styleSpec:s}):[new Ve(w,t[w],`unknown property "${w}"`)])}return v}function mn(n){const t=n.value,s=n.styleSpec,c=s.sky,f=n.style,v=Di(t);if(t===void 0)return[];if(v!=="object")return[new Ve("sky",t,`object expected, ${v} found`)];let x=[];for(const w in t)x=x.concat(c[w]?Cn({key:w,value:t[w],valueSpec:c[w],style:f,styleSpec:s}):[new Ve(w,t[w],`unknown property "${w}"`)]);return x}function Fn(n){const t=n.value,s=n.styleSpec,c=s.terrain,f=n.style;let v=[];const x=Di(t);if(t===void 0)return v;if(x!=="object")return v=v.concat([new Ve("terrain",t,`object expected, ${x} found`)]),v;for(const w in t)v=v.concat(c[w]?n.validateSpec({key:w,value:t[w],valueSpec:c[w],validateSpec:n.validateSpec,style:f,styleSpec:s}):[new Ve(w,t[w],`unknown property "${w}"`)]);return v}function Es(n){let t=[];const s=n.value,c=n.key;if(Array.isArray(s)){const f=[],v=[];for(const x in s)s[x].id&&f.includes(s[x].id)&&t.push(new Ve(c,s,`all the sprites' ids must be unique, but ${s[x].id} is duplicated`)),f.push(s[x].id),s[x].url&&v.includes(s[x].url)&&t.push(new Ve(c,s,`all the sprites' URLs must be unique, but ${s[x].url} is duplicated`)),v.push(s[x].url),t=t.concat(jr({key:`${c}[${x}]`,value:s[x],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return t}return ur({key:c,value:s})}const tn={"*":()=>[],array:el,boolean:function(n){const t=n.value,s=n.key,c=Di(t);return c!=="boolean"?[new Ve(s,t,`boolean expected, ${c} found`)]:[]},number:tl,color:function(n){const t=n.key,s=n.value,c=Di(s);return c!=="string"?[new Ve(t,s,`color expected, ${c} found`)]:Vi.parse(String(s))?[]:[new Ve(t,s,`color expected, "${s}" found`)]},constants:Nl,enum:mt,filter:Xt,function:Te,layer:Tn,object:jr,source:cs,light:Ss,sky:mn,terrain:Fn,string:ur,formatted:function(n){return ur(n).length===0?[]:Re(n)},resolvedImage:function(n){return ur(n).length===0?[]:Re(n)},padding:function(n){const t=n.key,s=n.value;if(Di(s)==="array"){if(s.length<1||s.length>4)return[new Ve(t,s,`padding requires 1 to 4 values; ${s.length} values found`)];const c={type:"number"};let f=[];for(let v=0;v<s.length;v++)f=f.concat(n.validateSpec({key:`${t}[${v}]`,value:s[v],validateSpec:n.validateSpec,valueSpec:c}));return f}return tl({key:t,value:s,valueSpec:{}})},variableAnchorOffsetCollection:function(n){const t=n.key,s=n.value,c=Di(s),f=n.styleSpec;if(c!=="array"||s.length<1||s.length%2!=0)return[new Ve(t,s,"variableAnchorOffsetCollection requires a non-empty array of even length")];let v=[];for(let x=0;x<s.length;x+=2)v=v.concat(mt({key:`${t}[${x}]`,value:s[x],valueSpec:f.layout_symbol["text-anchor"]})),v=v.concat(el({key:`${t}[${x+1}]`,value:s[x+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:f}));return v},sprite:Es};function Cn(n){const t=n.value,s=n.valueSpec,c=n.styleSpec;return n.validateSpec=Cn,s.expression&&Zo(mr(t))?Te(n):s.expression&&er(Hs(t))?Re(n):s.type&&tn[s.type]?tn[s.type](n):jr(Ni({},n,{valueSpec:s.type?c[s.type]:s}))}function Ea(n){const t=n.value,s=n.key,c=ur(n);return c.length||(t.indexOf("{fontstack}")===-1&&c.push(new Ve(s,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&c.push(new Ve(s,t,'"glyphs" url must include a "{range}" token'))),c}function Xn(n,t=ce){let s=[];return s=s.concat(Cn({key:"",value:n,valueSpec:t.$root,styleSpec:t,style:n,validateSpec:Cn,objectElementValidators:{glyphs:Ea,"*":()=>[]}})),n.constants&&(s=s.concat(Nl({key:"constants",value:n.constants,style:n,styleSpec:t,validateSpec:Cn}))),Ga(s)}function Ts(n){return function(t){return n({...t,validateSpec:Cn})}}function Ga(n){return[].concat(n).sort((t,s)=>t.line-s.line)}function Ai(n){return function(...t){return Ga(n.apply(this,t))}}Xn.source=Ai(Ts(cs)),Xn.sprite=Ai(Ts(Es)),Xn.glyphs=Ai(Ts(Ea)),Xn.light=Ai(Ts(Ss)),Xn.sky=Ai(Ts(mn)),Xn.terrain=Ai(Ts(Fn)),Xn.layer=Ai(Ts(Tn)),Xn.filter=Ai(Ts(Xt)),Xn.paintProperty=Ai(Ts(gr)),Xn.layoutProperty=Ai(Ts(Cr));const Ri=Xn,il=Ri.light,Cs=Ri.paintProperty,$l=Ri.layoutProperty;function rn(n,t){let s=!1;if(t&&t.length)for(const c of t)n.fire(new De(new Error(c.message))),s=!0;return s}class Bn{constructor(t,s,c){const f=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const x=new Int32Array(this.arrayBuffer);t=x[0],this.d=(s=x[1])+2*(c=x[2]);for(let T=0;T<this.d*this.d;T++){const I=x[3+T],L=x[3+T+1];f.push(I===L?null:x.subarray(I,L))}const w=x[3+f.length+1];this.keys=x.subarray(x[3+f.length],w),this.bboxes=x.subarray(w),this.insert=this._insertReadonly}else{this.d=s+2*c;for(let x=0;x<this.d*this.d;x++)f.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=t,this.padding=c,this.scale=s/t,this.uid=0;const v=c/s*t;this.min=-v,this.max=t+v}insert(t,s,c,f,v){this._forEachCell(s,c,f,v,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(v)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,s,c,f,v,x){this.cells[v].push(x)}query(t,s,c,f,v){const x=this.min,w=this.max;if(t<=x&&s<=x&&w<=c&&w<=f&&!v)return Array.prototype.slice.call(this.keys);{const T=[];return this._forEachCell(t,s,c,f,this._queryCell,T,{},v),T}}_queryCell(t,s,c,f,v,x,w,T){const I=this.cells[v];if(I!==null){const L=this.keys,O=this.bboxes;for(let $=0;$<I.length;$++){const j=I[$];if(w[j]===void 0){const G=4*j;(T?T(O[G+0],O[G+1],O[G+2],O[G+3]):t<=O[G+2]&&s<=O[G+3]&&c>=O[G+0]&&f>=O[G+1])?(w[j]=!0,x.push(L[j])):w[j]=!1}}}}_forEachCell(t,s,c,f,v,x,w,T){const I=this._convertToCellCoord(t),L=this._convertToCellCoord(s),O=this._convertToCellCoord(c),$=this._convertToCellCoord(f);for(let j=I;j<=O;j++)for(let G=L;G<=$;G++){const Y=this.d*G+j;if((!T||T(this._convertFromCellCoord(j),this._convertFromCellCoord(G),this._convertFromCellCoord(j+1),this._convertFromCellCoord(G+1)))&&v.call(this,t,s,c,f,Y,x,w,T))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,s=3+this.cells.length+1+1;let c=0;for(let x=0;x<this.cells.length;x++)c+=this.cells[x].length;const f=new Int32Array(s+c+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;let v=s;for(let x=0;x<t.length;x++){const w=t[x];f[3+x]=v,f.set(w,v),v+=w.length}return f[3+t.length]=v,f.set(this.keys,v),v+=this.keys.length,f[3+t.length+1]=v,f.set(this.bboxes,v),v+=this.bboxes.length,f.buffer}static serialize(t,s){const c=t.toArrayBuffer();return s&&s.push(c),{buffer:c}}static deserialize(t){return new Bn(t.buffer)}}const nn={};function Ct(n,t,s={}){if(nn[n])throw new Error(`${n} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:n,writeable:!1}),nn[n]={klass:t,omit:s.omit||[],shallow:s.shallow||[]}}Ct("Object",Object),Ct("TransferableGridIndex",Bn),Ct("Color",Vi),Ct("Error",Error),Ct("AJAXError",Tt),Ct("ResolvedImage",Mn),Ct("StylePropertyFunction",Ko),Ct("StyleExpression",$i,{omit:["_evaluator"]}),Ct("ZoomDependentExpression",Xo),Ct("ZoomConstantExpression",sa),Ct("CompoundExpression",xi,{omit:["_evaluate"]});for(const n in Va)Va[n]._classRegistryKey||Ct(`Expression_${n}`,Va[n]);function Ta(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function us(n,t){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error)return n;if(Ta(n)||ai(n))return t&&t.push(n),n;if(ArrayBuffer.isView(n)){const s=n;return t&&t.push(s.buffer),s}if(n instanceof ImageData)return t&&t.push(n.data.buffer),n;if(Array.isArray(n)){const s=[];for(const c of n)s.push(us(c,t));return s}if(typeof n=="object"){const s=n.constructor,c=s._classRegistryKey;if(!c)throw new Error(`can't serialize object of unregistered class ${s.name}`);if(!nn[c])throw new Error(`${c} is not registered.`);const f=s.serialize?s.serialize(n,t):{};if(s.serialize){if(t&&f===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const v in n){if(!n.hasOwnProperty(v)||nn[c].omit.indexOf(v)>=0)continue;const x=n[v];f[v]=nn[c].shallow.indexOf(v)>=0?x:us(x,t)}n instanceof Error&&(f.message=n.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(f.$name=c),f}throw new Error("can't serialize object of type "+typeof n)}function Kn(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||Ta(n)||ai(n)||ArrayBuffer.isView(n)||n instanceof ImageData)return n;if(Array.isArray(n))return n.map(Kn);if(typeof n=="object"){const t=n.$name||"Object";if(!nn[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:s}=nn[t];if(!s)throw new Error(`can't deserialize unregistered class ${t}`);if(s.deserialize)return s.deserialize(n);const c=Object.create(s.prototype);for(const f of Object.keys(n)){if(f==="$name")continue;const v=n[f];c[f]=nn[t].shallow.indexOf(f)>=0?v:Kn(v)}return c}throw new Error("can't deserialize object of type "+typeof n)}class Ul{constructor(){this.first=!0}update(t,s){const c=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=s),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=c,!0))}}const vt={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function oa(n){for(const t of n)if(vo(t.charCodeAt(0)))return!0;return!1}function yo(n){for(const t of n)if(!_o(t.charCodeAt(0)))return!1;return!0}function _o(n){return!(vt.Arabic(n)||vt["Arabic Supplement"](n)||vt["Arabic Extended-A"](n)||vt["Arabic Presentation Forms-A"](n)||vt["Arabic Presentation Forms-B"](n))}function vo(n){return!(n!==746&&n!==747&&(n<4352||!(vt["Bopomofo Extended"](n)||vt.Bopomofo(n)||vt["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||vt["CJK Compatibility Ideographs"](n)||vt["CJK Compatibility"](n)||vt["CJK Radicals Supplement"](n)||vt["CJK Strokes"](n)||!(!vt["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||vt["CJK Unified Ideographs Extension A"](n)||vt["CJK Unified Ideographs"](n)||vt["Enclosed CJK Letters and Months"](n)||vt["Hangul Compatibility Jamo"](n)||vt["Hangul Jamo Extended-A"](n)||vt["Hangul Jamo Extended-B"](n)||vt["Hangul Jamo"](n)||vt["Hangul Syllables"](n)||vt.Hiragana(n)||vt["Ideographic Description Characters"](n)||vt.Kanbun(n)||vt["Kangxi Radicals"](n)||vt["Katakana Phonetic Extensions"](n)||vt.Katakana(n)&&n!==12540||!(!vt["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!vt["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||vt["Unified Canadian Aboriginal Syllabics"](n)||vt["Unified Canadian Aboriginal Syllabics Extended"](n)||vt["Vertical Forms"](n)||vt["Yijing Hexagram Symbols"](n)||vt["Yi Syllables"](n)||vt["Yi Radicals"](n))))}function Ha(n){return!(vo(n)||function(t){return!!(vt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||vt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||vt["Letterlike Symbols"](t)||vt["Number Forms"](t)||vt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||vt["Control Pictures"](t)&&t!==9251||vt["Optical Character Recognition"](t)||vt["Enclosed Alphanumerics"](t)||vt["Geometric Shapes"](t)||vt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||vt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||vt["CJK Symbols and Punctuation"](t)||vt.Katakana(t)||vt["Private Use Area"](t)||vt["CJK Compatibility Forms"](t)||vt["Small Form Variants"](t)||vt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(n))}function Ca(n){return n>=1424&&n<=2303||vt["Arabic Presentation Forms-A"](n)||vt["Arabic Presentation Forms-B"](n)}function rd(n,t){return!(!t&&Ca(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||vt.Khmer(n))}function $p(n){for(const t of n)if(Ca(t.charCodeAt(0)))return!0;return!1}const Wa=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class xr{constructor(t,s){this.zoom=t,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ul,this.transition={})}isSupportedScript(t){return function(s,c){for(const f of s)if(!rd(f.charCodeAt(0),c))return!1;return!0}(t,Wa.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,s=t-Math.floor(t),c=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*s}}}class Vl{constructor(t,s){this.property=t,this.value=s,this.expression=function(c,f){if(Zo(c))return new Ko(c,f);if(er(c)){const v=Rl(c,f);if(v.result==="error")throw new Error(v.value.map(x=>`${x.key}: ${x.message}`).join(", "));return v.value}{let v=c;return f.type==="color"&&typeof c=="string"?v=Vi.parse(c):f.type!=="padding"||typeof c!="number"&&!Array.isArray(c)?f.type==="variableAnchorOffsetCollection"&&Array.isArray(c)&&(v=Dr.parse(c)):v=wn.parse(c),{kind:"constant",evaluate:()=>v}}}(s===void 0?t.specification.default:s,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,s,c){return this.property.possiblyEvaluate(this,t,s,c)}}class Sc{constructor(t){this.property=t,this.value=new Vl(t,void 0)}transitioned(t,s){return new nd(this.property,this.value,s,nt({},t.transition,this.transition),t.now)}untransitioned(){return new nd(this.property,this.value,null,{},0)}}class Cu{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Lt(this._values[t].value.value)}setValue(t,s){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Sc(this._values[t].property)),this._values[t].value=new Vl(this._values[t].property,s===null?void 0:Lt(s))}getTransition(t){return Lt(this._values[t].transition)}setTransition(t,s){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Sc(this._values[t].property)),this._values[t].transition=Lt(s)||void 0}serialize(){const t={};for(const s of Object.keys(this._values)){const c=this.getValue(s);c!==void 0&&(t[s]=c);const f=this.getTransition(s);f!==void 0&&(t[`${s}-transition`]=f)}return t}transitioned(t,s){const c=new sd(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].transitioned(t,s._values[f]);return c}untransitioned(){const t=new sd(this._properties);for(const s of Object.keys(this._values))t._values[s]=this._values[s].untransitioned();return t}}class nd{constructor(t,s,c,f,v){this.property=t,this.value=s,this.begin=v+f.delay||0,this.end=this.begin+f.duration||0,t.specification.transition&&(f.delay||f.duration)&&(this.prior=c)}possiblyEvaluate(t,s,c){const f=t.now||0,v=this.value.possiblyEvaluate(t,s,c),x=this.prior;if(x){if(f>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(f<this.begin)return x.possiblyEvaluate(t,s,c);{const w=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(t,s,c),v,function(T){if(T<=0)return 0;if(T>=1)return 1;const I=T*T,L=I*T;return 4*(T<.5?L:3*(T-I)+L-.75)}(w))}}return v}}class sd{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,s,c){const f=new jl(this._properties);for(const v of Object.keys(this._values))f._values[v]=this._values[v].possiblyEvaluate(t,s,c);return f}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class ad{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Lt(this._values[t].value)}setValue(t,s){this._values[t]=new Vl(this._values[t].property,s===null?void 0:Lt(s))}serialize(){const t={};for(const s of Object.keys(this._values)){const c=this.getValue(s);c!==void 0&&(t[s]=c)}return t}possiblyEvaluate(t,s,c){const f=new jl(this._properties);for(const v of Object.keys(this._values))f._values[v]=this._values[v].possiblyEvaluate(t,s,c);return f}}class Ws{constructor(t,s,c){this.property=t,this.value=s,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,s,c,f){return this.property.evaluate(this.value,this.parameters,t,s,c,f)}}class jl{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Gt{constructor(t){this.specification=t}possiblyEvaluate(t,s){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(s)}interpolate(t,s,c){const f=fn[this.specification.type];return f?f(t,s,c):t}}class ei{constructor(t,s){this.specification=t,this.overrides=s}possiblyEvaluate(t,s,c,f){return new Ws(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(s,null,{},c,f)}:t.expression,s)}interpolate(t,s,c){if(t.value.kind!=="constant"||s.value.kind!=="constant")return t;if(t.value.value===void 0||s.value.value===void 0)return new Ws(this,{kind:"constant",value:void 0},t.parameters);const f=fn[this.specification.type];if(f){const v=f(t.value.value,s.value.value,c);return new Ws(this,{kind:"constant",value:v},t.parameters)}return t}evaluate(t,s,c,f,v,x){return t.kind==="constant"?t.value:t.evaluate(s,c,f,v,x)}}class Ec extends ei{possiblyEvaluate(t,s,c,f){if(t.value===void 0)return new Ws(this,{kind:"constant",value:void 0},s);if(t.expression.kind==="constant"){const v=t.expression.evaluate(s,null,{},c,f),x=t.property.specification.type==="resolvedImage"&&typeof v!="string"?v.name:v,w=this._calculate(x,x,x,s);return new Ws(this,{kind:"constant",value:w},s)}if(t.expression.kind==="camera"){const v=this._calculate(t.expression.evaluate({zoom:s.zoom-1}),t.expression.evaluate({zoom:s.zoom}),t.expression.evaluate({zoom:s.zoom+1}),s);return new Ws(this,{kind:"constant",value:v},s)}return new Ws(this,t.expression,s)}evaluate(t,s,c,f,v,x){if(t.kind==="source"){const w=t.evaluate(s,c,f,v,x);return this._calculate(w,w,w,s)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(s.zoom)-1},c,f),t.evaluate({zoom:Math.floor(s.zoom)},c,f),t.evaluate({zoom:Math.floor(s.zoom)+1},c,f),s):t.value}_calculate(t,s,c,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:c,to:s}}interpolate(t){return t}}class ql{constructor(t){this.specification=t}possiblyEvaluate(t,s,c,f){if(t.value!==void 0){if(t.expression.kind==="constant"){const v=t.expression.evaluate(s,null,{},c,f);return this._calculate(v,v,v,s)}return this._calculate(t.expression.evaluate(new xr(Math.floor(s.zoom-1),s)),t.expression.evaluate(new xr(Math.floor(s.zoom),s)),t.expression.evaluate(new xr(Math.floor(s.zoom+1),s)),s)}}_calculate(t,s,c,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:c,to:s}}interpolate(t){return t}}class Iu{constructor(t){this.specification=t}possiblyEvaluate(t,s,c,f){return!!t.expression.evaluate(s,null,{},c,f)}interpolate(){return!1}}class Yn{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in t){const c=t[s];c.specification.overridable&&this.overridableProperties.push(s);const f=this.defaultPropertyValues[s]=new Vl(c,void 0),v=this.defaultTransitionablePropertyValues[s]=new Sc(c);this.defaultTransitioningPropertyValues[s]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=f.possiblyEvaluate({})}}}Ct("DataDrivenProperty",ei),Ct("DataConstantProperty",Gt),Ct("CrossFadedDataDrivenProperty",Ec),Ct("CrossFadedProperty",ql),Ct("ColorRampProperty",Iu);const Au="-transition";class Zs extends Fe{constructor(t,s){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),s.layout&&(this._unevaluatedLayout=new ad(s.layout)),s.paint)){this._transitionablePaint=new Cu(s.paint);for(const c in t.paint)this.setPaintProperty(c,t.paint[c],{validate:!1});for(const c in t.layout)this.setLayoutProperty(c,t.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new jl(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,s,c={}){s!=null&&this._validate($l,`layers.${this.id}.layout.${t}`,t,s,c)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,s):this.visibility=s)}getPaintProperty(t){return t.endsWith(Au)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,s,c={}){if(s!=null&&this._validate(Cs,`layers.${this.id}.paint.${t}`,t,s,c))return!1;if(t.endsWith(Au))return this._transitionablePaint.setTransition(t.slice(0,-11),s||void 0),!1;{const f=this._transitionablePaint._values[t],v=f.property.specification["property-type"]==="cross-faded-data-driven",x=f.value.isDataDriven(),w=f.value;this._transitionablePaint.setValue(t,s),this._handleSpecialPaintPropertyUpdate(t);const T=this._transitionablePaint._values[t].value;return T.isDataDriven()||x||v||this._handleOverridablePaintPropertyUpdate(t,w,T)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,s,c){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,s){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,s)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Ot(t,(s,c)=>!(s===void 0||c==="layout"&&!Object.keys(s).length||c==="paint"&&!Object.keys(s).length))}_validate(t,s,c,f,v={}){return(!v||v.validate!==!1)&&rn(this,t.call(Ri,{key:s,layerType:this.type,objectKey:c,value:f,styleSpec:ce,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const s=this.paint.get(t);if(s instanceof Ws&&ws(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}}const od={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Gl{constructor(t,s){this._structArray=t,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class zr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,s){return t._trim(),s&&(t.isTransferred=!0,s.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const s=Object.create(this.prototype);return s.arrayBuffer=t.arrayBuffer,s.length=t.length,s.capacity=t.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function qr(n,t=1){let s=0,c=0;return{members:n.map(f=>{const v=od[f.type].BYTES_PER_ELEMENT,x=s=ld(s,Math.max(t,v)),w=f.components||1;return c=Math.max(c,v),s+=v*w,{name:f.name,type:f.type,components:w,offset:x}}),size:ld(s,Math.max(c,t)),alignment:t}}function ld(n,t){return Math.ceil(n/t)*t}class Hl extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,s)}emplace(t,s,c){const f=2*t;return this.int16[f+0]=s,this.int16[f+1]=c,t}}Hl.prototype.bytesPerElement=4,Ct("StructArrayLayout2i4",Hl);class Ia extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,t,s,c)}emplace(t,s,c,f){const v=3*t;return this.int16[v+0]=s,this.int16[v+1]=c,this.int16[v+2]=f,t}}Ia.prototype.bytesPerElement=6,Ct("StructArrayLayout3i6",Ia);class Pu extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,f){const v=this.length;return this.resize(v+1),this.emplace(v,t,s,c,f)}emplace(t,s,c,f,v){const x=4*t;return this.int16[x+0]=s,this.int16[x+1]=c,this.int16[x+2]=f,this.int16[x+3]=v,t}}Pu.prototype.bytesPerElement=8,Ct("StructArrayLayout4i8",Pu);class ku extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,f,v,x){const w=this.length;return this.resize(w+1),this.emplace(w,t,s,c,f,v,x)}emplace(t,s,c,f,v,x,w){const T=6*t;return this.int16[T+0]=s,this.int16[T+1]=c,this.int16[T+2]=f,this.int16[T+3]=v,this.int16[T+4]=x,this.int16[T+5]=w,t}}ku.prototype.bytesPerElement=12,Ct("StructArrayLayout2i4i12",ku);class Du extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,f,v,x){const w=this.length;return this.resize(w+1),this.emplace(w,t,s,c,f,v,x)}emplace(t,s,c,f,v,x,w){const T=4*t,I=8*t;return this.int16[T+0]=s,this.int16[T+1]=c,this.uint8[I+4]=f,this.uint8[I+5]=v,this.uint8[I+6]=x,this.uint8[I+7]=w,t}}Du.prototype.bytesPerElement=8,Ct("StructArrayLayout2i4ub8",Du);class Wl extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,s)}emplace(t,s,c){const f=2*t;return this.float32[f+0]=s,this.float32[f+1]=c,t}}Wl.prototype.bytesPerElement=8,Ct("StructArrayLayout2f8",Wl);class Tc extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,f,v,x,w,T,I,L){const O=this.length;return this.resize(O+1),this.emplace(O,t,s,c,f,v,x,w,T,I,L)}emplace(t,s,c,f,v,x,w,T,I,L,O){const $=10*t;return this.uint16[$+0]=s,this.uint16[$+1]=c,this.uint16[$+2]=f,this.uint16[$+3]=v,this.uint16[$+4]=x,this.uint16[$+5]=w,this.uint16[$+6]=T,this.uint16[$+7]=I,this.uint16[$+8]=L,this.uint16[$+9]=O,t}}Tc.prototype.bytesPerElement=20,Ct("StructArrayLayout10ui20",Tc);class Lu extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,f,v,x,w,T,I,L,O,$){const j=this.length;return this.resize(j+1),this.emplace(j,t,s,c,f,v,x,w,T,I,L,O,$)}emplace(t,s,c,f,v,x,w,T,I,L,O,$,j){const G=12*t;return this.int16[G+0]=s,this.int16[G+1]=c,this.int16[G+2]=f,this.int16[G+3]=v,this.uint16[G+4]=x,this.uint16[G+5]=w,this.uint16[G+6]=T,this.uint16[G+7]=I,this.int16[G+8]=L,this.int16[G+9]=O,this.int16[G+10]=$,this.int16[G+11]=j,t}}Lu.prototype.bytesPerElement=24,Ct("StructArrayLayout4i4ui4i24",Lu);class Ru extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,t,s,c)}emplace(t,s,c,f){const v=3*t;return this.float32[v+0]=s,this.float32[v+1]=c,this.float32[v+2]=f,t}}Ru.prototype.bytesPerElement=12,Ct("StructArrayLayout3f12",Ru);class Aa extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint32[1*t+0]=s,t}}Aa.prototype.bytesPerElement=4,Ct("StructArrayLayout1ul4",Aa);class Cc extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,f,v,x,w,T,I){const L=this.length;return this.resize(L+1),this.emplace(L,t,s,c,f,v,x,w,T,I)}emplace(t,s,c,f,v,x,w,T,I,L){const O=10*t,$=5*t;return this.int16[O+0]=s,this.int16[O+1]=c,this.int16[O+2]=f,this.int16[O+3]=v,this.int16[O+4]=x,this.int16[O+5]=w,this.uint32[$+3]=T,this.uint16[O+8]=I,this.uint16[O+9]=L,t}}Cc.prototype.bytesPerElement=20,Ct("StructArrayLayout6i1ul2ui20",Cc);class Zl extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,f,v,x){const w=this.length;return this.resize(w+1),this.emplace(w,t,s,c,f,v,x)}emplace(t,s,c,f,v,x,w){const T=6*t;return this.int16[T+0]=s,this.int16[T+1]=c,this.int16[T+2]=f,this.int16[T+3]=v,this.int16[T+4]=x,this.int16[T+5]=w,t}}Zl.prototype.bytesPerElement=12,Ct("StructArrayLayout2i2i2i12",Zl);class Ic extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,f,v){const x=this.length;return this.resize(x+1),this.emplace(x,t,s,c,f,v)}emplace(t,s,c,f,v,x){const w=4*t,T=8*t;return this.float32[w+0]=s,this.float32[w+1]=c,this.float32[w+2]=f,this.int16[T+6]=v,this.int16[T+7]=x,t}}Ic.prototype.bytesPerElement=16,Ct("StructArrayLayout2f1f2i16",Ic);class Xl extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,f){const v=this.length;return this.resize(v+1),this.emplace(v,t,s,c,f)}emplace(t,s,c,f,v){const x=12*t,w=3*t;return this.uint8[x+0]=s,this.uint8[x+1]=c,this.float32[w+1]=f,this.float32[w+2]=v,t}}Xl.prototype.bytesPerElement=12,Ct("StructArrayLayout2ub2f12",Xl);class Ac extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,t,s,c)}emplace(t,s,c,f){const v=3*t;return this.uint16[v+0]=s,this.uint16[v+1]=c,this.uint16[v+2]=f,t}}Ac.prototype.bytesPerElement=6,Ct("StructArrayLayout3ui6",Ac);class rl extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,f,v,x,w,T,I,L,O,$,j,G,Y,ne,he){const Ce=this.length;return this.resize(Ce+1),this.emplace(Ce,t,s,c,f,v,x,w,T,I,L,O,$,j,G,Y,ne,he)}emplace(t,s,c,f,v,x,w,T,I,L,O,$,j,G,Y,ne,he,Ce){const pe=24*t,be=12*t,$e=48*t;return this.int16[pe+0]=s,this.int16[pe+1]=c,this.uint16[pe+2]=f,this.uint16[pe+3]=v,this.uint32[be+2]=x,this.uint32[be+3]=w,this.uint32[be+4]=T,this.uint16[pe+10]=I,this.uint16[pe+11]=L,this.uint16[pe+12]=O,this.float32[be+7]=$,this.float32[be+8]=j,this.uint8[$e+36]=G,this.uint8[$e+37]=Y,this.uint8[$e+38]=ne,this.uint32[be+10]=he,this.int16[pe+22]=Ce,t}}rl.prototype.bytesPerElement=48,Ct("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",rl);class xo extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,f,v,x,w,T,I,L,O,$,j,G,Y,ne,he,Ce,pe,be,$e,He,It,Nt,Et,bt,ct,Rt){const _t=this.length;return this.resize(_t+1),this.emplace(_t,t,s,c,f,v,x,w,T,I,L,O,$,j,G,Y,ne,he,Ce,pe,be,$e,He,It,Nt,Et,bt,ct,Rt)}emplace(t,s,c,f,v,x,w,T,I,L,O,$,j,G,Y,ne,he,Ce,pe,be,$e,He,It,Nt,Et,bt,ct,Rt,_t){const tt=32*t,Qt=16*t;return this.int16[tt+0]=s,this.int16[tt+1]=c,this.int16[tt+2]=f,this.int16[tt+3]=v,this.int16[tt+4]=x,this.int16[tt+5]=w,this.int16[tt+6]=T,this.int16[tt+7]=I,this.uint16[tt+8]=L,this.uint16[tt+9]=O,this.uint16[tt+10]=$,this.uint16[tt+11]=j,this.uint16[tt+12]=G,this.uint16[tt+13]=Y,this.uint16[tt+14]=ne,this.uint16[tt+15]=he,this.uint16[tt+16]=Ce,this.uint16[tt+17]=pe,this.uint16[tt+18]=be,this.uint16[tt+19]=$e,this.uint16[tt+20]=He,this.uint16[tt+21]=It,this.uint16[tt+22]=Nt,this.uint32[Qt+12]=Et,this.float32[Qt+13]=bt,this.float32[Qt+14]=ct,this.uint16[tt+30]=Rt,this.uint16[tt+31]=_t,t}}xo.prototype.bytesPerElement=64,Ct("StructArrayLayout8i15ui1ul2f2ui64",xo);class Pc extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.float32[1*t+0]=s,t}}Pc.prototype.bytesPerElement=4,Ct("StructArrayLayout1f4",Pc);class kc extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,t,s,c)}emplace(t,s,c,f){const v=3*t;return this.uint16[6*t+0]=s,this.float32[v+1]=c,this.float32[v+2]=f,t}}kc.prototype.bytesPerElement=12,Ct("StructArrayLayout1ui2f12",kc);class bo extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,t,s,c)}emplace(t,s,c,f){const v=4*t;return this.uint32[2*t+0]=s,this.uint16[v+2]=c,this.uint16[v+3]=f,t}}bo.prototype.bytesPerElement=8,Ct("StructArrayLayout1ul2ui8",bo);class zu extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,s)}emplace(t,s,c){const f=2*t;return this.uint16[f+0]=s,this.uint16[f+1]=c,t}}zu.prototype.bytesPerElement=4,Ct("StructArrayLayout2ui4",zu);class Ou extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint16[1*t+0]=s,t}}Ou.prototype.bytesPerElement=2,Ct("StructArrayLayout1ui2",Ou);class Dc extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,f){const v=this.length;return this.resize(v+1),this.emplace(v,t,s,c,f)}emplace(t,s,c,f,v){const x=4*t;return this.float32[x+0]=s,this.float32[x+1]=c,this.float32[x+2]=f,this.float32[x+3]=v,t}}Dc.prototype.bytesPerElement=16,Ct("StructArrayLayout4f16",Dc);class cd extends Gl{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new k(this.anchorPointX,this.anchorPointY)}}cd.prototype.size=20;class y extends Cc{get(t){return new cd(this,t)}}Ct("CollisionBoxArray",y);class i extends Gl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}i.prototype.size=48;class o extends rl{get(t){return new i(this,t)}}Ct("PlacedSymbolArray",o);class h extends Gl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}h.prototype.size=64;class p extends xo{get(t){return new h(this,t)}}Ct("SymbolInstanceArray",p);class _ extends Pc{getoffsetX(t){return this.float32[1*t+0]}}Ct("GlyphOffsetArray",_);class S extends Ia{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Ct("SymbolLineVertexArray",S);class E extends Gl{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}E.prototype.size=12;class C extends kc{get(t){return new E(this,t)}}Ct("TextAnchorOffsetArray",C);class D extends Gl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}D.prototype.size=8;class F extends bo{get(t){return new D(this,t)}}Ct("FeatureIndexArray",F);class B extends Hl{}class q extends Hl{}class re extends Hl{}class te extends ku{}class se extends Du{}class K extends Wl{}class me extends Tc{}class Pe extends Lu{}class le extends Ru{}class Me extends Aa{}class ke extends Zl{}class Le extends Xl{}class Oe extends Ac{}class Ke extends zu{}const Ze=qr([{name:"a_pos",components:2,type:"Int16"}],4),{members:ot}=Ze;class ht{constructor(t=[]){this.segments=t}prepareSegment(t,s,c,f){let v=this.segments[this.segments.length-1];return t>ht.MAX_VERTEX_ARRAY_LENGTH&&Ei(`Max vertices per segment is ${ht.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!v||v.vertexLength+t>ht.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==f)&&(v={vertexOffset:s.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},f!==void 0&&(v.sortKey=f),this.segments.push(v)),v}get(){return this.segments}destroy(){for(const t of this.segments)for(const s in t.vaos)t.vaos[s].destroy()}static simpleSegment(t,s,c,f){return new ht([{vertexOffset:t,primitiveOffset:s,vertexLength:c,primitiveLength:f,vaos:{},sortKey:0}])}}function di(n,t){return 256*(n=Ue(Math.floor(n),0,255))+Ue(Math.floor(t),0,255)}ht.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ct("SegmentVector",ht);const yt=qr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ti={exports:{}},pi={exports:{}};pi.exports=function(n,t){var s,c,f,v,x,w,T,I;for(c=n.length-(s=3&n.length),f=t,x=3432918353,w=461845907,I=0;I<c;)T=255&n.charCodeAt(I)|(255&n.charCodeAt(++I))<<8|(255&n.charCodeAt(++I))<<16|(255&n.charCodeAt(++I))<<24,++I,f=27492+(65535&(v=5*(65535&(f=(f^=T=(65535&(T=(T=(65535&T)*x+(((T>>>16)*x&65535)<<16)&4294967295)<<15|T>>>17))*w+(((T>>>16)*w&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(T=0,s){case 3:T^=(255&n.charCodeAt(I+2))<<16;case 2:T^=(255&n.charCodeAt(I+1))<<8;case 1:f^=T=(65535&(T=(T=(65535&(T^=255&n.charCodeAt(I)))*x+(((T>>>16)*x&65535)<<16)&4294967295)<<15|T>>>17))*w+(((T>>>16)*w&65535)<<16)&4294967295}return f^=n.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0};var Li=pi.exports,si={exports:{}};si.exports=function(n,t){for(var s,c=n.length,f=t^c,v=0;c>=4;)s=1540483477*(65535&(s=255&n.charCodeAt(v)|(255&n.charCodeAt(++v))<<8|(255&n.charCodeAt(++v))<<16|(255&n.charCodeAt(++v))<<24))+((1540483477*(s>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),c-=4,++v;switch(c){case 3:f^=(255&n.charCodeAt(v+2))<<16;case 2:f^=(255&n.charCodeAt(v+1))<<8;case 1:f=1540483477*(65535&(f^=255&n.charCodeAt(v)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0};var mi=Li,bi=si.exports;ti.exports=mi,ti.exports.murmur3=mi,ti.exports.murmur2=bi;var Or=M(ti.exports);class tr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,s,c,f){this.ids.push(hs(t)),this.positions.push(s,c,f)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const s=hs(t);let c=0,f=this.ids.length-1;for(;c<f;){const x=c+f>>1;this.ids[x]>=s?f=x:c=x+1}const v=[];for(;this.ids[c]===s;)v.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return v}static serialize(t,s){const c=new Float64Array(t.ids),f=new Uint32Array(t.positions);return sn(c,f,0,c.length-1),s&&s.push(c.buffer,f.buffer),{ids:c,positions:f}}static deserialize(t){const s=new tr;return s.ids=t.ids,s.positions=t.positions,s.indexed=!0,s}}function hs(n){const t=+n;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Or(String(n))}function sn(n,t,s,c){for(;s<c;){const f=n[s+c>>1];let v=s-1,x=c+1;for(;;){do v++;while(n[v]<f);do x--;while(n[x]>f);if(v>=x)break;Ir(n,v,x),Ir(t,3*v,3*x),Ir(t,3*v+1,3*x+1),Ir(t,3*v+2,3*x+2)}x-s<c-x?(sn(n,t,s,x),s=x+1):(sn(n,t,x+1,c),c=x)}}function Ir(n,t,s){const c=n[t];n[t]=n[s],n[s]=c}Ct("FeaturePositionMap",tr);class an{constructor(t,s){this.gl=t.gl,this.location=s}}class ds extends an{constructor(t,s){super(t,s),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class la extends an{constructor(t,s){super(t,s),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Za extends an{constructor(t,s){super(t,s),this.current=Vi.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Kl=new Float32Array(16);function Xa(n){return[di(255*n.r,255*n.g),di(255*n.b,255*n.a)]}class ca{constructor(t,s,c){this.value=t,this.uniformNames=s.map(f=>`u_${f}`),this.type=c}setUniform(t,s,c){t.set(c.constantOr(this.value))}getBinding(t,s,c){return this.type==="color"?new Za(t,s):new ds(t,s)}}class Xr{constructor(t,s){this.uniformNames=s.map(c=>`u_${c}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=t.tlbr}setUniform(t,s,c,f){const v=f==="u_pattern_to"?this.patternTo:f==="u_pattern_from"?this.patternFrom:f==="u_pixel_ratio_to"?this.pixelRatioTo:f==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&t.set(v)}getBinding(t,s,c){return c.substr(0,9)==="u_pattern"?new la(t,s):new ds(t,s)}}class Ar{constructor(t,s,c,f){this.expression=t,this.type=c,this.maxValue=0,this.paintVertexAttributes=s.map(v=>({name:`a_${v}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(t,s,c,f,v){const x=this.paintVertexArray.length,w=this.expression.evaluate(new xr(0),s,{},f,[],v);this.paintVertexArray.resize(t),this._setPaintValue(x,t,w)}updatePaintArray(t,s,c,f){const v=this.expression.evaluate({zoom:0},c,f);this._setPaintValue(t,s,v)}_setPaintValue(t,s,c){if(this.type==="color"){const f=Xa(c);for(let v=t;v<s;v++)this.paintVertexArray.emplace(v,f[0],f[1])}else{for(let f=t;f<s;f++)this.paintVertexArray.emplace(f,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class br{constructor(t,s,c,f,v,x){this.expression=t,this.uniformNames=s.map(w=>`u_${w}_t`),this.type=c,this.useIntegerZoom=f,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=s.map(w=>({name:`a_${w}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(t,s,c,f,v){const x=this.expression.evaluate(new xr(this.zoom),s,{},f,[],v),w=this.expression.evaluate(new xr(this.zoom+1),s,{},f,[],v),T=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(T,t,x,w)}updatePaintArray(t,s,c,f){const v=this.expression.evaluate({zoom:this.zoom},c,f),x=this.expression.evaluate({zoom:this.zoom+1},c,f);this._setPaintValue(t,s,v,x)}_setPaintValue(t,s,c,f){if(this.type==="color"){const v=Xa(c),x=Xa(f);for(let w=t;w<s;w++)this.paintVertexArray.emplace(w,v[0],v[1],x[0],x[1])}else{for(let v=t;v<s;v++)this.paintVertexArray.emplace(v,c,f);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(f))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,s){const c=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,f=Ue(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);t.set(f)}getBinding(t,s,c){return new ds(t,s)}}class Is{constructor(t,s,c,f,v,x){this.expression=t,this.type=s,this.useIntegerZoom=c,this.zoom=f,this.layerId=x,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v}populatePaintArray(t,s,c){const f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(f,t,s.patterns&&s.patterns[this.layerId],c)}updatePaintArray(t,s,c,f,v){this._setPaintValues(t,s,c.patterns&&c.patterns[this.layerId],v)}_setPaintValues(t,s,c,f){if(!f||!c)return;const{min:v,mid:x,max:w}=c,T=f[v],I=f[x],L=f[w];if(T&&I&&L)for(let O=t;O<s;O++)this.zoomInPaintVertexArray.emplace(O,I.tl[0],I.tl[1],I.br[0],I.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],I.pixelRatio,T.pixelRatio),this.zoomOutPaintVertexArray.emplace(O,I.tl[0],I.tl[1],I.br[0],I.br[1],L.tl[0],L.tl[1],L.br[0],L.br[1],I.pixelRatio,L.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,yt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,yt.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Kr{constructor(t,s,c){this.binders={},this._buffers=[];const f=[];for(const v in t.paint._values){if(!c(v))continue;const x=t.paint.get(v);if(!(x instanceof Ws&&ws(x.property.specification)))continue;const w=As(v,t.type),T=x.value,I=x.property.specification.type,L=x.property.useIntegerZoom,O=x.property.specification["property-type"],$=O==="cross-faded"||O==="cross-faded-data-driven";if(T.kind==="constant")this.binders[v]=$?new Xr(T.value,w):new ca(T.value,w,I),f.push(`/u_${v}`);else if(T.kind==="source"||$){const j=Yr(v,I,"source");this.binders[v]=$?new Is(T,I,L,s,j,t.id):new Ar(T,w,I,j),f.push(`/a_${v}`)}else{const j=Yr(v,I,"composite");this.binders[v]=new br(T,w,I,L,s,j),f.push(`/z_${v}`)}}this.cacheKey=f.sort().join("")}getMaxValue(t){const s=this.binders[t];return s instanceof Ar||s instanceof br?s.maxValue:0}populatePaintArrays(t,s,c,f,v){for(const x in this.binders){const w=this.binders[x];(w instanceof Ar||w instanceof br||w instanceof Is)&&w.populatePaintArray(t,s,c,f,v)}}setConstantPatternPositions(t,s){for(const c in this.binders){const f=this.binders[c];f instanceof Xr&&f.setConstantPatternPositions(t,s)}}updatePaintArrays(t,s,c,f,v){let x=!1;for(const w in t){const T=s.getPositions(w);for(const I of T){const L=c.feature(I.index);for(const O in this.binders){const $=this.binders[O];if(($ instanceof Ar||$ instanceof br||$ instanceof Is)&&$.expression.isStateDependent===!0){const j=f.paint.get(O);$.expression=j.value,$.updatePaintArray(I.start,I.end,L,t[w],v),x=!0}}}}return x}defines(){const t=[];for(const s in this.binders){const c=this.binders[s];(c instanceof ca||c instanceof Xr)&&t.push(...c.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return t}getBinderAttributes(){const t=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof Ar||c instanceof br)for(let f=0;f<c.paintVertexAttributes.length;f++)t.push(c.paintVertexAttributes[f].name);else if(c instanceof Is)for(let f=0;f<yt.members.length;f++)t.push(yt.members[f].name)}return t}getBinderUniforms(){const t=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof ca||c instanceof Xr||c instanceof br)for(const f of c.uniformNames)t.push(f)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,s){const c=[];for(const f in this.binders){const v=this.binders[f];if(v instanceof ca||v instanceof Xr||v instanceof br){for(const x of v.uniformNames)if(s[x]){const w=v.getBinding(t,s[x],x);c.push({name:x,property:f,binding:w})}}}return c}setUniforms(t,s,c,f){for(const{name:v,property:x,binding:w}of s)this.binders[x].setUniform(w,f,c.get(x),v)}updatePaintBuffers(t){this._buffers=[];for(const s in this.binders){const c=this.binders[s];if(t&&c instanceof Is){const f=t.fromScale===2?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(c instanceof Ar||c instanceof br)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}}upload(t){for(const s in this.binders){const c=this.binders[s];(c instanceof Ar||c instanceof br||c instanceof Is)&&c.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const s=this.binders[t];(s instanceof Ar||s instanceof br||s instanceof Is)&&s.destroy()}}}class Pr{constructor(t,s,c=()=>!0){this.programConfigurations={};for(const f of t)this.programConfigurations[f.id]=new Kr(f,s,c);this.needsUpload=!1,this._featureMap=new tr,this._bufferOffset=0}populatePaintArrays(t,s,c,f,v,x){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(t,s,f,v,x);s.id!==void 0&&this._featureMap.add(s.id,c,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,s,c,f){for(const v of c)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(t,this._featureMap,s,v,f)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function As(n,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}function Yr(n,t,s){const c={color:{source:Wl,composite:Dc},number:{source:Pc,composite:Wl}},f=function(v){return{"line-pattern":{source:me,composite:me},"fill-pattern":{source:me,composite:me},"fill-extrusion-pattern":{source:me,composite:me}}[v]}(n);return f&&f[s]||c[t][s]}Ct("ConstantBinder",ca),Ct("CrossFadedConstantBinder",Xr),Ct("SourceExpressionBinder",Ar),Ct("CrossFadedCompositeBinder",Is),Ct("CompositeExpressionBinder",br),Ct("ProgramConfiguration",Kr,{omit:["_buffers"]}),Ct("ProgramConfigurationSet",Pr);const $r=8192,Fu=Math.pow(2,14)-1,ud=-Fu-1;function wo(n){const t=$r/n.extent,s=n.loadGeometry();for(let c=0;c<s.length;c++){const f=s[c];for(let v=0;v<f.length;v++){const x=f[v],w=Math.round(x.x*t),T=Math.round(x.y*t);x.x=Ue(w,ud,Fu),x.y=Ue(T,ud,Fu),(w<x.x||w>x.x+1||T<x.y||T>x.y+1)&&Ei("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return s}function Mo(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?wo(n):[]}}function Lc(n,t,s,c,f){n.emplaceBack(2*t+(c+1)/2,2*s+(f+1)/2)}class Ka{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new q,this.indexArray=new Oe,this.segments=new ht,this.programConfigurations=new Pr(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,c){const f=this.layers[0],v=[];let x=null,w=!1;f.type==="circle"&&(x=f.layout.get("circle-sort-key"),w=!x.isConstant());for(const{feature:T,id:I,index:L,sourceLayerIndex:O}of t){const $=this.layers[0]._featureFilter.needGeometry,j=Mo(T,$);if(!this.layers[0]._featureFilter.filter(new xr(this.zoom),j,c))continue;const G=w?x.evaluate(j,{},c):void 0,Y={id:I,properties:T.properties,type:T.type,sourceLayerIndex:O,index:L,geometry:$?j.geometry:wo(T),patterns:{},sortKey:G};v.push(Y)}w&&v.sort((T,I)=>T.sortKey-I.sortKey);for(const T of v){const{geometry:I,index:L,sourceLayerIndex:O}=T,$=t[L].feature;this.addFeature(T,I,L,c),s.featureIndex.insert($,I,L,O,this.index)}}update(t,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ot),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,s,c,f){for(const v of s)for(const x of v){const w=x.x,T=x.y;if(w<0||w>=$r||T<0||T>=$r)continue;const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),L=I.vertexLength;Lc(this.layoutVertexArray,w,T,-1,-1),Lc(this.layoutVertexArray,w,T,1,-1),Lc(this.layoutVertexArray,w,T,1,1),Lc(this.layoutVertexArray,w,T,-1,1),this.indexArray.emplaceBack(L,L+1,L+2),this.indexArray.emplaceBack(L,L+3,L+2),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,{},f)}}function Bu(n,t){for(let s=0;s<n.length;s++)if(zc(t,n[s]))return!0;for(let s=0;s<t.length;s++)if(zc(n,t[s]))return!0;return!!Rc(n,t)}function hd(n,t,s){return!!zc(n,t)||!!Up(t,n,s)}function Nu(n,t){if(n.length===1)return gg(t,n[0]);for(let s=0;s<t.length;s++){const c=t[s];for(let f=0;f<c.length;f++)if(zc(n,c[f]))return!0}for(let s=0;s<n.length;s++)if(gg(t,n[s]))return!0;for(let s=0;s<t.length;s++)if(Rc(n,t[s]))return!0;return!1}function $u(n,t,s){if(n.length>1){if(Rc(n,t))return!0;for(let c=0;c<t.length;c++)if(Up(t[c],n,s))return!0}for(let c=0;c<n.length;c++)if(Up(n[c],t,s))return!0;return!1}function Rc(n,t){if(n.length===0||t.length===0)return!1;for(let s=0;s<n.length-1;s++){const c=n[s],f=n[s+1];for(let v=0;v<t.length-1;v++)if(Uu(c,f,t[v],t[v+1]))return!0}return!1}function Uu(n,t,s,c){return ci(n,s,c)!==ci(t,s,c)&&ci(n,t,s)!==ci(n,t,c)}function Up(n,t,s){const c=s*s;if(t.length===1)return n.distSqr(t[0])<c;for(let f=1;f<t.length;f++)if(mg(n,t[f-1],t[f])<c)return!0;return!1}function mg(n,t,s){const c=t.distSqr(s);if(c===0)return n.distSqr(t);const f=((n.x-t.x)*(s.x-t.x)+(n.y-t.y)*(s.y-t.y))/c;return n.distSqr(f<0?t:f>1?s:s.sub(t)._mult(f)._add(t))}function gg(n,t){let s,c,f,v=!1;for(let x=0;x<n.length;x++){s=n[x];for(let w=0,T=s.length-1;w<s.length;T=w++)c=s[w],f=s[T],c.y>t.y!=f.y>t.y&&t.x<(f.x-c.x)*(t.y-c.y)/(f.y-c.y)+c.x&&(v=!v)}return v}function zc(n,t){let s=!1;for(let c=0,f=n.length-1;c<n.length;f=c++){const v=n[c],x=n[f];v.y>t.y!=x.y>t.y&&t.x<(x.x-v.x)*(t.y-v.y)/(x.y-v.y)+v.x&&(s=!s)}return s}function h1(n,t,s){const c=s[0],f=s[2];if(n.x<c.x&&t.x<c.x||n.x>f.x&&t.x>f.x||n.y<c.y&&t.y<c.y||n.y>f.y&&t.y>f.y)return!1;const v=ci(n,t,s[0]);return v!==ci(n,t,s[1])||v!==ci(n,t,s[2])||v!==ci(n,t,s[3])}function Vu(n,t,s){const c=t.paint.get(n).value;return c.kind==="constant"?c.value:s.programConfigurations.get(t.id).getMaxValue(n)}function dd(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function pd(n,t,s,c,f){if(!t[0]&&!t[1])return n;const v=k.convert(t)._mult(f);s==="viewport"&&v._rotate(-c);const x=[];for(let w=0;w<n.length;w++)x.push(n[w].sub(v));return x}let yg,_g;Ct("CircleBucket",Ka,{omit:["layers"]});var d1={get paint(){return _g=_g||new Yn({"circle-radius":new ei(ce.paint_circle["circle-radius"]),"circle-color":new ei(ce.paint_circle["circle-color"]),"circle-blur":new ei(ce.paint_circle["circle-blur"]),"circle-opacity":new ei(ce.paint_circle["circle-opacity"]),"circle-translate":new Gt(ce.paint_circle["circle-translate"]),"circle-translate-anchor":new Gt(ce.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Gt(ce.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Gt(ce.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ei(ce.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ei(ce.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ei(ce.paint_circle["circle-stroke-opacity"])})},get layout(){return yg=yg||new Yn({"circle-sort-key":new ei(ce.layout_circle["circle-sort-key"])})}},Jn=1e-6,Oc=typeof Float32Array<"u"?Float32Array:Array;function Vp(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function vg(n,t,s){var c=t[0],f=t[1],v=t[2],x=t[3],w=t[4],T=t[5],I=t[6],L=t[7],O=t[8],$=t[9],j=t[10],G=t[11],Y=t[12],ne=t[13],he=t[14],Ce=t[15],pe=s[0],be=s[1],$e=s[2],He=s[3];return n[0]=pe*c+be*w+$e*O+He*Y,n[1]=pe*f+be*T+$e*$+He*ne,n[2]=pe*v+be*I+$e*j+He*he,n[3]=pe*x+be*L+$e*G+He*Ce,n[4]=(pe=s[4])*c+(be=s[5])*w+($e=s[6])*O+(He=s[7])*Y,n[5]=pe*f+be*T+$e*$+He*ne,n[6]=pe*v+be*I+$e*j+He*he,n[7]=pe*x+be*L+$e*G+He*Ce,n[8]=(pe=s[8])*c+(be=s[9])*w+($e=s[10])*O+(He=s[11])*Y,n[9]=pe*f+be*T+$e*$+He*ne,n[10]=pe*v+be*I+$e*j+He*he,n[11]=pe*x+be*L+$e*G+He*Ce,n[12]=(pe=s[12])*c+(be=s[13])*w+($e=s[14])*O+(He=s[15])*Y,n[13]=pe*f+be*T+$e*$+He*ne,n[14]=pe*v+be*I+$e*j+He*he,n[15]=pe*x+be*L+$e*G+He*Ce,n}Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var ju,p1=vg;function fd(n,t,s){var c=t[0],f=t[1],v=t[2],x=t[3];return n[0]=s[0]*c+s[4]*f+s[8]*v+s[12]*x,n[1]=s[1]*c+s[5]*f+s[9]*v+s[13]*x,n[2]=s[2]*c+s[6]*f+s[10]*v+s[14]*x,n[3]=s[3]*c+s[7]*f+s[11]*v+s[15]*x,n}ju=new Oc(4),Oc!=Float32Array&&(ju[0]=0,ju[1]=0,ju[2]=0,ju[3]=0);class f1 extends Zs{constructor(t){super(t,d1)}createBucket(t){return new Ka(t)}queryRadius(t){const s=t;return Vu("circle-radius",this,s)+Vu("circle-stroke-width",this,s)+dd(this.paint.get("circle-translate"))}queryIntersectsFeature(t,s,c,f,v,x,w,T){const I=pd(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,w),L=this.paint.get("circle-radius").evaluate(s,c)+this.paint.get("circle-stroke-width").evaluate(s,c),O=this.paint.get("circle-pitch-alignment")==="map",$=O?I:function(G,Y){return G.map(ne=>xg(ne,Y))}(I,T),j=O?L*w:L;for(const G of f)for(const Y of G){const ne=O?Y:xg(Y,T);let he=j;const Ce=fd([],[Y.x,Y.y,0,1],T);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?he*=Ce[3]/x.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(he*=x.cameraToCenterDistance/Ce[3]),hd($,ne,he))return!0}return!1}}function xg(n,t){const s=fd([],[n.x,n.y,0,1],t);return new k(s[0]/s[3],s[1]/s[3])}class bg extends Ka{}let wg;Ct("HeatmapBucket",bg,{omit:["layers"]});var m1={get paint(){return wg=wg||new Yn({"heatmap-radius":new ei(ce.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ei(ce.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Gt(ce.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Iu(ce.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Gt(ce.paint_heatmap["heatmap-opacity"])})}};function jp(n,{width:t,height:s},c,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==t*s*c)throw new RangeError(`mismatched image size. expected: ${f.length} but got: ${t*s*c}`)}else f=new Uint8Array(t*s*c);return n.width=t,n.height=s,n.data=f,n}function Mg(n,{width:t,height:s},c){if(t===n.width&&s===n.height)return;const f=jp({},{width:t,height:s},c);qp(n,f,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,t),height:Math.min(n.height,s)},c),n.width=t,n.height=s,n.data=f.data}function qp(n,t,s,c,f,v){if(f.width===0||f.height===0)return t;if(f.width>n.width||f.height>n.height||s.x>n.width-f.width||s.y>n.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>t.width||f.height>t.height||c.x>t.width-f.width||c.y>t.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const x=n.data,w=t.data;if(x===w)throw new Error("srcData equals dstData, so image is already copied");for(let T=0;T<f.height;T++){const I=((s.y+T)*n.width+s.x)*v,L=((c.y+T)*t.width+c.x)*v;for(let O=0;O<f.width*v;O++)w[L+O]=x[I+O]}return t}class qu{constructor(t,s){jp(this,t,1,s)}resize(t){Mg(this,t,1)}clone(){return new qu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,c,f,v){qp(t,s,c,f,v,1)}}class Xs{constructor(t,s){jp(this,t,4,s)}resize(t){Mg(this,t,4)}replace(t,s){s?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Xs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,c,f,v){qp(t,s,c,f,v,4)}}function Sg(n){const t={},s=n.resolution||256,c=n.clips?n.clips.length:1,f=n.image||new Xs({width:s,height:c});if(Math.log(s)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${s}`);const v=(x,w,T)=>{t[n.evaluationKey]=T;const I=n.expression.evaluate(t);f.data[x+w+0]=Math.floor(255*I.r/I.a),f.data[x+w+1]=Math.floor(255*I.g/I.a),f.data[x+w+2]=Math.floor(255*I.b/I.a),f.data[x+w+3]=Math.floor(255*I.a)};if(n.clips)for(let x=0,w=0;x<c;++x,w+=4*s)for(let T=0,I=0;T<s;T++,I+=4){const L=T/(s-1),{start:O,end:$}=n.clips[x];v(w,I,O*(1-L)+$*L)}else for(let x=0,w=0;x<s;x++,w+=4)v(0,w,x/(s-1));return f}Ct("AlphaImage",qu),Ct("RGBAImage",Xs);class g1 extends Zs{createBucket(t){return new bg(t)}constructor(t){super(t,m1),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Sg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Eg;var y1={get paint(){return Eg=Eg||new Yn({"hillshade-illumination-direction":new Gt(ce.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Gt(ce.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Gt(ce.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Gt(ce.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Gt(ce.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Gt(ce.paint_hillshade["hillshade-accent-color"])})}};class _1 extends Zs{constructor(t){super(t,y1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const v1=qr([{name:"a_pos",components:2,type:"Int16"}],4),{members:x1}=v1;var Gp={exports:{}};function md(n,t,s){s=s||2;var c,f,v,x,w,T,I,L=t&&t.length,O=L?t[0]*s:n.length,$=Tg(n,0,O,s,!0),j=[];if(!$||$.next===$.prev)return j;if(L&&($=function(Y,ne,he,Ce){var pe,be,$e,He=[];for(pe=0,be=ne.length;pe<be;pe++)($e=Tg(Y,ne[pe]*Ce,pe<be-1?ne[pe+1]*Ce:Y.length,Ce,!1))===$e.next&&($e.steiner=!0),He.push(I1($e));for(He.sort(E1),pe=0;pe<He.length;pe++)he=T1(He[pe],he);return he}(n,t,$,s)),n.length>80*s){c=v=n[0],f=x=n[1];for(var G=s;G<O;G+=s)(w=n[G])<c&&(c=w),(T=n[G+1])<f&&(f=T),w>v&&(v=w),T>x&&(x=T);I=(I=Math.max(v-c,x-f))!==0?32767/I:0}return Gu($,j,s,c,f,I,0),j}function Tg(n,t,s,c,f){var v,x;if(f===Zp(n,t,s,c)>0)for(v=t;v<s;v+=c)x=Ag(v,n[v],n[v+1],x);else for(v=s-c;v>=t;v-=c)x=Ag(v,n[v],n[v+1],x);return x&&gd(x,x.next)&&(Wu(x),x=x.next),x}function Yl(n,t){if(!n)return n;t||(t=n);var s,c=n;do if(s=!1,c.steiner||!gd(c,c.next)&&Gr(c.prev,c,c.next)!==0)c=c.next;else{if(Wu(c),(c=t=c.prev)===c.next)break;s=!0}while(s||c!==t);return t}function Gu(n,t,s,c,f,v,x){if(n){!x&&v&&function(L,O,$,j){var G=L;do G.z===0&&(G.z=Hp(G.x,G.y,O,$,j)),G.prevZ=G.prev,G.nextZ=G.next,G=G.next;while(G!==L);G.prevZ.nextZ=null,G.prevZ=null,function(Y){var ne,he,Ce,pe,be,$e,He,It,Nt=1;do{for(he=Y,Y=null,be=null,$e=0;he;){for($e++,Ce=he,He=0,ne=0;ne<Nt&&(He++,Ce=Ce.nextZ);ne++);for(It=Nt;He>0||It>0&&Ce;)He!==0&&(It===0||!Ce||he.z<=Ce.z)?(pe=he,he=he.nextZ,He--):(pe=Ce,Ce=Ce.nextZ,It--),be?be.nextZ=pe:Y=pe,pe.prevZ=be,be=pe;he=Ce}be.nextZ=null,Nt*=2}while($e>1)}(G)}(n,c,f,v);for(var w,T,I=n;n.prev!==n.next;)if(w=n.prev,T=n.next,v?w1(n,c,f,v):b1(n))t.push(w.i/s|0),t.push(n.i/s|0),t.push(T.i/s|0),Wu(n),n=T.next,I=T.next;else if((n=T)===I){x?x===1?Gu(n=M1(Yl(n),t,s),t,s,c,f,v,2):x===2&&S1(n,t,s,c,f,v):Gu(Yl(n),t,s,c,f,v,1);break}}}function b1(n){var t=n.prev,s=n,c=n.next;if(Gr(t,s,c)>=0)return!1;for(var f=t.x,v=s.x,x=c.x,w=t.y,T=s.y,I=c.y,L=f<v?f<x?f:x:v<x?v:x,O=w<T?w<I?w:I:T<I?T:I,$=f>v?f>x?f:x:v>x?v:x,j=w>T?w>I?w:I:T>I?T:I,G=c.next;G!==t;){if(G.x>=L&&G.x<=$&&G.y>=O&&G.y<=j&&Fc(f,w,v,T,x,I,G.x,G.y)&&Gr(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function w1(n,t,s,c){var f=n.prev,v=n,x=n.next;if(Gr(f,v,x)>=0)return!1;for(var w=f.x,T=v.x,I=x.x,L=f.y,O=v.y,$=x.y,j=w<T?w<I?w:I:T<I?T:I,G=L<O?L<$?L:$:O<$?O:$,Y=w>T?w>I?w:I:T>I?T:I,ne=L>O?L>$?L:$:O>$?O:$,he=Hp(j,G,t,s,c),Ce=Hp(Y,ne,t,s,c),pe=n.prevZ,be=n.nextZ;pe&&pe.z>=he&&be&&be.z<=Ce;){if(pe.x>=j&&pe.x<=Y&&pe.y>=G&&pe.y<=ne&&pe!==f&&pe!==x&&Fc(w,L,T,O,I,$,pe.x,pe.y)&&Gr(pe.prev,pe,pe.next)>=0||(pe=pe.prevZ,be.x>=j&&be.x<=Y&&be.y>=G&&be.y<=ne&&be!==f&&be!==x&&Fc(w,L,T,O,I,$,be.x,be.y)&&Gr(be.prev,be,be.next)>=0))return!1;be=be.nextZ}for(;pe&&pe.z>=he;){if(pe.x>=j&&pe.x<=Y&&pe.y>=G&&pe.y<=ne&&pe!==f&&pe!==x&&Fc(w,L,T,O,I,$,pe.x,pe.y)&&Gr(pe.prev,pe,pe.next)>=0)return!1;pe=pe.prevZ}for(;be&&be.z<=Ce;){if(be.x>=j&&be.x<=Y&&be.y>=G&&be.y<=ne&&be!==f&&be!==x&&Fc(w,L,T,O,I,$,be.x,be.y)&&Gr(be.prev,be,be.next)>=0)return!1;be=be.nextZ}return!0}function M1(n,t,s){var c=n;do{var f=c.prev,v=c.next.next;!gd(f,v)&&Cg(f,c,c.next,v)&&Hu(f,v)&&Hu(v,f)&&(t.push(f.i/s|0),t.push(c.i/s|0),t.push(v.i/s|0),Wu(c),Wu(c.next),c=n=v),c=c.next}while(c!==n);return Yl(c)}function S1(n,t,s,c,f,v){var x=n;do{for(var w=x.next.next;w!==x.prev;){if(x.i!==w.i&&A1(x,w)){var T=Ig(x,w);return x=Yl(x,x.next),T=Yl(T,T.next),Gu(x,t,s,c,f,v,0),void Gu(T,t,s,c,f,v,0)}w=w.next}x=x.next}while(x!==n)}function E1(n,t){return n.x-t.x}function T1(n,t){var s=function(f,v){var x,w=v,T=f.x,I=f.y,L=-1/0;do{if(I<=w.y&&I>=w.next.y&&w.next.y!==w.y){var O=w.x+(I-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(O<=T&&O>L&&(L=O,x=w.x<w.next.x?w:w.next,O===T))return x}w=w.next}while(w!==v);if(!x)return null;var $,j=x,G=x.x,Y=x.y,ne=1/0;w=x;do T>=w.x&&w.x>=G&&T!==w.x&&Fc(I<Y?T:L,I,G,Y,I<Y?L:T,I,w.x,w.y)&&($=Math.abs(I-w.y)/(T-w.x),Hu(w,f)&&($<ne||$===ne&&(w.x>x.x||w.x===x.x&&C1(x,w)))&&(x=w,ne=$)),w=w.next;while(w!==j);return x}(n,t);if(!s)return t;var c=Ig(s,n);return Yl(c,c.next),Yl(s,s.next)}function C1(n,t){return Gr(n.prev,n,t.prev)<0&&Gr(t.next,n,n.next)<0}function Hp(n,t,s,c,f){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-s)*f|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-c)*f|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function I1(n){var t=n,s=n;do(t.x<s.x||t.x===s.x&&t.y<s.y)&&(s=t),t=t.next;while(t!==n);return s}function Fc(n,t,s,c,f,v,x,w){return(f-x)*(t-w)>=(n-x)*(v-w)&&(n-x)*(c-w)>=(s-x)*(t-w)&&(s-x)*(v-w)>=(f-x)*(c-w)}function A1(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!function(s,c){var f=s;do{if(f.i!==s.i&&f.next.i!==s.i&&f.i!==c.i&&f.next.i!==c.i&&Cg(f,f.next,s,c))return!0;f=f.next}while(f!==s);return!1}(n,t)&&(Hu(n,t)&&Hu(t,n)&&function(s,c){var f=s,v=!1,x=(s.x+c.x)/2,w=(s.y+c.y)/2;do f.y>w!=f.next.y>w&&f.next.y!==f.y&&x<(f.next.x-f.x)*(w-f.y)/(f.next.y-f.y)+f.x&&(v=!v),f=f.next;while(f!==s);return v}(n,t)&&(Gr(n.prev,n,t.prev)||Gr(n,t.prev,t))||gd(n,t)&&Gr(n.prev,n,n.next)>0&&Gr(t.prev,t,t.next)>0)}function Gr(n,t,s){return(t.y-n.y)*(s.x-t.x)-(t.x-n.x)*(s.y-t.y)}function gd(n,t){return n.x===t.x&&n.y===t.y}function Cg(n,t,s,c){var f=_d(Gr(n,t,s)),v=_d(Gr(n,t,c)),x=_d(Gr(s,c,n)),w=_d(Gr(s,c,t));return f!==v&&x!==w||!(f!==0||!yd(n,s,t))||!(v!==0||!yd(n,c,t))||!(x!==0||!yd(s,n,c))||!(w!==0||!yd(s,t,c))}function yd(n,t,s){return t.x<=Math.max(n.x,s.x)&&t.x>=Math.min(n.x,s.x)&&t.y<=Math.max(n.y,s.y)&&t.y>=Math.min(n.y,s.y)}function _d(n){return n>0?1:n<0?-1:0}function Hu(n,t){return Gr(n.prev,n,n.next)<0?Gr(n,t,n.next)>=0&&Gr(n,n.prev,t)>=0:Gr(n,t,n.prev)<0||Gr(n,n.next,t)<0}function Ig(n,t){var s=new Wp(n.i,n.x,n.y),c=new Wp(t.i,t.x,t.y),f=n.next,v=t.prev;return n.next=t,t.prev=n,s.next=f,f.prev=s,c.next=s,s.prev=c,v.next=c,c.prev=v,c}function Ag(n,t,s,c){var f=new Wp(n,t,s);return c?(f.next=c.next,f.prev=c,c.next.prev=f,c.next=f):(f.prev=f,f.next=f),f}function Wu(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Wp(n,t,s){this.i=n,this.x=t,this.y=s,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Zp(n,t,s,c){for(var f=0,v=t,x=s-c;v<s;v+=c)f+=(n[x]-n[v])*(n[v+1]+n[x+1]),x=v;return f}Gp.exports=md,Gp.exports.default=md,md.deviation=function(n,t,s,c){var f=t&&t.length,v=Math.abs(Zp(n,0,f?t[0]*s:n.length,s));if(f)for(var x=0,w=t.length;x<w;x++)v-=Math.abs(Zp(n,t[x]*s,x<w-1?t[x+1]*s:n.length,s));var T=0;for(x=0;x<c.length;x+=3){var I=c[x]*s,L=c[x+1]*s,O=c[x+2]*s;T+=Math.abs((n[I]-n[O])*(n[L+1]-n[I+1])-(n[I]-n[L])*(n[O+1]-n[I+1]))}return v===0&&T===0?0:Math.abs((T-v)/v)},md.flatten=function(n){for(var t=n[0][0].length,s={vertices:[],holes:[],dimensions:t},c=0,f=0;f<n.length;f++){for(var v=0;v<n[f].length;v++)for(var x=0;x<t;x++)s.vertices.push(n[f][v][x]);f>0&&s.holes.push(c+=n[f-1].length)}return s};var Pg=M(Gp.exports);function P1(n,t,s,c,f){kg(n,t,s||0,c||n.length-1,f||k1)}function kg(n,t,s,c,f){for(;c>s;){if(c-s>600){var v=c-s+1,x=t-s+1,w=Math.log(v),T=.5*Math.exp(2*w/3),I=.5*Math.sqrt(w*T*(v-T)/v)*(x-v/2<0?-1:1);kg(n,t,Math.max(s,Math.floor(t-x*T/v+I)),Math.min(c,Math.floor(t+(v-x)*T/v+I)),f)}var L=n[t],O=s,$=c;for(Zu(n,s,t),f(n[c],L)>0&&Zu(n,s,c);O<$;){for(Zu(n,O,$),O++,$--;f(n[O],L)<0;)O++;for(;f(n[$],L)>0;)$--}f(n[s],L)===0?Zu(n,s,$):Zu(n,++$,c),$<=t&&(s=$+1),t<=$&&(c=$-1)}}function Zu(n,t,s){var c=n[t];n[t]=n[s],n[s]=c}function k1(n,t){return n<t?-1:n>t?1:0}function Xp(n,t){const s=n.length;if(s<=1)return[n];const c=[];let f,v;for(let x=0;x<s;x++){const w=xt(n[x]);w!==0&&(n[x].area=Math.abs(w),v===void 0&&(v=w<0),v===w<0?(f&&c.push(f),f=[n[x]]):f.push(n[x]))}if(f&&c.push(f),t>1)for(let x=0;x<c.length;x++)c[x].length<=t||(P1(c[x],t,1,c[x].length-1,D1),c[x]=c[x].slice(0,t));return c}function D1(n,t){return t.area-n.area}function Kp(n,t,s){const c=s.patternDependencies;let f=!1;for(const v of t){const x=v.paint.get(`${n}-pattern`);x.isConstant()||(f=!0);const w=x.constantOr(null);w&&(f=!0,c[w.to]=!0,c[w.from]=!0)}return f}function Yp(n,t,s,c,f){const v=f.patternDependencies;for(const x of t){const w=x.paint.get(`${n}-pattern`).value;if(w.kind!=="constant"){let T=w.evaluate({zoom:c-1},s,{},f.availableImages),I=w.evaluate({zoom:c},s,{},f.availableImages),L=w.evaluate({zoom:c+1},s,{},f.availableImages);T=T&&T.name?T.name:T,I=I&&I.name?I.name:I,L=L&&L.name?L.name:L,v[T]=!0,v[I]=!0,v[L]=!0,s.patterns[x.id]={min:T,mid:I,max:L}}}return s}class Jp{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new re,this.indexArray=new Oe,this.indexArray2=new Ke,this.programConfigurations=new Pr(t.layers,t.zoom),this.segments=new ht,this.segments2=new ht,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,c){this.hasPattern=Kp("fill",this.layers,s);const f=this.layers[0].layout.get("fill-sort-key"),v=!f.isConstant(),x=[];for(const{feature:w,id:T,index:I,sourceLayerIndex:L}of t){const O=this.layers[0]._featureFilter.needGeometry,$=Mo(w,O);if(!this.layers[0]._featureFilter.filter(new xr(this.zoom),$,c))continue;const j=v?f.evaluate($,{},c,s.availableImages):void 0,G={id:T,properties:w.properties,type:w.type,sourceLayerIndex:L,index:I,geometry:O?$.geometry:wo(w),patterns:{},sortKey:j};x.push(G)}v&&x.sort((w,T)=>w.sortKey-T.sortKey);for(const w of x){const{geometry:T,index:I,sourceLayerIndex:L}=w;if(this.hasPattern){const O=Yp("fill",this.layers,w,this.zoom,s);this.patternFeatures.push(O)}else this.addFeature(w,T,I,c,{});s.featureIndex.insert(t[I].feature,T,I,L,this.index)}}update(t,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,c)}addFeatures(t,s,c){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,s,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,x1),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,s,c,f,v){for(const x of Xp(s,500)){let w=0;for(const j of x)w+=j.length;const T=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),I=T.vertexLength,L=[],O=[];for(const j of x){if(j.length===0)continue;j!==x[0]&&O.push(L.length/2);const G=this.segments2.prepareSegment(j.length,this.layoutVertexArray,this.indexArray2),Y=G.vertexLength;this.layoutVertexArray.emplaceBack(j[0].x,j[0].y),this.indexArray2.emplaceBack(Y+j.length-1,Y),L.push(j[0].x),L.push(j[0].y);for(let ne=1;ne<j.length;ne++)this.layoutVertexArray.emplaceBack(j[ne].x,j[ne].y),this.indexArray2.emplaceBack(Y+ne-1,Y+ne),L.push(j[ne].x),L.push(j[ne].y);G.vertexLength+=j.length,G.primitiveLength+=j.length}const $=Pg(L,O);for(let j=0;j<$.length;j+=3)this.indexArray.emplaceBack(I+$[j],I+$[j+1],I+$[j+2]);T.vertexLength+=w,T.primitiveLength+=$.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,v,f)}}let Dg,Lg;Ct("FillBucket",Jp,{omit:["layers","patternFeatures"]});var L1={get paint(){return Lg=Lg||new Yn({"fill-antialias":new Gt(ce.paint_fill["fill-antialias"]),"fill-opacity":new ei(ce.paint_fill["fill-opacity"]),"fill-color":new ei(ce.paint_fill["fill-color"]),"fill-outline-color":new ei(ce.paint_fill["fill-outline-color"]),"fill-translate":new Gt(ce.paint_fill["fill-translate"]),"fill-translate-anchor":new Gt(ce.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ec(ce.paint_fill["fill-pattern"])})},get layout(){return Dg=Dg||new Yn({"fill-sort-key":new ei(ce.layout_fill["fill-sort-key"])})}};class R1 extends Zs{constructor(t){super(t,L1)}recalculate(t,s){super.recalculate(t,s);const c=this.paint._values["fill-outline-color"];c.value.kind==="constant"&&c.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Jp(t)}queryRadius(){return dd(this.paint.get("fill-translate"))}queryIntersectsFeature(t,s,c,f,v,x,w){return Nu(pd(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,w),f)}isTileClipped(){return!0}}const z1=qr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),O1=qr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:F1}=z1;var nl={},B1=A,Rg=Bc;function Bc(n,t,s,c,f){this.properties={},this.extent=s,this.type=0,this._pbf=n,this._geometry=-1,this._keys=c,this._values=f,n.readFields(N1,this,t)}function N1(n,t,s){n==1?t.id=s.readVarint():n==2?function(c,f){for(var v=c.readVarint()+c.pos;c.pos<v;){var x=f._keys[c.readVarint()],w=f._values[c.readVarint()];f.properties[x]=w}}(s,t):n==3?t.type=s.readVarint():n==4&&(t._geometry=s.pos)}function $1(n){for(var t,s,c=0,f=0,v=n.length,x=v-1;f<v;x=f++)c+=((s=n[x]).x-(t=n[f]).x)*(t.y+s.y);return c}Bc.types=["Unknown","Point","LineString","Polygon"],Bc.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var t,s=n.readVarint()+n.pos,c=1,f=0,v=0,x=0,w=[];n.pos<s;){if(f<=0){var T=n.readVarint();c=7&T,f=T>>3}if(f--,c===1||c===2)v+=n.readSVarint(),x+=n.readSVarint(),c===1&&(t&&w.push(t),t=[]),t.push(new B1(v,x));else{if(c!==7)throw new Error("unknown command "+c);t&&t.push(t[0].clone())}}return t&&w.push(t),w},Bc.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var t=n.readVarint()+n.pos,s=1,c=0,f=0,v=0,x=1/0,w=-1/0,T=1/0,I=-1/0;n.pos<t;){if(c<=0){var L=n.readVarint();s=7&L,c=L>>3}if(c--,s===1||s===2)(f+=n.readSVarint())<x&&(x=f),f>w&&(w=f),(v+=n.readSVarint())<T&&(T=v),v>I&&(I=v);else if(s!==7)throw new Error("unknown command "+s)}return[x,T,w,I]},Bc.prototype.toGeoJSON=function(n,t,s){var c,f,v=this.extent*Math.pow(2,s),x=this.extent*n,w=this.extent*t,T=this.loadGeometry(),I=Bc.types[this.type];function L(j){for(var G=0;G<j.length;G++){var Y=j[G];j[G]=[360*(Y.x+x)/v-180,360/Math.PI*Math.atan(Math.exp((180-360*(Y.y+w)/v)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(c=0;c<T.length;c++)O[c]=T[c][0];L(T=O);break;case 2:for(c=0;c<T.length;c++)L(T[c]);break;case 3:for(T=function(j){var G=j.length;if(G<=1)return[j];for(var Y,ne,he=[],Ce=0;Ce<G;Ce++){var pe=$1(j[Ce]);pe!==0&&(ne===void 0&&(ne=pe<0),ne===pe<0?(Y&&he.push(Y),Y=[j[Ce]]):Y.push(j[Ce]))}return Y&&he.push(Y),he}(T),c=0;c<T.length;c++)for(f=0;f<T[c].length;f++)L(T[c][f])}T.length===1?T=T[0]:I="Multi"+I;var $={type:"Feature",geometry:{type:I,coordinates:T},properties:this.properties};return"id"in this&&($.id=this.id),$};var U1=Rg,zg=Og;function Og(n,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(V1,this,t),this.length=this._features.length}function V1(n,t,s){n===15?t.version=s.readVarint():n===1?t.name=s.readString():n===5?t.extent=s.readVarint():n===2?t._features.push(s.pos):n===3?t._keys.push(s.readString()):n===4&&t._values.push(function(c){for(var f=null,v=c.readVarint()+c.pos;c.pos<v;){var x=c.readVarint()>>3;f=x===1?c.readString():x===2?c.readFloat():x===3?c.readDouble():x===4?c.readVarint64():x===5?c.readVarint():x===6?c.readSVarint():x===7?c.readBoolean():null}return f}(s))}Og.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var t=this._pbf.readVarint()+this._pbf.pos;return new U1(this._pbf,t,this.extent,this._keys,this._values)};var j1=zg;function q1(n,t,s){if(n===3){var c=new j1(s,s.readVarint()+s.pos);c.length&&(t[c.name]=c)}}nl.VectorTile=function(n,t){this.layers=n.readFields(q1,{},t)},nl.VectorTileFeature=Rg,nl.VectorTileLayer=zg;const G1=nl.VectorTileFeature.types,Qp=Math.pow(2,13);function Xu(n,t,s,c,f,v,x,w){n.emplaceBack(t,s,2*Math.floor(c*Qp)+x,f*Qp*2,v*Qp*2,Math.round(w))}class ef{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new te,this.centroidVertexArray=new B,this.indexArray=new Oe,this.programConfigurations=new Pr(t.layers,t.zoom),this.segments=new ht,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,c){this.features=[],this.hasPattern=Kp("fill-extrusion",this.layers,s);for(const{feature:f,id:v,index:x,sourceLayerIndex:w}of t){const T=this.layers[0]._featureFilter.needGeometry,I=Mo(f,T);if(!this.layers[0]._featureFilter.filter(new xr(this.zoom),I,c))continue;const L={id:v,sourceLayerIndex:w,index:x,geometry:T?I.geometry:wo(f),properties:f.properties,type:f.type,patterns:{}};this.hasPattern?this.features.push(Yp("fill-extrusion",this.layers,L,this.zoom,s)):this.addFeature(L,L.geometry,x,c,{}),s.featureIndex.insert(f,L.geometry,x,w,this.index,!0)}}addFeatures(t,s,c){for(const f of this.features){const{geometry:v}=f;this.addFeature(f,v,f.index,s,c)}}update(t,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,c)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,F1),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,O1.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,s,c,f,v){const x={x:0,y:0,vertexCount:0};for(const w of Xp(s,500)){let T=0;for(const G of w)T+=G.length;let I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const G of w){if(G.length===0||W1(G))continue;let Y=0;for(let ne=0;ne<G.length;ne++){const he=G[ne];if(ne>=1){const Ce=G[ne-1];if(!H1(he,Ce)){I.vertexLength+4>ht.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const pe=he.sub(Ce)._perp()._unit(),be=Ce.dist(he);Y+be>32768&&(Y=0),Xu(this.layoutVertexArray,he.x,he.y,pe.x,pe.y,0,0,Y),Xu(this.layoutVertexArray,he.x,he.y,pe.x,pe.y,0,1,Y),x.x+=2*he.x,x.y+=2*he.y,x.vertexCount+=2,Y+=be,Xu(this.layoutVertexArray,Ce.x,Ce.y,pe.x,pe.y,0,0,Y),Xu(this.layoutVertexArray,Ce.x,Ce.y,pe.x,pe.y,0,1,Y),x.x+=2*Ce.x,x.y+=2*Ce.y,x.vertexCount+=2;const $e=I.vertexLength;this.indexArray.emplaceBack($e,$e+2,$e+1),this.indexArray.emplaceBack($e+1,$e+2,$e+3),I.vertexLength+=4,I.primitiveLength+=2}}}}if(I.vertexLength+T>ht.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray)),G1[t.type]!=="Polygon")continue;const L=[],O=[],$=I.vertexLength;for(const G of w)if(G.length!==0){G!==w[0]&&O.push(L.length/2);for(let Y=0;Y<G.length;Y++){const ne=G[Y];Xu(this.layoutVertexArray,ne.x,ne.y,0,0,1,1,0),x.x+=ne.x,x.y+=ne.y,x.vertexCount+=1,L.push(ne.x),L.push(ne.y)}}const j=Pg(L,O);for(let G=0;G<j.length;G+=3)this.indexArray.emplaceBack($+j[G],$+j[G+2],$+j[G+1]);I.primitiveLength+=j.length/3,I.vertexLength+=T}for(let w=0;w<x.vertexCount;w++)this.centroidVertexArray.emplaceBack(Math.floor(x.x/x.vertexCount),Math.floor(x.y/x.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,v,f)}}function H1(n,t){return n.x===t.x&&(n.x<0||n.x>$r)||n.y===t.y&&(n.y<0||n.y>$r)}function W1(n){return n.every(t=>t.x<0)||n.every(t=>t.x>$r)||n.every(t=>t.y<0)||n.every(t=>t.y>$r)}let Fg;Ct("FillExtrusionBucket",ef,{omit:["layers","features"]});var Z1={get paint(){return Fg=Fg||new Yn({"fill-extrusion-opacity":new Gt(ce["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ei(ce["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Gt(ce["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Gt(ce["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ec(ce["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ei(ce["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ei(ce["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Gt(ce["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class X1 extends Zs{constructor(t){super(t,Z1)}createBucket(t){return new ef(t)}queryRadius(){return dd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,s,c,f,v,x,w,T){const I=pd(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,w),L=this.paint.get("fill-extrusion-height").evaluate(s,c),O=this.paint.get("fill-extrusion-base").evaluate(s,c),$=function(G,Y,ne,he){const Ce=[];for(const pe of G){const be=[pe.x,pe.y,0,1];fd(be,be,Y),Ce.push(new k(be[0]/be[3],be[1]/be[3]))}return Ce}(I,T),j=function(G,Y,ne,he){const Ce=[],pe=[],be=he[8]*Y,$e=he[9]*Y,He=he[10]*Y,It=he[11]*Y,Nt=he[8]*ne,Et=he[9]*ne,bt=he[10]*ne,ct=he[11]*ne;for(const Rt of G){const _t=[],tt=[];for(const Qt of Rt){const jt=Qt.x,Si=Qt.y,yr=he[0]*jt+he[4]*Si+he[12],wr=he[1]*jt+he[5]*Si+he[13],ln=he[2]*jt+he[6]*Si+he[14],Ps=he[3]*jt+he[7]*Si+he[15],Qn=ln+He,Jr=Ps+It,In=yr+Nt,Ln=wr+Et,es=ln+bt,ts=Ps+ct,cn=new k((yr+be)/Jr,(wr+$e)/Jr);cn.z=Qn/Jr,_t.push(cn);const un=new k(In/ts,Ln/ts);un.z=es/ts,tt.push(un)}Ce.push(_t),pe.push(tt)}return[Ce,pe]}(f,O,L,T);return function(G,Y,ne){let he=1/0;Nu(ne,Y)&&(he=Bg(ne,Y[0]));for(let Ce=0;Ce<Y.length;Ce++){const pe=Y[Ce],be=G[Ce];for(let $e=0;$e<pe.length-1;$e++){const He=pe[$e],It=[He,pe[$e+1],be[$e+1],be[$e],He];Bu(ne,It)&&(he=Math.min(he,Bg(ne,It)))}}return he!==1/0&&he}(j[0],j[1],$)}}function Ku(n,t){return n.x*t.x+n.y*t.y}function Bg(n,t){if(n.length===1){let s=0;const c=t[s++];let f;for(;!f||c.equals(f);)if(f=t[s++],!f)return 1/0;for(;s<t.length;s++){const v=t[s],x=n[0],w=f.sub(c),T=v.sub(c),I=x.sub(c),L=Ku(w,w),O=Ku(w,T),$=Ku(T,T),j=Ku(I,w),G=Ku(I,T),Y=L*$-O*O,ne=($*j-O*G)/Y,he=(L*G-O*j)/Y,Ce=c.z*(1-ne-he)+f.z*ne+v.z*he;if(isFinite(Ce))return Ce}return 1/0}{let s=1/0;for(const c of t)s=Math.min(s,c.z);return s}}const K1=qr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Y1}=K1,J1=qr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Q1}=J1,eb=nl.VectorTileFeature.types,tb=Math.cos(Math.PI/180*37.5),Ng=Math.pow(2,14)/.5;class tf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new se,this.layoutVertexArray2=new K,this.indexArray=new Oe,this.programConfigurations=new Pr(t.layers,t.zoom),this.segments=new ht,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,c){this.hasPattern=Kp("line",this.layers,s);const f=this.layers[0].layout.get("line-sort-key"),v=!f.isConstant(),x=[];for(const{feature:w,id:T,index:I,sourceLayerIndex:L}of t){const O=this.layers[0]._featureFilter.needGeometry,$=Mo(w,O);if(!this.layers[0]._featureFilter.filter(new xr(this.zoom),$,c))continue;const j=v?f.evaluate($,{},c):void 0,G={id:T,properties:w.properties,type:w.type,sourceLayerIndex:L,index:I,geometry:O?$.geometry:wo(w),patterns:{},sortKey:j};x.push(G)}v&&x.sort((w,T)=>w.sortKey-T.sortKey);for(const w of x){const{geometry:T,index:I,sourceLayerIndex:L}=w;if(this.hasPattern){const O=Yp("line",this.layers,w,this.zoom,s);this.patternFeatures.push(O)}else this.addFeature(w,T,I,c,{});s.featureIndex.insert(t[I].feature,T,I,L,this.index)}}update(t,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,c)}addFeatures(t,s,c){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,s,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Q1)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Y1),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,s,c,f,v){const x=this.layers[0].layout,w=x.get("line-join").evaluate(t,{}),T=x.get("line-cap"),I=x.get("line-miter-limit"),L=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const O of s)this.addLine(O,t,w,T,I,L);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,v,f)}addLine(t,s,c,f,v,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let he=0;he<t.length-1;he++)this.totalDistance+=t[he].dist(t[he+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w=eb[s.type]==="Polygon";let T=t.length;for(;T>=2&&t[T-1].equals(t[T-2]);)T--;let I=0;for(;I<T-1&&t[I].equals(t[I+1]);)I++;if(T<(w?3:2))return;c==="bevel"&&(v=1.05);const L=this.overscaling<=16?15*$r/(512*this.overscaling):0,O=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let $,j,G,Y,ne;this.e1=this.e2=-1,w&&($=t[T-2],ne=t[I].sub($)._unit()._perp());for(let he=I;he<T;he++){if(G=he===T-1?w?t[I+1]:void 0:t[he+1],G&&t[he].equals(G))continue;ne&&(Y=ne),$&&(j=$),$=t[he],ne=G?G.sub($)._unit()._perp():Y,Y=Y||ne;let Ce=Y.add(ne);Ce.x===0&&Ce.y===0||Ce._unit();const pe=Y.x*ne.x+Y.y*ne.y,be=Ce.x*ne.x+Ce.y*ne.y,$e=be!==0?1/be:1/0,He=2*Math.sqrt(2-2*be),It=be<tb&&j&&G,Nt=Y.x*ne.y-Y.y*ne.x>0;if(It&&he>I){const ct=$.dist(j);if(ct>2*L){const Rt=$.sub($.sub(j)._mult(L/ct)._round());this.updateDistance(j,Rt),this.addCurrentVertex(Rt,Y,0,0,O),j=Rt}}const Et=j&&G;let bt=Et?c:w?"butt":f;if(Et&&bt==="round"&&($e<x?bt="miter":$e<=2&&(bt="fakeround")),bt==="miter"&&$e>v&&(bt="bevel"),bt==="bevel"&&($e>2&&(bt="flipbevel"),$e<v&&(bt="miter")),j&&this.updateDistance(j,$),bt==="miter")Ce._mult($e),this.addCurrentVertex($,Ce,0,0,O);else if(bt==="flipbevel"){if($e>100)Ce=ne.mult(-1);else{const ct=$e*Y.add(ne).mag()/Y.sub(ne).mag();Ce._perp()._mult(ct*(Nt?-1:1))}this.addCurrentVertex($,Ce,0,0,O),this.addCurrentVertex($,Ce.mult(-1),0,0,O)}else if(bt==="bevel"||bt==="fakeround"){const ct=-Math.sqrt($e*$e-1),Rt=Nt?ct:0,_t=Nt?0:ct;if(j&&this.addCurrentVertex($,Y,Rt,_t,O),bt==="fakeround"){const tt=Math.round(180*He/Math.PI/20);for(let Qt=1;Qt<tt;Qt++){let jt=Qt/tt;if(jt!==.5){const yr=jt-.5;jt+=jt*yr*(jt-1)*((1.0904+pe*(pe*(3.55645-1.43519*pe)-3.2452))*yr*yr+(.848013+pe*(.215638*pe-1.06021)))}const Si=ne.sub(Y)._mult(jt)._add(Y)._unit()._mult(Nt?-1:1);this.addHalfVertex($,Si.x,Si.y,!1,Nt,0,O)}}G&&this.addCurrentVertex($,ne,-Rt,-_t,O)}else if(bt==="butt")this.addCurrentVertex($,Ce,0,0,O);else if(bt==="square"){const ct=j?1:-1;this.addCurrentVertex($,Ce,ct,ct,O)}else bt==="round"&&(j&&(this.addCurrentVertex($,Y,0,0,O),this.addCurrentVertex($,Y,1,1,O,!0)),G&&(this.addCurrentVertex($,ne,-1,-1,O,!0),this.addCurrentVertex($,ne,0,0,O)));if(It&&he<T-1){const ct=$.dist(G);if(ct>2*L){const Rt=$.add(G.sub($)._mult(L/ct)._round());this.updateDistance($,Rt),this.addCurrentVertex(Rt,ne,0,0,O),$=Rt}}}}addCurrentVertex(t,s,c,f,v,x=!1){const w=s.y*f-s.x,T=-s.y-s.x*f;this.addHalfVertex(t,s.x+s.y*c,s.y-s.x*c,x,!1,c,v),this.addHalfVertex(t,w,T,x,!0,-f,v),this.distance>Ng/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,s,c,f,v,x))}addHalfVertex({x:t,y:s},c,f,v,x,w,T){const I=.5*(this.lineClips?this.scaledDistance*(Ng-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(v?1:0),(s<<1)+(x?1:0),Math.round(63*c)+128,Math.round(63*f)+128,1+(w===0?0:w<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const L=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,L),T.primitiveLength++),x?this.e2=L:this.e1=L}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,s){this.distance+=t.dist(s),this.updateScaledDistance()}}let $g,Ug;Ct("LineBucket",tf,{omit:["layers","patternFeatures"]});var Vg={get paint(){return Ug=Ug||new Yn({"line-opacity":new ei(ce.paint_line["line-opacity"]),"line-color":new ei(ce.paint_line["line-color"]),"line-translate":new Gt(ce.paint_line["line-translate"]),"line-translate-anchor":new Gt(ce.paint_line["line-translate-anchor"]),"line-width":new ei(ce.paint_line["line-width"]),"line-gap-width":new ei(ce.paint_line["line-gap-width"]),"line-offset":new ei(ce.paint_line["line-offset"]),"line-blur":new ei(ce.paint_line["line-blur"]),"line-dasharray":new ql(ce.paint_line["line-dasharray"]),"line-pattern":new Ec(ce.paint_line["line-pattern"]),"line-gradient":new Iu(ce.paint_line["line-gradient"])})},get layout(){return $g=$g||new Yn({"line-cap":new Gt(ce.layout_line["line-cap"]),"line-join":new ei(ce.layout_line["line-join"]),"line-miter-limit":new Gt(ce.layout_line["line-miter-limit"]),"line-round-limit":new Gt(ce.layout_line["line-round-limit"]),"line-sort-key":new ei(ce.layout_line["line-sort-key"])})}};class ib extends ei{possiblyEvaluate(t,s){return s=new xr(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,zoomHistory:s.zoomHistory,transition:s.transition}),super.possiblyEvaluate(t,s)}evaluate(t,s,c,f){return s=nt({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(t,s,c,f)}}let vd;class rb extends Zs{constructor(t){super(t,Vg),this.gradientVersion=0,vd||(vd=new ib(Vg.paint.properties["line-width"].specification),vd.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const s=this.gradientExpression();this.stepInterpolant=!!function(c){return c._styleExpression!==void 0}(s)&&s._styleExpression.expression instanceof $a,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,s){super.recalculate(t,s),this.paint._values["line-floorwidth"]=vd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new tf(t)}queryRadius(t){const s=t,c=jg(Vu("line-width",this,s),Vu("line-gap-width",this,s)),f=Vu("line-offset",this,s);return c/2+Math.abs(f)+dd(this.paint.get("line-translate"))}queryIntersectsFeature(t,s,c,f,v,x,w){const T=pd(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,w),I=w/2*jg(this.paint.get("line-width").evaluate(s,c),this.paint.get("line-gap-width").evaluate(s,c)),L=this.paint.get("line-offset").evaluate(s,c);return L&&(f=function(O,$){const j=[];for(let G=0;G<O.length;G++){const Y=O[G],ne=[];for(let he=0;he<Y.length;he++){const Ce=Y[he-1],pe=Y[he],be=Y[he+1],$e=he===0?new k(0,0):pe.sub(Ce)._unit()._perp(),He=he===Y.length-1?new k(0,0):be.sub(pe)._unit()._perp(),It=$e._add(He)._unit(),Nt=It.x*He.x+It.y*He.y;Nt!==0&&It._mult(1/Nt),ne.push(It._mult($)._add(pe))}j.push(ne)}return j}(f,L*w)),function(O,$,j){for(let G=0;G<$.length;G++){const Y=$[G];if(O.length>=3){for(let ne=0;ne<Y.length;ne++)if(zc(O,Y[ne]))return!0}if($u(O,Y,j))return!0}return!1}(T,f,I)}isTileClipped(){return!0}}function jg(n,t){return t>0?t+2*n:n}const nb=qr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),sb=qr([{name:"a_projected_pos",components:3,type:"Float32"}],4);qr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const ab=qr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);qr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const qg=qr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),ob=qr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function lb(n,t,s){return n.sections.forEach(c=>{c.text=function(f,v,x){const w=v.layout.get("text-transform").evaluate(x,{});return w==="uppercase"?f=f.toLocaleUpperCase():w==="lowercase"&&(f=f.toLocaleLowerCase()),Wa.applyArabicShaping&&(f=Wa.applyArabicShaping(f)),f}(c.text,t,s)}),n}qr([{name:"triangle",components:3,type:"Uint16"}]),qr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),qr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),qr([{type:"Float32",name:"offsetX"}]),qr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),qr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Yu={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var on=24,Gg=nr,Hg=function(n,t,s,c,f){var v,x,w=8*f-c-1,T=(1<<w)-1,I=T>>1,L=-7,O=s?f-1:0,$=s?-1:1,j=n[t+O];for(O+=$,v=j&(1<<-L)-1,j>>=-L,L+=w;L>0;v=256*v+n[t+O],O+=$,L-=8);for(x=v&(1<<-L)-1,v>>=-L,L+=c;L>0;x=256*x+n[t+O],O+=$,L-=8);if(v===0)v=1-I;else{if(v===T)return x?NaN:1/0*(j?-1:1);x+=Math.pow(2,c),v-=I}return(j?-1:1)*x*Math.pow(2,v-c)},Wg=function(n,t,s,c,f,v){var x,w,T,I=8*v-f-1,L=(1<<I)-1,O=L>>1,$=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,j=c?0:v-1,G=c?1:-1,Y=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(w=isNaN(t)?1:0,x=L):(x=Math.floor(Math.log(t)/Math.LN2),t*(T=Math.pow(2,-x))<1&&(x--,T*=2),(t+=x+O>=1?$/T:$*Math.pow(2,1-O))*T>=2&&(x++,T/=2),x+O>=L?(w=0,x=L):x+O>=1?(w=(t*T-1)*Math.pow(2,f),x+=O):(w=t*Math.pow(2,O-1)*Math.pow(2,f),x=0));f>=8;n[s+j]=255&w,j+=G,w/=256,f-=8);for(x=x<<f|w,I+=f;I>0;n[s+j]=255&x,j+=G,x/=256,I-=8);n[s+j-G]|=128*Y};function nr(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}nr.Varint=0,nr.Fixed64=1,nr.Bytes=2,nr.Fixed32=5;var rf=4294967296,Zg=1/rf,Xg=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function So(n){return n.type===nr.Bytes?n.readVarint()+n.pos:n.pos+1}function Nc(n,t,s){return s?4294967296*t+(n>>>0):4294967296*(t>>>0)+(n>>>0)}function Kg(n,t,s){var c=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));s.realloc(c);for(var f=s.pos-1;f>=n;f--)s.buf[f+c]=s.buf[f]}function cb(n,t){for(var s=0;s<n.length;s++)t.writeVarint(n[s])}function ub(n,t){for(var s=0;s<n.length;s++)t.writeSVarint(n[s])}function hb(n,t){for(var s=0;s<n.length;s++)t.writeFloat(n[s])}function db(n,t){for(var s=0;s<n.length;s++)t.writeDouble(n[s])}function pb(n,t){for(var s=0;s<n.length;s++)t.writeBoolean(n[s])}function fb(n,t){for(var s=0;s<n.length;s++)t.writeFixed32(n[s])}function mb(n,t){for(var s=0;s<n.length;s++)t.writeSFixed32(n[s])}function gb(n,t){for(var s=0;s<n.length;s++)t.writeFixed64(n[s])}function yb(n,t){for(var s=0;s<n.length;s++)t.writeSFixed64(n[s])}function xd(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+16777216*n[t+3]}function $c(n,t,s){n[s]=t,n[s+1]=t>>>8,n[s+2]=t>>>16,n[s+3]=t>>>24}function Yg(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+(n[t+3]<<24)}nr.prototype={destroy:function(){this.buf=null},readFields:function(n,t,s){for(s=s||this.length;this.pos<s;){var c=this.readVarint(),f=c>>3,v=this.pos;this.type=7&c,n(f,t,this),this.pos===v&&this.skip(c)}return t},readMessage:function(n,t){return this.readFields(n,t,this.readVarint()+this.pos)},readFixed32:function(){var n=xd(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=Yg(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=xd(this.buf,this.pos)+xd(this.buf,this.pos+4)*rf;return this.pos+=8,n},readSFixed64:function(){var n=xd(this.buf,this.pos)+Yg(this.buf,this.pos+4)*rf;return this.pos+=8,n},readFloat:function(){var n=Hg(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=Hg(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var t,s,c=this.buf;return t=127&(s=c[this.pos++]),s<128?t:(t|=(127&(s=c[this.pos++]))<<7,s<128?t:(t|=(127&(s=c[this.pos++]))<<14,s<128?t:(t|=(127&(s=c[this.pos++]))<<21,s<128?t:function(f,v,x){var w,T,I=x.buf;if(w=(112&(T=I[x.pos++]))>>4,T<128||(w|=(127&(T=I[x.pos++]))<<3,T<128)||(w|=(127&(T=I[x.pos++]))<<10,T<128)||(w|=(127&(T=I[x.pos++]))<<17,T<128)||(w|=(127&(T=I[x.pos++]))<<24,T<128)||(w|=(1&(T=I[x.pos++]))<<31,T<128))return Nc(f,w,v);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(s=c[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,t=this.pos;return this.pos=n,n-t>=12&&Xg?function(s,c,f){return Xg.decode(s.subarray(c,f))}(this.buf,t,n):function(s,c,f){for(var v="",x=c;x<f;){var w,T,I,L=s[x],O=null,$=L>239?4:L>223?3:L>191?2:1;if(x+$>f)break;$===1?L<128&&(O=L):$===2?(192&(w=s[x+1]))==128&&(O=(31&L)<<6|63&w)<=127&&(O=null):$===3?(T=s[x+2],(192&(w=s[x+1]))==128&&(192&T)==128&&((O=(15&L)<<12|(63&w)<<6|63&T)<=2047||O>=55296&&O<=57343)&&(O=null)):$===4&&(T=s[x+2],I=s[x+3],(192&(w=s[x+1]))==128&&(192&T)==128&&(192&I)==128&&((O=(15&L)<<18|(63&w)<<12|(63&T)<<6|63&I)<=65535||O>=1114112)&&(O=null)),O===null?(O=65533,$=1):O>65535&&(O-=65536,v+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),v+=String.fromCharCode(O),x+=$}return v}(this.buf,t,n)},readBytes:function(){var n=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,n);return this.pos=n,t},readPackedVarint:function(n,t){if(this.type!==nr.Bytes)return n.push(this.readVarint(t));var s=So(this);for(n=n||[];this.pos<s;)n.push(this.readVarint(t));return n},readPackedSVarint:function(n){if(this.type!==nr.Bytes)return n.push(this.readSVarint());var t=So(this);for(n=n||[];this.pos<t;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==nr.Bytes)return n.push(this.readBoolean());var t=So(this);for(n=n||[];this.pos<t;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==nr.Bytes)return n.push(this.readFloat());var t=So(this);for(n=n||[];this.pos<t;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==nr.Bytes)return n.push(this.readDouble());var t=So(this);for(n=n||[];this.pos<t;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==nr.Bytes)return n.push(this.readFixed32());var t=So(this);for(n=n||[];this.pos<t;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==nr.Bytes)return n.push(this.readSFixed32());var t=So(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==nr.Bytes)return n.push(this.readFixed64());var t=So(this);for(n=n||[];this.pos<t;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==nr.Bytes)return n.push(this.readSFixed64());var t=So(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed64());return n},skip:function(n){var t=7&n;if(t===nr.Varint)for(;this.buf[this.pos++]>127;);else if(t===nr.Bytes)this.pos=this.readVarint()+this.pos;else if(t===nr.Fixed32)this.pos+=4;else{if(t!==nr.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(n,t){this.writeVarint(n<<3|t)},realloc:function(n){for(var t=this.length||16;t<this.pos+n;)t*=2;if(t!==this.length){var s=new Uint8Array(t);s.set(this.buf),this.buf=s,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),$c(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),$c(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),$c(this.buf,-1&n,this.pos),$c(this.buf,Math.floor(n*Zg),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),$c(this.buf,-1&n,this.pos),$c(this.buf,Math.floor(n*Zg),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(t,s){var c,f;if(t>=0?(c=t%4294967296|0,f=t/4294967296|0):(f=~(-t/4294967296),4294967295^(c=~(-t%4294967296))?c=c+1|0:(c=0,f=f+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(v,x,w){w.buf[w.pos++]=127&v|128,v>>>=7,w.buf[w.pos++]=127&v|128,v>>>=7,w.buf[w.pos++]=127&v|128,v>>>=7,w.buf[w.pos++]=127&v|128,w.buf[w.pos]=127&(v>>>=7)}(c,0,s),function(v,x){var w=(7&v)<<4;x.buf[x.pos++]|=w|((v>>>=3)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v)))))}(f,s)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var t=this.pos;this.pos=function(c,f,v){for(var x,w,T=0;T<f.length;T++){if((x=f.charCodeAt(T))>55295&&x<57344){if(!w){x>56319||T+1===f.length?(c[v++]=239,c[v++]=191,c[v++]=189):w=x;continue}if(x<56320){c[v++]=239,c[v++]=191,c[v++]=189,w=x;continue}x=w-55296<<10|x-56320|65536,w=null}else w&&(c[v++]=239,c[v++]=191,c[v++]=189,w=null);x<128?c[v++]=x:(x<2048?c[v++]=x>>6|192:(x<65536?c[v++]=x>>12|224:(c[v++]=x>>18|240,c[v++]=x>>12&63|128),c[v++]=x>>6&63|128),c[v++]=63&x|128)}return v}(this.buf,n,this.pos);var s=this.pos-t;s>=128&&Kg(t,s,this),this.pos=t-1,this.writeVarint(s),this.pos+=s},writeFloat:function(n){this.realloc(4),Wg(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),Wg(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var t=n.length;this.writeVarint(t),this.realloc(t);for(var s=0;s<t;s++)this.buf[this.pos++]=n[s]},writeRawMessage:function(n,t){this.pos++;var s=this.pos;n(t,this);var c=this.pos-s;c>=128&&Kg(s,c,this),this.pos=s-1,this.writeVarint(c),this.pos+=c},writeMessage:function(n,t,s){this.writeTag(n,nr.Bytes),this.writeRawMessage(t,s)},writePackedVarint:function(n,t){t.length&&this.writeMessage(n,cb,t)},writePackedSVarint:function(n,t){t.length&&this.writeMessage(n,ub,t)},writePackedBoolean:function(n,t){t.length&&this.writeMessage(n,pb,t)},writePackedFloat:function(n,t){t.length&&this.writeMessage(n,hb,t)},writePackedDouble:function(n,t){t.length&&this.writeMessage(n,db,t)},writePackedFixed32:function(n,t){t.length&&this.writeMessage(n,fb,t)},writePackedSFixed32:function(n,t){t.length&&this.writeMessage(n,mb,t)},writePackedFixed64:function(n,t){t.length&&this.writeMessage(n,gb,t)},writePackedSFixed64:function(n,t){t.length&&this.writeMessage(n,yb,t)},writeBytesField:function(n,t){this.writeTag(n,nr.Bytes),this.writeBytes(t)},writeFixed32Field:function(n,t){this.writeTag(n,nr.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(n,t){this.writeTag(n,nr.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(n,t){this.writeTag(n,nr.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(n,t){this.writeTag(n,nr.Fixed64),this.writeSFixed64(t)},writeVarintField:function(n,t){this.writeTag(n,nr.Varint),this.writeVarint(t)},writeSVarintField:function(n,t){this.writeTag(n,nr.Varint),this.writeSVarint(t)},writeStringField:function(n,t){this.writeTag(n,nr.Bytes),this.writeString(t)},writeFloatField:function(n,t){this.writeTag(n,nr.Fixed32),this.writeFloat(t)},writeDoubleField:function(n,t){this.writeTag(n,nr.Fixed64),this.writeDouble(t)},writeBooleanField:function(n,t){this.writeVarintField(n,!!t)}};var nf=M(Gg);const sf=3;function _b(n,t,s){n===1&&s.readMessage(vb,t)}function vb(n,t,s){if(n===3){const{id:c,bitmap:f,width:v,height:x,left:w,top:T,advance:I}=s.readMessage(xb,{});t.push({id:c,bitmap:new qu({width:v+2*sf,height:x+2*sf},f),metrics:{width:v,height:x,left:w,top:T,advance:I}})}}function xb(n,t,s){n===1?t.id=s.readVarint():n===2?t.bitmap=s.readBytes():n===3?t.width=s.readVarint():n===4?t.height=s.readVarint():n===5?t.left=s.readSVarint():n===6?t.top=s.readSVarint():n===7&&(t.advance=s.readVarint())}const Jg=sf;function Qg(n){let t=0,s=0;for(const x of n)t+=x.w*x.h,s=Math.max(s,x.w);n.sort((x,w)=>w.h-x.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),s),h:1/0}];let f=0,v=0;for(const x of n)for(let w=c.length-1;w>=0;w--){const T=c[w];if(!(x.w>T.w||x.h>T.h)){if(x.x=T.x,x.y=T.y,v=Math.max(v,x.y+x.h),f=Math.max(f,x.x+x.w),x.w===T.w&&x.h===T.h){const I=c.pop();w<c.length&&(c[w]=I)}else x.h===T.h?(T.x+=x.w,T.w-=x.w):x.w===T.w?(T.y+=x.h,T.h-=x.h):(c.push({x:T.x+x.w,y:T.y,w:T.w-x.w,h:x.h}),T.y+=x.h,T.h-=x.h);break}}return{w:f,h:v,fill:t/(f*v)||0}}const ps=1;class af{constructor(t,{pixelRatio:s,version:c,stretchX:f,stretchY:v,content:x}){this.paddedRect=t,this.pixelRatio=s,this.stretchX=f,this.stretchY=v,this.content=x,this.version=c}get tl(){return[this.paddedRect.x+ps,this.paddedRect.y+ps]}get br(){return[this.paddedRect.x+this.paddedRect.w-ps,this.paddedRect.y+this.paddedRect.h-ps]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*ps)/this.pixelRatio,(this.paddedRect.h-2*ps)/this.pixelRatio]}}class ey{constructor(t,s){const c={},f={};this.haveRenderCallbacks=[];const v=[];this.addImages(t,c,v),this.addImages(s,f,v);const{w:x,h:w}=Qg(v),T=new Xs({width:x||1,height:w||1});for(const I in t){const L=t[I],O=c[I].paddedRect;Xs.copy(L.data,T,{x:0,y:0},{x:O.x+ps,y:O.y+ps},L.data)}for(const I in s){const L=s[I],O=f[I].paddedRect,$=O.x+ps,j=O.y+ps,G=L.data.width,Y=L.data.height;Xs.copy(L.data,T,{x:0,y:0},{x:$,y:j},L.data),Xs.copy(L.data,T,{x:0,y:Y-1},{x:$,y:j-1},{width:G,height:1}),Xs.copy(L.data,T,{x:0,y:0},{x:$,y:j+Y},{width:G,height:1}),Xs.copy(L.data,T,{x:G-1,y:0},{x:$-1,y:j},{width:1,height:Y}),Xs.copy(L.data,T,{x:0,y:0},{x:$+G,y:j},{width:1,height:Y})}this.image=T,this.iconPositions=c,this.patternPositions=f}addImages(t,s,c){for(const f in t){const v=t[f],x={x:0,y:0,w:v.data.width+2*ps,h:v.data.height+2*ps};c.push(x),s[f]=new af(x,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(t,s){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in t.updatedImages)this.patchUpdatedImage(this.iconPositions[c],t.getImage(c),s),this.patchUpdatedImage(this.patternPositions[c],t.getImage(c),s)}patchUpdatedImage(t,s,c){if(!t||!s||t.version===s.version)return;t.version=s.version;const[f,v]=t.tl;c.update(s.data,void 0,{x:f,y:v})}}var sl;Ct("ImagePosition",af),Ct("ImageAtlas",ey),m.ah=void 0,(sl=m.ah||(m.ah={}))[sl.none=0]="none",sl[sl.horizontal=1]="horizontal",sl[sl.vertical=2]="vertical",sl[sl.horizontalOnly=3]="horizontalOnly";const Ju=-17;class Qu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,s){const c=new Qu;return c.scale=t||1,c.fontStack=s,c}static forImage(t){const s=new Qu;return s.imageName=t,s}}class Uc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,s){const c=new Uc;for(let f=0;f<t.sections.length;f++){const v=t.sections[f];v.image?c.addImageSection(v):c.addTextSection(v,s)}return c}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let s="";for(let c=0;c<t.length;c++){const f=t.charCodeAt(c+1)||null,v=t.charCodeAt(c-1)||null;s+=f&&Ha(f)&&!Yu[t[c+1]]||v&&Ha(v)&&!Yu[t[c-1]]||!Yu[t[c]]?t[c]:Yu[t[c]]}return s}(this.text)}trim(){let t=0;for(let c=0;c<this.text.length&&wd[this.text.charCodeAt(c)];c++)t++;let s=this.text.length;for(let c=this.text.length-1;c>=0&&c>=t&&wd[this.text.charCodeAt(c)];c--)s--;this.text=this.text.substring(t,s),this.sectionIndex=this.sectionIndex.slice(t,s)}substring(t,s){const c=new Uc;return c.text=this.text.substring(t,s),c.sectionIndex=this.sectionIndex.slice(t,s),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,s)=>Math.max(t,this.sections[s].scale),0)}addTextSection(t,s){this.text+=t.text,this.sections.push(Qu.forText(t.scale,t.fontStack||s));const c=this.sections.length-1;for(let f=0;f<t.text.length;++f)this.sectionIndex.push(c)}addImageSection(t){const s=t.image?t.image.name:"";if(s.length===0)return void Ei("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Qu.forImage(s)),this.sectionIndex.push(this.sections.length-1)):Ei("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function bd(n,t,s,c,f,v,x,w,T,I,L,O,$,j,G,Y){const ne=Uc.fromFeature(n,f);let he;O===m.ah.vertical&&ne.verticalizePunctuation();const{processBidirectionalText:Ce,processStyledBidirectionalText:pe}=Wa;if(Ce&&ne.sections.length===1){he=[];const He=Ce(ne.toString(),of(ne,I,v,t,c,j,G));for(const It of He){const Nt=new Uc;Nt.text=It,Nt.sections=ne.sections;for(let Et=0;Et<It.length;Et++)Nt.sectionIndex.push(0);he.push(Nt)}}else if(pe){he=[];const He=pe(ne.text,ne.sectionIndex,of(ne,I,v,t,c,j,G));for(const It of He){const Nt=new Uc;Nt.text=It[0],Nt.sectionIndex=It[1],Nt.sections=ne.sections,he.push(Nt)}}else he=function(He,It){const Nt=[],Et=He.text;let bt=0;for(const ct of It)Nt.push(He.substring(bt,ct)),bt=ct;return bt<Et.length&&Nt.push(He.substring(bt,Et.length)),Nt}(ne,of(ne,I,v,t,c,j,G));const be=[],$e={positionedLines:be,text:ne.toString(),top:L[1],bottom:L[1],left:L[0],right:L[0],writingMode:O,iconsInText:!1,verticalizable:!1};return function(He,It,Nt,Et,bt,ct,Rt,_t,tt,Qt,jt,Si){let yr=0,wr=Ju,ln=0,Ps=0;const Qn=_t==="right"?1:_t==="left"?0:.5;let Jr=0;for(const cn of bt){cn.trim();const un=cn.getMaxScale(),Nn=(un-1)*on,is={positionedGlyphs:[],lineOffset:0};He.positionedLines[Jr]=is;const $n=is.positionedGlyphs;let fs=0;if(!cn.length()){wr+=ct,++Jr;continue}for(let hn=0;hn<cn.length();hn++){const Pi=cn.getSection(hn),Un=cn.getSectionIndex(hn),Rn=cn.getCharCode(hn);let dn=0,ua=null,Pa=null,ka=null,Eo=on;const ha=!(tt===m.ah.horizontal||!jt&&!vo(Rn)||jt&&(wd[Rn]||(In=Rn,vt.Arabic(In)||vt["Arabic Supplement"](In)||vt["Arabic Extended-A"](In)||vt["Arabic Presentation Forms-A"](In)||vt["Arabic Presentation Forms-B"](In))));if(Pi.imageName){const Ys=Et[Pi.imageName];if(!Ys)continue;ka=Pi.imageName,He.iconsInText=He.iconsInText||!0,Pa=Ys.paddedRect;const gs=Ys.displaySize;Pi.scale=Pi.scale*on/Si,ua={width:gs[0],height:gs[1],left:ps,top:-Jg,advance:ha?gs[1]:gs[0]},dn=Nn+(on-gs[1]*Pi.scale),Eo=ua.advance;const To=ha?gs[0]*Pi.scale-on*un:gs[1]*Pi.scale-on*un;To>0&&To>fs&&(fs=To)}else{const Ys=Nt[Pi.fontStack],gs=Ys&&Ys[Rn];if(gs&&gs.rect)Pa=gs.rect,ua=gs.metrics;else{const To=It[Pi.fontStack],nh=To&&To[Rn];if(!nh)continue;ua=nh.metrics}dn=(un-Pi.scale)*on}ha?(He.verticalizable=!0,$n.push({glyph:Rn,imageName:ka,x:yr,y:wr+dn,vertical:ha,scale:Pi.scale,fontStack:Pi.fontStack,sectionIndex:Un,metrics:ua,rect:Pa}),yr+=Eo*Pi.scale+Qt):($n.push({glyph:Rn,imageName:ka,x:yr,y:wr+dn,vertical:ha,scale:Pi.scale,fontStack:Pi.fontStack,sectionIndex:Un,metrics:ua,rect:Pa}),yr+=ua.advance*Pi.scale+Qt)}$n.length!==0&&(ln=Math.max(yr-Qt,ln),Mb($n,0,$n.length-1,Qn,fs)),yr=0;const ms=ct*un+fs;is.lineOffset=Math.max(fs,Nn),wr+=ms,Ps=Math.max(ms,Ps),++Jr}var In;const Ln=wr-Ju,{horizontalAlign:es,verticalAlign:ts}=lf(Rt);(function(cn,un,Nn,is,$n,fs,ms,hn,Pi){const Un=(un-Nn)*$n;let Rn=0;Rn=fs!==ms?-hn*is-Ju:(-is*Pi+.5)*ms;for(const dn of cn)for(const ua of dn.positionedGlyphs)ua.x+=Un,ua.y+=Rn})(He.positionedLines,Qn,es,ts,ln,Ps,ct,Ln,bt.length),He.top+=-ts*Ln,He.bottom=He.top+Ln,He.left+=-es*ln,He.right=He.left+ln}($e,t,s,c,he,x,w,T,O,I,$,Y),!function(He){for(const It of He)if(It.positionedGlyphs.length!==0)return!1;return!0}(be)&&$e}const wd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},bb={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function ty(n,t,s,c,f,v){if(t.imageName){const x=c[t.imageName];return x?x.displaySize[0]*t.scale*on/v+f:0}{const x=s[t.fontStack],w=x&&x[n];return w?w.metrics.advance*t.scale+f:0}}function iy(n,t,s,c){const f=Math.pow(n-t,2);return c?n<t?f/2:2*f:f+Math.abs(s)*s}function wb(n,t,s){let c=0;return n===10&&(c-=1e4),s&&(c+=150),n!==40&&n!==65288||(c+=50),t!==41&&t!==65289||(c+=50),c}function ry(n,t,s,c,f,v){let x=null,w=iy(t,s,f,v);for(const T of c){const I=iy(t-T.x,s,f,v)+T.badness;I<=w&&(x=T,w=I)}return{index:n,x:t,priorBreak:x,badness:w}}function ny(n){return n?ny(n.priorBreak).concat(n.index):[]}function of(n,t,s,c,f,v,x){if(v!=="point")return[];if(!n)return[];const w=[],T=function($,j,G,Y,ne,he){let Ce=0;for(let pe=0;pe<$.length();pe++){const be=$.getSection(pe);Ce+=ty($.getCharCode(pe),be,Y,ne,j,he)}return Ce/Math.max(1,Math.ceil(Ce/G))}(n,t,s,c,f,x),I=n.text.indexOf("​")>=0;let L=0;for(let $=0;$<n.length();$++){const j=n.getSection($),G=n.getCharCode($);if(wd[G]||(L+=ty(G,j,c,f,t,x)),$<n.length()-1){const Y=!((O=G)<11904||!(vt["Bopomofo Extended"](O)||vt.Bopomofo(O)||vt["CJK Compatibility Forms"](O)||vt["CJK Compatibility Ideographs"](O)||vt["CJK Compatibility"](O)||vt["CJK Radicals Supplement"](O)||vt["CJK Strokes"](O)||vt["CJK Symbols and Punctuation"](O)||vt["CJK Unified Ideographs Extension A"](O)||vt["CJK Unified Ideographs"](O)||vt["Enclosed CJK Letters and Months"](O)||vt["Halfwidth and Fullwidth Forms"](O)||vt.Hiragana(O)||vt["Ideographic Description Characters"](O)||vt["Kangxi Radicals"](O)||vt["Katakana Phonetic Extensions"](O)||vt.Katakana(O)||vt["Vertical Forms"](O)||vt["Yi Radicals"](O)||vt["Yi Syllables"](O)));(bb[G]||Y||j.imageName)&&w.push(ry($+1,L,T,w,wb(G,n.getCharCode($+1),Y&&I),!1))}}var O;return ny(ry(n.length(),L,T,w,0,!0))}function lf(n){let t=.5,s=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:t,verticalAlign:s}}function Mb(n,t,s,c,f){if(!c&&!f)return;const v=n[s],x=(n[s].x+v.metrics.advance*v.scale)*c;for(let w=t;w<=s;w++)n[w].x-=x,n[w].y+=f}function Sb(n,t,s){const{horizontalAlign:c,verticalAlign:f}=lf(s),v=t[0]-n.displaySize[0]*c,x=t[1]-n.displaySize[1]*f;return{image:n,top:x,bottom:x+n.displaySize[1],left:v,right:v+n.displaySize[0]}}function sy(n,t,s,c,f,v){const x=n.image;let w;if(x.content){const ne=x.content,he=x.pixelRatio||1;w=[ne[0]/he,ne[1]/he,x.displaySize[0]-ne[2]/he,x.displaySize[1]-ne[3]/he]}const T=t.left*v,I=t.right*v;let L,O,$,j;s==="width"||s==="both"?(j=f[0]+T-c[3],O=f[0]+I+c[1]):(j=f[0]+(T+I-x.displaySize[0])/2,O=j+x.displaySize[0]);const G=t.top*v,Y=t.bottom*v;return s==="height"||s==="both"?(L=f[1]+G-c[0],$=f[1]+Y+c[2]):(L=f[1]+(G+Y-x.displaySize[1])/2,$=L+x.displaySize[1]),{image:x,top:L,right:O,bottom:$,left:j,collisionPadding:w}}const eh=255,Ya=128,al=eh*Ya;function ay(n,t){const{expression:s}=t;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new xr(n+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:f}=s;let v=0;for(;v<c.length&&c[v]<=n;)v++;v=Math.max(0,v-1);let x=v;for(;x<c.length&&c[x]<n+1;)x++;x=Math.min(c.length-1,x);const w=c[v],T=c[x];return s.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:T,interpolationType:f}:{kind:"camera",minZoom:w,maxZoom:T,minSize:s.evaluate(new xr(w)),maxSize:s.evaluate(new xr(T)),interpolationType:f}}}function cf(n,t,s){let c="never";const f=n.get(t);return f?c=f:n.get(s)&&(c="always"),c}const Eb=nl.VectorTileFeature.types,Tb=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Md(n,t,s,c,f,v,x,w,T,I,L,O,$){const j=w?Math.min(al,Math.round(w[0])):0,G=w?Math.min(al,Math.round(w[1])):0;n.emplaceBack(t,s,Math.round(32*c),Math.round(32*f),v,x,(j<<1)+(T?1:0),G,16*I,16*L,256*O,256*$)}function uf(n,t,s){n.emplaceBack(t.x,t.y,s),n.emplaceBack(t.x,t.y,s),n.emplaceBack(t.x,t.y,s),n.emplaceBack(t.x,t.y,s)}function Cb(n){for(const t of n.sections)if($p(t.text))return!0;return!1}class hf{constructor(t){this.layoutVertexArray=new Pe,this.indexArray=new Oe,this.programConfigurations=t,this.segments=new ht,this.dynamicLayoutVertexArray=new le,this.opacityVertexArray=new Me,this.hasVisibleVertices=!1,this.placedSymbolArray=new o}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,s,c,f){this.isEmpty()||(c&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,nb.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,sb.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Tb,!0),this.opacityVertexBuffer.itemSize=1),(c||f)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ct("SymbolBuffers",hf);class df{constructor(t,s,c){this.layoutVertexArray=new t,this.layoutAttributes=s,this.indexArray=new c,this.segments=new ht,this.collisionVertexArray=new Le}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,ab.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ct("CollisionBuffers",df);class Vc{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(x=>x.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Vp([]),this.placementViewportMatrix=Vp([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ay(this.zoom,s["text-size"]),this.iconSizeData=ay(this.zoom,s["icon-size"]);const c=this.layers[0].layout,f=c.get("symbol-sort-key"),v=c.get("symbol-z-order");this.canOverlap=cf(c,"text-overlap","text-allow-overlap")!=="never"||cf(c,"icon-overlap","icon-allow-overlap")!=="never"||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&!f.isConstant(),this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,c.get("symbol-placement")==="point"&&(this.writingModes=c.get("text-writing-mode").map(x=>m.ah[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=t.sourceID}createArrays(){this.text=new hf(new Pr(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new hf(new Pr(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new _,this.lineVertexArray=new S,this.symbolInstances=new p,this.textAnchorOffsets=new C}calculateGlyphDependencies(t,s,c,f,v){for(let x=0;x<t.length;x++)if(s[t.charCodeAt(x)]=!0,(c||f)&&v){const w=Yu[t.charAt(x)];w&&(s[w.charCodeAt(0)]=!0)}}populate(t,s,c){const f=this.layers[0],v=f.layout,x=v.get("text-font"),w=v.get("text-field"),T=v.get("icon-image"),I=(w.value.kind!=="constant"||w.value.value instanceof kn&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),L=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,O=v.get("symbol-sort-key");if(this.features=[],!I&&!L)return;const $=s.iconDependencies,j=s.glyphDependencies,G=s.availableImages,Y=new xr(this.zoom);for(const{feature:ne,id:he,index:Ce,sourceLayerIndex:pe}of t){const be=f._featureFilter.needGeometry,$e=Mo(ne,be);if(!f._featureFilter.filter(Y,$e,c))continue;let He,It;if(be||($e.geometry=wo(ne)),I){const Et=f.getValueAndResolveTokens("text-field",$e,c,G),bt=kn.factory(Et),ct=this.hasRTLText=this.hasRTLText||Cb(bt);(!ct||Wa.getRTLTextPluginStatus()==="unavailable"||ct&&Wa.isParsed())&&(He=lb(bt,f,$e))}if(L){const Et=f.getValueAndResolveTokens("icon-image",$e,c,G);It=Et instanceof Mn?Et:Mn.fromString(Et)}if(!He&&!It)continue;const Nt=this.sortFeaturesByKey?O.evaluate($e,{},c):void 0;if(this.features.push({id:he,text:He,icon:It,index:Ce,sourceLayerIndex:pe,geometry:$e.geometry,properties:ne.properties,type:Eb[ne.type],sortKey:Nt}),It&&($[It.name]=!0),He){const Et=x.evaluate($e,{},c).join(","),bt=v.get("text-rotation-alignment")!=="viewport"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(m.ah.vertical)>=0;for(const ct of He.sections)if(ct.image)$[ct.image.name]=!0;else{const Rt=oa(He.toString()),_t=ct.fontStack||Et,tt=j[_t]=j[_t]||{};this.calculateGlyphDependencies(ct.text,tt,bt,this.allowVerticalPlacement,Rt)}}}v.get("symbol-placement")==="line"&&(this.features=function(ne){const he={},Ce={},pe=[];let be=0;function $e(Et){pe.push(ne[Et]),be++}function He(Et,bt,ct){const Rt=Ce[Et];return delete Ce[Et],Ce[bt]=Rt,pe[Rt].geometry[0].pop(),pe[Rt].geometry[0]=pe[Rt].geometry[0].concat(ct[0]),Rt}function It(Et,bt,ct){const Rt=he[bt];return delete he[bt],he[Et]=Rt,pe[Rt].geometry[0].shift(),pe[Rt].geometry[0]=ct[0].concat(pe[Rt].geometry[0]),Rt}function Nt(Et,bt,ct){const Rt=ct?bt[0][bt[0].length-1]:bt[0][0];return`${Et}:${Rt.x}:${Rt.y}`}for(let Et=0;Et<ne.length;Et++){const bt=ne[Et],ct=bt.geometry,Rt=bt.text?bt.text.toString():null;if(!Rt){$e(Et);continue}const _t=Nt(Rt,ct),tt=Nt(Rt,ct,!0);if(_t in Ce&&tt in he&&Ce[_t]!==he[tt]){const Qt=It(_t,tt,ct),jt=He(_t,tt,pe[Qt].geometry);delete he[_t],delete Ce[tt],Ce[Nt(Rt,pe[jt].geometry,!0)]=jt,pe[Qt].geometry=null}else _t in Ce?He(_t,tt,ct):tt in he?It(_t,tt,ct):($e(Et),he[_t]=be-1,Ce[tt]=be-1)}return pe.filter(Et=>Et.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ne,he)=>ne.sortKey-he.sortKey)}update(t,s,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,s,this.layers,c),this.icon.programConfigurations.updatePaintArrays(t,s,this.layers,c))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,s){const c=this.lineVertexArray.length;if(t.segment!==void 0){let f=t.dist(s[t.segment+1]),v=t.dist(s[t.segment]);const x={};for(let w=t.segment+1;w<s.length;w++)x[w]={x:s[w].x,y:s[w].y,tileUnitDistanceFromAnchor:f},w<s.length-1&&(f+=s[w+1].dist(s[w]));for(let w=t.segment||0;w>=0;w--)x[w]={x:s[w].x,y:s[w].y,tileUnitDistanceFromAnchor:v},w>0&&(v+=s[w-1].dist(s[w]));for(let w=0;w<s.length;w++){const T=x[w];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(t,s,c,f,v,x,w,T,I,L,O,$){const j=t.indexArray,G=t.layoutVertexArray,Y=t.segments.prepareSegment(4*s.length,G,j,this.canOverlap?x.sortKey:void 0),ne=this.glyphOffsetArray.length,he=Y.vertexLength,Ce=this.allowVerticalPlacement&&w===m.ah.vertical?Math.PI/2:0,pe=x.text&&x.text.sections;for(let be=0;be<s.length;be++){const{tl:$e,tr:He,bl:It,br:Nt,tex:Et,pixelOffsetTL:bt,pixelOffsetBR:ct,minFontScaleX:Rt,minFontScaleY:_t,glyphOffset:tt,isSDF:Qt,sectionIndex:jt}=s[be],Si=Y.vertexLength,yr=tt[1];Md(G,T.x,T.y,$e.x,yr+$e.y,Et.x,Et.y,c,Qt,bt.x,bt.y,Rt,_t),Md(G,T.x,T.y,He.x,yr+He.y,Et.x+Et.w,Et.y,c,Qt,ct.x,bt.y,Rt,_t),Md(G,T.x,T.y,It.x,yr+It.y,Et.x,Et.y+Et.h,c,Qt,bt.x,ct.y,Rt,_t),Md(G,T.x,T.y,Nt.x,yr+Nt.y,Et.x+Et.w,Et.y+Et.h,c,Qt,ct.x,ct.y,Rt,_t),uf(t.dynamicLayoutVertexArray,T,Ce),j.emplaceBack(Si,Si+1,Si+2),j.emplaceBack(Si+1,Si+2,Si+3),Y.vertexLength+=4,Y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(tt[0]),be!==s.length-1&&jt===s[be+1].sectionIndex||t.programConfigurations.populatePaintArrays(G.length,x,x.index,{},$,pe&&pe[jt])}t.placedSymbolArray.emplaceBack(T.x,T.y,ne,this.glyphOffsetArray.length-ne,he,I,L,T.segment,c?c[0]:0,c?c[1]:0,f[0],f[1],w,0,!1,0,O)}_addCollisionDebugVertex(t,s,c,f,v,x){return s.emplaceBack(0,0),t.emplaceBack(c.x,c.y,f,v,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(t,s,c,f,v,x,w){const T=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),I=T.vertexLength,L=v.layoutVertexArray,O=v.collisionVertexArray,$=w.anchorX,j=w.anchorY;this._addCollisionDebugVertex(L,O,x,$,j,new k(t,s)),this._addCollisionDebugVertex(L,O,x,$,j,new k(c,s)),this._addCollisionDebugVertex(L,O,x,$,j,new k(c,f)),this._addCollisionDebugVertex(L,O,x,$,j,new k(t,f)),T.vertexLength+=4;const G=v.indexArray;G.emplaceBack(I,I+1),G.emplaceBack(I+1,I+2),G.emplaceBack(I+2,I+3),G.emplaceBack(I+3,I),T.primitiveLength+=4}addDebugCollisionBoxes(t,s,c,f){for(let v=t;v<s;v++){const x=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,f?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,c)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new df(ke,qg.members,Ke),this.iconCollisionBox=new df(ke,qg.members,Ke);for(let t=0;t<this.symbolInstances.length;t++){const s=this.symbolInstances.get(t);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}}_deserializeCollisionBoxesForSymbol(t,s,c,f,v,x,w,T,I){const L={};for(let O=s;O<c;O++){const $=t.get(O);L.textBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},L.textFeatureIndex=$.featureIndex;break}for(let O=f;O<v;O++){const $=t.get(O);L.verticalTextBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},L.verticalTextFeatureIndex=$.featureIndex;break}for(let O=x;O<w;O++){const $=t.get(O);L.iconBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},L.iconFeatureIndex=$.featureIndex;break}for(let O=T;O<I;O++){const $=t.get(O);L.verticalIconBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},L.verticalIconFeatureIndex=$.featureIndex;break}return L}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const c=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,s){const c=t.placedSymbolArray.get(s),f=c.vertexStartIndex+4*c.numGlyphs;for(let v=c.vertexStartIndex;v<f;v+=4)t.indexArray.emplaceBack(v,v+1,v+2),t.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(t),c=Math.cos(t),f=[],v=[],x=[];for(let w=0;w<this.symbolInstances.length;++w){x.push(w);const T=this.symbolInstances.get(w);f.push(0|Math.round(s*T.anchorX+c*T.anchorY)),v.push(T.featureIndex)}return x.sort((w,T)=>f[w]-f[T]||v[T]-v[w]),x}addToSortKeyRanges(t,s){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===s?c.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const c=this.symbolInstances.get(s);this.featureSortOrder.push(c.featureIndex),[c.rightJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.leftJustifiedTextSymbolIndex].forEach((f,v,x)=>{f>=0&&x.indexOf(f)===v&&this.addIndicesForPlacedSymbol(this.text,f)}),c.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,c.verticalPlacedTextSymbolIndex),c.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.placedIconSymbolIndex),c.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let oy,ly;Ct("SymbolBucket",Vc,{omit:["layers","collisionBoxArray","features","compareText"]}),Vc.MAX_GLYPHS=65535,Vc.addDynamicAttributes=uf;var pf={get paint(){return ly=ly||new Yn({"icon-opacity":new ei(ce.paint_symbol["icon-opacity"]),"icon-color":new ei(ce.paint_symbol["icon-color"]),"icon-halo-color":new ei(ce.paint_symbol["icon-halo-color"]),"icon-halo-width":new ei(ce.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ei(ce.paint_symbol["icon-halo-blur"]),"icon-translate":new Gt(ce.paint_symbol["icon-translate"]),"icon-translate-anchor":new Gt(ce.paint_symbol["icon-translate-anchor"]),"text-opacity":new ei(ce.paint_symbol["text-opacity"]),"text-color":new ei(ce.paint_symbol["text-color"],{runtimeType:qi,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new ei(ce.paint_symbol["text-halo-color"]),"text-halo-width":new ei(ce.paint_symbol["text-halo-width"]),"text-halo-blur":new ei(ce.paint_symbol["text-halo-blur"]),"text-translate":new Gt(ce.paint_symbol["text-translate"]),"text-translate-anchor":new Gt(ce.paint_symbol["text-translate-anchor"])})},get layout(){return oy=oy||new Yn({"symbol-placement":new Gt(ce.layout_symbol["symbol-placement"]),"symbol-spacing":new Gt(ce.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Gt(ce.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ei(ce.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Gt(ce.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Gt(ce.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Gt(ce.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Gt(ce.layout_symbol["icon-ignore-placement"]),"icon-optional":new Gt(ce.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Gt(ce.layout_symbol["icon-rotation-alignment"]),"icon-size":new ei(ce.layout_symbol["icon-size"]),"icon-text-fit":new Gt(ce.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Gt(ce.layout_symbol["icon-text-fit-padding"]),"icon-image":new ei(ce.layout_symbol["icon-image"]),"icon-rotate":new ei(ce.layout_symbol["icon-rotate"]),"icon-padding":new ei(ce.layout_symbol["icon-padding"]),"icon-keep-upright":new Gt(ce.layout_symbol["icon-keep-upright"]),"icon-offset":new ei(ce.layout_symbol["icon-offset"]),"icon-anchor":new ei(ce.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Gt(ce.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Gt(ce.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Gt(ce.layout_symbol["text-rotation-alignment"]),"text-field":new ei(ce.layout_symbol["text-field"]),"text-font":new ei(ce.layout_symbol["text-font"]),"text-size":new ei(ce.layout_symbol["text-size"]),"text-max-width":new ei(ce.layout_symbol["text-max-width"]),"text-line-height":new Gt(ce.layout_symbol["text-line-height"]),"text-letter-spacing":new ei(ce.layout_symbol["text-letter-spacing"]),"text-justify":new ei(ce.layout_symbol["text-justify"]),"text-radial-offset":new ei(ce.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Gt(ce.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new ei(ce.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new ei(ce.layout_symbol["text-anchor"]),"text-max-angle":new Gt(ce.layout_symbol["text-max-angle"]),"text-writing-mode":new Gt(ce.layout_symbol["text-writing-mode"]),"text-rotate":new ei(ce.layout_symbol["text-rotate"]),"text-padding":new Gt(ce.layout_symbol["text-padding"]),"text-keep-upright":new Gt(ce.layout_symbol["text-keep-upright"]),"text-transform":new ei(ce.layout_symbol["text-transform"]),"text-offset":new ei(ce.layout_symbol["text-offset"]),"text-allow-overlap":new Gt(ce.layout_symbol["text-allow-overlap"]),"text-overlap":new Gt(ce.layout_symbol["text-overlap"]),"text-ignore-placement":new Gt(ce.layout_symbol["text-ignore-placement"]),"text-optional":new Gt(ce.layout_symbol["text-optional"])})}};class cy{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Sr,this.defaultValue=t}evaluate(t){if(t.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(t.formattedSection))return s.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ct("FormatSectionOverride",cy,{omit:["defaultValue"]});class Sd extends Zs{constructor(t){super(t,pf)}recalculate(t,s){if(super.recalculate(t,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const c=this.layout.get("text-writing-mode");if(c){const f=[];for(const v of c)f.indexOf(v)<0&&f.push(v);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,s,c,f){const v=this.layout.get(t).evaluate(s,{},c,f),x=this._unevaluatedLayout._values[t];return x.isDataDriven()||er(x.value)||!v?v:function(w,T){return T.replace(/{([^{}]+)}/g,(I,L)=>w&&L in w?String(w[L]):"")}(s.properties,v)}createBucket(t){return new Vc(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of pf.paint.overridableProperties){if(!Sd.hasPaintOverride(this.layout,t))continue;const s=this.paint.get(t),c=new cy(s),f=new $i(c,s.property.specification);let v=null;v=s.value.kind==="constant"||s.value.kind==="source"?new sa("source",f):new Xo("composite",f,s.value.zoomStops),this.paint._values[t]=new Ws(s.property,v,s.parameters)}}_handleOverridablePaintPropertyUpdate(t,s,c){return!(!this.layout||s.isDataDriven()||c.isDataDriven())&&Sd.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,s){const c=t.get("text-field"),f=pf.paint.properties[s];let v=!1;const x=w=>{for(const T of w)if(f.overrides&&f.overrides.hasOverride(T))return void(v=!0)};if(c.value.kind==="constant"&&c.value.value instanceof kn)x(c.value.value.sections);else if(c.value.kind==="source"){const w=I=>{v||(I instanceof ia&&Lr(I.value)===Er?x(I.value.sections):I instanceof qo?x(I.sections):I.eachChild(w))},T=c.value;T._styleExpression&&w(T._styleExpression.expression)}return v}}let uy;var Ib={get paint(){return uy=uy||new Yn({"background-color":new Gt(ce.paint_background["background-color"]),"background-pattern":new ql(ce.paint_background["background-pattern"]),"background-opacity":new Gt(ce.paint_background["background-opacity"])})}};class Ab extends Zs{constructor(t){super(t,Ib)}}let hy;var Pb={get paint(){return hy=hy||new Yn({"raster-opacity":new Gt(ce.paint_raster["raster-opacity"]),"raster-hue-rotate":new Gt(ce.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Gt(ce.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Gt(ce.paint_raster["raster-brightness-max"]),"raster-saturation":new Gt(ce.paint_raster["raster-saturation"]),"raster-contrast":new Gt(ce.paint_raster["raster-contrast"]),"raster-resampling":new Gt(ce.paint_raster["raster-resampling"]),"raster-fade-duration":new Gt(ce.paint_raster["raster-fade-duration"])})}};class kb extends Zs{constructor(t){super(t,Pb)}}class Db extends Zs{constructor(t){super(t,{}),this.onAdd=s=>{this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},this.onRemove=s=>{this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Lb{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const ff=63710088e-1;class ol{constructor(t,s){if(isNaN(t)||isNaN(s))throw new Error(`Invalid LngLat object: (${t}, ${s})`);if(this.lng=+t,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ol(Xe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const s=Math.PI/180,c=this.lat*s,f=t.lat*s,v=Math.sin(c)*Math.sin(f)+Math.cos(c)*Math.cos(f)*Math.cos((t.lng-this.lng)*s);return ff*Math.acos(Math.min(v,1))}static convert(t){if(t instanceof ol)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new ol(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new ol(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const dy=2*Math.PI*ff;function py(n){return dy*Math.cos(n*Math.PI/180)}function fy(n){return(180+n)/360}function my(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function gy(n,t){return n/py(t)}function mf(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}class Ed{constructor(t,s,c=0){this.x=+t,this.y=+s,this.z=+c}static fromLngLat(t,s=0){const c=ol.convert(t);return new Ed(fy(c.lng),my(c.lat),gy(s,c.lat))}toLngLat(){return new ol(360*this.x-180,mf(this.y))}toAltitude(){return this.z*py(mf(this.y))}meterInMercatorCoordinateUnits(){return 1/dy*(t=mf(this.y),1/Math.cos(t*Math.PI/180));var t}}function yy(n,t,s){var c=2*Math.PI*6378137/256/Math.pow(2,s);return[n*c-2*Math.PI*6378137/2,t*c-2*Math.PI*6378137/2]}class gf{constructor(t,s,c){if(t<0||t>25||c<0||c>=Math.pow(2,t)||s<0||s>=Math.pow(2,t))throw new Error(`x=${s}, y=${c}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=s,this.y=c,this.key=th(0,t,t,s,c)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,s,c){const f=(x=this.y,w=this.z,T=yy(256*(v=this.x),256*(x=Math.pow(2,w)-x-1),w),I=yy(256*(v+1),256*(x+1),w),T[0]+","+T[1]+","+I[0]+","+I[1]);var v,x,w,T,I;const L=function(O,$,j){let G,Y="";for(let ne=O;ne>0;ne--)G=1<<ne-1,Y+=($&G?1:0)+(j&G?2:0);return Y}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(c==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,s>1?"@2x":"").replace(/{quadkey}/g,L).replace(/{bbox-epsg-3857}/g,f)}isChildOf(t){const s=this.z-t.z;return s>0&&t.x===this.x>>s&&t.y===this.y>>s}getTilePoint(t){const s=Math.pow(2,this.z);return new k((t.x*s-this.x)*$r,(t.y*s-this.y)*$r)}toString(){return`${this.z}/${this.x}/${this.y}`}}class _y{constructor(t,s){this.wrap=t,this.canonical=s,this.key=th(t,s.z,s.z,s.x,s.y)}}class Ks{constructor(t,s,c,f,v){if(t<c)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${c}`);this.overscaledZ=t,this.wrap=s,this.canonical=new gf(c,+f,+v),this.key=th(s,t,c,f,v)}clone(){return new Ks(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-t;return t>this.canonical.z?new Ks(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ks(t,this.wrap,t,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(t,s){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-t;return t>this.canonical.z?th(this.wrap*+s,t,this.canonical.z,this.canonical.x,this.canonical.y):th(this.wrap*+s,t,t,this.canonical.x>>c,this.canonical.y>>c)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const s=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>s&&t.canonical.y===this.canonical.y>>s}children(t){if(this.overscaledZ>=t)return[new Ks(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,c=2*this.canonical.x,f=2*this.canonical.y;return[new Ks(s,this.wrap,s,c,f),new Ks(s,this.wrap,s,c+1,f),new Ks(s,this.wrap,s,c,f+1),new Ks(s,this.wrap,s,c+1,f+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Ks(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Ks(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new _y(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Ed(t.x-this.wrap,t.y))}}function th(n,t,s,c,f){(n*=2)<0&&(n=-1*n-1);const v=1<<s;return(v*v*n+v*f+c).toString(36)+s.toString(36)+t.toString(36)}Ct("CanonicalTileID",gf),Ct("OverscaledTileID",Ks,{omit:["posMatrix"]});class vy{constructor(t,s,c,f=1,v=1,x=1,w=0){if(this.uid=t,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(c&&!["mapbox","terrarium","custom"].includes(c))return void Ei(`"${c}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=s.height;const T=this.dim=s.height-2;switch(this.data=new Uint32Array(s.data.buffer),c){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=f,this.greenFactor=v,this.blueFactor=x,this.baseShift=w;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let I=0;I<T;I++)this.data[this._idx(-1,I)]=this.data[this._idx(0,I)],this.data[this._idx(T,I)]=this.data[this._idx(T-1,I)],this.data[this._idx(I,-1)]=this.data[this._idx(I,0)],this.data[this._idx(I,T)]=this.data[this._idx(I,T-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(T,-1)]=this.data[this._idx(T-1,0)],this.data[this._idx(-1,T)]=this.data[this._idx(0,T-1)],this.data[this._idx(T,T)]=this.data[this._idx(T-1,T-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let I=0;I<T;I++)for(let L=0;L<T;L++){const O=this.get(I,L);O>this.max&&(this.max=O),O<this.min&&(this.min=O)}}get(t,s){const c=new Uint8Array(this.data.buffer),f=4*this._idx(t,s);return this.unpack(c[f],c[f+1],c[f+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,s){if(t<-1||t>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(t+1)}unpack(t,s,c){return t*this.redFactor+s*this.greenFactor+c*this.blueFactor-this.baseShift}getPixels(){return new Xs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,s,c){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let f=s*this.dim,v=s*this.dim+this.dim,x=c*this.dim,w=c*this.dim+this.dim;switch(s){case-1:f=v-1;break;case 1:v=f+1}switch(c){case-1:x=w-1;break;case 1:w=x+1}const T=-s*this.dim,I=-c*this.dim;for(let L=x;L<w;L++)for(let O=f;O<v;O++)this.data[this._idx(O,L)]=t.data[this._idx(O+T,L+I)]}}Ct("DEMData",vy);class xy{constructor(t){this._stringToNumber={},this._numberToString=[];for(let s=0;s<t.length;s++){const c=t[s];this._stringToNumber[c]=s,this._numberToString[s]=c}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class by{constructor(t,s,c,f,v){this.type="Feature",this._vectorTileFeature=t,t._z=s,t._x=c,t._y=f,this.properties=t.properties,this.id=v}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(t[s]=this[s]);return t}}class wy{constructor(t,s){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Bn($r,16,0),this.grid3D=new Bn($r,16,0),this.featureIndexArray=new F,this.promoteId=s}insert(t,s,c,f,v,x){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,f,v);const T=x?this.grid3D:this.grid;for(let I=0;I<s.length;I++){const L=s[I],O=[1/0,1/0,-1/0,-1/0];for(let $=0;$<L.length;$++){const j=L[$];O[0]=Math.min(O[0],j.x),O[1]=Math.min(O[1],j.y),O[2]=Math.max(O[2],j.x),O[3]=Math.max(O[3],j.y)}O[0]<$r&&O[1]<$r&&O[2]>=0&&O[3]>=0&&T.insert(w,O[0],O[1],O[2],O[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new nl.VectorTile(new nf(this.rawTileData)).layers,this.sourceLayerCoder=new xy(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,s,c,f){this.loadVTLayers();const v=t.params||{},x=$r/t.tileSize/t.scale,w=Ma(v.filter),T=t.queryGeometry,I=t.queryPadding*x,L=Sy(T),O=this.grid.query(L.minX-I,L.minY-I,L.maxX+I,L.maxY+I),$=Sy(t.cameraQueryGeometry),j=this.grid3D.query($.minX-I,$.minY-I,$.maxX+I,$.maxY+I,(ne,he,Ce,pe)=>function(be,$e,He,It,Nt){for(const bt of be)if($e<=bt.x&&He<=bt.y&&It>=bt.x&&Nt>=bt.y)return!0;const Et=[new k($e,He),new k($e,Nt),new k(It,Nt),new k(It,He)];if(be.length>2){for(const bt of Et)if(zc(be,bt))return!0}for(let bt=0;bt<be.length-1;bt++)if(h1(be[bt],be[bt+1],Et))return!0;return!1}(t.cameraQueryGeometry,ne-I,he-I,Ce+I,pe+I));for(const ne of j)O.push(ne);O.sort(Rb);const G={};let Y;for(let ne=0;ne<O.length;ne++){const he=O[ne];if(he===Y)continue;Y=he;const Ce=this.featureIndexArray.get(he);let pe=null;this.loadMatchingFeature(G,Ce.bucketIndex,Ce.sourceLayerIndex,Ce.featureIndex,w,v.layers,v.availableImages,s,c,f,(be,$e,He)=>(pe||(pe=wo(be)),$e.queryIntersectsFeature(T,be,He,pe,this.z,t.transform,x,t.pixelPosMatrix)))}return G}loadMatchingFeature(t,s,c,f,v,x,w,T,I,L,O){const $=this.bucketLayerIDs[s];if(x&&!function(ne,he){for(let Ce=0;Ce<ne.length;Ce++)if(he.indexOf(ne[Ce])>=0)return!0;return!1}(x,$))return;const j=this.sourceLayerCoder.decode(c),G=this.vtLayers[j].feature(f);if(v.needGeometry){const ne=Mo(G,!0);if(!v.filter(new xr(this.tileID.overscaledZ),ne,this.tileID.canonical))return}else if(!v.filter(new xr(this.tileID.overscaledZ),G))return;const Y=this.getId(G,j);for(let ne=0;ne<$.length;ne++){const he=$[ne];if(x&&x.indexOf(he)<0)continue;const Ce=T[he];if(!Ce)continue;let pe={};Y&&L&&(pe=L.getState(Ce.sourceLayer||"_geojsonTileLayer",Y));const be=nt({},I[he]);be.paint=My(be.paint,Ce.paint,G,pe,w),be.layout=My(be.layout,Ce.layout,G,pe,w);const $e=!O||O(G,Ce,pe);if(!$e)continue;const He=new by(G,this.z,this.x,this.y,Y);He.layer=be;let It=t[he];It===void 0&&(It=t[he]=[]),It.push({featureIndex:f,feature:He,intersectionZ:$e})}}lookupSymbolFeatures(t,s,c,f,v,x,w,T){const I={};this.loadVTLayers();const L=Ma(v);for(const O of t)this.loadMatchingFeature(I,c,f,O,L,x,w,T,s);return I}hasLayer(t){for(const s of this.bucketLayerIDs)for(const c of s)if(t===c)return!0;return!1}getId(t,s){let c=t.id;return this.promoteId&&(c=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]],typeof c=="boolean"&&(c=Number(c))),c}}function My(n,t,s,c,f){return At(n,(v,x)=>{const w=t instanceof jl?t.get(x):null;return w&&w.evaluate?w.evaluate(s,c,f):w})}function Sy(n){let t=1/0,s=1/0,c=-1/0,f=-1/0;for(const v of n)t=Math.min(t,v.x),s=Math.min(s,v.y),c=Math.max(c,v.x),f=Math.max(f,v.y);return{minX:t,minY:s,maxX:c,maxY:f}}function Rb(n,t){return t-n}function Ey(n,t,s,c,f){const v=[];for(let x=0;x<n.length;x++){const w=n[x];let T;for(let I=0;I<w.length-1;I++){let L=w[I],O=w[I+1];L.x<t&&O.x<t||(L.x<t?L=new k(t,L.y+(t-L.x)/(O.x-L.x)*(O.y-L.y))._round():O.x<t&&(O=new k(t,L.y+(t-L.x)/(O.x-L.x)*(O.y-L.y))._round()),L.y<s&&O.y<s||(L.y<s?L=new k(L.x+(s-L.y)/(O.y-L.y)*(O.x-L.x),s)._round():O.y<s&&(O=new k(L.x+(s-L.y)/(O.y-L.y)*(O.x-L.x),s)._round()),L.x>=c&&O.x>=c||(L.x>=c?L=new k(c,L.y+(c-L.x)/(O.x-L.x)*(O.y-L.y))._round():O.x>=c&&(O=new k(c,L.y+(c-L.x)/(O.x-L.x)*(O.y-L.y))._round()),L.y>=f&&O.y>=f||(L.y>=f?L=new k(L.x+(f-L.y)/(O.y-L.y)*(O.x-L.x),f)._round():O.y>=f&&(O=new k(L.x+(f-L.y)/(O.y-L.y)*(O.x-L.x),f)._round()),T&&L.equals(T[T.length-1])||(T=[L],v.push(T)),T.push(O)))))}}return v}Ct("FeatureIndex",wy,{omit:["rawTileData","sourceLayerCoder"]});class ll extends k{constructor(t,s,c,f){super(t,s),this.angle=c,f!==void 0&&(this.segment=f)}clone(){return new ll(this.x,this.y,this.angle,this.segment)}}function Ty(n,t,s,c,f){if(t.segment===void 0||s===0)return!0;let v=t,x=t.segment+1,w=0;for(;w>-s/2;){if(x--,x<0)return!1;w-=n[x].dist(v),v=n[x]}w+=n[x].dist(n[x+1]),x++;const T=[];let I=0;for(;w<s/2;){const L=n[x],O=n[x+1];if(!O)return!1;let $=n[x-1].angleTo(L)-L.angleTo(O);for($=Math.abs(($+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:w,angleDelta:$}),I+=$;w-T[0].distance>c;)I-=T.shift().angleDelta;if(I>f)return!1;x++,w+=L.dist(O)}return!0}function Cy(n){let t=0;for(let s=0;s<n.length-1;s++)t+=n[s].dist(n[s+1]);return t}function Iy(n,t,s){return n?.6*t*s:0}function Ay(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function zb(n,t,s,c,f,v){const x=Iy(s,f,v),w=Ay(s,c)*v;let T=0;const I=Cy(n)/2;for(let L=0;L<n.length-1;L++){const O=n[L],$=n[L+1],j=O.dist($);if(T+j>I){const G=(I-T)/j,Y=fn.number(O.x,$.x,G),ne=fn.number(O.y,$.y,G),he=new ll(Y,ne,$.angleTo(O),L);return he._round(),!x||Ty(n,he,w,x,t)?he:void 0}T+=j}}function Ob(n,t,s,c,f,v,x,w,T){const I=Iy(c,v,x),L=Ay(c,f),O=L*x,$=n[0].x===0||n[0].x===T||n[0].y===0||n[0].y===T;return t-O<t/4&&(t=O+t/4),Py(n,$?t/2*w%t:(L/2+2*v)*x*w%t,t,I,s,O,$,!1,T)}function Py(n,t,s,c,f,v,x,w,T){const I=v/2,L=Cy(n);let O=0,$=t-s,j=[];for(let G=0;G<n.length-1;G++){const Y=n[G],ne=n[G+1],he=Y.dist(ne),Ce=ne.angleTo(Y);for(;$+s<O+he;){$+=s;const pe=($-O)/he,be=fn.number(Y.x,ne.x,pe),$e=fn.number(Y.y,ne.y,pe);if(be>=0&&be<T&&$e>=0&&$e<T&&$-I>=0&&$+I<=L){const He=new ll(be,$e,Ce,G);He._round(),c&&!Ty(n,He,v,c,f)||j.push(He)}}O+=he}return w||j.length||x||(j=Py(n,O/2,s,c,f,v,x,!0,T)),j}Ct("Anchor",ll);const jc=ps;function ky(n,t,s,c){const f=[],v=n.image,x=v.pixelRatio,w=v.paddedRect.w-2*jc,T=v.paddedRect.h-2*jc,I=n.right-n.left,L=n.bottom-n.top,O=v.stretchX||[[0,w]],$=v.stretchY||[[0,T]],j=(ct,Rt)=>ct+Rt[1]-Rt[0],G=O.reduce(j,0),Y=$.reduce(j,0),ne=w-G,he=T-Y;let Ce=0,pe=G,be=0,$e=Y,He=0,It=ne,Nt=0,Et=he;if(v.content&&c){const ct=v.content;Ce=Td(O,0,ct[0]),be=Td($,0,ct[1]),pe=Td(O,ct[0],ct[2]),$e=Td($,ct[1],ct[3]),He=ct[0]-Ce,Nt=ct[1]-be,It=ct[2]-ct[0]-pe,Et=ct[3]-ct[1]-$e}const bt=(ct,Rt,_t,tt)=>{const Qt=Cd(ct.stretch-Ce,pe,I,n.left),jt=Id(ct.fixed-He,It,ct.stretch,G),Si=Cd(Rt.stretch-be,$e,L,n.top),yr=Id(Rt.fixed-Nt,Et,Rt.stretch,Y),wr=Cd(_t.stretch-Ce,pe,I,n.left),ln=Id(_t.fixed-He,It,_t.stretch,G),Ps=Cd(tt.stretch-be,$e,L,n.top),Qn=Id(tt.fixed-Nt,Et,tt.stretch,Y),Jr=new k(Qt,Si),In=new k(wr,Si),Ln=new k(wr,Ps),es=new k(Qt,Ps),ts=new k(jt/x,yr/x),cn=new k(ln/x,Qn/x),un=t*Math.PI/180;if(un){const $n=Math.sin(un),fs=Math.cos(un),ms=[fs,-$n,$n,fs];Jr._matMult(ms),In._matMult(ms),es._matMult(ms),Ln._matMult(ms)}const Nn=ct.stretch+ct.fixed,is=Rt.stretch+Rt.fixed;return{tl:Jr,tr:In,bl:es,br:Ln,tex:{x:v.paddedRect.x+jc+Nn,y:v.paddedRect.y+jc+is,w:_t.stretch+_t.fixed-Nn,h:tt.stretch+tt.fixed-is},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ts,pixelOffsetBR:cn,minFontScaleX:It/x/I,minFontScaleY:Et/x/L,isSDF:s}};if(c&&(v.stretchX||v.stretchY)){const ct=Dy(O,ne,G),Rt=Dy($,he,Y);for(let _t=0;_t<ct.length-1;_t++){const tt=ct[_t],Qt=ct[_t+1];for(let jt=0;jt<Rt.length-1;jt++)f.push(bt(tt,Rt[jt],Qt,Rt[jt+1]))}}else f.push(bt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:T+1}));return f}function Td(n,t,s){let c=0;for(const f of n)c+=Math.max(t,Math.min(s,f[1]))-Math.max(t,Math.min(s,f[0]));return c}function Dy(n,t,s){const c=[{fixed:-jc,stretch:0}];for(const[f,v]of n){const x=c[c.length-1];c.push({fixed:f-x.stretch,stretch:x.stretch}),c.push({fixed:f-x.stretch,stretch:x.stretch+(v-f)})}return c.push({fixed:t+jc,stretch:s}),c}function Cd(n,t,s,c){return n/t*s+c}function Id(n,t,s,c){return n-t*s/c}class Ad{constructor(t,s,c,f,v,x,w,T,I,L){if(this.boxStartIndex=t.length,I){let O=x.top,$=x.bottom;const j=x.collisionPadding;j&&(O-=j[1],$+=j[3]);let G=$-O;G>0&&(G=Math.max(10,G),this.circleDiameter=G)}else{let O=x.top*w-T[0],$=x.bottom*w+T[2],j=x.left*w-T[3],G=x.right*w+T[1];const Y=x.collisionPadding;if(Y&&(j-=Y[0]*w,O-=Y[1]*w,G+=Y[2]*w,$+=Y[3]*w),L){const ne=new k(j,O),he=new k(G,O),Ce=new k(j,$),pe=new k(G,$),be=L*Math.PI/180;ne._rotate(be),he._rotate(be),Ce._rotate(be),pe._rotate(be),j=Math.min(ne.x,he.x,Ce.x,pe.x),G=Math.max(ne.x,he.x,Ce.x,pe.x),O=Math.min(ne.y,he.y,Ce.y,pe.y),$=Math.max(ne.y,he.y,Ce.y,pe.y)}t.emplaceBack(s.x,s.y,j,O,G,$,c,f,v)}this.boxEndIndex=t.length}}class Fb{constructor(t=[],s=Bb){if(this.data=t,this.length=this.data.length,this.compare=s,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:s,compare:c}=this,f=s[t];for(;t>0;){const v=t-1>>1,x=s[v];if(c(f,x)>=0)break;s[t]=x,t=v}s[t]=f}_down(t){const{data:s,compare:c}=this,f=this.length>>1,v=s[t];for(;t<f;){let x=1+(t<<1),w=s[x];const T=x+1;if(T<this.length&&c(s[T],w)<0&&(x=T,w=s[T]),c(w,v)>=0)break;s[t]=w,t=x}s[t]=v}}function Bb(n,t){return n<t?-1:n>t?1:0}function Nb(n,t=1,s=!1){let c=1/0,f=1/0,v=-1/0,x=-1/0;const w=n[0];for(let j=0;j<w.length;j++){const G=w[j];(!j||G.x<c)&&(c=G.x),(!j||G.y<f)&&(f=G.y),(!j||G.x>v)&&(v=G.x),(!j||G.y>x)&&(x=G.y)}const T=Math.min(v-c,x-f);let I=T/2;const L=new Fb([],$b);if(T===0)return new k(c,f);for(let j=c;j<v;j+=T)for(let G=f;G<x;G+=T)L.push(new qc(j+I,G+I,I,n));let O=function(j){let G=0,Y=0,ne=0;const he=j[0];for(let Ce=0,pe=he.length,be=pe-1;Ce<pe;be=Ce++){const $e=he[Ce],He=he[be],It=$e.x*He.y-He.x*$e.y;Y+=($e.x+He.x)*It,ne+=($e.y+He.y)*It,G+=3*It}return new qc(Y/G,ne/G,0,j)}(n),$=L.length;for(;L.length;){const j=L.pop();(j.d>O.d||!O.d)&&(O=j,s&&console.log("found best %d after %d probes",Math.round(1e4*j.d)/1e4,$)),j.max-O.d<=t||(I=j.h/2,L.push(new qc(j.p.x-I,j.p.y-I,I,n)),L.push(new qc(j.p.x+I,j.p.y-I,I,n)),L.push(new qc(j.p.x-I,j.p.y+I,I,n)),L.push(new qc(j.p.x+I,j.p.y+I,I,n)),$+=4)}return s&&(console.log(`num probes: ${$}`),console.log(`best distance: ${O.d}`)),O.p}function $b(n,t){return t.max-n.max}function qc(n,t,s,c){this.p=new k(n,t),this.h=s,this.d=function(f,v){let x=!1,w=1/0;for(let T=0;T<v.length;T++){const I=v[T];for(let L=0,O=I.length,$=O-1;L<O;$=L++){const j=I[L],G=I[$];j.y>f.y!=G.y>f.y&&f.x<(G.x-j.x)*(f.y-j.y)/(G.y-j.y)+j.x&&(x=!x),w=Math.min(w,mg(f,j,G))}}return(x?1:-1)*Math.sqrt(w)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}var Dn;m.ap=void 0,(Dn=m.ap||(m.ap={}))[Dn.center=1]="center",Dn[Dn.left=2]="left",Dn[Dn.right=3]="right",Dn[Dn.top=4]="top",Dn[Dn.bottom=5]="bottom",Dn[Dn["top-left"]=6]="top-left",Dn[Dn["top-right"]=7]="top-right",Dn[Dn["bottom-left"]=8]="bottom-left",Dn[Dn["bottom-right"]=9]="bottom-right";const cl=7,yf=Number.POSITIVE_INFINITY;function Ly(n,t){return t[1]!==yf?function(s,c,f){let v=0,x=0;switch(c=Math.abs(c),f=Math.abs(f),s){case"top-right":case"top-left":case"top":x=f-cl;break;case"bottom-right":case"bottom-left":case"bottom":x=-f+cl}switch(s){case"top-right":case"bottom-right":case"right":v=-c;break;case"top-left":case"bottom-left":case"left":v=c}return[v,x]}(n,t[0],t[1]):function(s,c){let f=0,v=0;c<0&&(c=0);const x=c/Math.SQRT2;switch(s){case"top-right":case"top-left":v=x-cl;break;case"bottom-right":case"bottom-left":v=-x+cl;break;case"bottom":v=-c+cl;break;case"top":v=c-cl}switch(s){case"top-right":case"bottom-right":f=-x;break;case"top-left":case"bottom-left":f=x;break;case"left":f=c;break;case"right":f=-c}return[f,v]}(n,t[0])}function Ry(n,t,s){var c;const f=n.layout,v=(c=f.get("text-variable-anchor-offset"))===null||c===void 0?void 0:c.evaluate(t,{},s);if(v){const w=v.values,T=[];for(let I=0;I<w.length;I+=2){const L=T[I]=w[I],O=w[I+1].map($=>$*on);L.startsWith("top")?O[1]-=cl:L.startsWith("bottom")&&(O[1]+=cl),T[I+1]=O}return new Dr(T)}const x=f.get("text-variable-anchor");if(x){let w;w=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[f.get("text-radial-offset").evaluate(t,{},s)*on,yf]:f.get("text-offset").evaluate(t,{},s).map(I=>I*on);const T=[];for(const I of x)T.push(I,Ly(I,w));return new Dr(T)}return null}function _f(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ub(n,t,s,c,f,v,x,w,T,I,L){let O=v.textMaxSize.evaluate(t,{});O===void 0&&(O=x);const $=n.layers[0].layout,j=$.get("icon-offset").evaluate(t,{},L),G=Oy(s.horizontal),Y=x/24,ne=n.tilePixelRatio*Y,he=n.tilePixelRatio*O/24,Ce=n.tilePixelRatio*w,pe=n.tilePixelRatio*$.get("symbol-spacing"),be=$.get("text-padding")*n.tilePixelRatio,$e=function(tt,Qt,jt,Si=1){const yr=tt.get("icon-padding").evaluate(Qt,{},jt),wr=yr&&yr.values;return[wr[0]*Si,wr[1]*Si,wr[2]*Si,wr[3]*Si]}($,t,L,n.tilePixelRatio),He=$.get("text-max-angle")/180*Math.PI,It=$.get("text-rotation-alignment")!=="viewport"&&$.get("symbol-placement")!=="point",Nt=$.get("icon-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",Et=$.get("symbol-placement"),bt=pe/2,ct=$.get("icon-text-fit");let Rt;c&&ct!=="none"&&(n.allowVerticalPlacement&&s.vertical&&(Rt=sy(c,s.vertical,ct,$.get("icon-text-fit-padding"),j,Y)),G&&(c=sy(c,G,ct,$.get("icon-text-fit-padding"),j,Y)));const _t=(tt,Qt)=>{Qt.x<0||Qt.x>=$r||Qt.y<0||Qt.y>=$r||function(jt,Si,yr,wr,ln,Ps,Qn,Jr,In,Ln,es,ts,cn,un,Nn,is,$n,fs,ms,hn,Pi,Un,Rn,dn,ua){const Pa=jt.addToLineVertexArray(Si,yr);let ka,Eo,ha,Ys,gs=0,To=0,nh=0,$y=0,Tf=-1,Cf=-1;const Co={};let Uy=Or("");if(jt.allowVerticalPlacement&&wr.vertical){const Vn=Jr.layout.get("text-rotate").evaluate(Pi,{},dn)+90;ha=new Ad(In,Si,Ln,es,ts,wr.vertical,cn,un,Nn,Vn),Qn&&(Ys=new Ad(In,Si,Ln,es,ts,Qn,$n,fs,Nn,Vn))}if(ln){const Vn=Jr.layout.get("icon-rotate").evaluate(Pi,{}),Js=Jr.layout.get("icon-text-fit")!=="none",Jl=ky(ln,Vn,Rn,Js),La=Qn?ky(Qn,Vn,Rn,Js):void 0;Eo=new Ad(In,Si,Ln,es,ts,ln,$n,fs,!1,Vn),gs=4*Jl.length;const Ql=jt.iconSizeData;let Ja=null;Ql.kind==="source"?(Ja=[Ya*Jr.layout.get("icon-size").evaluate(Pi,{})],Ja[0]>al&&Ei(`${jt.layerIds[0]}: Value for "icon-size" is >= ${eh}. Reduce your "icon-size".`)):Ql.kind==="composite"&&(Ja=[Ya*Un.compositeIconSizes[0].evaluate(Pi,{},dn),Ya*Un.compositeIconSizes[1].evaluate(Pi,{},dn)],(Ja[0]>al||Ja[1]>al)&&Ei(`${jt.layerIds[0]}: Value for "icon-size" is >= ${eh}. Reduce your "icon-size".`)),jt.addSymbols(jt.icon,Jl,Ja,hn,ms,Pi,m.ah.none,Si,Pa.lineStartIndex,Pa.lineLength,-1,dn),Tf=jt.icon.placedSymbolArray.length-1,La&&(To=4*La.length,jt.addSymbols(jt.icon,La,Ja,hn,ms,Pi,m.ah.vertical,Si,Pa.lineStartIndex,Pa.lineLength,-1,dn),Cf=jt.icon.placedSymbolArray.length-1)}const Vy=Object.keys(wr.horizontal);for(const Vn of Vy){const Js=wr.horizontal[Vn];if(!ka){Uy=Or(Js.text);const La=Jr.layout.get("text-rotate").evaluate(Pi,{},dn);ka=new Ad(In,Si,Ln,es,ts,Js,cn,un,Nn,La)}const Jl=Js.positionedLines.length===1;if(nh+=zy(jt,Si,Js,Ps,Jr,Nn,Pi,is,Pa,wr.vertical?m.ah.horizontal:m.ah.horizontalOnly,Jl?Vy:[Vn],Co,Tf,Un,dn),Jl)break}wr.vertical&&($y+=zy(jt,Si,wr.vertical,Ps,Jr,Nn,Pi,is,Pa,m.ah.vertical,["vertical"],Co,Cf,Un,dn));const qb=ka?ka.boxStartIndex:jt.collisionBoxArray.length,Gb=ka?ka.boxEndIndex:jt.collisionBoxArray.length,Hb=ha?ha.boxStartIndex:jt.collisionBoxArray.length,Wb=ha?ha.boxEndIndex:jt.collisionBoxArray.length,Zb=Eo?Eo.boxStartIndex:jt.collisionBoxArray.length,Xb=Eo?Eo.boxEndIndex:jt.collisionBoxArray.length,Kb=Ys?Ys.boxStartIndex:jt.collisionBoxArray.length,Yb=Ys?Ys.boxEndIndex:jt.collisionBoxArray.length;let Da=-1;const kd=(Vn,Js)=>Vn&&Vn.circleDiameter?Math.max(Vn.circleDiameter,Js):Js;Da=kd(ka,Da),Da=kd(ha,Da),Da=kd(Eo,Da),Da=kd(Ys,Da);const jy=Da>-1?1:0;jy&&(Da*=ua/on),jt.glyphOffsetArray.length>=Vc.MAX_GLYPHS&&Ei("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Pi.sortKey!==void 0&&jt.addToSortKeyRanges(jt.symbolInstances.length,Pi.sortKey);const Jb=Ry(Jr,Pi,dn),[Qb,ew]=function(Vn,Js){const Jl=Vn.length,La=Js==null?void 0:Js.values;if((La==null?void 0:La.length)>0)for(let Ql=0;Ql<La.length;Ql+=2){const Ja=La[Ql+1];Vn.emplaceBack(m.ap[La[Ql]],Ja[0],Ja[1])}return[Jl,Vn.length]}(jt.textAnchorOffsets,Jb);jt.symbolInstances.emplaceBack(Si.x,Si.y,Co.right>=0?Co.right:-1,Co.center>=0?Co.center:-1,Co.left>=0?Co.left:-1,Co.vertical||-1,Tf,Cf,Uy,qb,Gb,Hb,Wb,Zb,Xb,Kb,Yb,Ln,nh,$y,gs,To,jy,0,cn,Da,Qb,ew)}(n,Qt,tt,s,c,f,Rt,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,ne,[be,be,be,be],It,T,Ce,$e,Nt,j,t,v,I,L,x)};if(Et==="line")for(const tt of Ey(t.geometry,0,0,$r,$r)){const Qt=Ob(tt,pe,He,s.vertical||G,c,24,he,n.overscaling,$r);for(const jt of Qt)G&&Vb(n,G.text,bt,jt)||_t(tt,jt)}else if(Et==="line-center"){for(const tt of t.geometry)if(tt.length>1){const Qt=zb(tt,He,s.vertical||G,c,24,he);Qt&&_t(tt,Qt)}}else if(t.type==="Polygon")for(const tt of Xp(t.geometry,0)){const Qt=Nb(tt,16);_t(tt[0],new ll(Qt.x,Qt.y,0))}else if(t.type==="LineString")for(const tt of t.geometry)_t(tt,new ll(tt[0].x,tt[0].y,0));else if(t.type==="Point")for(const tt of t.geometry)for(const Qt of tt)_t([Qt],new ll(Qt.x,Qt.y,0))}function zy(n,t,s,c,f,v,x,w,T,I,L,O,$,j,G){const Y=function(Ce,pe,be,$e,He,It,Nt,Et){const bt=$e.layout.get("text-rotate").evaluate(It,{})*Math.PI/180,ct=[];for(const Rt of pe.positionedLines)for(const _t of Rt.positionedGlyphs){if(!_t.rect)continue;const tt=_t.rect||{};let Qt=Jg+1,jt=!0,Si=1,yr=0;const wr=(He||Et)&&_t.vertical,ln=_t.metrics.advance*_t.scale/2;if(Et&&pe.verticalizable&&(yr=Rt.lineOffset/2-(_t.imageName?-(on-_t.metrics.width*_t.scale)/2:(_t.scale-1)*on)),_t.imageName){const hn=Nt[_t.imageName];jt=hn.sdf,Si=hn.pixelRatio,Qt=ps/Si}const Ps=He?[_t.x+ln,_t.y]:[0,0];let Qn=He?[0,0]:[_t.x+ln+be[0],_t.y+be[1]-yr],Jr=[0,0];wr&&(Jr=Qn,Qn=[0,0]);const In=_t.metrics.isDoubleResolution?2:1,Ln=(_t.metrics.left-Qt)*_t.scale-ln+Qn[0],es=(-_t.metrics.top-Qt)*_t.scale+Qn[1],ts=Ln+tt.w/In*_t.scale/Si,cn=es+tt.h/In*_t.scale/Si,un=new k(Ln,es),Nn=new k(ts,es),is=new k(Ln,cn),$n=new k(ts,cn);if(wr){const hn=new k(-ln,ln-Ju),Pi=-Math.PI/2,Un=on/2-ln,Rn=new k(5-Ju-Un,-(_t.imageName?Un:0)),dn=new k(...Jr);un._rotateAround(Pi,hn)._add(Rn)._add(dn),Nn._rotateAround(Pi,hn)._add(Rn)._add(dn),is._rotateAround(Pi,hn)._add(Rn)._add(dn),$n._rotateAround(Pi,hn)._add(Rn)._add(dn)}if(bt){const hn=Math.sin(bt),Pi=Math.cos(bt),Un=[Pi,-hn,hn,Pi];un._matMult(Un),Nn._matMult(Un),is._matMult(Un),$n._matMult(Un)}const fs=new k(0,0),ms=new k(0,0);ct.push({tl:un,tr:Nn,bl:is,br:$n,tex:tt,writingMode:pe.writingMode,glyphOffset:Ps,sectionIndex:_t.sectionIndex,isSDF:jt,pixelOffsetTL:fs,pixelOffsetBR:ms,minFontScaleX:0,minFontScaleY:0})}return ct}(0,s,w,f,v,x,c,n.allowVerticalPlacement),ne=n.textSizeData;let he=null;ne.kind==="source"?(he=[Ya*f.layout.get("text-size").evaluate(x,{})],he[0]>al&&Ei(`${n.layerIds[0]}: Value for "text-size" is >= ${eh}. Reduce your "text-size".`)):ne.kind==="composite"&&(he=[Ya*j.compositeTextSizes[0].evaluate(x,{},G),Ya*j.compositeTextSizes[1].evaluate(x,{},G)],(he[0]>al||he[1]>al)&&Ei(`${n.layerIds[0]}: Value for "text-size" is >= ${eh}. Reduce your "text-size".`)),n.addSymbols(n.text,Y,he,w,v,x,I,t,T.lineStartIndex,T.lineLength,$,G);for(const Ce of L)O[Ce]=n.text.placedSymbolArray.length-1;return 4*Y.length}function Oy(n){for(const t in n)return n[t];return null}function Vb(n,t,s,c){const f=n.compareText;if(t in f){const v=f[t];for(let x=v.length-1;x>=0;x--)if(c.dist(v[x])<s)return!0}else f[t]=[];return f[t].push(c),!1}const Fy=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class vf{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,c]=new Uint8Array(t,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const f=c>>4;if(f!==1)throw new Error(`Got v${f} data when expected v1.`);const v=Fy[15&c];if(!v)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(t,2,1),[w]=new Uint32Array(t,4,1);return new vf(w,x,v,t)}constructor(t,s=64,c=Float64Array,f){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=c,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const v=Fy.indexOf(this.ArrayType),x=2*t*this.ArrayType.BYTES_PER_ELEMENT,w=t*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-w%8)%8;if(v<0)throw new Error(`Unexpected typed array class: ${c}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+w+T,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+x+w+T),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+w+T,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+v]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=t)}add(t,s){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=t,this.coords[this._pos++]=s,c}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return xf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,s,c,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:x,nodeSize:w}=this,T=[0,v.length-1,0],I=[];for(;T.length;){const L=T.pop()||0,O=T.pop()||0,$=T.pop()||0;if(O-$<=w){for(let ne=$;ne<=O;ne++){const he=x[2*ne],Ce=x[2*ne+1];he>=t&&he<=c&&Ce>=s&&Ce<=f&&I.push(v[ne])}continue}const j=$+O>>1,G=x[2*j],Y=x[2*j+1];G>=t&&G<=c&&Y>=s&&Y<=f&&I.push(v[j]),(L===0?t<=G:s<=Y)&&(T.push($),T.push(j-1),T.push(1-L)),(L===0?c>=G:f>=Y)&&(T.push(j+1),T.push(O),T.push(1-L))}return I}within(t,s,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:v,nodeSize:x}=this,w=[0,f.length-1,0],T=[],I=c*c;for(;w.length;){const L=w.pop()||0,O=w.pop()||0,$=w.pop()||0;if(O-$<=x){for(let ne=$;ne<=O;ne++)Ny(v[2*ne],v[2*ne+1],t,s)<=I&&T.push(f[ne]);continue}const j=$+O>>1,G=v[2*j],Y=v[2*j+1];Ny(G,Y,t,s)<=I&&T.push(f[j]),(L===0?t-c<=G:s-c<=Y)&&(w.push($),w.push(j-1),w.push(1-L)),(L===0?t+c>=G:s+c>=Y)&&(w.push(j+1),w.push(O),w.push(1-L))}return T}}function xf(n,t,s,c,f,v){if(f-c<=s)return;const x=c+f>>1;By(n,t,x,c,f,v),xf(n,t,s,c,x-1,1-v),xf(n,t,s,x+1,f,1-v)}function By(n,t,s,c,f,v){for(;f>c;){if(f-c>600){const I=f-c+1,L=s-c+1,O=Math.log(I),$=.5*Math.exp(2*O/3),j=.5*Math.sqrt(O*$*(I-$)/I)*(L-I/2<0?-1:1);By(n,t,s,Math.max(c,Math.floor(s-L*$/I+j)),Math.min(f,Math.floor(s+(I-L)*$/I+j)),v)}const x=t[2*s+v];let w=c,T=f;for(ih(n,t,c,s),t[2*f+v]>x&&ih(n,t,c,f);w<T;){for(ih(n,t,w,T),w++,T--;t[2*w+v]<x;)w++;for(;t[2*T+v]>x;)T--}t[2*c+v]===x?ih(n,t,c,T):(T++,ih(n,t,T,f)),T<=s&&(c=T+1),s<=T&&(f=T-1)}}function ih(n,t,s,c){bf(n,s,c),bf(t,2*s,2*c),bf(t,2*s+1,2*c+1)}function bf(n,t,s){const c=n[t];n[t]=n[s],n[s]=c}function Ny(n,t,s,c){const f=n-s,v=t-c;return f*f+v*v}var wf;m.bd=void 0,(wf=m.bd||(m.bd={})).create="create",wf.load="load",wf.fullLoad="fullLoad";let Pd=null,rh=[];const Mf=1e3/60,Sf="loadTime",Ef="fullLoadTime",jb={mark(n){performance.mark(n)},frame(n){const t=n;Pd!=null&&rh.push(t-Pd),Pd=t},clearMetrics(){Pd=null,rh=[],performance.clearMeasures(Sf),performance.clearMeasures(Ef);for(const n in m.bd)performance.clearMarks(m.bd[n])},getPerformanceMetrics(){performance.measure(Sf,m.bd.create,m.bd.load),performance.measure(Ef,m.bd.create,m.bd.fullLoad);const n=performance.getEntriesByName(Sf)[0].duration,t=performance.getEntriesByName(Ef)[0].duration,s=rh.length,c=1/(rh.reduce((v,x)=>v+x,0)/s/1e3),f=rh.filter(v=>v>Mf).reduce((v,x)=>v+(x-Mf)/Mf,0);return{loadTime:n,fullLoadTime:t,fps:c,percentDroppedFrames:f/(s+f)*100,totalFrames:s}}};m.$=ht,m.A=Oc,m.B=function(n){if($t==null){const t=n.navigator?n.navigator.userAgent:null;$t=!!n.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return $t},m.C=class{constructor(n,t){this.target=n,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Lb(()=>this.process()),this.subscription=function(s,c,f,v){return s.addEventListener(c,f,!1),{unsubscribe:()=>{s.removeEventListener(c,f,!1)}}}(this.target,"message",s=>this.receive(s)),this.globalScope=kt(self)?n:window}registerMessageHandler(n,t){this.messageHandlers[n]=t}sendAsync(n,t){return new Promise((s,c)=>{const f=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[f]={resolve:s,reject:c},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[f];const w={id:f,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(w)},{once:!0});const v=[],x=Object.assign(Object.assign({},n),{id:f,sourceMapId:this.mapId,origin:location.origin,data:us(n.data,v)});this.target.postMessage(x,{transfer:v})})}receive(n){const t=n.data,s=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[s];const c=this.abortControllers[s];return delete this.abortControllers[s],void(c&&c.abort())}if(kt(self)||t.mustQueue)return this.tasks[s]=t,this.taskQueue.push(s),void this.invoker.trigger();this.processTask(s,t)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),t=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(n,t)}processTask(n,t){return l(this,void 0,void 0,function*(){if(t.type==="<response>"){const f=this.resolveRejects[n];return delete this.resolveRejects[n],f?void(t.error?f.reject(Kn(t.error)):f.resolve(Kn(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const s=Kn(t.data),c=new AbortController;this.abortControllers[n]=c;try{const f=yield this.messageHandlers[t.type](t.sourceMapId,s,c);this.completeTask(n,null,f)}catch(f){this.completeTask(n,f)}})}completeTask(n,t,s){const c=[];delete this.abortControllers[n];const f={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?us(t):null,data:us(s,c)};this.target.postMessage(f,{transfer:c})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},m.D=Gt,m.E=Fe,m.F=function(){var n=new Oc(16);return Oc!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},m.G=je,m.H=function(n,t,s){var c,f,v,x,w,T,I,L,O,$,j,G,Y=s[0],ne=s[1],he=s[2];return t===n?(n[12]=t[0]*Y+t[4]*ne+t[8]*he+t[12],n[13]=t[1]*Y+t[5]*ne+t[9]*he+t[13],n[14]=t[2]*Y+t[6]*ne+t[10]*he+t[14],n[15]=t[3]*Y+t[7]*ne+t[11]*he+t[15]):(f=t[1],v=t[2],x=t[3],w=t[4],T=t[5],I=t[6],L=t[7],O=t[8],$=t[9],j=t[10],G=t[11],n[0]=c=t[0],n[1]=f,n[2]=v,n[3]=x,n[4]=w,n[5]=T,n[6]=I,n[7]=L,n[8]=O,n[9]=$,n[10]=j,n[11]=G,n[12]=c*Y+w*ne+O*he+t[12],n[13]=f*Y+T*ne+$*he+t[13],n[14]=v*Y+I*ne+j*he+t[14],n[15]=x*Y+L*ne+G*he+t[15]),n},m.I=af,m.J=function(n,t,s){var c=s[0],f=s[1],v=s[2];return n[0]=t[0]*c,n[1]=t[1]*c,n[2]=t[2]*c,n[3]=t[3]*c,n[4]=t[4]*f,n[5]=t[5]*f,n[6]=t[6]*f,n[7]=t[7]*f,n[8]=t[8]*v,n[9]=t[9]*v,n[10]=t[10]*v,n[11]=t[11]*v,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},m.K=vg,m.L=function(n,t){const s={};for(let c=0;c<t.length;c++){const f=t[c];f in n&&(s[f]=n[f])}return s},m.M=ol,m.N=fy,m.O=my,m.P=k,m.Q=Ks,m.R=Xs,m.S=ye,m.T=Cu,m.U=we,m.V=Bi,m.W=$r,m.X=qr,m.Y=Ed,m.Z=class extends Pu{},m._=l,m.a=ji,m.a$=function(n,t,s){return n[0]=t[0]*s[0],n[1]=t[1]*s[1],n[2]=t[2]*s[2],n[3]=t[3]*s[3],n},m.a0=gf,m.a1=Ve,m.a2=n=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(s=>{t.onloadstart=()=>{s(t)};for(const c of n){const f=window.document.createElement("source");ki(c)||(t.crossOrigin="Anonymous"),f.src=c,t.appendChild(f)}})},m.a3=function(){return ft++},m.a4=y,m.a5=Vc,m.a6=Ma,m.a7=Mo,m.a8=xr,m.a9=by,m.aA=Lt,m.aB=function(n,t){if(!n)return[{command:"setStyle",args:[t]}];let s=[];try{if(!Be(n.version,t.version))return[{command:"setStyle",args:[t]}];Be(n.center,t.center)||s.push({command:"setCenter",args:[t.center]}),Be(n.zoom,t.zoom)||s.push({command:"setZoom",args:[t.zoom]}),Be(n.bearing,t.bearing)||s.push({command:"setBearing",args:[t.bearing]}),Be(n.pitch,t.pitch)||s.push({command:"setPitch",args:[t.pitch]}),Be(n.sprite,t.sprite)||s.push({command:"setSprite",args:[t.sprite]}),Be(n.glyphs,t.glyphs)||s.push({command:"setGlyphs",args:[t.glyphs]}),Be(n.transition,t.transition)||s.push({command:"setTransition",args:[t.transition]}),Be(n.light,t.light)||s.push({command:"setLight",args:[t.light]}),Be(n.terrain,t.terrain)||s.push({command:"setTerrain",args:[t.terrain]}),Be(n.sky,t.sky)||s.push({command:"setSky",args:[t.sky]});const c={},f=[];(function(x,w,T,I){let L;for(L in w=w||{},x=x||{})Object.prototype.hasOwnProperty.call(x,L)&&(Object.prototype.hasOwnProperty.call(w,L)||Dt(L,T,I));for(L in w)Object.prototype.hasOwnProperty.call(w,L)&&(Object.prototype.hasOwnProperty.call(x,L)?Be(x[L],w[L])||(x[L].type==="geojson"&&w[L].type==="geojson"&&Zt(x,w,L)?st(T,{command:"setGeoJSONSourceData",args:[L,w[L].data]}):Kt(L,w,T,I)):rt(L,w,T))})(n.sources,t.sources,f,c);const v=[];n.layers&&n.layers.forEach(x=>{"source"in x&&c[x.source]?s.push({command:"removeLayer",args:[x.id]}):v.push(x)}),s=s.concat(f),function(x,w,T){w=w||[];const I=(x=x||[]).map(yi),L=w.map(yi),O=x.reduce(Ti,{}),$=w.reduce(Ti,{}),j=I.slice(),G=Object.create(null);let Y,ne,he,Ce,pe;for(let be=0,$e=0;be<I.length;be++)Y=I[be],Object.prototype.hasOwnProperty.call($,Y)?$e++:(st(T,{command:"removeLayer",args:[Y]}),j.splice(j.indexOf(Y,$e),1));for(let be=0,$e=0;be<L.length;be++)Y=L[L.length-1-be],j[j.length-1-be]!==Y&&(Object.prototype.hasOwnProperty.call(O,Y)?(st(T,{command:"removeLayer",args:[Y]}),j.splice(j.lastIndexOf(Y,j.length-$e),1)):$e++,Ce=j[j.length-be],st(T,{command:"addLayer",args:[$[Y],Ce]}),j.splice(j.length-be,0,Y),G[Y]=!0);for(let be=0;be<L.length;be++)if(Y=L[be],ne=O[Y],he=$[Y],!G[Y]&&!Be(ne,he))if(Be(ne.source,he.source)&&Be(ne["source-layer"],he["source-layer"])&&Be(ne.type,he.type)){for(pe in Jt(ne.layout,he.layout,T,Y,null,"setLayoutProperty"),Jt(ne.paint,he.paint,T,Y,null,"setPaintProperty"),Be(ne.filter,he.filter)||st(T,{command:"setFilter",args:[Y,he.filter]}),Be(ne.minzoom,he.minzoom)&&Be(ne.maxzoom,he.maxzoom)||st(T,{command:"setLayerZoomRange",args:[Y,he.minzoom,he.maxzoom]}),ne)Object.prototype.hasOwnProperty.call(ne,pe)&&pe!=="layout"&&pe!=="paint"&&pe!=="filter"&&pe!=="metadata"&&pe!=="minzoom"&&pe!=="maxzoom"&&(pe.indexOf("paint.")===0?Jt(ne[pe],he[pe],T,Y,pe.slice(6),"setPaintProperty"):Be(ne[pe],he[pe])||st(T,{command:"setLayerProperty",args:[Y,pe,he[pe]]}));for(pe in he)Object.prototype.hasOwnProperty.call(he,pe)&&!Object.prototype.hasOwnProperty.call(ne,pe)&&pe!=="layout"&&pe!=="paint"&&pe!=="filter"&&pe!=="metadata"&&pe!=="minzoom"&&pe!=="maxzoom"&&(pe.indexOf("paint.")===0?Jt(ne[pe],he[pe],T,Y,pe.slice(6),"setPaintProperty"):Be(ne[pe],he[pe])||st(T,{command:"setLayerProperty",args:[Y,pe,he[pe]]}))}else st(T,{command:"removeLayer",args:[Y]}),Ce=j[j.lastIndexOf(Y)+1],st(T,{command:"addLayer",args:[he,Ce]})}(v,t.layers,s)}catch(c){console.warn("Unable to compute style diff:",c),s=[{command:"setStyle",args:[t]}]}return s},m.aC=function(n){const t=[],s=n.id;return s===void 0&&t.push({message:`layers.${s}: missing required property "id"`}),n.render===void 0&&t.push({message:`layers.${s}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&t.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),t},m.aD=function n(t,s){if(Array.isArray(t)){if(!Array.isArray(s)||t.length!==s.length)return!1;for(let c=0;c<t.length;c++)if(!n(t[c],s[c]))return!1;return!0}if(typeof t=="object"&&t!==null&&s!==null){if(typeof s!="object"||Object.keys(t).length!==Object.keys(s).length)return!1;for(const c in t)if(!n(t[c],s[c]))return!1;return!0}return t===s},m.aE=At,m.aF=Ot,m.aG=class extends an{constructor(n,t){super(n,t),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},m.aH=ds,m.aI=class extends an{constructor(n,t){super(n,t),this.current=Kl}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let t=1;t<16;t++)if(n[t]!==this.current[t]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},m.aJ=la,m.aK=class extends an{constructor(n,t){super(n,t),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},m.aL=class extends an{constructor(n,t){super(n,t),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},m.aM=Za,m.aN=function(n,t,s,c,f,v,x){var w=1/(t-s),T=1/(c-f),I=1/(v-x);return n[0]=-2*w,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*T,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*I,n[11]=0,n[12]=(t+s)*w,n[13]=(f+c)*T,n[14]=(x+v)*I,n[15]=1,n},m.aO=Vi,m.aP=p1,m.aQ=class extends Ic{},m.aR=ob,m.aS=class extends Ac{},m.aT=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},m.aU=Sg,m.aV=B,m.aW=class extends Ou{},m.aX=Oe,m.aY=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]&&n[9]===t[9]&&n[10]===t[10]&&n[11]===t[11]&&n[12]===t[12]&&n[13]===t[13]&&n[14]===t[14]&&n[15]===t[15]},m.aZ=function(n,t){var s=n[0],c=n[1],f=n[2],v=n[3],x=n[4],w=n[5],T=n[6],I=n[7],L=n[8],O=n[9],$=n[10],j=n[11],G=n[12],Y=n[13],ne=n[14],he=n[15],Ce=t[0],pe=t[1],be=t[2],$e=t[3],He=t[4],It=t[5],Nt=t[6],Et=t[7],bt=t[8],ct=t[9],Rt=t[10],_t=t[11],tt=t[12],Qt=t[13],jt=t[14],Si=t[15];return Math.abs(s-Ce)<=Jn*Math.max(1,Math.abs(s),Math.abs(Ce))&&Math.abs(c-pe)<=Jn*Math.max(1,Math.abs(c),Math.abs(pe))&&Math.abs(f-be)<=Jn*Math.max(1,Math.abs(f),Math.abs(be))&&Math.abs(v-$e)<=Jn*Math.max(1,Math.abs(v),Math.abs($e))&&Math.abs(x-He)<=Jn*Math.max(1,Math.abs(x),Math.abs(He))&&Math.abs(w-It)<=Jn*Math.max(1,Math.abs(w),Math.abs(It))&&Math.abs(T-Nt)<=Jn*Math.max(1,Math.abs(T),Math.abs(Nt))&&Math.abs(I-Et)<=Jn*Math.max(1,Math.abs(I),Math.abs(Et))&&Math.abs(L-bt)<=Jn*Math.max(1,Math.abs(L),Math.abs(bt))&&Math.abs(O-ct)<=Jn*Math.max(1,Math.abs(O),Math.abs(ct))&&Math.abs($-Rt)<=Jn*Math.max(1,Math.abs($),Math.abs(Rt))&&Math.abs(j-_t)<=Jn*Math.max(1,Math.abs(j),Math.abs(_t))&&Math.abs(G-tt)<=Jn*Math.max(1,Math.abs(G),Math.abs(tt))&&Math.abs(Y-Qt)<=Jn*Math.max(1,Math.abs(Y),Math.abs(Qt))&&Math.abs(ne-jt)<=Jn*Math.max(1,Math.abs(ne),Math.abs(jt))&&Math.abs(he-Si)<=Jn*Math.max(1,Math.abs(he),Math.abs(Si))},m.a_=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},m.aa=function(n){const t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,c,f,v)=>{const x=f||v;return t[c]=!x||x.toLowerCase(),""}),t["max-age"]){const s=parseInt(t["max-age"],10);isNaN(s)?delete t["max-age"]:t["max-age"]=s}return t},m.ab=function(n,t){const s=[];for(const c in n)c in t||s.push(c);return s},m.ac=Ue,m.ad=function(n,t,s){var c=Math.sin(s),f=Math.cos(s),v=t[0],x=t[1],w=t[2],T=t[3],I=t[4],L=t[5],O=t[6],$=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=v*f+I*c,n[1]=x*f+L*c,n[2]=w*f+O*c,n[3]=T*f+$*c,n[4]=I*f-v*c,n[5]=L*f-x*c,n[6]=O*f-w*c,n[7]=$*f-T*c,n},m.ae=function(n){var t=new Oc(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},m.af=fd,m.ag=function(n,t){let s=0,c=0;if(n.kind==="constant")c=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:f,minZoom:v,maxZoom:x}=n,w=f?Ue(en.interpolationFactor(f,t,v,x),0,1):0;n.kind==="camera"?c=fn.number(n.minSize,n.maxSize,w):s=w}return{uSizeT:s,uSize:c}},m.ai=function(n,{uSize:t,uSizeT:s},{lowerSize:c,upperSize:f}){return n.kind==="source"?c/Ya:n.kind==="composite"?fn.number(c/Ya,f/Ya,s):t},m.aj=uf,m.ak=function(n,t,s,c){const f=t.y-n.y,v=t.x-n.x,x=c.y-s.y,w=c.x-s.x,T=x*v-w*f;if(T===0)return null;const I=(w*(n.y-s.y)-x*(n.x-s.x))/T;return new k(n.x+I*v,n.y+I*f)},m.al=Ey,m.am=Bu,m.an=Vp,m.ao=on,m.aq=cf,m.ar=function(n,t){var s=t[0],c=t[1],f=t[2],v=t[3],x=t[4],w=t[5],T=t[6],I=t[7],L=t[8],O=t[9],$=t[10],j=t[11],G=t[12],Y=t[13],ne=t[14],he=t[15],Ce=s*w-c*x,pe=s*T-f*x,be=s*I-v*x,$e=c*T-f*w,He=c*I-v*w,It=f*I-v*T,Nt=L*Y-O*G,Et=L*ne-$*G,bt=L*he-j*G,ct=O*ne-$*Y,Rt=O*he-j*Y,_t=$*he-j*ne,tt=Ce*_t-pe*Rt+be*ct+$e*bt-He*Et+It*Nt;return tt?(n[0]=(w*_t-T*Rt+I*ct)*(tt=1/tt),n[1]=(f*Rt-c*_t-v*ct)*tt,n[2]=(Y*It-ne*He+he*$e)*tt,n[3]=($*He-O*It-j*$e)*tt,n[4]=(T*bt-x*_t-I*Et)*tt,n[5]=(s*_t-f*bt+v*Et)*tt,n[6]=(ne*be-G*It-he*pe)*tt,n[7]=(L*It-$*be+j*pe)*tt,n[8]=(x*Rt-w*bt+I*Nt)*tt,n[9]=(c*bt-s*Rt-v*Nt)*tt,n[10]=(G*He-Y*be+he*Ce)*tt,n[11]=(O*be-L*He-j*Ce)*tt,n[12]=(w*Et-x*ct-T*Nt)*tt,n[13]=(s*ct-c*Et+f*Nt)*tt,n[14]=(Y*pe-G*$e-ne*Ce)*tt,n[15]=(L*$e-O*pe+$*Ce)*tt,n):null},m.as=_f,m.at=lf,m.au=vf,m.av=function(){const n={},t=ce.$version;for(const s in ce.$root){const c=ce.$root[s];if(c.required){let f=null;f=s==="version"?t:c.type==="array"?[]:{},f!=null&&(n[s]=f)}}return n},m.aw=Ul,m.ax=ut,m.ay=function(n){n=n.slice();const t=Object.create(null);for(let s=0;s<n.length;s++)t[n[s].id]=n[s];for(let s=0;s<n.length;s++)"ref"in n[s]&&(n[s]=Pt(n[s],t[n[s].ref]));return n},m.az=function(n){if(n.type==="custom")return new Db(n);switch(n.type){case"background":return new Ab(n);case"circle":return new f1(n);case"fill":return new R1(n);case"fill-extrusion":return new X1(n);case"heatmap":return new g1(n);case"hillshade":return new _1(n);case"line":return new rb(n);case"raster":return new kb(n);case"symbol":return new Sd(n)}},m.b=ai,m.b0=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]},m.b1=Xe,m.b2=_y,m.b3=gy,m.b4=function(n,t,s,c,f){var v,x=1/Math.tan(t/2);return n[0]=x/s,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=x,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,f!=null&&f!==1/0?(n[10]=(f+c)*(v=1/(c-f)),n[14]=2*f*c*v):(n[10]=-1,n[14]=-2*c),n},m.b5=function(n,t,s){var c=Math.sin(s),f=Math.cos(s),v=t[4],x=t[5],w=t[6],T=t[7],I=t[8],L=t[9],O=t[10],$=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=v*f+I*c,n[5]=x*f+L*c,n[6]=w*f+O*c,n[7]=T*f+$*c,n[8]=I*f-v*c,n[9]=L*f-x*c,n[10]=O*f-w*c,n[11]=$*f-T*c,n},m.b6=ee,m.b7=Ie,m.b8=function(n){return n*Math.PI/180},m.b9=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},m.bA=Wa,m.ba=class extends Ia{},m.bb=ff,m.bc=jb,m.be=Tt,m.bf=function(n,t){ji.REGISTERED_PROTOCOLS[n]=t},m.bg=function(n){delete ji.REGISTERED_PROTOCOLS[n]},m.bh=function(n,t){const s={};for(let f=0;f<n.length;f++){const v=t&&t[n[f].id]||Bl(n[f]);t&&(t[n[f].id]=v);let x=s[v];x||(x=s[v]=[]),x.push(n[f])}const c=[];for(const f in s)c.push(s[f]);return c},m.bi=Ct,m.bj=xy,m.bk=wy,m.bl=ey,m.bm=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=$r/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const t=n.bucket.layers[0],s=t.layout,c=t._unevaluatedLayout._values,f={layoutIconSize:c["icon-size"].possiblyEvaluate(new xr(n.bucket.zoom+1),n.canonical),layoutTextSize:c["text-size"].possiblyEvaluate(new xr(n.bucket.zoom+1),n.canonical),textMaxSize:c["text-size"].possiblyEvaluate(new xr(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:I,maxZoom:L}=n.bucket.textSizeData;f.compositeTextSizes=[c["text-size"].possiblyEvaluate(new xr(I),n.canonical),c["text-size"].possiblyEvaluate(new xr(L),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:I,maxZoom:L}=n.bucket.iconSizeData;f.compositeIconSizes=[c["icon-size"].possiblyEvaluate(new xr(I),n.canonical),c["icon-size"].possiblyEvaluate(new xr(L),n.canonical)]}const v=s.get("text-line-height")*on,x=s.get("text-rotation-alignment")!=="viewport"&&s.get("symbol-placement")!=="point",w=s.get("text-keep-upright"),T=s.get("text-size");for(const I of n.bucket.features){const L=s.get("text-font").evaluate(I,{},n.canonical).join(","),O=T.evaluate(I,{},n.canonical),$=f.layoutTextSize.evaluate(I,{},n.canonical),j=f.layoutIconSize.evaluate(I,{},n.canonical),G={horizontal:{},vertical:void 0},Y=I.text;let ne,he=[0,0];if(Y){const be=Y.toString(),$e=s.get("text-letter-spacing").evaluate(I,{},n.canonical)*on,He=yo(be)?$e:0,It=s.get("text-anchor").evaluate(I,{},n.canonical),Nt=Ry(t,I,n.canonical);if(!Nt){const _t=s.get("text-radial-offset").evaluate(I,{},n.canonical);he=_t?Ly(It,[_t*on,yf]):s.get("text-offset").evaluate(I,{},n.canonical).map(tt=>tt*on)}let Et=x?"center":s.get("text-justify").evaluate(I,{},n.canonical);const bt=s.get("symbol-placement"),ct=bt==="point"?s.get("text-max-width").evaluate(I,{},n.canonical)*on:0,Rt=()=>{n.bucket.allowVerticalPlacement&&oa(be)&&(G.vertical=bd(Y,n.glyphMap,n.glyphPositions,n.imagePositions,L,ct,v,It,"left",He,he,m.ah.vertical,!0,bt,$,O))};if(!x&&Nt){const _t=new Set;if(Et==="auto")for(let Qt=0;Qt<Nt.values.length;Qt+=2)_t.add(_f(Nt.values[Qt]));else _t.add(Et);let tt=!1;for(const Qt of _t)if(!G.horizontal[Qt])if(tt)G.horizontal[Qt]=G.horizontal[0];else{const jt=bd(Y,n.glyphMap,n.glyphPositions,n.imagePositions,L,ct,v,"center",Qt,He,he,m.ah.horizontal,!1,bt,$,O);jt&&(G.horizontal[Qt]=jt,tt=jt.positionedLines.length===1)}Rt()}else{Et==="auto"&&(Et=_f(It));const _t=bd(Y,n.glyphMap,n.glyphPositions,n.imagePositions,L,ct,v,It,Et,He,he,m.ah.horizontal,!1,bt,$,O);_t&&(G.horizontal[Et]=_t),Rt(),oa(be)&&x&&w&&(G.vertical=bd(Y,n.glyphMap,n.glyphPositions,n.imagePositions,L,ct,v,It,Et,He,he,m.ah.vertical,!1,bt,$,O))}}let Ce=!1;if(I.icon&&I.icon.name){const be=n.imageMap[I.icon.name];be&&(ne=Sb(n.imagePositions[I.icon.name],s.get("icon-offset").evaluate(I,{},n.canonical),s.get("icon-anchor").evaluate(I,{},n.canonical)),Ce=!!be.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=Ce:n.bucket.sdfIcons!==Ce&&Ei("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(be.pixelRatio!==n.bucket.pixelRatio||s.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const pe=Oy(G.horizontal)||G.vertical;n.bucket.iconsInText=!!pe&&pe.iconsInText,(pe||ne)&&Ub(n.bucket,I,G,ne,n.imageMap,f,$,j,he,Ce,n.canonical)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},m.bn=tf,m.bo=Jp,m.bp=ef,m.bq=nl,m.br=nf,m.bs=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},m.bt=function(n,t,s,c,f){return l(this,void 0,void 0,function*(){if(we())try{return yield Bi(n,t,s,c,f)}catch{}return function(v,x,w,T,I){const L=v.width,O=v.height;We&&it||(We=new OffscreenCanvas(L,O),it=We.getContext("2d",{willReadFrequently:!0})),We.width=L,We.height=O,it.drawImage(v,0,0,L,O);const $=it.getImageData(x,w,T,I);return it.clearRect(0,0,L,O),$.data}(n,t,s,c,f)})},m.bu=vy,m.bv=M,m.bw=A,m.bx=Gg,m.by=Ms,m.bz=function(n){return n.message===Qe},m.c=Xi,m.d=n=>l(void 0,void 0,void 0,function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(t)}catch(s){throw new Error(`Could not load image because of ${s.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),m.e=nt,m.f=n=>new Promise((t,s)=>{const c=new Image;c.onload=()=>{t(c),URL.revokeObjectURL(c.src),c.onload=null,window.requestAnimationFrame(()=>{c.src=Zi})},c.onerror=()=>s(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const f=new Blob([new Uint8Array(n)],{type:"image/png"});c.src=n.byteLength?URL.createObjectURL(f):Zi}),m.g=Mi,m.h=(n,t)=>et(nt(n,{type:"json"}),t),m.i=kt,m.j=De,m.k=ue,m.l=(n,t)=>et(nt(n,{type:"arrayBuffer"}),t),m.m=et,m.n=function(n){return new nf(n).readFields(_b,[])},m.o=qu,m.p=Qg,m.q=Yn,m.r=il,m.s=ki,m.t=rn,m.u=vt,m.v=ce,m.w=Ei,m.x=Ri,m.y=function([n,t,s]){return t+=90,t*=Math.PI/180,s*=Math.PI/180,{x:n*Math.cos(t)*Math.sin(s),y:n*Math.sin(t)*Math.sin(s),z:n*Math.cos(s)}},m.z=fn}),d("worker",["./shared"],function(m){class l{constructor(N){this.keyCache={},N&&this.replace(N)}replace(N){this._layerConfigs={},this._layers={},this.update(N,[])}update(N,U){for(const Q of N){this._layerConfigs[Q.id]=Q;const ve=this._layers[Q.id]=m.az(Q);ve._featureFilter=m.a6(ve.filter),this.keyCache[Q.id]&&delete this.keyCache[Q.id]}for(const Q of U)delete this.keyCache[Q],delete this._layerConfigs[Q],delete this._layers[Q];this.familiesBySource={};const H=m.bh(Object.values(this._layerConfigs),this.keyCache);for(const Q of H){const ve=Q.map(ze=>this._layers[ze.id]),xe=ve[0];if(xe.visibility==="none")continue;const Se=xe.source||"";let de=this.familiesBySource[Se];de||(de=this.familiesBySource[Se]={});const Ae=xe.sourceLayer||"_geojsonTileLayer";let Ge=de[Ae];Ge||(Ge=de[Ae]=[]),Ge.push(ve)}}}class M{constructor(N){const U={},H=[];for(const Se in N){const de=N[Se],Ae=U[Se]={};for(const Ge in de){const ze=de[+Ge];if(!ze||ze.bitmap.width===0||ze.bitmap.height===0)continue;const Ne={x:0,y:0,w:ze.bitmap.width+2,h:ze.bitmap.height+2};H.push(Ne),Ae[Ge]={rect:Ne,metrics:ze.metrics}}}const{w:Q,h:ve}=m.p(H),xe=new m.o({width:Q||1,height:ve||1});for(const Se in N){const de=N[Se];for(const Ae in de){const Ge=de[+Ae];if(!Ge||Ge.bitmap.width===0||Ge.bitmap.height===0)continue;const ze=U[Se][Ae].rect;m.o.copy(Ge.bitmap,xe,{x:0,y:0},{x:ze.x+1,y:ze.y+1},Ge.bitmap)}}this.image=xe,this.positions=U}}m.bi("GlyphAtlas",M);class A{constructor(N){this.tileID=new m.Q(N.tileID.overscaledZ,N.tileID.wrap,N.tileID.canonical.z,N.tileID.canonical.x,N.tileID.canonical.y),this.uid=N.uid,this.zoom=N.zoom,this.pixelRatio=N.pixelRatio,this.tileSize=N.tileSize,this.source=N.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=N.showCollisionBoxes,this.collectResourceTiming=!!N.collectResourceTiming,this.returnDependencies=!!N.returnDependencies,this.promoteId=N.promoteId,this.inFlightDependencies=[]}parse(N,U,H,Q){return m._(this,void 0,void 0,function*(){this.status="parsing",this.data=N,this.collisionBoxArray=new m.a4;const ve=new m.bj(Object.keys(N.layers).sort()),xe=new m.bk(this.tileID,this.promoteId);xe.bucketLayerIDs=[];const Se={},de={featureIndex:xe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:H},Ae=U.familiesBySource[this.source];for(const Yt in Ae){const _r=N.layers[Yt];if(!_r)continue;_r.version===1&&m.w(`Vector tile source "${this.source}" layer "${Yt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Vr=ve.encode(Yt),xn=[];for(let bn=0;bn<_r.length;bn++){const Zr=_r.feature(bn),Hn=xe.getId(Zr,Yt);xn.push({feature:Zr,id:Hn,index:bn,sourceLayerIndex:Vr})}for(const bn of Ae[Yt]){const Zr=bn[0];Zr.source!==this.source&&m.w(`layer.source = ${Zr.source} does not equal this.source = ${this.source}`),Zr.minzoom&&this.zoom<Math.floor(Zr.minzoom)||Zr.maxzoom&&this.zoom>=Zr.maxzoom||Zr.visibility!=="none"&&(R(bn,this.zoom,H),(Se[Zr.id]=Zr.createBucket({index:xe.bucketLayerIDs.length,layers:bn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Vr,sourceID:this.source})).populate(xn,de,this.tileID.canonical),xe.bucketLayerIDs.push(bn.map(Hn=>Hn.id)))}}const Ge=m.aE(de.glyphDependencies,Yt=>Object.keys(Yt).map(Number));this.inFlightDependencies.forEach(Yt=>Yt==null?void 0:Yt.abort()),this.inFlightDependencies=[];let ze=Promise.resolve({});if(Object.keys(Ge).length){const Yt=new AbortController;this.inFlightDependencies.push(Yt),ze=Q.sendAsync({type:"GG",data:{stacks:Ge,source:this.source,tileID:this.tileID,type:"glyphs"}},Yt)}const Ne=Object.keys(de.iconDependencies);let Vt=Promise.resolve({});if(Ne.length){const Yt=new AbortController;this.inFlightDependencies.push(Yt),Vt=Q.sendAsync({type:"GI",data:{icons:Ne,source:this.source,tileID:this.tileID,type:"icons"}},Yt)}const Wt=Object.keys(de.patternDependencies);let ri=Promise.resolve({});if(Wt.length){const Yt=new AbortController;this.inFlightDependencies.push(Yt),ri=Q.sendAsync({type:"GI",data:{icons:Wt,source:this.source,tileID:this.tileID,type:"patterns"}},Yt)}const[ni,vi,Ui]=yield Promise.all([ze,Vt,ri]),cr=new M(ni),Br=new m.bl(vi,Ui);for(const Yt in Se){const _r=Se[Yt];_r instanceof m.a5?(R(_r.layers,this.zoom,H),m.bm({bucket:_r,glyphMap:ni,glyphPositions:cr.positions,imageMap:vi,imagePositions:Br.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):_r.hasPattern&&(_r instanceof m.bn||_r instanceof m.bo||_r instanceof m.bp)&&(R(_r.layers,this.zoom,H),_r.addFeatures(de,this.tileID.canonical,Br.patternPositions))}return this.status="done",{buckets:Object.values(Se).filter(Yt=>!Yt.isEmpty()),featureIndex:xe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:cr.image,imageAtlas:Br,glyphMap:this.returnDependencies?ni:null,iconMap:this.returnDependencies?vi:null,glyphPositions:this.returnDependencies?cr.positions:null}})}}function R(ie,N,U){const H=new m.a8(N);for(const Q of ie)Q.recalculate(H,U)}class k{constructor(N,U,H){this.actor=N,this.layerIndex=U,this.availableImages=H,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(N,U){return m._(this,void 0,void 0,function*(){const H=yield m.l(N.request,U);try{return{vectorTile:new m.bq.VectorTile(new m.br(H.data)),rawData:H.data,cacheControl:H.cacheControl,expires:H.expires}}catch(Q){const ve=new Uint8Array(H.data);let xe=`Unable to parse the tile at ${N.request.url}, `;throw xe+=ve[0]===31&&ve[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Q.messge}`,new Error(xe)}})}loadTile(N){return m._(this,void 0,void 0,function*(){const U=N.uid,H=!!(N&&N.request&&N.request.collectResourceTiming)&&new m.bs(N.request),Q=new A(N);this.loading[U]=Q;const ve=new AbortController;Q.abort=ve;try{const xe=yield this.loadVectorTile(N,ve);if(delete this.loading[U],!xe)return null;const Se=xe.rawData,de={};xe.expires&&(de.expires=xe.expires),xe.cacheControl&&(de.cacheControl=xe.cacheControl);const Ae={};if(H){const ze=H.finish();ze&&(Ae.resourceTiming=JSON.parse(JSON.stringify(ze)))}Q.vectorTile=xe.vectorTile;const Ge=Q.parse(xe.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[U]=Q,this.fetching[U]={rawTileData:Se,cacheControl:de,resourceTiming:Ae};try{const ze=yield Ge;return m.e({rawTileData:Se.slice(0)},ze,de,Ae)}finally{delete this.fetching[U]}}catch(xe){throw delete this.loading[U],Q.status="done",this.loaded[U]=Q,xe}})}reloadTile(N){return m._(this,void 0,void 0,function*(){const U=N.uid;if(!this.loaded||!this.loaded[U])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const H=this.loaded[U];if(H.showCollisionBoxes=N.showCollisionBoxes,H.status==="parsing"){const Q=yield H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor);let ve;if(this.fetching[U]){const{rawTileData:xe,cacheControl:Se,resourceTiming:de}=this.fetching[U];delete this.fetching[U],ve=m.e({rawTileData:xe.slice(0)},Q,Se,de)}else ve=Q;return ve}if(H.status==="done"&&H.vectorTile)return H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(N){return m._(this,void 0,void 0,function*(){const U=this.loading,H=N.uid;U&&U[H]&&U[H].abort&&(U[H].abort.abort(),delete U[H])})}removeTile(N){return m._(this,void 0,void 0,function*(){this.loaded&&this.loaded[N.uid]&&delete this.loaded[N.uid]})}}class z{constructor(){this.loaded={}}loadTile(N){return m._(this,void 0,void 0,function*(){const{uid:U,encoding:H,rawImageData:Q,redFactor:ve,greenFactor:xe,blueFactor:Se,baseShift:de}=N,Ae=Q.width+2,Ge=Q.height+2,ze=m.b(Q)?new m.R({width:Ae,height:Ge},yield m.bt(Q,-1,-1,Ae,Ge)):Q,Ne=new m.bu(U,ze,H,ve,xe,Se,de);return this.loaded=this.loaded||{},this.loaded[U]=Ne,Ne})}removeTile(N){const U=this.loaded,H=N.uid;U&&U[H]&&delete U[H]}}function W(ie,N){if(ie.length!==0){Z(ie[0],N);for(var U=1;U<ie.length;U++)Z(ie[U],!N)}}function Z(ie,N){for(var U=0,H=0,Q=0,ve=ie.length,xe=ve-1;Q<ve;xe=Q++){var Se=(ie[Q][0]-ie[xe][0])*(ie[xe][1]+ie[Q][1]),de=U+Se;H+=Math.abs(U)>=Math.abs(Se)?U-de+Se:Se-de+U,U=de}U+H>=0!=!!N&&ie.reverse()}var X=m.bv(function ie(N,U){var H,Q=N&&N.type;if(Q==="FeatureCollection")for(H=0;H<N.features.length;H++)ie(N.features[H],U);else if(Q==="GeometryCollection")for(H=0;H<N.geometries.length;H++)ie(N.geometries[H],U);else if(Q==="Feature")ie(N.geometry,U);else if(Q==="Polygon")W(N.coordinates,U);else if(Q==="MultiPolygon")for(H=0;H<N.coordinates.length;H++)W(N.coordinates[H],U);return N});const fe=m.bq.VectorTileFeature.prototype.toGeoJSON;var ye={exports:{}},we=m.bw,ee=m.bq.VectorTileFeature,Ie=Ue;function Ue(ie,N){this.options=N||{},this.features=ie,this.length=ie.length}function Xe(ie,N){this.id=typeof ie.id=="number"?ie.id:void 0,this.type=ie.type,this.rawGeometry=ie.type===1?[ie.geometry]:ie.geometry,this.properties=ie.tags,this.extent=N||4096}Ue.prototype.feature=function(ie){return new Xe(this.features[ie],this.options.extent)},Xe.prototype.loadGeometry=function(){var ie=this.rawGeometry;this.geometry=[];for(var N=0;N<ie.length;N++){for(var U=ie[N],H=[],Q=0;Q<U.length;Q++)H.push(new we(U[Q][0],U[Q][1]));this.geometry.push(H)}return this.geometry},Xe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ie=this.geometry,N=1/0,U=-1/0,H=1/0,Q=-1/0,ve=0;ve<ie.length;ve++)for(var xe=ie[ve],Se=0;Se<xe.length;Se++){var de=xe[Se];N=Math.min(N,de.x),U=Math.max(U,de.x),H=Math.min(H,de.y),Q=Math.max(Q,de.y)}return[N,H,U,Q]},Xe.prototype.toGeoJSON=ee.prototype.toGeoJSON;var nt=m.bx,ft=Ie;function At(ie){var N=new nt;return function(U,H){for(var Q in U.layers)H.writeMessage(3,Ot,U.layers[Q])}(ie,N),N.finish()}function Ot(ie,N){var U;N.writeVarintField(15,ie.version||1),N.writeStringField(1,ie.name||""),N.writeVarintField(5,ie.extent||4096);var H={keys:[],values:[],keycache:{},valuecache:{}};for(U=0;U<ie.length;U++)H.feature=ie.feature(U),N.writeMessage(2,Lt,H);var Q=H.keys;for(U=0;U<Q.length;U++)N.writeStringField(3,Q[U]);var ve=H.values;for(U=0;U<ve.length;U++)N.writeMessage(4,kt,ve[U])}function Lt(ie,N){var U=ie.feature;U.id!==void 0&&N.writeVarintField(1,U.id),N.writeMessage(2,li,ie),N.writeVarintField(3,U.type),N.writeMessage(4,xt,U)}function li(ie,N){var U=ie.feature,H=ie.keys,Q=ie.values,ve=ie.keycache,xe=ie.valuecache;for(var Se in U.properties){var de=U.properties[Se],Ae=ve[Se];if(de!==null){Ae===void 0&&(H.push(Se),ve[Se]=Ae=H.length-1),N.writeVarint(Ae);var Ge=typeof de;Ge!=="string"&&Ge!=="boolean"&&Ge!=="number"&&(de=JSON.stringify(de));var ze=Ge+":"+de,Ne=xe[ze];Ne===void 0&&(Q.push(de),xe[ze]=Ne=Q.length-1),N.writeVarint(Ne)}}}function Ei(ie,N){return(N<<3)+(7&ie)}function ci(ie){return ie<<1^ie>>31}function xt(ie,N){for(var U=ie.loadGeometry(),H=ie.type,Q=0,ve=0,xe=U.length,Se=0;Se<xe;Se++){var de=U[Se],Ae=1;H===1&&(Ae=de.length),N.writeVarint(Ei(1,Ae));for(var Ge=H===3?de.length-1:de.length,ze=0;ze<Ge;ze++){ze===1&&H!==1&&N.writeVarint(Ei(2,Ge-1));var Ne=de[ze].x-Q,Vt=de[ze].y-ve;N.writeVarint(ci(Ne)),N.writeVarint(ci(Vt)),Q+=Ne,ve+=Vt}H===3&&N.writeVarint(Ei(7,1))}}function kt(ie,N){var U=typeof ie;U==="string"?N.writeStringField(1,ie):U==="boolean"?N.writeBooleanField(7,ie):U==="number"&&(ie%1!=0?N.writeDoubleField(3,ie):ie<0?N.writeSVarintField(6,ie):N.writeVarintField(5,ie))}ye.exports=At,ye.exports.fromVectorTileJs=At,ye.exports.fromGeojsonVt=function(ie,N){N=N||{};var U={};for(var H in ie)U[H]=new ft(ie[H].features,N),U[H].name=H,U[H].version=N.version,U[H].extent=N.extent;return At({layers:U})},ye.exports.GeoJSONWrapper=ft;var $t=m.bv(ye.exports);const ai={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ie=>ie},Zi=Math.fround||(Bi=new Float32Array(1),ie=>(Bi[0]=+ie,Bi[0]));var Bi;const We=3,it=5,Qe=6;class Xi{constructor(N){this.options=Object.assign(Object.create(ai),N),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(N){const{log:U,minZoom:H,maxZoom:Q}=this.options;U&&console.time("total time");const ve=`prepare ${N.length} points`;U&&console.time(ve),this.points=N;const xe=[];for(let de=0;de<N.length;de++){const Ae=N[de];if(!Ae.geometry)continue;const[Ge,ze]=Ae.geometry.coordinates,Ne=Zi(je(Ge)),Vt=Zi(Tt(ze));xe.push(Ne,Vt,1/0,de,-1,1),this.options.reduce&&xe.push(0)}let Se=this.trees[Q+1]=this._createTree(xe);U&&console.timeEnd(ve);for(let de=Q;de>=H;de--){const Ae=+Date.now();Se=this.trees[de]=this._createTree(this._cluster(Se,de)),U&&console.log("z%d: %d clusters in %dms",de,Se.numItems,+Date.now()-Ae)}return U&&console.timeEnd("total time"),this}getClusters(N,U){let H=((N[0]+180)%360+360)%360-180;const Q=Math.max(-90,Math.min(90,N[1]));let ve=N[2]===180?180:((N[2]+180)%360+360)%360-180;const xe=Math.max(-90,Math.min(90,N[3]));if(N[2]-N[0]>=360)H=-180,ve=180;else if(H>ve){const ze=this.getClusters([H,Q,180,xe],U),Ne=this.getClusters([-180,Q,ve,xe],U);return ze.concat(Ne)}const Se=this.trees[this._limitZoom(U)],de=Se.range(je(H),Tt(xe),je(ve),Tt(Q)),Ae=Se.data,Ge=[];for(const ze of de){const Ne=this.stride*ze;Ge.push(Ae[Ne+it]>1?ji(Ae,Ne,this.clusterProps):this.points[Ae[Ne+We]])}return Ge}getChildren(N){const U=this._getOriginId(N),H=this._getOriginZoom(N),Q="No cluster with the specified id.",ve=this.trees[H];if(!ve)throw new Error(Q);const xe=ve.data;if(U*this.stride>=xe.length)throw new Error(Q);const Se=this.options.radius/(this.options.extent*Math.pow(2,H-1)),de=ve.within(xe[U*this.stride],xe[U*this.stride+1],Se),Ae=[];for(const Ge of de){const ze=Ge*this.stride;xe[ze+4]===N&&Ae.push(xe[ze+it]>1?ji(xe,ze,this.clusterProps):this.points[xe[ze+We]])}if(Ae.length===0)throw new Error(Q);return Ae}getLeaves(N,U,H){const Q=[];return this._appendLeaves(Q,N,U=U||10,H=H||0,0),Q}getTile(N,U,H){const Q=this.trees[this._limitZoom(N)],ve=Math.pow(2,N),{extent:xe,radius:Se}=this.options,de=Se/xe,Ae=(H-de)/ve,Ge=(H+1+de)/ve,ze={features:[]};return this._addTileFeatures(Q.range((U-de)/ve,Ae,(U+1+de)/ve,Ge),Q.data,U,H,ve,ze),U===0&&this._addTileFeatures(Q.range(1-de/ve,Ae,1,Ge),Q.data,ve,H,ve,ze),U===ve-1&&this._addTileFeatures(Q.range(0,Ae,de/ve,Ge),Q.data,-1,H,ve,ze),ze.features.length?ze:null}getClusterExpansionZoom(N){let U=this._getOriginZoom(N)-1;for(;U<=this.options.maxZoom;){const H=this.getChildren(N);if(U++,H.length!==1)break;N=H[0].properties.cluster_id}return U}_appendLeaves(N,U,H,Q,ve){const xe=this.getChildren(U);for(const Se of xe){const de=Se.properties;if(de&&de.cluster?ve+de.point_count<=Q?ve+=de.point_count:ve=this._appendLeaves(N,de.cluster_id,H,Q,ve):ve<Q?ve++:N.push(Se),N.length===H)break}return ve}_createTree(N){const U=new m.au(N.length/this.stride|0,this.options.nodeSize,Float32Array);for(let H=0;H<N.length;H+=this.stride)U.add(N[H],N[H+1]);return U.finish(),U.data=N,U}_addTileFeatures(N,U,H,Q,ve,xe){for(const Se of N){const de=Se*this.stride,Ae=U[de+it]>1;let Ge,ze,Ne;if(Ae)Ge=Mi(U,de,this.clusterProps),ze=U[de],Ne=U[de+1];else{const ri=this.points[U[de+We]];Ge=ri.properties;const[ni,vi]=ri.geometry.coordinates;ze=je(ni),Ne=Tt(vi)}const Vt={type:1,geometry:[[Math.round(this.options.extent*(ze*ve-H)),Math.round(this.options.extent*(Ne*ve-Q))]],tags:Ge};let Wt;Wt=Ae||this.options.generateId?U[de+We]:this.points[U[de+We]].id,Wt!==void 0&&(Vt.id=Wt),xe.features.push(Vt)}}_limitZoom(N){return Math.max(this.options.minZoom,Math.min(Math.floor(+N),this.options.maxZoom+1))}_cluster(N,U){const{radius:H,extent:Q,reduce:ve,minPoints:xe}=this.options,Se=H/(Q*Math.pow(2,U)),de=N.data,Ae=[],Ge=this.stride;for(let ze=0;ze<de.length;ze+=Ge){if(de[ze+2]<=U)continue;de[ze+2]=U;const Ne=de[ze],Vt=de[ze+1],Wt=N.within(de[ze],de[ze+1],Se),ri=de[ze+it];let ni=ri;for(const vi of Wt){const Ui=vi*Ge;de[Ui+2]>U&&(ni+=de[Ui+it])}if(ni>ri&&ni>=xe){let vi,Ui=Ne*ri,cr=Vt*ri,Br=-1;const Yt=((ze/Ge|0)<<5)+(U+1)+this.points.length;for(const _r of Wt){const Vr=_r*Ge;if(de[Vr+2]<=U)continue;de[Vr+2]=U;const xn=de[Vr+it];Ui+=de[Vr]*xn,cr+=de[Vr+1]*xn,de[Vr+4]=Yt,ve&&(vi||(vi=this._map(de,ze,!0),Br=this.clusterProps.length,this.clusterProps.push(vi)),ve(vi,this._map(de,Vr)))}de[ze+4]=Yt,Ae.push(Ui/ni,cr/ni,1/0,Yt,-1,ni),ve&&Ae.push(Br)}else{for(let vi=0;vi<Ge;vi++)Ae.push(de[ze+vi]);if(ni>1)for(const vi of Wt){const Ui=vi*Ge;if(!(de[Ui+2]<=U)){de[Ui+2]=U;for(let cr=0;cr<Ge;cr++)Ae.push(de[Ui+cr])}}}}return Ae}_getOriginId(N){return N-this.points.length>>5}_getOriginZoom(N){return(N-this.points.length)%32}_map(N,U,H){if(N[U+it]>1){const xe=this.clusterProps[N[U+Qe]];return H?Object.assign({},xe):xe}const Q=this.points[N[U+We]].properties,ve=this.options.map(Q);return H&&ve===Q?Object.assign({},ve):ve}}function ji(ie,N,U){return{type:"Feature",id:ie[N+We],properties:Mi(ie,N,U),geometry:{type:"Point",coordinates:[(H=ie[N],360*(H-.5)),ut(ie[N+1])]}};var H}function Mi(ie,N,U){const H=ie[N+it],Q=H>=1e4?`${Math.round(H/1e3)}k`:H>=1e3?Math.round(H/100)/10+"k":H,ve=ie[N+Qe],xe=ve===-1?{}:Object.assign({},U[ve]);return Object.assign(xe,{cluster:!0,cluster_id:ie[N+We],point_count:H,point_count_abbreviated:Q})}function je(ie){return ie/360+.5}function Tt(ie){const N=Math.sin(ie*Math.PI/180),U=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return U<0?0:U>1?1:U}function ut(ie){const N=(180-360*ie)*Math.PI/180;return 360*Math.atan(Math.exp(N))/Math.PI-90}function et(ie,N,U,H){for(var Q,ve=H,xe=U-N>>1,Se=U-N,de=ie[N],Ae=ie[N+1],Ge=ie[U],ze=ie[U+1],Ne=N+3;Ne<U;Ne+=3){var Vt=ki(ie[Ne],ie[Ne+1],de,Ae,Ge,ze);if(Vt>ve)Q=Ne,ve=Vt;else if(Vt===ve){var Wt=Math.abs(Ne-xe);Wt<Se&&(Q=Ne,Se=Wt)}}ve>H&&(Q-N>3&&et(ie,N,Q,H),ie[Q+2]=ve,U-Q>3&&et(ie,Q,U,H))}function ki(ie,N,U,H,Q,ve){var xe=Q-U,Se=ve-H;if(xe!==0||Se!==0){var de=((ie-U)*xe+(N-H)*Se)/(xe*xe+Se*Se);de>1?(U=Q,H=ve):de>0&&(U+=xe*de,H+=Se*de)}return(xe=ie-U)*xe+(Se=N-H)*Se}function Oi(ie,N,U,H){var Q={id:ie===void 0?null:ie,type:N,geometry:U,tags:H,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ve){var xe=ve.geometry,Se=ve.type;if(Se==="Point"||Se==="MultiPoint"||Se==="LineString")ae(ve,xe);else if(Se==="Polygon"||Se==="MultiLineString")for(var de=0;de<xe.length;de++)ae(ve,xe[de]);else if(Se==="MultiPolygon")for(de=0;de<xe.length;de++)for(var Ae=0;Ae<xe[de].length;Ae++)ae(ve,xe[de][Ae])}(Q),Q}function ae(ie,N){for(var U=0;U<N.length;U+=3)ie.minX=Math.min(ie.minX,N[U]),ie.minY=Math.min(ie.minY,N[U+1]),ie.maxX=Math.max(ie.maxX,N[U]),ie.maxY=Math.max(ie.maxY,N[U+1])}function ue(ie,N,U,H){if(N.geometry){var Q=N.geometry.coordinates,ve=N.geometry.type,xe=Math.pow(U.tolerance/((1<<U.maxZoom)*U.extent),2),Se=[],de=N.id;if(U.promoteId?de=N.properties[U.promoteId]:U.generateId&&(de=H||0),ve==="Point")De(Q,Se);else if(ve==="MultiPoint")for(var Ae=0;Ae<Q.length;Ae++)De(Q[Ae],Se);else if(ve==="LineString")Fe(Q,Se,xe,!1);else if(ve==="MultiLineString"){if(U.lineMetrics){for(Ae=0;Ae<Q.length;Ae++)Fe(Q[Ae],Se=[],xe,!1),ie.push(Oi(de,"LineString",Se,N.properties));return}ce(Q,Se,xe,!1)}else if(ve==="Polygon")ce(Q,Se,xe,!0);else{if(ve!=="MultiPolygon"){if(ve==="GeometryCollection"){for(Ae=0;Ae<N.geometry.geometries.length;Ae++)ue(ie,{id:de,geometry:N.geometry.geometries[Ae],properties:N.properties},U,H);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ae=0;Ae<Q.length;Ae++){var Ge=[];ce(Q[Ae],Ge,xe,!0),Se.push(Ge)}}ie.push(Oi(de,ve,Se,N.properties))}}function De(ie,N){N.push(dt(ie[0])),N.push(Pt(ie[1])),N.push(0)}function Fe(ie,N,U,H){for(var Q,ve,xe=0,Se=0;Se<ie.length;Se++){var de=dt(ie[Se][0]),Ae=Pt(ie[Se][1]);N.push(de),N.push(Ae),N.push(0),Se>0&&(xe+=H?(Q*Ae-de*ve)/2:Math.sqrt(Math.pow(de-Q,2)+Math.pow(Ae-ve,2))),Q=de,ve=Ae}var Ge=N.length-3;N[2]=1,et(N,0,Ge,U),N[Ge+2]=1,N.size=Math.abs(xe),N.start=0,N.end=N.size}function ce(ie,N,U,H){for(var Q=0;Q<ie.length;Q++){var ve=[];Fe(ie[Q],ve,U,H),N.push(ve)}}function dt(ie){return ie/360+.5}function Pt(ie){var N=Math.sin(ie*Math.PI/180),U=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return U<0?0:U>1?1:U}function Be(ie,N,U,H,Q,ve,xe,Se){if(H/=N,ve>=(U/=N)&&xe<H)return ie;if(xe<U||ve>=H)return null;for(var de=[],Ae=0;Ae<ie.length;Ae++){var Ge=ie[Ae],ze=Ge.geometry,Ne=Ge.type,Vt=Q===0?Ge.minX:Ge.minY,Wt=Q===0?Ge.maxX:Ge.maxY;if(Vt>=U&&Wt<H)de.push(Ge);else if(!(Wt<U||Vt>=H)){var ri=[];if(Ne==="Point"||Ne==="MultiPoint")st(ze,ri,U,H,Q);else if(Ne==="LineString")rt(ze,ri,U,H,Q,!1,Se.lineMetrics);else if(Ne==="MultiLineString")Kt(ze,ri,U,H,Q,!1);else if(Ne==="Polygon")Kt(ze,ri,U,H,Q,!0);else if(Ne==="MultiPolygon")for(var ni=0;ni<ze.length;ni++){var vi=[];Kt(ze[ni],vi,U,H,Q,!0),vi.length&&ri.push(vi)}if(ri.length){if(Se.lineMetrics&&Ne==="LineString"){for(ni=0;ni<ri.length;ni++)de.push(Oi(Ge.id,Ne,ri[ni],Ge.tags));continue}Ne!=="LineString"&&Ne!=="MultiLineString"||(ri.length===1?(Ne="LineString",ri=ri[0]):Ne="MultiLineString"),Ne!=="Point"&&Ne!=="MultiPoint"||(Ne=ri.length===3?"Point":"MultiPoint"),de.push(Oi(Ge.id,Ne,ri,Ge.tags))}}}return de.length?de:null}function st(ie,N,U,H,Q){for(var ve=0;ve<ie.length;ve+=3){var xe=ie[ve+Q];xe>=U&&xe<=H&&(N.push(ie[ve]),N.push(ie[ve+1]),N.push(ie[ve+2]))}}function rt(ie,N,U,H,Q,ve,xe){for(var Se,de,Ae=Dt(ie),Ge=Q===0?Jt:yi,ze=ie.start,Ne=0;Ne<ie.length-3;Ne+=3){var Vt=ie[Ne],Wt=ie[Ne+1],ri=ie[Ne+2],ni=ie[Ne+3],vi=ie[Ne+4],Ui=Q===0?Vt:Wt,cr=Q===0?ni:vi,Br=!1;xe&&(Se=Math.sqrt(Math.pow(Vt-ni,2)+Math.pow(Wt-vi,2))),Ui<U?cr>U&&(de=Ge(Ae,Vt,Wt,ni,vi,U),xe&&(Ae.start=ze+Se*de)):Ui>H?cr<H&&(de=Ge(Ae,Vt,Wt,ni,vi,H),xe&&(Ae.start=ze+Se*de)):Zt(Ae,Vt,Wt,ri),cr<U&&Ui>=U&&(de=Ge(Ae,Vt,Wt,ni,vi,U),Br=!0),cr>H&&Ui<=H&&(de=Ge(Ae,Vt,Wt,ni,vi,H),Br=!0),!ve&&Br&&(xe&&(Ae.end=ze+Se*de),N.push(Ae),Ae=Dt(ie)),xe&&(ze+=Se)}var Yt=ie.length-3;Vt=ie[Yt],Wt=ie[Yt+1],ri=ie[Yt+2],(Ui=Q===0?Vt:Wt)>=U&&Ui<=H&&Zt(Ae,Vt,Wt,ri),Yt=Ae.length-3,ve&&Yt>=3&&(Ae[Yt]!==Ae[0]||Ae[Yt+1]!==Ae[1])&&Zt(Ae,Ae[0],Ae[1],Ae[2]),Ae.length&&N.push(Ae)}function Dt(ie){var N=[];return N.size=ie.size,N.start=ie.start,N.end=ie.end,N}function Kt(ie,N,U,H,Q,ve){for(var xe=0;xe<ie.length;xe++)rt(ie[xe],N,U,H,Q,ve,!1)}function Zt(ie,N,U,H){ie.push(N),ie.push(U),ie.push(H)}function Jt(ie,N,U,H,Q,ve){var xe=(ve-N)/(H-N);return ie.push(ve),ie.push(U+(Q-U)*xe),ie.push(1),xe}function yi(ie,N,U,H,Q,ve){var xe=(ve-U)/(Q-U);return ie.push(N+(H-N)*xe),ie.push(ve),ie.push(1),xe}function Ti(ie,N){for(var U=[],H=0;H<ie.length;H++){var Q,ve=ie[H],xe=ve.type;if(xe==="Point"||xe==="MultiPoint"||xe==="LineString")Q=Ve(ve.geometry,N);else if(xe==="MultiLineString"||xe==="Polygon"){Q=[];for(var Se=0;Se<ve.geometry.length;Se++)Q.push(Ve(ve.geometry[Se],N))}else if(xe==="MultiPolygon")for(Q=[],Se=0;Se<ve.geometry.length;Se++){for(var de=[],Ae=0;Ae<ve.geometry[Se].length;Ae++)de.push(Ve(ve.geometry[Se][Ae],N));Q.push(de)}U.push(Oi(ve.id,xe,Q,ve.tags))}return U}function Ve(ie,N){var U=[];U.size=ie.size,ie.start!==void 0&&(U.start=ie.start,U.end=ie.end);for(var H=0;H<ie.length;H+=3)U.push(ie[H]+N,ie[H+1],ie[H+2]);return U}function Ni(ie,N){if(ie.transformed)return ie;var U,H,Q,ve=1<<ie.z,xe=ie.x,Se=ie.y;for(U=0;U<ie.features.length;U++){var de=ie.features[U],Ae=de.geometry,Ge=de.type;if(de.geometry=[],Ge===1)for(H=0;H<Ae.length;H+=2)de.geometry.push(Qi(Ae[H],Ae[H+1],N,ve,xe,Se));else for(H=0;H<Ae.length;H++){var ze=[];for(Q=0;Q<Ae[H].length;Q+=2)ze.push(Qi(Ae[H][Q],Ae[H][Q+1],N,ve,xe,Se));de.geometry.push(ze)}}return ie.transformed=!0,ie}function Qi(ie,N,U,H,Q,ve){return[Math.round(U*(ie*H-Q)),Math.round(U*(N*H-ve))]}function _n(ie,N,U,H,Q){for(var ve=N===Q.maxZoom?0:Q.tolerance/((1<<N)*Q.extent),xe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:U,y:H,z:N,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Se=0;Se<ie.length;Se++){xe.numFeatures++,Sr(xe,ie[Se],ve,Q);var de=ie[Se].minX,Ae=ie[Se].minY,Ge=ie[Se].maxX,ze=ie[Se].maxY;de<xe.minX&&(xe.minX=de),Ae<xe.minY&&(xe.minY=Ae),Ge>xe.maxX&&(xe.maxX=Ge),ze>xe.maxY&&(xe.maxY=ze)}return xe}function Sr(ie,N,U,H){var Q=N.geometry,ve=N.type,xe=[];if(ve==="Point"||ve==="MultiPoint")for(var Se=0;Se<Q.length;Se+=3)xe.push(Q[Se]),xe.push(Q[Se+1]),ie.numPoints++,ie.numSimplified++;else if(ve==="LineString")at(xe,Q,ie,U,!1,!1);else if(ve==="MultiLineString"||ve==="Polygon")for(Se=0;Se<Q.length;Se++)at(xe,Q[Se],ie,U,ve==="Polygon",Se===0);else if(ve==="MultiPolygon")for(var de=0;de<Q.length;de++){var Ae=Q[de];for(Se=0;Se<Ae.length;Se++)at(xe,Ae[Se],ie,U,!0,Se===0)}if(xe.length){var Ge=N.tags||null;if(ve==="LineString"&&H.lineMetrics){for(var ze in Ge={},N.tags)Ge[ze]=N.tags[ze];Ge.mapbox_clip_start=Q.start/Q.size,Ge.mapbox_clip_end=Q.end/Q.size}var Ne={geometry:xe,type:ve==="Polygon"||ve==="MultiPolygon"?3:ve==="LineString"||ve==="MultiLineString"?2:1,tags:Ge};N.id!==null&&(Ne.id=N.id),ie.features.push(Ne)}}function at(ie,N,U,H,Q,ve){var xe=H*H;if(H>0&&N.size<(Q?xe:H))U.numPoints+=N.length/3;else{for(var Se=[],de=0;de<N.length;de+=3)(H===0||N[de+2]>xe)&&(U.numSimplified++,Se.push(N[de]),Se.push(N[de+1])),U.numPoints++;Q&&function(Ae,Ge){for(var ze=0,Ne=0,Vt=Ae.length,Wt=Vt-2;Ne<Vt;Wt=Ne,Ne+=2)ze+=(Ae[Ne]-Ae[Wt])*(Ae[Ne+1]+Ae[Wt+1]);if(ze>0===Ge)for(Ne=0,Vt=Ae.length;Ne<Vt/2;Ne+=2){var ri=Ae[Ne],ni=Ae[Ne+1];Ae[Ne]=Ae[Vt-2-Ne],Ae[Ne+1]=Ae[Vt-1-Ne],Ae[Vt-2-Ne]=ri,Ae[Vt-1-Ne]=ni}}(Se,ve),ie.push(Se)}}function ui(ie,N){var U=(N=this.options=function(Q,ve){for(var xe in ve)Q[xe]=ve[xe];return Q}(Object.create(this.options),N)).debug;if(U&&console.time("preprocess data"),N.maxZoom<0||N.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(N.promoteId&&N.generateId)throw new Error("promoteId and generateId cannot be used together.");var H=function(Q,ve){var xe=[];if(Q.type==="FeatureCollection")for(var Se=0;Se<Q.features.length;Se++)ue(xe,Q.features[Se],ve,Se);else ue(xe,Q.type==="Feature"?Q:{geometry:Q},ve);return xe}(ie,N);this.tiles={},this.tileCoords=[],U&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",N.indexMaxZoom,N.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),H=function(Q,ve){var xe=ve.buffer/ve.extent,Se=Q,de=Be(Q,1,-1-xe,xe,0,-1,2,ve),Ae=Be(Q,1,1-xe,2+xe,0,-1,2,ve);return(de||Ae)&&(Se=Be(Q,1,-xe,1+xe,0,-1,2,ve)||[],de&&(Se=Ti(de,1).concat(Se)),Ae&&(Se=Se.concat(Ti(Ae,-1)))),Se}(H,N),H.length&&this.splitTile(H,0,0,0),U&&(H.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ut(ie,N,U){return 32*((1<<ie)*U+N)+ie}function qi(ie,N){return N?ie.properties[N]:ie.id}function vn(ie,N){if(ie==null)return!0;if(ie.type==="Feature")return qi(ie,N)!=null;if(ie.type==="FeatureCollection"){const U=new Set;for(const H of ie.features){const Q=qi(H,N);if(Q==null||U.has(Q))return!1;U.add(Q)}return!0}return!1}function ii(ie,N){const U=new Map;if(ie!=null)if(ie.type==="Feature")U.set(qi(ie,N),ie);else for(const H of ie.features)U.set(qi(H,N),H);return U}ui.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ui.prototype.splitTile=function(ie,N,U,H,Q,ve,xe){for(var Se=[ie,N,U,H],de=this.options,Ae=de.debug;Se.length;){H=Se.pop(),U=Se.pop(),N=Se.pop(),ie=Se.pop();var Ge=1<<N,ze=Ut(N,U,H),Ne=this.tiles[ze];if(!Ne&&(Ae>1&&console.time("creation"),Ne=this.tiles[ze]=_n(ie,N,U,H,de),this.tileCoords.push({z:N,x:U,y:H}),Ae)){Ae>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",N,U,H,Ne.numFeatures,Ne.numPoints,Ne.numSimplified),console.timeEnd("creation"));var Vt="z"+N;this.stats[Vt]=(this.stats[Vt]||0)+1,this.total++}if(Ne.source=ie,Q){if(N===de.maxZoom||N===Q)continue;var Wt=1<<Q-N;if(U!==Math.floor(ve/Wt)||H!==Math.floor(xe/Wt))continue}else if(N===de.indexMaxZoom||Ne.numPoints<=de.indexMaxPoints)continue;if(Ne.source=null,ie.length!==0){Ae>1&&console.time("clipping");var ri,ni,vi,Ui,cr,Br,Yt=.5*de.buffer/de.extent,_r=.5-Yt,Vr=.5+Yt,xn=1+Yt;ri=ni=vi=Ui=null,cr=Be(ie,Ge,U-Yt,U+Vr,0,Ne.minX,Ne.maxX,de),Br=Be(ie,Ge,U+_r,U+xn,0,Ne.minX,Ne.maxX,de),ie=null,cr&&(ri=Be(cr,Ge,H-Yt,H+Vr,1,Ne.minY,Ne.maxY,de),ni=Be(cr,Ge,H+_r,H+xn,1,Ne.minY,Ne.maxY,de),cr=null),Br&&(vi=Be(Br,Ge,H-Yt,H+Vr,1,Ne.minY,Ne.maxY,de),Ui=Be(Br,Ge,H+_r,H+xn,1,Ne.minY,Ne.maxY,de),Br=null),Ae>1&&console.timeEnd("clipping"),Se.push(ri||[],N+1,2*U,2*H),Se.push(ni||[],N+1,2*U,2*H+1),Se.push(vi||[],N+1,2*U+1,2*H),Se.push(Ui||[],N+1,2*U+1,2*H+1)}}},ui.prototype.getTile=function(ie,N,U){var H=this.options,Q=H.extent,ve=H.debug;if(ie<0||ie>24)return null;var xe=1<<ie,Se=Ut(ie,N=(N%xe+xe)%xe,U);if(this.tiles[Se])return Ni(this.tiles[Se],Q);ve>1&&console.log("drilling down to z%d-%d-%d",ie,N,U);for(var de,Ae=ie,Ge=N,ze=U;!de&&Ae>0;)Ae--,Ge=Math.floor(Ge/2),ze=Math.floor(ze/2),de=this.tiles[Ut(Ae,Ge,ze)];return de&&de.source?(ve>1&&console.log("found parent tile z%d-%d-%d",Ae,Ge,ze),ve>1&&console.time("drilling down"),this.splitTile(de.source,Ae,Ge,ze,ie,N,U),ve>1&&console.timeEnd("drilling down"),this.tiles[Se]?Ni(this.tiles[Se],Q):null):null};class ta extends k{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(N,U){return m._(this,void 0,void 0,function*(){const H=N.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Q=this._geoJSONIndex.getTile(H.z,H.x,H.y);if(!Q)return null;const ve=new class{constructor(Se){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.W,this.length=Se.length,this._features=Se}feature(Se){return new class{constructor(de){this._feature=de,this.extent=m.W,this.type=de.type,this.properties=de.tags,"id"in de&&!isNaN(de.id)&&(this.id=parseInt(de.id,10))}loadGeometry(){if(this._feature.type===1){const de=[];for(const Ae of this._feature.geometry)de.push([new m.P(Ae[0],Ae[1])]);return de}{const de=[];for(const Ae of this._feature.geometry){const Ge=[];for(const ze of Ae)Ge.push(new m.P(ze[0],ze[1]));de.push(Ge)}return de}}toGeoJSON(de,Ae,Ge){return fe.call(this,de,Ae,Ge)}}(this._features[Se])}}(Q.features);let xe=$t(ve);return xe.byteOffset===0&&xe.byteLength===xe.buffer.byteLength||(xe=new Uint8Array(xe)),{vectorTile:ve,rawData:xe.buffer}})}loadData(N){return m._(this,void 0,void 0,function*(){var U;(U=this._pendingRequest)===null||U===void 0||U.abort();const H=!!(N&&N.request&&N.request.collectResourceTiming)&&new m.bs(N.request);this._pendingRequest=new AbortController;try{let Q=yield this.loadGeoJSON(N,this._pendingRequest);if(delete this._pendingRequest,typeof Q!="object")throw new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`);if(X(Q,!0),N.filter){const xe=m.by(N.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(xe.result==="error")throw new Error(xe.value.map(de=>`${de.key}: ${de.message}`).join(", "));Q={type:"FeatureCollection",features:Q.features.filter(de=>xe.value.evaluate({zoom:0},de))}}this._geoJSONIndex=N.cluster?new Xi(function({superclusterOptions:xe,clusterProperties:Se}){if(!Se||!xe)return xe;const de={},Ae={},Ge={accumulated:null,zoom:0},ze={properties:null},Ne=Object.keys(Se);for(const Vt of Ne){const[Wt,ri]=Se[Vt],ni=m.by(ri),vi=m.by(typeof Wt=="string"?[Wt,["accumulated"],["get",Vt]]:Wt);de[Vt]=ni.value,Ae[Vt]=vi.value}return xe.map=Vt=>{ze.properties=Vt;const Wt={};for(const ri of Ne)Wt[ri]=de[ri].evaluate(Ge,ze);return Wt},xe.reduce=(Vt,Wt)=>{ze.properties=Wt;for(const ri of Ne)Ge.accumulated=Vt[ri],Vt[ri]=Ae[ri].evaluate(Ge,ze)},xe}(N)).load(Q.features):function(xe,Se){return new ui(xe,Se)}(Q,N.geojsonVtOptions),this.loaded={};const ve={};if(H){const xe=H.finish();xe&&(ve.resourceTiming={},ve.resourceTiming[N.source]=JSON.parse(JSON.stringify(xe)))}return ve}catch(Q){if(delete this._pendingRequest,m.bz(Q))return{abandoned:!0};throw Q}})}reloadTile(N){const U=this.loaded;return U&&U[N.uid]?super.reloadTile(N):this.loadTile(N)}loadGeoJSON(N,U){return m._(this,void 0,void 0,function*(){const{promoteId:H}=N;if(N.request){const Q=yield m.h(N.request,U);return this._dataUpdateable=vn(Q.data,H)?ii(Q.data,H):void 0,Q.data}if(typeof N.data=="string")try{const Q=JSON.parse(N.data);return this._dataUpdateable=vn(Q,H)?ii(Q,H):void 0,Q}catch{throw new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`)}if(!N.dataDiff)throw new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${N.source}`);return function(Q,ve,xe){var Se,de,Ae,Ge;if(ve.removeAll&&Q.clear(),ve.remove)for(const ze of ve.remove)Q.delete(ze);if(ve.add)for(const ze of ve.add){const Ne=qi(ze,xe);Ne!=null&&Q.set(Ne,ze)}if(ve.update)for(const ze of ve.update){let Ne=Q.get(ze.id);if(Ne==null)continue;const Vt=!ze.removeAllProperties&&(((Se=ze.removeProperties)===null||Se===void 0?void 0:Se.length)>0||((de=ze.addOrUpdateProperties)===null||de===void 0?void 0:de.length)>0);if((ze.newGeometry||ze.removeAllProperties||Vt)&&(Ne=Object.assign({},Ne),Q.set(ze.id,Ne),Vt&&(Ne.properties=Object.assign({},Ne.properties))),ze.newGeometry&&(Ne.geometry=ze.newGeometry),ze.removeAllProperties)Ne.properties={};else if(((Ae=ze.removeProperties)===null||Ae===void 0?void 0:Ae.length)>0)for(const Wt of ze.removeProperties)Object.prototype.hasOwnProperty.call(Ne.properties,Wt)&&delete Ne.properties[Wt];if(((Ge=ze.addOrUpdateProperties)===null||Ge===void 0?void 0:Ge.length)>0)for(const{key:Wt,value:ri}of ze.addOrUpdateProperties)Ne.properties[Wt]=ri}}(this._dataUpdateable,N.dataDiff,H),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(N){return m._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(N){return this._geoJSONIndex.getClusterExpansionZoom(N.clusterId)}getClusterChildren(N){return this._geoJSONIndex.getChildren(N.clusterId)}getClusterLeaves(N){return this._geoJSONIndex.getLeaves(N.clusterId,N.limit,N.offset)}}class Er{constructor(N){this.self=N,this.actor=new m.C(N),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(U,H)=>{if(this.externalWorkerSourceTypes[U])throw new Error(`Worker source with name "${U}" already registered.`);this.externalWorkerSourceTypes[U]=H},this.self.addProtocol=m.bf,this.self.removeProtocol=m.bg,this.self.registerRTLTextPlugin=U=>{if(m.bA.isParsed())throw new Error("RTL text plugin already registered.");m.bA.setMethods(U)},this.actor.registerMessageHandler("LDT",(U,H)=>this._getDEMWorkerSource(U,H.source).loadTile(H)),this.actor.registerMessageHandler("RDT",(U,H)=>m._(this,void 0,void 0,function*(){this._getDEMWorkerSource(U,H.source).removeTile(H)})),this.actor.registerMessageHandler("GCEZ",(U,H)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(U,H.type,H.source).getClusterExpansionZoom(H)})),this.actor.registerMessageHandler("GCC",(U,H)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(U,H.type,H.source).getClusterChildren(H)})),this.actor.registerMessageHandler("GCL",(U,H)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(U,H.type,H.source).getClusterLeaves(H)})),this.actor.registerMessageHandler("LD",(U,H)=>this._getWorkerSource(U,H.type,H.source).loadData(H)),this.actor.registerMessageHandler("LT",(U,H)=>this._getWorkerSource(U,H.type,H.source).loadTile(H)),this.actor.registerMessageHandler("RT",(U,H)=>this._getWorkerSource(U,H.type,H.source).reloadTile(H)),this.actor.registerMessageHandler("AT",(U,H)=>this._getWorkerSource(U,H.type,H.source).abortTile(H)),this.actor.registerMessageHandler("RMT",(U,H)=>this._getWorkerSource(U,H.type,H.source).removeTile(H)),this.actor.registerMessageHandler("RS",(U,H)=>m._(this,void 0,void 0,function*(){if(!this.workerSources[U]||!this.workerSources[U][H.type]||!this.workerSources[U][H.type][H.source])return;const Q=this.workerSources[U][H.type][H.source];delete this.workerSources[U][H.type][H.source],Q.removeSource!==void 0&&Q.removeSource(H)})),this.actor.registerMessageHandler("RM",U=>m._(this,void 0,void 0,function*(){delete this.layerIndexes[U],delete this.availableImages[U],delete this.workerSources[U],delete this.demWorkerSources[U]})),this.actor.registerMessageHandler("SR",(U,H)=>m._(this,void 0,void 0,function*(){this.referrer=H})),this.actor.registerMessageHandler("SRPS",(U,H)=>this._syncRTLPluginState(U,H)),this.actor.registerMessageHandler("IS",(U,H)=>m._(this,void 0,void 0,function*(){this.self.importScripts(H)})),this.actor.registerMessageHandler("SI",(U,H)=>this._setImages(U,H)),this.actor.registerMessageHandler("UL",(U,H)=>m._(this,void 0,void 0,function*(){this._getLayerIndex(U).update(H.layers,H.removedIds)})),this.actor.registerMessageHandler("SL",(U,H)=>m._(this,void 0,void 0,function*(){this._getLayerIndex(U).replace(H)}))}_setImages(N,U){return m._(this,void 0,void 0,function*(){this.availableImages[N]=U;for(const H in this.workerSources[N]){const Q=this.workerSources[N][H];for(const ve in Q)Q[ve].availableImages=U}})}_syncRTLPluginState(N,U){return m._(this,void 0,void 0,function*(){if(m.bA.isParsed())return m.bA.getState();if(U.pluginStatus!=="loading")return m.bA.setState(U),U;const H=U.pluginURL;if(this.self.importScripts(H),m.bA.isParsed()){const Q={pluginStatus:"loaded",pluginURL:H};return m.bA.setState(Q),Q}throw m.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${H}`)})}_getAvailableImages(N){let U=this.availableImages[N];return U||(U=[]),U}_getLayerIndex(N){let U=this.layerIndexes[N];return U||(U=this.layerIndexes[N]=new l),U}_getWorkerSource(N,U,H){if(this.workerSources[N]||(this.workerSources[N]={}),this.workerSources[N][U]||(this.workerSources[N][U]={}),!this.workerSources[N][U][H]){const Q={sendAsync:(ve,xe)=>(ve.targetMapId=N,this.actor.sendAsync(ve,xe))};switch(U){case"vector":this.workerSources[N][U][H]=new k(Q,this._getLayerIndex(N),this._getAvailableImages(N));break;case"geojson":this.workerSources[N][U][H]=new ta(Q,this._getLayerIndex(N),this._getAvailableImages(N));break;default:this.workerSources[N][U][H]=new this.externalWorkerSourceTypes[U](Q,this._getLayerIndex(N),this._getAvailableImages(N))}}return this.workerSources[N][U][H]}_getDEMWorkerSource(N,U){return this.demWorkerSources[N]||(this.demWorkerSources[N]={}),this.demWorkerSources[N][U]||(this.demWorkerSources[N][U]=new z),this.demWorkerSources[N][U]}}return m.i(self)&&(self.worker=new Er(self)),Er}),d("index",["exports","./shared"],function(m,l){var M="4.1.3";let A,R;const k={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:y=>new Promise((i,o)=>{const h=requestAnimationFrame(i);y.signal.addEventListener("abort",()=>{cancelAnimationFrame(h),o(l.c())})}),getImageData(y,i=0){return this.getImageCanvasContext(y).getImageData(-i,-i,y.width+2*i,y.height+2*i)},getImageCanvasContext(y){const i=window.document.createElement("canvas"),o=i.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return i.width=y.width,i.height=y.height,o.drawImage(y,0,0,y.width,y.height),o},resolveURL:y=>(A||(A=document.createElement("a")),A.href=y,A.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(R==null&&(R=matchMedia("(prefers-reduced-motion: reduce)")),R.matches)}};class z{static testProp(i){if(!z.docStyle)return i[0];for(let o=0;o<i.length;o++)if(i[o]in z.docStyle)return i[o];return i[0]}static create(i,o,h){const p=window.document.createElement(i);return o!==void 0&&(p.className=o),h&&h.appendChild(p),p}static createNS(i,o){return window.document.createElementNS(i,o)}static disableDrag(){z.docStyle&&z.selectProp&&(z.userSelect=z.docStyle[z.selectProp],z.docStyle[z.selectProp]="none")}static enableDrag(){z.docStyle&&z.selectProp&&(z.docStyle[z.selectProp]=z.userSelect)}static setTransform(i,o){i.style[z.transformProp]=o}static addEventListener(i,o,h,p={}){i.addEventListener(o,h,"passive"in p?p:p.capture)}static removeEventListener(i,o,h,p={}){i.removeEventListener(o,h,"passive"in p?p:p.capture)}static suppressClickInternal(i){i.preventDefault(),i.stopPropagation(),window.removeEventListener("click",z.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",z.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",z.suppressClickInternal,!0)},0)}static getScale(i){const o=i.getBoundingClientRect();return{x:o.width/i.offsetWidth||1,y:o.height/i.offsetHeight||1,boundingClientRect:o}}static getPoint(i,o,h){const p=o.boundingClientRect;return new l.P((h.clientX-p.left)/o.x-i.clientLeft,(h.clientY-p.top)/o.y-i.clientTop)}static mousePos(i,o){const h=z.getScale(i);return z.getPoint(i,h,o)}static touchPos(i,o){const h=[],p=z.getScale(i);for(let _=0;_<o.length;_++)h.push(z.getPoint(i,p,o[_]));return h}static mouseButton(i){return i.button}static remove(i){i.parentNode&&i.parentNode.removeChild(i)}}z.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,z.selectProp=z.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),z.transformProp=z.testProp(["transform","WebkitTransform"]);const W={supported:!1,testSupport:function(y){!fe&&X&&(ye?we(y):Z=y)}};let Z,X,fe=!1,ye=!1;function we(y){const i=y.createTexture();y.bindTexture(y.TEXTURE_2D,i);try{if(y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,X),y.isContextLost())return;W.supported=!0}catch{}y.deleteTexture(i),fe=!0}var ee;typeof document<"u"&&(X=document.createElement("img"),X.onload=function(){Z&&we(Z),Z=null,ye=!0},X.onerror=function(){fe=!0,Z=null},X.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(y){let i,o,h,p;y.resetRequestQueue=()=>{i=[],o=0,h=0,p={}},y.addThrottleControl=C=>{const D=h++;return p[D]=C,D},y.removeThrottleControl=C=>{delete p[C],S()},y.getImage=(C,D,F=!0)=>new Promise((B,q)=>{W.supported&&(C.headers||(C.headers={}),C.headers.accept="image/webp,*/*"),l.e(C,{type:"image"}),i.push({abortController:D,requestParameters:C,supportImageRefresh:F,state:"queued",onError:re=>{q(re)},onSuccess:re=>{B(re)}}),S()});const _=C=>l._(this,void 0,void 0,function*(){C.state="running";const{requestParameters:D,supportImageRefresh:F,onError:B,onSuccess:q,abortController:re}=C,te=F===!1&&!l.i(self)&&!l.g(D.url)&&(!D.headers||Object.keys(D.headers).reduce((me,Pe)=>me&&Pe==="accept",!0));o++;const se=te?E(D,re):l.m(D,re);try{const me=yield se;delete C.abortController,C.state="completed",me.data instanceof HTMLImageElement||l.b(me.data)?q(me):me.data&&q({data:yield(K=me.data,typeof createImageBitmap=="function"?l.d(K):l.f(K)),cacheControl:me.cacheControl,expires:me.expires})}catch(me){delete C.abortController,B(me)}finally{o--,S()}var K}),S=()=>{const C=(()=>{for(const D of Object.keys(p))if(p[D]())return!0;return!1})()?l.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let D=o;D<C&&i.length>0;D++){const F=i.shift();F.abortController.signal.aborted?D--:_(F)}},E=(C,D)=>new Promise((F,B)=>{const q=new Image,re=C.url,te=C.credentials;te&&te==="include"?q.crossOrigin="use-credentials":(te&&te==="same-origin"||!l.s(re))&&(q.crossOrigin="anonymous"),D.signal.addEventListener("abort",()=>{q.src="",B(l.c())}),q.fetchPriority="high",q.onload=()=>{q.onerror=q.onload=null,F({data:q})},q.onerror=()=>{q.onerror=q.onload=null,D.signal.aborted||B(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},q.src=re})}(ee||(ee={})),ee.resetRequestQueue();class Ie{constructor(i){this._transformRequestFn=i}transformRequest(i,o){return this._transformRequestFn&&this._transformRequestFn(i,o)||{url:i}}normalizeSpriteURL(i,o,h){const p=function(_){const S=_.match(Ue);if(!S)throw new Error(`Unable to parse URL "${_}"`);return{protocol:S[1],authority:S[2],path:S[3]||"/",params:S[4]?S[4].split("&"):[]}}(i);return p.path+=`${o}${h}`,function(_){const S=_.params.length?`?${_.params.join("&")}`:"";return`${_.protocol}://${_.authority}${_.path}${S}`}(p)}setTransformRequest(i){this._transformRequestFn=i}}const Ue=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Xe(y){var i=new l.A(3);return i[0]=y[0],i[1]=y[1],i[2]=y[2],i}var nt,ft=function(y,i,o){return y[0]=i[0]-o[0],y[1]=i[1]-o[1],y[2]=i[2]-o[2],y};nt=new l.A(3),l.A!=Float32Array&&(nt[0]=0,nt[1]=0,nt[2]=0);var At=function(y){var i=y[0],o=y[1];return i*i+o*o};function Ot(y){const i=[];if(typeof y=="string")i.push({id:"default",url:y});else if(y&&y.length>0){const o=[];for(const{id:h,url:p}of y){const _=`${h}${p}`;o.indexOf(_)===-1&&(o.push(_),i.push({id:h,url:p}))}}return i}(function(){var y=new l.A(2);l.A!=Float32Array&&(y[0]=0,y[1]=0)})();class Lt{constructor(i,o,h,p){this.context=i,this.format=h,this.texture=i.gl.createTexture(),this.update(o,p)}update(i,o,h){const{width:p,height:_}=i,S=!(this.size&&this.size[0]===p&&this.size[1]===_||h),{context:E}=this,{gl:C}=E;if(this.useMipmap=!!(o&&o.useMipmap),C.bindTexture(C.TEXTURE_2D,this.texture),E.pixelStoreUnpackFlipY.set(!1),E.pixelStoreUnpack.set(1),E.pixelStoreUnpackPremultiplyAlpha.set(this.format===C.RGBA&&(!o||o.premultiply!==!1)),S)this.size=[p,_],i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||l.b(i)?C.texImage2D(C.TEXTURE_2D,0,this.format,this.format,C.UNSIGNED_BYTE,i):C.texImage2D(C.TEXTURE_2D,0,this.format,p,_,0,this.format,C.UNSIGNED_BYTE,i.data);else{const{x:D,y:F}=h||{x:0,y:0};i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||l.b(i)?C.texSubImage2D(C.TEXTURE_2D,0,D,F,C.RGBA,C.UNSIGNED_BYTE,i):C.texSubImage2D(C.TEXTURE_2D,0,D,F,p,_,C.RGBA,C.UNSIGNED_BYTE,i.data)}this.useMipmap&&this.isSizePowerOfTwo()&&C.generateMipmap(C.TEXTURE_2D)}bind(i,o,h){const{context:p}=this,{gl:_}=p;_.bindTexture(_.TEXTURE_2D,this.texture),h!==_.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(h=_.LINEAR),i!==this.filter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,i),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,h||i),this.filter=i),o!==this.wrap&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,o),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}function li(y){const{userImage:i}=y;return!!(i&&i.render&&i.render())&&(y.data.replace(new Uint8Array(i.data.buffer)),!0)}class Ei extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:o,promiseResolve:h}of this.requestors)h(this._getImagesForIds(o));this.requestors=[]}}getImage(i){const o=this.images[i];if(o&&!o.data&&o.spriteData){const h=o.spriteData;o.data=new l.R({width:h.width,height:h.height},h.context.getImageData(h.x,h.y,h.width,h.height).data),o.spriteData=null}return o}addImage(i,o){if(this.images[i])throw new Error(`Image id ${i} already exist, use updateImage instead`);this._validate(i,o)&&(this.images[i]=o)}_validate(i,o){let h=!0;const p=o.data||o.spriteData;return this._validateStretch(o.stretchX,p&&p.width)||(this.fire(new l.j(new Error(`Image "${i}" has invalid "stretchX" value`))),h=!1),this._validateStretch(o.stretchY,p&&p.height)||(this.fire(new l.j(new Error(`Image "${i}" has invalid "stretchY" value`))),h=!1),this._validateContent(o.content,o)||(this.fire(new l.j(new Error(`Image "${i}" has invalid "content" value`))),h=!1),h}_validateStretch(i,o){if(!i)return!0;let h=0;for(const p of i){if(p[0]<h||p[1]<p[0]||o<p[1])return!1;h=p[1]}return!0}_validateContent(i,o){if(!i)return!0;if(i.length!==4)return!1;const h=o.spriteData,p=h&&h.width||o.data.width,_=h&&h.height||o.data.height;return!(i[0]<0||p<i[0]||i[1]<0||_<i[1]||i[2]<0||p<i[2]||i[3]<0||_<i[3]||i[2]<i[0]||i[3]<i[1])}updateImage(i,o,h=!0){const p=this.getImage(i);if(h&&(p.data.width!==o.data.width||p.data.height!==o.data.height))throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${o.data.width}x${o.data.height}).`);o.version=p.version+1,this.images[i]=o,this.updatedImages[i]=!0}removeImage(i){const o=this.images[i];delete this.images[i],delete this.patterns[i],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i){return new Promise((o,h)=>{let p=!0;if(!this.isLoaded())for(const _ of i)this.images[_]||(p=!1);this.isLoaded()||p?o(this._getImagesForIds(i)):this.requestors.push({ids:i,promiseResolve:o})})}_getImagesForIds(i){const o={};for(const h of i){let p=this.getImage(h);p||(this.fire(new l.k("styleimagemissing",{id:h})),p=this.getImage(h)),p?o[h]={data:p.data.clone(),pixelRatio:p.pixelRatio,sdf:p.sdf,version:p.version,stretchX:p.stretchX,stretchY:p.stretchY,content:p.content,hasRenderCallback:!!(p.userImage&&p.userImage.render)}:l.w(`Image "${h}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return o}getPixelSize(){const{width:i,height:o}=this.atlasImage;return{width:i,height:o}}getPattern(i){const o=this.patterns[i],h=this.getImage(i);if(!h)return null;if(o&&o.position.version===h.version)return o.position;if(o)o.position.version=h.version;else{const p={w:h.data.width+2,h:h.data.height+2,x:0,y:0},_=new l.I(p,h);this.patterns[i]={bin:p,position:_}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const o=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Lt(i,this.atlasImage,o.RGBA),this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const _ in this.patterns)i.push(this.patterns[_].bin);const{w:o,h}=l.p(i),p=this.atlasImage;p.resize({width:o||1,height:h||1});for(const _ in this.patterns){const{bin:S}=this.patterns[_],E=S.x+1,C=S.y+1,D=this.getImage(_).data,F=D.width,B=D.height;l.R.copy(D,p,{x:0,y:0},{x:E,y:C},{width:F,height:B}),l.R.copy(D,p,{x:0,y:B-1},{x:E,y:C-1},{width:F,height:1}),l.R.copy(D,p,{x:0,y:0},{x:E,y:C+B},{width:F,height:1}),l.R.copy(D,p,{x:F-1,y:0},{x:E-1,y:C},{width:1,height:B}),l.R.copy(D,p,{x:0,y:0},{x:E+F,y:C},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const o of i){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;const h=this.getImage(o);h||l.w(`Image with ID: "${o}" was not found`),li(h)&&this.updateImage(o,h)}}}const ci=1e20;function xt(y,i,o,h,p,_,S,E,C){for(let D=i;D<i+h;D++)kt(y,o*_+D,_,p,S,E,C);for(let D=o;D<o+p;D++)kt(y,D*_+i,1,h,S,E,C)}function kt(y,i,o,h,p,_,S){_[0]=0,S[0]=-ci,S[1]=ci,p[0]=y[i];for(let E=1,C=0,D=0;E<h;E++){p[E]=y[i+E*o];const F=E*E;do{const B=_[C];D=(p[E]-p[B]+F-B*B)/(E-B)/2}while(D<=S[C]&&--C>-1);C++,_[C]=E,S[C]=D,S[C+1]=ci}for(let E=0,C=0;E<h;E++){for(;S[C+1]<E;)C++;const D=_[C],F=E-D;y[i+E*o]=p[D]+F*F}}class $t{constructor(i,o){this.requestManager=i,this.localIdeographFontFamily=o,this.entries={}}setURL(i){this.url=i}getGlyphs(i){return l._(this,void 0,void 0,function*(){const o=[];for(const _ in i)for(const S of i[_])o.push(this._getAndCacheGlyphsPromise(_,S));const h=yield Promise.all(o),p={};for(const{stack:_,id:S,glyph:E}of h)p[_]||(p[_]={}),p[_][S]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics};return p})}_getAndCacheGlyphsPromise(i,o){return l._(this,void 0,void 0,function*(){let h=this.entries[i];h||(h=this.entries[i]={glyphs:{},requests:{},ranges:{}});let p=h.glyphs[o];if(p!==void 0)return{stack:i,id:o,glyph:p};if(p=this._tinySDF(h,i,o),p)return h.glyphs[o]=p,{stack:i,id:o,glyph:p};const _=Math.floor(o/256);if(256*_>65535)throw new Error("glyphs > 65535 not supported");if(h.ranges[_])return{stack:i,id:o,glyph:p};if(!this.url)throw new Error("glyphsUrl is not set");if(!h.requests[_]){const E=$t.loadGlyphRange(i,_,this.url,this.requestManager);h.requests[_]=E}const S=yield h.requests[_];for(const E in S)this._doesCharSupportLocalGlyph(+E)||(h.glyphs[+E]=S[+E]);return h.ranges[_]=!0,{stack:i,id:o,glyph:S[o]||null}})}_doesCharSupportLocalGlyph(i){return!!this.localIdeographFontFamily&&(l.u["CJK Unified Ideographs"](i)||l.u["Hangul Syllables"](i)||l.u.Hiragana(i)||l.u.Katakana(i))}_tinySDF(i,o,h){const p=this.localIdeographFontFamily;if(!p||!this._doesCharSupportLocalGlyph(h))return;let _=i.tinySDF;if(!_){let E="400";/bold/i.test(o)?E="900":/medium/i.test(o)?E="500":/light/i.test(o)&&(E="200"),_=i.tinySDF=new $t.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:p,fontWeight:E})}const S=_.draw(String.fromCharCode(h));return{id:h,bitmap:new l.o({width:S.width||60,height:S.height||60},S.data),metrics:{width:S.glyphWidth/2||24,height:S.glyphHeight/2||24,left:S.glyphLeft/2+.5||0,top:S.glyphTop/2-27.5||-8,advance:S.glyphAdvance/2||24,isDoubleResolution:!0}}}}$t.loadGlyphRange=function(y,i,o,h){return l._(this,void 0,void 0,function*(){const p=256*i,_=p+255,S=h.transformRequest(o.replace("{fontstack}",y).replace("{range}",`${p}-${_}`),"Glyphs"),E=yield l.l(S,new AbortController);if(!E||!E.data)throw new Error(`Could not load glyph range. range: ${i}, ${p}-${_}`);const C={};for(const D of l.n(E.data))C[D.id]=D;return C})},$t.TinySDF=class{constructor({fontSize:y=24,buffer:i=3,radius:o=8,cutoff:h=.25,fontFamily:p="sans-serif",fontWeight:_="normal",fontStyle:S="normal"}={}){this.buffer=i,this.cutoff=h,this.radius=o;const E=this.size=y+4*i,C=this._createCanvas(E),D=this.ctx=C.getContext("2d",{willReadFrequently:!0});D.font=`${S} ${_} ${y}px ${p}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}_createCanvas(y){const i=document.createElement("canvas");return i.width=i.height=y,i}draw(y){const{width:i,actualBoundingBoxAscent:o,actualBoundingBoxDescent:h,actualBoundingBoxLeft:p,actualBoundingBoxRight:_}=this.ctx.measureText(y),S=Math.ceil(o),E=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-p))),C=Math.min(this.size-this.buffer,S+Math.ceil(h)),D=E+2*this.buffer,F=C+2*this.buffer,B=Math.max(D*F,0),q=new Uint8ClampedArray(B),re={data:q,width:D,height:F,glyphWidth:E,glyphHeight:C,glyphTop:S,glyphLeft:0,glyphAdvance:i};if(E===0||C===0)return re;const{ctx:te,buffer:se,gridInner:K,gridOuter:me}=this;te.clearRect(se,se,E,C),te.fillText(y,se,se+S);const Pe=te.getImageData(se,se,E,C);me.fill(ci,0,B),K.fill(0,0,B);for(let le=0;le<C;le++)for(let Me=0;Me<E;Me++){const ke=Pe.data[4*(le*E+Me)+3]/255;if(ke===0)continue;const Le=(le+se)*D+Me+se;if(ke===1)me[Le]=0,K[Le]=ci;else{const Oe=.5-ke;me[Le]=Oe>0?Oe*Oe:0,K[Le]=Oe<0?Oe*Oe:0}}xt(me,0,0,D,F,D,this.f,this.v,this.z),xt(K,se,se,E,C,D,this.f,this.v,this.z);for(let le=0;le<B;le++){const Me=Math.sqrt(me[le])-Math.sqrt(K[le]);q[le]=Math.round(255-255*(Me/this.radius+this.cutoff))}return re}};class ai{constructor(){this.specification=l.v.light.position}possiblyEvaluate(i,o){return l.y(i.expression.evaluate(o))}interpolate(i,o,h){return{x:l.z.number(i.x,o.x,h),y:l.z.number(i.y,o.y,h),z:l.z.number(i.z,o.z,h)}}}let Zi;class Bi extends l.E{constructor(i){super(),Zi=Zi||new l.q({anchor:new l.D(l.v.light.anchor),position:new ai,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.T(Zi),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,o={}){if(!this._validate(l.r,i,o))for(const h in i){const p=i[h];h.endsWith("-transition")?this._transitionable.setTransition(h.slice(0,-11),p):this._transitionable.setValue(h,p)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,o,h){return(!h||h.validate!==!1)&&l.t(this,i.call(l.x,{value:o,style:{glyphs:!0,sprite:!0},styleSpec:l.v}))}}class We{constructor(i,o){this.width=i,this.height=o,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(i,o){const h=i.join(",")+String(o);return this.dashEntry[h]||(this.dashEntry[h]=this.addDash(i,o)),this.dashEntry[h]}getDashRanges(i,o,h){const p=[];let _=i.length%2==1?-i[i.length-1]*h:0,S=i[0]*h,E=!0;p.push({left:_,right:S,isDash:E,zeroLength:i[0]===0});let C=i[0];for(let D=1;D<i.length;D++){E=!E;const F=i[D];_=C*h,C+=F,S=C*h,p.push({left:_,right:S,isDash:E,zeroLength:F===0})}return p}addRoundDash(i,o,h){const p=o/2;for(let _=-h;_<=h;_++){const S=this.width*(this.nextRow+h+_);let E=0,C=i[E];for(let D=0;D<this.width;D++){D/C.right>1&&(C=i[++E]);const F=Math.abs(D-C.left),B=Math.abs(D-C.right),q=Math.min(F,B);let re;const te=_/h*(p+1);if(C.isDash){const se=p-Math.abs(te);re=Math.sqrt(q*q+se*se)}else re=p-Math.sqrt(q*q+te*te);this.data[S+D]=Math.max(0,Math.min(255,re+128))}}}addRegularDash(i){for(let E=i.length-1;E>=0;--E){const C=i[E],D=i[E+1];C.zeroLength?i.splice(E,1):D&&D.isDash===C.isDash&&(D.left=C.left,i.splice(E,1))}const o=i[0],h=i[i.length-1];o.isDash===h.isDash&&(o.left=h.left-this.width,h.right=o.right+this.width);const p=this.width*this.nextRow;let _=0,S=i[_];for(let E=0;E<this.width;E++){E/S.right>1&&(S=i[++_]);const C=Math.abs(E-S.left),D=Math.abs(E-S.right),F=Math.min(C,D);this.data[p+E]=Math.max(0,Math.min(255,(S.isDash?F:-F)+128))}}addDash(i,o){const h=o?7:0,p=2*h+1;if(this.nextRow+p>this.height)return l.w("LineAtlas out of space"),null;let _=0;for(let E=0;E<i.length;E++)_+=i[E];if(_!==0){const E=this.width/_,C=this.getDashRanges(i,this.width,E);o?this.addRoundDash(C,E,h):this.addRegularDash(C)}const S={y:(this.nextRow+h+.5)/this.height,height:2*h/this.height,width:_};return this.nextRow+=p,this.dirty=!0,S}bind(i){const o=i.gl;this.texture?(o.bindTexture(o.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,o.texSubImage2D(o.TEXTURE_2D,0,0,0,this.width,this.height,o.ALPHA,o.UNSIGNED_BYTE,this.data))):(this.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.ALPHA,this.width,this.height,0,o.ALPHA,o.UNSIGNED_BYTE,this.data))}}const it="maplibre_preloaded_worker_pool";class Qe{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<Qe.workerCount;)this.workers.push(new Worker(l.a.WORKER_URL));return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[it]}numActive(){return Object.keys(this.active).length}}const Xi=Math.floor(k.hardwareConcurrency/2);let ji,Mi;function je(){return ji||(ji=new Qe),ji}Qe.workerCount=l.B(globalThis)?Math.max(Math.min(Xi,3),1):1;class Tt{constructor(i,o){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=o;const h=this.workerPool.acquire(o);for(let p=0;p<h.length;p++){const _=new l.C(h[p],o);_.name=`Worker ${p}`,this.actors.push(_)}if(!this.actors.length)throw new Error("No actors found")}broadcast(i,o){const h=[];for(const p of this.actors)h.push(p.sendAsync({type:i,data:o}));return Promise.all(h)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(i=!0){this.actors.forEach(o=>{o.remove()}),this.actors=[],i&&this.workerPool.release(this.id)}registerMessageHandler(i,o){for(const h of this.actors)h.registerMessageHandler(i,o)}}function ut(){return Mi||(Mi=new Tt(je(),l.G),Mi.registerMessageHandler("GR",(y,i,o)=>l.m(i,o))),Mi}function et(y,i){const o=l.F();return l.H(o,o,[1,1,0]),l.J(o,o,[.5*y.width,.5*y.height,1]),l.K(o,o,y.calculatePosMatrix(i.toUnwrapped()))}function ki(y,i,o,h,p,_){const S=function(B,q,re){if(B)for(const te of B){const se=q[te];if(se&&se.source===re&&se.type==="fill-extrusion")return!0}else for(const te in q){const se=q[te];if(se.source===re&&se.type==="fill-extrusion")return!0}return!1}(p&&p.layers,i,y.id),E=_.maxPitchScaleFactor(),C=y.tilesIn(h,E,S);C.sort(Oi);const D=[];for(const B of C)D.push({wrappedTileID:B.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(i,o,y._state,B.queryGeometry,B.cameraQueryGeometry,B.scale,p,_,E,et(y.transform,B.tileID))});const F=function(B){const q={},re={};for(const te of B){const se=te.queryResults,K=te.wrappedTileID,me=re[K]=re[K]||{};for(const Pe in se){const le=se[Pe],Me=me[Pe]=me[Pe]||{},ke=q[Pe]=q[Pe]||[];for(const Le of le)Me[Le.featureIndex]||(Me[Le.featureIndex]=!0,ke.push(Le))}}return q}(D);for(const B in F)F[B].forEach(q=>{const re=q.feature,te=y.getFeatureState(re.layer["source-layer"],re.id);re.source=re.layer.source,re.layer["source-layer"]&&(re.sourceLayer=re.layer["source-layer"]),re.state=te});return F}function Oi(y,i){const o=y.tileID,h=i.tileID;return o.overscaledZ-h.overscaledZ||o.canonical.y-h.canonical.y||o.wrap-h.wrap||o.canonical.x-h.canonical.x}function ae(y,i,o){return l._(this,void 0,void 0,function*(){let h=y;if(y.url?h=(yield l.h(i.transformRequest(y.url,"Source"),o)).data:yield k.frameAsync(o),!h)return null;const p=l.L(l.e(h,y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in h&&h.vector_layers&&(p.vectorLayerIds=h.vector_layers.map(_=>_.id)),p})}class ue{constructor(i,o){i&&(o?this.setSouthWest(i).setNorthEast(o):Array.isArray(i)&&(i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1])))}setNorthEast(i){return this._ne=i instanceof l.M?new l.M(i.lng,i.lat):l.M.convert(i),this}setSouthWest(i){return this._sw=i instanceof l.M?new l.M(i.lng,i.lat):l.M.convert(i),this}extend(i){const o=this._sw,h=this._ne;let p,_;if(i instanceof l.M)p=i,_=i;else{if(!(i instanceof ue))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(ue.convert(i)):this.extend(l.M.convert(i)):i&&("lng"in i||"lon"in i)&&"lat"in i?this.extend(l.M.convert(i)):this;if(p=i._sw,_=i._ne,!p||!_)return this}return o||h?(o.lng=Math.min(p.lng,o.lng),o.lat=Math.min(p.lat,o.lat),h.lng=Math.max(_.lng,h.lng),h.lat=Math.max(_.lat,h.lat)):(this._sw=new l.M(p.lng,p.lat),this._ne=new l.M(_.lng,_.lat)),this}getCenter(){return new l.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.M(this.getWest(),this.getNorth())}getSouthEast(){return new l.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:o,lat:h}=l.M.convert(i);let p=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&p}static convert(i){return i instanceof ue?i:i&&new ue(i)}static fromLngLat(i,o=0){const h=360*o/40075017,p=h/Math.cos(Math.PI/180*i.lat);return new ue(new l.M(i.lng-p,i.lat-h),new l.M(i.lng+p,i.lat+h))}}class De{constructor(i,o,h){this.bounds=ue.convert(this.validateBounds(i)),this.minzoom=o||0,this.maxzoom=h||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const o=Math.pow(2,i.z),h=Math.floor(l.N(this.bounds.getWest())*o),p=Math.floor(l.O(this.bounds.getNorth())*o),_=Math.ceil(l.N(this.bounds.getEast())*o),S=Math.ceil(l.O(this.bounds.getSouth())*o);return i.x>=h&&i.x<_&&i.y>=p&&i.y<S}}class Fe extends l.E{constructor(i,o,h,p){if(super(),this.id=i,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.L(o,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p)}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield ae(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),i&&(l.e(this,i),i.bounds&&(this.tileBounds=new De(i.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(i){this._tileJSONRequest=null,this.fire(new l.j(i))}})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}setSourceProperty(i){this._tileJSONRequest&&this._tileJSONRequest.abort(),i(),this.load()}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}setUrl(i){return this.setSourceProperty(()=>{this.url=i,this._options.url=i}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(i){return l._(this,void 0,void 0,function*(){const o=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),h={request:this.map._requestManager.transformRequest(o,"Tile"),uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};h.request.collectResourceTiming=this._collectResourceTiming;let p="RT";if(i.actor&&i.state!=="expired"){if(i.state==="loading")return new Promise((_,S)=>{i.reloadPromise={resolve:_,reject:S}})}else i.actor=this.dispatcher.getActor(),p="LT";i.abortController=new AbortController;try{const _=yield i.actor.sendAsync({type:p,data:h},i.abortController);if(delete i.abortController,i.aborted)return;this._afterTileLoadWorkerResponse(i,_)}catch(_){if(delete i.abortController,i.aborted)return;if(_&&_.status!==404)throw _;this._afterTileLoadWorkerResponse(i,null)}})}_afterTileLoadWorkerResponse(i,o){if(o&&o.resourceTiming&&(i.resourceTiming=o.resourceTiming),o&&this.map._refreshExpiredTiles&&i.setExpiryData(o),i.loadVectorData(o,this.map.painter),i.reloadPromise){const h=i.reloadPromise;i.reloadPromise=null,this.loadTile(i).then(h.resolve).catch(h.reject)}}abortTile(i){return l._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.actor&&(yield i.actor.sendAsync({type:"AT",data:{uid:i.uid,type:this.type,source:this.id}}))})}unloadTile(i){return l._(this,void 0,void 0,function*(){i.unloadVectorData(),i.actor&&(yield i.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ce extends l.E{constructor(i,o,h,p){super(),this.id=i,this.dispatcher=h,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},o),l.e(this,l.L(o,["url","scheme","tileSize"]))}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield ae(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,i&&(l.e(this,i),i.bounds&&(this.tileBounds=new De(i.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(i){this._tileJSONRequest=null,this.fire(new l.j(i))}})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(i){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),i(),this.load()}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}setUrl(i){return this.setSourceProperty(()=>{this.url=i,this._options.url=i}),this}serialize(){return l.e({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i){return l._(this,void 0,void 0,function*(){const o=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);i.abortController=new AbortController;try{const h=yield ee.getImage(this.map._requestManager.transformRequest(o,"Tile"),i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(h&&h.data){this.map._refreshExpiredTiles&&h.cacheControl&&h.expires&&i.setExpiryData({cacheControl:h.cacheControl,expires:h.expires});const p=this.map.painter.context,_=p.gl,S=h.data;i.texture=this.map.painter.getTileTexture(S.width),i.texture?i.texture.update(S,{useMipmap:!0}):(i.texture=new Lt(p,S,_.RGBA,{useMipmap:!0}),i.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST),p.extTextureFilterAnisotropic&&_.texParameterf(_.TEXTURE_2D,p.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,p.extTextureFilterAnisotropicMax)),i.state="loaded"}}catch(h){if(delete i.abortController,i.aborted)i.state="unloaded";else if(h)throw i.state="errored",h}})}abortTile(i){return l._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController)})}unloadTile(i){return l._(this,void 0,void 0,function*(){i.texture&&this.map.painter.saveTileTexture(i.texture)})}hasTransition(){return!1}}class dt extends ce{constructor(i,o,h,p){super(i,o,h,p),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox",this.redFactor=o.redFactor,this.greenFactor=o.greenFactor,this.blueFactor=o.blueFactor,this.baseShift=o.baseShift}loadTile(i){return l._(this,void 0,void 0,function*(){const o=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),h=this.map._requestManager.transformRequest(o,"Tile");i.neighboringTiles=this._getNeighboringTiles(i.tileID),i.abortController=new AbortController;try{const p=yield ee.getImage(h,i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(p&&p.data){const _=p.data;this.map._refreshExpiredTiles&&p.cacheControl&&p.expires&&i.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const S=l.b(_)&&l.S()?_:yield this.readImageNow(_),E={type:this.type,uid:i.uid,source:this.id,rawImageData:S,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!i.actor||i.state==="expired"){i.actor=this.dispatcher.getActor();const C=yield i.actor.sendAsync({type:"LDT",data:E});i.dem=C,i.needsHillshadePrepare=!0,i.needsTerrainPrepare=!0,i.state="loaded"}}}catch(p){if(delete i.abortController,i.aborted)i.state="unloaded";else if(p)throw i.state="errored",p}})}readImageNow(i){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.U()){const o=i.width+2,h=i.height+2;try{return new l.R({width:o,height:h},yield l.V(i,-1,-1,o,h))}catch{}}return k.getImageData(i,1)})}_getNeighboringTiles(i){const o=i.canonical,h=Math.pow(2,o.z),p=(o.x-1+h)%h,_=o.x===0?i.wrap-1:i.wrap,S=(o.x+1+h)%h,E=o.x+1===h?i.wrap+1:i.wrap,C={};return C[new l.Q(i.overscaledZ,_,o.z,p,o.y).key]={backfilled:!1},C[new l.Q(i.overscaledZ,E,o.z,S,o.y).key]={backfilled:!1},o.y>0&&(C[new l.Q(i.overscaledZ,_,o.z,p,o.y-1).key]={backfilled:!1},C[new l.Q(i.overscaledZ,i.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},C[new l.Q(i.overscaledZ,E,o.z,S,o.y-1).key]={backfilled:!1}),o.y+1<h&&(C[new l.Q(i.overscaledZ,_,o.z,p,o.y+1).key]={backfilled:!1},C[new l.Q(i.overscaledZ,i.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},C[new l.Q(i.overscaledZ,E,o.z,S,o.y+1).key]={backfilled:!1}),C}unloadTile(i){return l._(this,void 0,void 0,function*(){i.demTexture&&this.map.painter.saveTileTexture(i.demTexture),i.fbo&&(i.fbo.destroy(),delete i.fbo),i.dem&&delete i.dem,delete i.neighboringTiles,i.state="unloaded",i.actor&&(yield i.actor.sendAsync({type:"RDT",data:{type:this.type,uid:i.uid,source:this.id}}))})}}class Pt extends l.E{constructor(i,o,h,p){super(),this.id=i,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=h.getActor(),this.setEventedParent(p),this._data=o.data,this._options=l.e({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const _=l.W/this.tileSize;this.workerOptions=l.e({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*_,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*_,extent:l.W,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:l.W,radius:(o.clusterRadius||50)*_,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return l._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(i){this.map=i,this.load()}setData(i){return this._data=i,this._updateWorkerData(),this}updateData(i){return this._updateWorkerData(i),this}setClusterOptions(i){return this.workerOptions.cluster=i.cluster,i&&(i.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=i.clusterRadius),i.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=i.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(i){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:i,source:this.id}})}getClusterChildren(i){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:i,source:this.id}})}getClusterLeaves(i,o,h){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:i,limit:o,offset:h}})}_updateWorkerData(i){return l._(this,void 0,void 0,function*(){const o=l.e({type:this.type},this.workerOptions);i?o.dataDiff=i:typeof this._data=="string"?(o.request=this.map._requestManager.transformRequest(k.resolveURL(this._data),"Source"),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.k("dataloading",{dataType:"source"}));try{const h=yield this.actor.sendAsync({type:"LD",data:o});if(this._pendingLoads--,this._removed||h.abandoned)return void this.fire(new l.k("dataabort",{dataType:"source"}));let p=null;h.resourceTiming&&h.resourceTiming[this.id]&&(p=h.resourceTiming[this.id].slice(0));const _={dataType:"source"};this._collectResourceTiming&&p&&p.length>0&&l.e(_,{resourceTiming:p}),this.fire(new l.k("data",Object.assign(Object.assign({},_),{sourceDataType:"metadata"}))),this.fire(new l.k("data",Object.assign(Object.assign({},_),{sourceDataType:"content"})))}catch(h){if(this._pendingLoads--,this._removed)return void this.fire(new l.k("dataabort",{dataType:"source"}));this.fire(new l.j(h))}})}loaded(){return this._pendingLoads===0}loadTile(i){return l._(this,void 0,void 0,function*(){const o=i.actor?"RT":"LT";i.actor=this.actor;const h={type:this.type,uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};i.abortController=new AbortController;const p=yield this.actor.sendAsync({type:o,data:h},i.abortController);delete i.abortController,i.unloadVectorData(),i.aborted||i.loadVectorData(p,this.map.painter,o==="RT")})}abortTile(i){return l._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.aborted=!0})}unloadTile(i){return l._(this,void 0,void 0,function*(){i.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Be=l.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class st extends l.E{constructor(i,o,h,p){super(),this.id=i,this.dispatcher=h,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=o}load(i){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const o=yield ee.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,o&&o.data&&(this.image=o.data,i&&(this.coordinates=i),this._finishLoading())}catch(o){this._request=null,this._loaded=!0,this.fire(new l.j(o))}})}loaded(){return this._loaded}updateImage(i){return i.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=i.url,this.load(i.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(i){this.coordinates=i;const o=i.map(l.Y.fromLngLat);this.tileID=function(p){let _=1/0,S=1/0,E=-1/0,C=-1/0;for(const q of p)_=Math.min(_,q.x),S=Math.min(S,q.y),E=Math.max(E,q.x),C=Math.max(C,q.y);const D=Math.max(E-_,C-S),F=Math.max(0,Math.floor(-Math.log(D)/Math.LN2)),B=Math.pow(2,F);return new l.a0(F,Math.floor((_+E)/2*B),Math.floor((S+C)/2*B))}(o),this.minzoom=this.maxzoom=this.tileID.z;const h=o.map(p=>this.tileID.getTilePoint(p)._round());return this._boundsArray=new l.Z,this._boundsArray.emplaceBack(h[0].x,h[0].y,0,0),this._boundsArray.emplaceBack(h[1].x,h[1].y,l.W,0),this._boundsArray.emplaceBack(h[3].x,h[3].y,0,l.W),this._boundsArray.emplaceBack(h[2].x,h[2].y,l.W,l.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const i=this.map.painter.context,o=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,Be.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Lt(i,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let h=!1;for(const p in this.tiles){const _=this.tiles[p];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,h=!0)}h&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(i){return l._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={}):i.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class rt extends st{constructor(i,o,h,p){super(i,o,h,p),this.roundZoom=!0,this.type="video",this.options=o}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1;const i=this.options;this.urls=[];for(const o of i.urls)this.urls.push(this.map._requestManager.transformRequest(o,"Source").url);try{const o=yield l.a2(this.urls);if(this._loaded=!0,!o)return;this.video=o,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(o){this.fire(new l.j(o))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(i){if(this.video){const o=this.video.seekable;i<o.start(0)||i>o.end(0)?this.fire(new l.j(new l.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=i}}getVideo(){return this.video}onAdd(i){this.map||(this.map=i,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const i=this.map.painter.context,o=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,Be.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new Lt(i,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let h=!1;for(const p in this.tiles){const _=this.tiles[p];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,h=!0)}h&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Dt extends st{constructor(i,o,h,p){super(i,o,h,p),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(S=>typeof S!="number"))||this.fire(new l.j(new l.a1(`sources.${i}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.j(new l.a1(`sources.${i}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new l.j(new l.a1(`sources.${i}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new l.j(new l.a1(`sources.${i}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.j(new l.a1(`sources.${i}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){return l._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(i){this.map=i,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let i=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,i=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,i=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context,h=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Be.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture?(i||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Lt(o,this.canvas,h.RGBA,{premultiply:!0});let p=!1;for(const _ in this.tiles){const S=this.tiles[_];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,p=!0)}p&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const i of[this.canvas.width,this.canvas.height])if(isNaN(i)||i<=0)return!0;return!1}}const Kt={},Zt=y=>{switch(y){case"geojson":return Pt;case"image":return st;case"raster":return ce;case"raster-dem":return dt;case"vector":return Fe;case"video":return rt;case"canvas":return Dt}return Kt[y]},Jt="RTLPluginLoaded";class yi extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=ut()}_syncState(i){return this.status=i,this.dispatcher.broadcast("SRPS",{pluginStatus:i,pluginURL:this.url}).catch(o=>{throw this.status="error",o})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(i){return l._(this,arguments,void 0,function*(o,h=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=k.resolveURL(o),!this.url)throw new Error(`requested url ${o} is invalid`);if(this.status==="unavailable"){if(!h)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return l._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.k(Jt))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Ti=null;function Ve(){return Ti||(Ti=new yi),Ti}class Ni{constructor(i,o){this.timeAdded=0,this.fadeEndTime=0,this.tileID=i,this.uid=l.a3(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(i){const o=i+this.timeAdded;o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(i){this.demTexture&&i.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(i,o,h){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(p,_){const S={};if(!_)return S;for(const E of p){const C=E.layerIds.map(D=>_.getLayer(D)).filter(Boolean);if(C.length!==0){E.layers=C,E.stateDependentLayerIds&&(E.stateDependentLayers=E.stateDependentLayerIds.map(D=>C.filter(F=>F.id===D)[0]));for(const D of C)S[D.id]=E}}return S}(i.buckets,o.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const _=this.buckets[p];if(_ instanceof l.a5){if(this.hasSymbolBuckets=!0,!h)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const _=this.buckets[p];if(_ instanceof l.a5&&_.hasRTLText){this.hasRTLText=!0,Ve().lazyLoad();break}}this.queryPadding=0;for(const p in this.buckets){const _=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(p).queryRadius(_))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage)}else this.collisionBoxArray=new l.a4}unloadVectorData(){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(i){return this.buckets[i.id]}upload(i){for(const h in this.buckets){const p=this.buckets[h];p.uploadPending()&&p.upload(i)}const o=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Lt(i,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Lt(i,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,o,h,p,_,S,E,C,D,F){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:_,scale:S,tileSize:this.tileSize,pixelPosMatrix:F,transform:C,params:E,queryPadding:this.queryPadding*D},i,o,h):{}}querySourceFeatures(i,o){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const p=h.loadVTLayers(),_=o&&o.sourceLayer?o.sourceLayer:"",S=p._geojsonTileLayer||p[_];if(!S)return;const E=l.a6(o&&o.filter),{z:C,x:D,y:F}=this.tileID.canonical,B={z:C,x:D,y:F};for(let q=0;q<S.length;q++){const re=S.feature(q);if(E.needGeometry){const K=l.a7(re,!0);if(!E.filter(new l.a8(this.tileID.overscaledZ),K,this.tileID.canonical))continue}else if(!E.filter(new l.a8(this.tileID.overscaledZ),re))continue;const te=h.getId(re,_),se=new l.a9(re,C,D,F,te);se.tile=B,i.push(se)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const o=this.expirationTime;if(i.cacheControl){const h=l.aa(i.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const h=Date.now();let p=!1;if(this.expirationTime>h)p=!1;else if(o)if(this.expirationTime<o)p=!0;else{const _=this.expirationTime-o;_?this.expirationTime=h+Math.max(_,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(i,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(i).length===0)return;const h=this.latestFeatureIndex.loadVTLayers();for(const p in this.buckets){if(!o.style.hasLayer(p))continue;const _=this.buckets[p],S=_.layers[0].sourceLayer||"_geojsonTileLayer",E=h[S],C=i[S];if(!E||!C||Object.keys(C).length===0)continue;_.update(C,E,this.imageAtlas&&this.imageAtlas.patternPositions||{});const D=o&&o.style&&o.style.getLayer(p);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<k.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=k.now()+i}setDependencies(i,o){const h={};for(const p of o)h[p]=!0;this.dependencies[i]=h}hasDependency(i,o){for(const h of i){const p=this.dependencies[h];if(p){for(const _ of o)if(p[_])return!0}}return!1}}class Qi{constructor(i,o){this.max=i,this.onRemove=o,this.reset()}reset(){for(const i in this.data)for(const o of this.data[i])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(i,o,h){const p=i.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const _={value:o,timeout:void 0};if(h!==void 0&&(_.timeout=setTimeout(()=>{this.remove(i,_)},h)),this.data[p].push(_),this.order.push(p),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const o=this.data[i].shift();return o.timeout&&clearTimeout(o.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),o.value}getByKey(i){const o=this.data[i];return o?o[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,o){if(!this.has(i))return this;const h=i.wrapped().key,p=o===void 0?0:this.data[h].indexOf(o),_=this.data[h][p];return this.data[h].splice(p,1),_.timeout&&clearTimeout(_.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(_.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(i){const o=[];for(const h in this.data)for(const p of this.data[h])i(p.value)||o.push(p);for(const h of o)this.remove(h.value.tileID,h)}}class _n{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,o,h){const p=String(o);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][p]=this.stateChanges[i][p]||{},l.e(this.stateChanges[i][p],h),this.deletedStates[i]===null){this.deletedStates[i]={};for(const _ in this.state[i])_!==p&&(this.deletedStates[i][_]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][p]===null){this.deletedStates[i][p]={};for(const _ in this.state[i][p])h[_]||(this.deletedStates[i][p][_]=null)}else for(const _ in h)this.deletedStates[i]&&this.deletedStates[i][p]&&this.deletedStates[i][p][_]===null&&delete this.deletedStates[i][p][_]}removeFeatureState(i,o,h){if(this.deletedStates[i]===null)return;const p=String(o);if(this.deletedStates[i]=this.deletedStates[i]||{},h&&o!==void 0)this.deletedStates[i][p]!==null&&(this.deletedStates[i][p]=this.deletedStates[i][p]||{},this.deletedStates[i][p][h]=null);else if(o!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][p])for(h in this.deletedStates[i][p]={},this.stateChanges[i][p])this.deletedStates[i][p][h]=null;else this.deletedStates[i][p]=null;else this.deletedStates[i]=null}getState(i,o){const h=String(o),p=l.e({},(this.state[i]||{})[h],(this.stateChanges[i]||{})[h]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){const _=this.deletedStates[i][o];if(_===null)return{};for(const S in _)delete p[S]}return p}initializeTileState(i,o){i.setFeatureState(this.state,o)}coalesceChanges(i,o){const h={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const _={};for(const S in this.stateChanges[p])this.state[p][S]||(this.state[p][S]={}),l.e(this.state[p][S],this.stateChanges[p][S]),_[S]=this.state[p][S];h[p]=_}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const _={};if(this.deletedStates[p]===null)for(const S in this.state[p])_[S]={},this.state[p][S]={};else for(const S in this.deletedStates[p]){if(this.deletedStates[p][S]===null)this.state[p][S]={};else for(const E of Object.keys(this.deletedStates[p][S]))delete this.state[p][S][E];_[S]=this.state[p][S]}h[p]=h[p]||{},l.e(h[p],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(const p in i)i[p].setFeatureState(h,o)}}class Sr extends l.E{constructor(i,o,h){super(),this.id=i,this.dispatcher=h,this.on("data",p=>this._dataHandler(p)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((p,_,S,E)=>{const C=new(Zt(_.type))(p,_,S,E);if(C.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${C.id}`);return C})(i,o,h,this),this._tiles={},this._cache=new Qi(0,p=>this._unloadTile(p)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new _n,this._didEmitContent=!1,this._updated=!1}onAdd(i){this.map=i,this._maxTileCacheSize=i?i._maxTileCacheSize:null,this._maxTileCacheZoomLevels=i?i._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(i)}onRemove(i){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(i)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const i in this._tiles){const o=this._tiles[i];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(i,o,h){return l._(this,void 0,void 0,function*(){try{yield this._source.loadTile(i),this._tileLoaded(i,o,h)}catch(p){i.state="errored",p.status!==404?this._source.fire(new l.j(p,{tile:i})):this.update(this.transform,this.terrain)}})}_unloadTile(i){this._source.unloadTile&&this._source.unloadTile(i)}_abortTile(i){this._source.abortTile&&this._source.abortTile(i),this._source.fire(new l.k("dataabort",{tile:i,coord:i.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const h=this._tiles[o];h.upload(i),h.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(i=>i.tileID).sort(at).map(i=>i.key)}getRenderableIds(i){const o=[];for(const h in this._tiles)this._isIdRenderable(h,i)&&o.push(this._tiles[h]);return i?o.sort((h,p)=>{const _=h.tileID,S=p.tileID,E=new l.P(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),C=new l.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-S.overscaledZ||C.y-E.y||C.x-E.x}).map(h=>h.tileID.key):o.map(h=>h.tileID).sort(at).map(h=>h.key)}hasRenderableParent(i){const o=this.findLoadedParent(i,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(i,o){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(o||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(i,"reloading")}}_reloadTile(i,o){return l._(this,void 0,void 0,function*(){const h=this._tiles[i];h&&(h.state!=="loading"&&(h.state=o),yield this._loadTile(h,i,o))})}_tileLoaded(i,o,h){i.timeAdded=k.now(),h==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(o,i),this.getSource().type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),i.aborted||this._source.fire(new l.k("data",{dataType:"source",tile:i,coord:i.tileID}))}_backfillDEM(i){const o=this.getRenderableIds();for(let p=0;p<o.length;p++){const _=o[p];if(i.neighboringTiles&&i.neighboringTiles[_]){const S=this.getTileByID(_);h(i,S),h(S,i)}}function h(p,_){p.needsHillshadePrepare=!0,p.needsTerrainPrepare=!0;let S=_.tileID.canonical.x-p.tileID.canonical.x;const E=_.tileID.canonical.y-p.tileID.canonical.y,C=Math.pow(2,p.tileID.canonical.z),D=_.tileID.key;S===0&&E===0||Math.abs(E)>1||(Math.abs(S)>1&&(Math.abs(S+C)===1?S+=C:Math.abs(S-C)===1&&(S-=C)),_.dem&&p.dem&&(p.dem.backfillBorder(_.dem,S,E),p.neighboringTiles&&p.neighboringTiles[D]&&(p.neighboringTiles[D].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,o,h,p){for(const _ in this._tiles){let S=this._tiles[_];if(p[_]||!S.hasData()||S.tileID.overscaledZ<=o||S.tileID.overscaledZ>h)continue;let E=S.tileID;for(;S&&S.tileID.overscaledZ>o+1;){const D=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[D.key],S&&S.hasData()&&(E=D)}let C=E;for(;C.overscaledZ>o;)if(C=C.scaledTo(C.overscaledZ-1),i[C.key]){p[E.key]=E;break}}}findLoadedParent(i,o){if(i.key in this._loadedParentTiles){const h=this._loadedParentTiles[i.key];return h&&h.tileID.overscaledZ>=o?h:null}for(let h=i.overscaledZ-1;h>=o;h--){const p=i.scaledTo(h),_=this._getLoadedTile(p);if(_)return _}}_getLoadedTile(i){const o=this._tiles[i.key];return o&&o.hasData()?o:this._cache.getByKey(i.wrapped().key)}updateCacheSize(i){const o=Math.ceil(i.width/this._source.tileSize)+1,h=Math.ceil(i.height/this._source.tileSize)+1,p=Math.floor(o*h*(this._maxTileCacheZoomLevels===null?l.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(_)}handleWrapJump(i){const o=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,o){const h={};for(const p in this._tiles){const _=this._tiles[p];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+o),h[_.tileID.key]=_}this._tiles=h;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(p,this._tiles[p])}}update(i,o){if(!this._sourceLoaded||this._paused)return;let h;this.transform=i,this.terrain=o,this.updateCacheSize(i),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(F=>new l.Q(F.canonical.z,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y)):(h=i.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:o}),this._source.hasTile&&(h=h.filter(F=>this._source.hasTile(F)))):h=[];const p=i.coveringZoomLevel(this._source),_=Math.max(p-Sr.maxOverzooming,this._source.minzoom),S=Math.max(p+Sr.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const F={};for(const B of h)if(B.canonical.z>this._source.minzoom){const q=B.scaledTo(B.canonical.z-1);F[q.key]=q;const re=B.scaledTo(Math.max(this._source.minzoom,Math.min(B.canonical.z,5)));F[re.key]=re}h=h.concat(Object.values(F))}const E=h.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,E&&this.fire(new l.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const C=this._updateRetainedTiles(h,p);if(ui(this._source.type)){const F={},B={},q=Object.keys(C),re=k.now();for(const te of q){const se=C[te],K=this._tiles[te];if(!K||K.fadeEndTime!==0&&K.fadeEndTime<=re)continue;const me=this.findLoadedParent(se,_);me&&(this._addTile(me.tileID),F[me.tileID.key]=me.tileID),B[te]=se}this._retainLoadedChildren(B,p,S,C);for(const te in F)C[te]||(this._coveredTiles[te]=!0,C[te]=F[te]);if(o){const te={},se={};for(const K of h)this._tiles[K.key].hasData()?te[K.key]=K:se[K.key]=K;for(const K in se){const me=se[K].children(this._source.maxzoom);this._tiles[me[0].key]&&this._tiles[me[1].key]&&this._tiles[me[2].key]&&this._tiles[me[3].key]&&(te[me[0].key]=C[me[0].key]=me[0],te[me[1].key]=C[me[1].key]=me[1],te[me[2].key]=C[me[2].key]=me[2],te[me[3].key]=C[me[3].key]=me[3],delete se[K])}for(const K in se){const me=this.findLoadedParent(se[K],this._source.minzoom);if(me){te[me.tileID.key]=C[me.tileID.key]=me.tileID;for(const Pe in te)te[Pe].isChildOf(me.tileID)&&delete te[Pe]}}for(const K in this._tiles)te[K]||(this._coveredTiles[K]=!0)}}for(const F in C)this._tiles[F].clearFadeHold();const D=l.ab(this._tiles,C);for(const F of D){const B=this._tiles[F];B.hasSymbolBuckets&&!B.holdingForFade()?B.setHoldDuration(this.map._fadeDuration):B.hasSymbolBuckets&&!B.symbolFadeFinished()||this._removeTile(F)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(i)}_updateRetainedTiles(i,o){const h={},p={},_=Math.max(o-Sr.maxOverzooming,this._source.minzoom),S=Math.max(o+Sr.maxUnderzooming,this._source.minzoom),E={};for(const C of i){const D=this._addTile(C);h[C.key]=C,D.hasData()||o<this._source.maxzoom&&(E[C.key]=C)}this._retainLoadedChildren(E,o,S,h);for(const C of i){let D=this._tiles[C.key];if(D.hasData())continue;if(o+1>this._source.maxzoom){const B=C.children(this._source.maxzoom)[0],q=this.getTile(B);if(q&&q.hasData()){h[B.key]=B;continue}}else{const B=C.children(this._source.maxzoom);if(h[B[0].key]&&h[B[1].key]&&h[B[2].key]&&h[B[3].key])continue}let F=D.wasRequested();for(let B=C.overscaledZ-1;B>=_;--B){const q=C.scaledTo(B);if(p[q.key])break;if(p[q.key]=!0,D=this.getTile(q),!D&&F&&(D=this._addTile(q)),D){const re=D.hasData();if((F||re)&&(h[q.key]=q),F=D.wasRequested(),re)break}}}return h}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const o=[];let h,p=this._tiles[i].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){h=this._loadedParentTiles[p.key];break}o.push(p.key);const _=p.scaledTo(p.overscaledZ-1);if(h=this._getLoadedTile(_),h)break;p=_}for(const _ of o)this._loadedParentTiles[_]=h}}_addTile(i){let o=this._tiles[i.key];if(o)return o;o=this._cache.getAndRemove(i),o&&(this._setTileReloadTimer(i.key,o),o.tileID=i,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,o)));const h=o;return o||(o=new Ni(i,this._source.tileSize*i.overscaleFactor()),this._loadTile(o,i.key,o.state)),o.uses++,this._tiles[i.key]=o,h||this._source.fire(new l.k("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o}_setTileReloadTimer(i,o){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const h=o.getExpiryTimeout();h&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},h))}_removeTile(i){const o=this._tiles[i];o&&(o.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),o.uses>0||(o.hasData()&&o.state!=="reloading"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}_dataHandler(i){const o=i.sourceDataType;i.dataType==="source"&&o==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&i.dataType==="source"&&o==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(i);this._cache.reset()}tilesIn(i,o,h){const p=[],_=this.transform;if(!_)return p;const S=h?_.getCameraQueryGeometry(i):i,E=i.map(te=>_.pointCoordinate(te,this.terrain)),C=S.map(te=>_.pointCoordinate(te,this.terrain)),D=this.getIds();let F=1/0,B=1/0,q=-1/0,re=-1/0;for(const te of C)F=Math.min(F,te.x),B=Math.min(B,te.y),q=Math.max(q,te.x),re=Math.max(re,te.y);for(let te=0;te<D.length;te++){const se=this._tiles[D[te]];if(se.holdingForFade())continue;const K=se.tileID,me=Math.pow(2,_.zoom-se.tileID.overscaledZ),Pe=o*se.queryPadding*l.W/se.tileSize/me,le=[K.getTilePoint(new l.Y(F,B)),K.getTilePoint(new l.Y(q,re))];if(le[0].x-Pe<l.W&&le[0].y-Pe<l.W&&le[1].x+Pe>=0&&le[1].y+Pe>=0){const Me=E.map(Le=>K.getTilePoint(Le)),ke=C.map(Le=>K.getTilePoint(Le));p.push({tile:se,tileID:K,queryGeometry:Me,cameraQueryGeometry:ke,scale:me})}}return p}getVisibleCoordinates(i){const o=this.getRenderableIds(i).map(h=>this._tiles[h].tileID);for(const h of o)h.posMatrix=this.transform.calculatePosMatrix(h.toUnwrapped());return o}hasTransition(){if(this._source.hasTransition())return!0;if(ui(this._source.type)){const i=k.now();for(const o in this._tiles)if(this._tiles[o].fadeEndTime>=i)return!0}return!1}setFeatureState(i,o,h){this._state.updateState(i=i||"_geojsonTileLayer",o,h)}removeFeatureState(i,o,h){this._state.removeFeatureState(i=i||"_geojsonTileLayer",o,h)}getFeatureState(i,o){return this._state.getState(i=i||"_geojsonTileLayer",o)}setDependencies(i,o,h){const p=this._tiles[i];p&&p.setDependencies(o,h)}reloadTilesForDependencies(i,o){for(const h in this._tiles)this._tiles[h].hasDependency(i,o)&&this._reloadTile(h,"reloading");this._cache.filter(h=>!h.hasDependency(i,o))}}function at(y,i){const o=Math.abs(2*y.wrap)-+(y.wrap<0),h=Math.abs(2*i.wrap)-+(i.wrap<0);return y.overscaledZ-i.overscaledZ||h-o||i.canonical.y-y.canonical.y||i.canonical.x-y.canonical.x}function ui(y){return y==="raster"||y==="image"||y==="video"}Sr.maxOverzooming=10,Sr.maxUnderzooming=3;class Ut{constructor(i,o){this.reset(i,o)}reset(i,o){this.points=i||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=l.ac(i,0,1);let o=1,h=this._distances[o];const p=i*this.paddedLength+this.padding;for(;h<p&&o<this._distances.length;)h=this._distances[++o];const _=o-1,S=this._distances[_],E=h-S,C=E>0?(p-S)/E:0;return this.points[_].mult(1-C).add(this.points[o].mult(C))}}function qi(y,i){let o=!0;return y==="always"||y!=="never"&&i!=="never"||(o=!1),o}class vn{constructor(i,o,h){const p=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(i/h),this.yCellCount=Math.ceil(o/h);for(let S=0;S<this.xCellCount*this.yCellCount;S++)p.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=o,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,o,h,p,_){this._forEachCell(o,h,p,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(_)}insertCircle(i,o,h,p){this._forEachCell(o-p,h-p,o+p,h+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(o),this.circles.push(h),this.circles.push(p)}_insertBoxCell(i,o,h,p,_,S){this.boxCells[_].push(S)}_insertCircleCell(i,o,h,p,_,S){this.circleCells[_].push(S)}_query(i,o,h,p,_,S,E){if(h<0||i>this.width||p<0||o>this.height)return[];const C=[];if(i<=0&&o<=0&&this.width<=h&&this.height<=p){if(_)return[{key:null,x1:i,y1:o,x2:h,y2:p}];for(let D=0;D<this.boxKeys.length;D++)C.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){const F=this.circles[3*D],B=this.circles[3*D+1],q=this.circles[3*D+2];C.push({key:this.circleKeys[D],x1:F-q,y1:B-q,x2:F+q,y2:B+q})}}else this._forEachCell(i,o,h,p,this._queryCell,C,{hitTest:_,overlapMode:S,seenUids:{box:{},circle:{}}},E);return C}query(i,o,h,p){return this._query(i,o,h,p,!1,null)}hitTest(i,o,h,p,_,S){return this._query(i,o,h,p,!0,_,S).length>0}hitTestCircle(i,o,h,p,_){const S=i-h,E=i+h,C=o-h,D=o+h;if(E<0||S>this.width||D<0||C>this.height)return!1;const F=[];return this._forEachCell(S,C,E,D,this._queryCellCircle,F,{hitTest:!0,overlapMode:p,circle:{x:i,y:o,radius:h},seenUids:{box:{},circle:{}}},_),F.length>0}_queryCell(i,o,h,p,_,S,E,C){const{seenUids:D,hitTest:F,overlapMode:B}=E,q=this.boxCells[_];if(q!==null){const te=this.bboxes;for(const se of q)if(!D.box[se]){D.box[se]=!0;const K=4*se,me=this.boxKeys[se];if(i<=te[K+2]&&o<=te[K+3]&&h>=te[K+0]&&p>=te[K+1]&&(!C||C(me))&&(!F||!qi(B,me.overlapMode))&&(S.push({key:me,x1:te[K],y1:te[K+1],x2:te[K+2],y2:te[K+3]}),F))return!0}}const re=this.circleCells[_];if(re!==null){const te=this.circles;for(const se of re)if(!D.circle[se]){D.circle[se]=!0;const K=3*se,me=this.circleKeys[se];if(this._circleAndRectCollide(te[K],te[K+1],te[K+2],i,o,h,p)&&(!C||C(me))&&(!F||!qi(B,me.overlapMode))){const Pe=te[K],le=te[K+1],Me=te[K+2];if(S.push({key:me,x1:Pe-Me,y1:le-Me,x2:Pe+Me,y2:le+Me}),F)return!0}}}return!1}_queryCellCircle(i,o,h,p,_,S,E,C){const{circle:D,seenUids:F,overlapMode:B}=E,q=this.boxCells[_];if(q!==null){const te=this.bboxes;for(const se of q)if(!F.box[se]){F.box[se]=!0;const K=4*se,me=this.boxKeys[se];if(this._circleAndRectCollide(D.x,D.y,D.radius,te[K+0],te[K+1],te[K+2],te[K+3])&&(!C||C(me))&&!qi(B,me.overlapMode))return S.push(!0),!0}}const re=this.circleCells[_];if(re!==null){const te=this.circles;for(const se of re)if(!F.circle[se]){F.circle[se]=!0;const K=3*se,me=this.circleKeys[se];if(this._circlesCollide(te[K],te[K+1],te[K+2],D.x,D.y,D.radius)&&(!C||C(me))&&!qi(B,me.overlapMode))return S.push(!0),!0}}}_forEachCell(i,o,h,p,_,S,E,C){const D=this._convertToXCellCoord(i),F=this._convertToYCellCoord(o),B=this._convertToXCellCoord(h),q=this._convertToYCellCoord(p);for(let re=D;re<=B;re++)for(let te=F;te<=q;te++)if(_.call(this,i,o,h,p,this.xCellCount*te+re,S,E,C))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,o,h,p,_,S){const E=p-i,C=_-o,D=h+S;return D*D>E*E+C*C}_circleAndRectCollide(i,o,h,p,_,S,E){const C=(S-p)/2,D=Math.abs(i-(p+C));if(D>C+h)return!1;const F=(E-_)/2,B=Math.abs(o-(_+F));if(B>F+h)return!1;if(D<=C||B<=F)return!0;const q=D-C,re=B-F;return q*q+re*re<=h*h}}function ii(y,i,o,h,p){const _=l.F();return i?(l.J(_,_,[1/p,1/p,1]),o||l.ad(_,_,h.angle)):l.K(_,h.labelPlaneMatrix,y),_}function ta(y,i,o,h,p){if(i){const _=l.ae(y);return l.J(_,_,[p,p,1]),o||l.ad(_,_,-h.angle),_}return h.glCoordMatrix}function Er(y,i,o){let h;o?(h=[y.x,y.y,o(y.x,y.y),1],l.af(h,h,i)):(h=[y.x,y.y,0,1],Vt(h,h,i));const p=h[3];return{point:new l.P(h[0]/p,h[1]/p),signedDistanceFromCamera:p}}function ie(y,i){return .5+y/i*.5}function N(y,i){const o=y[0]/y[3],h=y[1]/y[3];return o>=-i[0]&&o<=i[0]&&h>=-i[1]&&h<=i[1]}function U(y,i,o,h,p,_,S,E,C,D){const F=h?y.textSizeData:y.iconSizeData,B=l.ag(F,o.transform.zoom),q=[256/o.width*2+1,256/o.height*2+1],re=h?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;re.clear();const te=y.lineVertexArray,se=h?y.text.placedSymbolArray:y.icon.placedSymbolArray,K=o.transform.width/o.transform.height;let me=!1;for(let Pe=0;Pe<se.length;Pe++){const le=se.get(Pe);if(le.hidden||le.writingMode===l.ah.vertical&&!me){Ne(le.numGlyphs,re);continue}let Me;if(me=!1,D?(Me=[le.anchorX,le.anchorY,D(le.anchorX,le.anchorY),1],l.af(Me,Me,i)):(Me=[le.anchorX,le.anchorY,0,1],Vt(Me,Me,i)),!N(Me,q)){Ne(le.numGlyphs,re);continue}const ke=ie(o.transform.cameraToCenterDistance,Me[3]),Le=l.ai(F,B,le),Oe=S?Le/ke:Le*ke,Ke=new l.P(le.anchorX,le.anchorY),Ze=Er(Ke,p,D).point,ot={projections:{},offsets:{}},ht=ve(le,Oe,!1,E,i,p,_,y.glyphOffsetArray,te,re,Ze,Ke,ot,K,C,D);me=ht.useVertical,(ht.notEnoughRoom||me||ht.needsFlipping&&ve(le,Oe,!0,E,i,p,_,y.glyphOffsetArray,te,re,Ze,Ke,ot,K,C,D).notEnoughRoom)&&Ne(le.numGlyphs,re)}h?y.text.dynamicLayoutVertexBuffer.updateData(re):y.icon.dynamicLayoutVertexBuffer.updateData(re)}function H(y,i,o,h,p,_,S,E,C,D,F,B,q){const re=E.glyphStartIndex+E.numGlyphs,te=E.lineStartIndex,se=E.lineStartIndex+E.lineLength,K=i.getoffsetX(E.glyphStartIndex),me=i.getoffsetX(re-1),Pe=Ge(y*K,o,h,p,_,S,E.segment,te,se,C,D,F,B,q);if(!Pe)return null;const le=Ge(y*me,o,h,p,_,S,E.segment,te,se,C,D,F,B,q);return le?{first:Pe,last:le}:null}function Q(y,i,o,h){return y===l.ah.horizontal&&Math.abs(o.y-i.y)>Math.abs(o.x-i.x)*h?{useVertical:!0}:(y===l.ah.vertical?i.y<o.y:i.x>o.x)?{needsFlipping:!0}:null}function ve(y,i,o,h,p,_,S,E,C,D,F,B,q,re,te,se){const K=i/24,me=y.lineOffsetX*K,Pe=y.lineOffsetY*K;let le;if(y.numGlyphs>1){const Me=y.glyphStartIndex+y.numGlyphs,ke=y.lineStartIndex,Le=y.lineStartIndex+y.lineLength,Oe=H(K,E,me,Pe,o,F,B,y,C,_,q,te,se);if(!Oe)return{notEnoughRoom:!0};const Ke=Er(Oe.first.point,S,se).point,Ze=Er(Oe.last.point,S,se).point;if(h&&!o){const ot=Q(y.writingMode,Ke,Ze,re);if(ot)return ot}le=[Oe.first];for(let ot=y.glyphStartIndex+1;ot<Me-1;ot++)le.push(Ge(K*E.getoffsetX(ot),me,Pe,o,F,B,y.segment,ke,Le,C,_,q,te,se));le.push(Oe.last)}else{if(h&&!o){const ke=Er(B,p,se).point,Le=y.lineStartIndex+y.segment+1,Oe=new l.P(C.getx(Le),C.gety(Le)),Ke=Er(Oe,p,se),Ze=Ke.signedDistanceFromCamera>0?Ke.point:xe(B,Oe,ke,1,p,se),ot=Q(y.writingMode,ke,Ze,re);if(ot)return ot}const Me=Ge(K*E.getoffsetX(y.glyphStartIndex),me,Pe,o,F,B,y.segment,y.lineStartIndex,y.lineStartIndex+y.lineLength,C,_,q,te,se);if(!Me)return{notEnoughRoom:!0};le=[Me]}for(const Me of le)l.aj(D,Me.point,Me.angle);return{}}function xe(y,i,o,h,p,_){const S=Er(y.add(y.sub(i)._unit()),p,_).point,E=o.sub(S);return o.add(E._mult(h/E.mag()))}function Se(y,i){const{projectionCache:o,lineVertexArray:h,labelPlaneMatrix:p,tileAnchorPoint:_,distanceFromAnchor:S,getElevation:E,previousVertex:C,direction:D,absOffsetX:F}=i;if(o.projections[y])return o.projections[y];const B=new l.P(h.getx(y),h.gety(y)),q=Er(B,p,E);if(q.signedDistanceFromCamera>0)return o.projections[y]=q.point,q.point;const re=y-D;return xe(S===0?_:new l.P(h.getx(re),h.gety(re)),B,C,F-S+1,p,E)}function de(y,i,o){return y._unit()._perp()._mult(i*o)}function Ae(y,i,o,h,p,_,S,E){const{projectionCache:C,direction:D}=E;if(C.offsets[y])return C.offsets[y];const F=o.add(i);if(y+D<h||y+D>=p)return C.offsets[y]=F,F;const B=Se(y+D,E),q=de(B.sub(o),S,D),re=o.add(q),te=B.add(q);return C.offsets[y]=l.ak(_,F,re,te)||F,C.offsets[y]}function Ge(y,i,o,h,p,_,S,E,C,D,F,B,q,re){const te=h?y-i:y+i;let se=te>0?1:-1,K=0;h&&(se*=-1,K=Math.PI),se<0&&(K+=Math.PI);let me,Pe,le=se>0?E+S:E+S+1,Me=p,ke=p,Le=0,Oe=0;const Ke=Math.abs(te),Ze=[];let ot;for(;Le+Oe<=Ke;){if(le+=se,le<E||le>=C)return null;Le+=Oe,ke=Me,Pe=me;const yt={projectionCache:B,lineVertexArray:D,labelPlaneMatrix:F,tileAnchorPoint:_,distanceFromAnchor:Le,getElevation:re,previousVertex:ke,direction:se,absOffsetX:Ke};if(Me=Se(le,yt),o===0)Ze.push(ke),ot=Me.sub(ke);else{let ti;const pi=Me.sub(ke);ti=pi.mag()===0?de(Se(le+se,yt).sub(Me),o,se):de(pi,o,se),Pe||(Pe=ke.add(ti)),me=Ae(le,ti,Me,E,C,Pe,o,yt),Ze.push(Pe),ot=me.sub(Pe)}Oe=ot.mag()}const ht=ot._mult((Ke-Le)/Oe)._add(Pe||ke),di=K+Math.atan2(Me.y-ke.y,Me.x-ke.x);return Ze.push(ht),{point:ht,angle:q?di:0,path:Ze}}const ze=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ne(y,i){for(let o=0;o<y;o++){const h=i.length;i.resize(h+4),i.float32.set(ze,3*h)}}function Vt(y,i,o){const h=i[0],p=i[1];return y[0]=o[0]*h+o[4]*p+o[12],y[1]=o[1]*h+o[5]*p+o[13],y[3]=o[3]*h+o[7]*p+o[15],y}const Wt=100;class ri{constructor(i,o=new vn(i.width+200,i.height+200,25),h=new vn(i.width+200,i.height+200,25)){this.transform=i,this.grid=o,this.ignoredGrid=h,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Wt,this.screenBottomBoundary=i.height+Wt,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(i,o,h,p,_,S){const E=this.projectAndGetPerspectiveRatio(p,i.anchorPointX,i.anchorPointY,S),C=h*E.perspectiveRatio,D=i.x1*C+E.point.x,F=i.y1*C+E.point.y,B=i.x2*C+E.point.x,q=i.y2*C+E.point.y;return!this.isInsideGrid(D,F,B,q)||o!=="always"&&this.grid.hitTest(D,F,B,q,o,_)||E.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[D,F,B,q],offscreen:this.isOffscreen(D,F,B,q)}}placeCollisionCircles(i,o,h,p,_,S,E,C,D,F,B,q,re,te){const se=[],K=new l.P(o.anchorX,o.anchorY),me=Er(K,S,te),Pe=ie(this.transform.cameraToCenterDistance,me.signedDistanceFromCamera),le=(F?_/Pe:_*Pe)/l.ao,Me=Er(K,E,te).point,ke=H(le,p,o.lineOffsetX*le,o.lineOffsetY*le,!1,Me,K,o,h,E,{projections:{},offsets:{}},!1,te);let Le=!1,Oe=!1,Ke=!0;if(ke){const Ze=.5*q*Pe+re,ot=new l.P(-100,-100),ht=new l.P(this.screenRightBoundary,this.screenBottomBoundary),di=new Ut,yt=ke.first,ti=ke.last;let pi=[];for(let mi=yt.path.length-1;mi>=1;mi--)pi.push(yt.path[mi]);for(let mi=1;mi<ti.path.length;mi++)pi.push(ti.path[mi]);const Li=2.5*Ze;if(C){const mi=pi.map(bi=>Er(bi,C,te));pi=mi.some(bi=>bi.signedDistanceFromCamera<=0)?[]:mi.map(bi=>bi.point)}let si=[];if(pi.length>0){const mi=pi[0].clone(),bi=pi[0].clone();for(let Or=1;Or<pi.length;Or++)mi.x=Math.min(mi.x,pi[Or].x),mi.y=Math.min(mi.y,pi[Or].y),bi.x=Math.max(bi.x,pi[Or].x),bi.y=Math.max(bi.y,pi[Or].y);si=mi.x>=ot.x&&bi.x<=ht.x&&mi.y>=ot.y&&bi.y<=ht.y?[pi]:bi.x<ot.x||mi.x>ht.x||bi.y<ot.y||mi.y>ht.y?[]:l.al([pi],ot.x,ot.y,ht.x,ht.y)}for(const mi of si){di.reset(mi,.25*Ze);let bi=0;bi=di.length<=.5*Ze?1:Math.ceil(di.paddedLength/Li)+1;for(let Or=0;Or<bi;Or++){const tr=Or/Math.max(bi-1,1),hs=di.lerp(tr),sn=hs.x+Wt,Ir=hs.y+Wt;se.push(sn,Ir,Ze,0);const an=sn-Ze,ds=Ir-Ze,la=sn+Ze,Za=Ir+Ze;if(Ke=Ke&&this.isOffscreen(an,ds,la,Za),Oe=Oe||this.isInsideGrid(an,ds,la,Za),i!=="always"&&this.grid.hitTestCircle(sn,Ir,Ze,i,B)&&(Le=!0,!D))return{circles:[],offscreen:!1,collisionDetected:Le}}}}return{circles:!D&&Le||!Oe||Pe<this.perspectiveRatioCutoff?[]:se,offscreen:Ke,collisionDetected:Le}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let h=1/0,p=1/0,_=-1/0,S=-1/0;for(const F of i){const B=new l.P(F.x+Wt,F.y+Wt);h=Math.min(h,B.x),p=Math.min(p,B.y),_=Math.max(_,B.x),S=Math.max(S,B.y),o.push(B)}const E=this.grid.query(h,p,_,S).concat(this.ignoredGrid.query(h,p,_,S)),C={},D={};for(const F of E){const B=F.key;if(C[B.bucketInstanceId]===void 0&&(C[B.bucketInstanceId]={}),C[B.bucketInstanceId][B.featureIndex])continue;const q=[new l.P(F.x1,F.y1),new l.P(F.x2,F.y1),new l.P(F.x2,F.y2),new l.P(F.x1,F.y2)];l.am(o,q)&&(C[B.bucketInstanceId][B.featureIndex]=!0,D[B.bucketInstanceId]===void 0&&(D[B.bucketInstanceId]=[]),D[B.bucketInstanceId].push(B.featureIndex))}return D}insertCollisionBox(i,o,h,p,_,S){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:_,collisionGroupID:S,overlapMode:o},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,o,h,p,_,S){const E=h?this.ignoredGrid:this.grid,C={bucketInstanceId:p,featureIndex:_,collisionGroupID:S,overlapMode:o};for(let D=0;D<i.length;D+=4)E.insertCircle(C,i[D],i[D+1],i[D+2])}projectAndGetPerspectiveRatio(i,o,h,p){let _;return p?(_=[o,h,p(o,h),1],l.af(_,_,i)):(_=[o,h,0,1],Vt(_,_,i)),{point:new l.P((_[0]/_[3]+1)/2*this.transform.width+Wt,(-_[1]/_[3]+1)/2*this.transform.height+Wt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/_[3]*.5}}isOffscreen(i,o,h,p){return h<Wt||i>=this.screenRightBoundary||p<Wt||o>this.screenBottomBoundary}isInsideGrid(i,o,h,p){return h>=0&&i<this.gridRightBoundary&&p>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const i=l.an([]);return l.H(i,i,[-100,-100,0]),i}}function ni(y,i,o){return i*(l.W/(y.tileSize*Math.pow(2,o-y.tileID.overscaledZ)))}class vi{constructor(i,o,h,p){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?o:-o))):p&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class Ui{constructor(i,o,h,p,_){this.text=new vi(i?i.text:null,o,h,_),this.icon=new vi(i?i.icon:null,o,p,_)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class cr{constructor(i,o,h){this.text=i,this.icon=o,this.skipFade=h}}class Br{constructor(){this.invProjMatrix=l.F(),this.viewportMatrix=l.F(),this.circles=[]}}class Yt{constructor(i,o,h,p,_){this.bucketInstanceId=i,this.featureIndex=o,this.sourceLayerIndex=h,this.bucketIndex=p,this.tileID=_}}class _r{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const o=++this.maxGroupID;this.collisionGroups[i]={ID:o,predicate:h=>h.collisionGroupID===o}}return this.collisionGroups[i]}}function Vr(y,i,o,h,p){const{horizontalAlign:_,verticalAlign:S}=l.at(y);return new l.P(-(_-.5)*i+h[0]*p,-(S-.5)*o+h[1]*p)}function xn(y,i,o,h,p,_){const{x1:S,x2:E,y1:C,y2:D,anchorPointX:F,anchorPointY:B}=y,q=new l.P(i,o);return h&&q._rotate(p?_:-_),{x1:S+q.x,y1:C+q.y,x2:E+q.x,y2:D+q.y,anchorPointX:F,anchorPointY:B}}class bn{constructor(i,o,h,p,_){this.transform=i.clone(),this.terrain=o,this.collisionIndex=new ri(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new _r(p),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,o,h,p){const _=h.getBucket(o),S=h.latestFeatureIndex;if(!_||!S||o.id!==_.layerIds[0])return;const E=h.collisionBoxArray,C=_.layers[0].layout,D=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),F=h.tileSize/l.W,B=this.transform.calculatePosMatrix(h.tileID.toUnwrapped()),q=C.get("text-pitch-alignment")==="map",re=C.get("text-rotation-alignment")==="map",te=ni(h,1,this.transform.zoom),se=ii(B,q,re,this.transform,te);let K=null;if(q){const Pe=ta(B,q,re,this.transform,te);K=l.K([],this.transform.labelPlaneMatrix,Pe)}this.retainedQueryData[_.bucketInstanceId]=new Yt(_.bucketInstanceId,S,_.sourceLayerIndex,_.index,h.tileID);const me={bucket:_,layout:C,posMatrix:B,textLabelPlaneMatrix:se,labelToScreenMatrix:K,scale:D,textPixelRatio:F,holdingForFade:h.holdingForFade(),collisionBoxArray:E,partiallyEvaluatedTextSize:l.ag(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(p)for(const Pe of _.sortKeyRanges){const{sortKey:le,symbolInstanceStart:Me,symbolInstanceEnd:ke}=Pe;i.push({sortKey:le,symbolInstanceStart:Me,symbolInstanceEnd:ke,parameters:me})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:me})}attemptAnchorPlacement(i,o,h,p,_,S,E,C,D,F,B,q,re,te,se,K){const me=l.ap[i.textAnchor],Pe=[i.textOffset0,i.textOffset1],le=Vr(me,h,p,Pe,_),Me=this.collisionIndex.placeCollisionBox(xn(o,le.x,le.y,S,E,this.transform.angle),B,C,D,F.predicate,K);if((!se||this.collisionIndex.placeCollisionBox(xn(se,le.x,le.y,S,E,this.transform.angle),B,C,D,F.predicate,K).box.length!==0)&&Me.box.length>0){let ke;if(this.prevPlacement&&this.prevPlacement.variableOffsets[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID].text&&(ke=this.prevPlacement.variableOffsets[q.crossTileID].anchor),q.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[q.crossTileID]={textOffset:Pe,width:h,height:p,anchor:me,textBoxScale:_,prevAnchor:ke},this.markUsedJustification(re,me,q,te),re.allowVerticalPlacement&&(this.markUsedOrientation(re,te,q),this.placedOrientations[q.crossTileID]=te),{shift:le,placedGlyphBoxes:Me}}}placeLayerBucketPart(i,o,h){const{bucket:p,layout:_,posMatrix:S,textLabelPlaneMatrix:E,labelToScreenMatrix:C,textPixelRatio:D,holdingForFade:F,collisionBoxArray:B,partiallyEvaluatedTextSize:q,collisionGroup:re}=i.parameters,te=_.get("text-optional"),se=_.get("icon-optional"),K=l.aq(_,"text-overlap","text-allow-overlap"),me=K==="always",Pe=l.aq(_,"icon-overlap","icon-allow-overlap"),le=Pe==="always",Me=_.get("text-rotation-alignment")==="map",ke=_.get("text-pitch-alignment")==="map",Le=_.get("icon-text-fit")!=="none",Oe=_.get("symbol-z-order")==="viewport-y",Ke=me&&(le||!p.hasIconData()||se),Ze=le&&(me||!p.hasTextData()||te);!p.collisionArrays&&B&&p.deserializeCollisionBoxes(B);const ot=this.retainedQueryData[p.bucketInstanceId].tileID,ht=this.terrain?(yt,ti)=>this.terrain.getElevation(ot,yt,ti):null,di=(yt,ti)=>{var pi,Li;if(o[yt.crossTileID])return;if(F)return void(this.placements[yt.crossTileID]=new cr(!1,!1,!1));let si=!1,mi=!1,bi=!0,Or=null,tr={box:null,offscreen:null},hs={box:null,offscreen:null},sn=null,Ir=null,an=null,ds=0,la=0,Za=0;ti.textFeatureIndex?ds=ti.textFeatureIndex:yt.useRuntimeCollisionCircles&&(ds=yt.featureIndex),ti.verticalTextFeatureIndex&&(la=ti.verticalTextFeatureIndex);const Kl=ti.textBox;if(Kl){const Xr=Kr=>{let Pr=l.ah.horizontal;if(p.allowVerticalPlacement&&!Kr&&this.prevPlacement){const As=this.prevPlacement.placedOrientations[yt.crossTileID];As&&(this.placedOrientations[yt.crossTileID]=As,Pr=As,this.markUsedOrientation(p,Pr,yt))}return Pr},Ar=(Kr,Pr)=>{if(p.allowVerticalPlacement&&yt.numVerticalGlyphVertices>0&&ti.verticalTextBox){for(const As of p.writingModes)if(As===l.ah.vertical?(tr=Pr(),hs=tr):tr=Kr(),tr&&tr.box&&tr.box.length)break}else tr=Kr()},br=yt.textAnchorOffsetStartIndex,Is=yt.textAnchorOffsetEndIndex;if(Is===br){const Kr=(Pr,As)=>{const Yr=this.collisionIndex.placeCollisionBox(Pr,K,D,S,re.predicate,ht);return Yr&&Yr.box&&Yr.box.length&&(this.markUsedOrientation(p,As,yt),this.placedOrientations[yt.crossTileID]=As),Yr};Ar(()=>Kr(Kl,l.ah.horizontal),()=>{const Pr=ti.verticalTextBox;return p.allowVerticalPlacement&&yt.numVerticalGlyphVertices>0&&Pr?Kr(Pr,l.ah.vertical):{box:null,offscreen:null}}),Xr(tr&&tr.box&&tr.box.length)}else{let Kr=l.ap[(Li=(pi=this.prevPlacement)===null||pi===void 0?void 0:pi.variableOffsets[yt.crossTileID])===null||Li===void 0?void 0:Li.anchor];const Pr=(Yr,$r,Fu)=>{const ud=Yr.x2-Yr.x1,wo=Yr.y2-Yr.y1,Mo=yt.textBoxScale,Lc=Le&&Pe==="never"?$r:null;let Ka={box:[],offscreen:!1},Bu=K==="never"?1:2,hd="never";Kr&&Bu++;for(let Nu=0;Nu<Bu;Nu++){for(let $u=br;$u<Is;$u++){const Rc=p.textAnchorOffsets.get($u);if(Kr&&Rc.textAnchor!==Kr)continue;const Uu=this.attemptAnchorPlacement(Rc,Yr,ud,wo,Mo,Me,ke,D,S,re,hd,yt,p,Fu,Lc,ht);if(Uu&&(Ka=Uu.placedGlyphBoxes,Ka&&Ka.box&&Ka.box.length))return si=!0,Or=Uu.shift,Ka}Kr?Kr=null:hd=K}return Ka};Ar(()=>Pr(Kl,ti.iconBox,l.ah.horizontal),()=>{const Yr=ti.verticalTextBox;return p.allowVerticalPlacement&&!(tr&&tr.box&&tr.box.length)&&yt.numVerticalGlyphVertices>0&&Yr?Pr(Yr,ti.verticalIconBox,l.ah.vertical):{box:null,offscreen:null}}),tr&&(si=tr.box,bi=tr.offscreen);const As=Xr(tr&&tr.box);if(!si&&this.prevPlacement){const Yr=this.prevPlacement.variableOffsets[yt.crossTileID];Yr&&(this.variableOffsets[yt.crossTileID]=Yr,this.markUsedJustification(p,Yr.anchor,yt,As))}}}if(sn=tr,si=sn&&sn.box&&sn.box.length>0,bi=sn&&sn.offscreen,yt.useRuntimeCollisionCircles){const Xr=p.text.placedSymbolArray.get(yt.centerJustifiedTextSymbolIndex),Ar=l.ai(p.textSizeData,q,Xr),br=_.get("text-padding");Ir=this.collisionIndex.placeCollisionCircles(K,Xr,p.lineVertexArray,p.glyphOffsetArray,Ar,S,E,C,h,ke,re.predicate,yt.collisionCircleDiameter,br,ht),Ir.circles.length&&Ir.collisionDetected&&!h&&l.w("Collisions detected, but collision boxes are not shown"),si=me||Ir.circles.length>0&&!Ir.collisionDetected,bi=bi&&Ir.offscreen}if(ti.iconFeatureIndex&&(Za=ti.iconFeatureIndex),ti.iconBox){const Xr=Ar=>{const br=Le&&Or?xn(Ar,Or.x,Or.y,Me,ke,this.transform.angle):Ar;return this.collisionIndex.placeCollisionBox(br,Pe,D,S,re.predicate,ht)};hs&&hs.box&&hs.box.length&&ti.verticalIconBox?(an=Xr(ti.verticalIconBox),mi=an.box.length>0):(an=Xr(ti.iconBox),mi=an.box.length>0),bi=bi&&an.offscreen}const Xa=te||yt.numHorizontalGlyphVertices===0&&yt.numVerticalGlyphVertices===0,ca=se||yt.numIconVertices===0;if(Xa||ca?ca?Xa||(mi=mi&&si):si=mi&&si:mi=si=mi&&si,si&&sn&&sn.box&&this.collisionIndex.insertCollisionBox(sn.box,K,_.get("text-ignore-placement"),p.bucketInstanceId,hs&&hs.box&&la?la:ds,re.ID),mi&&an&&this.collisionIndex.insertCollisionBox(an.box,Pe,_.get("icon-ignore-placement"),p.bucketInstanceId,Za,re.ID),Ir&&(si&&this.collisionIndex.insertCollisionCircles(Ir.circles,K,_.get("text-ignore-placement"),p.bucketInstanceId,ds,re.ID),h)){const Xr=p.bucketInstanceId;let Ar=this.collisionCircleArrays[Xr];Ar===void 0&&(Ar=this.collisionCircleArrays[Xr]=new Br);for(let br=0;br<Ir.circles.length;br+=4)Ar.circles.push(Ir.circles[br+0]),Ar.circles.push(Ir.circles[br+1]),Ar.circles.push(Ir.circles[br+2]),Ar.circles.push(Ir.collisionDetected?1:0)}if(yt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(p.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[yt.crossTileID]=new cr(si||Ke,mi||Ze,bi||p.justReloaded),o[yt.crossTileID]=!0};if(Oe){if(i.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const yt=p.getSortedSymbolIndexes(this.transform.angle);for(let ti=yt.length-1;ti>=0;--ti){const pi=yt[ti];di(p.symbolInstances.get(pi),p.collisionArrays[pi])}}else for(let yt=i.symbolInstanceStart;yt<i.symbolInstanceEnd;yt++)di(p.symbolInstances.get(yt),p.collisionArrays[yt]);if(h&&p.bucketInstanceId in this.collisionCircleArrays){const yt=this.collisionCircleArrays[p.bucketInstanceId];l.ar(yt.invProjMatrix,S),yt.viewportMatrix=this.collisionIndex.getViewportMatrix()}p.justReloaded=!1}markUsedJustification(i,o,h,p){let _;_=p===l.ah.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[l.as(o)];const S=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];for(const E of S)E>=0&&(i.text.placedSymbolArray.get(E).crossTileID=_>=0&&E!==_?0:h.crossTileID)}markUsedOrientation(i,o,h){const p=o===l.ah.horizontal||o===l.ah.horizontalOnly?o:0,_=o===l.ah.vertical?o:0,S=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];for(const E of S)i.text.placedSymbolArray.get(E).placedOrientation=p;h.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let h=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const p=o?o.symbolFadeChange(i):1,_=o?o.opacities:{},S=o?o.variableOffsets:{},E=o?o.placedOrientations:{};for(const C in this.placements){const D=this.placements[C],F=_[C];F?(this.opacities[C]=new Ui(F,p,D.text,D.icon),h=h||D.text!==F.text.placed||D.icon!==F.icon.placed):(this.opacities[C]=new Ui(null,p,D.text,D.icon,D.skipFade),h=h||D.text||D.icon)}for(const C in _){const D=_[C];if(!this.opacities[C]){const F=new Ui(D,p,!1,!1);F.isHidden()||(this.opacities[C]=F,h=h||D.text.placed||D.icon.placed)}}for(const C in S)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=S[C]);for(const C in E)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=E[C]);if(o&&o.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");h?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:i)}updateLayerOpacities(i,o){const h={};for(const p of o){const _=p.getBucket(i);_&&p.latestFeatureIndex&&i.id===_.layerIds[0]&&this.updateBucketOpacities(_,h,p.collisionBoxArray)}}updateBucketOpacities(i,o,h){i.hasTextData()&&(i.text.opacityVertexArray.clear(),i.text.hasVisibleVertices=!1),i.hasIconData()&&(i.icon.opacityVertexArray.clear(),i.icon.hasVisibleVertices=!1),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const p=i.layers[0],_=p.layout,S=new Ui(null,0,!1,!1,!0),E=_.get("text-allow-overlap"),C=_.get("icon-allow-overlap"),D=p._unevaluatedLayout.hasValue("text-variable-anchor")||p._unevaluatedLayout.hasValue("text-variable-anchor-offset"),F=_.get("text-rotation-alignment")==="map",B=_.get("text-pitch-alignment")==="map",q=_.get("icon-text-fit")!=="none",re=new Ui(null,0,E&&(C||!i.hasIconData()||_.get("icon-optional")),C&&(E||!i.hasTextData()||_.get("text-optional")),!0);!i.collisionArrays&&h&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(h);const te=(se,K,me)=>{for(let Pe=0;Pe<K/4;Pe++)se.opacityVertexArray.emplaceBack(me);se.hasVisibleVertices=se.hasVisibleVertices||me!==Wn};for(let se=0;se<i.symbolInstances.length;se++){const K=i.symbolInstances.get(se),{numHorizontalGlyphVertices:me,numVerticalGlyphVertices:Pe,crossTileID:le}=K;let Me=this.opacities[le];o[le]?Me=S:Me||(Me=re,this.opacities[le]=Me),o[le]=!0;const ke=K.numIconVertices>0,Le=this.placedOrientations[K.crossTileID],Oe=Le===l.ah.vertical,Ke=Le===l.ah.horizontal||Le===l.ah.horizontalOnly;if(me>0||Pe>0){const Ze=wn(Me.text);te(i.text,me,Oe?Wn:Ze),te(i.text,Pe,Ke?Wn:Ze);const ot=Me.text.isHidden();[K.rightJustifiedTextSymbolIndex,K.centerJustifiedTextSymbolIndex,K.leftJustifiedTextSymbolIndex].forEach(yt=>{yt>=0&&(i.text.placedSymbolArray.get(yt).hidden=ot||Oe?1:0)}),K.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(K.verticalPlacedTextSymbolIndex).hidden=ot||Ke?1:0);const ht=this.variableOffsets[K.crossTileID];ht&&this.markUsedJustification(i,ht.anchor,K,Le);const di=this.placedOrientations[K.crossTileID];di&&(this.markUsedJustification(i,"left",K,di),this.markUsedOrientation(i,di,K))}if(ke){const Ze=wn(Me.icon),ot=!(q&&K.verticalPlacedIconSymbolIndex&&Oe);K.placedIconSymbolIndex>=0&&(te(i.icon,K.numIconVertices,ot?Ze:Wn),i.icon.placedSymbolArray.get(K.placedIconSymbolIndex).hidden=Me.icon.isHidden()),K.verticalPlacedIconSymbolIndex>=0&&(te(i.icon,K.numVerticalIconVertices,ot?Wn:Ze),i.icon.placedSymbolArray.get(K.verticalPlacedIconSymbolIndex).hidden=Me.icon.isHidden())}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Ze=i.collisionArrays[se];if(Ze){let ot=new l.P(0,0);if(Ze.textBox||Ze.verticalTextBox){let di=!0;if(D){const yt=this.variableOffsets[le];yt?(ot=Vr(yt.anchor,yt.width,yt.height,yt.textOffset,yt.textBoxScale),F&&ot._rotate(B?this.transform.angle:-this.transform.angle)):di=!1}Ze.textBox&&Zr(i.textCollisionBox.collisionVertexArray,Me.text.placed,!di||Oe,ot.x,ot.y),Ze.verticalTextBox&&Zr(i.textCollisionBox.collisionVertexArray,Me.text.placed,!di||Ke,ot.x,ot.y)}const ht=!!(!Ke&&Ze.verticalIconBox);Ze.iconBox&&Zr(i.iconCollisionBox.collisionVertexArray,Me.icon.placed,ht,q?ot.x:0,q?ot.y:0),Ze.verticalIconBox&&Zr(i.iconCollisionBox.collisionVertexArray,Me.icon.placed,!ht,q?ot.x:0,q?ot.y:0)}}}if(i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.text.opacityVertexArray.length!==i.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${i.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${i.text.layoutVertexArray.length}) / 4`);if(i.icon.opacityVertexArray.length!==i.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${i.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${i.icon.layoutVertexArray.length}) / 4`);if(i.bucketInstanceId in this.collisionCircleArrays){const se=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=se.invProjMatrix,i.placementViewportMatrix=se.viewportMatrix,i.collisionCircleArray=se.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,o){const h=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*h>i}setStale(){this.stale=!0}}function Zr(y,i,o,h,p){y.emplaceBack(i?1:0,o?1:0,h||0,p||0),y.emplaceBack(i?1:0,o?1:0,h||0,p||0),y.emplaceBack(i?1:0,o?1:0,h||0,p||0),y.emplaceBack(i?1:0,o?1:0,h||0,p||0)}const Hn=Math.pow(2,25),gc=Math.pow(2,24),zo=Math.pow(2,17),Vi=Math.pow(2,16),lo=Math.pow(2,9),kr=Math.pow(2,8),kn=Math.pow(2,1);function wn(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const i=y.placed?1:0,o=Math.floor(127*y.opacity);return o*Hn+i*gc+o*zo+i*Vi+o*lo+i*kr+o*kn+i}const Wn=0;class Dr{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&!i.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,o,h,p,_){const S=this._bucketParts;for(;this._currentTileIndex<i.length;)if(o.getBucketParts(S,p,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((E,C)=>E.sortKey-C.sortKey));this._currentPartIndex<S.length;)if(o.placeLayerBucketPart(S[this._currentPartIndex],this._seenCrossTileIDs,h),this._currentPartIndex++,_())return!0;return!1}}class Mn{constructor(i,o,h,p,_,S,E,C){this.placement=new bn(i,o,S,E,C),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(i,o,h){const p=k.now(),_=()=>!this._forceFullPlacement&&k.now()-p>2;for(;this._currentPlacementIndex>=0;){const S=o[i[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&(!S.minzoom||S.minzoom<=E)&&(!S.maxzoom||S.maxzoom>E)){if(this._inProgressLayer||(this._inProgressLayer=new Dr(S)),this._inProgressLayer.continuePlacement(h[S.source],this.placement,this._showCollisionBoxes,S,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const Zn=512/l.W/2;class bs{constructor(i,o,h){this.tileID=i,this.bucketInstanceId=h,this._symbolsByKey={};const p=new Map;for(let _=0;_<o.length;_++){const S=o.get(_),E=S.key,C=p.get(E);C?C.push(S):p.set(E,[S])}for(const[_,S]of p){const E={positions:S.map(C=>({x:Math.floor(C.anchorX*Zn),y:Math.floor(C.anchorY*Zn)})),crossTileIDs:S.map(C=>C.crossTileID)};if(E.positions.length>128){const C=new l.au(E.positions.length,16,Uint16Array);for(const{x:D,y:F}of E.positions)C.add(D,F);C.finish(),delete E.positions,E.index=C}this._symbolsByKey[_]=E}}getScaledCoordinates(i,o){const{x:h,y:p,z:_}=this.tileID.canonical,{x:S,y:E,z:C}=o.canonical,D=Zn/Math.pow(2,C-_),F=(E*l.W+i.anchorY)*D,B=p*l.W*Zn;return{x:Math.floor((S*l.W+i.anchorX)*D-h*l.W*Zn),y:Math.floor(F-B)}}findMatches(i,o,h){const p=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z);for(let _=0;_<i.length;_++){const S=i.get(_);if(S.crossTileID)continue;const E=this._symbolsByKey[S.key];if(!E)continue;const C=this.getScaledCoordinates(S,o);if(E.index){const D=E.index.range(C.x-p,C.y-p,C.x+p,C.y+p).sort();for(const F of D){const B=E.crossTileIDs[F];if(!h[B]){h[B]=!0,S.crossTileID=B;break}}}else if(E.positions)for(let D=0;D<E.positions.length;D++){const F=E.positions[D],B=E.crossTileIDs[D];if(Math.abs(F.x-C.x)<=p&&Math.abs(F.y-C.y)<=p&&!h[B]){h[B]=!0,S.crossTileID=B;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:i})=>i)}}class Lr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class co{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const o=Math.round((i-this.lng)/360);if(o!==0)for(const h in this.indexes){const p=this.indexes[h],_={};for(const S in p){const E=p[S];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+o),_[E.tileID.key]=E}this.indexes[h]=_}this.lng=i}addBucket(i,o,h){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let _=0;_<o.symbolInstances.length;_++)o.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const p=this.usedCrossTileIDs[i.overscaledZ];for(const _ in this.indexes){const S=this.indexes[_];if(Number(_)>i.overscaledZ)for(const E in S){const C=S[E];C.tileID.isChildOf(i)&&C.findMatches(o.symbolInstances,i,p)}else{const E=S[i.scaledTo(Number(_)).key];E&&E.findMatches(o.symbolInstances,i,p)}}for(let _=0;_<o.symbolInstances.length;_++){const S=o.symbolInstances.get(_);S.crossTileID||(S.crossTileID=h.generate(),p[S.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new bs(i,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(i,o){for(const h of o.getCrossTileIDsLists())for(const p of h)delete this.usedCrossTileIDs[i][p]}removeStaleBuckets(i){let o=!1;for(const h in this.indexes){const p=this.indexes[h];for(const _ in p)i[p[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,p[_]),delete p[_],o=!0)}return o}}class ia{constructor(){this.layerIndexes={},this.crossTileIDs=new Lr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,o,h){let p=this.layerIndexes[i.id];p===void 0&&(p=this.layerIndexes[i.id]=new co);let _=!1;const S={};p.handleWrapJump(h);for(const E of o){const C=E.getBucket(i);C&&i.id===C.layerIds[0]&&(C.bucketInstanceId||(C.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(E.tileID,C,this.crossTileIDs)&&(_=!0),S[C.bucketInstanceId]=!0)}return p.removeStaleBuckets(S)&&(_=!0),_}pruneUnusedLayers(i){const o={};i.forEach(h=>{o[h]=!0});for(const h in this.layerIndexes)o[h]||delete this.layerIndexes[h]}}const pr=(y,i)=>l.t(y,i&&i.filter(o=>o.identifier!=="source.canvas")),uo=l.av();class Sn extends l.E{constructor(i,o={}){super(),this._rtlPluginLoaded=()=>{for(const h in this.sourceCaches){const p=this.sourceCaches[h].getSource().type;p!=="vector"&&p!=="geojson"||this.sourceCaches[h].reload()}},this.map=i,this.dispatcher=new Tt(je(),i._getMapId()),this.dispatcher.registerMessageHandler("GG",(h,p)=>this.getGlyphs(h,p)),this.dispatcher.registerMessageHandler("GI",(h,p)=>this.getImages(h,p)),this.imageManager=new Ei,this.imageManager.setEventedParent(this),this.glyphManager=new $t(i._requestManager,o.localIdeographFontFamily),this.lineAtlas=new We(256,512),this.crossTileSymbolIndex=new ia,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",l.ax()),Ve().on(Jt,this._rtlPluginLoaded),this.on("data",h=>{if(h.dataType!=="source"||h.sourceDataType!=="metadata")return;const p=this.sourceCaches[h.sourceId];if(!p)return;const _=p.getSource();if(_&&_.vectorLayerIds)for(const S in this._layers){const E=this._layers[S];E.source===_.id&&this._validateLayer(E)}})}loadURL(i,o={},h){this.fire(new l.k("dataloading",{dataType:"style"})),o.validate=typeof o.validate!="boolean"||o.validate;const p=this.map._requestManager.transformRequest(i,"Style");this._loadStyleRequest=new AbortController,l.h(p,this._loadStyleRequest).then(_=>{this._loadStyleRequest=null,this._load(_.data,o,h)}).catch(_=>{this._loadStyleRequest=null,_&&this.fire(new l.j(_))})}loadJSON(i,o={},h){this.fire(new l.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,k.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,o.validate=o.validate!==!1,this._load(i,o,h)}).catch(()=>{})}loadEmpty(){this.fire(new l.k("dataloading",{dataType:"style"})),this._load(uo,{validate:!1})}_load(i,o,h){var p;const _=o.transformStyle?o.transformStyle(h,i):i;if(!o.validate||!pr(this,l.x(_))){this._loaded=!0,this.stylesheet=_;for(const S in _.sources)this.addSource(S,_.sources[S],{validate:!1});_.sprite?this._loadSprite(_.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(_.glyphs),this._createLayers(),this.light=new Bi(this.stylesheet.light),this.map.setTerrain((p=this.stylesheet.terrain)!==null&&p!==void 0?p:null),this.fire(new l.k("data",{dataType:"style"})),this.fire(new l.k("style.load"))}}_createLayers(){const i=l.ay(this.stylesheet.layers);this.dispatcher.broadcast("SL",i),this._order=i.map(o=>o.id),this._layers={},this._serializedLayers=null;for(const o of i){const h=l.az(o);h.setEventedParent(this,{layer:{id:o.id}}),this._layers[o.id]=h}}_loadSprite(i,o=!1,h=void 0){let p;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(_,S,E,C){return l._(this,void 0,void 0,function*(){const D=Ot(_),F=E>1?"@2x":"",B={},q={};for(const{id:re,url:te}of D){const se=S.transformRequest(S.normalizeSpriteURL(te,F,".json"),"SpriteJSON");B[re]=l.h(se,C);const K=S.transformRequest(S.normalizeSpriteURL(te,F,".png"),"SpriteImage");q[re]=ee.getImage(K,C)}return yield Promise.all([...Object.values(B),...Object.values(q)]),function(re,te){return l._(this,void 0,void 0,function*(){const se={};for(const K in re){se[K]={};const me=k.getImageCanvasContext((yield te[K]).data),Pe=(yield re[K]).data;for(const le in Pe){const{width:Me,height:ke,x:Le,y:Oe,sdf:Ke,pixelRatio:Ze,stretchX:ot,stretchY:ht,content:di}=Pe[le];se[K][le]={data:null,pixelRatio:Ze,sdf:Ke,stretchX:ot,stretchY:ht,content:di,spriteData:{width:Me,height:ke,x:Le,y:Oe,context:me}}}}return se})}(B,q)})}(i,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(_=>{if(this._spriteRequest=null,_)for(const S in _){this._spritesImagesIds[S]=[];const E=this._spritesImagesIds[S]?this._spritesImagesIds[S].filter(C=>!(C in _)):[];for(const C of E)this.imageManager.removeImage(C),this._changedImages[C]=!0;for(const C in _[S]){const D=S==="default"?C:`${S}:${C}`;this._spritesImagesIds[S].push(D),D in this.imageManager.images?this.imageManager.updateImage(D,_[S][C],!1):this.imageManager.addImage(D,_[S][C]),o&&(this._changedImages[D]=!0)}}}).catch(_=>{this._spriteRequest=null,p=_,this.fire(new l.j(p))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),o&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"})),h&&h(p)})}_unloadSprite(){for(const i of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(i),this._changedImages[i]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}_validateLayer(i){const o=this.sourceCaches[i.source];if(!o)return;const h=i.sourceLayer;if(!h)return;const p=o.getSource();(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(h)===-1)&&this.fire(new l.j(new Error(`Source layer "${h}" does not exist on source "${p.id}" as specified by style layer "${i.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this.sourceCaches)if(!this.sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(i){const o=this._serializedAllLayers();if(!i||i.length===0)return Object.values(o);const h=[];for(const p of i)o[p]&&h.push(o[p]);return h}_serializedAllLayers(){let i=this._serializedLayers;if(i)return i;i=this._serializedLayers={};const o=Object.keys(this._layers);for(const h of o){const p=this._layers[h];p.type!=="custom"&&(i[h]=p.serialize())}return i}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const i in this.sourceCaches)if(this.sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(i){if(!this._loaded)return;const o=this._changed;if(o){const p=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(p.length||_.length)&&this._updateWorkerLayers(p,_);for(const S in this._updatedSources){const E=this._updatedSources[S];if(E==="reload")this._reloadSource(S);else{if(E!=="clear")throw new Error(`Invalid action ${E}`);this._clearSource(S)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const S in this._updatedPaintProps)this._layers[S].updateTransitions(i);this.light.updateTransitions(i),this._resetUpdates()}const h={};for(const p in this.sourceCaches){const _=this.sourceCaches[p];h[p]=_.used,_.used=!1}for(const p of this._order){const _=this._layers[p];_.recalculate(i,this._availableImages),!_.isHidden(i.zoom)&&_.source&&(this.sourceCaches[_.source].used=!0)}for(const p in h){const _=this.sourceCaches[p];!!h[p]!=!!_.used&&_.fire(new l.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:p}))}this.light.recalculate(i),this.z=i.zoom,o&&this.fire(new l.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const i in this.sourceCaches)this.sourceCaches[i].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(i,o){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(i),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(i,o={}){var h;this._checkLoaded();const p=this.serialize();if(i=o.transformStyle?o.transformStyle(p,i):i,((h=o.validate)===null||h===void 0||h)&&pr(this,l.x(i)))return!1;(i=l.aA(i)).layers=l.ay(i.layers);const _=l.aB(p,i),S=this._getOperationsToPerform(_);if(S.unimplemented.length>0)throw new Error(`Unimplemented: ${S.unimplemented.join(", ")}.`);if(S.operations.length===0)return!1;for(const E of S.operations)E();return this.stylesheet=i,this._serializedLayers=null,!0}_getOperationsToPerform(i){const o=[],h=[];for(const p of i)switch(p.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":o.push(()=>this.addLayer.apply(this,p.args));break;case"removeLayer":o.push(()=>this.removeLayer.apply(this,p.args));break;case"setPaintProperty":o.push(()=>this.setPaintProperty.apply(this,p.args));break;case"setLayoutProperty":o.push(()=>this.setLayoutProperty.apply(this,p.args));break;case"setFilter":o.push(()=>this.setFilter.apply(this,p.args));break;case"addSource":o.push(()=>this.addSource.apply(this,p.args));break;case"removeSource":o.push(()=>this.removeSource.apply(this,p.args));break;case"setLayerZoomRange":o.push(()=>this.setLayerZoomRange.apply(this,p.args));break;case"setLight":o.push(()=>this.setLight.apply(this,p.args));break;case"setGeoJSONSourceData":o.push(()=>this.setGeoJSONSourceData.apply(this,p.args));break;case"setGlyphs":o.push(()=>this.setGlyphs.apply(this,p.args));break;case"setSprite":o.push(()=>this.setSprite.apply(this,p.args));break;case"setTerrain":o.push(()=>this.map.setTerrain.apply(this,p.args));break;case"setTransition":o.push(()=>{});break;default:h.push(p.command)}return{operations:o,unimplemented:h}}addImage(i,o){if(this.getImage(i))return this.fire(new l.j(new Error(`An image named "${i}" already exists.`)));this.imageManager.addImage(i,o),this._afterImageUpdated(i)}updateImage(i,o){this.imageManager.updateImage(i,o)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){if(!this.getImage(i))return this.fire(new l.j(new Error(`An image named "${i}" does not exist.`)));this.imageManager.removeImage(i),this._afterImageUpdated(i)}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(i,o,h={}){if(this._checkLoaded(),this.sourceCaches[i]!==void 0)throw new Error(`Source "${i}" already exists.`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(l.x.source,`sources.${i}`,o,null,h))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const p=this.sourceCaches[i]=new Sr(i,o,this.dispatcher);p.style=this,p.setEventedParent(this,()=>({isSourceLoaded:p.loaded(),source:p.serialize(),sourceId:i})),p.onAdd(this.map),this._changed=!0}removeSource(i){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error("There is no source with this ID");for(const h in this._layers)if(this._layers[h].source===i)return this.fire(new l.j(new Error(`Source "${i}" cannot be removed while layer "${h}" is using it.`)));const o=this.sourceCaches[i];delete this.sourceCaches[i],delete this._updatedSources[i],o.fire(new l.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:i})),o.setEventedParent(null),o.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(i,o){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error(`There is no source with this ID=${i}`);const h=this.sourceCaches[i].getSource();if(h.type!=="geojson")throw new Error(`geojsonSource.type is ${h.type}, which is !== 'geojson`);h.setData(o),this._changed=!0}getSource(i){return this.sourceCaches[i]&&this.sourceCaches[i].getSource()}addLayer(i,o,h={}){this._checkLoaded();const p=i.id;if(this.getLayer(p))return void this.fire(new l.j(new Error(`Layer "${p}" already exists on this map.`)));let _;if(i.type==="custom"){if(pr(this,l.aC(i)))return;_=l.az(i)}else{if("source"in i&&typeof i.source=="object"&&(this.addSource(p,i.source),i=l.aA(i),i=l.e(i,{source:p})),this._validate(l.x.layer,`layers.${p}`,i,{arrayIndex:-1},h))return;_=l.az(i),this._validateLayer(_),_.setEventedParent(this,{layer:{id:p}})}const S=o?this._order.indexOf(o):this._order.length;if(o&&S===-1)this.fire(new l.j(new Error(`Cannot add layer "${p}" before non-existing layer "${o}".`)));else{if(this._order.splice(S,0,p),this._layerOrderChanged=!0,this._layers[p]=_,this._removedLayers[p]&&_.source&&_.type!=="custom"){const E=this._removedLayers[p];delete this._removedLayers[p],E.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",this.sourceCaches[_.source].pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map)}}moveLayer(i,o){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new l.j(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===o)return;const h=this._order.indexOf(i);this._order.splice(h,1);const p=o?this._order.indexOf(o):this._order.length;o&&p===-1?this.fire(new l.j(new Error(`Cannot move layer "${i}" before non-existing layer "${o}".`))):(this._order.splice(p,0,i),this._layerOrderChanged=!0)}removeLayer(i){this._checkLoaded();const o=this._layers[i];if(!o)return void this.fire(new l.j(new Error(`Cannot remove non-existing layer "${i}".`)));o.setEventedParent(null);const h=this._order.indexOf(i);this._order.splice(h,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=o,delete this._layers[i],this._serializedLayers&&delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],o.onRemove&&o.onRemove(this.map)}getLayer(i){return this._layers[i]}getLayersOrder(){return[...this._order]}hasLayer(i){return i in this._layers}setLayerZoomRange(i,o,h){this._checkLoaded();const p=this.getLayer(i);p?p.minzoom===o&&p.maxzoom===h||(o!=null&&(p.minzoom=o),h!=null&&(p.maxzoom=h),this._updateLayer(p)):this.fire(new l.j(new Error(`Cannot set the zoom range of non-existing layer "${i}".`)))}setFilter(i,o,h={}){this._checkLoaded();const p=this.getLayer(i);if(p){if(!l.aD(p.filter,o))return o==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(l.x.filter,`layers.${p.id}.filter`,o,null,h)||(p.filter=l.aA(o),this._updateLayer(p)))}else this.fire(new l.j(new Error(`Cannot filter non-existing layer "${i}".`)))}getFilter(i){return l.aA(this.getLayer(i).filter)}setLayoutProperty(i,o,h,p={}){this._checkLoaded();const _=this.getLayer(i);_?l.aD(_.getLayoutProperty(o),h)||(_.setLayoutProperty(o,h,p),this._updateLayer(_)):this.fire(new l.j(new Error(`Cannot style non-existing layer "${i}".`)))}getLayoutProperty(i,o){const h=this.getLayer(i);if(h)return h.getLayoutProperty(o);this.fire(new l.j(new Error(`Cannot get style of non-existing layer "${i}".`)))}setPaintProperty(i,o,h,p={}){this._checkLoaded();const _=this.getLayer(i);_?l.aD(_.getPaintProperty(o),h)||(_.setPaintProperty(o,h,p)&&this._updateLayer(_),this._changed=!0,this._updatedPaintProps[i]=!0,this._serializedLayers=null):this.fire(new l.j(new Error(`Cannot style non-existing layer "${i}".`)))}getPaintProperty(i,o){return this.getLayer(i).getPaintProperty(o)}setFeatureState(i,o){this._checkLoaded();const h=i.source,p=i.sourceLayer,_=this.sourceCaches[h];if(_===void 0)return void this.fire(new l.j(new Error(`The source '${h}' does not exist in the map's style.`)));const S=_.getSource().type;S==="geojson"&&p?this.fire(new l.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):S!=="vector"||p?(i.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),_.setFeatureState(p,i.id,o)):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(i,o){this._checkLoaded();const h=i.source,p=this.sourceCaches[h];if(p===void 0)return void this.fire(new l.j(new Error(`The source '${h}' does not exist in the map's style.`)));const _=p.getSource().type,S=_==="vector"?i.sourceLayer:void 0;_!=="vector"||S?o&&typeof i.id!="string"&&typeof i.id!="number"?this.fire(new l.j(new Error("A feature id is required to remove its specific state property."))):p.removeFeatureState(S,i.id,o):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(i){this._checkLoaded();const o=i.source,h=i.sourceLayer,p=this.sourceCaches[o];if(p!==void 0)return p.getSource().type!=="vector"||h?(i.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),p.getFeatureState(h,i.id)):void this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.j(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const i=l.aE(this.sourceCaches,_=>_.serialize()),o=this._serializeByIds(this._order),h=this.map.getTerrain()||void 0,p=this.stylesheet;return l.aF({version:p.version,name:p.name,metadata:p.metadata,light:p.light,center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,sprite:p.sprite,glyphs:p.glyphs,transition:p.transition,sources:i,layers:o,terrain:h},_=>_!==void 0)}_updateLayer(i){this._updatedLayers[i.id]=!0,i.source&&!this._updatedSources[i.source]&&this.sourceCaches[i.source].getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",this.sourceCaches[i.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(i){const o=S=>this._layers[S].type==="fill-extrusion",h={},p=[];for(let S=this._order.length-1;S>=0;S--){const E=this._order[S];if(o(E)){h[E]=S;for(const C of i){const D=C[E];if(D)for(const F of D)p.push(F)}}}p.sort((S,E)=>E.intersectionZ-S.intersectionZ);const _=[];for(let S=this._order.length-1;S>=0;S--){const E=this._order[S];if(o(E))for(let C=p.length-1;C>=0;C--){const D=p[C].feature;if(h[D.layer.id]<S)break;_.push(D),p.pop()}else for(const C of i){const D=C[E];if(D)for(const F of D)_.push(F.feature)}}return _}queryRenderedFeatures(i,o,h){o&&o.filter&&this._validate(l.x.filter,"queryRenderedFeatures.filter",o.filter,null,o);const p={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new l.j(new Error("parameters.layers must be an Array."))),[];for(const E of o.layers){const C=this._layers[E];if(!C)return this.fire(new l.j(new Error(`The layer '${E}' does not exist in the map's style and cannot be queried for features.`))),[];p[C.source]=!0}}const _=[];o.availableImages=this._availableImages;const S=this._serializedAllLayers();for(const E in this.sourceCaches)o.layers&&!p[E]||_.push(ki(this.sourceCaches[E],this._layers,S,i,o,h));return this.placement&&_.push(function(E,C,D,F,B,q,re){const te={},se=q.queryRenderedSymbols(F),K=[];for(const me of Object.keys(se).map(Number))K.push(re[me]);K.sort(Oi);for(const me of K){const Pe=me.featureIndex.lookupSymbolFeatures(se[me.bucketInstanceId],C,me.bucketIndex,me.sourceLayerIndex,B.filter,B.layers,B.availableImages,E);for(const le in Pe){const Me=te[le]=te[le]||[],ke=Pe[le];ke.sort((Le,Oe)=>{const Ke=me.featureSortOrder;if(Ke){const Ze=Ke.indexOf(Le.featureIndex);return Ke.indexOf(Oe.featureIndex)-Ze}return Oe.featureIndex-Le.featureIndex});for(const Le of ke)Me.push(Le)}}for(const me in te)te[me].forEach(Pe=>{const le=Pe.feature,Me=D[E[me].source].getFeatureState(le.layer["source-layer"],le.id);le.source=le.layer.source,le.layer["source-layer"]&&(le.sourceLayer=le.layer["source-layer"]),le.state=Me});return te}(this._layers,S,this.sourceCaches,i,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(i,o){o&&o.filter&&this._validate(l.x.filter,"querySourceFeatures.filter",o.filter,null,o);const h=this.sourceCaches[i];return h?function(p,_){const S=p.getRenderableIds().map(D=>p.getTileByID(D)),E=[],C={};for(let D=0;D<S.length;D++){const F=S[D],B=F.tileID.canonical.key;C[B]||(C[B]=!0,F.querySourceFeatures(E,_))}return E}(h,o):[]}getLight(){return this.light.getLight()}setLight(i,o={}){this._checkLoaded();const h=this.light.getLight();let p=!1;for(const S in i)if(!l.aD(i[S],h[S])){p=!0;break}if(!p)return;const _={now:k.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,o),this.light.updateTransitions(_)}_validate(i,o,h,p,_={}){return(!_||_.validate!==!1)&&pr(this,i.call(l.x,l.e({key:o,style:this.serialize(),value:h,styleSpec:l.v},p)))}_remove(i=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Ve().off(Jt,this._rtlPluginLoaded);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this.sourceCaches){const h=this.sourceCaches[o];h.setEventedParent(null),h.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),i&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(i)}_clearSource(i){this.sourceCaches[i].clearTiles()}_reloadSource(i){this.sourceCaches[i].resume(),this.sourceCaches[i].reload()}_updateSources(i){for(const o in this.sourceCaches)this.sourceCaches[o].update(i,this.map.terrain)}_generateCollisionBoxes(){for(const i in this.sourceCaches)this._reloadSource(i)}_updatePlacement(i,o,h,p,_=!1){let S=!1,E=!1;const C={};for(const D of this._order){const F=this._layers[D];if(F.type!=="symbol")continue;if(!C[F.source]){const q=this.sourceCaches[F.source];C[F.source]=q.getRenderableIds(!0).map(re=>q.getTileByID(re)).sort((re,te)=>te.tileID.overscaledZ-re.tileID.overscaledZ||(re.tileID.isLessThan(te.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(F,C[F.source],i.center.lng);S=S||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((_=_||this._layerOrderChanged||h===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(k.now(),i.zoom))&&(this.pauseablePlacement=new Mn(i,this.map.terrain,this._order,_,o,h,p,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,C),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(k.now()),E=!0),S&&this.pauseablePlacement.placement.setStale()),E||S)for(const D of this._order){const F=this._layers[D];F.type==="symbol"&&this.placement.updateLayerOpacities(F,C[F.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(k.now())}_releaseSymbolFadeTiles(){for(const i in this.sourceCaches)this.sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,o){return l._(this,void 0,void 0,function*(){const h=yield this.imageManager.getImages(o.icons);this._updateTilesForChangedImages();const p=this.sourceCaches[o.source];return p&&p.setDependencies(o.tileID.key,o.type,o.icons),h})}getGlyphs(i,o){return l._(this,void 0,void 0,function*(){const h=yield this.glyphManager.getGlyphs(o.stacks),p=this.sourceCaches[o.source];return p&&p.setDependencies(o.tileID.key,o.type,[""]),h})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(i,o={}){this._checkLoaded(),i&&this._validate(l.x.glyphs,"glyphs",i,null,o)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=i,this.glyphManager.entries={},this.glyphManager.setURL(i))}addSprite(i,o,h={},p){this._checkLoaded();const _=[{id:i,url:o}],S=[...Ot(this.stylesheet.sprite),..._];this._validate(l.x.sprite,"sprite",S,null,h)||(this.stylesheet.sprite=S,this._loadSprite(_,!0,p))}removeSprite(i){this._checkLoaded();const o=Ot(this.stylesheet.sprite);if(o.find(h=>h.id===i)){if(this._spritesImagesIds[i])for(const h of this._spritesImagesIds[i])this.imageManager.removeImage(h),this._changedImages[h]=!0;o.splice(o.findIndex(h=>h.id===i),1),this.stylesheet.sprite=o.length>0?o:void 0,delete this._spritesImagesIds[i],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}else this.fire(new l.j(new Error(`Sprite "${i}" doesn't exists on this map.`)))}getSprite(){return Ot(this.stylesheet.sprite)}setSprite(i,o={},h){this._checkLoaded(),i&&this._validate(l.x.sprite,"sprite",i,null,o)||(this.stylesheet.sprite=i,i?this._loadSprite(i,!0,h):(this._unloadSprite(),h&&h(null)))}}var ho=l.X([{name:"a_pos",type:"Int16",components:2}]),os="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const po={prelude:Hi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Hi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Hi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Hi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Hi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Hi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Hi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Hi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Hi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Hi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Hi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Hi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Hi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Hi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Hi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Hi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Hi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Hi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Hi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Hi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Hi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Hi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Hi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Hi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Hi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Hi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Hi("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",os),terrainDepth:Hi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",os),terrainCoords:Hi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",os)};function Hi(y,i){const o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=i.match(/attribute ([\w]+) ([\w]+)/g),p=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=i.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=_?_.concat(p):p,E={};return{fragmentSource:y=y.replace(o,(C,D,F,B,q)=>(E[q]=!0,D==="define"?`
#ifndef HAS_UNIFORM_u_${q}
varying ${F} ${B} ${q};
#else
uniform ${F} ${B} u_${q};
#endif
`:`
#ifdef HAS_UNIFORM_u_${q}
    ${F} ${B} ${q} = u_${q};
#endif
`)),vertexSource:i=i.replace(o,(C,D,F,B,q)=>{const re=B==="float"?"vec2":"vec4",te=q.match(/color/)?"color":re;return E[q]?D==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
attribute ${F} ${re} a_${q};
varying ${F} ${B} ${q};
#else
uniform ${F} ${B} u_${q};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = a_${q};
#else
    ${F} ${B} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = unpack_mix_${te}(a_${q}, u_${q}_t);
#else
    ${F} ${B} ${q} = u_${q};
#endif
`:D==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
attribute ${F} ${re} a_${q};
#else
uniform ${F} ${B} u_${q};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${F} ${B} ${q} = a_${q};
#else
    ${F} ${B} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${F} ${B} ${q} = unpack_mix_${te}(a_${q}, u_${q}_t);
#else
    ${F} ${B} ${q} = u_${q};
#endif
`}),staticAttributes:h,staticUniforms:S}}class Oo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(i,o,h,p,_,S,E,C,D){this.context=i;let F=this.boundPaintVertexBuffers.length!==p.length;for(let B=0;!F&&B<p.length;B++)this.boundPaintVertexBuffers[B]!==p[B]&&(F=!0);!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==h||F||this.boundIndexBuffer!==_||this.boundVertexOffset!==S||this.boundDynamicVertexBuffer!==E||this.boundDynamicVertexBuffer2!==C||this.boundDynamicVertexBuffer3!==D?this.freshBind(o,h,p,_,S,E,C,D):(i.bindVertexArray.set(this.vao),E&&E.bind(),_&&_.dynamicDraw&&_.bind(),C&&C.bind(),D&&D.bind())}freshBind(i,o,h,p,_,S,E,C){const D=i.numAttributes,F=this.context,B=F.gl;this.vao&&this.destroy(),this.vao=F.createVertexArray(),F.bindVertexArray.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=p,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=S,this.boundDynamicVertexBuffer2=E,this.boundDynamicVertexBuffer3=C,o.enableAttributes(B,i);for(const q of h)q.enableAttributes(B,i);S&&S.enableAttributes(B,i),E&&E.enableAttributes(B,i),C&&C.enableAttributes(B,i),o.bind(),o.setVertexAttribPointers(B,i,_);for(const q of h)q.bind(),q.setVertexAttribPointers(B,i,_);S&&(S.bind(),S.setVertexAttribPointers(B,i,_)),p&&p.bind(),E&&(E.bind(),E.setVertexAttribPointers(B,i,_)),C&&(C.bind(),C.setVertexAttribPointers(B,i,_)),F.currentNumAttributes=D}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Us(y){const i=[];for(let o=0;o<y.length;o++){if(y[o]===null)continue;const h=y[o].split(" ");i.push(h.pop())}return i}class b{constructor(i,o,h,p,_,S){const E=i.gl;this.program=E.createProgram();const C=Us(o.staticAttributes),D=h?h.getBinderAttributes():[],F=C.concat(D),B=po.prelude.staticUniforms?Us(po.prelude.staticUniforms):[],q=o.staticUniforms?Us(o.staticUniforms):[],re=h?h.getBinderUniforms():[],te=B.concat(q).concat(re),se=[];for(const Le of te)se.indexOf(Le)<0&&se.push(Le);const K=h?h.defines():[];_&&K.push("#define OVERDRAW_INSPECTOR;"),S&&K.push("#define TERRAIN3D;");const me=K.concat(po.prelude.fragmentSource,o.fragmentSource).join(`
`),Pe=K.concat(po.prelude.vertexSource,o.vertexSource).join(`
`),le=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);if(E.shaderSource(le,me),E.compileShader(le),!E.getShaderParameter(le,E.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${E.getShaderInfoLog(le)}`);E.attachShader(this.program,le);const Me=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);if(E.shaderSource(Me,Pe),E.compileShader(Me),!E.getShaderParameter(Me,E.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${E.getShaderInfoLog(Me)}`);E.attachShader(this.program,Me),this.attributes={};const ke={};this.numAttributes=F.length;for(let Le=0;Le<this.numAttributes;Le++)F[Le]&&(E.bindAttribLocation(this.program,Le,F[Le]),this.attributes[F[Le]]=Le);if(E.linkProgram(this.program),!E.getProgramParameter(this.program,E.LINK_STATUS))throw new Error(`Program failed to link: ${E.getProgramInfoLog(this.program)}`);E.deleteShader(Me),E.deleteShader(le);for(let Le=0;Le<se.length;Le++){const Oe=se[Le];if(Oe&&!ke[Oe]){const Ke=E.getUniformLocation(this.program,Oe);Ke&&(ke[Oe]=Ke)}}this.fixedUniforms=p(i,ke),this.terrainUniforms=((Le,Oe)=>({u_depth:new l.aG(Le,Oe.u_depth),u_terrain:new l.aG(Le,Oe.u_terrain),u_terrain_dim:new l.aH(Le,Oe.u_terrain_dim),u_terrain_matrix:new l.aI(Le,Oe.u_terrain_matrix),u_terrain_unpack:new l.aJ(Le,Oe.u_terrain_unpack),u_terrain_exaggeration:new l.aH(Le,Oe.u_terrain_exaggeration)}))(i,ke),this.binderUniforms=h?h.getUniforms(i,ke):[]}draw(i,o,h,p,_,S,E,C,D,F,B,q,re,te,se,K,me,Pe){const le=i.gl;if(this.failedToCreate)return;if(i.program.set(this.program),i.setDepthMode(h),i.setStencilMode(p),i.setColorMode(_),i.setCullFace(S),C){i.activeTexture.set(le.TEXTURE2),le.bindTexture(le.TEXTURE_2D,C.depthTexture),i.activeTexture.set(le.TEXTURE3),le.bindTexture(le.TEXTURE_2D,C.texture);for(const ke in this.terrainUniforms)this.terrainUniforms[ke].set(C[ke])}for(const ke in this.fixedUniforms)this.fixedUniforms[ke].set(E[ke]);se&&se.setUniforms(i,this.binderUniforms,re,{zoom:te});let Me=0;switch(o){case le.LINES:Me=2;break;case le.TRIANGLES:Me=3;break;case le.LINE_STRIP:Me=1}for(const ke of q.get()){const Le=ke.vaos||(ke.vaos={});(Le[D]||(Le[D]=new Oo)).bind(i,this,F,se?se.getPaintVertexBuffers():[],B,ke.vertexOffset,K,me,Pe),le.drawElements(o,ke.primitiveLength*Me,le.UNSIGNED_SHORT,ke.primitiveOffset*Me*2)}}}function P(y,i,o){const h=1/ni(o,1,i.transform.tileZoom),p=Math.pow(2,o.tileID.overscaledZ),_=o.tileSize*Math.pow(2,i.transform.tileZoom)/p,S=_*(o.tileID.canonical.x+o.tileID.wrap*p),E=_*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[h,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[S>>16,E>>16],u_pixel_coord_lower:[65535&S,65535&E]}}const V=(y,i,o,h)=>{const p=i.style.light,_=p.properties.get("position"),S=[_.x,_.y,_.z],E=function(){var D=new l.A(9);return l.A!=Float32Array&&(D[1]=0,D[2]=0,D[3]=0,D[5]=0,D[6]=0,D[7]=0),D[0]=1,D[4]=1,D[8]=1,D}();p.properties.get("anchor")==="viewport"&&function(D,F){var B=Math.sin(F),q=Math.cos(F);D[0]=q,D[1]=B,D[2]=0,D[3]=-B,D[4]=q,D[5]=0,D[6]=0,D[7]=0,D[8]=1}(E,-i.transform.angle),function(D,F,B){var q=F[0],re=F[1],te=F[2];D[0]=q*B[0]+re*B[3]+te*B[6],D[1]=q*B[1]+re*B[4]+te*B[7],D[2]=q*B[2]+re*B[5]+te*B[8]}(S,S,E);const C=p.properties.get("color");return{u_matrix:y,u_lightpos:S,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[C.r,C.g,C.b],u_vertical_gradient:+o,u_opacity:h}},oe=(y,i,o,h,p,_,S)=>l.e(V(y,i,o,h),P(_,i,S),{u_height_factor:-Math.pow(2,p.overscaledZ)/S.tileSize/8}),ge=y=>({u_matrix:y}),_e=(y,i,o,h)=>l.e(ge(y),P(o,i,h)),Ee=(y,i)=>({u_matrix:y,u_world:i}),Je=(y,i,o,h,p)=>l.e(_e(y,i,o,h),{u_world:p}),lt=(y,i,o,h)=>{const p=y.transform;let _,S;if(h.paint.get("circle-pitch-alignment")==="map"){const E=ni(o,1,p.zoom);_=!0,S=[E,E]}else _=!1,S=p.pixelsToGLUnits;return{u_camera_to_center_distance:p.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_matrix:y.translatePosMatrix(i.posMatrix,o,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_pitch_with_map:+_,u_device_pixel_ratio:y.pixelRatio,u_extrude_scale:S}},Mt=(y,i,o)=>{const h=ni(o,1,i.zoom),p=Math.pow(2,i.zoom-o.tileID.overscaledZ),_=o.tileID.overscaleFactor();return{u_matrix:y,u_camera_to_center_distance:i.cameraToCenterDistance,u_pixels_to_tile_units:h,u_extrude_scale:[i.pixelsToGLUnits[0]/(h*p),i.pixelsToGLUnits[1]/(h*p)],u_overscale_factor:_}},St=(y,i,o=1)=>({u_matrix:y,u_color:i,u_overlay:0,u_overlay_scale:o}),pt=y=>({u_matrix:y}),oi=(y,i,o,h)=>({u_matrix:y,u_extrude_scale:ni(i,1,o),u_intensity:h});function fr(y,i){const o=Math.pow(2,i.canonical.z),h=i.canonical.y;return[new l.Y(0,h/o).toLngLat().lat,new l.Y(0,(h+1)/o).toLngLat().lat]}const hi=(y,i,o,h)=>{const p=y.transform;return{u_matrix:Tr(y,i,o,h),u_ratio:1/ni(i,1,p.zoom),u_device_pixel_ratio:y.pixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Rr=(y,i,o,h,p)=>l.e(hi(y,i,o,p),{u_image:0,u_image_height:h}),qe=(y,i,o,h,p)=>{const _=y.transform,S=xi(i,_);return{u_matrix:Tr(y,i,o,p),u_texsize:i.imageAtlasTexture.size,u_ratio:1/ni(i,1,_.zoom),u_device_pixel_ratio:y.pixelRatio,u_image:0,u_scale:[S,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},Bt=(y,i,o,h,p,_)=>{const S=y.lineAtlas,E=xi(i,y.transform),C=o.layout.get("line-cap")==="round",D=S.getDash(h.from,C),F=S.getDash(h.to,C),B=D.width*p.fromScale,q=F.width*p.toScale;return l.e(hi(y,i,o,_),{u_patternscale_a:[E/B,-D.height/2],u_patternscale_b:[E/q,-F.height/2],u_sdfgamma:S.width/(256*Math.min(B,q)*y.pixelRatio)/2,u_image:0,u_tex_y_a:D.y,u_tex_y_b:F.y,u_mix:p.t})};function xi(y,i){return 1/ni(y,1,i.tileZoom)}function Tr(y,i,o,h){return y.translatePosMatrix(h?h.posMatrix:i.tileID.posMatrix,i,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const vr=(y,i,o,h,p)=>{return{u_matrix:y,u_tl_parent:i,u_scale_parent:o,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*p.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:p.paint.get("raster-brightness-min"),u_brightness_high:p.paint.get("raster-brightness-max"),u_saturation_factor:(S=p.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(_=p.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:va(p.paint.get("raster-hue-rotate"))};var _,S};function va(y){y*=Math.PI/180;const i=Math.sin(y),o=Math.cos(y);return[(2*o+1)/3,(-Math.sqrt(3)*i-o+1)/3,(Math.sqrt(3)*i-o+1)/3]}const fo=(y,i,o,h,p,_,S,E,C,D)=>{const F=p.transform;return{u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:F.cameraToCenterDistance,u_pitch:F.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:F.width/F.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:S,u_coord_matrix:E,u_is_text:+C,u_pitch_with_map:+h,u_texsize:D,u_texture:0}},Ki=(y,i,o,h,p,_,S,E,C,D,F)=>{const B=p.transform;return l.e(fo(y,i,o,h,p,_,S,E,C,D),{u_gamma_scale:h?Math.cos(B._pitch)*B.cameraToCenterDistance:1,u_device_pixel_ratio:p.pixelRatio,u_is_halo:+F})},$a=(y,i,o,h,p,_,S,E,C,D)=>l.e(Ki(y,i,o,h,p,_,S,E,!0,C,!0),{u_texsize_icon:D,u_texture_icon:1}),Su=(y,i,o)=>({u_matrix:y,u_opacity:i,u_color:o}),Vs=(y,i,o,h,p,_)=>l.e(function(S,E,C,D){const F=C.imageManager.getPattern(S.from.toString()),B=C.imageManager.getPattern(S.to.toString()),{width:q,height:re}=C.imageManager.getPixelSize(),te=Math.pow(2,D.tileID.overscaledZ),se=D.tileSize*Math.pow(2,C.transform.tileZoom)/te,K=se*(D.tileID.canonical.x+D.tileID.wrap*te),me=se*D.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:F.tl,u_pattern_br_a:F.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[q,re],u_mix:E.t,u_pattern_size_a:F.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:E.fromScale,u_scale_b:E.toScale,u_tile_units_to_pixels:1/ni(D,1,C.transform.tileZoom),u_pixel_coord_upper:[K>>16,me>>16],u_pixel_coord_lower:[65535&K,65535&me]}}(h,_,o,p),{u_matrix:y,u_opacity:i}),Il={fillExtrusion:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_lightpos:new l.aK(y,i.u_lightpos),u_lightintensity:new l.aH(y,i.u_lightintensity),u_lightcolor:new l.aK(y,i.u_lightcolor),u_vertical_gradient:new l.aH(y,i.u_vertical_gradient),u_opacity:new l.aH(y,i.u_opacity)}),fillExtrusionPattern:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_lightpos:new l.aK(y,i.u_lightpos),u_lightintensity:new l.aH(y,i.u_lightintensity),u_lightcolor:new l.aK(y,i.u_lightcolor),u_vertical_gradient:new l.aH(y,i.u_vertical_gradient),u_height_factor:new l.aH(y,i.u_height_factor),u_image:new l.aG(y,i.u_image),u_texsize:new l.aL(y,i.u_texsize),u_pixel_coord_upper:new l.aL(y,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(y,i.u_pixel_coord_lower),u_scale:new l.aK(y,i.u_scale),u_fade:new l.aH(y,i.u_fade),u_opacity:new l.aH(y,i.u_opacity)}),fill:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix)}),fillPattern:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_image:new l.aG(y,i.u_image),u_texsize:new l.aL(y,i.u_texsize),u_pixel_coord_upper:new l.aL(y,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(y,i.u_pixel_coord_lower),u_scale:new l.aK(y,i.u_scale),u_fade:new l.aH(y,i.u_fade)}),fillOutline:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_world:new l.aL(y,i.u_world)}),fillOutlinePattern:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_world:new l.aL(y,i.u_world),u_image:new l.aG(y,i.u_image),u_texsize:new l.aL(y,i.u_texsize),u_pixel_coord_upper:new l.aL(y,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(y,i.u_pixel_coord_lower),u_scale:new l.aK(y,i.u_scale),u_fade:new l.aH(y,i.u_fade)}),circle:(y,i)=>({u_camera_to_center_distance:new l.aH(y,i.u_camera_to_center_distance),u_scale_with_map:new l.aG(y,i.u_scale_with_map),u_pitch_with_map:new l.aG(y,i.u_pitch_with_map),u_extrude_scale:new l.aL(y,i.u_extrude_scale),u_device_pixel_ratio:new l.aH(y,i.u_device_pixel_ratio),u_matrix:new l.aI(y,i.u_matrix)}),collisionBox:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_camera_to_center_distance:new l.aH(y,i.u_camera_to_center_distance),u_pixels_to_tile_units:new l.aH(y,i.u_pixels_to_tile_units),u_extrude_scale:new l.aL(y,i.u_extrude_scale),u_overscale_factor:new l.aH(y,i.u_overscale_factor)}),collisionCircle:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_inv_matrix:new l.aI(y,i.u_inv_matrix),u_camera_to_center_distance:new l.aH(y,i.u_camera_to_center_distance),u_viewport_size:new l.aL(y,i.u_viewport_size)}),debug:(y,i)=>({u_color:new l.aM(y,i.u_color),u_matrix:new l.aI(y,i.u_matrix),u_overlay:new l.aG(y,i.u_overlay),u_overlay_scale:new l.aH(y,i.u_overlay_scale)}),clippingMask:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix)}),heatmap:(y,i)=>({u_extrude_scale:new l.aH(y,i.u_extrude_scale),u_intensity:new l.aH(y,i.u_intensity),u_matrix:new l.aI(y,i.u_matrix)}),heatmapTexture:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_world:new l.aL(y,i.u_world),u_image:new l.aG(y,i.u_image),u_color_ramp:new l.aG(y,i.u_color_ramp),u_opacity:new l.aH(y,i.u_opacity)}),hillshade:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_image:new l.aG(y,i.u_image),u_latrange:new l.aL(y,i.u_latrange),u_light:new l.aL(y,i.u_light),u_shadow:new l.aM(y,i.u_shadow),u_highlight:new l.aM(y,i.u_highlight),u_accent:new l.aM(y,i.u_accent)}),hillshadePrepare:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_image:new l.aG(y,i.u_image),u_dimension:new l.aL(y,i.u_dimension),u_zoom:new l.aH(y,i.u_zoom),u_unpack:new l.aJ(y,i.u_unpack)}),line:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_ratio:new l.aH(y,i.u_ratio),u_device_pixel_ratio:new l.aH(y,i.u_device_pixel_ratio),u_units_to_pixels:new l.aL(y,i.u_units_to_pixels)}),lineGradient:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_ratio:new l.aH(y,i.u_ratio),u_device_pixel_ratio:new l.aH(y,i.u_device_pixel_ratio),u_units_to_pixels:new l.aL(y,i.u_units_to_pixels),u_image:new l.aG(y,i.u_image),u_image_height:new l.aH(y,i.u_image_height)}),linePattern:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_texsize:new l.aL(y,i.u_texsize),u_ratio:new l.aH(y,i.u_ratio),u_device_pixel_ratio:new l.aH(y,i.u_device_pixel_ratio),u_image:new l.aG(y,i.u_image),u_units_to_pixels:new l.aL(y,i.u_units_to_pixels),u_scale:new l.aK(y,i.u_scale),u_fade:new l.aH(y,i.u_fade)}),lineSDF:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_ratio:new l.aH(y,i.u_ratio),u_device_pixel_ratio:new l.aH(y,i.u_device_pixel_ratio),u_units_to_pixels:new l.aL(y,i.u_units_to_pixels),u_patternscale_a:new l.aL(y,i.u_patternscale_a),u_patternscale_b:new l.aL(y,i.u_patternscale_b),u_sdfgamma:new l.aH(y,i.u_sdfgamma),u_image:new l.aG(y,i.u_image),u_tex_y_a:new l.aH(y,i.u_tex_y_a),u_tex_y_b:new l.aH(y,i.u_tex_y_b),u_mix:new l.aH(y,i.u_mix)}),raster:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_tl_parent:new l.aL(y,i.u_tl_parent),u_scale_parent:new l.aH(y,i.u_scale_parent),u_buffer_scale:new l.aH(y,i.u_buffer_scale),u_fade_t:new l.aH(y,i.u_fade_t),u_opacity:new l.aH(y,i.u_opacity),u_image0:new l.aG(y,i.u_image0),u_image1:new l.aG(y,i.u_image1),u_brightness_low:new l.aH(y,i.u_brightness_low),u_brightness_high:new l.aH(y,i.u_brightness_high),u_saturation_factor:new l.aH(y,i.u_saturation_factor),u_contrast_factor:new l.aH(y,i.u_contrast_factor),u_spin_weights:new l.aK(y,i.u_spin_weights)}),symbolIcon:(y,i)=>({u_is_size_zoom_constant:new l.aG(y,i.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(y,i.u_is_size_feature_constant),u_size_t:new l.aH(y,i.u_size_t),u_size:new l.aH(y,i.u_size),u_camera_to_center_distance:new l.aH(y,i.u_camera_to_center_distance),u_pitch:new l.aH(y,i.u_pitch),u_rotate_symbol:new l.aG(y,i.u_rotate_symbol),u_aspect_ratio:new l.aH(y,i.u_aspect_ratio),u_fade_change:new l.aH(y,i.u_fade_change),u_matrix:new l.aI(y,i.u_matrix),u_label_plane_matrix:new l.aI(y,i.u_label_plane_matrix),u_coord_matrix:new l.aI(y,i.u_coord_matrix),u_is_text:new l.aG(y,i.u_is_text),u_pitch_with_map:new l.aG(y,i.u_pitch_with_map),u_texsize:new l.aL(y,i.u_texsize),u_texture:new l.aG(y,i.u_texture)}),symbolSDF:(y,i)=>({u_is_size_zoom_constant:new l.aG(y,i.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(y,i.u_is_size_feature_constant),u_size_t:new l.aH(y,i.u_size_t),u_size:new l.aH(y,i.u_size),u_camera_to_center_distance:new l.aH(y,i.u_camera_to_center_distance),u_pitch:new l.aH(y,i.u_pitch),u_rotate_symbol:new l.aG(y,i.u_rotate_symbol),u_aspect_ratio:new l.aH(y,i.u_aspect_ratio),u_fade_change:new l.aH(y,i.u_fade_change),u_matrix:new l.aI(y,i.u_matrix),u_label_plane_matrix:new l.aI(y,i.u_label_plane_matrix),u_coord_matrix:new l.aI(y,i.u_coord_matrix),u_is_text:new l.aG(y,i.u_is_text),u_pitch_with_map:new l.aG(y,i.u_pitch_with_map),u_texsize:new l.aL(y,i.u_texsize),u_texture:new l.aG(y,i.u_texture),u_gamma_scale:new l.aH(y,i.u_gamma_scale),u_device_pixel_ratio:new l.aH(y,i.u_device_pixel_ratio),u_is_halo:new l.aG(y,i.u_is_halo)}),symbolTextAndIcon:(y,i)=>({u_is_size_zoom_constant:new l.aG(y,i.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(y,i.u_is_size_feature_constant),u_size_t:new l.aH(y,i.u_size_t),u_size:new l.aH(y,i.u_size),u_camera_to_center_distance:new l.aH(y,i.u_camera_to_center_distance),u_pitch:new l.aH(y,i.u_pitch),u_rotate_symbol:new l.aG(y,i.u_rotate_symbol),u_aspect_ratio:new l.aH(y,i.u_aspect_ratio),u_fade_change:new l.aH(y,i.u_fade_change),u_matrix:new l.aI(y,i.u_matrix),u_label_plane_matrix:new l.aI(y,i.u_label_plane_matrix),u_coord_matrix:new l.aI(y,i.u_coord_matrix),u_is_text:new l.aG(y,i.u_is_text),u_pitch_with_map:new l.aG(y,i.u_pitch_with_map),u_texsize:new l.aL(y,i.u_texsize),u_texsize_icon:new l.aL(y,i.u_texsize_icon),u_texture:new l.aG(y,i.u_texture),u_texture_icon:new l.aG(y,i.u_texture_icon),u_gamma_scale:new l.aH(y,i.u_gamma_scale),u_device_pixel_ratio:new l.aH(y,i.u_device_pixel_ratio),u_is_halo:new l.aG(y,i.u_is_halo)}),background:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_opacity:new l.aH(y,i.u_opacity),u_color:new l.aM(y,i.u_color)}),backgroundPattern:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_opacity:new l.aH(y,i.u_opacity),u_image:new l.aG(y,i.u_image),u_pattern_tl_a:new l.aL(y,i.u_pattern_tl_a),u_pattern_br_a:new l.aL(y,i.u_pattern_br_a),u_pattern_tl_b:new l.aL(y,i.u_pattern_tl_b),u_pattern_br_b:new l.aL(y,i.u_pattern_br_b),u_texsize:new l.aL(y,i.u_texsize),u_mix:new l.aH(y,i.u_mix),u_pattern_size_a:new l.aL(y,i.u_pattern_size_a),u_pattern_size_b:new l.aL(y,i.u_pattern_size_b),u_scale_a:new l.aH(y,i.u_scale_a),u_scale_b:new l.aH(y,i.u_scale_b),u_pixel_coord_upper:new l.aL(y,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(y,i.u_pixel_coord_lower),u_tile_units_to_pixels:new l.aH(y,i.u_tile_units_to_pixels)}),terrain:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_texture:new l.aG(y,i.u_texture),u_ele_delta:new l.aH(y,i.u_ele_delta)}),terrainDepth:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_ele_delta:new l.aH(y,i.u_ele_delta)}),terrainCoords:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_texture:new l.aG(y,i.u_texture),u_terrain_coords_id:new l.aH(y,i.u_terrain_coords_id),u_ele_delta:new l.aH(y,i.u_ele_delta)})};class yc{constructor(i,o,h){this.context=i;const p=i.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const o=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ra={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ua{constructor(i,o,h,p){this.length=o.length,this.attributes=h,this.itemSize=o.bytesPerElement,this.dynamicDraw=p,this.context=i;const _=i.gl;this.buffer=_.createBuffer(),i.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){if(i.length!==this.length)throw new Error(`Length of new data is ${i.length}, which doesn't match current length of ${this.length}`);const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,o){for(let h=0;h<this.attributes.length;h++){const p=o.attributes[this.attributes[h].name];p!==void 0&&i.enableVertexAttribArray(p)}}setVertexAttribPointers(i,o,h){for(let p=0;p<this.attributes.length;p++){const _=this.attributes[p],S=o.attributes[_.name];S!==void 0&&i.vertexAttribPointer(S,_.components,i[ra[_.type]],!1,this.itemSize,_.offset+this.itemSize*(h||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const fn=new WeakMap;function en(y){var i;if(fn.has(y))return fn.get(y);{const o=(i=y.getParameter(y.VERSION))===null||i===void 0?void 0:i.startsWith("WebGL 2.0");return fn.set(y,o),o}}class Fi{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Fo extends Fi{getDefault(){return l.aO.transparent}set(i){const o=this.current;(i.r!==o.r||i.g!==o.g||i.b!==o.b||i.a!==o.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Bo extends Fi{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class No extends Fi{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class $o extends Fi{getDefault(){return[!0,!0,!0,!0]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class mo extends Fi{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class Al extends Fi{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class Pl extends Fi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const o=this.current;(i.func!==o.func||i.ref!==o.ref||i.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class xa extends Fi{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Uo extends Fi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=i,this.dirty=!1}}class kl extends Fi{getDefault(){return[0,1]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class En extends Fi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=i,this.dirty=!1}}class _c extends Fi{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class vc extends Fi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.BLEND):o.disable(o.BLEND),this.current=i,this.dirty=!1}}class Eu extends Fi{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class xc extends Fi{getDefault(){return l.aO.transparent}set(i){const o=this.current;(i.r!==o.r||i.g!==o.g||i.b!==o.b||i.a!==o.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Vo extends Fi{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class bc extends Fi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=i,this.dirty=!1}}class jo extends Fi{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class qo extends Fi{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class js extends Fi{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class Go extends Fi{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class Va extends Fi{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class wc extends Fi{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class Ho extends Fi{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class ba extends Fi{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class qs extends Fi{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Wo extends Fi{getDefault(){return null}set(i){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class na extends Fi{getDefault(){return null}set(i){var o;if(i===this.current&&!this.dirty)return;const h=this.gl;en(h)?h.bindVertexArray(i):(o=h.getExtension("OES_vertex_array_object"))===null||o===void 0||o.bindVertexArrayOES(i),this.current=i,this.dirty=!1}}class ws extends Fi{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class Mc extends Fi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class Dl extends Fi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class Di extends Fi{constructor(i,o){super(i),this.context=i,this.parent=o}getDefault(){return null}}class Zo extends Di{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Tu extends Di{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Ll extends Di{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class wa{constructor(i,o,h,p,_){this.context=i,this.width=o,this.height=h;const S=i.gl,E=this.framebuffer=S.createFramebuffer();if(this.colorAttachment=new Zo(i,E),p)this.depthAttachment=_?new Ll(i,E):new Tu(i,E);else if(_)throw new Error("Stencil cannot be set without depth");if(S.checkFramebufferStatus(S.FRAMEBUFFER)!==S.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const i=this.context.gl,o=this.colorAttachment.get();if(o&&i.deleteTexture(o),this.depthAttachment){const h=this.depthAttachment.get();h&&i.deleteRenderbuffer(h)}i.deleteFramebuffer(this.framebuffer)}}class ir{constructor(i,o,h){this.blendFunction=i,this.blendColor=o,this.mask=h}}ir.Replace=[1,0],ir.disabled=new ir(ir.Replace,l.aO.transparent,[!1,!1,!1,!1]),ir.unblended=new ir(ir.Replace,l.aO.transparent,[!0,!0,!0,!0]),ir.alphaBlended=new ir([1,771],l.aO.transparent,[!0,!0,!0,!0]);class Gs{constructor(i){var o,h;if(this.gl=i,this.clearColor=new Fo(this),this.clearDepth=new Bo(this),this.clearStencil=new No(this),this.colorMask=new $o(this),this.depthMask=new mo(this),this.stencilMask=new Al(this),this.stencilFunc=new Pl(this),this.stencilOp=new xa(this),this.stencilTest=new Uo(this),this.depthRange=new kl(this),this.depthTest=new En(this),this.depthFunc=new _c(this),this.blend=new vc(this),this.blendFunc=new Eu(this),this.blendColor=new xc(this),this.blendEquation=new Vo(this),this.cullFace=new bc(this),this.cullFaceSide=new jo(this),this.frontFace=new qo(this),this.program=new js(this),this.activeTexture=new Go(this),this.viewport=new Va(this),this.bindFramebuffer=new wc(this),this.bindRenderbuffer=new Ho(this),this.bindTexture=new ba(this),this.bindVertexBuffer=new qs(this),this.bindElementBuffer=new Wo(this),this.bindVertexArray=new na(this),this.pixelStoreUnpack=new ws(this),this.pixelStoreUnpackPremultiplyAlpha=new Mc(this),this.pixelStoreUnpackFlipY=new Dl(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),en(i)){this.HALF_FLOAT=i.HALF_FLOAT;const p=i.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(o=i.RGBA16F)!==null&&o!==void 0?o:p==null?void 0:p.RGBA16F_EXT,this.RGB16F=(h=i.RGB16F)!==null&&h!==void 0?h:p==null?void 0:p.RGB16F_EXT,i.getExtension("EXT_color_buffer_float")}else{i.getExtension("EXT_color_buffer_half_float"),i.getExtension("OES_texture_half_float_linear");const p=i.getExtension("OES_texture_half_float");this.HALF_FLOAT=p==null?void 0:p.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,o){return new yc(this,i,o)}createVertexBuffer(i,o,h){return new Ua(this,i,o,h)}createRenderbuffer(i,o,h){const p=this.gl,_=p.createRenderbuffer();return this.bindRenderbuffer.set(_),p.renderbufferStorage(p.RENDERBUFFER,i,o,h),this.bindRenderbuffer.set(null),_}createFramebuffer(i,o,h,p){return new wa(this,i,o,h,p)}clear({color:i,depth:o,stencil:h}){const p=this.gl;let _=0;i&&(_|=p.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(_|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),h!==void 0&&(_|=p.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),p.clear(_)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){l.aD(i.blendFunction,ir.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}createVertexArray(){var i;return en(this.gl)?this.gl.createVertexArray():(i=this.gl.getExtension("OES_vertex_array_object"))===null||i===void 0?void 0:i.createVertexArrayOES()}deleteVertexArray(i){var o;return en(this.gl)?this.gl.deleteVertexArray(i):(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.deleteVertexArrayOES(i)}unbindVAO(){this.bindVertexArray.set(null)}}class fi{constructor(i,o,h){this.func=i,this.mask=o,this.range=h}}fi.ReadOnly=!1,fi.ReadWrite=!0,fi.disabled=new fi(519,fi.ReadOnly,[0,1]);const ja=7680;class $i{constructor(i,o,h,p,_,S){this.test=i,this.ref=o,this.mask=h,this.fail=p,this.depthFail=_,this.pass=S}}$i.disabled=new $i({func:519,mask:0},0,0,ja,ja,ja);class er{constructor(i,o,h){this.enable=i,this.mode=o,this.frontFace=h}}let Ms;function sa(y,i,o,h,p,_,S){const E=y.context,C=E.gl,D=y.useProgram("collisionBox"),F=[];let B=0,q=0;for(let le=0;le<h.length;le++){const Me=h[le],ke=i.getTile(Me),Le=ke.getBucket(o);if(!Le)continue;let Oe=Me.posMatrix;p[0]===0&&p[1]===0||(Oe=y.translatePosMatrix(Me.posMatrix,ke,p,_));const Ke=S?Le.textCollisionBox:Le.iconCollisionBox,Ze=Le.collisionCircleArray;if(Ze.length>0){const ot=l.F(),ht=Oe;l.aP(ot,Le.placementInvProjMatrix,y.transform.glCoordMatrix),l.aP(ot,ot,Le.placementViewportMatrix),F.push({circleArray:Ze,circleOffset:q,transform:ht,invTransform:ot,coord:Me}),B+=Ze.length/4,q=B}Ke&&D.draw(E,C.LINES,fi.disabled,$i.disabled,y.colorModeForRenderPass(),er.disabled,Mt(Oe,y.transform,ke),y.style.map.terrain&&y.style.map.terrain.getTerrainData(Me),o.id,Ke.layoutVertexBuffer,Ke.indexBuffer,Ke.segments,null,y.transform.zoom,null,null,Ke.collisionVertexBuffer)}if(!S||!F.length)return;const re=y.useProgram("collisionCircle"),te=new l.aQ;te.resize(4*B),te._trim();let se=0;for(const le of F)for(let Me=0;Me<le.circleArray.length/4;Me++){const ke=4*Me,Le=le.circleArray[ke+0],Oe=le.circleArray[ke+1],Ke=le.circleArray[ke+2],Ze=le.circleArray[ke+3];te.emplace(se++,Le,Oe,Ke,Ze,0),te.emplace(se++,Le,Oe,Ke,Ze,1),te.emplace(se++,Le,Oe,Ke,Ze,2),te.emplace(se++,Le,Oe,Ke,Ze,3)}(!Ms||Ms.length<2*B)&&(Ms=function(le){const Me=2*le,ke=new l.aS;ke.resize(Me),ke._trim();for(let Le=0;Le<Me;Le++){const Oe=6*Le;ke.uint16[Oe+0]=4*Le+0,ke.uint16[Oe+1]=4*Le+1,ke.uint16[Oe+2]=4*Le+2,ke.uint16[Oe+3]=4*Le+2,ke.uint16[Oe+4]=4*Le+3,ke.uint16[Oe+5]=4*Le+0}return ke}(B));const K=E.createIndexBuffer(Ms,!0),me=E.createVertexBuffer(te,l.aR.members,!0);for(const le of F){const Me={u_matrix:le.transform,u_inv_matrix:le.invTransform,u_camera_to_center_distance:(Pe=y.transform).cameraToCenterDistance,u_viewport_size:[Pe.width,Pe.height]};re.draw(E,C.TRIANGLES,fi.disabled,$i.disabled,y.colorModeForRenderPass(),er.disabled,Me,y.style.map.terrain&&y.style.map.terrain.getTerrainData(le.coord),o.id,me,K,l.$.simpleSegment(0,2*le.circleOffset,le.circleArray.length,le.circleArray.length/2),null,y.transform.zoom,null,null,null)}var Pe;me.destroy(),K.destroy()}er.disabled=new er(!1,1029,2305),er.backCCW=new er(!0,1029,2305);const Xo=l.an(new Float32Array(16));function Rl(y,i,o,h,p,_){const{horizontalAlign:S,verticalAlign:E}=l.at(y);return new l.P((-(S-.5)*i/p+h[0])*_,(-(E-.5)*o/p+h[1])*_)}function Ko(y,i,o,h,p,_,S,E,C,D,F){const B=y.text.placedSymbolArray,q=y.text.dynamicLayoutVertexArray,re=y.icon.dynamicLayoutVertexArray,te={};q.clear();for(let se=0;se<B.length;se++){const K=B.get(se),me=K.hidden||!K.crossTileID||y.allowVerticalPlacement&&!K.placedOrientation?null:h[K.crossTileID];if(me){const Pe=new l.P(K.anchorX,K.anchorY),le=Er(Pe,o?S:_,F),Me=ie(p.cameraToCenterDistance,le.signedDistanceFromCamera);let ke=l.ai(y.textSizeData,C,K)*Me/l.ao;o&&(ke*=y.tilePixelRatio/E);const{width:Le,height:Oe,anchor:Ke,textOffset:Ze,textBoxScale:ot}=me,ht=Rl(Ke,Le,Oe,Ze,ot,ke),di=o?Er(Pe.add(ht),_,F).point:le.point.add(i?ht.rotate(-p.angle):ht),yt=y.allowVerticalPlacement&&K.placedOrientation===l.ah.vertical?Math.PI/2:0;for(let ti=0;ti<K.numGlyphs;ti++)l.aj(q,di,yt);D&&K.associatedIconIndex>=0&&(te[K.associatedIconIndex]={shiftedAnchor:di,angle:yt})}else Ne(K.numGlyphs,q)}if(D){re.clear();const se=y.icon.placedSymbolArray;for(let K=0;K<se.length;K++){const me=se.get(K);if(me.hidden)Ne(me.numGlyphs,re);else{const Pe=te[K];if(Pe)for(let le=0;le<me.numGlyphs;le++)l.aj(re,Pe.shiftedAnchor,Pe.angle);else Ne(me.numGlyphs,re)}}y.icon.dynamicLayoutVertexBuffer.updateData(re)}y.text.dynamicLayoutVertexBuffer.updateData(q)}function Yo(y,i,o){return o.iconsInText&&i?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function go(y,i,o,h,p,_,S,E,C,D,F,B){const q=y.context,re=q.gl,te=y.transform,se=E==="map",K=C==="map",me=E!=="viewport"&&o.layout.get("symbol-placement")!=="point",Pe=se&&!K&&!me,le=!o.layout.get("symbol-sort-key").isConstant();let Me=!1;const ke=y.depthModeForSublayer(0,fi.ReadOnly),Le=o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Oe=[];for(const Ke of h){const Ze=i.getTile(Ke),ot=Ze.getBucket(o);if(!ot)continue;const ht=p?ot.text:ot.icon;if(!ht||!ht.segments.get().length||!ht.hasVisibleVertices)continue;const di=ht.programConfigurations.get(o.id),yt=p||ot.sdfIcons,ti=p?ot.textSizeData:ot.iconSizeData,pi=K||te.pitch!==0,Li=y.useProgram(Yo(yt,p,ot),di),si=l.ag(ti,te.zoom),mi=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ke);let bi,Or,tr,hs,sn=[0,0],Ir=null;if(p)Or=Ze.glyphAtlasTexture,tr=re.LINEAR,bi=Ze.glyphAtlasTexture.size,ot.iconsInText&&(sn=Ze.imageAtlasTexture.size,Ir=Ze.imageAtlasTexture,hs=pi||y.options.rotating||y.options.zooming||ti.kind==="composite"||ti.kind==="camera"?re.LINEAR:re.NEAREST);else{const Kr=o.layout.get("icon-size").constantOr(0)!==1||ot.iconsNeedLinear;Or=Ze.imageAtlasTexture,tr=yt||y.options.rotating||y.options.zooming||Kr||pi?re.LINEAR:re.NEAREST,bi=Ze.imageAtlasTexture.size}const an=ni(Ze,1,y.transform.zoom),ds=ii(Ke.posMatrix,K,se,y.transform,an),la=ta(Ke.posMatrix,K,se,y.transform,an),Za=Le&&ot.hasTextData(),Kl=o.layout.get("icon-text-fit")!=="none"&&Za&&ot.hasIconData();if(me){const Kr=y.style.map.terrain?(As,Yr)=>y.style.map.terrain.getElevation(Ke,As,Yr):null,Pr=o.layout.get("text-rotation-alignment")==="map";U(ot,Ke.posMatrix,y,p,ds,la,K,D,Pr,Kr)}const Xa=y.translatePosMatrix(Ke.posMatrix,Ze,_,S),ca=me||p&&Le||Kl?Xo:ds,Xr=y.translatePosMatrix(la,Ze,_,S,!0),Ar=yt&&o.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let br;br=yt?ot.iconsInText?$a(ti.kind,si,Pe,K,y,Xa,ca,Xr,bi,sn):Ki(ti.kind,si,Pe,K,y,Xa,ca,Xr,p,bi,!0):fo(ti.kind,si,Pe,K,y,Xa,ca,Xr,p,bi);const Is={program:Li,buffers:ht,uniformValues:br,atlasTexture:Or,atlasTextureIcon:Ir,atlasInterpolation:tr,atlasInterpolationIcon:hs,isSDF:yt,hasHalo:Ar};if(le&&ot.canOverlap){Me=!0;const Kr=ht.segments.get();for(const Pr of Kr)Oe.push({segments:new l.$([Pr]),sortKey:Pr.sortKey,state:Is,terrainData:mi})}else Oe.push({segments:ht.segments,sortKey:0,state:Is,terrainData:mi})}Me&&Oe.sort((Ke,Ze)=>Ke.sortKey-Ze.sortKey);for(const Ke of Oe){const Ze=Ke.state;if(q.activeTexture.set(re.TEXTURE0),Ze.atlasTexture.bind(Ze.atlasInterpolation,re.CLAMP_TO_EDGE),Ze.atlasTextureIcon&&(q.activeTexture.set(re.TEXTURE1),Ze.atlasTextureIcon&&Ze.atlasTextureIcon.bind(Ze.atlasInterpolationIcon,re.CLAMP_TO_EDGE)),Ze.isSDF){const ot=Ze.uniformValues;Ze.hasHalo&&(ot.u_is_halo=1,zl(Ze.buffers,Ke.segments,o,y,Ze.program,ke,F,B,ot,Ke.terrainData)),ot.u_is_halo=0}zl(Ze.buffers,Ke.segments,o,y,Ze.program,ke,F,B,Ze.uniformValues,Ke.terrainData)}}function zl(y,i,o,h,p,_,S,E,C,D){const F=h.context;p.draw(F,F.gl.TRIANGLES,_,S,E,er.disabled,C,D,o.id,y.layoutVertexBuffer,y.indexBuffer,i,o.paint,h.transform.zoom,y.programConfigurations.get(o.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function Ma(y,i,o,h,p){if(!o||!h||!h.imageAtlas)return;const _=h.imageAtlas.patternPositions;let S=_[o.to.toString()],E=_[o.from.toString()];if(!S&&E&&(S=E),!E&&S&&(E=S),!S||!E){const C=p.getPaintProperty(i);S=_[C],E=_[C]}S&&E&&y.setConstantPatternPositions(S,E)}function Sa(y,i,o,h,p,_,S){const E=y.context.gl,C="fill-pattern",D=o.paint.get(C),F=D&&D.constantOr(1),B=o.getCrossfadeParameters();let q,re,te,se,K;S?(re=F&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",q=E.LINES):(re=F?"fillPattern":"fill",q=E.TRIANGLES);const me=D.constantOr(null);for(const Pe of h){const le=i.getTile(Pe);if(F&&!le.patternsLoaded())continue;const Me=le.getBucket(o);if(!Me)continue;const ke=Me.programConfigurations.get(o.id),Le=y.useProgram(re,ke),Oe=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Pe);F&&(y.context.activeTexture.set(E.TEXTURE0),le.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),ke.updatePaintBuffers(B)),Ma(ke,C,me,le,o);const Ke=Oe?Pe:null,Ze=y.translatePosMatrix(Ke?Ke.posMatrix:Pe.posMatrix,le,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(S){se=Me.indexBuffer2,K=Me.segments2;const ot=[E.drawingBufferWidth,E.drawingBufferHeight];te=re==="fillOutlinePattern"&&F?Je(Ze,y,B,le,ot):Ee(Ze,ot)}else se=Me.indexBuffer,K=Me.segments,te=F?_e(Ze,y,B,le):ge(Ze);Le.draw(y.context,q,p,y.stencilModeForClipping(Pe),_,er.disabled,te,Oe,o.id,Me.layoutVertexBuffer,se,K,o.paint,y.transform.zoom,ke)}}function Jo(y,i,o,h,p,_,S){const E=y.context,C=E.gl,D="fill-extrusion-pattern",F=o.paint.get(D),B=F.constantOr(1),q=o.getCrossfadeParameters(),re=o.paint.get("fill-extrusion-opacity"),te=F.constantOr(null);for(const se of h){const K=i.getTile(se),me=K.getBucket(o);if(!me)continue;const Pe=y.style.map.terrain&&y.style.map.terrain.getTerrainData(se),le=me.programConfigurations.get(o.id),Me=y.useProgram(B?"fillExtrusionPattern":"fillExtrusion",le);B&&(y.context.activeTexture.set(C.TEXTURE0),K.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),le.updatePaintBuffers(q)),Ma(le,D,te,K,o);const ke=y.translatePosMatrix(se.posMatrix,K,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Le=o.paint.get("fill-extrusion-vertical-gradient"),Oe=B?oe(ke,y,Le,re,se,q,K):V(ke,y,Le,re);Me.draw(E,E.gl.TRIANGLES,p,_,S,er.backCCW,Oe,Pe,o.id,me.layoutVertexBuffer,me.indexBuffer,me.segments,o.paint,y.transform.zoom,le,y.style.map.terrain&&me.centroidVertexBuffer)}}function ls(y,i,o,h,p,_,S){const E=y.context,C=E.gl,D=o.fbo;if(!D)return;const F=y.useProgram("hillshade"),B=y.style.map.terrain&&y.style.map.terrain.getTerrainData(i);E.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,D.colorAttachment.get()),F.draw(E,C.TRIANGLES,p,_,S,er.disabled,((q,re,te,se)=>{const K=te.paint.get("hillshade-shadow-color"),me=te.paint.get("hillshade-highlight-color"),Pe=te.paint.get("hillshade-accent-color");let le=te.paint.get("hillshade-illumination-direction")*(Math.PI/180);te.paint.get("hillshade-illumination-anchor")==="viewport"&&(le-=q.transform.angle);const Me=!q.options.moving;return{u_matrix:se?se.posMatrix:q.transform.calculatePosMatrix(re.tileID.toUnwrapped(),Me),u_image:0,u_latrange:fr(0,re.tileID),u_light:[te.paint.get("hillshade-exaggeration"),le],u_shadow:K,u_highlight:me,u_accent:Pe}})(y,o,h,B?i:null),B,h.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}function Ol(y,i,o,h,p,_){const S=y.context,E=S.gl,C=i.dem;if(C&&C.data){const D=C.dim,F=C.stride,B=C.getPixels();if(S.activeTexture.set(E.TEXTURE1),S.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||y.getTileTexture(F),i.demTexture){const re=i.demTexture;re.update(B,{premultiply:!1}),re.bind(E.NEAREST,E.CLAMP_TO_EDGE)}else i.demTexture=new Lt(S,B,E.RGBA,{premultiply:!1}),i.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE);S.activeTexture.set(E.TEXTURE0);let q=i.fbo;if(!q){const re=new Lt(S,{width:D,height:D,data:null},E.RGBA);re.bind(E.LINEAR,E.CLAMP_TO_EDGE),q=i.fbo=S.createFramebuffer(D,D,!0,!1),q.colorAttachment.set(re.texture)}S.bindFramebuffer.set(q.framebuffer),S.viewport.set([0,0,D,D]),y.useProgram("hillshadePrepare").draw(S,E.TRIANGLES,h,p,_,er.disabled,((re,te)=>{const se=te.stride,K=l.F();return l.aN(K,0,l.W,-l.W,0,0,1),l.H(K,K,[0,-l.W,0]),{u_matrix:K,u_image:1,u_dimension:[se,se],u_zoom:re.overscaledZ,u_unpack:te.getUnpackVector()}})(i.tileID,C),null,o.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments),i.needsHillshadePrepare=!1}}function aa(y,i,o,h,p,_){const S=h.paint.get("raster-fade-duration");if(!_&&S>0){const E=k.now(),C=(E-y.timeAdded)/S,D=i?(E-i.timeAdded)/S:-1,F=o.getSource(),B=p.coveringZoomLevel({tileSize:F.tileSize,roundZoom:F.roundZoom}),q=!i||Math.abs(i.tileID.overscaledZ-B)>Math.abs(y.tileID.overscaledZ-B),re=q&&y.refreshedUponExpiration?1:l.ac(q?C:1-D,0,1);return y.refreshedUponExpiration&&C>=1&&(y.refreshedUponExpiration=!1),i?{opacity:1,mix:1-re}:{opacity:re,mix:0}}return{opacity:1,mix:0}}const Fl=new l.aO(1,0,0,1),Qo=new l.aO(0,1,0,1),qa=new l.aO(0,0,1,1),Bl=new l.aO(1,0,1,1),Nl=new l.aO(0,1,1,1);function mr(y,i,o,h){jr(y,0,i+o/2,y.transform.width,o,h)}function Hs(y,i,o,h){jr(y,i-o/2,0,o,y.transform.height,h)}function jr(y,i,o,h,p,_){const S=y.context,E=S.gl;E.enable(E.SCISSOR_TEST),E.scissor(i*y.pixelRatio,o*y.pixelRatio,h*y.pixelRatio,p*y.pixelRatio),S.clear({color:_}),E.disable(E.SCISSOR_TEST)}function el(y,i,o){const h=y.context,p=h.gl,_=o.posMatrix,S=y.useProgram("debug"),E=fi.disabled,C=$i.disabled,D=y.colorModeForRenderPass(),F="$debug",B=y.style.map.terrain&&y.style.map.terrain.getTerrainData(o);h.activeTexture.set(p.TEXTURE0);const q=i.getTileByID(o.key).latestRawTileData,re=Math.floor((q&&q.byteLength||0)/1024),te=i.getTile(o).tileSize,se=512/Math.min(te,512)*(o.overscaledZ/y.transform.zoom)*.5;let K=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(K+=` => ${o.overscaledZ}`),function(me,Pe){me.initDebugOverlayCanvas();const le=me.debugOverlayCanvas,Me=me.context.gl,ke=me.debugOverlayCanvas.getContext("2d");ke.clearRect(0,0,le.width,le.height),ke.shadowColor="white",ke.shadowBlur=2,ke.lineWidth=1.5,ke.strokeStyle="white",ke.textBaseline="top",ke.font="bold 36px Open Sans, sans-serif",ke.fillText(Pe,5,5),ke.strokeText(Pe,5,5),me.debugOverlayTexture.update(le),me.debugOverlayTexture.bind(Me.LINEAR,Me.CLAMP_TO_EDGE)}(y,`${K} ${re}kB`),S.draw(h,p.TRIANGLES,E,C,ir.alphaBlended,er.disabled,St(_,l.aO.transparent,se),null,F,y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),S.draw(h,p.LINE_STRIP,E,C,D,er.disabled,St(_,l.aO.red),B,F,y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}function tl(y,i,o){const h=y.context,p=h.gl,_=y.colorModeForRenderPass(),S=new fi(p.LEQUAL,fi.ReadWrite,y.depthRangeFor3D),E=y.useProgram("terrain"),C=i.getTerrainMesh();h.bindFramebuffer.set(null),h.viewport.set([0,0,y.width,y.height]);for(const D of o){const F=y.renderToTexture.getTexture(D),B=i.getTerrainData(D.tileID);h.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,F.texture);const q={u_matrix:y.transform.calculatePosMatrix(D.tileID.toUnwrapped()),u_texture:0,u_ele_delta:i.getMeshFrameDelta(y.transform.zoom)};E.draw(h,p.TRIANGLES,S,$i.disabled,_,er.backCCW,q,B,"terrain",C.vertexBuffer,C.indexBuffer,C.segments)}}class Te{constructor(i,o){this.context=new Gs(i),this.transform=o,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Sr.maxUnderzooming+Sr.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ia}resize(i,o,h){if(this.width=Math.floor(i*h),this.height=Math.floor(o*h),this.pixelRatio=h,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style._order)this.style._layers[p].resize()}setup(){const i=this.context,o=new l.aV;o.emplaceBack(0,0),o.emplaceBack(l.W,0),o.emplaceBack(0,l.W),o.emplaceBack(l.W,l.W),this.tileExtentBuffer=i.createVertexBuffer(o,ho.members),this.tileExtentSegments=l.$.simpleSegment(0,0,4,2);const h=new l.aV;h.emplaceBack(0,0),h.emplaceBack(l.W,0),h.emplaceBack(0,l.W),h.emplaceBack(l.W,l.W),this.debugBuffer=i.createVertexBuffer(h,ho.members),this.debugSegments=l.$.simpleSegment(0,0,4,5);const p=new l.Z;p.emplaceBack(0,0,0,0),p.emplaceBack(l.W,0,l.W,0),p.emplaceBack(0,l.W,0,l.W),p.emplaceBack(l.W,l.W,l.W,l.W),this.rasterBoundsBuffer=i.createVertexBuffer(p,Be.members),this.rasterBoundsSegments=l.$.simpleSegment(0,0,4,2);const _=new l.aV;_.emplaceBack(0,0),_.emplaceBack(1,0),_.emplaceBack(0,1),_.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(_,ho.members),this.viewportSegments=l.$.simpleSegment(0,0,4,2);const S=new l.aW;S.emplaceBack(0),S.emplaceBack(1),S.emplaceBack(3),S.emplaceBack(2),S.emplaceBack(0),this.tileBorderIndexBuffer=i.createIndexBuffer(S);const E=new l.aX;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(E);const C=this.context.gl;this.stencilClearMode=new $i({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO)}clearStencil(){const i=this.context,o=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const h=l.F();l.aN(h,0,this.width,this.height,0,0,1),l.J(h,h,[o.drawingBufferWidth,o.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(i,o.TRIANGLES,fi.disabled,this.stencilClearMode,ir.disabled,er.disabled,pt(h),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(i,o){if(this.currentStencilSource===i.source||!i.isTileClipped()||!o||!o.length)return;this.currentStencilSource=i.source;const h=this.context,p=h.gl;this.nextStencilID+o.length>256&&this.clearStencil(),h.setColorMode(ir.disabled),h.setDepthMode(fi.disabled);const _=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of o){const E=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,C=this.style.map.terrain&&this.style.map.terrain.getTerrainData(S);_.draw(h,p.TRIANGLES,fi.disabled,new $i({func:p.ALWAYS,mask:0},E,255,p.KEEP,p.KEEP,p.REPLACE),ir.disabled,er.disabled,pt(S.posMatrix),C,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,o=this.context.gl;return new $i({func:o.NOTEQUAL,mask:255},i,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(i){const o=this.context.gl;return new $i({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(i){const o=this.context.gl,h=i.sort((S,E)=>E.overscaledZ-S.overscaledZ),p=h[h.length-1].overscaledZ,_=h[0].overscaledZ-p+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const S={};for(let E=0;E<_;E++)S[E+p]=new $i({func:o.GEQUAL,mask:255},E+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=_,[S,h]}return[{[p]:$i.disabled},h]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new ir([i.CONSTANT_COLOR,i.ONE],new l.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ir.unblended:ir.alphaBlended}depthModeForSublayer(i,o,h){if(!this.opaquePassEnabledForLayer())return fi.disabled;const p=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new fi(h||this.context.gl.LEQUAL,o,[p,p])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,o){this.style=i,this.options=o,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(k.now()),this.imageManager.beginFrame();const h=this.style._order,p=this.style.sourceCaches,_={},S={},E={};for(const C in p){const D=p[C];D.used&&D.prepare(this.context),_[C]=D.getVisibleCoordinates(),S[C]=_[C].slice().reverse(),E[C]=D.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let C=0;C<h.length;C++)if(this.style._layers[h[C]].is3D()){this.opaquePassCutoff=C;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const C of h){const D=this.style._layers[C];if(!D.hasOffscreenPass()||D.isHidden(this.transform.zoom))continue;const F=S[D.source];(D.type==="custom"||F.length)&&this.renderLayer(this,p[D.source],D,F)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:o.showOverdrawInspector?l.aO.black:l.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.depthRangeFor3D=[0,1-(i._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){const C=this.style._layers[h[this.currentLayer]],D=p[C.source],F=_[C.source];this._renderTileClippingMasks(C,F),this.renderLayer(this,D,C,F)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){const C=this.style._layers[h[this.currentLayer]],D=p[C.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(C))continue;const F=(C.type==="symbol"?E:S)[C.source];this._renderTileClippingMasks(C,_[C.source]),this.renderLayer(this,D,C,F)}if(this.options.showTileBoundaries){const C=function(D,F){let B=null;const q=Object.values(D._layers).flatMap(K=>K.source&&!K.isHidden(F)?[D.sourceCaches[K.source]]:[]),re=q.filter(K=>K.getSource().type==="vector"),te=q.filter(K=>K.getSource().type!=="vector"),se=K=>{(!B||B.getSource().maxzoom<K.getSource().maxzoom)&&(B=K)};return re.forEach(K=>se(K)),B||te.forEach(K=>se(K)),B}(this.style,this.transform.zoom);C&&function(D,F,B){for(let q=0;q<B.length;q++)el(D,F,B[q])}(this,C,C.getVisibleCoordinates())}this.options.showPadding&&function(C){const D=C.transform.padding;mr(C,C.transform.height-(D.top||0),3,Fl),mr(C,D.bottom||0,3,Qo),Hs(C,D.left||0,3,qa),Hs(C,C.transform.width-(D.right||0),3,Bl);const F=C.transform.centerPoint;(function(B,q,re,te){jr(B,q-1,re-10,2,20,te),jr(B,q-10,re-1,20,2,te)})(C,F.x,C.transform.height-F.y,Nl)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(i){if(!this.style||!this.style.map||!this.style.map.terrain)return;const o=this.terrainFacilitator.matrix,h=this.transform.projMatrix;let p=this.terrainFacilitator.dirty;p||(p=i?!l.aY(o,h):!l.aZ(o,h)),p||(p=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),p&&(l.a_(o,h),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(_,S){const E=_.context,C=E.gl,D=ir.unblended,F=new fi(C.LEQUAL,fi.ReadWrite,[0,1]),B=S.getTerrainMesh(),q=S.sourceCache.getRenderableTiles(),re=_.useProgram("terrainDepth");E.bindFramebuffer.set(S.getFramebuffer("depth").framebuffer),E.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),E.clear({color:l.aO.transparent,depth:1});for(const te of q){const se=S.getTerrainData(te.tileID),K={u_matrix:_.transform.calculatePosMatrix(te.tileID.toUnwrapped()),u_ele_delta:S.getMeshFrameDelta(_.transform.zoom)};re.draw(E,C.TRIANGLES,F,$i.disabled,D,er.backCCW,K,se,"terrain",B.vertexBuffer,B.indexBuffer,B.segments)}E.bindFramebuffer.set(null),E.viewport.set([0,0,_.width,_.height])}(this,this.style.map.terrain),function(_,S){const E=_.context,C=E.gl,D=ir.unblended,F=new fi(C.LEQUAL,fi.ReadWrite,[0,1]),B=S.getTerrainMesh(),q=S.getCoordsTexture(),re=S.sourceCache.getRenderableTiles(),te=_.useProgram("terrainCoords");E.bindFramebuffer.set(S.getFramebuffer("coords").framebuffer),E.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),E.clear({color:l.aO.transparent,depth:1}),S.coordsIndex=[];for(const se of re){const K=S.getTerrainData(se.tileID);E.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,q.texture);const me={u_matrix:_.transform.calculatePosMatrix(se.tileID.toUnwrapped()),u_terrain_coords_id:(255-S.coordsIndex.length)/255,u_texture:0,u_ele_delta:S.getMeshFrameDelta(_.transform.zoom)};te.draw(E,C.TRIANGLES,F,$i.disabled,D,er.backCCW,me,K,"terrain",B.vertexBuffer,B.indexBuffer,B.segments),S.coordsIndex.push(se.tileID.key)}E.bindFramebuffer.set(null),E.viewport.set([0,0,_.width,_.height])}(this,this.style.map.terrain))}renderLayer(i,o,h,p){if(!h.isHidden(this.transform.zoom)&&(h.type==="background"||h.type==="custom"||(p||[]).length))switch(this.id=h.id,h.type){case"symbol":(function(_,S,E,C,D){if(_.renderPass!=="translucent")return;const F=$i.disabled,B=_.colorModeForRenderPass();(E._unevaluatedLayout.hasValue("text-variable-anchor")||E._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(q,re,te,se,K,me,Pe){const le=re.transform,Me=K==="map",ke=me==="map";for(const Le of q){const Oe=se.getTile(Le),Ke=Oe.getBucket(te);if(!Ke||!Ke.text||!Ke.text.segments.get().length)continue;const Ze=l.ag(Ke.textSizeData,le.zoom),ot=ni(Oe,1,re.transform.zoom),ht=ii(Le.posMatrix,ke,Me,re.transform,ot),di=te.layout.get("icon-text-fit")!=="none"&&Ke.hasIconData();if(Ze){const yt=Math.pow(2,le.zoom-Oe.tileID.overscaledZ);Ko(Ke,Me,ke,Pe,le,ht,Le.posMatrix,yt,Ze,di,re.style.map.terrain?(ti,pi)=>re.style.map.terrain.getElevation(Le,ti,pi):null)}}}(C,_,E,S,E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),D),E.paint.get("icon-opacity").constantOr(1)!==0&&go(_,S,E,C,!1,E.paint.get("icon-translate"),E.paint.get("icon-translate-anchor"),E.layout.get("icon-rotation-alignment"),E.layout.get("icon-pitch-alignment"),E.layout.get("icon-keep-upright"),F,B),E.paint.get("text-opacity").constantOr(1)!==0&&go(_,S,E,C,!0,E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),E.layout.get("text-keep-upright"),F,B),S.map.showCollisionBoxes&&(sa(_,S,E,C,E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),!0),sa(_,S,E,C,E.paint.get("icon-translate"),E.paint.get("icon-translate-anchor"),!1))})(i,o,h,p,this.style.placement.variableOffsets);break;case"circle":(function(_,S,E,C){if(_.renderPass!=="translucent")return;const D=E.paint.get("circle-opacity"),F=E.paint.get("circle-stroke-width"),B=E.paint.get("circle-stroke-opacity"),q=!E.layout.get("circle-sort-key").isConstant();if(D.constantOr(1)===0&&(F.constantOr(1)===0||B.constantOr(1)===0))return;const re=_.context,te=re.gl,se=_.depthModeForSublayer(0,fi.ReadOnly),K=$i.disabled,me=_.colorModeForRenderPass(),Pe=[];for(let le=0;le<C.length;le++){const Me=C[le],ke=S.getTile(Me),Le=ke.getBucket(E);if(!Le)continue;const Oe=Le.programConfigurations.get(E.id),Ke=_.useProgram("circle",Oe),Ze=Le.layoutVertexBuffer,ot=Le.indexBuffer,ht=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Me),di={programConfiguration:Oe,program:Ke,layoutVertexBuffer:Ze,indexBuffer:ot,uniformValues:lt(_,Me,ke,E),terrainData:ht};if(q){const yt=Le.segments.get();for(const ti of yt)Pe.push({segments:new l.$([ti]),sortKey:ti.sortKey,state:di})}else Pe.push({segments:Le.segments,sortKey:0,state:di})}q&&Pe.sort((le,Me)=>le.sortKey-Me.sortKey);for(const le of Pe){const{programConfiguration:Me,program:ke,layoutVertexBuffer:Le,indexBuffer:Oe,uniformValues:Ke,terrainData:Ze}=le.state;ke.draw(re,te.TRIANGLES,se,K,me,er.disabled,Ke,Ze,E.id,Le,Oe,le.segments,E.paint,_.transform.zoom,Me)}})(i,o,h,p);break;case"heatmap":(function(_,S,E,C){if(E.paint.get("heatmap-opacity")!==0)if(_.renderPass==="offscreen"){const D=_.context,F=D.gl,B=$i.disabled,q=new ir([F.ONE,F.ONE],l.aO.transparent,[!0,!0,!0,!0]);(function(re,te,se){const K=re.gl;re.activeTexture.set(K.TEXTURE1),re.viewport.set([0,0,te.width/4,te.height/4]);let me=se.heatmapFbo;if(me)K.bindTexture(K.TEXTURE_2D,me.colorAttachment.get()),re.bindFramebuffer.set(me.framebuffer);else{const Pe=K.createTexture();K.bindTexture(K.TEXTURE_2D,Pe),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MAG_FILTER,K.LINEAR),me=se.heatmapFbo=re.createFramebuffer(te.width/4,te.height/4,!1,!1),function(le,Me,ke,Le){var Oe,Ke;const Ze=le.gl,ot=(Oe=le.HALF_FLOAT)!==null&&Oe!==void 0?Oe:Ze.UNSIGNED_BYTE,ht=(Ke=le.RGBA16F)!==null&&Ke!==void 0?Ke:Ze.RGBA;Ze.texImage2D(Ze.TEXTURE_2D,0,ht,Me.width/4,Me.height/4,0,Ze.RGBA,ot,null),Le.colorAttachment.set(ke)}(re,te,Pe,me)}})(D,_,E),D.clear({color:l.aO.transparent});for(let re=0;re<C.length;re++){const te=C[re];if(S.hasRenderableParent(te))continue;const se=S.getTile(te),K=se.getBucket(E);if(!K)continue;const me=K.programConfigurations.get(E.id),Pe=_.useProgram("heatmap",me),{zoom:le}=_.transform;Pe.draw(D,F.TRIANGLES,fi.disabled,B,q,er.disabled,oi(te.posMatrix,se,le,E.paint.get("heatmap-intensity")),null,E.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,E.paint,_.transform.zoom,me)}D.viewport.set([0,0,_.width,_.height])}else _.renderPass==="translucent"&&(_.context.setColorMode(_.colorModeForRenderPass()),function(D,F){const B=D.context,q=B.gl,re=F.heatmapFbo;if(!re)return;B.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_2D,re.colorAttachment.get()),B.activeTexture.set(q.TEXTURE1);let te=F.colorRampTexture;te||(te=F.colorRampTexture=new Lt(B,F.colorRamp,q.RGBA)),te.bind(q.LINEAR,q.CLAMP_TO_EDGE),D.useProgram("heatmapTexture").draw(B,q.TRIANGLES,fi.disabled,$i.disabled,D.colorModeForRenderPass(),er.disabled,((se,K,me,Pe)=>{const le=l.F();l.aN(le,0,se.width,se.height,0,0,1);const Me=se.context.gl;return{u_matrix:le,u_world:[Me.drawingBufferWidth,Me.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:K.paint.get("heatmap-opacity")}})(D,F),null,F.id,D.viewportBuffer,D.quadTriangleIndexBuffer,D.viewportSegments,F.paint,D.transform.zoom)}(_,E))})(i,o,h,p);break;case"line":(function(_,S,E,C){if(_.renderPass!=="translucent")return;const D=E.paint.get("line-opacity"),F=E.paint.get("line-width");if(D.constantOr(1)===0||F.constantOr(1)===0)return;const B=_.depthModeForSublayer(0,fi.ReadOnly),q=_.colorModeForRenderPass(),re=E.paint.get("line-dasharray"),te=E.paint.get("line-pattern"),se=te.constantOr(1),K=E.paint.get("line-gradient"),me=E.getCrossfadeParameters(),Pe=se?"linePattern":re?"lineSDF":K?"lineGradient":"line",le=_.context,Me=le.gl;let ke=!0;for(const Le of C){const Oe=S.getTile(Le);if(se&&!Oe.patternsLoaded())continue;const Ke=Oe.getBucket(E);if(!Ke)continue;const Ze=Ke.programConfigurations.get(E.id),ot=_.context.program.get(),ht=_.useProgram(Pe,Ze),di=ke||ht.program!==ot,yt=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Le),ti=te.constantOr(null);if(ti&&Oe.imageAtlas){const si=Oe.imageAtlas,mi=si.patternPositions[ti.to.toString()],bi=si.patternPositions[ti.from.toString()];mi&&bi&&Ze.setConstantPatternPositions(mi,bi)}const pi=yt?Le:null,Li=se?qe(_,Oe,E,me,pi):re?Bt(_,Oe,E,re,me,pi):K?Rr(_,Oe,E,Ke.lineClipsArray.length,pi):hi(_,Oe,E,pi);if(se)le.activeTexture.set(Me.TEXTURE0),Oe.imageAtlasTexture.bind(Me.LINEAR,Me.CLAMP_TO_EDGE),Ze.updatePaintBuffers(me);else if(re&&(di||_.lineAtlas.dirty))le.activeTexture.set(Me.TEXTURE0),_.lineAtlas.bind(le);else if(K){const si=Ke.gradients[E.id];let mi=si.texture;if(E.gradientVersion!==si.version){let bi=256;if(E.stepInterpolant){const Or=S.getSource().maxzoom,tr=Le.canonical.z===Or?Math.ceil(1<<_.transform.maxZoom-Le.canonical.z):1;bi=l.ac(l.aT(Ke.maxLineLength/l.W*1024*tr),256,le.maxTextureSize)}si.gradient=l.aU({expression:E.gradientExpression(),evaluationKey:"lineProgress",resolution:bi,image:si.gradient||void 0,clips:Ke.lineClipsArray}),si.texture?si.texture.update(si.gradient):si.texture=new Lt(le,si.gradient,Me.RGBA),si.version=E.gradientVersion,mi=si.texture}le.activeTexture.set(Me.TEXTURE0),mi.bind(E.stepInterpolant?Me.NEAREST:Me.LINEAR,Me.CLAMP_TO_EDGE)}ht.draw(le,Me.TRIANGLES,B,_.stencilModeForClipping(Le),q,er.disabled,Li,yt,E.id,Ke.layoutVertexBuffer,Ke.indexBuffer,Ke.segments,E.paint,_.transform.zoom,Ze,Ke.layoutVertexBuffer2),ke=!1}})(i,o,h,p);break;case"fill":(function(_,S,E,C){const D=E.paint.get("fill-color"),F=E.paint.get("fill-opacity");if(F.constantOr(1)===0)return;const B=_.colorModeForRenderPass(),q=E.paint.get("fill-pattern"),re=_.opaquePassEnabledForLayer()&&!q.constantOr(1)&&D.constantOr(l.aO.transparent).a===1&&F.constantOr(0)===1?"opaque":"translucent";if(_.renderPass===re){const te=_.depthModeForSublayer(1,_.renderPass==="opaque"?fi.ReadWrite:fi.ReadOnly);Sa(_,S,E,C,te,B,!1)}if(_.renderPass==="translucent"&&E.paint.get("fill-antialias")){const te=_.depthModeForSublayer(E.getPaintProperty("fill-outline-color")?2:0,fi.ReadOnly);Sa(_,S,E,C,te,B,!0)}})(i,o,h,p);break;case"fill-extrusion":(function(_,S,E,C){const D=E.paint.get("fill-extrusion-opacity");if(D!==0&&_.renderPass==="translucent"){const F=new fi(_.context.gl.LEQUAL,fi.ReadWrite,_.depthRangeFor3D);if(D!==1||E.paint.get("fill-extrusion-pattern").constantOr(1))Jo(_,S,E,C,F,$i.disabled,ir.disabled),Jo(_,S,E,C,F,_.stencilModeFor3D(),_.colorModeForRenderPass());else{const B=_.colorModeForRenderPass();Jo(_,S,E,C,F,$i.disabled,B)}}})(i,o,h,p);break;case"hillshade":(function(_,S,E,C){if(_.renderPass!=="offscreen"&&_.renderPass!=="translucent")return;const D=_.context,F=_.depthModeForSublayer(0,fi.ReadOnly),B=_.colorModeForRenderPass(),[q,re]=_.renderPass==="translucent"?_.stencilConfigForOverlap(C):[{},C];for(const te of re){const se=S.getTile(te);se.needsHillshadePrepare!==void 0&&se.needsHillshadePrepare&&_.renderPass==="offscreen"?Ol(_,se,E,F,$i.disabled,B):_.renderPass==="translucent"&&ls(_,te,se,E,F,q[te.overscaledZ],B)}D.viewport.set([0,0,_.width,_.height])})(i,o,h,p);break;case"raster":(function(_,S,E,C){if(_.renderPass!=="translucent"||E.paint.get("raster-opacity")===0||!C.length)return;const D=_.context,F=D.gl,B=S.getSource(),q=_.useProgram("raster"),re=_.colorModeForRenderPass(),[te,se]=B instanceof st?[{},C]:_.stencilConfigForOverlap(C),K=se[se.length-1].overscaledZ,me=!_.options.moving;for(const Pe of se){const le=_.depthModeForSublayer(Pe.overscaledZ-K,E.paint.get("raster-opacity")===1?fi.ReadWrite:fi.ReadOnly,F.LESS),Me=S.getTile(Pe);Me.registerFadeDuration(E.paint.get("raster-fade-duration"));const ke=S.findLoadedParent(Pe,0),Le=aa(Me,ke,S,E,_.transform,_.style.map.terrain);let Oe,Ke;const Ze=E.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;D.activeTexture.set(F.TEXTURE0),Me.texture.bind(Ze,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),D.activeTexture.set(F.TEXTURE1),ke?(ke.texture.bind(Ze,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),Oe=Math.pow(2,ke.tileID.overscaledZ-Me.tileID.overscaledZ),Ke=[Me.tileID.canonical.x*Oe%1,Me.tileID.canonical.y*Oe%1]):Me.texture.bind(Ze,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST);const ot=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Pe),ht=ot?Pe:null,di=ht?ht.posMatrix:_.transform.calculatePosMatrix(Pe.toUnwrapped(),me),yt=vr(di,Ke||[0,0],Oe||1,Le,E);B instanceof st?q.draw(D,F.TRIANGLES,le,$i.disabled,re,er.disabled,yt,ot,E.id,B.boundsBuffer,_.quadTriangleIndexBuffer,B.boundsSegments):q.draw(D,F.TRIANGLES,le,te[Pe.overscaledZ],re,er.disabled,yt,ot,E.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments)}})(i,o,h,p);break;case"background":(function(_,S,E,C){const D=E.paint.get("background-color"),F=E.paint.get("background-opacity");if(F===0)return;const B=_.context,q=B.gl,re=_.transform,te=re.tileSize,se=E.paint.get("background-pattern");if(_.isPatternMissing(se))return;const K=!se&&D.a===1&&F===1&&_.opaquePassEnabledForLayer()?"opaque":"translucent";if(_.renderPass!==K)return;const me=$i.disabled,Pe=_.depthModeForSublayer(0,K==="opaque"?fi.ReadWrite:fi.ReadOnly),le=_.colorModeForRenderPass(),Me=_.useProgram(se?"backgroundPattern":"background"),ke=C||re.coveringTiles({tileSize:te,terrain:_.style.map.terrain});se&&(B.activeTexture.set(q.TEXTURE0),_.imageManager.bind(_.context));const Le=E.getCrossfadeParameters();for(const Oe of ke){const Ke=C?Oe.posMatrix:_.transform.calculatePosMatrix(Oe.toUnwrapped()),Ze=se?Vs(Ke,F,_,se,{tileID:Oe,tileSize:te},Le):Su(Ke,F,D),ot=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Oe);Me.draw(B,q.TRIANGLES,Pe,me,le,er.disabled,Ze,ot,E.id,_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}})(i,0,h,p);break;case"custom":(function(_,S,E){const C=_.context,D=E.implementation;if(_.renderPass==="offscreen"){const F=D.prerender;F&&(_.setCustomLayerDefaults(),C.setColorMode(_.colorModeForRenderPass()),F.call(D,C.gl,_.transform.customLayerMatrix()),C.setDirty(),_.setBaseState())}else if(_.renderPass==="translucent"){_.setCustomLayerDefaults(),C.setColorMode(_.colorModeForRenderPass()),C.setStencilMode($i.disabled);const F=D.renderingMode==="3d"?new fi(_.context.gl.LEQUAL,fi.ReadWrite,_.depthRangeFor3D):_.depthModeForSublayer(0,fi.ReadOnly);C.setDepthMode(F),D.render(C.gl,_.transform.customLayerMatrix()),C.setDirty(),_.setBaseState(),C.bindFramebuffer.set(null)}})(i,0,h)}}translatePosMatrix(i,o,h,p,_){if(!h[0]&&!h[1])return i;const S=_?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(S){const D=Math.sin(S),F=Math.cos(S);h=[h[0]*F-h[1]*D,h[0]*D+h[1]*F]}const E=[_?h[0]:ni(o,h[0],this.transform.zoom),_?h[1]:ni(o,h[1],this.transform.zoom),0],C=new Float32Array(16);return l.H(C,i,E),C}saveTileTexture(i){const o=this._tileTextures[i.size[0]];o?o.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const o=this._tileTextures[i];return o&&o.length>0?o.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const o=this.imageManager.getPattern(i.from.toString()),h=this.imageManager.getPattern(i.to.toString());return!o||!h}useProgram(i,o){this.cache=this.cache||{};const h=i+(o?o.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[h]||(this.cache[h]=new b(this.context,po[i],o,Il[i],this._showOverdrawInspector,this.style.map.terrain)),this.cache[h]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Lt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:i,drawingBufferHeight:o}=this.context.gl;return this.width!==i||this.height!==o}}class Re{constructor(i,o){this.points=i,this.planes=o}static fromInvProjectionMatrix(i,o,h){const p=Math.pow(2,h),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const C=1/(E=l.af([],E,i))[3]/o*p;return l.a$(E,E,[C,C,1/E[3],C])}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const C=function(q,re){var te=re[0],se=re[1],K=re[2],me=te*te+se*se+K*K;return me>0&&(me=1/Math.sqrt(me)),q[0]=re[0]*me,q[1]=re[1]*me,q[2]=re[2]*me,q}([],function(q,re,te){var se=re[0],K=re[1],me=re[2],Pe=te[0],le=te[1],Me=te[2];return q[0]=K*Me-me*le,q[1]=me*Pe-se*Me,q[2]=se*le-K*Pe,q}([],ft([],_[E[0]],_[E[1]]),ft([],_[E[2]],_[E[1]]))),D=-((F=C)[0]*(B=_[E[1]])[0]+F[1]*B[1]+F[2]*B[2]);var F,B;return C.concat(D)});return new Re(_,S)}}class mt{constructor(i,o){this.min=i,this.max=o,this.center=function(h,p,_){return h[0]=.5*p[0],h[1]=.5*p[1],h[2]=.5*p[2],h}([],function(h,p,_){return h[0]=p[0]+_[0],h[1]=p[1]+_[1],h[2]=p[2]+_[2],h}([],this.min,this.max))}quadrant(i){const o=[i%2==0,i<2],h=Xe(this.min),p=Xe(this.max);for(let _=0;_<o.length;_++)h[_]=o[_]?this.min[_]:this.center[_],p[_]=o[_]?this.center[_]:this.max[_];return p[2]=this.max[2],new mt(h,p)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}intersects(i){const o=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let h=!0;for(let p=0;p<i.planes.length;p++){const _=i.planes[p];let S=0;for(let E=0;E<o.length;E++)l.b0(_,o[E])>=0&&S++;if(S===0)return 0;S!==o.length&&(h=!1)}if(h)return 2;for(let p=0;p<3;p++){let _=Number.MAX_VALUE,S=-Number.MAX_VALUE;for(let E=0;E<i.points.length;E++){const C=i.points[E][p]-this.min[p];_=Math.min(_,C),S=Math.max(S,C)}if(S<0||_>this.max[p]-this.min[p])return 0}return 1}}class Xt{constructor(i=0,o=0,h=0,p=0){if(isNaN(i)||i<0||isNaN(o)||o<0||isNaN(h)||h<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=o,this.left=h,this.right=p}interpolate(i,o,h){return o.top!=null&&i.top!=null&&(this.top=l.z.number(i.top,o.top,h)),o.bottom!=null&&i.bottom!=null&&(this.bottom=l.z.number(i.bottom,o.bottom,h)),o.left!=null&&i.left!=null&&(this.left=l.z.number(i.left,o.left,h)),o.right!=null&&i.right!=null&&(this.right=l.z.number(i.right,o.right,h)),this}getCenter(i,o){const h=l.ac((this.left+i-this.right)/2,0,i),p=l.ac((this.top+o-this.bottom)/2,0,o);return new l.P(h,p)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new Xt(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const rr=85.051129;class Ci{constructor(i,o,h,p,_){this.tileSize=512,this._renderWorldCopies=_===void 0||!!_,this._minZoom=i||0,this._maxZoom=o||22,this._minPitch=h??0,this._maxPitch=p??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Xt,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const i=new Ci(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return i.apply(this),i}apply(i){this.tileSize=i.tileSize,this.latRange=i.latRange,this.width=i.width,this.height=i.height,this._center=i._center,this._elevation=i._elevation,this.minElevationForCurrentTile=i.minElevationForCurrentTile,this.zoom=i.zoom,this.angle=i.angle,this._fov=i._fov,this._pitch=i._pitch,this._unmodified=i._unmodified,this._edgeInsets=i._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(i){const o=-l.b1(i,-180,180)*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=function(){var h=new l.A(4);return l.A!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h}(),function(h,p,_){var S=p[0],E=p[1],C=p[2],D=p[3],F=Math.sin(_),B=Math.cos(_);h[0]=S*B+C*F,h[1]=E*B+D*F,h[2]=S*-F+C*B,h[3]=E*-F+D*B}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const o=l.ac(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(i){const o=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._zoom=o,this.tileZoom=Math.max(0,Math.floor(o)),this.scale=this.zoomScale(o),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(i){i!==this._elevation&&(this._elevation=i,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,o,h){this._unmodified=!1,this._edgeInsets.interpolate(i,o,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const o=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(i){const o=[new l.b2(0,i)];if(this._renderWorldCopies){const h=this.pointCoordinate(new l.P(0,0)),p=this.pointCoordinate(new l.P(this.width,0)),_=this.pointCoordinate(new l.P(this.width,this.height)),S=this.pointCoordinate(new l.P(0,this.height)),E=Math.floor(Math.min(h.x,p.x,_.x,S.x)),C=Math.floor(Math.max(h.x,p.x,_.x,S.x)),D=1;for(let F=E-D;F<=C+D;F++)F!==0&&o.push(new l.b2(F,i))}return o}coveringTiles(i){var o,h;let p=this.coveringZoomLevel(i);const _=p;if(i.minzoom!==void 0&&p<i.minzoom)return[];i.maxzoom!==void 0&&p>i.maxzoom&&(p=i.maxzoom);const S=this.pointCoordinate(this.getCameraPoint()),E=l.Y.fromLngLat(this.center),C=Math.pow(2,p),D=[C*S.x,C*S.y,0],F=[C*E.x,C*E.y,0],B=Re.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,p);let q=i.minzoom||0;!i.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(q=p);const re=i.terrain?2/Math.min(this.tileSize,i.tileSize)*this.tileSize:3,te=le=>({aabb:new mt([le*C,0,0],[(le+1)*C,C,0]),zoom:0,x:0,y:0,wrap:le,fullyVisible:!1}),se=[],K=[],me=p,Pe=i.reparseOverscaled?_:p;if(this._renderWorldCopies)for(let le=1;le<=3;le++)se.push(te(-le)),se.push(te(le));for(se.push(te(0));se.length>0;){const le=se.pop(),Me=le.x,ke=le.y;let Le=le.fullyVisible;if(!Le){const ht=le.aabb.intersects(B);if(ht===0)continue;Le=ht===2}const Oe=i.terrain?D:F,Ke=le.aabb.distanceX(Oe),Ze=le.aabb.distanceY(Oe),ot=Math.max(Math.abs(Ke),Math.abs(Ze));if(le.zoom===me||ot>re+(1<<me-le.zoom)-2&&le.zoom>=q){const ht=me-le.zoom,di=D[0]-.5-(Me<<ht),yt=D[1]-.5-(ke<<ht);K.push({tileID:new l.Q(le.zoom===me?Pe:le.zoom,le.wrap,le.zoom,Me,ke),distanceSq:At([F[0]-.5-Me,F[1]-.5-ke]),tileDistanceToCamera:Math.sqrt(di*di+yt*yt)})}else for(let ht=0;ht<4;ht++){const di=(Me<<1)+ht%2,yt=(ke<<1)+(ht>>1),ti=le.zoom+1;let pi=le.aabb.quadrant(ht);if(i.terrain){const Li=new l.Q(ti,le.wrap,ti,di,yt),si=i.terrain.getMinMaxElevation(Li),mi=(o=si.minElevation)!==null&&o!==void 0?o:this.elevation,bi=(h=si.maxElevation)!==null&&h!==void 0?h:this.elevation;pi=new mt([pi.min[0],pi.min[1],mi],[pi.max[0],pi.max[1],bi])}se.push({aabb:pi,zoom:ti,x:di,y:yt,wrap:le.wrap,fullyVisible:Le})}}return K.sort((le,Me)=>le.distanceSq-Me.distanceSq).map(le=>le.tileID)}resize(i,o){this.width=i,this.height=o,this.pixelsToGLUnits=[2/i,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const o=l.ac(i.lat,-85.051129,rr);return new l.P(l.N(i.lng)*this.worldSize,l.O(o)*this.worldSize)}unproject(i){return new l.Y(i.x/this.worldSize,i.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(i){const o=this.elevation,h=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,p=this.pointLocation(this.centerPoint,i),_=i.getElevationForLngLatZoom(p,this.tileZoom);if(!(this.elevation-_))return;const S=h+o-_,E=Math.cos(this._pitch)*this.cameraToCenterDistance/S/l.b3(1,p.lat),C=this.scaleZoom(E/this.tileSize);this._elevation=_,this._center=p,this.zoom=C}setLocationAtPoint(i,o){const h=this.pointCoordinate(o),p=this.pointCoordinate(this.centerPoint),_=this.locationCoordinate(i),S=new l.Y(_.x-(h.x-p.x),_.y-(h.y-p.y));this.center=this.coordinateLocation(S),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(i,o){return o?this.coordinatePoint(this.locationCoordinate(i),o.getElevationForLngLatZoom(i,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(i))}pointLocation(i,o){return this.coordinateLocation(this.pointCoordinate(i,o))}locationCoordinate(i){return l.Y.fromLngLat(i)}coordinateLocation(i){return i&&i.toLngLat()}pointCoordinate(i,o){if(o){const q=o.pointCoordinate(i);if(q!=null)return q}const h=[i.x,i.y,0,1],p=[i.x,i.y,1,1];l.af(h,h,this.pixelMatrixInverse),l.af(p,p,this.pixelMatrixInverse);const _=h[3],S=p[3],E=h[1]/_,C=p[1]/S,D=h[2]/_,F=p[2]/S,B=D===F?0:(0-D)/(F-D);return new l.Y(l.z.number(h[0]/_,p[0]/S,B)/this.worldSize,l.z.number(E,C,B)/this.worldSize)}coordinatePoint(i,o=0,h=this.pixelMatrix){const p=[i.x*this.worldSize,i.y*this.worldSize,o,1];return l.af(p,p,h),new l.P(p[0]/p[3],p[1]/p[3])}getBounds(){const i=Math.max(0,this.height/2-this.getHorizon());return new ue().extend(this.pointLocation(new l.P(0,i))).extend(this.pointLocation(new l.P(this.width,i))).extend(this.pointLocation(new l.P(this.width,this.height))).extend(this.pointLocation(new l.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new ue([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(i){i?(this.lngRange=[i.getWest(),i.getEast()],this.latRange=[i.getSouth(),i.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,rr])}calculatePosMatrix(i,o=!1){const h=i.key,p=o?this._alignedPosMatrixCache:this._posMatrixCache;if(p[h])return p[h];const _=i.canonical,S=this.worldSize/this.zoomScale(_.z),E=_.x+Math.pow(2,_.z)*i.wrap,C=l.an(new Float64Array(16));return l.H(C,C,[E*S,_.y*S,0]),l.J(C,C,[S/l.W,S/l.W,1]),l.K(C,o?this.alignedProjMatrix:this.projMatrix,C),p[h]=new Float32Array(C),p[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(i,o){o=l.ac(+o,this.minZoom,this.maxZoom);const h={center:new l.M(i.lng,i.lat),zoom:o};let p=this.lngRange;if(!this._renderWorldCopies&&p===null){const le=179.9999999999;p=[-le,le]}const _=this.tileSize*this.zoomScale(h.zoom);let S=0,E=_,C=0,D=_,F=0,B=0;const{x:q,y:re}=this.size;if(this.latRange){const le=this.latRange;S=l.O(le[1])*_,E=l.O(le[0])*_,E-S<re&&(F=re/(E-S))}p&&(C=l.b1(l.N(p[0])*_,0,_),D=l.b1(l.N(p[1])*_,0,_),D<C&&(D+=_),D-C<q&&(B=q/(D-C)));const{x:te,y:se}=this.project.call({worldSize:_},i);let K,me;const Pe=Math.max(B||0,F||0);if(Pe){const le=new l.P(B?(D+C)/2:te,F?(E+S)/2:se);return h.center=this.unproject.call({worldSize:_},le).wrap(),h.zoom+=this.scaleZoom(Pe),h}if(this.latRange){const le=re/2;se-le<S&&(me=S+le),se+le>E&&(me=E-le)}if(p){const le=(C+D)/2;let Me=te;this._renderWorldCopies&&(Me=l.b1(te,le-_/2,le+_/2));const ke=q/2;Me-ke<C&&(K=C+ke),Me+ke>D&&(K=D-ke)}if(K!==void 0||me!==void 0){const le=new l.P(K??te,me??se);h.center=this.unproject.call({worldSize:_},le).wrap()}return h}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this._unmodified,{center:o,zoom:h}=this.getConstrained(this.center,this.zoom);this.center=o,this.zoom=h,this._unmodified=i,this._constraining=!1}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,o=this.point.x,h=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.b3(1,this.center.lat)*this.worldSize;let p=l.an(new Float64Array(16));l.J(p,p,[this.width/2,-this.height/2,1]),l.H(p,p,[1,-1,0]),this.labelPlaneMatrix=p,p=l.an(new Float64Array(16)),l.J(p,p,[1,-1,1]),l.H(p,p,[-1,-1,0]),l.J(p,p,[2/this.width,2/this.height,1]),this.glCoordMatrix=p;const _=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),S=Math.min(this.elevation,this.minElevationForCurrentTile),E=_-S*this._pixelPerMeter/Math.cos(this._pitch),C=S<0?E:_,D=Math.PI/2+this._pitch,F=this._fov*(.5+i.y/this.height),B=Math.sin(F)*C/Math.sin(l.ac(Math.PI-D-F,.01,Math.PI-.01)),q=this.getHorizon(),re=2*Math.atan(q/this.cameraToCenterDistance)*(.5+i.y/(2*q)),te=Math.sin(re)*C/Math.sin(l.ac(Math.PI-D-re,.01,Math.PI-.01)),se=Math.min(B,te),K=1.01*(Math.cos(Math.PI/2-this._pitch)*se+C),me=this.height/50;p=new Float64Array(16),l.b4(p,this._fov,this.width/this.height,me,K),p[8]=2*-i.x/this.width,p[9]=2*i.y/this.height,l.J(p,p,[1,-1,1]),l.H(p,p,[0,0,-this.cameraToCenterDistance]),l.b5(p,p,this._pitch),l.ad(p,p,this.angle),l.H(p,p,[-o,-h,0]),this.mercatorMatrix=l.J([],p,[this.worldSize,this.worldSize,this.worldSize]),l.J(p,p,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.K(new Float64Array(16),this.labelPlaneMatrix,p),l.H(p,p,[0,0,-this.elevation]),this.projMatrix=p,this.invProjMatrix=l.ar([],p),this.pixelMatrix3D=l.K(new Float64Array(16),this.labelPlaneMatrix,p);const Pe=this.width%2/2,le=this.height%2/2,Me=Math.cos(this.angle),ke=Math.sin(this.angle),Le=o-Math.round(o)+Me*Pe+ke*le,Oe=h-Math.round(h)+Me*le+ke*Pe,Ke=new Float64Array(p);if(l.H(Ke,Ke,[Le>.5?Le-1:Le,Oe>.5?Oe-1:Oe,0]),this.alignedProjMatrix=Ke,p=l.ar(new Float64Array(16),this.pixelMatrix),!p)throw new Error("failed to invert matrix");this.pixelMatrixInverse=p,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const i=this.pointCoordinate(new l.P(0,0)),o=[i.x*this.worldSize,i.y*this.worldSize,0,1];return l.af(o,o,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(0,i))}getCameraQueryGeometry(i){const o=this.getCameraPoint();if(i.length===1)return[i[0],o];{let h=o.x,p=o.y,_=o.x,S=o.y;for(const E of i)h=Math.min(h,E.x),p=Math.min(p,E.y),_=Math.max(_,E.x),S=Math.max(S,E.y);return[new l.P(h,p),new l.P(_,p),new l.P(_,S),new l.P(h,S),new l.P(h,p)]}}lngLatToCameraDepth(i,o){const h=this.locationCoordinate(i),p=[h.x*this.worldSize,h.y*this.worldSize,o,1];return l.af(p,p,this.projMatrix),p[2]/p[3]}}function gr(y,i){let o,h=!1,p=null,_=null;const S=()=>{p=null,h&&(y.apply(_,o),p=setTimeout(S,i),h=!1)};return(...E)=>(h=!0,_=this,o=E,p||S(),p)}class Cr{constructor(i){this._getCurrentHash=()=>{const o=window.location.hash.replace("#","");if(this._hashName){let h;return o.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(h=p)}),(h&&h[1]||"").split("/")}return o.split("/")},this._onHashChange=()=>{const o=this._getCurrentHash();if(o.length>=3&&!o.some(h=>isNaN(h))){const h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:h,pitch:+(o[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const o=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,o)}catch{}},this._updateHash=gr(this._updateHashUnthrottled,300),this._hashName=i&&encodeURIComponent(i)}addTo(i){return this._map=i,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(i){const o=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,p=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,p),S=Math.round(o.lng*_)/_,E=Math.round(o.lat*_)/_,C=this._map.getBearing(),D=this._map.getPitch();let F="";if(F+=i?`/${S}/${E}/${h}`:`${h}/${E}/${S}`,(C||D)&&(F+="/"+Math.round(10*C)/10),D&&(F+=`/${Math.round(D)}`),this._hashName){const B=this._hashName;let q=!1;const re=window.location.hash.slice(1).split("&").map(te=>{const se=te.split("=")[0];return se===B?(q=!0,`${se}=${F}`):te}).filter(te=>te);return q||re.push(`${B}=${F}`),`#${re.join("&")}`}return`#${F}`}}const Tn={linearity:.3,easing:l.b6(0,0,.3,1)},ur=l.e({deceleration:2500,maxSpeed:1400},Tn),Nr=l.e({deceleration:20,maxSpeed:1400},Tn),cs=l.e({deceleration:1e3,maxSpeed:360},Tn),Ss=l.e({deceleration:1e3,maxSpeed:90},Tn);class mn{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:k.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,o=k.now();for(;i.length>0&&o-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const o={zoom:0,bearing:0,pitch:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)o.zoom+=_.zoomDelta||0,o.bearing+=_.bearingDelta||0,o.pitch+=_.pitchDelta||0,_.panDelta&&o.pan._add(_.panDelta),_.around&&(o.around=_.around),_.pinchAround&&(o.pinchAround=_.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(o.pan.mag()){const _=Es(o.pan.mag(),h,l.e({},ur,i||{}));p.offset=o.pan.mult(_.amount/o.pan.mag()),p.center=this._map.transform.center,Fn(p,_)}if(o.zoom){const _=Es(o.zoom,h,Nr);p.zoom=this._map.transform.zoom+_.amount,Fn(p,_)}if(o.bearing){const _=Es(o.bearing,h,cs);p.bearing=this._map.transform.bearing+l.ac(_.amount,-179,179),Fn(p,_)}if(o.pitch){const _=Es(o.pitch,h,Ss);p.pitch=this._map.transform.pitch+_.amount,Fn(p,_)}if(p.zoom||p.bearing){const _=o.pinchAround===void 0?o.around:o.pinchAround;p.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),l.e(p,{noMoveStart:!0})}}function Fn(y,i){(!y.duration||y.duration<i.duration)&&(y.duration=i.duration,y.easing=i.easing)}function Es(y,i,o){const{maxSpeed:h,linearity:p,deceleration:_}=o,S=l.ac(y*p/(i/1e3),-h,h),E=Math.abs(S)/(_*p);return{easing:o.easing,duration:1e3*E,amount:S*(E/2)}}class tn extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,h,p={}){const _=z.mousePos(o.getCanvas(),h),S=o.unproject(_);super(i,l.e({point:_,lngLat:S,originalEvent:h},p)),this._defaultPrevented=!1,this.target=o}}class Cn extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,h){const p=i==="touchend"?h.changedTouches:h.touches,_=z.touchPos(o.getCanvasContainer(),p),S=_.map(C=>o.unproject(C)),E=_.reduce((C,D,F,B)=>C.add(D.div(B.length)),new l.P(0,0));super(i,{points:_,point:E,lngLats:S,lngLat:o.unproject(E),originalEvent:h}),this._defaultPrevented=!1}}class Ea extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,h){super(i,{originalEvent:h}),this._defaultPrevented=!1}}class Xn{constructor(i,o){this._map=i,this._clickTolerance=o.clickTolerance}reset(){delete this._mousedownPos}wheel(i){return this._firePreventable(new Ea(i.type,this._map,i))}mousedown(i,o){return this._mousedownPos=o,this._firePreventable(new tn(i.type,this._map,i))}mouseup(i){this._map.fire(new tn(i.type,this._map,i))}click(i,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||this._map.fire(new tn(i.type,this._map,i))}dblclick(i){return this._firePreventable(new tn(i.type,this._map,i))}mouseover(i){this._map.fire(new tn(i.type,this._map,i))}mouseout(i){this._map.fire(new tn(i.type,this._map,i))}touchstart(i){return this._firePreventable(new Cn(i.type,this._map,i))}touchmove(i){this._map.fire(new Cn(i.type,this._map,i))}touchend(i){this._map.fire(new Cn(i.type,this._map,i))}touchcancel(i){this._map.fire(new Cn(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ts{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(i){this._map.fire(new tn(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new tn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._ignoreContextMenu||this._map.fire(new tn(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ga{constructor(i){this._map=i}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(i){return this.transform.pointLocation(l.P.convert(i),this._map.terrain)}}class Ai{constructor(i,o){this._map=i,this._tr=new Ga(i),this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,o){this.isEnabled()&&i.shiftKey&&i.button===0&&(z.disableDrag(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(i,o){if(!this._active)return;const h=o;if(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)return;const p=this._startPos;this._lastPos=h,this._box||(this._box=z.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",i));const _=Math.min(p.x,h.x),S=Math.max(p.x,h.x),E=Math.min(p.y,h.y),C=Math.max(p.y,h.y);z.setTransform(this._box,`translate(${_}px,${E}px)`),this._box.style.width=S-_+"px",this._box.style.height=C-E+"px"}mouseupWindow(i,o){if(!this._active||i.button!==0)return;const h=this._startPos,p=o;if(this.reset(),z.suppressClick(),h.x!==p.x||h.y!==p.y)return this._map.fire(new l.k("boxzoomend",{originalEvent:i})),{cameraAnimation:_=>_.fitScreenCoordinates(h,p,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",i)}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(z.remove(this._box),this._box=null),z.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(i,o){return this._map.fire(new l.k(i,{originalEvent:o}))}}function Ri(y,i){if(y.length!==i.length)throw new Error(`The number of touches and points are not equal - touches ${y.length}, points ${i.length}`);const o={};for(let h=0;h<y.length;h++)o[y[h].identifier]=i[h];return o}class il{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(i,o,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),h.length===this.numTouches&&(this.centroid=function(p){const _=new l.P(0,0);for(const S of p)_._add(S);return _.div(p.length)}(o),this.touches=Ri(h,o)))}touchmove(i,o,h){if(this.aborted||!this.centroid)return;const p=Ri(h,o);for(const _ in this.touches){const S=p[_];(!S||S.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(i,o,h){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class Cs{constructor(i){this.singleTap=new il(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(i,o,h){this.singleTap.touchstart(i,o,h)}touchmove(i,o,h){this.singleTap.touchmove(i,o,h)}touchend(i,o,h){const p=this.singleTap.touchend(i,o,h);if(p){const _=i.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(p)<30;if(_&&S||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class $l{constructor(i){this._tr=new Ga(i),this._zoomIn=new Cs({numTouches:1,numTaps:2}),this._zoomOut=new Cs({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,o,h){this._zoomIn.touchstart(i,o,h),this._zoomOut.touchstart(i,o,h)}touchmove(i,o,h){this._zoomIn.touchmove(i,o,h),this._zoomOut.touchmove(i,o,h)}touchend(i,o,h){const p=this._zoomIn.touchend(i,o,h),_=this._zoomOut.touchend(i,o,h),S=this._tr;return p?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:S.zoom+1,around:S.unproject(p)},{originalEvent:i})}):_?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:S.zoom-1,around:S.unproject(_)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class rn{constructor(i){this._enabled=!!i.enable,this._moveStateManager=i.moveStateManager,this._clickTolerance=i.clickTolerance||1,this._moveFunction=i.move,this._activateOnStart=!!i.activateOnStart,i.assignEvents(this),this.reset()}reset(i){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(i)}_move(...i){const o=this._moveFunction(...i);if(o.bearingDelta||o.pitchDelta||o.around||o.panDelta)return this._active=!0,o}dragStart(i,o){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(i)&&(this._moveStateManager.startMove(i),this._lastPoint=o.length?o[0]:o,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(i,o){if(!this.isEnabled())return;const h=this._lastPoint;if(!h)return;if(i.preventDefault(),!this._moveStateManager.isValidMoveEvent(i))return void this.reset(i);const p=o.length?o[0]:o;return!this._moved&&p.dist(h)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=p,this._move(h,p))}dragEnd(i){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(i)&&(this._moved&&z.suppressClick(),this.reset(i))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Bn={0:1,2:2};class nn{constructor(i){this._correctEvent=i.checkCorrectEvent}startMove(i){const o=z.mouseButton(i);this._eventButton=o}endMove(i){delete this._eventButton}isValidStartEvent(i){return this._correctEvent(i)}isValidMoveEvent(i){return!function(o,h){const p=Bn[h];return o.buttons===void 0||(o.buttons&p)!==p}(i,this._eventButton)}isValidEndEvent(i){return z.mouseButton(i)===this._eventButton}}class Ct{constructor(){this._firstTouch=void 0}_isOneFingerTouch(i){return i.targetTouches.length===1}_isSameTouchEvent(i){return i.targetTouches[0].identifier===this._firstTouch}startMove(i){this._firstTouch=i.targetTouches[0].identifier}endMove(i){delete this._firstTouch}isValidStartEvent(i){return this._isOneFingerTouch(i)}isValidMoveEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}isValidEndEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}}const Ta=y=>{y.mousedown=y.dragStart,y.mousemoveWindow=y.dragMove,y.mouseup=y.dragEnd,y.contextmenu=function(i){i.preventDefault()}},us=({enable:y,clickTolerance:i,bearingDegreesPerPixelMoved:o=.8})=>{const h=new nn({checkCorrectEvent:p=>z.mouseButton(p)===0&&p.ctrlKey||z.mouseButton(p)===2});return new rn({clickTolerance:i,move:(p,_)=>({bearingDelta:(_.x-p.x)*o}),moveStateManager:h,enable:y,assignEvents:Ta})},Kn=({enable:y,clickTolerance:i,pitchDegreesPerPixelMoved:o=-.5})=>{const h=new nn({checkCorrectEvent:p=>z.mouseButton(p)===0&&p.ctrlKey||z.mouseButton(p)===2});return new rn({clickTolerance:i,move:(p,_)=>({pitchDelta:(_.y-p.y)*o}),moveStateManager:h,enable:y,assignEvents:Ta})};class Ul{constructor(i,o){this._clickTolerance=i.clickTolerance||1,this._map=o,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(i,o,h){return this._calculateTransform(i,o,h)}touchmove(i,o,h){if(this._active&&!(h.length<this.minTouchs()))return i.preventDefault(),this._calculateTransform(i,o,h)}touchend(i,o,h){this._calculateTransform(i,o,h),this._active&&h.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,o,h){h.length>0&&(this._active=!0);const p=Ri(h,o),_=new l.P(0,0),S=new l.P(0,0);let E=0;for(const D in p){const F=p[D],B=this._touches[D];B&&(_._add(F),S._add(F.sub(B)),E++,p[D]=F)}if(this._touches=p,E<this.minTouchs()||!S.mag())return;const C=S.div(E);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(E),panDelta:C}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vt{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(i,o,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([o[0],o[1]]))}touchmove(i,o,h){if(!this._firstTwoTouches)return;i.preventDefault();const[p,_]=this._firstTwoTouches,S=oa(h,o,p),E=oa(h,o,_);if(!S||!E)return;const C=this._aroundCenter?null:S.add(E).div(2);return this._move([S,E],C,i)}touchend(i,o,h){if(!this._firstTwoTouches)return;const[p,_]=this._firstTwoTouches,S=oa(h,o,p),E=oa(h,o,_);S&&E||(this._active&&z.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function oa(y,i,o){for(let h=0;h<y.length;h++)if(y[h].identifier===o)return i[h]}function yo(y,i){return Math.log(y/i)/Math.LN2}class _o extends vt{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,o){const h=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(yo(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:yo(this._distance,h),pinchAround:o}}}function vo(y,i){return 180*y.angleWith(i)/Math.PI}class Ha extends vt{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,o,h){const p=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:vo(this._vector,p),pinchAround:o}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const o=25/(Math.PI*this._minDiameter)*360,h=vo(i,this._startVector);return Math.abs(h)<o}}function Ca(y){return Math.abs(y.y)>Math.abs(y.x)}class rd extends vt{constructor(i){super(),this._currentTouchCount=0,this._map=i}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(i,o,h){super.touchstart(i,o,h),this._currentTouchCount=h.length}_start(i){this._lastPoints=i,Ca(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,o,h){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const p=i[0].sub(this._lastPoints[0]),_=i[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(p,_,h.timeStamp),this._valid?(this._lastPoints=i,this._active=!0,{pitchDelta:(p.y+_.y)/2*-.5}):void 0}gestureBeginsVertically(i,o,h){if(this._valid!==void 0)return this._valid;const p=i.mag()>=2,_=o.mag()>=2;if(!p&&!_)return;if(!p||!_)return this._firstMove===void 0&&(this._firstMove=h),h-this._firstMove<100&&void 0;const S=i.y>0==o.y>0;return Ca(i)&&Ca(o)&&S}}const $p={panStep:100,bearingStep:15,pitchStep:10};class Wa{constructor(i){this._tr=new Ga(i);const o=$p;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let o=0,h=0,p=0,_=0,S=0;switch(i.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:i.shiftKey?h=-1:(i.preventDefault(),_=-1);break;case 39:i.shiftKey?h=1:(i.preventDefault(),_=1);break;case 38:i.shiftKey?p=1:(i.preventDefault(),S=-1);break;case 40:i.shiftKey?p=-1:(i.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(h=0,p=0),{cameraAnimation:E=>{const C=this._tr;E.easeTo({duration:300,easeId:"keyboardHandler",easing:xr,zoom:o?Math.round(C.zoom)+o*(i.shiftKey?2:1):C.zoom,bearing:C.bearing+h*this._bearingStep,pitch:C.pitch+p*this._pitchStep,offset:[-_*this._panStep,-S*this._panStep],center:C.center},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function xr(y){return y*(2-y)}const Vl=4.000244140625;class Sc{constructor(i,o){this._onTimeout=h=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(h)},this._map=i,this._tr=new Ga(i),this._triggerRenderFrame=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(i){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!i[this._map.cooperativeGestures._bypassKey])return;let o=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const h=k.now(),p=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,o!==0&&o%Vl==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(p*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),i.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=i,this._delta-=o,this._active||this._start(i)),i.preventDefault()}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=z.mousePos(this._map.getCanvas(),i),h=this._tr;this._around=o.y>h.transform.height/2-h.transform.getHorizon()?l.M.convert(this._aroundCenter?h.center:h.unproject(o)):l.M.convert(h.center),this._aroundPoint=h.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._tr.transform;if(this._delta!==0){const E=this._type==="wheel"&&Math.abs(this._delta)>Vl?this._wheelZoomRate:this._defaultZoomRate;let C=2/(1+Math.exp(-Math.abs(this._delta*E)));this._delta<0&&C!==0&&(C=1/C);const D=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):i.scale;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(D*C))),this._type==="wheel"&&(this._startZoom=i.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const o=typeof this._targetZoom=="number"?this._targetZoom:i.zoom,h=this._startZoom,p=this._easing;let _,S=!1;if(this._type==="wheel"&&h&&p){const E=Math.min((k.now()-this._lastWheelEventTime)/200,1),C=p(E);_=l.z.number(h,o,C),E<1?this._frameId||(this._frameId=!0):S=!0}else _=o,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:_-i.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let o=l.b7;if(this._prevEase){const h=this._prevEase,p=(k.now()-h.start)/h.duration,_=h.easing(p+.01)-h.easing(p),S=.27/Math.sqrt(_*_+1e-4)*.01,E=Math.sqrt(.0729-S*S);o=l.b6(S,E,.25,1)}return this._prevEase={start:k.now(),duration:i,easing:o},o}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Cu{constructor(i,o){this._clickZoom=i,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class nd{constructor(i){this._tr=new Ga(i),this.reset()}reset(){this._active=!1}dblclick(i,o){return i.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:this._tr.zoom+(i.shiftKey?-1:1),around:this._tr.unproject(o)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sd{constructor(){this._tap=new Cs({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(i,o,h){if(!this._swipePoint)if(this._tapTime){const p=o[0],_=i.timeStamp-this._tapTime<500,S=this._tapPoint.dist(p)<30;_&&S?h.length>0&&(this._swipePoint=p,this._swipeTouch=h[0].identifier):this.reset()}else this._tap.touchstart(i,o,h)}touchmove(i,o,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const p=o[0],_=p.y-this._swipePoint.y;return this._swipePoint=p,i.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(i,o,h)}touchend(i,o,h){if(this._tapTime)this._swipePoint&&h.length===0&&this.reset();else{const p=this._tap.touchend(i,o,h);p&&(this._tapTime=i.timeStamp,this._tapPoint=p)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ad{constructor(i,o,h){this._el=i,this._mousePan=o,this._touchPan=h}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ws{constructor(i,o,h){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=o,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class jl{constructor(i,o,h,p){this._el=i,this._touchZoom=o,this._touchRotate=h,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Gt{constructor(i,o){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=i,this._options=o,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const i=this._map.getCanvasContainer();i.classList.add("maplibregl-cooperative-gestures"),this._container=z.create("div","maplibregl-cooperative-gesture-screen",i);let o=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(o=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const h=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),p=document.createElement("div");p.className="maplibregl-desktop-message",p.textContent=o,this._container.appendChild(p);const _=document.createElement("div");_.className="maplibregl-mobile-message",_.textContent=h,this._container.appendChild(_),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(z.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(i){this._onCooperativeGesture(i.touches.length===1)}wheel(i){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!i[this._bypassKey])}_onCooperativeGesture(i){this._enabled&&i&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const ei=y=>y.zoom||y.drag||y.pitch||y.rotate;class Ec extends l.k{}function ql(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class Iu{constructor(i,o){this.handleWindowEvent=p=>{this.handleEvent(p,`${p.type}Window`)},this.handleEvent=(p,_)=>{if(p.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const S=p.type==="renderFrame"?void 0:p,E={needsRenderFrame:!1},C={},D={},F=p.touches,B=F?this._getMapTouches(F):void 0,q=B?z.touchPos(this._map.getCanvas(),B):z.mousePos(this._map.getCanvas(),p);for(const{handlerName:se,handler:K,allowed:me}of this._handlers){if(!K.isEnabled())continue;let Pe;this._blockedByActive(D,me,se)?K.reset():K[_||p.type]&&(Pe=K[_||p.type](p,q,B),this.mergeHandlerResult(E,C,Pe,se,S),Pe&&Pe.needsRenderFrame&&this._triggerRenderFrame()),(Pe||K.isActive())&&(D[se]=K)}const re={};for(const se in this._previousActiveHandlers)D[se]||(re[se]=S);this._previousActiveHandlers=D,(Object.keys(re).length||ql(E))&&(this._changes.push([E,C,re]),this._triggerRenderFrame()),(Object.keys(D).length||ql(E))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:te}=E;te&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],te(this._map))},this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new mn(i),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(o);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,_,S]of this._listeners)z.addEventListener(p,_,p===document?this.handleWindowEvent:this.handleEvent,S)}destroy(){for(const[i,o,h]of this._listeners)z.removeEventListener(i,o,i===document?this.handleWindowEvent:this.handleEvent,h)}_addDefaultHandlers(i){const o=this._map,h=o.getCanvasContainer();this._add("mapEvent",new Xn(o,i));const p=o.boxZoom=new Ai(o,i);this._add("boxZoom",p),i.interactive&&i.boxZoom&&p.enable();const _=o.cooperativeGestures=new Gt(o,i.cooperativeGestures);this._add("cooperativeGestures",_),i.cooperativeGestures&&_.enable();const S=new $l(o),E=new nd(o);o.doubleClickZoom=new Cu(E,S),this._add("tapZoom",S),this._add("clickZoom",E),i.interactive&&i.doubleClickZoom&&o.doubleClickZoom.enable();const C=new sd;this._add("tapDragZoom",C);const D=o.touchPitch=new rd(o);this._add("touchPitch",D),i.interactive&&i.touchPitch&&o.touchPitch.enable(i.touchPitch);const F=us(i),B=Kn(i);o.dragRotate=new Ws(i,F,B),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",B,["mouseRotate"]),i.interactive&&i.dragRotate&&o.dragRotate.enable();const q=(({enable:Pe,clickTolerance:le})=>{const Me=new nn({checkCorrectEvent:ke=>z.mouseButton(ke)===0&&!ke.ctrlKey});return new rn({clickTolerance:le,move:(ke,Le)=>({around:Le,panDelta:Le.sub(ke)}),activateOnStart:!0,moveStateManager:Me,enable:Pe,assignEvents:Ta})})(i),re=new Ul(i,o);o.dragPan=new ad(h,q,re),this._add("mousePan",q),this._add("touchPan",re,["touchZoom","touchRotate"]),i.interactive&&i.dragPan&&o.dragPan.enable(i.dragPan);const te=new Ha,se=new _o;o.touchZoomRotate=new jl(h,se,te,C),this._add("touchRotate",te,["touchPan","touchZoom"]),this._add("touchZoom",se,["touchPan","touchRotate"]),i.interactive&&i.touchZoomRotate&&o.touchZoomRotate.enable(i.touchZoomRotate);const K=o.scrollZoom=new Sc(o,()=>this._triggerRenderFrame());this._add("scrollZoom",K,["mousePan"]),i.interactive&&i.scrollZoom&&o.scrollZoom.enable(i.scrollZoom);const me=o.keyboard=new Wa(o);this._add("keyboard",me),i.interactive&&i.keyboard&&o.keyboard.enable(),this._add("blockableMapEvent",new Ts(o))}_add(i,o,h){this._handlers.push({handlerName:i,handler:o,allowed:h}),this._handlersById[i]=o}stop(i){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ei(this._eventsInProgress)||this.isZooming()}_blockedByActive(i,o,h){for(const p in i)if(p!==h&&(!o||o.indexOf(p)<0))return!0;return!1}_getMapTouches(i){const o=[];for(const h of i)this._el.contains(h.target)&&o.push(h);return o}mergeHandlerResult(i,o,h,p,_){if(!h)return;l.e(i,h);const S={handlerName:p,originalEvent:h.originalEvent||_};h.zoomDelta!==void 0&&(o.zoom=S),h.panDelta!==void 0&&(o.drag=S),h.pitchDelta!==void 0&&(o.pitch=S),h.bearingDelta!==void 0&&(o.rotate=S)}_applyChanges(){const i={},o={},h={};for(const[p,_,S]of this._changes)p.panDelta&&(i.panDelta=(i.panDelta||new l.P(0,0))._add(p.panDelta)),p.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(i.around=p.around),p.pinchAround!==void 0&&(i.pinchAround=p.pinchAround),p.noInertia&&(i.noInertia=p.noInertia),l.e(o,_),l.e(h,S);this._updateMapTransform(i,o,h),this._changes=[]}_updateMapTransform(i,o,h){const p=this._map,_=p._getTransformForUpdate(),S=p.terrain;if(!(ql(i)||S&&this._terrainMovement))return this._fireEvents(o,h,!0);let{panDelta:E,zoomDelta:C,bearingDelta:D,pitchDelta:F,around:B,pinchAround:q}=i;q!==void 0&&(B=q),p._stop(!0),B=B||p.transform.centerPoint;const re=_.pointLocation(E?B.sub(E):B);D&&(_.bearing+=D),F&&(_.pitch+=F),C&&(_.zoom+=C),S?this._terrainMovement||!o.drag&&!o.zoom?o.drag&&this._terrainMovement?_.center=_.pointLocation(_.centerPoint.sub(E)):_.setLocationAtPoint(re,B):(this._terrainMovement=!0,this._map._elevationFreeze=!0,_.setLocationAtPoint(re,B),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,_.recalculateZoom(p.terrain)})):_.setLocationAtPoint(re,B),p._applyUpdatedTransform(_),this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(o,h,!0)}_fireEvents(i,o,h){const p=ei(this._eventsInProgress),_=ei(i),S={};for(const F in i){const{originalEvent:B}=i[F];this._eventsInProgress[F]||(S[`${F}start`]=B),this._eventsInProgress[F]=i[F]}!p&&_&&this._fireEvent("movestart",_.originalEvent);for(const F in S)this._fireEvent(F,S[F]);_&&this._fireEvent("move",_.originalEvent);for(const F in i){const{originalEvent:B}=i[F];this._fireEvent(F,B)}const E={};let C;for(const F in this._eventsInProgress){const{handlerName:B,originalEvent:q}=this._eventsInProgress[F];this._handlersById[B].isActive()||(delete this._eventsInProgress[F],C=o[B]||q,E[`${F}end`]=C)}for(const F in E)this._fireEvent(F,E[F]);const D=ei(this._eventsInProgress);if(h&&(p||_)&&!D){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=q=>q!==0&&-this._bearingSnap<q&&q<this._bearingSnap;!F||!F.essential&&k.prefersReducedMotion?(this._map.fire(new l.k("moveend",{originalEvent:C})),B(this._map.getBearing())&&this._map.resetNorth()):(B(F.bearing||this._map.getBearing())&&(F.bearing=0),F.freezeElevation=!0,this._map.easeTo(F,{originalEvent:C})),this._updatingCamera=!1}}_fireEvent(i,o){this._map.fire(new l.k(i,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{delete this._frameId,this.handleEvent(new Ec("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Yn extends l.E{constructor(i,o){super(),this._renderFrameCallback=()=>{const h=Math.min((k.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=o.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new l.M(this.transform.center.lng,this.transform.center.lat)}setCenter(i,o){return this.jumpTo({center:i},o)}panBy(i,o,h){return i=l.P.convert(i).mult(-1),this.panTo(this.transform.center,l.e({offset:i},o),h)}panTo(i,o,h){return this.easeTo(l.e({center:i},o),h)}getZoom(){return this.transform.zoom}setZoom(i,o){return this.jumpTo({zoom:i},o),this}zoomTo(i,o,h){return this.easeTo(l.e({zoom:i},o),h)}zoomIn(i,o){return this.zoomTo(this.getZoom()+1,i,o),this}zoomOut(i,o){return this.zoomTo(this.getZoom()-1,i,o),this}getBearing(){return this.transform.bearing}setBearing(i,o){return this.jumpTo({bearing:i},o),this}getPadding(){return this.transform.padding}setPadding(i,o){return this.jumpTo({padding:i},o),this}rotateTo(i,o,h){return this.easeTo(l.e({bearing:i},o),h)}resetNorth(i,o){return this.rotateTo(0,l.e({duration:1e3},i),o),this}resetNorthPitch(i,o){return this.easeTo(l.e({bearing:0,pitch:0,duration:1e3},i),o),this}snapToNorth(i,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,o):this}getPitch(){return this.transform.pitch}setPitch(i,o){return this.jumpTo({pitch:i},o),this}cameraForBounds(i,o){i=ue.convert(i);const h=o&&o.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),h,o)}_cameraForBoxAndBearing(i,o,h,p){const _={top:0,bottom:0,right:0,left:0};if(typeof(p=l.e({padding:_,offset:[0,0],maxZoom:this.transform.maxZoom},p)).padding=="number"){const ht=p.padding;p.padding={top:ht,bottom:ht,right:ht,left:ht}}p.padding=l.e(_,p.padding);const S=this.transform,E=S.padding,C=new ue(i,o),D=S.project(C.getNorthWest()),F=S.project(C.getNorthEast()),B=S.project(C.getSouthEast()),q=S.project(C.getSouthWest()),re=l.b8(-h),te=D.rotate(re),se=F.rotate(re),K=B.rotate(re),me=q.rotate(re),Pe=new l.P(Math.max(te.x,se.x,me.x,K.x),Math.max(te.y,se.y,me.y,K.y)),le=new l.P(Math.min(te.x,se.x,me.x,K.x),Math.min(te.y,se.y,me.y,K.y)),Me=Pe.sub(le),ke=(S.width-(E.left+E.right+p.padding.left+p.padding.right))/Me.x,Le=(S.height-(E.top+E.bottom+p.padding.top+p.padding.bottom))/Me.y;if(Le<0||ke<0)return void l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Oe=Math.min(S.scaleZoom(S.scale*Math.min(ke,Le)),p.maxZoom),Ke=l.P.convert(p.offset),Ze=new l.P((p.padding.left-p.padding.right)/2,(p.padding.top-p.padding.bottom)/2).rotate(l.b8(h)),ot=Ke.add(Ze).mult(S.scale/S.zoomScale(Oe));return{center:S.unproject(D.add(B).div(2).sub(ot)),zoom:Oe,bearing:h}}fitBounds(i,o,h){return this._fitInternal(this.cameraForBounds(i,o),o,h)}fitScreenCoordinates(i,o,h,p,_){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.P.convert(i)),this.transform.pointLocation(l.P.convert(o)),h,p),p,_)}_fitInternal(i,o,h){return i?(delete(o=l.e(i,o)).padding,o.linear?this.easeTo(o,h):this.flyTo(o,h)):this}jumpTo(i,o){this.stop();const h=this._getTransformForUpdate();let p=!1,_=!1,S=!1;return"zoom"in i&&h.zoom!==+i.zoom&&(p=!0,h.zoom=+i.zoom),i.center!==void 0&&(h.center=l.M.convert(i.center)),"bearing"in i&&h.bearing!==+i.bearing&&(_=!0,h.bearing=+i.bearing),"pitch"in i&&h.pitch!==+i.pitch&&(S=!0,h.pitch=+i.pitch),i.padding==null||h.isPaddingEqual(i.padding)||(h.padding=i.padding),this._applyUpdatedTransform(h),this.fire(new l.k("movestart",o)).fire(new l.k("move",o)),p&&this.fire(new l.k("zoomstart",o)).fire(new l.k("zoom",o)).fire(new l.k("zoomend",o)),_&&this.fire(new l.k("rotatestart",o)).fire(new l.k("rotate",o)).fire(new l.k("rotateend",o)),S&&this.fire(new l.k("pitchstart",o)).fire(new l.k("pitch",o)).fire(new l.k("pitchend",o)),this.fire(new l.k("moveend",o))}calculateCameraOptionsFromTo(i,o,h,p=0){const _=l.Y.fromLngLat(i,o),S=l.Y.fromLngLat(h,p),E=S.x-_.x,C=S.y-_.y,D=S.z-_.z,F=Math.hypot(E,C,D);if(F===0)throw new Error("Can't calculate camera options with same From and To");const B=Math.hypot(E,C),q=this.transform.scaleZoom(this.transform.cameraToCenterDistance/F/this.transform.tileSize),re=180*Math.atan2(E,-C)/Math.PI;let te=180*Math.acos(B/F)/Math.PI;return te=D<0?90-te:90+te,{center:S.toLngLat(),zoom:q,pitch:te,bearing:re}}easeTo(i,o){var h;this._stop(!1,i.easeId),((i=l.e({offset:[0,0],duration:500,easing:l.b7},i)).animate===!1||!i.essential&&k.prefersReducedMotion)&&(i.duration=0);const p=this._getTransformForUpdate(),_=this.getZoom(),S=this.getBearing(),E=this.getPitch(),C=this.getPadding(),D="bearing"in i?this._normalizeBearing(i.bearing,S):S,F="pitch"in i?+i.pitch:E,B="padding"in i?i.padding:p.padding,q=l.P.convert(i.offset);let re=p.centerPoint.add(q);const te=p.pointLocation(re),{center:se,zoom:K}=p.getConstrained(l.M.convert(i.center||te),(h=i.zoom)!==null&&h!==void 0?h:_);this._normalizeCenter(se);const me=p.project(te),Pe=p.project(se).sub(me),le=p.zoomScale(K-_);let Me,ke;i.around&&(Me=l.M.convert(i.around),ke=p.locationPoint(Me));const Le={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||K!==_,this._rotating=this._rotating||S!==D,this._pitching=this._pitching||F!==E,this._padding=!p.isPaddingEqual(B),this._easeId=i.easeId,this._prepareEase(o,i.noMoveStart,Le),this.terrain&&this._prepareElevation(se),this._ease(Oe=>{if(this._zooming&&(p.zoom=l.z.number(_,K,Oe)),this._rotating&&(p.bearing=l.z.number(S,D,Oe)),this._pitching&&(p.pitch=l.z.number(E,F,Oe)),this._padding&&(p.interpolatePadding(C,B,Oe),re=p.centerPoint.add(q)),this.terrain&&!i.freezeElevation&&this._updateElevation(Oe),Me)p.setLocationAtPoint(Me,ke);else{const Ke=p.zoomScale(p.zoom-_),Ze=K>_?Math.min(2,le):Math.max(.5,le),ot=Math.pow(Ze,1-Oe),ht=p.unproject(me.add(Pe.mult(Oe*ot)).mult(Ke));p.setLocationAtPoint(p.renderWorldCopies?ht.wrap():ht,re)}this._applyUpdatedTransform(p),this._fireMoveEvents(o)},Oe=>{this.terrain&&this._finalizeElevation(),this._afterEase(o,Oe)},i),this}_prepareEase(i,o,h={}){this._moving=!0,o||h.moving||this.fire(new l.k("movestart",i)),this._zooming&&!h.zooming&&this.fire(new l.k("zoomstart",i)),this._rotating&&!h.rotating&&this.fire(new l.k("rotatestart",i)),this._pitching&&!h.pitching&&this.fire(new l.k("pitchstart",i))}_prepareElevation(i){this._elevationCenter=i,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(i){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const o=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(i<1&&o!==this._elevationTarget){const h=this._elevationTarget-this._elevationStart;this._elevationStart+=i*(h-(o-(h*i+this._elevationStart))/(1-i)),this._elevationTarget=o}this.transform.elevation=l.z.number(this._elevationStart,this._elevationTarget,i)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(i){if(!this.transformCameraUpdate)return;const o=i.clone(),{center:h,zoom:p,pitch:_,bearing:S,elevation:E}=this.transformCameraUpdate(o);h&&(o.center=h),p!==void 0&&(o.zoom=p),_!==void 0&&(o.pitch=_),S!==void 0&&(o.bearing=S),E!==void 0&&(o.elevation=E),this.transform.apply(o)}_fireMoveEvents(i){this.fire(new l.k("move",i)),this._zooming&&this.fire(new l.k("zoom",i)),this._rotating&&this.fire(new l.k("rotate",i)),this._pitching&&this.fire(new l.k("pitch",i))}_afterEase(i,o){if(this._easeId&&o&&this._easeId===o)return;delete this._easeId;const h=this._zooming,p=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,h&&this.fire(new l.k("zoomend",i)),p&&this.fire(new l.k("rotateend",i)),_&&this.fire(new l.k("pitchend",i)),this.fire(new l.k("moveend",i))}flyTo(i,o){var h;if(!i.essential&&k.prefersReducedMotion){const Li=l.L(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Li,o)}this.stop(),i=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.b7},i);const p=this._getTransformForUpdate(),_=this.getZoom(),S=this.getBearing(),E=this.getPitch(),C=this.getPadding(),D="bearing"in i?this._normalizeBearing(i.bearing,S):S,F="pitch"in i?+i.pitch:E,B="padding"in i?i.padding:p.padding,q=l.P.convert(i.offset);let re=p.centerPoint.add(q);const te=p.pointLocation(re),{center:se,zoom:K}=p.getConstrained(l.M.convert(i.center||te),(h=i.zoom)!==null&&h!==void 0?h:_);this._normalizeCenter(se);const me=p.zoomScale(K-_),Pe=p.project(te),le=p.project(se).sub(Pe);let Me=i.curve;const ke=Math.max(p.width,p.height),Le=ke/me,Oe=le.mag();if("minZoom"in i){const Li=l.ac(Math.min(i.minZoom,_,K),p.minZoom,p.maxZoom),si=ke/p.zoomScale(Li-_);Me=Math.sqrt(si/Oe*2)}const Ke=Me*Me;function Ze(Li){const si=(Le*Le-ke*ke+(Li?-1:1)*Ke*Ke*Oe*Oe)/(2*(Li?Le:ke)*Ke*Oe);return Math.log(Math.sqrt(si*si+1)-si)}function ot(Li){return(Math.exp(Li)-Math.exp(-Li))/2}function ht(Li){return(Math.exp(Li)+Math.exp(-Li))/2}const di=Ze(!1);let yt=function(Li){return ht(di)/ht(di+Me*Li)},ti=function(Li){return ke*((ht(di)*(ot(si=di+Me*Li)/ht(si))-ot(di))/Ke)/Oe;var si},pi=(Ze(!0)-di)/Me;if(Math.abs(Oe)<1e-6||!isFinite(pi)){if(Math.abs(ke-Le)<1e-6)return this.easeTo(i,o);const Li=Le<ke?-1:1;pi=Math.abs(Math.log(Le/ke))/Me,ti=function(){return 0},yt=function(si){return Math.exp(Li*Me*si)}}return i.duration="duration"in i?+i.duration:1e3*pi/("screenSpeed"in i?+i.screenSpeed/Me:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0),this._zooming=!0,this._rotating=S!==D,this._pitching=F!==E,this._padding=!p.isPaddingEqual(B),this._prepareEase(o,!1),this.terrain&&this._prepareElevation(se),this._ease(Li=>{const si=Li*pi,mi=1/yt(si);p.zoom=Li===1?K:_+p.scaleZoom(mi),this._rotating&&(p.bearing=l.z.number(S,D,Li)),this._pitching&&(p.pitch=l.z.number(E,F,Li)),this._padding&&(p.interpolatePadding(C,B,Li),re=p.centerPoint.add(q)),this.terrain&&!i.freezeElevation&&this._updateElevation(Li);const bi=Li===1?se:p.unproject(Pe.add(le.mult(ti(si))).mult(mi));p.setLocationAtPoint(p.renderWorldCopies?bi.wrap():bi,re),this._applyUpdatedTransform(p),this._fireMoveEvents(o)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(o)},i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const h=this._onEaseEnd;delete this._onEaseEnd,h.call(this,o)}if(!i){const h=this.handlers;h&&h.stop(!1)}return this}_ease(i,o,h){h.animate===!1||h.duration===0?(i(1),o()):(this._easeStart=k.now(),this._easeOptions=h,this._onEaseFrame=i,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(i,o){i=l.b1(i,-180,180);const h=Math.abs(i-o);return Math.abs(i-360-o)<h&&(i-=360),Math.abs(i+360-o)<h&&(i+=360),i}_normalizeCenter(i){const o=this.transform;if(!o.renderWorldCopies||o.lngRange)return;const h=i.lng-o.center.lng;i.lng+=h>180?-360:h<-180?360:0}queryTerrainElevation(i){return this.terrain?this.terrain.getElevationForLngLatZoom(l.M.convert(i),this.transform.tileZoom)-this.transform.elevation:null}}const Au={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Zs{constructor(i=Au){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=o=>{!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"&&o.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=i}getDefaultPosition(){return"bottom-right"}onAdd(i){return this._map=i,this._compact=this.options.compact,this._container=z.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=z.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=z.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){z.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(i,o){const h=this._map._getUIString(`AttributionControl.${o}`);i.title=h,i.setAttribute("aria-label",h)}_updateAttributions(){if(!this._map.style)return;let i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map(p=>typeof p!="string"?"":p)):typeof this.options.customAttribution=="string"&&i.push(this.options.customAttribution)),this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const o=this._map.style.sourceCaches;for(const p in o){const _=o[p];if(_.used||_.usedForTerrain){const S=_.getSource();S.attribution&&i.indexOf(S.attribution)<0&&i.push(S.attribution)}}i=i.filter(p=>String(p).trim()),i.sort((p,_)=>p.length-_.length),i=i.filter((p,_)=>{for(let S=_+1;S<i.length;S++)if(i[S].indexOf(p)>=0)return!1;return!0});const h=i.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,i.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class od{constructor(i={}){this._updateCompact=()=>{const o=this._container.children;if(o.length){const h=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&h.classList.add("maplibregl-compact"):h.classList.remove("maplibregl-compact")}},this.options=i}getDefaultPosition(){return"bottom-left"}onAdd(i){this._map=i,this._compact=this.options&&this.options.compact,this._container=z.create("div","maplibregl-ctrl");const o=z.create("a","maplibregl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://maplibre.org/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){z.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Gl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const o=++this._id;return this._queue.push({callback:i,id:o,cancelled:!1}),o}remove(i){const o=this._currentlyRunning,h=o?this._queue.concat(o):this._queue;for(const p of h)if(p.id===i)return void(p.cancelled=!0)}run(i=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const o=this._currentlyRunning=this._queue;this._queue=[];for(const h of o)if(!h.cancelled&&(h.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var zr=l.X([{name:"a_pos3d",type:"Int16",components:3}]);class qr extends l.E{constructor(i){super(),this.sourceCache=i,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,i.usedForTerrain=!0,i.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(i,o){this.sourceCache.update(i,o),this._renderableTilesKeys=[];const h={};for(const p of i.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:o}))h[p.key]=!0,this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.posMatrix=new Float64Array(16),l.aN(p.posMatrix,0,l.W,0,l.W,0,1),this._tiles[p.key]=new Ni(p,this.tileSize));for(const p in this._tiles)h[p]||delete this._tiles[p]}freeRtt(i){for(const o in this._tiles){const h=this._tiles[o];(!i||h.tileID.equals(i)||h.tileID.isChildOf(i)||i.isChildOf(h.tileID))&&(h.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(i=>this.getTileByID(i))}getTileByID(i){return this._tiles[i]}getTerrainCoords(i){const o={};for(const h of this._renderableTilesKeys){const p=this._tiles[h].tileID;if(p.canonical.equals(i.canonical)){const _=i.clone();_.posMatrix=new Float64Array(16),l.aN(_.posMatrix,0,l.W,0,l.W,0,1),o[h]=_}else if(p.canonical.isChildOf(i.canonical)){const _=i.clone();_.posMatrix=new Float64Array(16);const S=p.canonical.z-i.canonical.z,E=p.canonical.x-(p.canonical.x>>S<<S),C=p.canonical.y-(p.canonical.y>>S<<S),D=l.W>>S;l.aN(_.posMatrix,0,D,0,D,0,1),l.H(_.posMatrix,_.posMatrix,[-E*D,-C*D,0]),o[h]=_}else if(i.canonical.isChildOf(p.canonical)){const _=i.clone();_.posMatrix=new Float64Array(16);const S=i.canonical.z-p.canonical.z,E=i.canonical.x-(i.canonical.x>>S<<S),C=i.canonical.y-(i.canonical.y>>S<<S),D=l.W>>S;l.aN(_.posMatrix,0,l.W,0,l.W,0,1),l.H(_.posMatrix,_.posMatrix,[E*D,C*D,0]),l.J(_.posMatrix,_.posMatrix,[1/2**S,1/2**S,0]),o[h]=_}}return o}getSourceTile(i,o){const h=this.sourceCache._source;let p=i.overscaledZ-this.deltaZoom;if(p>h.maxzoom&&(p=h.maxzoom),p<h.minzoom)return null;this._sourceTileCache[i.key]||(this._sourceTileCache[i.key]=i.scaledTo(p).key);let _=this.sourceCache.getTileByID(this._sourceTileCache[i.key]);if((!_||!_.dem)&&o)for(;p>=h.minzoom&&(!_||!_.dem);)_=this.sourceCache.getTileByID(i.scaledTo(p--).key);return _}tilesAfterTime(i=Date.now()){return Object.values(this._tiles).filter(o=>o.timeAdded>=i)}}class ld{constructor(i,o,h){this.painter=i,this.sourceCache=new qr(o),this.options=h,this.exaggeration=typeof h.exaggeration=="number"?h.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(i,o,h,p=l.W){var _;if(!(o>=0&&o<p&&h>=0&&h<p))return 0;const S=this.getTerrainData(i),E=(_=S.tile)===null||_===void 0?void 0:_.dem;if(!E)return 0;const C=function(te,se,K){var me=se[0],Pe=se[1];return te[0]=K[0]*me+K[4]*Pe+K[12],te[1]=K[1]*me+K[5]*Pe+K[13],te}([],[o/p*l.W,h/p*l.W],S.u_terrain_matrix),D=[C[0]*E.dim,C[1]*E.dim],F=Math.floor(D[0]),B=Math.floor(D[1]),q=D[0]-F,re=D[1]-B;return E.get(F,B)*(1-q)*(1-re)+E.get(F+1,B)*q*(1-re)+E.get(F,B+1)*(1-q)*re+E.get(F+1,B+1)*q*re}getElevationForLngLatZoom(i,o){const{tileID:h,mercatorX:p,mercatorY:_}=this._getOverscaledTileIDFromLngLatZoom(i,o);return this.getElevation(h,p%l.W,_%l.W,l.W)}getElevation(i,o,h,p=l.W){return this.getDEMElevation(i,o,h,p)*this.exaggeration}getTerrainData(i){if(!this._emptyDemTexture){const p=this.painter.context,_=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Lt(p,_,p.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Lt(p,new l.R({width:1,height:1}),p.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.an([])}const o=this.sourceCache.getSourceTile(i,!0);if(o&&o.dem&&(!o.demTexture||o.needsTerrainPrepare)){const p=this.painter.context;o.demTexture=this.painter.getTileTexture(o.dem.stride),o.demTexture?o.demTexture.update(o.dem.getPixels(),{premultiply:!1}):o.demTexture=new Lt(p,o.dem.getPixels(),p.gl.RGBA,{premultiply:!1}),o.demTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),o.needsTerrainPrepare=!1}const h=o&&o+o.tileID.key+i.key;if(h&&!this._demMatrixCache[h]){const p=this.sourceCache.sourceCache._source.maxzoom;let _=i.canonical.z-o.tileID.canonical.z;i.overscaledZ>i.canonical.z&&(i.canonical.z>=p?_=i.canonical.z-p:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const S=i.canonical.x-(i.canonical.x>>_<<_),E=i.canonical.y-(i.canonical.y>>_<<_),C=l.b9(new Float64Array(16),[1/(l.W<<_),1/(l.W<<_),0]);l.H(C,C,[S*l.W,E*l.W,0]),this._demMatrixCache[i.key]={matrix:C,coord:i}}return{u_depth:2,u_terrain:3,u_terrain_dim:o&&o.dem&&o.dem.dim||1,u_terrain_matrix:h?this._demMatrixCache[i.key].matrix:this._emptyDemMatrix,u_terrain_unpack:o&&o.dem&&o.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(o&&o.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:o}}getFramebuffer(i){const o=this.painter,h=o.width/devicePixelRatio,p=o.height/devicePixelRatio;return!this._fbo||this._fbo.width===h&&this._fbo.height===p||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Lt(o.context,{width:h,height:p,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Lt(o.context,{width:h,height:p,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=o.context.createFramebuffer(h,p,!0,!1),this._fbo.depthAttachment.set(o.context.createRenderbuffer(o.context.gl.DEPTH_COMPONENT16,h,p))),this._fbo.colorAttachment.set(i==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const i=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const o=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let _=0,S=0;_<this._coordsTextureSize;_++)for(let E=0;E<this._coordsTextureSize;E++,S+=4)o[S+0]=255&E,o[S+1]=255&_,o[S+2]=E>>8<<4|_>>8,o[S+3]=0;const h=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(o.buffer)),p=new Lt(i,h,i.gl.RGBA,{premultiply:!1});return p.bind(i.gl.NEAREST,i.gl.CLAMP_TO_EDGE),this._coordsTexture=p,p}pointCoordinate(i){this.painter.maybeDrawDepthAndCoords(!0);const o=new Uint8Array(4),h=this.painter.context,p=h.gl,_=Math.round(i.x*this.painter.pixelRatio/devicePixelRatio),S=Math.round(i.y*this.painter.pixelRatio/devicePixelRatio),E=Math.round(this.painter.height/devicePixelRatio);h.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),p.readPixels(_,E-S-1,1,1,p.RGBA,p.UNSIGNED_BYTE,o),h.bindFramebuffer.set(null);const C=o[0]+(o[2]>>4<<8),D=o[1]+((15&o[2])<<8),F=this.coordsIndex[255-o[3]],B=F&&this.sourceCache.getTileByID(F);if(!B)return null;const q=this._coordsTextureSize,re=(1<<B.tileID.canonical.z)*q;return new l.Y((B.tileID.canonical.x*q+C)/re+B.tileID.wrap,(B.tileID.canonical.y*q+D)/re,this.getElevation(B.tileID,C,D,q))}depthAtPoint(i){const o=new Uint8Array(4),h=this.painter.context,p=h.gl;return h.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),p.readPixels(i.x,this.painter.height/devicePixelRatio-i.y-1,1,1,p.RGBA,p.UNSIGNED_BYTE,o),h.bindFramebuffer.set(null),(o[0]/16777216+o[1]/65536+o[2]/256+o[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const i=this.painter.context,o=new l.ba,h=new l.aX,p=this.meshSize,_=l.W/p,S=p*p;for(let B=0;B<=p;B++)for(let q=0;q<=p;q++)o.emplaceBack(q*_,B*_,0);for(let B=0;B<S;B+=p+1)for(let q=0;q<p;q++)h.emplaceBack(q+B,p+q+B+1,p+q+B+2),h.emplaceBack(q+B,p+q+B+2,q+B+1);const E=o.length,C=E+2*(p+1);for(const B of[0,1])for(let q=0;q<=p;q++)for(const re of[0,1])o.emplaceBack(q*_,B*l.W,re);for(let B=0;B<2*p;B+=2)h.emplaceBack(C+B,C+B+1,C+B+3),h.emplaceBack(C+B,C+B+3,C+B+2),h.emplaceBack(E+B,E+B+3,E+B+1),h.emplaceBack(E+B,E+B+2,E+B+3);const D=o.length,F=D+2*(p+1);for(const B of[0,1])for(let q=0;q<=p;q++)for(const re of[0,1])o.emplaceBack(B*l.W,q*_,re);for(let B=0;B<2*p;B+=2)h.emplaceBack(D+B,D+B+1,D+B+3),h.emplaceBack(D+B,D+B+3,D+B+2),h.emplaceBack(F+B,F+B+3,F+B+1),h.emplaceBack(F+B,F+B+2,F+B+3);return this._mesh={indexBuffer:i.createIndexBuffer(h),vertexBuffer:i.createVertexBuffer(o,zr.members),segments:l.$.simpleSegment(0,0,o.length,h.length)},this._mesh}getMeshFrameDelta(i){return 2*Math.PI*l.bb/Math.pow(2,i)/5}getMinTileElevationForLngLatZoom(i,o){var h;const{tileID:p}=this._getOverscaledTileIDFromLngLatZoom(i,o);return(h=this.getMinMaxElevation(p).minElevation)!==null&&h!==void 0?h:0}getMinMaxElevation(i){const o=this.getTerrainData(i).tile,h={minElevation:null,maxElevation:null};return o&&o.dem&&(h.minElevation=o.dem.min*this.exaggeration,h.maxElevation=o.dem.max*this.exaggeration),h}_getOverscaledTileIDFromLngLatZoom(i,o){const h=l.Y.fromLngLat(i.wrap()),p=(1<<o)*l.W,_=h.x*p,S=h.y*p,E=Math.floor(_/l.W),C=Math.floor(S/l.W);return{tileID:new l.Q(o,0,o,E,C),mercatorX:_,mercatorY:S}}}class Hl{constructor(i,o,h){this._context=i,this._size=o,this._tileSize=h,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const i of this._objects)i.texture.destroy(),i.fbo.destroy()}_createObject(i){const o=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),h=new Lt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return h.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),o.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),o.colorAttachment.set(h.texture),{id:i,fbo:o,texture:h,stamp:-1,inUse:!1}}getObjectForId(i){return this._objects[i]}useObject(i){i.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(o=>i.id!==o),this._recentlyUsed.push(i.id)}stampObject(i){i.stamp=++this._stamp}getOrCreateFreeObject(){for(const o of this._recentlyUsed)if(!this._objects[o].inUse)return this._objects[o];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const i=this._createObject(this._objects.length);return this._objects.push(i),i}freeObject(i){i.inUse=!1}freeAllObjects(){for(const i of this._objects)this.freeObject(i)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(i=>!i.inUse)===!1}}const Ia={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Pu{constructor(i,o){this.painter=i,this.terrain=o,this.pool=new Hl(i.context,30,o.sourceCache.tileSize*o.qualityFactor)}destruct(){this.pool.destruct()}getTexture(i){return this.pool.getObjectForId(i.rtt[this._stacks.length-1].id).texture}prepareForRender(i,o){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=i._order.filter(h=>!i._layers[h].isHidden(o)),this._coordsDescendingInv={};for(const h in i.sourceCaches){this._coordsDescendingInv[h]={};const p=i.sourceCaches[h].getVisibleCoordinates();for(const _ of p){const S=this.terrain.sourceCache.getTerrainCoords(_);for(const E in S)this._coordsDescendingInv[h][E]||(this._coordsDescendingInv[h][E]=[]),this._coordsDescendingInv[h][E].push(S[E])}}this._coordsDescendingInvStr={};for(const h of i._order){const p=i._layers[h],_=p.source;if(Ia[p.type]&&!this._coordsDescendingInvStr[_]){this._coordsDescendingInvStr[_]={};for(const S in this._coordsDescendingInv[_])this._coordsDescendingInvStr[_][S]=this._coordsDescendingInv[_][S].map(E=>E.key).sort().join()}}for(const h of this._renderableTiles)for(const p in this._coordsDescendingInvStr){const _=this._coordsDescendingInvStr[p][h.tileID.key];_&&_!==h.rttCoords[p]&&(h.rtt=[])}}renderLayer(i){if(i.isHidden(this.painter.transform.zoom))return!1;const o=i.type,h=this.painter,p=this._renderableLayerIds[this._renderableLayerIds.length-1]===i.id;if(Ia[o]&&(this._prevType&&Ia[this._prevType]||this._stacks.push([]),this._prevType=o,this._stacks[this._stacks.length-1].push(i.id),!p))return!0;if(Ia[this._prevType]||Ia[o]&&p){this._prevType=o;const _=this._stacks.length-1,S=this._stacks[_]||[];for(const E of this._renderableTiles){if(this.pool.isFull()&&(tl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(E),E.rtt[_]){const D=this.pool.getObjectForId(E.rtt[_].id);if(D.stamp===E.rtt[_].stamp){this.pool.useObject(D);continue}}const C=this.pool.getOrCreateFreeObject();this.pool.useObject(C),this.pool.stampObject(C),E.rtt[_]={id:C.id,stamp:C.stamp},h.context.bindFramebuffer.set(C.fbo.framebuffer),h.context.clear({color:l.aO.transparent,stencil:0}),h.currentStencilSource=void 0;for(let D=0;D<S.length;D++){const F=h.style._layers[S[D]],B=F.source?this._coordsDescendingInv[F.source][E.tileID.key]:[E.tileID];h.context.viewport.set([0,0,C.fbo.width,C.fbo.height]),h._renderTileClippingMasks(F,B),h.renderLayer(h,h.style.sourceCaches[F.source],F,B),F.source&&(E.rttCoords[F.source]=this._coordsDescendingInvStr[F.source][E.tileID.key])}}return tl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Ia[o]}return!1}}const ku={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Du=M,Wl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Au,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Tc=y=>{y.touchstart=y.dragStart,y.touchmoveWindow=y.dragMove,y.touchend=y.dragEnd},Lu={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ru{constructor(i,o,h=!1){this.mousedown=S=>{this.startMouse(l.e({},S,{ctrlKey:!0,preventDefault:()=>S.preventDefault()}),z.mousePos(this.element,S)),z.addEventListener(window,"mousemove",this.mousemove),z.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=S=>{this.moveMouse(S,z.mousePos(this.element,S))},this.mouseup=S=>{this.mouseRotate.dragEnd(S),this.mousePitch&&this.mousePitch.dragEnd(S),this.offTemp()},this.touchstart=S=>{S.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=z.touchPos(this.element,S.targetTouches)[0],this.startTouch(S,this._startPos),z.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),z.addEventListener(window,"touchend",this.touchend))},this.touchmove=S=>{S.targetTouches.length!==1?this.reset():(this._lastPos=z.touchPos(this.element,S.targetTouches)[0],this.moveTouch(S,this._lastPos))},this.touchend=S=>{S.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const p=i.dragRotate._mouseRotate.getClickTolerance(),_=i.dragRotate._mousePitch.getClickTolerance();this.element=o,this.mouseRotate=us({clickTolerance:p,enable:!0}),this.touchRotate=(({enable:S,clickTolerance:E,bearingDegreesPerPixelMoved:C=.8})=>{const D=new Ct;return new rn({clickTolerance:E,move:(F,B)=>({bearingDelta:(B.x-F.x)*C}),moveStateManager:D,enable:S,assignEvents:Tc})})({clickTolerance:p,enable:!0}),this.map=i,h&&(this.mousePitch=Kn({clickTolerance:_,enable:!0}),this.touchPitch=(({enable:S,clickTolerance:E,pitchDegreesPerPixelMoved:C=-.5})=>{const D=new Ct;return new rn({clickTolerance:E,move:(F,B)=>({pitchDelta:(B.y-F.y)*C}),moveStateManager:D,enable:S,assignEvents:Tc})})({clickTolerance:_,enable:!0})),z.addEventListener(o,"mousedown",this.mousedown),z.addEventListener(o,"touchstart",this.touchstart,{passive:!1}),z.addEventListener(o,"touchcancel",this.reset)}startMouse(i,o){this.mouseRotate.dragStart(i,o),this.mousePitch&&this.mousePitch.dragStart(i,o),z.disableDrag()}startTouch(i,o){this.touchRotate.dragStart(i,o),this.touchPitch&&this.touchPitch.dragStart(i,o),z.disableDrag()}moveMouse(i,o){const h=this.map,{bearingDelta:p}=this.mouseRotate.dragMove(i,o)||{};if(p&&h.setBearing(h.getBearing()+p),this.mousePitch){const{pitchDelta:_}=this.mousePitch.dragMove(i,o)||{};_&&h.setPitch(h.getPitch()+_)}}moveTouch(i,o){const h=this.map,{bearingDelta:p}=this.touchRotate.dragMove(i,o)||{};if(p&&h.setBearing(h.getBearing()+p),this.touchPitch){const{pitchDelta:_}=this.touchPitch.dragMove(i,o)||{};_&&h.setPitch(h.getPitch()+_)}}off(){const i=this.element;z.removeEventListener(i,"mousedown",this.mousedown),z.removeEventListener(i,"touchstart",this.touchstart,{passive:!1}),z.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),z.removeEventListener(window,"touchend",this.touchend),z.removeEventListener(i,"touchcancel",this.reset),this.offTemp()}offTemp(){z.enableDrag(),z.removeEventListener(window,"mousemove",this.mousemove),z.removeEventListener(window,"mouseup",this.mouseup),z.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),z.removeEventListener(window,"touchend",this.touchend)}}let Aa;function Cc(y,i,o){const h=new l.M(y.lng,y.lat);if(y=new l.M(y.lng,y.lat),i){const p=new l.M(y.lng-360,y.lat),_=new l.M(y.lng+360,y.lat),S=o.locationPoint(y).distSqr(i);o.locationPoint(p).distSqr(i)<S?y=p:o.locationPoint(_).distSqr(i)<S&&(y=_)}for(;Math.abs(y.lng-o.center.lng)>180;){const p=o.locationPoint(y);if(p.x>=0&&p.y>=0&&p.x<=o.width&&p.y<=o.height)break;y.lng>o.center.lng?y.lng-=360:y.lng+=360}return y.lng!==h.lng&&o.locationPoint(y).y>o.height/2-o.getHorizon()?y:h}const Zl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ic(y,i,o){const h=y.classList;for(const p in Zl)h.remove(`maplibregl-${o}-anchor-${p}`);h.add(`maplibregl-${o}-anchor-${i}`)}class Xl extends l.E{constructor(i){if(super(),this._onKeyPress=o=>{const h=o.code,p=o.charCode||o.keyCode;h!=="Space"&&h!=="Enter"&&p!==32&&p!==13||this.togglePopup()},this._onMapClick=o=>{const h=o.originalEvent.target,p=this._element;this._popup&&(h===p||p.contains(h))&&this.togglePopup()},this._update=o=>{var h;if(!this._map)return;const p=this._map.loaded()&&!this._map.isMoving();((o==null?void 0:o.type)==="terrain"||(o==null?void 0:o.type)==="render"&&!p)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Cc(this._lngLat,this._flatPos,this._map.transform):(h=this._lngLat)===null||h===void 0?void 0:h.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let _="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?_=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(_=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S=`rotateX(${this._map.getPitch()}deg)`),o&&o.type!=="moveend"||(this._pos=this._pos.round()),z.setTransform(this._element,`${Zl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${S} ${_}`),k.frameAsync(new AbortController).then(()=>{this._updateOpacity(o&&o.type==="moveend")}).catch(()=>{})},this._onMove=o=>{if(!this._isDragging){const h=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.k("dragstart"))),this.fire(new l.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.k("dragend")),this._state="inactive"},this._addDragHandler=o=>{this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment!=="auto"?i.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(i==null?void 0:i.opacity,i==null?void 0:i.opacityWhenCovered),i&&i.element)this._element=i.element,this._offset=l.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=z.create("div"),this._element.setAttribute("aria-label","Map marker");const o=z.createNS("http://www.w3.org/2000/svg","svg"),h=41,p=27;o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height",`${h}px`),o.setAttributeNS(null,"width",`${p}px`),o.setAttributeNS(null,"viewBox",`0 0 ${p} ${h}`);const _=z.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"stroke","none"),_.setAttributeNS(null,"stroke-width","1"),_.setAttributeNS(null,"fill","none"),_.setAttributeNS(null,"fill-rule","evenodd");const S=z.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"fill-rule","nonzero");const E=z.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"transform","translate(3.0, 29.0)"),E.setAttributeNS(null,"fill","#000000");const C=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const me of C){const Pe=z.createNS("http://www.w3.org/2000/svg","ellipse");Pe.setAttributeNS(null,"opacity","0.04"),Pe.setAttributeNS(null,"cx","10.5"),Pe.setAttributeNS(null,"cy","5.80029008"),Pe.setAttributeNS(null,"rx",me.rx),Pe.setAttributeNS(null,"ry",me.ry),E.appendChild(Pe)}const D=z.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"fill",this._color);const F=z.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),D.appendChild(F);const B=z.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"opacity","0.25"),B.setAttributeNS(null,"fill","#000000");const q=z.createNS("http://www.w3.org/2000/svg","path");q.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),B.appendChild(q);const re=z.createNS("http://www.w3.org/2000/svg","g");re.setAttributeNS(null,"transform","translate(6.0, 7.0)"),re.setAttributeNS(null,"fill","#FFFFFF");const te=z.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"transform","translate(8.0, 8.0)");const se=z.createNS("http://www.w3.org/2000/svg","circle");se.setAttributeNS(null,"fill","#000000"),se.setAttributeNS(null,"opacity","0.25"),se.setAttributeNS(null,"cx","5.5"),se.setAttributeNS(null,"cy","5.5"),se.setAttributeNS(null,"r","5.4999962");const K=z.createNS("http://www.w3.org/2000/svg","circle");K.setAttributeNS(null,"fill","#FFFFFF"),K.setAttributeNS(null,"cx","5.5"),K.setAttributeNS(null,"cy","5.5"),K.setAttributeNS(null,"r","5.4999962"),te.appendChild(se),te.appendChild(K),S.appendChild(E),S.appendChild(D),S.appendChild(B),S.appendChild(re),S.appendChild(te),o.appendChild(S),o.setAttributeNS(null,"height",h*this._scale+"px"),o.setAttributeNS(null,"width",p*this._scale+"px"),this._element.appendChild(o),this._offset=l.P.convert(i&&i.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",o=>{o.preventDefault()}),this._element.addEventListener("mousedown",o=>{o.preventDefault()}),Ic(this._element,this._anchor,"marker"),i&&i.className)for(const o of i.className.split(" "))this._element.classList.add(o);this._popup=null}addTo(i){return this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._update),i.on("moveend",this._update),i.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),z.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=l.M.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const p=Math.abs(13.5)/Math.SQRT2;i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const i=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:i?(i.isOpen()?i.remove():(i.setLngLat(this._lngLat),i.addTo(this._map)),this):this}_updateOpacity(i=!1){var o,h;if(!(!((o=this._map)===null||o===void 0)&&o.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(i)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const p=this._map,_=p.terrain.depthAtPoint(this._pos),S=p.terrain.getElevationForLngLatZoom(this._lngLat,p.transform.tileZoom);if(p.transform.lngLatToCameraDepth(this._lngLat,S)-_<.006)return void(this._element.style.opacity=this._opacity);const E=-this._offset.y/p.transform._pixelPerMeter,C=Math.sin(p.getPitch()*Math.PI/180)*E,D=p.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),F=p.transform.lngLatToCameraDepth(this._lngLat,S+C)-D>.006;!((h=this._popup)===null||h===void 0)&&h.isOpen()&&F&&this._popup.remove(),this._element.style.opacity=F?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(i){return this._offset=l.P.convert(i),this._update(),this}addClassName(i){this._element.classList.add(i)}removeClassName(i){this._element.classList.remove(i)}toggleClassName(i){return this._element.classList.toggle(i)}setDraggable(i){return this._draggable=!!i,this._map&&(i?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i&&i!=="auto"?i:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(i,o){return i===void 0&&o===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),i!==void 0&&(this._opacity=i),o!==void 0&&(this._opacityWhenCovered=o),this._map&&this._updateOpacity(!0),this}}const Ac={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let rl=0,xo=!1;const Pc={maxWidth:100,unit:"metric"};function kc(y,i,o){const h=o&&o.maxWidth||100,p=y._container.clientHeight/2,_=y.unproject([0,p]),S=y.unproject([h,p]),E=_.distanceTo(S);if(o&&o.unit==="imperial"){const C=3.2808*E;C>5280?bo(i,h,C/5280,y._getUIString("ScaleControl.Miles")):bo(i,h,C,y._getUIString("ScaleControl.Feet"))}else o&&o.unit==="nautical"?bo(i,h,E/1852,y._getUIString("ScaleControl.NauticalMiles")):E>=1e3?bo(i,h,E/1e3,y._getUIString("ScaleControl.Kilometers")):bo(i,h,E,y._getUIString("ScaleControl.Meters"))}function bo(y,i,o,h){const p=function(_){const S=Math.pow(10,`${Math.floor(_)}`.length-1);let E=_/S;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:function(C){const D=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*D)/D}(E),S*E}(o);y.style.width=i*(p/o)+"px",y.innerHTML=`${p}&nbsp;${h}`}const zu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Ou=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Dc(y){if(y){if(typeof y=="number"){const i=Math.round(Math.abs(y)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,y),"top-left":new l.P(i,i),"top-right":new l.P(-i,i),bottom:new l.P(0,-y),"bottom-left":new l.P(i,-i),"bottom-right":new l.P(-i,-i),left:new l.P(y,0),right:new l.P(-y,0)}}if(y instanceof l.P||Array.isArray(y)){const i=l.P.convert(y);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:l.P.convert(y.center||[0,0]),top:l.P.convert(y.top||[0,0]),"top-left":l.P.convert(y["top-left"]||[0,0]),"top-right":l.P.convert(y["top-right"]||[0,0]),bottom:l.P.convert(y.bottom||[0,0]),"bottom-left":l.P.convert(y["bottom-left"]||[0,0]),"bottom-right":l.P.convert(y["bottom-right"]||[0,0]),left:l.P.convert(y.left||[0,0]),right:l.P.convert(y.right||[0,0])}}return Dc(new l.P(0,0))}const cd=M;m.AJAXError=l.be,m.Evented=l.E,m.LngLat=l.M,m.MercatorCoordinate=l.Y,m.Point=l.P,m.addProtocol=l.bf,m.config=l.a,m.removeProtocol=l.bg,m.AttributionControl=Zs,m.BoxZoomHandler=Ai,m.CanvasSource=Dt,m.CooperativeGesturesHandler=Gt,m.DoubleClickZoomHandler=Cu,m.DragPanHandler=ad,m.DragRotateHandler=Ws,m.EdgeInsets=Xt,m.FullscreenControl=class extends l.E{constructor(y={}){super(),this._onFullscreenChange=()=>{var i;let o=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((i=o==null?void 0:o.shadowRoot)===null||i===void 0)&&i.fullscreenElement;)o=o.shadowRoot.fullscreenElement;o===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){z.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const y=this._fullscreenButton=z.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);z.create("span","maplibregl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},m.GeoJSONSource=Pt,m.GeolocateControl=class extends l.E{constructor(y){super(),this._onSuccess=i=>{if(this._map){if(this._isOutOfMapMaxBounds(i))return this._setErrorState(),this.fire(new l.k("outofmaxbounds",i)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=i,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(i),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(i),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.k("geolocate",i)),this._finish()}},this._updateCamera=i=>{const o=new l.M(i.coords.longitude,i.coords.latitude),h=i.coords.accuracy,p=this._map.getBearing(),_=l.e({bearing:p},this.options.fitBoundsOptions),S=ue.fromLngLat(o,h);this._map.fitBounds(S,_,{geolocateSource:!0})},this._updateMarker=i=>{if(i){const o=new l.M(i.coords.longitude,i.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=i.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=i=>{if(this._map){if(this.options.trackUserLocation)if(i.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(i.code===3&&xo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.k("error",i)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=i=>{if(this._map){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=z.create("button","maplibregl-ctrl-geolocate",this._container),z.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",i===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=z.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Xl({element:this._dotElement}),this._circleElement=z.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Xl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.k("trackuserlocationend")))})}},this.options=l.e({},Ac,y)}onAdd(y){return this._map=y,this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return l._(this,arguments,void 0,function*(i=!1){if(Aa!==void 0&&!i)return Aa;if(window.navigator.permissions===void 0)return Aa=!!window.navigator.geolocation,Aa;try{Aa=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Aa=!!window.navigator.geolocation}return Aa})}().then(i=>this._setupUI(i)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),z.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,rl=0,xo=!1}_isOutOfMapMaxBounds(y){const i=this._map.getMaxBounds(),o=y.coords;return i&&(o.longitude<i.getWest()||o.longitude>i.getEast()||o.latitude<i.getSouth()||o.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const y=this._map.getBounds(),i=y.getSouthEast(),o=y.getNorthEast(),h=i.distanceTo(o),p=Math.ceil(this._accuracy/(h/this._map._container.clientHeight)*2);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":rl--,xo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),rl++,rl>1?(y={maximumAge:6e5,timeout:0},xo=!0):(y=this.options.positionOptions,xo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},m.Hash=Cr,m.ImageSource=st,m.KeyboardHandler=Wa,m.LngLatBounds=ue,m.LogoControl=od,m.Map=class extends Yn{constructor(y){if(l.bc.mark(l.bd.create),(y=l.e({},Wl,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Ci(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies),{bearingSnap:y.bearingSnap}),this._contextLost=i=>{i.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new l.k("webglcontextlost",{originalEvent:i}))},this._contextRestored=i=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.k("webglcontextrestored",{originalEvent:i}))},this._onMapScroll=i=>{if(i.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=y.interactive,this._maxTileCacheSize=y.maxTileCacheSize,this._maxTileCacheZoomLevels=y.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._crossSourceCollisions=y.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=y.collectResourceTiming,this._renderTaskQueue=new Gl,this._controls=[],this._mapId=l.a3(),this._locale=l.e({},ku,y.locale),this._clickTolerance=y.clickTolerance,this._overridePixelRatio=y.pixelRatio,this._maxCanvasSize=y.maxCanvasSize,this.transformCameraUpdate=y.transformCameraUpdate,this._imageQueueHandle=ee.addThrottleControl(()=>this.isMoving()),this._requestManager=new Ie(y.transformRequest),typeof y.container=="string"){if(this._container=document.getElementById(y.container),!this._container)throw new Error(`Container '${y.container}' not found.`)}else{if(!(y.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(y.maxBounds&&this.setMaxBounds(y.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let i=!1;const o=gr(h=>{this._trackResize&&!this._removed&&this.resize(h)._update()},50);this._resizeObserver=new ResizeObserver(h=>{i?o(h):i=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Iu(this,y),this._hash=y.hash&&new Cr(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,l.e({},y.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=y.localIdeographFontFamily,this._validateStyle=y.validateStyle,y.style&&this.setStyle(y.style,{localIdeographFontFamily:y.localIdeographFontFamily}),y.attributionControl&&this.addControl(new Zs(typeof y.attributionControl=="boolean"?void 0:y.attributionControl)),y.maplibreLogo&&this.addControl(new od,y.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update(i.dataType==="style"),this.fire(new l.k(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new l.k(`${i.dataType}dataloading`,i))}),this.on("dataabort",i=>{this.fire(new l.k("sourcedataabort",i))})}_getMapId(){return this._mapId}addControl(y,i){if(i===void 0&&(i=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new l.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=y.onAdd(this);this._controls.push(y);const h=this._controlPositions[i];return i.indexOf("bottom")!==-1?h.insertBefore(o,h.firstChild):h.appendChild(o),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new l.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(y);return i>-1&&this._controls.splice(i,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}calculateCameraOptionsFromTo(y,i,o,h){return h==null&&this.terrain&&(h=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(y,i,o,h)}resize(y){var i;const o=this._containerDimensions(),h=o[0],p=o[1],_=this._getClampedPixelRatio(h,p);if(this._resizeCanvas(h,p,_),this.painter.resize(h,p,_),this.painter.overLimit()){const E=this.painter.context.gl;this._maxCanvasSize=[E.drawingBufferWidth,E.drawingBufferHeight];const C=this._getClampedPixelRatio(h,p);this._resizeCanvas(h,p,C),this.painter.resize(h,p,C)}this.transform.resize(h,p),(i=this._requestedCameraState)===null||i===void 0||i.resize(h,p);const S=!this._moving;return S&&(this.stop(),this.fire(new l.k("movestart",y)).fire(new l.k("move",y))),this.fire(new l.k("resize",y)),S&&this.fire(new l.k("moveend",y)),this}_getClampedPixelRatio(y,i){const{0:o,1:h}=this._maxCanvasSize,p=this.getPixelRatio(),_=y*p,S=i*p;return Math.min(_>o?o/_:1,S>h?h/S:1)*p}getPixelRatio(){var y;return(y=this._overridePixelRatio)!==null&&y!==void 0?y:devicePixelRatio}setPixelRatio(y){this._overridePixelRatio=y,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(y){return this.transform.setMaxBounds(ue.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y&&this.setZoom(y),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y&&this.setZoom(y),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this._update()}project(y){return this.transform.locationPoint(l.M.convert(y),this.style&&this.terrain)}unproject(y){return this.transform.pointLocation(l.P.convert(y),this.terrain)}isMoving(){var y;return this._moving||((y=this.handlers)===null||y===void 0?void 0:y.isMoving())}isZooming(){var y;return this._zooming||((y=this.handlers)===null||y===void 0?void 0:y.isZooming())}isRotating(){var y;return this._rotating||((y=this.handlers)===null||y===void 0?void 0:y.isRotating())}_createDelegatedListener(y,i,o){if(y==="mouseenter"||y==="mouseover"){let h=!1;return{layer:i,listener:o,delegates:{mousemove:_=>{const S=this.getLayer(i)?this.queryRenderedFeatures(_.point,{layers:[i]}):[];S.length?h||(h=!0,o.call(this,new tn(y,this,_.originalEvent,{features:S}))):h=!1},mouseout:()=>{h=!1}}}}if(y==="mouseleave"||y==="mouseout"){let h=!1;return{layer:i,listener:o,delegates:{mousemove:S=>{(this.getLayer(i)?this.queryRenderedFeatures(S.point,{layers:[i]}):[]).length?h=!0:h&&(h=!1,o.call(this,new tn(y,this,S.originalEvent)))},mouseout:S=>{h&&(h=!1,o.call(this,new tn(y,this,S.originalEvent)))}}}}{const h=p=>{const _=this.getLayer(i)?this.queryRenderedFeatures(p.point,{layers:[i]}):[];_.length&&(p.features=_,o.call(this,p),delete p.features)};return{layer:i,listener:o,delegates:{[y]:h}}}}on(y,i,o){if(o===void 0)return super.on(y,i);const h=this._createDelegatedListener(y,i,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(h);for(const p in h.delegates)this.on(p,h.delegates[p]);return this}once(y,i,o){if(o===void 0)return super.once(y,i);const h=this._createDelegatedListener(y,i,o);for(const p in h.delegates)this.once(p,h.delegates[p]);return this}off(y,i,o){return o===void 0?super.off(y,i):(this._delegatedListeners&&this._delegatedListeners[y]&&(h=>{const p=this._delegatedListeners[y];for(let _=0;_<p.length;_++){const S=p[_];if(S.layer===i&&S.listener===o){for(const E in S.delegates)this.off(E,S.delegates[E]);return p.splice(_,1),this}}})(),this)}queryRenderedFeatures(y,i){if(!this.style)return[];let o;const h=y instanceof l.P||Array.isArray(y),p=h?y:[[0,0],[this.transform.width,this.transform.height]];if(i=i||(h?{}:y)||{},p instanceof l.P||typeof p[0]=="number")o=[l.P.convert(p)];else{const _=l.P.convert(p[0]),S=l.P.convert(p[1]);o=[_,new l.P(S.x,_.y),S,new l.P(_.x,S.y),_]}return this.style.queryRenderedFeatures(o,i,this.transform)}querySourceFeatures(y,i){return this.style.querySourceFeatures(y,i)}setStyle(y,i){return(i=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},i)).diff!==!1&&i.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._updateStyle(y,i))}setTransformRequest(y){return this._requestManager.setTransformRequest(y),this}_getUIString(y){const i=this._locale[y];if(i==null)throw new Error(`Missing UI string '${y}'`);return i}_updateStyle(y,i){if(i.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(y,i));const o=this.style&&i.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!y)),y?(this.style=new Sn(this,i||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y,i,o):this.style.loadJSON(y,i,o),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Sn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,i){if(typeof y=="string"){const o=this._requestManager.transformRequest(y,"Style");l.h(o,new AbortController).then(h=>{this._updateDiff(h.data,i)}).catch(h=>{h&&this.fire(new l.j(h))})}else typeof y=="object"&&this._updateDiff(y,i)}_updateDiff(y,i){try{this.style.setState(y,i)&&this._update(!0)}catch(o){l.w(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(y,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(y,i){return this._lazyInitEmptyStyle(),this.style.addSource(y,i),this._update(!0)}isSourceLoaded(y){const i=this.style&&this.style.sourceCaches[y];if(i!==void 0)return i.loaded();this.fire(new l.j(new Error(`There is no source with ID '${y}'`)))}setTerrain(y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),y){const i=this.style.sourceCaches[y.source];if(!i)throw new Error(`cannot load terrain, because there exists no source with ID: ${y.source}`);this.terrain===null&&i.reload();for(const o in this.style._layers){const h=this.style._layers[o];h.type==="hillshade"&&h.source===y.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new ld(this.painter,i,y),this.painter.renderToTexture=new Pu(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=o=>{o.dataType==="style"?this.terrain.sourceCache.freeRtt():o.dataType==="source"&&o.tile&&(o.sourceId!==y.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(o.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new l.k("terrain",{terrain:y})),this}getTerrain(){var y,i;return(i=(y=this.terrain)===null||y===void 0?void 0:y.options)!==null&&i!==void 0?i:null}areTilesLoaded(){const y=this.style&&this.style.sourceCaches;for(const i in y){const o=y[i]._tiles;for(const h in o){const p=o[h];if(p.state!=="loaded"&&p.state!=="errored")return!1}}return!0}removeSource(y){return this.style.removeSource(y),this._update(!0)}getSource(y){return this.style.getSource(y)}addImage(y,i,o={}){const{pixelRatio:h=1,sdf:p=!1,stretchX:_,stretchY:S,content:E}=o;if(this._lazyInitEmptyStyle(),!(i instanceof HTMLImageElement||l.b(i))){if(i.width===void 0||i.height===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:C,height:D,data:F}=i,B=i;return this.style.addImage(y,{data:new l.R({width:C,height:D},new Uint8Array(F)),pixelRatio:h,stretchX:_,stretchY:S,content:E,sdf:p,version:0,userImage:B}),B.onAdd&&B.onAdd(this,y),this}}{const{width:C,height:D,data:F}=k.getImageData(i);this.style.addImage(y,{data:new l.R({width:C,height:D},F),pixelRatio:h,stretchX:_,stretchY:S,content:E,sdf:p,version:0})}}updateImage(y,i){const o=this.style.getImage(y);if(!o)return this.fire(new l.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const h=i instanceof HTMLImageElement||l.b(i)?k.getImageData(i):i,{width:p,height:_,data:S}=h;if(p===void 0||_===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==o.data.width||_!==o.data.height)return this.fire(new l.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const E=!(i instanceof HTMLImageElement||l.b(i));return o.data.replace(S,E),this.style.updateImage(y,o),this}getImage(y){return this.style.getImage(y)}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new l.j(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y){return ee.getImage(this._requestManager.transformRequest(y,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(y,i){return this._lazyInitEmptyStyle(),this.style.addLayer(y,i),this._update(!0)}moveLayer(y,i){return this.style.moveLayer(y,i),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(y,i,o){return this.style.setLayerZoomRange(y,i,o),this._update(!0)}setFilter(y,i,o={}){return this.style.setFilter(y,i,o),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,i,o,h={}){return this.style.setPaintProperty(y,i,o,h),this._update(!0)}getPaintProperty(y,i){return this.style.getPaintProperty(y,i)}setLayoutProperty(y,i,o,h={}){return this.style.setLayoutProperty(y,i,o,h),this._update(!0)}getLayoutProperty(y,i){return this.style.getLayoutProperty(y,i)}setGlyphs(y,i={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(y,i),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(y,i,o={}){return this._lazyInitEmptyStyle(),this.style.addSprite(y,i,o,h=>{h||this._update(!0)}),this}removeSprite(y){return this._lazyInitEmptyStyle(),this.style.removeSprite(y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(y,i={}){return this._lazyInitEmptyStyle(),this.style.setSprite(y,i,o=>{o||this._update(!0)}),this}setLight(y,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,i),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(y,i){return this.style.setFeatureState(y,i),this._update()}removeFeatureState(y,i){return this.style.removeFeatureState(y,i),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let y=0,i=0;return this._container&&(y=this._container.clientWidth||400,i=this._container.clientHeight||300),[y,i]}_setupContainer(){const y=this._container;y.classList.add("maplibregl-map");const i=this._canvasContainer=z.create("div","maplibregl-canvas-container",y);this._interactive&&i.classList.add("maplibregl-interactive"),this._canvas=z.create("canvas","maplibregl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const o=this._containerDimensions(),h=this._getClampedPixelRatio(o[0],o[1]);this._resizeCanvas(o[0],o[1],h);const p=this._controlContainer=z.create("div","maplibregl-control-container",y),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(S=>{_[S]=z.create("div",`maplibregl-ctrl-${S} `,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,i,o){this._canvas.width=Math.floor(o*y),this._canvas.height=Math.floor(o*i),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${i}px`}_setupPainter(){const y={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let i=null;this._canvas.addEventListener("webglcontextcreationerror",h=>{i={requestedAttributes:y},h&&(i.statusMessage=h.statusMessage,i.type=h.type)},{once:!0});const o=this._canvas.getContext("webgl2",y)||this._canvas.getContext("webgl",y);if(!o){const h="Failed to initialize WebGL";throw i?(i.message=h,new Error(JSON.stringify(i))):new Error(h)}this.painter=new Te(o,this.transform),W.testSupport(o)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_render(y){const i=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),this._removed)return;let o=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const p=this.transform.zoom,_=k.now();this.style.zoomHistory.update(p,_);const S=new l.a8(p,{now:_,fadeDuration:i,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),E=S.crossFadingFactor();E===1&&E===this._crossFadingFactor||(o=!0,this._crossFadingFactor=E),this.style.update(S)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,i,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:i,showPadding:this.showPadding}),this.fire(new l.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.bc.mark(l.bd.load),this.fire(new l.k("load"))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const h=this._sourcesDirty||this._styleDirty||this._placementDirty;return h||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.k("idle")),!this._loaded||this._fullyLoaded||h||(this._fullyLoaded=!0,l.bc.mark(l.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var y;this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ee.removeThrottleControl(this._imageQueueHandle),(y=this._resizeObserver)===null||y===void 0||y.disconnect();const i=this.painter.context.gl.getExtension("WEBGL_lose_context");i&&i.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),z.remove(this._canvasContainer),z.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),l.bc.clearMetrics(),this._removed=!0,this.fire(new l.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,k.frameAsync(this._frameRequest).then(y=>{l.bc.frame(y),this._frameRequest=null,this._render(y)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get version(){return Du}getCameraTargetElevation(){return this.transform.elevation}},m.MapMouseEvent=tn,m.MapTouchEvent=Cn,m.MapWheelEvent=Ea,m.Marker=Xl,m.NavigationControl=class{constructor(y){this._updateZoomButtons=()=>{const i=this._map.getZoom(),o=i===this._map.getMaxZoom(),h=i===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())},this._rotateCompassArrow=()=>{const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=i},this._setButtonTitle=(i,o)=>{const h=this._map._getUIString(`NavigationControl.${o}`);i.title=h,i.setAttribute("aria-label",h)},this.options=l.e({},Lu,y),this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",i=>this._map.zoomIn({},{originalEvent:i})),z.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",i=>this._map.zoomOut({},{originalEvent:i})),z.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",i=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:i}):this._map.resetNorth({},{originalEvent:i})}),this._compassIcon=z.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ru(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){z.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(y,i){const o=z.create("button",y,this._container);return o.type="button",o.addEventListener("click",i),o}},m.Popup=class extends l.E{constructor(y){super(),this.remove=()=>(this._content&&z.remove(this._content),this._container&&(z.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.k("close"))),this),this._onMouseUp=i=>{this._update(i.point)},this._onMouseMove=i=>{this._update(i.point)},this._onDrag=i=>{this._update(i.point)},this._update=i=>{var o;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=z.create("div","maplibregl-popup",this._map.getContainer()),this._tip=z.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const E of this.options.className.split(" "))this._container.classList.add(E);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Cc(this._lngLat,this._flatPos,this._map.transform):(o=this._lngLat)===null||o===void 0?void 0:o.wrap(),this._trackPointer&&!i)return;const h=this._flatPos=this._pos=this._trackPointer&&i?i:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&i?i:this._map.transform.locationPoint(this._lngLat));let p=this.options.anchor;const _=Dc(this.options.offset);if(!p){const E=this._container.offsetWidth,C=this._container.offsetHeight;let D;D=h.y+_.bottom.y<C?["top"]:h.y>this._map.transform.height-C?["bottom"]:[],h.x<E/2?D.push("left"):h.x>this._map.transform.width-E/2&&D.push("right"),p=D.length===0?"bottom":D.join("-")}let S=h.add(_[p]);this.options.subpixelPositioning||(S=S.round()),z.setTransform(this._container,`${Zl[p]} translate(${S.x}px,${S.y}px)`),Ic(this._container,p,"popup")},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(zu),y)}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=l.M.convert(y),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const i=document.createDocumentFragment(),o=document.createElement("body");let h;for(o.innerHTML=y;h=o.firstChild,h;)i.appendChild(h);return this.setDOMContent(i)}getMaxWidth(){var y;return(y=this._container)===null||y===void 0?void 0:y.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=z.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(y){this._container&&this._container.classList.add(y)}removeClassName(y){this._container&&this._container.classList.remove(y)}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){if(this._container)return this._container.classList.toggle(y)}setSubpixelPositioning(y){this.options.subpixelPositioning=y}_createCloseButton(){this.options.closeButton&&(this._closeButton=z.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(Ou);y&&y.focus()}},m.RasterDEMTileSource=dt,m.RasterTileSource=ce,m.ScaleControl=class{constructor(y){this._onMove=()=>{kc(this._map,this._container,this.options)},this.setUnit=i=>{this.options.unit=i,kc(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Pc),y)}getDefaultPosition(){return"bottom-left"}onAdd(y){return this._map=y,this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){z.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},m.ScrollZoomHandler=Sc,m.Style=Sn,m.TerrainControl=class{constructor(y){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=y}onAdd(y){return this._map=y,this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=z.create("button","maplibregl-ctrl-terrain",this._container),z.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){z.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},m.TwoFingersTouchPitchHandler=rd,m.TwoFingersTouchRotateHandler=Ha,m.TwoFingersTouchZoomHandler=_o,m.TwoFingersTouchZoomRotateHandler=jl,m.VectorTileSource=Fe,m.VideoSource=rt,m.addSourceType=(y,i)=>l._(void 0,void 0,void 0,function*(){if(Zt(y))throw new Error(`A source type called "${y}" already exists.`);((o,h)=>{Kt[o]=h})(y,i)}),m.clearPrewarmedResources=function(){const y=ji;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(it),ji=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},m.getMaxParallelImageRequests=function(){return l.a.MAX_PARALLEL_IMAGE_REQUESTS},m.getRTLTextPluginStatus=function(){return Ve().getRTLTextPluginStatus()},m.getVersion=function(){return cd},m.getWorkerCount=function(){return Qe.workerCount},m.getWorkerUrl=function(){return l.a.WORKER_URL},m.importScriptInWorkers=function(y){return ut().broadcast("IS",y)},m.prewarm=function(){je().acquire(it)},m.setMaxParallelImageRequests=function(y){l.a.MAX_PARALLEL_IMAGE_REQUESTS=y},m.setRTLTextPlugin=function(y,i){return Ve().setRTLTextPlugin(y,i)},m.setWorkerCount=function(y){Qe.workerCount=y},m.setWorkerUrl=function(y){l.a.WORKER_URL=y}});var g=a;return g})})(a1);var RR=a1.exports;const Yf=ig(RR);var l1={exports:{}};(function(e,r){(function(a,u){e.exports=u()})(Kc,function(){var a=function(b,P){var V={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},oe={on:function(_e,Ee,Je){if(V[_e]===void 0)throw new Error("Invalid event type: "+_e);V[_e].push({selector:Ee,fn:Je})},render:function(_e){P.store.featureChanged(_e)}},ge=function(_e,Ee){for(var Je=V[_e],lt=Je.length;lt--;){var Mt=Je[lt];if(Mt.selector(Ee)){Mt.fn.call(oe,Ee)||P.store.render(),P.ui.updateMapClasses();break}}};return b.start.call(oe),{render:b.render,stop:function(){b.stop&&b.stop()},trash:function(){b.trash&&(b.trash(),P.store.render())},combineFeatures:function(){b.combineFeatures&&b.combineFeatures()},uncombineFeatures:function(){b.uncombineFeatures&&b.uncombineFeatures()},drag:function(_e){ge("drag",_e)},click:function(_e){ge("click",_e)},mousemove:function(_e){ge("mousemove",_e)},mousedown:function(_e){ge("mousedown",_e)},mouseup:function(_e){ge("mouseup",_e)},mouseout:function(_e){ge("mouseout",_e)},keydown:function(_e){ge("keydown",_e)},keyup:function(_e){ge("keyup",_e)},touchstart:function(_e){ge("touchstart",_e)},touchmove:function(_e){ge("touchmove",_e)},touchend:function(_e){ge("touchend",_e)},tap:function(_e){ge("tap",_e)}}};function u(b){return b&&b.__esModule&&Object.prototype.hasOwnProperty.call(b,"default")?b.default:b}function d(b){if(b.__esModule)return b;var P=b.default;if(typeof P=="function"){var V=function oe(){if(this instanceof oe){var ge=[null];ge.push.apply(ge,arguments);var _e=Function.bind.apply(P,ge);return new _e}return P.apply(this,arguments)};V.prototype=P.prototype}else V={};return Object.defineProperty(V,"__esModule",{value:!0}),Object.keys(b).forEach(function(oe){var ge=Object.getOwnPropertyDescriptor(b,oe);Object.defineProperty(V,oe,ge.get?ge:{enumerable:!0,get:function(){return b[oe]}})}),V}var g={},m={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:63567523142e-4},l=m;function M(b){var P=0;if(b&&b.length>0){P+=Math.abs(A(b[0]));for(var V=1;V<b.length;V++)P-=Math.abs(A(b[V]))}return P}function A(b){var P,V,oe,ge,_e,Ee,Je=0,lt=b.length;if(lt>2){for(Ee=0;Ee<lt;Ee++)Ee===lt-2?(oe=lt-2,ge=lt-1,_e=0):Ee===lt-1?(oe=lt-1,ge=0,_e=1):(oe=Ee,ge=Ee+1,_e=Ee+2),P=b[oe],V=b[ge],Je+=(R(b[_e][0])-R(P[0]))*Math.sin(R(V[1]));Je=Je*l.RADIUS*l.RADIUS/2}return Je}function R(b){return b*Math.PI/180}g.geometry=function b(P){var V,oe=0;switch(P.type){case"Polygon":return M(P.coordinates);case"MultiPolygon":for(V=0;V<P.coordinates.length;V++)oe+=M(P.coordinates[V]);return oe;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(V=0;V<P.geometries.length;V++)oe+=b(P.geometries[V]);return oe}},g.ring=A;var k={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},z={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},W={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},Z={POLYGON:"polygon",LINE:"line_string",POINT:"point"},X={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},fe={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},ye={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},we={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},ee={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},Ie={ACTIVE:"true",INACTIVE:"false"},Ue=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],Xe=-85,nt=Object.freeze({__proto__:null,classes:k,sources:z,cursors:W,types:Z,geojsonTypes:X,modes:fe,events:ye,updateActions:we,meta:ee,activeStates:Ie,interactions:Ue,LAT_MIN:-90,LAT_RENDERED_MIN:Xe,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),ft={Point:0,LineString:1,MultiLineString:1,Polygon:2};function At(b,P){var V=ft[b.geometry.type]-ft[P.geometry.type];return V===0&&b.geometry.type===X.POLYGON?b.area-P.area:V}function Ot(b){return b.map(function(P){return P.geometry.type===X.POLYGON&&(P.area=g.geometry({type:X.FEATURE,property:{},geometry:P.geometry})),P}).sort(At).map(function(P){return delete P.area,P})}function Lt(b,P){return P===void 0&&(P=0),[[b.point.x-P,b.point.y-P],[b.point.x+P,b.point.y+P]]}function li(b){if(this._items={},this._nums={},this._length=b?b.length:0,b)for(var P=0,V=b.length;P<V;P++)this.add(b[P]),b[P]!==void 0&&(typeof b[P]=="string"?this._items[b[P]]=P:this._nums[b[P]]=P)}li.prototype.add=function(b){return this.has(b)||(this._length++,typeof b=="string"?this._items[b]=this._length:this._nums[b]=this._length),this},li.prototype.delete=function(b){return this.has(b)===!1||(this._length--,delete this._items[b],delete this._nums[b]),this},li.prototype.has=function(b){return(typeof b=="string"||typeof b=="number")&&(this._items[b]!==void 0||this._nums[b]!==void 0)},li.prototype.values=function(){var b=this,P=[];return Object.keys(this._items).forEach(function(V){P.push({k:V,v:b._items[V]})}),Object.keys(this._nums).forEach(function(V){P.push({k:JSON.parse(V),v:b._nums[V]})}),P.sort(function(V,oe){return V.v-oe.v}).map(function(V){return V.k})},li.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var Ei=[ee.FEATURE,ee.MIDPOINT,ee.VERTEX],ci={click:function(b,P,V){return xt(b,P,V,V.options.clickBuffer)},touch:function(b,P,V){return xt(b,P,V,V.options.touchBuffer)}};function xt(b,P,V,oe){if(V.map===null)return[];var ge=b?Lt(b,oe):P,_e={};V.options.styles&&(_e.layers=V.options.styles.map(function(Mt){return Mt.id}).filter(function(Mt){return V.map.getLayer(Mt)!=null}));var Ee=V.map.queryRenderedFeatures(ge,_e).filter(function(Mt){return Ei.indexOf(Mt.properties.meta)!==-1}),Je=new li,lt=[];return Ee.forEach(function(Mt){var St=Mt.properties.id;Je.has(St)||(Je.add(St),lt.push(Mt))}),Ot(lt)}function kt(b,P){var V=ci.click(b,null,P),oe={mouse:W.NONE};return V[0]&&(oe.mouse=V[0].properties.active===Ie.ACTIVE?W.MOVE:W.POINTER,oe.feature=V[0].properties.meta),P.events.currentModeName().indexOf("draw")!==-1&&(oe.mouse=W.ADD),P.ui.queueMapClasses(oe),P.ui.updateMapClasses(),V[0]}function $t(b,P){var V=b.x-P.x,oe=b.y-P.y;return Math.sqrt(V*V+oe*oe)}function ai(b,P,V){V===void 0&&(V={});var oe=V.fineTolerance!=null?V.fineTolerance:4,ge=V.grossTolerance!=null?V.grossTolerance:12,_e=V.interval!=null?V.interval:500;b.point=b.point||P.point,b.time=b.time||P.time;var Ee=$t(b.point,P.point);return Ee<oe||Ee<ge&&P.time-b.time<_e}function Zi(b,P,V){V===void 0&&(V={});var oe=V.tolerance!=null?V.tolerance:25,ge=V.interval!=null?V.interval:250;return b.point=b.point||P.point,b.time=b.time||P.time,$t(b.point,P.point)<oe&&P.time-b.time<ge}var Bi={exports:{}},We=Bi.exports=function(b,P){if(P||(P=16),b===void 0&&(b=128),b<=0)return"0";for(var V=Math.log(Math.pow(2,b))/Math.log(P),oe=2;V===1/0;oe*=2)V=Math.log(Math.pow(2,b/oe))/Math.log(P)*oe;var ge=V-Math.floor(V),_e="";for(oe=0;oe<Math.floor(V);oe++)_e=Math.floor(Math.random()*P).toString(P)+_e;if(ge){var Ee=Math.pow(P,ge);_e=Math.floor(Math.random()*Ee).toString(P)+_e}var Je=parseInt(_e,P);return Je!==1/0&&Je>=Math.pow(2,b)?We(b,P):_e};We.rack=function(b,P,V){var oe=function(_e){var Ee=0;do{if(Ee++>10){if(!V)throw new Error("too many ID collisions, use more bits");b+=V}var Je=We(b,P)}while(Object.hasOwnProperty.call(ge,Je));return ge[Je]=_e,Je},ge=oe.hats={};return oe.get=function(_e){return oe.hats[_e]},oe.set=function(_e,Ee){return oe.hats[_e]=Ee,oe},oe.bits=b||128,oe.base=P||16,oe};var it=u(Bi.exports),Qe=function(b,P){this.ctx=b,this.properties=P.properties||{},this.coordinates=P.geometry.coordinates,this.id=P.id||it(),this.type=P.geometry.type};Qe.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},Qe.prototype.incomingCoords=function(b){this.setCoordinates(b)},Qe.prototype.setCoordinates=function(b){this.coordinates=b,this.changed()},Qe.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},Qe.prototype.setProperty=function(b,P){this.properties[b]=P},Qe.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:X.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},Qe.prototype.internal=function(b){var P={id:this.id,meta:ee.FEATURE,"meta:type":this.type,active:Ie.INACTIVE,mode:b};if(this.ctx.options.userProperties)for(var V in this.properties)P["user_"+V]=this.properties[V];return{type:X.FEATURE,properties:P,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var Xi=function(b,P){Qe.call(this,b,P)};(Xi.prototype=Object.create(Qe.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},Xi.prototype.updateCoordinate=function(b,P,V){this.coordinates=arguments.length===3?[P,V]:[b,P],this.changed()},Xi.prototype.getCoordinate=function(){return this.getCoordinates()};var ji=function(b,P){Qe.call(this,b,P)};(ji.prototype=Object.create(Qe.prototype)).isValid=function(){return this.coordinates.length>1},ji.prototype.addCoordinate=function(b,P,V){this.changed();var oe=parseInt(b,10);this.coordinates.splice(oe,0,[P,V])},ji.prototype.getCoordinate=function(b){var P=parseInt(b,10);return JSON.parse(JSON.stringify(this.coordinates[P]))},ji.prototype.removeCoordinate=function(b){this.changed(),this.coordinates.splice(parseInt(b,10),1)},ji.prototype.updateCoordinate=function(b,P,V){var oe=parseInt(b,10);this.coordinates[oe]=[P,V],this.changed()};var Mi=function(b,P){Qe.call(this,b,P),this.coordinates=this.coordinates.map(function(V){return V.slice(0,-1)})};(Mi.prototype=Object.create(Qe.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(b){return b.length>2})},Mi.prototype.incomingCoords=function(b){this.coordinates=b.map(function(P){return P.slice(0,-1)}),this.changed()},Mi.prototype.setCoordinates=function(b){this.coordinates=b,this.changed()},Mi.prototype.addCoordinate=function(b,P,V){this.changed();var oe=b.split(".").map(function(ge){return parseInt(ge,10)});this.coordinates[oe[0]].splice(oe[1],0,[P,V])},Mi.prototype.removeCoordinate=function(b){this.changed();var P=b.split(".").map(function(oe){return parseInt(oe,10)}),V=this.coordinates[P[0]];V&&(V.splice(P[1],1),V.length<3&&this.coordinates.splice(P[0],1))},Mi.prototype.getCoordinate=function(b){var P=b.split(".").map(function(oe){return parseInt(oe,10)}),V=this.coordinates[P[0]];return JSON.parse(JSON.stringify(V[P[1]]))},Mi.prototype.getCoordinates=function(){return this.coordinates.map(function(b){return b.concat([b[0]])})},Mi.prototype.updateCoordinate=function(b,P,V){this.changed();var oe=b.split("."),ge=parseInt(oe[0],10),_e=parseInt(oe[1],10);this.coordinates[ge]===void 0&&(this.coordinates[ge]=[]),this.coordinates[ge][_e]=[P,V]};var je={MultiPoint:Xi,MultiLineString:ji,MultiPolygon:Mi},Tt=function(b,P,V,oe,ge){var _e=V.split("."),Ee=parseInt(_e[0],10),Je=_e[1]?_e.slice(1).join("."):null;return b[Ee][P](Je,oe,ge)},ut=function(b,P){if(Qe.call(this,b,P),delete this.coordinates,this.model=je[P.geometry.type],this.model===void 0)throw new TypeError(P.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(P.geometry.coordinates)};function et(b){this.map=b.map,this.drawConfig=JSON.parse(JSON.stringify(b.options||{})),this._ctx=b}(ut.prototype=Object.create(Qe.prototype))._coordinatesToFeatures=function(b){var P=this,V=this.model.bind(this);return b.map(function(oe){return new V(P.ctx,{id:it(),type:X.FEATURE,properties:{},geometry:{coordinates:oe,type:P.type.replace("Multi","")}})})},ut.prototype.isValid=function(){return this.features.every(function(b){return b.isValid()})},ut.prototype.setCoordinates=function(b){this.features=this._coordinatesToFeatures(b),this.changed()},ut.prototype.getCoordinate=function(b){return Tt(this.features,"getCoordinate",b)},ut.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(b){return b.type===X.POLYGON?b.getCoordinates():b.coordinates})))},ut.prototype.updateCoordinate=function(b,P,V){Tt(this.features,"updateCoordinate",b,P,V),this.changed()},ut.prototype.addCoordinate=function(b,P,V){Tt(this.features,"addCoordinate",b,P,V),this.changed()},ut.prototype.removeCoordinate=function(b){Tt(this.features,"removeCoordinate",b),this.changed()},ut.prototype.getFeatures=function(){return this.features},et.prototype.setSelected=function(b){return this._ctx.store.setSelected(b)},et.prototype.setSelectedCoordinates=function(b){var P=this;this._ctx.store.setSelectedCoordinates(b),b.reduce(function(V,oe){return V[oe.feature_id]===void 0&&(V[oe.feature_id]=!0,P._ctx.store.get(oe.feature_id).changed()),V},{})},et.prototype.getSelected=function(){return this._ctx.store.getSelected()},et.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},et.prototype.isSelected=function(b){return this._ctx.store.isSelected(b)},et.prototype.getFeature=function(b){return this._ctx.store.get(b)},et.prototype.select=function(b){return this._ctx.store.select(b)},et.prototype.deselect=function(b){return this._ctx.store.deselect(b)},et.prototype.deleteFeature=function(b,P){return P===void 0&&(P={}),this._ctx.store.delete(b,P)},et.prototype.addFeature=function(b){return this._ctx.store.add(b)},et.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},et.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},et.prototype.setActionableState=function(b){b===void 0&&(b={});var P={trash:b.trash||!1,combineFeatures:b.combineFeatures||!1,uncombineFeatures:b.uncombineFeatures||!1};return this._ctx.events.actionable(P)},et.prototype.changeMode=function(b,P,V){return P===void 0&&(P={}),V===void 0&&(V={}),this._ctx.events.changeMode(b,P,V)},et.prototype.updateUIClasses=function(b){return this._ctx.ui.queueMapClasses(b)},et.prototype.activateUIButton=function(b){return this._ctx.ui.setActiveButton(b)},et.prototype.featuresAt=function(b,P,V){if(V===void 0&&(V="click"),V!=="click"&&V!=="touch")throw new Error("invalid buffer type");return ci[V](b,P,this._ctx)},et.prototype.newFeature=function(b){var P=b.geometry.type;return P===X.POINT?new Xi(this._ctx,b):P===X.LINE_STRING?new ji(this._ctx,b):P===X.POLYGON?new Mi(this._ctx,b):new ut(this._ctx,b)},et.prototype.isInstanceOf=function(b,P){if(b===X.POINT)return P instanceof Xi;if(b===X.LINE_STRING)return P instanceof ji;if(b===X.POLYGON)return P instanceof Mi;if(b==="MultiFeature")return P instanceof ut;throw new Error("Unknown feature class: "+b)},et.prototype.doRender=function(b){return this._ctx.store.featureChanged(b)},et.prototype.onSetup=function(){},et.prototype.onDrag=function(){},et.prototype.onClick=function(){},et.prototype.onMouseMove=function(){},et.prototype.onMouseDown=function(){},et.prototype.onMouseUp=function(){},et.prototype.onMouseOut=function(){},et.prototype.onKeyUp=function(){},et.prototype.onKeyDown=function(){},et.prototype.onTouchStart=function(){},et.prototype.onTouchMove=function(){},et.prototype.onTouchEnd=function(){},et.prototype.onTap=function(){},et.prototype.onStop=function(){},et.prototype.onTrash=function(){},et.prototype.onCombineFeature=function(){},et.prototype.onUncombineFeature=function(){},et.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var ki={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},Oi=Object.keys(ki);function ae(b){var P=Object.keys(b);return function(V,oe){oe===void 0&&(oe={});var ge={},_e=P.reduce(function(Ee,Je){return Ee[Je]=b[Je],Ee},new et(V));return{start:function(){var Ee=this;ge=_e.onSetup(oe),Oi.forEach(function(Je){var lt,Mt=ki[Je],St=function(){return!1};b[Mt]&&(St=function(){return!0}),Ee.on(Je,St,(lt=Mt,function(pt){return _e[lt](ge,pt)}))})},stop:function(){_e.onStop(ge)},trash:function(){_e.onTrash(ge)},combineFeatures:function(){_e.onCombineFeatures(ge)},uncombineFeatures:function(){_e.onUncombineFeatures(ge)},render:function(Ee,Je){_e.toDisplayFeatures(ge,Ee,Je)}}}}function ue(b){return[].concat(b).filter(function(P){return P!==void 0})}function De(){var b=this;if(!(b.ctx.map&&b.ctx.map.getSource(z.HOT)!==void 0))return lt();var P=b.ctx.events.currentModeName();b.ctx.ui.queueMapClasses({mode:P});var V=[],oe=[];b.isDirty?oe=b.getAllIds():(V=b.getChangedIds().filter(function(Mt){return b.get(Mt)!==void 0}),oe=b.sources.hot.filter(function(Mt){return Mt.properties.id&&V.indexOf(Mt.properties.id)===-1&&b.get(Mt.properties.id)!==void 0}).map(function(Mt){return Mt.properties.id})),b.sources.hot=[];var ge=b.sources.cold.length;b.sources.cold=b.isDirty?[]:b.sources.cold.filter(function(Mt){var St=Mt.properties.id||Mt.properties.parent;return V.indexOf(St)===-1});var _e=ge!==b.sources.cold.length||oe.length>0;function Ee(Mt,St){var pt=b.get(Mt).internal(P);b.ctx.events.currentModeRender(pt,function(oi){b.sources[St].push(oi)})}if(V.forEach(function(Mt){return Ee(Mt,"hot")}),oe.forEach(function(Mt){return Ee(Mt,"cold")}),_e&&b.ctx.map.getSource(z.COLD).setData({type:X.FEATURE_COLLECTION,features:b.sources.cold}),b.ctx.map.getSource(z.HOT).setData({type:X.FEATURE_COLLECTION,features:b.sources.hot}),b._emitSelectionChange&&(b.ctx.map.fire(ye.SELECTION_CHANGE,{features:b.getSelected().map(function(Mt){return Mt.toGeoJSON()}),points:b.getSelectedCoordinates().map(function(Mt){return{type:X.FEATURE,properties:{},geometry:{type:X.POINT,coordinates:Mt.coordinates}}})}),b._emitSelectionChange=!1),b._deletedFeaturesToEmit.length){var Je=b._deletedFeaturesToEmit.map(function(Mt){return Mt.toGeoJSON()});b._deletedFeaturesToEmit=[],b.ctx.map.fire(ye.DELETE,{features:Je})}function lt(){b.isDirty=!1,b.clearChangedIds()}lt(),b.ctx.map.fire(ye.RENDER,{})}function Fe(b){var P,V=this;this._features={},this._featureIds=new li,this._selectedFeatureIds=new li,this._selectedCoordinates=[],this._changedFeatureIds=new li,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=b,this.sources={hot:[],cold:[]},this.render=function(){P||(P=requestAnimationFrame(function(){P=null,De.call(V)}))},this.isDirty=!1}function ce(b,P){var V=b._selectedCoordinates.filter(function(oe){return b._selectedFeatureIds.has(oe.feature_id)});b._selectedCoordinates.length===V.length||P.silent||(b._emitSelectionChange=!0),b._selectedCoordinates=V}Fe.prototype.createRenderBatch=function(){var b=this,P=this.render,V=0;return this.render=function(){V++},function(){b.render=P,V>0&&b.render()}},Fe.prototype.setDirty=function(){return this.isDirty=!0,this},Fe.prototype.featureChanged=function(b){return this._changedFeatureIds.add(b),this},Fe.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},Fe.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},Fe.prototype.getAllIds=function(){return this._featureIds.values()},Fe.prototype.add=function(b){return this.featureChanged(b.id),this._features[b.id]=b,this._featureIds.add(b.id),this},Fe.prototype.delete=function(b,P){var V=this;return P===void 0&&(P={}),ue(b).forEach(function(oe){V._featureIds.has(oe)&&(V._featureIds.delete(oe),V._selectedFeatureIds.delete(oe),P.silent||V._deletedFeaturesToEmit.indexOf(V._features[oe])===-1&&V._deletedFeaturesToEmit.push(V._features[oe]),delete V._features[oe],V.isDirty=!0)}),ce(this,P),this},Fe.prototype.get=function(b){return this._features[b]},Fe.prototype.getAll=function(){var b=this;return Object.keys(this._features).map(function(P){return b._features[P]})},Fe.prototype.select=function(b,P){var V=this;return P===void 0&&(P={}),ue(b).forEach(function(oe){V._selectedFeatureIds.has(oe)||(V._selectedFeatureIds.add(oe),V._changedFeatureIds.add(oe),P.silent||(V._emitSelectionChange=!0))}),this},Fe.prototype.deselect=function(b,P){var V=this;return P===void 0&&(P={}),ue(b).forEach(function(oe){V._selectedFeatureIds.has(oe)&&(V._selectedFeatureIds.delete(oe),V._changedFeatureIds.add(oe),P.silent||(V._emitSelectionChange=!0))}),ce(this,P),this},Fe.prototype.clearSelected=function(b){return b===void 0&&(b={}),this.deselect(this._selectedFeatureIds.values(),{silent:b.silent}),this},Fe.prototype.setSelected=function(b,P){var V=this;return P===void 0&&(P={}),b=ue(b),this.deselect(this._selectedFeatureIds.values().filter(function(oe){return b.indexOf(oe)===-1}),{silent:P.silent}),this.select(b.filter(function(oe){return!V._selectedFeatureIds.has(oe)}),{silent:P.silent}),this},Fe.prototype.setSelectedCoordinates=function(b){return this._selectedCoordinates=b,this._emitSelectionChange=!0,this},Fe.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},Fe.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},Fe.prototype.getSelected=function(){var b=this;return this._selectedFeatureIds.values().map(function(P){return b.get(P)})},Fe.prototype.getSelectedCoordinates=function(){var b=this;return this._selectedCoordinates.map(function(P){return{coordinates:b.get(P.feature_id).getCoordinate(P.coord_path)}})},Fe.prototype.isSelected=function(b){return this._selectedFeatureIds.has(b)},Fe.prototype.setFeatureProperty=function(b,P,V){this.get(b).setProperty(P,V),this.featureChanged(b)},Fe.prototype.storeMapConfig=function(){var b=this;Ue.forEach(function(P){b.ctx.map[P]&&(b._mapInitialConfig[P]=b.ctx.map[P].isEnabled())})},Fe.prototype.restoreMapConfig=function(){var b=this;Object.keys(this._mapInitialConfig).forEach(function(P){b._mapInitialConfig[P]?b.ctx.map[P].enable():b.ctx.map[P].disable()})},Fe.prototype.getInitialConfigValue=function(b){return this._mapInitialConfig[b]===void 0||this._mapInitialConfig[b]};var dt=function(){for(var b=arguments,P={},V=0;V<arguments.length;V++){var oe=b[V];for(var ge in oe)Pt.call(oe,ge)&&(P[ge]=oe[ge])}return P},Pt=Object.prototype.hasOwnProperty,Be=u(dt),st=["mode","feature","mouse"];function rt(b){var P=null,V=null,oe={onRemove:function(){return b.map.off("load",oe.connect),clearInterval(V),oe.removeLayers(),b.store.restoreMapConfig(),b.ui.removeButtons(),b.events.removeEventListeners(),b.ui.clearMapClasses(),b.boxZoomInitial&&b.map.boxZoom.enable(),b.map=null,b.container=null,b.store=null,P&&P.parentNode&&P.parentNode.removeChild(P),P=null,this},connect:function(){b.map.off("load",oe.connect),clearInterval(V),oe.addLayers(),b.store.storeMapConfig(),b.events.addEventListeners()},onAdd:function(ge){var _e=ge.fire;return ge.fire=function(Ee,Je){var lt=arguments;return _e.length===1&&arguments.length!==1&&(lt=[Be({},{type:Ee},Je)]),_e.apply(ge,lt)},b.map=ge,b.events=function(Ee){var Je=Object.keys(Ee.options.modes).reduce(function(qe,Bt){return qe[Bt]=ae(Ee.options.modes[Bt]),qe},{}),lt={},Mt={},St={},pt=null,oi=null;St.drag=function(qe,Bt){Bt({point:qe.point,time:new Date().getTime()})?(Ee.ui.queueMapClasses({mouse:W.DRAG}),oi.drag(qe)):qe.originalEvent.stopPropagation()},St.mousedrag=function(qe){St.drag(qe,function(Bt){return!ai(lt,Bt)})},St.touchdrag=function(qe){St.drag(qe,function(Bt){return!Zi(Mt,Bt)})},St.mousemove=function(qe){if((qe.originalEvent.buttons!==void 0?qe.originalEvent.buttons:qe.originalEvent.which)===1)return St.mousedrag(qe);var Bt=kt(qe,Ee);qe.featureTarget=Bt,oi.mousemove(qe)},St.mousedown=function(qe){lt={time:new Date().getTime(),point:qe.point};var Bt=kt(qe,Ee);qe.featureTarget=Bt,oi.mousedown(qe)},St.mouseup=function(qe){var Bt=kt(qe,Ee);qe.featureTarget=Bt,ai(lt,{point:qe.point,time:new Date().getTime()})?oi.click(qe):oi.mouseup(qe)},St.mouseout=function(qe){oi.mouseout(qe)},St.touchstart=function(qe){if(Ee.options.touchEnabled){Mt={time:new Date().getTime(),point:qe.point};var Bt=ci.touch(qe,null,Ee)[0];qe.featureTarget=Bt,oi.touchstart(qe)}},St.touchmove=function(qe){if(Ee.options.touchEnabled)return oi.touchmove(qe),St.touchdrag(qe)},St.touchend=function(qe){if(qe.originalEvent.preventDefault(),Ee.options.touchEnabled){var Bt=ci.touch(qe,null,Ee)[0];qe.featureTarget=Bt,Zi(Mt,{time:new Date().getTime(),point:qe.point})?oi.tap(qe):oi.touchend(qe)}};var fr=function(qe){return!(qe===8||qe===46||qe>=48&&qe<=57)};function hi(qe,Bt,xi){xi===void 0&&(xi={}),oi.stop();var Tr=Je[qe];if(Tr===void 0)throw new Error(qe+" is not valid");pt=qe;var vr=Tr(Ee,Bt);oi=a(vr,Ee),xi.silent||Ee.map.fire(ye.MODE_CHANGE,{mode:qe}),Ee.store.setDirty(),Ee.store.render()}St.keydown=function(qe){(qe.srcElement||qe.target).classList.contains("mapboxgl-canvas")&&(qe.keyCode!==8&&qe.keyCode!==46||!Ee.options.controls.trash?fr(qe.keyCode)?oi.keydown(qe):qe.keyCode===49&&Ee.options.controls.point?hi(fe.DRAW_POINT):qe.keyCode===50&&Ee.options.controls.line_string?hi(fe.DRAW_LINE_STRING):qe.keyCode===51&&Ee.options.controls.polygon&&hi(fe.DRAW_POLYGON):(qe.preventDefault(),oi.trash()))},St.keyup=function(qe){fr(qe.keyCode)&&oi.keyup(qe)},St.zoomend=function(){Ee.store.changeZoom()},St.data=function(qe){if(qe.dataType==="style"){var Bt=Ee.setup,xi=Ee.map,Tr=Ee.options,vr=Ee.store;Tr.styles.some(function(va){return xi.getLayer(va.id)})||(Bt.addLayers(),vr.setDirty(),vr.render())}};var Rr={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){pt=Ee.options.defaultMode,oi=a(Je[pt](Ee),Ee)},changeMode:hi,actionable:function(qe){var Bt=!1;Object.keys(qe).forEach(function(xi){if(Rr[xi]===void 0)throw new Error("Invalid action type");Rr[xi]!==qe[xi]&&(Bt=!0),Rr[xi]=qe[xi]}),Bt&&Ee.map.fire(ye.ACTIONABLE,{actions:Rr})},currentModeName:function(){return pt},currentModeRender:function(qe,Bt){return oi.render(qe,Bt)},fire:function(qe,Bt){St[qe]&&St[qe](Bt)},addEventListeners:function(){Ee.map.on("mousemove",St.mousemove),Ee.map.on("mousedown",St.mousedown),Ee.map.on("mouseup",St.mouseup),Ee.map.on("data",St.data),Ee.map.on("touchmove",St.touchmove),Ee.map.on("touchstart",St.touchstart),Ee.map.on("touchend",St.touchend),Ee.container.addEventListener("mouseout",St.mouseout),Ee.options.keybindings&&(Ee.container.addEventListener("keydown",St.keydown),Ee.container.addEventListener("keyup",St.keyup))},removeEventListeners:function(){Ee.map.off("mousemove",St.mousemove),Ee.map.off("mousedown",St.mousedown),Ee.map.off("mouseup",St.mouseup),Ee.map.off("data",St.data),Ee.map.off("touchmove",St.touchmove),Ee.map.off("touchstart",St.touchstart),Ee.map.off("touchend",St.touchend),Ee.container.removeEventListener("mouseout",St.mouseout),Ee.options.keybindings&&(Ee.container.removeEventListener("keydown",St.keydown),Ee.container.removeEventListener("keyup",St.keyup))},trash:function(qe){oi.trash(qe)},combineFeatures:function(){oi.combineFeatures()},uncombineFeatures:function(){oi.uncombineFeatures()},getMode:function(){return pt}}}(b),b.ui=function(Ee){var Je={},lt=null,Mt={mode:null,feature:null,mouse:null},St={mode:null,feature:null,mouse:null};function pt(qe){St=Be(St,qe)}function oi(){var qe,Bt;if(Ee.container){var xi=[],Tr=[];st.forEach(function(vr){St[vr]!==Mt[vr]&&(xi.push(vr+"-"+Mt[vr]),St[vr]!==null&&Tr.push(vr+"-"+St[vr]))}),xi.length>0&&(qe=Ee.container.classList).remove.apply(qe,xi),Tr.length>0&&(Bt=Ee.container.classList).add.apply(Bt,Tr),Mt=Be(Mt,St)}}function fr(qe,Bt){Bt===void 0&&(Bt={});var xi=document.createElement("button");return xi.className=k.CONTROL_BUTTON+" "+Bt.className,xi.setAttribute("title",Bt.title),Bt.container.appendChild(xi),xi.addEventListener("click",function(Tr){if(Tr.preventDefault(),Tr.stopPropagation(),Tr.target===lt)return hi(),void Bt.onDeactivate();Rr(qe),Bt.onActivate()},!0),xi}function hi(){lt&&(lt.classList.remove(k.ACTIVE_BUTTON),lt=null)}function Rr(qe){hi();var Bt=Je[qe];Bt&&Bt&&qe!=="trash"&&(Bt.classList.add(k.ACTIVE_BUTTON),lt=Bt)}return{setActiveButton:Rr,queueMapClasses:pt,updateMapClasses:oi,clearMapClasses:function(){pt({mode:null,feature:null,mouse:null}),oi()},addButtons:function(){var qe=Ee.options.controls,Bt=document.createElement("div");return Bt.className=k.CONTROL_GROUP+" "+k.CONTROL_BASE,qe&&(qe[Z.LINE]&&(Je[Z.LINE]=fr(Z.LINE,{container:Bt,className:k.CONTROL_BUTTON_LINE,title:"LineString tool "+(Ee.options.keybindings?"(l)":""),onActivate:function(){return Ee.events.changeMode(fe.DRAW_LINE_STRING)},onDeactivate:function(){return Ee.events.trash()}})),qe[Z.POLYGON]&&(Je[Z.POLYGON]=fr(Z.POLYGON,{container:Bt,className:k.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(Ee.options.keybindings?"(p)":""),onActivate:function(){return Ee.events.changeMode(fe.DRAW_POLYGON)},onDeactivate:function(){return Ee.events.trash()}})),qe[Z.POINT]&&(Je[Z.POINT]=fr(Z.POINT,{container:Bt,className:k.CONTROL_BUTTON_POINT,title:"Marker tool "+(Ee.options.keybindings?"(m)":""),onActivate:function(){return Ee.events.changeMode(fe.DRAW_POINT)},onDeactivate:function(){return Ee.events.trash()}})),qe.trash&&(Je.trash=fr("trash",{container:Bt,className:k.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){Ee.events.trash()}})),qe.combine_features&&(Je.combine_features=fr("combineFeatures",{container:Bt,className:k.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){Ee.events.combineFeatures()}})),qe.uncombine_features&&(Je.uncombine_features=fr("uncombineFeatures",{container:Bt,className:k.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){Ee.events.uncombineFeatures()}}))),Bt},removeButtons:function(){Object.keys(Je).forEach(function(qe){var Bt=Je[qe];Bt.parentNode&&Bt.parentNode.removeChild(Bt),delete Je[qe]})}}}(b),b.container=ge.getContainer(),b.store=new Fe(b),P=b.ui.addButtons(),b.options.boxSelect&&(b.boxZoomInitial=ge.boxZoom.isEnabled(),ge.boxZoom.disable(),ge.dragPan.disable(),ge.dragPan.enable()),ge.loaded()?oe.connect():(ge.on("load",oe.connect),V=setInterval(function(){ge.loaded()&&oe.connect()},16)),b.events.start(),P},addLayers:function(){b.map.addSource(z.COLD,{data:{type:X.FEATURE_COLLECTION,features:[]},type:"geojson"}),b.map.addSource(z.HOT,{data:{type:X.FEATURE_COLLECTION,features:[]},type:"geojson"}),b.options.styles.forEach(function(ge){b.map.addLayer(ge)}),b.store.setDirty(!0),b.store.render()},removeLayers:function(){b.options.styles.forEach(function(ge){b.map.getLayer(ge.id)&&b.map.removeLayer(ge.id)}),b.map.getSource(z.COLD)&&b.map.removeSource(z.COLD),b.map.getSource(z.HOT)&&b.map.removeSource(z.HOT)}};return b.setup=oe,oe}var Dt=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function Kt(b){return function(P){var V=P.featureTarget;return!!V&&!!V.properties&&V.properties.meta===b}}function Zt(b){return!!b.originalEvent&&!!b.originalEvent.shiftKey&&b.originalEvent.button===0}function Jt(b){return!!b.featureTarget&&!!b.featureTarget.properties&&b.featureTarget.properties.active===Ie.ACTIVE&&b.featureTarget.properties.meta===ee.FEATURE}function yi(b){return!!b.featureTarget&&!!b.featureTarget.properties&&b.featureTarget.properties.active===Ie.INACTIVE&&b.featureTarget.properties.meta===ee.FEATURE}function Ti(b){return b.featureTarget===void 0}function Ve(b){return!!b.featureTarget&&!!b.featureTarget.properties&&b.featureTarget.properties.meta===ee.FEATURE}function Ni(b){var P=b.featureTarget;return!!P&&!!P.properties&&P.properties.meta===ee.VERTEX}function Qi(b){return!!b.originalEvent&&b.originalEvent.shiftKey===!0}function _n(b){return b.keyCode===27}function Sr(b){return b.keyCode===13}var at=Object.freeze({__proto__:null,isOfMetaType:Kt,isShiftMousedown:Zt,isActiveFeature:Jt,isInactiveFeature:yi,noTarget:Ti,isFeature:Ve,isVertex:Ni,isShiftDown:Qi,isEscapeKey:_n,isEnterKey:Sr,isTrue:function(){return!0}}),ui=Ut;function Ut(b,P){this.x=b,this.y=P}Ut.prototype={clone:function(){return new Ut(this.x,this.y)},add:function(b){return this.clone()._add(b)},sub:function(b){return this.clone()._sub(b)},multByPoint:function(b){return this.clone()._multByPoint(b)},divByPoint:function(b){return this.clone()._divByPoint(b)},mult:function(b){return this.clone()._mult(b)},div:function(b){return this.clone()._div(b)},rotate:function(b){return this.clone()._rotate(b)},rotateAround:function(b,P){return this.clone()._rotateAround(b,P)},matMult:function(b){return this.clone()._matMult(b)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(b){return this.x===b.x&&this.y===b.y},dist:function(b){return Math.sqrt(this.distSqr(b))},distSqr:function(b){var P=b.x-this.x,V=b.y-this.y;return P*P+V*V},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(b){return Math.atan2(this.y-b.y,this.x-b.x)},angleWith:function(b){return this.angleWithSep(b.x,b.y)},angleWithSep:function(b,P){return Math.atan2(this.x*P-this.y*b,this.x*b+this.y*P)},_matMult:function(b){var P=b[0]*this.x+b[1]*this.y,V=b[2]*this.x+b[3]*this.y;return this.x=P,this.y=V,this},_add:function(b){return this.x+=b.x,this.y+=b.y,this},_sub:function(b){return this.x-=b.x,this.y-=b.y,this},_mult:function(b){return this.x*=b,this.y*=b,this},_div:function(b){return this.x/=b,this.y/=b,this},_multByPoint:function(b){return this.x*=b.x,this.y*=b.y,this},_divByPoint:function(b){return this.x/=b.x,this.y/=b.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var b=this.y;return this.y=this.x,this.x=-b,this},_rotate:function(b){var P=Math.cos(b),V=Math.sin(b),oe=P*this.x-V*this.y,ge=V*this.x+P*this.y;return this.x=oe,this.y=ge,this},_rotateAround:function(b,P){var V=Math.cos(b),oe=Math.sin(b),ge=P.x+V*(this.x-P.x)-oe*(this.y-P.y),_e=P.y+oe*(this.x-P.x)+V*(this.y-P.y);return this.x=ge,this.y=_e,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ut.convert=function(b){return b instanceof Ut?b:Array.isArray(b)?new Ut(b[0],b[1]):b};var qi=u(ui);function vn(b,P){var V=P.getBoundingClientRect();return new qi(b.clientX-V.left-(P.clientLeft||0),b.clientY-V.top-(P.clientTop||0))}function ii(b,P,V,oe){return{type:X.FEATURE,properties:{meta:ee.VERTEX,parent:b,coord_path:V,active:oe?Ie.ACTIVE:Ie.INACTIVE},geometry:{type:X.POINT,coordinates:P}}}function ta(b,P,V){var oe=P.geometry.coordinates,ge=V.geometry.coordinates;if(oe[1]>85||oe[1]<Xe||ge[1]>85||ge[1]<Xe)return null;var _e={lng:(oe[0]+ge[0])/2,lat:(oe[1]+ge[1])/2};return{type:X.FEATURE,properties:{meta:ee.MIDPOINT,parent:b,lng:_e.lng,lat:_e.lat,coord_path:V.properties.coord_path},geometry:{type:X.POINT,coordinates:[_e.lng,_e.lat]}}}function Er(b,P,V){P===void 0&&(P={}),V===void 0&&(V=null);var oe,ge=b.geometry,_e=ge.type,Ee=ge.coordinates,Je=b.properties&&b.properties.id,lt=[];function Mt(pt,oi){var fr="",hi=null;pt.forEach(function(Rr,qe){var Bt=oi!=null?oi+"."+qe:String(qe),xi=ii(Je,Rr,Bt,St(Bt));if(P.midpoints&&hi){var Tr=ta(Je,hi,xi);Tr&&lt.push(Tr)}hi=xi;var vr=JSON.stringify(Rr);fr!==vr&&lt.push(xi),qe===0&&(fr=vr)})}function St(pt){return!!P.selectedPaths&&P.selectedPaths.indexOf(pt)!==-1}return _e===X.POINT?lt.push(ii(Je,Ee,V,St(V))):_e===X.POLYGON?Ee.forEach(function(pt,oi){Mt(pt,V!==null?V+"."+oi:String(oi))}):_e===X.LINE_STRING?Mt(Ee,V):_e.indexOf(X.MULTI_PREFIX)===0&&(oe=_e.replace(X.MULTI_PREFIX,""),Ee.forEach(function(pt,oi){var fr={type:X.FEATURE,properties:b.properties,geometry:{type:oe,coordinates:pt}};lt=lt.concat(Er(fr,P,oi))})),lt}var ie={enable:function(b){setTimeout(function(){b.map&&b.map.doubleClickZoom&&b._ctx&&b._ctx.store&&b._ctx.store.getInitialConfigValue&&b._ctx.store.getInitialConfigValue("doubleClickZoom")&&b.map.doubleClickZoom.enable()},0)},disable:function(b){setTimeout(function(){b.map&&b.map.doubleClickZoom&&b.map.doubleClickZoom.disable()},0)}},N={exports:{}},U=function(b){if(!b||!b.type)return null;var P=H[b.type];if(!P)return null;if(P==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:b}]};if(P==="feature")return{type:"FeatureCollection",features:[b]};if(P==="featurecollection")return b},H={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},Q=u(U),ve=Object.freeze({__proto__:null,default:function b(P){switch(P&&P.type||null){case"FeatureCollection":return P.features=P.features.reduce(function(V,oe){return V.concat(b(oe))},[]),P;case"Feature":return P.geometry?b(P.geometry).map(function(V){var oe={type:"Feature",properties:JSON.parse(JSON.stringify(P.properties)),geometry:V};return P.id!==void 0&&(oe.id=P.id),oe}):[P];case"MultiPoint":return P.coordinates.map(function(V){return{type:"Point",coordinates:V}});case"MultiPolygon":return P.coordinates.map(function(V){return{type:"Polygon",coordinates:V}});case"MultiLineString":return P.coordinates.map(function(V){return{type:"LineString",coordinates:V}});case"GeometryCollection":return P.geometries.map(b).reduce(function(V,oe){return V.concat(oe)},[]);case"Point":case"Polygon":case"LineString":return[P]}}}),xe=U,Se=d(ve),de=function(b){return function P(V){return Array.isArray(V)&&V.length&&typeof V[0]=="number"?[V]:V.reduce(function(oe,ge){return Array.isArray(ge)&&Array.isArray(ge[0])?oe.concat(P(ge)):(oe.push(ge),oe)},[])}(b)};Se instanceof Function||(Se=Se.default);var Ae={exports:{}},Ge=Ae.exports=function(b){return new ze(b)};function ze(b){this.value=b}function Ne(b,P,V){var oe=[],ge=[],_e=!0;return function Ee(Je){var lt=V?Vt(Je):Je,Mt={},St=!0,pt={node:lt,node_:Je,path:[].concat(oe),parent:ge[ge.length-1],parents:ge,key:oe.slice(-1)[0],isRoot:oe.length===0,level:oe.length,circular:null,update:function(hi,Rr){pt.isRoot||(pt.parent.node[pt.key]=hi),pt.node=hi,Rr&&(St=!1)},delete:function(hi){delete pt.parent.node[pt.key],hi&&(St=!1)},remove:function(hi){ni(pt.parent.node)?pt.parent.node.splice(pt.key,1):delete pt.parent.node[pt.key],hi&&(St=!1)},keys:null,before:function(hi){Mt.before=hi},after:function(hi){Mt.after=hi},pre:function(hi){Mt.pre=hi},post:function(hi){Mt.post=hi},stop:function(){_e=!1},block:function(){St=!1}};if(!_e)return pt;function oi(){if(typeof pt.node=="object"&&pt.node!==null){pt.keys&&pt.node_===pt.node||(pt.keys=Wt(pt.node)),pt.isLeaf=pt.keys.length==0;for(var hi=0;hi<ge.length;hi++)if(ge[hi].node_===Je){pt.circular=ge[hi];break}}else pt.isLeaf=!0,pt.keys=null;pt.notLeaf=!pt.isLeaf,pt.notRoot=!pt.isRoot}oi();var fr=P.call(pt,pt.node);return fr!==void 0&&pt.update&&pt.update(fr),Mt.before&&Mt.before.call(pt,pt.node),St&&(typeof pt.node!="object"||pt.node===null||pt.circular||(ge.push(pt),oi(),vi(pt.keys,function(hi,Rr){oe.push(hi),Mt.pre&&Mt.pre.call(pt,pt.node[hi],hi);var qe=Ee(pt.node[hi]);V&&Ui.call(pt.node,hi)&&(pt.node[hi]=qe.node),qe.isLast=Rr==pt.keys.length-1,qe.isFirst=Rr==0,Mt.post&&Mt.post.call(pt,qe),oe.pop()}),ge.pop()),Mt.after&&Mt.after.call(pt,pt.node)),pt}(b).node}function Vt(b){if(typeof b=="object"&&b!==null){var P;if(ni(b))P=[];else if(ri(b)==="[object Date]")P=new Date(b.getTime?b.getTime():b);else if(function(ge){return ri(ge)==="[object RegExp]"}(b))P=new RegExp(b);else if(function(ge){return ri(ge)==="[object Error]"}(b))P={message:b.message};else if(function(ge){return ri(ge)==="[object Boolean]"}(b))P=new Boolean(b);else if(function(ge){return ri(ge)==="[object Number]"}(b))P=new Number(b);else if(function(ge){return ri(ge)==="[object String]"}(b))P=new String(b);else if(Object.create&&Object.getPrototypeOf)P=Object.create(Object.getPrototypeOf(b));else if(b.constructor===Object)P={};else{var V=b.constructor&&b.constructor.prototype||b.__proto__||{},oe=function(){};oe.prototype=V,P=new oe}return vi(Wt(b),function(ge){P[ge]=b[ge]}),P}return b}ze.prototype.get=function(b){for(var P=this.value,V=0;V<b.length;V++){var oe=b[V];if(!P||!Ui.call(P,oe)){P=void 0;break}P=P[oe]}return P},ze.prototype.has=function(b){for(var P=this.value,V=0;V<b.length;V++){var oe=b[V];if(!P||!Ui.call(P,oe))return!1;P=P[oe]}return!0},ze.prototype.set=function(b,P){for(var V=this.value,oe=0;oe<b.length-1;oe++){var ge=b[oe];Ui.call(V,ge)||(V[ge]={}),V=V[ge]}return V[b[oe]]=P,P},ze.prototype.map=function(b){return Ne(this.value,b,!0)},ze.prototype.forEach=function(b){return this.value=Ne(this.value,b,!1),this.value},ze.prototype.reduce=function(b,P){var V=arguments.length===1,oe=V?this.value:P;return this.forEach(function(ge){this.isRoot&&V||(oe=b.call(this,oe,ge))}),oe},ze.prototype.paths=function(){var b=[];return this.forEach(function(P){b.push(this.path)}),b},ze.prototype.nodes=function(){var b=[];return this.forEach(function(P){b.push(this.node)}),b},ze.prototype.clone=function(){var b=[],P=[];return function V(oe){for(var ge=0;ge<b.length;ge++)if(b[ge]===oe)return P[ge];if(typeof oe=="object"&&oe!==null){var _e=Vt(oe);return b.push(oe),P.push(_e),vi(Wt(oe),function(Ee){_e[Ee]=V(oe[Ee])}),b.pop(),P.pop(),_e}return oe}(this.value)};var Wt=Object.keys||function(b){var P=[];for(var V in b)P.push(V);return P};function ri(b){return Object.prototype.toString.call(b)}var ni=Array.isArray||function(b){return Object.prototype.toString.call(b)==="[object Array]"},vi=function(b,P){if(b.forEach)return b.forEach(P);for(var V=0;V<b.length;V++)P(b[V],V,b)};vi(Wt(ze.prototype),function(b){Ge[b]=function(P){var V=[].slice.call(arguments,1),oe=new ze(P);return oe[b].apply(oe,V)}});var Ui=Object.hasOwnProperty||function(b,P){return P in b},cr=Ae.exports,Br=Yt;function Yt(b){if(!(this instanceof Yt))return new Yt(b);this._bbox=b||[1/0,1/0,-1/0,-1/0],this._valid=!!b}Yt.prototype.include=function(b){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],b[0]),this._bbox[1]=Math.min(this._bbox[1],b[1]),this._bbox[2]=Math.max(this._bbox[2],b[0]),this._bbox[3]=Math.max(this._bbox[3],b[1]),this},Yt.prototype.equals=function(b){var P;return P=b instanceof Yt?b.bbox():b,this._bbox[0]==P[0]&&this._bbox[1]==P[1]&&this._bbox[2]==P[2]&&this._bbox[3]==P[3]},Yt.prototype.center=function(b){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},Yt.prototype.union=function(b){var P;return this._valid=!0,P=b instanceof Yt?b.bbox():b,this._bbox[0]=Math.min(this._bbox[0],P[0]),this._bbox[1]=Math.min(this._bbox[1],P[1]),this._bbox[2]=Math.max(this._bbox[2],P[2]),this._bbox[3]=Math.max(this._bbox[3],P[3]),this},Yt.prototype.bbox=function(){return this._valid?this._bbox:null},Yt.prototype.contains=function(b){if(!b)return this._fastContains();if(!this._valid)return null;var P=b[0],V=b[1];return this._bbox[0]<=P&&this._bbox[1]<=V&&this._bbox[2]>=P&&this._bbox[3]>=V},Yt.prototype.intersect=function(b){return this._valid?(P=b instanceof Yt?b.bbox():b,!(this._bbox[0]>P[2]||this._bbox[2]<P[0]||this._bbox[3]<P[1]||this._bbox[1]>P[3])):null;var P},Yt.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var b="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",b)},Yt.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var _r=function(b){if(!b)return[];var P=Se(xe(b)),V=[];return P.features.forEach(function(oe){oe.geometry&&(V=V.concat(de(oe.geometry.coordinates)))}),V},Vr=cr,xn=Br,bn={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},Zr=Object.keys(bn);function Hn(b){for(var P=xn(),V=_r(b),oe=0;oe<V.length;oe++)P.include(V[oe]);return P}N.exports=function(b){return Hn(b).bbox()},N.exports.polygon=function(b){return Hn(b).polygon()},N.exports.bboxify=function(b){return Vr(b).map(function(P){P&&Zr.some(function(V){return!!P[V]&&bn[V].indexOf(P.type)!==-1})&&(P.bbox=Hn(P).bbox(),this.update(P))})};var gc=u(N.exports),zo=-90;function Vi(b,P){var V=zo,oe=90,ge=zo,_e=90,Ee=270,Je=-270;b.forEach(function(Mt){var St=gc(Mt),pt=St[1],oi=St[3],fr=St[0],hi=St[2];pt>V&&(V=pt),oi<oe&&(oe=oi),oi>ge&&(ge=oi),pt<_e&&(_e=pt),fr<Ee&&(Ee=fr),hi>Je&&(Je=hi)});var lt=P;return V+lt.lat>85&&(lt.lat=85-V),ge+lt.lat>90&&(lt.lat=90-ge),oe+lt.lat<-85&&(lt.lat=-85-oe),_e+lt.lat<zo&&(lt.lat=zo-_e),Ee+lt.lng<=-270&&(lt.lng+=360*Math.ceil(Math.abs(lt.lng)/360)),Je+lt.lng>=270&&(lt.lng-=360*Math.ceil(Math.abs(lt.lng)/360)),lt}function lo(b,P){var V=Vi(b.map(function(oe){return oe.toGeoJSON()}),P);b.forEach(function(oe){var ge,_e=oe.getCoordinates(),Ee=function(lt){var Mt={lng:lt[0]+V.lng,lat:lt[1]+V.lat};return[Mt.lng,Mt.lat]},Je=function(lt){return lt.map(function(Mt){return Ee(Mt)})};oe.type===X.POINT?ge=Ee(_e):oe.type===X.LINE_STRING||oe.type===X.MULTI_POINT?ge=_e.map(Ee):oe.type===X.POLYGON||oe.type===X.MULTI_LINE_STRING?ge=_e.map(Je):oe.type===X.MULTI_POLYGON&&(ge=_e.map(function(lt){return lt.map(function(Mt){return Je(Mt)})})),oe.incomingCoords(ge)})}var kr={onSetup:function(b){var P=this,V={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:b.featureIds||[]};return this.setSelected(V.initiallySelectedFeatureIds.filter(function(oe){return P.getFeature(oe)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),V},fireUpdate:function(){this.map.fire(ye.UPDATE,{action:we.MOVE,features:this.getSelected().map(function(b){return b.toGeoJSON()})})},fireActionable:function(){var b=this,P=this.getSelected(),V=P.filter(function(Je){return b.isInstanceOf("MultiFeature",Je)}),oe=!1;if(P.length>1){oe=!0;var ge=P[0].type.replace("Multi","");P.forEach(function(Je){Je.type.replace("Multi","")!==ge&&(oe=!1)})}var _e=V.length>0,Ee=P.length>0;this.setActionableState({combineFeatures:oe,uncombineFeatures:_e,trash:Ee})},getUniqueIds:function(b){return b.length?b.map(function(P){return P.properties.id}).filter(function(P){return P!==void 0}).reduce(function(P,V){return P.add(V),P},new li).values():[]},stopExtendedInteractions:function(b){b.boxSelectElement&&(b.boxSelectElement.parentNode&&b.boxSelectElement.parentNode.removeChild(b.boxSelectElement),b.boxSelectElement=null),this.map.dragPan.enable(),b.boxSelecting=!1,b.canBoxSelect=!1,b.dragMoving=!1,b.canDragMove=!1},onStop:function(){ie.enable(this)},onMouseMove:function(b,P){return Ve(P)&&b.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(b),!0},onMouseOut:function(b){return!b.dragMoving||this.fireUpdate()}};kr.onTap=kr.onClick=function(b,P){return Ti(P)?this.clickAnywhere(b,P):Kt(ee.VERTEX)(P)?this.clickOnVertex(b,P):Ve(P)?this.clickOnFeature(b,P):void 0},kr.clickAnywhere=function(b){var P=this,V=this.getSelectedIds();V.length&&(this.clearSelectedFeatures(),V.forEach(function(oe){return P.doRender(oe)})),ie.enable(this),this.stopExtendedInteractions(b)},kr.clickOnVertex=function(b,P){this.changeMode(fe.DIRECT_SELECT,{featureId:P.featureTarget.properties.parent,coordPath:P.featureTarget.properties.coord_path,startPos:P.lngLat}),this.updateUIClasses({mouse:W.MOVE})},kr.startOnActiveFeature=function(b,P){this.stopExtendedInteractions(b),this.map.dragPan.disable(),this.doRender(P.featureTarget.properties.id),b.canDragMove=!0,b.dragMoveLocation=P.lngLat},kr.clickOnFeature=function(b,P){var V=this;ie.disable(this),this.stopExtendedInteractions(b);var oe=Qi(P),ge=this.getSelectedIds(),_e=P.featureTarget.properties.id,Ee=this.isSelected(_e);if(!oe&&Ee&&this.getFeature(_e).type!==X.POINT)return this.changeMode(fe.DIRECT_SELECT,{featureId:_e});Ee&&oe?(this.deselect(_e),this.updateUIClasses({mouse:W.POINTER}),ge.length===1&&ie.enable(this)):!Ee&&oe?(this.select(_e),this.updateUIClasses({mouse:W.MOVE})):Ee||oe||(ge.forEach(function(Je){return V.doRender(Je)}),this.setSelected(_e),this.updateUIClasses({mouse:W.MOVE})),this.doRender(_e)},kr.onMouseDown=function(b,P){return Jt(P)?this.startOnActiveFeature(b,P):this.drawConfig.boxSelect&&Zt(P)?this.startBoxSelect(b,P):void 0},kr.startBoxSelect=function(b,P){this.stopExtendedInteractions(b),this.map.dragPan.disable(),b.boxSelectStartLocation=vn(P.originalEvent,this.map.getContainer()),b.canBoxSelect=!0},kr.onTouchStart=function(b,P){if(Jt(P))return this.startOnActiveFeature(b,P)},kr.onDrag=function(b,P){return b.canDragMove?this.dragMove(b,P):this.drawConfig.boxSelect&&b.canBoxSelect?this.whileBoxSelect(b,P):void 0},kr.whileBoxSelect=function(b,P){b.boxSelecting=!0,this.updateUIClasses({mouse:W.ADD}),b.boxSelectElement||(b.boxSelectElement=document.createElement("div"),b.boxSelectElement.classList.add(k.BOX_SELECT),this.map.getContainer().appendChild(b.boxSelectElement));var V=vn(P.originalEvent,this.map.getContainer()),oe=Math.min(b.boxSelectStartLocation.x,V.x),ge=Math.max(b.boxSelectStartLocation.x,V.x),_e=Math.min(b.boxSelectStartLocation.y,V.y),Ee=Math.max(b.boxSelectStartLocation.y,V.y),Je="translate("+oe+"px, "+_e+"px)";b.boxSelectElement.style.transform=Je,b.boxSelectElement.style.WebkitTransform=Je,b.boxSelectElement.style.width=ge-oe+"px",b.boxSelectElement.style.height=Ee-_e+"px"},kr.dragMove=function(b,P){b.dragMoving=!0,P.originalEvent.stopPropagation();var V={lng:P.lngLat.lng-b.dragMoveLocation.lng,lat:P.lngLat.lat-b.dragMoveLocation.lat};lo(this.getSelected(),V),b.dragMoveLocation=P.lngLat},kr.onTouchEnd=kr.onMouseUp=function(b,P){var V=this;if(b.dragMoving)this.fireUpdate();else if(b.boxSelecting){var oe=[b.boxSelectStartLocation,vn(P.originalEvent,this.map.getContainer())],ge=this.featuresAt(null,oe,"click"),_e=this.getUniqueIds(ge).filter(function(Ee){return!V.isSelected(Ee)});_e.length&&(this.select(_e),_e.forEach(function(Ee){return V.doRender(Ee)}),this.updateUIClasses({mouse:W.MOVE}))}this.stopExtendedInteractions(b)},kr.toDisplayFeatures=function(b,P,V){P.properties.active=this.isSelected(P.properties.id)?Ie.ACTIVE:Ie.INACTIVE,V(P),this.fireActionable(),P.properties.active===Ie.ACTIVE&&P.geometry.type!==X.POINT&&Er(P).forEach(V)},kr.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},kr.onCombineFeatures=function(){var b=this.getSelected();if(!(b.length===0||b.length<2)){for(var P=[],V=[],oe=b[0].type.replace("Multi",""),ge=0;ge<b.length;ge++){var _e=b[ge];if(_e.type.replace("Multi","")!==oe)return;_e.type.includes("Multi")?_e.getCoordinates().forEach(function(Je){P.push(Je)}):P.push(_e.getCoordinates()),V.push(_e.toGeoJSON())}if(V.length>1){var Ee=this.newFeature({type:X.FEATURE,properties:V[0].properties,geometry:{type:"Multi"+oe,coordinates:P}});this.addFeature(Ee),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([Ee.id]),this.map.fire(ye.COMBINE_FEATURES,{createdFeatures:[Ee.toGeoJSON()],deletedFeatures:V})}this.fireActionable()}},kr.onUncombineFeatures=function(){var b=this,P=this.getSelected();if(P.length!==0){for(var V=[],oe=[],ge=function(Ee){var Je=P[Ee];b.isInstanceOf("MultiFeature",Je)&&(Je.getFeatures().forEach(function(lt){b.addFeature(lt),lt.properties=Je.properties,V.push(lt.toGeoJSON()),b.select([lt.id])}),b.deleteFeature(Je.id,{silent:!0}),oe.push(Je.toGeoJSON()))},_e=0;_e<P.length;_e++)ge(_e);V.length>1&&this.map.fire(ye.UNCOMBINE_FEATURES,{createdFeatures:V,deletedFeatures:oe}),this.fireActionable()}};var kn=Kt(ee.VERTEX),wn=Kt(ee.MIDPOINT),Wn={fireUpdate:function(){this.map.fire(ye.UPDATE,{action:we.CHANGE_COORDINATES,features:this.getSelected().map(function(b){return b.toGeoJSON()})})},fireActionable:function(b){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:b.selectedCoordPaths.length>0})},startDragging:function(b,P){this.map.dragPan.disable(),b.canDragMove=!0,b.dragMoveLocation=P.lngLat},stopDragging:function(b){this.map.dragPan.enable(),b.dragMoving=!1,b.canDragMove=!1,b.dragMoveLocation=null},onVertex:function(b,P){this.startDragging(b,P);var V=P.featureTarget.properties,oe=b.selectedCoordPaths.indexOf(V.coord_path);Qi(P)||oe!==-1?Qi(P)&&oe===-1&&b.selectedCoordPaths.push(V.coord_path):b.selectedCoordPaths=[V.coord_path];var ge=this.pathsToCoordinates(b.featureId,b.selectedCoordPaths);this.setSelectedCoordinates(ge)},onMidpoint:function(b,P){this.startDragging(b,P);var V=P.featureTarget.properties;b.feature.addCoordinate(V.coord_path,V.lng,V.lat),this.fireUpdate(),b.selectedCoordPaths=[V.coord_path]},pathsToCoordinates:function(b,P){return P.map(function(V){return{feature_id:b,coord_path:V}})},onFeature:function(b,P){b.selectedCoordPaths.length===0?this.startDragging(b,P):this.stopDragging(b)},dragFeature:function(b,P,V){lo(this.getSelected(),V),b.dragMoveLocation=P.lngLat},dragVertex:function(b,P,V){for(var oe=b.selectedCoordPaths.map(function(Je){return b.feature.getCoordinate(Je)}),ge=Vi(oe.map(function(Je){return{type:X.FEATURE,properties:{},geometry:{type:X.POINT,coordinates:Je}}}),V),_e=0;_e<oe.length;_e++){var Ee=oe[_e];b.feature.updateCoordinate(b.selectedCoordPaths[_e],Ee[0]+ge.lng,Ee[1]+ge.lat)}},clickNoTarget:function(){this.changeMode(fe.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(fe.SIMPLE_SELECT)},clickActiveFeature:function(b){b.selectedCoordPaths=[],this.clearSelectedCoordinates(),b.feature.changed()},onSetup:function(b){var P=b.featureId,V=this.getFeature(P);if(!V)throw new Error("You must provide a featureId to enter direct_select mode");if(V.type===X.POINT)throw new TypeError("direct_select mode doesn't handle point features");var oe={featureId:P,feature:V,dragMoveLocation:b.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:b.coordPath?[b.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(P,oe.selectedCoordPaths)),this.setSelected(P),ie.disable(this),this.setActionableState({trash:!0}),oe},onStop:function(){ie.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(b,P,V){b.featureId===P.properties.id?(P.properties.active=Ie.ACTIVE,V(P),Er(P,{map:this.map,midpoints:!0,selectedPaths:b.selectedCoordPaths}).forEach(V)):(P.properties.active=Ie.INACTIVE,V(P)),this.fireActionable(b)},onTrash:function(b){b.selectedCoordPaths.sort(function(P,V){return V.localeCompare(P,"en",{numeric:!0})}).forEach(function(P){return b.feature.removeCoordinate(P)}),this.fireUpdate(),b.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(b),b.feature.isValid()===!1&&(this.deleteFeature([b.featureId]),this.changeMode(fe.SIMPLE_SELECT,{}))},onMouseMove:function(b,P){var V=Jt(P),oe=kn(P),ge=wn(P),_e=b.selectedCoordPaths.length===0;return V&&_e||oe&&!_e?this.updateUIClasses({mouse:W.MOVE}):this.updateUIClasses({mouse:W.NONE}),(oe||V||ge)&&b.dragMoving&&this.fireUpdate(),this.stopDragging(b),!0},onMouseOut:function(b){return b.dragMoving&&this.fireUpdate(),!0}};Wn.onTouchStart=Wn.onMouseDown=function(b,P){return kn(P)?this.onVertex(b,P):Jt(P)?this.onFeature(b,P):wn(P)?this.onMidpoint(b,P):void 0},Wn.onDrag=function(b,P){if(b.canDragMove===!0){b.dragMoving=!0,P.originalEvent.stopPropagation();var V={lng:P.lngLat.lng-b.dragMoveLocation.lng,lat:P.lngLat.lat-b.dragMoveLocation.lat};b.selectedCoordPaths.length>0?this.dragVertex(b,P,V):this.dragFeature(b,P,V),b.dragMoveLocation=P.lngLat}},Wn.onClick=function(b,P){return Ti(P)?this.clickNoTarget(b,P):Jt(P)?this.clickActiveFeature(b,P):yi(P)?this.clickInactive(b,P):void this.stopDragging(b)},Wn.onTap=function(b,P){return Ti(P)?this.clickNoTarget(b,P):Jt(P)?this.clickActiveFeature(b,P):yi(P)?this.clickInactive(b,P):void 0},Wn.onTouchEnd=Wn.onMouseUp=function(b){b.dragMoving&&this.fireUpdate(),this.stopDragging(b)};var Dr={};function Mn(b,P){return!!b.lngLat&&b.lngLat.lng===P[0]&&b.lngLat.lat===P[1]}Dr.onSetup=function(){var b=this.newFeature({type:X.FEATURE,properties:{},geometry:{type:X.POINT,coordinates:[]}});return this.addFeature(b),this.clearSelectedFeatures(),this.updateUIClasses({mouse:W.ADD}),this.activateUIButton(Z.POINT),this.setActionableState({trash:!0}),{point:b}},Dr.stopDrawingAndRemove=function(b){this.deleteFeature([b.point.id],{silent:!0}),this.changeMode(fe.SIMPLE_SELECT)},Dr.onTap=Dr.onClick=function(b,P){this.updateUIClasses({mouse:W.MOVE}),b.point.updateCoordinate("",P.lngLat.lng,P.lngLat.lat),this.map.fire(ye.CREATE,{features:[b.point.toGeoJSON()]}),this.changeMode(fe.SIMPLE_SELECT,{featureIds:[b.point.id]})},Dr.onStop=function(b){this.activateUIButton(),b.point.getCoordinate().length||this.deleteFeature([b.point.id],{silent:!0})},Dr.toDisplayFeatures=function(b,P,V){var oe=P.properties.id===b.point.id;if(P.properties.active=oe?Ie.ACTIVE:Ie.INACTIVE,!oe)return V(P)},Dr.onTrash=Dr.stopDrawingAndRemove,Dr.onKeyUp=function(b,P){if(_n(P)||Sr(P))return this.stopDrawingAndRemove(b,P)};var Zn={onSetup:function(){var b=this.newFeature({type:X.FEATURE,properties:{},geometry:{type:X.POLYGON,coordinates:[[]]}});return this.addFeature(b),this.clearSelectedFeatures(),ie.disable(this),this.updateUIClasses({mouse:W.ADD}),this.activateUIButton(Z.POLYGON),this.setActionableState({trash:!0}),{polygon:b,currentVertexPosition:0}},clickAnywhere:function(b,P){if(b.currentVertexPosition>0&&Mn(P,b.polygon.coordinates[0][b.currentVertexPosition-1]))return this.changeMode(fe.SIMPLE_SELECT,{featureIds:[b.polygon.id]});this.updateUIClasses({mouse:W.ADD}),b.polygon.updateCoordinate("0."+b.currentVertexPosition,P.lngLat.lng,P.lngLat.lat),b.currentVertexPosition++,b.polygon.updateCoordinate("0."+b.currentVertexPosition,P.lngLat.lng,P.lngLat.lat)},clickOnVertex:function(b){return this.changeMode(fe.SIMPLE_SELECT,{featureIds:[b.polygon.id]})},onMouseMove:function(b,P){b.polygon.updateCoordinate("0."+b.currentVertexPosition,P.lngLat.lng,P.lngLat.lat),Ni(P)&&this.updateUIClasses({mouse:W.POINTER})}};Zn.onTap=Zn.onClick=function(b,P){return Ni(P)?this.clickOnVertex(b,P):this.clickAnywhere(b,P)},Zn.onKeyUp=function(b,P){_n(P)?(this.deleteFeature([b.polygon.id],{silent:!0}),this.changeMode(fe.SIMPLE_SELECT)):Sr(P)&&this.changeMode(fe.SIMPLE_SELECT,{featureIds:[b.polygon.id]})},Zn.onStop=function(b){this.updateUIClasses({mouse:W.NONE}),ie.enable(this),this.activateUIButton(),this.getFeature(b.polygon.id)!==void 0&&(b.polygon.removeCoordinate("0."+b.currentVertexPosition),b.polygon.isValid()?this.map.fire(ye.CREATE,{features:[b.polygon.toGeoJSON()]}):(this.deleteFeature([b.polygon.id],{silent:!0}),this.changeMode(fe.SIMPLE_SELECT,{},{silent:!0})))},Zn.toDisplayFeatures=function(b,P,V){var oe=P.properties.id===b.polygon.id;if(P.properties.active=oe?Ie.ACTIVE:Ie.INACTIVE,!oe)return V(P);if(P.geometry.coordinates.length!==0){var ge=P.geometry.coordinates[0].length;if(!(ge<3)){if(P.properties.meta=ee.FEATURE,V(ii(b.polygon.id,P.geometry.coordinates[0][0],"0.0",!1)),ge>3){var _e=P.geometry.coordinates[0].length-3;V(ii(b.polygon.id,P.geometry.coordinates[0][_e],"0."+_e,!1))}if(ge<=4){var Ee=[[P.geometry.coordinates[0][0][0],P.geometry.coordinates[0][0][1]],[P.geometry.coordinates[0][1][0],P.geometry.coordinates[0][1][1]]];if(V({type:X.FEATURE,properties:P.properties,geometry:{coordinates:Ee,type:X.LINE_STRING}}),ge===3)return}return V(P)}}},Zn.onTrash=function(b){this.deleteFeature([b.polygon.id],{silent:!0}),this.changeMode(fe.SIMPLE_SELECT)};var bs={onSetup:function(b){var P,V,oe=(b=b||{}).featureId,ge="forward";if(oe){if(!(P=this.getFeature(oe)))throw new Error("Could not find a feature with the provided featureId");var _e=b.from;if(_e&&_e.type==="Feature"&&_e.geometry&&_e.geometry.type==="Point"&&(_e=_e.geometry),_e&&_e.type==="Point"&&_e.coordinates&&_e.coordinates.length===2&&(_e=_e.coordinates),!_e||!Array.isArray(_e))throw new Error("Please use the `from` property to indicate which point to continue the line from");var Ee=P.coordinates.length-1;if(P.coordinates[Ee][0]===_e[0]&&P.coordinates[Ee][1]===_e[1])V=Ee+1,P.addCoordinate.apply(P,[V].concat(P.coordinates[Ee]));else{if(P.coordinates[0][0]!==_e[0]||P.coordinates[0][1]!==_e[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");ge="backwards",V=0,P.addCoordinate.apply(P,[V].concat(P.coordinates[0]))}}else P=this.newFeature({type:X.FEATURE,properties:{},geometry:{type:X.LINE_STRING,coordinates:[]}}),V=0,this.addFeature(P);return this.clearSelectedFeatures(),ie.disable(this),this.updateUIClasses({mouse:W.ADD}),this.activateUIButton(Z.LINE),this.setActionableState({trash:!0}),{line:P,currentVertexPosition:V,direction:ge}},clickAnywhere:function(b,P){if(b.currentVertexPosition>0&&Mn(P,b.line.coordinates[b.currentVertexPosition-1])||b.direction==="backwards"&&Mn(P,b.line.coordinates[b.currentVertexPosition+1]))return this.changeMode(fe.SIMPLE_SELECT,{featureIds:[b.line.id]});this.updateUIClasses({mouse:W.ADD}),b.line.updateCoordinate(b.currentVertexPosition,P.lngLat.lng,P.lngLat.lat),b.direction==="forward"?(b.currentVertexPosition++,b.line.updateCoordinate(b.currentVertexPosition,P.lngLat.lng,P.lngLat.lat)):b.line.addCoordinate(0,P.lngLat.lng,P.lngLat.lat)},clickOnVertex:function(b){return this.changeMode(fe.SIMPLE_SELECT,{featureIds:[b.line.id]})},onMouseMove:function(b,P){b.line.updateCoordinate(b.currentVertexPosition,P.lngLat.lng,P.lngLat.lat),Ni(P)&&this.updateUIClasses({mouse:W.POINTER})}};bs.onTap=bs.onClick=function(b,P){if(Ni(P))return this.clickOnVertex(b,P);this.clickAnywhere(b,P)},bs.onKeyUp=function(b,P){Sr(P)?this.changeMode(fe.SIMPLE_SELECT,{featureIds:[b.line.id]}):_n(P)&&(this.deleteFeature([b.line.id],{silent:!0}),this.changeMode(fe.SIMPLE_SELECT))},bs.onStop=function(b){ie.enable(this),this.activateUIButton(),this.getFeature(b.line.id)!==void 0&&(b.line.removeCoordinate(""+b.currentVertexPosition),b.line.isValid()?this.map.fire(ye.CREATE,{features:[b.line.toGeoJSON()]}):(this.deleteFeature([b.line.id],{silent:!0}),this.changeMode(fe.SIMPLE_SELECT,{},{silent:!0})))},bs.onTrash=function(b){this.deleteFeature([b.line.id],{silent:!0}),this.changeMode(fe.SIMPLE_SELECT)},bs.toDisplayFeatures=function(b,P,V){var oe=P.properties.id===b.line.id;if(P.properties.active=oe?Ie.ACTIVE:Ie.INACTIVE,!oe)return V(P);P.geometry.coordinates.length<2||(P.properties.meta=ee.FEATURE,V(ii(b.line.id,P.geometry.coordinates[b.direction==="forward"?P.geometry.coordinates.length-2:1],""+(b.direction==="forward"?P.geometry.coordinates.length-2:1),!1)),V(P))};var Lr={simple_select:kr,direct_select:Wn,draw_point:Dr,draw_polygon:Zn,draw_line_string:bs},co={defaultMode:fe.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:Dt,modes:Lr,controls:{},userProperties:!1},ia={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},pr={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function uo(b,P){return b.map(function(V){return V.source?V:Be(V,{id:V.id+"."+P,source:P==="hot"?z.HOT:z.COLD})})}var Sn={exports:{}};(function(b,P){var V="__lodash_hash_undefined__",oe=9007199254740991,ge="[object Arguments]",_e="[object Array]",Ee="[object Boolean]",Je="[object Date]",lt="[object Error]",Mt="[object Function]",St="[object Map]",pt="[object Number]",oi="[object Object]",fr="[object Promise]",hi="[object RegExp]",Rr="[object Set]",qe="[object String]",Bt="[object Symbol]",xi="[object WeakMap]",Tr="[object ArrayBuffer]",vr="[object DataView]",va=/^\[object .+?Constructor\]$/,fo=/^(?:0|[1-9]\d*)$/,Ki={};Ki["[object Float32Array]"]=Ki["[object Float64Array]"]=Ki["[object Int8Array]"]=Ki["[object Int16Array]"]=Ki["[object Int32Array]"]=Ki["[object Uint8Array]"]=Ki["[object Uint8ClampedArray]"]=Ki["[object Uint16Array]"]=Ki["[object Uint32Array]"]=!0,Ki[ge]=Ki[_e]=Ki[Tr]=Ki[Ee]=Ki[vr]=Ki[Je]=Ki[lt]=Ki[Mt]=Ki[St]=Ki[pt]=Ki[oi]=Ki[hi]=Ki[Rr]=Ki[qe]=Ki[xi]=!1;var $a=typeof Kc=="object"&&Kc&&Kc.Object===Object&&Kc,Su=typeof self=="object"&&self&&self.Object===Object&&self,Vs=$a||Su||Function("return this")(),Il=P&&!P.nodeType&&P,yc=Il&&b&&!b.nodeType&&b,ra=yc&&yc.exports===Il,Ua=ra&&$a.process,fn=function(){try{return Ua&&Ua.binding&&Ua.binding("util")}catch{}}(),en=fn&&fn.isTypedArray;function Fi(Te,Re){for(var mt=-1,Xt=Te==null?0:Te.length;++mt<Xt;)if(Re(Te[mt],mt,Te))return!0;return!1}function Fo(Te){var Re=-1,mt=Array(Te.size);return Te.forEach(function(Xt,rr){mt[++Re]=[rr,Xt]}),mt}function Bo(Te){var Re=-1,mt=Array(Te.size);return Te.forEach(function(Xt){mt[++Re]=Xt}),mt}var No,$o,mo,Al=Array.prototype,Pl=Function.prototype,xa=Object.prototype,Uo=Vs["__core-js_shared__"],kl=Pl.toString,En=xa.hasOwnProperty,_c=(No=/[^.]+$/.exec(Uo&&Uo.keys&&Uo.keys.IE_PROTO||""))?"Symbol(src)_1."+No:"",vc=xa.toString,Eu=RegExp("^"+kl.call(En).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),xc=ra?Vs.Buffer:void 0,Vo=Vs.Symbol,bc=Vs.Uint8Array,jo=xa.propertyIsEnumerable,qo=Al.splice,js=Vo?Vo.toStringTag:void 0,Go=Object.getOwnPropertySymbols,Va=xc?xc.isBuffer:void 0,wc=($o=Object.keys,mo=Object,function(Te){return $o(mo(Te))}),Ho=Sa(Vs,"DataView"),ba=Sa(Vs,"Map"),qs=Sa(Vs,"Promise"),Wo=Sa(Vs,"Set"),na=Sa(Vs,"WeakMap"),ws=Sa(Object,"create"),Mc=aa(Ho),Dl=aa(ba),Di=aa(qs),Zo=aa(Wo),Tu=aa(na),Ll=Vo?Vo.prototype:void 0,wa=Ll?Ll.valueOf:void 0;function ir(Te){var Re=-1,mt=Te==null?0:Te.length;for(this.clear();++Re<mt;){var Xt=Te[Re];this.set(Xt[0],Xt[1])}}function Gs(Te){var Re=-1,mt=Te==null?0:Te.length;for(this.clear();++Re<mt;){var Xt=Te[Re];this.set(Xt[0],Xt[1])}}function fi(Te){var Re=-1,mt=Te==null?0:Te.length;for(this.clear();++Re<mt;){var Xt=Te[Re];this.set(Xt[0],Xt[1])}}function ja(Te){var Re=-1,mt=Te==null?0:Te.length;for(this.__data__=new fi;++Re<mt;)this.add(Te[Re])}function $i(Te){var Re=this.__data__=new Gs(Te);this.size=Re.size}function er(Te,Re){var mt=qa(Te),Xt=!mt&&Qo(Te),rr=!mt&&!Xt&&Bl(Te),Ci=!mt&&!Xt&&!rr&&el(Te),gr=mt||Xt||rr||Ci,Cr=gr?function(Nr,cs){for(var Ss=-1,mn=Array(Nr);++Ss<Nr;)mn[Ss]=cs(Ss);return mn}(Te.length,String):[],Tn=Cr.length;for(var ur in Te)!Re&&!En.call(Te,ur)||gr&&(ur=="length"||rr&&(ur=="offset"||ur=="parent")||Ci&&(ur=="buffer"||ur=="byteLength"||ur=="byteOffset")||Ol(ur,Tn))||Cr.push(ur);return Cr}function Ms(Te,Re){for(var mt=Te.length;mt--;)if(Fl(Te[mt][0],Re))return mt;return-1}function sa(Te){return Te==null?Te===void 0?"[object Undefined]":"[object Null]":js&&js in Object(Te)?function(Re){var mt=En.call(Re,js),Xt=Re[js];try{Re[js]=void 0;var rr=!0}catch{}var Ci=vc.call(Re);return rr&&(mt?Re[js]=Xt:delete Re[js]),Ci}(Te):function(Re){return vc.call(Re)}(Te)}function Xo(Te){return jr(Te)&&sa(Te)==ge}function Rl(Te,Re,mt,Xt,rr){return Te===Re||(Te==null||Re==null||!jr(Te)&&!jr(Re)?Te!=Te&&Re!=Re:function(Ci,gr,Cr,Tn,ur,Nr){var cs=qa(Ci),Ss=qa(gr),mn=cs?_e:ls(Ci),Fn=Ss?_e:ls(gr),Es=(mn=mn==ge?oi:mn)==oi,tn=(Fn=Fn==ge?oi:Fn)==oi,Cn=mn==Fn;if(Cn&&Bl(Ci)){if(!Bl(gr))return!1;cs=!0,Es=!1}if(Cn&&!Es)return Nr||(Nr=new $i),cs||el(Ci)?go(Ci,gr,Cr,Tn,ur,Nr):function(Ai,Ri,il,Cs,$l,rn,Bn){switch(il){case vr:if(Ai.byteLength!=Ri.byteLength||Ai.byteOffset!=Ri.byteOffset)return!1;Ai=Ai.buffer,Ri=Ri.buffer;case Tr:return!(Ai.byteLength!=Ri.byteLength||!rn(new bc(Ai),new bc(Ri)));case Ee:case Je:case pt:return Fl(+Ai,+Ri);case lt:return Ai.name==Ri.name&&Ai.message==Ri.message;case hi:case qe:return Ai==Ri+"";case St:var nn=Fo;case Rr:var Ct=1&Cs;if(nn||(nn=Bo),Ai.size!=Ri.size&&!Ct)return!1;var Ta=Bn.get(Ai);if(Ta)return Ta==Ri;Cs|=2,Bn.set(Ai,Ri);var us=go(nn(Ai),nn(Ri),Cs,$l,rn,Bn);return Bn.delete(Ai),us;case Bt:if(wa)return wa.call(Ai)==wa.call(Ri)}return!1}(Ci,gr,mn,Cr,Tn,ur,Nr);if(!(1&Cr)){var Ea=Es&&En.call(Ci,"__wrapped__"),Xn=tn&&En.call(gr,"__wrapped__");if(Ea||Xn){var Ts=Ea?Ci.value():Ci,Ga=Xn?gr.value():gr;return Nr||(Nr=new $i),ur(Ts,Ga,Cr,Tn,Nr)}}return Cn?(Nr||(Nr=new $i),function(Ai,Ri,il,Cs,$l,rn){var Bn=1&il,nn=zl(Ai),Ct=nn.length,Ta=zl(Ri).length;if(Ct!=Ta&&!Bn)return!1;for(var us=Ct;us--;){var Kn=nn[us];if(!(Bn?Kn in Ri:En.call(Ri,Kn)))return!1}var Ul=rn.get(Ai);if(Ul&&rn.get(Ri))return Ul==Ri;var vt=!0;rn.set(Ai,Ri),rn.set(Ri,Ai);for(var oa=Bn;++us<Ct;){var yo=Ai[Kn=nn[us]],_o=Ri[Kn];if(Cs)var vo=Bn?Cs(_o,yo,Kn,Ri,Ai,rn):Cs(yo,_o,Kn,Ai,Ri,rn);if(!(vo===void 0?yo===_o||$l(yo,_o,il,Cs,rn):vo)){vt=!1;break}oa||(oa=Kn=="constructor")}if(vt&&!oa){var Ha=Ai.constructor,Ca=Ri.constructor;Ha==Ca||!("constructor"in Ai)||!("constructor"in Ri)||typeof Ha=="function"&&Ha instanceof Ha&&typeof Ca=="function"&&Ca instanceof Ca||(vt=!1)}return rn.delete(Ai),rn.delete(Ri),vt}(Ci,gr,Cr,Tn,ur,Nr)):!1}(Te,Re,mt,Xt,Rl,rr))}function Ko(Te){return!(!Hs(Te)||function(Re){return!!_c&&_c in Re}(Te))&&(Nl(Te)?Eu:va).test(aa(Te))}function Yo(Te){if(mt=(Re=Te)&&Re.constructor,Xt=typeof mt=="function"&&mt.prototype||xa,Re!==Xt)return wc(Te);var Re,mt,Xt,rr=[];for(var Ci in Object(Te))En.call(Te,Ci)&&Ci!="constructor"&&rr.push(Ci);return rr}function go(Te,Re,mt,Xt,rr,Ci){var gr=1&mt,Cr=Te.length,Tn=Re.length;if(Cr!=Tn&&!(gr&&Tn>Cr))return!1;var ur=Ci.get(Te);if(ur&&Ci.get(Re))return ur==Re;var Nr=-1,cs=!0,Ss=2&mt?new ja:void 0;for(Ci.set(Te,Re),Ci.set(Re,Te);++Nr<Cr;){var mn=Te[Nr],Fn=Re[Nr];if(Xt)var Es=gr?Xt(Fn,mn,Nr,Re,Te,Ci):Xt(mn,Fn,Nr,Te,Re,Ci);if(Es!==void 0){if(Es)continue;cs=!1;break}if(Ss){if(!Fi(Re,function(tn,Cn){if(Ea=Cn,!Ss.has(Ea)&&(mn===tn||rr(mn,tn,mt,Xt,Ci)))return Ss.push(Cn);var Ea})){cs=!1;break}}else if(mn!==Fn&&!rr(mn,Fn,mt,Xt,Ci)){cs=!1;break}}return Ci.delete(Te),Ci.delete(Re),cs}function zl(Te){return function(Re,mt,Xt){var rr=mt(Re);return qa(Re)?rr:function(Ci,gr){for(var Cr=-1,Tn=gr.length,ur=Ci.length;++Cr<Tn;)Ci[ur+Cr]=gr[Cr];return Ci}(rr,Xt(Re))}(Te,tl,Jo)}function Ma(Te,Re){var mt,Xt,rr=Te.__data__;return((Xt=typeof(mt=Re))=="string"||Xt=="number"||Xt=="symbol"||Xt=="boolean"?mt!=="__proto__":mt===null)?rr[typeof Re=="string"?"string":"hash"]:rr.map}function Sa(Te,Re){var mt=function(Xt,rr){return Xt==null?void 0:Xt[rr]}(Te,Re);return Ko(mt)?mt:void 0}ir.prototype.clear=function(){this.__data__=ws?ws(null):{},this.size=0},ir.prototype.delete=function(Te){var Re=this.has(Te)&&delete this.__data__[Te];return this.size-=Re?1:0,Re},ir.prototype.get=function(Te){var Re=this.__data__;if(ws){var mt=Re[Te];return mt===V?void 0:mt}return En.call(Re,Te)?Re[Te]:void 0},ir.prototype.has=function(Te){var Re=this.__data__;return ws?Re[Te]!==void 0:En.call(Re,Te)},ir.prototype.set=function(Te,Re){var mt=this.__data__;return this.size+=this.has(Te)?0:1,mt[Te]=ws&&Re===void 0?V:Re,this},Gs.prototype.clear=function(){this.__data__=[],this.size=0},Gs.prototype.delete=function(Te){var Re=this.__data__,mt=Ms(Re,Te);return!(mt<0)&&(mt==Re.length-1?Re.pop():qo.call(Re,mt,1),--this.size,!0)},Gs.prototype.get=function(Te){var Re=this.__data__,mt=Ms(Re,Te);return mt<0?void 0:Re[mt][1]},Gs.prototype.has=function(Te){return Ms(this.__data__,Te)>-1},Gs.prototype.set=function(Te,Re){var mt=this.__data__,Xt=Ms(mt,Te);return Xt<0?(++this.size,mt.push([Te,Re])):mt[Xt][1]=Re,this},fi.prototype.clear=function(){this.size=0,this.__data__={hash:new ir,map:new(ba||Gs),string:new ir}},fi.prototype.delete=function(Te){var Re=Ma(this,Te).delete(Te);return this.size-=Re?1:0,Re},fi.prototype.get=function(Te){return Ma(this,Te).get(Te)},fi.prototype.has=function(Te){return Ma(this,Te).has(Te)},fi.prototype.set=function(Te,Re){var mt=Ma(this,Te),Xt=mt.size;return mt.set(Te,Re),this.size+=mt.size==Xt?0:1,this},ja.prototype.add=ja.prototype.push=function(Te){return this.__data__.set(Te,V),this},ja.prototype.has=function(Te){return this.__data__.has(Te)},$i.prototype.clear=function(){this.__data__=new Gs,this.size=0},$i.prototype.delete=function(Te){var Re=this.__data__,mt=Re.delete(Te);return this.size=Re.size,mt},$i.prototype.get=function(Te){return this.__data__.get(Te)},$i.prototype.has=function(Te){return this.__data__.has(Te)},$i.prototype.set=function(Te,Re){var mt=this.__data__;if(mt instanceof Gs){var Xt=mt.__data__;if(!ba||Xt.length<199)return Xt.push([Te,Re]),this.size=++mt.size,this;mt=this.__data__=new fi(Xt)}return mt.set(Te,Re),this.size=mt.size,this};var Jo=Go?function(Te){return Te==null?[]:(Te=Object(Te),function(Re,mt){for(var Xt=-1,rr=Re==null?0:Re.length,Ci=0,gr=[];++Xt<rr;){var Cr=Re[Xt];mt(Cr,Xt,Re)&&(gr[Ci++]=Cr)}return gr}(Go(Te),function(Re){return jo.call(Te,Re)}))}:function(){return[]},ls=sa;function Ol(Te,Re){return!!(Re=Re??oe)&&(typeof Te=="number"||fo.test(Te))&&Te>-1&&Te%1==0&&Te<Re}function aa(Te){if(Te!=null){try{return kl.call(Te)}catch{}try{return Te+""}catch{}}return""}function Fl(Te,Re){return Te===Re||Te!=Te&&Re!=Re}(Ho&&ls(new Ho(new ArrayBuffer(1)))!=vr||ba&&ls(new ba)!=St||qs&&ls(qs.resolve())!=fr||Wo&&ls(new Wo)!=Rr||na&&ls(new na)!=xi)&&(ls=function(Te){var Re=sa(Te),mt=Re==oi?Te.constructor:void 0,Xt=mt?aa(mt):"";if(Xt)switch(Xt){case Mc:return vr;case Dl:return St;case Di:return fr;case Zo:return Rr;case Tu:return xi}return Re});var Qo=Xo(function(){return arguments}())?Xo:function(Te){return jr(Te)&&En.call(Te,"callee")&&!jo.call(Te,"callee")},qa=Array.isArray,Bl=Va||function(){return!1};function Nl(Te){if(!Hs(Te))return!1;var Re=sa(Te);return Re==Mt||Re=="[object GeneratorFunction]"||Re=="[object AsyncFunction]"||Re=="[object Proxy]"}function mr(Te){return typeof Te=="number"&&Te>-1&&Te%1==0&&Te<=oe}function Hs(Te){var Re=typeof Te;return Te!=null&&(Re=="object"||Re=="function")}function jr(Te){return Te!=null&&typeof Te=="object"}var el=en?function(Te){return function(Re){return Te(Re)}}(en):function(Te){return jr(Te)&&mr(Te.length)&&!!Ki[sa(Te)]};function tl(Te){return(Re=Te)!=null&&mr(Re.length)&&!Nl(Re)?er(Te):Yo(Te);var Re}b.exports=function(Te,Re){return Rl(Te,Re)}})(Sn,Sn.exports);var ho=u(Sn.exports);function os(b,P){return b.length===P.length&&JSON.stringify(b.map(function(V){return V}).sort())===JSON.stringify(P.map(function(V){return V}).sort())}var po={Polygon:Mi,LineString:ji,Point:Xi,MultiPolygon:ut,MultiLineString:ut,MultiPoint:ut},Hi=Object.freeze({__proto__:null,CommonSelectors:at,constrainFeatureMovement:Vi,createMidPoint:ta,createSupplementaryPoints:Er,createVertex:ii,doubleClickZoom:ie,euclideanDistance:$t,featuresAt:ci,getFeatureAtAndSetCursors:kt,isClick:ai,isEventAtCoordinates:Mn,isTap:Zi,mapEventToBoundingBox:Lt,ModeHandler:a,moveFeatures:lo,sortFeatures:Ot,stringSetsAreEqual:os,StringSet:li,theme:Dt,toDenseArray:ue}),Oo=function(b,P){var V={options:b=function(ge){ge===void 0&&(ge={});var _e=Be(ge);return ge.controls||(_e.controls={}),ge.displayControlsDefault===!1?_e.controls=Be(pr,ge.controls):_e.controls=Be(ia,ge.controls),(_e=Be(co,_e)).styles=uo(_e.styles,"cold").concat(uo(_e.styles,"hot")),_e}(b)};P=function(ge,_e){return _e.modes=fe,_e.getFeatureIdsAt=function(Ee){return ci.click({point:Ee},null,ge).map(function(Je){return Je.properties.id})},_e.getSelectedIds=function(){return ge.store.getSelectedIds()},_e.getSelected=function(){return{type:X.FEATURE_COLLECTION,features:ge.store.getSelectedIds().map(function(Ee){return ge.store.get(Ee)}).map(function(Ee){return Ee.toGeoJSON()})}},_e.getSelectedPoints=function(){return{type:X.FEATURE_COLLECTION,features:ge.store.getSelectedCoordinates().map(function(Ee){return{type:X.FEATURE,properties:{},geometry:{type:X.POINT,coordinates:Ee.coordinates}}})}},_e.set=function(Ee){if(Ee.type===void 0||Ee.type!==X.FEATURE_COLLECTION||!Array.isArray(Ee.features))throw new Error("Invalid FeatureCollection");var Je=ge.store.createRenderBatch(),lt=ge.store.getAllIds().slice(),Mt=_e.add(Ee),St=new li(Mt);return(lt=lt.filter(function(pt){return!St.has(pt)})).length&&_e.delete(lt),Je(),Mt},_e.add=function(Ee){var Je=JSON.parse(JSON.stringify(Q(Ee))).features.map(function(lt){if(lt.id=lt.id||it(),lt.geometry===null)throw new Error("Invalid geometry: null");if(ge.store.get(lt.id)===void 0||ge.store.get(lt.id).type!==lt.geometry.type){var Mt=po[lt.geometry.type];if(Mt===void 0)throw new Error("Invalid geometry type: "+lt.geometry.type+".");var St=new Mt(ge,lt);ge.store.add(St)}else{var pt=ge.store.get(lt.id);pt.properties=lt.properties,ho(pt.properties,lt.properties)||ge.store.featureChanged(pt.id),ho(pt.getCoordinates(),lt.geometry.coordinates)||pt.incomingCoords(lt.geometry.coordinates)}return lt.id});return ge.store.render(),Je},_e.get=function(Ee){var Je=ge.store.get(Ee);if(Je)return Je.toGeoJSON()},_e.getAll=function(){return{type:X.FEATURE_COLLECTION,features:ge.store.getAll().map(function(Ee){return Ee.toGeoJSON()})}},_e.delete=function(Ee){return ge.store.delete(Ee,{silent:!0}),_e.getMode()!==fe.DIRECT_SELECT||ge.store.getSelectedIds().length?ge.store.render():ge.events.changeMode(fe.SIMPLE_SELECT,void 0,{silent:!0}),_e},_e.deleteAll=function(){return ge.store.delete(ge.store.getAllIds(),{silent:!0}),_e.getMode()===fe.DIRECT_SELECT?ge.events.changeMode(fe.SIMPLE_SELECT,void 0,{silent:!0}):ge.store.render(),_e},_e.changeMode=function(Ee,Je){return Je===void 0&&(Je={}),Ee===fe.SIMPLE_SELECT&&_e.getMode()===fe.SIMPLE_SELECT?(os(Je.featureIds||[],ge.store.getSelectedIds())||(ge.store.setSelected(Je.featureIds,{silent:!0}),ge.store.render()),_e):(Ee===fe.DIRECT_SELECT&&_e.getMode()===fe.DIRECT_SELECT&&Je.featureId===ge.store.getSelectedIds()[0]||ge.events.changeMode(Ee,Je,{silent:!0}),_e)},_e.getMode=function(){return ge.events.getMode()},_e.trash=function(){return ge.events.trash({silent:!0}),_e},_e.combineFeatures=function(){return ge.events.combineFeatures({silent:!0}),_e},_e.uncombineFeatures=function(){return ge.events.uncombineFeatures({silent:!0}),_e},_e.setFeatureProperty=function(Ee,Je,lt){return ge.store.setFeatureProperty(Ee,Je,lt),_e},_e}(V,P),V.api=P;var oe=rt(V);return P.onAdd=oe.onAdd,P.onRemove=oe.onRemove,P.types=Z,P.options=b,P};function Us(b){Oo(b,this)}return Us.modes=Lr,Us.constants=nt,Us.lib=Hi,Us})})(l1);var zR=l1.exports;const Ud=ig(zR),OR=e=>(qh("data-v-a4dab320"),e=e(),Gh(),e),FR=OR(()=>J("input",null,null,-1)),BR={__name:"AddressSearchControl",setup(e){const r=Wh(),a=vs("");return(u,d)=>(wt(),Ft(Mr,null,[pv(J("input",{class:"input address-input",type:"text",placeholder:"Search an address","onUpdate:modelValue":d[0]||(d[0]=g=>a.value=g),onKeydown:d[1]||(d[1]=vM(g=>zi(r).replace({name:"search",query:{address:a.value}}),["enter"]))},null,544),[[yM,a.value]]),FR,J("button",{class:"button",onClick:d[2]||(d[2]=g=>zi(r).replace({name:"search",query:{address:a.value}}))}," Search ")],64))}},NR=Fs(BR,[["__scopeId","data-v-a4dab320"]]);function $R(e,r,a,u){u===void 0&&(u={});var d=Uh(e),g=za(d[0]),m=za(d[1]),l=za(a),M=bI(r,u.units),A=Math.asin(Math.sin(m)*Math.cos(M)+Math.cos(m)*Math.sin(M)*Math.cos(l)),R=g+Math.atan2(Math.sin(l)*Math.sin(M)*Math.cos(m),Math.cos(M)-Math.sin(m)*Math.sin(A)),k=Mm(R),z=Mm(A);return Fh([k,z],u.properties)}function c1(e,r,a){if(a===void 0&&(a={}),a.final===!0)return UR(e,r);var u=Uh(e),d=Uh(r),g=za(u[0]),m=za(d[0]),l=za(u[1]),M=za(d[1]),A=Math.sin(m-g)*Math.cos(M),R=Math.cos(l)*Math.sin(M)-Math.sin(l)*Math.cos(M)*Math.cos(m-g);return Mm(Math.atan2(A,R))}function UR(e,r){var a=c1(r,e);return a=(a+180)%360,a}function S0(e,r){var a=_u(e,r),u=c1(e,r),d=$R(e,a/2,u);return d}var E0=6378137;function VR(e){return IL(e,function(r,a){return r+jR(a)},0)}function jR(e){var r=0,a;switch(e.type){case"Polygon":return T0(e.coordinates);case"MultiPolygon":for(a=0;a<e.coordinates.length;a++)r+=T0(e.coordinates[a]);return r;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function T0(e){var r=0;if(e&&e.length>0){r+=Math.abs(C0(e[0]));for(var a=1;a<e.length;a++)r-=Math.abs(C0(e[a]))}return r}function C0(e){var r,a,u,d,g,m,l,M=0,A=e.length;if(A>2){for(l=0;l<A;l++)l===A-2?(d=A-2,g=A-1,m=0):l===A-1?(d=A-1,g=0,m=1):(d=l,g=l+1,m=l+2),r=e[d],a=e[g],u=e[m],M+=(Jf(u[0])-Jf(r[0]))*Math.sin(Jf(a[1]));M=M*E0*E0/2}return M}function Jf(e){return e*Math.PI/180}const qR={name:"DistanceMeasureControl",props:{position:{type:String,default:"bottom-left"}},data(){return{mode:"simple_select",selected:null,toggledOn:!1,currentShape:null,currentArea:null,labelLayers:[]}},computed:{publicPath(){return"/vue3-atlas2/"},currentOrSelectedShape(){let e;return this.$data.selected?e=this.$data.selected:this.currentShape&&(e=this.currentShape),e},newArea(){let e=this.$data.labelLayers.filter(a=>a.id===this.currentOrSelectedShape);console.log("newArea is recalculating, shape:",e,"this.currentOrSelectedShape:",this.currentOrSelectedShape);let r;return e[0]&&(r=e[0].area),r},currentDistances(){console.log("currentDistances is recalculating");let e=this.$data.labelLayers.filter(a=>a.id===this.currentOrSelectedShape),r;return e[0]&&(r=e[0].distances),r},currentTotalLength(){let e=0;for(let r of this.currentDistances)e=e+r.distance;return e.toFixed(2)+" Ft"},shouldShowDistanceBox(){let e=this.$data.mode!=="simple_select",r=this.$data.selected!==null,a=this.$data.toggledOn,u;return e&&a||r&&a?u=!0:u=!1,u}},methods:{handleDeleteClick(e){const r=as();let a=this.labelLayers.indexOf(this.labelLayers.filter(u=>u.id===this.currentShape)[0]);this.labelLayers.splice(a,1),r.draw.delete(this.$data.selected),this.$data.selected=null},deleteDrawDistances(e){let r=this.currentShape.indexOf(this.currentShape.filter(a=>a.id===e)[0]);this.currentShape.splice(r,1),this.$data.selected=null},getDrawDistances(e){console.log("start of getDrawDistances, e:",e);let a=as().draw,u=a.getAll(),d,g,m;e&&e.point?(g=e.point,m=a.getFeatureIdsAt(g)[0],m||(m=u.features[u.features.length-1].id)):e&&e.features&&e.features.length&&(m=e.features[0].id),this.currentShape=m;let l,M;if(console.log("shapeId:",m,"draw.getSelectedIds():",a.getSelectedIds()),m?(l=u.features.filter(z=>z.id===m)[0],console.log("if shapeId:",m,"feature:",l,"feature,geometry.coordinates.length:",l.geometry.coordinates.length),l.geometry.type==="LineString"?(d=l.geometry.coordinates,console.log("its a linestring, coordinates.length:",d.length)):(console.log("its not a linestring"),d=l.geometry.coordinates[0])):(l=u.features[u.features.length-1],l&&l.geometry&&l.geometry.type==="LineString"?(console.log("its a linestring"),d=l.geometry.coordinates):l&&l.geometry&&(console.log("its not a linestring"),d=l.geometry.coordinates[0])),console.log("middle of getDrawDistances, draw:",a,"shapeId:",m,"e:",e,"mode is draw_polygon, data:",u,"coordinates:",d),e&&e.point&&(console.log("if e.point is running"),d.splice(d.length-2,1)),l&&l.geometry&&l.geometry.type==="LineString"&&(console.log("if feature.geometry.type === LineString is running"),d.splice(0,1)),d&&d.length>=4){const z=ag([d]),W=wI(VR(z),"meters","feet");console.log("calculating the area:",W),M=W.toFixed(2)+" Sq Feet"}let A,R=[],k=[];if(d)for(A=0;A<d.length;A++){let z=0,W=null,Z=[],X=[],fe;if(d[A+1]?fe=d[A+1]:fe=d[0],z=parseFloat((_u(d[A],fe,{units:"miles"})*5280).toFixed(2)),d[A-1]&&(W=parseFloat((_u(d[A-1],d[A],{units:"miles"})*5280).toFixed(2))),X={firstPoint:[parseFloat(d[A][0].toFixed(5)),parseFloat(d[A][1].toFixed(5))],midPoint:Z,distance:W},R.push(X),e.point&&d[A][0]!==fe[0]&&A<d.length-2&&(Z=S0(d[A],fe).geometry.coordinates,k.push({type:"Feature",properties:{description:z},geometry:{type:"Point",coordinates:Z}})),!e.point&&d[A][0]!==fe[0]&&A<d.length-1&&(Z=S0(d[A],fe).geometry.coordinates,k.push({type:"Feature",properties:{description:z},geometry:{type:"Point",coordinates:Z}})),e.point&&A===d.length-2)break}if(console.log("near end of getDrawDistances, currentArea:",M,"distancesArray.length:",R.length,"distancesArray:",R,"features:",k),R.length){let z={};if(m){console.log("if inside if is running, currentArea:",M,"distancesArray[distancesArray.length-1].distance:",R[R.length-1].distance,"distancesArray:",R),z={id:m,area:M,distances:R,source:{type:"geojson",data:{type:"FeatureCollection",features:[]}},layer:{id:m,type:"symbol",source:m,paint:{"text-color":"red"},layout:{"text-size":12,"text-font":["Open Sans Regular"],"text-field":["get","description"],"text-variable-anchor":["center"],"text-radial-offset":.5,"text-justify":"center"}}};let W=this.labelLayers.filter(Z=>Z.id===m)[0];W||(this.labelLayers.push(z),W=this.labelLayers.filter(Z=>Z.id===m)[0]),W.area=M,W.distances=R,W.source.data.features=k}}},handleDrawModeChange(e){console.log("handleDrawModeChange is running, e:",e,"e.mode:",e.mode),this.$data.mode=e.mode,e.mode==="draw_polygon"&&(this.$data.toggledOn=!0),this.currentShape},handleDrawCancel(e){console.log("handleDrawCancel is running, e:",e,"this.currentShape:",this.$data.currentShape);const r=as();let a=this.currentShape;if(console.log("handleDrawCancel is running, shapeId:",a),a){let u=this.$data.labelLayers.indexOf(this.$data.labelLayers.filter(d=>d.id===a)[0]);this.$data.labelLayers.splice(u,1),r.draw.delete(this.currentShape),this.$data.currentShape=null}r.draw.changeMode("simple_select"),this.$data.toggledOn=!1},handleDrawFinish(e){const r=as();let a=this.$data.currentShape,u=this.$data.labelLayers.filter(g=>g.id===this.currentShape)[0].distances;console.log("MapPanel.vue handleDrawFinish 1 is running, MapStore.draw.getMode():",r.draw.getMode(),"currentShape:",a,"fetchedPoints:",u);let d=[];for(let g of u)d.push(g.firstPoint);if(d.length>1&&d.push(u[0].firstPoint),u.length>2)r.draw.changeMode("simple_select"),this.$data.mode="simple_select";else if(u.length===2){r.draw.delete(this.currentShape),r.draw.changeMode("draw_line_string");let g={type:"Feature",geometry:{type:"LineString",coordinates:d},id:this.currentShape,properties:{}};r.draw.add(g),r.draw.changeMode("simple_select"),this.$data.mode="simple_select"}else if(u.length===1){r.draw.delete(this.currentShape),r.draw.changeMode("draw_point");let g={type:"Feature",geometry:{type:"Point",coordinates:d[0]},id:this.currentShape,properties:{}};r.draw.add(g),r.draw.changeMode("simple_select"),this.$data.mode="simple_select"}else r.draw.trash(),this.handleDrawCancel();console.log("MapPanel.vue handleDrawFinish 2 is running, MapStore.draw.getMode():",r.draw.getMode(),"currentShape:",a,"fetchedPoints:",u)},handleDrawSelectionChange(e){let u=as().draw.getSelectedIds();console.log("handleDrawSelectionChange, e:",e,"val:",u),e.features[0]?(console.log("there are features"),this.$data.selected=u[0]):(console.log("there are no features"),this.$data.selected=null)}}},GR={key:0,class:ns("measure-tool-popup-bottom-right")},HR={key:0},WR=J("div",{class:"measure-tool-header"}," Measure distances and areas ",-1),ZR=J("div",{class:"measure-tool-description"}," Start creating a measurement by adding points to the map. ",-1),XR=J("hr",{class:"popup-line"},null,-1),KR=["src"],YR={key:1},JR=J("tr",null,[J("th",null,"lat"),J("th",null,"lng"),J("th",null,"distance (ft)")],-1),QR=J("hr",{class:"popup-line"},null,-1),ez={key:0},tz=J("hr",{class:"popup-line"},null,-1),iz={key:1},rz=J("hr",{class:"popup-line"},null,-1),nz={key:2,class:"drawn-shape-actions"},sz=["src"],az={key:3,class:"draw-actions"},oz=["src"],lz=["src"];function cz(e,r,a,u,d,g){return wt(),Ft("div",null,[g.shouldShowDistanceBox?(wt(),Ft("div",GR,[g.currentDistances?Gi("",!0):(wt(),Ft("div",HR,[WR,ZR,XR,J("div",null,[J("img",{src:g.publicPath+"images/cancel.png",class:"img-class",alt:"cancel",onClick:r[0]||(r[0]=(...m)=>g.handleDrawCancel&&g.handleDrawCancel(...m))},null,8,KR),J("div",{class:"inline-block-div",onClick:r[1]||(r[1]=(...m)=>g.handleDrawCancel&&g.handleDrawCancel(...m))}," Cancel ")])])),g.currentDistances?(wt(),Ft("div",YR,[J("table",null,[JR,(wt(!0),Ft(Mr,null,Rs(g.currentDistances,(m,l)=>(wt(),Ft("tr",{key:l},[J("td",null,Ht(m.firstPoint[1]),1),J("td",null,Ht(m.firstPoint[0]),1),J("td",null,Ht(m.distance),1)]))),128))]),QR,g.currentDistances.length>=2?(wt(),Ft("div",ez,[np(" Total Length: "+Ht(g.currentTotalLength)+" ",1),tz])):Gi("",!0),g.currentDistances.length>=3?(wt(),Ft("div",iz,[np(" Total Area: "+Ht(g.newArea)+" ",1),rz])):Gi("",!0),e.mode==="simple_select"?(wt(),Ft("div",nz,[J("img",{src:g.publicPath+"images/trash.png",class:"img-class",alt:"trash",onClick:r[2]||(r[2]=(...m)=>g.handleDeleteClick&&g.handleDeleteClick(...m))},null,8,sz),J("div",{class:"inline-block-div",onClick:r[3]||(r[3]=(...m)=>g.handleDeleteClick&&g.handleDeleteClick(...m))}," Delete ")])):Gi("",!0),e.mode!=="simple_select"?(wt(),Ft("div",az,[J("img",{src:g.publicPath+"images/cancel.png",class:"img-class",alt:"cancel",onClick:r[4]||(r[4]=(...m)=>g.handleDrawCancel&&g.handleDrawCancel(...m))},null,8,oz),J("div",{class:"inline-block-div",onClick:r[5]||(r[5]=(...m)=>g.handleDrawCancel&&g.handleDrawCancel(...m))}," Cancel "),J("img",{src:g.publicPath+"images/check.png",class:"img-class",alt:"finish",onClick:r[6]||(r[6]=(...m)=>g.handleDrawFinish&&g.handleDrawFinish(...m))},null,8,lz),J("div",{class:"inline-block-div",onClick:r[7]||(r[7]=(...m)=>g.handleDrawFinish&&g.handleDrawFinish(...m))}," Finish Measurement ")])):Gi("",!0)])):Gi("",!0)])):Gi("",!0)])}const uz=Fs(qR,[["render",cz]]),hz={class:"imagery-toggle"},dz=["src"],pz={__name:"ImageryToggleControl",emits:["toggleImagery"],setup(e){const r=as(),a=gi(()=>r.imageryOn?"/vue3-atlas2/images/basemap_small.png":"/vue3-atlas2/images/imagery_small.png");return(u,d)=>(wt(),Ft("div",hz,[J("button",{type:"button",onClick:d[0]||(d[0]=g=>u.$emit("toggleImagery"))},[J("img",{class:"img-src",src:a.value},null,8,dz)])]))}},fz=Fs(pz,[["__scopeId","data-v-4e6c7b60"]]),mz={class:"dropdown-trigger"},gz={class:"button","aria-haspopup":"true","aria-controls":"dropdown-menu"},yz=J("span",{class:"icon is-small"},[J("i",{class:"fas fa-angle-down","aria-hidden":"true"})],-1),_z={class:"dropdown-menu",id:"dropdown-menu",role:"menu"},vz={class:"dropdown-content"},xz={__name:"ImageryDropdownControl",emits:["setImagery"],setup(e,{emit:r}){as();const a=r,u=vs("2023"),d=vs(!1),g=()=>d.value=!d.value,m=l=>{u.value=l,a("setImagery",l),d.value=!1};return(l,M)=>(wt(),Ft("div",{class:ns([d.value?"is-active":"","imagery-dropdown dropdown"]),onClick:g},[J("div",mz,[J("button",gz,[J("span",null,Ht(u.value),1),yz])]),J("div",_z,[J("div",vz,[J("a",{class:"dropdown-item",onClick:M[0]||(M[0]=A=>m("2023"))},"2023"),J("a",{class:"dropdown-item",onClick:M[1]||(M[1]=A=>m("2022"))},"2022"),J("a",{class:"dropdown-item",onClick:M[2]||(M[2]=A=>m("2020"))},"2020"),J("a",{class:"dropdown-item",onClick:M[3]||(M[3]=A=>m("2019"))},"2019"),J("a",{class:"dropdown-item",onClick:M[4]||(M[4]=A=>m("2018"))},"2018"),J("a",{class:"dropdown-item",onClick:M[5]||(M[5]=A=>m("2017"))},"2017"),J("a",{class:"dropdown-item",onClick:M[6]||(M[6]=A=>m("2016"))},"2016"),J("a",{class:"dropdown-item",onClick:M[7]||(M[7]=A=>m("2015"))},"2015"),J("a",{class:"dropdown-item",onClick:M[8]||(M[8]=A=>m("2012"))},"2012"),J("a",{class:"dropdown-item",onClick:M[9]||(M[9]=A=>m("2010"))},"2010"),J("a",{class:"dropdown-item",onClick:M[10]||(M[10]=A=>m("2008"))},"2008"),J("a",{class:"dropdown-item",onClick:M[11]||(M[11]=A=>m("2004"))},"2004"),J("a",{class:"dropdown-item",onClick:M[12]||(M[12]=A=>m("1996"))},"1996"),J("a",{class:"dropdown-item",onClick:M[13]||(M[13]=A=>m("1962"))},"1962"),J("a",{class:"dropdown-item",onClick:M[14]||(M[14]=A=>m("1942"))},"1942"),J("a",{class:"dropdown-item",onClick:M[15]||(M[15]=A=>m("1910"))},"1910"),J("a",{class:"dropdown-item",onClick:M[16]||(M[16]=A=>m("1895"))},"1895"),J("a",{class:"dropdown-item",onClick:M[17]||(M[17]=A=>m("1875"))},"1875"),J("a",{class:"dropdown-item",onClick:M[18]||(M[18]=A=>m("1860"))},"1860")])])],2))}},bz={class:"cyclomedia-toggle"},wz=["src"],Mz={__name:"CyclomediaControl",emits:["toggleCyclomedia"],setup(e){const r=gi(()=>"/vue3-atlas2/images/cyclomedia.png");return(a,u)=>(wt(),Ft("div",bz,[J("button",{type:"button",onClick:u[0]||(u[0]=d=>a.$emit("toggleCyclomedia"))},[J("img",{class:"img-src",src:r.value},null,8,wz)])]))}},Sz=Fs(Mz,[["__scopeId","data-v-a7ad6777"]]),Ez={class:"pictometry-toggle"},Tz=["src"],Cz={__name:"PictometryControl",emits:["togglePictometry"],setup(e){const r=gi(()=>"/vue3-atlas2/images/pictometry.png");return(a,u)=>(wt(),Ft("div",Ez,[J("button",{type:"button",onClick:u[0]||(u[0]=d=>a.$emit("togglePictometry"))},[J("img",{class:"img-src",src:r.value},null,8,Tz)])]))}},Iz=Fs(Cz,[["__scopeId","data-v-9574f07b"]]),Az={name:"OpacitySlider",props:["position","initialOpacity"],data(){return{value:100}},mounted(){as(),this.$data.value=this.$props.initialOpacity*100},methods:{handleSliderValueChange(e){this.$data.value=e.target.value,this.$emit("opacityChange",e.target.value)}}},Pz={class:"map-overlay top"},kz={class:"map-overlay-inner"},Dz=["value"];function Lz(e,r,a,u,d,g){return wt(),Ft("div",Pz,[J("div",kz,[J("input",{id:"slider",class:"opacity-slider",type:"range",min:"0",max:"100",step:"0",value:e.value,onInput:r[0]||(r[0]=(...m)=>g.handleSliderValueChange&&g.handleSliderValueChange(...m)),onChange:r[1]||(r[1]=(...m)=>g.handleSliderValueChange&&g.handleSliderValueChange(...m))},null,40,Dz)])])}const I0=Fs(Az,[["render",Lz]]),Rz={id:"map",class:"map-class"},zz={__name:"Map",setup(e){console.log("Map.vue $config:",Hr);const r=as(),a=ea(),u=Qr(),d=mu(),g=dg(),m=Zh(),l=Wh();let M;const A=gi(()=>u.addressData.features?u.addressData.features[0].geometry.coordinates:[]),R=gi(()=>a.selectedParcelId),k=gi(()=>R.value&&d.dor.features?(console.log("selectedParcelId.value:",R.value,"ParcelsStore.dor.features.filter(parcel => parcel.id === selectedParcelId.value)[0]:",d.dor.features.filter(xt=>xt.id===R.value)[0]),d.dor.features.filter(xt=>xt.id===R.value)[0].geometry.coordinates[0]):[]);zn(()=>A.value,xt=>{console.log("Map pwdCoordinates watch, newCoords:",xt,"MapStore.addressMarker:",r.addressMarker);const kt={type:"Feature",geometry:{type:"Point",coordinates:xt}};M.getSource("addressMarker").setData(kt)}),zn(()=>k.value,xt=>{console.log("Map dorCoordinates watch, newCoords:",xt);const kt={type:"Feature",geometry:{type:"Polygon",coordinates:[xt]}};M.getSource("dorParcel").setData(kt)}),zn(()=>m.params.topic,async xt=>{if(console.log("Map route.params.topic watch, newTopic:",xt),xt){M.setStyle(Hr[Hr.topicStyles[xt]]);const kt=M.getSource("addressMarker"),$t=M.getSource("dorParcel");kt&&$t&&(kt.setData({type:"Feature",geometry:{type:"Point",coordinates:A.value}}),$t.setData({type:"Feature",geometry:{type:"Polygon",coordinates:[k.value]}})),r.selectedRegmap=null}}),zn(()=>u.addressData,async xt=>{console.log("MapStore route.params.address watch, newAddress:",xt);const kt=xt.features[0].geometry.coordinates;a.lastSearchMethod==="address"&&(M.setCenter(kt),M.setZoom(17))});const z=gi(()=>r.selectedRegmap);zn(()=>z.value,(xt,kt)=>{if(console.log("addRegmapLayer, newRegmap:",xt,"oldRegmap:",kt),xt==null)console.log("remove old regmap"),M.getLayer("regmap")&&(M.removeLayer("regmap"),M.removeSource("regmap")),r.selectedRegmap=null;else if(kt==null){M.getSource("regmap")&&M.removeSource("regmap"),console.log("add newRegmap:",xt);const $t=`https://ags-regmaps.phila.gov/arcgis/rest/services/RegMaps/MapServer/export?dpi=96&layerDefs=0:NAME='g${xt.toLowerCase()}.tif'&transparent=true&format=png24&bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=700,700&f=image&layers=show%3A0`;Hr.dorDrawnMapStyle.sources.regmap={type:"raster",tiles:[$t],tileSize:256},M.addLayer({id:"regmap",type:"raster",source:Hr.dorDrawnMapStyle.sources.regmap,paint:{"raster-opacity":r.regmapOpacity}},"dorParcel")}else{M.removeLayer("regmap"),M.removeSource("regmap");const $t=`https://ags-regmaps.phila.gov/arcgis/rest/services/RegMaps/MapServer/export?dpi=96&layerDefs=0:NAME='g${xt.toLowerCase()}.tif'&transparent=true&format=png24&bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=700,700&f=image&layers=show%3A0`;Hr.dorDrawnMapStyle.sources.regmap={type:"raster",tiles:[$t],tileSize:256},M.addLayer({id:"regmap",type:"raster",source:Hr.dorDrawnMapStyle.sources.regmap,paint:{"raster-opacity":r.regmapOpacity}},"dorParcel")}});const W=xt=>{r.regmapOpacity=xt/100,M.setPaintProperty("regmap","raster-opacity",parseFloat(xt/100))},Z=gi(()=>g.selectedLiBuildingNumber);zn(()=>Z.value,xt=>{console.log("Map.vue watch selectedLiBuildingNumber.value:",Z.value),M.setPaintProperty("liBuildingFootprints","fill-color",["match",["get","id"],xt,"#FFFA80","#C2B7FF"])});const X=gi(()=>a.hoveredStateId);zn(()=>X.value,xt=>{if(console.log("Map.vue hoveredStateId watch, newHoveredStateId:",xt),xt){const kt=M.getStyle().sources.nearby.data.features.filter(ai=>ai.properties.id===xt)[0],$t=M.getStyle().sources.nearby.data.features.indexOf(kt);console.log("index:",$t,"map.getStyle().sources.nearby.data.features:",M.getStyle().sources.nearby.data.features.filter(ai=>ai.properties.id===xt)[0]),M.getStyle().sources.nearby.data.features.splice($t,1),M.getStyle().sources.nearby.data.features.push(kt),M.getSource("nearby").setData(M.getStyle().sources.nearby.data),console.log("there is a new hoveredStateId, setting paint property"),M.setPaintProperty("nearby","circle-color",["match",["get","id"],xt,"#FFFF00",["match",["get","type"],"nearby311","#FF0000","nearbyCrimeIncidents","#0096FF","#000000"]])}else M.setPaintProperty("nearby","circle-color",["match",["get","type"],"nearby311","#FF0000","nearbyCrimeIncidents","#0096FF","#000000"])});const fe=vs({mode:null,selection:null,currentShape:null,labelLayers:[],currentArea:null}),ye=vs(null),we=gi(()=>"/vue3-atlas2/images/marker_blue.png");mc(async()=>{console.log("Map.vue onMounted route.params.topic:",m.params.topic,"route.params.address:",m.params.address);let xt;m.params.topic?xt=Hr.topicStyles[m.params.topic]:xt="pwdDrawnMapStyle";let kt;m.params.address?kt=17:kt=12,M=new Yf.Map({container:"map",style:Hr[xt],center:[-75.163471,39.953338],zoom:kt,minZoom:6,maxZoom:22,attributionControl:!1}),M.addControl(new Yf.NavigationControl,"bottom-left"),M.addControl(new Yf.GeolocateControl,"bottom-left");const ai=await M.loadImage("https://docs.mapbox.com/mapbox-gl-js/assets/custom_marker.png");M.addImage("custom-marker",ai.data);const Zi=await M.loadImage(we.value);M.addImage("marker-blue",Zi.data),M.on("click","liBuildingFootprints",We=>{console.log("liBuildingFootprints click, e:",We),We.clickOnLayer=!0,g.selectedLiBuildingNumber=We.features[0].properties.id}),M.on("click","cyclomediaRecordings",We=>{console.log("cyclomediaRecordings click, e:",We,"e.features[0]:",We.features[0]),r.clickedCyclomediaRecordingCoords=[We.lngLat.lng,We.lngLat.lat],We.clickOnLayer=!0}),M.on("click",(We,it)=>{if(We.clickOnLayer)return;console.log("e:",We,"data:",it,"drawInfo.mode:",fe.mode,Bi.getMode());let Qe=fe.mode,Xi=r.map.queryRenderedFeatures(We.point).filter(ji=>["mapbox-gl-draw-cold","mapbox-gl-draw-hot"].includes(ji.source));console.log("Map.vue handleMapClick, e:",We,"drawLayers:",Xi,"drawMode:",Qe,"e:",We,"MapStore.map.getStyle():",r.map.getStyle(),"MapStore.drawStart:",r.drawStart),!Xi.length&&Bi.getMode()!=="draw_polygon"&&l.push({name:"search",query:{lng:We.lngLat.lng,lat:We.lngLat.lat}}),Bi.getMode()==="draw_polygon"&&ye.value.getDrawDistances(We)}),M.on("mouseenter","nearby",We=>{We.features.length>0&&(console.log("map.getSource(nearby):",M.getSource("nearby"),"map.getStyle().sources:",M.getStyle().sources),a.hoveredStateId=We.features[0].properties.id)}),M.on("mouseleave","nearby",()=>{X&&(a.hoveredStateId=null)}),Ud.constants.classes.CONTROL_BASE="maplibregl-ctrl",Ud.constants.classes.CONTROL_PREFIX="maplibregl-ctrl-",Ud.constants.classes.CONTROL_GROUP="maplibregl-ctrl-group";const Bi=new Ud({displayControlsDefault:!1,controls:{polygon:!0}});r.draw=Bi,M.addControl(Bi,"bottom-right"),M.on("draw.create",ee),M.on("draw.selectionchange",Ie),M.on("draw.finish",Ue),M.on("draw.modechange",Xe),Ot=new LR("https://atlasapi.cyclomedia.com/api/recording/wfs","","",4326),r.setMap(M)});const ee=xt=>{console.log("drawCreate is running, e",xt),ye.value.getDrawDistances(xt)},Ie=xt=>{console.log("drawSelectionChange is running, e:",xt),ye.value.handleDrawSelectionChange(xt)},Ue=()=>{console.log("drawFinish is running"),fe.mode="simple_select"},Xe=xt=>{console.log("drawModeChange is running, e",xt),fe.mode=xt.mode,ye.value.handleDrawModeChange(xt)},nt=gi(()=>r.imagerySelected),ft=()=>{console.log("toggleImagery, map.getStyle:",M.getStyle()),M.getStyle(),r.imageryOn?(console.log("map.getStyle().layers:",M.getStyle().layers),r.imageryOn=!1,M.removeLayer(nt.value),M.removeLayer("imageryLabels")):(r.imageryOn=!0,M.addLayer(Hr.mapLayers[nt.value],"addressMarker"),M.addLayer(Hr.mapLayers.imageryLabels,"addressMarker"))},At=async xt=>{const kt=nt.value;console.log("setImagery, newImagery:",xt,"oldLayer:",kt,"imagerySelected.value:",nt.value),r.imagerySelected=xt,await M.addLayer(Hr.mapLayers[nt.value],"addressMarker"),M.removeLayer(kt)};let Ot=null;const Lt=()=>{console.log("updateCyclomediaRecordings is running");const xt=r.map,kt=xt.getZoom();if(console.log("updateCyclomediaRecordings is running, zoom:",kt),!r.cyclomediaOn||kt<17)return;const $t=xt.getBounds();console.log("bounds:",$t),Ot.getRecordings($t,ai=>{console.log("recordings:",ai);let Zi={type:"FeatureCollection",features:[]};console.log("map:",xt);let Bi=[];for(let We of ai)Bi.push({type:"Feature",geometry:{type:"Point",coordinates:[We.lng,We.lat]},properties:{id:We.imageId,type:"cyclomediaRecording"}});Zi.features=Bi,console.log("map.getSource('cyclomediaRecordings'):","map.getStyle().layers:",xt.getStyle().layers),xt.getSource("cyclomediaRecordings").setData(Zi),Hr.dorDrawnMapStyle.sources.cyclomediaRecordings.data.features=Bi,Hr.liDrawnMapStyle.sources.cyclomediaRecordings.data.features=Bi,Hr.pwdDrawnMapStyle.sources.cyclomediaRecordings.data.features=Bi})},li=()=>{if(console.log("toggleCyclomedia"),r.cyclomediaOn=!r.cyclomediaOn,r.cyclomediaOn)Lt();else{let xt={type:"FeatureCollection",features:[]};M.getSource("cyclomediaRecordings").setData(xt)}},Ei=()=>{console.log("togglePictometry"),r.pictometryOn=!r.pictometryOn},ci=xt=>{r.zoningOpacity=xt/100,M.setPaintProperty("zoning","raster-opacity",xt/100)};return(xt,kt)=>(wt(),Ft("div",Rz,[sr(NR),sr(fz,{onToggleImagery:ft}),zi(r).imageryOn?(wt(),Ls(xz,{key:0,onSetImagery:At})):Gi("",!0),sr(Sz,{onToggleCyclomedia:li}),sr(Iz,{onTogglePictometry:Ei}),sr(uz,{ref_key:"distanceMeasureControlRef",ref:ye},null,512),z.value?(wt(),Ls(I0,{key:1,initialOpacity:zi(r).regmapOpacity,onOpacityChange:W},null,8,["initialOpacity"])):Gi("",!0),zi(a).currentTopic=="Zoning"?(wt(),Ls(I0,{key:2,initialOpacity:zi(r).zoningOpacity,onOpacityChange:ci},null,8,["initialOpacity"])):Gi("",!0)]))}},Oz=Fs(zz,[["__scopeId","data-v-341c3987"]]),Fz={class:"cyclomedia-panel"},Bz={id:"cycloviewer",ref:"cycloviewer",class:"panoramaViewerWindow"},Nz="+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs",$z="+proj=lcc +lat_1=40.96666666666667 +lat_2=39.93333333333333 +lat_0=39.33333333333334 +lon_0=-77.75 +x_0=600000 +y_0=0 +ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 +no_defs",Uz={__name:"CyclomediaPanel",setup(e){console.log("CyclomediaPanel.vue setup");const r=as(),a=Qr(),u=vs(!1),d=g=>{console.log("CyclomediaPanel.vue setNewLocation, coords:",g),console.log(g);const m=Os(Nz,$z,g);StreetSmartApi.open(m[0]+","+m[1],{viewerType:StreetSmartApi.ViewerType.PANORAMA,srs:"EPSG:2272",panoramaViewer:{closable:!1,maximizable:!1}})};return zn(()=>r.clickedCyclomediaRecordingCoords,g=>{console.log("CyclomediaPanel.vue watch clickedCyclomediaRecordingCoords, newClickedCyclomediaRecordingCoords:",g),g&&d(g)}),mc(async()=>{if(console.log("CyclomediaPanel.vue onMounted"),u.value||(await StreetSmartApi.init({targetElement:cycloviewer,username:"",password:"",apiKey:"",srs:"EPSG:2272",locale:"en-us",addressSettings:{locale:"en-us",database:"CMDatabase"}}),u.value=!0),a.addressData.features.length>0){const g=a.addressData.features[0].geometry.coordinates;d(g)}else d([-75.163471,39.953338])}),(g,m)=>(wt(),Ft("div",Fz,[J("div",Bz,null,512)]))}},Vz=Fs(Uz,[["__scopeId","data-v-53a3bee3"]]),jz={__name:"MapPanel",setup(e){const r=as(),a=gi(()=>r.cyclomediaOn||r.pictometryOn?"map-panel cyclomedia-pictometry":"map-panel");return(u,d)=>(wt(),Ft("div",{id:"map-panel",class:ns(a.value)},[sr(Oz),(wt(),Ls(s2,null,[zi(r).cyclomediaOn?(wt(),Ls(Vz,{key:0})):Gi("",!0)],1024))],2))}},qz=Fs(jz,[["__scopeId","data-v-aa153340"]]),Gz=J("div",{class:"container"},[J("h1",{class:"title is-1"},"Vue3 Atlas")],-1),Hz={class:"small-container"},Wz={class:"columns"},Zz={class:"column is-6 pr-0 pb-0"},Xz={class:"column is-6 p-0 p-0"},nc={__name:"App",setup(e){console.log("import.meta.env.VITE_PUBLICPATH:","/vue3-atlas2/"),console.log("import.meta.env.VITE_CAK:","");const r=ea(),a=Zh(),u=Wh();return vs(""),mc(async()=>{await u.isReady(),console.log("App onMounted, route.params.topic:",a.params.topic,"route.params.address:",a.params.address),a.name==="not-found"&&u.push({name:"home"}),a.params.topic&&(r.currentTopic=a.params.topic)}),(d,g)=>(wt(),Ft("main",null,[Gz,J("div",Hz,[J("div",Wz,[J("div",Zz,[sr(DR)]),J("div",Xz,[sr(qz)])])])]))}},Kz="modulepreload",Yz=function(e){return"/vue3-atlas2/"+e},A0={},Jz=function(r,a,u){let d=Promise.resolve();if(a&&a.length>0){const g=document.getElementsByTagName("link"),m=document.querySelector("meta[property=csp-nonce]"),l=(m==null?void 0:m.nonce)||(m==null?void 0:m.getAttribute("nonce"));d=Promise.all(a.map(M=>{if(M=Yz(M),M in A0)return;A0[M]=!0;const A=M.endsWith(".css"),R=A?'[rel="stylesheet"]':"";if(!!u)for(let W=g.length-1;W>=0;W--){const Z=g[W];if(Z.href===M&&(!A||Z.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${M}"]${R}`))return;const z=document.createElement("link");if(z.rel=A?"stylesheet":Kz,A||(z.as="script",z.crossOrigin=""),z.href=M,l&&z.setAttribute("nonce",l),document.head.appendChild(z),A)return new Promise((W,Z)=>{z.addEventListener("load",W),z.addEventListener("error",()=>Z(new Error(`Unable to preload CSS for ${M}`)))})}))}return d.then(()=>r()).catch(g=>{const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=g,window.dispatchEvent(m),!m.defaultPrevented)throw g})},{routeApp:Qz}=vx(),u1=async e=>{console.log("getAddressAndPutInStore is running, address:",e);const r=ea();r.clearDataSourcesLoadedArray();const a=Qr();if(await a.fillAddressData(e),!a.addressData.features){Mu.push({name:"not-found"});return}const u=a.addressData.features[0].properties.street_address;r.setCurrentAddress(u)},eO=async(e,r)=>{let a;const u=ea();u.selectedParcelId=null;let d=u.currentTopic;const g=Hr.parcelLayerForTopic[d],m=mu();if(await m.fillParcelDataByLngLat(e,r,g),!m[g].features[0]){Mu.push({name:"not-found"});return}const l=g==="pwd"?"ADDRESS":"ADDR_SOURCE";a=m[g].features[0].properties[l],console.log("getParcelAndPutInStore, currentAddress:",a,"parcelLayer:",g,"addressField",l,"ParcelsStore[parcelLayer].features[0].properties:",m[g].features[0].properties,"ParcelsStore[parcelLayer].features[0].properties[addressField]:",m[g].features[0].properties[l]),u.setCurrentAddress(a)},tO=async(e,r)=>{const a=ea(),u=Qr(),d=a.dataSourcesLoadedArray;if(e.name==="not-found")return;let g,m;if(e.params.address?g=e.params.address:e.query.address&&(g=e.query.address),e.params.topic&&(m=e.params.topic),g!==u.addressData.normalized)await u1(g);else if(d.includes(m))return;const l=mu();await l.fillPwdParcelData(),await l.fillDorParcelData();const M=Op();if(await M.fillCondoData(g),e.params.topic=="Condominiums"&&!M.condosData.length){a.currentTopic="Property",Mu.push({name:"address-and-topic",params:{address:e.params.address,topic:"Property"}});return}await iO(e.params.topic),a.addToDataSourcesLoadedArray(e.params.topic)},iO=async e=>{if(console.log("topicDataFetch is running, topic:",e),e==="Property"&&await Ax().fillOpaData(),e==="Licenses & Inspections"){const r=dg();await r.fillLiBuildingFootprints(),await r.fillLiBuildingCertSummary(),await r.fillLiBuildingCerts(),await r.fillLiInspections(),await r.fillLiPermits()}if(e==="Deeds"){const r=kx();await r.fillDorDocuments(),await r.fillRegmaps()}if(e==="Nearby Activity"){const a=ea().currentNearbyDataType;await s1().fetchData(a);const g=Qr().addressData.features[0].geometry.coordinates;await as().fillBufferForAddress(g[0],g[1])}},Mu=LS({history:cS("/vue3-atlas2"),routes:[{path:"/:pathMatch(.*)*",name:"NotFound",component:()=>Jz(()=>import("./NotFound-s1KnGzLl.js"),[])},{path:"/",name:"home",component:nc,props:!0},{path:"/:address",name:"address",component:nc},{path:"/:address/:topic",name:"address-and-topic",component:nc},{path:"/:address/:topic/:data",name:"address-topic-and-data",component:nc},{path:"/not-found",name:"not-found",component:nc},{path:"/search",name:"search",component:nc,beforeEnter:async(e,r)=>{console.log("search route beforeEnter, to.query:",e.query,"from:",r);const{address:a,lat:u,lng:d}=e.query,g=ea();a?(g.setLastSearchMethod("address"),await u1(a)):u&&d&&(g.setLastSearchMethod("mapClick"),await eO(d,u)),Qz(Mu)}}]});Mu.afterEach(async(e,r)=>{console.log("router afterEach to:",e,"from:",r),e.name!=="not-found"&&e.name!=="search"&&await tO(e)});const fg=wM(nc);fg.use(TM());fg.use(Mu);fg.mount("#app");export{Fs as _,J as a,np as b,Ft as c,sr as d,wt as o,rO as r,Ao as w};
