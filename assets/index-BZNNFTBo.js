(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const x of document.querySelectorAll('link[rel="modulepreload"]'))m(x);new MutationObserver(x=>{for(const T of x)if(T.type==="childList")for(const v of T.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&m(v)}).observe(document,{childList:!0,subtree:!0});function d(x){const T={};return x.integrity&&(T.integrity=x.integrity),x.referrerPolicy&&(T.referrerPolicy=x.referrerPolicy),x.crossOrigin==="use-credentials"?T.credentials="include":x.crossOrigin==="anonymous"?T.credentials="omit":T.credentials="same-origin",T}function m(x){if(x.ep)return;x.ep=!0;const T=d(x);fetch(x.href,T)}})();/**
* @vue/shared v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Rp(n,a){const d=new Set(n.split(","));return a?m=>d.has(m.toLowerCase()):m=>d.has(m)}const Fi={},Xa=[],Mn=()=>{},t0=()=>!1,gh=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),Lp=n=>n.startsWith("onUpdate:"),kr=Object.assign,Fp=(n,a)=>{const d=n.indexOf(a);d>-1&&n.splice(d,1)},i0=Object.prototype.hasOwnProperty,li=(n,a)=>i0.call(n,a),Vt=Array.isArray,Ya=n=>_h(n)==="[object Map]",n_=n=>_h(n)==="[object Set]",Gt=n=>typeof n=="function",mr=n=>typeof n=="string",ol=n=>typeof n=="symbol",Oi=n=>n!==null&&typeof n=="object",s_=n=>(Oi(n)||Gt(n))&&Gt(n.then)&&Gt(n.catch),o_=Object.prototype.toString,_h=n=>o_.call(n),r0=n=>_h(n).slice(8,-1),a_=n=>_h(n)==="[object Object]",Op=n=>mr(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,gc=Rp(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),yh=n=>{const a=Object.create(null);return d=>a[d]||(a[d]=n(d))},n0=/-(\w)/g,os=yh(n=>n.replace(n0,(a,d)=>d?d.toUpperCase():"")),s0=/\B([A-Z])/g,Go=yh(n=>n.replace(s0,"-$1").toLowerCase()),xh=yh(n=>n.charAt(0).toUpperCase()+n.slice(1)),Wd=yh(n=>n?`on${xh(n)}`:""),oo=(n,a)=>!Object.is(n,a),Ju=(n,a)=>{for(let d=0;d<n.length;d++)n[d](a)},oh=(n,a,d)=>{Object.defineProperty(n,a,{configurable:!0,enumerable:!1,value:d})},hp=n=>{const a=parseFloat(n);return isNaN(a)?n:a};let $m;const l_=()=>$m||($m=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Bp(n){if(Vt(n)){const a={};for(let d=0;d<n.length;d++){const m=n[d],x=mr(m)?c0(m):Bp(m);if(x)for(const T in x)a[T]=x[T]}return a}else if(mr(n)||Oi(n))return n}const o0=/;(?![^(]*\))/g,a0=/:([^]+)/,l0=/\/\*[^]*?\*\//g;function c0(n){const a={};return n.replace(l0,"").split(o0).forEach(d=>{if(d){const m=d.split(a0);m.length>1&&(a[m[0].trim()]=m[1].trim())}}),a}function Dc(n){let a="";if(mr(n))a=n;else if(Vt(n))for(let d=0;d<n.length;d++){const m=Dc(n[d]);m&&(a+=m+" ")}else if(Oi(n))for(const d in n)n[d]&&(a+=d+" ");return a.trim()}const u0="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",h0=Rp(u0);function c_(n){return!!n||n===""}const ei=n=>mr(n)?n:n==null?"":Vt(n)||Oi(n)&&(n.toString===o_||!Gt(n.toString))?JSON.stringify(n,u_,2):String(n),u_=(n,a)=>a&&a.__v_isRef?u_(n,a.value):Ya(a)?{[`Map(${a.size})`]:[...a.entries()].reduce((d,[m,x],T)=>(d[Kd(m,T)+" =>"]=x,d),{})}:n_(a)?{[`Set(${a.size})`]:[...a.values()].map(d=>Kd(d))}:ol(a)?Kd(a):Oi(a)&&!Vt(a)&&!a_(a)?String(a):a,Kd=(n,a="")=>{var d;return ol(n)?`Symbol(${(d=n.description)!=null?d:a})`:n};/**
* @vue/reactivity v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let vn;class h_{constructor(a=!1){this.detached=a,this._active=!0,this.effects=[],this.cleanups=[],this.parent=vn,!a&&vn&&(this.index=(vn.scopes||(vn.scopes=[])).push(this)-1)}get active(){return this._active}run(a){if(this._active){const d=vn;try{return vn=this,a()}finally{vn=d}}}on(){vn=this}off(){vn=this.parent}stop(a){if(this._active){let d,m;for(d=0,m=this.effects.length;d<m;d++)this.effects[d].stop();for(d=0,m=this.cleanups.length;d<m;d++)this.cleanups[d]();if(this.scopes)for(d=0,m=this.scopes.length;d<m;d++)this.scopes[d].stop(!0);if(!this.detached&&this.parent&&!a){const x=this.parent.scopes.pop();x&&x!==this&&(this.parent.scopes[this.index]=x,x.index=this.index)}this.parent=void 0,this._active=!1}}}function d_(n){return new h_(n)}function d0(n,a=vn){a&&a.active&&a.effects.push(n)}function p_(){return vn}function p0(n){vn&&vn.cleanups.push(n)}let Uo;class Np{constructor(a,d,m,x){this.fn=a,this.trigger=d,this.scheduler=m,this.active=!0,this.deps=[],this._dirtyLevel=4,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,d0(this,x)}get dirty(){if(this._dirtyLevel===2||this._dirtyLevel===3){this._dirtyLevel=1,Ho();for(let a=0;a<this._depsLength;a++){const d=this.deps[a];if(d.computed&&(f0(d.computed),this._dirtyLevel>=4))break}this._dirtyLevel===1&&(this._dirtyLevel=0),Zo()}return this._dirtyLevel>=4}set dirty(a){this._dirtyLevel=a?4:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let a=no,d=Uo;try{return no=!0,Uo=this,this._runnings++,Um(this),this.fn()}finally{jm(this),this._runnings--,Uo=d,no=a}}stop(){var a;this.active&&(Um(this),jm(this),(a=this.onStop)==null||a.call(this),this.active=!1)}}function f0(n){return n.value}function Um(n){n._trackId++,n._depsLength=0}function jm(n){if(n.deps.length>n._depsLength){for(let a=n._depsLength;a<n.deps.length;a++)f_(n.deps[a],n);n.deps.length=n._depsLength}}function f_(n,a){const d=n.get(a);d!==void 0&&a._trackId!==d&&(n.delete(a),n.size===0&&n.cleanup())}let no=!0,dp=0;const m_=[];function Ho(){m_.push(no),no=!1}function Zo(){const n=m_.pop();no=n===void 0?!0:n}function Vp(){dp++}function $p(){for(dp--;!dp&&pp.length;)pp.shift()()}function g_(n,a,d){if(a.get(n)!==n._trackId){a.set(n,n._trackId);const m=n.deps[n._depsLength];m!==a?(m&&f_(m,n),n.deps[n._depsLength++]=a):n._depsLength++}}const pp=[];function __(n,a,d){Vp();for(const m of n.keys()){let x;m._dirtyLevel<a&&(x??(x=n.get(m)===m._trackId))&&(m._shouldSchedule||(m._shouldSchedule=m._dirtyLevel===0),m._dirtyLevel=a),m._shouldSchedule&&(x??(x=n.get(m)===m._trackId))&&(m.trigger(),(!m._runnings||m.allowRecurse)&&m._dirtyLevel!==2&&(m._shouldSchedule=!1,m.scheduler&&pp.push(m.scheduler)))}$p()}const y_=(n,a)=>{const d=new Map;return d.cleanup=n,d.computed=a,d},ah=new WeakMap,jo=Symbol(""),fp=Symbol("");function cn(n,a,d){if(no&&Uo){let m=ah.get(n);m||ah.set(n,m=new Map);let x=m.get(d);x||m.set(d,x=y_(()=>m.delete(d))),g_(Uo,x)}}function As(n,a,d,m,x,T){const v=ah.get(n);if(!v)return;let h=[];if(a==="clear")h=[...v.values()];else if(d==="length"&&Vt(n)){const L=Number(m);v.forEach((U,j)=>{(j==="length"||!ol(j)&&j>=L)&&h.push(U)})}else switch(d!==void 0&&h.push(v.get(d)),a){case"add":Vt(n)?Op(d)&&h.push(v.get("length")):(h.push(v.get(jo)),Ya(n)&&h.push(v.get(fp)));break;case"delete":Vt(n)||(h.push(v.get(jo)),Ya(n)&&h.push(v.get(fp)));break;case"set":Ya(n)&&h.push(v.get(jo));break}Vp();for(const L of h)L&&__(L,4);$p()}function m0(n,a){var d;return(d=ah.get(n))==null?void 0:d.get(a)}const g0=Rp("__proto__,__v_isRef,__isVue"),x_=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(ol)),qm=_0();function _0(){const n={};return["includes","indexOf","lastIndexOf"].forEach(a=>{n[a]=function(...d){const m=si(this);for(let T=0,v=this.length;T<v;T++)cn(m,"get",T+"");const x=m[a](...d);return x===-1||x===!1?m[a](...d.map(si)):x}}),["push","pop","shift","unshift","splice"].forEach(a=>{n[a]=function(...d){Ho(),Vp();const m=si(this)[a].apply(this,d);return $p(),Zo(),m}}),n}function y0(n){const a=si(this);return cn(a,"has",n),a.hasOwnProperty(n)}class v_{constructor(a=!1,d=!1){this._isReadonly=a,this._isShallow=d}get(a,d,m){const x=this._isReadonly,T=this._isShallow;if(d==="__v_isReactive")return!x;if(d==="__v_isReadonly")return x;if(d==="__v_isShallow")return T;if(d==="__v_raw")return m===(x?T?k0:T_:T?S_:w_).get(a)||Object.getPrototypeOf(a)===Object.getPrototypeOf(m)?a:void 0;const v=Vt(a);if(!x){if(v&&li(qm,d))return Reflect.get(qm,d,m);if(d==="hasOwnProperty")return y0}const h=Reflect.get(a,d,m);return(ol(d)?x_.has(d):g0(d))||(x||cn(a,"get",d),T)?h:lr(h)?v&&Op(d)?h:h.value:Oi(h)?x?I_(h):zc(h):h}}class b_ extends v_{constructor(a=!1){super(!1,a)}set(a,d,m,x){let T=a[d];if(!this._isShallow){const L=tl(T);if(!lh(m)&&!tl(m)&&(T=si(T),m=si(m)),!Vt(a)&&lr(T)&&!lr(m))return L?!1:(T.value=m,!0)}const v=Vt(a)&&Op(d)?Number(d)<a.length:li(a,d),h=Reflect.set(a,d,m,x);return a===si(x)&&(v?oo(m,T)&&As(a,"set",d,m):As(a,"add",d,m)),h}deleteProperty(a,d){const m=li(a,d);a[d];const x=Reflect.deleteProperty(a,d);return x&&m&&As(a,"delete",d,void 0),x}has(a,d){const m=Reflect.has(a,d);return(!ol(d)||!x_.has(d))&&cn(a,"has",d),m}ownKeys(a){return cn(a,"iterate",Vt(a)?"length":jo),Reflect.ownKeys(a)}}class x0 extends v_{constructor(a=!1){super(!0,a)}set(a,d){return!0}deleteProperty(a,d){return!0}}const v0=new b_,b0=new x0,w0=new b_(!0),Up=n=>n,vh=n=>Reflect.getPrototypeOf(n);function qu(n,a,d=!1,m=!1){n=n.__v_raw;const x=si(n),T=si(a);d||(oo(a,T)&&cn(x,"get",a),cn(x,"get",T));const{has:v}=vh(x),h=m?Up:d?Gp:Tc;if(v.call(x,a))return h(n.get(a));if(v.call(x,T))return h(n.get(T));n!==x&&n.get(a)}function Gu(n,a=!1){const d=this.__v_raw,m=si(d),x=si(n);return a||(oo(n,x)&&cn(m,"has",n),cn(m,"has",x)),n===x?d.has(n):d.has(n)||d.has(x)}function Hu(n,a=!1){return n=n.__v_raw,!a&&cn(si(n),"iterate",jo),Reflect.get(n,"size",n)}function Gm(n){n=si(n);const a=si(this);return vh(a).has.call(a,n)||(a.add(n),As(a,"add",n,n)),this}function Hm(n,a){a=si(a);const d=si(this),{has:m,get:x}=vh(d);let T=m.call(d,n);T||(n=si(n),T=m.call(d,n));const v=x.call(d,n);return d.set(n,a),T?oo(a,v)&&As(d,"set",n,a):As(d,"add",n,a),this}function Zm(n){const a=si(this),{has:d,get:m}=vh(a);let x=d.call(a,n);x||(n=si(n),x=d.call(a,n)),m&&m.call(a,n);const T=a.delete(n);return x&&As(a,"delete",n,void 0),T}function Wm(){const n=si(this),a=n.size!==0,d=n.clear();return a&&As(n,"clear",void 0,void 0),d}function Zu(n,a){return function(m,x){const T=this,v=T.__v_raw,h=si(v),L=a?Up:n?Gp:Tc;return!n&&cn(h,"iterate",jo),v.forEach((U,j)=>m.call(x,L(U),L(j),T))}}function Wu(n,a,d){return function(...m){const x=this.__v_raw,T=si(x),v=Ya(T),h=n==="entries"||n===Symbol.iterator&&v,L=n==="keys"&&v,U=x[n](...m),j=d?Up:a?Gp:Tc;return!a&&cn(T,"iterate",L?fp:jo),{next(){const{value:N,done:V}=U.next();return V?{value:N,done:V}:{value:h?[j(N[0]),j(N[1])]:j(N),done:V}},[Symbol.iterator](){return this}}}}function Ks(n){return function(...a){return n==="delete"?!1:n==="clear"?void 0:this}}function S0(){const n={get(T){return qu(this,T)},get size(){return Hu(this)},has:Gu,add:Gm,set:Hm,delete:Zm,clear:Wm,forEach:Zu(!1,!1)},a={get(T){return qu(this,T,!1,!0)},get size(){return Hu(this)},has:Gu,add:Gm,set:Hm,delete:Zm,clear:Wm,forEach:Zu(!1,!0)},d={get(T){return qu(this,T,!0)},get size(){return Hu(this,!0)},has(T){return Gu.call(this,T,!0)},add:Ks("add"),set:Ks("set"),delete:Ks("delete"),clear:Ks("clear"),forEach:Zu(!0,!1)},m={get(T){return qu(this,T,!0,!0)},get size(){return Hu(this,!0)},has(T){return Gu.call(this,T,!0)},add:Ks("add"),set:Ks("set"),delete:Ks("delete"),clear:Ks("clear"),forEach:Zu(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(T=>{n[T]=Wu(T,!1,!1),d[T]=Wu(T,!0,!1),a[T]=Wu(T,!1,!0),m[T]=Wu(T,!0,!0)}),[n,d,a,m]}const[T0,A0,I0,E0]=S0();function jp(n,a){const d=a?n?E0:I0:n?A0:T0;return(m,x,T)=>x==="__v_isReactive"?!n:x==="__v_isReadonly"?n:x==="__v_raw"?m:Reflect.get(li(d,x)&&x in m?d:m,x,T)}const P0={get:jp(!1,!1)},C0={get:jp(!1,!0)},M0={get:jp(!0,!1)},w_=new WeakMap,S_=new WeakMap,T_=new WeakMap,k0=new WeakMap;function D0(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function z0(n){return n.__v_skip||!Object.isExtensible(n)?0:D0(r0(n))}function zc(n){return tl(n)?n:qp(n,!1,v0,P0,w_)}function A_(n){return qp(n,!1,w0,C0,S_)}function I_(n){return qp(n,!0,b0,M0,T_)}function qp(n,a,d,m,x){if(!Oi(n)||n.__v_raw&&!(a&&n.__v_isReactive))return n;const T=x.get(n);if(T)return T;const v=z0(n);if(v===0)return n;const h=new Proxy(n,v===2?m:d);return x.set(n,h),h}function Is(n){return tl(n)?Is(n.__v_raw):!!(n&&n.__v_isReactive)}function tl(n){return!!(n&&n.__v_isReadonly)}function lh(n){return!!(n&&n.__v_isShallow)}function E_(n){return Is(n)||tl(n)}function si(n){const a=n&&n.__v_raw;return a?si(a):n}function bh(n){return Object.isExtensible(n)&&oh(n,"__v_skip",!0),n}const Tc=n=>Oi(n)?zc(n):n,Gp=n=>Oi(n)?I_(n):n;class P_{constructor(a,d,m,x){this.getter=a,this._setter=d,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this.effect=new Np(()=>a(this._value),()=>Qu(this,this.effect._dirtyLevel===2?2:3)),this.effect.computed=this,this.effect.active=this._cacheable=!x,this.__v_isReadonly=m}get value(){const a=si(this);return(!a._cacheable||a.effect.dirty)&&oo(a._value,a._value=a.effect.run())&&Qu(a,4),C_(a),a.effect._dirtyLevel>=2&&Qu(a,2),a._value}set value(a){this._setter(a)}get _dirty(){return this.effect.dirty}set _dirty(a){this.effect.dirty=a}}function R0(n,a,d=!1){let m,x;const T=Gt(n);return T?(m=n,x=Mn):(m=n.get,x=n.set),new P_(m,x,T||!x,d)}function C_(n){var a;no&&Uo&&(n=si(n),g_(Uo,(a=n.dep)!=null?a:n.dep=y_(()=>n.dep=void 0,n instanceof P_?n:void 0)))}function Qu(n,a=4,d){n=si(n);const m=n.dep;m&&__(m,a)}function lr(n){return!!(n&&n.__v_isRef===!0)}function ss(n){return M_(n,!1)}function L0(n){return M_(n,!0)}function M_(n,a){return lr(n)?n:new F0(n,a)}class F0{constructor(a,d){this.__v_isShallow=d,this.dep=void 0,this.__v_isRef=!0,this._rawValue=d?a:si(a),this._value=d?a:Tc(a)}get value(){return C_(this),this._value}set value(a){const d=this.__v_isShallow||lh(a)||tl(a);a=d?a:si(a),oo(a,this._rawValue)&&(this._rawValue=a,this._value=d?a:Tc(a),Qu(this,4))}}function qt(n){return lr(n)?n.value:n}const O0={get:(n,a,d)=>qt(Reflect.get(n,a,d)),set:(n,a,d,m)=>{const x=n[a];return lr(x)&&!lr(d)?(x.value=d,!0):Reflect.set(n,a,d,m)}};function k_(n){return Is(n)?n:new Proxy(n,O0)}function B0(n){const a=Vt(n)?new Array(n.length):{};for(const d in n)a[d]=D_(n,d);return a}class N0{constructor(a,d,m){this._object=a,this._key=d,this._defaultValue=m,this.__v_isRef=!0}get value(){const a=this._object[this._key];return a===void 0?this._defaultValue:a}set value(a){this._object[this._key]=a}get dep(){return m0(si(this._object),this._key)}}class V0{constructor(a){this._getter=a,this.__v_isRef=!0,this.__v_isReadonly=!0}get value(){return this._getter()}}function $0(n,a,d){return lr(n)?n:Gt(n)?new V0(n):Oi(n)&&arguments.length>1?D_(n,a,d):ss(n)}function D_(n,a,d){const m=n[a];return lr(m)?m:new N0(n,a,d)}/**
* @vue/runtime-core v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function so(n,a,d,m){try{return m?n(...m):n()}catch(x){wh(x,a,d)}}function Nn(n,a,d,m){if(Gt(n)){const T=so(n,a,d,m);return T&&s_(T)&&T.catch(v=>{wh(v,a,d)}),T}const x=[];for(let T=0;T<n.length;T++)x.push(Nn(n[T],a,d,m));return x}function wh(n,a,d,m=!0){const x=a?a.vnode:null;if(a){let T=a.parent;const v=a.proxy,h=`https://vuejs.org/error-reference/#runtime-${d}`;for(;T;){const U=T.ec;if(U){for(let j=0;j<U.length;j++)if(U[j](n,v,h)===!1)return}T=T.parent}const L=a.appContext.config.errorHandler;if(L){so(L,null,10,[n,v,h]);return}}U0(n,d,x,m)}function U0(n,a,d,m=!0){console.error(n)}let Ac=!1,mp=!1;const $r=[];let rs=0;const Ja=[];let eo=null,Vo=0;const z_=Promise.resolve();let Hp=null;function Zp(n){const a=Hp||z_;return n?a.then(this?n.bind(this):n):a}function j0(n){let a=rs+1,d=$r.length;for(;a<d;){const m=a+d>>>1,x=$r[m],T=Ic(x);T<n||T===n&&x.pre?a=m+1:d=m}return a}function Wp(n){(!$r.length||!$r.includes(n,Ac&&n.allowRecurse?rs+1:rs))&&(n.id==null?$r.push(n):$r.splice(j0(n.id),0,n),R_())}function R_(){!Ac&&!mp&&(mp=!0,Hp=z_.then(F_))}function q0(n){const a=$r.indexOf(n);a>rs&&$r.splice(a,1)}function G0(n){Vt(n)?Ja.push(...n):(!eo||!eo.includes(n,n.allowRecurse?Vo+1:Vo))&&Ja.push(n),R_()}function Km(n,a,d=Ac?rs+1:0){for(;d<$r.length;d++){const m=$r[d];if(m&&m.pre){if(n&&m.id!==n.uid)continue;$r.splice(d,1),d--,m()}}}function L_(n){if(Ja.length){const a=[...new Set(Ja)].sort((d,m)=>Ic(d)-Ic(m));if(Ja.length=0,eo){eo.push(...a);return}for(eo=a,Vo=0;Vo<eo.length;Vo++)eo[Vo]();eo=null,Vo=0}}const Ic=n=>n.id==null?1/0:n.id,H0=(n,a)=>{const d=Ic(n)-Ic(a);if(d===0){if(n.pre&&!a.pre)return-1;if(a.pre&&!n.pre)return 1}return d};function F_(n){mp=!1,Ac=!0,$r.sort(H0);try{for(rs=0;rs<$r.length;rs++){const a=$r[rs];a&&a.active!==!1&&so(a,null,14)}}finally{rs=0,$r.length=0,L_(),Ac=!1,Hp=null,($r.length||Ja.length)&&F_()}}function Z0(n,a,...d){if(n.isUnmounted)return;const m=n.vnode.props||Fi;let x=d;const T=a.startsWith("update:"),v=T&&a.slice(7);if(v&&v in m){const j=`${v==="modelValue"?"model":v}Modifiers`,{number:N,trim:V}=m[j]||Fi;V&&(x=d.map(de=>mr(de)?de.trim():de)),N&&(x=d.map(hp))}let h,L=m[h=Wd(a)]||m[h=Wd(os(a))];!L&&T&&(L=m[h=Wd(Go(a))]),L&&Nn(L,n,6,x);const U=m[h+"Once"];if(U){if(!n.emitted)n.emitted={};else if(n.emitted[h])return;n.emitted[h]=!0,Nn(U,n,6,x)}}function O_(n,a,d=!1){const m=a.emitsCache,x=m.get(n);if(x!==void 0)return x;const T=n.emits;let v={},h=!1;if(!Gt(n)){const L=U=>{const j=O_(U,a,!0);j&&(h=!0,kr(v,j))};!d&&a.mixins.length&&a.mixins.forEach(L),n.extends&&L(n.extends),n.mixins&&n.mixins.forEach(L)}return!T&&!h?(Oi(n)&&m.set(n,null),null):(Vt(T)?T.forEach(L=>v[L]=null):kr(v,T),Oi(n)&&m.set(n,v),v)}function Sh(n,a){return!n||!gh(a)?!1:(a=a.slice(2).replace(/Once$/,""),li(n,a[0].toLowerCase()+a.slice(1))||li(n,Go(a))||li(n,a))}let fr=null,Th=null;function ch(n){const a=fr;return fr=n,Th=n&&n.type.__scopeId||null,a}function Ah(n){Th=n}function Ih(){Th=null}function Ts(n,a=fr,d){if(!a||n._n)return n;const m=(...x)=>{m._d&&og(-1);const T=ch(a);let v;try{v=n(...x)}finally{ch(T),m._d&&og(1)}return v};return m._n=!0,m._c=!0,m._d=!0,m}function Xd(n){const{type:a,vnode:d,proxy:m,withProxy:x,props:T,propsOptions:[v],slots:h,attrs:L,emit:U,render:j,renderCache:N,data:V,setupState:de,ctx:_e,inheritAttrs:Ie}=n;let Je,Ue;const We=ch(n);try{if(d.shapeFlag&4){const Be=x||m,ot=Be;Je=is(j.call(ot,Be,N,T,de,V,_e)),Ue=L}else{const Be=a;Je=is(Be.length>1?Be(T,{attrs:L,slots:h,emit:U}):Be(T,null)),Ue=a.props?L:W0(L)}}catch(Be){vc.length=0,wh(Be,n,1),Je=Ni(ao)}let ye=Je;if(Ue&&Ie!==!1){const Be=Object.keys(Ue),{shapeFlag:ot}=ye;Be.length&&ot&7&&(v&&Be.some(Lp)&&(Ue=K0(Ue,v)),ye=il(ye,Ue))}return d.dirs&&(ye=il(ye),ye.dirs=ye.dirs?ye.dirs.concat(d.dirs):d.dirs),d.transition&&(ye.transition=d.transition),Je=ye,ch(We),Je}const W0=n=>{let a;for(const d in n)(d==="class"||d==="style"||gh(d))&&((a||(a={}))[d]=n[d]);return a},K0=(n,a)=>{const d={};for(const m in n)(!Lp(m)||!(m.slice(9)in a))&&(d[m]=n[m]);return d};function X0(n,a,d){const{props:m,children:x,component:T}=n,{props:v,children:h,patchFlag:L}=a,U=T.emitsOptions;if(a.dirs||a.transition)return!0;if(d&&L>=0){if(L&1024)return!0;if(L&16)return m?Xm(m,v,U):!!v;if(L&8){const j=a.dynamicProps;for(let N=0;N<j.length;N++){const V=j[N];if(v[V]!==m[V]&&!Sh(U,V))return!0}}}else return(x||h)&&(!h||!h.$stable)?!0:m===v?!1:m?v?Xm(m,v,U):!0:!!v;return!1}function Xm(n,a,d){const m=Object.keys(a);if(m.length!==Object.keys(n).length)return!0;for(let x=0;x<m.length;x++){const T=m[x];if(a[T]!==n[T]&&!Sh(d,T))return!0}return!1}function Y0({vnode:n,parent:a},d){for(;a;){const m=a.subTree;if(m.suspense&&m.suspense.activeBranch===n&&(m.el=n.el),m===n)(n=a.vnode).el=d,a=a.parent;else break}}const B_="components";function iE(n,a){return Q0(B_,n,!0,a)||n}const J0=Symbol.for("v-ndc");function Q0(n,a,d=!0,m=!1){const x=fr||Mr;if(x){const T=x.type;if(n===B_){const h=Zb(T,!1);if(h&&(h===a||h===os(a)||h===xh(os(a))))return T}const v=Ym(x[n]||T[n],a)||Ym(x.appContext[n],a);return!v&&m?T:v}}function Ym(n,a){return n&&(n[a]||n[os(a)]||n[xh(os(a))])}const eb=n=>n.__isSuspense;function tb(n,a){a&&a.pendingBranch?Vt(n)?a.effects.push(...n):a.effects.push(n):G0(n)}const ib=Symbol.for("v-scx"),rb=()=>ln(ib),Ku={};function _c(n,a,d){return N_(n,a,d)}function N_(n,a,{immediate:d,deep:m,flush:x,once:T,onTrack:v,onTrigger:h}=Fi){if(a&&T){const at=a;a=(...xt)=>{at(...xt),ot()}}const L=Mr,U=at=>m===!0?at:$o(at,m===!1?1:void 0);let j,N=!1,V=!1;if(lr(n)?(j=()=>n.value,N=lh(n)):Is(n)?(j=()=>U(n),N=!0):Vt(n)?(V=!0,N=n.some(at=>Is(at)||lh(at)),j=()=>n.map(at=>{if(lr(at))return at.value;if(Is(at))return U(at);if(Gt(at))return so(at,L,2)})):Gt(n)?a?j=()=>so(n,L,2):j=()=>(de&&de(),Nn(n,L,3,[_e])):j=Mn,a&&m){const at=j;j=()=>$o(at())}let de,_e=at=>{de=ye.onStop=()=>{so(at,L,4),de=ye.onStop=void 0}},Ie;if(Mh)if(_e=Mn,a?d&&Nn(a,L,3,[j(),V?[]:void 0,_e]):j(),x==="sync"){const at=rb();Ie=at.__watcherHandles||(at.__watcherHandles=[])}else return Mn;let Je=V?new Array(n.length).fill(Ku):Ku;const Ue=()=>{if(!(!ye.active||!ye.dirty))if(a){const at=ye.run();(m||N||(V?at.some((xt,St)=>oo(xt,Je[St])):oo(at,Je)))&&(de&&de(),Nn(a,L,3,[at,Je===Ku?void 0:V&&Je[0]===Ku?[]:Je,_e]),Je=at)}else ye.run()};Ue.allowRecurse=!!a;let We;x==="sync"?We=Ue:x==="post"?We=()=>an(Ue,L&&L.suspense):(Ue.pre=!0,L&&(Ue.id=L.uid),We=()=>Wp(Ue));const ye=new Np(j,Mn,We),Be=p_(),ot=()=>{ye.stop(),Be&&Fp(Be.effects,ye)};return a?d?Ue():Je=ye.run():x==="post"?an(ye.run.bind(ye),L&&L.suspense):ye.run(),Ie&&Ie.push(ot),ot}function nb(n,a,d){const m=this.proxy,x=mr(n)?n.includes(".")?V_(m,n):()=>m[n]:n.bind(m,m);let T;Gt(a)?T=a:(T=a.handler,d=a);const v=Rc(this),h=N_(x,T.bind(m),d);return v(),h}function V_(n,a){const d=a.split(".");return()=>{let m=n;for(let x=0;x<d.length&&m;x++)m=m[d[x]];return m}}function $o(n,a,d=0,m){if(!Oi(n)||n.__v_skip)return n;if(a&&a>0){if(d>=a)return n;d++}if(m=m||new Set,m.has(n))return n;if(m.add(n),lr(n))$o(n.value,a,d,m);else if(Vt(n))for(let x=0;x<n.length;x++)$o(n[x],a,d,m);else if(n_(n)||Ya(n))n.forEach(x=>{$o(x,a,d,m)});else if(a_(n))for(const x in n)$o(n[x],a,d,m);return n}function $_(n,a){if(fr===null)return n;const d=kh(fr)||fr.proxy,m=n.dirs||(n.dirs=[]);for(let x=0;x<a.length;x++){let[T,v,h,L=Fi]=a[x];T&&(Gt(T)&&(T={mounted:T,updated:T}),T.deep&&$o(v),m.push({dir:T,instance:d,value:v,oldValue:void 0,arg:h,modifiers:L}))}return n}function Fo(n,a,d,m){const x=n.dirs,T=a&&a.dirs;for(let v=0;v<x.length;v++){const h=x[v];T&&(h.oldValue=T[v].value);let L=h.dir[m];L&&(Ho(),Nn(L,d,8,[n.el,h,n,a]),Zo())}}/*! #__NO_SIDE_EFFECTS__ */function U_(n,a){return Gt(n)?kr({name:n.name},a,{setup:n}):n}const yc=n=>!!n.type.__asyncLoader,j_=n=>n.type.__isKeepAlive;function sb(n,a){q_(n,"a",a)}function ob(n,a){q_(n,"da",a)}function q_(n,a,d=Mr){const m=n.__wdc||(n.__wdc=()=>{let x=d;for(;x;){if(x.isDeactivated)return;x=x.parent}return n()});if(Eh(a,m,d),d){let x=d.parent;for(;x&&x.parent;)j_(x.parent.vnode)&&ab(m,a,d,x),x=x.parent}}function ab(n,a,d,m){const x=Eh(a,n,m,!0);H_(()=>{Fp(m[a],x)},d)}function Eh(n,a,d=Mr,m=!1){if(d){const x=d[n]||(d[n]=[]),T=a.__weh||(a.__weh=(...v)=>{if(d.isUnmounted)return;Ho();const h=Rc(d),L=Nn(a,d,n,v);return h(),Zo(),L});return m?x.unshift(T):x.push(T),T}}const Ps=n=>(a,d=Mr)=>(!Mh||n==="sp")&&Eh(n,(...m)=>a(...m),d),G_=Ps("bm"),Kp=Ps("m"),lb=Ps("bu"),cb=Ps("u"),ub=Ps("bum"),H_=Ps("um"),hb=Ps("sp"),db=Ps("rtg"),pb=Ps("rtc");function fb(n,a=Mr){Eh("ec",n,a)}function qo(n,a,d,m){let x;const T=d&&d[m];if(Vt(n)||mr(n)){x=new Array(n.length);for(let v=0,h=n.length;v<h;v++)x[v]=a(n[v],v,void 0,T&&T[v])}else if(typeof n=="number"){x=new Array(n);for(let v=0;v<n;v++)x[v]=a(v+1,v,void 0,T&&T[v])}else if(Oi(n))if(n[Symbol.iterator])x=Array.from(n,(v,h)=>a(v,h,void 0,T&&T[h]));else{const v=Object.keys(n);x=new Array(v.length);for(let h=0,L=v.length;h<L;h++){const U=v[h];x[h]=a(n[U],U,h,T&&T[h])}}else x=[];return d&&(d[m]=x),x}function mb(n,a,d={},m,x){if(fr.isCE||fr.parent&&yc(fr.parent)&&fr.parent.isCE)return a!=="default"&&(d.name=a),Ni("slot",d,m&&m());let T=n[a];T&&T._c&&(T._d=!1),Nt();const v=T&&Z_(T(d)),h=ts(pr,{key:d.key||v&&v.key||`_${a}`},v||(m?m():[]),v&&n._===1?64:-2);return!x&&h.scopeId&&(h.slotScopeIds=[h.scopeId+"-s"]),T&&T._c&&(T._d=!0),h}function Z_(n){return n.some(a=>hh(a)?!(a.type===ao||a.type===pr&&!Z_(a.children)):!0)?n:null}const gp=n=>n?oy(n)?kh(n)||n.proxy:gp(n.parent):null,xc=kr(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>gp(n.parent),$root:n=>gp(n.root),$emit:n=>n.emit,$options:n=>Xp(n),$forceUpdate:n=>n.f||(n.f=()=>{n.effect.dirty=!0,Wp(n.update)}),$nextTick:n=>n.n||(n.n=Zp.bind(n.proxy)),$watch:n=>nb.bind(n)}),Yd=(n,a)=>n!==Fi&&!n.__isScriptSetup&&li(n,a),gb={get({_:n},a){const{ctx:d,setupState:m,data:x,props:T,accessCache:v,type:h,appContext:L}=n;let U;if(a[0]!=="$"){const de=v[a];if(de!==void 0)switch(de){case 1:return m[a];case 2:return x[a];case 4:return d[a];case 3:return T[a]}else{if(Yd(m,a))return v[a]=1,m[a];if(x!==Fi&&li(x,a))return v[a]=2,x[a];if((U=n.propsOptions[0])&&li(U,a))return v[a]=3,T[a];if(d!==Fi&&li(d,a))return v[a]=4,d[a];_p&&(v[a]=0)}}const j=xc[a];let N,V;if(j)return a==="$attrs"&&cn(n,"get",a),j(n);if((N=h.__cssModules)&&(N=N[a]))return N;if(d!==Fi&&li(d,a))return v[a]=4,d[a];if(V=L.config.globalProperties,li(V,a))return V[a]},set({_:n},a,d){const{data:m,setupState:x,ctx:T}=n;return Yd(x,a)?(x[a]=d,!0):m!==Fi&&li(m,a)?(m[a]=d,!0):li(n.props,a)||a[0]==="$"&&a.slice(1)in n?!1:(T[a]=d,!0)},has({_:{data:n,setupState:a,accessCache:d,ctx:m,appContext:x,propsOptions:T}},v){let h;return!!d[v]||n!==Fi&&li(n,v)||Yd(a,v)||(h=T[0])&&li(h,v)||li(m,v)||li(xc,v)||li(x.config.globalProperties,v)},defineProperty(n,a,d){return d.get!=null?n._.accessCache[a]=0:li(d,"value")&&this.set(n,a,d.value,null),Reflect.defineProperty(n,a,d)}};function Jm(n){return Vt(n)?n.reduce((a,d)=>(a[d]=null,a),{}):n}let _p=!0;function _b(n){const a=Xp(n),d=n.proxy,m=n.ctx;_p=!1,a.beforeCreate&&Qm(a.beforeCreate,n,"bc");const{data:x,computed:T,methods:v,watch:h,provide:L,inject:U,created:j,beforeMount:N,mounted:V,beforeUpdate:de,updated:_e,activated:Ie,deactivated:Je,beforeDestroy:Ue,beforeUnmount:We,destroyed:ye,unmounted:Be,render:ot,renderTracked:at,renderTriggered:xt,errorCaptured:St,serverPrefetch:dt,expose:kt,inheritAttrs:vt,components:pt,directives:Bt,filters:Pt}=a;if(U&&yb(U,m,null),v)for(const Ct in v){const Xt=v[Ct];Gt(Xt)&&(m[Ct]=Xt.bind(d))}if(x){const Ct=x.call(d,d);Oi(Ct)&&(n.data=zc(Ct))}if(_p=!0,T)for(const Ct in T){const Xt=T[Ct],ur=Gt(Xt)?Xt.bind(d,d):Gt(Xt.get)?Xt.get.bind(d,d):Mn,wr=!Gt(Xt)&&Gt(Xt.set)?Xt.set.bind(d):Mn,bi=ar({get:ur,set:wr});Object.defineProperty(m,Ct,{enumerable:!0,configurable:!0,get:()=>bi.value,set:oi=>bi.value=oi})}if(h)for(const Ct in h)W_(h[Ct],m,d,Ct);if(L){const Ct=Gt(L)?L.call(d):L;Reflect.ownKeys(Ct).forEach(Xt=>{el(Xt,Ct[Xt])})}j&&Qm(j,n,"c");function It(Ct,Xt){Vt(Xt)?Xt.forEach(ur=>Ct(ur.bind(d))):Xt&&Ct(Xt.bind(d))}if(It(G_,N),It(Kp,V),It(lb,de),It(cb,_e),It(sb,Ie),It(ob,Je),It(fb,St),It(pb,at),It(db,xt),It(ub,We),It(H_,Be),It(hb,dt),Vt(kt))if(kt.length){const Ct=n.exposed||(n.exposed={});kt.forEach(Xt=>{Object.defineProperty(Ct,Xt,{get:()=>d[Xt],set:ur=>d[Xt]=ur})})}else n.exposed||(n.exposed={});ot&&n.render===Mn&&(n.render=ot),vt!=null&&(n.inheritAttrs=vt),pt&&(n.components=pt),Bt&&(n.directives=Bt)}function yb(n,a,d=Mn){Vt(n)&&(n=yp(n));for(const m in n){const x=n[m];let T;Oi(x)?"default"in x?T=ln(x.from||m,x.default,!0):T=ln(x.from||m):T=ln(x),lr(T)?Object.defineProperty(a,m,{enumerable:!0,configurable:!0,get:()=>T.value,set:v=>T.value=v}):a[m]=T}}function Qm(n,a,d){Nn(Vt(n)?n.map(m=>m.bind(a.proxy)):n.bind(a.proxy),a,d)}function W_(n,a,d,m){const x=m.includes(".")?V_(d,m):()=>d[m];if(mr(n)){const T=a[n];Gt(T)&&_c(x,T)}else if(Gt(n))_c(x,n.bind(d));else if(Oi(n))if(Vt(n))n.forEach(T=>W_(T,a,d,m));else{const T=Gt(n.handler)?n.handler.bind(d):a[n.handler];Gt(T)&&_c(x,T,n)}}function Xp(n){const a=n.type,{mixins:d,extends:m}=a,{mixins:x,optionsCache:T,config:{optionMergeStrategies:v}}=n.appContext,h=T.get(a);let L;return h?L=h:!x.length&&!d&&!m?L=a:(L={},x.length&&x.forEach(U=>uh(L,U,v,!0)),uh(L,a,v)),Oi(a)&&T.set(a,L),L}function uh(n,a,d,m=!1){const{mixins:x,extends:T}=a;T&&uh(n,T,d,!0),x&&x.forEach(v=>uh(n,v,d,!0));for(const v in a)if(!(m&&v==="expose")){const h=xb[v]||d&&d[v];n[v]=h?h(n[v],a[v]):a[v]}return n}const xb={data:eg,props:tg,emits:tg,methods:mc,computed:mc,beforeCreate:Jr,created:Jr,beforeMount:Jr,mounted:Jr,beforeUpdate:Jr,updated:Jr,beforeDestroy:Jr,beforeUnmount:Jr,destroyed:Jr,unmounted:Jr,activated:Jr,deactivated:Jr,errorCaptured:Jr,serverPrefetch:Jr,components:mc,directives:mc,watch:bb,provide:eg,inject:vb};function eg(n,a){return a?n?function(){return kr(Gt(n)?n.call(this,this):n,Gt(a)?a.call(this,this):a)}:a:n}function vb(n,a){return mc(yp(n),yp(a))}function yp(n){if(Vt(n)){const a={};for(let d=0;d<n.length;d++)a[n[d]]=n[d];return a}return n}function Jr(n,a){return n?[...new Set([].concat(n,a))]:a}function mc(n,a){return n?kr(Object.create(null),n,a):a}function tg(n,a){return n?Vt(n)&&Vt(a)?[...new Set([...n,...a])]:kr(Object.create(null),Jm(n),Jm(a??{})):a}function bb(n,a){if(!n)return a;if(!a)return n;const d=kr(Object.create(null),n);for(const m in a)d[m]=Jr(n[m],a[m]);return d}function K_(){return{app:null,config:{isNativeTag:t0,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let wb=0;function Sb(n,a){return function(m,x=null){Gt(m)||(m=kr({},m)),x!=null&&!Oi(x)&&(x=null);const T=K_(),v=new WeakSet;let h=!1;const L=T.app={_uid:wb++,_component:m,_props:x,_container:null,_context:T,_instance:null,version:Kb,get config(){return T.config},set config(U){},use(U,...j){return v.has(U)||(U&&Gt(U.install)?(v.add(U),U.install(L,...j)):Gt(U)&&(v.add(U),U(L,...j))),L},mixin(U){return T.mixins.includes(U)||T.mixins.push(U),L},component(U,j){return j?(T.components[U]=j,L):T.components[U]},directive(U,j){return j?(T.directives[U]=j,L):T.directives[U]},mount(U,j,N){if(!h){const V=Ni(m,x);return V.appContext=T,N===!0?N="svg":N===!1&&(N=void 0),j&&a?a(V,U):n(V,U,N),h=!0,L._container=U,U.__vue_app__=L,kh(V.component)||V.component.proxy}},unmount(){h&&(n(null,L._container),delete L._container.__vue_app__)},provide(U,j){return T.provides[U]=j,L},runWithContext(U){const j=Qa;Qa=L;try{return U()}finally{Qa=j}}};return L}}let Qa=null;function el(n,a){if(Mr){let d=Mr.provides;const m=Mr.parent&&Mr.parent.provides;m===d&&(d=Mr.provides=Object.create(m)),d[n]=a}}function ln(n,a,d=!1){const m=Mr||fr;if(m||Qa){const x=m?m.parent==null?m.vnode.appContext&&m.vnode.appContext.provides:m.parent.provides:Qa._context.provides;if(x&&n in x)return x[n];if(arguments.length>1)return d&&Gt(a)?a.call(m&&m.proxy):a}}function Tb(){return!!(Mr||fr||Qa)}function Ab(n,a,d,m=!1){const x={},T={};oh(T,Ch,1),n.propsDefaults=Object.create(null),X_(n,a,x,T);for(const v in n.propsOptions[0])v in x||(x[v]=void 0);d?n.props=m?x:A_(x):n.type.props?n.props=x:n.props=T,n.attrs=T}function Ib(n,a,d,m){const{props:x,attrs:T,vnode:{patchFlag:v}}=n,h=si(x),[L]=n.propsOptions;let U=!1;if((m||v>0)&&!(v&16)){if(v&8){const j=n.vnode.dynamicProps;for(let N=0;N<j.length;N++){let V=j[N];if(Sh(n.emitsOptions,V))continue;const de=a[V];if(L)if(li(T,V))de!==T[V]&&(T[V]=de,U=!0);else{const _e=os(V);x[_e]=xp(L,h,_e,de,n,!1)}else de!==T[V]&&(T[V]=de,U=!0)}}}else{X_(n,a,x,T)&&(U=!0);let j;for(const N in h)(!a||!li(a,N)&&((j=Go(N))===N||!li(a,j)))&&(L?d&&(d[N]!==void 0||d[j]!==void 0)&&(x[N]=xp(L,h,N,void 0,n,!0)):delete x[N]);if(T!==h)for(const N in T)(!a||!li(a,N))&&(delete T[N],U=!0)}U&&As(n,"set","$attrs")}function X_(n,a,d,m){const[x,T]=n.propsOptions;let v=!1,h;if(a)for(let L in a){if(gc(L))continue;const U=a[L];let j;x&&li(x,j=os(L))?!T||!T.includes(j)?d[j]=U:(h||(h={}))[j]=U:Sh(n.emitsOptions,L)||(!(L in m)||U!==m[L])&&(m[L]=U,v=!0)}if(T){const L=si(d),U=h||Fi;for(let j=0;j<T.length;j++){const N=T[j];d[N]=xp(x,L,N,U[N],n,!li(U,N))}}return v}function xp(n,a,d,m,x,T){const v=n[d];if(v!=null){const h=li(v,"default");if(h&&m===void 0){const L=v.default;if(v.type!==Function&&!v.skipFactory&&Gt(L)){const{propsDefaults:U}=x;if(d in U)m=U[d];else{const j=Rc(x);m=U[d]=L.call(null,a),j()}}else m=L}v[0]&&(T&&!h?m=!1:v[1]&&(m===""||m===Go(d))&&(m=!0))}return m}function Y_(n,a,d=!1){const m=a.propsCache,x=m.get(n);if(x)return x;const T=n.props,v={},h=[];let L=!1;if(!Gt(n)){const j=N=>{L=!0;const[V,de]=Y_(N,a,!0);kr(v,V),de&&h.push(...de)};!d&&a.mixins.length&&a.mixins.forEach(j),n.extends&&j(n.extends),n.mixins&&n.mixins.forEach(j)}if(!T&&!L)return Oi(n)&&m.set(n,Xa),Xa;if(Vt(T))for(let j=0;j<T.length;j++){const N=os(T[j]);ig(N)&&(v[N]=Fi)}else if(T)for(const j in T){const N=os(j);if(ig(N)){const V=T[j],de=v[N]=Vt(V)||Gt(V)?{type:V}:kr({},V);if(de){const _e=sg(Boolean,de.type),Ie=sg(String,de.type);de[0]=_e>-1,de[1]=Ie<0||_e<Ie,(_e>-1||li(de,"default"))&&h.push(N)}}}const U=[v,h];return Oi(n)&&m.set(n,U),U}function ig(n){return n[0]!=="$"&&!gc(n)}function rg(n){return n===null?"null":typeof n=="function"?n.name||"":typeof n=="object"&&n.constructor&&n.constructor.name||""}function ng(n,a){return rg(n)===rg(a)}function sg(n,a){return Vt(a)?a.findIndex(d=>ng(d,n)):Gt(a)&&ng(a,n)?0:-1}const J_=n=>n[0]==="_"||n==="$stable",Yp=n=>Vt(n)?n.map(is):[is(n)],Eb=(n,a,d)=>{if(a._n)return a;const m=Ts((...x)=>Yp(a(...x)),d);return m._c=!1,m},Q_=(n,a,d)=>{const m=n._ctx;for(const x in n){if(J_(x))continue;const T=n[x];if(Gt(T))a[x]=Eb(x,T,m);else if(T!=null){const v=Yp(T);a[x]=()=>v}}},ey=(n,a)=>{const d=Yp(a);n.slots.default=()=>d},Pb=(n,a)=>{if(n.vnode.shapeFlag&32){const d=a._;d?(n.slots=si(a),oh(a,"_",d)):Q_(a,n.slots={})}else n.slots={},a&&ey(n,a);oh(n.slots,Ch,1)},Cb=(n,a,d)=>{const{vnode:m,slots:x}=n;let T=!0,v=Fi;if(m.shapeFlag&32){const h=a._;h?d&&h===1?T=!1:(kr(x,a),!d&&h===1&&delete x._):(T=!a.$stable,Q_(a,x)),v=a}else a&&(ey(n,a),v={default:1});if(T)for(const h in x)!J_(h)&&v[h]==null&&delete x[h]};function vp(n,a,d,m,x=!1){if(Vt(n)){n.forEach((V,de)=>vp(V,a&&(Vt(a)?a[de]:a),d,m,x));return}if(yc(m)&&!x)return;const T=m.shapeFlag&4?kh(m.component)||m.component.proxy:m.el,v=x?null:T,{i:h,r:L}=n,U=a&&a.r,j=h.refs===Fi?h.refs={}:h.refs,N=h.setupState;if(U!=null&&U!==L&&(mr(U)?(j[U]=null,li(N,U)&&(N[U]=null)):lr(U)&&(U.value=null)),Gt(L))so(L,h,12,[v,j]);else{const V=mr(L),de=lr(L);if(V||de){const _e=()=>{if(n.f){const Ie=V?li(N,L)?N[L]:j[L]:L.value;x?Vt(Ie)&&Fp(Ie,T):Vt(Ie)?Ie.includes(T)||Ie.push(T):V?(j[L]=[T],li(N,L)&&(N[L]=j[L])):(L.value=[T],n.k&&(j[n.k]=L.value))}else V?(j[L]=v,li(N,L)&&(N[L]=v)):de&&(L.value=v,n.k&&(j[n.k]=v))};v?(_e.id=-1,an(_e,d)):_e()}}}const an=tb;function Mb(n){return kb(n)}function kb(n,a){const d=l_();d.__VUE__=!0;const{insert:m,remove:x,patchProp:T,createElement:v,createText:h,createComment:L,setText:U,setElementText:j,parentNode:N,nextSibling:V,setScopeId:de=Mn,insertStaticContent:_e}=n,Ie=(J,ie,ve,De=null,ee=null,qe=null,et=void 0,Ae=null,Oe=!!ie.dynamicChildren)=>{if(J===ie)return;J&&!lc(J,ie)&&(De=Pe(J),oi(J,ee,qe,!0),J=null),ie.patchFlag===-2&&(Oe=!1,ie.dynamicChildren=null);const{type:Fe,ref:nt,shapeFlag:bt}=ie;switch(Fe){case Ph:Je(J,ie,ve,De);break;case ao:Ue(J,ie,ve,De);break;case eh:J==null&&We(ie,ve,De,et);break;case pr:pt(J,ie,ve,De,ee,qe,et,Ae,Oe);break;default:bt&1?ot(J,ie,ve,De,ee,qe,et,Ae,Oe):bt&6?Bt(J,ie,ve,De,ee,qe,et,Ae,Oe):(bt&64||bt&128)&&Fe.process(J,ie,ve,De,ee,qe,et,Ae,Oe,ct)}nt!=null&&ee&&vp(nt,J&&J.ref,qe,ie||J,!ie)},Je=(J,ie,ve,De)=>{if(J==null)m(ie.el=h(ie.children),ve,De);else{const ee=ie.el=J.el;ie.children!==J.children&&U(ee,ie.children)}},Ue=(J,ie,ve,De)=>{J==null?m(ie.el=L(ie.children||""),ve,De):ie.el=J.el},We=(J,ie,ve,De)=>{[J.el,J.anchor]=_e(J.children,ie,ve,De,J.el,J.anchor)},ye=({el:J,anchor:ie},ve,De)=>{let ee;for(;J&&J!==ie;)ee=V(J),m(J,ve,De),J=ee;m(ie,ve,De)},Be=({el:J,anchor:ie})=>{let ve;for(;J&&J!==ie;)ve=V(J),x(J),J=ve;x(ie)},ot=(J,ie,ve,De,ee,qe,et,Ae,Oe)=>{ie.type==="svg"?et="svg":ie.type==="math"&&(et="mathml"),J==null?at(ie,ve,De,ee,qe,et,Ae,Oe):dt(J,ie,ee,qe,et,Ae,Oe)},at=(J,ie,ve,De,ee,qe,et,Ae)=>{let Oe,Fe;const{props:nt,shapeFlag:bt,transition:ft,dirs:Tt}=J;if(Oe=J.el=v(J.type,qe,nt&&nt.is,nt),bt&8?j(Oe,J.children):bt&16&&St(J.children,Oe,null,De,ee,Jd(J,qe),et,Ae),Tt&&Fo(J,null,De,"created"),xt(Oe,J,J.scopeId,et,De),nt){for(const Yt in nt)Yt!=="value"&&!gc(Yt)&&T(Oe,Yt,null,nt[Yt],qe,J.children,De,ee,wi);"value"in nt&&T(Oe,"value",null,nt.value,qe),(Fe=nt.onVnodeBeforeMount)&&es(Fe,De,J)}Tt&&Fo(J,null,De,"beforeMount");const jt=Db(ee,ft);jt&&ft.beforeEnter(Oe),m(Oe,ie,ve),((Fe=nt&&nt.onVnodeMounted)||jt||Tt)&&an(()=>{Fe&&es(Fe,De,J),jt&&ft.enter(Oe),Tt&&Fo(J,null,De,"mounted")},ee)},xt=(J,ie,ve,De,ee)=>{if(ve&&de(J,ve),De)for(let qe=0;qe<De.length;qe++)de(J,De[qe]);if(ee){let qe=ee.subTree;if(ie===qe){const et=ee.vnode;xt(J,et,et.scopeId,et.slotScopeIds,ee.parent)}}},St=(J,ie,ve,De,ee,qe,et,Ae,Oe=0)=>{for(let Fe=Oe;Fe<J.length;Fe++){const nt=J[Fe]=Ae?to(J[Fe]):is(J[Fe]);Ie(null,nt,ie,ve,De,ee,qe,et,Ae)}},dt=(J,ie,ve,De,ee,qe,et)=>{const Ae=ie.el=J.el;let{patchFlag:Oe,dynamicChildren:Fe,dirs:nt}=ie;Oe|=J.patchFlag&16;const bt=J.props||Fi,ft=ie.props||Fi;let Tt;if(ve&&Oo(ve,!1),(Tt=ft.onVnodeBeforeUpdate)&&es(Tt,ve,ie,J),nt&&Fo(ie,J,ve,"beforeUpdate"),ve&&Oo(ve,!0),Fe?kt(J.dynamicChildren,Fe,Ae,ve,De,Jd(ie,ee),qe):et||Xt(J,ie,Ae,null,ve,De,Jd(ie,ee),qe,!1),Oe>0){if(Oe&16)vt(Ae,ie,bt,ft,ve,De,ee);else if(Oe&2&&bt.class!==ft.class&&T(Ae,"class",null,ft.class,ee),Oe&4&&T(Ae,"style",bt.style,ft.style,ee),Oe&8){const jt=ie.dynamicProps;for(let Yt=0;Yt<jt.length;Yt++){const Ce=jt[Yt],pi=bt[Ce],Si=ft[Ce];(Si!==pi||Ce==="value")&&T(Ae,Ce,pi,Si,ee,J.children,ve,De,wi)}}Oe&1&&J.children!==ie.children&&j(Ae,ie.children)}else!et&&Fe==null&&vt(Ae,ie,bt,ft,ve,De,ee);((Tt=ft.onVnodeUpdated)||nt)&&an(()=>{Tt&&es(Tt,ve,ie,J),nt&&Fo(ie,J,ve,"updated")},De)},kt=(J,ie,ve,De,ee,qe,et)=>{for(let Ae=0;Ae<ie.length;Ae++){const Oe=J[Ae],Fe=ie[Ae],nt=Oe.el&&(Oe.type===pr||!lc(Oe,Fe)||Oe.shapeFlag&70)?N(Oe.el):ve;Ie(Oe,Fe,nt,null,De,ee,qe,et,!0)}},vt=(J,ie,ve,De,ee,qe,et)=>{if(ve!==De){if(ve!==Fi)for(const Ae in ve)!gc(Ae)&&!(Ae in De)&&T(J,Ae,ve[Ae],null,et,ie.children,ee,qe,wi);for(const Ae in De){if(gc(Ae))continue;const Oe=De[Ae],Fe=ve[Ae];Oe!==Fe&&Ae!=="value"&&T(J,Ae,Fe,Oe,et,ie.children,ee,qe,wi)}"value"in De&&T(J,"value",ve.value,De.value,et)}},pt=(J,ie,ve,De,ee,qe,et,Ae,Oe)=>{const Fe=ie.el=J?J.el:h(""),nt=ie.anchor=J?J.anchor:h("");let{patchFlag:bt,dynamicChildren:ft,slotScopeIds:Tt}=ie;Tt&&(Ae=Ae?Ae.concat(Tt):Tt),J==null?(m(Fe,ve,De),m(nt,ve,De),St(ie.children||[],ve,nt,ee,qe,et,Ae,Oe)):bt>0&&bt&64&&ft&&J.dynamicChildren?(kt(J.dynamicChildren,ft,ve,ee,qe,et,Ae),(ie.key!=null||ee&&ie===ee.subTree)&&ty(J,ie,!0)):Xt(J,ie,ve,nt,ee,qe,et,Ae,Oe)},Bt=(J,ie,ve,De,ee,qe,et,Ae,Oe)=>{ie.slotScopeIds=Ae,J==null?ie.shapeFlag&512?ee.ctx.activate(ie,ve,De,et,Oe):Pt(ie,ve,De,ee,qe,et,Oe):di(J,ie,Oe)},Pt=(J,ie,ve,De,ee,qe,et)=>{const Ae=J.component=Ub(J,De,ee);if(j_(J)&&(Ae.ctx.renderer=ct),jb(Ae),Ae.asyncDep){if(ee&&ee.registerDep(Ae,It),!J.el){const Oe=Ae.subTree=Ni(ao);Ue(null,Oe,ie,ve)}}else It(Ae,J,ie,ve,ee,qe,et)},di=(J,ie,ve)=>{const De=ie.component=J.component;if(X0(J,ie,ve))if(De.asyncDep&&!De.asyncResolved){Ct(De,ie,ve);return}else De.next=ie,q0(De.update),De.effect.dirty=!0,De.update();else ie.el=J.el,De.vnode=ie},It=(J,ie,ve,De,ee,qe,et)=>{const Ae=()=>{if(J.isMounted){let{next:nt,bu:bt,u:ft,parent:Tt,vnode:jt}=J;{const en=iy(J);if(en){nt&&(nt.el=jt.el,Ct(J,nt,et)),en.asyncDep.then(()=>{J.isUnmounted||Ae()});return}}let Yt=nt,Ce;Oo(J,!1),nt?(nt.el=jt.el,Ct(J,nt,et)):nt=jt,bt&&Ju(bt),(Ce=nt.props&&nt.props.onVnodeBeforeUpdate)&&es(Ce,Tt,nt,jt),Oo(J,!0);const pi=Xd(J),Si=J.subTree;J.subTree=pi,Ie(Si,pi,N(Si.el),Pe(Si),J,ee,qe),nt.el=pi.el,Yt===null&&Y0(J,pi.el),ft&&an(ft,ee),(Ce=nt.props&&nt.props.onVnodeUpdated)&&an(()=>es(Ce,Tt,nt,jt),ee)}else{let nt;const{el:bt,props:ft}=ie,{bm:Tt,m:jt,parent:Yt}=J,Ce=yc(ie);if(Oo(J,!1),Tt&&Ju(Tt),!Ce&&(nt=ft&&ft.onVnodeBeforeMount)&&es(nt,Yt,ie),Oo(J,!0),bt&&ti){const pi=()=>{J.subTree=Xd(J),ti(bt,J.subTree,J,ee,null)};Ce?ie.type.__asyncLoader().then(()=>!J.isUnmounted&&pi()):pi()}else{const pi=J.subTree=Xd(J);Ie(null,pi,ve,De,J,ee,qe),ie.el=pi.el}if(jt&&an(jt,ee),!Ce&&(nt=ft&&ft.onVnodeMounted)){const pi=ie;an(()=>es(nt,Yt,pi),ee)}(ie.shapeFlag&256||Yt&&yc(Yt.vnode)&&Yt.vnode.shapeFlag&256)&&J.a&&an(J.a,ee),J.isMounted=!0,ie=ve=De=null}},Oe=J.effect=new Np(Ae,Mn,()=>Wp(Fe),J.scope),Fe=J.update=()=>{Oe.dirty&&Oe.run()};Fe.id=J.uid,Oo(J,!0),Fe()},Ct=(J,ie,ve)=>{ie.component=J;const De=J.vnode.props;J.vnode=ie,J.next=null,Ib(J,ie.props,De,ve),Cb(J,ie.children,ve),Ho(),Km(J),Zo()},Xt=(J,ie,ve,De,ee,qe,et,Ae,Oe=!1)=>{const Fe=J&&J.children,nt=J?J.shapeFlag:0,bt=ie.children,{patchFlag:ft,shapeFlag:Tt}=ie;if(ft>0){if(ft&128){wr(Fe,bt,ve,De,ee,qe,et,Ae,Oe);return}else if(ft&256){ur(Fe,bt,ve,De,ee,qe,et,Ae,Oe);return}}Tt&8?(nt&16&&wi(Fe,ee,qe),bt!==Fe&&j(ve,bt)):nt&16?Tt&16?wr(Fe,bt,ve,De,ee,qe,et,Ae,Oe):wi(Fe,ee,qe,!0):(nt&8&&j(ve,""),Tt&16&&St(bt,ve,De,ee,qe,et,Ae,Oe))},ur=(J,ie,ve,De,ee,qe,et,Ae,Oe)=>{J=J||Xa,ie=ie||Xa;const Fe=J.length,nt=ie.length,bt=Math.min(Fe,nt);let ft;for(ft=0;ft<bt;ft++){const Tt=ie[ft]=Oe?to(ie[ft]):is(ie[ft]);Ie(J[ft],Tt,ve,null,ee,qe,et,Ae,Oe)}Fe>nt?wi(J,ee,qe,!0,!1,bt):St(ie,ve,De,ee,qe,et,Ae,Oe,bt)},wr=(J,ie,ve,De,ee,qe,et,Ae,Oe)=>{let Fe=0;const nt=ie.length;let bt=J.length-1,ft=nt-1;for(;Fe<=bt&&Fe<=ft;){const Tt=J[Fe],jt=ie[Fe]=Oe?to(ie[Fe]):is(ie[Fe]);if(lc(Tt,jt))Ie(Tt,jt,ve,null,ee,qe,et,Ae,Oe);else break;Fe++}for(;Fe<=bt&&Fe<=ft;){const Tt=J[bt],jt=ie[ft]=Oe?to(ie[ft]):is(ie[ft]);if(lc(Tt,jt))Ie(Tt,jt,ve,null,ee,qe,et,Ae,Oe);else break;bt--,ft--}if(Fe>bt){if(Fe<=ft){const Tt=ft+1,jt=Tt<nt?ie[Tt].el:De;for(;Fe<=ft;)Ie(null,ie[Fe]=Oe?to(ie[Fe]):is(ie[Fe]),ve,jt,ee,qe,et,Ae,Oe),Fe++}}else if(Fe>ft)for(;Fe<=bt;)oi(J[Fe],ee,qe,!0),Fe++;else{const Tt=Fe,jt=Fe,Yt=new Map;for(Fe=jt;Fe<=ft;Fe++){const gt=ie[Fe]=Oe?to(ie[Fe]):is(ie[Fe]);gt.key!=null&&Yt.set(gt.key,Fe)}let Ce,pi=0;const Si=ft-jt+1;let en=!1,Xi=0;const Ve=new Array(Si);for(Fe=0;Fe<Si;Fe++)Ve[Fe]=0;for(Fe=Tt;Fe<=bt;Fe++){const gt=J[Fe];if(pi>=Si){oi(gt,ee,qe,!0);continue}let ai;if(gt.key!=null)ai=Yt.get(gt.key);else for(Ce=jt;Ce<=ft;Ce++)if(Ve[Ce-jt]===0&&lc(gt,ie[Ce])){ai=Ce;break}ai===void 0?oi(gt,ee,qe,!0):(Ve[ai-jt]=Fe+1,ai>=Xi?Xi=ai:en=!0,Ie(gt,ie[ai],ve,null,ee,qe,et,Ae,Oe),pi++)}const Mt=en?zb(Ve):Xa;for(Ce=Mt.length-1,Fe=Si-1;Fe>=0;Fe--){const gt=jt+Fe,ai=ie[gt],Ur=gt+1<nt?ie[gt+1].el:De;Ve[Fe]===0?Ie(null,ai,ve,Ur,ee,qe,et,Ae,Oe):en&&(Ce<0||Fe!==Mt[Ce]?bi(ai,ve,Ur,2):Ce--)}}},bi=(J,ie,ve,De,ee=null)=>{const{el:qe,type:et,transition:Ae,children:Oe,shapeFlag:Fe}=J;if(Fe&6){bi(J.component.subTree,ie,ve,De);return}if(Fe&128){J.suspense.move(ie,ve,De);return}if(Fe&64){et.move(J,ie,ve,ct);return}if(et===pr){m(qe,ie,ve);for(let bt=0;bt<Oe.length;bt++)bi(Oe[bt],ie,ve,De);m(J.anchor,ie,ve);return}if(et===eh){ye(J,ie,ve);return}if(De!==2&&Fe&1&&Ae)if(De===0)Ae.beforeEnter(qe),m(qe,ie,ve),an(()=>Ae.enter(qe),ee);else{const{leave:bt,delayLeave:ft,afterLeave:Tt}=Ae,jt=()=>m(qe,ie,ve),Yt=()=>{bt(qe,()=>{jt(),Tt&&Tt()})};ft?ft(qe,jt,Yt):Yt()}else m(qe,ie,ve)},oi=(J,ie,ve,De=!1,ee=!1)=>{const{type:qe,props:et,ref:Ae,children:Oe,dynamicChildren:Fe,shapeFlag:nt,patchFlag:bt,dirs:ft}=J;if(Ae!=null&&vp(Ae,null,ve,J,!0),nt&256){ie.ctx.deactivate(J);return}const Tt=nt&1&&ft,jt=!yc(J);let Yt;if(jt&&(Yt=et&&et.onVnodeBeforeUnmount)&&es(Yt,ie,J),nt&6)gr(J.component,ve,De);else{if(nt&128){J.suspense.unmount(ve,De);return}Tt&&Fo(J,null,ie,"beforeUnmount"),nt&64?J.type.remove(J,ie,ve,ee,ct,De):Fe&&(qe!==pr||bt>0&&bt&64)?wi(Fe,ie,ve,!1,!0):(qe===pr&&bt&384||!ee&&nt&16)&&wi(Oe,ie,ve),De&&hr(J)}(jt&&(Yt=et&&et.onVnodeUnmounted)||Tt)&&an(()=>{Yt&&es(Yt,ie,J),Tt&&Fo(J,null,ie,"unmounted")},ve)},hr=J=>{const{type:ie,el:ve,anchor:De,transition:ee}=J;if(ie===pr){Qr(ve,De);return}if(ie===eh){Be(J);return}const qe=()=>{x(ve),ee&&!ee.persisted&&ee.afterLeave&&ee.afterLeave()};if(J.shapeFlag&1&&ee&&!ee.persisted){const{leave:et,delayLeave:Ae}=ee,Oe=()=>et(ve,qe);Ae?Ae(J.el,qe,Oe):Oe()}else qe()},Qr=(J,ie)=>{let ve;for(;J!==ie;)ve=V(J),x(J),J=ve;x(ie)},gr=(J,ie,ve)=>{const{bum:De,scope:ee,update:qe,subTree:et,um:Ae}=J;De&&Ju(De),ee.stop(),qe&&(qe.active=!1,oi(et,J,ie,ve)),Ae&&an(Ae,ie),an(()=>{J.isUnmounted=!0},ie),ie&&ie.pendingBranch&&!ie.isUnmounted&&J.asyncDep&&!J.asyncResolved&&J.suspenseId===ie.pendingId&&(ie.deps--,ie.deps===0&&ie.resolve())},wi=(J,ie,ve,De=!1,ee=!1,qe=0)=>{for(let et=qe;et<J.length;et++)oi(J[et],ie,ve,De,ee)},Pe=J=>J.shapeFlag&6?Pe(J.component.subTree):J.shapeFlag&128?J.suspense.next():V(J.anchor||J.el);let tt=!1;const Qe=(J,ie,ve)=>{J==null?ie._vnode&&oi(ie._vnode,null,null,!0):Ie(ie._vnode||null,J,ie,null,null,null,ve),tt||(tt=!0,Km(),L_(),tt=!1),ie._vnode=J},ct={p:Ie,um:oi,m:bi,r:hr,mt:Pt,mc:St,pc:Xt,pbc:kt,n:Pe,o:n};let Qt,ti;return a&&([Qt,ti]=a(ct)),{render:Qe,hydrate:Qt,createApp:Sb(Qe,Qt)}}function Jd({type:n,props:a},d){return d==="svg"&&n==="foreignObject"||d==="mathml"&&n==="annotation-xml"&&a&&a.encoding&&a.encoding.includes("html")?void 0:d}function Oo({effect:n,update:a},d){n.allowRecurse=a.allowRecurse=d}function Db(n,a){return(!n||n&&!n.pendingBranch)&&a&&!a.persisted}function ty(n,a,d=!1){const m=n.children,x=a.children;if(Vt(m)&&Vt(x))for(let T=0;T<m.length;T++){const v=m[T];let h=x[T];h.shapeFlag&1&&!h.dynamicChildren&&((h.patchFlag<=0||h.patchFlag===32)&&(h=x[T]=to(x[T]),h.el=v.el),d||ty(v,h)),h.type===Ph&&(h.el=v.el)}}function zb(n){const a=n.slice(),d=[0];let m,x,T,v,h;const L=n.length;for(m=0;m<L;m++){const U=n[m];if(U!==0){if(x=d[d.length-1],n[x]<U){a[m]=x,d.push(m);continue}for(T=0,v=d.length-1;T<v;)h=T+v>>1,n[d[h]]<U?T=h+1:v=h;U<n[d[T]]&&(T>0&&(a[m]=d[T-1]),d[T]=m)}}for(T=d.length,v=d[T-1];T-- >0;)d[T]=v,v=a[v];return d}function iy(n){const a=n.subTree.component;if(a)return a.asyncDep&&!a.asyncResolved?a:iy(a)}const Rb=n=>n.__isTeleport,pr=Symbol.for("v-fgt"),Ph=Symbol.for("v-txt"),ao=Symbol.for("v-cmt"),eh=Symbol.for("v-stc"),vc=[];let Bn=null;function Nt(n=!1){vc.push(Bn=n?null:[])}function Lb(){vc.pop(),Bn=vc[vc.length-1]||null}let Ec=1;function og(n){Ec+=n}function ry(n){return n.dynamicChildren=Ec>0?Bn||Xa:null,Lb(),Ec>0&&Bn&&Bn.push(n),n}function ri(n,a,d,m,x,T){return ry(fe(n,a,d,m,x,T,!0))}function ts(n,a,d,m,x){return ry(Ni(n,a,d,m,x,!0))}function hh(n){return n?n.__v_isVNode===!0:!1}function lc(n,a){return n.type===a.type&&n.key===a.key}const Ch="__vInternal",ny=({key:n})=>n??null,th=({ref:n,ref_key:a,ref_for:d})=>(typeof n=="number"&&(n=""+n),n!=null?mr(n)||lr(n)||Gt(n)?{i:fr,r:n,k:a,f:!!d}:n:null);function fe(n,a=null,d=null,m=0,x=null,T=n===pr?0:1,v=!1,h=!1){const L={__v_isVNode:!0,__v_skip:!0,type:n,props:a,key:a&&ny(a),ref:a&&th(a),scopeId:Th,slotScopeIds:null,children:d,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:T,patchFlag:m,dynamicProps:x,dynamicChildren:null,appContext:null,ctx:fr};return h?(Jp(L,d),T&128&&n.normalize(L)):d&&(L.shapeFlag|=mr(d)?8:16),Ec>0&&!v&&Bn&&(L.patchFlag>0||T&6)&&L.patchFlag!==32&&Bn.push(L),L}const Ni=Fb;function Fb(n,a=null,d=null,m=0,x=null,T=!1){if((!n||n===J0)&&(n=ao),hh(n)){const h=il(n,a,!0);return d&&Jp(h,d),Ec>0&&!T&&Bn&&(h.shapeFlag&6?Bn[Bn.indexOf(n)]=h:Bn.push(h)),h.patchFlag|=-2,h}if(Wb(n)&&(n=n.__vccOpts),a){a=Ob(a);let{class:h,style:L}=a;h&&!mr(h)&&(a.class=Dc(h)),Oi(L)&&(E_(L)&&!Vt(L)&&(L=kr({},L)),a.style=Bp(L))}const v=mr(n)?1:eb(n)?128:Rb(n)?64:Oi(n)?4:Gt(n)?2:0;return fe(n,a,d,m,x,v,T,!0)}function Ob(n){return n?E_(n)||Ch in n?kr({},n):n:null}function il(n,a,d=!1){const{props:m,ref:x,patchFlag:T,children:v}=n,h=a?Nb(m||{},a):m;return{__v_isVNode:!0,__v_skip:!0,type:n.type,props:h,key:h&&ny(h),ref:a&&a.ref?d&&x?Vt(x)?x.concat(th(a)):[x,th(a)]:th(a):x,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:v,target:n.target,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:a&&n.type!==pr?T===-1?16:T|16:T,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:n.transition,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&il(n.ssContent),ssFallback:n.ssFallback&&il(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce}}function sy(n=" ",a=0){return Ni(Ph,null,n,a)}function Bb(n,a){const d=Ni(eh,null,n);return d.staticCount=a,d}function br(n="",a=!1){return a?(Nt(),ts(ao,null,n)):Ni(ao,null,n)}function is(n){return n==null||typeof n=="boolean"?Ni(ao):Vt(n)?Ni(pr,null,n.slice()):typeof n=="object"?to(n):Ni(Ph,null,String(n))}function to(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:il(n)}function Jp(n,a){let d=0;const{shapeFlag:m}=n;if(a==null)a=null;else if(Vt(a))d=16;else if(typeof a=="object")if(m&65){const x=a.default;x&&(x._c&&(x._d=!1),Jp(n,x()),x._c&&(x._d=!0));return}else{d=32;const x=a._;!x&&!(Ch in a)?a._ctx=fr:x===3&&fr&&(fr.slots._===1?a._=1:(a._=2,n.patchFlag|=1024))}else Gt(a)?(a={default:a,_ctx:fr},d=32):(a=String(a),m&64?(d=16,a=[sy(a)]):d=8);n.children=a,n.shapeFlag|=d}function Nb(...n){const a={};for(let d=0;d<n.length;d++){const m=n[d];for(const x in m)if(x==="class")a.class!==m.class&&(a.class=Dc([a.class,m.class]));else if(x==="style")a.style=Bp([a.style,m.style]);else if(gh(x)){const T=a[x],v=m[x];v&&T!==v&&!(Vt(T)&&T.includes(v))&&(a[x]=T?[].concat(T,v):v)}else x!==""&&(a[x]=m[x])}return a}function es(n,a,d,m=null){Nn(n,a,7,[d,m])}const Vb=K_();let $b=0;function Ub(n,a,d){const m=n.type,x=(a?a.appContext:n.appContext)||Vb,T={uid:$b++,vnode:n,type:m,parent:a,appContext:x,root:null,next:null,subTree:null,effect:null,update:null,scope:new h_(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:a?a.provides:Object.create(x.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Y_(m,x),emitsOptions:O_(m,x),emit:null,emitted:null,propsDefaults:Fi,inheritAttrs:m.inheritAttrs,ctx:Fi,data:Fi,props:Fi,attrs:Fi,slots:Fi,refs:Fi,setupState:Fi,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:d,suspenseId:d?d.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return T.ctx={_:T},T.root=a?a.root:T,T.emit=Z0.bind(null,T),n.ce&&n.ce(T),T}let Mr=null,dh,bp;{const n=l_(),a=(d,m)=>{let x;return(x=n[d])||(x=n[d]=[]),x.push(m),T=>{x.length>1?x.forEach(v=>v(T)):x[0](T)}};dh=a("__VUE_INSTANCE_SETTERS__",d=>Mr=d),bp=a("__VUE_SSR_SETTERS__",d=>Mh=d)}const Rc=n=>{const a=Mr;return dh(n),n.scope.on(),()=>{n.scope.off(),dh(a)}},ag=()=>{Mr&&Mr.scope.off(),dh(null)};function oy(n){return n.vnode.shapeFlag&4}let Mh=!1;function jb(n,a=!1){a&&bp(a);const{props:d,children:m}=n.vnode,x=oy(n);Ab(n,d,x,a),Pb(n,m);const T=x?qb(n,a):void 0;return a&&bp(!1),T}function qb(n,a){const d=n.type;n.accessCache=Object.create(null),n.proxy=bh(new Proxy(n.ctx,gb));const{setup:m}=d;if(m){const x=n.setupContext=m.length>1?Hb(n):null,T=Rc(n);Ho();const v=so(m,n,0,[n.props,x]);if(Zo(),T(),s_(v)){if(v.then(ag,ag),a)return v.then(h=>{lg(n,h,a)}).catch(h=>{wh(h,n,0)});n.asyncDep=v}else lg(n,v,a)}else ay(n,a)}function lg(n,a,d){Gt(a)?n.type.__ssrInlineRender?n.ssrRender=a:n.render=a:Oi(a)&&(n.setupState=k_(a)),ay(n,d)}let cg;function ay(n,a,d){const m=n.type;if(!n.render){if(!a&&cg&&!m.render){const x=m.template||Xp(n).template;if(x){const{isCustomElement:T,compilerOptions:v}=n.appContext.config,{delimiters:h,compilerOptions:L}=m,U=kr(kr({isCustomElement:T,delimiters:h},v),L);m.render=cg(x,U)}}n.render=m.render||Mn}{const x=Rc(n);Ho();try{_b(n)}finally{Zo(),x()}}}function Gb(n){return n.attrsProxy||(n.attrsProxy=new Proxy(n.attrs,{get(a,d){return cn(n,"get","$attrs"),a[d]}}))}function Hb(n){const a=d=>{n.exposed=d||{}};return{get attrs(){return Gb(n)},slots:n.slots,emit:n.emit,expose:a}}function kh(n){if(n.exposed)return n.exposeProxy||(n.exposeProxy=new Proxy(k_(bh(n.exposed)),{get(a,d){if(d in a)return a[d];if(d in xc)return xc[d](n)},has(a,d){return d in a||d in xc}}))}function Zb(n,a=!0){return Gt(n)?n.displayName||n.name:n.name||a&&n.__name}function Wb(n){return Gt(n)&&"__vccOpts"in n}const ar=(n,a)=>R0(n,a,Mh);function ly(n,a,d){const m=arguments.length;return m===2?Oi(a)&&!Vt(a)?hh(a)?Ni(n,null,[a]):Ni(n,a):Ni(n,null,a):(m>3?d=Array.prototype.slice.call(arguments,2):m===3&&hh(d)&&(d=[d]),Ni(n,a,d))}const Kb="3.4.21";/**
* @vue/runtime-dom v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const Xb="http://www.w3.org/2000/svg",Yb="http://www.w3.org/1998/Math/MathML",io=typeof document<"u"?document:null,ug=io&&io.createElement("template"),Jb={insert:(n,a,d)=>{a.insertBefore(n,d||null)},remove:n=>{const a=n.parentNode;a&&a.removeChild(n)},createElement:(n,a,d,m)=>{const x=a==="svg"?io.createElementNS(Xb,n):a==="mathml"?io.createElementNS(Yb,n):io.createElement(n,d?{is:d}:void 0);return n==="select"&&m&&m.multiple!=null&&x.setAttribute("multiple",m.multiple),x},createText:n=>io.createTextNode(n),createComment:n=>io.createComment(n),setText:(n,a)=>{n.nodeValue=a},setElementText:(n,a)=>{n.textContent=a},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>io.querySelector(n),setScopeId(n,a){n.setAttribute(a,"")},insertStaticContent(n,a,d,m,x,T){const v=d?d.previousSibling:a.lastChild;if(x&&(x===T||x.nextSibling))for(;a.insertBefore(x.cloneNode(!0),d),!(x===T||!(x=x.nextSibling)););else{ug.innerHTML=m==="svg"?`<svg>${n}</svg>`:m==="mathml"?`<math>${n}</math>`:n;const h=ug.content;if(m==="svg"||m==="mathml"){const L=h.firstChild;for(;L.firstChild;)h.appendChild(L.firstChild);h.removeChild(L)}a.insertBefore(h,d)}return[v?v.nextSibling:a.firstChild,d?d.previousSibling:a.lastChild]}},Qb=Symbol("_vtc");function e1(n,a,d){const m=n[Qb];m&&(a=(a?[a,...m]:[...m]).join(" ")),a==null?n.removeAttribute("class"):d?n.setAttribute("class",a):n.className=a}const ph=Symbol("_vod"),cy=Symbol("_vsh"),t1={beforeMount(n,{value:a},{transition:d}){n[ph]=n.style.display==="none"?"":n.style.display,d&&a?d.beforeEnter(n):cc(n,a)},mounted(n,{value:a},{transition:d}){d&&a&&d.enter(n)},updated(n,{value:a,oldValue:d},{transition:m}){!a!=!d&&(m?a?(m.beforeEnter(n),cc(n,!0),m.enter(n)):m.leave(n,()=>{cc(n,!1)}):cc(n,a))},beforeUnmount(n,{value:a}){cc(n,a)}};function cc(n,a){n.style.display=a?n[ph]:"none",n[cy]=!a}const i1=Symbol(""),r1=/(^|;)\s*display\s*:/;function n1(n,a,d){const m=n.style,x=mr(d);let T=!1;if(d&&!x){if(a)if(mr(a))for(const v of a.split(";")){const h=v.slice(0,v.indexOf(":")).trim();d[h]==null&&ih(m,h,"")}else for(const v in a)d[v]==null&&ih(m,v,"");for(const v in d)v==="display"&&(T=!0),ih(m,v,d[v])}else if(x){if(a!==d){const v=m[i1];v&&(d+=";"+v),m.cssText=d,T=r1.test(d)}}else a&&n.removeAttribute("style");ph in n&&(n[ph]=T?m.display:"",n[cy]&&(m.display="none"))}const hg=/\s*!important$/;function ih(n,a,d){if(Vt(d))d.forEach(m=>ih(n,a,m));else if(d==null&&(d=""),a.startsWith("--"))n.setProperty(a,d);else{const m=s1(n,a);hg.test(d)?n.setProperty(Go(m),d.replace(hg,""),"important"):n[m]=d}}const dg=["Webkit","Moz","ms"],Qd={};function s1(n,a){const d=Qd[a];if(d)return d;let m=os(a);if(m!=="filter"&&m in n)return Qd[a]=m;m=xh(m);for(let x=0;x<dg.length;x++){const T=dg[x]+m;if(T in n)return Qd[a]=T}return a}const pg="http://www.w3.org/1999/xlink";function o1(n,a,d,m,x){if(m&&a.startsWith("xlink:"))d==null?n.removeAttributeNS(pg,a.slice(6,a.length)):n.setAttributeNS(pg,a,d);else{const T=h0(a);d==null||T&&!c_(d)?n.removeAttribute(a):n.setAttribute(a,T?"":d)}}function a1(n,a,d,m,x,T,v){if(a==="innerHTML"||a==="textContent"){m&&v(m,x,T),n[a]=d??"";return}const h=n.tagName;if(a==="value"&&h!=="PROGRESS"&&!h.includes("-")){const U=h==="OPTION"?n.getAttribute("value")||"":n.value,j=d??"";(U!==j||!("_value"in n))&&(n.value=j),d==null&&n.removeAttribute(a),n._value=d;return}let L=!1;if(d===""||d==null){const U=typeof n[a];U==="boolean"?d=c_(d):d==null&&U==="string"?(d="",L=!0):U==="number"&&(d=0,L=!0)}try{n[a]=d}catch{}L&&n.removeAttribute(a)}function Za(n,a,d,m){n.addEventListener(a,d,m)}function l1(n,a,d,m){n.removeEventListener(a,d,m)}const fg=Symbol("_vei");function c1(n,a,d,m,x=null){const T=n[fg]||(n[fg]={}),v=T[a];if(m&&v)v.value=m;else{const[h,L]=u1(a);if(m){const U=T[a]=p1(m,x);Za(n,h,U,L)}else v&&(l1(n,h,v,L),T[a]=void 0)}}const mg=/(?:Once|Passive|Capture)$/;function u1(n){let a;if(mg.test(n)){a={};let m;for(;m=n.match(mg);)n=n.slice(0,n.length-m[0].length),a[m[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):Go(n.slice(2)),a]}let ep=0;const h1=Promise.resolve(),d1=()=>ep||(h1.then(()=>ep=0),ep=Date.now());function p1(n,a){const d=m=>{if(!m._vts)m._vts=Date.now();else if(m._vts<=d.attached)return;Nn(f1(m,d.value),a,5,[m])};return d.value=n,d.attached=d1(),d}function f1(n,a){if(Vt(a)){const d=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{d.call(n),n._stopped=!0},a.map(m=>x=>!x._stopped&&m&&m(x))}else return a}const gg=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,m1=(n,a,d,m,x,T,v,h,L)=>{const U=x==="svg";a==="class"?e1(n,m,U):a==="style"?n1(n,d,m):gh(a)?Lp(a)||c1(n,a,d,m,v):(a[0]==="."?(a=a.slice(1),!0):a[0]==="^"?(a=a.slice(1),!1):g1(n,a,m,U))?a1(n,a,m,T,v,h,L):(a==="true-value"?n._trueValue=m:a==="false-value"&&(n._falseValue=m),o1(n,a,m,U))};function g1(n,a,d,m){if(m)return!!(a==="innerHTML"||a==="textContent"||a in n&&gg(a)&&Gt(d));if(a==="spellcheck"||a==="draggable"||a==="translate"||a==="form"||a==="list"&&n.tagName==="INPUT"||a==="type"&&n.tagName==="TEXTAREA")return!1;if(a==="width"||a==="height"){const x=n.tagName;if(x==="IMG"||x==="VIDEO"||x==="CANVAS"||x==="SOURCE")return!1}return gg(a)&&mr(d)?!1:a in n}const _g=n=>{const a=n.props["onUpdate:modelValue"]||!1;return Vt(a)?d=>Ju(a,d):a};function _1(n){n.target.composing=!0}function yg(n){const a=n.target;a.composing&&(a.composing=!1,a.dispatchEvent(new Event("input")))}const tp=Symbol("_assign"),y1={created(n,{modifiers:{lazy:a,trim:d,number:m}},x){n[tp]=_g(x);const T=m||x.props&&x.props.type==="number";Za(n,a?"change":"input",v=>{if(v.target.composing)return;let h=n.value;d&&(h=h.trim()),T&&(h=hp(h)),n[tp](h)}),d&&Za(n,"change",()=>{n.value=n.value.trim()}),a||(Za(n,"compositionstart",_1),Za(n,"compositionend",yg),Za(n,"change",yg))},mounted(n,{value:a}){n.value=a??""},beforeUpdate(n,{value:a,modifiers:{lazy:d,trim:m,number:x}},T){if(n[tp]=_g(T),n.composing)return;const v=x||n.type==="number"?hp(n.value):n.value,h=a??"";v!==h&&(document.activeElement===n&&n.type!=="range"&&(d||m&&n.value.trim()===h)||(n.value=h))}},x1={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},v1=(n,a)=>{const d=n._withKeys||(n._withKeys={}),m=a.join(".");return d[m]||(d[m]=x=>{if(!("key"in x))return;const T=Go(x.key);if(a.some(v=>v===T||x1[v]===T))return n(x)})},b1=kr({patchProp:m1},Jb);let xg;function w1(){return xg||(xg=Mb(b1))}const S1=(...n)=>{const a=w1().createApp(...n),{mount:d}=a;return a.mount=m=>{const x=A1(m);if(!x)return;const T=a._component;!Gt(T)&&!T.render&&!T.template&&(T.template=x.innerHTML),x.innerHTML="";const v=d(x,!1,T1(x));return x instanceof Element&&(x.removeAttribute("v-cloak"),x.setAttribute("data-v-app","")),v},a};function T1(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function A1(n){return mr(n)?document.querySelector(n):n}var I1=!1;/*!
 * pinia v2.1.7
 * (c) 2023 Eduardo San Martin Morote
 * @license MIT
 */let uy;const Dh=n=>uy=n,hy=Symbol();function wp(n){return n&&typeof n=="object"&&Object.prototype.toString.call(n)==="[object Object]"&&typeof n.toJSON!="function"}var bc;(function(n){n.direct="direct",n.patchObject="patch object",n.patchFunction="patch function"})(bc||(bc={}));function E1(){const n=d_(!0),a=n.run(()=>ss({}));let d=[],m=[];const x=bh({install(T){Dh(x),x._a=T,T.provide(hy,x),T.config.globalProperties.$pinia=x,m.forEach(v=>d.push(v)),m=[]},use(T){return!this._a&&!I1?m.push(T):d.push(T),this},_p:d,_a:null,_e:n,_s:new Map,state:a});return x}const dy=()=>{};function vg(n,a,d,m=dy){n.push(a);const x=()=>{const T=n.indexOf(a);T>-1&&(n.splice(T,1),m())};return!d&&p_()&&p0(x),x}function Ga(n,...a){n.slice().forEach(d=>{d(...a)})}const P1=n=>n();function Sp(n,a){n instanceof Map&&a instanceof Map&&a.forEach((d,m)=>n.set(m,d)),n instanceof Set&&a instanceof Set&&a.forEach(n.add,n);for(const d in a){if(!a.hasOwnProperty(d))continue;const m=a[d],x=n[d];wp(x)&&wp(m)&&n.hasOwnProperty(d)&&!lr(m)&&!Is(m)?n[d]=Sp(x,m):n[d]=m}return n}const C1=Symbol();function M1(n){return!wp(n)||!n.hasOwnProperty(C1)}const{assign:Qs}=Object;function k1(n){return!!(lr(n)&&n.effect)}function D1(n,a,d,m){const{state:x,actions:T,getters:v}=a,h=d.state.value[n];let L;function U(){h||(d.state.value[n]=x?x():{});const j=B0(d.state.value[n]);return Qs(j,T,Object.keys(v||{}).reduce((N,V)=>(N[V]=bh(ar(()=>{Dh(d);const de=d._s.get(n);return v[V].call(de,de)})),N),{}))}return L=py(n,U,a,d,m,!0),L}function py(n,a,d={},m,x,T){let v;const h=Qs({actions:{}},d),L={deep:!0};let U,j,N=[],V=[],de;const _e=m.state.value[n];!T&&!_e&&(m.state.value[n]={}),ss({});let Ie;function Je(St){let dt;U=j=!1,typeof St=="function"?(St(m.state.value[n]),dt={type:bc.patchFunction,storeId:n,events:de}):(Sp(m.state.value[n],St),dt={type:bc.patchObject,payload:St,storeId:n,events:de});const kt=Ie=Symbol();Zp().then(()=>{Ie===kt&&(U=!0)}),j=!0,Ga(N,dt,m.state.value[n])}const Ue=T?function(){const{state:dt}=d,kt=dt?dt():{};this.$patch(vt=>{Qs(vt,kt)})}:dy;function We(){v.stop(),N=[],V=[],m._s.delete(n)}function ye(St,dt){return function(){Dh(m);const kt=Array.from(arguments),vt=[],pt=[];function Bt(It){vt.push(It)}function Pt(It){pt.push(It)}Ga(V,{args:kt,name:St,store:ot,after:Bt,onError:Pt});let di;try{di=dt.apply(this&&this.$id===n?this:ot,kt)}catch(It){throw Ga(pt,It),It}return di instanceof Promise?di.then(It=>(Ga(vt,It),It)).catch(It=>(Ga(pt,It),Promise.reject(It))):(Ga(vt,di),di)}}const Be={_p:m,$id:n,$onAction:vg.bind(null,V),$patch:Je,$reset:Ue,$subscribe(St,dt={}){const kt=vg(N,St,dt.detached,()=>vt()),vt=v.run(()=>_c(()=>m.state.value[n],pt=>{(dt.flush==="sync"?j:U)&&St({storeId:n,type:bc.direct,events:de},pt)},Qs({},L,dt)));return kt},$dispose:We},ot=zc(Be);m._s.set(n,ot);const xt=(m._a&&m._a.runWithContext||P1)(()=>m._e.run(()=>(v=d_()).run(a)));for(const St in xt){const dt=xt[St];if(lr(dt)&&!k1(dt)||Is(dt))T||(_e&&M1(dt)&&(lr(dt)?dt.value=_e[St]:Sp(dt,_e[St])),m.state.value[n][St]=dt);else if(typeof dt=="function"){const kt=ye(St,dt);xt[St]=kt,h.actions[St]=dt}}return Qs(ot,xt),Qs(si(ot),xt),Object.defineProperty(ot,"$state",{get:()=>m.state.value[n],set:St=>{Je(dt=>{Qs(dt,St)})}}),m._p.forEach(St=>{Qs(ot,v.run(()=>St({store:ot,app:m._a,pinia:m,options:h})))}),_e&&T&&d.hydrate&&d.hydrate(ot.$state,_e),U=!0,j=!0,ot}function Cs(n,a,d){let m,x;const T=typeof a=="function";typeof n=="string"?(m=n,x=T?d:a):(x=n,m=n.id);function v(h,L){const U=Tb();return h=h||(U?ln(hy,null):null),h&&Dh(h),h=uy,h._s.has(m)||(T?py(m,a,x,h):D1(m,x,h)),h._s.get(m)}return v.$id=m,v}function z1(n){{n=si(n);const a={};for(const d in n){const m=n[d];(lr(m)||Is(m))&&(a[d]=$0(n,d))}return a}}/*!
  * vue-router v4.3.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const Wa=typeof document<"u";function R1(n){return n.__esModule||n[Symbol.toStringTag]==="Module"}const yi=Object.assign;function ip(n,a){const d={};for(const m in a){const x=a[m];d[m]=Vn(x)?x.map(n):n(x)}return d}const wc=()=>{},Vn=Array.isArray,fy=/#/g,L1=/&/g,F1=/\//g,O1=/=/g,B1=/\?/g,my=/\+/g,N1=/%5B/g,V1=/%5D/g,gy=/%5E/g,$1=/%60/g,_y=/%7B/g,U1=/%7C/g,yy=/%7D/g,j1=/%20/g;function Qp(n){return encodeURI(""+n).replace(U1,"|").replace(N1,"[").replace(V1,"]")}function q1(n){return Qp(n).replace(_y,"{").replace(yy,"}").replace(gy,"^")}function Tp(n){return Qp(n).replace(my,"%2B").replace(j1,"+").replace(fy,"%23").replace(L1,"%26").replace($1,"`").replace(_y,"{").replace(yy,"}").replace(gy,"^")}function G1(n){return Tp(n).replace(O1,"%3D")}function H1(n){return Qp(n).replace(fy,"%23").replace(B1,"%3F")}function Z1(n){return n==null?"":H1(n).replace(F1,"%2F")}function Pc(n){try{return decodeURIComponent(""+n)}catch{}return""+n}const W1=/\/$/,K1=n=>n.replace(W1,"");function rp(n,a,d="/"){let m,x={},T="",v="";const h=a.indexOf("#");let L=a.indexOf("?");return h<L&&h>=0&&(L=-1),L>-1&&(m=a.slice(0,L),T=a.slice(L+1,h>-1?h:a.length),x=n(T)),h>-1&&(m=m||a.slice(0,h),v=a.slice(h,a.length)),m=Q1(m??a,d),{fullPath:m+(T&&"?")+T+v,path:m,query:x,hash:Pc(v)}}function X1(n,a){const d=a.query?n(a.query):"";return a.path+(d&&"?")+d+(a.hash||"")}function bg(n,a){return!a||!n.toLowerCase().startsWith(a.toLowerCase())?n:n.slice(a.length)||"/"}function Y1(n,a,d){const m=a.matched.length-1,x=d.matched.length-1;return m>-1&&m===x&&rl(a.matched[m],d.matched[x])&&xy(a.params,d.params)&&n(a.query)===n(d.query)&&a.hash===d.hash}function rl(n,a){return(n.aliasOf||n)===(a.aliasOf||a)}function xy(n,a){if(Object.keys(n).length!==Object.keys(a).length)return!1;for(const d in n)if(!J1(n[d],a[d]))return!1;return!0}function J1(n,a){return Vn(n)?wg(n,a):Vn(a)?wg(a,n):n===a}function wg(n,a){return Vn(a)?n.length===a.length&&n.every((d,m)=>d===a[m]):n.length===1&&n[0]===a}function Q1(n,a){if(n.startsWith("/"))return n;if(!n)return a;const d=a.split("/"),m=n.split("/"),x=m[m.length-1];(x===".."||x===".")&&m.push("");let T=d.length-1,v,h;for(v=0;v<m.length;v++)if(h=m[v],h!==".")if(h==="..")T>1&&T--;else break;return d.slice(0,T).join("/")+"/"+m.slice(v).join("/")}var Cc;(function(n){n.pop="pop",n.push="push"})(Cc||(Cc={}));var Sc;(function(n){n.back="back",n.forward="forward",n.unknown=""})(Sc||(Sc={}));function ew(n){if(!n)if(Wa){const a=document.querySelector("base");n=a&&a.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),K1(n)}const tw=/^[^#]+#/;function iw(n,a){return n.replace(tw,"#")+a}function rw(n,a){const d=document.documentElement.getBoundingClientRect(),m=n.getBoundingClientRect();return{behavior:a.behavior,left:m.left-d.left-(a.left||0),top:m.top-d.top-(a.top||0)}}const zh=()=>({left:window.scrollX,top:window.scrollY});function nw(n){let a;if("el"in n){const d=n.el,m=typeof d=="string"&&d.startsWith("#"),x=typeof d=="string"?m?document.getElementById(d.slice(1)):document.querySelector(d):d;if(!x)return;a=rw(x,n)}else a=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(a):window.scrollTo(a.left!=null?a.left:window.scrollX,a.top!=null?a.top:window.scrollY)}function Sg(n,a){return(history.state?history.state.position-a:-1)+n}const Ap=new Map;function sw(n,a){Ap.set(n,a)}function ow(n){const a=Ap.get(n);return Ap.delete(n),a}let aw=()=>location.protocol+"//"+location.host;function vy(n,a){const{pathname:d,search:m,hash:x}=a,T=n.indexOf("#");if(T>-1){let h=x.includes(n.slice(T))?n.slice(T).length:1,L=x.slice(h);return L[0]!=="/"&&(L="/"+L),bg(L,"")}return bg(d,n)+m+x}function lw(n,a,d,m){let x=[],T=[],v=null;const h=({state:V})=>{const de=vy(n,location),_e=d.value,Ie=a.value;let Je=0;if(V){if(d.value=de,a.value=V,v&&v===_e){v=null;return}Je=Ie?V.position-Ie.position:0}else m(de);x.forEach(Ue=>{Ue(d.value,_e,{delta:Je,type:Cc.pop,direction:Je?Je>0?Sc.forward:Sc.back:Sc.unknown})})};function L(){v=d.value}function U(V){x.push(V);const de=()=>{const _e=x.indexOf(V);_e>-1&&x.splice(_e,1)};return T.push(de),de}function j(){const{history:V}=window;V.state&&V.replaceState(yi({},V.state,{scroll:zh()}),"")}function N(){for(const V of T)V();T=[],window.removeEventListener("popstate",h),window.removeEventListener("beforeunload",j)}return window.addEventListener("popstate",h),window.addEventListener("beforeunload",j,{passive:!0}),{pauseListeners:L,listen:U,destroy:N}}function Tg(n,a,d,m=!1,x=!1){return{back:n,current:a,forward:d,replaced:m,position:window.history.length,scroll:x?zh():null}}function cw(n){const{history:a,location:d}=window,m={value:vy(n,d)},x={value:a.state};x.value||T(m.value,{back:null,current:m.value,forward:null,position:a.length-1,replaced:!0,scroll:null},!0);function T(L,U,j){const N=n.indexOf("#"),V=N>-1?(d.host&&document.querySelector("base")?n:n.slice(N))+L:aw()+n+L;try{a[j?"replaceState":"pushState"](U,"",V),x.value=U}catch(de){console.error(de),d[j?"replace":"assign"](V)}}function v(L,U){const j=yi({},a.state,Tg(x.value.back,L,x.value.forward,!0),U,{position:x.value.position});T(L,j,!0),m.value=L}function h(L,U){const j=yi({},x.value,a.state,{forward:L,scroll:zh()});T(j.current,j,!0);const N=yi({},Tg(m.value,L,null),{position:j.position+1},U);T(L,N,!1),m.value=L}return{location:m,state:x,push:h,replace:v}}function uw(n){n=ew(n);const a=cw(n),d=lw(n,a.state,a.location,a.replace);function m(T,v=!0){v||d.pauseListeners(),history.go(T)}const x=yi({location:"",base:n,go:m,createHref:iw.bind(null,n)},a,d);return Object.defineProperty(x,"location",{enumerable:!0,get:()=>a.location.value}),Object.defineProperty(x,"state",{enumerable:!0,get:()=>a.state.value}),x}function hw(n){return n=location.host?n||location.pathname+location.search:"",n.includes("#")||(n+="#"),uw(n)}function dw(n){return typeof n=="string"||n&&typeof n=="object"}function by(n){return typeof n=="string"||typeof n=="symbol"}const Xs={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},wy=Symbol("");var Ag;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(Ag||(Ag={}));function nl(n,a){return yi(new Error,{type:n,[wy]:!0},a)}function Ss(n,a){return n instanceof Error&&wy in n&&(a==null||!!(n.type&a))}const Ig="[^/]+?",pw={sensitive:!1,strict:!1,start:!0,end:!0},fw=/[.+*?^${}()[\]/\\]/g;function mw(n,a){const d=yi({},pw,a),m=[];let x=d.start?"^":"";const T=[];for(const U of n){const j=U.length?[]:[90];d.strict&&!U.length&&(x+="/");for(let N=0;N<U.length;N++){const V=U[N];let de=40+(d.sensitive?.25:0);if(V.type===0)N||(x+="/"),x+=V.value.replace(fw,"\\$&"),de+=40;else if(V.type===1){const{value:_e,repeatable:Ie,optional:Je,regexp:Ue}=V;T.push({name:_e,repeatable:Ie,optional:Je});const We=Ue||Ig;if(We!==Ig){de+=10;try{new RegExp(`(${We})`)}catch(Be){throw new Error(`Invalid custom RegExp for param "${_e}" (${We}): `+Be.message)}}let ye=Ie?`((?:${We})(?:/(?:${We}))*)`:`(${We})`;N||(ye=Je&&U.length<2?`(?:/${ye})`:"/"+ye),Je&&(ye+="?"),x+=ye,de+=20,Je&&(de+=-8),Ie&&(de+=-20),We===".*"&&(de+=-50)}j.push(de)}m.push(j)}if(d.strict&&d.end){const U=m.length-1;m[U][m[U].length-1]+=.7000000000000001}d.strict||(x+="/?"),d.end?x+="$":d.strict&&(x+="(?:/|$)");const v=new RegExp(x,d.sensitive?"":"i");function h(U){const j=U.match(v),N={};if(!j)return null;for(let V=1;V<j.length;V++){const de=j[V]||"",_e=T[V-1];N[_e.name]=de&&_e.repeatable?de.split("/"):de}return N}function L(U){let j="",N=!1;for(const V of n){(!N||!j.endsWith("/"))&&(j+="/"),N=!1;for(const de of V)if(de.type===0)j+=de.value;else if(de.type===1){const{value:_e,repeatable:Ie,optional:Je}=de,Ue=_e in U?U[_e]:"";if(Vn(Ue)&&!Ie)throw new Error(`Provided param "${_e}" is an array but it is not repeatable (* or + modifiers)`);const We=Vn(Ue)?Ue.join("/"):Ue;if(!We)if(Je)V.length<2&&(j.endsWith("/")?j=j.slice(0,-1):N=!0);else throw new Error(`Missing required param "${_e}"`);j+=We}}return j||"/"}return{re:v,score:m,keys:T,parse:h,stringify:L}}function gw(n,a){let d=0;for(;d<n.length&&d<a.length;){const m=a[d]-n[d];if(m)return m;d++}return n.length<a.length?n.length===1&&n[0]===80?-1:1:n.length>a.length?a.length===1&&a[0]===80?1:-1:0}function _w(n,a){let d=0;const m=n.score,x=a.score;for(;d<m.length&&d<x.length;){const T=gw(m[d],x[d]);if(T)return T;d++}if(Math.abs(x.length-m.length)===1){if(Eg(m))return 1;if(Eg(x))return-1}return x.length-m.length}function Eg(n){const a=n[n.length-1];return n.length>0&&a[a.length-1]<0}const yw={type:0,value:""},xw=/[a-zA-Z0-9_]/;function vw(n){if(!n)return[[]];if(n==="/")return[[yw]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function a(de){throw new Error(`ERR (${d})/"${U}": ${de}`)}let d=0,m=d;const x=[];let T;function v(){T&&x.push(T),T=[]}let h=0,L,U="",j="";function N(){U&&(d===0?T.push({type:0,value:U}):d===1||d===2||d===3?(T.length>1&&(L==="*"||L==="+")&&a(`A repeatable param (${U}) must be alone in its segment. eg: '/:ids+.`),T.push({type:1,value:U,regexp:j,repeatable:L==="*"||L==="+",optional:L==="*"||L==="?"})):a("Invalid state to consume buffer"),U="")}function V(){U+=L}for(;h<n.length;){if(L=n[h++],L==="\\"&&d!==2){m=d,d=4;continue}switch(d){case 0:L==="/"?(U&&N(),v()):L===":"?(N(),d=1):V();break;case 4:V(),d=m;break;case 1:L==="("?d=2:xw.test(L)?V():(N(),d=0,L!=="*"&&L!=="?"&&L!=="+"&&h--);break;case 2:L===")"?j[j.length-1]=="\\"?j=j.slice(0,-1)+L:d=3:j+=L;break;case 3:N(),d=0,L!=="*"&&L!=="?"&&L!=="+"&&h--,j="";break;default:a("Unknown state");break}}return d===2&&a(`Unfinished custom RegExp for param "${U}"`),N(),v(),x}function bw(n,a,d){const m=mw(vw(n.path),d),x=yi(m,{record:n,parent:a,children:[],alias:[]});return a&&!x.record.aliasOf==!a.record.aliasOf&&a.children.push(x),x}function ww(n,a){const d=[],m=new Map;a=Mg({strict:!1,end:!0,sensitive:!1},a);function x(j){return m.get(j)}function T(j,N,V){const de=!V,_e=Sw(j);_e.aliasOf=V&&V.record;const Ie=Mg(a,j),Je=[_e];if("alias"in j){const ye=typeof j.alias=="string"?[j.alias]:j.alias;for(const Be of ye)Je.push(yi({},_e,{components:V?V.record.components:_e.components,path:Be,aliasOf:V?V.record:_e}))}let Ue,We;for(const ye of Je){const{path:Be}=ye;if(N&&Be[0]!=="/"){const ot=N.record.path,at=ot[ot.length-1]==="/"?"":"/";ye.path=N.record.path+(Be&&at+Be)}if(Ue=bw(ye,N,Ie),V?V.alias.push(Ue):(We=We||Ue,We!==Ue&&We.alias.push(Ue),de&&j.name&&!Cg(Ue)&&v(j.name)),_e.children){const ot=_e.children;for(let at=0;at<ot.length;at++)T(ot[at],Ue,V&&V.children[at])}V=V||Ue,(Ue.record.components&&Object.keys(Ue.record.components).length||Ue.record.name||Ue.record.redirect)&&L(Ue)}return We?()=>{v(We)}:wc}function v(j){if(by(j)){const N=m.get(j);N&&(m.delete(j),d.splice(d.indexOf(N),1),N.children.forEach(v),N.alias.forEach(v))}else{const N=d.indexOf(j);N>-1&&(d.splice(N,1),j.record.name&&m.delete(j.record.name),j.children.forEach(v),j.alias.forEach(v))}}function h(){return d}function L(j){let N=0;for(;N<d.length&&_w(j,d[N])>=0&&(j.record.path!==d[N].record.path||!Sy(j,d[N]));)N++;d.splice(N,0,j),j.record.name&&!Cg(j)&&m.set(j.record.name,j)}function U(j,N){let V,de={},_e,Ie;if("name"in j&&j.name){if(V=m.get(j.name),!V)throw nl(1,{location:j});Ie=V.record.name,de=yi(Pg(N.params,V.keys.filter(We=>!We.optional).concat(V.parent?V.parent.keys.filter(We=>We.optional):[]).map(We=>We.name)),j.params&&Pg(j.params,V.keys.map(We=>We.name))),_e=V.stringify(de)}else if(j.path!=null)_e=j.path,V=d.find(We=>We.re.test(_e)),V&&(de=V.parse(_e),Ie=V.record.name);else{if(V=N.name?m.get(N.name):d.find(We=>We.re.test(N.path)),!V)throw nl(1,{location:j,currentLocation:N});Ie=V.record.name,de=yi({},N.params,j.params),_e=V.stringify(de)}const Je=[];let Ue=V;for(;Ue;)Je.unshift(Ue.record),Ue=Ue.parent;return{name:Ie,path:_e,params:de,matched:Je,meta:Aw(Je)}}return n.forEach(j=>T(j)),{addRoute:T,resolve:U,removeRoute:v,getRoutes:h,getRecordMatcher:x}}function Pg(n,a){const d={};for(const m of a)m in n&&(d[m]=n[m]);return d}function Sw(n){return{path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:void 0,beforeEnter:n.beforeEnter,props:Tw(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}}}function Tw(n){const a={},d=n.props||!1;if("component"in n)a.default=d;else for(const m in n.components)a[m]=typeof d=="object"?d[m]:d;return a}function Cg(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function Aw(n){return n.reduce((a,d)=>yi(a,d.meta),{})}function Mg(n,a){const d={};for(const m in n)d[m]=m in a?a[m]:n[m];return d}function Sy(n,a){return a.children.some(d=>d===n||Sy(n,d))}function Iw(n){const a={};if(n===""||n==="?")return a;const m=(n[0]==="?"?n.slice(1):n).split("&");for(let x=0;x<m.length;++x){const T=m[x].replace(my," "),v=T.indexOf("="),h=Pc(v<0?T:T.slice(0,v)),L=v<0?null:Pc(T.slice(v+1));if(h in a){let U=a[h];Vn(U)||(U=a[h]=[U]),U.push(L)}else a[h]=L}return a}function kg(n){let a="";for(let d in n){const m=n[d];if(d=G1(d),m==null){m!==void 0&&(a+=(a.length?"&":"")+d);continue}(Vn(m)?m.map(T=>T&&Tp(T)):[m&&Tp(m)]).forEach(T=>{T!==void 0&&(a+=(a.length?"&":"")+d,T!=null&&(a+="="+T))})}return a}function Ew(n){const a={};for(const d in n){const m=n[d];m!==void 0&&(a[d]=Vn(m)?m.map(x=>x==null?null:""+x):m==null?m:""+m)}return a}const Pw=Symbol(""),Dg=Symbol(""),Rh=Symbol(""),ef=Symbol(""),Ip=Symbol("");function uc(){let n=[];function a(m){return n.push(m),()=>{const x=n.indexOf(m);x>-1&&n.splice(x,1)}}function d(){n=[]}return{add:a,list:()=>n.slice(),reset:d}}function ro(n,a,d,m,x,T=v=>v()){const v=m&&(m.enterCallbacks[x]=m.enterCallbacks[x]||[]);return()=>new Promise((h,L)=>{const U=V=>{V===!1?L(nl(4,{from:d,to:a})):V instanceof Error?L(V):dw(V)?L(nl(2,{from:a,to:V})):(v&&m.enterCallbacks[x]===v&&typeof V=="function"&&v.push(V),h())},j=T(()=>n.call(m&&m.instances[x],a,d,U));let N=Promise.resolve(j);n.length<3&&(N=N.then(U)),N.catch(V=>L(V))})}function np(n,a,d,m,x=T=>T()){const T=[];for(const v of n)for(const h in v.components){let L=v.components[h];if(!(a!=="beforeRouteEnter"&&!v.instances[h]))if(Cw(L)){const j=(L.__vccOpts||L)[a];j&&T.push(ro(j,d,m,v,h,x))}else{let U=L();T.push(()=>U.then(j=>{if(!j)return Promise.reject(new Error(`Couldn't resolve component "${h}" at "${v.path}"`));const N=R1(j)?j.default:j;v.components[h]=N;const de=(N.__vccOpts||N)[a];return de&&ro(de,d,m,v,h,x)()}))}}return T}function Cw(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function zg(n){const a=ln(Rh),d=ln(ef),m=ar(()=>a.resolve(qt(n.to))),x=ar(()=>{const{matched:L}=m.value,{length:U}=L,j=L[U-1],N=d.matched;if(!j||!N.length)return-1;const V=N.findIndex(rl.bind(null,j));if(V>-1)return V;const de=Rg(L[U-2]);return U>1&&Rg(j)===de&&N[N.length-1].path!==de?N.findIndex(rl.bind(null,L[U-2])):V}),T=ar(()=>x.value>-1&&Dw(d.params,m.value.params)),v=ar(()=>x.value>-1&&x.value===d.matched.length-1&&xy(d.params,m.value.params));function h(L={}){return kw(L)?a[qt(n.replace)?"replace":"push"](qt(n.to)).catch(wc):Promise.resolve()}return{route:m,href:ar(()=>m.value.href),isActive:T,isExactActive:v,navigate:h}}const Mw=U_({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:zg,setup(n,{slots:a}){const d=zc(zg(n)),{options:m}=ln(Rh),x=ar(()=>({[Lg(n.activeClass,m.linkActiveClass,"router-link-active")]:d.isActive,[Lg(n.exactActiveClass,m.linkExactActiveClass,"router-link-exact-active")]:d.isExactActive}));return()=>{const T=a.default&&a.default(d);return n.custom?T:ly("a",{"aria-current":d.isExactActive?n.ariaCurrentValue:null,href:d.href,onClick:d.navigate,class:x.value},T)}}}),Ty=Mw;function kw(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const a=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(a))return}return n.preventDefault&&n.preventDefault(),!0}}function Dw(n,a){for(const d in a){const m=a[d],x=n[d];if(typeof m=="string"){if(m!==x)return!1}else if(!Vn(x)||x.length!==m.length||m.some((T,v)=>T!==x[v]))return!1}return!0}function Rg(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const Lg=(n,a,d)=>n??a??d,zw=U_({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:a,slots:d}){const m=ln(Ip),x=ar(()=>n.route||m.value),T=ln(Dg,0),v=ar(()=>{let U=qt(T);const{matched:j}=x.value;let N;for(;(N=j[U])&&!N.components;)U++;return U}),h=ar(()=>x.value.matched[v.value]);el(Dg,ar(()=>v.value+1)),el(Pw,h),el(Ip,x);const L=ss();return _c(()=>[L.value,h.value,n.name],([U,j,N],[V,de,_e])=>{j&&(j.instances[N]=U,de&&de!==j&&U&&U===V&&(j.leaveGuards.size||(j.leaveGuards=de.leaveGuards),j.updateGuards.size||(j.updateGuards=de.updateGuards))),U&&j&&(!de||!rl(j,de)||!V)&&(j.enterCallbacks[N]||[]).forEach(Ie=>Ie(U))},{flush:"post"}),()=>{const U=x.value,j=n.name,N=h.value,V=N&&N.components[j];if(!V)return Fg(d.default,{Component:V,route:U});const de=N.props[j],_e=de?de===!0?U.params:typeof de=="function"?de(U):de:null,Je=ly(V,yi({},_e,a,{onVnodeUnmounted:Ue=>{Ue.component.isUnmounted&&(N.instances[j]=null)},ref:L}));return Fg(d.default,{Component:Je,route:U})||Je}}});function Fg(n,a){if(!n)return null;const d=n(a);return d.length===1?d[0]:d}const Ay=zw;function Rw(n){const a=ww(n.routes,n),d=n.parseQuery||Iw,m=n.stringifyQuery||kg,x=n.history,T=uc(),v=uc(),h=uc(),L=L0(Xs);let U=Xs;Wa&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const j=ip.bind(null,Pe=>""+Pe),N=ip.bind(null,Z1),V=ip.bind(null,Pc);function de(Pe,tt){let Qe,ct;return by(Pe)?(Qe=a.getRecordMatcher(Pe),ct=tt):ct=Pe,a.addRoute(ct,Qe)}function _e(Pe){const tt=a.getRecordMatcher(Pe);tt&&a.removeRoute(tt)}function Ie(){return a.getRoutes().map(Pe=>Pe.record)}function Je(Pe){return!!a.getRecordMatcher(Pe)}function Ue(Pe,tt){if(tt=yi({},tt||L.value),typeof Pe=="string"){const ie=rp(d,Pe,tt.path),ve=a.resolve({path:ie.path},tt),De=x.createHref(ie.fullPath);return yi(ie,ve,{params:V(ve.params),hash:Pc(ie.hash),redirectedFrom:void 0,href:De})}let Qe;if(Pe.path!=null)Qe=yi({},Pe,{path:rp(d,Pe.path,tt.path).path});else{const ie=yi({},Pe.params);for(const ve in ie)ie[ve]==null&&delete ie[ve];Qe=yi({},Pe,{params:N(ie)}),tt.params=N(tt.params)}const ct=a.resolve(Qe,tt),Qt=Pe.hash||"";ct.params=j(V(ct.params));const ti=X1(m,yi({},Pe,{hash:q1(Qt),path:ct.path})),J=x.createHref(ti);return yi({fullPath:ti,hash:Qt,query:m===kg?Ew(Pe.query):Pe.query||{}},ct,{redirectedFrom:void 0,href:J})}function We(Pe){return typeof Pe=="string"?rp(d,Pe,L.value.path):yi({},Pe)}function ye(Pe,tt){if(U!==Pe)return nl(8,{from:tt,to:Pe})}function Be(Pe){return xt(Pe)}function ot(Pe){return Be(yi(We(Pe),{replace:!0}))}function at(Pe){const tt=Pe.matched[Pe.matched.length-1];if(tt&&tt.redirect){const{redirect:Qe}=tt;let ct=typeof Qe=="function"?Qe(Pe):Qe;return typeof ct=="string"&&(ct=ct.includes("?")||ct.includes("#")?ct=We(ct):{path:ct},ct.params={}),yi({query:Pe.query,hash:Pe.hash,params:ct.path!=null?{}:Pe.params},ct)}}function xt(Pe,tt){const Qe=U=Ue(Pe),ct=L.value,Qt=Pe.state,ti=Pe.force,J=Pe.replace===!0,ie=at(Qe);if(ie)return xt(yi(We(ie),{state:typeof ie=="object"?yi({},Qt,ie.state):Qt,force:ti,replace:J}),tt||Qe);const ve=Qe;ve.redirectedFrom=tt;let De;return!ti&&Y1(m,ct,Qe)&&(De=nl(16,{to:ve,from:ct}),bi(ct,ct,!0,!1)),(De?Promise.resolve(De):kt(ve,ct)).catch(ee=>Ss(ee)?Ss(ee,2)?ee:wr(ee):Xt(ee,ve,ct)).then(ee=>{if(ee){if(Ss(ee,2))return xt(yi({replace:J},We(ee.to),{state:typeof ee.to=="object"?yi({},Qt,ee.to.state):Qt,force:ti}),tt||ve)}else ee=pt(ve,ct,!0,J,Qt);return vt(ve,ct,ee),ee})}function St(Pe,tt){const Qe=ye(Pe,tt);return Qe?Promise.reject(Qe):Promise.resolve()}function dt(Pe){const tt=Qr.values().next().value;return tt&&typeof tt.runWithContext=="function"?tt.runWithContext(Pe):Pe()}function kt(Pe,tt){let Qe;const[ct,Qt,ti]=Lw(Pe,tt);Qe=np(ct.reverse(),"beforeRouteLeave",Pe,tt);for(const ie of ct)ie.leaveGuards.forEach(ve=>{Qe.push(ro(ve,Pe,tt))});const J=St.bind(null,Pe,tt);return Qe.push(J),wi(Qe).then(()=>{Qe=[];for(const ie of T.list())Qe.push(ro(ie,Pe,tt));return Qe.push(J),wi(Qe)}).then(()=>{Qe=np(Qt,"beforeRouteUpdate",Pe,tt);for(const ie of Qt)ie.updateGuards.forEach(ve=>{Qe.push(ro(ve,Pe,tt))});return Qe.push(J),wi(Qe)}).then(()=>{Qe=[];for(const ie of ti)if(ie.beforeEnter)if(Vn(ie.beforeEnter))for(const ve of ie.beforeEnter)Qe.push(ro(ve,Pe,tt));else Qe.push(ro(ie.beforeEnter,Pe,tt));return Qe.push(J),wi(Qe)}).then(()=>(Pe.matched.forEach(ie=>ie.enterCallbacks={}),Qe=np(ti,"beforeRouteEnter",Pe,tt,dt),Qe.push(J),wi(Qe))).then(()=>{Qe=[];for(const ie of v.list())Qe.push(ro(ie,Pe,tt));return Qe.push(J),wi(Qe)}).catch(ie=>Ss(ie,8)?ie:Promise.reject(ie))}function vt(Pe,tt,Qe){h.list().forEach(ct=>dt(()=>ct(Pe,tt,Qe)))}function pt(Pe,tt,Qe,ct,Qt){const ti=ye(Pe,tt);if(ti)return ti;const J=tt===Xs,ie=Wa?history.state:{};Qe&&(ct||J?x.replace(Pe.fullPath,yi({scroll:J&&ie&&ie.scroll},Qt)):x.push(Pe.fullPath,Qt)),L.value=Pe,bi(Pe,tt,Qe,J),wr()}let Bt;function Pt(){Bt||(Bt=x.listen((Pe,tt,Qe)=>{if(!gr.listening)return;const ct=Ue(Pe),Qt=at(ct);if(Qt){xt(yi(Qt,{replace:!0}),ct).catch(wc);return}U=ct;const ti=L.value;Wa&&sw(Sg(ti.fullPath,Qe.delta),zh()),kt(ct,ti).catch(J=>Ss(J,12)?J:Ss(J,2)?(xt(J.to,ct).then(ie=>{Ss(ie,20)&&!Qe.delta&&Qe.type===Cc.pop&&x.go(-1,!1)}).catch(wc),Promise.reject()):(Qe.delta&&x.go(-Qe.delta,!1),Xt(J,ct,ti))).then(J=>{J=J||pt(ct,ti,!1),J&&(Qe.delta&&!Ss(J,8)?x.go(-Qe.delta,!1):Qe.type===Cc.pop&&Ss(J,20)&&x.go(-1,!1)),vt(ct,ti,J)}).catch(wc)}))}let di=uc(),It=uc(),Ct;function Xt(Pe,tt,Qe){wr(Pe);const ct=It.list();return ct.length?ct.forEach(Qt=>Qt(Pe,tt,Qe)):console.error(Pe),Promise.reject(Pe)}function ur(){return Ct&&L.value!==Xs?Promise.resolve():new Promise((Pe,tt)=>{di.add([Pe,tt])})}function wr(Pe){return Ct||(Ct=!Pe,Pt(),di.list().forEach(([tt,Qe])=>Pe?Qe(Pe):tt()),di.reset()),Pe}function bi(Pe,tt,Qe,ct){const{scrollBehavior:Qt}=n;if(!Wa||!Qt)return Promise.resolve();const ti=!Qe&&ow(Sg(Pe.fullPath,0))||(ct||!Qe)&&history.state&&history.state.scroll||null;return Zp().then(()=>Qt(Pe,tt,ti)).then(J=>J&&nw(J)).catch(J=>Xt(J,Pe,tt))}const oi=Pe=>x.go(Pe);let hr;const Qr=new Set,gr={currentRoute:L,listening:!0,addRoute:de,removeRoute:_e,hasRoute:Je,getRoutes:Ie,resolve:Ue,options:n,push:Be,replace:ot,go:oi,back:()=>oi(-1),forward:()=>oi(1),beforeEach:T.add,beforeResolve:v.add,afterEach:h.add,onError:It.add,isReady:ur,install(Pe){const tt=this;Pe.component("RouterLink",Ty),Pe.component("RouterView",Ay),Pe.config.globalProperties.$router=tt,Object.defineProperty(Pe.config.globalProperties,"$route",{enumerable:!0,get:()=>qt(L)}),Wa&&!hr&&L.value===Xs&&(hr=!0,Be(x.location).catch(Qt=>{}));const Qe={};for(const Qt in Xs)Object.defineProperty(Qe,Qt,{get:()=>L.value[Qt],enumerable:!0});Pe.provide(Rh,tt),Pe.provide(ef,A_(Qe)),Pe.provide(Ip,L);const ct=Pe.unmount;Qr.add(Pe),Pe.unmount=function(){Qr.delete(Pe),Qr.size<1&&(U=Xs,Bt&&Bt(),Bt=null,L.value=Xs,hr=!1,Ct=!1),ct()}}};function wi(Pe){return Pe.reduce((tt,Qe)=>tt.then(()=>dt(Qe)),Promise.resolve())}return gr}function Lw(n,a){const d=[],m=[],x=[],T=Math.max(a.matched.length,n.matched.length);for(let v=0;v<T;v++){const h=a.matched[v];h&&(n.matched.find(U=>rl(U,h))?m.push(h):d.push(h));const L=n.matched[v];L&&(a.matched.find(U=>rl(U,L))||x.push(L))}return[d,m,x]}function Iy(){return ln(Rh)}function tf(){return ln(ef)}const Fw={__name:"App",setup(n){return(a,d)=>(Nt(),ts(qt(Ay)))}},Ow="modulepreload",Bw=function(n){return"/vue3-atlas2/"+n},Og={},Nw=function(a,d,m){let x=Promise.resolve();if(d&&d.length>0){const T=document.getElementsByTagName("link"),v=document.querySelector("meta[property=csp-nonce]"),h=(v==null?void 0:v.nonce)||(v==null?void 0:v.getAttribute("nonce"));x=Promise.all(d.map(L=>{if(L=Bw(L),L in Og)return;Og[L]=!0;const U=L.endsWith(".css"),j=U?'[rel="stylesheet"]':"";if(!!m)for(let de=T.length-1;de>=0;de--){const _e=T[de];if(_e.href===L&&(!U||_e.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${L}"]${j}`))return;const V=document.createElement("link");if(V.rel=U?"stylesheet":Ow,U||(V.as="script",V.crossOrigin=""),V.href=L,h&&V.setAttribute("nonce",h),document.head.appendChild(V),U)return new Promise((de,_e)=>{V.addEventListener("load",de),V.addEventListener("error",()=>_e(new Error(`Unable to preload CSS for ${L}`)))})}))}return x.then(()=>a()).catch(T=>{const v=new Event("vite:preloadError",{cancelable:!0});if(v.payload=T,window.dispatchEvent(v),!v.defaultPrevented)throw T})};var Vw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ey(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Py={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.3/LICENSE.txt
 */(function(n,a){(function(d,m){n.exports=m()})(Vw,function(){var d={},m={};function x(v,h,L){if(m[v]=L,v==="index"){var U="var sharedModule = {}; ("+m.shared+")(sharedModule); ("+m.worker+")(sharedModule);",j={};return m.shared(j),m.index(d,j),typeof window<"u"&&d.setWorkerUrl(window.URL.createObjectURL(new Blob([U],{type:"text/javascript"}))),d}}x("shared",["exports"],function(v){function h(i,e,r,o){return new(r||(r=Promise))(function(u,g){function _(I){try{S(o.next(I))}catch(P){g(P)}}function y(I){try{S(o.throw(I))}catch(P){g(P)}}function S(I){var P;I.done?u(I.value):(P=I.value,P instanceof r?P:new r(function(C){C(P)})).then(_,y)}S((o=o.apply(i,e||[])).next())})}function L(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var U=j;function j(i,e){this.x=i,this.y=e}j.prototype={clone:function(){return new j(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),o=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=o,this},_rotateAround:function(i,e){var r=Math.cos(i),o=Math.sin(i),u=e.y+o*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-o*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},j.convert=function(i){return i instanceof j?i:Array.isArray(i)?new j(i[0],i[1]):i};var N=L(U),V=de;function de(i,e,r,o){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=o}de.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,o=0;o<8;o++){var u=this.sampleCurveX(r)-i;if(Math.abs(u)<e)return r;var g=this.sampleCurveDerivativeX(r);if(Math.abs(g)<1e-6)break;r-=u/g}var _=0,y=1;for(r=i,o=0;o<20&&(u=this.sampleCurveX(r),!(Math.abs(u-i)<e));o++)i>u?_=r:y=r,r=.5*(y-_)+_;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var _e=L(V);let Ie,Je;function Ue(){return Ie==null&&(Ie=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ie}function We(){if(Je==null&&(Je=!1,Ue())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let o=0;o<5*5;o++){const u=4*o;e.fillStyle=`rgb(${u},${u+1},${u+2})`,e.fillRect(o%5,Math.floor(o/5),1,1)}const r=e.getImageData(0,0,5,5).data;for(let o=0;o<5*5*4;o++)if(o%4!=3&&r[o]!==o){Je=!0;break}}}return Je||!1}function ye(i,e,r,o){const u=new _e(i,e,r,o);return function(g){return u.solve(g)}}const Be=ye(.25,.1,.25,1);function ot(i,e,r){return Math.min(r,Math.max(e,i))}function at(i,e,r){const o=r-e,u=((i-e)%o+o)%o+e;return u===e?r:u}function xt(i,...e){for(const r of e)for(const o in r)i[o]=r[o];return i}let St=1;function dt(i,e,r){const o={};for(const u in i)o[u]=e.call(r||this,i[u],u,i);return o}function kt(i,e,r){const o={};for(const u in i)e.call(r||this,i[u],u,i)&&(o[u]=i[u]);return o}function vt(i){return Array.isArray(i)?i.map(vt):typeof i=="object"&&i?dt(i,vt):i}const pt={};function Bt(i){pt[i]||(typeof console<"u"&&console.warn(i),pt[i]=!0)}function Pt(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function di(i){let e=0;for(let r,o,u=0,g=i.length,_=g-1;u<g;_=u++)r=i[u],o=i[_],e+=(o.x-r.x)*(r.y+o.y);return e}function It(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let Ct=null;function Xt(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const ur="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function wr(i,e,r,o,u){return h(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const g=new VideoFrame(i,{timestamp:0});try{const _=g==null?void 0:g.format;if(!_||!_.startsWith("BGR")&&!_.startsWith("RGB"))throw new Error(`Unrecognized format ${_}`);const y=_.startsWith("BGR"),S=new Uint8ClampedArray(o*u*4);if(yield g.copyTo(S,function(I,P,C,z,F){const B=4*Math.max(-P,0),G=(Math.max(0,C)-C)*z*4+B,K=4*z,te=Math.max(0,P),he=Math.max(0,C);return{rect:{x:te,y:he,width:Math.min(I.width,P+z)-te,height:Math.min(I.height,C+F)-he},layout:[{offset:G,stride:K}]}}(i,e,r,o,u)),y)for(let I=0;I<S.length;I+=4){const P=S[I];S[I]=S[I+2],S[I+2]=P}return S}finally{g.close()}})}let bi,oi;const hr="AbortError";function Qr(){return new Error(hr)}const gr={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function wi(i){return gr.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const Pe="global-dispatcher";class tt extends Error{constructor(e,r,o,u){super(`AJAXError: ${r} (${e}): ${o}`),this.status=e,this.statusText=r,this.url=o,this.body=u}}const Qe=()=>It(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,ct=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const o=wi(i.url);if(o)return o(i,e);if(It(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:Pe},e)}if(!(/^file:/.test(r=i.url)||/^file:/.test(Qe())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(o,u){return h(this,void 0,void 0,function*(){const g=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:Qe(),signal:u.signal});o.type==="json"&&g.headers.set("Accept","application/json");const _=yield fetch(g);if(!_.ok){const I=yield _.blob();throw new tt(_.status,_.statusText,o.url,I)}let y;y=o.type==="arrayBuffer"||o.type==="image"?_.arrayBuffer():o.type==="json"?_.json():_.text();const S=yield y;if(u.signal.aborted)throw Qr();return{data:S,cacheControl:_.headers.get("Cache-Control"),expires:_.headers.get("Expires")}})}(i,e);if(It(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:Pe},e)}var r;return function(o,u){return new Promise((g,_)=>{const y=new XMLHttpRequest;y.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(y.responseType="arraybuffer");for(const S in o.headers)y.setRequestHeader(S,o.headers[S]);o.type==="json"&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials=o.credentials==="include",y.onerror=()=>{_(new Error(y.statusText))},y.onload=()=>{if(!u.signal.aborted)if((y.status>=200&&y.status<300||y.status===0)&&y.response!==null){let S=y.response;if(o.type==="json")try{S=JSON.parse(y.response)}catch(I){return void _(I)}g({data:S,cacheControl:y.getResponseHeader("Cache-Control"),expires:y.getResponseHeader("Expires")})}else{const S=new Blob([y.response],{type:y.getResponseHeader("Content-Type")});_(new tt(y.status,y.statusText,o.url,S))}},u.signal.addEventListener("abort",()=>{y.abort(),_(Qr())}),y.send(o.body)})}(i,e)};function Qt(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),r=window.location;return e.protocol===r.protocol&&e.host===r.host}function ti(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function J(i,e,r){if(r&&r[i]){const o=r[i].indexOf(e);o!==-1&&r[i].splice(o,1)}}class ie{constructor(e,r={}){xt(this,r),this.type=e}}class ve extends ie{constructor(e,r={}){super("error",xt({error:e},r))}}class De{on(e,r){return this._listeners=this._listeners||{},ti(e,r,this._listeners),this}off(e,r){return J(e,r,this._listeners),J(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},ti(e,r,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,r){typeof e=="string"&&(e=new ie(e,r||{}));const o=e.type;if(this.listens(o)){e.target=this;const u=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const y of u)y.call(this,e);const g=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const y of g)J(o,y,this._oneTimeListeners),y.call(this,e);const _=this._eventedParent;_&&(xt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(e))}else e instanceof ve&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var ee={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const qe=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function et(i,e){const r={};for(const o in i)o!=="ref"&&(r[o]=i[o]);return qe.forEach(o=>{o in e&&(r[o]=e[o])}),r}function Ae(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(!Ae(i[r],e[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const r in i)if(!Ae(i[r],e[r]))return!1;return!0}return i===e}function Oe(i,e){i.push(e)}function Fe(i,e,r){Oe(r,{command:"addSource",args:[i,e[i]]})}function nt(i,e,r){Oe(e,{command:"removeSource",args:[i]}),r[i]=!0}function bt(i,e,r,o){nt(i,r,o),Fe(i,e,r)}function ft(i,e,r){let o;for(o in i[r])if(Object.prototype.hasOwnProperty.call(i[r],o)&&o!=="data"&&!Ae(i[r][o],e[r][o]))return!1;for(o in e[r])if(Object.prototype.hasOwnProperty.call(e[r],o)&&o!=="data"&&!Ae(i[r][o],e[r][o]))return!1;return!0}function Tt(i,e,r,o,u,g){i=i||{},e=e||{};for(const _ in i)Object.prototype.hasOwnProperty.call(i,_)&&(Ae(i[_],e[_])||r.push({command:g,args:[o,_,e[_],u]}));for(const _ in e)Object.prototype.hasOwnProperty.call(e,_)&&!Object.prototype.hasOwnProperty.call(i,_)&&(Ae(i[_],e[_])||r.push({command:g,args:[o,_,e[_],u]}))}function jt(i){return i.id}function Yt(i,e){return i[e.id]=e,i}class Ce{constructor(e,r,o,u){this.message=(e?`${e}: `:"")+o,u&&(this.identifier=u),r!=null&&r.__line__&&(this.line=r.__line__)}}function pi(i,...e){for(const r of e)for(const o in r)i[o]=r[o];return i}class Si extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class en{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[o,u]of r)this.bindings[o]=u}concat(e){return new en(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Xi={kind:"null"},Ve={kind:"number"},Mt={kind:"string"},gt={kind:"boolean"},ai={kind:"color"},Ur={kind:"object"},Dt={kind:"value"},ls={kind:"collator"},Yi={kind:"formatted"},X={kind:"padding"},D={kind:"resolvedImage"},R={kind:"variableAnchorOffsetCollection"};function $(i,e){return{kind:"array",itemType:i,N:e}}function H(i){if(i.kind==="array"){const e=H(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const oe=[Xi,Ve,Mt,gt,ai,Yi,Ur,$(Dt),X,D,R];function ae(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ae(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of oe)if(!ae(r,e))return null}}return`Expected ${H(i)} but found ${H(e)} instead.`}function ue(i,e){return e.some(r=>r.kind===i.kind)}function ne(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function pe(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const Me=.96422,Se=.82521,Te=4/29,ht=6/29,_t=3*ht*ht,zt=ht*ht*ht,Et=Math.PI/180,Zt=180/Math.PI;function fi(i){return(i%=360)<0&&(i+=360),i}function Ti([i,e,r,o]){let u,g;const _=Ft((.2225045*(i=qi(i))+.7168786*(e=qi(e))+.0606169*(r=qi(r)))/1);i===e&&e===r?u=g=_:(u=Ft((.4360747*i+.3850649*e+.1430804*r)/Me),g=Ft((.0139322*i+.0971045*e+.7141733*r)/Se));const y=116*_-16;return[y<0?0:y,500*(u-_),200*(_-g),o]}function qi(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Ft(i){return i>zt?Math.pow(i,1/3):i/_t+Te}function Di([i,e,r,o]){let u=(i+16)/116,g=isNaN(e)?u:u+e/500,_=isNaN(r)?u:u-r/200;return u=1*Sr(u),g=Me*Sr(g),_=Se*Sr(_),[Ji(3.1338561*g-1.6168667*u-.4906146*_),Ji(-.9787684*g+1.9161415*u+.033454*_),Ji(.0719453*g-.2289914*u+1.4052427*_),o]}function Ji(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function Sr(i){return i>ht?i*i*i:_t*(i-Te)}function Dr(i){return parseInt(i.padEnd(2,i),16)/255}function cr(i,e){return bn(e?i/100:i,0,1)}function bn(i,e,r){return Math.min(Math.max(e,i),r)}function Nc(i){return!i.some(Number.isNaN)}const jh={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class ci{constructor(e,r,o,u=1,g=!0){this.r=e,this.g=r,this.b=o,this.a=u,g||(this.r*=u,this.g*=u,this.b*=u,u||this.overwriteGetter("rgb",[e,r,o,u]))}static parse(e){if(e instanceof ci)return e;if(typeof e!="string")return;const r=function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const u=jh[o];if(u){const[_,y,S]=u;return[_/255,y/255,S/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const _=o.length<6?1:2;let y=1;return[Dr(o.slice(y,y+=_)),Dr(o.slice(y,y+=_)),Dr(o.slice(y,y+=_)),Dr(o.slice(y,y+_)||"ff")]}if(o.startsWith("rgb")){const _=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[y,S,I,P,C,z,F,B,G,K,te,he]=_,re=[P||" ",F||" ",K].join("");if(re==="  "||re==="  /"||re===",,"||re===",,,"){const le=[I,z,G].join(""),we=le==="%%%"?100:le===""?255:0;if(we){const Ee=[bn(+S/we,0,1),bn(+C/we,0,1),bn(+B/we,0,1),te?cr(+te,he):1];if(Nc(Ee))return Ee}}return}}const g=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[_,y,S,I,P,C,z,F,B]=g,G=[S||" ",P||" ",z].join("");if(G==="  "||G==="  /"||G===",,"||G===",,,"){const K=[+y,bn(+I,0,100),bn(+C,0,100),F?cr(+F,B):1];if(Nc(K))return function([te,he,re,le]){function we(Ee){const Ye=(Ee+te/30)%12,st=he*Math.min(re,1-re);return re-st*Math.max(-1,Math.min(Ye-3,9-Ye,1))}return te=fi(te),he/=100,re/=100,[we(0),we(8),we(4),le]}(K)}}}(e);return r?new ci(...r,!1):void 0}get rgb(){const{r:e,g:r,b:o,a:u}=this,g=u||1/0;return this.overwriteGetter("rgb",[e/g,r/g,o/g,u])}get hcl(){return this.overwriteGetter("hcl",function(e){const[r,o,u,g]=Ti(e),_=Math.sqrt(o*o+u*u);return[Math.round(1e4*_)?fi(Math.atan2(u,o)*Zt):NaN,_,r,g]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Ti(this.rgb))}overwriteGetter(e,r){return Object.defineProperty(this,e,{value:r}),r}toString(){const[e,r,o,u]=this.rgb;return`rgba(${[e,r,o].map(g=>Math.round(255*g)).join(",")},${u})`}}ci.black=new ci(0,0,0,1),ci.white=new ci(1,1,1,1),ci.transparent=new ci(0,0,0,0),ci.red=new ci(1,0,0,1);class ll{constructor(e,r,o){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class cl{constructor(e,r,o,u,g){this.text=e,this.image=r,this.scale=o,this.fontStack=u,this.textColor=g}}class jr{constructor(e){this.sections=e}static fromString(e){return new jr([new cl(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof jr?e:jr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class zr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof zr)return e;if(typeof e=="number")return new zr([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new zr(e)}}toString(){return JSON.stringify(this.values)}}const co=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class tn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof tn)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let r=0;r<e.length;r+=2){const o=e[r],u=e[r+1];if(typeof o!="string"||!co.has(o)||!Array.isArray(u)||u.length!==2||typeof u[0]!="number"||typeof u[1]!="number")return}return new tn(e)}}toString(){return JSON.stringify(this.values)}}class rn{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new rn({name:e,available:!1}):null}}function Ms(i,e,r,o){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[i,e,r,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[i,e,r,o]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Wo(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof ci||i instanceof ll||i instanceof jr||i instanceof zr||i instanceof tn||i instanceof rn)return!0;if(Array.isArray(i)){for(const e of i)if(!Wo(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!Wo(i[e]))return!1;return!0}return!1}function Gi(i){if(i===null)return Xi;if(typeof i=="string")return Mt;if(typeof i=="boolean")return gt;if(typeof i=="number")return Ve;if(i instanceof ci)return ai;if(i instanceof ll)return ls;if(i instanceof jr)return Yi;if(i instanceof zr)return X;if(i instanceof tn)return R;if(i instanceof rn)return D;if(Array.isArray(i)){const e=i.length;let r;for(const o of i){const u=Gi(o);if(r){if(r===u)continue;r=Dt;break}r=u}return $(r||Dt,e)}return Ur}function uo(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof ci||i instanceof jr||i instanceof zr||i instanceof tn||i instanceof rn?i.toString():JSON.stringify(i)}class jn{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Wo(e[1]))return r.error("invalid value");const o=e[1];let u=Gi(o);const g=r.expectedType;return u.kind!=="array"||u.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(u=g),new jn(u,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Pi{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Ko={string:Mt,number:Ve,boolean:gt,object:Ur};class qr{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let o,u=1;const g=e[0];if(g==="array"){let y,S;if(e.length>2){const I=e[1];if(typeof I!="string"||!(I in Ko)||I==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);y=Ko[I],u++}else y=Dt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);S=e[2],u++}o=$(y,S)}else{if(!Ko[g])throw new Error(`Types doesn't contain name = ${g}`);o=Ko[g]}const _=[];for(;u<e.length;u++){const y=r.parse(e[u],u,Dt);if(!y)return null;_.push(y)}return new qr(o,_)}evaluate(e){for(let r=0;r<this.args.length;r++){const o=this.args[r].evaluate(e);if(!ae(this.type,Gi(o)))return o;if(r===this.args.length-1)throw new Pi(`Expected value to be of type ${H(this.type)}, but found ${H(Gi(o))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Xo={"to-boolean":gt,"to-color":ai,"to-number":Ve,"to-string":Mt};class wn{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const o=e[0];if(!Xo[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&e.length!==2)return r.error("Expected one argument.");const u=Xo[o],g=[];for(let _=1;_<e.length;_++){const y=r.parse(e[_],_,Dt);if(!y)return null;g.push(y)}return new wn(u,g)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let r,o;for(const u of this.args){if(r=u.evaluate(e),o=null,r instanceof ci)return r;if(typeof r=="string"){const g=e.parseColor(r);if(g)return g}else if(Array.isArray(r)&&(o=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Ms(r[0],r[1],r[2],r[3]),!o))return new ci(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Pi(o||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const o of this.args){r=o.evaluate(e);const u=zr.parse(r);if(u)return u}throw new Pi(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const o of this.args){r=o.evaluate(e);const u=tn.parse(r);if(u)return u}throw new Pi(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const o of this.args){if(r=o.evaluate(e),r===null)return 0;const u=Number(r);if(!isNaN(u))return u}throw new Pi(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return jr.fromString(uo(this.args[0].evaluate(e)));case"resolvedImage":return rn.fromString(uo(this.args[0].evaluate(e)));default:return uo(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const ho=["Unknown","Point","LineString","Polygon"];class ui{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ho[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=ci.parse(e)),r}}class Yo{constructor(e,r,o=[],u,g=new en,_=[]){this.registry=e,this.path=o,this.key=o.map(y=>`[${y}]`).join(""),this.scope=g,this.errors=_,this.expectedType=u,this._isConstant=r}parse(e,r,o,u,g={}){return r?this.concat(r,o,u)._parse(e,g):this._parse(e,g)}_parse(e,r){function o(u,g,_){return _==="assert"?new qr(g,[u]):_==="coerce"?new wn(g,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[u];if(g){let _=g.parse(e,this);if(!_)return null;if(this.expectedType){const y=this.expectedType,S=_.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||S.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||S.kind!=="value"&&S.kind!=="string")if(y.kind!=="padding"||S.kind!=="value"&&S.kind!=="number"&&S.kind!=="array")if(y.kind!=="variableAnchorOffsetCollection"||S.kind!=="value"&&S.kind!=="array"){if(this.checkSubtype(y,S))return null}else _=o(_,y,r.typeAnnotation||"coerce");else _=o(_,y,r.typeAnnotation||"coerce");else _=o(_,y,r.typeAnnotation||"coerce");else _=o(_,y,r.typeAnnotation||"assert")}if(!(_ instanceof jn)&&_.type.kind!=="resolvedImage"&&this._isConstant(_)){const y=new ui;try{_=new jn(_.type,_.evaluate(y))}catch(S){return this.error(S.message),null}}return _}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,o){const u=typeof e=="number"?this.path.concat(e):this.path,g=o?this.scope.concat(o):this.scope;return new Yo(this.registry,this._isConstant,u,r||null,g,this.errors)}error(e,...r){const o=`${this.key}${r.map(u=>`[${u}]`).join("")}`;this.errors.push(new Si(o,e))}checkSubtype(e,r){const o=ae(e,r);return o&&this.error(o),o}}class ks{constructor(e,r,o){this.type=ls,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return r.error("Collator options argument must be an object.");const u=r.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,gt);if(!u)return null;const g=r.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,gt);if(!g)return null;let _=null;return o.locale&&(_=r.parse(o.locale,1,Mt),!_)?null:new ks(u,g,_)}evaluate(e){return new ll(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const qn=8192;function Jo(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function po(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function qh(i,e){const r=(180+i[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(r*u*qn),Math.round(o*u*qn)]}function Vc(i,e,r){const o=i[0]-e[0],u=i[1]-e[1],g=i[0]-r[0],_=i[1]-r[1];return o*_-g*u==0&&o*g<=0&&u*_<=0}function Qo(i,e){let r=!1;for(let _=0,y=e.length;_<y;_++){const S=e[_];for(let I=0,P=S.length;I<P-1;I++){if(Vc(i,S[I],S[I+1]))return!1;(u=S[I])[1]>(o=i)[1]!=(g=S[I+1])[1]>o[1]&&o[0]<(g[0]-u[0])*(o[1]-u[1])/(g[1]-u[1])+u[0]&&(r=!r)}}var o,u,g;return r}function Gh(i,e){for(let r=0;r<e.length;r++)if(Qo(i,e[r]))return!0;return!1}function $c(i,e,r,o){const u=o[0]-r[0],g=o[1]-r[1],_=(i[0]-r[0])*g-u*(i[1]-r[1]),y=(e[0]-r[0])*g-u*(e[1]-r[1]);return _>0&&y<0||_<0&&y>0}function Hh(i,e,r){for(const I of r)for(let P=0;P<I.length-1;++P)if((y=[(_=I[P+1])[0]-(g=I[P])[0],_[1]-g[1]])[0]*(S=[(u=e)[0]-(o=i)[0],u[1]-o[1]])[1]-y[1]*S[0]!=0&&$c(o,u,g,_)&&$c(g,_,o,u))return!0;var o,u,g,_,y,S;return!1}function Uc(i,e){for(let r=0;r<i.length;++r)if(!Qo(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(Hh(i[r],i[r+1],e))return!1;return!0}function jc(i,e){for(let r=0;r<e.length;r++)if(Uc(i,e[r]))return!0;return!1}function ea(i,e,r){const o=[];for(let u=0;u<i.length;u++){const g=[];for(let _=0;_<i[u].length;_++){const y=qh(i[u][_],r);Jo(e,y),g.push(y)}o.push(g)}return o}function qc(i,e,r){const o=[];for(let u=0;u<i.length;u++){const g=ea(i[u],e,r);o.push(g)}return o}function Gc(i,e,r,o){if(i[0]<r[0]||i[0]>r[2]){const u=.5*o;let g=i[0]-r[0]>u?-o:r[0]-i[0]>u?o:0;g===0&&(g=i[0]-r[2]>u?-o:r[2]-i[0]>u?o:0),i[0]+=g}Jo(e,i)}function ta(i,e,r,o){const u=Math.pow(2,o.z)*qn,g=[o.x*qn,o.y*qn],_=[];for(const y of i)for(const S of y){const I=[S.x+g[0],S.y+g[1]];Gc(I,e,r,u),_.push(I)}return _}function Hc(i,e,r,o){const u=Math.pow(2,o.z)*qn,g=[o.x*qn,o.y*qn],_=[];for(const S of i){const I=[];for(const P of S){const C=[P.x+g[0],P.y+g[1]];Jo(e,C),I.push(C)}_.push(I)}if(e[2]-e[0]<=u/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const S of _)for(const I of S)Gc(I,e,r,u)}var y;return _}class cs{constructor(e,r){this.type=gt,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Wo(e[1])){const o=e[1];if(o.type==="FeatureCollection"){const u=[];for(const g of o.features){const{type:_,coordinates:y}=g.geometry;_==="Polygon"&&u.push(y),_==="MultiPolygon"&&u.push(...y)}if(u.length)return new cs(o,{type:"MultiPolygon",coordinates:u})}else if(o.type==="Feature"){const u=o.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new cs(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new cs(o,o)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,o){const u=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(o.type==="Polygon"){const y=ea(o.coordinates,g,_),S=ta(r.geometry(),u,g,_);if(!po(u,g))return!1;for(const I of S)if(!Qo(I,y))return!1}if(o.type==="MultiPolygon"){const y=qc(o.coordinates,g,_),S=ta(r.geometry(),u,g,_);if(!po(u,g))return!1;for(const I of S)if(!Gh(I,y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,o){const u=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(o.type==="Polygon"){const y=ea(o.coordinates,g,_),S=Hc(r.geometry(),u,g,_);if(!po(u,g))return!1;for(const I of S)if(!Uc(I,y))return!1}if(o.type==="MultiPolygon"){const y=qc(o.coordinates,g,_),S=Hc(r.geometry(),u,g,_);if(!po(u,g))return!1;for(const I of S)if(!jc(I,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class ia{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const o=e[1];return r.scope.has(o)?new ia(o,r.scope.get(o)):r.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Gr{constructor(e,r,o,u){this.name=e,this.type=r,this._evaluate=o,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const o=e[0],u=Gr.definitions[o];if(!u)return r.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(u)?u[0]:u.type,_=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,y=_.filter(([I])=>!Array.isArray(I)||I.length===e.length-1);let S=null;for(const[I,P]of y){S=new Yo(r.registry,fo,r.path,null,r.scope);const C=[];let z=!1;for(let F=1;F<e.length;F++){const B=e[F],G=Array.isArray(I)?I[F-1]:I.type,K=S.parse(B,1+C.length,G);if(!K){z=!0;break}C.push(K)}if(!z)if(Array.isArray(I)&&I.length!==C.length)S.error(`Expected ${I.length} arguments, but found ${C.length} instead.`);else{for(let F=0;F<C.length;F++){const B=Array.isArray(I)?I[F]:I.type,G=C[F];S.concat(F+1).checkSubtype(B,G.type)}if(S.errors.length===0)return new Gr(o,g,P,C)}}if(y.length===1)r.errors.push(...S.errors);else{const I=(y.length?y:_).map(([C])=>{return z=C,Array.isArray(z)?`(${z.map(H).join(", ")})`:`(${H(z.type)}...)`;var z}).join(" | "),P=[];for(let C=1;C<e.length;C++){const z=r.parse(e[C],1+P.length);if(!z)return null;P.push(H(z.type))}r.error(`Expected arguments of type ${I}, but found (${P.join(", ")}) instead.`)}return null}static register(e,r){Gr.definitions=r;for(const o in r)e[o]=Gr}}function fo(i){if(i instanceof ia)return fo(i.boundExpression);if(i instanceof Gr&&i.name==="error"||i instanceof ks||i instanceof cs)return!1;const e=i instanceof wn||i instanceof qr;let r=!0;return i.eachChild(o=>{r=e?r&&fo(o):r&&o instanceof jn}),!!r&&ra(i)&&go(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ra(i){if(i instanceof Gr&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof cs)return!1;let e=!0;return i.eachChild(r=>{e&&!ra(r)&&(e=!1)}),e}function mo(i){if(i instanceof Gr&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!mo(r)&&(e=!1)}),e}function go(i,e){if(i instanceof Gr&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(o=>{r&&!go(o,e)&&(r=!1)}),r}function _o(i,e){const r=i.length-1;let o,u,g=0,_=r,y=0;for(;g<=_;)if(y=Math.floor((g+_)/2),o=i[y],u=i[y+1],o<=e){if(y===r||e<u)return y;g=y+1}else{if(!(o>e))throw new Pi("Input is not a number.");_=y-1}return 0}class yo{constructor(e,r,o){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[u,g]of o)this.labels.push(u),this.outputs.push(g)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const o=r.parse(e[1],1,Ve);if(!o)return null;const u=[];let g=null;r.expectedType&&r.expectedType.kind!=="value"&&(g=r.expectedType);for(let _=1;_<e.length;_+=2){const y=_===1?-1/0:e[_],S=e[_+1],I=_,P=_+1;if(typeof y!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(u.length&&u[u.length-1][0]>=y)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const C=r.parse(S,P,g);if(!C)return null;g=g||C.type,u.push([y,C])}return new yo(g,o,u)}evaluate(e){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return o[0].evaluate(e);const g=r.length;return u>=r[g-1]?o[g-1].evaluate(e):o[_o(r,u)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Zh(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Wh=Zc;function Zc(i,e,r,o){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=o}Zc.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,o=0;o<8;o++){var u=this.sampleCurveX(r)-i;if(Math.abs(u)<e)return r;var g=this.sampleCurveDerivativeX(r);if(Math.abs(g)<1e-6)break;r-=u/g}var _=0,y=1;for(r=i,o=0;o<20&&(u=this.sampleCurveX(r),!(Math.abs(u-i)<e));o++)i>u?_=r:y=r,r=.5*(y-_)+_;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var Kh=Zh(Wh);function us(i,e,r){return i+r*(e-i)}function na(i,e,r){return i.map((o,u)=>us(o,e[u],r))}const Tr={number:us,color:function(i,e,r,o="rgb"){switch(o){case"rgb":{const[u,g,_,y]=na(i.rgb,e.rgb,r);return new ci(u,g,_,y,!1)}case"hcl":{const[u,g,_,y]=i.hcl,[S,I,P,C]=e.hcl;let z,F;if(isNaN(u)||isNaN(S))isNaN(u)?isNaN(S)?z=NaN:(z=S,_!==1&&_!==0||(F=I)):(z=u,P!==1&&P!==0||(F=g));else{let he=S-u;S>u&&he>180?he-=360:S<u&&u-S>180&&(he+=360),z=u+r*he}const[B,G,K,te]=function([he,re,le,we]){return he=isNaN(he)?0:he*Et,Di([le,Math.cos(he)*re,Math.sin(he)*re,we])}([z,F??us(g,I,r),us(_,P,r),us(y,C,r)]);return new ci(B,G,K,te,!1)}case"lab":{const[u,g,_,y]=Di(na(i.lab,e.lab,r));return new ci(u,g,_,y,!1)}}},array:na,padding:function(i,e,r){return new zr(na(i.values,e.values,r))},variableAnchorOffsetCollection:function(i,e,r){const o=i.values,u=e.values;if(o.length!==u.length)throw new Pi(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${e.toString()}`);const g=[];for(let _=0;_<o.length;_+=2){if(o[_]!==u[_])throw new Pi(`Cannot interpolate values containing mismatched anchors. from[${_}]: ${o[_]}, to[${_}]: ${u[_]}`);g.push(o[_]);const[y,S]=o[_+1],[I,P]=u[_+1];g.push([us(y,I,r),us(S,P,r)])}return new tn(g)}};class _r{constructor(e,r,o,u,g){this.type=e,this.operator=r,this.interpolation=o,this.input=u,this.labels=[],this.outputs=[];for(const[_,y]of g)this.labels.push(_),this.outputs.push(y)}static interpolationFactor(e,r,o,u){let g=0;if(e.name==="exponential")g=ii(r,e.base,o,u);else if(e.name==="linear")g=ii(r,1,o,u);else if(e.name==="cubic-bezier"){const _=e.controlPoints;g=new Kh(_[0],_[1],_[2],_[3]).solve(ii(r,1,o,u))}return g}static parse(e,r){let[o,u,g,..._]=e;if(!Array.isArray(u)||u.length===0)return r.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const I=u[1];if(typeof I!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:I}}else{if(u[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const I=u.slice(1);if(I.length!==4||I.some(P=>typeof P!="number"||P<0||P>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:I}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(g=r.parse(g,2,Ve),!g)return null;const y=[];let S=null;o==="interpolate-hcl"||o==="interpolate-lab"?S=ai:r.expectedType&&r.expectedType.kind!=="value"&&(S=r.expectedType);for(let I=0;I<_.length;I+=2){const P=_[I],C=_[I+1],z=I+3,F=I+4;if(typeof P!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(y.length&&y[y.length-1][0]>=P)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);const B=r.parse(C,F,S);if(!B)return null;S=S||B.type,y.push([P,B])}return pe(S,Ve)||pe(S,ai)||pe(S,X)||pe(S,R)||pe(S,$(Ve))?new _r(S,o,u,g,y):r.error(`Type ${H(S)} is not interpolatable.`)}evaluate(e){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return o[0].evaluate(e);const g=r.length;if(u>=r[g-1])return o[g-1].evaluate(e);const _=_o(r,u),y=_r.interpolationFactor(this.interpolation,u,r[_],r[_+1]),S=o[_].evaluate(e),I=o[_+1].evaluate(e);switch(this.operator){case"interpolate":return Tr[this.type.kind](S,I,y);case"interpolate-hcl":return Tr.color(S,I,y,"hcl");case"interpolate-lab":return Tr.color(S,I,y,"lab")}}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function ii(i,e,r,o){const u=o-r,g=i-r;return u===0?0:e===1?g/u:(Math.pow(e,g)-1)/(Math.pow(e,u)-1)}class sa{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let o=null;const u=r.expectedType;u&&u.kind!=="value"&&(o=u);const g=[];for(const y of e.slice(1)){const S=r.parse(y,1+g.length,o,void 0,{typeAnnotation:"omit"});if(!S)return null;o=o||S.type,g.push(S)}if(!o)throw new Error("No output type");const _=u&&g.some(y=>ae(u,y.type));return new sa(_?Dt:o,g)}evaluate(e){let r,o=null,u=0;for(const g of this.args)if(u++,o=g.evaluate(e),o&&o instanceof rn&&!o.available&&(r||(r=o.name),o=null,u===this.args.length&&(o=r)),o!==null)break;return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class oa{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let g=1;g<e.length-1;g+=2){const _=e[g];if(typeof _!="string")return r.error(`Expected string, but found ${typeof _} instead.`,g);if(/[^a-zA-Z0-9_]/.test(_))return r.error("Variable names must contain only alphanumeric characters or '_'.",g);const y=r.parse(e[g+1],g+1);if(!y)return null;o.push([_,y])}const u=r.parse(e[e.length-1],e.length-1,r.expectedType,o);return u?new oa(o,u):null}outputDefined(){return this.result.outputDefined()}}class ul{constructor(e,r,o){this.type=e,this.index=r,this.input=o}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,Ve),u=r.parse(e[2],2,$(r.expectedType||Dt));return o&&u?new ul(u.type.itemType,o,u):null}evaluate(e){const r=this.index.evaluate(e),o=this.input.evaluate(e);if(r<0)throw new Pi(`Array index out of bounds: ${r} < 0.`);if(r>=o.length)throw new Pi(`Array index out of bounds: ${r} > ${o.length-1}.`);if(r!==Math.floor(r))throw new Pi(`Array index must be an integer, but found ${r} instead.`);return o[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class hl{constructor(e,r){this.type=gt,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,Dt),u=r.parse(e[2],2,Dt);return o&&u?ue(o.type,[gt,Mt,Ve,Xi,Dt])?new hl(o,u):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${H(o.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!ne(r,["boolean","string","number","null"]))throw new Pi(`Expected first argument to be of type boolean, string, number or null, but found ${H(Gi(r))} instead.`);if(!ne(o,["string","array"]))throw new Pi(`Expected second argument to be of type array or string, but found ${H(Gi(o))} instead.`);return o.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class aa{constructor(e,r,o){this.type=Ve,this.needle=e,this.haystack=r,this.fromIndex=o}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,Dt),u=r.parse(e[2],2,Dt);if(!o||!u)return null;if(!ue(o.type,[gt,Mt,Ve,Xi,Dt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${H(o.type)} instead`);if(e.length===4){const g=r.parse(e[3],3,Ve);return g?new aa(o,u,g):null}return new aa(o,u)}evaluate(e){const r=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!ne(r,["boolean","string","number","null"]))throw new Pi(`Expected first argument to be of type boolean, string, number or null, but found ${H(Gi(r))} instead.`);if(!ne(o,["string","array"]))throw new Pi(`Expected second argument to be of type array or string, but found ${H(Gi(o))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return o.indexOf(r,u)}return o.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class dl{constructor(e,r,o,u,g,_){this.inputType=e,this.type=r,this.input=o,this.cases=u,this.outputs=g,this.otherwise=_}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let o,u;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);const g={},_=[];for(let I=2;I<e.length-1;I+=2){let P=e[I];const C=e[I+1];Array.isArray(P)||(P=[P]);const z=r.concat(I);if(P.length===0)return z.error("Expected at least one branch label.");for(const B of P){if(typeof B!="number"&&typeof B!="string")return z.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return z.error("Numeric branch labels must be integer values.");if(o){if(z.checkSubtype(o,Gi(B)))return null}else o=Gi(B);if(g[String(B)]!==void 0)return z.error("Branch labels must be unique.");g[String(B)]=_.length}const F=r.parse(C,I,u);if(!F)return null;u=u||F.type,_.push(F)}const y=r.parse(e[1],1,Dt);if(!y)return null;const S=r.parse(e[e.length-1],e.length-1,u);return S?y.type.kind!=="value"&&r.concat(1).checkSubtype(o,y.type)?null:new dl(o,u,y,g,_,S):null}evaluate(e){const r=this.input.evaluate(e);return(Gi(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class pl{constructor(e,r,o){this.type=e,this.branches=r,this.otherwise=o}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let o;r.expectedType&&r.expectedType.kind!=="value"&&(o=r.expectedType);const u=[];for(let _=1;_<e.length-1;_+=2){const y=r.parse(e[_],_,gt);if(!y)return null;const S=r.parse(e[_+1],_+1,o);if(!S)return null;u.push([y,S]),o=o||S.type}const g=r.parse(e[e.length-1],e.length-1,o);if(!g)return null;if(!o)throw new Error("Can't infer output type");return new pl(o,u,g)}evaluate(e){for(const[r,o]of this.branches)if(r.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,o]of this.branches)e(r),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class la{constructor(e,r,o,u){this.type=e,this.input=r,this.beginIndex=o,this.endIndex=u}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,Dt),u=r.parse(e[2],2,Ve);if(!o||!u)return null;if(!ue(o.type,[$(Dt),Mt,Dt]))return r.error(`Expected first argument to be of type array or string, but found ${H(o.type)} instead`);if(e.length===4){const g=r.parse(e[3],3,Ve);return g?new la(o.type,o,u,g):null}return new la(o.type,o,u)}evaluate(e){const r=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!ne(r,["string","array"]))throw new Pi(`Expected first argument to be of type array or string, but found ${H(Gi(r))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return r.slice(o,u)}return r.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Wc(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Kc(i,e,r,o){return o.compare(e,r)===0}function Ds(i,e,r){const o=i!=="=="&&i!=="!=";return class Cy{constructor(g,_,y){this.type=gt,this.lhs=g,this.rhs=_,this.collator=y,this.hasUntypedArgument=g.type.kind==="value"||_.type.kind==="value"}static parse(g,_){if(g.length!==3&&g.length!==4)return _.error("Expected two or three arguments.");const y=g[0];let S=_.parse(g[1],1,Dt);if(!S)return null;if(!Wc(y,S.type))return _.concat(1).error(`"${y}" comparisons are not supported for type '${H(S.type)}'.`);let I=_.parse(g[2],2,Dt);if(!I)return null;if(!Wc(y,I.type))return _.concat(2).error(`"${y}" comparisons are not supported for type '${H(I.type)}'.`);if(S.type.kind!==I.type.kind&&S.type.kind!=="value"&&I.type.kind!=="value")return _.error(`Cannot compare types '${H(S.type)}' and '${H(I.type)}'.`);o&&(S.type.kind==="value"&&I.type.kind!=="value"?S=new qr(I.type,[S]):S.type.kind!=="value"&&I.type.kind==="value"&&(I=new qr(S.type,[I])));let P=null;if(g.length===4){if(S.type.kind!=="string"&&I.type.kind!=="string"&&S.type.kind!=="value"&&I.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(P=_.parse(g[3],3,ls),!P)return null}return new Cy(S,I,P)}evaluate(g){const _=this.lhs.evaluate(g),y=this.rhs.evaluate(g);if(o&&this.hasUntypedArgument){const S=Gi(_),I=Gi(y);if(S.kind!==I.kind||S.kind!=="string"&&S.kind!=="number")throw new Pi(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${S.kind}, ${I.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const S=Gi(_),I=Gi(y);if(S.kind!=="string"||I.kind!=="string")return e(g,_,y)}return this.collator?r(g,_,y,this.collator.evaluate(g)):e(g,_,y)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}}}const Xh=Ds("==",function(i,e,r){return e===r},Kc),Yh=Ds("!=",function(i,e,r){return e!==r},function(i,e,r,o){return!Kc(0,e,r,o)}),Jh=Ds("<",function(i,e,r){return e<r},function(i,e,r,o){return o.compare(e,r)<0}),Qh=Ds(">",function(i,e,r){return e>r},function(i,e,r,o){return o.compare(e,r)>0}),ed=Ds("<=",function(i,e,r){return e<=r},function(i,e,r,o){return o.compare(e,r)<=0}),td=Ds(">=",function(i,e,r){return e>=r},function(i,e,r,o){return o.compare(e,r)>=0});class fl{constructor(e,r,o,u,g){this.type=Mt,this.number=e,this.locale=r,this.currency=o,this.minFractionDigits=u,this.maxFractionDigits=g}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const o=r.parse(e[1],1,Ve);if(!o)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return r.error("NumberFormat options argument must be an object.");let g=null;if(u.locale&&(g=r.parse(u.locale,1,Mt),!g))return null;let _=null;if(u.currency&&(_=r.parse(u.currency,1,Mt),!_))return null;let y=null;if(u["min-fraction-digits"]&&(y=r.parse(u["min-fraction-digits"],1,Ve),!y))return null;let S=null;return u["max-fraction-digits"]&&(S=r.parse(u["max-fraction-digits"],1,Ve),!S)?null:new fl(o,g,_,y,S)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class ca{constructor(e){this.type=Yi,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return r.error("First argument must be an image or text section.");const u=[];let g=!1;for(let _=1;_<=e.length-1;++_){const y=e[_];if(g&&typeof y=="object"&&!Array.isArray(y)){g=!1;let S=null;if(y["font-scale"]&&(S=r.parse(y["font-scale"],1,Ve),!S))return null;let I=null;if(y["text-font"]&&(I=r.parse(y["text-font"],1,$(Mt)),!I))return null;let P=null;if(y["text-color"]&&(P=r.parse(y["text-color"],1,ai),!P))return null;const C=u[u.length-1];C.scale=S,C.font=I,C.textColor=P}else{const S=r.parse(e[_],1,Dt);if(!S)return null;const I=S.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,u.push({content:S,scale:null,font:null,textColor:null})}}return new ca(u)}evaluate(e){return new jr(this.sections.map(r=>{const o=r.content.evaluate(e);return Gi(o)===D?new cl("",o,null,null,null):new cl(uo(o),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}}class ml{constructor(e){this.type=D,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const o=r.parse(e[1],1,Mt);return o?new ml(o):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),o=rn.fromString(r);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(r)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}}class gl{constructor(e){this.type=Ve,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=r.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${H(o.type)} instead.`):new gl(o):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Pi(`Expected value to be of type string or array, but found ${H(Gi(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const zs={"==":Xh,"!=":Yh,">":Qh,"<":Jh,">=":td,"<=":ed,array:qr,at:ul,boolean:qr,case:pl,coalesce:sa,collator:ks,format:ca,image:ml,in:hl,"index-of":aa,interpolate:_r,"interpolate-hcl":_r,"interpolate-lab":_r,length:gl,let:oa,literal:jn,match:dl,number:qr,"number-format":fl,object:qr,slice:la,step:yo,string:qr,"to-boolean":wn,"to-color":wn,"to-number":wn,"to-string":wn,var:ia,within:cs};function Xc(i,[e,r,o,u]){e=e.evaluate(i),r=r.evaluate(i),o=o.evaluate(i);const g=u?u.evaluate(i):1,_=Ms(e,r,o,g);if(_)throw new Pi(_);return new ci(e/255,r/255,o/255,g,!1)}function Yc(i,e){return i in e}function _l(i,e){const r=e[i];return r===void 0?null:r}function hs(i){return{type:i}}function Jc(i){return{result:"success",value:i}}function Rs(i){return{result:"error",value:i}}function Ls(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Qc(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function yl(i){return!!i.expression&&i.expression.interpolated}function Jt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function ua(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function id(i){return i}function eu(i,e){const r=e.type==="color",o=i.stops&&typeof i.stops[0][0]=="object",u=o||!(o||i.property!==void 0),g=i.type||(yl(e)?"exponential":"interval");if(r||e.type==="padding"){const P=r?ci.parse:zr.parse;(i=pi({},i)).stops&&(i.stops=i.stops.map(C=>[C[0],P(C[1])])),i.default=P(i.default?i.default:e.default)}if(i.colorSpace&&(_=i.colorSpace)!=="rgb"&&_!=="hcl"&&_!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var _;let y,S,I;if(g==="exponential")y=Wt;else if(g==="interval")y=rd;else if(g==="categorical"){y=$i,S=Object.create(null);for(const P of i.stops)S[P[0]]=P[1];I=typeof i.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);y=xl}if(o){const P={},C=[];for(let B=0;B<i.stops.length;B++){const G=i.stops[B],K=G[0].zoom;P[K]===void 0&&(P[K]={zoom:K,type:i.type,property:i.property,default:i.default,stops:[]},C.push(K)),P[K].stops.push([G[0].value,G[1]])}const z=[];for(const B of C)z.push([P[B].zoom,eu(P[B],e)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:_r.interpolationFactor.bind(void 0,F),zoomStops:z.map(B=>B[0]),evaluate:({zoom:B},G)=>Wt({stops:z,base:i.base},e,B).evaluate(B,G)}}if(u){const P=g==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:_r.interpolationFactor.bind(void 0,P),zoomStops:i.stops.map(C=>C[0]),evaluate:({zoom:C})=>y(i,e,C,S,I)}}return{kind:"source",evaluate(P,C){const z=C&&C.properties?C.properties[i.property]:void 0;return z===void 0?xo(i.default,e.default):y(i,e,z,S,I)}}}function xo(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function $i(i,e,r,o,u){return xo(typeof r===u?o[r]:void 0,i.default,e.default)}function rd(i,e,r){if(Jt(r)!=="number")return xo(i.default,e.default);const o=i.stops.length;if(o===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[o-1][0])return i.stops[o-1][1];const u=_o(i.stops.map(g=>g[0]),r);return i.stops[u][1]}function Wt(i,e,r){const o=i.base!==void 0?i.base:1;if(Jt(r)!=="number")return xo(i.default,e.default);const u=i.stops.length;if(u===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[u-1][0])return i.stops[u-1][1];const g=_o(i.stops.map(P=>P[0]),r),_=function(P,C,z,F){const B=F-z,G=P-z;return B===0?0:C===1?G/B:(Math.pow(C,G)-1)/(Math.pow(C,B)-1)}(r,o,i.stops[g][0],i.stops[g+1][0]),y=i.stops[g][1],S=i.stops[g+1][1],I=Tr[e.type]||id;return typeof y.evaluate=="function"?{evaluate(...P){const C=y.evaluate.apply(void 0,P),z=S.evaluate.apply(void 0,P);if(C!==void 0&&z!==void 0)return I(C,z,_,i.colorSpace)}}:I(y,S,_,i.colorSpace)}function xl(i,e,r){switch(e.type){case"color":r=ci.parse(r);break;case"formatted":r=jr.fromString(r.toString());break;case"resolvedImage":r=rn.fromString(r.toString());break;case"padding":r=zr.parse(r);break;default:Jt(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return xo(r,i.default,e.default)}Gr.register(zs,{error:[{kind:"error"},[Mt],(i,[e])=>{throw new Pi(e.evaluate(i))}],typeof:[Mt,[Dt],(i,[e])=>H(Gi(e.evaluate(i)))],"to-rgba":[$(Ve,4),[ai],(i,[e])=>{const[r,o,u,g]=e.evaluate(i).rgb;return[255*r,255*o,255*u,g]}],rgb:[ai,[Ve,Ve,Ve],Xc],rgba:[ai,[Ve,Ve,Ve,Ve],Xc],has:{type:gt,overloads:[[[Mt],(i,[e])=>Yc(e.evaluate(i),i.properties())],[[Mt,Ur],(i,[e,r])=>Yc(e.evaluate(i),r.evaluate(i))]]},get:{type:Dt,overloads:[[[Mt],(i,[e])=>_l(e.evaluate(i),i.properties())],[[Mt,Ur],(i,[e,r])=>_l(e.evaluate(i),r.evaluate(i))]]},"feature-state":[Dt,[Mt],(i,[e])=>_l(e.evaluate(i),i.featureState||{})],properties:[Ur,[],i=>i.properties()],"geometry-type":[Mt,[],i=>i.geometryType()],id:[Dt,[],i=>i.id()],zoom:[Ve,[],i=>i.globals.zoom],"heatmap-density":[Ve,[],i=>i.globals.heatmapDensity||0],"line-progress":[Ve,[],i=>i.globals.lineProgress||0],accumulated:[Dt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Ve,hs(Ve),(i,e)=>{let r=0;for(const o of e)r+=o.evaluate(i);return r}],"*":[Ve,hs(Ve),(i,e)=>{let r=1;for(const o of e)r*=o.evaluate(i);return r}],"-":{type:Ve,overloads:[[[Ve,Ve],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[Ve],(i,[e])=>-e.evaluate(i)]]},"/":[Ve,[Ve,Ve],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[Ve,[Ve,Ve],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[Ve,[],()=>Math.LN2],pi:[Ve,[],()=>Math.PI],e:[Ve,[],()=>Math.E],"^":[Ve,[Ve,Ve],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[Ve,[Ve],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Ve,[Ve],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Ve,[Ve],(i,[e])=>Math.log(e.evaluate(i))],log2:[Ve,[Ve],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Ve,[Ve],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Ve,[Ve],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Ve,[Ve],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Ve,[Ve],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Ve,[Ve],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Ve,[Ve],(i,[e])=>Math.atan(e.evaluate(i))],min:[Ve,hs(Ve),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[Ve,hs(Ve),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[Ve,[Ve],(i,[e])=>Math.abs(e.evaluate(i))],round:[Ve,[Ve],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[Ve,[Ve],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Ve,[Ve],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[gt,[Mt,Dt],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[gt,[Dt],(i,[e])=>i.id()===e.value],"filter-type-==":[gt,[Mt],(i,[e])=>i.geometryType()===e.value],"filter-<":[gt,[Mt,Dt],(i,[e,r])=>{const o=i.properties()[e.value],u=r.value;return typeof o==typeof u&&o<u}],"filter-id-<":[gt,[Dt],(i,[e])=>{const r=i.id(),o=e.value;return typeof r==typeof o&&r<o}],"filter->":[gt,[Mt,Dt],(i,[e,r])=>{const o=i.properties()[e.value],u=r.value;return typeof o==typeof u&&o>u}],"filter-id->":[gt,[Dt],(i,[e])=>{const r=i.id(),o=e.value;return typeof r==typeof o&&r>o}],"filter-<=":[gt,[Mt,Dt],(i,[e,r])=>{const o=i.properties()[e.value],u=r.value;return typeof o==typeof u&&o<=u}],"filter-id-<=":[gt,[Dt],(i,[e])=>{const r=i.id(),o=e.value;return typeof r==typeof o&&r<=o}],"filter->=":[gt,[Mt,Dt],(i,[e,r])=>{const o=i.properties()[e.value],u=r.value;return typeof o==typeof u&&o>=u}],"filter-id->=":[gt,[Dt],(i,[e])=>{const r=i.id(),o=e.value;return typeof r==typeof o&&r>=o}],"filter-has":[gt,[Dt],(i,[e])=>e.value in i.properties()],"filter-has-id":[gt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[gt,[$(Mt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[gt,[$(Dt)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[gt,[Mt,$(Dt)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[gt,[Mt,$(Dt)],(i,[e,r])=>function(o,u,g,_){for(;g<=_;){const y=g+_>>1;if(u[y]===o)return!0;u[y]>o?_=y-1:g=y+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:gt,overloads:[[[gt,gt],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[hs(gt),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:gt,overloads:[[[gt,gt],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[hs(gt),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[gt,[gt],(i,[e])=>!e.evaluate(i)],"is-supported-script":[gt,[Mt],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[Mt,[Mt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[Mt,[Mt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[Mt,hs(Dt),(i,e)=>e.map(r=>uo(r.evaluate(i))).join("")],"resolved-locale":[Mt,[ls],(i,[e])=>e.evaluate(i).resolvedLocale()]});class xi{constructor(e,r){var o;this.expression=e,this._warningHistory={},this._evaluator=new ui,this._defaultValue=r?(o=r).type==="color"&&ua(o.default)?new ci(0,0,0,0):o.type==="color"?ci.parse(o.default)||null:o.type==="padding"?zr.parse(o.default)||null:o.type==="variableAnchorOffsetCollection"?tn.parse(o.default)||null:o.default===void 0?null:o.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,o,u,g,_){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=o,this._evaluator.canonical=u,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_,this.expression.evaluate(this._evaluator)}evaluate(e,r,o,u,g,_){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=o||null,this._evaluator.canonical=u,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_||null;try{const y=this.expression.evaluate(this._evaluator);if(y==null||typeof y=="number"&&y!=y)return this._defaultValue;if(this._enumValues&&!(y in this._enumValues))throw new Pi(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(y)} instead.`);return y}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}}}function gi(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in zs}function ds(i,e){const r=new Yo(zs,fo,[],e?function(u){const g={color:ai,string:Mt,number:Ve,enum:Mt,boolean:gt,formatted:Yi,padding:X,resolvedImage:D,variableAnchorOffsetCollection:R};return u.type==="array"?$(g[u.value]||Dt,u.length):g[u.type]}(e):void 0),o=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?Jc(new xi(o,e)):Rs(r.errors)}class ha{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!mo(r.expression)}evaluateWithoutErrorHandling(e,r,o,u,g,_){return this._styleExpression.evaluateWithoutErrorHandling(e,r,o,u,g,_)}evaluate(e,r,o,u,g,_){return this._styleExpression.evaluate(e,r,o,u,g,_)}}class vl{constructor(e,r,o,u){this.kind=e,this.zoomStops=o,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!mo(r.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,r,o,u,g,_){return this._styleExpression.evaluateWithoutErrorHandling(e,r,o,u,g,_)}evaluate(e,r,o,u,g,_){return this._styleExpression.evaluate(e,r,o,u,g,_)}interpolationFactor(e,r,o){return this.interpolationType?_r.interpolationFactor(this.interpolationType,e,r,o):0}}function tu(i,e){const r=ds(i,e);if(r.result==="error")return r;const o=r.value.expression,u=ra(o);if(!u&&!Ls(e))return Rs([new Si("","data expressions not supported")]);const g=go(o,["zoom"]);if(!g&&!Qc(e))return Rs([new Si("","zoom expressions not supported")]);const _=pa(o);return _||g?_ instanceof Si?Rs([_]):_ instanceof _r&&!yl(e)?Rs([new Si("",'"interpolate" expressions cannot be used with this property')]):Jc(_?new vl(u?"camera":"composite",r.value,_.labels,_ instanceof _r?_.interpolation:void 0):new ha(u?"constant":"source",r.value)):Rs([new Si("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class da{constructor(e,r){this._parameters=e,this._specification=r,pi(this,eu(this._parameters,this._specification))}static deserialize(e){return new da(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function pa(i){let e=null;if(i instanceof oa)e=pa(i.result);else if(i instanceof sa){for(const r of i.args)if(e=pa(r),e)break}else(i instanceof yo||i instanceof _r)&&i.input instanceof Gr&&i.input.name==="zoom"&&(e=i);return e instanceof Si||i.eachChild(r=>{const o=pa(r);o instanceof Si?e=o:!e&&o?e=new Si("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new Si("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function fa(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!fa(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const iu={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ma(i){if(i==null)return{filter:()=>!0,needGeometry:!1};fa(i)||(i=_a(i));const e=ds(i,iu);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,o,u)=>e.value.evaluate(r,o,{},u),needGeometry:ga(i)}}function ru(i,e){return i<e?-1:i>e?1:0}function ga(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(ga(i[e]))return!0;return!1}function _a(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?bl(i[1],i[2],"=="):e==="!="?ya(bl(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?bl(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(_a))):e==="all"?["all"].concat(i.slice(1).map(_a)):e==="none"?["all"].concat(i.slice(1).map(_a).map(ya)):e==="in"?nu(i[1],i.slice(2)):e==="!in"?ya(nu(i[1],i.slice(2))):e==="has"?su(i[1]):e==="!has"?ya(su(i[1])):e!=="within"||i;var r}function bl(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function nu(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(ru)]]:["filter-in-small",i,["literal",e]]}}function su(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function ya(i){return["!",i]}function wl(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let u="[";for(const g of i)u+=`${wl(g)},`;return`${u}]`}const r=Object.keys(i).sort();let o="{";for(let u=0;u<r.length;u++)o+=`${JSON.stringify(r[u])}:${wl(i[r[u]])},`;return`${o}}`}function nd(i){let e="";for(const r of qe)e+=`/${wl(i[r])}`;return e}function ou(i){const e=i.value;return e?[new Ce(i.key,e,"constants have been deprecated as of v8")]:[]}function zi(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Gn(i){if(Array.isArray(i))return i.map(Gn);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=Gn(i[r]);return e}return zi(i)}function Ar(i){const e=i.key,r=i.value,o=i.valueSpec||{},u=i.objectElementValidators||{},g=i.style,_=i.styleSpec,y=i.validateSpec;let S=[];const I=Jt(r);if(I!=="object")return[new Ce(e,r,`object expected, ${I} found`)];for(const P in r){const C=P.split(".")[0],z=o[C]||o["*"];let F;if(u[C])F=u[C];else if(o[C])F=y;else if(u["*"])F=u["*"];else{if(!o["*"]){S.push(new Ce(e,r[P],`unknown property "${P}"`));continue}F=y}S=S.concat(F({key:(e&&`${e}.`)+P,value:r[P],valueSpec:z,style:g,styleSpec:_,object:r,objectKey:P,validateSpec:y},r))}for(const P in o)u[P]||o[P].required&&o[P].default===void 0&&r[P]===void 0&&S.push(new Ce(e,r,`missing required property "${P}"`));return S}function Sl(i){const e=i.value,r=i.valueSpec,o=i.style,u=i.styleSpec,g=i.key,_=i.arrayElementValidator||i.validateSpec;if(Jt(e)!=="array")return[new Ce(g,e,`array expected, ${Jt(e)} found`)];if(r.length&&e.length!==r.length)return[new Ce(g,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new Ce(g,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let y={type:r.value,values:r.values};u.$version<7&&(y.function=r.function),Jt(r.value)==="object"&&(y=r.value);let S=[];for(let I=0;I<e.length;I++)S=S.concat(_({array:e,arrayIndex:I,value:e[I],valueSpec:y,validateSpec:i.validateSpec,style:o,styleSpec:u,key:`${g}[${I}]`}));return S}function xa(i){const e=i.key,r=i.value,o=i.valueSpec;let u=Jt(r);return u==="number"&&r!=r&&(u="NaN"),u!=="number"?[new Ce(e,r,`number expected, ${u} found`)]:"minimum"in o&&r<o.minimum?[new Ce(e,r,`${r} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&r>o.maximum?[new Ce(e,r,`${r} is greater than the maximum value ${o.maximum}`)]:[]}function au(i){const e=i.valueSpec,r=zi(i.value.type);let o,u,g,_={};const y=r!=="categorical"&&i.value.property===void 0,S=!y,I=Jt(i.value.stops)==="array"&&Jt(i.value.stops[0])==="array"&&Jt(i.value.stops[0][0])==="object",P=Ar({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(F){if(r==="identity")return[new Ce(F.key,F.value,'identity function may not have a "stops" property')];let B=[];const G=F.value;return B=B.concat(Sl({key:F.key,value:G,valueSpec:F.valueSpec,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:C})),Jt(G)==="array"&&G.length===0&&B.push(new Ce(F.key,G,"array must have at least one stop")),B},default:function(F){return F.validateSpec({key:F.key,value:F.value,valueSpec:e,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec})}}});return r==="identity"&&y&&P.push(new Ce(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||P.push(new Ce(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!yl(i.valueSpec)&&P.push(new Ce(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(S&&!Ls(i.valueSpec)?P.push(new Ce(i.key,i.value,"property functions not supported")):y&&!Qc(i.valueSpec)&&P.push(new Ce(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!I||i.value.property!==void 0||P.push(new Ce(i.key,i.value,'"property" property is required')),P;function C(F){let B=[];const G=F.value,K=F.key;if(Jt(G)!=="array")return[new Ce(K,G,`array expected, ${Jt(G)} found`)];if(G.length!==2)return[new Ce(K,G,`array length 2 expected, length ${G.length} found`)];if(I){if(Jt(G[0])!=="object")return[new Ce(K,G,`object expected, ${Jt(G[0])} found`)];if(G[0].zoom===void 0)return[new Ce(K,G,"object stop key must have zoom")];if(G[0].value===void 0)return[new Ce(K,G,"object stop key must have value")];if(g&&g>zi(G[0].zoom))return[new Ce(K,G[0].zoom,"stop zoom values must appear in ascending order")];zi(G[0].zoom)!==g&&(g=zi(G[0].zoom),u=void 0,_={}),B=B.concat(Ar({key:`${K}[0]`,value:G[0],valueSpec:{zoom:{}},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:xa,value:z}}))}else B=B.concat(z({key:`${K}[0]`,value:G[0],valueSpec:{},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec},G));return gi(Gn(G[1]))?B.concat([new Ce(`${K}[1]`,G[1],"expressions are not allowed in function stops.")]):B.concat(F.validateSpec({key:`${K}[1]`,value:G[1],valueSpec:e,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec}))}function z(F,B){const G=Jt(F.value),K=zi(F.value),te=F.value!==null?F.value:B;if(o){if(G!==o)return[new Ce(F.key,te,`${G} stop domain type must match previous stop domain type ${o}`)]}else o=G;if(G!=="number"&&G!=="string"&&G!=="boolean")return[new Ce(F.key,te,"stop domain value must be a number, string, or boolean")];if(G!=="number"&&r!=="categorical"){let he=`number expected, ${G} found`;return Ls(e)&&r===void 0&&(he+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ce(F.key,te,he)]}return r!=="categorical"||G!=="number"||isFinite(K)&&Math.floor(K)===K?r!=="categorical"&&G==="number"&&u!==void 0&&K<u?[new Ce(F.key,te,"stop domain values must appear in ascending order")]:(u=K,r==="categorical"&&K in _?[new Ce(F.key,te,"stop domain values must be unique")]:(_[K]=!0,[])):[new Ce(F.key,te,`integer expected, found ${K}`)]}}function Hn(i){const e=(i.expressionContext==="property"?tu:ds)(Gn(i.value),i.valueSpec);if(e.result==="error")return e.value.map(o=>new Ce(`${i.key}${o.key}`,i.value,o.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new Ce(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!mo(r))return[new Ce(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!mo(r))return[new Ce(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!go(r,["zoom","feature-state"]))return[new Ce(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!ra(r))return[new Ce(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Zn(i){const e=i.key,r=i.value,o=i.valueSpec,u=[];return Array.isArray(o.values)?o.values.indexOf(zi(r))===-1&&u.push(new Ce(e,r,`expected one of [${o.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(o.values).indexOf(zi(r))===-1&&u.push(new Ce(e,r,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(r)} found`)),u}function Fs(i){return fa(Gn(i.value))?Hn(pi({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Tl(i)}function Tl(i){const e=i.value,r=i.key;if(Jt(e)!=="array")return[new Ce(r,e,`array expected, ${Jt(e)} found`)];const o=i.styleSpec;let u,g=[];if(e.length<1)return[new Ce(r,e,"filter array must have at least 1 element")];switch(g=g.concat(Zn({key:`${r}[0]`,value:e[0],valueSpec:o.filter_operator,style:i.style,styleSpec:i.styleSpec})),zi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&zi(e[1])==="$type"&&g.push(new Ce(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&g.push(new Ce(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=Jt(e[1]),u!=="string"&&g.push(new Ce(`${r}[1]`,e[1],`string expected, ${u} found`)));for(let _=2;_<e.length;_++)u=Jt(e[_]),zi(e[1])==="$type"?g=g.concat(Zn({key:`${r}[${_}]`,value:e[_],valueSpec:o.geometry_type,style:i.style,styleSpec:i.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&g.push(new Ce(`${r}[${_}]`,e[_],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let _=1;_<e.length;_++)g=g.concat(Tl({key:`${r}[${_}]`,value:e[_],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":u=Jt(e[1]),e.length!==2?g.push(new Ce(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="string"&&g.push(new Ce(`${r}[1]`,e[1],`string expected, ${u} found`));break;case"within":u=Jt(e[1]),e.length!==2?g.push(new Ce(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="object"&&g.push(new Ce(`${r}[1]`,e[1],`object expected, ${u} found`))}return g}function va(i,e){const r=i.key,o=i.validateSpec,u=i.style,g=i.styleSpec,_=i.value,y=i.objectKey,S=g[`${e}_${i.layerType}`];if(!S)return[];const I=y.match(/^(.*)-transition$/);if(e==="paint"&&I&&S[I[1]]&&S[I[1]].transition)return o({key:r,value:_,valueSpec:g.transition,style:u,styleSpec:g});const P=i.valueSpec||S[y];if(!P)return[new Ce(r,_,`unknown property "${y}"`)];let C;if(Jt(_)==="string"&&Ls(P)&&!P.tokens&&(C=/^{([^}]+)}$/.exec(_)))return[new Ce(r,_,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(C[1])} }\`.`)];const z=[];return i.layerType==="symbol"&&(y==="text-field"&&u&&!u.glyphs&&z.push(new Ce(r,_,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&ua(Gn(_))&&zi(_.type)==="identity"&&z.push(new Ce(r,_,'"text-font" does not support identity functions'))),z.concat(o({key:i.key,value:_,valueSpec:P,style:u,styleSpec:g,expressionContext:"property",propertyType:e,propertyKey:y}))}function Al(i){return va(i,"paint")}function Il(i){return va(i,"layout")}function vo(i){let e=[];const r=i.value,o=i.key,u=i.style,g=i.styleSpec;r.type||r.ref||e.push(new Ce(o,r,'either "type" or "ref" is required'));let _=zi(r.type);const y=zi(r.ref);if(r.id){const S=zi(r.id);for(let I=0;I<i.arrayIndex;I++){const P=u.layers[I];zi(P.id)===S&&e.push(new Ce(o,r.id,`duplicate layer id "${r.id}", previously used at line ${P.id.__line__}`))}}if("ref"in r){let S;["type","source","source-layer","filter","layout"].forEach(I=>{I in r&&e.push(new Ce(o,r[I],`"${I}" is prohibited for ref layers`))}),u.layers.forEach(I=>{zi(I.id)===y&&(S=I)}),S?S.ref?e.push(new Ce(o,r.ref,"ref cannot reference another ref layer")):_=zi(S.type):e.push(new Ce(o,r.ref,`ref layer "${y}" not found`))}else if(_!=="background")if(r.source){const S=u.sources&&u.sources[r.source],I=S&&zi(S.type);S?I==="vector"&&_==="raster"?e.push(new Ce(o,r.source,`layer "${r.id}" requires a raster source`)):I!=="raster-dem"&&_==="hillshade"?e.push(new Ce(o,r.source,`layer "${r.id}" requires a raster-dem source`)):I==="raster"&&_!=="raster"?e.push(new Ce(o,r.source,`layer "${r.id}" requires a vector source`)):I!=="vector"||r["source-layer"]?I==="raster-dem"&&_!=="hillshade"?e.push(new Ce(o,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):_!=="line"||!r.paint||!r.paint["line-gradient"]||I==="geojson"&&S.lineMetrics||e.push(new Ce(o,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Ce(o,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Ce(o,r.source,`source "${r.source}" not found`))}else e.push(new Ce(o,r,'missing required property "source"'));return e=e.concat(Ar({key:o,value:r,valueSpec:g.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${o}.type`,value:r.type,valueSpec:g.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:Fs,layout:S=>Ar({layer:r,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":I=>Il(pi({layerType:_},I))}}),paint:S=>Ar({layer:r,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":I=>Al(pi({layerType:_},I))}})}})),e}function ps(i){const e=i.value,r=i.key,o=Jt(e);return o!=="string"?[new Ce(r,e,`string expected, ${o} found`)]:[]}const lu={promoteId:function({key:i,value:e}){if(Jt(e)==="string")return ps({key:i,value:e});{const r=[];for(const o in e)r.push(...ps({key:`${i}.${o}`,value:e[o]}));return r}}};function cu(i){const e=i.value,r=i.key,o=i.styleSpec,u=i.style,g=i.validateSpec;if(!e.type)return[new Ce(r,e,'"type" is required')];const _=zi(e.type);let y;switch(_){case"vector":case"raster":return y=Ar({key:r,value:e,valueSpec:o[`source_${_.replace("-","_")}`],style:i.style,styleSpec:o,objectElementValidators:lu,validateSpec:g}),y;case"raster-dem":return y=function(S){var I;const P=(I=S.sourceName)!==null&&I!==void 0?I:"",C=S.value,z=S.styleSpec,F=z.source_raster_dem,B=S.style;let G=[];const K=Jt(C);if(C===void 0)return G;if(K!=="object")return G.push(new Ce("source_raster_dem",C,`object expected, ${K} found`)),G;const te=zi(C.encoding)==="custom",he=["redFactor","greenFactor","blueFactor","baseShift"],re=S.value.encoding?`"${S.value.encoding}"`:"Default";for(const le in C)!te&&he.includes(le)?G.push(new Ce(le,C[le],`In "${P}": "${le}" is only valid when "encoding" is set to "custom". ${re} encoding found`)):F[le]?G=G.concat(S.validateSpec({key:le,value:C[le],valueSpec:F[le],validateSpec:S.validateSpec,style:B,styleSpec:z})):G.push(new Ce(le,C[le],`unknown property "${le}"`));return G}({sourceName:r,value:e,style:i.style,styleSpec:o,validateSpec:g}),y;case"geojson":if(y=Ar({key:r,value:e,valueSpec:o.source_geojson,style:u,styleSpec:o,validateSpec:g,objectElementValidators:lu}),e.cluster)for(const S in e.clusterProperties){const[I,P]=e.clusterProperties[S],C=typeof I=="string"?[I,["accumulated"],["get",S]]:I;y.push(...Hn({key:`${r}.${S}.map`,value:P,validateSpec:g,expressionContext:"cluster-map"})),y.push(...Hn({key:`${r}.${S}.reduce`,value:C,validateSpec:g,expressionContext:"cluster-reduce"}))}return y;case"video":return Ar({key:r,value:e,valueSpec:o.source_video,style:u,validateSpec:g,styleSpec:o});case"image":return Ar({key:r,value:e,valueSpec:o.source_image,style:u,validateSpec:g,styleSpec:o});case"canvas":return[new Ce(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Zn({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:u,validateSpec:g,styleSpec:o})}}function uu(i){const e=i.value,r=i.styleSpec,o=r.light,u=i.style;let g=[];const _=Jt(e);if(e===void 0)return g;if(_!=="object")return g=g.concat([new Ce("light",e,`object expected, ${_} found`)]),g;for(const y in e){const S=y.match(/^(.*)-transition$/);g=g.concat(S&&o[S[1]]&&o[S[1]].transition?i.validateSpec({key:y,value:e[y],valueSpec:r.transition,validateSpec:i.validateSpec,style:u,styleSpec:r}):o[y]?i.validateSpec({key:y,value:e[y],valueSpec:o[y],validateSpec:i.validateSpec,style:u,styleSpec:r}):[new Ce(y,e[y],`unknown property "${y}"`)])}return g}function hu(i){const e=i.value,r=i.styleSpec,o=r.sky,u=i.style,g=Jt(e);if(e===void 0)return[];if(g!=="object")return[new Ce("sky",e,`object expected, ${g} found`)];let _=[];for(const y in e)_=_.concat(o[y]?Sn({key:y,value:e[y],valueSpec:o[y],style:u,styleSpec:r}):[new Ce(y,e[y],`unknown property "${y}"`)]);return _}function bo(i){const e=i.value,r=i.styleSpec,o=r.terrain,u=i.style;let g=[];const _=Jt(e);if(e===void 0)return g;if(_!=="object")return g=g.concat([new Ce("terrain",e,`object expected, ${_} found`)]),g;for(const y in e)g=g.concat(o[y]?i.validateSpec({key:y,value:e[y],valueSpec:o[y],validateSpec:i.validateSpec,style:u,styleSpec:r}):[new Ce(y,e[y],`unknown property "${y}"`)]);return g}function wo(i){let e=[];const r=i.value,o=i.key;if(Array.isArray(r)){const u=[],g=[];for(const _ in r)r[_].id&&u.includes(r[_].id)&&e.push(new Ce(o,r,`all the sprites' ids must be unique, but ${r[_].id} is duplicated`)),u.push(r[_].id),r[_].url&&g.includes(r[_].url)&&e.push(new Ce(o,r,`all the sprites' URLs must be unique, but ${r[_].url} is duplicated`)),g.push(r[_].url),e=e.concat(Ar({key:`${o}[${_}]`,value:r[_],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return ps({key:o,value:r})}const Rr={"*":()=>[],array:Sl,boolean:function(i){const e=i.value,r=i.key,o=Jt(e);return o!=="boolean"?[new Ce(r,e,`boolean expected, ${o} found`)]:[]},number:xa,color:function(i){const e=i.key,r=i.value,o=Jt(r);return o!=="string"?[new Ce(e,r,`color expected, ${o} found`)]:ci.parse(String(r))?[]:[new Ce(e,r,`color expected, "${r}" found`)]},constants:ou,enum:Zn,filter:Fs,function:au,layer:vo,object:Ar,source:cu,light:uu,sky:hu,terrain:bo,string:ps,formatted:function(i){return ps(i).length===0?[]:Hn(i)},resolvedImage:function(i){return ps(i).length===0?[]:Hn(i)},padding:function(i){const e=i.key,r=i.value;if(Jt(r)==="array"){if(r.length<1||r.length>4)return[new Ce(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const o={type:"number"};let u=[];for(let g=0;g<r.length;g++)u=u.concat(i.validateSpec({key:`${e}[${g}]`,value:r[g],validateSpec:i.validateSpec,valueSpec:o}));return u}return xa({key:e,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const e=i.key,r=i.value,o=Jt(r),u=i.styleSpec;if(o!=="array"||r.length<1||r.length%2!=0)return[new Ce(e,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let g=[];for(let _=0;_<r.length;_+=2)g=g.concat(Zn({key:`${e}[${_}]`,value:r[_],valueSpec:u.layout_symbol["text-anchor"]})),g=g.concat(Sl({key:`${e}[${_+1}]`,value:r[_+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:u}));return g},sprite:wo};function Sn(i){const e=i.value,r=i.valueSpec,o=i.styleSpec;return i.validateSpec=Sn,r.expression&&ua(zi(e))?au(i):r.expression&&gi(Gn(e))?Hn(i):r.type&&Rr[r.type]?Rr[r.type](i):Ar(pi({},i,{valueSpec:r.type?o[r.type]:r}))}function El(i){const e=i.value,r=i.key,o=ps(i);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new Ce(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new Ce(r,e,'"glyphs" url must include a "{range}" token'))),o}function dn(i,e=ee){let r=[];return r=r.concat(Sn({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:Sn,objectElementValidators:{glyphs:El,"*":()=>[]}})),i.constants&&(r=r.concat(ou({key:"constants",value:i.constants,style:i,styleSpec:e,validateSpec:Sn}))),Os(r)}function Tn(i){return function(e){return i({...e,validateSpec:Sn})}}function Os(i){return[].concat(i).sort((e,r)=>e.line-r.line)}function pn(i){return function(...e){return Os(i.apply(this,e))}}dn.source=pn(Tn(cu)),dn.sprite=pn(Tn(wo)),dn.glyphs=pn(Tn(El)),dn.light=pn(Tn(uu)),dn.sky=pn(Tn(hu)),dn.terrain=pn(Tn(bo)),dn.layer=pn(Tn(vo)),dn.filter=pn(Tn(Fs)),dn.paintProperty=pn(Tn(Al)),dn.layoutProperty=pn(Tn(Il));const fs=dn,sd=fs.light,Pl=fs.paintProperty,od=fs.layoutProperty;function Bs(i,e){let r=!1;if(e&&e.length)for(const o of e)i.fire(new ve(new Error(o.message))),r=!0;return r}class So{constructor(e,r,o){const u=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const _=new Int32Array(this.arrayBuffer);e=_[0],this.d=(r=_[1])+2*(o=_[2]);for(let S=0;S<this.d*this.d;S++){const I=_[3+S],P=_[3+S+1];u.push(I===P?null:_.subarray(I,P))}const y=_[3+u.length+1];this.keys=_.subarray(_[3+u.length],y),this.bboxes=_.subarray(y),this.insert=this._insertReadonly}else{this.d=r+2*o;for(let _=0;_<this.d*this.d;_++)u.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=o,this.scale=r/e,this.uid=0;const g=o/r*e;this.min=-g,this.max=e+g}insert(e,r,o,u,g){this._forEachCell(r,o,u,g,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(g)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,o,u,g,_){this.cells[g].push(_)}query(e,r,o,u,g){const _=this.min,y=this.max;if(e<=_&&r<=_&&y<=o&&y<=u&&!g)return Array.prototype.slice.call(this.keys);{const S=[];return this._forEachCell(e,r,o,u,this._queryCell,S,{},g),S}}_queryCell(e,r,o,u,g,_,y,S){const I=this.cells[g];if(I!==null){const P=this.keys,C=this.bboxes;for(let z=0;z<I.length;z++){const F=I[z];if(y[F]===void 0){const B=4*F;(S?S(C[B+0],C[B+1],C[B+2],C[B+3]):e<=C[B+2]&&r<=C[B+3]&&o>=C[B+0]&&u>=C[B+1])?(y[F]=!0,_.push(P[F])):y[F]=!1}}}}_forEachCell(e,r,o,u,g,_,y,S){const I=this._convertToCellCoord(e),P=this._convertToCellCoord(r),C=this._convertToCellCoord(o),z=this._convertToCellCoord(u);for(let F=I;F<=C;F++)for(let B=P;B<=z;B++){const G=this.d*B+F;if((!S||S(this._convertFromCellCoord(F),this._convertFromCellCoord(B),this._convertFromCellCoord(F+1),this._convertFromCellCoord(B+1)))&&g.call(this,e,r,o,u,G,_,y,S))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let o=0;for(let _=0;_<this.cells.length;_++)o+=this.cells[_].length;const u=new Int32Array(r+o+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;let g=r;for(let _=0;_<e.length;_++){const y=e[_];u[3+_]=g,u.set(y,g),g+=y.length}return u[3+e.length]=g,u.set(this.keys,g),g+=this.keys.length,u[3+e.length+1]=g,u.set(this.bboxes,g),g+=this.bboxes.length,u.buffer}static serialize(e,r){const o=e.toArrayBuffer();return r&&r.push(o),{buffer:o}}static deserialize(e){return new So(e.buffer)}}const An={};function it(i,e,r={}){if(An[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),An[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}it("Object",Object),it("TransferableGridIndex",So),it("Color",ci),it("Error",Error),it("AJAXError",tt),it("ResolvedImage",rn),it("StylePropertyFunction",da),it("StyleExpression",xi,{omit:["_evaluator"]}),it("ZoomDependentExpression",vl),it("ZoomConstantExpression",ha),it("CompoundExpression",Gr,{omit:["_evaluate"]});for(const i in zs)zs[i]._classRegistryKey||it(`Expression_${i}`,zs[i]);function ba(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Ns(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error)return i;if(ba(i)||Xt(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const o of i)r.push(Ns(o,e));return r}if(typeof i=="object"){const r=i.constructor,o=r._classRegistryKey;if(!o)throw new Error(`can't serialize object of unregistered class ${r.name}`);if(!An[o])throw new Error(`${o} is not registered.`);const u=r.serialize?r.serialize(i,e):{};if(r.serialize){if(e&&u===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const g in i){if(!i.hasOwnProperty(g)||An[o].omit.indexOf(g)>=0)continue;const _=i[g];u[g]=An[o].shallow.indexOf(g)>=0?_:Ns(_,e)}i instanceof Error&&(u.message=i.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(u.$name=o),u}throw new Error("can't serialize object of type "+typeof i)}function Vs(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||ba(i)||Xt(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(Vs);if(typeof i=="object"){const e=i.$name||"Object";if(!An[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=An[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const o=Object.create(r.prototype);for(const u of Object.keys(i)){if(u==="$name")continue;const g=i[u];o[u]=An[e].shallow.indexOf(u)>=0?g:Vs(g)}return o}throw new Error("can't deserialize object of type "+typeof i)}class du{constructor(){this.first=!0}update(e,r){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}const Ke={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function $s(i){for(const e of i)if(wa(e.charCodeAt(0)))return!0;return!1}function pu(i){for(const e of i)if(!fu(e.charCodeAt(0)))return!1;return!0}function fu(i){return!(Ke.Arabic(i)||Ke["Arabic Supplement"](i)||Ke["Arabic Extended-A"](i)||Ke["Arabic Presentation Forms-A"](i)||Ke["Arabic Presentation Forms-B"](i))}function wa(i){return!(i!==746&&i!==747&&(i<4352||!(Ke["Bopomofo Extended"](i)||Ke.Bopomofo(i)||Ke["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Ke["CJK Compatibility Ideographs"](i)||Ke["CJK Compatibility"](i)||Ke["CJK Radicals Supplement"](i)||Ke["CJK Strokes"](i)||!(!Ke["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Ke["CJK Unified Ideographs Extension A"](i)||Ke["CJK Unified Ideographs"](i)||Ke["Enclosed CJK Letters and Months"](i)||Ke["Hangul Compatibility Jamo"](i)||Ke["Hangul Jamo Extended-A"](i)||Ke["Hangul Jamo Extended-B"](i)||Ke["Hangul Jamo"](i)||Ke["Hangul Syllables"](i)||Ke.Hiragana(i)||Ke["Ideographic Description Characters"](i)||Ke.Kanbun(i)||Ke["Kangxi Radicals"](i)||Ke["Katakana Phonetic Extensions"](i)||Ke.Katakana(i)&&i!==12540||!(!Ke["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Ke["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Ke["Unified Canadian Aboriginal Syllabics"](i)||Ke["Unified Canadian Aboriginal Syllabics Extended"](i)||Ke["Vertical Forms"](i)||Ke["Yijing Hexagram Symbols"](i)||Ke["Yi Syllables"](i)||Ke["Yi Radicals"](i))))}function Cl(i){return!(wa(i)||function(e){return!!(Ke["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Ke["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Ke["Letterlike Symbols"](e)||Ke["Number Forms"](e)||Ke["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Ke["Control Pictures"](e)&&e!==9251||Ke["Optical Character Recognition"](e)||Ke["Enclosed Alphanumerics"](e)||Ke["Geometric Shapes"](e)||Ke["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Ke["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ke["CJK Symbols and Punctuation"](e)||Ke.Katakana(e)||Ke["Private Use Area"](e)||Ke["CJK Compatibility Forms"](e)||Ke["Small Form Variants"](e)||Ke["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function Sa(i){return i>=1424&&i<=2303||Ke["Arabic Presentation Forms-A"](i)||Ke["Arabic Presentation Forms-B"](i)}function mu(i,e){return!(!e&&Sa(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Ke.Khmer(i))}function ad(i){for(const e of i)if(Sa(e.charCodeAt(0)))return!0;return!1}const Wn=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Ai{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new du,this.transition={})}isSupportedScript(e){return function(r,o){for(const u of r)if(!mu(u.charCodeAt(0),o))return!1;return!0}(e,Wn.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*r}}}class To{constructor(e,r){this.property=e,this.value=r,this.expression=function(o,u){if(ua(o))return new da(o,u);if(gi(o)){const g=tu(o,u);if(g.result==="error")throw new Error(g.value.map(_=>`${_.key}: ${_.message}`).join(", "));return g.value}{let g=o;return u.type==="color"&&typeof o=="string"?g=ci.parse(o):u.type!=="padding"||typeof o!="number"&&!Array.isArray(o)?u.type==="variableAnchorOffsetCollection"&&Array.isArray(o)&&(g=tn.parse(o)):g=zr.parse(o),{kind:"constant",evaluate:()=>g}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,o){return this.property.possiblyEvaluate(this,e,r,o)}}class Ta{constructor(e){this.property=e,this.value=new To(e,void 0)}transitioned(e,r){return new gu(this.property,this.value,r,xt({},e.transition,this.transition),e.now)}untransitioned(){return new gu(this.property,this.value,null,{},0)}}class Ml{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return vt(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Ta(this._values[e].property)),this._values[e].value=new To(this._values[e].property,r===null?void 0:vt(r))}getTransition(e){return vt(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Ta(this._values[e].property)),this._values[e].transition=vt(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(e[r]=o);const u=this.getTransition(r);u!==void 0&&(e[`${r}-transition`]=u)}return e}transitioned(e,r){const o=new _u(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].transitioned(e,r._values[u]);return o}untransitioned(){const e=new _u(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class gu{constructor(e,r,o,u,g){this.property=e,this.value=r,this.begin=g+u.delay||0,this.end=this.begin+u.duration||0,e.specification.transition&&(u.delay||u.duration)&&(this.prior=o)}possiblyEvaluate(e,r,o){const u=e.now||0,g=this.value.possiblyEvaluate(e,r,o),_=this.prior;if(_){if(u>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(u<this.begin)return _.possiblyEvaluate(e,r,o);{const y=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(e,r,o),g,function(S){if(S<=0)return 0;if(S>=1)return 1;const I=S*S,P=I*S;return 4*(S<.5?P:3*(S-I)+P-.75)}(y))}}return g}}class _u{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,o){const u=new Ao(this._properties);for(const g of Object.keys(this._values))u._values[g]=this._values[g].possiblyEvaluate(e,r,o);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class yu{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return vt(this._values[e].value)}setValue(e,r){this._values[e]=new To(this._values[e].property,r===null?void 0:vt(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(e[r]=o)}return e}possiblyEvaluate(e,r,o){const u=new Ao(this._properties);for(const g of Object.keys(this._values))u._values[g]=this._values[g].possiblyEvaluate(e,r,o);return u}}class fn{constructor(e,r,o){this.property=e,this.value=r,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,o,u){return this.property.evaluate(this.value,this.parameters,e,r,o,u)}}class Ao{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ut{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,o){const u=Tr[this.specification.type];return u?u(e,r,o):e}}class yt{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,o,u){return new fn(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},o,u)}:e.expression,r)}interpolate(e,r,o){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new fn(this,{kind:"constant",value:void 0},e.parameters);const u=Tr[this.specification.type];if(u){const g=u(e.value.value,r.value.value,o);return new fn(this,{kind:"constant",value:g},e.parameters)}return e}evaluate(e,r,o,u,g,_){return e.kind==="constant"?e.value:e.evaluate(r,o,u,g,_)}}class Aa extends yt{possiblyEvaluate(e,r,o,u){if(e.value===void 0)return new fn(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const g=e.expression.evaluate(r,null,{},o,u),_=e.property.specification.type==="resolvedImage"&&typeof g!="string"?g.name:g,y=this._calculate(_,_,_,r);return new fn(this,{kind:"constant",value:y},r)}if(e.expression.kind==="camera"){const g=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new fn(this,{kind:"constant",value:g},r)}return new fn(this,e.expression,r)}evaluate(e,r,o,u,g,_){if(e.kind==="source"){const y=e.evaluate(r,o,u,g,_);return this._calculate(y,y,y,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},o,u),e.evaluate({zoom:Math.floor(r.zoom)},o,u),e.evaluate({zoom:Math.floor(r.zoom)+1},o,u),r):e.value}_calculate(e,r,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:o,to:r}}interpolate(e){return e}}class Io{constructor(e){this.specification=e}possiblyEvaluate(e,r,o,u){if(e.value!==void 0){if(e.expression.kind==="constant"){const g=e.expression.evaluate(r,null,{},o,u);return this._calculate(g,g,g,r)}return this._calculate(e.expression.evaluate(new Ai(Math.floor(r.zoom-1),r)),e.expression.evaluate(new Ai(Math.floor(r.zoom),r)),e.expression.evaluate(new Ai(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:o,to:r}}interpolate(e){return e}}class kl{constructor(e){this.specification=e}possiblyEvaluate(e,r,o,u){return!!e.expression.evaluate(r,null,{},o,u)}interpolate(){return!1}}class Lr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const o=e[r];o.specification.overridable&&this.overridableProperties.push(r);const u=this.defaultPropertyValues[r]=new To(o,void 0),g=this.defaultTransitionablePropertyValues[r]=new Ta(o);this.defaultTransitioningPropertyValues[r]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=u.possiblyEvaluate({})}}}it("DataDrivenProperty",yt),it("DataConstantProperty",ut),it("CrossFadedDataDrivenProperty",Aa),it("CrossFadedProperty",Io),it("ColorRampProperty",kl);const Dl="-transition";class mn extends De{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new yu(r.layout)),r.paint)){this._transitionablePaint=new Ml(r.paint);for(const o in e.paint)this.setPaintProperty(o,e.paint[o],{validate:!1});for(const o in e.layout)this.setLayoutProperty(o,e.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ao(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,o={}){r!=null&&this._validate(od,`layers.${this.id}.layout.${e}`,e,r,o)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith(Dl)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,o={}){if(r!=null&&this._validate(Pl,`layers.${this.id}.paint.${e}`,e,r,o))return!1;if(e.endsWith(Dl))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const u=this._transitionablePaint._values[e],g=u.property.specification["property-type"]==="cross-faded-data-driven",_=u.value.isDataDriven(),y=u.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const S=this._transitionablePaint._values[e].value;return S.isDataDriven()||_||g||this._handleOverridablePaintPropertyUpdate(e,y,S)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),kt(e,(r,o)=>!(r===void 0||o==="layout"&&!Object.keys(r).length||o==="paint"&&!Object.keys(r).length))}_validate(e,r,o,u,g={}){return(!g||g.validate!==!1)&&Bs(this,e.call(fs,{key:r,layerType:this.type,objectKey:o,value:u,styleSpec:ee,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof fn&&Ls(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const xu={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Eo{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ri{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ui(i,e=1){let r=0,o=0;return{members:i.map(u=>{const g=xu[u.type].BYTES_PER_ELEMENT,_=r=vu(r,Math.max(e,g)),y=u.components||1;return o=Math.max(o,g),r+=g*y,{name:u.name,type:u.type,components:y,offset:_}}),size:vu(r,Math.max(o,e)),alignment:e}}function vu(i,e){return Math.ceil(i/e)*e}class Po extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){const u=2*e;return this.int16[u+0]=r,this.int16[u+1]=o,e}}Po.prototype.bytesPerElement=4,it("StructArrayLayout2i4",Po);class Dn extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,o)}emplace(e,r,o,u){const g=3*e;return this.int16[g+0]=r,this.int16[g+1]=o,this.int16[g+2]=u,e}}Dn.prototype.bytesPerElement=6,it("StructArrayLayout3i6",Dn);class zl extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,u){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,o,u)}emplace(e,r,o,u,g){const _=4*e;return this.int16[_+0]=r,this.int16[_+1]=o,this.int16[_+2]=u,this.int16[_+3]=g,e}}zl.prototype.bytesPerElement=8,it("StructArrayLayout4i8",zl);class Rl extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,u,g,_){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,o,u,g,_)}emplace(e,r,o,u,g,_,y){const S=6*e;return this.int16[S+0]=r,this.int16[S+1]=o,this.int16[S+2]=u,this.int16[S+3]=g,this.int16[S+4]=_,this.int16[S+5]=y,e}}Rl.prototype.bytesPerElement=12,it("StructArrayLayout2i4i12",Rl);class Ll extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,u,g,_){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,o,u,g,_)}emplace(e,r,o,u,g,_,y){const S=4*e,I=8*e;return this.int16[S+0]=r,this.int16[S+1]=o,this.uint8[I+4]=u,this.uint8[I+5]=g,this.uint8[I+6]=_,this.uint8[I+7]=y,e}}Ll.prototype.bytesPerElement=8,it("StructArrayLayout2i4ub8",Ll);class Co extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){const u=2*e;return this.float32[u+0]=r,this.float32[u+1]=o,e}}Co.prototype.bytesPerElement=8,it("StructArrayLayout2f8",Co);class Ia extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,u,g,_,y,S,I,P){const C=this.length;return this.resize(C+1),this.emplace(C,e,r,o,u,g,_,y,S,I,P)}emplace(e,r,o,u,g,_,y,S,I,P,C){const z=10*e;return this.uint16[z+0]=r,this.uint16[z+1]=o,this.uint16[z+2]=u,this.uint16[z+3]=g,this.uint16[z+4]=_,this.uint16[z+5]=y,this.uint16[z+6]=S,this.uint16[z+7]=I,this.uint16[z+8]=P,this.uint16[z+9]=C,e}}Ia.prototype.bytesPerElement=20,it("StructArrayLayout10ui20",Ia);class Fl extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,u,g,_,y,S,I,P,C,z){const F=this.length;return this.resize(F+1),this.emplace(F,e,r,o,u,g,_,y,S,I,P,C,z)}emplace(e,r,o,u,g,_,y,S,I,P,C,z,F){const B=12*e;return this.int16[B+0]=r,this.int16[B+1]=o,this.int16[B+2]=u,this.int16[B+3]=g,this.uint16[B+4]=_,this.uint16[B+5]=y,this.uint16[B+6]=S,this.uint16[B+7]=I,this.int16[B+8]=P,this.int16[B+9]=C,this.int16[B+10]=z,this.int16[B+11]=F,e}}Fl.prototype.bytesPerElement=24,it("StructArrayLayout4i4ui4i24",Fl);class Ol extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,o)}emplace(e,r,o,u){const g=3*e;return this.float32[g+0]=r,this.float32[g+1]=o,this.float32[g+2]=u,e}}Ol.prototype.bytesPerElement=12,it("StructArrayLayout3f12",Ol);class zn extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}zn.prototype.bytesPerElement=4,it("StructArrayLayout1ul4",zn);class Ea extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,u,g,_,y,S,I){const P=this.length;return this.resize(P+1),this.emplace(P,e,r,o,u,g,_,y,S,I)}emplace(e,r,o,u,g,_,y,S,I,P){const C=10*e,z=5*e;return this.int16[C+0]=r,this.int16[C+1]=o,this.int16[C+2]=u,this.int16[C+3]=g,this.int16[C+4]=_,this.int16[C+5]=y,this.uint32[z+3]=S,this.uint16[C+8]=I,this.uint16[C+9]=P,e}}Ea.prototype.bytesPerElement=20,it("StructArrayLayout6i1ul2ui20",Ea);class Mo extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,u,g,_){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,o,u,g,_)}emplace(e,r,o,u,g,_,y){const S=6*e;return this.int16[S+0]=r,this.int16[S+1]=o,this.int16[S+2]=u,this.int16[S+3]=g,this.int16[S+4]=_,this.int16[S+5]=y,e}}Mo.prototype.bytesPerElement=12,it("StructArrayLayout2i2i2i12",Mo);class Pa extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,u,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,o,u,g)}emplace(e,r,o,u,g,_){const y=4*e,S=8*e;return this.float32[y+0]=r,this.float32[y+1]=o,this.float32[y+2]=u,this.int16[S+6]=g,this.int16[S+7]=_,e}}Pa.prototype.bytesPerElement=16,it("StructArrayLayout2f1f2i16",Pa);class ko extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,u){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,o,u)}emplace(e,r,o,u,g){const _=12*e,y=3*e;return this.uint8[_+0]=r,this.uint8[_+1]=o,this.float32[y+1]=u,this.float32[y+2]=g,e}}ko.prototype.bytesPerElement=12,it("StructArrayLayout2ub2f12",ko);class Ca extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,o)}emplace(e,r,o,u){const g=3*e;return this.uint16[g+0]=r,this.uint16[g+1]=o,this.uint16[g+2]=u,e}}Ca.prototype.bytesPerElement=6,it("StructArrayLayout3ui6",Ca);class Us extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,u,g,_,y,S,I,P,C,z,F,B,G,K,te){const he=this.length;return this.resize(he+1),this.emplace(he,e,r,o,u,g,_,y,S,I,P,C,z,F,B,G,K,te)}emplace(e,r,o,u,g,_,y,S,I,P,C,z,F,B,G,K,te,he){const re=24*e,le=12*e,we=48*e;return this.int16[re+0]=r,this.int16[re+1]=o,this.uint16[re+2]=u,this.uint16[re+3]=g,this.uint32[le+2]=_,this.uint32[le+3]=y,this.uint32[le+4]=S,this.uint16[re+10]=I,this.uint16[re+11]=P,this.uint16[re+12]=C,this.float32[le+7]=z,this.float32[le+8]=F,this.uint8[we+36]=B,this.uint8[we+37]=G,this.uint8[we+38]=K,this.uint32[le+10]=te,this.int16[re+22]=he,e}}Us.prototype.bytesPerElement=48,it("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Us);class ms extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,u,g,_,y,S,I,P,C,z,F,B,G,K,te,he,re,le,we,Ee,Ye,st,Xe,Ze,$e,rt){const He=this.length;return this.resize(He+1),this.emplace(He,e,r,o,u,g,_,y,S,I,P,C,z,F,B,G,K,te,he,re,le,we,Ee,Ye,st,Xe,Ze,$e,rt)}emplace(e,r,o,u,g,_,y,S,I,P,C,z,F,B,G,K,te,he,re,le,we,Ee,Ye,st,Xe,Ze,$e,rt,He){const Le=32*e,mt=16*e;return this.int16[Le+0]=r,this.int16[Le+1]=o,this.int16[Le+2]=u,this.int16[Le+3]=g,this.int16[Le+4]=_,this.int16[Le+5]=y,this.int16[Le+6]=S,this.int16[Le+7]=I,this.uint16[Le+8]=P,this.uint16[Le+9]=C,this.uint16[Le+10]=z,this.uint16[Le+11]=F,this.uint16[Le+12]=B,this.uint16[Le+13]=G,this.uint16[Le+14]=K,this.uint16[Le+15]=te,this.uint16[Le+16]=he,this.uint16[Le+17]=re,this.uint16[Le+18]=le,this.uint16[Le+19]=we,this.uint16[Le+20]=Ee,this.uint16[Le+21]=Ye,this.uint16[Le+22]=st,this.uint32[mt+12]=Xe,this.float32[mt+13]=Ze,this.float32[mt+14]=$e,this.uint16[Le+30]=rt,this.uint16[Le+31]=He,e}}ms.prototype.bytesPerElement=64,it("StructArrayLayout8i15ui1ul2f2ui64",ms);class Ma extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Ma.prototype.bytesPerElement=4,it("StructArrayLayout1f4",Ma);class ka extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,o)}emplace(e,r,o,u){const g=3*e;return this.uint16[6*e+0]=r,this.float32[g+1]=o,this.float32[g+2]=u,e}}ka.prototype.bytesPerElement=12,it("StructArrayLayout1ui2f12",ka);class gs extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,o)}emplace(e,r,o,u){const g=4*e;return this.uint32[2*e+0]=r,this.uint16[g+2]=o,this.uint16[g+3]=u,e}}gs.prototype.bytesPerElement=8,it("StructArrayLayout1ul2ui8",gs);class Bl extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){const u=2*e;return this.uint16[u+0]=r,this.uint16[u+1]=o,e}}Bl.prototype.bytesPerElement=4,it("StructArrayLayout2ui4",Bl);class Nl extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}Nl.prototype.bytesPerElement=2,it("StructArrayLayout1ui2",Nl);class Da extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,u){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,o,u)}emplace(e,r,o,u,g){const _=4*e;return this.float32[_+0]=r,this.float32[_+1]=o,this.float32[_+2]=u,this.float32[_+3]=g,e}}Da.prototype.bytesPerElement=16,it("StructArrayLayout4f16",Da);class bu extends Eo{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new N(this.anchorPointX,this.anchorPointY)}}bu.prototype.size=20;class p extends Ea{get(e){return new bu(this,e)}}it("CollisionBoxArray",p);class t extends Eo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}t.prototype.size=48;class s extends Us{get(e){return new t(this,e)}}it("PlacedSymbolArray",s);class l extends Eo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}l.prototype.size=64;class c extends ms{get(e){return new l(this,e)}}it("SymbolInstanceArray",c);class f extends Ma{getoffsetX(e){return this.float32[1*e+0]}}it("GlyphOffsetArray",f);class b extends Dn{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}it("SymbolLineVertexArray",b);class w extends Eo{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}w.prototype.size=12;class A extends ka{get(e){return new w(this,e)}}it("TextAnchorOffsetArray",A);class E extends Eo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}E.prototype.size=8;class M extends gs{get(e){return new E(this,e)}}it("FeatureIndexArray",M);class k extends Po{}class O extends Po{}class W extends Po{}class Z extends Rl{}class Y extends Ll{}class q extends Co{}class se extends Ia{}class me extends Fl{}class Q extends Ol{}class ce extends zn{}class ge extends Mo{}class xe extends ko{}class be extends Ca{}class ze extends Bl{}const ke=Ui([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ne}=ke;class je{constructor(e=[]){this.segments=e}prepareSegment(e,r,o,u){let g=this.segments[this.segments.length-1];return e>je.MAX_VERTEX_ARRAY_LENGTH&&Bt(`Max vertices per segment is ${je.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!g||g.vertexLength+e>je.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==u)&&(g={vertexOffset:r.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},u!==void 0&&(g.sortKey=u),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,o,u){return new je([{vertexOffset:e,primitiveOffset:r,vertexLength:o,primitiveLength:u,vaos:{},sortKey:0}])}}function Rt(i,e){return 256*(i=ot(Math.floor(i),0,255))+ot(Math.floor(e),0,255)}je.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,it("SegmentVector",je);const Ge=Ui([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var wt={exports:{}},Lt={exports:{}};Lt.exports=function(i,e){var r,o,u,g,_,y,S,I;for(o=i.length-(r=3&i.length),u=e,_=3432918353,y=461845907,I=0;I<o;)S=255&i.charCodeAt(I)|(255&i.charCodeAt(++I))<<8|(255&i.charCodeAt(++I))<<16|(255&i.charCodeAt(++I))<<24,++I,u=27492+(65535&(g=5*(65535&(u=(u^=S=(65535&(S=(S=(65535&S)*_+(((S>>>16)*_&65535)<<16)&4294967295)<<15|S>>>17))*y+(((S>>>16)*y&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(S=0,r){case 3:S^=(255&i.charCodeAt(I+2))<<16;case 2:S^=(255&i.charCodeAt(I+1))<<8;case 1:u^=S=(65535&(S=(S=(65535&(S^=255&i.charCodeAt(I)))*_+(((S>>>16)*_&65535)<<16)&4294967295)<<15|S>>>17))*y+(((S>>>16)*y&65535)<<16)&4294967295}return u^=i.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0};var Kt=Lt.exports,At={exports:{}};At.exports=function(i,e){for(var r,o=i.length,u=e^o,g=0;o>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(g)|(255&i.charCodeAt(++g))<<8|(255&i.charCodeAt(++g))<<16|(255&i.charCodeAt(++g))<<24))+((1540483477*(r>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),o-=4,++g;switch(o){case 3:u^=(255&i.charCodeAt(g+2))<<16;case 2:u^=(255&i.charCodeAt(g+1))<<8;case 1:u=1540483477*(65535&(u^=255&i.charCodeAt(g)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0};var Ot=Kt,$t=At.exports;wt.exports=Ot,wt.exports.murmur3=Ot,wt.exports.murmur2=$t;var Li=L(wt.exports);class hi{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,o,u){this.ids.push(Hr(e)),this.positions.push(r,o,u)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Hr(e);let o=0,u=this.ids.length-1;for(;o<u;){const _=o+u>>1;this.ids[_]>=r?u=_:o=_+1}const g=[];for(;this.ids[o]===r;)g.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return g}static serialize(e,r){const o=new Float64Array(e.ids),u=new Uint32Array(e.positions);return Qi(o,u,0,o.length-1),r&&r.push(o.buffer,u.buffer),{ids:o,positions:u}}static deserialize(e){const r=new hi;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function Hr(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Li(String(i))}function Qi(i,e,r,o){for(;r<o;){const u=i[r+o>>1];let g=r-1,_=o+1;for(;;){do g++;while(i[g]<u);do _--;while(i[_]>u);if(g>=_)break;Ci(i,g,_),Ci(e,3*g,3*_),Ci(e,3*g+1,3*_+1),Ci(e,3*g+2,3*_+2)}_-r<o-_?(Qi(i,e,r,_),r=_+1):(Qi(i,e,_+1,o),o=_)}}function Ci(i,e,r){const o=i[e];i[e]=i[r],i[r]=o}it("FeaturePositionMap",hi);class er{constructor(e,r){this.gl=e.gl,this.location=r}}class Zr extends er{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class In extends er{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Kn extends er{constructor(e,r){super(e,r),this.current=ci.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Do=new Float32Array(16);function Xn(i){return[Rt(255*i.r,255*i.g),Rt(255*i.b,255*i.a)]}class En{constructor(e,r,o){this.value=e,this.uniformNames=r.map(u=>`u_${u}`),this.type=o}setUniform(e,r,o){e.set(o.constantOr(this.value))}getBinding(e,r,o){return this.type==="color"?new Kn(e,r):new Zr(e,r)}}class Hi{constructor(e,r){this.uniformNames=r.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setUniform(e,r,o,u){const g=u==="u_pattern_to"?this.patternTo:u==="u_pattern_from"?this.patternFrom:u==="u_pixel_ratio_to"?this.pixelRatioTo:u==="u_pixel_ratio_from"?this.pixelRatioFrom:null;g&&e.set(g)}getBinding(e,r,o){return o.substr(0,9)==="u_pattern"?new In(e,r):new Zr(e,r)}}class Mi{constructor(e,r,o,u){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=r.map(g=>({name:`a_${g}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,r,o,u,g){const _=this.paintVertexArray.length,y=this.expression.evaluate(new Ai(0),r,{},u,[],g);this.paintVertexArray.resize(e),this._setPaintValue(_,e,y)}updatePaintArray(e,r,o,u){const g=this.expression.evaluate({zoom:0},o,u);this._setPaintValue(e,r,g)}_setPaintValue(e,r,o){if(this.type==="color"){const u=Xn(o);for(let g=e;g<r;g++)this.paintVertexArray.emplace(g,u[0],u[1])}else{for(let u=e;u<r;u++)this.paintVertexArray.emplace(u,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ii{constructor(e,r,o,u,g,_){this.expression=e,this.uniformNames=r.map(y=>`u_${y}_t`),this.type=o,this.useIntegerZoom=u,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=r.map(y=>({name:`a_${y}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(e,r,o,u,g){const _=this.expression.evaluate(new Ai(this.zoom),r,{},u,[],g),y=this.expression.evaluate(new Ai(this.zoom+1),r,{},u,[],g),S=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(S,e,_,y)}updatePaintArray(e,r,o,u){const g=this.expression.evaluate({zoom:this.zoom},o,u),_=this.expression.evaluate({zoom:this.zoom+1},o,u);this._setPaintValue(e,r,g,_)}_setPaintValue(e,r,o,u){if(this.type==="color"){const g=Xn(o),_=Xn(u);for(let y=e;y<r;y++)this.paintVertexArray.emplace(y,g[0],g[1],_[0],_[1])}else{for(let g=e;g<r;g++)this.paintVertexArray.emplace(g,o,u);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const o=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,u=ot(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(u)}getBinding(e,r,o){return new Zr(e,r)}}class nn{constructor(e,r,o,u,g,_){this.expression=e,this.type=r,this.useIntegerZoom=o,this.zoom=u,this.layerId=_,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(e,r,o){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(u,e,r.patterns&&r.patterns[this.layerId],o)}updatePaintArray(e,r,o,u,g){this._setPaintValues(e,r,o.patterns&&o.patterns[this.layerId],g)}_setPaintValues(e,r,o,u){if(!u||!o)return;const{min:g,mid:_,max:y}=o,S=u[g],I=u[_],P=u[y];if(S&&I&&P)for(let C=e;C<r;C++)this.zoomInPaintVertexArray.emplace(C,I.tl[0],I.tl[1],I.br[0],I.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],I.pixelRatio,S.pixelRatio),this.zoomOutPaintVertexArray.emplace(C,I.tl[0],I.tl[1],I.br[0],I.br[1],P.tl[0],P.tl[1],P.br[0],P.br[1],I.pixelRatio,P.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Ge.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Ge.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Zi{constructor(e,r,o){this.binders={},this._buffers=[];const u=[];for(const g in e.paint._values){if(!o(g))continue;const _=e.paint.get(g);if(!(_ instanceof fn&&Ls(_.property.specification)))continue;const y=sn(g,e.type),S=_.value,I=_.property.specification.type,P=_.property.useIntegerZoom,C=_.property.specification["property-type"],z=C==="cross-faded"||C==="cross-faded-data-driven";if(S.kind==="constant")this.binders[g]=z?new Hi(S.value,y):new En(S.value,y,I),u.push(`/u_${g}`);else if(S.kind==="source"||z){const F=Wi(g,I,"source");this.binders[g]=z?new nn(S,I,P,r,F,e.id):new Mi(S,y,I,F),u.push(`/a_${g}`)}else{const F=Wi(g,I,"composite");this.binders[g]=new Ii(S,y,I,P,r,F),u.push(`/z_${g}`)}}this.cacheKey=u.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof Mi||r instanceof Ii?r.maxValue:0}populatePaintArrays(e,r,o,u,g){for(const _ in this.binders){const y=this.binders[_];(y instanceof Mi||y instanceof Ii||y instanceof nn)&&y.populatePaintArray(e,r,o,u,g)}}setConstantPatternPositions(e,r){for(const o in this.binders){const u=this.binders[o];u instanceof Hi&&u.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,o,u,g){let _=!1;for(const y in e){const S=r.getPositions(y);for(const I of S){const P=o.feature(I.index);for(const C in this.binders){const z=this.binders[C];if((z instanceof Mi||z instanceof Ii||z instanceof nn)&&z.expression.isStateDependent===!0){const F=u.paint.get(C);z.expression=F.value,z.updatePaintArray(I.start,I.end,P,e[y],g),_=!0}}}}return _}defines(){const e=[];for(const r in this.binders){const o=this.binders[r];(o instanceof En||o instanceof Hi)&&e.push(...o.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof Mi||o instanceof Ii)for(let u=0;u<o.paintVertexAttributes.length;u++)e.push(o.paintVertexAttributes[u].name);else if(o instanceof nn)for(let u=0;u<Ge.members.length;u++)e.push(Ge.members[u].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof En||o instanceof Hi||o instanceof Ii)for(const u of o.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const o=[];for(const u in this.binders){const g=this.binders[u];if(g instanceof En||g instanceof Hi||g instanceof Ii){for(const _ of g.uniformNames)if(r[_]){const y=g.getBinding(e,r[_],_);o.push({name:_,property:u,binding:y})}}}return o}setUniforms(e,r,o,u){for(const{name:g,property:_,binding:y}of r)this.binders[_].setUniform(y,u,o.get(_),g)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const o=this.binders[r];if(e&&o instanceof nn){const u=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(o instanceof Mi||o instanceof Ii)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const r in this.binders){const o=this.binders[r];(o instanceof Mi||o instanceof Ii||o instanceof nn)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof Mi||r instanceof Ii||r instanceof nn)&&r.destroy()}}}class ki{constructor(e,r,o=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new Zi(u,r,o);this.needsUpload=!1,this._featureMap=new hi,this._bufferOffset=0}populatePaintArrays(e,r,o,u,g,_){for(const y in this.programConfigurations)this.programConfigurations[y].populatePaintArrays(e,r,u,g,_);r.id!==void 0&&this._featureMap.add(r.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,o,u){for(const g of o)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(e,this._featureMap,r,g,u)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function sn(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function Wi(i,e,r){const o={color:{source:Co,composite:Da},number:{source:Ma,composite:Co}},u=function(g){return{"line-pattern":{source:se,composite:se},"fill-pattern":{source:se,composite:se},"fill-extrusion-pattern":{source:se,composite:se}}[g]}(i);return u&&u[r]||o[e][r]}it("ConstantBinder",En),it("CrossFadedConstantBinder",Hi),it("SourceExpressionBinder",Mi),it("CrossFadedCompositeBinder",nn),it("CompositeExpressionBinder",Ii),it("ProgramConfiguration",Zi,{omit:["_buffers"]}),it("ProgramConfigurationSet",ki);const Bi=8192,Vl=Math.pow(2,14)-1,wu=-Vl-1;function _s(i){const e=Bi/i.extent,r=i.loadGeometry();for(let o=0;o<r.length;o++){const u=r[o];for(let g=0;g<u.length;g++){const _=u[g],y=Math.round(_.x*e),S=Math.round(_.y*e);_.x=ot(y,wu,Vl),_.y=ot(S,wu,Vl),(y<_.x||y>_.x+1||S<_.y||S>_.y+1)&&Bt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function ys(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?_s(i):[]}}function za(i,e,r,o,u){i.emplaceBack(2*e+(o+1)/2,2*r+(u+1)/2)}class Yn{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new O,this.indexArray=new be,this.segments=new je,this.programConfigurations=new ki(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){const u=this.layers[0],g=[];let _=null,y=!1;u.type==="circle"&&(_=u.layout.get("circle-sort-key"),y=!_.isConstant());for(const{feature:S,id:I,index:P,sourceLayerIndex:C}of e){const z=this.layers[0]._featureFilter.needGeometry,F=ys(S,z);if(!this.layers[0]._featureFilter.filter(new Ai(this.zoom),F,o))continue;const B=y?_.evaluate(F,{},o):void 0,G={id:I,properties:S.properties,type:S.type,sourceLayerIndex:C,index:P,geometry:z?F.geometry:_s(S),patterns:{},sortKey:B};g.push(G)}y&&g.sort((S,I)=>S.sortKey-I.sortKey);for(const S of g){const{geometry:I,index:P,sourceLayerIndex:C}=S,z=e[P].feature;this.addFeature(S,I,P,o),r.featureIndex.insert(z,I,P,C,this.index)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ne),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,o,u){for(const g of r)for(const _ of g){const y=_.x,S=_.y;if(y<0||y>=Bi||S<0||S>=Bi)continue;const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),P=I.vertexLength;za(this.layoutVertexArray,y,S,-1,-1),za(this.layoutVertexArray,y,S,1,-1),za(this.layoutVertexArray,y,S,1,1),za(this.layoutVertexArray,y,S,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+3,P+2),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},u)}}function $l(i,e){for(let r=0;r<i.length;r++)if(La(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(La(i,e[r]))return!0;return!!Ra(i,e)}function Su(i,e,r){return!!La(i,e)||!!ld(e,i,r)}function Ul(i,e){if(i.length===1)return pf(e,i[0]);for(let r=0;r<e.length;r++){const o=e[r];for(let u=0;u<o.length;u++)if(La(i,o[u]))return!0}for(let r=0;r<i.length;r++)if(pf(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Ra(i,e[r]))return!0;return!1}function jl(i,e,r){if(i.length>1){if(Ra(i,e))return!0;for(let o=0;o<e.length;o++)if(ld(e[o],i,r))return!0}for(let o=0;o<i.length;o++)if(ld(i[o],e,r))return!0;return!1}function Ra(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const o=i[r],u=i[r+1];for(let g=0;g<e.length-1;g++)if(ql(o,u,e[g],e[g+1]))return!0}return!1}function ql(i,e,r,o){return Pt(i,r,o)!==Pt(e,r,o)&&Pt(i,e,r)!==Pt(i,e,o)}function ld(i,e,r){const o=r*r;if(e.length===1)return i.distSqr(e[0])<o;for(let u=1;u<e.length;u++)if(df(i,e[u-1],e[u])<o)return!0;return!1}function df(i,e,r){const o=e.distSqr(r);if(o===0)return i.distSqr(e);const u=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/o;return i.distSqr(u<0?e:u>1?r:r.sub(e)._mult(u)._add(e))}function pf(i,e){let r,o,u,g=!1;for(let _=0;_<i.length;_++){r=i[_];for(let y=0,S=r.length-1;y<r.length;S=y++)o=r[y],u=r[S],o.y>e.y!=u.y>e.y&&e.x<(u.x-o.x)*(e.y-o.y)/(u.y-o.y)+o.x&&(g=!g)}return g}function La(i,e){let r=!1;for(let o=0,u=i.length-1;o<i.length;u=o++){const g=i[o],_=i[u];g.y>e.y!=_.y>e.y&&e.x<(_.x-g.x)*(e.y-g.y)/(_.y-g.y)+g.x&&(r=!r)}return r}function hx(i,e,r){const o=r[0],u=r[2];if(i.x<o.x&&e.x<o.x||i.x>u.x&&e.x>u.x||i.y<o.y&&e.y<o.y||i.y>u.y&&e.y>u.y)return!1;const g=Pt(i,e,r[0]);return g!==Pt(i,e,r[1])||g!==Pt(i,e,r[2])||g!==Pt(i,e,r[3])}function Gl(i,e,r){const o=e.paint.get(i).value;return o.kind==="constant"?o.value:r.programConfigurations.get(e.id).getMaxValue(i)}function Tu(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Au(i,e,r,o,u){if(!e[0]&&!e[1])return i;const g=N.convert(e)._mult(u);r==="viewport"&&g._rotate(-o);const _=[];for(let y=0;y<i.length;y++)_.push(i[y].sub(g));return _}let ff,mf;it("CircleBucket",Yn,{omit:["layers"]});var dx={get paint(){return mf=mf||new Lr({"circle-radius":new yt(ee.paint_circle["circle-radius"]),"circle-color":new yt(ee.paint_circle["circle-color"]),"circle-blur":new yt(ee.paint_circle["circle-blur"]),"circle-opacity":new yt(ee.paint_circle["circle-opacity"]),"circle-translate":new ut(ee.paint_circle["circle-translate"]),"circle-translate-anchor":new ut(ee.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ut(ee.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ut(ee.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new yt(ee.paint_circle["circle-stroke-width"]),"circle-stroke-color":new yt(ee.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new yt(ee.paint_circle["circle-stroke-opacity"])})},get layout(){return ff=ff||new Lr({"circle-sort-key":new yt(ee.layout_circle["circle-sort-key"])})}},Fr=1e-6,Fa=typeof Float32Array<"u"?Float32Array:Array;function cd(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function gf(i,e,r){var o=e[0],u=e[1],g=e[2],_=e[3],y=e[4],S=e[5],I=e[6],P=e[7],C=e[8],z=e[9],F=e[10],B=e[11],G=e[12],K=e[13],te=e[14],he=e[15],re=r[0],le=r[1],we=r[2],Ee=r[3];return i[0]=re*o+le*y+we*C+Ee*G,i[1]=re*u+le*S+we*z+Ee*K,i[2]=re*g+le*I+we*F+Ee*te,i[3]=re*_+le*P+we*B+Ee*he,i[4]=(re=r[4])*o+(le=r[5])*y+(we=r[6])*C+(Ee=r[7])*G,i[5]=re*u+le*S+we*z+Ee*K,i[6]=re*g+le*I+we*F+Ee*te,i[7]=re*_+le*P+we*B+Ee*he,i[8]=(re=r[8])*o+(le=r[9])*y+(we=r[10])*C+(Ee=r[11])*G,i[9]=re*u+le*S+we*z+Ee*K,i[10]=re*g+le*I+we*F+Ee*te,i[11]=re*_+le*P+we*B+Ee*he,i[12]=(re=r[12])*o+(le=r[13])*y+(we=r[14])*C+(Ee=r[15])*G,i[13]=re*u+le*S+we*z+Ee*K,i[14]=re*g+le*I+we*F+Ee*te,i[15]=re*_+le*P+we*B+Ee*he,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var Hl,px=gf;function Iu(i,e,r){var o=e[0],u=e[1],g=e[2],_=e[3];return i[0]=r[0]*o+r[4]*u+r[8]*g+r[12]*_,i[1]=r[1]*o+r[5]*u+r[9]*g+r[13]*_,i[2]=r[2]*o+r[6]*u+r[10]*g+r[14]*_,i[3]=r[3]*o+r[7]*u+r[11]*g+r[15]*_,i}Hl=new Fa(4),Fa!=Float32Array&&(Hl[0]=0,Hl[1]=0,Hl[2]=0,Hl[3]=0);class fx extends mn{constructor(e){super(e,dx)}createBucket(e){return new Yn(e)}queryRadius(e){const r=e;return Gl("circle-radius",this,r)+Gl("circle-stroke-width",this,r)+Tu(this.paint.get("circle-translate"))}queryIntersectsFeature(e,r,o,u,g,_,y,S){const I=Au(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),_.angle,y),P=this.paint.get("circle-radius").evaluate(r,o)+this.paint.get("circle-stroke-width").evaluate(r,o),C=this.paint.get("circle-pitch-alignment")==="map",z=C?I:function(B,G){return B.map(K=>_f(K,G))}(I,S),F=C?P*y:P;for(const B of u)for(const G of B){const K=C?G:_f(G,S);let te=F;const he=Iu([],[G.x,G.y,0,1],S);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?te*=he[3]/_.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(te*=_.cameraToCenterDistance/he[3]),Su(z,K,te))return!0}return!1}}function _f(i,e){const r=Iu([],[i.x,i.y,0,1],e);return new N(r[0]/r[3],r[1]/r[3])}class yf extends Yn{}let xf;it("HeatmapBucket",yf,{omit:["layers"]});var mx={get paint(){return xf=xf||new Lr({"heatmap-radius":new yt(ee.paint_heatmap["heatmap-radius"]),"heatmap-weight":new yt(ee.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ut(ee.paint_heatmap["heatmap-intensity"]),"heatmap-color":new kl(ee.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ut(ee.paint_heatmap["heatmap-opacity"])})}};function ud(i,{width:e,height:r},o,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*r*o)throw new RangeError(`mismatched image size. expected: ${u.length} but got: ${e*r*o}`)}else u=new Uint8Array(e*r*o);return i.width=e,i.height=r,i.data=u,i}function vf(i,{width:e,height:r},o){if(e===i.width&&r===i.height)return;const u=ud({},{width:e,height:r},o);hd(i,u,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},o),i.width=e,i.height=r,i.data=u.data}function hd(i,e,r,o,u,g){if(u.width===0||u.height===0)return e;if(u.width>i.width||u.height>i.height||r.x>i.width-u.width||r.y>i.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||o.x>e.width-u.width||o.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const _=i.data,y=e.data;if(_===y)throw new Error("srcData equals dstData, so image is already copied");for(let S=0;S<u.height;S++){const I=((r.y+S)*i.width+r.x)*g,P=((o.y+S)*e.width+o.x)*g;for(let C=0;C<u.width*g;C++)y[P+C]=_[I+C]}return e}class Zl{constructor(e,r){ud(this,e,1,r)}resize(e){vf(this,e,1)}clone(){return new Zl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,o,u,g){hd(e,r,o,u,g,1)}}class gn{constructor(e,r){ud(this,e,4,r)}resize(e){vf(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new gn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,o,u,g){hd(e,r,o,u,g,4)}}function bf(i){const e={},r=i.resolution||256,o=i.clips?i.clips.length:1,u=i.image||new gn({width:r,height:o});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const g=(_,y,S)=>{e[i.evaluationKey]=S;const I=i.expression.evaluate(e);u.data[_+y+0]=Math.floor(255*I.r/I.a),u.data[_+y+1]=Math.floor(255*I.g/I.a),u.data[_+y+2]=Math.floor(255*I.b/I.a),u.data[_+y+3]=Math.floor(255*I.a)};if(i.clips)for(let _=0,y=0;_<o;++_,y+=4*r)for(let S=0,I=0;S<r;S++,I+=4){const P=S/(r-1),{start:C,end:z}=i.clips[_];g(y,I,C*(1-P)+z*P)}else for(let _=0,y=0;_<r;_++,y+=4)g(0,y,_/(r-1));return u}it("AlphaImage",Zl),it("RGBAImage",gn);class gx extends mn{createBucket(e){return new yf(e)}constructor(e){super(e,mx),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=bf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let wf;var _x={get paint(){return wf=wf||new Lr({"hillshade-illumination-direction":new ut(ee.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ut(ee.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ut(ee.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ut(ee.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ut(ee.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ut(ee.paint_hillshade["hillshade-accent-color"])})}};class yx extends mn{constructor(e){super(e,_x)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const xx=Ui([{name:"a_pos",components:2,type:"Int16"}],4),{members:vx}=xx;var dd={exports:{}};function Eu(i,e,r){r=r||2;var o,u,g,_,y,S,I,P=e&&e.length,C=P?e[0]*r:i.length,z=Sf(i,0,C,r,!0),F=[];if(!z||z.next===z.prev)return F;if(P&&(z=function(G,K,te,he){var re,le,we,Ee=[];for(re=0,le=K.length;re<le;re++)(we=Sf(G,K[re]*he,re<le-1?K[re+1]*he:G.length,he,!1))===we.next&&(we.steiner=!0),Ee.push(Px(we));for(Ee.sort(Ax),re=0;re<Ee.length;re++)te=Ix(Ee[re],te);return te}(i,e,z,r)),i.length>80*r){o=g=i[0],u=_=i[1];for(var B=r;B<C;B+=r)(y=i[B])<o&&(o=y),(S=i[B+1])<u&&(u=S),y>g&&(g=y),S>_&&(_=S);I=(I=Math.max(g-o,_-u))!==0?32767/I:0}return Wl(z,F,r,o,u,I,0),F}function Sf(i,e,r,o,u){var g,_;if(u===md(i,e,r,o)>0)for(g=e;g<r;g+=o)_=If(g,i[g],i[g+1],_);else for(g=r-o;g>=e;g-=o)_=If(g,i[g],i[g+1],_);return _&&Pu(_,_.next)&&(Xl(_),_=_.next),_}function zo(i,e){if(!i)return i;e||(e=i);var r,o=i;do if(r=!1,o.steiner||!Pu(o,o.next)&&ji(o.prev,o,o.next)!==0)o=o.next;else{if(Xl(o),(o=e=o.prev)===o.next)break;r=!0}while(r||o!==e);return e}function Wl(i,e,r,o,u,g,_){if(i){!_&&g&&function(P,C,z,F){var B=P;do B.z===0&&(B.z=pd(B.x,B.y,C,z,F)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==P);B.prevZ.nextZ=null,B.prevZ=null,function(G){var K,te,he,re,le,we,Ee,Ye,st=1;do{for(te=G,G=null,le=null,we=0;te;){for(we++,he=te,Ee=0,K=0;K<st&&(Ee++,he=he.nextZ);K++);for(Ye=st;Ee>0||Ye>0&&he;)Ee!==0&&(Ye===0||!he||te.z<=he.z)?(re=te,te=te.nextZ,Ee--):(re=he,he=he.nextZ,Ye--),le?le.nextZ=re:G=re,re.prevZ=le,le=re;te=he}le.nextZ=null,st*=2}while(we>1)}(B)}(i,o,u,g);for(var y,S,I=i;i.prev!==i.next;)if(y=i.prev,S=i.next,g?wx(i,o,u,g):bx(i))e.push(y.i/r|0),e.push(i.i/r|0),e.push(S.i/r|0),Xl(i),i=S.next,I=S.next;else if((i=S)===I){_?_===1?Wl(i=Sx(zo(i),e,r),e,r,o,u,g,2):_===2&&Tx(i,e,r,o,u,g):Wl(zo(i),e,r,o,u,g,1);break}}}function bx(i){var e=i.prev,r=i,o=i.next;if(ji(e,r,o)>=0)return!1;for(var u=e.x,g=r.x,_=o.x,y=e.y,S=r.y,I=o.y,P=u<g?u<_?u:_:g<_?g:_,C=y<S?y<I?y:I:S<I?S:I,z=u>g?u>_?u:_:g>_?g:_,F=y>S?y>I?y:I:S>I?S:I,B=o.next;B!==e;){if(B.x>=P&&B.x<=z&&B.y>=C&&B.y<=F&&Oa(u,y,g,S,_,I,B.x,B.y)&&ji(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function wx(i,e,r,o){var u=i.prev,g=i,_=i.next;if(ji(u,g,_)>=0)return!1;for(var y=u.x,S=g.x,I=_.x,P=u.y,C=g.y,z=_.y,F=y<S?y<I?y:I:S<I?S:I,B=P<C?P<z?P:z:C<z?C:z,G=y>S?y>I?y:I:S>I?S:I,K=P>C?P>z?P:z:C>z?C:z,te=pd(F,B,e,r,o),he=pd(G,K,e,r,o),re=i.prevZ,le=i.nextZ;re&&re.z>=te&&le&&le.z<=he;){if(re.x>=F&&re.x<=G&&re.y>=B&&re.y<=K&&re!==u&&re!==_&&Oa(y,P,S,C,I,z,re.x,re.y)&&ji(re.prev,re,re.next)>=0||(re=re.prevZ,le.x>=F&&le.x<=G&&le.y>=B&&le.y<=K&&le!==u&&le!==_&&Oa(y,P,S,C,I,z,le.x,le.y)&&ji(le.prev,le,le.next)>=0))return!1;le=le.nextZ}for(;re&&re.z>=te;){if(re.x>=F&&re.x<=G&&re.y>=B&&re.y<=K&&re!==u&&re!==_&&Oa(y,P,S,C,I,z,re.x,re.y)&&ji(re.prev,re,re.next)>=0)return!1;re=re.prevZ}for(;le&&le.z<=he;){if(le.x>=F&&le.x<=G&&le.y>=B&&le.y<=K&&le!==u&&le!==_&&Oa(y,P,S,C,I,z,le.x,le.y)&&ji(le.prev,le,le.next)>=0)return!1;le=le.nextZ}return!0}function Sx(i,e,r){var o=i;do{var u=o.prev,g=o.next.next;!Pu(u,g)&&Tf(u,o,o.next,g)&&Kl(u,g)&&Kl(g,u)&&(e.push(u.i/r|0),e.push(o.i/r|0),e.push(g.i/r|0),Xl(o),Xl(o.next),o=i=g),o=o.next}while(o!==i);return zo(o)}function Tx(i,e,r,o,u,g){var _=i;do{for(var y=_.next.next;y!==_.prev;){if(_.i!==y.i&&Cx(_,y)){var S=Af(_,y);return _=zo(_,_.next),S=zo(S,S.next),Wl(_,e,r,o,u,g,0),void Wl(S,e,r,o,u,g,0)}y=y.next}_=_.next}while(_!==i)}function Ax(i,e){return i.x-e.x}function Ix(i,e){var r=function(u,g){var _,y=g,S=u.x,I=u.y,P=-1/0;do{if(I<=y.y&&I>=y.next.y&&y.next.y!==y.y){var C=y.x+(I-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(C<=S&&C>P&&(P=C,_=y.x<y.next.x?y:y.next,C===S))return _}y=y.next}while(y!==g);if(!_)return null;var z,F=_,B=_.x,G=_.y,K=1/0;y=_;do S>=y.x&&y.x>=B&&S!==y.x&&Oa(I<G?S:P,I,B,G,I<G?P:S,I,y.x,y.y)&&(z=Math.abs(I-y.y)/(S-y.x),Kl(y,u)&&(z<K||z===K&&(y.x>_.x||y.x===_.x&&Ex(_,y)))&&(_=y,K=z)),y=y.next;while(y!==F);return _}(i,e);if(!r)return e;var o=Af(r,i);return zo(o,o.next),zo(r,r.next)}function Ex(i,e){return ji(i.prev,i,e.prev)<0&&ji(e.next,i,i.next)<0}function pd(i,e,r,o,u){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*u|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Px(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function Oa(i,e,r,o,u,g,_,y){return(u-_)*(e-y)>=(i-_)*(g-y)&&(i-_)*(o-y)>=(r-_)*(e-y)&&(r-_)*(g-y)>=(u-_)*(o-y)}function Cx(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,o){var u=r;do{if(u.i!==r.i&&u.next.i!==r.i&&u.i!==o.i&&u.next.i!==o.i&&Tf(u,u.next,r,o))return!0;u=u.next}while(u!==r);return!1}(i,e)&&(Kl(i,e)&&Kl(e,i)&&function(r,o){var u=r,g=!1,_=(r.x+o.x)/2,y=(r.y+o.y)/2;do u.y>y!=u.next.y>y&&u.next.y!==u.y&&_<(u.next.x-u.x)*(y-u.y)/(u.next.y-u.y)+u.x&&(g=!g),u=u.next;while(u!==r);return g}(i,e)&&(ji(i.prev,i,e.prev)||ji(i,e.prev,e))||Pu(i,e)&&ji(i.prev,i,i.next)>0&&ji(e.prev,e,e.next)>0)}function ji(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function Pu(i,e){return i.x===e.x&&i.y===e.y}function Tf(i,e,r,o){var u=Mu(ji(i,e,r)),g=Mu(ji(i,e,o)),_=Mu(ji(r,o,i)),y=Mu(ji(r,o,e));return u!==g&&_!==y||!(u!==0||!Cu(i,r,e))||!(g!==0||!Cu(i,o,e))||!(_!==0||!Cu(r,i,o))||!(y!==0||!Cu(r,e,o))}function Cu(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function Mu(i){return i>0?1:i<0?-1:0}function Kl(i,e){return ji(i.prev,i,i.next)<0?ji(i,e,i.next)>=0&&ji(i,i.prev,e)>=0:ji(i,e,i.prev)<0||ji(i,i.next,e)<0}function Af(i,e){var r=new fd(i.i,i.x,i.y),o=new fd(e.i,e.x,e.y),u=i.next,g=e.prev;return i.next=e,e.prev=i,r.next=u,u.prev=r,o.next=r,r.prev=o,g.next=o,o.prev=g,o}function If(i,e,r,o){var u=new fd(i,e,r);return o?(u.next=o.next,u.prev=o,o.next.prev=u,o.next=u):(u.prev=u,u.next=u),u}function Xl(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function fd(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function md(i,e,r,o){for(var u=0,g=e,_=r-o;g<r;g+=o)u+=(i[_]-i[g])*(i[g+1]+i[_+1]),_=g;return u}dd.exports=Eu,dd.exports.default=Eu,Eu.deviation=function(i,e,r,o){var u=e&&e.length,g=Math.abs(md(i,0,u?e[0]*r:i.length,r));if(u)for(var _=0,y=e.length;_<y;_++)g-=Math.abs(md(i,e[_]*r,_<y-1?e[_+1]*r:i.length,r));var S=0;for(_=0;_<o.length;_+=3){var I=o[_]*r,P=o[_+1]*r,C=o[_+2]*r;S+=Math.abs((i[I]-i[C])*(i[P+1]-i[I+1])-(i[I]-i[P])*(i[C+1]-i[I+1]))}return g===0&&S===0?0:Math.abs((S-g)/g)},Eu.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},o=0,u=0;u<i.length;u++){for(var g=0;g<i[u].length;g++)for(var _=0;_<e;_++)r.vertices.push(i[u][g][_]);u>0&&r.holes.push(o+=i[u-1].length)}return r};var Ef=L(dd.exports);function Mx(i,e,r,o,u){Pf(i,e,r||0,o||i.length-1,u||kx)}function Pf(i,e,r,o,u){for(;o>r;){if(o-r>600){var g=o-r+1,_=e-r+1,y=Math.log(g),S=.5*Math.exp(2*y/3),I=.5*Math.sqrt(y*S*(g-S)/g)*(_-g/2<0?-1:1);Pf(i,e,Math.max(r,Math.floor(e-_*S/g+I)),Math.min(o,Math.floor(e+(g-_)*S/g+I)),u)}var P=i[e],C=r,z=o;for(Yl(i,r,e),u(i[o],P)>0&&Yl(i,r,o);C<z;){for(Yl(i,C,z),C++,z--;u(i[C],P)<0;)C++;for(;u(i[z],P)>0;)z--}u(i[r],P)===0?Yl(i,r,z):Yl(i,++z,o),z<=e&&(r=z+1),e<=z&&(o=z-1)}}function Yl(i,e,r){var o=i[e];i[e]=i[r],i[r]=o}function kx(i,e){return i<e?-1:i>e?1:0}function gd(i,e){const r=i.length;if(r<=1)return[i];const o=[];let u,g;for(let _=0;_<r;_++){const y=di(i[_]);y!==0&&(i[_].area=Math.abs(y),g===void 0&&(g=y<0),g===y<0?(u&&o.push(u),u=[i[_]]):u.push(i[_]))}if(u&&o.push(u),e>1)for(let _=0;_<o.length;_++)o[_].length<=e||(Mx(o[_],e,1,o[_].length-1,Dx),o[_]=o[_].slice(0,e));return o}function Dx(i,e){return e.area-i.area}function _d(i,e,r){const o=r.patternDependencies;let u=!1;for(const g of e){const _=g.paint.get(`${i}-pattern`);_.isConstant()||(u=!0);const y=_.constantOr(null);y&&(u=!0,o[y.to]=!0,o[y.from]=!0)}return u}function yd(i,e,r,o,u){const g=u.patternDependencies;for(const _ of e){const y=_.paint.get(`${i}-pattern`).value;if(y.kind!=="constant"){let S=y.evaluate({zoom:o-1},r,{},u.availableImages),I=y.evaluate({zoom:o},r,{},u.availableImages),P=y.evaluate({zoom:o+1},r,{},u.availableImages);S=S&&S.name?S.name:S,I=I&&I.name?I.name:I,P=P&&P.name?P.name:P,g[S]=!0,g[I]=!0,g[P]=!0,r.patterns[_.id]={min:S,mid:I,max:P}}}return r}class xd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new W,this.indexArray=new be,this.indexArray2=new ze,this.programConfigurations=new ki(e.layers,e.zoom),this.segments=new je,this.segments2=new je,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){this.hasPattern=_d("fill",this.layers,r);const u=this.layers[0].layout.get("fill-sort-key"),g=!u.isConstant(),_=[];for(const{feature:y,id:S,index:I,sourceLayerIndex:P}of e){const C=this.layers[0]._featureFilter.needGeometry,z=ys(y,C);if(!this.layers[0]._featureFilter.filter(new Ai(this.zoom),z,o))continue;const F=g?u.evaluate(z,{},o,r.availableImages):void 0,B={id:S,properties:y.properties,type:y.type,sourceLayerIndex:P,index:I,geometry:C?z.geometry:_s(y),patterns:{},sortKey:F};_.push(B)}g&&_.sort((y,S)=>y.sortKey-S.sortKey);for(const y of _){const{geometry:S,index:I,sourceLayerIndex:P}=y;if(this.hasPattern){const C=yd("fill",this.layers,y,this.zoom,r);this.patternFeatures.push(C)}else this.addFeature(y,S,I,o,{});r.featureIndex.insert(e[I].feature,S,I,P,this.index)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,o)}addFeatures(e,r,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,r,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,vx),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,o,u,g){for(const _ of gd(r,500)){let y=0;for(const F of _)y+=F.length;const S=this.segments.prepareSegment(y,this.layoutVertexArray,this.indexArray),I=S.vertexLength,P=[],C=[];for(const F of _){if(F.length===0)continue;F!==_[0]&&C.push(P.length/2);const B=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),G=B.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(G+F.length-1,G),P.push(F[0].x),P.push(F[0].y);for(let K=1;K<F.length;K++)this.layoutVertexArray.emplaceBack(F[K].x,F[K].y),this.indexArray2.emplaceBack(G+K-1,G+K),P.push(F[K].x),P.push(F[K].y);B.vertexLength+=F.length,B.primitiveLength+=F.length}const z=Ef(P,C);for(let F=0;F<z.length;F+=3)this.indexArray.emplaceBack(I+z[F],I+z[F+1],I+z[F+2]);S.vertexLength+=y,S.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,g,u)}}let Cf,Mf;it("FillBucket",xd,{omit:["layers","patternFeatures"]});var zx={get paint(){return Mf=Mf||new Lr({"fill-antialias":new ut(ee.paint_fill["fill-antialias"]),"fill-opacity":new yt(ee.paint_fill["fill-opacity"]),"fill-color":new yt(ee.paint_fill["fill-color"]),"fill-outline-color":new yt(ee.paint_fill["fill-outline-color"]),"fill-translate":new ut(ee.paint_fill["fill-translate"]),"fill-translate-anchor":new ut(ee.paint_fill["fill-translate-anchor"]),"fill-pattern":new Aa(ee.paint_fill["fill-pattern"])})},get layout(){return Cf=Cf||new Lr({"fill-sort-key":new yt(ee.layout_fill["fill-sort-key"])})}};class Rx extends mn{constructor(e){super(e,zx)}recalculate(e,r){super.recalculate(e,r);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new xd(e)}queryRadius(){return Tu(this.paint.get("fill-translate"))}queryIntersectsFeature(e,r,o,u,g,_,y){return Ul(Au(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),_.angle,y),u)}isTileClipped(){return!0}}const Lx=Ui([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Fx=Ui([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Ox}=Lx;var js={},Bx=U,kf=Ba;function Ba(i,e,r,o,u){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=o,this._values=u,i.readFields(Nx,this,e)}function Nx(i,e,r){i==1?e.id=r.readVarint():i==2?function(o,u){for(var g=o.readVarint()+o.pos;o.pos<g;){var _=u._keys[o.readVarint()],y=u._values[o.readVarint()];u.properties[_]=y}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function Vx(i){for(var e,r,o=0,u=0,g=i.length,_=g-1;u<g;_=u++)o+=((r=i[_]).x-(e=i[u]).x)*(e.y+r.y);return o}Ba.types=["Unknown","Point","LineString","Polygon"],Ba.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,o=1,u=0,g=0,_=0,y=[];i.pos<r;){if(u<=0){var S=i.readVarint();o=7&S,u=S>>3}if(u--,o===1||o===2)g+=i.readSVarint(),_+=i.readSVarint(),o===1&&(e&&y.push(e),e=[]),e.push(new Bx(g,_));else{if(o!==7)throw new Error("unknown command "+o);e&&e.push(e[0].clone())}}return e&&y.push(e),y},Ba.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,o=0,u=0,g=0,_=1/0,y=-1/0,S=1/0,I=-1/0;i.pos<e;){if(o<=0){var P=i.readVarint();r=7&P,o=P>>3}if(o--,r===1||r===2)(u+=i.readSVarint())<_&&(_=u),u>y&&(y=u),(g+=i.readSVarint())<S&&(S=g),g>I&&(I=g);else if(r!==7)throw new Error("unknown command "+r)}return[_,S,y,I]},Ba.prototype.toGeoJSON=function(i,e,r){var o,u,g=this.extent*Math.pow(2,r),_=this.extent*i,y=this.extent*e,S=this.loadGeometry(),I=Ba.types[this.type];function P(F){for(var B=0;B<F.length;B++){var G=F[B];F[B]=[360*(G.x+_)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(G.y+y)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var C=[];for(o=0;o<S.length;o++)C[o]=S[o][0];P(S=C);break;case 2:for(o=0;o<S.length;o++)P(S[o]);break;case 3:for(S=function(F){var B=F.length;if(B<=1)return[F];for(var G,K,te=[],he=0;he<B;he++){var re=Vx(F[he]);re!==0&&(K===void 0&&(K=re<0),K===re<0?(G&&te.push(G),G=[F[he]]):G.push(F[he]))}return G&&te.push(G),te}(S),o=0;o<S.length;o++)for(u=0;u<S[o].length;u++)P(S[o][u])}S.length===1?S=S[0]:I="Multi"+I;var z={type:"Feature",geometry:{type:I,coordinates:S},properties:this.properties};return"id"in this&&(z.id=this.id),z};var $x=kf,Df=zf;function zf(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Ux,this,e),this.length=this._features.length}function Ux(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(o){for(var u=null,g=o.readVarint()+o.pos;o.pos<g;){var _=o.readVarint()>>3;u=_===1?o.readString():_===2?o.readFloat():_===3?o.readDouble():_===4?o.readVarint64():_===5?o.readVarint():_===6?o.readSVarint():_===7?o.readBoolean():null}return u}(r))}zf.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new $x(this._pbf,e,this.extent,this._keys,this._values)};var jx=Df;function qx(i,e,r){if(i===3){var o=new jx(r,r.readVarint()+r.pos);o.length&&(e[o.name]=o)}}js.VectorTile=function(i,e){this.layers=i.readFields(qx,{},e)},js.VectorTileFeature=kf,js.VectorTileLayer=Df;const Gx=js.VectorTileFeature.types,vd=Math.pow(2,13);function Jl(i,e,r,o,u,g,_,y){i.emplaceBack(e,r,2*Math.floor(o*vd)+_,u*vd*2,g*vd*2,Math.round(y))}class bd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Z,this.centroidVertexArray=new k,this.indexArray=new be,this.programConfigurations=new ki(e.layers,e.zoom),this.segments=new je,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){this.features=[],this.hasPattern=_d("fill-extrusion",this.layers,r);for(const{feature:u,id:g,index:_,sourceLayerIndex:y}of e){const S=this.layers[0]._featureFilter.needGeometry,I=ys(u,S);if(!this.layers[0]._featureFilter.filter(new Ai(this.zoom),I,o))continue;const P={id:g,sourceLayerIndex:y,index:_,geometry:S?I.geometry:_s(u),properties:u.properties,type:u.type,patterns:{}};this.hasPattern?this.features.push(yd("fill-extrusion",this.layers,P,this.zoom,r)):this.addFeature(P,P.geometry,_,o,{}),r.featureIndex.insert(u,P.geometry,_,y,this.index,!0)}}addFeatures(e,r,o){for(const u of this.features){const{geometry:g}=u;this.addFeature(u,g,u.index,r,o)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ox),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Fx.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,o,u,g){const _={x:0,y:0,vertexCount:0};for(const y of gd(r,500)){let S=0;for(const B of y)S+=B.length;let I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const B of y){if(B.length===0||Zx(B))continue;let G=0;for(let K=0;K<B.length;K++){const te=B[K];if(K>=1){const he=B[K-1];if(!Hx(te,he)){I.vertexLength+4>je.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const re=te.sub(he)._perp()._unit(),le=he.dist(te);G+le>32768&&(G=0),Jl(this.layoutVertexArray,te.x,te.y,re.x,re.y,0,0,G),Jl(this.layoutVertexArray,te.x,te.y,re.x,re.y,0,1,G),_.x+=2*te.x,_.y+=2*te.y,_.vertexCount+=2,G+=le,Jl(this.layoutVertexArray,he.x,he.y,re.x,re.y,0,0,G),Jl(this.layoutVertexArray,he.x,he.y,re.x,re.y,0,1,G),_.x+=2*he.x,_.y+=2*he.y,_.vertexCount+=2;const we=I.vertexLength;this.indexArray.emplaceBack(we,we+2,we+1),this.indexArray.emplaceBack(we+1,we+2,we+3),I.vertexLength+=4,I.primitiveLength+=2}}}}if(I.vertexLength+S>je.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray)),Gx[e.type]!=="Polygon")continue;const P=[],C=[],z=I.vertexLength;for(const B of y)if(B.length!==0){B!==y[0]&&C.push(P.length/2);for(let G=0;G<B.length;G++){const K=B[G];Jl(this.layoutVertexArray,K.x,K.y,0,0,1,1,0),_.x+=K.x,_.y+=K.y,_.vertexCount+=1,P.push(K.x),P.push(K.y)}}const F=Ef(P,C);for(let B=0;B<F.length;B+=3)this.indexArray.emplaceBack(z+F[B],z+F[B+2],z+F[B+1]);I.primitiveLength+=F.length/3,I.vertexLength+=S}for(let y=0;y<_.vertexCount;y++)this.centroidVertexArray.emplaceBack(Math.floor(_.x/_.vertexCount),Math.floor(_.y/_.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,g,u)}}function Hx(i,e){return i.x===e.x&&(i.x<0||i.x>Bi)||i.y===e.y&&(i.y<0||i.y>Bi)}function Zx(i){return i.every(e=>e.x<0)||i.every(e=>e.x>Bi)||i.every(e=>e.y<0)||i.every(e=>e.y>Bi)}let Rf;it("FillExtrusionBucket",bd,{omit:["layers","features"]});var Wx={get paint(){return Rf=Rf||new Lr({"fill-extrusion-opacity":new ut(ee["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new yt(ee["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ut(ee["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ut(ee["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Aa(ee["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new yt(ee["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new yt(ee["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ut(ee["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Kx extends mn{constructor(e){super(e,Wx)}createBucket(e){return new bd(e)}queryRadius(){return Tu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,r,o,u,g,_,y,S){const I=Au(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_.angle,y),P=this.paint.get("fill-extrusion-height").evaluate(r,o),C=this.paint.get("fill-extrusion-base").evaluate(r,o),z=function(B,G,K,te){const he=[];for(const re of B){const le=[re.x,re.y,0,1];Iu(le,le,G),he.push(new N(le[0]/le[3],le[1]/le[3]))}return he}(I,S),F=function(B,G,K,te){const he=[],re=[],le=te[8]*G,we=te[9]*G,Ee=te[10]*G,Ye=te[11]*G,st=te[8]*K,Xe=te[9]*K,Ze=te[10]*K,$e=te[11]*K;for(const rt of B){const He=[],Le=[];for(const mt of rt){const lt=mt.x,Ut=mt.y,vi=te[0]*lt+te[4]*Ut+te[12],Ei=te[1]*lt+te[5]*Ut+te[13],ir=te[2]*lt+te[6]*Ut+te[14],on=te[3]*lt+te[7]*Ut+te[15],Or=ir+Ee,Ki=on+Ye,dr=vi+st,xr=Ei+Xe,Br=ir+Ze,Nr=on+$e,rr=new N((vi+le)/Ki,(Ei+we)/Ki);rr.z=Or/Ki,He.push(rr);const nr=new N(dr/Nr,xr/Nr);nr.z=Br/Nr,Le.push(nr)}he.push(He),re.push(Le)}return[he,re]}(u,C,P,S);return function(B,G,K){let te=1/0;Ul(K,G)&&(te=Lf(K,G[0]));for(let he=0;he<G.length;he++){const re=G[he],le=B[he];for(let we=0;we<re.length-1;we++){const Ee=re[we],Ye=[Ee,re[we+1],le[we+1],le[we],Ee];$l(K,Ye)&&(te=Math.min(te,Lf(K,Ye)))}}return te!==1/0&&te}(F[0],F[1],z)}}function Ql(i,e){return i.x*e.x+i.y*e.y}function Lf(i,e){if(i.length===1){let r=0;const o=e[r++];let u;for(;!u||o.equals(u);)if(u=e[r++],!u)return 1/0;for(;r<e.length;r++){const g=e[r],_=i[0],y=u.sub(o),S=g.sub(o),I=_.sub(o),P=Ql(y,y),C=Ql(y,S),z=Ql(S,S),F=Ql(I,y),B=Ql(I,S),G=P*z-C*C,K=(z*F-C*B)/G,te=(P*B-C*F)/G,he=o.z*(1-K-te)+u.z*K+g.z*te;if(isFinite(he))return he}return 1/0}{let r=1/0;for(const o of e)r=Math.min(r,o.z);return r}}const Xx=Ui([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Yx}=Xx,Jx=Ui([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Qx}=Jx,ev=js.VectorTileFeature.types,tv=Math.cos(Math.PI/180*37.5),Ff=Math.pow(2,14)/.5;class wd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Y,this.layoutVertexArray2=new q,this.indexArray=new be,this.programConfigurations=new ki(e.layers,e.zoom),this.segments=new je,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){this.hasPattern=_d("line",this.layers,r);const u=this.layers[0].layout.get("line-sort-key"),g=!u.isConstant(),_=[];for(const{feature:y,id:S,index:I,sourceLayerIndex:P}of e){const C=this.layers[0]._featureFilter.needGeometry,z=ys(y,C);if(!this.layers[0]._featureFilter.filter(new Ai(this.zoom),z,o))continue;const F=g?u.evaluate(z,{},o):void 0,B={id:S,properties:y.properties,type:y.type,sourceLayerIndex:P,index:I,geometry:C?z.geometry:_s(y),patterns:{},sortKey:F};_.push(B)}g&&_.sort((y,S)=>y.sortKey-S.sortKey);for(const y of _){const{geometry:S,index:I,sourceLayerIndex:P}=y;if(this.hasPattern){const C=yd("line",this.layers,y,this.zoom,r);this.patternFeatures.push(C)}else this.addFeature(y,S,I,o,{});r.featureIndex.insert(e[I].feature,S,I,P,this.index)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,o)}addFeatures(e,r,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,r,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Qx)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Yx),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,o,u,g){const _=this.layers[0].layout,y=_.get("line-join").evaluate(e,{}),S=_.get("line-cap"),I=_.get("line-miter-limit"),P=_.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const C of r)this.addLine(C,e,y,S,I,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,g,u)}addLine(e,r,o,u,g,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let te=0;te<e.length-1;te++)this.totalDistance+=e[te].dist(e[te+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y=ev[r.type]==="Polygon";let S=e.length;for(;S>=2&&e[S-1].equals(e[S-2]);)S--;let I=0;for(;I<S-1&&e[I].equals(e[I+1]);)I++;if(S<(y?3:2))return;o==="bevel"&&(g=1.05);const P=this.overscaling<=16?15*Bi/(512*this.overscaling):0,C=this.segments.prepareSegment(10*S,this.layoutVertexArray,this.indexArray);let z,F,B,G,K;this.e1=this.e2=-1,y&&(z=e[S-2],K=e[I].sub(z)._unit()._perp());for(let te=I;te<S;te++){if(B=te===S-1?y?e[I+1]:void 0:e[te+1],B&&e[te].equals(B))continue;K&&(G=K),z&&(F=z),z=e[te],K=B?B.sub(z)._unit()._perp():G,G=G||K;let he=G.add(K);he.x===0&&he.y===0||he._unit();const re=G.x*K.x+G.y*K.y,le=he.x*K.x+he.y*K.y,we=le!==0?1/le:1/0,Ee=2*Math.sqrt(2-2*le),Ye=le<tv&&F&&B,st=G.x*K.y-G.y*K.x>0;if(Ye&&te>I){const $e=z.dist(F);if($e>2*P){const rt=z.sub(z.sub(F)._mult(P/$e)._round());this.updateDistance(F,rt),this.addCurrentVertex(rt,G,0,0,C),F=rt}}const Xe=F&&B;let Ze=Xe?o:y?"butt":u;if(Xe&&Ze==="round"&&(we<_?Ze="miter":we<=2&&(Ze="fakeround")),Ze==="miter"&&we>g&&(Ze="bevel"),Ze==="bevel"&&(we>2&&(Ze="flipbevel"),we<g&&(Ze="miter")),F&&this.updateDistance(F,z),Ze==="miter")he._mult(we),this.addCurrentVertex(z,he,0,0,C);else if(Ze==="flipbevel"){if(we>100)he=K.mult(-1);else{const $e=we*G.add(K).mag()/G.sub(K).mag();he._perp()._mult($e*(st?-1:1))}this.addCurrentVertex(z,he,0,0,C),this.addCurrentVertex(z,he.mult(-1),0,0,C)}else if(Ze==="bevel"||Ze==="fakeround"){const $e=-Math.sqrt(we*we-1),rt=st?$e:0,He=st?0:$e;if(F&&this.addCurrentVertex(z,G,rt,He,C),Ze==="fakeround"){const Le=Math.round(180*Ee/Math.PI/20);for(let mt=1;mt<Le;mt++){let lt=mt/Le;if(lt!==.5){const vi=lt-.5;lt+=lt*vi*(lt-1)*((1.0904+re*(re*(3.55645-1.43519*re)-3.2452))*vi*vi+(.848013+re*(.215638*re-1.06021)))}const Ut=K.sub(G)._mult(lt)._add(G)._unit()._mult(st?-1:1);this.addHalfVertex(z,Ut.x,Ut.y,!1,st,0,C)}}B&&this.addCurrentVertex(z,K,-rt,-He,C)}else if(Ze==="butt")this.addCurrentVertex(z,he,0,0,C);else if(Ze==="square"){const $e=F?1:-1;this.addCurrentVertex(z,he,$e,$e,C)}else Ze==="round"&&(F&&(this.addCurrentVertex(z,G,0,0,C),this.addCurrentVertex(z,G,1,1,C,!0)),B&&(this.addCurrentVertex(z,K,-1,-1,C,!0),this.addCurrentVertex(z,K,0,0,C)));if(Ye&&te<S-1){const $e=z.dist(B);if($e>2*P){const rt=z.add(B.sub(z)._mult(P/$e)._round());this.updateDistance(z,rt),this.addCurrentVertex(rt,K,0,0,C),z=rt}}}}addCurrentVertex(e,r,o,u,g,_=!1){const y=r.y*u-r.x,S=-r.y-r.x*u;this.addHalfVertex(e,r.x+r.y*o,r.y-r.x*o,_,!1,o,g),this.addHalfVertex(e,y,S,_,!0,-u,g),this.distance>Ff/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,r,o,u,g,_))}addHalfVertex({x:e,y:r},o,u,g,_,y,S){const I=.5*(this.lineClips?this.scaledDistance*(Ff-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(g?1:0),(r<<1)+(_?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(y===0?0:y<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const P=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,P),S.primitiveLength++),_?this.e2=P:this.e1=P}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}let Of,Bf;it("LineBucket",wd,{omit:["layers","patternFeatures"]});var Nf={get paint(){return Bf=Bf||new Lr({"line-opacity":new yt(ee.paint_line["line-opacity"]),"line-color":new yt(ee.paint_line["line-color"]),"line-translate":new ut(ee.paint_line["line-translate"]),"line-translate-anchor":new ut(ee.paint_line["line-translate-anchor"]),"line-width":new yt(ee.paint_line["line-width"]),"line-gap-width":new yt(ee.paint_line["line-gap-width"]),"line-offset":new yt(ee.paint_line["line-offset"]),"line-blur":new yt(ee.paint_line["line-blur"]),"line-dasharray":new Io(ee.paint_line["line-dasharray"]),"line-pattern":new Aa(ee.paint_line["line-pattern"]),"line-gradient":new kl(ee.paint_line["line-gradient"])})},get layout(){return Of=Of||new Lr({"line-cap":new ut(ee.layout_line["line-cap"]),"line-join":new yt(ee.layout_line["line-join"]),"line-miter-limit":new ut(ee.layout_line["line-miter-limit"]),"line-round-limit":new ut(ee.layout_line["line-round-limit"]),"line-sort-key":new yt(ee.layout_line["line-sort-key"])})}};class iv extends yt{possiblyEvaluate(e,r){return r=new Ai(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,o,u){return r=xt({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,o,u)}}let ku;class rv extends mn{constructor(e){super(e,Nf),this.gradientVersion=0,ku||(ku=new iv(Nf.paint.properties["line-width"].specification),ku.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(o){return o._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof yo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,r){super.recalculate(e,r),this.paint._values["line-floorwidth"]=ku.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new wd(e)}queryRadius(e){const r=e,o=Vf(Gl("line-width",this,r),Gl("line-gap-width",this,r)),u=Gl("line-offset",this,r);return o/2+Math.abs(u)+Tu(this.paint.get("line-translate"))}queryIntersectsFeature(e,r,o,u,g,_,y){const S=Au(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_.angle,y),I=y/2*Vf(this.paint.get("line-width").evaluate(r,o),this.paint.get("line-gap-width").evaluate(r,o)),P=this.paint.get("line-offset").evaluate(r,o);return P&&(u=function(C,z){const F=[];for(let B=0;B<C.length;B++){const G=C[B],K=[];for(let te=0;te<G.length;te++){const he=G[te-1],re=G[te],le=G[te+1],we=te===0?new N(0,0):re.sub(he)._unit()._perp(),Ee=te===G.length-1?new N(0,0):le.sub(re)._unit()._perp(),Ye=we._add(Ee)._unit(),st=Ye.x*Ee.x+Ye.y*Ee.y;st!==0&&Ye._mult(1/st),K.push(Ye._mult(z)._add(re))}F.push(K)}return F}(u,P*y)),function(C,z,F){for(let B=0;B<z.length;B++){const G=z[B];if(C.length>=3){for(let K=0;K<G.length;K++)if(La(C,G[K]))return!0}if(jl(C,G,F))return!0}return!1}(S,u,I)}isTileClipped(){return!0}}function Vf(i,e){return e>0?e+2*i:i}const nv=Ui([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),sv=Ui([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ui([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const ov=Ui([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Ui([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const $f=Ui([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),av=Ui([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function lv(i,e,r){return i.sections.forEach(o=>{o.text=function(u,g,_){const y=g.layout.get("text-transform").evaluate(_,{});return y==="uppercase"?u=u.toLocaleUpperCase():y==="lowercase"&&(u=u.toLocaleLowerCase()),Wn.applyArabicShaping&&(u=Wn.applyArabicShaping(u)),u}(o.text,e,r)}),i}Ui([{name:"triangle",components:3,type:"Uint16"}]),Ui([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ui([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Ui([{type:"Float32",name:"offsetX"}]),Ui([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Ui([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const ec={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var tr=24,Uf=mi,jf=function(i,e,r,o,u){var g,_,y=8*u-o-1,S=(1<<y)-1,I=S>>1,P=-7,C=r?u-1:0,z=r?-1:1,F=i[e+C];for(C+=z,g=F&(1<<-P)-1,F>>=-P,P+=y;P>0;g=256*g+i[e+C],C+=z,P-=8);for(_=g&(1<<-P)-1,g>>=-P,P+=o;P>0;_=256*_+i[e+C],C+=z,P-=8);if(g===0)g=1-I;else{if(g===S)return _?NaN:1/0*(F?-1:1);_+=Math.pow(2,o),g-=I}return(F?-1:1)*_*Math.pow(2,g-o)},qf=function(i,e,r,o,u,g){var _,y,S,I=8*g-u-1,P=(1<<I)-1,C=P>>1,z=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,F=o?0:g-1,B=o?1:-1,G=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,_=P):(_=Math.floor(Math.log(e)/Math.LN2),e*(S=Math.pow(2,-_))<1&&(_--,S*=2),(e+=_+C>=1?z/S:z*Math.pow(2,1-C))*S>=2&&(_++,S/=2),_+C>=P?(y=0,_=P):_+C>=1?(y=(e*S-1)*Math.pow(2,u),_+=C):(y=e*Math.pow(2,C-1)*Math.pow(2,u),_=0));u>=8;i[r+F]=255&y,F+=B,y/=256,u-=8);for(_=_<<u|y,I+=u;I>0;i[r+F]=255&_,F+=B,_/=256,I-=8);i[r+F-B]|=128*G};function mi(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}mi.Varint=0,mi.Fixed64=1,mi.Bytes=2,mi.Fixed32=5;var Sd=4294967296,Gf=1/Sd,Hf=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function xs(i){return i.type===mi.Bytes?i.readVarint()+i.pos:i.pos+1}function Na(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Zf(i,e,r){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(o);for(var u=r.pos-1;u>=i;u--)r.buf[u+o]=r.buf[u]}function cv(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function uv(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function hv(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function dv(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function pv(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function fv(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function mv(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function gv(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function _v(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function Du(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Va(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function Wf(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}mi.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var o=this.readVarint(),u=o>>3,g=this.pos;this.type=7&o,i(u,e,this),this.pos===g&&this.skip(o)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=Du(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Wf(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Du(this.buf,this.pos)+Du(this.buf,this.pos+4)*Sd;return this.pos+=8,i},readSFixed64:function(){var i=Du(this.buf,this.pos)+Wf(this.buf,this.pos+4)*Sd;return this.pos+=8,i},readFloat:function(){var i=jf(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=jf(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,o=this.buf;return e=127&(r=o[this.pos++]),r<128?e:(e|=(127&(r=o[this.pos++]))<<7,r<128?e:(e|=(127&(r=o[this.pos++]))<<14,r<128?e:(e|=(127&(r=o[this.pos++]))<<21,r<128?e:function(u,g,_){var y,S,I=_.buf;if(y=(112&(S=I[_.pos++]))>>4,S<128||(y|=(127&(S=I[_.pos++]))<<3,S<128)||(y|=(127&(S=I[_.pos++]))<<10,S<128)||(y|=(127&(S=I[_.pos++]))<<17,S<128)||(y|=(127&(S=I[_.pos++]))<<24,S<128)||(y|=(1&(S=I[_.pos++]))<<31,S<128))return Na(u,y,g);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=o[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&Hf?function(r,o,u){return Hf.decode(r.subarray(o,u))}(this.buf,e,i):function(r,o,u){for(var g="",_=o;_<u;){var y,S,I,P=r[_],C=null,z=P>239?4:P>223?3:P>191?2:1;if(_+z>u)break;z===1?P<128&&(C=P):z===2?(192&(y=r[_+1]))==128&&(C=(31&P)<<6|63&y)<=127&&(C=null):z===3?(S=r[_+2],(192&(y=r[_+1]))==128&&(192&S)==128&&((C=(15&P)<<12|(63&y)<<6|63&S)<=2047||C>=55296&&C<=57343)&&(C=null)):z===4&&(S=r[_+2],I=r[_+3],(192&(y=r[_+1]))==128&&(192&S)==128&&(192&I)==128&&((C=(15&P)<<18|(63&y)<<12|(63&S)<<6|63&I)<=65535||C>=1114112)&&(C=null)),C===null?(C=65533,z=1):C>65535&&(C-=65536,g+=String.fromCharCode(C>>>10&1023|55296),C=56320|1023&C),g+=String.fromCharCode(C),_+=z}return g}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==mi.Bytes)return i.push(this.readVarint(e));var r=xs(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==mi.Bytes)return i.push(this.readSVarint());var e=xs(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==mi.Bytes)return i.push(this.readBoolean());var e=xs(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==mi.Bytes)return i.push(this.readFloat());var e=xs(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==mi.Bytes)return i.push(this.readDouble());var e=xs(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==mi.Bytes)return i.push(this.readFixed32());var e=xs(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==mi.Bytes)return i.push(this.readSFixed32());var e=xs(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==mi.Bytes)return i.push(this.readFixed64());var e=xs(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==mi.Bytes)return i.push(this.readSFixed64());var e=xs(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===mi.Varint)for(;this.buf[this.pos++]>127;);else if(e===mi.Bytes)this.pos=this.readVarint()+this.pos;else if(e===mi.Fixed32)this.pos+=4;else{if(e!==mi.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Va(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Va(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Va(this.buf,-1&i,this.pos),Va(this.buf,Math.floor(i*Gf),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Va(this.buf,-1&i,this.pos),Va(this.buf,Math.floor(i*Gf),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var o,u;if(e>=0?(o=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(o=~(-e%4294967296))?o=o+1|0:(o=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(g,_,y){y.buf[y.pos++]=127&g|128,g>>>=7,y.buf[y.pos++]=127&g|128,g>>>=7,y.buf[y.pos++]=127&g|128,g>>>=7,y.buf[y.pos++]=127&g|128,y.buf[y.pos]=127&(g>>>=7)}(o,0,r),function(g,_){var y=(7&g)<<4;_.buf[_.pos++]|=y|((g>>>=3)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g)))))}(u,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(o,u,g){for(var _,y,S=0;S<u.length;S++){if((_=u.charCodeAt(S))>55295&&_<57344){if(!y){_>56319||S+1===u.length?(o[g++]=239,o[g++]=191,o[g++]=189):y=_;continue}if(_<56320){o[g++]=239,o[g++]=191,o[g++]=189,y=_;continue}_=y-55296<<10|_-56320|65536,y=null}else y&&(o[g++]=239,o[g++]=191,o[g++]=189,y=null);_<128?o[g++]=_:(_<2048?o[g++]=_>>6|192:(_<65536?o[g++]=_>>12|224:(o[g++]=_>>18|240,o[g++]=_>>12&63|128),o[g++]=_>>6&63|128),o[g++]=63&_|128)}return g}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&Zf(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),qf(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),qf(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var o=this.pos-r;o>=128&&Zf(r,o,this),this.pos=r-1,this.writeVarint(o),this.pos+=o},writeMessage:function(i,e,r){this.writeTag(i,mi.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,cv,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,uv,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,pv,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,hv,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,dv,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,fv,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,mv,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,gv,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,_v,e)},writeBytesField:function(i,e){this.writeTag(i,mi.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,mi.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,mi.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,mi.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,mi.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,mi.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,mi.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,mi.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,mi.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,mi.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};var Td=L(Uf);const Ad=3;function yv(i,e,r){i===1&&r.readMessage(xv,e)}function xv(i,e,r){if(i===3){const{id:o,bitmap:u,width:g,height:_,left:y,top:S,advance:I}=r.readMessage(vv,{});e.push({id:o,bitmap:new Zl({width:g+2*Ad,height:_+2*Ad},u),metrics:{width:g,height:_,left:y,top:S,advance:I}})}}function vv(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}const Kf=Ad;function Xf(i){let e=0,r=0;for(const _ of i)e+=_.w*_.h,r=Math.max(r,_.w);i.sort((_,y)=>y.h-_.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let u=0,g=0;for(const _ of i)for(let y=o.length-1;y>=0;y--){const S=o[y];if(!(_.w>S.w||_.h>S.h)){if(_.x=S.x,_.y=S.y,g=Math.max(g,_.y+_.h),u=Math.max(u,_.x+_.w),_.w===S.w&&_.h===S.h){const I=o.pop();y<o.length&&(o[y]=I)}else _.h===S.h?(S.x+=_.w,S.w-=_.w):_.w===S.w?(S.y+=_.h,S.h-=_.h):(o.push({x:S.x+_.w,y:S.y,w:S.w-_.w,h:_.h}),S.y+=_.h,S.h-=_.h);break}}return{w:u,h:g,fill:e/(u*g)||0}}const Wr=1;class Id{constructor(e,{pixelRatio:r,version:o,stretchX:u,stretchY:g,content:_}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=u,this.stretchY=g,this.content=_,this.version=o}get tl(){return[this.paddedRect.x+Wr,this.paddedRect.y+Wr]}get br(){return[this.paddedRect.x+this.paddedRect.w-Wr,this.paddedRect.y+this.paddedRect.h-Wr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Wr)/this.pixelRatio,(this.paddedRect.h-2*Wr)/this.pixelRatio]}}class Yf{constructor(e,r){const o={},u={};this.haveRenderCallbacks=[];const g=[];this.addImages(e,o,g),this.addImages(r,u,g);const{w:_,h:y}=Xf(g),S=new gn({width:_||1,height:y||1});for(const I in e){const P=e[I],C=o[I].paddedRect;gn.copy(P.data,S,{x:0,y:0},{x:C.x+Wr,y:C.y+Wr},P.data)}for(const I in r){const P=r[I],C=u[I].paddedRect,z=C.x+Wr,F=C.y+Wr,B=P.data.width,G=P.data.height;gn.copy(P.data,S,{x:0,y:0},{x:z,y:F},P.data),gn.copy(P.data,S,{x:0,y:G-1},{x:z,y:F-1},{width:B,height:1}),gn.copy(P.data,S,{x:0,y:0},{x:z,y:F+G},{width:B,height:1}),gn.copy(P.data,S,{x:B-1,y:0},{x:z-1,y:F},{width:1,height:G}),gn.copy(P.data,S,{x:0,y:0},{x:z+B,y:F},{width:1,height:G})}this.image=S,this.iconPositions=o,this.patternPositions=u}addImages(e,r,o){for(const u in e){const g=e[u],_={x:0,y:0,w:g.data.width+2*Wr,h:g.data.height+2*Wr};o.push(_),r[u]=new Id(_,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),r),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),r)}patchUpdatedImage(e,r,o){if(!e||!r||e.version===r.version)return;e.version=r.version;const[u,g]=e.tl;o.update(r.data,void 0,{x:u,y:g})}}var qs;it("ImagePosition",Id),it("ImageAtlas",Yf),v.ah=void 0,(qs=v.ah||(v.ah={}))[qs.none=0]="none",qs[qs.horizontal=1]="horizontal",qs[qs.vertical=2]="vertical",qs[qs.horizontalOnly=3]="horizontalOnly";const tc=-17;class ic{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const o=new ic;return o.scale=e||1,o.fontStack=r,o}static forImage(e){const r=new ic;return r.imageName=e,r}}class $a{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const o=new $a;for(let u=0;u<e.sections.length;u++){const g=e.sections[u];g.image?o.addImageSection(g):o.addTextSection(g,r)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let o=0;o<e.length;o++){const u=e.charCodeAt(o+1)||null,g=e.charCodeAt(o-1)||null;r+=u&&Cl(u)&&!ec[e[o+1]]||g&&Cl(g)&&!ec[e[o-1]]||!ec[e[o]]?e[o]:ec[e[o]]}return r}(this.text)}trim(){let e=0;for(let o=0;o<this.text.length&&Ru[this.text.charCodeAt(o)];o++)e++;let r=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&Ru[this.text.charCodeAt(o)];o--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const o=new $a;return o.text=this.text.substring(e,r),o.sectionIndex=this.sectionIndex.slice(e,r),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(ic.forText(e.scale,e.fontStack||r));const o=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(o)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void Bt("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(ic.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Bt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function zu(i,e,r,o,u,g,_,y,S,I,P,C,z,F,B,G){const K=$a.fromFeature(i,u);let te;C===v.ah.vertical&&K.verticalizePunctuation();const{processBidirectionalText:he,processStyledBidirectionalText:re}=Wn;if(he&&K.sections.length===1){te=[];const Ee=he(K.toString(),Ed(K,I,g,e,o,F,B));for(const Ye of Ee){const st=new $a;st.text=Ye,st.sections=K.sections;for(let Xe=0;Xe<Ye.length;Xe++)st.sectionIndex.push(0);te.push(st)}}else if(re){te=[];const Ee=re(K.text,K.sectionIndex,Ed(K,I,g,e,o,F,B));for(const Ye of Ee){const st=new $a;st.text=Ye[0],st.sectionIndex=Ye[1],st.sections=K.sections,te.push(st)}}else te=function(Ee,Ye){const st=[],Xe=Ee.text;let Ze=0;for(const $e of Ye)st.push(Ee.substring(Ze,$e)),Ze=$e;return Ze<Xe.length&&st.push(Ee.substring(Ze,Xe.length)),st}(K,Ed(K,I,g,e,o,F,B));const le=[],we={positionedLines:le,text:K.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:C,iconsInText:!1,verticalizable:!1};return function(Ee,Ye,st,Xe,Ze,$e,rt,He,Le,mt,lt,Ut){let vi=0,Ei=tc,ir=0,on=0;const Or=He==="right"?1:He==="left"?0:.5;let Ki=0;for(const rr of Ze){rr.trim();const nr=rr.getMaxScale(),Ir=(nr-1)*tr,Vr={positionedGlyphs:[],lineOffset:0};Ee.positionedLines[Ki]=Vr;const Er=Vr.positionedGlyphs;let Kr=0;if(!rr.length()){Ei+=$e,++Ki;continue}for(let sr=0;sr<rr.length();sr++){const Ht=rr.getSection(sr),Pr=rr.getSectionIndex(sr),vr=rr.getCharCode(sr);let or=0,Pn=null,Rn=null,Ln=null,vs=tr;const Cn=!(Le===v.ah.horizontal||!lt&&!wa(vr)||lt&&(Ru[vr]||(dr=vr,Ke.Arabic(dr)||Ke["Arabic Supplement"](dr)||Ke["Arabic Extended-A"](dr)||Ke["Arabic Presentation Forms-A"](dr)||Ke["Arabic Presentation Forms-B"](dr))));if(Ht.imageName){const yn=Xe[Ht.imageName];if(!yn)continue;Ln=Ht.imageName,Ee.iconsInText=Ee.iconsInText||!0,Rn=yn.paddedRect;const Yr=yn.displaySize;Ht.scale=Ht.scale*tr/Ut,Pn={width:Yr[0],height:Yr[1],left:Wr,top:-Kf,advance:Cn?Yr[1]:Yr[0]},or=Ir+(tr-Yr[1]*Ht.scale),vs=Pn.advance;const bs=Cn?Yr[0]*Ht.scale-tr*nr:Yr[1]*Ht.scale-tr*nr;bs>0&&bs>Kr&&(Kr=bs)}else{const yn=st[Ht.fontStack],Yr=yn&&yn[vr];if(Yr&&Yr.rect)Rn=Yr.rect,Pn=Yr.metrics;else{const bs=Ye[Ht.fontStack],ac=bs&&bs[vr];if(!ac)continue;Pn=ac.metrics}or=(nr-Ht.scale)*tr}Cn?(Ee.verticalizable=!0,Er.push({glyph:vr,imageName:Ln,x:vi,y:Ei+or,vertical:Cn,scale:Ht.scale,fontStack:Ht.fontStack,sectionIndex:Pr,metrics:Pn,rect:Rn}),vi+=vs*Ht.scale+mt):(Er.push({glyph:vr,imageName:Ln,x:vi,y:Ei+or,vertical:Cn,scale:Ht.scale,fontStack:Ht.fontStack,sectionIndex:Pr,metrics:Pn,rect:Rn}),vi+=Pn.advance*Ht.scale+mt)}Er.length!==0&&(ir=Math.max(vi-mt,ir),Sv(Er,0,Er.length-1,Or,Kr)),vi=0;const Xr=$e*nr+Kr;Vr.lineOffset=Math.max(Kr,Ir),Ei+=Xr,on=Math.max(Xr,on),++Ki}var dr;const xr=Ei-tc,{horizontalAlign:Br,verticalAlign:Nr}=Pd(rt);(function(rr,nr,Ir,Vr,Er,Kr,Xr,sr,Ht){const Pr=(nr-Ir)*Er;let vr=0;vr=Kr!==Xr?-sr*Vr-tc:(-Vr*Ht+.5)*Xr;for(const or of rr)for(const Pn of or.positionedGlyphs)Pn.x+=Pr,Pn.y+=vr})(Ee.positionedLines,Or,Br,Nr,ir,on,$e,xr,Ze.length),Ee.top+=-Nr*xr,Ee.bottom=Ee.top+xr,Ee.left+=-Br*ir,Ee.right=Ee.left+ir}(we,e,r,o,te,_,y,S,C,I,z,G),!function(Ee){for(const Ye of Ee)if(Ye.positionedGlyphs.length!==0)return!1;return!0}(le)&&we}const Ru={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},bv={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Jf(i,e,r,o,u,g){if(e.imageName){const _=o[e.imageName];return _?_.displaySize[0]*e.scale*tr/g+u:0}{const _=r[e.fontStack],y=_&&_[i];return y?y.metrics.advance*e.scale+u:0}}function Qf(i,e,r,o){const u=Math.pow(i-e,2);return o?i<e?u/2:2*u:u+Math.abs(r)*r}function wv(i,e,r){let o=0;return i===10&&(o-=1e4),r&&(o+=150),i!==40&&i!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function em(i,e,r,o,u,g){let _=null,y=Qf(e,r,u,g);for(const S of o){const I=Qf(e-S.x,r,u,g)+S.badness;I<=y&&(_=S,y=I)}return{index:i,x:e,priorBreak:_,badness:y}}function tm(i){return i?tm(i.priorBreak).concat(i.index):[]}function Ed(i,e,r,o,u,g,_){if(g!=="point")return[];if(!i)return[];const y=[],S=function(z,F,B,G,K,te){let he=0;for(let re=0;re<z.length();re++){const le=z.getSection(re);he+=Jf(z.getCharCode(re),le,G,K,F,te)}return he/Math.max(1,Math.ceil(he/B))}(i,e,r,o,u,_),I=i.text.indexOf("​")>=0;let P=0;for(let z=0;z<i.length();z++){const F=i.getSection(z),B=i.getCharCode(z);if(Ru[B]||(P+=Jf(B,F,o,u,e,_)),z<i.length()-1){const G=!((C=B)<11904||!(Ke["Bopomofo Extended"](C)||Ke.Bopomofo(C)||Ke["CJK Compatibility Forms"](C)||Ke["CJK Compatibility Ideographs"](C)||Ke["CJK Compatibility"](C)||Ke["CJK Radicals Supplement"](C)||Ke["CJK Strokes"](C)||Ke["CJK Symbols and Punctuation"](C)||Ke["CJK Unified Ideographs Extension A"](C)||Ke["CJK Unified Ideographs"](C)||Ke["Enclosed CJK Letters and Months"](C)||Ke["Halfwidth and Fullwidth Forms"](C)||Ke.Hiragana(C)||Ke["Ideographic Description Characters"](C)||Ke["Kangxi Radicals"](C)||Ke["Katakana Phonetic Extensions"](C)||Ke.Katakana(C)||Ke["Vertical Forms"](C)||Ke["Yi Radicals"](C)||Ke["Yi Syllables"](C)));(bv[B]||G||F.imageName)&&y.push(em(z+1,P,S,y,wv(B,i.getCharCode(z+1),G&&I),!1))}}var C;return tm(em(i.length(),P,S,y,0,!0))}function Pd(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Sv(i,e,r,o,u){if(!o&&!u)return;const g=i[r],_=(i[r].x+g.metrics.advance*g.scale)*o;for(let y=e;y<=r;y++)i[y].x-=_,i[y].y+=u}function Tv(i,e,r){const{horizontalAlign:o,verticalAlign:u}=Pd(r),g=e[0]-i.displaySize[0]*o,_=e[1]-i.displaySize[1]*u;return{image:i,top:_,bottom:_+i.displaySize[1],left:g,right:g+i.displaySize[0]}}function im(i,e,r,o,u,g){const _=i.image;let y;if(_.content){const K=_.content,te=_.pixelRatio||1;y=[K[0]/te,K[1]/te,_.displaySize[0]-K[2]/te,_.displaySize[1]-K[3]/te]}const S=e.left*g,I=e.right*g;let P,C,z,F;r==="width"||r==="both"?(F=u[0]+S-o[3],C=u[0]+I+o[1]):(F=u[0]+(S+I-_.displaySize[0])/2,C=F+_.displaySize[0]);const B=e.top*g,G=e.bottom*g;return r==="height"||r==="both"?(P=u[1]+B-o[0],z=u[1]+G+o[2]):(P=u[1]+(B+G-_.displaySize[1])/2,z=P+_.displaySize[1]),{image:_,top:P,right:C,bottom:z,left:F,collisionPadding:y}}const rc=255,Jn=128,Gs=rc*Jn;function rm(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Ai(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:u}=r;let g=0;for(;g<o.length&&o[g]<=i;)g++;g=Math.max(0,g-1);let _=g;for(;_<o.length&&o[_]<i+1;)_++;_=Math.min(o.length-1,_);const y=o[g],S=o[_];return r.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:S,interpolationType:u}:{kind:"camera",minZoom:y,maxZoom:S,minSize:r.evaluate(new Ai(y)),maxSize:r.evaluate(new Ai(S)),interpolationType:u}}}function Cd(i,e,r){let o="never";const u=i.get(e);return u?o=u:i.get(r)&&(o="always"),o}const Av=js.VectorTileFeature.types,Iv=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Lu(i,e,r,o,u,g,_,y,S,I,P,C,z){const F=y?Math.min(Gs,Math.round(y[0])):0,B=y?Math.min(Gs,Math.round(y[1])):0;i.emplaceBack(e,r,Math.round(32*o),Math.round(32*u),g,_,(F<<1)+(S?1:0),B,16*I,16*P,256*C,256*z)}function Md(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function Ev(i){for(const e of i.sections)if(ad(e.text))return!0;return!1}class kd{constructor(e){this.layoutVertexArray=new me,this.indexArray=new be,this.programConfigurations=e,this.segments=new je,this.dynamicLayoutVertexArray=new Q,this.opacityVertexArray=new ce,this.hasVisibleVertices=!1,this.placedSymbolArray=new s}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,o,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,nv.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,sv.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Iv,!0),this.opacityVertexBuffer.itemSize=1),(o||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}it("SymbolBuffers",kd);class Dd{constructor(e,r,o){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new o,this.segments=new je,this.collisionVertexArray=new xe}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,ov.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}it("CollisionBuffers",Dd);class Ua{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(_=>_.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=cd([]),this.placementViewportMatrix=cd([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=rm(this.zoom,r["text-size"]),this.iconSizeData=rm(this.zoom,r["icon-size"]);const o=this.layers[0].layout,u=o.get("symbol-sort-key"),g=o.get("symbol-z-order");this.canOverlap=Cd(o,"text-overlap","text-allow-overlap")!=="never"||Cd(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&!u.isConstant(),this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(_=>v.ah[_])),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=e.sourceID}createArrays(){this.text=new kd(new ki(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new kd(new ki(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new f,this.lineVertexArray=new b,this.symbolInstances=new c,this.textAnchorOffsets=new A}calculateGlyphDependencies(e,r,o,u,g){for(let _=0;_<e.length;_++)if(r[e.charCodeAt(_)]=!0,(o||u)&&g){const y=ec[e.charAt(_)];y&&(r[y.charCodeAt(0)]=!0)}}populate(e,r,o){const u=this.layers[0],g=u.layout,_=g.get("text-font"),y=g.get("text-field"),S=g.get("icon-image"),I=(y.value.kind!=="constant"||y.value.value instanceof jr&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&(_.value.kind!=="constant"||_.value.value.length>0),P=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,C=g.get("symbol-sort-key");if(this.features=[],!I&&!P)return;const z=r.iconDependencies,F=r.glyphDependencies,B=r.availableImages,G=new Ai(this.zoom);for(const{feature:K,id:te,index:he,sourceLayerIndex:re}of e){const le=u._featureFilter.needGeometry,we=ys(K,le);if(!u._featureFilter.filter(G,we,o))continue;let Ee,Ye;if(le||(we.geometry=_s(K)),I){const Xe=u.getValueAndResolveTokens("text-field",we,o,B),Ze=jr.factory(Xe),$e=this.hasRTLText=this.hasRTLText||Ev(Ze);(!$e||Wn.getRTLTextPluginStatus()==="unavailable"||$e&&Wn.isParsed())&&(Ee=lv(Ze,u,we))}if(P){const Xe=u.getValueAndResolveTokens("icon-image",we,o,B);Ye=Xe instanceof rn?Xe:rn.fromString(Xe)}if(!Ee&&!Ye)continue;const st=this.sortFeaturesByKey?C.evaluate(we,{},o):void 0;if(this.features.push({id:te,text:Ee,icon:Ye,index:he,sourceLayerIndex:re,geometry:we.geometry,properties:K.properties,type:Av[K.type],sortKey:st}),Ye&&(z[Ye.name]=!0),Ee){const Xe=_.evaluate(we,{},o).join(","),Ze=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(v.ah.vertical)>=0;for(const $e of Ee.sections)if($e.image)z[$e.image.name]=!0;else{const rt=$s(Ee.toString()),He=$e.fontStack||Xe,Le=F[He]=F[He]||{};this.calculateGlyphDependencies($e.text,Le,Ze,this.allowVerticalPlacement,rt)}}}g.get("symbol-placement")==="line"&&(this.features=function(K){const te={},he={},re=[];let le=0;function we(Xe){re.push(K[Xe]),le++}function Ee(Xe,Ze,$e){const rt=he[Xe];return delete he[Xe],he[Ze]=rt,re[rt].geometry[0].pop(),re[rt].geometry[0]=re[rt].geometry[0].concat($e[0]),rt}function Ye(Xe,Ze,$e){const rt=te[Ze];return delete te[Ze],te[Xe]=rt,re[rt].geometry[0].shift(),re[rt].geometry[0]=$e[0].concat(re[rt].geometry[0]),rt}function st(Xe,Ze,$e){const rt=$e?Ze[0][Ze[0].length-1]:Ze[0][0];return`${Xe}:${rt.x}:${rt.y}`}for(let Xe=0;Xe<K.length;Xe++){const Ze=K[Xe],$e=Ze.geometry,rt=Ze.text?Ze.text.toString():null;if(!rt){we(Xe);continue}const He=st(rt,$e),Le=st(rt,$e,!0);if(He in he&&Le in te&&he[He]!==te[Le]){const mt=Ye(He,Le,$e),lt=Ee(He,Le,re[mt].geometry);delete te[He],delete he[Le],he[st(rt,re[lt].geometry,!0)]=lt,re[mt].geometry=null}else He in he?Ee(He,Le,$e):Le in te?Ye(He,Le,$e):(we(Xe),te[He]=le-1,he[Le]=le-1)}return re.filter(Xe=>Xe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((K,te)=>K.sortKey-te.sortKey)}update(e,r,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,o),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const o=this.lineVertexArray.length;if(e.segment!==void 0){let u=e.dist(r[e.segment+1]),g=e.dist(r[e.segment]);const _={};for(let y=e.segment+1;y<r.length;y++)_[y]={x:r[y].x,y:r[y].y,tileUnitDistanceFromAnchor:u},y<r.length-1&&(u+=r[y+1].dist(r[y]));for(let y=e.segment||0;y>=0;y--)_[y]={x:r[y].x,y:r[y].y,tileUnitDistanceFromAnchor:g},y>0&&(g+=r[y-1].dist(r[y]));for(let y=0;y<r.length;y++){const S=_[y];this.lineVertexArray.emplaceBack(S.x,S.y,S.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,r,o,u,g,_,y,S,I,P,C,z){const F=e.indexArray,B=e.layoutVertexArray,G=e.segments.prepareSegment(4*r.length,B,F,this.canOverlap?_.sortKey:void 0),K=this.glyphOffsetArray.length,te=G.vertexLength,he=this.allowVerticalPlacement&&y===v.ah.vertical?Math.PI/2:0,re=_.text&&_.text.sections;for(let le=0;le<r.length;le++){const{tl:we,tr:Ee,bl:Ye,br:st,tex:Xe,pixelOffsetTL:Ze,pixelOffsetBR:$e,minFontScaleX:rt,minFontScaleY:He,glyphOffset:Le,isSDF:mt,sectionIndex:lt}=r[le],Ut=G.vertexLength,vi=Le[1];Lu(B,S.x,S.y,we.x,vi+we.y,Xe.x,Xe.y,o,mt,Ze.x,Ze.y,rt,He),Lu(B,S.x,S.y,Ee.x,vi+Ee.y,Xe.x+Xe.w,Xe.y,o,mt,$e.x,Ze.y,rt,He),Lu(B,S.x,S.y,Ye.x,vi+Ye.y,Xe.x,Xe.y+Xe.h,o,mt,Ze.x,$e.y,rt,He),Lu(B,S.x,S.y,st.x,vi+st.y,Xe.x+Xe.w,Xe.y+Xe.h,o,mt,$e.x,$e.y,rt,He),Md(e.dynamicLayoutVertexArray,S,he),F.emplaceBack(Ut,Ut+1,Ut+2),F.emplaceBack(Ut+1,Ut+2,Ut+3),G.vertexLength+=4,G.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Le[0]),le!==r.length-1&&lt===r[le+1].sectionIndex||e.programConfigurations.populatePaintArrays(B.length,_,_.index,{},z,re&&re[lt])}e.placedSymbolArray.emplaceBack(S.x,S.y,K,this.glyphOffsetArray.length-K,te,I,P,S.segment,o?o[0]:0,o?o[1]:0,u[0],u[1],y,0,!1,0,C)}_addCollisionDebugVertex(e,r,o,u,g,_){return r.emplaceBack(0,0),e.emplaceBack(o.x,o.y,u,g,Math.round(_.x),Math.round(_.y))}addCollisionDebugVertices(e,r,o,u,g,_,y){const S=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),I=S.vertexLength,P=g.layoutVertexArray,C=g.collisionVertexArray,z=y.anchorX,F=y.anchorY;this._addCollisionDebugVertex(P,C,_,z,F,new N(e,r)),this._addCollisionDebugVertex(P,C,_,z,F,new N(o,r)),this._addCollisionDebugVertex(P,C,_,z,F,new N(o,u)),this._addCollisionDebugVertex(P,C,_,z,F,new N(e,u)),S.vertexLength+=4;const B=g.indexArray;B.emplaceBack(I,I+1),B.emplaceBack(I+1,I+2),B.emplaceBack(I+2,I+3),B.emplaceBack(I+3,I),S.primitiveLength+=4}addDebugCollisionBoxes(e,r,o,u){for(let g=e;g<r;g++){const _=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(_.x1,_.y1,_.x2,_.y2,u?this.textCollisionBox:this.iconCollisionBox,_.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Dd(ge,$f.members,ze),this.iconCollisionBox=new Dd(ge,$f.members,ze);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,o,u,g,_,y,S,I){const P={};for(let C=r;C<o;C++){const z=e.get(C);P.textBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},P.textFeatureIndex=z.featureIndex;break}for(let C=u;C<g;C++){const z=e.get(C);P.verticalTextBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},P.verticalTextFeatureIndex=z.featureIndex;break}for(let C=_;C<y;C++){const z=e.get(C);P.iconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},P.iconFeatureIndex=z.featureIndex;break}for(let C=S;C<I;C++){const z=e.get(C);P.verticalIconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},P.verticalIconFeatureIndex=z.featureIndex;break}return P}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const o=e.placedSymbolArray.get(r),u=o.vertexStartIndex+4*o.numGlyphs;for(let g=o.vertexStartIndex;g<u;g+=4)e.indexArray.emplaceBack(g,g+1,g+2),e.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),o=Math.cos(e),u=[],g=[],_=[];for(let y=0;y<this.symbolInstances.length;++y){_.push(y);const S=this.symbolInstances.get(y);u.push(0|Math.round(r*S.anchorX+o*S.anchorY)),g.push(S.featureIndex)}return _.sort((y,S)=>u[y]-u[S]||g[S]-g[y]),_}addToSortKeyRanges(e,r){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===r?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const o=this.symbolInstances.get(r);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((u,g,_)=>{u>=0&&_.indexOf(u)===g&&this.addIndicesForPlacedSymbol(this.text,u)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let nm,sm;it("SymbolBucket",Ua,{omit:["layers","collisionBoxArray","features","compareText"]}),Ua.MAX_GLYPHS=65535,Ua.addDynamicAttributes=Md;var zd={get paint(){return sm=sm||new Lr({"icon-opacity":new yt(ee.paint_symbol["icon-opacity"]),"icon-color":new yt(ee.paint_symbol["icon-color"]),"icon-halo-color":new yt(ee.paint_symbol["icon-halo-color"]),"icon-halo-width":new yt(ee.paint_symbol["icon-halo-width"]),"icon-halo-blur":new yt(ee.paint_symbol["icon-halo-blur"]),"icon-translate":new ut(ee.paint_symbol["icon-translate"]),"icon-translate-anchor":new ut(ee.paint_symbol["icon-translate-anchor"]),"text-opacity":new yt(ee.paint_symbol["text-opacity"]),"text-color":new yt(ee.paint_symbol["text-color"],{runtimeType:ai,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new yt(ee.paint_symbol["text-halo-color"]),"text-halo-width":new yt(ee.paint_symbol["text-halo-width"]),"text-halo-blur":new yt(ee.paint_symbol["text-halo-blur"]),"text-translate":new ut(ee.paint_symbol["text-translate"]),"text-translate-anchor":new ut(ee.paint_symbol["text-translate-anchor"])})},get layout(){return nm=nm||new Lr({"symbol-placement":new ut(ee.layout_symbol["symbol-placement"]),"symbol-spacing":new ut(ee.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ut(ee.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new yt(ee.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ut(ee.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ut(ee.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ut(ee.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ut(ee.layout_symbol["icon-ignore-placement"]),"icon-optional":new ut(ee.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ut(ee.layout_symbol["icon-rotation-alignment"]),"icon-size":new yt(ee.layout_symbol["icon-size"]),"icon-text-fit":new ut(ee.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ut(ee.layout_symbol["icon-text-fit-padding"]),"icon-image":new yt(ee.layout_symbol["icon-image"]),"icon-rotate":new yt(ee.layout_symbol["icon-rotate"]),"icon-padding":new yt(ee.layout_symbol["icon-padding"]),"icon-keep-upright":new ut(ee.layout_symbol["icon-keep-upright"]),"icon-offset":new yt(ee.layout_symbol["icon-offset"]),"icon-anchor":new yt(ee.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ut(ee.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ut(ee.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ut(ee.layout_symbol["text-rotation-alignment"]),"text-field":new yt(ee.layout_symbol["text-field"]),"text-font":new yt(ee.layout_symbol["text-font"]),"text-size":new yt(ee.layout_symbol["text-size"]),"text-max-width":new yt(ee.layout_symbol["text-max-width"]),"text-line-height":new ut(ee.layout_symbol["text-line-height"]),"text-letter-spacing":new yt(ee.layout_symbol["text-letter-spacing"]),"text-justify":new yt(ee.layout_symbol["text-justify"]),"text-radial-offset":new yt(ee.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ut(ee.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new yt(ee.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new yt(ee.layout_symbol["text-anchor"]),"text-max-angle":new ut(ee.layout_symbol["text-max-angle"]),"text-writing-mode":new ut(ee.layout_symbol["text-writing-mode"]),"text-rotate":new yt(ee.layout_symbol["text-rotate"]),"text-padding":new ut(ee.layout_symbol["text-padding"]),"text-keep-upright":new ut(ee.layout_symbol["text-keep-upright"]),"text-transform":new yt(ee.layout_symbol["text-transform"]),"text-offset":new yt(ee.layout_symbol["text-offset"]),"text-allow-overlap":new ut(ee.layout_symbol["text-allow-overlap"]),"text-overlap":new ut(ee.layout_symbol["text-overlap"]),"text-ignore-placement":new ut(ee.layout_symbol["text-ignore-placement"]),"text-optional":new ut(ee.layout_symbol["text-optional"])})}};class om{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Xi,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}it("FormatSectionOverride",om,{omit:["defaultValue"]});class Fu extends mn{constructor(e){super(e,zd)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const u=[];for(const g of o)u.indexOf(g)<0&&u.push(g);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,o,u){const g=this.layout.get(e).evaluate(r,{},o,u),_=this._unevaluatedLayout._values[e];return _.isDataDriven()||gi(_.value)||!g?g:function(y,S){return S.replace(/{([^{}]+)}/g,(I,P)=>y&&P in y?String(y[P]):"")}(r.properties,g)}createBucket(e){return new Ua(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of zd.paint.overridableProperties){if(!Fu.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),o=new om(r),u=new xi(o,r.property.specification);let g=null;g=r.value.kind==="constant"||r.value.kind==="source"?new ha("source",u):new vl("composite",u,r.value.zoomStops),this.paint._values[e]=new fn(r.property,g,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,o){return!(!this.layout||r.isDataDriven()||o.isDataDriven())&&Fu.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const o=e.get("text-field"),u=zd.paint.properties[r];let g=!1;const _=y=>{for(const S of y)if(u.overrides&&u.overrides.hasOverride(S))return void(g=!0)};if(o.value.kind==="constant"&&o.value.value instanceof jr)_(o.value.value.sections);else if(o.value.kind==="source"){const y=I=>{g||(I instanceof jn&&Gi(I.value)===Yi?_(I.value.sections):I instanceof ca?_(I.sections):I.eachChild(y))},S=o.value;S._styleExpression&&y(S._styleExpression.expression)}return g}}let am;var Pv={get paint(){return am=am||new Lr({"background-color":new ut(ee.paint_background["background-color"]),"background-pattern":new Io(ee.paint_background["background-pattern"]),"background-opacity":new ut(ee.paint_background["background-opacity"])})}};class Cv extends mn{constructor(e){super(e,Pv)}}let lm;var Mv={get paint(){return lm=lm||new Lr({"raster-opacity":new ut(ee.paint_raster["raster-opacity"]),"raster-hue-rotate":new ut(ee.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ut(ee.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ut(ee.paint_raster["raster-brightness-max"]),"raster-saturation":new ut(ee.paint_raster["raster-saturation"]),"raster-contrast":new ut(ee.paint_raster["raster-contrast"]),"raster-resampling":new ut(ee.paint_raster["raster-resampling"]),"raster-fade-duration":new ut(ee.paint_raster["raster-fade-duration"])})}};class kv extends mn{constructor(e){super(e,Mv)}}class Dv extends mn{constructor(e){super(e,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class zv{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Rd=63710088e-1;class Hs{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Hs(at(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,o=this.lat*r,u=e.lat*r,g=Math.sin(o)*Math.sin(u)+Math.cos(o)*Math.cos(u)*Math.cos((e.lng-this.lng)*r);return Rd*Math.acos(Math.min(g,1))}static convert(e){if(e instanceof Hs)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Hs(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Hs(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const cm=2*Math.PI*Rd;function um(i){return cm*Math.cos(i*Math.PI/180)}function hm(i){return(180+i)/360}function dm(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function pm(i,e){return i/um(e)}function Ld(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Ou{constructor(e,r,o=0){this.x=+e,this.y=+r,this.z=+o}static fromLngLat(e,r=0){const o=Hs.convert(e);return new Ou(hm(o.lng),dm(o.lat),pm(r,o.lat))}toLngLat(){return new Hs(360*this.x-180,Ld(this.y))}toAltitude(){return this.z*um(Ld(this.y))}meterInMercatorCoordinateUnits(){return 1/cm*(e=Ld(this.y),1/Math.cos(e*Math.PI/180));var e}}function fm(i,e,r){var o=2*Math.PI*6378137/256/Math.pow(2,r);return[i*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class Fd{constructor(e,r,o){if(e<0||e>25||o<0||o>=Math.pow(2,e)||r<0||r>=Math.pow(2,e))throw new Error(`x=${r}, y=${o}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=o,this.key=nc(0,e,e,r,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,o){const u=(_=this.y,y=this.z,S=fm(256*(g=this.x),256*(_=Math.pow(2,y)-_-1),y),I=fm(256*(g+1),256*(_+1),y),S[0]+","+S[1]+","+I[0]+","+I[1]);var g,_,y,S,I;const P=function(C,z,F){let B,G="";for(let K=C;K>0;K--)B=1<<K-1,G+=(z&B?1:0)+(F&B?2:0);return G}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,P).replace(/{bbox-epsg-3857}/g,u)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new N((e.x*r-this.x)*Bi,(e.y*r-this.y)*Bi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class mm{constructor(e,r){this.wrap=e,this.canonical=r,this.key=nc(e,r.z,r.z,r.x,r.y)}}class _n{constructor(e,r,o,u,g){if(e<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${o}`);this.overscaledZ=e,this.wrap=r,this.canonical=new Fd(o,+u,+g),this.key=nc(r,e,o,u,g)}clone(){return new _n(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new _n(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new _n(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-e;return e>this.canonical.z?nc(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):nc(this.wrap*+r,e,e,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new _n(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,o=2*this.canonical.x,u=2*this.canonical.y;return[new _n(r,this.wrap,r,o,u),new _n(r,this.wrap,r,o+1,u),new _n(r,this.wrap,r,o,u+1),new _n(r,this.wrap,r,o+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new _n(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new _n(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new mm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Ou(e.x-this.wrap,e.y))}}function nc(i,e,r,o,u){(i*=2)<0&&(i=-1*i-1);const g=1<<r;return(g*g*i+g*u+o).toString(36)+r.toString(36)+e.toString(36)}it("CanonicalTileID",Fd),it("OverscaledTileID",_n,{omit:["posMatrix"]});class gm{constructor(e,r,o,u=1,g=1,_=1,y=0){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void Bt(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const S=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=u,this.greenFactor=g,this.blueFactor=_,this.baseShift=y;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let I=0;I<S;I++)this.data[this._idx(-1,I)]=this.data[this._idx(0,I)],this.data[this._idx(S,I)]=this.data[this._idx(S-1,I)],this.data[this._idx(I,-1)]=this.data[this._idx(I,0)],this.data[this._idx(I,S)]=this.data[this._idx(I,S-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(S,-1)]=this.data[this._idx(S-1,0)],this.data[this._idx(-1,S)]=this.data[this._idx(0,S-1)],this.data[this._idx(S,S)]=this.data[this._idx(S-1,S-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let I=0;I<S;I++)for(let P=0;P<S;P++){const C=this.get(I,P);C>this.max&&(this.max=C),C<this.min&&(this.min=C)}}get(e,r){const o=new Uint8Array(this.data.buffer),u=4*this._idx(e,r);return this.unpack(o[u],o[u+1],o[u+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}unpack(e,r,o){return e*this.redFactor+r*this.greenFactor+o*this.blueFactor-this.baseShift}getPixels(){return new gn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=r*this.dim,g=r*this.dim+this.dim,_=o*this.dim,y=o*this.dim+this.dim;switch(r){case-1:u=g-1;break;case 1:g=u+1}switch(o){case-1:_=y-1;break;case 1:y=_+1}const S=-r*this.dim,I=-o*this.dim;for(let P=_;P<y;P++)for(let C=u;C<g;C++)this.data[this._idx(C,P)]=e.data[this._idx(C+S,P+I)]}}it("DEMData",gm);class _m{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const o=e[r];this._stringToNumber[o]=r,this._numberToString[r]=o}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class ym{constructor(e,r,o,u,g){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=o,e._y=u,this.properties=e.properties,this.id=g}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class xm{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new So(Bi,16,0),this.grid3D=new So(Bi,16,0),this.featureIndexArray=new M,this.promoteId=r}insert(e,r,o,u,g,_){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,u,g);const S=_?this.grid3D:this.grid;for(let I=0;I<r.length;I++){const P=r[I],C=[1/0,1/0,-1/0,-1/0];for(let z=0;z<P.length;z++){const F=P[z];C[0]=Math.min(C[0],F.x),C[1]=Math.min(C[1],F.y),C[2]=Math.max(C[2],F.x),C[3]=Math.max(C[3],F.y)}C[0]<Bi&&C[1]<Bi&&C[2]>=0&&C[3]>=0&&S.insert(y,C[0],C[1],C[2],C[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new js.VectorTile(new Td(this.rawTileData)).layers,this.sourceLayerCoder=new _m(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,o,u){this.loadVTLayers();const g=e.params||{},_=Bi/e.tileSize/e.scale,y=ma(g.filter),S=e.queryGeometry,I=e.queryPadding*_,P=bm(S),C=this.grid.query(P.minX-I,P.minY-I,P.maxX+I,P.maxY+I),z=bm(e.cameraQueryGeometry),F=this.grid3D.query(z.minX-I,z.minY-I,z.maxX+I,z.maxY+I,(K,te,he,re)=>function(le,we,Ee,Ye,st){for(const Ze of le)if(we<=Ze.x&&Ee<=Ze.y&&Ye>=Ze.x&&st>=Ze.y)return!0;const Xe=[new N(we,Ee),new N(we,st),new N(Ye,st),new N(Ye,Ee)];if(le.length>2){for(const Ze of Xe)if(La(le,Ze))return!0}for(let Ze=0;Ze<le.length-1;Ze++)if(hx(le[Ze],le[Ze+1],Xe))return!0;return!1}(e.cameraQueryGeometry,K-I,te-I,he+I,re+I));for(const K of F)C.push(K);C.sort(Rv);const B={};let G;for(let K=0;K<C.length;K++){const te=C[K];if(te===G)continue;G=te;const he=this.featureIndexArray.get(te);let re=null;this.loadMatchingFeature(B,he.bucketIndex,he.sourceLayerIndex,he.featureIndex,y,g.layers,g.availableImages,r,o,u,(le,we,Ee)=>(re||(re=_s(le)),we.queryIntersectsFeature(S,le,Ee,re,this.z,e.transform,_,e.pixelPosMatrix)))}return B}loadMatchingFeature(e,r,o,u,g,_,y,S,I,P,C){const z=this.bucketLayerIDs[r];if(_&&!function(K,te){for(let he=0;he<K.length;he++)if(te.indexOf(K[he])>=0)return!0;return!1}(_,z))return;const F=this.sourceLayerCoder.decode(o),B=this.vtLayers[F].feature(u);if(g.needGeometry){const K=ys(B,!0);if(!g.filter(new Ai(this.tileID.overscaledZ),K,this.tileID.canonical))return}else if(!g.filter(new Ai(this.tileID.overscaledZ),B))return;const G=this.getId(B,F);for(let K=0;K<z.length;K++){const te=z[K];if(_&&_.indexOf(te)<0)continue;const he=S[te];if(!he)continue;let re={};G&&P&&(re=P.getState(he.sourceLayer||"_geojsonTileLayer",G));const le=xt({},I[te]);le.paint=vm(le.paint,he.paint,B,re,y),le.layout=vm(le.layout,he.layout,B,re,y);const we=!C||C(B,he,re);if(!we)continue;const Ee=new ym(B,this.z,this.x,this.y,G);Ee.layer=le;let Ye=e[te];Ye===void 0&&(Ye=e[te]=[]),Ye.push({featureIndex:u,feature:Ee,intersectionZ:we})}}lookupSymbolFeatures(e,r,o,u,g,_,y,S){const I={};this.loadVTLayers();const P=ma(g);for(const C of e)this.loadMatchingFeature(I,o,u,C,P,_,y,S,r);return I}hasLayer(e){for(const r of this.bucketLayerIDs)for(const o of r)if(e===o)return!0;return!1}getId(e,r){let o=e.id;return this.promoteId&&(o=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof o=="boolean"&&(o=Number(o))),o}}function vm(i,e,r,o,u){return dt(i,(g,_)=>{const y=e instanceof Ao?e.get(_):null;return y&&y.evaluate?y.evaluate(r,o,u):y})}function bm(i){let e=1/0,r=1/0,o=-1/0,u=-1/0;for(const g of i)e=Math.min(e,g.x),r=Math.min(r,g.y),o=Math.max(o,g.x),u=Math.max(u,g.y);return{minX:e,minY:r,maxX:o,maxY:u}}function Rv(i,e){return e-i}function wm(i,e,r,o,u){const g=[];for(let _=0;_<i.length;_++){const y=i[_];let S;for(let I=0;I<y.length-1;I++){let P=y[I],C=y[I+1];P.x<e&&C.x<e||(P.x<e?P=new N(e,P.y+(e-P.x)/(C.x-P.x)*(C.y-P.y))._round():C.x<e&&(C=new N(e,P.y+(e-P.x)/(C.x-P.x)*(C.y-P.y))._round()),P.y<r&&C.y<r||(P.y<r?P=new N(P.x+(r-P.y)/(C.y-P.y)*(C.x-P.x),r)._round():C.y<r&&(C=new N(P.x+(r-P.y)/(C.y-P.y)*(C.x-P.x),r)._round()),P.x>=o&&C.x>=o||(P.x>=o?P=new N(o,P.y+(o-P.x)/(C.x-P.x)*(C.y-P.y))._round():C.x>=o&&(C=new N(o,P.y+(o-P.x)/(C.x-P.x)*(C.y-P.y))._round()),P.y>=u&&C.y>=u||(P.y>=u?P=new N(P.x+(u-P.y)/(C.y-P.y)*(C.x-P.x),u)._round():C.y>=u&&(C=new N(P.x+(u-P.y)/(C.y-P.y)*(C.x-P.x),u)._round()),S&&P.equals(S[S.length-1])||(S=[P],g.push(S)),S.push(C)))))}}return g}it("FeatureIndex",xm,{omit:["rawTileData","sourceLayerCoder"]});class Zs extends N{constructor(e,r,o,u){super(e,r),this.angle=o,u!==void 0&&(this.segment=u)}clone(){return new Zs(this.x,this.y,this.angle,this.segment)}}function Sm(i,e,r,o,u){if(e.segment===void 0||r===0)return!0;let g=e,_=e.segment+1,y=0;for(;y>-r/2;){if(_--,_<0)return!1;y-=i[_].dist(g),g=i[_]}y+=i[_].dist(i[_+1]),_++;const S=[];let I=0;for(;y<r/2;){const P=i[_],C=i[_+1];if(!C)return!1;let z=i[_-1].angleTo(P)-P.angleTo(C);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:y,angleDelta:z}),I+=z;y-S[0].distance>o;)I-=S.shift().angleDelta;if(I>u)return!1;_++,y+=P.dist(C)}return!0}function Tm(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function Am(i,e,r){return i?.6*e*r:0}function Im(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function Lv(i,e,r,o,u,g){const _=Am(r,u,g),y=Im(r,o)*g;let S=0;const I=Tm(i)/2;for(let P=0;P<i.length-1;P++){const C=i[P],z=i[P+1],F=C.dist(z);if(S+F>I){const B=(I-S)/F,G=Tr.number(C.x,z.x,B),K=Tr.number(C.y,z.y,B),te=new Zs(G,K,z.angleTo(C),P);return te._round(),!_||Sm(i,te,y,_,e)?te:void 0}S+=F}}function Fv(i,e,r,o,u,g,_,y,S){const I=Am(o,g,_),P=Im(o,u),C=P*_,z=i[0].x===0||i[0].x===S||i[0].y===0||i[0].y===S;return e-C<e/4&&(e=C+e/4),Em(i,z?e/2*y%e:(P/2+2*g)*_*y%e,e,I,r,C,z,!1,S)}function Em(i,e,r,o,u,g,_,y,S){const I=g/2,P=Tm(i);let C=0,z=e-r,F=[];for(let B=0;B<i.length-1;B++){const G=i[B],K=i[B+1],te=G.dist(K),he=K.angleTo(G);for(;z+r<C+te;){z+=r;const re=(z-C)/te,le=Tr.number(G.x,K.x,re),we=Tr.number(G.y,K.y,re);if(le>=0&&le<S&&we>=0&&we<S&&z-I>=0&&z+I<=P){const Ee=new Zs(le,we,he,B);Ee._round(),o&&!Sm(i,Ee,g,o,u)||F.push(Ee)}}C+=te}return y||F.length||_||(F=Em(i,C/2,r,o,u,g,_,!0,S)),F}it("Anchor",Zs);const ja=Wr;function Pm(i,e,r,o){const u=[],g=i.image,_=g.pixelRatio,y=g.paddedRect.w-2*ja,S=g.paddedRect.h-2*ja,I=i.right-i.left,P=i.bottom-i.top,C=g.stretchX||[[0,y]],z=g.stretchY||[[0,S]],F=($e,rt)=>$e+rt[1]-rt[0],B=C.reduce(F,0),G=z.reduce(F,0),K=y-B,te=S-G;let he=0,re=B,le=0,we=G,Ee=0,Ye=K,st=0,Xe=te;if(g.content&&o){const $e=g.content;he=Bu(C,0,$e[0]),le=Bu(z,0,$e[1]),re=Bu(C,$e[0],$e[2]),we=Bu(z,$e[1],$e[3]),Ee=$e[0]-he,st=$e[1]-le,Ye=$e[2]-$e[0]-re,Xe=$e[3]-$e[1]-we}const Ze=($e,rt,He,Le)=>{const mt=Nu($e.stretch-he,re,I,i.left),lt=Vu($e.fixed-Ee,Ye,$e.stretch,B),Ut=Nu(rt.stretch-le,we,P,i.top),vi=Vu(rt.fixed-st,Xe,rt.stretch,G),Ei=Nu(He.stretch-he,re,I,i.left),ir=Vu(He.fixed-Ee,Ye,He.stretch,B),on=Nu(Le.stretch-le,we,P,i.top),Or=Vu(Le.fixed-st,Xe,Le.stretch,G),Ki=new N(mt,Ut),dr=new N(Ei,Ut),xr=new N(Ei,on),Br=new N(mt,on),Nr=new N(lt/_,vi/_),rr=new N(ir/_,Or/_),nr=e*Math.PI/180;if(nr){const Er=Math.sin(nr),Kr=Math.cos(nr),Xr=[Kr,-Er,Er,Kr];Ki._matMult(Xr),dr._matMult(Xr),Br._matMult(Xr),xr._matMult(Xr)}const Ir=$e.stretch+$e.fixed,Vr=rt.stretch+rt.fixed;return{tl:Ki,tr:dr,bl:Br,br:xr,tex:{x:g.paddedRect.x+ja+Ir,y:g.paddedRect.y+ja+Vr,w:He.stretch+He.fixed-Ir,h:Le.stretch+Le.fixed-Vr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Nr,pixelOffsetBR:rr,minFontScaleX:Ye/_/I,minFontScaleY:Xe/_/P,isSDF:r}};if(o&&(g.stretchX||g.stretchY)){const $e=Cm(C,K,B),rt=Cm(z,te,G);for(let He=0;He<$e.length-1;He++){const Le=$e[He],mt=$e[He+1];for(let lt=0;lt<rt.length-1;lt++)u.push(Ze(Le,rt[lt],mt,rt[lt+1]))}}else u.push(Ze({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:S+1}));return u}function Bu(i,e,r){let o=0;for(const u of i)o+=Math.max(e,Math.min(r,u[1]))-Math.max(e,Math.min(r,u[0]));return o}function Cm(i,e,r){const o=[{fixed:-ja,stretch:0}];for(const[u,g]of i){const _=o[o.length-1];o.push({fixed:u-_.stretch,stretch:_.stretch}),o.push({fixed:u-_.stretch,stretch:_.stretch+(g-u)})}return o.push({fixed:e+ja,stretch:r}),o}function Nu(i,e,r,o){return i/e*r+o}function Vu(i,e,r,o){return i-e*r/o}class $u{constructor(e,r,o,u,g,_,y,S,I,P){if(this.boxStartIndex=e.length,I){let C=_.top,z=_.bottom;const F=_.collisionPadding;F&&(C-=F[1],z+=F[3]);let B=z-C;B>0&&(B=Math.max(10,B),this.circleDiameter=B)}else{let C=_.top*y-S[0],z=_.bottom*y+S[2],F=_.left*y-S[3],B=_.right*y+S[1];const G=_.collisionPadding;if(G&&(F-=G[0]*y,C-=G[1]*y,B+=G[2]*y,z+=G[3]*y),P){const K=new N(F,C),te=new N(B,C),he=new N(F,z),re=new N(B,z),le=P*Math.PI/180;K._rotate(le),te._rotate(le),he._rotate(le),re._rotate(le),F=Math.min(K.x,te.x,he.x,re.x),B=Math.max(K.x,te.x,he.x,re.x),C=Math.min(K.y,te.y,he.y,re.y),z=Math.max(K.y,te.y,he.y,re.y)}e.emplaceBack(r.x,r.y,F,C,B,z,o,u,g)}this.boxEndIndex=e.length}}class Ov{constructor(e=[],r=Bv){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:o}=this,u=r[e];for(;e>0;){const g=e-1>>1,_=r[g];if(o(u,_)>=0)break;r[e]=_,e=g}r[e]=u}_down(e){const{data:r,compare:o}=this,u=this.length>>1,g=r[e];for(;e<u;){let _=1+(e<<1),y=r[_];const S=_+1;if(S<this.length&&o(r[S],y)<0&&(_=S,y=r[S]),o(y,g)>=0)break;r[e]=y,e=_}r[e]=g}}function Bv(i,e){return i<e?-1:i>e?1:0}function Nv(i,e=1,r=!1){let o=1/0,u=1/0,g=-1/0,_=-1/0;const y=i[0];for(let F=0;F<y.length;F++){const B=y[F];(!F||B.x<o)&&(o=B.x),(!F||B.y<u)&&(u=B.y),(!F||B.x>g)&&(g=B.x),(!F||B.y>_)&&(_=B.y)}const S=Math.min(g-o,_-u);let I=S/2;const P=new Ov([],Vv);if(S===0)return new N(o,u);for(let F=o;F<g;F+=S)for(let B=u;B<_;B+=S)P.push(new qa(F+I,B+I,I,i));let C=function(F){let B=0,G=0,K=0;const te=F[0];for(let he=0,re=te.length,le=re-1;he<re;le=he++){const we=te[he],Ee=te[le],Ye=we.x*Ee.y-Ee.x*we.y;G+=(we.x+Ee.x)*Ye,K+=(we.y+Ee.y)*Ye,B+=3*Ye}return new qa(G/B,K/B,0,F)}(i),z=P.length;for(;P.length;){const F=P.pop();(F.d>C.d||!C.d)&&(C=F,r&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,z)),F.max-C.d<=e||(I=F.h/2,P.push(new qa(F.p.x-I,F.p.y-I,I,i)),P.push(new qa(F.p.x+I,F.p.y-I,I,i)),P.push(new qa(F.p.x-I,F.p.y+I,I,i)),P.push(new qa(F.p.x+I,F.p.y+I,I,i)),z+=4)}return r&&(console.log(`num probes: ${z}`),console.log(`best distance: ${C.d}`)),C.p}function Vv(i,e){return e.max-i.max}function qa(i,e,r,o){this.p=new N(i,e),this.h=r,this.d=function(u,g){let _=!1,y=1/0;for(let S=0;S<g.length;S++){const I=g[S];for(let P=0,C=I.length,z=C-1;P<C;z=P++){const F=I[P],B=I[z];F.y>u.y!=B.y>u.y&&u.x<(B.x-F.x)*(u.y-F.y)/(B.y-F.y)+F.x&&(_=!_),y=Math.min(y,df(u,F,B))}}return(_?1:-1)*Math.sqrt(y)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}var yr;v.ap=void 0,(yr=v.ap||(v.ap={}))[yr.center=1]="center",yr[yr.left=2]="left",yr[yr.right=3]="right",yr[yr.top=4]="top",yr[yr.bottom=5]="bottom",yr[yr["top-left"]=6]="top-left",yr[yr["top-right"]=7]="top-right",yr[yr["bottom-left"]=8]="bottom-left",yr[yr["bottom-right"]=9]="bottom-right";const Ws=7,Od=Number.POSITIVE_INFINITY;function Mm(i,e){return e[1]!==Od?function(r,o,u){let g=0,_=0;switch(o=Math.abs(o),u=Math.abs(u),r){case"top-right":case"top-left":case"top":_=u-Ws;break;case"bottom-right":case"bottom-left":case"bottom":_=-u+Ws}switch(r){case"top-right":case"bottom-right":case"right":g=-o;break;case"top-left":case"bottom-left":case"left":g=o}return[g,_]}(i,e[0],e[1]):function(r,o){let u=0,g=0;o<0&&(o=0);const _=o/Math.SQRT2;switch(r){case"top-right":case"top-left":g=_-Ws;break;case"bottom-right":case"bottom-left":g=-_+Ws;break;case"bottom":g=-o+Ws;break;case"top":g=o-Ws}switch(r){case"top-right":case"bottom-right":u=-_;break;case"top-left":case"bottom-left":u=_;break;case"left":u=o;break;case"right":u=-o}return[u,g]}(i,e[0])}function km(i,e,r){var o;const u=i.layout,g=(o=u.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(e,{},r);if(g){const y=g.values,S=[];for(let I=0;I<y.length;I+=2){const P=S[I]=y[I],C=y[I+1].map(z=>z*tr);P.startsWith("top")?C[1]-=Ws:P.startsWith("bottom")&&(C[1]+=Ws),S[I+1]=C}return new tn(S)}const _=u.get("text-variable-anchor");if(_){let y;y=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[u.get("text-radial-offset").evaluate(e,{},r)*tr,Od]:u.get("text-offset").evaluate(e,{},r).map(I=>I*tr);const S=[];for(const I of _)S.push(I,Mm(I,y));return new tn(S)}return null}function Bd(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function $v(i,e,r,o,u,g,_,y,S,I,P){let C=g.textMaxSize.evaluate(e,{});C===void 0&&(C=_);const z=i.layers[0].layout,F=z.get("icon-offset").evaluate(e,{},P),B=zm(r.horizontal),G=_/24,K=i.tilePixelRatio*G,te=i.tilePixelRatio*C/24,he=i.tilePixelRatio*y,re=i.tilePixelRatio*z.get("symbol-spacing"),le=z.get("text-padding")*i.tilePixelRatio,we=function(Le,mt,lt,Ut=1){const vi=Le.get("icon-padding").evaluate(mt,{},lt),Ei=vi&&vi.values;return[Ei[0]*Ut,Ei[1]*Ut,Ei[2]*Ut,Ei[3]*Ut]}(z,e,P,i.tilePixelRatio),Ee=z.get("text-max-angle")/180*Math.PI,Ye=z.get("text-rotation-alignment")!=="viewport"&&z.get("symbol-placement")!=="point",st=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Xe=z.get("symbol-placement"),Ze=re/2,$e=z.get("icon-text-fit");let rt;o&&$e!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(rt=im(o,r.vertical,$e,z.get("icon-text-fit-padding"),F,G)),B&&(o=im(o,B,$e,z.get("icon-text-fit-padding"),F,G)));const He=(Le,mt)=>{mt.x<0||mt.x>=Bi||mt.y<0||mt.y>=Bi||function(lt,Ut,vi,Ei,ir,on,Or,Ki,dr,xr,Br,Nr,rr,nr,Ir,Vr,Er,Kr,Xr,sr,Ht,Pr,vr,or,Pn){const Rn=lt.addToLineVertexArray(Ut,vi);let Ln,vs,Cn,yn,Yr=0,bs=0,ac=0,Om=0,Hd=-1,Zd=-1;const ws={};let Bm=Li("");if(lt.allowVerticalPlacement&&Ei.vertical){const Cr=Ki.layout.get("text-rotate").evaluate(Ht,{},or)+90;Cn=new $u(dr,Ut,xr,Br,Nr,Ei.vertical,rr,nr,Ir,Cr),Or&&(yn=new $u(dr,Ut,xr,Br,Nr,Or,Er,Kr,Ir,Cr))}if(ir){const Cr=Ki.layout.get("icon-rotate").evaluate(Ht,{}),xn=Ki.layout.get("icon-text-fit")!=="none",Ro=Pm(ir,Cr,vr,xn),On=Or?Pm(Or,Cr,vr,xn):void 0;vs=new $u(dr,Ut,xr,Br,Nr,ir,Er,Kr,!1,Cr),Yr=4*Ro.length;const Lo=lt.iconSizeData;let Qn=null;Lo.kind==="source"?(Qn=[Jn*Ki.layout.get("icon-size").evaluate(Ht,{})],Qn[0]>Gs&&Bt(`${lt.layerIds[0]}: Value for "icon-size" is >= ${rc}. Reduce your "icon-size".`)):Lo.kind==="composite"&&(Qn=[Jn*Pr.compositeIconSizes[0].evaluate(Ht,{},or),Jn*Pr.compositeIconSizes[1].evaluate(Ht,{},or)],(Qn[0]>Gs||Qn[1]>Gs)&&Bt(`${lt.layerIds[0]}: Value for "icon-size" is >= ${rc}. Reduce your "icon-size".`)),lt.addSymbols(lt.icon,Ro,Qn,sr,Xr,Ht,v.ah.none,Ut,Rn.lineStartIndex,Rn.lineLength,-1,or),Hd=lt.icon.placedSymbolArray.length-1,On&&(bs=4*On.length,lt.addSymbols(lt.icon,On,Qn,sr,Xr,Ht,v.ah.vertical,Ut,Rn.lineStartIndex,Rn.lineLength,-1,or),Zd=lt.icon.placedSymbolArray.length-1)}const Nm=Object.keys(Ei.horizontal);for(const Cr of Nm){const xn=Ei.horizontal[Cr];if(!Ln){Bm=Li(xn.text);const On=Ki.layout.get("text-rotate").evaluate(Ht,{},or);Ln=new $u(dr,Ut,xr,Br,Nr,xn,rr,nr,Ir,On)}const Ro=xn.positionedLines.length===1;if(ac+=Dm(lt,Ut,xn,on,Ki,Ir,Ht,Vr,Rn,Ei.vertical?v.ah.horizontal:v.ah.horizontalOnly,Ro?Nm:[Cr],ws,Hd,Pr,or),Ro)break}Ei.vertical&&(Om+=Dm(lt,Ut,Ei.vertical,on,Ki,Ir,Ht,Vr,Rn,v.ah.vertical,["vertical"],ws,Zd,Pr,or));const qv=Ln?Ln.boxStartIndex:lt.collisionBoxArray.length,Gv=Ln?Ln.boxEndIndex:lt.collisionBoxArray.length,Hv=Cn?Cn.boxStartIndex:lt.collisionBoxArray.length,Zv=Cn?Cn.boxEndIndex:lt.collisionBoxArray.length,Wv=vs?vs.boxStartIndex:lt.collisionBoxArray.length,Kv=vs?vs.boxEndIndex:lt.collisionBoxArray.length,Xv=yn?yn.boxStartIndex:lt.collisionBoxArray.length,Yv=yn?yn.boxEndIndex:lt.collisionBoxArray.length;let Fn=-1;const ju=(Cr,xn)=>Cr&&Cr.circleDiameter?Math.max(Cr.circleDiameter,xn):xn;Fn=ju(Ln,Fn),Fn=ju(Cn,Fn),Fn=ju(vs,Fn),Fn=ju(yn,Fn);const Vm=Fn>-1?1:0;Vm&&(Fn*=Pn/tr),lt.glyphOffsetArray.length>=Ua.MAX_GLYPHS&&Bt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ht.sortKey!==void 0&&lt.addToSortKeyRanges(lt.symbolInstances.length,Ht.sortKey);const Jv=km(Ki,Ht,or),[Qv,e0]=function(Cr,xn){const Ro=Cr.length,On=xn==null?void 0:xn.values;if((On==null?void 0:On.length)>0)for(let Lo=0;Lo<On.length;Lo+=2){const Qn=On[Lo+1];Cr.emplaceBack(v.ap[On[Lo]],Qn[0],Qn[1])}return[Ro,Cr.length]}(lt.textAnchorOffsets,Jv);lt.symbolInstances.emplaceBack(Ut.x,Ut.y,ws.right>=0?ws.right:-1,ws.center>=0?ws.center:-1,ws.left>=0?ws.left:-1,ws.vertical||-1,Hd,Zd,Bm,qv,Gv,Hv,Zv,Wv,Kv,Xv,Yv,xr,ac,Om,Yr,bs,Vm,0,rr,Fn,Qv,e0)}(i,mt,Le,r,o,u,rt,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,K,[le,le,le,le],Ye,S,he,we,st,F,e,g,I,P,_)};if(Xe==="line")for(const Le of wm(e.geometry,0,0,Bi,Bi)){const mt=Fv(Le,re,Ee,r.vertical||B,o,24,te,i.overscaling,Bi);for(const lt of mt)B&&Uv(i,B.text,Ze,lt)||He(Le,lt)}else if(Xe==="line-center"){for(const Le of e.geometry)if(Le.length>1){const mt=Lv(Le,Ee,r.vertical||B,o,24,te);mt&&He(Le,mt)}}else if(e.type==="Polygon")for(const Le of gd(e.geometry,0)){const mt=Nv(Le,16);He(Le[0],new Zs(mt.x,mt.y,0))}else if(e.type==="LineString")for(const Le of e.geometry)He(Le,new Zs(Le[0].x,Le[0].y,0));else if(e.type==="Point")for(const Le of e.geometry)for(const mt of Le)He([mt],new Zs(mt.x,mt.y,0))}function Dm(i,e,r,o,u,g,_,y,S,I,P,C,z,F,B){const G=function(he,re,le,we,Ee,Ye,st,Xe){const Ze=we.layout.get("text-rotate").evaluate(Ye,{})*Math.PI/180,$e=[];for(const rt of re.positionedLines)for(const He of rt.positionedGlyphs){if(!He.rect)continue;const Le=He.rect||{};let mt=Kf+1,lt=!0,Ut=1,vi=0;const Ei=(Ee||Xe)&&He.vertical,ir=He.metrics.advance*He.scale/2;if(Xe&&re.verticalizable&&(vi=rt.lineOffset/2-(He.imageName?-(tr-He.metrics.width*He.scale)/2:(He.scale-1)*tr)),He.imageName){const sr=st[He.imageName];lt=sr.sdf,Ut=sr.pixelRatio,mt=Wr/Ut}const on=Ee?[He.x+ir,He.y]:[0,0];let Or=Ee?[0,0]:[He.x+ir+le[0],He.y+le[1]-vi],Ki=[0,0];Ei&&(Ki=Or,Or=[0,0]);const dr=He.metrics.isDoubleResolution?2:1,xr=(He.metrics.left-mt)*He.scale-ir+Or[0],Br=(-He.metrics.top-mt)*He.scale+Or[1],Nr=xr+Le.w/dr*He.scale/Ut,rr=Br+Le.h/dr*He.scale/Ut,nr=new N(xr,Br),Ir=new N(Nr,Br),Vr=new N(xr,rr),Er=new N(Nr,rr);if(Ei){const sr=new N(-ir,ir-tc),Ht=-Math.PI/2,Pr=tr/2-ir,vr=new N(5-tc-Pr,-(He.imageName?Pr:0)),or=new N(...Ki);nr._rotateAround(Ht,sr)._add(vr)._add(or),Ir._rotateAround(Ht,sr)._add(vr)._add(or),Vr._rotateAround(Ht,sr)._add(vr)._add(or),Er._rotateAround(Ht,sr)._add(vr)._add(or)}if(Ze){const sr=Math.sin(Ze),Ht=Math.cos(Ze),Pr=[Ht,-sr,sr,Ht];nr._matMult(Pr),Ir._matMult(Pr),Vr._matMult(Pr),Er._matMult(Pr)}const Kr=new N(0,0),Xr=new N(0,0);$e.push({tl:nr,tr:Ir,bl:Vr,br:Er,tex:Le,writingMode:re.writingMode,glyphOffset:on,sectionIndex:He.sectionIndex,isSDF:lt,pixelOffsetTL:Kr,pixelOffsetBR:Xr,minFontScaleX:0,minFontScaleY:0})}return $e}(0,r,y,u,g,_,o,i.allowVerticalPlacement),K=i.textSizeData;let te=null;K.kind==="source"?(te=[Jn*u.layout.get("text-size").evaluate(_,{})],te[0]>Gs&&Bt(`${i.layerIds[0]}: Value for "text-size" is >= ${rc}. Reduce your "text-size".`)):K.kind==="composite"&&(te=[Jn*F.compositeTextSizes[0].evaluate(_,{},B),Jn*F.compositeTextSizes[1].evaluate(_,{},B)],(te[0]>Gs||te[1]>Gs)&&Bt(`${i.layerIds[0]}: Value for "text-size" is >= ${rc}. Reduce your "text-size".`)),i.addSymbols(i.text,G,te,y,g,_,I,e,S.lineStartIndex,S.lineLength,z,B);for(const he of P)C[he]=i.text.placedSymbolArray.length-1;return 4*G.length}function zm(i){for(const e in i)return i[e];return null}function Uv(i,e,r,o){const u=i.compareText;if(e in u){const g=u[e];for(let _=g.length-1;_>=0;_--)if(o.dist(g[_])<r)return!0}else u[e]=[];return u[e].push(o),!1}const Rm=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Nd{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,o]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=o>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const g=Rm[15&o];if(!g)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new Nd(y,_,g,e)}constructor(e,r=64,o=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const g=Rm.indexOf(this.ArrayType),_=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-y%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${o}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+S,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+_+y+S),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+S,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=r,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Vd(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:_,nodeSize:y}=this,S=[0,g.length-1,0],I=[];for(;S.length;){const P=S.pop()||0,C=S.pop()||0,z=S.pop()||0;if(C-z<=y){for(let K=z;K<=C;K++){const te=_[2*K],he=_[2*K+1];te>=e&&te<=o&&he>=r&&he<=u&&I.push(g[K])}continue}const F=z+C>>1,B=_[2*F],G=_[2*F+1];B>=e&&B<=o&&G>=r&&G<=u&&I.push(g[F]),(P===0?e<=B:r<=G)&&(S.push(z),S.push(F-1),S.push(1-P)),(P===0?o>=B:u>=G)&&(S.push(F+1),S.push(C),S.push(1-P))}return I}within(e,r,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:g,nodeSize:_}=this,y=[0,u.length-1,0],S=[],I=o*o;for(;y.length;){const P=y.pop()||0,C=y.pop()||0,z=y.pop()||0;if(C-z<=_){for(let K=z;K<=C;K++)Fm(g[2*K],g[2*K+1],e,r)<=I&&S.push(u[K]);continue}const F=z+C>>1,B=g[2*F],G=g[2*F+1];Fm(B,G,e,r)<=I&&S.push(u[F]),(P===0?e-o<=B:r-o<=G)&&(y.push(z),y.push(F-1),y.push(1-P)),(P===0?e+o>=B:r+o>=G)&&(y.push(F+1),y.push(C),y.push(1-P))}return S}}function Vd(i,e,r,o,u,g){if(u-o<=r)return;const _=o+u>>1;Lm(i,e,_,o,u,g),Vd(i,e,r,o,_-1,1-g),Vd(i,e,r,_+1,u,1-g)}function Lm(i,e,r,o,u,g){for(;u>o;){if(u-o>600){const I=u-o+1,P=r-o+1,C=Math.log(I),z=.5*Math.exp(2*C/3),F=.5*Math.sqrt(C*z*(I-z)/I)*(P-I/2<0?-1:1);Lm(i,e,r,Math.max(o,Math.floor(r-P*z/I+F)),Math.min(u,Math.floor(r+(I-P)*z/I+F)),g)}const _=e[2*r+g];let y=o,S=u;for(sc(i,e,o,r),e[2*u+g]>_&&sc(i,e,o,u);y<S;){for(sc(i,e,y,S),y++,S--;e[2*y+g]<_;)y++;for(;e[2*S+g]>_;)S--}e[2*o+g]===_?sc(i,e,o,S):(S++,sc(i,e,S,u)),S<=r&&(o=S+1),r<=S&&(u=S-1)}}function sc(i,e,r,o){$d(i,r,o),$d(e,2*r,2*o),$d(e,2*r+1,2*o+1)}function $d(i,e,r){const o=i[e];i[e]=i[r],i[r]=o}function Fm(i,e,r,o){const u=i-r,g=e-o;return u*u+g*g}var Ud;v.bd=void 0,(Ud=v.bd||(v.bd={})).create="create",Ud.load="load",Ud.fullLoad="fullLoad";let Uu=null,oc=[];const jd=1e3/60,qd="loadTime",Gd="fullLoadTime",jv={mark(i){performance.mark(i)},frame(i){const e=i;Uu!=null&&oc.push(e-Uu),Uu=e},clearMetrics(){Uu=null,oc=[],performance.clearMeasures(qd),performance.clearMeasures(Gd);for(const i in v.bd)performance.clearMarks(v.bd[i])},getPerformanceMetrics(){performance.measure(qd,v.bd.create,v.bd.load),performance.measure(Gd,v.bd.create,v.bd.fullLoad);const i=performance.getEntriesByName(qd)[0].duration,e=performance.getEntriesByName(Gd)[0].duration,r=oc.length,o=1/(oc.reduce((g,_)=>g+_,0)/r/1e3),u=oc.filter(g=>g>jd).reduce((g,_)=>g+(_-jd)/jd,0);return{loadTime:i,fullLoadTime:e,fps:o,percentDroppedFrames:u/(r+u)*100,totalFrames:r}}};v.$=je,v.A=Fa,v.B=function(i){if(Ct==null){const e=i.navigator?i.navigator.userAgent:null;Ct=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Ct},v.C=class{constructor(i,e){this.target=i,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new zv(()=>this.process()),this.subscription=function(r,o,u,g){return r.addEventListener(o,u,!1),{unsubscribe:()=>{r.removeEventListener(o,u,!1)}}}(this.target,"message",r=>this.receive(r)),this.globalScope=It(self)?i:window}registerMessageHandler(i,e){this.messageHandlers[i]=e}sendAsync(i,e){return new Promise((r,o)=>{const u=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[u]={resolve:r,reject:o},e&&e.signal.addEventListener("abort",()=>{delete this.resolveRejects[u];const y={id:u,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(y)},{once:!0});const g=[],_=Object.assign(Object.assign({},i),{id:u,sourceMapId:this.mapId,origin:location.origin,data:Ns(i.data,g)});this.target.postMessage(_,{transfer:g})})}receive(i){const e=i.data,r=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[r];const o=this.abortControllers[r];return delete this.abortControllers[r],void(o&&o.abort())}if(It(self)||e.mustQueue)return this.tasks[r]=e,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,e)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){return h(this,void 0,void 0,function*(){if(e.type==="<response>"){const u=this.resolveRejects[i];return delete this.resolveRejects[i],u?void(e.error?u.reject(Vs(e.error)):u.resolve(Vs(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=Vs(e.data),o=new AbortController;this.abortControllers[i]=o;try{const u=yield this.messageHandlers[e.type](e.sourceMapId,r,o);this.completeTask(i,null,u)}catch(u){this.completeTask(i,u)}})}completeTask(i,e,r){const o=[];delete this.abortControllers[i];const u={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?Ns(e):null,data:Ns(r,o)};this.target.postMessage(u,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},v.D=ut,v.E=De,v.F=function(){var i=new Fa(16);return Fa!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},v.G=Pe,v.H=function(i,e,r){var o,u,g,_,y,S,I,P,C,z,F,B,G=r[0],K=r[1],te=r[2];return e===i?(i[12]=e[0]*G+e[4]*K+e[8]*te+e[12],i[13]=e[1]*G+e[5]*K+e[9]*te+e[13],i[14]=e[2]*G+e[6]*K+e[10]*te+e[14],i[15]=e[3]*G+e[7]*K+e[11]*te+e[15]):(u=e[1],g=e[2],_=e[3],y=e[4],S=e[5],I=e[6],P=e[7],C=e[8],z=e[9],F=e[10],B=e[11],i[0]=o=e[0],i[1]=u,i[2]=g,i[3]=_,i[4]=y,i[5]=S,i[6]=I,i[7]=P,i[8]=C,i[9]=z,i[10]=F,i[11]=B,i[12]=o*G+y*K+C*te+e[12],i[13]=u*G+S*K+z*te+e[13],i[14]=g*G+I*K+F*te+e[14],i[15]=_*G+P*K+B*te+e[15]),i},v.I=Id,v.J=function(i,e,r){var o=r[0],u=r[1],g=r[2];return i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i[3]=e[3]*o,i[4]=e[4]*u,i[5]=e[5]*u,i[6]=e[6]*u,i[7]=e[7]*u,i[8]=e[8]*g,i[9]=e[9]*g,i[10]=e[10]*g,i[11]=e[11]*g,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},v.K=gf,v.L=function(i,e){const r={};for(let o=0;o<e.length;o++){const u=e[o];u in i&&(r[u]=i[u])}return r},v.M=Hs,v.N=hm,v.O=dm,v.P=N,v.Q=_n,v.R=gn,v.S=Ue,v.T=Ml,v.U=We,v.V=wr,v.W=Bi,v.X=Ui,v.Y=Ou,v.Z=class extends zl{},v._=h,v.a=gr,v.a$=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},v.a0=Fd,v.a1=Ce,v.a2=i=>{const e=window.document.createElement("video");return e.muted=!0,new Promise(r=>{e.onloadstart=()=>{r(e)};for(const o of i){const u=window.document.createElement("source");Qt(o)||(e.crossOrigin="Anonymous"),u.src=o,e.appendChild(u)}})},v.a3=function(){return St++},v.a4=p,v.a5=Ua,v.a6=ma,v.a7=ys,v.a8=Ai,v.a9=ym,v.aA=vt,v.aB=function(i,e){if(!i)return[{command:"setStyle",args:[e]}];let r=[];try{if(!Ae(i.version,e.version))return[{command:"setStyle",args:[e]}];Ae(i.center,e.center)||r.push({command:"setCenter",args:[e.center]}),Ae(i.zoom,e.zoom)||r.push({command:"setZoom",args:[e.zoom]}),Ae(i.bearing,e.bearing)||r.push({command:"setBearing",args:[e.bearing]}),Ae(i.pitch,e.pitch)||r.push({command:"setPitch",args:[e.pitch]}),Ae(i.sprite,e.sprite)||r.push({command:"setSprite",args:[e.sprite]}),Ae(i.glyphs,e.glyphs)||r.push({command:"setGlyphs",args:[e.glyphs]}),Ae(i.transition,e.transition)||r.push({command:"setTransition",args:[e.transition]}),Ae(i.light,e.light)||r.push({command:"setLight",args:[e.light]}),Ae(i.terrain,e.terrain)||r.push({command:"setTerrain",args:[e.terrain]}),Ae(i.sky,e.sky)||r.push({command:"setSky",args:[e.sky]});const o={},u=[];(function(_,y,S,I){let P;for(P in y=y||{},_=_||{})Object.prototype.hasOwnProperty.call(_,P)&&(Object.prototype.hasOwnProperty.call(y,P)||nt(P,S,I));for(P in y)Object.prototype.hasOwnProperty.call(y,P)&&(Object.prototype.hasOwnProperty.call(_,P)?Ae(_[P],y[P])||(_[P].type==="geojson"&&y[P].type==="geojson"&&ft(_,y,P)?Oe(S,{command:"setGeoJSONSourceData",args:[P,y[P].data]}):bt(P,y,S,I)):Fe(P,y,S))})(i.sources,e.sources,u,o);const g=[];i.layers&&i.layers.forEach(_=>{"source"in _&&o[_.source]?r.push({command:"removeLayer",args:[_.id]}):g.push(_)}),r=r.concat(u),function(_,y,S){y=y||[];const I=(_=_||[]).map(jt),P=y.map(jt),C=_.reduce(Yt,{}),z=y.reduce(Yt,{}),F=I.slice(),B=Object.create(null);let G,K,te,he,re;for(let le=0,we=0;le<I.length;le++)G=I[le],Object.prototype.hasOwnProperty.call(z,G)?we++:(Oe(S,{command:"removeLayer",args:[G]}),F.splice(F.indexOf(G,we),1));for(let le=0,we=0;le<P.length;le++)G=P[P.length-1-le],F[F.length-1-le]!==G&&(Object.prototype.hasOwnProperty.call(C,G)?(Oe(S,{command:"removeLayer",args:[G]}),F.splice(F.lastIndexOf(G,F.length-we),1)):we++,he=F[F.length-le],Oe(S,{command:"addLayer",args:[z[G],he]}),F.splice(F.length-le,0,G),B[G]=!0);for(let le=0;le<P.length;le++)if(G=P[le],K=C[G],te=z[G],!B[G]&&!Ae(K,te))if(Ae(K.source,te.source)&&Ae(K["source-layer"],te["source-layer"])&&Ae(K.type,te.type)){for(re in Tt(K.layout,te.layout,S,G,null,"setLayoutProperty"),Tt(K.paint,te.paint,S,G,null,"setPaintProperty"),Ae(K.filter,te.filter)||Oe(S,{command:"setFilter",args:[G,te.filter]}),Ae(K.minzoom,te.minzoom)&&Ae(K.maxzoom,te.maxzoom)||Oe(S,{command:"setLayerZoomRange",args:[G,te.minzoom,te.maxzoom]}),K)Object.prototype.hasOwnProperty.call(K,re)&&re!=="layout"&&re!=="paint"&&re!=="filter"&&re!=="metadata"&&re!=="minzoom"&&re!=="maxzoom"&&(re.indexOf("paint.")===0?Tt(K[re],te[re],S,G,re.slice(6),"setPaintProperty"):Ae(K[re],te[re])||Oe(S,{command:"setLayerProperty",args:[G,re,te[re]]}));for(re in te)Object.prototype.hasOwnProperty.call(te,re)&&!Object.prototype.hasOwnProperty.call(K,re)&&re!=="layout"&&re!=="paint"&&re!=="filter"&&re!=="metadata"&&re!=="minzoom"&&re!=="maxzoom"&&(re.indexOf("paint.")===0?Tt(K[re],te[re],S,G,re.slice(6),"setPaintProperty"):Ae(K[re],te[re])||Oe(S,{command:"setLayerProperty",args:[G,re,te[re]]}))}else Oe(S,{command:"removeLayer",args:[G]}),he=F[F.lastIndexOf(G)+1],Oe(S,{command:"addLayer",args:[te,he]})}(g,e.layers,r)}catch(o){console.warn("Unable to compute style diff:",o),r=[{command:"setStyle",args:[e]}]}return r},v.aC=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},v.aD=function i(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(let o=0;o<e.length;o++)if(!i(e[o],r[o]))return!1;return!0}if(typeof e=="object"&&e!==null&&r!==null){if(typeof r!="object"||Object.keys(e).length!==Object.keys(r).length)return!1;for(const o in e)if(!i(e[o],r[o]))return!1;return!0}return e===r},v.aE=dt,v.aF=kt,v.aG=class extends er{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},v.aH=Zr,v.aI=class extends er{constructor(i,e){super(i,e),this.current=Do}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},v.aJ=In,v.aK=class extends er{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},v.aL=class extends er{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},v.aM=Kn,v.aN=function(i,e,r,o,u,g,_){var y=1/(e-r),S=1/(o-u),I=1/(g-_);return i[0]=-2*y,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*S,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*I,i[11]=0,i[12]=(e+r)*y,i[13]=(u+o)*S,i[14]=(_+g)*I,i[15]=1,i},v.aO=ci,v.aP=px,v.aQ=class extends Pa{},v.aR=av,v.aS=class extends Ca{},v.aT=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},v.aU=bf,v.aV=k,v.aW=class extends Nl{},v.aX=be,v.aY=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]&&i[9]===e[9]&&i[10]===e[10]&&i[11]===e[11]&&i[12]===e[12]&&i[13]===e[13]&&i[14]===e[14]&&i[15]===e[15]},v.aZ=function(i,e){var r=i[0],o=i[1],u=i[2],g=i[3],_=i[4],y=i[5],S=i[6],I=i[7],P=i[8],C=i[9],z=i[10],F=i[11],B=i[12],G=i[13],K=i[14],te=i[15],he=e[0],re=e[1],le=e[2],we=e[3],Ee=e[4],Ye=e[5],st=e[6],Xe=e[7],Ze=e[8],$e=e[9],rt=e[10],He=e[11],Le=e[12],mt=e[13],lt=e[14],Ut=e[15];return Math.abs(r-he)<=Fr*Math.max(1,Math.abs(r),Math.abs(he))&&Math.abs(o-re)<=Fr*Math.max(1,Math.abs(o),Math.abs(re))&&Math.abs(u-le)<=Fr*Math.max(1,Math.abs(u),Math.abs(le))&&Math.abs(g-we)<=Fr*Math.max(1,Math.abs(g),Math.abs(we))&&Math.abs(_-Ee)<=Fr*Math.max(1,Math.abs(_),Math.abs(Ee))&&Math.abs(y-Ye)<=Fr*Math.max(1,Math.abs(y),Math.abs(Ye))&&Math.abs(S-st)<=Fr*Math.max(1,Math.abs(S),Math.abs(st))&&Math.abs(I-Xe)<=Fr*Math.max(1,Math.abs(I),Math.abs(Xe))&&Math.abs(P-Ze)<=Fr*Math.max(1,Math.abs(P),Math.abs(Ze))&&Math.abs(C-$e)<=Fr*Math.max(1,Math.abs(C),Math.abs($e))&&Math.abs(z-rt)<=Fr*Math.max(1,Math.abs(z),Math.abs(rt))&&Math.abs(F-He)<=Fr*Math.max(1,Math.abs(F),Math.abs(He))&&Math.abs(B-Le)<=Fr*Math.max(1,Math.abs(B),Math.abs(Le))&&Math.abs(G-mt)<=Fr*Math.max(1,Math.abs(G),Math.abs(mt))&&Math.abs(K-lt)<=Fr*Math.max(1,Math.abs(K),Math.abs(lt))&&Math.abs(te-Ut)<=Fr*Math.max(1,Math.abs(te),Math.abs(Ut))},v.a_=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},v.aa=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,o,u,g)=>{const _=u||g;return e[o]=!_||_.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e},v.ab=function(i,e){const r=[];for(const o in i)o in e||r.push(o);return r},v.ac=ot,v.ad=function(i,e,r){var o=Math.sin(r),u=Math.cos(r),g=e[0],_=e[1],y=e[2],S=e[3],I=e[4],P=e[5],C=e[6],z=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=g*u+I*o,i[1]=_*u+P*o,i[2]=y*u+C*o,i[3]=S*u+z*o,i[4]=I*u-g*o,i[5]=P*u-_*o,i[6]=C*u-y*o,i[7]=z*u-S*o,i},v.ae=function(i){var e=new Fa(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},v.af=Iu,v.ag=function(i,e){let r=0,o=0;if(i.kind==="constant")o=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:u,minZoom:g,maxZoom:_}=i,y=u?ot(_r.interpolationFactor(u,e,g,_),0,1):0;i.kind==="camera"?o=Tr.number(i.minSize,i.maxSize,y):r=y}return{uSizeT:r,uSize:o}},v.ai=function(i,{uSize:e,uSizeT:r},{lowerSize:o,upperSize:u}){return i.kind==="source"?o/Jn:i.kind==="composite"?Tr.number(o/Jn,u/Jn,r):e},v.aj=Md,v.ak=function(i,e,r,o){const u=e.y-i.y,g=e.x-i.x,_=o.y-r.y,y=o.x-r.x,S=_*g-y*u;if(S===0)return null;const I=(y*(i.y-r.y)-_*(i.x-r.x))/S;return new N(i.x+I*g,i.y+I*u)},v.al=wm,v.am=$l,v.an=cd,v.ao=tr,v.aq=Cd,v.ar=function(i,e){var r=e[0],o=e[1],u=e[2],g=e[3],_=e[4],y=e[5],S=e[6],I=e[7],P=e[8],C=e[9],z=e[10],F=e[11],B=e[12],G=e[13],K=e[14],te=e[15],he=r*y-o*_,re=r*S-u*_,le=r*I-g*_,we=o*S-u*y,Ee=o*I-g*y,Ye=u*I-g*S,st=P*G-C*B,Xe=P*K-z*B,Ze=P*te-F*B,$e=C*K-z*G,rt=C*te-F*G,He=z*te-F*K,Le=he*He-re*rt+le*$e+we*Ze-Ee*Xe+Ye*st;return Le?(i[0]=(y*He-S*rt+I*$e)*(Le=1/Le),i[1]=(u*rt-o*He-g*$e)*Le,i[2]=(G*Ye-K*Ee+te*we)*Le,i[3]=(z*Ee-C*Ye-F*we)*Le,i[4]=(S*Ze-_*He-I*Xe)*Le,i[5]=(r*He-u*Ze+g*Xe)*Le,i[6]=(K*le-B*Ye-te*re)*Le,i[7]=(P*Ye-z*le+F*re)*Le,i[8]=(_*rt-y*Ze+I*st)*Le,i[9]=(o*Ze-r*rt-g*st)*Le,i[10]=(B*Ee-G*le+te*he)*Le,i[11]=(C*le-P*Ee-F*he)*Le,i[12]=(y*Xe-_*$e-S*st)*Le,i[13]=(r*$e-o*Xe+u*st)*Le,i[14]=(G*re-B*we-K*he)*Le,i[15]=(P*we-C*re+z*he)*Le,i):null},v.as=Bd,v.at=Pd,v.au=Nd,v.av=function(){const i={},e=ee.$version;for(const r in ee.$root){const o=ee.$root[r];if(o.required){let u=null;u=r==="version"?e:o.type==="array"?[]:{},u!=null&&(i[r]=u)}}return i},v.aw=du,v.ax=Qe,v.ay=function(i){i=i.slice();const e=Object.create(null);for(let r=0;r<i.length;r++)e[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=et(i[r],e[i[r].ref]));return i},v.az=function(i){if(i.type==="custom")return new Dv(i);switch(i.type){case"background":return new Cv(i);case"circle":return new fx(i);case"fill":return new Rx(i);case"fill-extrusion":return new Kx(i);case"heatmap":return new gx(i);case"hillshade":return new yx(i);case"line":return new rv(i);case"raster":return new kv(i);case"symbol":return new Fu(i)}},v.b=Xt,v.b0=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},v.b1=at,v.b2=mm,v.b3=pm,v.b4=function(i,e,r,o,u){var g,_=1/Math.tan(e/2);return i[0]=_/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=_,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,u!=null&&u!==1/0?(i[10]=(u+o)*(g=1/(o-u)),i[14]=2*u*o*g):(i[10]=-1,i[14]=-2*o),i},v.b5=function(i,e,r){var o=Math.sin(r),u=Math.cos(r),g=e[4],_=e[5],y=e[6],S=e[7],I=e[8],P=e[9],C=e[10],z=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=g*u+I*o,i[5]=_*u+P*o,i[6]=y*u+C*o,i[7]=S*u+z*o,i[8]=I*u-g*o,i[9]=P*u-_*o,i[10]=C*u-y*o,i[11]=z*u-S*o,i},v.b6=ye,v.b7=Be,v.b8=function(i){return i*Math.PI/180},v.b9=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},v.bA=Wn,v.ba=class extends Dn{},v.bb=Rd,v.bc=jv,v.be=tt,v.bf=function(i,e){gr.REGISTERED_PROTOCOLS[i]=e},v.bg=function(i){delete gr.REGISTERED_PROTOCOLS[i]},v.bh=function(i,e){const r={};for(let u=0;u<i.length;u++){const g=e&&e[i[u].id]||nd(i[u]);e&&(e[i[u].id]=g);let _=r[g];_||(_=r[g]=[]),_.push(i[u])}const o=[];for(const u in r)o.push(r[u]);return o},v.bi=it,v.bj=_m,v.bk=xm,v.bl=Yf,v.bm=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=Bi/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],r=e.layout,o=e._unevaluatedLayout._values,u={layoutIconSize:o["icon-size"].possiblyEvaluate(new Ai(i.bucket.zoom+1),i.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new Ai(i.bucket.zoom+1),i.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new Ai(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:I,maxZoom:P}=i.bucket.textSizeData;u.compositeTextSizes=[o["text-size"].possiblyEvaluate(new Ai(I),i.canonical),o["text-size"].possiblyEvaluate(new Ai(P),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:I,maxZoom:P}=i.bucket.iconSizeData;u.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new Ai(I),i.canonical),o["icon-size"].possiblyEvaluate(new Ai(P),i.canonical)]}const g=r.get("text-line-height")*tr,_=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",y=r.get("text-keep-upright"),S=r.get("text-size");for(const I of i.bucket.features){const P=r.get("text-font").evaluate(I,{},i.canonical).join(","),C=S.evaluate(I,{},i.canonical),z=u.layoutTextSize.evaluate(I,{},i.canonical),F=u.layoutIconSize.evaluate(I,{},i.canonical),B={horizontal:{},vertical:void 0},G=I.text;let K,te=[0,0];if(G){const le=G.toString(),we=r.get("text-letter-spacing").evaluate(I,{},i.canonical)*tr,Ee=pu(le)?we:0,Ye=r.get("text-anchor").evaluate(I,{},i.canonical),st=km(e,I,i.canonical);if(!st){const He=r.get("text-radial-offset").evaluate(I,{},i.canonical);te=He?Mm(Ye,[He*tr,Od]):r.get("text-offset").evaluate(I,{},i.canonical).map(Le=>Le*tr)}let Xe=_?"center":r.get("text-justify").evaluate(I,{},i.canonical);const Ze=r.get("symbol-placement"),$e=Ze==="point"?r.get("text-max-width").evaluate(I,{},i.canonical)*tr:0,rt=()=>{i.bucket.allowVerticalPlacement&&$s(le)&&(B.vertical=zu(G,i.glyphMap,i.glyphPositions,i.imagePositions,P,$e,g,Ye,"left",Ee,te,v.ah.vertical,!0,Ze,z,C))};if(!_&&st){const He=new Set;if(Xe==="auto")for(let mt=0;mt<st.values.length;mt+=2)He.add(Bd(st.values[mt]));else He.add(Xe);let Le=!1;for(const mt of He)if(!B.horizontal[mt])if(Le)B.horizontal[mt]=B.horizontal[0];else{const lt=zu(G,i.glyphMap,i.glyphPositions,i.imagePositions,P,$e,g,"center",mt,Ee,te,v.ah.horizontal,!1,Ze,z,C);lt&&(B.horizontal[mt]=lt,Le=lt.positionedLines.length===1)}rt()}else{Xe==="auto"&&(Xe=Bd(Ye));const He=zu(G,i.glyphMap,i.glyphPositions,i.imagePositions,P,$e,g,Ye,Xe,Ee,te,v.ah.horizontal,!1,Ze,z,C);He&&(B.horizontal[Xe]=He),rt(),$s(le)&&_&&y&&(B.vertical=zu(G,i.glyphMap,i.glyphPositions,i.imagePositions,P,$e,g,Ye,Xe,Ee,te,v.ah.vertical,!1,Ze,z,C))}}let he=!1;if(I.icon&&I.icon.name){const le=i.imageMap[I.icon.name];le&&(K=Tv(i.imagePositions[I.icon.name],r.get("icon-offset").evaluate(I,{},i.canonical),r.get("icon-anchor").evaluate(I,{},i.canonical)),he=!!le.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=he:i.bucket.sdfIcons!==he&&Bt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(le.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const re=zm(B.horizontal)||B.vertical;i.bucket.iconsInText=!!re&&re.iconsInText,(re||K)&&$v(i.bucket,I,B,K,i.imageMap,u,z,F,te,he,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},v.bn=wd,v.bo=xd,v.bp=bd,v.bq=js,v.br=Td,v.bs=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},v.bt=function(i,e,r,o,u){return h(this,void 0,void 0,function*(){if(We())try{return yield wr(i,e,r,o,u)}catch{}return function(g,_,y,S,I){const P=g.width,C=g.height;bi&&oi||(bi=new OffscreenCanvas(P,C),oi=bi.getContext("2d",{willReadFrequently:!0})),bi.width=P,bi.height=C,oi.drawImage(g,0,0,P,C);const z=oi.getImageData(_,y,S,I);return oi.clearRect(0,0,P,C),z.data}(i,e,r,o,u)})},v.bu=gm,v.bv=L,v.bw=U,v.bx=Uf,v.by=ds,v.bz=function(i){return i.message===hr},v.c=Qr,v.d=i=>h(void 0,void 0,void 0,function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(e)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),v.e=xt,v.f=i=>new Promise((e,r)=>{const o=new Image;o.onload=()=>{e(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame(()=>{o.src=ur})},o.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const u=new Blob([new Uint8Array(i)],{type:"image/png"});o.src=i.byteLength?URL.createObjectURL(u):ur}),v.g=wi,v.h=(i,e)=>ct(xt(i,{type:"json"}),e),v.i=It,v.j=ve,v.k=ie,v.l=(i,e)=>ct(xt(i,{type:"arrayBuffer"}),e),v.m=ct,v.n=function(i){return new Td(i).readFields(yv,[])},v.o=Zl,v.p=Xf,v.q=Lr,v.r=sd,v.s=Qt,v.t=Bs,v.u=Ke,v.v=ee,v.w=Bt,v.x=fs,v.y=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}},v.z=Tr}),x("worker",["./shared"],function(v){class h{constructor(D){this.keyCache={},D&&this.replace(D)}replace(D){this._layerConfigs={},this._layers={},this.update(D,[])}update(D,R){for(const H of D){this._layerConfigs[H.id]=H;const oe=this._layers[H.id]=v.az(H);oe._featureFilter=v.a6(oe.filter),this.keyCache[H.id]&&delete this.keyCache[H.id]}for(const H of R)delete this.keyCache[H],delete this._layerConfigs[H],delete this._layers[H];this.familiesBySource={};const $=v.bh(Object.values(this._layerConfigs),this.keyCache);for(const H of $){const oe=H.map(Se=>this._layers[Se.id]),ae=oe[0];if(ae.visibility==="none")continue;const ue=ae.source||"";let ne=this.familiesBySource[ue];ne||(ne=this.familiesBySource[ue]={});const pe=ae.sourceLayer||"_geojsonTileLayer";let Me=ne[pe];Me||(Me=ne[pe]=[]),Me.push(oe)}}}class L{constructor(D){const R={},$=[];for(const ue in D){const ne=D[ue],pe=R[ue]={};for(const Me in ne){const Se=ne[+Me];if(!Se||Se.bitmap.width===0||Se.bitmap.height===0)continue;const Te={x:0,y:0,w:Se.bitmap.width+2,h:Se.bitmap.height+2};$.push(Te),pe[Me]={rect:Te,metrics:Se.metrics}}}const{w:H,h:oe}=v.p($),ae=new v.o({width:H||1,height:oe||1});for(const ue in D){const ne=D[ue];for(const pe in ne){const Me=ne[+pe];if(!Me||Me.bitmap.width===0||Me.bitmap.height===0)continue;const Se=R[ue][pe].rect;v.o.copy(Me.bitmap,ae,{x:0,y:0},{x:Se.x+1,y:Se.y+1},Me.bitmap)}}this.image=ae,this.positions=R}}v.bi("GlyphAtlas",L);class U{constructor(D){this.tileID=new v.Q(D.tileID.overscaledZ,D.tileID.wrap,D.tileID.canonical.z,D.tileID.canonical.x,D.tileID.canonical.y),this.uid=D.uid,this.zoom=D.zoom,this.pixelRatio=D.pixelRatio,this.tileSize=D.tileSize,this.source=D.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=D.showCollisionBoxes,this.collectResourceTiming=!!D.collectResourceTiming,this.returnDependencies=!!D.returnDependencies,this.promoteId=D.promoteId,this.inFlightDependencies=[]}parse(D,R,$,H){return v._(this,void 0,void 0,function*(){this.status="parsing",this.data=D,this.collisionBoxArray=new v.a4;const oe=new v.bj(Object.keys(D.layers).sort()),ae=new v.bk(this.tileID,this.promoteId);ae.bucketLayerIDs=[];const ue={},ne={featureIndex:ae,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:$},pe=R.familiesBySource[this.source];for(const Ft in pe){const Di=D.layers[Ft];if(!Di)continue;Di.version===1&&v.w(`Vector tile source "${this.source}" layer "${Ft}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ji=oe.encode(Ft),Sr=[];for(let Dr=0;Dr<Di.length;Dr++){const cr=Di.feature(Dr),bn=ae.getId(cr,Ft);Sr.push({feature:cr,id:bn,index:Dr,sourceLayerIndex:Ji})}for(const Dr of pe[Ft]){const cr=Dr[0];cr.source!==this.source&&v.w(`layer.source = ${cr.source} does not equal this.source = ${this.source}`),cr.minzoom&&this.zoom<Math.floor(cr.minzoom)||cr.maxzoom&&this.zoom>=cr.maxzoom||cr.visibility!=="none"&&(j(Dr,this.zoom,$),(ue[cr.id]=cr.createBucket({index:ae.bucketLayerIDs.length,layers:Dr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ji,sourceID:this.source})).populate(Sr,ne,this.tileID.canonical),ae.bucketLayerIDs.push(Dr.map(bn=>bn.id)))}}const Me=v.aE(ne.glyphDependencies,Ft=>Object.keys(Ft).map(Number));this.inFlightDependencies.forEach(Ft=>Ft==null?void 0:Ft.abort()),this.inFlightDependencies=[];let Se=Promise.resolve({});if(Object.keys(Me).length){const Ft=new AbortController;this.inFlightDependencies.push(Ft),Se=H.sendAsync({type:"GG",data:{stacks:Me,source:this.source,tileID:this.tileID,type:"glyphs"}},Ft)}const Te=Object.keys(ne.iconDependencies);let ht=Promise.resolve({});if(Te.length){const Ft=new AbortController;this.inFlightDependencies.push(Ft),ht=H.sendAsync({type:"GI",data:{icons:Te,source:this.source,tileID:this.tileID,type:"icons"}},Ft)}const _t=Object.keys(ne.patternDependencies);let zt=Promise.resolve({});if(_t.length){const Ft=new AbortController;this.inFlightDependencies.push(Ft),zt=H.sendAsync({type:"GI",data:{icons:_t,source:this.source,tileID:this.tileID,type:"patterns"}},Ft)}const[Et,Zt,fi]=yield Promise.all([Se,ht,zt]),Ti=new L(Et),qi=new v.bl(Zt,fi);for(const Ft in ue){const Di=ue[Ft];Di instanceof v.a5?(j(Di.layers,this.zoom,$),v.bm({bucket:Di,glyphMap:Et,glyphPositions:Ti.positions,imageMap:Zt,imagePositions:qi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Di.hasPattern&&(Di instanceof v.bn||Di instanceof v.bo||Di instanceof v.bp)&&(j(Di.layers,this.zoom,$),Di.addFeatures(ne,this.tileID.canonical,qi.patternPositions))}return this.status="done",{buckets:Object.values(ue).filter(Ft=>!Ft.isEmpty()),featureIndex:ae,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ti.image,imageAtlas:qi,glyphMap:this.returnDependencies?Et:null,iconMap:this.returnDependencies?Zt:null,glyphPositions:this.returnDependencies?Ti.positions:null}})}}function j(X,D,R){const $=new v.a8(D);for(const H of X)H.recalculate($,R)}class N{constructor(D,R,$){this.actor=D,this.layerIndex=R,this.availableImages=$,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(D,R){return v._(this,void 0,void 0,function*(){const $=yield v.l(D.request,R);try{return{vectorTile:new v.bq.VectorTile(new v.br($.data)),rawData:$.data,cacheControl:$.cacheControl,expires:$.expires}}catch(H){const oe=new Uint8Array($.data);let ae=`Unable to parse the tile at ${D.request.url}, `;throw ae+=oe[0]===31&&oe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${H.messge}`,new Error(ae)}})}loadTile(D){return v._(this,void 0,void 0,function*(){const R=D.uid,$=!!(D&&D.request&&D.request.collectResourceTiming)&&new v.bs(D.request),H=new U(D);this.loading[R]=H;const oe=new AbortController;H.abort=oe;try{const ae=yield this.loadVectorTile(D,oe);if(delete this.loading[R],!ae)return null;const ue=ae.rawData,ne={};ae.expires&&(ne.expires=ae.expires),ae.cacheControl&&(ne.cacheControl=ae.cacheControl);const pe={};if($){const Se=$.finish();Se&&(pe.resourceTiming=JSON.parse(JSON.stringify(Se)))}H.vectorTile=ae.vectorTile;const Me=H.parse(ae.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[R]=H,this.fetching[R]={rawTileData:ue,cacheControl:ne,resourceTiming:pe};try{const Se=yield Me;return v.e({rawTileData:ue.slice(0)},Se,ne,pe)}finally{delete this.fetching[R]}}catch(ae){throw delete this.loading[R],H.status="done",this.loaded[R]=H,ae}})}reloadTile(D){return v._(this,void 0,void 0,function*(){const R=D.uid;if(!this.loaded||!this.loaded[R])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const $=this.loaded[R];if($.showCollisionBoxes=D.showCollisionBoxes,$.status==="parsing"){const H=yield $.parse($.vectorTile,this.layerIndex,this.availableImages,this.actor);let oe;if(this.fetching[R]){const{rawTileData:ae,cacheControl:ue,resourceTiming:ne}=this.fetching[R];delete this.fetching[R],oe=v.e({rawTileData:ae.slice(0)},H,ue,ne)}else oe=H;return oe}if($.status==="done"&&$.vectorTile)return $.parse($.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(D){return v._(this,void 0,void 0,function*(){const R=this.loading,$=D.uid;R&&R[$]&&R[$].abort&&(R[$].abort.abort(),delete R[$])})}removeTile(D){return v._(this,void 0,void 0,function*(){this.loaded&&this.loaded[D.uid]&&delete this.loaded[D.uid]})}}class V{constructor(){this.loaded={}}loadTile(D){return v._(this,void 0,void 0,function*(){const{uid:R,encoding:$,rawImageData:H,redFactor:oe,greenFactor:ae,blueFactor:ue,baseShift:ne}=D,pe=H.width+2,Me=H.height+2,Se=v.b(H)?new v.R({width:pe,height:Me},yield v.bt(H,-1,-1,pe,Me)):H,Te=new v.bu(R,Se,$,oe,ae,ue,ne);return this.loaded=this.loaded||{},this.loaded[R]=Te,Te})}removeTile(D){const R=this.loaded,$=D.uid;R&&R[$]&&delete R[$]}}function de(X,D){if(X.length!==0){_e(X[0],D);for(var R=1;R<X.length;R++)_e(X[R],!D)}}function _e(X,D){for(var R=0,$=0,H=0,oe=X.length,ae=oe-1;H<oe;ae=H++){var ue=(X[H][0]-X[ae][0])*(X[ae][1]+X[H][1]),ne=R+ue;$+=Math.abs(R)>=Math.abs(ue)?R-ne+ue:ue-ne+R,R=ne}R+$>=0!=!!D&&X.reverse()}var Ie=v.bv(function X(D,R){var $,H=D&&D.type;if(H==="FeatureCollection")for($=0;$<D.features.length;$++)X(D.features[$],R);else if(H==="GeometryCollection")for($=0;$<D.geometries.length;$++)X(D.geometries[$],R);else if(H==="Feature")X(D.geometry,R);else if(H==="Polygon")de(D.coordinates,R);else if(H==="MultiPolygon")for($=0;$<D.coordinates.length;$++)de(D.coordinates[$],R);return D});const Je=v.bq.VectorTileFeature.prototype.toGeoJSON;var Ue={exports:{}},We=v.bw,ye=v.bq.VectorTileFeature,Be=ot;function ot(X,D){this.options=D||{},this.features=X,this.length=X.length}function at(X,D){this.id=typeof X.id=="number"?X.id:void 0,this.type=X.type,this.rawGeometry=X.type===1?[X.geometry]:X.geometry,this.properties=X.tags,this.extent=D||4096}ot.prototype.feature=function(X){return new at(this.features[X],this.options.extent)},at.prototype.loadGeometry=function(){var X=this.rawGeometry;this.geometry=[];for(var D=0;D<X.length;D++){for(var R=X[D],$=[],H=0;H<R.length;H++)$.push(new We(R[H][0],R[H][1]));this.geometry.push($)}return this.geometry},at.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var X=this.geometry,D=1/0,R=-1/0,$=1/0,H=-1/0,oe=0;oe<X.length;oe++)for(var ae=X[oe],ue=0;ue<ae.length;ue++){var ne=ae[ue];D=Math.min(D,ne.x),R=Math.max(R,ne.x),$=Math.min($,ne.y),H=Math.max(H,ne.y)}return[D,$,R,H]},at.prototype.toGeoJSON=ye.prototype.toGeoJSON;var xt=v.bx,St=Be;function dt(X){var D=new xt;return function(R,$){for(var H in R.layers)$.writeMessage(3,kt,R.layers[H])}(X,D),D.finish()}function kt(X,D){var R;D.writeVarintField(15,X.version||1),D.writeStringField(1,X.name||""),D.writeVarintField(5,X.extent||4096);var $={keys:[],values:[],keycache:{},valuecache:{}};for(R=0;R<X.length;R++)$.feature=X.feature(R),D.writeMessage(2,vt,$);var H=$.keys;for(R=0;R<H.length;R++)D.writeStringField(3,H[R]);var oe=$.values;for(R=0;R<oe.length;R++)D.writeMessage(4,It,oe[R])}function vt(X,D){var R=X.feature;R.id!==void 0&&D.writeVarintField(1,R.id),D.writeMessage(2,pt,X),D.writeVarintField(3,R.type),D.writeMessage(4,di,R)}function pt(X,D){var R=X.feature,$=X.keys,H=X.values,oe=X.keycache,ae=X.valuecache;for(var ue in R.properties){var ne=R.properties[ue],pe=oe[ue];if(ne!==null){pe===void 0&&($.push(ue),oe[ue]=pe=$.length-1),D.writeVarint(pe);var Me=typeof ne;Me!=="string"&&Me!=="boolean"&&Me!=="number"&&(ne=JSON.stringify(ne));var Se=Me+":"+ne,Te=ae[Se];Te===void 0&&(H.push(ne),ae[Se]=Te=H.length-1),D.writeVarint(Te)}}}function Bt(X,D){return(D<<3)+(7&X)}function Pt(X){return X<<1^X>>31}function di(X,D){for(var R=X.loadGeometry(),$=X.type,H=0,oe=0,ae=R.length,ue=0;ue<ae;ue++){var ne=R[ue],pe=1;$===1&&(pe=ne.length),D.writeVarint(Bt(1,pe));for(var Me=$===3?ne.length-1:ne.length,Se=0;Se<Me;Se++){Se===1&&$!==1&&D.writeVarint(Bt(2,Me-1));var Te=ne[Se].x-H,ht=ne[Se].y-oe;D.writeVarint(Pt(Te)),D.writeVarint(Pt(ht)),H+=Te,oe+=ht}$===3&&D.writeVarint(Bt(7,1))}}function It(X,D){var R=typeof X;R==="string"?D.writeStringField(1,X):R==="boolean"?D.writeBooleanField(7,X):R==="number"&&(X%1!=0?D.writeDoubleField(3,X):X<0?D.writeSVarintField(6,X):D.writeVarintField(5,X))}Ue.exports=dt,Ue.exports.fromVectorTileJs=dt,Ue.exports.fromGeojsonVt=function(X,D){D=D||{};var R={};for(var $ in X)R[$]=new St(X[$].features,D),R[$].name=$,R[$].version=D.version,R[$].extent=D.extent;return dt({layers:R})},Ue.exports.GeoJSONWrapper=St;var Ct=v.bv(Ue.exports);const Xt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:X=>X},ur=Math.fround||(wr=new Float32Array(1),X=>(wr[0]=+X,wr[0]));var wr;const bi=3,oi=5,hr=6;class Qr{constructor(D){this.options=Object.assign(Object.create(Xt),D),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(D){const{log:R,minZoom:$,maxZoom:H}=this.options;R&&console.time("total time");const oe=`prepare ${D.length} points`;R&&console.time(oe),this.points=D;const ae=[];for(let ne=0;ne<D.length;ne++){const pe=D[ne];if(!pe.geometry)continue;const[Me,Se]=pe.geometry.coordinates,Te=ur(Pe(Me)),ht=ur(tt(Se));ae.push(Te,ht,1/0,ne,-1,1),this.options.reduce&&ae.push(0)}let ue=this.trees[H+1]=this._createTree(ae);R&&console.timeEnd(oe);for(let ne=H;ne>=$;ne--){const pe=+Date.now();ue=this.trees[ne]=this._createTree(this._cluster(ue,ne)),R&&console.log("z%d: %d clusters in %dms",ne,ue.numItems,+Date.now()-pe)}return R&&console.timeEnd("total time"),this}getClusters(D,R){let $=((D[0]+180)%360+360)%360-180;const H=Math.max(-90,Math.min(90,D[1]));let oe=D[2]===180?180:((D[2]+180)%360+360)%360-180;const ae=Math.max(-90,Math.min(90,D[3]));if(D[2]-D[0]>=360)$=-180,oe=180;else if($>oe){const Se=this.getClusters([$,H,180,ae],R),Te=this.getClusters([-180,H,oe,ae],R);return Se.concat(Te)}const ue=this.trees[this._limitZoom(R)],ne=ue.range(Pe($),tt(ae),Pe(oe),tt(H)),pe=ue.data,Me=[];for(const Se of ne){const Te=this.stride*Se;Me.push(pe[Te+oi]>1?gr(pe,Te,this.clusterProps):this.points[pe[Te+bi]])}return Me}getChildren(D){const R=this._getOriginId(D),$=this._getOriginZoom(D),H="No cluster with the specified id.",oe=this.trees[$];if(!oe)throw new Error(H);const ae=oe.data;if(R*this.stride>=ae.length)throw new Error(H);const ue=this.options.radius/(this.options.extent*Math.pow(2,$-1)),ne=oe.within(ae[R*this.stride],ae[R*this.stride+1],ue),pe=[];for(const Me of ne){const Se=Me*this.stride;ae[Se+4]===D&&pe.push(ae[Se+oi]>1?gr(ae,Se,this.clusterProps):this.points[ae[Se+bi]])}if(pe.length===0)throw new Error(H);return pe}getLeaves(D,R,$){const H=[];return this._appendLeaves(H,D,R=R||10,$=$||0,0),H}getTile(D,R,$){const H=this.trees[this._limitZoom(D)],oe=Math.pow(2,D),{extent:ae,radius:ue}=this.options,ne=ue/ae,pe=($-ne)/oe,Me=($+1+ne)/oe,Se={features:[]};return this._addTileFeatures(H.range((R-ne)/oe,pe,(R+1+ne)/oe,Me),H.data,R,$,oe,Se),R===0&&this._addTileFeatures(H.range(1-ne/oe,pe,1,Me),H.data,oe,$,oe,Se),R===oe-1&&this._addTileFeatures(H.range(0,pe,ne/oe,Me),H.data,-1,$,oe,Se),Se.features.length?Se:null}getClusterExpansionZoom(D){let R=this._getOriginZoom(D)-1;for(;R<=this.options.maxZoom;){const $=this.getChildren(D);if(R++,$.length!==1)break;D=$[0].properties.cluster_id}return R}_appendLeaves(D,R,$,H,oe){const ae=this.getChildren(R);for(const ue of ae){const ne=ue.properties;if(ne&&ne.cluster?oe+ne.point_count<=H?oe+=ne.point_count:oe=this._appendLeaves(D,ne.cluster_id,$,H,oe):oe<H?oe++:D.push(ue),D.length===$)break}return oe}_createTree(D){const R=new v.au(D.length/this.stride|0,this.options.nodeSize,Float32Array);for(let $=0;$<D.length;$+=this.stride)R.add(D[$],D[$+1]);return R.finish(),R.data=D,R}_addTileFeatures(D,R,$,H,oe,ae){for(const ue of D){const ne=ue*this.stride,pe=R[ne+oi]>1;let Me,Se,Te;if(pe)Me=wi(R,ne,this.clusterProps),Se=R[ne],Te=R[ne+1];else{const zt=this.points[R[ne+bi]];Me=zt.properties;const[Et,Zt]=zt.geometry.coordinates;Se=Pe(Et),Te=tt(Zt)}const ht={type:1,geometry:[[Math.round(this.options.extent*(Se*oe-$)),Math.round(this.options.extent*(Te*oe-H))]],tags:Me};let _t;_t=pe||this.options.generateId?R[ne+bi]:this.points[R[ne+bi]].id,_t!==void 0&&(ht.id=_t),ae.features.push(ht)}}_limitZoom(D){return Math.max(this.options.minZoom,Math.min(Math.floor(+D),this.options.maxZoom+1))}_cluster(D,R){const{radius:$,extent:H,reduce:oe,minPoints:ae}=this.options,ue=$/(H*Math.pow(2,R)),ne=D.data,pe=[],Me=this.stride;for(let Se=0;Se<ne.length;Se+=Me){if(ne[Se+2]<=R)continue;ne[Se+2]=R;const Te=ne[Se],ht=ne[Se+1],_t=D.within(ne[Se],ne[Se+1],ue),zt=ne[Se+oi];let Et=zt;for(const Zt of _t){const fi=Zt*Me;ne[fi+2]>R&&(Et+=ne[fi+oi])}if(Et>zt&&Et>=ae){let Zt,fi=Te*zt,Ti=ht*zt,qi=-1;const Ft=((Se/Me|0)<<5)+(R+1)+this.points.length;for(const Di of _t){const Ji=Di*Me;if(ne[Ji+2]<=R)continue;ne[Ji+2]=R;const Sr=ne[Ji+oi];fi+=ne[Ji]*Sr,Ti+=ne[Ji+1]*Sr,ne[Ji+4]=Ft,oe&&(Zt||(Zt=this._map(ne,Se,!0),qi=this.clusterProps.length,this.clusterProps.push(Zt)),oe(Zt,this._map(ne,Ji)))}ne[Se+4]=Ft,pe.push(fi/Et,Ti/Et,1/0,Ft,-1,Et),oe&&pe.push(qi)}else{for(let Zt=0;Zt<Me;Zt++)pe.push(ne[Se+Zt]);if(Et>1)for(const Zt of _t){const fi=Zt*Me;if(!(ne[fi+2]<=R)){ne[fi+2]=R;for(let Ti=0;Ti<Me;Ti++)pe.push(ne[fi+Ti])}}}}return pe}_getOriginId(D){return D-this.points.length>>5}_getOriginZoom(D){return(D-this.points.length)%32}_map(D,R,$){if(D[R+oi]>1){const ae=this.clusterProps[D[R+hr]];return $?Object.assign({},ae):ae}const H=this.points[D[R+bi]].properties,oe=this.options.map(H);return $&&oe===H?Object.assign({},oe):oe}}function gr(X,D,R){return{type:"Feature",id:X[D+bi],properties:wi(X,D,R),geometry:{type:"Point",coordinates:[($=X[D],360*($-.5)),Qe(X[D+1])]}};var $}function wi(X,D,R){const $=X[D+oi],H=$>=1e4?`${Math.round($/1e3)}k`:$>=1e3?Math.round($/100)/10+"k":$,oe=X[D+hr],ae=oe===-1?{}:Object.assign({},R[oe]);return Object.assign(ae,{cluster:!0,cluster_id:X[D+bi],point_count:$,point_count_abbreviated:H})}function Pe(X){return X/360+.5}function tt(X){const D=Math.sin(X*Math.PI/180),R=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return R<0?0:R>1?1:R}function Qe(X){const D=(180-360*X)*Math.PI/180;return 360*Math.atan(Math.exp(D))/Math.PI-90}function ct(X,D,R,$){for(var H,oe=$,ae=R-D>>1,ue=R-D,ne=X[D],pe=X[D+1],Me=X[R],Se=X[R+1],Te=D+3;Te<R;Te+=3){var ht=Qt(X[Te],X[Te+1],ne,pe,Me,Se);if(ht>oe)H=Te,oe=ht;else if(ht===oe){var _t=Math.abs(Te-ae);_t<ue&&(H=Te,ue=_t)}}oe>$&&(H-D>3&&ct(X,D,H,$),X[H+2]=oe,R-H>3&&ct(X,H,R,$))}function Qt(X,D,R,$,H,oe){var ae=H-R,ue=oe-$;if(ae!==0||ue!==0){var ne=((X-R)*ae+(D-$)*ue)/(ae*ae+ue*ue);ne>1?(R=H,$=oe):ne>0&&(R+=ae*ne,$+=ue*ne)}return(ae=X-R)*ae+(ue=D-$)*ue}function ti(X,D,R,$){var H={id:X===void 0?null:X,type:D,geometry:R,tags:$,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(oe){var ae=oe.geometry,ue=oe.type;if(ue==="Point"||ue==="MultiPoint"||ue==="LineString")J(oe,ae);else if(ue==="Polygon"||ue==="MultiLineString")for(var ne=0;ne<ae.length;ne++)J(oe,ae[ne]);else if(ue==="MultiPolygon")for(ne=0;ne<ae.length;ne++)for(var pe=0;pe<ae[ne].length;pe++)J(oe,ae[ne][pe])}(H),H}function J(X,D){for(var R=0;R<D.length;R+=3)X.minX=Math.min(X.minX,D[R]),X.minY=Math.min(X.minY,D[R+1]),X.maxX=Math.max(X.maxX,D[R]),X.maxY=Math.max(X.maxY,D[R+1])}function ie(X,D,R,$){if(D.geometry){var H=D.geometry.coordinates,oe=D.geometry.type,ae=Math.pow(R.tolerance/((1<<R.maxZoom)*R.extent),2),ue=[],ne=D.id;if(R.promoteId?ne=D.properties[R.promoteId]:R.generateId&&(ne=$||0),oe==="Point")ve(H,ue);else if(oe==="MultiPoint")for(var pe=0;pe<H.length;pe++)ve(H[pe],ue);else if(oe==="LineString")De(H,ue,ae,!1);else if(oe==="MultiLineString"){if(R.lineMetrics){for(pe=0;pe<H.length;pe++)De(H[pe],ue=[],ae,!1),X.push(ti(ne,"LineString",ue,D.properties));return}ee(H,ue,ae,!1)}else if(oe==="Polygon")ee(H,ue,ae,!0);else{if(oe!=="MultiPolygon"){if(oe==="GeometryCollection"){for(pe=0;pe<D.geometry.geometries.length;pe++)ie(X,{id:ne,geometry:D.geometry.geometries[pe],properties:D.properties},R,$);return}throw new Error("Input data is not a valid GeoJSON object.")}for(pe=0;pe<H.length;pe++){var Me=[];ee(H[pe],Me,ae,!0),ue.push(Me)}}X.push(ti(ne,oe,ue,D.properties))}}function ve(X,D){D.push(qe(X[0])),D.push(et(X[1])),D.push(0)}function De(X,D,R,$){for(var H,oe,ae=0,ue=0;ue<X.length;ue++){var ne=qe(X[ue][0]),pe=et(X[ue][1]);D.push(ne),D.push(pe),D.push(0),ue>0&&(ae+=$?(H*pe-ne*oe)/2:Math.sqrt(Math.pow(ne-H,2)+Math.pow(pe-oe,2))),H=ne,oe=pe}var Me=D.length-3;D[2]=1,ct(D,0,Me,R),D[Me+2]=1,D.size=Math.abs(ae),D.start=0,D.end=D.size}function ee(X,D,R,$){for(var H=0;H<X.length;H++){var oe=[];De(X[H],oe,R,$),D.push(oe)}}function qe(X){return X/360+.5}function et(X){var D=Math.sin(X*Math.PI/180),R=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return R<0?0:R>1?1:R}function Ae(X,D,R,$,H,oe,ae,ue){if($/=D,oe>=(R/=D)&&ae<$)return X;if(ae<R||oe>=$)return null;for(var ne=[],pe=0;pe<X.length;pe++){var Me=X[pe],Se=Me.geometry,Te=Me.type,ht=H===0?Me.minX:Me.minY,_t=H===0?Me.maxX:Me.maxY;if(ht>=R&&_t<$)ne.push(Me);else if(!(_t<R||ht>=$)){var zt=[];if(Te==="Point"||Te==="MultiPoint")Oe(Se,zt,R,$,H);else if(Te==="LineString")Fe(Se,zt,R,$,H,!1,ue.lineMetrics);else if(Te==="MultiLineString")bt(Se,zt,R,$,H,!1);else if(Te==="Polygon")bt(Se,zt,R,$,H,!0);else if(Te==="MultiPolygon")for(var Et=0;Et<Se.length;Et++){var Zt=[];bt(Se[Et],Zt,R,$,H,!0),Zt.length&&zt.push(Zt)}if(zt.length){if(ue.lineMetrics&&Te==="LineString"){for(Et=0;Et<zt.length;Et++)ne.push(ti(Me.id,Te,zt[Et],Me.tags));continue}Te!=="LineString"&&Te!=="MultiLineString"||(zt.length===1?(Te="LineString",zt=zt[0]):Te="MultiLineString"),Te!=="Point"&&Te!=="MultiPoint"||(Te=zt.length===3?"Point":"MultiPoint"),ne.push(ti(Me.id,Te,zt,Me.tags))}}}return ne.length?ne:null}function Oe(X,D,R,$,H){for(var oe=0;oe<X.length;oe+=3){var ae=X[oe+H];ae>=R&&ae<=$&&(D.push(X[oe]),D.push(X[oe+1]),D.push(X[oe+2]))}}function Fe(X,D,R,$,H,oe,ae){for(var ue,ne,pe=nt(X),Me=H===0?Tt:jt,Se=X.start,Te=0;Te<X.length-3;Te+=3){var ht=X[Te],_t=X[Te+1],zt=X[Te+2],Et=X[Te+3],Zt=X[Te+4],fi=H===0?ht:_t,Ti=H===0?Et:Zt,qi=!1;ae&&(ue=Math.sqrt(Math.pow(ht-Et,2)+Math.pow(_t-Zt,2))),fi<R?Ti>R&&(ne=Me(pe,ht,_t,Et,Zt,R),ae&&(pe.start=Se+ue*ne)):fi>$?Ti<$&&(ne=Me(pe,ht,_t,Et,Zt,$),ae&&(pe.start=Se+ue*ne)):ft(pe,ht,_t,zt),Ti<R&&fi>=R&&(ne=Me(pe,ht,_t,Et,Zt,R),qi=!0),Ti>$&&fi<=$&&(ne=Me(pe,ht,_t,Et,Zt,$),qi=!0),!oe&&qi&&(ae&&(pe.end=Se+ue*ne),D.push(pe),pe=nt(X)),ae&&(Se+=ue)}var Ft=X.length-3;ht=X[Ft],_t=X[Ft+1],zt=X[Ft+2],(fi=H===0?ht:_t)>=R&&fi<=$&&ft(pe,ht,_t,zt),Ft=pe.length-3,oe&&Ft>=3&&(pe[Ft]!==pe[0]||pe[Ft+1]!==pe[1])&&ft(pe,pe[0],pe[1],pe[2]),pe.length&&D.push(pe)}function nt(X){var D=[];return D.size=X.size,D.start=X.start,D.end=X.end,D}function bt(X,D,R,$,H,oe){for(var ae=0;ae<X.length;ae++)Fe(X[ae],D,R,$,H,oe,!1)}function ft(X,D,R,$){X.push(D),X.push(R),X.push($)}function Tt(X,D,R,$,H,oe){var ae=(oe-D)/($-D);return X.push(oe),X.push(R+(H-R)*ae),X.push(1),ae}function jt(X,D,R,$,H,oe){var ae=(oe-R)/(H-R);return X.push(D+($-D)*ae),X.push(oe),X.push(1),ae}function Yt(X,D){for(var R=[],$=0;$<X.length;$++){var H,oe=X[$],ae=oe.type;if(ae==="Point"||ae==="MultiPoint"||ae==="LineString")H=Ce(oe.geometry,D);else if(ae==="MultiLineString"||ae==="Polygon"){H=[];for(var ue=0;ue<oe.geometry.length;ue++)H.push(Ce(oe.geometry[ue],D))}else if(ae==="MultiPolygon")for(H=[],ue=0;ue<oe.geometry.length;ue++){for(var ne=[],pe=0;pe<oe.geometry[ue].length;pe++)ne.push(Ce(oe.geometry[ue][pe],D));H.push(ne)}R.push(ti(oe.id,ae,H,oe.tags))}return R}function Ce(X,D){var R=[];R.size=X.size,X.start!==void 0&&(R.start=X.start,R.end=X.end);for(var $=0;$<X.length;$+=3)R.push(X[$]+D,X[$+1],X[$+2]);return R}function pi(X,D){if(X.transformed)return X;var R,$,H,oe=1<<X.z,ae=X.x,ue=X.y;for(R=0;R<X.features.length;R++){var ne=X.features[R],pe=ne.geometry,Me=ne.type;if(ne.geometry=[],Me===1)for($=0;$<pe.length;$+=2)ne.geometry.push(Si(pe[$],pe[$+1],D,oe,ae,ue));else for($=0;$<pe.length;$++){var Se=[];for(H=0;H<pe[$].length;H+=2)Se.push(Si(pe[$][H],pe[$][H+1],D,oe,ae,ue));ne.geometry.push(Se)}}return X.transformed=!0,X}function Si(X,D,R,$,H,oe){return[Math.round(R*(X*$-H)),Math.round(R*(D*$-oe))]}function en(X,D,R,$,H){for(var oe=D===H.maxZoom?0:H.tolerance/((1<<D)*H.extent),ae={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:R,y:$,z:D,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ue=0;ue<X.length;ue++){ae.numFeatures++,Xi(ae,X[ue],oe,H);var ne=X[ue].minX,pe=X[ue].minY,Me=X[ue].maxX,Se=X[ue].maxY;ne<ae.minX&&(ae.minX=ne),pe<ae.minY&&(ae.minY=pe),Me>ae.maxX&&(ae.maxX=Me),Se>ae.maxY&&(ae.maxY=Se)}return ae}function Xi(X,D,R,$){var H=D.geometry,oe=D.type,ae=[];if(oe==="Point"||oe==="MultiPoint")for(var ue=0;ue<H.length;ue+=3)ae.push(H[ue]),ae.push(H[ue+1]),X.numPoints++,X.numSimplified++;else if(oe==="LineString")Ve(ae,H,X,R,!1,!1);else if(oe==="MultiLineString"||oe==="Polygon")for(ue=0;ue<H.length;ue++)Ve(ae,H[ue],X,R,oe==="Polygon",ue===0);else if(oe==="MultiPolygon")for(var ne=0;ne<H.length;ne++){var pe=H[ne];for(ue=0;ue<pe.length;ue++)Ve(ae,pe[ue],X,R,!0,ue===0)}if(ae.length){var Me=D.tags||null;if(oe==="LineString"&&$.lineMetrics){for(var Se in Me={},D.tags)Me[Se]=D.tags[Se];Me.mapbox_clip_start=H.start/H.size,Me.mapbox_clip_end=H.end/H.size}var Te={geometry:ae,type:oe==="Polygon"||oe==="MultiPolygon"?3:oe==="LineString"||oe==="MultiLineString"?2:1,tags:Me};D.id!==null&&(Te.id=D.id),X.features.push(Te)}}function Ve(X,D,R,$,H,oe){var ae=$*$;if($>0&&D.size<(H?ae:$))R.numPoints+=D.length/3;else{for(var ue=[],ne=0;ne<D.length;ne+=3)($===0||D[ne+2]>ae)&&(R.numSimplified++,ue.push(D[ne]),ue.push(D[ne+1])),R.numPoints++;H&&function(pe,Me){for(var Se=0,Te=0,ht=pe.length,_t=ht-2;Te<ht;_t=Te,Te+=2)Se+=(pe[Te]-pe[_t])*(pe[Te+1]+pe[_t+1]);if(Se>0===Me)for(Te=0,ht=pe.length;Te<ht/2;Te+=2){var zt=pe[Te],Et=pe[Te+1];pe[Te]=pe[ht-2-Te],pe[Te+1]=pe[ht-1-Te],pe[ht-2-Te]=zt,pe[ht-1-Te]=Et}}(ue,oe),X.push(ue)}}function Mt(X,D){var R=(D=this.options=function(H,oe){for(var ae in oe)H[ae]=oe[ae];return H}(Object.create(this.options),D)).debug;if(R&&console.time("preprocess data"),D.maxZoom<0||D.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(D.promoteId&&D.generateId)throw new Error("promoteId and generateId cannot be used together.");var $=function(H,oe){var ae=[];if(H.type==="FeatureCollection")for(var ue=0;ue<H.features.length;ue++)ie(ae,H.features[ue],oe,ue);else ie(ae,H.type==="Feature"?H:{geometry:H},oe);return ae}(X,D);this.tiles={},this.tileCoords=[],R&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",D.indexMaxZoom,D.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),$=function(H,oe){var ae=oe.buffer/oe.extent,ue=H,ne=Ae(H,1,-1-ae,ae,0,-1,2,oe),pe=Ae(H,1,1-ae,2+ae,0,-1,2,oe);return(ne||pe)&&(ue=Ae(H,1,-ae,1+ae,0,-1,2,oe)||[],ne&&(ue=Yt(ne,1).concat(ue)),pe&&(ue=ue.concat(Yt(pe,-1)))),ue}($,D),$.length&&this.splitTile($,0,0,0),R&&($.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function gt(X,D,R){return 32*((1<<X)*R+D)+X}function ai(X,D){return D?X.properties[D]:X.id}function Ur(X,D){if(X==null)return!0;if(X.type==="Feature")return ai(X,D)!=null;if(X.type==="FeatureCollection"){const R=new Set;for(const $ of X.features){const H=ai($,D);if(H==null||R.has(H))return!1;R.add(H)}return!0}return!1}function Dt(X,D){const R=new Map;if(X!=null)if(X.type==="Feature")R.set(ai(X,D),X);else for(const $ of X.features)R.set(ai($,D),$);return R}Mt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Mt.prototype.splitTile=function(X,D,R,$,H,oe,ae){for(var ue=[X,D,R,$],ne=this.options,pe=ne.debug;ue.length;){$=ue.pop(),R=ue.pop(),D=ue.pop(),X=ue.pop();var Me=1<<D,Se=gt(D,R,$),Te=this.tiles[Se];if(!Te&&(pe>1&&console.time("creation"),Te=this.tiles[Se]=en(X,D,R,$,ne),this.tileCoords.push({z:D,x:R,y:$}),pe)){pe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",D,R,$,Te.numFeatures,Te.numPoints,Te.numSimplified),console.timeEnd("creation"));var ht="z"+D;this.stats[ht]=(this.stats[ht]||0)+1,this.total++}if(Te.source=X,H){if(D===ne.maxZoom||D===H)continue;var _t=1<<H-D;if(R!==Math.floor(oe/_t)||$!==Math.floor(ae/_t))continue}else if(D===ne.indexMaxZoom||Te.numPoints<=ne.indexMaxPoints)continue;if(Te.source=null,X.length!==0){pe>1&&console.time("clipping");var zt,Et,Zt,fi,Ti,qi,Ft=.5*ne.buffer/ne.extent,Di=.5-Ft,Ji=.5+Ft,Sr=1+Ft;zt=Et=Zt=fi=null,Ti=Ae(X,Me,R-Ft,R+Ji,0,Te.minX,Te.maxX,ne),qi=Ae(X,Me,R+Di,R+Sr,0,Te.minX,Te.maxX,ne),X=null,Ti&&(zt=Ae(Ti,Me,$-Ft,$+Ji,1,Te.minY,Te.maxY,ne),Et=Ae(Ti,Me,$+Di,$+Sr,1,Te.minY,Te.maxY,ne),Ti=null),qi&&(Zt=Ae(qi,Me,$-Ft,$+Ji,1,Te.minY,Te.maxY,ne),fi=Ae(qi,Me,$+Di,$+Sr,1,Te.minY,Te.maxY,ne),qi=null),pe>1&&console.timeEnd("clipping"),ue.push(zt||[],D+1,2*R,2*$),ue.push(Et||[],D+1,2*R,2*$+1),ue.push(Zt||[],D+1,2*R+1,2*$),ue.push(fi||[],D+1,2*R+1,2*$+1)}}},Mt.prototype.getTile=function(X,D,R){var $=this.options,H=$.extent,oe=$.debug;if(X<0||X>24)return null;var ae=1<<X,ue=gt(X,D=(D%ae+ae)%ae,R);if(this.tiles[ue])return pi(this.tiles[ue],H);oe>1&&console.log("drilling down to z%d-%d-%d",X,D,R);for(var ne,pe=X,Me=D,Se=R;!ne&&pe>0;)pe--,Me=Math.floor(Me/2),Se=Math.floor(Se/2),ne=this.tiles[gt(pe,Me,Se)];return ne&&ne.source?(oe>1&&console.log("found parent tile z%d-%d-%d",pe,Me,Se),oe>1&&console.time("drilling down"),this.splitTile(ne.source,pe,Me,Se,X,D,R),oe>1&&console.timeEnd("drilling down"),this.tiles[ue]?pi(this.tiles[ue],H):null):null};class ls extends N{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(D,R){return v._(this,void 0,void 0,function*(){const $=D.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const H=this._geoJSONIndex.getTile($.z,$.x,$.y);if(!H)return null;const oe=new class{constructor(ue){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=v.W,this.length=ue.length,this._features=ue}feature(ue){return new class{constructor(ne){this._feature=ne,this.extent=v.W,this.type=ne.type,this.properties=ne.tags,"id"in ne&&!isNaN(ne.id)&&(this.id=parseInt(ne.id,10))}loadGeometry(){if(this._feature.type===1){const ne=[];for(const pe of this._feature.geometry)ne.push([new v.P(pe[0],pe[1])]);return ne}{const ne=[];for(const pe of this._feature.geometry){const Me=[];for(const Se of pe)Me.push(new v.P(Se[0],Se[1]));ne.push(Me)}return ne}}toGeoJSON(ne,pe,Me){return Je.call(this,ne,pe,Me)}}(this._features[ue])}}(H.features);let ae=Ct(oe);return ae.byteOffset===0&&ae.byteLength===ae.buffer.byteLength||(ae=new Uint8Array(ae)),{vectorTile:oe,rawData:ae.buffer}})}loadData(D){return v._(this,void 0,void 0,function*(){var R;(R=this._pendingRequest)===null||R===void 0||R.abort();const $=!!(D&&D.request&&D.request.collectResourceTiming)&&new v.bs(D.request);this._pendingRequest=new AbortController;try{let H=yield this.loadGeoJSON(D,this._pendingRequest);if(delete this._pendingRequest,typeof H!="object")throw new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`);if(Ie(H,!0),D.filter){const ae=v.by(D.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ae.result==="error")throw new Error(ae.value.map(ne=>`${ne.key}: ${ne.message}`).join(", "));H={type:"FeatureCollection",features:H.features.filter(ne=>ae.value.evaluate({zoom:0},ne))}}this._geoJSONIndex=D.cluster?new Qr(function({superclusterOptions:ae,clusterProperties:ue}){if(!ue||!ae)return ae;const ne={},pe={},Me={accumulated:null,zoom:0},Se={properties:null},Te=Object.keys(ue);for(const ht of Te){const[_t,zt]=ue[ht],Et=v.by(zt),Zt=v.by(typeof _t=="string"?[_t,["accumulated"],["get",ht]]:_t);ne[ht]=Et.value,pe[ht]=Zt.value}return ae.map=ht=>{Se.properties=ht;const _t={};for(const zt of Te)_t[zt]=ne[zt].evaluate(Me,Se);return _t},ae.reduce=(ht,_t)=>{Se.properties=_t;for(const zt of Te)Me.accumulated=ht[zt],ht[zt]=pe[zt].evaluate(Me,Se)},ae}(D)).load(H.features):function(ae,ue){return new Mt(ae,ue)}(H,D.geojsonVtOptions),this.loaded={};const oe={};if($){const ae=$.finish();ae&&(oe.resourceTiming={},oe.resourceTiming[D.source]=JSON.parse(JSON.stringify(ae)))}return oe}catch(H){if(delete this._pendingRequest,v.bz(H))return{abandoned:!0};throw H}})}reloadTile(D){const R=this.loaded;return R&&R[D.uid]?super.reloadTile(D):this.loadTile(D)}loadGeoJSON(D,R){return v._(this,void 0,void 0,function*(){const{promoteId:$}=D;if(D.request){const H=yield v.h(D.request,R);return this._dataUpdateable=Ur(H.data,$)?Dt(H.data,$):void 0,H.data}if(typeof D.data=="string")try{const H=JSON.parse(D.data);return this._dataUpdateable=Ur(H,$)?Dt(H,$):void 0,H}catch{throw new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`)}if(!D.dataDiff)throw new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${D.source}`);return function(H,oe,ae){var ue,ne,pe,Me;if(oe.removeAll&&H.clear(),oe.remove)for(const Se of oe.remove)H.delete(Se);if(oe.add)for(const Se of oe.add){const Te=ai(Se,ae);Te!=null&&H.set(Te,Se)}if(oe.update)for(const Se of oe.update){let Te=H.get(Se.id);if(Te==null)continue;const ht=!Se.removeAllProperties&&(((ue=Se.removeProperties)===null||ue===void 0?void 0:ue.length)>0||((ne=Se.addOrUpdateProperties)===null||ne===void 0?void 0:ne.length)>0);if((Se.newGeometry||Se.removeAllProperties||ht)&&(Te=Object.assign({},Te),H.set(Se.id,Te),ht&&(Te.properties=Object.assign({},Te.properties))),Se.newGeometry&&(Te.geometry=Se.newGeometry),Se.removeAllProperties)Te.properties={};else if(((pe=Se.removeProperties)===null||pe===void 0?void 0:pe.length)>0)for(const _t of Se.removeProperties)Object.prototype.hasOwnProperty.call(Te.properties,_t)&&delete Te.properties[_t];if(((Me=Se.addOrUpdateProperties)===null||Me===void 0?void 0:Me.length)>0)for(const{key:_t,value:zt}of Se.addOrUpdateProperties)Te.properties[_t]=zt}}(this._dataUpdateable,D.dataDiff,$),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(D){return v._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(D){return this._geoJSONIndex.getClusterExpansionZoom(D.clusterId)}getClusterChildren(D){return this._geoJSONIndex.getChildren(D.clusterId)}getClusterLeaves(D){return this._geoJSONIndex.getLeaves(D.clusterId,D.limit,D.offset)}}class Yi{constructor(D){this.self=D,this.actor=new v.C(D),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(R,$)=>{if(this.externalWorkerSourceTypes[R])throw new Error(`Worker source with name "${R}" already registered.`);this.externalWorkerSourceTypes[R]=$},this.self.addProtocol=v.bf,this.self.removeProtocol=v.bg,this.self.registerRTLTextPlugin=R=>{if(v.bA.isParsed())throw new Error("RTL text plugin already registered.");v.bA.setMethods(R)},this.actor.registerMessageHandler("LDT",(R,$)=>this._getDEMWorkerSource(R,$.source).loadTile($)),this.actor.registerMessageHandler("RDT",(R,$)=>v._(this,void 0,void 0,function*(){this._getDEMWorkerSource(R,$.source).removeTile($)})),this.actor.registerMessageHandler("GCEZ",(R,$)=>v._(this,void 0,void 0,function*(){return this._getWorkerSource(R,$.type,$.source).getClusterExpansionZoom($)})),this.actor.registerMessageHandler("GCC",(R,$)=>v._(this,void 0,void 0,function*(){return this._getWorkerSource(R,$.type,$.source).getClusterChildren($)})),this.actor.registerMessageHandler("GCL",(R,$)=>v._(this,void 0,void 0,function*(){return this._getWorkerSource(R,$.type,$.source).getClusterLeaves($)})),this.actor.registerMessageHandler("LD",(R,$)=>this._getWorkerSource(R,$.type,$.source).loadData($)),this.actor.registerMessageHandler("LT",(R,$)=>this._getWorkerSource(R,$.type,$.source).loadTile($)),this.actor.registerMessageHandler("RT",(R,$)=>this._getWorkerSource(R,$.type,$.source).reloadTile($)),this.actor.registerMessageHandler("AT",(R,$)=>this._getWorkerSource(R,$.type,$.source).abortTile($)),this.actor.registerMessageHandler("RMT",(R,$)=>this._getWorkerSource(R,$.type,$.source).removeTile($)),this.actor.registerMessageHandler("RS",(R,$)=>v._(this,void 0,void 0,function*(){if(!this.workerSources[R]||!this.workerSources[R][$.type]||!this.workerSources[R][$.type][$.source])return;const H=this.workerSources[R][$.type][$.source];delete this.workerSources[R][$.type][$.source],H.removeSource!==void 0&&H.removeSource($)})),this.actor.registerMessageHandler("RM",R=>v._(this,void 0,void 0,function*(){delete this.layerIndexes[R],delete this.availableImages[R],delete this.workerSources[R],delete this.demWorkerSources[R]})),this.actor.registerMessageHandler("SR",(R,$)=>v._(this,void 0,void 0,function*(){this.referrer=$})),this.actor.registerMessageHandler("SRPS",(R,$)=>this._syncRTLPluginState(R,$)),this.actor.registerMessageHandler("IS",(R,$)=>v._(this,void 0,void 0,function*(){this.self.importScripts($)})),this.actor.registerMessageHandler("SI",(R,$)=>this._setImages(R,$)),this.actor.registerMessageHandler("UL",(R,$)=>v._(this,void 0,void 0,function*(){this._getLayerIndex(R).update($.layers,$.removedIds)})),this.actor.registerMessageHandler("SL",(R,$)=>v._(this,void 0,void 0,function*(){this._getLayerIndex(R).replace($)}))}_setImages(D,R){return v._(this,void 0,void 0,function*(){this.availableImages[D]=R;for(const $ in this.workerSources[D]){const H=this.workerSources[D][$];for(const oe in H)H[oe].availableImages=R}})}_syncRTLPluginState(D,R){return v._(this,void 0,void 0,function*(){if(v.bA.isParsed())return v.bA.getState();if(R.pluginStatus!=="loading")return v.bA.setState(R),R;const $=R.pluginURL;if(this.self.importScripts($),v.bA.isParsed()){const H={pluginStatus:"loaded",pluginURL:$};return v.bA.setState(H),H}throw v.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${$}`)})}_getAvailableImages(D){let R=this.availableImages[D];return R||(R=[]),R}_getLayerIndex(D){let R=this.layerIndexes[D];return R||(R=this.layerIndexes[D]=new h),R}_getWorkerSource(D,R,$){if(this.workerSources[D]||(this.workerSources[D]={}),this.workerSources[D][R]||(this.workerSources[D][R]={}),!this.workerSources[D][R][$]){const H={sendAsync:(oe,ae)=>(oe.targetMapId=D,this.actor.sendAsync(oe,ae))};switch(R){case"vector":this.workerSources[D][R][$]=new N(H,this._getLayerIndex(D),this._getAvailableImages(D));break;case"geojson":this.workerSources[D][R][$]=new ls(H,this._getLayerIndex(D),this._getAvailableImages(D));break;default:this.workerSources[D][R][$]=new this.externalWorkerSourceTypes[R](H,this._getLayerIndex(D),this._getAvailableImages(D))}}return this.workerSources[D][R][$]}_getDEMWorkerSource(D,R){return this.demWorkerSources[D]||(this.demWorkerSources[D]={}),this.demWorkerSources[D][R]||(this.demWorkerSources[D][R]=new V),this.demWorkerSources[D][R]}}return v.i(self)&&(self.worker=new Yi(self)),Yi}),x("index",["exports","./shared"],function(v,h){var L="4.1.3";let U,j;const N={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:p=>new Promise((t,s)=>{const l=requestAnimationFrame(t);p.signal.addEventListener("abort",()=>{cancelAnimationFrame(l),s(h.c())})}),getImageData(p,t=0){return this.getImageCanvasContext(p).getImageData(-t,-t,p.width+2*t,p.height+2*t)},getImageCanvasContext(p){const t=window.document.createElement("canvas"),s=t.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return t.width=p.width,t.height=p.height,s.drawImage(p,0,0,p.width,p.height),s},resolveURL:p=>(U||(U=document.createElement("a")),U.href=p,U.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(j==null&&(j=matchMedia("(prefers-reduced-motion: reduce)")),j.matches)}};class V{static testProp(t){if(!V.docStyle)return t[0];for(let s=0;s<t.length;s++)if(t[s]in V.docStyle)return t[s];return t[0]}static create(t,s,l){const c=window.document.createElement(t);return s!==void 0&&(c.className=s),l&&l.appendChild(c),c}static createNS(t,s){return window.document.createElementNS(t,s)}static disableDrag(){V.docStyle&&V.selectProp&&(V.userSelect=V.docStyle[V.selectProp],V.docStyle[V.selectProp]="none")}static enableDrag(){V.docStyle&&V.selectProp&&(V.docStyle[V.selectProp]=V.userSelect)}static setTransform(t,s){t.style[V.transformProp]=s}static addEventListener(t,s,l,c={}){t.addEventListener(s,l,"passive"in c?c:c.capture)}static removeEventListener(t,s,l,c={}){t.removeEventListener(s,l,"passive"in c?c:c.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",V.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",V.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",V.suppressClickInternal,!0)},0)}static getScale(t){const s=t.getBoundingClientRect();return{x:s.width/t.offsetWidth||1,y:s.height/t.offsetHeight||1,boundingClientRect:s}}static getPoint(t,s,l){const c=s.boundingClientRect;return new h.P((l.clientX-c.left)/s.x-t.clientLeft,(l.clientY-c.top)/s.y-t.clientTop)}static mousePos(t,s){const l=V.getScale(t);return V.getPoint(t,l,s)}static touchPos(t,s){const l=[],c=V.getScale(t);for(let f=0;f<s.length;f++)l.push(V.getPoint(t,c,s[f]));return l}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}V.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,V.selectProp=V.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),V.transformProp=V.testProp(["transform","WebkitTransform"]);const de={supported:!1,testSupport:function(p){!Je&&Ie&&(Ue?We(p):_e=p)}};let _e,Ie,Je=!1,Ue=!1;function We(p){const t=p.createTexture();p.bindTexture(p.TEXTURE_2D,t);try{if(p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,Ie),p.isContextLost())return;de.supported=!0}catch{}p.deleteTexture(t),Je=!0}var ye;typeof document<"u"&&(Ie=document.createElement("img"),Ie.onload=function(){_e&&We(_e),_e=null,Ue=!0},Ie.onerror=function(){Je=!0,_e=null},Ie.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(p){let t,s,l,c;p.resetRequestQueue=()=>{t=[],s=0,l=0,c={}},p.addThrottleControl=A=>{const E=l++;return c[E]=A,E},p.removeThrottleControl=A=>{delete c[A],b()},p.getImage=(A,E,M=!0)=>new Promise((k,O)=>{de.supported&&(A.headers||(A.headers={}),A.headers.accept="image/webp,*/*"),h.e(A,{type:"image"}),t.push({abortController:E,requestParameters:A,supportImageRefresh:M,state:"queued",onError:W=>{O(W)},onSuccess:W=>{k(W)}}),b()});const f=A=>h._(this,void 0,void 0,function*(){A.state="running";const{requestParameters:E,supportImageRefresh:M,onError:k,onSuccess:O,abortController:W}=A,Z=M===!1&&!h.i(self)&&!h.g(E.url)&&(!E.headers||Object.keys(E.headers).reduce((se,me)=>se&&me==="accept",!0));s++;const Y=Z?w(E,W):h.m(E,W);try{const se=yield Y;delete A.abortController,A.state="completed",se.data instanceof HTMLImageElement||h.b(se.data)?O(se):se.data&&O({data:yield(q=se.data,typeof createImageBitmap=="function"?h.d(q):h.f(q)),cacheControl:se.cacheControl,expires:se.expires})}catch(se){delete A.abortController,k(se)}finally{s--,b()}var q}),b=()=>{const A=(()=>{for(const E of Object.keys(c))if(c[E]())return!0;return!1})()?h.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:h.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let E=s;E<A&&t.length>0;E++){const M=t.shift();M.abortController.signal.aborted?E--:f(M)}},w=(A,E)=>new Promise((M,k)=>{const O=new Image,W=A.url,Z=A.credentials;Z&&Z==="include"?O.crossOrigin="use-credentials":(Z&&Z==="same-origin"||!h.s(W))&&(O.crossOrigin="anonymous"),E.signal.addEventListener("abort",()=>{O.src="",k(h.c())}),O.fetchPriority="high",O.onload=()=>{O.onerror=O.onload=null,M({data:O})},O.onerror=()=>{O.onerror=O.onload=null,E.signal.aborted||k(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},O.src=W})}(ye||(ye={})),ye.resetRequestQueue();class Be{constructor(t){this._transformRequestFn=t}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}normalizeSpriteURL(t,s,l){const c=function(f){const b=f.match(ot);if(!b)throw new Error(`Unable to parse URL "${f}"`);return{protocol:b[1],authority:b[2],path:b[3]||"/",params:b[4]?b[4].split("&"):[]}}(t);return c.path+=`${s}${l}`,function(f){const b=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${b}`}(c)}setTransformRequest(t){this._transformRequestFn=t}}const ot=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function at(p){var t=new h.A(3);return t[0]=p[0],t[1]=p[1],t[2]=p[2],t}var xt,St=function(p,t,s){return p[0]=t[0]-s[0],p[1]=t[1]-s[1],p[2]=t[2]-s[2],p};xt=new h.A(3),h.A!=Float32Array&&(xt[0]=0,xt[1]=0,xt[2]=0);var dt=function(p){var t=p[0],s=p[1];return t*t+s*s};function kt(p){const t=[];if(typeof p=="string")t.push({id:"default",url:p});else if(p&&p.length>0){const s=[];for(const{id:l,url:c}of p){const f=`${l}${c}`;s.indexOf(f)===-1&&(s.push(f),t.push({id:l,url:c}))}}return t}(function(){var p=new h.A(2);h.A!=Float32Array&&(p[0]=0,p[1]=0)})();class vt{constructor(t,s,l,c){this.context=t,this.format=l,this.texture=t.gl.createTexture(),this.update(s,c)}update(t,s,l){const{width:c,height:f}=t,b=!(this.size&&this.size[0]===c&&this.size[1]===f||l),{context:w}=this,{gl:A}=w;if(this.useMipmap=!!(s&&s.useMipmap),A.bindTexture(A.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===A.RGBA&&(!s||s.premultiply!==!1)),b)this.size=[c,f],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||h.b(t)?A.texImage2D(A.TEXTURE_2D,0,this.format,this.format,A.UNSIGNED_BYTE,t):A.texImage2D(A.TEXTURE_2D,0,this.format,c,f,0,this.format,A.UNSIGNED_BYTE,t.data);else{const{x:E,y:M}=l||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||h.b(t)?A.texSubImage2D(A.TEXTURE_2D,0,E,M,A.RGBA,A.UNSIGNED_BYTE,t):A.texSubImage2D(A.TEXTURE_2D,0,E,M,c,f,A.RGBA,A.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&A.generateMipmap(A.TEXTURE_2D)}bind(t,s,l){const{context:c}=this,{gl:f}=c;f.bindTexture(f.TEXTURE_2D,this.texture),l!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=f.LINEAR),t!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,t),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,l||t),this.filter=t),s!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,s),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function pt(p){const{userImage:t}=p;return!!(t&&t.render&&t.render())&&(p.data.replace(new Uint8Array(t.data.buffer)),!0)}class Bt extends h.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new h.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:s,promiseResolve:l}of this.requestors)l(this._getImagesForIds(s));this.requestors=[]}}getImage(t){const s=this.images[t];if(s&&!s.data&&s.spriteData){const l=s.spriteData;s.data=new h.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),s.spriteData=null}return s}addImage(t,s){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,s)&&(this.images[t]=s)}_validate(t,s){let l=!0;const c=s.data||s.spriteData;return this._validateStretch(s.stretchX,c&&c.width)||(this.fire(new h.j(new Error(`Image "${t}" has invalid "stretchX" value`))),l=!1),this._validateStretch(s.stretchY,c&&c.height)||(this.fire(new h.j(new Error(`Image "${t}" has invalid "stretchY" value`))),l=!1),this._validateContent(s.content,s)||(this.fire(new h.j(new Error(`Image "${t}" has invalid "content" value`))),l=!1),l}_validateStretch(t,s){if(!t)return!0;let l=0;for(const c of t){if(c[0]<l||c[1]<c[0]||s<c[1])return!1;l=c[1]}return!0}_validateContent(t,s){if(!t)return!0;if(t.length!==4)return!1;const l=s.spriteData,c=l&&l.width||s.data.width,f=l&&l.height||s.data.height;return!(t[0]<0||c<t[0]||t[1]<0||f<t[1]||t[2]<0||c<t[2]||t[3]<0||f<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,s,l=!0){const c=this.getImage(t);if(l&&(c.data.width!==s.data.width||c.data.height!==s.data.height))throw new Error(`size mismatch between old image (${c.data.width}x${c.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=c.version+1,this.images[t]=s,this.updatedImages[t]=!0}removeImage(t){const s=this.images[t];delete this.images[t],delete this.patterns[t],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise((s,l)=>{let c=!0;if(!this.isLoaded())for(const f of t)this.images[f]||(c=!1);this.isLoaded()||c?s(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:s})})}_getImagesForIds(t){const s={};for(const l of t){let c=this.getImage(l);c||(this.fire(new h.k("styleimagemissing",{id:l})),c=this.getImage(l)),c?s[l]={data:c.data.clone(),pixelRatio:c.pixelRatio,sdf:c.sdf,version:c.version,stretchX:c.stretchX,stretchY:c.stretchY,content:c.content,hasRenderCallback:!!(c.userImage&&c.userImage.render)}:h.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return s}getPixelSize(){const{width:t,height:s}=this.atlasImage;return{width:t,height:s}}getPattern(t){const s=this.patterns[t],l=this.getImage(t);if(!l)return null;if(s&&s.position.version===l.version)return s.position;if(s)s.position.version=l.version;else{const c={w:l.data.width+2,h:l.data.height+2,x:0,y:0},f=new h.I(c,l);this.patterns[t]={bin:c,position:f}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const s=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new vt(t,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const f in this.patterns)t.push(this.patterns[f].bin);const{w:s,h:l}=h.p(t),c=this.atlasImage;c.resize({width:s||1,height:l||1});for(const f in this.patterns){const{bin:b}=this.patterns[f],w=b.x+1,A=b.y+1,E=this.getImage(f).data,M=E.width,k=E.height;h.R.copy(E,c,{x:0,y:0},{x:w,y:A},{width:M,height:k}),h.R.copy(E,c,{x:0,y:k-1},{x:w,y:A-1},{width:M,height:1}),h.R.copy(E,c,{x:0,y:0},{x:w,y:A+k},{width:M,height:1}),h.R.copy(E,c,{x:M-1,y:0},{x:w-1,y:A},{width:1,height:k}),h.R.copy(E,c,{x:0,y:0},{x:w+M,y:A},{width:1,height:k})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const s of t){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const l=this.getImage(s);l||h.w(`Image with ID: "${s}" was not found`),pt(l)&&this.updateImage(s,l)}}}const Pt=1e20;function di(p,t,s,l,c,f,b,w,A){for(let E=t;E<t+l;E++)It(p,s*f+E,f,c,b,w,A);for(let E=s;E<s+c;E++)It(p,E*f+t,1,l,b,w,A)}function It(p,t,s,l,c,f,b){f[0]=0,b[0]=-Pt,b[1]=Pt,c[0]=p[t];for(let w=1,A=0,E=0;w<l;w++){c[w]=p[t+w*s];const M=w*w;do{const k=f[A];E=(c[w]-c[k]+M-k*k)/(w-k)/2}while(E<=b[A]&&--A>-1);A++,f[A]=w,b[A]=E,b[A+1]=Pt}for(let w=0,A=0;w<l;w++){for(;b[A+1]<w;)A++;const E=f[A],M=w-E;p[t+w*s]=c[E]+M*M}}class Ct{constructor(t,s){this.requestManager=t,this.localIdeographFontFamily=s,this.entries={}}setURL(t){this.url=t}getGlyphs(t){return h._(this,void 0,void 0,function*(){const s=[];for(const f in t)for(const b of t[f])s.push(this._getAndCacheGlyphsPromise(f,b));const l=yield Promise.all(s),c={};for(const{stack:f,id:b,glyph:w}of l)c[f]||(c[f]={}),c[f][b]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics};return c})}_getAndCacheGlyphsPromise(t,s){return h._(this,void 0,void 0,function*(){let l=this.entries[t];l||(l=this.entries[t]={glyphs:{},requests:{},ranges:{}});let c=l.glyphs[s];if(c!==void 0)return{stack:t,id:s,glyph:c};if(c=this._tinySDF(l,t,s),c)return l.glyphs[s]=c,{stack:t,id:s,glyph:c};const f=Math.floor(s/256);if(256*f>65535)throw new Error("glyphs > 65535 not supported");if(l.ranges[f])return{stack:t,id:s,glyph:c};if(!this.url)throw new Error("glyphsUrl is not set");if(!l.requests[f]){const w=Ct.loadGlyphRange(t,f,this.url,this.requestManager);l.requests[f]=w}const b=yield l.requests[f];for(const w in b)this._doesCharSupportLocalGlyph(+w)||(l.glyphs[+w]=b[+w]);return l.ranges[f]=!0,{stack:t,id:s,glyph:b[s]||null}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(h.u["CJK Unified Ideographs"](t)||h.u["Hangul Syllables"](t)||h.u.Hiragana(t)||h.u.Katakana(t))}_tinySDF(t,s,l){const c=this.localIdeographFontFamily;if(!c||!this._doesCharSupportLocalGlyph(l))return;let f=t.tinySDF;if(!f){let w="400";/bold/i.test(s)?w="900":/medium/i.test(s)?w="500":/light/i.test(s)&&(w="200"),f=t.tinySDF=new Ct.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:w})}const b=f.draw(String.fromCharCode(l));return{id:l,bitmap:new h.o({width:b.width||60,height:b.height||60},b.data),metrics:{width:b.glyphWidth/2||24,height:b.glyphHeight/2||24,left:b.glyphLeft/2+.5||0,top:b.glyphTop/2-27.5||-8,advance:b.glyphAdvance/2||24,isDoubleResolution:!0}}}}Ct.loadGlyphRange=function(p,t,s,l){return h._(this,void 0,void 0,function*(){const c=256*t,f=c+255,b=l.transformRequest(s.replace("{fontstack}",p).replace("{range}",`${c}-${f}`),"Glyphs"),w=yield h.l(b,new AbortController);if(!w||!w.data)throw new Error(`Could not load glyph range. range: ${t}, ${c}-${f}`);const A={};for(const E of h.n(w.data))A[E.id]=E;return A})},Ct.TinySDF=class{constructor({fontSize:p=24,buffer:t=3,radius:s=8,cutoff:l=.25,fontFamily:c="sans-serif",fontWeight:f="normal",fontStyle:b="normal"}={}){this.buffer=t,this.cutoff=l,this.radius=s;const w=this.size=p+4*t,A=this._createCanvas(w),E=this.ctx=A.getContext("2d",{willReadFrequently:!0});E.font=`${b} ${f} ${p}px ${c}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(p){const t=document.createElement("canvas");return t.width=t.height=p,t}draw(p){const{width:t,actualBoundingBoxAscent:s,actualBoundingBoxDescent:l,actualBoundingBoxLeft:c,actualBoundingBoxRight:f}=this.ctx.measureText(p),b=Math.ceil(s),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-c))),A=Math.min(this.size-this.buffer,b+Math.ceil(l)),E=w+2*this.buffer,M=A+2*this.buffer,k=Math.max(E*M,0),O=new Uint8ClampedArray(k),W={data:O,width:E,height:M,glyphWidth:w,glyphHeight:A,glyphTop:b,glyphLeft:0,glyphAdvance:t};if(w===0||A===0)return W;const{ctx:Z,buffer:Y,gridInner:q,gridOuter:se}=this;Z.clearRect(Y,Y,w,A),Z.fillText(p,Y,Y+b);const me=Z.getImageData(Y,Y,w,A);se.fill(Pt,0,k),q.fill(0,0,k);for(let Q=0;Q<A;Q++)for(let ce=0;ce<w;ce++){const ge=me.data[4*(Q*w+ce)+3]/255;if(ge===0)continue;const xe=(Q+Y)*E+ce+Y;if(ge===1)se[xe]=0,q[xe]=Pt;else{const be=.5-ge;se[xe]=be>0?be*be:0,q[xe]=be<0?be*be:0}}di(se,0,0,E,M,E,this.f,this.v,this.z),di(q,Y,Y,w,A,E,this.f,this.v,this.z);for(let Q=0;Q<k;Q++){const ce=Math.sqrt(se[Q])-Math.sqrt(q[Q]);O[Q]=Math.round(255-255*(ce/this.radius+this.cutoff))}return W}};class Xt{constructor(){this.specification=h.v.light.position}possiblyEvaluate(t,s){return h.y(t.expression.evaluate(s))}interpolate(t,s,l){return{x:h.z.number(t.x,s.x,l),y:h.z.number(t.y,s.y,l),z:h.z.number(t.z,s.z,l)}}}let ur;class wr extends h.E{constructor(t){super(),ur=ur||new h.q({anchor:new h.D(h.v.light.anchor),position:new Xt,color:new h.D(h.v.light.color),intensity:new h.D(h.v.light.intensity)}),this._transitionable=new h.T(ur),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s={}){if(!this._validate(h.r,t,s))for(const l in t){const c=t[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),c):this._transitionable.setValue(l,c)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,l){return(!l||l.validate!==!1)&&h.t(this,t.call(h.x,{value:s,style:{glyphs:!0,sprite:!0},styleSpec:h.v}))}}class bi{constructor(t,s){this.width=t,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,s){const l=t.join(",")+String(s);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(t,s)),this.dashEntry[l]}getDashRanges(t,s,l){const c=[];let f=t.length%2==1?-t[t.length-1]*l:0,b=t[0]*l,w=!0;c.push({left:f,right:b,isDash:w,zeroLength:t[0]===0});let A=t[0];for(let E=1;E<t.length;E++){w=!w;const M=t[E];f=A*l,A+=M,b=A*l,c.push({left:f,right:b,isDash:w,zeroLength:M===0})}return c}addRoundDash(t,s,l){const c=s/2;for(let f=-l;f<=l;f++){const b=this.width*(this.nextRow+l+f);let w=0,A=t[w];for(let E=0;E<this.width;E++){E/A.right>1&&(A=t[++w]);const M=Math.abs(E-A.left),k=Math.abs(E-A.right),O=Math.min(M,k);let W;const Z=f/l*(c+1);if(A.isDash){const Y=c-Math.abs(Z);W=Math.sqrt(O*O+Y*Y)}else W=c-Math.sqrt(O*O+Z*Z);this.data[b+E]=Math.max(0,Math.min(255,W+128))}}}addRegularDash(t){for(let w=t.length-1;w>=0;--w){const A=t[w],E=t[w+1];A.zeroLength?t.splice(w,1):E&&E.isDash===A.isDash&&(E.left=A.left,t.splice(w,1))}const s=t[0],l=t[t.length-1];s.isDash===l.isDash&&(s.left=l.left-this.width,l.right=s.right+this.width);const c=this.width*this.nextRow;let f=0,b=t[f];for(let w=0;w<this.width;w++){w/b.right>1&&(b=t[++f]);const A=Math.abs(w-b.left),E=Math.abs(w-b.right),M=Math.min(A,E);this.data[c+w]=Math.max(0,Math.min(255,(b.isDash?M:-M)+128))}}addDash(t,s){const l=s?7:0,c=2*l+1;if(this.nextRow+c>this.height)return h.w("LineAtlas out of space"),null;let f=0;for(let w=0;w<t.length;w++)f+=t[w];if(f!==0){const w=this.width/f,A=this.getDashRanges(t,this.width,w);s?this.addRoundDash(A,w,l):this.addRegularDash(A)}const b={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:f};return this.nextRow+=c,this.dirty=!0,b}bind(t){const s=t.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}const oi="maplibre_preloaded_worker_pool";class hr{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<hr.workerCount;)this.workers.push(new Worker(h.a.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[oi]}numActive(){return Object.keys(this.active).length}}const Qr=Math.floor(N.hardwareConcurrency/2);let gr,wi;function Pe(){return gr||(gr=new hr),gr}hr.workerCount=h.B(globalThis)?Math.max(Math.min(Qr,3),1):1;class tt{constructor(t,s){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=s;const l=this.workerPool.acquire(s);for(let c=0;c<l.length;c++){const f=new h.C(l[c],s);f.name=`Worker ${c}`,this.actors.push(f)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,s){const l=[];for(const c of this.actors)l.push(c.sendAsync({type:t,data:s}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(s=>{s.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,s){for(const l of this.actors)l.registerMessageHandler(t,s)}}function Qe(){return wi||(wi=new tt(Pe(),h.G),wi.registerMessageHandler("GR",(p,t,s)=>h.m(t,s))),wi}function ct(p,t){const s=h.F();return h.H(s,s,[1,1,0]),h.J(s,s,[.5*p.width,.5*p.height,1]),h.K(s,s,p.calculatePosMatrix(t.toUnwrapped()))}function Qt(p,t,s,l,c,f){const b=function(k,O,W){if(k)for(const Z of k){const Y=O[Z];if(Y&&Y.source===W&&Y.type==="fill-extrusion")return!0}else for(const Z in O){const Y=O[Z];if(Y.source===W&&Y.type==="fill-extrusion")return!0}return!1}(c&&c.layers,t,p.id),w=f.maxPitchScaleFactor(),A=p.tilesIn(l,w,b);A.sort(ti);const E=[];for(const k of A)E.push({wrappedTileID:k.tileID.wrapped().key,queryResults:k.tile.queryRenderedFeatures(t,s,p._state,k.queryGeometry,k.cameraQueryGeometry,k.scale,c,f,w,ct(p.transform,k.tileID))});const M=function(k){const O={},W={};for(const Z of k){const Y=Z.queryResults,q=Z.wrappedTileID,se=W[q]=W[q]||{};for(const me in Y){const Q=Y[me],ce=se[me]=se[me]||{},ge=O[me]=O[me]||[];for(const xe of Q)ce[xe.featureIndex]||(ce[xe.featureIndex]=!0,ge.push(xe))}}return O}(E);for(const k in M)M[k].forEach(O=>{const W=O.feature,Z=p.getFeatureState(W.layer["source-layer"],W.id);W.source=W.layer.source,W.layer["source-layer"]&&(W.sourceLayer=W.layer["source-layer"]),W.state=Z});return M}function ti(p,t){const s=p.tileID,l=t.tileID;return s.overscaledZ-l.overscaledZ||s.canonical.y-l.canonical.y||s.wrap-l.wrap||s.canonical.x-l.canonical.x}function J(p,t,s){return h._(this,void 0,void 0,function*(){let l=p;if(p.url?l=(yield h.h(t.transformRequest(p.url,"Source"),s)).data:yield N.frameAsync(s),!l)return null;const c=h.L(h.e(l,p),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(c.vectorLayerIds=l.vector_layers.map(f=>f.id)),c})}class ie{constructor(t,s){t&&(s?this.setSouthWest(t).setNorthEast(s):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof h.M?new h.M(t.lng,t.lat):h.M.convert(t),this}setSouthWest(t){return this._sw=t instanceof h.M?new h.M(t.lng,t.lat):h.M.convert(t),this}extend(t){const s=this._sw,l=this._ne;let c,f;if(t instanceof h.M)c=t,f=t;else{if(!(t instanceof ie))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(ie.convert(t)):this.extend(h.M.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(h.M.convert(t)):this;if(c=t._sw,f=t._ne,!c||!f)return this}return s||l?(s.lng=Math.min(c.lng,s.lng),s.lat=Math.min(c.lat,s.lat),l.lng=Math.max(f.lng,l.lng),l.lat=Math.max(f.lat,l.lat)):(this._sw=new h.M(c.lng,c.lat),this._ne=new h.M(f.lng,f.lat)),this}getCenter(){return new h.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new h.M(this.getWest(),this.getNorth())}getSouthEast(){return new h.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:s,lat:l}=h.M.convert(t);let c=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&c}static convert(t){return t instanceof ie?t:t&&new ie(t)}static fromLngLat(t,s=0){const l=360*s/40075017,c=l/Math.cos(Math.PI/180*t.lat);return new ie(new h.M(t.lng-c,t.lat-l),new h.M(t.lng+c,t.lat+l))}}class ve{constructor(t,s,l){this.bounds=ie.convert(this.validateBounds(t)),this.minzoom=s||0,this.maxzoom=l||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const s=Math.pow(2,t.z),l=Math.floor(h.N(this.bounds.getWest())*s),c=Math.floor(h.O(this.bounds.getNorth())*s),f=Math.ceil(h.N(this.bounds.getEast())*s),b=Math.ceil(h.O(this.bounds.getSouth())*s);return t.x>=l&&t.x<f&&t.y>=c&&t.y<b}}class De extends h.E{constructor(t,s,l,c){if(super(),this.id=t,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,h.e(this,h.L(s,["url","scheme","tileSize","promoteId"])),this._options=h.e({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(c)}load(){return h._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new h.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield J(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(h.e(this,t),t.bounds&&(this.tileBounds=new ve(t.bounds,this.minzoom,this.maxzoom)),this.fire(new h.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new h.j(t))}})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return h.e({},this._options)}loadTile(t){return h._(this,void 0,void 0,function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(s,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};l.request.collectResourceTiming=this._collectResourceTiming;let c="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise((f,b)=>{t.reloadPromise={resolve:f,reject:b}})}else t.actor=this.dispatcher.getActor(),c="LT";t.abortController=new AbortController;try{const f=yield t.actor.sendAsync({type:c,data:l},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,f)}catch(f){if(delete t.abortController,t.aborted)return;if(f&&f.status!==404)throw f;this._afterTileLoadWorkerResponse(t,null)}})}_afterTileLoadWorkerResponse(t,s){if(s&&s.resourceTiming&&(t.resourceTiming=s.resourceTiming),s&&this.map._refreshExpiredTiles&&t.setExpiryData(s),t.loadVectorData(s,this.map.painter),t.reloadPromise){const l=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(l.resolve).catch(l.reject)}}abortTile(t){return h._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))})}unloadTile(t){return h._(this,void 0,void 0,function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ee extends h.E{constructor(t,s,l,c){super(),this.id=t,this.dispatcher=l,this.setEventedParent(c),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=h.e({type:"raster"},s),h.e(this,h.L(s,["url","scheme","tileSize"]))}load(){return h._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new h.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield J(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,t&&(h.e(this,t),t.bounds&&(this.tileBounds=new ve(t.bounds,this.minzoom,this.maxzoom)),this.fire(new h.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new h.j(t))}})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}serialize(){return h.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return h._(this,void 0,void 0,function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const l=yield ye.getImage(this.map._requestManager.transformRequest(s,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&l.cacheControl&&l.expires&&t.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const c=this.map.painter.context,f=c.gl,b=l.data;t.texture=this.map.painter.getTileTexture(b.width),t.texture?t.texture.update(b,{useMipmap:!0}):(t.texture=new vt(c,b,f.RGBA,{useMipmap:!0}),t.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE,f.LINEAR_MIPMAP_NEAREST),c.extTextureFilterAnisotropic&&f.texParameterf(f.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax)),t.state="loaded"}}catch(l){if(delete t.abortController,t.aborted)t.state="unloaded";else if(l)throw t.state="errored",l}})}abortTile(t){return h._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)})}unloadTile(t){return h._(this,void 0,void 0,function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)})}hasTransition(){return!1}}class qe extends ee{constructor(t,s,l,c){super(t,s,l,c),this.type="raster-dem",this.maxzoom=22,this._options=h.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox",this.redFactor=s.redFactor,this.greenFactor=s.greenFactor,this.blueFactor=s.blueFactor,this.baseShift=s.baseShift}loadTile(t){return h._(this,void 0,void 0,function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(s,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const c=yield ye.getImage(l,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(c&&c.data){const f=c.data;this.map._refreshExpiredTiles&&c.cacheControl&&c.expires&&t.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const b=h.b(f)&&h.S()?f:yield this.readImageNow(f),w={type:this.type,uid:t.uid,source:this.id,rawImageData:b,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const A=yield t.actor.sendAsync({type:"LDT",data:w});t.dem=A,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(c){if(delete t.abortController,t.aborted)t.state="unloaded";else if(c)throw t.state="errored",c}})}readImageNow(t){return h._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&h.U()){const s=t.width+2,l=t.height+2;try{return new h.R({width:s,height:l},yield h.V(t,-1,-1,s,l))}catch{}}return N.getImageData(t,1)})}_getNeighboringTiles(t){const s=t.canonical,l=Math.pow(2,s.z),c=(s.x-1+l)%l,f=s.x===0?t.wrap-1:t.wrap,b=(s.x+1+l)%l,w=s.x+1===l?t.wrap+1:t.wrap,A={};return A[new h.Q(t.overscaledZ,f,s.z,c,s.y).key]={backfilled:!1},A[new h.Q(t.overscaledZ,w,s.z,b,s.y).key]={backfilled:!1},s.y>0&&(A[new h.Q(t.overscaledZ,f,s.z,c,s.y-1).key]={backfilled:!1},A[new h.Q(t.overscaledZ,t.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},A[new h.Q(t.overscaledZ,w,s.z,b,s.y-1).key]={backfilled:!1}),s.y+1<l&&(A[new h.Q(t.overscaledZ,f,s.z,c,s.y+1).key]={backfilled:!1},A[new h.Q(t.overscaledZ,t.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},A[new h.Q(t.overscaledZ,w,s.z,b,s.y+1).key]={backfilled:!1}),A}unloadTile(t){return h._(this,void 0,void 0,function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))})}}class et extends h.E{constructor(t,s,l,c){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=l.getActor(),this.setEventedParent(c),this._data=s.data,this._options=h.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const f=h.W/this.tileSize;this.workerOptions=h.e({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*f,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*f,extent:h.W,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:h.W,radius:(s.clusterRadius||50)*f,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return h._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,s,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:s,offset:l}})}_updateWorkerData(t){return h._(this,void 0,void 0,function*(){const s=h.e({type:this.type},this.workerOptions);t?s.dataDiff=t:typeof this._data=="string"?(s.request=this.map._requestManager.transformRequest(N.resolveURL(this._data),"Source"),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new h.k("dataloading",{dataType:"source"}));try{const l=yield this.actor.sendAsync({type:"LD",data:s});if(this._pendingLoads--,this._removed||l.abandoned)return void this.fire(new h.k("dataabort",{dataType:"source"}));let c=null;l.resourceTiming&&l.resourceTiming[this.id]&&(c=l.resourceTiming[this.id].slice(0));const f={dataType:"source"};this._collectResourceTiming&&c&&c.length>0&&h.e(f,{resourceTiming:c}),this.fire(new h.k("data",Object.assign(Object.assign({},f),{sourceDataType:"metadata"}))),this.fire(new h.k("data",Object.assign(Object.assign({},f),{sourceDataType:"content"})))}catch(l){if(this._pendingLoads--,this._removed)return void this.fire(new h.k("dataabort",{dataType:"source"}));this.fire(new h.j(l))}})}loaded(){return this._pendingLoads===0}loadTile(t){return h._(this,void 0,void 0,function*(){const s=t.actor?"RT":"LT";t.actor=this.actor;const l={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.abortController=new AbortController;const c=yield this.actor.sendAsync({type:s,data:l},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(c,this.map.painter,s==="RT")})}abortTile(t){return h._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0})}unloadTile(t){return h._(this,void 0,void 0,function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return h.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Ae=h.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Oe extends h.E{constructor(t,s,l,c){super(),this.id=t,this.dispatcher=l,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(c),this.options=s}load(t){return h._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new h.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const s=yield ye.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,s&&s.data&&(this.image=s.data,t&&(this.coordinates=t),this._finishLoading())}catch(s){this._request=null,this._loaded=!0,this.fire(new h.j(s))}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new h.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const s=t.map(h.Y.fromLngLat);this.tileID=function(c){let f=1/0,b=1/0,w=-1/0,A=-1/0;for(const O of c)f=Math.min(f,O.x),b=Math.min(b,O.y),w=Math.max(w,O.x),A=Math.max(A,O.y);const E=Math.max(w-f,A-b),M=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),k=Math.pow(2,M);return new h.a0(M,Math.floor((f+w)/2*k),Math.floor((b+A)/2*k))}(s),this.minzoom=this.maxzoom=this.tileID.z;const l=s.map(c=>this.tileID.getTilePoint(c)._round());return this._boundsArray=new h.Z,this._boundsArray.emplaceBack(l[0].x,l[0].y,0,0),this._boundsArray.emplaceBack(l[1].x,l[1].y,h.W,0),this._boundsArray.emplaceBack(l[3].x,l[3].y,0,h.W),this._boundsArray.emplaceBack(l[2].x,l[2].y,h.W,h.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new h.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,s=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Ae.members)),this.boundsSegments||(this.boundsSegments=h.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new vt(t,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let l=!1;for(const c in this.tiles){const f=this.tiles[c];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture,l=!0)}l&&this.fire(new h.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return h._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Fe extends Oe{constructor(t,s,l,c){super(t,s,l,c),this.roundZoom=!0,this.type="video",this.options=s}load(){return h._(this,void 0,void 0,function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const s of t.urls)this.urls.push(this.map._requestManager.transformRequest(s,"Source").url);try{const s=yield h.a2(this.urls);if(this._loaded=!0,!s)return;this.video=s,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(s){this.fire(new h.j(s))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const s=this.video.seekable;t<s.start(0)||t>s.end(0)?this.fire(new h.j(new h.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,s=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Ae.members)),this.boundsSegments||(this.boundsSegments=h.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new vt(t,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let l=!1;for(const c in this.tiles){const f=this.tiles[c];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture,l=!0)}l&&this.fire(new h.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class nt extends Oe{constructor(t,s,l,c){super(t,s,l,c),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(f=>!Array.isArray(f)||f.length!==2||f.some(b=>typeof b!="number"))||this.fire(new h.j(new h.a1(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new h.j(new h.a1(`sources.${t}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new h.j(new h.a1(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new h.j(new h.a1(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new h.j(new h.a1(`sources.${t}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){return h._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new h.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,l=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,Ae.members)),this.boundsSegments||(this.boundsSegments=h.$.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new vt(s,this.canvas,l.RGBA,{premultiply:!0});let c=!1;for(const f in this.tiles){const b=this.tiles[f];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,c=!0)}c&&this.fire(new h.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const bt={},ft=p=>{switch(p){case"geojson":return et;case"image":return Oe;case"raster":return ee;case"raster-dem":return qe;case"vector":return De;case"video":return Fe;case"canvas":return nt}return bt[p]},Tt="RTLPluginLoaded";class jt extends h.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Qe()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch(s=>{throw this.status="error",s})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return h._(this,arguments,void 0,function*(s,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=N.resolveURL(s),!this.url)throw new Error(`requested url ${s} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return h._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new h.k(Tt))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Yt=null;function Ce(){return Yt||(Yt=new jt),Yt}class pi{constructor(t,s){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=h.a3(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const s=t+this.timeAdded;s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,s,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(c,f){const b={};if(!f)return b;for(const w of c){const A=w.layerIds.map(E=>f.getLayer(E)).filter(Boolean);if(A.length!==0){w.layers=A,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(E=>A.filter(M=>M.id===E)[0]));for(const E of A)b[E.id]=w}}return b}(t.buckets,s.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const f=this.buckets[c];if(f instanceof h.a5){if(this.hasSymbolBuckets=!0,!l)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const f=this.buckets[c];if(f instanceof h.a5&&f.hasRTLText){this.hasRTLText=!0,Ce().lazyLoad();break}}this.queryPadding=0;for(const c in this.buckets){const f=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(c).queryRadius(f))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new h.a4}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const l in this.buckets){const c=this.buckets[l];c.uploadPending()&&c.upload(t)}const s=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new vt(t,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new vt(t,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,s,l,c,f,b,w,A,E,M){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:f,scale:b,tileSize:this.tileSize,pixelPosMatrix:M,transform:A,params:w,queryPadding:this.queryPadding*E},t,s,l):{}}querySourceFeatures(t,s){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const c=l.loadVTLayers(),f=s&&s.sourceLayer?s.sourceLayer:"",b=c._geojsonTileLayer||c[f];if(!b)return;const w=h.a6(s&&s.filter),{z:A,x:E,y:M}=this.tileID.canonical,k={z:A,x:E,y:M};for(let O=0;O<b.length;O++){const W=b.feature(O);if(w.needGeometry){const q=h.a7(W,!0);if(!w.filter(new h.a8(this.tileID.overscaledZ),q,this.tileID.canonical))continue}else if(!w.filter(new h.a8(this.tileID.overscaledZ),W))continue;const Z=l.getId(W,f),Y=new h.a9(W,A,E,M,Z);Y.tile=k,t.push(Y)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const l=h.aa(t.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const l=Date.now();let c=!1;if(this.expirationTime>l)c=!1;else if(s)if(this.expirationTime<s)c=!0;else{const f=this.expirationTime-s;f?this.expirationTime=l+Math.max(f,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const c in this.buckets){if(!s.style.hasLayer(c))continue;const f=this.buckets[c],b=f.layers[0].sourceLayer||"_geojsonTileLayer",w=l[b],A=t[b];if(!w||!A||Object.keys(A).length===0)continue;f.update(A,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});const E=s&&s.style&&s.style.getLayer(c);E&&(this.queryPadding=Math.max(this.queryPadding,E.queryRadius(f)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<N.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=N.now()+t}setDependencies(t,s){const l={};for(const c of s)l[c]=!0;this.dependencies[t]=l}hasDependency(t,s){for(const l of t){const c=this.dependencies[l];if(c){for(const f of s)if(c[f])return!0}}return!1}}class Si{constructor(t,s){this.max=t,this.onRemove=s,this.reset()}reset(){for(const t in this.data)for(const s of this.data[t])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(t,s,l){const c=t.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const f={value:s,timeout:void 0};if(l!==void 0&&(f.timeout=setTimeout(()=>{this.remove(t,f)},l)),this.data[c].push(f),this.order.push(c),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const s=this.data[t].shift();return s.timeout&&clearTimeout(s.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),s.value}getByKey(t){const s=this.data[t];return s?s[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,s){if(!this.has(t))return this;const l=t.wrapped().key,c=s===void 0?0:this.data[l].indexOf(s),f=this.data[l][c];return this.data[l].splice(c,1),f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(f.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(t){const s=[];for(const l in this.data)for(const c of this.data[l])t(c.value)||s.push(c);for(const l of s)this.remove(l.value.tileID,l)}}class en{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,l){const c=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][c]=this.stateChanges[t][c]||{},h.e(this.stateChanges[t][c],l),this.deletedStates[t]===null){this.deletedStates[t]={};for(const f in this.state[t])f!==c&&(this.deletedStates[t][f]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][c]===null){this.deletedStates[t][c]={};for(const f in this.state[t][c])l[f]||(this.deletedStates[t][c][f]=null)}else for(const f in l)this.deletedStates[t]&&this.deletedStates[t][c]&&this.deletedStates[t][c][f]===null&&delete this.deletedStates[t][c][f]}removeFeatureState(t,s,l){if(this.deletedStates[t]===null)return;const c=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},l&&s!==void 0)this.deletedStates[t][c]!==null&&(this.deletedStates[t][c]=this.deletedStates[t][c]||{},this.deletedStates[t][c][l]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][c])for(l in this.deletedStates[t][c]={},this.stateChanges[t][c])this.deletedStates[t][c][l]=null;else this.deletedStates[t][c]=null;else this.deletedStates[t]=null}getState(t,s){const l=String(s),c=h.e({},(this.state[t]||{})[l],(this.stateChanges[t]||{})[l]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const f=this.deletedStates[t][s];if(f===null)return{};for(const b in f)delete c[b]}return c}initializeTileState(t,s){t.setFeatureState(this.state,s)}coalesceChanges(t,s){const l={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const f={};for(const b in this.stateChanges[c])this.state[c][b]||(this.state[c][b]={}),h.e(this.state[c][b],this.stateChanges[c][b]),f[b]=this.state[c][b];l[c]=f}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const f={};if(this.deletedStates[c]===null)for(const b in this.state[c])f[b]={},this.state[c][b]={};else for(const b in this.deletedStates[c]){if(this.deletedStates[c][b]===null)this.state[c][b]={};else for(const w of Object.keys(this.deletedStates[c][b]))delete this.state[c][b][w];f[b]=this.state[c][b]}l[c]=l[c]||{},h.e(l[c],f)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const c in t)t[c].setFeatureState(l,s)}}class Xi extends h.E{constructor(t,s,l){super(),this.id=t,this.dispatcher=l,this.on("data",c=>this._dataHandler(c)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((c,f,b,w)=>{const A=new(ft(f.type))(c,f,b,w);if(A.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${A.id}`);return A})(t,s,l,this),this._tiles={},this._cache=new Si(0,c=>this._unloadTile(c)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new en,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const s=this._tiles[t];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,s,l){return h._(this,void 0,void 0,function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,s,l)}catch(c){t.state="errored",c.status!==404?this._source.fire(new h.j(c,{tile:t})):this.update(this.transform,this.terrain)}})}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new h.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const l=this._tiles[s];l.upload(t),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Ve).map(t=>t.key)}getRenderableIds(t){const s=[];for(const l in this._tiles)this._isIdRenderable(l,t)&&s.push(this._tiles[l]);return t?s.sort((l,c)=>{const f=l.tileID,b=c.tileID,w=new h.P(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),A=new h.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-b.overscaledZ||A.y-w.y||A.x-w.x}).map(l=>l.tileID.key):s.map(l=>l.tileID).sort(Ve).map(l=>l.key)}hasRenderableParent(t){const s=this.findLoadedParent(t,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(t,s){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(s||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,s){return h._(this,void 0,void 0,function*(){const l=this._tiles[t];l&&(l.state!=="loading"&&(l.state=s),yield this._loadTile(l,t,s))})}_tileLoaded(t,s,l){t.timeAdded=N.now(),l==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new h.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const s=this.getRenderableIds();for(let c=0;c<s.length;c++){const f=s[c];if(t.neighboringTiles&&t.neighboringTiles[f]){const b=this.getTileByID(f);l(t,b),l(b,t)}}function l(c,f){c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0;let b=f.tileID.canonical.x-c.tileID.canonical.x;const w=f.tileID.canonical.y-c.tileID.canonical.y,A=Math.pow(2,c.tileID.canonical.z),E=f.tileID.key;b===0&&w===0||Math.abs(w)>1||(Math.abs(b)>1&&(Math.abs(b+A)===1?b+=A:Math.abs(b-A)===1&&(b-=A)),f.dem&&c.dem&&(c.dem.backfillBorder(f.dem,b,w),c.neighboringTiles&&c.neighboringTiles[E]&&(c.neighboringTiles[E].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,s,l,c){for(const f in this._tiles){let b=this._tiles[f];if(c[f]||!b.hasData()||b.tileID.overscaledZ<=s||b.tileID.overscaledZ>l)continue;let w=b.tileID;for(;b&&b.tileID.overscaledZ>s+1;){const E=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[E.key],b&&b.hasData()&&(w=E)}let A=w;for(;A.overscaledZ>s;)if(A=A.scaledTo(A.overscaledZ-1),t[A.key]){c[w.key]=w;break}}}findLoadedParent(t,s){if(t.key in this._loadedParentTiles){const l=this._loadedParentTiles[t.key];return l&&l.tileID.overscaledZ>=s?l:null}for(let l=t.overscaledZ-1;l>=s;l--){const c=t.scaledTo(l),f=this._getLoadedTile(c);if(f)return f}}_getLoadedTile(t){const s=this._tiles[t.key];return s&&s.hasData()?s:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const s=Math.ceil(t.width/this._source.tileSize)+1,l=Math.ceil(t.height/this._source.tileSize)+1,c=Math.floor(s*l*(this._maxTileCacheZoomLevels===null?h.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),f=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,c):c;this._cache.setMaxSize(f)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,s){const l={};for(const c in this._tiles){const f=this._tiles[c];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+s),l[f.tileID.key]=f}this._tiles=l;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(c,this._tiles[c])}}update(t,s){if(!this._sourceLoaded||this._paused)return;let l;this.transform=t,this.terrain=s,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new h.Q(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y)):(l=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(l=l.filter(M=>this._source.hasTile(M)))):l=[];const c=t.coveringZoomLevel(this._source),f=Math.max(c-Xi.maxOverzooming,this._source.minzoom),b=Math.max(c+Xi.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const M={};for(const k of l)if(k.canonical.z>this._source.minzoom){const O=k.scaledTo(k.canonical.z-1);M[O.key]=O;const W=k.scaledTo(Math.max(this._source.minzoom,Math.min(k.canonical.z,5)));M[W.key]=W}l=l.concat(Object.values(M))}const w=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,w&&this.fire(new h.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const A=this._updateRetainedTiles(l,c);if(Mt(this._source.type)){const M={},k={},O=Object.keys(A),W=N.now();for(const Z of O){const Y=A[Z],q=this._tiles[Z];if(!q||q.fadeEndTime!==0&&q.fadeEndTime<=W)continue;const se=this.findLoadedParent(Y,f);se&&(this._addTile(se.tileID),M[se.tileID.key]=se.tileID),k[Z]=Y}this._retainLoadedChildren(k,c,b,A);for(const Z in M)A[Z]||(this._coveredTiles[Z]=!0,A[Z]=M[Z]);if(s){const Z={},Y={};for(const q of l)this._tiles[q.key].hasData()?Z[q.key]=q:Y[q.key]=q;for(const q in Y){const se=Y[q].children(this._source.maxzoom);this._tiles[se[0].key]&&this._tiles[se[1].key]&&this._tiles[se[2].key]&&this._tiles[se[3].key]&&(Z[se[0].key]=A[se[0].key]=se[0],Z[se[1].key]=A[se[1].key]=se[1],Z[se[2].key]=A[se[2].key]=se[2],Z[se[3].key]=A[se[3].key]=se[3],delete Y[q])}for(const q in Y){const se=this.findLoadedParent(Y[q],this._source.minzoom);if(se){Z[se.tileID.key]=A[se.tileID.key]=se.tileID;for(const me in Z)Z[me].isChildOf(se.tileID)&&delete Z[me]}}for(const q in this._tiles)Z[q]||(this._coveredTiles[q]=!0)}}for(const M in A)this._tiles[M].clearFadeHold();const E=h.ab(this._tiles,A);for(const M of E){const k=this._tiles[M];k.hasSymbolBuckets&&!k.holdingForFade()?k.setHoldDuration(this.map._fadeDuration):k.hasSymbolBuckets&&!k.symbolFadeFinished()||this._removeTile(M)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,s){const l={},c={},f=Math.max(s-Xi.maxOverzooming,this._source.minzoom),b=Math.max(s+Xi.maxUnderzooming,this._source.minzoom),w={};for(const A of t){const E=this._addTile(A);l[A.key]=A,E.hasData()||s<this._source.maxzoom&&(w[A.key]=A)}this._retainLoadedChildren(w,s,b,l);for(const A of t){let E=this._tiles[A.key];if(E.hasData())continue;if(s+1>this._source.maxzoom){const k=A.children(this._source.maxzoom)[0],O=this.getTile(k);if(O&&O.hasData()){l[k.key]=k;continue}}else{const k=A.children(this._source.maxzoom);if(l[k[0].key]&&l[k[1].key]&&l[k[2].key]&&l[k[3].key])continue}let M=E.wasRequested();for(let k=A.overscaledZ-1;k>=f;--k){const O=A.scaledTo(k);if(c[O.key])break;if(c[O.key]=!0,E=this.getTile(O),!E&&M&&(E=this._addTile(O)),E){const W=E.hasData();if((M||W)&&(l[O.key]=O),M=E.wasRequested(),W)break}}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const s=[];let l,c=this._tiles[t].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){l=this._loadedParentTiles[c.key];break}s.push(c.key);const f=c.scaledTo(c.overscaledZ-1);if(l=this._getLoadedTile(f),l)break;c=f}for(const f of s)this._loadedParentTiles[f]=l}}_addTile(t){let s=this._tiles[t.key];if(s)return s;s=this._cache.getAndRemove(t),s&&(this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,s)));const l=s;return s||(s=new pi(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(s,t.key,s.state)),s.uses++,this._tiles[t.key]=s,l||this._source.fire(new h.k("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(t,s){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const l=s.getExpiryTimeout();l&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},l))}_removeTile(t){const s=this._tiles[t];s&&(s.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}_dataHandler(t){const s=t.sourceDataType;t.dataType==="source"&&s==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&t.dataType==="source"&&s==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,s,l){const c=[],f=this.transform;if(!f)return c;const b=l?f.getCameraQueryGeometry(t):t,w=t.map(Z=>f.pointCoordinate(Z,this.terrain)),A=b.map(Z=>f.pointCoordinate(Z,this.terrain)),E=this.getIds();let M=1/0,k=1/0,O=-1/0,W=-1/0;for(const Z of A)M=Math.min(M,Z.x),k=Math.min(k,Z.y),O=Math.max(O,Z.x),W=Math.max(W,Z.y);for(let Z=0;Z<E.length;Z++){const Y=this._tiles[E[Z]];if(Y.holdingForFade())continue;const q=Y.tileID,se=Math.pow(2,f.zoom-Y.tileID.overscaledZ),me=s*Y.queryPadding*h.W/Y.tileSize/se,Q=[q.getTilePoint(new h.Y(M,k)),q.getTilePoint(new h.Y(O,W))];if(Q[0].x-me<h.W&&Q[0].y-me<h.W&&Q[1].x+me>=0&&Q[1].y+me>=0){const ce=w.map(xe=>q.getTilePoint(xe)),ge=A.map(xe=>q.getTilePoint(xe));c.push({tile:Y,tileID:q,queryGeometry:ce,cameraQueryGeometry:ge,scale:se})}}return c}getVisibleCoordinates(t){const s=this.getRenderableIds(t).map(l=>this._tiles[l].tileID);for(const l of s)l.posMatrix=this.transform.calculatePosMatrix(l.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(Mt(this._source.type)){const t=N.now();for(const s in this._tiles)if(this._tiles[s].fadeEndTime>=t)return!0}return!1}setFeatureState(t,s,l){this._state.updateState(t=t||"_geojsonTileLayer",s,l)}removeFeatureState(t,s,l){this._state.removeFeatureState(t=t||"_geojsonTileLayer",s,l)}getFeatureState(t,s){return this._state.getState(t=t||"_geojsonTileLayer",s)}setDependencies(t,s,l){const c=this._tiles[t];c&&c.setDependencies(s,l)}reloadTilesForDependencies(t,s){for(const l in this._tiles)this._tiles[l].hasDependency(t,s)&&this._reloadTile(l,"reloading");this._cache.filter(l=>!l.hasDependency(t,s))}}function Ve(p,t){const s=Math.abs(2*p.wrap)-+(p.wrap<0),l=Math.abs(2*t.wrap)-+(t.wrap<0);return p.overscaledZ-t.overscaledZ||l-s||t.canonical.y-p.canonical.y||t.canonical.x-p.canonical.x}function Mt(p){return p==="raster"||p==="image"||p==="video"}Xi.maxOverzooming=10,Xi.maxUnderzooming=3;class gt{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=h.ac(t,0,1);let s=1,l=this._distances[s];const c=t*this.paddedLength+this.padding;for(;l<c&&s<this._distances.length;)l=this._distances[++s];const f=s-1,b=this._distances[f],w=l-b,A=w>0?(c-b)/w:0;return this.points[f].mult(1-A).add(this.points[s].mult(A))}}function ai(p,t){let s=!0;return p==="always"||p!=="never"&&t!=="never"||(s=!1),s}class Ur{constructor(t,s,l){const c=this.boxCells=[],f=this.circleCells=[];this.xCellCount=Math.ceil(t/l),this.yCellCount=Math.ceil(s/l);for(let b=0;b<this.xCellCount*this.yCellCount;b++)c.push([]),f.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,l,c,f){this._forEachCell(s,l,c,f,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(c),this.bboxes.push(f)}insertCircle(t,s,l,c){this._forEachCell(s-c,l-c,s+c,l+c,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(l),this.circles.push(c)}_insertBoxCell(t,s,l,c,f,b){this.boxCells[f].push(b)}_insertCircleCell(t,s,l,c,f,b){this.circleCells[f].push(b)}_query(t,s,l,c,f,b,w){if(l<0||t>this.width||c<0||s>this.height)return[];const A=[];if(t<=0&&s<=0&&this.width<=l&&this.height<=c){if(f)return[{key:null,x1:t,y1:s,x2:l,y2:c}];for(let E=0;E<this.boxKeys.length;E++)A.push({key:this.boxKeys[E],x1:this.bboxes[4*E],y1:this.bboxes[4*E+1],x2:this.bboxes[4*E+2],y2:this.bboxes[4*E+3]});for(let E=0;E<this.circleKeys.length;E++){const M=this.circles[3*E],k=this.circles[3*E+1],O=this.circles[3*E+2];A.push({key:this.circleKeys[E],x1:M-O,y1:k-O,x2:M+O,y2:k+O})}}else this._forEachCell(t,s,l,c,this._queryCell,A,{hitTest:f,overlapMode:b,seenUids:{box:{},circle:{}}},w);return A}query(t,s,l,c){return this._query(t,s,l,c,!1,null)}hitTest(t,s,l,c,f,b){return this._query(t,s,l,c,!0,f,b).length>0}hitTestCircle(t,s,l,c,f){const b=t-l,w=t+l,A=s-l,E=s+l;if(w<0||b>this.width||E<0||A>this.height)return!1;const M=[];return this._forEachCell(b,A,w,E,this._queryCellCircle,M,{hitTest:!0,overlapMode:c,circle:{x:t,y:s,radius:l},seenUids:{box:{},circle:{}}},f),M.length>0}_queryCell(t,s,l,c,f,b,w,A){const{seenUids:E,hitTest:M,overlapMode:k}=w,O=this.boxCells[f];if(O!==null){const Z=this.bboxes;for(const Y of O)if(!E.box[Y]){E.box[Y]=!0;const q=4*Y,se=this.boxKeys[Y];if(t<=Z[q+2]&&s<=Z[q+3]&&l>=Z[q+0]&&c>=Z[q+1]&&(!A||A(se))&&(!M||!ai(k,se.overlapMode))&&(b.push({key:se,x1:Z[q],y1:Z[q+1],x2:Z[q+2],y2:Z[q+3]}),M))return!0}}const W=this.circleCells[f];if(W!==null){const Z=this.circles;for(const Y of W)if(!E.circle[Y]){E.circle[Y]=!0;const q=3*Y,se=this.circleKeys[Y];if(this._circleAndRectCollide(Z[q],Z[q+1],Z[q+2],t,s,l,c)&&(!A||A(se))&&(!M||!ai(k,se.overlapMode))){const me=Z[q],Q=Z[q+1],ce=Z[q+2];if(b.push({key:se,x1:me-ce,y1:Q-ce,x2:me+ce,y2:Q+ce}),M)return!0}}}return!1}_queryCellCircle(t,s,l,c,f,b,w,A){const{circle:E,seenUids:M,overlapMode:k}=w,O=this.boxCells[f];if(O!==null){const Z=this.bboxes;for(const Y of O)if(!M.box[Y]){M.box[Y]=!0;const q=4*Y,se=this.boxKeys[Y];if(this._circleAndRectCollide(E.x,E.y,E.radius,Z[q+0],Z[q+1],Z[q+2],Z[q+3])&&(!A||A(se))&&!ai(k,se.overlapMode))return b.push(!0),!0}}const W=this.circleCells[f];if(W!==null){const Z=this.circles;for(const Y of W)if(!M.circle[Y]){M.circle[Y]=!0;const q=3*Y,se=this.circleKeys[Y];if(this._circlesCollide(Z[q],Z[q+1],Z[q+2],E.x,E.y,E.radius)&&(!A||A(se))&&!ai(k,se.overlapMode))return b.push(!0),!0}}}_forEachCell(t,s,l,c,f,b,w,A){const E=this._convertToXCellCoord(t),M=this._convertToYCellCoord(s),k=this._convertToXCellCoord(l),O=this._convertToYCellCoord(c);for(let W=E;W<=k;W++)for(let Z=M;Z<=O;Z++)if(f.call(this,t,s,l,c,this.xCellCount*Z+W,b,w,A))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,l,c,f,b){const w=c-t,A=f-s,E=l+b;return E*E>w*w+A*A}_circleAndRectCollide(t,s,l,c,f,b,w){const A=(b-c)/2,E=Math.abs(t-(c+A));if(E>A+l)return!1;const M=(w-f)/2,k=Math.abs(s-(f+M));if(k>M+l)return!1;if(E<=A||k<=M)return!0;const O=E-A,W=k-M;return O*O+W*W<=l*l}}function Dt(p,t,s,l,c){const f=h.F();return t?(h.J(f,f,[1/c,1/c,1]),s||h.ad(f,f,l.angle)):h.K(f,l.labelPlaneMatrix,p),f}function ls(p,t,s,l,c){if(t){const f=h.ae(p);return h.J(f,f,[c,c,1]),s||h.ad(f,f,-l.angle),f}return l.glCoordMatrix}function Yi(p,t,s){let l;s?(l=[p.x,p.y,s(p.x,p.y),1],h.af(l,l,t)):(l=[p.x,p.y,0,1],ht(l,l,t));const c=l[3];return{point:new h.P(l[0]/c,l[1]/c),signedDistanceFromCamera:c}}function X(p,t){return .5+p/t*.5}function D(p,t){const s=p[0]/p[3],l=p[1]/p[3];return s>=-t[0]&&s<=t[0]&&l>=-t[1]&&l<=t[1]}function R(p,t,s,l,c,f,b,w,A,E){const M=l?p.textSizeData:p.iconSizeData,k=h.ag(M,s.transform.zoom),O=[256/s.width*2+1,256/s.height*2+1],W=l?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;W.clear();const Z=p.lineVertexArray,Y=l?p.text.placedSymbolArray:p.icon.placedSymbolArray,q=s.transform.width/s.transform.height;let se=!1;for(let me=0;me<Y.length;me++){const Q=Y.get(me);if(Q.hidden||Q.writingMode===h.ah.vertical&&!se){Te(Q.numGlyphs,W);continue}let ce;if(se=!1,E?(ce=[Q.anchorX,Q.anchorY,E(Q.anchorX,Q.anchorY),1],h.af(ce,ce,t)):(ce=[Q.anchorX,Q.anchorY,0,1],ht(ce,ce,t)),!D(ce,O)){Te(Q.numGlyphs,W);continue}const ge=X(s.transform.cameraToCenterDistance,ce[3]),xe=h.ai(M,k,Q),be=b?xe/ge:xe*ge,ze=new h.P(Q.anchorX,Q.anchorY),ke=Yi(ze,c,E).point,Ne={projections:{},offsets:{}},je=oe(Q,be,!1,w,t,c,f,p.glyphOffsetArray,Z,W,ke,ze,Ne,q,A,E);se=je.useVertical,(je.notEnoughRoom||se||je.needsFlipping&&oe(Q,be,!0,w,t,c,f,p.glyphOffsetArray,Z,W,ke,ze,Ne,q,A,E).notEnoughRoom)&&Te(Q.numGlyphs,W)}l?p.text.dynamicLayoutVertexBuffer.updateData(W):p.icon.dynamicLayoutVertexBuffer.updateData(W)}function $(p,t,s,l,c,f,b,w,A,E,M,k,O){const W=w.glyphStartIndex+w.numGlyphs,Z=w.lineStartIndex,Y=w.lineStartIndex+w.lineLength,q=t.getoffsetX(w.glyphStartIndex),se=t.getoffsetX(W-1),me=Me(p*q,s,l,c,f,b,w.segment,Z,Y,A,E,M,k,O);if(!me)return null;const Q=Me(p*se,s,l,c,f,b,w.segment,Z,Y,A,E,M,k,O);return Q?{first:me,last:Q}:null}function H(p,t,s,l){return p===h.ah.horizontal&&Math.abs(s.y-t.y)>Math.abs(s.x-t.x)*l?{useVertical:!0}:(p===h.ah.vertical?t.y<s.y:t.x>s.x)?{needsFlipping:!0}:null}function oe(p,t,s,l,c,f,b,w,A,E,M,k,O,W,Z,Y){const q=t/24,se=p.lineOffsetX*q,me=p.lineOffsetY*q;let Q;if(p.numGlyphs>1){const ce=p.glyphStartIndex+p.numGlyphs,ge=p.lineStartIndex,xe=p.lineStartIndex+p.lineLength,be=$(q,w,se,me,s,M,k,p,A,f,O,Z,Y);if(!be)return{notEnoughRoom:!0};const ze=Yi(be.first.point,b,Y).point,ke=Yi(be.last.point,b,Y).point;if(l&&!s){const Ne=H(p.writingMode,ze,ke,W);if(Ne)return Ne}Q=[be.first];for(let Ne=p.glyphStartIndex+1;Ne<ce-1;Ne++)Q.push(Me(q*w.getoffsetX(Ne),se,me,s,M,k,p.segment,ge,xe,A,f,O,Z,Y));Q.push(be.last)}else{if(l&&!s){const ge=Yi(k,c,Y).point,xe=p.lineStartIndex+p.segment+1,be=new h.P(A.getx(xe),A.gety(xe)),ze=Yi(be,c,Y),ke=ze.signedDistanceFromCamera>0?ze.point:ae(k,be,ge,1,c,Y),Ne=H(p.writingMode,ge,ke,W);if(Ne)return Ne}const ce=Me(q*w.getoffsetX(p.glyphStartIndex),se,me,s,M,k,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,A,f,O,Z,Y);if(!ce)return{notEnoughRoom:!0};Q=[ce]}for(const ce of Q)h.aj(E,ce.point,ce.angle);return{}}function ae(p,t,s,l,c,f){const b=Yi(p.add(p.sub(t)._unit()),c,f).point,w=s.sub(b);return s.add(w._mult(l/w.mag()))}function ue(p,t){const{projectionCache:s,lineVertexArray:l,labelPlaneMatrix:c,tileAnchorPoint:f,distanceFromAnchor:b,getElevation:w,previousVertex:A,direction:E,absOffsetX:M}=t;if(s.projections[p])return s.projections[p];const k=new h.P(l.getx(p),l.gety(p)),O=Yi(k,c,w);if(O.signedDistanceFromCamera>0)return s.projections[p]=O.point,O.point;const W=p-E;return ae(b===0?f:new h.P(l.getx(W),l.gety(W)),k,A,M-b+1,c,w)}function ne(p,t,s){return p._unit()._perp()._mult(t*s)}function pe(p,t,s,l,c,f,b,w){const{projectionCache:A,direction:E}=w;if(A.offsets[p])return A.offsets[p];const M=s.add(t);if(p+E<l||p+E>=c)return A.offsets[p]=M,M;const k=ue(p+E,w),O=ne(k.sub(s),b,E),W=s.add(O),Z=k.add(O);return A.offsets[p]=h.ak(f,M,W,Z)||M,A.offsets[p]}function Me(p,t,s,l,c,f,b,w,A,E,M,k,O,W){const Z=l?p-t:p+t;let Y=Z>0?1:-1,q=0;l&&(Y*=-1,q=Math.PI),Y<0&&(q+=Math.PI);let se,me,Q=Y>0?w+b:w+b+1,ce=c,ge=c,xe=0,be=0;const ze=Math.abs(Z),ke=[];let Ne;for(;xe+be<=ze;){if(Q+=Y,Q<w||Q>=A)return null;xe+=be,ge=ce,me=se;const Ge={projectionCache:k,lineVertexArray:E,labelPlaneMatrix:M,tileAnchorPoint:f,distanceFromAnchor:xe,getElevation:W,previousVertex:ge,direction:Y,absOffsetX:ze};if(ce=ue(Q,Ge),s===0)ke.push(ge),Ne=ce.sub(ge);else{let wt;const Lt=ce.sub(ge);wt=Lt.mag()===0?ne(ue(Q+Y,Ge).sub(ce),s,Y):ne(Lt,s,Y),me||(me=ge.add(wt)),se=pe(Q,wt,ce,w,A,me,s,Ge),ke.push(me),Ne=se.sub(me)}be=Ne.mag()}const je=Ne._mult((ze-xe)/be)._add(me||ge),Rt=q+Math.atan2(ce.y-ge.y,ce.x-ge.x);return ke.push(je),{point:je,angle:O?Rt:0,path:ke}}const Se=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Te(p,t){for(let s=0;s<p;s++){const l=t.length;t.resize(l+4),t.float32.set(Se,3*l)}}function ht(p,t,s){const l=t[0],c=t[1];return p[0]=s[0]*l+s[4]*c+s[12],p[1]=s[1]*l+s[5]*c+s[13],p[3]=s[3]*l+s[7]*c+s[15],p}const _t=100;class zt{constructor(t,s=new Ur(t.width+200,t.height+200,25),l=new Ur(t.width+200,t.height+200,25)){this.transform=t,this.grid=s,this.ignoredGrid=l,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+_t,this.screenBottomBoundary=t.height+_t,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,s,l,c,f,b){const w=this.projectAndGetPerspectiveRatio(c,t.anchorPointX,t.anchorPointY,b),A=l*w.perspectiveRatio,E=t.x1*A+w.point.x,M=t.y1*A+w.point.y,k=t.x2*A+w.point.x,O=t.y2*A+w.point.y;return!this.isInsideGrid(E,M,k,O)||s!=="always"&&this.grid.hitTest(E,M,k,O,s,f)||w.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[E,M,k,O],offscreen:this.isOffscreen(E,M,k,O)}}placeCollisionCircles(t,s,l,c,f,b,w,A,E,M,k,O,W,Z){const Y=[],q=new h.P(s.anchorX,s.anchorY),se=Yi(q,b,Z),me=X(this.transform.cameraToCenterDistance,se.signedDistanceFromCamera),Q=(M?f/me:f*me)/h.ao,ce=Yi(q,w,Z).point,ge=$(Q,c,s.lineOffsetX*Q,s.lineOffsetY*Q,!1,ce,q,s,l,w,{projections:{},offsets:{}},!1,Z);let xe=!1,be=!1,ze=!0;if(ge){const ke=.5*O*me+W,Ne=new h.P(-100,-100),je=new h.P(this.screenRightBoundary,this.screenBottomBoundary),Rt=new gt,Ge=ge.first,wt=ge.last;let Lt=[];for(let Ot=Ge.path.length-1;Ot>=1;Ot--)Lt.push(Ge.path[Ot]);for(let Ot=1;Ot<wt.path.length;Ot++)Lt.push(wt.path[Ot]);const Kt=2.5*ke;if(A){const Ot=Lt.map($t=>Yi($t,A,Z));Lt=Ot.some($t=>$t.signedDistanceFromCamera<=0)?[]:Ot.map($t=>$t.point)}let At=[];if(Lt.length>0){const Ot=Lt[0].clone(),$t=Lt[0].clone();for(let Li=1;Li<Lt.length;Li++)Ot.x=Math.min(Ot.x,Lt[Li].x),Ot.y=Math.min(Ot.y,Lt[Li].y),$t.x=Math.max($t.x,Lt[Li].x),$t.y=Math.max($t.y,Lt[Li].y);At=Ot.x>=Ne.x&&$t.x<=je.x&&Ot.y>=Ne.y&&$t.y<=je.y?[Lt]:$t.x<Ne.x||Ot.x>je.x||$t.y<Ne.y||Ot.y>je.y?[]:h.al([Lt],Ne.x,Ne.y,je.x,je.y)}for(const Ot of At){Rt.reset(Ot,.25*ke);let $t=0;$t=Rt.length<=.5*ke?1:Math.ceil(Rt.paddedLength/Kt)+1;for(let Li=0;Li<$t;Li++){const hi=Li/Math.max($t-1,1),Hr=Rt.lerp(hi),Qi=Hr.x+_t,Ci=Hr.y+_t;Y.push(Qi,Ci,ke,0);const er=Qi-ke,Zr=Ci-ke,In=Qi+ke,Kn=Ci+ke;if(ze=ze&&this.isOffscreen(er,Zr,In,Kn),be=be||this.isInsideGrid(er,Zr,In,Kn),t!=="always"&&this.grid.hitTestCircle(Qi,Ci,ke,t,k)&&(xe=!0,!E))return{circles:[],offscreen:!1,collisionDetected:xe}}}}return{circles:!E&&xe||!be||me<this.perspectiveRatioCutoff?[]:Y,offscreen:ze,collisionDetected:xe}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let l=1/0,c=1/0,f=-1/0,b=-1/0;for(const M of t){const k=new h.P(M.x+_t,M.y+_t);l=Math.min(l,k.x),c=Math.min(c,k.y),f=Math.max(f,k.x),b=Math.max(b,k.y),s.push(k)}const w=this.grid.query(l,c,f,b).concat(this.ignoredGrid.query(l,c,f,b)),A={},E={};for(const M of w){const k=M.key;if(A[k.bucketInstanceId]===void 0&&(A[k.bucketInstanceId]={}),A[k.bucketInstanceId][k.featureIndex])continue;const O=[new h.P(M.x1,M.y1),new h.P(M.x2,M.y1),new h.P(M.x2,M.y2),new h.P(M.x1,M.y2)];h.am(s,O)&&(A[k.bucketInstanceId][k.featureIndex]=!0,E[k.bucketInstanceId]===void 0&&(E[k.bucketInstanceId]=[]),E[k.bucketInstanceId].push(k.featureIndex))}return E}insertCollisionBox(t,s,l,c,f,b){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:f,collisionGroupID:b,overlapMode:s},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,l,c,f,b){const w=l?this.ignoredGrid:this.grid,A={bucketInstanceId:c,featureIndex:f,collisionGroupID:b,overlapMode:s};for(let E=0;E<t.length;E+=4)w.insertCircle(A,t[E],t[E+1],t[E+2])}projectAndGetPerspectiveRatio(t,s,l,c){let f;return c?(f=[s,l,c(s,l),1],h.af(f,f,t)):(f=[s,l,0,1],ht(f,f,t)),{point:new h.P((f[0]/f[3]+1)/2*this.transform.width+_t,(-f[1]/f[3]+1)/2*this.transform.height+_t),perspectiveRatio:.5+this.transform.cameraToCenterDistance/f[3]*.5}}isOffscreen(t,s,l,c){return l<_t||t>=this.screenRightBoundary||c<_t||s>this.screenBottomBoundary}isInsideGrid(t,s,l,c){return l>=0&&t<this.gridRightBoundary&&c>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=h.an([]);return h.H(t,t,[-100,-100,0]),t}}function Et(p,t,s){return t*(h.W/(p.tileSize*Math.pow(2,s-p.tileID.overscaledZ)))}class Zt{constructor(t,s,l,c){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):c&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class fi{constructor(t,s,l,c,f){this.text=new Zt(t?t.text:null,s,l,f),this.icon=new Zt(t?t.icon:null,s,c,f)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ti{constructor(t,s,l){this.text=t,this.icon=s,this.skipFade=l}}class qi{constructor(){this.invProjMatrix=h.F(),this.viewportMatrix=h.F(),this.circles=[]}}class Ft{constructor(t,s,l,c,f){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=l,this.bucketIndex=c,this.tileID=f}}class Di{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:l=>l.collisionGroupID===s}}return this.collisionGroups[t]}}function Ji(p,t,s,l,c){const{horizontalAlign:f,verticalAlign:b}=h.at(p);return new h.P(-(f-.5)*t+l[0]*c,-(b-.5)*s+l[1]*c)}function Sr(p,t,s,l,c,f){const{x1:b,x2:w,y1:A,y2:E,anchorPointX:M,anchorPointY:k}=p,O=new h.P(t,s);return l&&O._rotate(c?f:-f),{x1:b+O.x,y1:A+O.y,x2:w+O.x,y2:E+O.y,anchorPointX:M,anchorPointY:k}}class Dr{constructor(t,s,l,c,f){this.transform=t.clone(),this.terrain=s,this.collisionIndex=new zt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new Di(c),this.collisionCircleArrays={},this.prevPlacement=f,f&&(f.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,s,l,c){const f=l.getBucket(s),b=l.latestFeatureIndex;if(!f||!b||s.id!==f.layerIds[0])return;const w=l.collisionBoxArray,A=f.layers[0].layout,E=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),M=l.tileSize/h.W,k=this.transform.calculatePosMatrix(l.tileID.toUnwrapped()),O=A.get("text-pitch-alignment")==="map",W=A.get("text-rotation-alignment")==="map",Z=Et(l,1,this.transform.zoom),Y=Dt(k,O,W,this.transform,Z);let q=null;if(O){const me=ls(k,O,W,this.transform,Z);q=h.K([],this.transform.labelPlaneMatrix,me)}this.retainedQueryData[f.bucketInstanceId]=new Ft(f.bucketInstanceId,b,f.sourceLayerIndex,f.index,l.tileID);const se={bucket:f,layout:A,posMatrix:k,textLabelPlaneMatrix:Y,labelToScreenMatrix:q,scale:E,textPixelRatio:M,holdingForFade:l.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:h.ag(f.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(f.sourceID)};if(c)for(const me of f.sortKeyRanges){const{sortKey:Q,symbolInstanceStart:ce,symbolInstanceEnd:ge}=me;t.push({sortKey:Q,symbolInstanceStart:ce,symbolInstanceEnd:ge,parameters:se})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:f.symbolInstances.length,parameters:se})}attemptAnchorPlacement(t,s,l,c,f,b,w,A,E,M,k,O,W,Z,Y,q){const se=h.ap[t.textAnchor],me=[t.textOffset0,t.textOffset1],Q=Ji(se,l,c,me,f),ce=this.collisionIndex.placeCollisionBox(Sr(s,Q.x,Q.y,b,w,this.transform.angle),k,A,E,M.predicate,q);if((!Y||this.collisionIndex.placeCollisionBox(Sr(Y,Q.x,Q.y,b,w,this.transform.angle),k,A,E,M.predicate,q).box.length!==0)&&ce.box.length>0){let ge;if(this.prevPlacement&&this.prevPlacement.variableOffsets[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID].text&&(ge=this.prevPlacement.variableOffsets[O.crossTileID].anchor),O.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[O.crossTileID]={textOffset:me,width:l,height:c,anchor:se,textBoxScale:f,prevAnchor:ge},this.markUsedJustification(W,se,O,Z),W.allowVerticalPlacement&&(this.markUsedOrientation(W,Z,O),this.placedOrientations[O.crossTileID]=Z),{shift:Q,placedGlyphBoxes:ce}}}placeLayerBucketPart(t,s,l){const{bucket:c,layout:f,posMatrix:b,textLabelPlaneMatrix:w,labelToScreenMatrix:A,textPixelRatio:E,holdingForFade:M,collisionBoxArray:k,partiallyEvaluatedTextSize:O,collisionGroup:W}=t.parameters,Z=f.get("text-optional"),Y=f.get("icon-optional"),q=h.aq(f,"text-overlap","text-allow-overlap"),se=q==="always",me=h.aq(f,"icon-overlap","icon-allow-overlap"),Q=me==="always",ce=f.get("text-rotation-alignment")==="map",ge=f.get("text-pitch-alignment")==="map",xe=f.get("icon-text-fit")!=="none",be=f.get("symbol-z-order")==="viewport-y",ze=se&&(Q||!c.hasIconData()||Y),ke=Q&&(se||!c.hasTextData()||Z);!c.collisionArrays&&k&&c.deserializeCollisionBoxes(k);const Ne=this.retainedQueryData[c.bucketInstanceId].tileID,je=this.terrain?(Ge,wt)=>this.terrain.getElevation(Ne,Ge,wt):null,Rt=(Ge,wt)=>{var Lt,Kt;if(s[Ge.crossTileID])return;if(M)return void(this.placements[Ge.crossTileID]=new Ti(!1,!1,!1));let At=!1,Ot=!1,$t=!0,Li=null,hi={box:null,offscreen:null},Hr={box:null,offscreen:null},Qi=null,Ci=null,er=null,Zr=0,In=0,Kn=0;wt.textFeatureIndex?Zr=wt.textFeatureIndex:Ge.useRuntimeCollisionCircles&&(Zr=Ge.featureIndex),wt.verticalTextFeatureIndex&&(In=wt.verticalTextFeatureIndex);const Do=wt.textBox;if(Do){const Hi=Zi=>{let ki=h.ah.horizontal;if(c.allowVerticalPlacement&&!Zi&&this.prevPlacement){const sn=this.prevPlacement.placedOrientations[Ge.crossTileID];sn&&(this.placedOrientations[Ge.crossTileID]=sn,ki=sn,this.markUsedOrientation(c,ki,Ge))}return ki},Mi=(Zi,ki)=>{if(c.allowVerticalPlacement&&Ge.numVerticalGlyphVertices>0&&wt.verticalTextBox){for(const sn of c.writingModes)if(sn===h.ah.vertical?(hi=ki(),Hr=hi):hi=Zi(),hi&&hi.box&&hi.box.length)break}else hi=Zi()},Ii=Ge.textAnchorOffsetStartIndex,nn=Ge.textAnchorOffsetEndIndex;if(nn===Ii){const Zi=(ki,sn)=>{const Wi=this.collisionIndex.placeCollisionBox(ki,q,E,b,W.predicate,je);return Wi&&Wi.box&&Wi.box.length&&(this.markUsedOrientation(c,sn,Ge),this.placedOrientations[Ge.crossTileID]=sn),Wi};Mi(()=>Zi(Do,h.ah.horizontal),()=>{const ki=wt.verticalTextBox;return c.allowVerticalPlacement&&Ge.numVerticalGlyphVertices>0&&ki?Zi(ki,h.ah.vertical):{box:null,offscreen:null}}),Hi(hi&&hi.box&&hi.box.length)}else{let Zi=h.ap[(Kt=(Lt=this.prevPlacement)===null||Lt===void 0?void 0:Lt.variableOffsets[Ge.crossTileID])===null||Kt===void 0?void 0:Kt.anchor];const ki=(Wi,Bi,Vl)=>{const wu=Wi.x2-Wi.x1,_s=Wi.y2-Wi.y1,ys=Ge.textBoxScale,za=xe&&me==="never"?Bi:null;let Yn={box:[],offscreen:!1},$l=q==="never"?1:2,Su="never";Zi&&$l++;for(let Ul=0;Ul<$l;Ul++){for(let jl=Ii;jl<nn;jl++){const Ra=c.textAnchorOffsets.get(jl);if(Zi&&Ra.textAnchor!==Zi)continue;const ql=this.attemptAnchorPlacement(Ra,Wi,wu,_s,ys,ce,ge,E,b,W,Su,Ge,c,Vl,za,je);if(ql&&(Yn=ql.placedGlyphBoxes,Yn&&Yn.box&&Yn.box.length))return At=!0,Li=ql.shift,Yn}Zi?Zi=null:Su=q}return Yn};Mi(()=>ki(Do,wt.iconBox,h.ah.horizontal),()=>{const Wi=wt.verticalTextBox;return c.allowVerticalPlacement&&!(hi&&hi.box&&hi.box.length)&&Ge.numVerticalGlyphVertices>0&&Wi?ki(Wi,wt.verticalIconBox,h.ah.vertical):{box:null,offscreen:null}}),hi&&(At=hi.box,$t=hi.offscreen);const sn=Hi(hi&&hi.box);if(!At&&this.prevPlacement){const Wi=this.prevPlacement.variableOffsets[Ge.crossTileID];Wi&&(this.variableOffsets[Ge.crossTileID]=Wi,this.markUsedJustification(c,Wi.anchor,Ge,sn))}}}if(Qi=hi,At=Qi&&Qi.box&&Qi.box.length>0,$t=Qi&&Qi.offscreen,Ge.useRuntimeCollisionCircles){const Hi=c.text.placedSymbolArray.get(Ge.centerJustifiedTextSymbolIndex),Mi=h.ai(c.textSizeData,O,Hi),Ii=f.get("text-padding");Ci=this.collisionIndex.placeCollisionCircles(q,Hi,c.lineVertexArray,c.glyphOffsetArray,Mi,b,w,A,l,ge,W.predicate,Ge.collisionCircleDiameter,Ii,je),Ci.circles.length&&Ci.collisionDetected&&!l&&h.w("Collisions detected, but collision boxes are not shown"),At=se||Ci.circles.length>0&&!Ci.collisionDetected,$t=$t&&Ci.offscreen}if(wt.iconFeatureIndex&&(Kn=wt.iconFeatureIndex),wt.iconBox){const Hi=Mi=>{const Ii=xe&&Li?Sr(Mi,Li.x,Li.y,ce,ge,this.transform.angle):Mi;return this.collisionIndex.placeCollisionBox(Ii,me,E,b,W.predicate,je)};Hr&&Hr.box&&Hr.box.length&&wt.verticalIconBox?(er=Hi(wt.verticalIconBox),Ot=er.box.length>0):(er=Hi(wt.iconBox),Ot=er.box.length>0),$t=$t&&er.offscreen}const Xn=Z||Ge.numHorizontalGlyphVertices===0&&Ge.numVerticalGlyphVertices===0,En=Y||Ge.numIconVertices===0;if(Xn||En?En?Xn||(Ot=Ot&&At):At=Ot&&At:Ot=At=Ot&&At,At&&Qi&&Qi.box&&this.collisionIndex.insertCollisionBox(Qi.box,q,f.get("text-ignore-placement"),c.bucketInstanceId,Hr&&Hr.box&&In?In:Zr,W.ID),Ot&&er&&this.collisionIndex.insertCollisionBox(er.box,me,f.get("icon-ignore-placement"),c.bucketInstanceId,Kn,W.ID),Ci&&(At&&this.collisionIndex.insertCollisionCircles(Ci.circles,q,f.get("text-ignore-placement"),c.bucketInstanceId,Zr,W.ID),l)){const Hi=c.bucketInstanceId;let Mi=this.collisionCircleArrays[Hi];Mi===void 0&&(Mi=this.collisionCircleArrays[Hi]=new qi);for(let Ii=0;Ii<Ci.circles.length;Ii+=4)Mi.circles.push(Ci.circles[Ii+0]),Mi.circles.push(Ci.circles[Ii+1]),Mi.circles.push(Ci.circles[Ii+2]),Mi.circles.push(Ci.collisionDetected?1:0)}if(Ge.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(c.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ge.crossTileID]=new Ti(At||ze,Ot||ke,$t||c.justReloaded),s[Ge.crossTileID]=!0};if(be){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ge=c.getSortedSymbolIndexes(this.transform.angle);for(let wt=Ge.length-1;wt>=0;--wt){const Lt=Ge[wt];Rt(c.symbolInstances.get(Lt),c.collisionArrays[Lt])}}else for(let Ge=t.symbolInstanceStart;Ge<t.symbolInstanceEnd;Ge++)Rt(c.symbolInstances.get(Ge),c.collisionArrays[Ge]);if(l&&c.bucketInstanceId in this.collisionCircleArrays){const Ge=this.collisionCircleArrays[c.bucketInstanceId];h.ar(Ge.invProjMatrix,b),Ge.viewportMatrix=this.collisionIndex.getViewportMatrix()}c.justReloaded=!1}markUsedJustification(t,s,l,c){let f;f=c===h.ah.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[h.as(s)];const b=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const w of b)w>=0&&(t.text.placedSymbolArray.get(w).crossTileID=f>=0&&w!==f?0:l.crossTileID)}markUsedOrientation(t,s,l){const c=s===h.ah.horizontal||s===h.ah.horizontalOnly?s:0,f=s===h.ah.vertical?s:0,b=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const w of b)t.text.placedSymbolArray.get(w).placedOrientation=c;l.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=f)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let l=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const c=s?s.symbolFadeChange(t):1,f=s?s.opacities:{},b=s?s.variableOffsets:{},w=s?s.placedOrientations:{};for(const A in this.placements){const E=this.placements[A],M=f[A];M?(this.opacities[A]=new fi(M,c,E.text,E.icon),l=l||E.text!==M.text.placed||E.icon!==M.icon.placed):(this.opacities[A]=new fi(null,c,E.text,E.icon,E.skipFade),l=l||E.text||E.icon)}for(const A in f){const E=f[A];if(!this.opacities[A]){const M=new fi(E,c,!1,!1);M.isHidden()||(this.opacities[A]=M,l=l||E.text.placed||E.icon.placed)}}for(const A in b)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=b[A]);for(const A in w)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=w[A]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s){const l={};for(const c of s){const f=c.getBucket(t);f&&c.latestFeatureIndex&&t.id===f.layerIds[0]&&this.updateBucketOpacities(f,l,c.collisionBoxArray)}}updateBucketOpacities(t,s,l){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const c=t.layers[0],f=c.layout,b=new fi(null,0,!1,!1,!0),w=f.get("text-allow-overlap"),A=f.get("icon-allow-overlap"),E=c._unevaluatedLayout.hasValue("text-variable-anchor")||c._unevaluatedLayout.hasValue("text-variable-anchor-offset"),M=f.get("text-rotation-alignment")==="map",k=f.get("text-pitch-alignment")==="map",O=f.get("icon-text-fit")!=="none",W=new fi(null,0,w&&(A||!t.hasIconData()||f.get("icon-optional")),A&&(w||!t.hasTextData()||f.get("text-optional")),!0);!t.collisionArrays&&l&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(l);const Z=(Y,q,se)=>{for(let me=0;me<q/4;me++)Y.opacityVertexArray.emplaceBack(se);Y.hasVisibleVertices=Y.hasVisibleVertices||se!==co};for(let Y=0;Y<t.symbolInstances.length;Y++){const q=t.symbolInstances.get(Y),{numHorizontalGlyphVertices:se,numVerticalGlyphVertices:me,crossTileID:Q}=q;let ce=this.opacities[Q];s[Q]?ce=b:ce||(ce=W,this.opacities[Q]=ce),s[Q]=!0;const ge=q.numIconVertices>0,xe=this.placedOrientations[q.crossTileID],be=xe===h.ah.vertical,ze=xe===h.ah.horizontal||xe===h.ah.horizontalOnly;if(se>0||me>0){const ke=zr(ce.text);Z(t.text,se,be?co:ke),Z(t.text,me,ze?co:ke);const Ne=ce.text.isHidden();[q.rightJustifiedTextSymbolIndex,q.centerJustifiedTextSymbolIndex,q.leftJustifiedTextSymbolIndex].forEach(Ge=>{Ge>=0&&(t.text.placedSymbolArray.get(Ge).hidden=Ne||be?1:0)}),q.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(q.verticalPlacedTextSymbolIndex).hidden=Ne||ze?1:0);const je=this.variableOffsets[q.crossTileID];je&&this.markUsedJustification(t,je.anchor,q,xe);const Rt=this.placedOrientations[q.crossTileID];Rt&&(this.markUsedJustification(t,"left",q,Rt),this.markUsedOrientation(t,Rt,q))}if(ge){const ke=zr(ce.icon),Ne=!(O&&q.verticalPlacedIconSymbolIndex&&be);q.placedIconSymbolIndex>=0&&(Z(t.icon,q.numIconVertices,Ne?ke:co),t.icon.placedSymbolArray.get(q.placedIconSymbolIndex).hidden=ce.icon.isHidden()),q.verticalPlacedIconSymbolIndex>=0&&(Z(t.icon,q.numVerticalIconVertices,Ne?co:ke),t.icon.placedSymbolArray.get(q.verticalPlacedIconSymbolIndex).hidden=ce.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const ke=t.collisionArrays[Y];if(ke){let Ne=new h.P(0,0);if(ke.textBox||ke.verticalTextBox){let Rt=!0;if(E){const Ge=this.variableOffsets[Q];Ge?(Ne=Ji(Ge.anchor,Ge.width,Ge.height,Ge.textOffset,Ge.textBoxScale),M&&Ne._rotate(k?this.transform.angle:-this.transform.angle)):Rt=!1}ke.textBox&&cr(t.textCollisionBox.collisionVertexArray,ce.text.placed,!Rt||be,Ne.x,Ne.y),ke.verticalTextBox&&cr(t.textCollisionBox.collisionVertexArray,ce.text.placed,!Rt||ze,Ne.x,Ne.y)}const je=!!(!ze&&ke.verticalIconBox);ke.iconBox&&cr(t.iconCollisionBox.collisionVertexArray,ce.icon.placed,je,O?Ne.x:0,O?Ne.y:0),ke.verticalIconBox&&cr(t.iconCollisionBox.collisionVertexArray,ce.icon.placed,!je,O?Ne.x:0,O?Ne.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const Y=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=Y.invProjMatrix,t.placementViewportMatrix=Y.viewportMatrix,t.collisionCircleArray=Y.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const l=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*l>t}setStale(){this.stale=!0}}function cr(p,t,s,l,c){p.emplaceBack(t?1:0,s?1:0,l||0,c||0),p.emplaceBack(t?1:0,s?1:0,l||0,c||0),p.emplaceBack(t?1:0,s?1:0,l||0,c||0),p.emplaceBack(t?1:0,s?1:0,l||0,c||0)}const bn=Math.pow(2,25),Nc=Math.pow(2,24),jh=Math.pow(2,17),ci=Math.pow(2,16),ll=Math.pow(2,9),cl=Math.pow(2,8),jr=Math.pow(2,1);function zr(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const t=p.placed?1:0,s=Math.floor(127*p.opacity);return s*bn+t*Nc+s*jh+t*ci+s*ll+t*cl+s*jr+t}const co=0;class tn{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,s,l,c,f){const b=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(b,c,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,f())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort((w,A)=>w.sortKey-A.sortKey));this._currentPartIndex<b.length;)if(s.placeLayerBucketPart(b[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,f())return!0;return!1}}class rn{constructor(t,s,l,c,f,b,w,A){this.placement=new Dr(t,s,b,w,A),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=f,this._done=!1}isDone(){return this._done}continuePlacement(t,s,l){const c=N.now(),f=()=>!this._forceFullPlacement&&N.now()-c>2;for(;this._currentPlacementIndex>=0;){const b=s[t[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(b.type==="symbol"&&(!b.minzoom||b.minzoom<=w)&&(!b.maxzoom||b.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new tn(b)),this._inProgressLayer.continuePlacement(l[b.source],this.placement,this._showCollisionBoxes,b,f))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Ms=512/h.W/2;class Wo{constructor(t,s,l){this.tileID=t,this.bucketInstanceId=l,this._symbolsByKey={};const c=new Map;for(let f=0;f<s.length;f++){const b=s.get(f),w=b.key,A=c.get(w);A?A.push(b):c.set(w,[b])}for(const[f,b]of c){const w={positions:b.map(A=>({x:Math.floor(A.anchorX*Ms),y:Math.floor(A.anchorY*Ms)})),crossTileIDs:b.map(A=>A.crossTileID)};if(w.positions.length>128){const A=new h.au(w.positions.length,16,Uint16Array);for(const{x:E,y:M}of w.positions)A.add(E,M);A.finish(),delete w.positions,w.index=A}this._symbolsByKey[f]=w}}getScaledCoordinates(t,s){const{x:l,y:c,z:f}=this.tileID.canonical,{x:b,y:w,z:A}=s.canonical,E=Ms/Math.pow(2,A-f),M=(w*h.W+t.anchorY)*E,k=c*h.W*Ms;return{x:Math.floor((b*h.W+t.anchorX)*E-l*h.W*Ms),y:Math.floor(M-k)}}findMatches(t,s,l){const c=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let f=0;f<t.length;f++){const b=t.get(f);if(b.crossTileID)continue;const w=this._symbolsByKey[b.key];if(!w)continue;const A=this.getScaledCoordinates(b,s);if(w.index){const E=w.index.range(A.x-c,A.y-c,A.x+c,A.y+c).sort();for(const M of E){const k=w.crossTileIDs[M];if(!l[k]){l[k]=!0,b.crossTileID=k;break}}}else if(w.positions)for(let E=0;E<w.positions.length;E++){const M=w.positions[E],k=w.crossTileIDs[E];if(Math.abs(M.x-A.x)<=c&&Math.abs(M.y-A.y)<=c&&!l[k]){l[k]=!0,b.crossTileID=k;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class Gi{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class uo{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const l in this.indexes){const c=this.indexes[l],f={};for(const b in c){const w=c[b];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+s),f[w.tileID.key]=w}this.indexes[l]=f}this.lng=t}addBucket(t,s,l){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let f=0;f<s.symbolInstances.length;f++)s.symbolInstances.get(f).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const c=this.usedCrossTileIDs[t.overscaledZ];for(const f in this.indexes){const b=this.indexes[f];if(Number(f)>t.overscaledZ)for(const w in b){const A=b[w];A.tileID.isChildOf(t)&&A.findMatches(s.symbolInstances,t,c)}else{const w=b[t.scaledTo(Number(f)).key];w&&w.findMatches(s.symbolInstances,t,c)}}for(let f=0;f<s.symbolInstances.length;f++){const b=s.symbolInstances.get(f);b.crossTileID||(b.crossTileID=l.generate(),c[b.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Wo(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const l of s.getCrossTileIDsLists())for(const c of l)delete this.usedCrossTileIDs[t][c]}removeStaleBuckets(t){let s=!1;for(const l in this.indexes){const c=this.indexes[l];for(const f in c)t[c[f].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,c[f]),delete c[f],s=!0)}return s}}class jn{constructor(){this.layerIndexes={},this.crossTileIDs=new Gi,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,l){let c=this.layerIndexes[t.id];c===void 0&&(c=this.layerIndexes[t.id]=new uo);let f=!1;const b={};c.handleWrapJump(l);for(const w of s){const A=w.getBucket(t);A&&t.id===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),c.addBucket(w.tileID,A,this.crossTileIDs)&&(f=!0),b[A.bucketInstanceId]=!0)}return c.removeStaleBuckets(b)&&(f=!0),f}pruneUnusedLayers(t){const s={};t.forEach(l=>{s[l]=!0});for(const l in this.layerIndexes)s[l]||delete this.layerIndexes[l]}}const Pi=(p,t)=>h.t(p,t&&t.filter(s=>s.identifier!=="source.canvas")),Ko=h.av();class qr extends h.E{constructor(t,s={}){super(),this._rtlPluginLoaded=()=>{for(const l in this.sourceCaches){const c=this.sourceCaches[l].getSource().type;c!=="vector"&&c!=="geojson"||this.sourceCaches[l].reload()}},this.map=t,this.dispatcher=new tt(Pe(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",(l,c)=>this.getGlyphs(l,c)),this.dispatcher.registerMessageHandler("GI",(l,c)=>this.getImages(l,c)),this.imageManager=new Bt,this.imageManager.setEventedParent(this),this.glyphManager=new Ct(t._requestManager,s.localIdeographFontFamily),this.lineAtlas=new bi(256,512),this.crossTileSymbolIndex=new jn,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new h.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",h.ax()),Ce().on(Tt,this._rtlPluginLoaded),this.on("data",l=>{if(l.dataType!=="source"||l.sourceDataType!=="metadata")return;const c=this.sourceCaches[l.sourceId];if(!c)return;const f=c.getSource();if(f&&f.vectorLayerIds)for(const b in this._layers){const w=this._layers[b];w.source===f.id&&this._validateLayer(w)}})}loadURL(t,s={},l){this.fire(new h.k("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const c=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController,h.h(c,this._loadStyleRequest).then(f=>{this._loadStyleRequest=null,this._load(f.data,s,l)}).catch(f=>{this._loadStyleRequest=null,f&&this.fire(new h.j(f))})}loadJSON(t,s={},l){this.fire(new h.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,N.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,s.validate=s.validate!==!1,this._load(t,s,l)}).catch(()=>{})}loadEmpty(){this.fire(new h.k("dataloading",{dataType:"style"})),this._load(Ko,{validate:!1})}_load(t,s,l){var c;const f=s.transformStyle?s.transformStyle(l,t):t;if(!s.validate||!Pi(this,h.x(f))){this._loaded=!0,this.stylesheet=f;for(const b in f.sources)this.addSource(b,f.sources[b],{validate:!1});f.sprite?this._loadSprite(f.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(f.glyphs),this._createLayers(),this.light=new wr(this.stylesheet.light),this.map.setTerrain((c=this.stylesheet.terrain)!==null&&c!==void 0?c:null),this.fire(new h.k("data",{dataType:"style"})),this.fire(new h.k("style.load"))}}_createLayers(){const t=h.ay(this.stylesheet.layers);this.dispatcher.broadcast("SL",t),this._order=t.map(s=>s.id),this._layers={},this._serializedLayers=null;for(const s of t){const l=h.az(s);l.setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=l}}_loadSprite(t,s=!1,l=void 0){let c;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(f,b,w,A){return h._(this,void 0,void 0,function*(){const E=kt(f),M=w>1?"@2x":"",k={},O={};for(const{id:W,url:Z}of E){const Y=b.transformRequest(b.normalizeSpriteURL(Z,M,".json"),"SpriteJSON");k[W]=h.h(Y,A);const q=b.transformRequest(b.normalizeSpriteURL(Z,M,".png"),"SpriteImage");O[W]=ye.getImage(q,A)}return yield Promise.all([...Object.values(k),...Object.values(O)]),function(W,Z){return h._(this,void 0,void 0,function*(){const Y={};for(const q in W){Y[q]={};const se=N.getImageCanvasContext((yield Z[q]).data),me=(yield W[q]).data;for(const Q in me){const{width:ce,height:ge,x:xe,y:be,sdf:ze,pixelRatio:ke,stretchX:Ne,stretchY:je,content:Rt}=me[Q];Y[q][Q]={data:null,pixelRatio:ke,sdf:ze,stretchX:Ne,stretchY:je,content:Rt,spriteData:{width:ce,height:ge,x:xe,y:be,context:se}}}}return Y})}(k,O)})}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(f=>{if(this._spriteRequest=null,f)for(const b in f){this._spritesImagesIds[b]=[];const w=this._spritesImagesIds[b]?this._spritesImagesIds[b].filter(A=>!(A in f)):[];for(const A of w)this.imageManager.removeImage(A),this._changedImages[A]=!0;for(const A in f[b]){const E=b==="default"?A:`${b}:${A}`;this._spritesImagesIds[b].push(E),E in this.imageManager.images?this.imageManager.updateImage(E,f[b][A],!1):this.imageManager.addImage(E,f[b][A]),s&&(this._changedImages[E]=!0)}}}).catch(f=>{this._spriteRequest=null,c=f,this.fire(new h.j(c))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.k("data",{dataType:"style"})),l&&l(c)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.k("data",{dataType:"style"}))}_validateLayer(t){const s=this.sourceCaches[t.source];if(!s)return;const l=t.sourceLayer;if(!l)return;const c=s.getSource();(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(l)===-1)&&this.fire(new h.j(new Error(`Source layer "${l}" does not exist on source "${c.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const s=this._serializedAllLayers();if(!t||t.length===0)return Object.values(s);const l=[];for(const c of t)s[c]&&l.push(s[c]);return l}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const s=Object.keys(this._layers);for(const l of s){const c=this._layers[l];c.type!=="custom"&&(t[l]=c.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const s=this._changed;if(s){const c=Object.keys(this._updatedLayers),f=Object.keys(this._removedLayers);(c.length||f.length)&&this._updateWorkerLayers(c,f);for(const b in this._updatedSources){const w=this._updatedSources[b];if(w==="reload")this._reloadSource(b);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(b)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const b in this._updatedPaintProps)this._layers[b].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const l={};for(const c in this.sourceCaches){const f=this.sourceCaches[c];l[c]=f.used,f.used=!1}for(const c of this._order){const f=this._layers[c];f.recalculate(t,this._availableImages),!f.isHidden(t.zoom)&&f.source&&(this.sourceCaches[f.source].used=!0)}for(const c in l){const f=this.sourceCaches[c];!!l[c]!=!!f.used&&f.fire(new h.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:c}))}this.light.recalculate(t),this.z=t.zoom,s&&this.fire(new h.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,s){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,s={}){var l;this._checkLoaded();const c=this.serialize();if(t=s.transformStyle?s.transformStyle(c,t):t,((l=s.validate)===null||l===void 0||l)&&Pi(this,h.x(t)))return!1;(t=h.aA(t)).layers=h.ay(t.layers);const f=h.aB(c,t),b=this._getOperationsToPerform(f);if(b.unimplemented.length>0)throw new Error(`Unimplemented: ${b.unimplemented.join(", ")}.`);if(b.operations.length===0)return!1;for(const w of b.operations)w();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const s=[],l=[];for(const c of t)switch(c.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":s.push(()=>this.addLayer.apply(this,c.args));break;case"removeLayer":s.push(()=>this.removeLayer.apply(this,c.args));break;case"setPaintProperty":s.push(()=>this.setPaintProperty.apply(this,c.args));break;case"setLayoutProperty":s.push(()=>this.setLayoutProperty.apply(this,c.args));break;case"setFilter":s.push(()=>this.setFilter.apply(this,c.args));break;case"addSource":s.push(()=>this.addSource.apply(this,c.args));break;case"removeSource":s.push(()=>this.removeSource.apply(this,c.args));break;case"setLayerZoomRange":s.push(()=>this.setLayerZoomRange.apply(this,c.args));break;case"setLight":s.push(()=>this.setLight.apply(this,c.args));break;case"setGeoJSONSourceData":s.push(()=>this.setGeoJSONSourceData.apply(this,c.args));break;case"setGlyphs":s.push(()=>this.setGlyphs.apply(this,c.args));break;case"setSprite":s.push(()=>this.setSprite.apply(this,c.args));break;case"setTerrain":s.push(()=>this.map.setTerrain.apply(this,c.args));break;case"setTransition":s.push(()=>{});break;default:l.push(c.command)}return{operations:s,unimplemented:l}}addImage(t,s){if(this.getImage(t))return this.fire(new h.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,s),this._afterImageUpdated(t)}updateImage(t,s){this.imageManager.updateImage(t,s)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new h.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,s,l={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(h.x.source,`sources.${t}`,s,null,l))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const c=this.sourceCaches[t]=new Xi(t,s,this.dispatcher);c.style=this,c.setEventedParent(this,()=>({isSourceLoaded:c.loaded(),source:c.serialize(),sourceId:t})),c.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===t)return this.fire(new h.j(new Error(`Source "${t}" cannot be removed while layer "${l}" is using it.`)));const s=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],s.fire(new h.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,s){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const l=this.sourceCaches[t].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(s),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,s,l={}){this._checkLoaded();const c=t.id;if(this.getLayer(c))return void this.fire(new h.j(new Error(`Layer "${c}" already exists on this map.`)));let f;if(t.type==="custom"){if(Pi(this,h.aC(t)))return;f=h.az(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(c,t.source),t=h.aA(t),t=h.e(t,{source:c})),this._validate(h.x.layer,`layers.${c}`,t,{arrayIndex:-1},l))return;f=h.az(t),this._validateLayer(f),f.setEventedParent(this,{layer:{id:c}})}const b=s?this._order.indexOf(s):this._order.length;if(s&&b===-1)this.fire(new h.j(new Error(`Cannot add layer "${c}" before non-existing layer "${s}".`)));else{if(this._order.splice(b,0,c),this._layerOrderChanged=!0,this._layers[c]=f,this._removedLayers[c]&&f.source&&f.type!=="custom"){const w=this._removedLayers[c];delete this._removedLayers[c],w.type!==f.type?this._updatedSources[f.source]="clear":(this._updatedSources[f.source]="reload",this.sourceCaches[f.source].pause())}this._updateLayer(f),f.onAdd&&f.onAdd(this.map)}}moveLayer(t,s){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new h.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===s)return;const l=this._order.indexOf(t);this._order.splice(l,1);const c=s?this._order.indexOf(s):this._order.length;s&&c===-1?this.fire(new h.j(new Error(`Cannot move layer "${t}" before non-existing layer "${s}".`))):(this._order.splice(c,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const s=this._layers[t];if(!s)return void this.fire(new h.j(new Error(`Cannot remove non-existing layer "${t}".`)));s.setEventedParent(null);const l=this._order.indexOf(t);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=s,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],s.onRemove&&s.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,s,l){this._checkLoaded();const c=this.getLayer(t);c?c.minzoom===s&&c.maxzoom===l||(s!=null&&(c.minzoom=s),l!=null&&(c.maxzoom=l),this._updateLayer(c)):this.fire(new h.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,s,l={}){this._checkLoaded();const c=this.getLayer(t);if(c){if(!h.aD(c.filter,s))return s==null?(c.filter=void 0,void this._updateLayer(c)):void(this._validate(h.x.filter,`layers.${c.id}.filter`,s,null,l)||(c.filter=h.aA(s),this._updateLayer(c)))}else this.fire(new h.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return h.aA(this.getLayer(t).filter)}setLayoutProperty(t,s,l,c={}){this._checkLoaded();const f=this.getLayer(t);f?h.aD(f.getLayoutProperty(s),l)||(f.setLayoutProperty(s,l,c),this._updateLayer(f)):this.fire(new h.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,s){const l=this.getLayer(t);if(l)return l.getLayoutProperty(s);this.fire(new h.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,s,l,c={}){this._checkLoaded();const f=this.getLayer(t);f?h.aD(f.getPaintProperty(s),l)||(f.setPaintProperty(s,l,c)&&this._updateLayer(f),this._changed=!0,this._updatedPaintProps[t]=!0,this._serializedLayers=null):this.fire(new h.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,s){return this.getLayer(t).getPaintProperty(s)}setFeatureState(t,s){this._checkLoaded();const l=t.source,c=t.sourceLayer,f=this.sourceCaches[l];if(f===void 0)return void this.fire(new h.j(new Error(`The source '${l}' does not exist in the map's style.`)));const b=f.getSource().type;b==="geojson"&&c?this.fire(new h.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):b!=="vector"||c?(t.id===void 0&&this.fire(new h.j(new Error("The feature id parameter must be provided."))),f.setFeatureState(c,t.id,s)):this.fire(new h.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,s){this._checkLoaded();const l=t.source,c=this.sourceCaches[l];if(c===void 0)return void this.fire(new h.j(new Error(`The source '${l}' does not exist in the map's style.`)));const f=c.getSource().type,b=f==="vector"?t.sourceLayer:void 0;f!=="vector"||b?s&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new h.j(new Error("A feature id is required to remove its specific state property."))):c.removeFeatureState(b,t.id,s):this.fire(new h.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const s=t.source,l=t.sourceLayer,c=this.sourceCaches[s];if(c!==void 0)return c.getSource().type!=="vector"||l?(t.id===void 0&&this.fire(new h.j(new Error("The feature id parameter must be provided."))),c.getFeatureState(l,t.id)):void this.fire(new h.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new h.j(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return h.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=h.aE(this.sourceCaches,f=>f.serialize()),s=this._serializeByIds(this._order),l=this.map.getTerrain()||void 0,c=this.stylesheet;return h.aF({version:c.version,name:c.name,metadata:c.metadata,light:c.light,center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,sprite:c.sprite,glyphs:c.glyphs,transition:c.transition,sources:t,layers:s,terrain:l},f=>f!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const s=b=>this._layers[b].type==="fill-extrusion",l={},c=[];for(let b=this._order.length-1;b>=0;b--){const w=this._order[b];if(s(w)){l[w]=b;for(const A of t){const E=A[w];if(E)for(const M of E)c.push(M)}}}c.sort((b,w)=>w.intersectionZ-b.intersectionZ);const f=[];for(let b=this._order.length-1;b>=0;b--){const w=this._order[b];if(s(w))for(let A=c.length-1;A>=0;A--){const E=c[A].feature;if(l[E.layer.id]<b)break;f.push(E),c.pop()}else for(const A of t){const E=A[w];if(E)for(const M of E)f.push(M.feature)}}return f}queryRenderedFeatures(t,s,l){s&&s.filter&&this._validate(h.x.filter,"queryRenderedFeatures.filter",s.filter,null,s);const c={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new h.j(new Error("parameters.layers must be an Array."))),[];for(const w of s.layers){const A=this._layers[w];if(!A)return this.fire(new h.j(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];c[A.source]=!0}}const f=[];s.availableImages=this._availableImages;const b=this._serializedAllLayers();for(const w in this.sourceCaches)s.layers&&!c[w]||f.push(Qt(this.sourceCaches[w],this._layers,b,t,s,l));return this.placement&&f.push(function(w,A,E,M,k,O,W){const Z={},Y=O.queryRenderedSymbols(M),q=[];for(const se of Object.keys(Y).map(Number))q.push(W[se]);q.sort(ti);for(const se of q){const me=se.featureIndex.lookupSymbolFeatures(Y[se.bucketInstanceId],A,se.bucketIndex,se.sourceLayerIndex,k.filter,k.layers,k.availableImages,w);for(const Q in me){const ce=Z[Q]=Z[Q]||[],ge=me[Q];ge.sort((xe,be)=>{const ze=se.featureSortOrder;if(ze){const ke=ze.indexOf(xe.featureIndex);return ze.indexOf(be.featureIndex)-ke}return be.featureIndex-xe.featureIndex});for(const xe of ge)ce.push(xe)}}for(const se in Z)Z[se].forEach(me=>{const Q=me.feature,ce=E[w[se].source].getFeatureState(Q.layer["source-layer"],Q.id);Q.source=Q.layer.source,Q.layer["source-layer"]&&(Q.sourceLayer=Q.layer["source-layer"]),Q.state=ce});return Z}(this._layers,b,this.sourceCaches,t,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(f)}querySourceFeatures(t,s){s&&s.filter&&this._validate(h.x.filter,"querySourceFeatures.filter",s.filter,null,s);const l=this.sourceCaches[t];return l?function(c,f){const b=c.getRenderableIds().map(E=>c.getTileByID(E)),w=[],A={};for(let E=0;E<b.length;E++){const M=b[E],k=M.tileID.canonical.key;A[k]||(A[k]=!0,M.querySourceFeatures(w,f))}return w}(l,s):[]}getLight(){return this.light.getLight()}setLight(t,s={}){this._checkLoaded();const l=this.light.getLight();let c=!1;for(const b in t)if(!h.aD(t[b],l[b])){c=!0;break}if(!c)return;const f={now:N.now(),transition:h.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,s),this.light.updateTransitions(f)}_validate(t,s,l,c,f={}){return(!f||f.validate!==!1)&&Pi(this,t.call(h.x,h.e({key:s,style:this.serialize(),value:l,styleSpec:h.v},c)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Ce().off(Tt,this._rtlPluginLoaded);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const l=this.sourceCaches[s];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const s in this.sourceCaches)this.sourceCaches[s].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,s,l,c,f=!1){let b=!1,w=!1;const A={};for(const E of this._order){const M=this._layers[E];if(M.type!=="symbol")continue;if(!A[M.source]){const O=this.sourceCaches[M.source];A[M.source]=O.getRenderableIds(!0).map(W=>O.getTileByID(W)).sort((W,Z)=>Z.tileID.overscaledZ-W.tileID.overscaledZ||(W.tileID.isLessThan(Z.tileID)?-1:1))}const k=this.crossTileSymbolIndex.addLayer(M,A[M.source],t.center.lng);b=b||k}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((f=f||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(N.now(),t.zoom))&&(this.pauseablePlacement=new rn(t,this.map.terrain,this._order,f,s,l,c,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(N.now()),w=!0),b&&this.pauseablePlacement.placement.setStale()),w||b)for(const E of this._order){const M=this._layers[E];M.type==="symbol"&&this.placement.updateLayerOpacities(M,A[M.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(N.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,s){return h._(this,void 0,void 0,function*(){const l=yield this.imageManager.getImages(s.icons);this._updateTilesForChangedImages();const c=this.sourceCaches[s.source];return c&&c.setDependencies(s.tileID.key,s.type,s.icons),l})}getGlyphs(t,s){return h._(this,void 0,void 0,function*(){const l=yield this.glyphManager.getGlyphs(s.stacks),c=this.sourceCaches[s.source];return c&&c.setDependencies(s.tileID.key,s.type,[""]),l})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,s={}){this._checkLoaded(),t&&this._validate(h.x.glyphs,"glyphs",t,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,s,l={},c){this._checkLoaded();const f=[{id:t,url:s}],b=[...kt(this.stylesheet.sprite),...f];this._validate(h.x.sprite,"sprite",b,null,l)||(this.stylesheet.sprite=b,this._loadSprite(f,!0,c))}removeSprite(t){this._checkLoaded();const s=kt(this.stylesheet.sprite);if(s.find(l=>l.id===t)){if(this._spritesImagesIds[t])for(const l of this._spritesImagesIds[t])this.imageManager.removeImage(l),this._changedImages[l]=!0;s.splice(s.findIndex(l=>l.id===t),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.k("data",{dataType:"style"}))}else this.fire(new h.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return kt(this.stylesheet.sprite)}setSprite(t,s={},l){this._checkLoaded(),t&&this._validate(h.x.sprite,"sprite",t,null,s)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,l):(this._unloadSprite(),l&&l(null)))}}var Xo=h.X([{name:"a_pos",type:"Int16",components:2}]),wn="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const ho={prelude:ui(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:ui(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:ui(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ui(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ui("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ui(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:ui(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ui("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ui("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ui("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:ui(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:ui(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:ui(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:ui(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ui(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ui(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ui(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ui(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:ui(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ui(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ui(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ui(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:ui(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:ui(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ui(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ui(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ui("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",wn),terrainDepth:ui("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",wn),terrainCoords:ui("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",wn)};function ui(p,t){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=t.match(/attribute ([\w]+) ([\w]+)/g),c=p.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),f=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=f?f.concat(c):c,w={};return{fragmentSource:p=p.replace(s,(A,E,M,k,O)=>(w[O]=!0,E==="define"?`
#ifndef HAS_UNIFORM_u_${O}
varying ${M} ${k} ${O};
#else
uniform ${M} ${k} u_${O};
#endif
`:`
#ifdef HAS_UNIFORM_u_${O}
    ${M} ${k} ${O} = u_${O};
#endif
`)),vertexSource:t=t.replace(s,(A,E,M,k,O)=>{const W=k==="float"?"vec2":"vec4",Z=O.match(/color/)?"color":W;return w[O]?E==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
attribute ${M} ${W} a_${O};
varying ${M} ${k} ${O};
#else
uniform ${M} ${k} u_${O};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = a_${O};
#else
    ${M} ${k} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = unpack_mix_${Z}(a_${O}, u_${O}_t);
#else
    ${M} ${k} ${O} = u_${O};
#endif
`:E==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
attribute ${M} ${W} a_${O};
#else
uniform ${M} ${k} u_${O};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${M} ${k} ${O} = a_${O};
#else
    ${M} ${k} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${M} ${k} ${O} = unpack_mix_${Z}(a_${O}, u_${O}_t);
#else
    ${M} ${k} ${O} = u_${O};
#endif
`}),staticAttributes:l,staticUniforms:b}}class Yo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,s,l,c,f,b,w,A,E){this.context=t;let M=this.boundPaintVertexBuffers.length!==c.length;for(let k=0;!M&&k<c.length;k++)this.boundPaintVertexBuffers[k]!==c[k]&&(M=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==l||M||this.boundIndexBuffer!==f||this.boundVertexOffset!==b||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==A||this.boundDynamicVertexBuffer3!==E?this.freshBind(s,l,c,f,b,w,A,E):(t.bindVertexArray.set(this.vao),w&&w.bind(),f&&f.dynamicDraw&&f.bind(),A&&A.bind(),E&&E.bind())}freshBind(t,s,l,c,f,b,w,A){const E=t.numAttributes,M=this.context,k=M.gl;this.vao&&this.destroy(),this.vao=M.createVertexArray(),M.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=c,this.boundVertexOffset=f,this.boundDynamicVertexBuffer=b,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=A,s.enableAttributes(k,t);for(const O of l)O.enableAttributes(k,t);b&&b.enableAttributes(k,t),w&&w.enableAttributes(k,t),A&&A.enableAttributes(k,t),s.bind(),s.setVertexAttribPointers(k,t,f);for(const O of l)O.bind(),O.setVertexAttribPointers(k,t,f);b&&(b.bind(),b.setVertexAttribPointers(k,t,f)),c&&c.bind(),w&&(w.bind(),w.setVertexAttribPointers(k,t,f)),A&&(A.bind(),A.setVertexAttribPointers(k,t,f)),M.currentNumAttributes=E}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function ks(p){const t=[];for(let s=0;s<p.length;s++){if(p[s]===null)continue;const l=p[s].split(" ");t.push(l.pop())}return t}class qn{constructor(t,s,l,c,f,b){const w=t.gl;this.program=w.createProgram();const A=ks(s.staticAttributes),E=l?l.getBinderAttributes():[],M=A.concat(E),k=ho.prelude.staticUniforms?ks(ho.prelude.staticUniforms):[],O=s.staticUniforms?ks(s.staticUniforms):[],W=l?l.getBinderUniforms():[],Z=k.concat(O).concat(W),Y=[];for(const xe of Z)Y.indexOf(xe)<0&&Y.push(xe);const q=l?l.defines():[];f&&q.push("#define OVERDRAW_INSPECTOR;"),b&&q.push("#define TERRAIN3D;");const se=q.concat(ho.prelude.fragmentSource,s.fragmentSource).join(`
`),me=q.concat(ho.prelude.vertexSource,s.vertexSource).join(`
`),Q=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(Q,se),w.compileShader(Q),!w.getShaderParameter(Q,w.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${w.getShaderInfoLog(Q)}`);w.attachShader(this.program,Q);const ce=w.createShader(w.VERTEX_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(ce,me),w.compileShader(ce),!w.getShaderParameter(ce,w.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${w.getShaderInfoLog(ce)}`);w.attachShader(this.program,ce),this.attributes={};const ge={};this.numAttributes=M.length;for(let xe=0;xe<this.numAttributes;xe++)M[xe]&&(w.bindAttribLocation(this.program,xe,M[xe]),this.attributes[M[xe]]=xe);if(w.linkProgram(this.program),!w.getProgramParameter(this.program,w.LINK_STATUS))throw new Error(`Program failed to link: ${w.getProgramInfoLog(this.program)}`);w.deleteShader(ce),w.deleteShader(Q);for(let xe=0;xe<Y.length;xe++){const be=Y[xe];if(be&&!ge[be]){const ze=w.getUniformLocation(this.program,be);ze&&(ge[be]=ze)}}this.fixedUniforms=c(t,ge),this.terrainUniforms=((xe,be)=>({u_depth:new h.aG(xe,be.u_depth),u_terrain:new h.aG(xe,be.u_terrain),u_terrain_dim:new h.aH(xe,be.u_terrain_dim),u_terrain_matrix:new h.aI(xe,be.u_terrain_matrix),u_terrain_unpack:new h.aJ(xe,be.u_terrain_unpack),u_terrain_exaggeration:new h.aH(xe,be.u_terrain_exaggeration)}))(t,ge),this.binderUniforms=l?l.getUniforms(t,ge):[]}draw(t,s,l,c,f,b,w,A,E,M,k,O,W,Z,Y,q,se,me){const Q=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(l),t.setStencilMode(c),t.setColorMode(f),t.setCullFace(b),A){t.activeTexture.set(Q.TEXTURE2),Q.bindTexture(Q.TEXTURE_2D,A.depthTexture),t.activeTexture.set(Q.TEXTURE3),Q.bindTexture(Q.TEXTURE_2D,A.texture);for(const ge in this.terrainUniforms)this.terrainUniforms[ge].set(A[ge])}for(const ge in this.fixedUniforms)this.fixedUniforms[ge].set(w[ge]);Y&&Y.setUniforms(t,this.binderUniforms,W,{zoom:Z});let ce=0;switch(s){case Q.LINES:ce=2;break;case Q.TRIANGLES:ce=3;break;case Q.LINE_STRIP:ce=1}for(const ge of O.get()){const xe=ge.vaos||(ge.vaos={});(xe[E]||(xe[E]=new Yo)).bind(t,this,M,Y?Y.getPaintVertexBuffers():[],k,ge.vertexOffset,q,se,me),Q.drawElements(s,ge.primitiveLength*ce,Q.UNSIGNED_SHORT,ge.primitiveOffset*ce*2)}}}function Jo(p,t,s){const l=1/Et(s,1,t.transform.tileZoom),c=Math.pow(2,s.tileID.overscaledZ),f=s.tileSize*Math.pow(2,t.transform.tileZoom)/c,b=f*(s.tileID.canonical.x+s.tileID.wrap*c),w=f*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[l,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[b>>16,w>>16],u_pixel_coord_lower:[65535&b,65535&w]}}const po=(p,t,s,l)=>{const c=t.style.light,f=c.properties.get("position"),b=[f.x,f.y,f.z],w=function(){var E=new h.A(9);return h.A!=Float32Array&&(E[1]=0,E[2]=0,E[3]=0,E[5]=0,E[6]=0,E[7]=0),E[0]=1,E[4]=1,E[8]=1,E}();c.properties.get("anchor")==="viewport"&&function(E,M){var k=Math.sin(M),O=Math.cos(M);E[0]=O,E[1]=k,E[2]=0,E[3]=-k,E[4]=O,E[5]=0,E[6]=0,E[7]=0,E[8]=1}(w,-t.transform.angle),function(E,M,k){var O=M[0],W=M[1],Z=M[2];E[0]=O*k[0]+W*k[3]+Z*k[6],E[1]=O*k[1]+W*k[4]+Z*k[7],E[2]=O*k[2]+W*k[5]+Z*k[8]}(b,b,w);const A=c.properties.get("color");return{u_matrix:p,u_lightpos:b,u_lightintensity:c.properties.get("intensity"),u_lightcolor:[A.r,A.g,A.b],u_vertical_gradient:+s,u_opacity:l}},qh=(p,t,s,l,c,f,b)=>h.e(po(p,t,s,l),Jo(f,t,b),{u_height_factor:-Math.pow(2,c.overscaledZ)/b.tileSize/8}),Vc=p=>({u_matrix:p}),Qo=(p,t,s,l)=>h.e(Vc(p),Jo(s,t,l)),Gh=(p,t)=>({u_matrix:p,u_world:t}),$c=(p,t,s,l,c)=>h.e(Qo(p,t,s,l),{u_world:c}),Hh=(p,t,s,l)=>{const c=p.transform;let f,b;if(l.paint.get("circle-pitch-alignment")==="map"){const w=Et(s,1,c.zoom);f=!0,b=[w,w]}else f=!1,b=c.pixelsToGLUnits;return{u_camera_to_center_distance:c.cameraToCenterDistance,u_scale_with_map:+(l.paint.get("circle-pitch-scale")==="map"),u_matrix:p.translatePosMatrix(t.posMatrix,s,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_pitch_with_map:+f,u_device_pixel_ratio:p.pixelRatio,u_extrude_scale:b}},Uc=(p,t,s)=>{const l=Et(s,1,t.zoom),c=Math.pow(2,t.zoom-s.tileID.overscaledZ),f=s.tileID.overscaleFactor();return{u_matrix:p,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:l,u_extrude_scale:[t.pixelsToGLUnits[0]/(l*c),t.pixelsToGLUnits[1]/(l*c)],u_overscale_factor:f}},jc=(p,t,s=1)=>({u_matrix:p,u_color:t,u_overlay:0,u_overlay_scale:s}),ea=p=>({u_matrix:p}),qc=(p,t,s,l)=>({u_matrix:p,u_extrude_scale:Et(t,1,s),u_intensity:l});function Gc(p,t){const s=Math.pow(2,t.canonical.z),l=t.canonical.y;return[new h.Y(0,l/s).toLngLat().lat,new h.Y(0,(l+1)/s).toLngLat().lat]}const ta=(p,t,s,l)=>{const c=p.transform;return{u_matrix:fo(p,t,s,l),u_ratio:1/Et(t,1,c.zoom),u_device_pixel_ratio:p.pixelRatio,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]]}},Hc=(p,t,s,l,c)=>h.e(ta(p,t,s,c),{u_image:0,u_image_height:l}),cs=(p,t,s,l,c)=>{const f=p.transform,b=Gr(t,f);return{u_matrix:fo(p,t,s,c),u_texsize:t.imageAtlasTexture.size,u_ratio:1/Et(t,1,f.zoom),u_device_pixel_ratio:p.pixelRatio,u_image:0,u_scale:[b,l.fromScale,l.toScale],u_fade:l.t,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},ia=(p,t,s,l,c,f)=>{const b=p.lineAtlas,w=Gr(t,p.transform),A=s.layout.get("line-cap")==="round",E=b.getDash(l.from,A),M=b.getDash(l.to,A),k=E.width*c.fromScale,O=M.width*c.toScale;return h.e(ta(p,t,s,f),{u_patternscale_a:[w/k,-E.height/2],u_patternscale_b:[w/O,-M.height/2],u_sdfgamma:b.width/(256*Math.min(k,O)*p.pixelRatio)/2,u_image:0,u_tex_y_a:E.y,u_tex_y_b:M.y,u_mix:c.t})};function Gr(p,t){return 1/Et(p,1,t.tileZoom)}function fo(p,t,s,l){return p.translatePosMatrix(l?l.posMatrix:t.tileID.posMatrix,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const ra=(p,t,s,l,c)=>{return{u_matrix:p,u_tl_parent:t,u_scale_parent:s,u_buffer_scale:1,u_fade_t:l.mix,u_opacity:l.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(b=c.paint.get("raster-saturation"),b>0?1-1/(1.001-b):-b),u_contrast_factor:(f=c.paint.get("raster-contrast"),f>0?1/(1-f):1+f),u_spin_weights:mo(c.paint.get("raster-hue-rotate"))};var f,b};function mo(p){p*=Math.PI/180;const t=Math.sin(p),s=Math.cos(p);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const go=(p,t,s,l,c,f,b,w,A,E)=>{const M=c.transform;return{u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:M.cameraToCenterDistance,u_pitch:M.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:M.width/M.height,u_fade_change:c.options.fadeDuration?c.symbolFadeChange:1,u_matrix:f,u_label_plane_matrix:b,u_coord_matrix:w,u_is_text:+A,u_pitch_with_map:+l,u_texsize:E,u_texture:0}},_o=(p,t,s,l,c,f,b,w,A,E,M)=>{const k=c.transform;return h.e(go(p,t,s,l,c,f,b,w,A,E),{u_gamma_scale:l?Math.cos(k._pitch)*k.cameraToCenterDistance:1,u_device_pixel_ratio:c.pixelRatio,u_is_halo:+M})},yo=(p,t,s,l,c,f,b,w,A,E)=>h.e(_o(p,t,s,l,c,f,b,w,!0,A,!0),{u_texsize_icon:E,u_texture_icon:1}),Zh=(p,t,s)=>({u_matrix:p,u_opacity:t,u_color:s}),Wh=(p,t,s,l,c,f)=>h.e(function(b,w,A,E){const M=A.imageManager.getPattern(b.from.toString()),k=A.imageManager.getPattern(b.to.toString()),{width:O,height:W}=A.imageManager.getPixelSize(),Z=Math.pow(2,E.tileID.overscaledZ),Y=E.tileSize*Math.pow(2,A.transform.tileZoom)/Z,q=Y*(E.tileID.canonical.x+E.tileID.wrap*Z),se=Y*E.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:M.tl,u_pattern_br_a:M.br,u_pattern_tl_b:k.tl,u_pattern_br_b:k.br,u_texsize:[O,W],u_mix:w.t,u_pattern_size_a:M.displaySize,u_pattern_size_b:k.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/Et(E,1,A.transform.tileZoom),u_pixel_coord_upper:[q>>16,se>>16],u_pixel_coord_lower:[65535&q,65535&se]}}(l,f,s,c),{u_matrix:p,u_opacity:t}),Zc={fillExtrusion:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_lightpos:new h.aK(p,t.u_lightpos),u_lightintensity:new h.aH(p,t.u_lightintensity),u_lightcolor:new h.aK(p,t.u_lightcolor),u_vertical_gradient:new h.aH(p,t.u_vertical_gradient),u_opacity:new h.aH(p,t.u_opacity)}),fillExtrusionPattern:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_lightpos:new h.aK(p,t.u_lightpos),u_lightintensity:new h.aH(p,t.u_lightintensity),u_lightcolor:new h.aK(p,t.u_lightcolor),u_vertical_gradient:new h.aH(p,t.u_vertical_gradient),u_height_factor:new h.aH(p,t.u_height_factor),u_image:new h.aG(p,t.u_image),u_texsize:new h.aL(p,t.u_texsize),u_pixel_coord_upper:new h.aL(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.aL(p,t.u_pixel_coord_lower),u_scale:new h.aK(p,t.u_scale),u_fade:new h.aH(p,t.u_fade),u_opacity:new h.aH(p,t.u_opacity)}),fill:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix)}),fillPattern:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_image:new h.aG(p,t.u_image),u_texsize:new h.aL(p,t.u_texsize),u_pixel_coord_upper:new h.aL(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.aL(p,t.u_pixel_coord_lower),u_scale:new h.aK(p,t.u_scale),u_fade:new h.aH(p,t.u_fade)}),fillOutline:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_world:new h.aL(p,t.u_world)}),fillOutlinePattern:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_world:new h.aL(p,t.u_world),u_image:new h.aG(p,t.u_image),u_texsize:new h.aL(p,t.u_texsize),u_pixel_coord_upper:new h.aL(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.aL(p,t.u_pixel_coord_lower),u_scale:new h.aK(p,t.u_scale),u_fade:new h.aH(p,t.u_fade)}),circle:(p,t)=>({u_camera_to_center_distance:new h.aH(p,t.u_camera_to_center_distance),u_scale_with_map:new h.aG(p,t.u_scale_with_map),u_pitch_with_map:new h.aG(p,t.u_pitch_with_map),u_extrude_scale:new h.aL(p,t.u_extrude_scale),u_device_pixel_ratio:new h.aH(p,t.u_device_pixel_ratio),u_matrix:new h.aI(p,t.u_matrix)}),collisionBox:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_camera_to_center_distance:new h.aH(p,t.u_camera_to_center_distance),u_pixels_to_tile_units:new h.aH(p,t.u_pixels_to_tile_units),u_extrude_scale:new h.aL(p,t.u_extrude_scale),u_overscale_factor:new h.aH(p,t.u_overscale_factor)}),collisionCircle:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_inv_matrix:new h.aI(p,t.u_inv_matrix),u_camera_to_center_distance:new h.aH(p,t.u_camera_to_center_distance),u_viewport_size:new h.aL(p,t.u_viewport_size)}),debug:(p,t)=>({u_color:new h.aM(p,t.u_color),u_matrix:new h.aI(p,t.u_matrix),u_overlay:new h.aG(p,t.u_overlay),u_overlay_scale:new h.aH(p,t.u_overlay_scale)}),clippingMask:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix)}),heatmap:(p,t)=>({u_extrude_scale:new h.aH(p,t.u_extrude_scale),u_intensity:new h.aH(p,t.u_intensity),u_matrix:new h.aI(p,t.u_matrix)}),heatmapTexture:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_world:new h.aL(p,t.u_world),u_image:new h.aG(p,t.u_image),u_color_ramp:new h.aG(p,t.u_color_ramp),u_opacity:new h.aH(p,t.u_opacity)}),hillshade:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_image:new h.aG(p,t.u_image),u_latrange:new h.aL(p,t.u_latrange),u_light:new h.aL(p,t.u_light),u_shadow:new h.aM(p,t.u_shadow),u_highlight:new h.aM(p,t.u_highlight),u_accent:new h.aM(p,t.u_accent)}),hillshadePrepare:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_image:new h.aG(p,t.u_image),u_dimension:new h.aL(p,t.u_dimension),u_zoom:new h.aH(p,t.u_zoom),u_unpack:new h.aJ(p,t.u_unpack)}),line:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_ratio:new h.aH(p,t.u_ratio),u_device_pixel_ratio:new h.aH(p,t.u_device_pixel_ratio),u_units_to_pixels:new h.aL(p,t.u_units_to_pixels)}),lineGradient:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_ratio:new h.aH(p,t.u_ratio),u_device_pixel_ratio:new h.aH(p,t.u_device_pixel_ratio),u_units_to_pixels:new h.aL(p,t.u_units_to_pixels),u_image:new h.aG(p,t.u_image),u_image_height:new h.aH(p,t.u_image_height)}),linePattern:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_texsize:new h.aL(p,t.u_texsize),u_ratio:new h.aH(p,t.u_ratio),u_device_pixel_ratio:new h.aH(p,t.u_device_pixel_ratio),u_image:new h.aG(p,t.u_image),u_units_to_pixels:new h.aL(p,t.u_units_to_pixels),u_scale:new h.aK(p,t.u_scale),u_fade:new h.aH(p,t.u_fade)}),lineSDF:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_ratio:new h.aH(p,t.u_ratio),u_device_pixel_ratio:new h.aH(p,t.u_device_pixel_ratio),u_units_to_pixels:new h.aL(p,t.u_units_to_pixels),u_patternscale_a:new h.aL(p,t.u_patternscale_a),u_patternscale_b:new h.aL(p,t.u_patternscale_b),u_sdfgamma:new h.aH(p,t.u_sdfgamma),u_image:new h.aG(p,t.u_image),u_tex_y_a:new h.aH(p,t.u_tex_y_a),u_tex_y_b:new h.aH(p,t.u_tex_y_b),u_mix:new h.aH(p,t.u_mix)}),raster:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_tl_parent:new h.aL(p,t.u_tl_parent),u_scale_parent:new h.aH(p,t.u_scale_parent),u_buffer_scale:new h.aH(p,t.u_buffer_scale),u_fade_t:new h.aH(p,t.u_fade_t),u_opacity:new h.aH(p,t.u_opacity),u_image0:new h.aG(p,t.u_image0),u_image1:new h.aG(p,t.u_image1),u_brightness_low:new h.aH(p,t.u_brightness_low),u_brightness_high:new h.aH(p,t.u_brightness_high),u_saturation_factor:new h.aH(p,t.u_saturation_factor),u_contrast_factor:new h.aH(p,t.u_contrast_factor),u_spin_weights:new h.aK(p,t.u_spin_weights)}),symbolIcon:(p,t)=>({u_is_size_zoom_constant:new h.aG(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new h.aG(p,t.u_is_size_feature_constant),u_size_t:new h.aH(p,t.u_size_t),u_size:new h.aH(p,t.u_size),u_camera_to_center_distance:new h.aH(p,t.u_camera_to_center_distance),u_pitch:new h.aH(p,t.u_pitch),u_rotate_symbol:new h.aG(p,t.u_rotate_symbol),u_aspect_ratio:new h.aH(p,t.u_aspect_ratio),u_fade_change:new h.aH(p,t.u_fade_change),u_matrix:new h.aI(p,t.u_matrix),u_label_plane_matrix:new h.aI(p,t.u_label_plane_matrix),u_coord_matrix:new h.aI(p,t.u_coord_matrix),u_is_text:new h.aG(p,t.u_is_text),u_pitch_with_map:new h.aG(p,t.u_pitch_with_map),u_texsize:new h.aL(p,t.u_texsize),u_texture:new h.aG(p,t.u_texture)}),symbolSDF:(p,t)=>({u_is_size_zoom_constant:new h.aG(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new h.aG(p,t.u_is_size_feature_constant),u_size_t:new h.aH(p,t.u_size_t),u_size:new h.aH(p,t.u_size),u_camera_to_center_distance:new h.aH(p,t.u_camera_to_center_distance),u_pitch:new h.aH(p,t.u_pitch),u_rotate_symbol:new h.aG(p,t.u_rotate_symbol),u_aspect_ratio:new h.aH(p,t.u_aspect_ratio),u_fade_change:new h.aH(p,t.u_fade_change),u_matrix:new h.aI(p,t.u_matrix),u_label_plane_matrix:new h.aI(p,t.u_label_plane_matrix),u_coord_matrix:new h.aI(p,t.u_coord_matrix),u_is_text:new h.aG(p,t.u_is_text),u_pitch_with_map:new h.aG(p,t.u_pitch_with_map),u_texsize:new h.aL(p,t.u_texsize),u_texture:new h.aG(p,t.u_texture),u_gamma_scale:new h.aH(p,t.u_gamma_scale),u_device_pixel_ratio:new h.aH(p,t.u_device_pixel_ratio),u_is_halo:new h.aG(p,t.u_is_halo)}),symbolTextAndIcon:(p,t)=>({u_is_size_zoom_constant:new h.aG(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new h.aG(p,t.u_is_size_feature_constant),u_size_t:new h.aH(p,t.u_size_t),u_size:new h.aH(p,t.u_size),u_camera_to_center_distance:new h.aH(p,t.u_camera_to_center_distance),u_pitch:new h.aH(p,t.u_pitch),u_rotate_symbol:new h.aG(p,t.u_rotate_symbol),u_aspect_ratio:new h.aH(p,t.u_aspect_ratio),u_fade_change:new h.aH(p,t.u_fade_change),u_matrix:new h.aI(p,t.u_matrix),u_label_plane_matrix:new h.aI(p,t.u_label_plane_matrix),u_coord_matrix:new h.aI(p,t.u_coord_matrix),u_is_text:new h.aG(p,t.u_is_text),u_pitch_with_map:new h.aG(p,t.u_pitch_with_map),u_texsize:new h.aL(p,t.u_texsize),u_texsize_icon:new h.aL(p,t.u_texsize_icon),u_texture:new h.aG(p,t.u_texture),u_texture_icon:new h.aG(p,t.u_texture_icon),u_gamma_scale:new h.aH(p,t.u_gamma_scale),u_device_pixel_ratio:new h.aH(p,t.u_device_pixel_ratio),u_is_halo:new h.aG(p,t.u_is_halo)}),background:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_opacity:new h.aH(p,t.u_opacity),u_color:new h.aM(p,t.u_color)}),backgroundPattern:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_opacity:new h.aH(p,t.u_opacity),u_image:new h.aG(p,t.u_image),u_pattern_tl_a:new h.aL(p,t.u_pattern_tl_a),u_pattern_br_a:new h.aL(p,t.u_pattern_br_a),u_pattern_tl_b:new h.aL(p,t.u_pattern_tl_b),u_pattern_br_b:new h.aL(p,t.u_pattern_br_b),u_texsize:new h.aL(p,t.u_texsize),u_mix:new h.aH(p,t.u_mix),u_pattern_size_a:new h.aL(p,t.u_pattern_size_a),u_pattern_size_b:new h.aL(p,t.u_pattern_size_b),u_scale_a:new h.aH(p,t.u_scale_a),u_scale_b:new h.aH(p,t.u_scale_b),u_pixel_coord_upper:new h.aL(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.aL(p,t.u_pixel_coord_lower),u_tile_units_to_pixels:new h.aH(p,t.u_tile_units_to_pixels)}),terrain:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_texture:new h.aG(p,t.u_texture),u_ele_delta:new h.aH(p,t.u_ele_delta)}),terrainDepth:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_ele_delta:new h.aH(p,t.u_ele_delta)}),terrainCoords:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_texture:new h.aG(p,t.u_texture),u_terrain_coords_id:new h.aH(p,t.u_terrain_coords_id),u_ele_delta:new h.aH(p,t.u_ele_delta)})};class Kh{constructor(t,s,l){this.context=t;const c=t.gl;this.buffer=c.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const us={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class na{constructor(t,s,l,c){this.length=s.length,this.attributes=l,this.itemSize=s.bytesPerElement,this.dynamicDraw=c,this.context=t;const f=t.gl;this.buffer=f.createBuffer(),t.bindVertexBuffer.set(this.buffer),f.bufferData(f.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let l=0;l<this.attributes.length;l++){const c=s.attributes[this.attributes[l].name];c!==void 0&&t.enableVertexAttribArray(c)}}setVertexAttribPointers(t,s,l){for(let c=0;c<this.attributes.length;c++){const f=this.attributes[c],b=s.attributes[f.name];b!==void 0&&t.vertexAttribPointer(b,f.components,t[us[f.type]],!1,this.itemSize,f.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Tr=new WeakMap;function _r(p){var t;if(Tr.has(p))return Tr.get(p);{const s=(t=p.getParameter(p.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Tr.set(p,s),s}}class ii{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class sa extends ii{getDefault(){return h.aO.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class oa extends ii{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class ul extends ii{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class hl extends ii{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class aa extends ii{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class dl extends ii{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class pl extends ii{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class la extends ii{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Wc extends ii{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class Kc extends ii{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Ds extends ii{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class Xh extends ii{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Yh extends ii{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class Jh extends ii{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Qh extends ii{getDefault(){return h.aO.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ed extends ii{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class td extends ii{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class fl extends ii{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class ca extends ii{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class ml extends ii{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class gl extends ii{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class zs extends ii{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Xc extends ii{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Yc extends ii{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class _l extends ii{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class hs extends ii{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Jc extends ii{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Rs extends ii{getDefault(){return null}set(t){var s;if(t===this.current&&!this.dirty)return;const l=this.gl;_r(l)?l.bindVertexArray(t):(s=l.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Ls extends ii{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Qc extends ii{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class yl extends ii{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Jt extends ii{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class ua extends Jt{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class id extends Jt{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class eu extends Jt{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class xo{constructor(t,s,l,c,f){this.context=t,this.width=s,this.height=l;const b=t.gl,w=this.framebuffer=b.createFramebuffer();if(this.colorAttachment=new ua(t,w),c)this.depthAttachment=f?new eu(t,w):new id(t,w);else if(f)throw new Error("Stencil cannot be set without depth");if(b.checkFramebufferStatus(b.FRAMEBUFFER)!==b.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,s=this.colorAttachment.get();if(s&&t.deleteTexture(s),this.depthAttachment){const l=this.depthAttachment.get();l&&t.deleteRenderbuffer(l)}t.deleteFramebuffer(this.framebuffer)}}class $i{constructor(t,s,l){this.blendFunction=t,this.blendColor=s,this.mask=l}}$i.Replace=[1,0],$i.disabled=new $i($i.Replace,h.aO.transparent,[!1,!1,!1,!1]),$i.unblended=new $i($i.Replace,h.aO.transparent,[!0,!0,!0,!0]),$i.alphaBlended=new $i([1,771],h.aO.transparent,[!0,!0,!0,!0]);class rd{constructor(t){var s,l;if(this.gl=t,this.clearColor=new sa(this),this.clearDepth=new oa(this),this.clearStencil=new ul(this),this.colorMask=new hl(this),this.depthMask=new aa(this),this.stencilMask=new dl(this),this.stencilFunc=new pl(this),this.stencilOp=new la(this),this.stencilTest=new Wc(this),this.depthRange=new Kc(this),this.depthTest=new Ds(this),this.depthFunc=new Xh(this),this.blend=new Yh(this),this.blendFunc=new Jh(this),this.blendColor=new Qh(this),this.blendEquation=new ed(this),this.cullFace=new td(this),this.cullFaceSide=new fl(this),this.frontFace=new ca(this),this.program=new ml(this),this.activeTexture=new gl(this),this.viewport=new zs(this),this.bindFramebuffer=new Xc(this),this.bindRenderbuffer=new Yc(this),this.bindTexture=new _l(this),this.bindVertexBuffer=new hs(this),this.bindElementBuffer=new Jc(this),this.bindVertexArray=new Rs(this),this.pixelStoreUnpack=new Ls(this),this.pixelStoreUnpackPremultiplyAlpha=new Qc(this),this.pixelStoreUnpackFlipY=new yl(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),_r(t)){this.HALF_FLOAT=t.HALF_FLOAT;const c=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=t.RGBA16F)!==null&&s!==void 0?s:c==null?void 0:c.RGBA16F_EXT,this.RGB16F=(l=t.RGB16F)!==null&&l!==void 0?l:c==null?void 0:c.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const c=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=c==null?void 0:c.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s){return new Kh(this,t,s)}createVertexBuffer(t,s,l){return new na(this,t,s,l)}createRenderbuffer(t,s,l){const c=this.gl,f=c.createRenderbuffer();return this.bindRenderbuffer.set(f),c.renderbufferStorage(c.RENDERBUFFER,t,s,l),this.bindRenderbuffer.set(null),f}createFramebuffer(t,s,l,c){return new xo(this,t,s,l,c)}clear({color:t,depth:s,stencil:l}){const c=this.gl;let f=0;t&&(f|=c.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(f|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),l!==void 0&&(f|=c.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),c.clear(f)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){h.aD(t.blendFunction,$i.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return _r(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var s;return _r(this.gl)?this.gl.deleteVertexArray(t):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class Wt{constructor(t,s,l){this.func=t,this.mask=s,this.range=l}}Wt.ReadOnly=!1,Wt.ReadWrite=!0,Wt.disabled=new Wt(519,Wt.ReadOnly,[0,1]);const xl=7680;class xi{constructor(t,s,l,c,f,b){this.test=t,this.ref=s,this.mask=l,this.fail=c,this.depthFail=f,this.pass=b}}xi.disabled=new xi({func:519,mask:0},0,0,xl,xl,xl);class gi{constructor(t,s,l){this.enable=t,this.mode=s,this.frontFace=l}}let ds;function ha(p,t,s,l,c,f,b){const w=p.context,A=w.gl,E=p.useProgram("collisionBox"),M=[];let k=0,O=0;for(let Q=0;Q<l.length;Q++){const ce=l[Q],ge=t.getTile(ce),xe=ge.getBucket(s);if(!xe)continue;let be=ce.posMatrix;c[0]===0&&c[1]===0||(be=p.translatePosMatrix(ce.posMatrix,ge,c,f));const ze=b?xe.textCollisionBox:xe.iconCollisionBox,ke=xe.collisionCircleArray;if(ke.length>0){const Ne=h.F(),je=be;h.aP(Ne,xe.placementInvProjMatrix,p.transform.glCoordMatrix),h.aP(Ne,Ne,xe.placementViewportMatrix),M.push({circleArray:ke,circleOffset:O,transform:je,invTransform:Ne,coord:ce}),k+=ke.length/4,O=k}ze&&E.draw(w,A.LINES,Wt.disabled,xi.disabled,p.colorModeForRenderPass(),gi.disabled,Uc(be,p.transform,ge),p.style.map.terrain&&p.style.map.terrain.getTerrainData(ce),s.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,null,p.transform.zoom,null,null,ze.collisionVertexBuffer)}if(!b||!M.length)return;const W=p.useProgram("collisionCircle"),Z=new h.aQ;Z.resize(4*k),Z._trim();let Y=0;for(const Q of M)for(let ce=0;ce<Q.circleArray.length/4;ce++){const ge=4*ce,xe=Q.circleArray[ge+0],be=Q.circleArray[ge+1],ze=Q.circleArray[ge+2],ke=Q.circleArray[ge+3];Z.emplace(Y++,xe,be,ze,ke,0),Z.emplace(Y++,xe,be,ze,ke,1),Z.emplace(Y++,xe,be,ze,ke,2),Z.emplace(Y++,xe,be,ze,ke,3)}(!ds||ds.length<2*k)&&(ds=function(Q){const ce=2*Q,ge=new h.aS;ge.resize(ce),ge._trim();for(let xe=0;xe<ce;xe++){const be=6*xe;ge.uint16[be+0]=4*xe+0,ge.uint16[be+1]=4*xe+1,ge.uint16[be+2]=4*xe+2,ge.uint16[be+3]=4*xe+2,ge.uint16[be+4]=4*xe+3,ge.uint16[be+5]=4*xe+0}return ge}(k));const q=w.createIndexBuffer(ds,!0),se=w.createVertexBuffer(Z,h.aR.members,!0);for(const Q of M){const ce={u_matrix:Q.transform,u_inv_matrix:Q.invTransform,u_camera_to_center_distance:(me=p.transform).cameraToCenterDistance,u_viewport_size:[me.width,me.height]};W.draw(w,A.TRIANGLES,Wt.disabled,xi.disabled,p.colorModeForRenderPass(),gi.disabled,ce,p.style.map.terrain&&p.style.map.terrain.getTerrainData(Q.coord),s.id,se,q,h.$.simpleSegment(0,2*Q.circleOffset,Q.circleArray.length,Q.circleArray.length/2),null,p.transform.zoom,null,null,null)}var me;se.destroy(),q.destroy()}gi.disabled=new gi(!1,1029,2305),gi.backCCW=new gi(!0,1029,2305);const vl=h.an(new Float32Array(16));function tu(p,t,s,l,c,f){const{horizontalAlign:b,verticalAlign:w}=h.at(p);return new h.P((-(b-.5)*t/c+l[0])*f,(-(w-.5)*s/c+l[1])*f)}function da(p,t,s,l,c,f,b,w,A,E,M){const k=p.text.placedSymbolArray,O=p.text.dynamicLayoutVertexArray,W=p.icon.dynamicLayoutVertexArray,Z={};O.clear();for(let Y=0;Y<k.length;Y++){const q=k.get(Y),se=q.hidden||!q.crossTileID||p.allowVerticalPlacement&&!q.placedOrientation?null:l[q.crossTileID];if(se){const me=new h.P(q.anchorX,q.anchorY),Q=Yi(me,s?b:f,M),ce=X(c.cameraToCenterDistance,Q.signedDistanceFromCamera);let ge=h.ai(p.textSizeData,A,q)*ce/h.ao;s&&(ge*=p.tilePixelRatio/w);const{width:xe,height:be,anchor:ze,textOffset:ke,textBoxScale:Ne}=se,je=tu(ze,xe,be,ke,Ne,ge),Rt=s?Yi(me.add(je),f,M).point:Q.point.add(t?je.rotate(-c.angle):je),Ge=p.allowVerticalPlacement&&q.placedOrientation===h.ah.vertical?Math.PI/2:0;for(let wt=0;wt<q.numGlyphs;wt++)h.aj(O,Rt,Ge);E&&q.associatedIconIndex>=0&&(Z[q.associatedIconIndex]={shiftedAnchor:Rt,angle:Ge})}else Te(q.numGlyphs,O)}if(E){W.clear();const Y=p.icon.placedSymbolArray;for(let q=0;q<Y.length;q++){const se=Y.get(q);if(se.hidden)Te(se.numGlyphs,W);else{const me=Z[q];if(me)for(let Q=0;Q<se.numGlyphs;Q++)h.aj(W,me.shiftedAnchor,me.angle);else Te(se.numGlyphs,W)}}p.icon.dynamicLayoutVertexBuffer.updateData(W)}p.text.dynamicLayoutVertexBuffer.updateData(O)}function pa(p,t,s){return s.iconsInText&&t?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function fa(p,t,s,l,c,f,b,w,A,E,M,k){const O=p.context,W=O.gl,Z=p.transform,Y=w==="map",q=A==="map",se=w!=="viewport"&&s.layout.get("symbol-placement")!=="point",me=Y&&!q&&!se,Q=!s.layout.get("symbol-sort-key").isConstant();let ce=!1;const ge=p.depthModeForSublayer(0,Wt.ReadOnly),xe=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),be=[];for(const ze of l){const ke=t.getTile(ze),Ne=ke.getBucket(s);if(!Ne)continue;const je=c?Ne.text:Ne.icon;if(!je||!je.segments.get().length||!je.hasVisibleVertices)continue;const Rt=je.programConfigurations.get(s.id),Ge=c||Ne.sdfIcons,wt=c?Ne.textSizeData:Ne.iconSizeData,Lt=q||Z.pitch!==0,Kt=p.useProgram(pa(Ge,c,Ne),Rt),At=h.ag(wt,Z.zoom),Ot=p.style.map.terrain&&p.style.map.terrain.getTerrainData(ze);let $t,Li,hi,Hr,Qi=[0,0],Ci=null;if(c)Li=ke.glyphAtlasTexture,hi=W.LINEAR,$t=ke.glyphAtlasTexture.size,Ne.iconsInText&&(Qi=ke.imageAtlasTexture.size,Ci=ke.imageAtlasTexture,Hr=Lt||p.options.rotating||p.options.zooming||wt.kind==="composite"||wt.kind==="camera"?W.LINEAR:W.NEAREST);else{const Zi=s.layout.get("icon-size").constantOr(0)!==1||Ne.iconsNeedLinear;Li=ke.imageAtlasTexture,hi=Ge||p.options.rotating||p.options.zooming||Zi||Lt?W.LINEAR:W.NEAREST,$t=ke.imageAtlasTexture.size}const er=Et(ke,1,p.transform.zoom),Zr=Dt(ze.posMatrix,q,Y,p.transform,er),In=ls(ze.posMatrix,q,Y,p.transform,er),Kn=xe&&Ne.hasTextData(),Do=s.layout.get("icon-text-fit")!=="none"&&Kn&&Ne.hasIconData();if(se){const Zi=p.style.map.terrain?(sn,Wi)=>p.style.map.terrain.getElevation(ze,sn,Wi):null,ki=s.layout.get("text-rotation-alignment")==="map";R(Ne,ze.posMatrix,p,c,Zr,In,q,E,ki,Zi)}const Xn=p.translatePosMatrix(ze.posMatrix,ke,f,b),En=se||c&&xe||Do?vl:Zr,Hi=p.translatePosMatrix(In,ke,f,b,!0),Mi=Ge&&s.paint.get(c?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ii;Ii=Ge?Ne.iconsInText?yo(wt.kind,At,me,q,p,Xn,En,Hi,$t,Qi):_o(wt.kind,At,me,q,p,Xn,En,Hi,c,$t,!0):go(wt.kind,At,me,q,p,Xn,En,Hi,c,$t);const nn={program:Kt,buffers:je,uniformValues:Ii,atlasTexture:Li,atlasTextureIcon:Ci,atlasInterpolation:hi,atlasInterpolationIcon:Hr,isSDF:Ge,hasHalo:Mi};if(Q&&Ne.canOverlap){ce=!0;const Zi=je.segments.get();for(const ki of Zi)be.push({segments:new h.$([ki]),sortKey:ki.sortKey,state:nn,terrainData:Ot})}else be.push({segments:je.segments,sortKey:0,state:nn,terrainData:Ot})}ce&&be.sort((ze,ke)=>ze.sortKey-ke.sortKey);for(const ze of be){const ke=ze.state;if(O.activeTexture.set(W.TEXTURE0),ke.atlasTexture.bind(ke.atlasInterpolation,W.CLAMP_TO_EDGE),ke.atlasTextureIcon&&(O.activeTexture.set(W.TEXTURE1),ke.atlasTextureIcon&&ke.atlasTextureIcon.bind(ke.atlasInterpolationIcon,W.CLAMP_TO_EDGE)),ke.isSDF){const Ne=ke.uniformValues;ke.hasHalo&&(Ne.u_is_halo=1,iu(ke.buffers,ze.segments,s,p,ke.program,ge,M,k,Ne,ze.terrainData)),Ne.u_is_halo=0}iu(ke.buffers,ze.segments,s,p,ke.program,ge,M,k,ke.uniformValues,ze.terrainData)}}function iu(p,t,s,l,c,f,b,w,A,E){const M=l.context;c.draw(M,M.gl.TRIANGLES,f,b,w,gi.disabled,A,E,s.id,p.layoutVertexBuffer,p.indexBuffer,t,s.paint,l.transform.zoom,p.programConfigurations.get(s.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function ma(p,t,s,l,c){if(!s||!l||!l.imageAtlas)return;const f=l.imageAtlas.patternPositions;let b=f[s.to.toString()],w=f[s.from.toString()];if(!b&&w&&(b=w),!w&&b&&(w=b),!b||!w){const A=c.getPaintProperty(t);b=f[A],w=f[A]}b&&w&&p.setConstantPatternPositions(b,w)}function ru(p,t,s,l,c,f,b){const w=p.context.gl,A="fill-pattern",E=s.paint.get(A),M=E&&E.constantOr(1),k=s.getCrossfadeParameters();let O,W,Z,Y,q;b?(W=M&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=w.LINES):(W=M?"fillPattern":"fill",O=w.TRIANGLES);const se=E.constantOr(null);for(const me of l){const Q=t.getTile(me);if(M&&!Q.patternsLoaded())continue;const ce=Q.getBucket(s);if(!ce)continue;const ge=ce.programConfigurations.get(s.id),xe=p.useProgram(W,ge),be=p.style.map.terrain&&p.style.map.terrain.getTerrainData(me);M&&(p.context.activeTexture.set(w.TEXTURE0),Q.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),ge.updatePaintBuffers(k)),ma(ge,A,se,Q,s);const ze=be?me:null,ke=p.translatePosMatrix(ze?ze.posMatrix:me.posMatrix,Q,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(b){Y=ce.indexBuffer2,q=ce.segments2;const Ne=[w.drawingBufferWidth,w.drawingBufferHeight];Z=W==="fillOutlinePattern"&&M?$c(ke,p,k,Q,Ne):Gh(ke,Ne)}else Y=ce.indexBuffer,q=ce.segments,Z=M?Qo(ke,p,k,Q):Vc(ke);xe.draw(p.context,O,c,p.stencilModeForClipping(me),f,gi.disabled,Z,be,s.id,ce.layoutVertexBuffer,Y,q,s.paint,p.transform.zoom,ge)}}function ga(p,t,s,l,c,f,b){const w=p.context,A=w.gl,E="fill-extrusion-pattern",M=s.paint.get(E),k=M.constantOr(1),O=s.getCrossfadeParameters(),W=s.paint.get("fill-extrusion-opacity"),Z=M.constantOr(null);for(const Y of l){const q=t.getTile(Y),se=q.getBucket(s);if(!se)continue;const me=p.style.map.terrain&&p.style.map.terrain.getTerrainData(Y),Q=se.programConfigurations.get(s.id),ce=p.useProgram(k?"fillExtrusionPattern":"fillExtrusion",Q);k&&(p.context.activeTexture.set(A.TEXTURE0),q.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),Q.updatePaintBuffers(O)),ma(Q,E,Z,q,s);const ge=p.translatePosMatrix(Y.posMatrix,q,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),xe=s.paint.get("fill-extrusion-vertical-gradient"),be=k?qh(ge,p,xe,W,Y,O,q):po(ge,p,xe,W);ce.draw(w,w.gl.TRIANGLES,c,f,b,gi.backCCW,be,me,s.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,s.paint,p.transform.zoom,Q,p.style.map.terrain&&se.centroidVertexBuffer)}}function _a(p,t,s,l,c,f,b){const w=p.context,A=w.gl,E=s.fbo;if(!E)return;const M=p.useProgram("hillshade"),k=p.style.map.terrain&&p.style.map.terrain.getTerrainData(t);w.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,E.colorAttachment.get()),M.draw(w,A.TRIANGLES,c,f,b,gi.disabled,((O,W,Z,Y)=>{const q=Z.paint.get("hillshade-shadow-color"),se=Z.paint.get("hillshade-highlight-color"),me=Z.paint.get("hillshade-accent-color");let Q=Z.paint.get("hillshade-illumination-direction")*(Math.PI/180);Z.paint.get("hillshade-illumination-anchor")==="viewport"&&(Q-=O.transform.angle);const ce=!O.options.moving;return{u_matrix:Y?Y.posMatrix:O.transform.calculatePosMatrix(W.tileID.toUnwrapped(),ce),u_image:0,u_latrange:Gc(0,W.tileID),u_light:[Z.paint.get("hillshade-exaggeration"),Q],u_shadow:q,u_highlight:se,u_accent:me}})(p,s,l,k?t:null),k,l.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}function bl(p,t,s,l,c,f){const b=p.context,w=b.gl,A=t.dem;if(A&&A.data){const E=A.dim,M=A.stride,k=A.getPixels();if(b.activeTexture.set(w.TEXTURE1),b.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||p.getTileTexture(M),t.demTexture){const W=t.demTexture;W.update(k,{premultiply:!1}),W.bind(w.NEAREST,w.CLAMP_TO_EDGE)}else t.demTexture=new vt(b,k,w.RGBA,{premultiply:!1}),t.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);b.activeTexture.set(w.TEXTURE0);let O=t.fbo;if(!O){const W=new vt(b,{width:E,height:E,data:null},w.RGBA);W.bind(w.LINEAR,w.CLAMP_TO_EDGE),O=t.fbo=b.createFramebuffer(E,E,!0,!1),O.colorAttachment.set(W.texture)}b.bindFramebuffer.set(O.framebuffer),b.viewport.set([0,0,E,E]),p.useProgram("hillshadePrepare").draw(b,w.TRIANGLES,l,c,f,gi.disabled,((W,Z)=>{const Y=Z.stride,q=h.F();return h.aN(q,0,h.W,-h.W,0,0,1),h.H(q,q,[0,-h.W,0]),{u_matrix:q,u_image:1,u_dimension:[Y,Y],u_zoom:W.overscaledZ,u_unpack:Z.getUnpackVector()}})(t.tileID,A),null,s.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function nu(p,t,s,l,c,f){const b=l.paint.get("raster-fade-duration");if(!f&&b>0){const w=N.now(),A=(w-p.timeAdded)/b,E=t?(w-t.timeAdded)/b:-1,M=s.getSource(),k=c.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),O=!t||Math.abs(t.tileID.overscaledZ-k)>Math.abs(p.tileID.overscaledZ-k),W=O&&p.refreshedUponExpiration?1:h.ac(O?A:1-E,0,1);return p.refreshedUponExpiration&&A>=1&&(p.refreshedUponExpiration=!1),t?{opacity:1,mix:1-W}:{opacity:W,mix:0}}return{opacity:1,mix:0}}const su=new h.aO(1,0,0,1),ya=new h.aO(0,1,0,1),wl=new h.aO(0,0,1,1),nd=new h.aO(1,0,1,1),ou=new h.aO(0,1,1,1);function zi(p,t,s,l){Ar(p,0,t+s/2,p.transform.width,s,l)}function Gn(p,t,s,l){Ar(p,t-s/2,0,s,p.transform.height,l)}function Ar(p,t,s,l,c,f){const b=p.context,w=b.gl;w.enable(w.SCISSOR_TEST),w.scissor(t*p.pixelRatio,s*p.pixelRatio,l*p.pixelRatio,c*p.pixelRatio),b.clear({color:f}),w.disable(w.SCISSOR_TEST)}function Sl(p,t,s){const l=p.context,c=l.gl,f=s.posMatrix,b=p.useProgram("debug"),w=Wt.disabled,A=xi.disabled,E=p.colorModeForRenderPass(),M="$debug",k=p.style.map.terrain&&p.style.map.terrain.getTerrainData(s);l.activeTexture.set(c.TEXTURE0);const O=t.getTileByID(s.key).latestRawTileData,W=Math.floor((O&&O.byteLength||0)/1024),Z=t.getTile(s).tileSize,Y=512/Math.min(Z,512)*(s.overscaledZ/p.transform.zoom)*.5;let q=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(q+=` => ${s.overscaledZ}`),function(se,me){se.initDebugOverlayCanvas();const Q=se.debugOverlayCanvas,ce=se.context.gl,ge=se.debugOverlayCanvas.getContext("2d");ge.clearRect(0,0,Q.width,Q.height),ge.shadowColor="white",ge.shadowBlur=2,ge.lineWidth=1.5,ge.strokeStyle="white",ge.textBaseline="top",ge.font="bold 36px Open Sans, sans-serif",ge.fillText(me,5,5),ge.strokeText(me,5,5),se.debugOverlayTexture.update(Q),se.debugOverlayTexture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE)}(p,`${q} ${W}kB`),b.draw(l,c.TRIANGLES,w,A,$i.alphaBlended,gi.disabled,jc(f,h.aO.transparent,Y),null,M,p.debugBuffer,p.quadTriangleIndexBuffer,p.debugSegments),b.draw(l,c.LINE_STRIP,w,A,E,gi.disabled,jc(f,h.aO.red),k,M,p.debugBuffer,p.tileBorderIndexBuffer,p.debugSegments)}function xa(p,t,s){const l=p.context,c=l.gl,f=p.colorModeForRenderPass(),b=new Wt(c.LEQUAL,Wt.ReadWrite,p.depthRangeFor3D),w=p.useProgram("terrain"),A=t.getTerrainMesh();l.bindFramebuffer.set(null),l.viewport.set([0,0,p.width,p.height]);for(const E of s){const M=p.renderToTexture.getTexture(E),k=t.getTerrainData(E.tileID);l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,M.texture);const O={u_matrix:p.transform.calculatePosMatrix(E.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(p.transform.zoom)};w.draw(l,c.TRIANGLES,b,xi.disabled,f,gi.backCCW,O,k,"terrain",A.vertexBuffer,A.indexBuffer,A.segments)}}class au{constructor(t,s){this.context=new rd(t),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:h.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Xi.maxUnderzooming+Xi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new jn}resize(t,s,l){if(this.width=Math.floor(t*l),this.height=Math.floor(s*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style._order)this.style._layers[c].resize()}setup(){const t=this.context,s=new h.aV;s.emplaceBack(0,0),s.emplaceBack(h.W,0),s.emplaceBack(0,h.W),s.emplaceBack(h.W,h.W),this.tileExtentBuffer=t.createVertexBuffer(s,Xo.members),this.tileExtentSegments=h.$.simpleSegment(0,0,4,2);const l=new h.aV;l.emplaceBack(0,0),l.emplaceBack(h.W,0),l.emplaceBack(0,h.W),l.emplaceBack(h.W,h.W),this.debugBuffer=t.createVertexBuffer(l,Xo.members),this.debugSegments=h.$.simpleSegment(0,0,4,5);const c=new h.Z;c.emplaceBack(0,0,0,0),c.emplaceBack(h.W,0,h.W,0),c.emplaceBack(0,h.W,0,h.W),c.emplaceBack(h.W,h.W,h.W,h.W),this.rasterBoundsBuffer=t.createVertexBuffer(c,Ae.members),this.rasterBoundsSegments=h.$.simpleSegment(0,0,4,2);const f=new h.aV;f.emplaceBack(0,0),f.emplaceBack(1,0),f.emplaceBack(0,1),f.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(f,Xo.members),this.viewportSegments=h.$.simpleSegment(0,0,4,2);const b=new h.aW;b.emplaceBack(0),b.emplaceBack(1),b.emplaceBack(3),b.emplaceBack(2),b.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(b);const w=new h.aX;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(w);const A=this.context.gl;this.stencilClearMode=new xi({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO)}clearStencil(){const t=this.context,s=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=h.F();h.aN(l,0,this.width,this.height,0,0,1),h.J(l,l,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,s.TRIANGLES,Wt.disabled,this.stencilClearMode,$i.disabled,gi.disabled,ea(l),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,s){if(this.currentStencilSource===t.source||!t.isTileClipped()||!s||!s.length)return;this.currentStencilSource=t.source;const l=this.context,c=l.gl;this.nextStencilID+s.length>256&&this.clearStencil(),l.setColorMode($i.disabled),l.setDepthMode(Wt.disabled);const f=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const b of s){const w=this._tileClippingMaskIDs[b.key]=this.nextStencilID++,A=this.style.map.terrain&&this.style.map.terrain.getTerrainData(b);f.draw(l,c.TRIANGLES,Wt.disabled,new xi({func:c.ALWAYS,mask:0},w,255,c.KEEP,c.KEEP,c.REPLACE),$i.disabled,gi.disabled,ea(b.posMatrix),A,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new xi({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){const s=this.context.gl;return new xi({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){const s=this.context.gl,l=t.sort((b,w)=>w.overscaledZ-b.overscaledZ),c=l[l.length-1].overscaledZ,f=l[0].overscaledZ-c+1;if(f>1){this.currentStencilSource=void 0,this.nextStencilID+f>256&&this.clearStencil();const b={};for(let w=0;w<f;w++)b[w+c]=new xi({func:s.GEQUAL,mask:255},w+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=f,[b,l]}return[{[c]:xi.disabled},l]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new $i([t.CONSTANT_COLOR,t.ONE],new h.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?$i.unblended:$i.alphaBlended}depthModeForSublayer(t,s,l){if(!this.opaquePassEnabledForLayer())return Wt.disabled;const c=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Wt(l||this.context.gl.LEQUAL,s,[c,c])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,s){this.style=t,this.options=s,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(N.now()),this.imageManager.beginFrame();const l=this.style._order,c=this.style.sourceCaches,f={},b={},w={};for(const A in c){const E=c[A];E.used&&E.prepare(this.context),f[A]=E.getVisibleCoordinates(),b[A]=f[A].slice().reverse(),w[A]=E.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let A=0;A<l.length;A++)if(this.style._layers[l[A]].is3D()){this.opaquePassCutoff=A;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const A of l){const E=this.style._layers[A];if(!E.hasOffscreenPass()||E.isHidden(this.transform.zoom))continue;const M=b[E.source];(E.type==="custom"||M.length)&&this.renderLayer(this,c[E.source],E,M)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?h.aO.black:h.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=l.length-1;this.currentLayer>=0;this.currentLayer--){const A=this.style._layers[l[this.currentLayer]],E=c[A.source],M=f[A.source];this._renderTileClippingMasks(A,M),this.renderLayer(this,E,A,M)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<l.length;this.currentLayer++){const A=this.style._layers[l[this.currentLayer]],E=c[A.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(A))continue;const M=(A.type==="symbol"?w:b)[A.source];this._renderTileClippingMasks(A,f[A.source]),this.renderLayer(this,E,A,M)}if(this.options.showTileBoundaries){const A=function(E,M){let k=null;const O=Object.values(E._layers).flatMap(q=>q.source&&!q.isHidden(M)?[E.sourceCaches[q.source]]:[]),W=O.filter(q=>q.getSource().type==="vector"),Z=O.filter(q=>q.getSource().type!=="vector"),Y=q=>{(!k||k.getSource().maxzoom<q.getSource().maxzoom)&&(k=q)};return W.forEach(q=>Y(q)),k||Z.forEach(q=>Y(q)),k}(this.style,this.transform.zoom);A&&function(E,M,k){for(let O=0;O<k.length;O++)Sl(E,M,k[O])}(this,A,A.getVisibleCoordinates())}this.options.showPadding&&function(A){const E=A.transform.padding;zi(A,A.transform.height-(E.top||0),3,su),zi(A,E.bottom||0,3,ya),Gn(A,E.left||0,3,wl),Gn(A,A.transform.width-(E.right||0),3,nd);const M=A.transform.centerPoint;(function(k,O,W,Z){Ar(k,O-1,W-10,2,20,Z),Ar(k,O-10,W-1,20,2,Z)})(A,M.x,A.transform.height-M.y,ou)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const s=this.terrainFacilitator.matrix,l=this.transform.projMatrix;let c=this.terrainFacilitator.dirty;c||(c=t?!h.aY(s,l):!h.aZ(s,l)),c||(c=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),c&&(h.a_(s,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(f,b){const w=f.context,A=w.gl,E=$i.unblended,M=new Wt(A.LEQUAL,Wt.ReadWrite,[0,1]),k=b.getTerrainMesh(),O=b.sourceCache.getRenderableTiles(),W=f.useProgram("terrainDepth");w.bindFramebuffer.set(b.getFramebuffer("depth").framebuffer),w.viewport.set([0,0,f.width/devicePixelRatio,f.height/devicePixelRatio]),w.clear({color:h.aO.transparent,depth:1});for(const Z of O){const Y=b.getTerrainData(Z.tileID),q={u_matrix:f.transform.calculatePosMatrix(Z.tileID.toUnwrapped()),u_ele_delta:b.getMeshFrameDelta(f.transform.zoom)};W.draw(w,A.TRIANGLES,M,xi.disabled,E,gi.backCCW,q,Y,"terrain",k.vertexBuffer,k.indexBuffer,k.segments)}w.bindFramebuffer.set(null),w.viewport.set([0,0,f.width,f.height])}(this,this.style.map.terrain),function(f,b){const w=f.context,A=w.gl,E=$i.unblended,M=new Wt(A.LEQUAL,Wt.ReadWrite,[0,1]),k=b.getTerrainMesh(),O=b.getCoordsTexture(),W=b.sourceCache.getRenderableTiles(),Z=f.useProgram("terrainCoords");w.bindFramebuffer.set(b.getFramebuffer("coords").framebuffer),w.viewport.set([0,0,f.width/devicePixelRatio,f.height/devicePixelRatio]),w.clear({color:h.aO.transparent,depth:1}),b.coordsIndex=[];for(const Y of W){const q=b.getTerrainData(Y.tileID);w.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,O.texture);const se={u_matrix:f.transform.calculatePosMatrix(Y.tileID.toUnwrapped()),u_terrain_coords_id:(255-b.coordsIndex.length)/255,u_texture:0,u_ele_delta:b.getMeshFrameDelta(f.transform.zoom)};Z.draw(w,A.TRIANGLES,M,xi.disabled,E,gi.backCCW,se,q,"terrain",k.vertexBuffer,k.indexBuffer,k.segments),b.coordsIndex.push(Y.tileID.key)}w.bindFramebuffer.set(null),w.viewport.set([0,0,f.width,f.height])}(this,this.style.map.terrain))}renderLayer(t,s,l,c){if(!l.isHidden(this.transform.zoom)&&(l.type==="background"||l.type==="custom"||(c||[]).length))switch(this.id=l.id,l.type){case"symbol":(function(f,b,w,A,E){if(f.renderPass!=="translucent")return;const M=xi.disabled,k=f.colorModeForRenderPass();(w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(O,W,Z,Y,q,se,me){const Q=W.transform,ce=q==="map",ge=se==="map";for(const xe of O){const be=Y.getTile(xe),ze=be.getBucket(Z);if(!ze||!ze.text||!ze.text.segments.get().length)continue;const ke=h.ag(ze.textSizeData,Q.zoom),Ne=Et(be,1,W.transform.zoom),je=Dt(xe.posMatrix,ge,ce,W.transform,Ne),Rt=Z.layout.get("icon-text-fit")!=="none"&&ze.hasIconData();if(ke){const Ge=Math.pow(2,Q.zoom-be.tileID.overscaledZ);da(ze,ce,ge,me,Q,je,xe.posMatrix,Ge,ke,Rt,W.style.map.terrain?(wt,Lt)=>W.style.map.terrain.getElevation(xe,wt,Lt):null)}}}(A,f,w,b,w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),E),w.paint.get("icon-opacity").constantOr(1)!==0&&fa(f,b,w,A,!1,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),w.layout.get("icon-rotation-alignment"),w.layout.get("icon-pitch-alignment"),w.layout.get("icon-keep-upright"),M,k),w.paint.get("text-opacity").constantOr(1)!==0&&fa(f,b,w,A,!0,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.layout.get("text-keep-upright"),M,k),b.map.showCollisionBoxes&&(ha(f,b,w,A,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),!0),ha(f,b,w,A,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),!1))})(t,s,l,c,this.style.placement.variableOffsets);break;case"circle":(function(f,b,w,A){if(f.renderPass!=="translucent")return;const E=w.paint.get("circle-opacity"),M=w.paint.get("circle-stroke-width"),k=w.paint.get("circle-stroke-opacity"),O=!w.layout.get("circle-sort-key").isConstant();if(E.constantOr(1)===0&&(M.constantOr(1)===0||k.constantOr(1)===0))return;const W=f.context,Z=W.gl,Y=f.depthModeForSublayer(0,Wt.ReadOnly),q=xi.disabled,se=f.colorModeForRenderPass(),me=[];for(let Q=0;Q<A.length;Q++){const ce=A[Q],ge=b.getTile(ce),xe=ge.getBucket(w);if(!xe)continue;const be=xe.programConfigurations.get(w.id),ze=f.useProgram("circle",be),ke=xe.layoutVertexBuffer,Ne=xe.indexBuffer,je=f.style.map.terrain&&f.style.map.terrain.getTerrainData(ce),Rt={programConfiguration:be,program:ze,layoutVertexBuffer:ke,indexBuffer:Ne,uniformValues:Hh(f,ce,ge,w),terrainData:je};if(O){const Ge=xe.segments.get();for(const wt of Ge)me.push({segments:new h.$([wt]),sortKey:wt.sortKey,state:Rt})}else me.push({segments:xe.segments,sortKey:0,state:Rt})}O&&me.sort((Q,ce)=>Q.sortKey-ce.sortKey);for(const Q of me){const{programConfiguration:ce,program:ge,layoutVertexBuffer:xe,indexBuffer:be,uniformValues:ze,terrainData:ke}=Q.state;ge.draw(W,Z.TRIANGLES,Y,q,se,gi.disabled,ze,ke,w.id,xe,be,Q.segments,w.paint,f.transform.zoom,ce)}})(t,s,l,c);break;case"heatmap":(function(f,b,w,A){if(w.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const E=f.context,M=E.gl,k=xi.disabled,O=new $i([M.ONE,M.ONE],h.aO.transparent,[!0,!0,!0,!0]);(function(W,Z,Y){const q=W.gl;W.activeTexture.set(q.TEXTURE1),W.viewport.set([0,0,Z.width/4,Z.height/4]);let se=Y.heatmapFbo;if(se)q.bindTexture(q.TEXTURE_2D,se.colorAttachment.get()),W.bindFramebuffer.set(se.framebuffer);else{const me=q.createTexture();q.bindTexture(q.TEXTURE_2D,me),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,q.LINEAR),se=Y.heatmapFbo=W.createFramebuffer(Z.width/4,Z.height/4,!1,!1),function(Q,ce,ge,xe){var be,ze;const ke=Q.gl,Ne=(be=Q.HALF_FLOAT)!==null&&be!==void 0?be:ke.UNSIGNED_BYTE,je=(ze=Q.RGBA16F)!==null&&ze!==void 0?ze:ke.RGBA;ke.texImage2D(ke.TEXTURE_2D,0,je,ce.width/4,ce.height/4,0,ke.RGBA,Ne,null),xe.colorAttachment.set(ge)}(W,Z,me,se)}})(E,f,w),E.clear({color:h.aO.transparent});for(let W=0;W<A.length;W++){const Z=A[W];if(b.hasRenderableParent(Z))continue;const Y=b.getTile(Z),q=Y.getBucket(w);if(!q)continue;const se=q.programConfigurations.get(w.id),me=f.useProgram("heatmap",se),{zoom:Q}=f.transform;me.draw(E,M.TRIANGLES,Wt.disabled,k,O,gi.disabled,qc(Z.posMatrix,Y,Q,w.paint.get("heatmap-intensity")),null,w.id,q.layoutVertexBuffer,q.indexBuffer,q.segments,w.paint,f.transform.zoom,se)}E.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(E,M){const k=E.context,O=k.gl,W=M.heatmapFbo;if(!W)return;k.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,W.colorAttachment.get()),k.activeTexture.set(O.TEXTURE1);let Z=M.colorRampTexture;Z||(Z=M.colorRampTexture=new vt(k,M.colorRamp,O.RGBA)),Z.bind(O.LINEAR,O.CLAMP_TO_EDGE),E.useProgram("heatmapTexture").draw(k,O.TRIANGLES,Wt.disabled,xi.disabled,E.colorModeForRenderPass(),gi.disabled,((Y,q,se,me)=>{const Q=h.F();h.aN(Q,0,Y.width,Y.height,0,0,1);const ce=Y.context.gl;return{u_matrix:Q,u_world:[ce.drawingBufferWidth,ce.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:q.paint.get("heatmap-opacity")}})(E,M),null,M.id,E.viewportBuffer,E.quadTriangleIndexBuffer,E.viewportSegments,M.paint,E.transform.zoom)}(f,w))})(t,s,l,c);break;case"line":(function(f,b,w,A){if(f.renderPass!=="translucent")return;const E=w.paint.get("line-opacity"),M=w.paint.get("line-width");if(E.constantOr(1)===0||M.constantOr(1)===0)return;const k=f.depthModeForSublayer(0,Wt.ReadOnly),O=f.colorModeForRenderPass(),W=w.paint.get("line-dasharray"),Z=w.paint.get("line-pattern"),Y=Z.constantOr(1),q=w.paint.get("line-gradient"),se=w.getCrossfadeParameters(),me=Y?"linePattern":W?"lineSDF":q?"lineGradient":"line",Q=f.context,ce=Q.gl;let ge=!0;for(const xe of A){const be=b.getTile(xe);if(Y&&!be.patternsLoaded())continue;const ze=be.getBucket(w);if(!ze)continue;const ke=ze.programConfigurations.get(w.id),Ne=f.context.program.get(),je=f.useProgram(me,ke),Rt=ge||je.program!==Ne,Ge=f.style.map.terrain&&f.style.map.terrain.getTerrainData(xe),wt=Z.constantOr(null);if(wt&&be.imageAtlas){const At=be.imageAtlas,Ot=At.patternPositions[wt.to.toString()],$t=At.patternPositions[wt.from.toString()];Ot&&$t&&ke.setConstantPatternPositions(Ot,$t)}const Lt=Ge?xe:null,Kt=Y?cs(f,be,w,se,Lt):W?ia(f,be,w,W,se,Lt):q?Hc(f,be,w,ze.lineClipsArray.length,Lt):ta(f,be,w,Lt);if(Y)Q.activeTexture.set(ce.TEXTURE0),be.imageAtlasTexture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE),ke.updatePaintBuffers(se);else if(W&&(Rt||f.lineAtlas.dirty))Q.activeTexture.set(ce.TEXTURE0),f.lineAtlas.bind(Q);else if(q){const At=ze.gradients[w.id];let Ot=At.texture;if(w.gradientVersion!==At.version){let $t=256;if(w.stepInterpolant){const Li=b.getSource().maxzoom,hi=xe.canonical.z===Li?Math.ceil(1<<f.transform.maxZoom-xe.canonical.z):1;$t=h.ac(h.aT(ze.maxLineLength/h.W*1024*hi),256,Q.maxTextureSize)}At.gradient=h.aU({expression:w.gradientExpression(),evaluationKey:"lineProgress",resolution:$t,image:At.gradient||void 0,clips:ze.lineClipsArray}),At.texture?At.texture.update(At.gradient):At.texture=new vt(Q,At.gradient,ce.RGBA),At.version=w.gradientVersion,Ot=At.texture}Q.activeTexture.set(ce.TEXTURE0),Ot.bind(w.stepInterpolant?ce.NEAREST:ce.LINEAR,ce.CLAMP_TO_EDGE)}je.draw(Q,ce.TRIANGLES,k,f.stencilModeForClipping(xe),O,gi.disabled,Kt,Ge,w.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,w.paint,f.transform.zoom,ke,ze.layoutVertexBuffer2),ge=!1}})(t,s,l,c);break;case"fill":(function(f,b,w,A){const E=w.paint.get("fill-color"),M=w.paint.get("fill-opacity");if(M.constantOr(1)===0)return;const k=f.colorModeForRenderPass(),O=w.paint.get("fill-pattern"),W=f.opaquePassEnabledForLayer()&&!O.constantOr(1)&&E.constantOr(h.aO.transparent).a===1&&M.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===W){const Z=f.depthModeForSublayer(1,f.renderPass==="opaque"?Wt.ReadWrite:Wt.ReadOnly);ru(f,b,w,A,Z,k,!1)}if(f.renderPass==="translucent"&&w.paint.get("fill-antialias")){const Z=f.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,Wt.ReadOnly);ru(f,b,w,A,Z,k,!0)}})(t,s,l,c);break;case"fill-extrusion":(function(f,b,w,A){const E=w.paint.get("fill-extrusion-opacity");if(E!==0&&f.renderPass==="translucent"){const M=new Wt(f.context.gl.LEQUAL,Wt.ReadWrite,f.depthRangeFor3D);if(E!==1||w.paint.get("fill-extrusion-pattern").constantOr(1))ga(f,b,w,A,M,xi.disabled,$i.disabled),ga(f,b,w,A,M,f.stencilModeFor3D(),f.colorModeForRenderPass());else{const k=f.colorModeForRenderPass();ga(f,b,w,A,M,xi.disabled,k)}}})(t,s,l,c);break;case"hillshade":(function(f,b,w,A){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent")return;const E=f.context,M=f.depthModeForSublayer(0,Wt.ReadOnly),k=f.colorModeForRenderPass(),[O,W]=f.renderPass==="translucent"?f.stencilConfigForOverlap(A):[{},A];for(const Z of W){const Y=b.getTile(Z);Y.needsHillshadePrepare!==void 0&&Y.needsHillshadePrepare&&f.renderPass==="offscreen"?bl(f,Y,w,M,xi.disabled,k):f.renderPass==="translucent"&&_a(f,Z,Y,w,M,O[Z.overscaledZ],k)}E.viewport.set([0,0,f.width,f.height])})(t,s,l,c);break;case"raster":(function(f,b,w,A){if(f.renderPass!=="translucent"||w.paint.get("raster-opacity")===0||!A.length)return;const E=f.context,M=E.gl,k=b.getSource(),O=f.useProgram("raster"),W=f.colorModeForRenderPass(),[Z,Y]=k instanceof Oe?[{},A]:f.stencilConfigForOverlap(A),q=Y[Y.length-1].overscaledZ,se=!f.options.moving;for(const me of Y){const Q=f.depthModeForSublayer(me.overscaledZ-q,w.paint.get("raster-opacity")===1?Wt.ReadWrite:Wt.ReadOnly,M.LESS),ce=b.getTile(me);ce.registerFadeDuration(w.paint.get("raster-fade-duration"));const ge=b.findLoadedParent(me,0),xe=nu(ce,ge,b,w,f.transform,f.style.map.terrain);let be,ze;const ke=w.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;E.activeTexture.set(M.TEXTURE0),ce.texture.bind(ke,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),E.activeTexture.set(M.TEXTURE1),ge?(ge.texture.bind(ke,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),be=Math.pow(2,ge.tileID.overscaledZ-ce.tileID.overscaledZ),ze=[ce.tileID.canonical.x*be%1,ce.tileID.canonical.y*be%1]):ce.texture.bind(ke,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST);const Ne=f.style.map.terrain&&f.style.map.terrain.getTerrainData(me),je=Ne?me:null,Rt=je?je.posMatrix:f.transform.calculatePosMatrix(me.toUnwrapped(),se),Ge=ra(Rt,ze||[0,0],be||1,xe,w);k instanceof Oe?O.draw(E,M.TRIANGLES,Q,xi.disabled,W,gi.disabled,Ge,Ne,w.id,k.boundsBuffer,f.quadTriangleIndexBuffer,k.boundsSegments):O.draw(E,M.TRIANGLES,Q,Z[me.overscaledZ],W,gi.disabled,Ge,Ne,w.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}})(t,s,l,c);break;case"background":(function(f,b,w,A){const E=w.paint.get("background-color"),M=w.paint.get("background-opacity");if(M===0)return;const k=f.context,O=k.gl,W=f.transform,Z=W.tileSize,Y=w.paint.get("background-pattern");if(f.isPatternMissing(Y))return;const q=!Y&&E.a===1&&M===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==q)return;const se=xi.disabled,me=f.depthModeForSublayer(0,q==="opaque"?Wt.ReadWrite:Wt.ReadOnly),Q=f.colorModeForRenderPass(),ce=f.useProgram(Y?"backgroundPattern":"background"),ge=A||W.coveringTiles({tileSize:Z,terrain:f.style.map.terrain});Y&&(k.activeTexture.set(O.TEXTURE0),f.imageManager.bind(f.context));const xe=w.getCrossfadeParameters();for(const be of ge){const ze=A?be.posMatrix:f.transform.calculatePosMatrix(be.toUnwrapped()),ke=Y?Wh(ze,M,f,Y,{tileID:be,tileSize:Z},xe):Zh(ze,M,E),Ne=f.style.map.terrain&&f.style.map.terrain.getTerrainData(be);ce.draw(k,O.TRIANGLES,me,se,Q,gi.disabled,ke,Ne,w.id,f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}})(t,0,l,c);break;case"custom":(function(f,b,w){const A=f.context,E=w.implementation;if(f.renderPass==="offscreen"){const M=E.prerender;M&&(f.setCustomLayerDefaults(),A.setColorMode(f.colorModeForRenderPass()),M.call(E,A.gl,f.transform.customLayerMatrix()),A.setDirty(),f.setBaseState())}else if(f.renderPass==="translucent"){f.setCustomLayerDefaults(),A.setColorMode(f.colorModeForRenderPass()),A.setStencilMode(xi.disabled);const M=E.renderingMode==="3d"?new Wt(f.context.gl.LEQUAL,Wt.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,Wt.ReadOnly);A.setDepthMode(M),E.render(A.gl,f.transform.customLayerMatrix()),A.setDirty(),f.setBaseState(),A.bindFramebuffer.set(null)}})(t,0,l)}}translatePosMatrix(t,s,l,c,f){if(!l[0]&&!l[1])return t;const b=f?c==="map"?this.transform.angle:0:c==="viewport"?-this.transform.angle:0;if(b){const E=Math.sin(b),M=Math.cos(b);l=[l[0]*M-l[1]*E,l[0]*E+l[1]*M]}const w=[f?l[0]:Et(s,l[0],this.transform.zoom),f?l[1]:Et(s,l[1],this.transform.zoom),0],A=new Float32Array(16);return h.H(A,t,w),A}saveTileTexture(t){const s=this._tileTextures[t.size[0]];s?s.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const s=this.imageManager.getPattern(t.from.toString()),l=this.imageManager.getPattern(t.to.toString());return!s||!l}useProgram(t,s){this.cache=this.cache||{};const l=t+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[l]||(this.cache[l]=new qn(this.context,ho[t],s,Zc[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[l]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new vt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:s}=this.context.gl;return this.width!==t||this.height!==s}}class Hn{constructor(t,s){this.points=t,this.planes=s}static fromInvProjectionMatrix(t,s,l){const c=Math.pow(2,l),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const A=1/(w=h.af([],w,t))[3]/s*c;return h.a$(w,w,[A,A,1/w[3],A])}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const A=function(O,W){var Z=W[0],Y=W[1],q=W[2],se=Z*Z+Y*Y+q*q;return se>0&&(se=1/Math.sqrt(se)),O[0]=W[0]*se,O[1]=W[1]*se,O[2]=W[2]*se,O}([],function(O,W,Z){var Y=W[0],q=W[1],se=W[2],me=Z[0],Q=Z[1],ce=Z[2];return O[0]=q*ce-se*Q,O[1]=se*me-Y*ce,O[2]=Y*Q-q*me,O}([],St([],f[w[0]],f[w[1]]),St([],f[w[2]],f[w[1]]))),E=-((M=A)[0]*(k=f[w[1]])[0]+M[1]*k[1]+M[2]*k[2]);var M,k;return A.concat(E)});return new Hn(f,b)}}class Zn{constructor(t,s){this.min=t,this.max=s,this.center=function(l,c,f){return l[0]=.5*c[0],l[1]=.5*c[1],l[2]=.5*c[2],l}([],function(l,c,f){return l[0]=c[0]+f[0],l[1]=c[1]+f[1],l[2]=c[2]+f[2],l}([],this.min,this.max))}quadrant(t){const s=[t%2==0,t<2],l=at(this.min),c=at(this.max);for(let f=0;f<s.length;f++)l[f]=s[f]?this.min[f]:this.center[f],c[f]=s[f]?this.center[f]:this.max[f];return c[2]=this.max[2],new Zn(l,c)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let l=!0;for(let c=0;c<t.planes.length;c++){const f=t.planes[c];let b=0;for(let w=0;w<s.length;w++)h.b0(f,s[w])>=0&&b++;if(b===0)return 0;b!==s.length&&(l=!1)}if(l)return 2;for(let c=0;c<3;c++){let f=Number.MAX_VALUE,b=-Number.MAX_VALUE;for(let w=0;w<t.points.length;w++){const A=t.points[w][c]-this.min[c];f=Math.min(f,A),b=Math.max(b,A)}if(b<0||f>this.max[c]-this.min[c])return 0}return 1}}class Fs{constructor(t=0,s=0,l=0,c=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(l)||l<0||isNaN(c)||c<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=l,this.right=c}interpolate(t,s,l){return s.top!=null&&t.top!=null&&(this.top=h.z.number(t.top,s.top,l)),s.bottom!=null&&t.bottom!=null&&(this.bottom=h.z.number(t.bottom,s.bottom,l)),s.left!=null&&t.left!=null&&(this.left=h.z.number(t.left,s.left,l)),s.right!=null&&t.right!=null&&(this.right=h.z.number(t.right,s.right,l)),this}getCenter(t,s){const l=h.ac((this.left+t-this.right)/2,0,t),c=h.ac((this.top+s-this.bottom)/2,0,s);return new h.P(l,c)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Fs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Tl=85.051129;class va{constructor(t,s,l,c,f){this.tileSize=512,this._renderWorldCopies=f===void 0||!!f,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=l??0,this._maxPitch=c??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new h.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Fs,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const t=new va(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this.minElevationForCurrentTile=t.minElevationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new h.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const s=-h.b1(t,-180,180)*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=function(){var l=new h.A(4);return h.A!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l}(),function(l,c,f){var b=c[0],w=c[1],A=c[2],E=c[3],M=Math.sin(f),k=Math.cos(f);l[0]=b*k+A*M,l[1]=w*k+E*M,l[2]=b*-M+A*k,l[3]=w*-M+E*k}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const s=h.ac(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.tileZoom=Math.max(0,Math.floor(s)),this.scale=this.zoomScale(s),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,l){this._unmodified=!1,this._edgeInsets.interpolate(t,s,l),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){const s=[new h.b2(0,t)];if(this._renderWorldCopies){const l=this.pointCoordinate(new h.P(0,0)),c=this.pointCoordinate(new h.P(this.width,0)),f=this.pointCoordinate(new h.P(this.width,this.height)),b=this.pointCoordinate(new h.P(0,this.height)),w=Math.floor(Math.min(l.x,c.x,f.x,b.x)),A=Math.floor(Math.max(l.x,c.x,f.x,b.x)),E=1;for(let M=w-E;M<=A+E;M++)M!==0&&s.push(new h.b2(M,t))}return s}coveringTiles(t){var s,l;let c=this.coveringZoomLevel(t);const f=c;if(t.minzoom!==void 0&&c<t.minzoom)return[];t.maxzoom!==void 0&&c>t.maxzoom&&(c=t.maxzoom);const b=this.pointCoordinate(this.getCameraPoint()),w=h.Y.fromLngLat(this.center),A=Math.pow(2,c),E=[A*b.x,A*b.y,0],M=[A*w.x,A*w.y,0],k=Hn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c);let O=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(O=c);const W=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,Z=Q=>({aabb:new Zn([Q*A,0,0],[(Q+1)*A,A,0]),zoom:0,x:0,y:0,wrap:Q,fullyVisible:!1}),Y=[],q=[],se=c,me=t.reparseOverscaled?f:c;if(this._renderWorldCopies)for(let Q=1;Q<=3;Q++)Y.push(Z(-Q)),Y.push(Z(Q));for(Y.push(Z(0));Y.length>0;){const Q=Y.pop(),ce=Q.x,ge=Q.y;let xe=Q.fullyVisible;if(!xe){const je=Q.aabb.intersects(k);if(je===0)continue;xe=je===2}const be=t.terrain?E:M,ze=Q.aabb.distanceX(be),ke=Q.aabb.distanceY(be),Ne=Math.max(Math.abs(ze),Math.abs(ke));if(Q.zoom===se||Ne>W+(1<<se-Q.zoom)-2&&Q.zoom>=O){const je=se-Q.zoom,Rt=E[0]-.5-(ce<<je),Ge=E[1]-.5-(ge<<je);q.push({tileID:new h.Q(Q.zoom===se?me:Q.zoom,Q.wrap,Q.zoom,ce,ge),distanceSq:dt([M[0]-.5-ce,M[1]-.5-ge]),tileDistanceToCamera:Math.sqrt(Rt*Rt+Ge*Ge)})}else for(let je=0;je<4;je++){const Rt=(ce<<1)+je%2,Ge=(ge<<1)+(je>>1),wt=Q.zoom+1;let Lt=Q.aabb.quadrant(je);if(t.terrain){const Kt=new h.Q(wt,Q.wrap,wt,Rt,Ge),At=t.terrain.getMinMaxElevation(Kt),Ot=(s=At.minElevation)!==null&&s!==void 0?s:this.elevation,$t=(l=At.maxElevation)!==null&&l!==void 0?l:this.elevation;Lt=new Zn([Lt.min[0],Lt.min[1],Ot],[Lt.max[0],Lt.max[1],$t])}Y.push({aabb:Lt,zoom:wt,x:Rt,y:Ge,wrap:Q.wrap,fullyVisible:xe})}}return q.sort((Q,ce)=>Q.distanceSq-ce.distanceSq).map(Q=>Q.tileID)}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const s=h.ac(t.lat,-85.051129,Tl);return new h.P(h.N(t.lng)*this.worldSize,h.O(s)*this.worldSize)}unproject(t){return new h.Y(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const s=this.elevation,l=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,c=this.pointLocation(this.centerPoint,t),f=t.getElevationForLngLatZoom(c,this.tileZoom);if(!(this.elevation-f))return;const b=l+s-f,w=Math.cos(this._pitch)*this.cameraToCenterDistance/b/h.b3(1,c.lat),A=this.scaleZoom(w/this.tileSize);this._elevation=f,this._center=c,this.zoom=A}setLocationAtPoint(t,s){const l=this.pointCoordinate(s),c=this.pointCoordinate(this.centerPoint),f=this.locationCoordinate(t),b=new h.Y(f.x-(l.x-c.x),f.y-(l.y-c.y));this.center=this.coordinateLocation(b),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,s){return s?this.coordinatePoint(this.locationCoordinate(t),s.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,s){return this.coordinateLocation(this.pointCoordinate(t,s))}locationCoordinate(t){return h.Y.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,s){if(s){const O=s.pointCoordinate(t);if(O!=null)return O}const l=[t.x,t.y,0,1],c=[t.x,t.y,1,1];h.af(l,l,this.pixelMatrixInverse),h.af(c,c,this.pixelMatrixInverse);const f=l[3],b=c[3],w=l[1]/f,A=c[1]/b,E=l[2]/f,M=c[2]/b,k=E===M?0:(0-E)/(M-E);return new h.Y(h.z.number(l[0]/f,c[0]/b,k)/this.worldSize,h.z.number(w,A,k)/this.worldSize)}coordinatePoint(t,s=0,l=this.pixelMatrix){const c=[t.x*this.worldSize,t.y*this.worldSize,s,1];return h.af(c,c,l),new h.P(c[0]/c[3],c[1]/c[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new ie().extend(this.pointLocation(new h.P(0,t))).extend(this.pointLocation(new h.P(this.width,t))).extend(this.pointLocation(new h.P(this.width,this.height))).extend(this.pointLocation(new h.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new ie([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Tl])}calculatePosMatrix(t,s=!1){const l=t.key,c=s?this._alignedPosMatrixCache:this._posMatrixCache;if(c[l])return c[l];const f=t.canonical,b=this.worldSize/this.zoomScale(f.z),w=f.x+Math.pow(2,f.z)*t.wrap,A=h.an(new Float64Array(16));return h.H(A,A,[w*b,f.y*b,0]),h.J(A,A,[b/h.W,b/h.W,1]),h.K(A,s?this.alignedProjMatrix:this.projMatrix,A),c[l]=new Float32Array(A),c[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(t,s){s=h.ac(+s,this.minZoom,this.maxZoom);const l={center:new h.M(t.lng,t.lat),zoom:s};let c=this.lngRange;if(!this._renderWorldCopies&&c===null){const Q=179.9999999999;c=[-Q,Q]}const f=this.tileSize*this.zoomScale(l.zoom);let b=0,w=f,A=0,E=f,M=0,k=0;const{x:O,y:W}=this.size;if(this.latRange){const Q=this.latRange;b=h.O(Q[1])*f,w=h.O(Q[0])*f,w-b<W&&(M=W/(w-b))}c&&(A=h.b1(h.N(c[0])*f,0,f),E=h.b1(h.N(c[1])*f,0,f),E<A&&(E+=f),E-A<O&&(k=O/(E-A)));const{x:Z,y:Y}=this.project.call({worldSize:f},t);let q,se;const me=Math.max(k||0,M||0);if(me){const Q=new h.P(k?(E+A)/2:Z,M?(w+b)/2:Y);return l.center=this.unproject.call({worldSize:f},Q).wrap(),l.zoom+=this.scaleZoom(me),l}if(this.latRange){const Q=W/2;Y-Q<b&&(se=b+Q),Y+Q>w&&(se=w-Q)}if(c){const Q=(A+E)/2;let ce=Z;this._renderWorldCopies&&(ce=h.b1(Z,Q-f/2,Q+f/2));const ge=O/2;ce-ge<A&&(q=A+ge),ce+ge>E&&(q=E-ge)}if(q!==void 0||se!==void 0){const Q=new h.P(q??Z,se??Y);l.center=this.unproject.call({worldSize:f},Q).wrap()}return l}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:s,zoom:l}=this.getConstrained(this.center,this.zoom);this.center=s,this.zoom=l,this._unmodified=t,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,s=this.point.x,l=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=h.b3(1,this.center.lat)*this.worldSize;let c=h.an(new Float64Array(16));h.J(c,c,[this.width/2,-this.height/2,1]),h.H(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=h.an(new Float64Array(16)),h.J(c,c,[1,-1,1]),h.H(c,c,[-1,-1,0]),h.J(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c;const f=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),b=Math.min(this.elevation,this.minElevationForCurrentTile),w=f-b*this._pixelPerMeter/Math.cos(this._pitch),A=b<0?w:f,E=Math.PI/2+this._pitch,M=this._fov*(.5+t.y/this.height),k=Math.sin(M)*A/Math.sin(h.ac(Math.PI-E-M,.01,Math.PI-.01)),O=this.getHorizon(),W=2*Math.atan(O/this.cameraToCenterDistance)*(.5+t.y/(2*O)),Z=Math.sin(W)*A/Math.sin(h.ac(Math.PI-E-W,.01,Math.PI-.01)),Y=Math.min(k,Z),q=1.01*(Math.cos(Math.PI/2-this._pitch)*Y+A),se=this.height/50;c=new Float64Array(16),h.b4(c,this._fov,this.width/this.height,se,q),c[8]=2*-t.x/this.width,c[9]=2*t.y/this.height,h.J(c,c,[1,-1,1]),h.H(c,c,[0,0,-this.cameraToCenterDistance]),h.b5(c,c,this._pitch),h.ad(c,c,this.angle),h.H(c,c,[-s,-l,0]),this.mercatorMatrix=h.J([],c,[this.worldSize,this.worldSize,this.worldSize]),h.J(c,c,[1,1,this._pixelPerMeter]),this.pixelMatrix=h.K(new Float64Array(16),this.labelPlaneMatrix,c),h.H(c,c,[0,0,-this.elevation]),this.projMatrix=c,this.invProjMatrix=h.ar([],c),this.pixelMatrix3D=h.K(new Float64Array(16),this.labelPlaneMatrix,c);const me=this.width%2/2,Q=this.height%2/2,ce=Math.cos(this.angle),ge=Math.sin(this.angle),xe=s-Math.round(s)+ce*me+ge*Q,be=l-Math.round(l)+ce*Q+ge*me,ze=new Float64Array(c);if(h.H(ze,ze,[xe>.5?xe-1:xe,be>.5?be-1:be,0]),this.alignedProjMatrix=ze,c=h.ar(new Float64Array(16),this.pixelMatrix),!c)throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new h.P(0,0)),s=[t.x*this.worldSize,t.y*this.worldSize,0,1];return h.af(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new h.P(0,t))}getCameraQueryGeometry(t){const s=this.getCameraPoint();if(t.length===1)return[t[0],s];{let l=s.x,c=s.y,f=s.x,b=s.y;for(const w of t)l=Math.min(l,w.x),c=Math.min(c,w.y),f=Math.max(f,w.x),b=Math.max(b,w.y);return[new h.P(l,c),new h.P(f,c),new h.P(f,b),new h.P(l,b),new h.P(l,c)]}}lngLatToCameraDepth(t,s){const l=this.locationCoordinate(t),c=[l.x*this.worldSize,l.y*this.worldSize,s,1];return h.af(c,c,this.projMatrix),c[2]/c[3]}}function Al(p,t){let s,l=!1,c=null,f=null;const b=()=>{c=null,l&&(p.apply(f,s),c=setTimeout(b,t),l=!1)};return(...w)=>(l=!0,f=this,s=w,c||b(),c)}class Il{constructor(t){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let l;return s.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(l=c)}),(l&&l[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(s.length>=3&&!s.some(l=>isNaN(l))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:l,pitch:+(s[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,s)}catch{}},this._updateHash=Al(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const s=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,c=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),f=Math.pow(10,c),b=Math.round(s.lng*f)/f,w=Math.round(s.lat*f)/f,A=this._map.getBearing(),E=this._map.getPitch();let M="";if(M+=t?`/${b}/${w}/${l}`:`${l}/${w}/${b}`,(A||E)&&(M+="/"+Math.round(10*A)/10),E&&(M+=`/${Math.round(E)}`),this._hashName){const k=this._hashName;let O=!1;const W=window.location.hash.slice(1).split("&").map(Z=>{const Y=Z.split("=")[0];return Y===k?(O=!0,`${Y}=${M}`):Z}).filter(Z=>Z);return O||W.push(`${k}=${M}`),`#${W.join("&")}`}return`#${M}`}}const vo={linearity:.3,easing:h.b6(0,0,.3,1)},ps=h.e({deceleration:2500,maxSpeed:1400},vo),lu=h.e({deceleration:20,maxSpeed:1400},vo),cu=h.e({deceleration:1e3,maxSpeed:360},vo),uu=h.e({deceleration:1e3,maxSpeed:90},vo);class hu{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:N.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=N.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new h.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:f}of this._inertiaBuffer)s.zoom+=f.zoomDelta||0,s.bearing+=f.bearingDelta||0,s.pitch+=f.pitchDelta||0,f.panDelta&&s.pan._add(f.panDelta),f.around&&(s.around=f.around),f.pinchAround&&(s.pinchAround=f.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,c={};if(s.pan.mag()){const f=wo(s.pan.mag(),l,h.e({},ps,t||{}));c.offset=s.pan.mult(f.amount/s.pan.mag()),c.center=this._map.transform.center,bo(c,f)}if(s.zoom){const f=wo(s.zoom,l,lu);c.zoom=this._map.transform.zoom+f.amount,bo(c,f)}if(s.bearing){const f=wo(s.bearing,l,cu);c.bearing=this._map.transform.bearing+h.ac(f.amount,-179,179),bo(c,f)}if(s.pitch){const f=wo(s.pitch,l,uu);c.pitch=this._map.transform.pitch+f.amount,bo(c,f)}if(c.zoom||c.bearing){const f=s.pinchAround===void 0?s.around:s.pinchAround;c.around=f?this._map.unproject(f):this._map.getCenter()}return this.clear(),h.e(c,{noMoveStart:!0})}}function bo(p,t){(!p.duration||p.duration<t.duration)&&(p.duration=t.duration,p.easing=t.easing)}function wo(p,t,s){const{maxSpeed:l,linearity:c,deceleration:f}=s,b=h.ac(p*c/(t/1e3),-l,l),w=Math.abs(b)/(f*c);return{easing:s.easing,duration:1e3*w,amount:b*(w/2)}}class Rr extends h.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,l,c={}){const f=V.mousePos(s.getCanvas(),l),b=s.unproject(f);super(t,h.e({point:f,lngLat:b,originalEvent:l},c)),this._defaultPrevented=!1,this.target=s}}class Sn extends h.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,l){const c=t==="touchend"?l.changedTouches:l.touches,f=V.touchPos(s.getCanvasContainer(),c),b=f.map(A=>s.unproject(A)),w=f.reduce((A,E,M,k)=>A.add(E.div(k.length)),new h.P(0,0));super(t,{points:f,point:w,lngLats:b,lngLat:s.unproject(w),originalEvent:l}),this._defaultPrevented=!1}}class El extends h.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,l){super(t,{originalEvent:l}),this._defaultPrevented=!1}}class dn{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new El(t.type,this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new Rr(t.type,this._map,t))}mouseup(t){this._map.fire(new Rr(t.type,this._map,t))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new Rr(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Rr(t.type,this._map,t))}mouseover(t){this._map.fire(new Rr(t.type,this._map,t))}mouseout(t){this._map.fire(new Rr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Sn(t.type,this._map,t))}touchmove(t){this._map.fire(new Sn(t.type,this._map,t))}touchend(t){this._map.fire(new Sn(t.type,this._map,t))}touchcancel(t){this._map.fire(new Sn(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Tn{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Rr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Rr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Rr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Os{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(h.P.convert(t),this._map.terrain)}}class pn{constructor(t,s){this._map=t,this._tr=new Os(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(V.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const l=s;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const c=this._startPos;this._lastPos=l,this._box||(this._box=V.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const f=Math.min(c.x,l.x),b=Math.max(c.x,l.x),w=Math.min(c.y,l.y),A=Math.max(c.y,l.y);V.setTransform(this._box,`translate(${f}px,${w}px)`),this._box.style.width=b-f+"px",this._box.style.height=A-w+"px"}mouseupWindow(t,s){if(!this._active||t.button!==0)return;const l=this._startPos,c=s;if(this.reset(),V.suppressClick(),l.x!==c.x||l.y!==c.y)return this._map.fire(new h.k("boxzoomend",{originalEvent:t})),{cameraAnimation:f=>f.fitScreenCoordinates(l,c,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(V.remove(this._box),this._box=null),V.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new h.k(t,{originalEvent:s}))}}function fs(p,t){if(p.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${p.length}, points ${t.length}`);const s={};for(let l=0;l<p.length;l++)s[p[l].identifier]=t[l];return s}class sd{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,s,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),l.length===this.numTouches&&(this.centroid=function(c){const f=new h.P(0,0);for(const b of c)f._add(b);return f.div(c.length)}(s),this.touches=fs(l,s)))}touchmove(t,s,l){if(this.aborted||!this.centroid)return;const c=fs(l,s);for(const f in this.touches){const b=c[f];(!b||b.dist(this.touches[f])>30)&&(this.aborted=!0)}}touchend(t,s,l){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const c=!this.aborted&&this.centroid;if(this.reset(),c)return c}}}class Pl{constructor(t){this.singleTap=new sd(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,s,l){this.singleTap.touchstart(t,s,l)}touchmove(t,s,l){this.singleTap.touchmove(t,s,l)}touchend(t,s,l){const c=this.singleTap.touchend(t,s,l);if(c){const f=t.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(c)<30;if(f&&b||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=c,this.count===this.numTaps)return this.reset(),c}}}class od{constructor(t){this._tr=new Os(t),this._zoomIn=new Pl({numTouches:1,numTaps:2}),this._zoomOut=new Pl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,l){this._zoomIn.touchstart(t,s,l),this._zoomOut.touchstart(t,s,l)}touchmove(t,s,l){this._zoomIn.touchmove(t,s,l),this._zoomOut.touchmove(t,s,l)}touchend(t,s,l){const c=this._zoomIn.touchend(t,s,l),f=this._zoomOut.touchend(t,s,l),b=this._tr;return c?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:b.zoom+1,around:b.unproject(c)},{originalEvent:t})}):f?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:b.zoom-1,around:b.unproject(f)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bs{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const s=this._moveFunction(...t);if(s.bearingDelta||s.pitchDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(t,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=s.length?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,s){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const c=s.length?s[0]:s;return!this._moved&&c.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=c,this._move(l,c))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&V.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const So={0:1,2:2};class An{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const s=V.mouseButton(t);this._eventButton=s}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(s,l){const c=So[l];return s.buttons===void 0||(s.buttons&c)!==c}(t,this._eventButton)}isValidEndEvent(t){return V.mouseButton(t)===this._eventButton}}class it{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const ba=p=>{p.mousedown=p.dragStart,p.mousemoveWindow=p.dragMove,p.mouseup=p.dragEnd,p.contextmenu=function(t){t.preventDefault()}},Ns=({enable:p,clickTolerance:t,bearingDegreesPerPixelMoved:s=.8})=>{const l=new An({checkCorrectEvent:c=>V.mouseButton(c)===0&&c.ctrlKey||V.mouseButton(c)===2});return new Bs({clickTolerance:t,move:(c,f)=>({bearingDelta:(f.x-c.x)*s}),moveStateManager:l,enable:p,assignEvents:ba})},Vs=({enable:p,clickTolerance:t,pitchDegreesPerPixelMoved:s=-.5})=>{const l=new An({checkCorrectEvent:c=>V.mouseButton(c)===0&&c.ctrlKey||V.mouseButton(c)===2});return new Bs({clickTolerance:t,move:(c,f)=>({pitchDelta:(f.y-c.y)*s}),moveStateManager:l,enable:p,assignEvents:ba})};class du{constructor(t,s){this._clickTolerance=t.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new h.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(t,s,l){return this._calculateTransform(t,s,l)}touchmove(t,s,l){if(this._active&&!(l.length<this.minTouchs()))return t.preventDefault(),this._calculateTransform(t,s,l)}touchend(t,s,l){this._calculateTransform(t,s,l),this._active&&l.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,l){l.length>0&&(this._active=!0);const c=fs(l,s),f=new h.P(0,0),b=new h.P(0,0);let w=0;for(const E in c){const M=c[E],k=this._touches[E];k&&(f._add(M),b._add(M.sub(k)),w++,c[E]=M)}if(this._touches=c,w<this.minTouchs()||!b.mag())return;const A=b.div(w);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:f.div(w),panDelta:A}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ke{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,s,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,l){if(!this._firstTwoTouches)return;t.preventDefault();const[c,f]=this._firstTwoTouches,b=$s(l,s,c),w=$s(l,s,f);if(!b||!w)return;const A=this._aroundCenter?null:b.add(w).div(2);return this._move([b,w],A,t)}touchend(t,s,l){if(!this._firstTwoTouches)return;const[c,f]=this._firstTwoTouches,b=$s(l,s,c),w=$s(l,s,f);b&&w||(this._active&&V.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function $s(p,t,s){for(let l=0;l<p.length;l++)if(p[l].identifier===s)return t[l]}function pu(p,t){return Math.log(p/t)/Math.LN2}class fu extends Ke{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const l=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(pu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:pu(this._distance,l),pinchAround:s}}}function wa(p,t){return 180*p.angleWith(t)/Math.PI}class Cl extends Ke{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s,l){const c=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:wa(this._vector,c),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,l=wa(t,this._startVector);return Math.abs(l)<s}}function Sa(p){return Math.abs(p.y)>Math.abs(p.x)}class mu extends Ke{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,s,l){super.touchstart(t,s,l),this._currentTouchCount=l.length}_start(t){this._lastPoints=t,Sa(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const c=t[0].sub(this._lastPoints[0]),f=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(c,f,l.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(c.y+f.y)/2*-.5}):void 0}gestureBeginsVertically(t,s,l){if(this._valid!==void 0)return this._valid;const c=t.mag()>=2,f=s.mag()>=2;if(!c&&!f)return;if(!c||!f)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const b=t.y>0==s.y>0;return Sa(t)&&Sa(s)&&b}}const ad={panStep:100,bearingStep:15,pitchStep:10};class Wn{constructor(t){this._tr=new Os(t);const s=ad;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,l=0,c=0,f=0,b=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?l=-1:(t.preventDefault(),f=-1);break;case 39:t.shiftKey?l=1:(t.preventDefault(),f=1);break;case 38:t.shiftKey?c=1:(t.preventDefault(),b=-1);break;case 40:t.shiftKey?c=-1:(t.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(l=0,c=0),{cameraAnimation:w=>{const A=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:Ai,zoom:s?Math.round(A.zoom)+s*(t.shiftKey?2:1):A.zoom,bearing:A.bearing+l*this._bearingStep,pitch:A.pitch+c*this._pitchStep,offset:[-f*this._panStep,-b*this._panStep],center:A.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ai(p){return p*(2-p)}const To=4.000244140625;class Ta{constructor(t,s){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=t,this._tr=new Os(t),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!t[this._map.cooperativeGestures._bypassKey])return;let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const l=N.now(),c=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,s!==0&&s%To==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":c>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(c*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=V.mousePos(this._map.getCanvas(),t),l=this._tr;this._around=s.y>l.transform.height/2-l.transform.getHorizon()?h.M.convert(this._aroundCenter?l.center:l.unproject(s)):h.M.convert(l.center),this._aroundPoint=l.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const w=this._type==="wheel"&&Math.abs(this._delta)>To?this._wheelZoomRate:this._defaultZoomRate;let A=2/(1+Math.exp(-Math.abs(this._delta*w)));this._delta<0&&A!==0&&(A=1/A);const E=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(E*A))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,l=this._startZoom,c=this._easing;let f,b=!1;if(this._type==="wheel"&&l&&c){const w=Math.min((N.now()-this._lastWheelEventTime)/200,1),A=c(w);f=h.z.number(l,s,A),w<1?this._frameId||(this._frameId=!0):b=!0}else f=s,b=!0;return this._active=!0,b&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!b,zoomDelta:f-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=h.b7;if(this._prevEase){const l=this._prevEase,c=(N.now()-l.start)/l.duration,f=l.easing(c+.01)-l.easing(c),b=.27/Math.sqrt(f*f+1e-4)*.01,w=Math.sqrt(.0729-b*b);s=h.b6(b,w,.25,1)}return this._prevEase={start:N.now(),duration:t,easing:s},s}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Ml{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class gu{constructor(t){this._tr=new Os(t),this.reset()}reset(){this._active=!1}dblclick(t,s){return t.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _u{constructor(){this._tap=new Pl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,s,l){if(!this._swipePoint)if(this._tapTime){const c=s[0],f=t.timeStamp-this._tapTime<500,b=this._tapPoint.dist(c)<30;f&&b?l.length>0&&(this._swipePoint=c,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(t,s,l)}touchmove(t,s,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const c=s[0],f=c.y-this._swipePoint.y;return this._swipePoint=c,t.preventDefault(),this._active=!0,{zoomDelta:f/128}}}else this._tap.touchmove(t,s,l)}touchend(t,s,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const c=this._tap.touchend(t,s,l);c&&(this._tapTime=t.timeStamp,this._tapPoint=c)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yu{constructor(t,s,l){this._el=t,this._mousePan=s,this._touchPan=l}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class fn{constructor(t,s,l){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=l}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ao{constructor(t,s,l,c){this._el=t,this._touchZoom=s,this._touchRotate=l,this._tapDragZoom=c,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class ut{constructor(t,s){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=s,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=V.create("div","maplibregl-cooperative-gesture-screen",t);let s=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(s=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),c=document.createElement("div");c.className="maplibregl-desktop-message",c.textContent=s,this._container.appendChild(c);const f=document.createElement("div");f.className="maplibregl-mobile-message",f.textContent=l,this._container.appendChild(f),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(V.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(t){this._onCooperativeGesture(t.touches.length===1)}wheel(t){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!t[this._bypassKey])}_onCooperativeGesture(t){this._enabled&&t&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const yt=p=>p.zoom||p.drag||p.pitch||p.rotate;class Aa extends h.k{}function Io(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class kl{constructor(t,s){this.handleWindowEvent=c=>{this.handleEvent(c,`${c.type}Window`)},this.handleEvent=(c,f)=>{if(c.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const b=c.type==="renderFrame"?void 0:c,w={needsRenderFrame:!1},A={},E={},M=c.touches,k=M?this._getMapTouches(M):void 0,O=k?V.touchPos(this._map.getCanvas(),k):V.mousePos(this._map.getCanvas(),c);for(const{handlerName:Y,handler:q,allowed:se}of this._handlers){if(!q.isEnabled())continue;let me;this._blockedByActive(E,se,Y)?q.reset():q[f||c.type]&&(me=q[f||c.type](c,O,k),this.mergeHandlerResult(w,A,me,Y,b),me&&me.needsRenderFrame&&this._triggerRenderFrame()),(me||q.isActive())&&(E[Y]=q)}const W={};for(const Y in this._previousActiveHandlers)E[Y]||(W[Y]=b);this._previousActiveHandlers=E,(Object.keys(W).length||Io(w))&&(this._changes.push([w,A,W]),this._triggerRenderFrame()),(Object.keys(E).length||Io(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Z}=w;Z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Z(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new hu(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[c,f,b]of this._listeners)V.addEventListener(c,f,c===document?this.handleWindowEvent:this.handleEvent,b)}destroy(){for(const[t,s,l]of this._listeners)V.removeEventListener(t,s,t===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(t){const s=this._map,l=s.getCanvasContainer();this._add("mapEvent",new dn(s,t));const c=s.boxZoom=new pn(s,t);this._add("boxZoom",c),t.interactive&&t.boxZoom&&c.enable();const f=s.cooperativeGestures=new ut(s,t.cooperativeGestures);this._add("cooperativeGestures",f),t.cooperativeGestures&&f.enable();const b=new od(s),w=new gu(s);s.doubleClickZoom=new Ml(w,b),this._add("tapZoom",b),this._add("clickZoom",w),t.interactive&&t.doubleClickZoom&&s.doubleClickZoom.enable();const A=new _u;this._add("tapDragZoom",A);const E=s.touchPitch=new mu(s);this._add("touchPitch",E),t.interactive&&t.touchPitch&&s.touchPitch.enable(t.touchPitch);const M=Ns(t),k=Vs(t);s.dragRotate=new fn(t,M,k),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]),t.interactive&&t.dragRotate&&s.dragRotate.enable();const O=(({enable:me,clickTolerance:Q})=>{const ce=new An({checkCorrectEvent:ge=>V.mouseButton(ge)===0&&!ge.ctrlKey});return new Bs({clickTolerance:Q,move:(ge,xe)=>({around:xe,panDelta:xe.sub(ge)}),activateOnStart:!0,moveStateManager:ce,enable:me,assignEvents:ba})})(t),W=new du(t,s);s.dragPan=new yu(l,O,W),this._add("mousePan",O),this._add("touchPan",W,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&s.dragPan.enable(t.dragPan);const Z=new Cl,Y=new fu;s.touchZoomRotate=new Ao(l,Y,Z,A),this._add("touchRotate",Z,["touchPan","touchZoom"]),this._add("touchZoom",Y,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&s.touchZoomRotate.enable(t.touchZoomRotate);const q=s.scrollZoom=new Ta(s,()=>this._triggerRenderFrame());this._add("scrollZoom",q,["mousePan"]),t.interactive&&t.scrollZoom&&s.scrollZoom.enable(t.scrollZoom);const se=s.keyboard=new Wn(s);this._add("keyboard",se),t.interactive&&t.keyboard&&s.keyboard.enable(),this._add("blockableMapEvent",new Tn(s))}_add(t,s,l){this._handlers.push({handlerName:t,handler:s,allowed:l}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!yt(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,s,l){for(const c in t)if(c!==l&&(!s||s.indexOf(c)<0))return!0;return!1}_getMapTouches(t){const s=[];for(const l of t)this._el.contains(l.target)&&s.push(l);return s}mergeHandlerResult(t,s,l,c,f){if(!l)return;h.e(t,l);const b={handlerName:c,originalEvent:l.originalEvent||f};l.zoomDelta!==void 0&&(s.zoom=b),l.panDelta!==void 0&&(s.drag=b),l.pitchDelta!==void 0&&(s.pitch=b),l.bearingDelta!==void 0&&(s.rotate=b)}_applyChanges(){const t={},s={},l={};for(const[c,f,b]of this._changes)c.panDelta&&(t.panDelta=(t.panDelta||new h.P(0,0))._add(c.panDelta)),c.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+c.zoomDelta),c.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+c.bearingDelta),c.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+c.pitchDelta),c.around!==void 0&&(t.around=c.around),c.pinchAround!==void 0&&(t.pinchAround=c.pinchAround),c.noInertia&&(t.noInertia=c.noInertia),h.e(s,f),h.e(l,b);this._updateMapTransform(t,s,l),this._changes=[]}_updateMapTransform(t,s,l){const c=this._map,f=c._getTransformForUpdate(),b=c.terrain;if(!(Io(t)||b&&this._terrainMovement))return this._fireEvents(s,l,!0);let{panDelta:w,zoomDelta:A,bearingDelta:E,pitchDelta:M,around:k,pinchAround:O}=t;O!==void 0&&(k=O),c._stop(!0),k=k||c.transform.centerPoint;const W=f.pointLocation(w?k.sub(w):k);E&&(f.bearing+=E),M&&(f.pitch+=M),A&&(f.zoom+=A),b?this._terrainMovement||!s.drag&&!s.zoom?s.drag&&this._terrainMovement?f.center=f.pointLocation(f.centerPoint.sub(w)):f.setLocationAtPoint(W,k):(this._terrainMovement=!0,this._map._elevationFreeze=!0,f.setLocationAtPoint(W,k),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,f.recalculateZoom(c.terrain)})):f.setLocationAtPoint(W,k),c._applyUpdatedTransform(f),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,l,!0)}_fireEvents(t,s,l){const c=yt(this._eventsInProgress),f=yt(t),b={};for(const M in t){const{originalEvent:k}=t[M];this._eventsInProgress[M]||(b[`${M}start`]=k),this._eventsInProgress[M]=t[M]}!c&&f&&this._fireEvent("movestart",f.originalEvent);for(const M in b)this._fireEvent(M,b[M]);f&&this._fireEvent("move",f.originalEvent);for(const M in t){const{originalEvent:k}=t[M];this._fireEvent(M,k)}const w={};let A;for(const M in this._eventsInProgress){const{handlerName:k,originalEvent:O}=this._eventsInProgress[M];this._handlersById[k].isActive()||(delete this._eventsInProgress[M],A=s[k]||O,w[`${M}end`]=A)}for(const M in w)this._fireEvent(M,w[M]);const E=yt(this._eventsInProgress);if(l&&(c||f)&&!E){this._updatingCamera=!0;const M=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),k=O=>O!==0&&-this._bearingSnap<O&&O<this._bearingSnap;!M||!M.essential&&N.prefersReducedMotion?(this._map.fire(new h.k("moveend",{originalEvent:A})),k(this._map.getBearing())&&this._map.resetNorth()):(k(M.bearing||this._map.getBearing())&&(M.bearing=0),M.freezeElevation=!0,this._map.easeTo(M,{originalEvent:A})),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new h.k(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Aa("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Lr extends h.E{constructor(t,s){super(),this._renderFrameCallback=()=>{const l=Math.min((N.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(l)),l<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new h.M(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,l){return t=h.P.convert(t).mult(-1),this.panTo(this.transform.center,h.e({offset:t},s),l)}panTo(t,s,l){return this.easeTo(h.e({center:t},s),l)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,l){return this.easeTo(h.e({zoom:t},s),l)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,l){return this.easeTo(h.e({bearing:t},s),l)}resetNorth(t,s){return this.rotateTo(0,h.e({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(h.e({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){t=ie.convert(t);const l=s&&s.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),l,s)}_cameraForBoxAndBearing(t,s,l,c){const f={top:0,bottom:0,right:0,left:0};if(typeof(c=h.e({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){const je=c.padding;c.padding={top:je,bottom:je,right:je,left:je}}c.padding=h.e(f,c.padding);const b=this.transform,w=b.padding,A=new ie(t,s),E=b.project(A.getNorthWest()),M=b.project(A.getNorthEast()),k=b.project(A.getSouthEast()),O=b.project(A.getSouthWest()),W=h.b8(-l),Z=E.rotate(W),Y=M.rotate(W),q=k.rotate(W),se=O.rotate(W),me=new h.P(Math.max(Z.x,Y.x,se.x,q.x),Math.max(Z.y,Y.y,se.y,q.y)),Q=new h.P(Math.min(Z.x,Y.x,se.x,q.x),Math.min(Z.y,Y.y,se.y,q.y)),ce=me.sub(Q),ge=(b.width-(w.left+w.right+c.padding.left+c.padding.right))/ce.x,xe=(b.height-(w.top+w.bottom+c.padding.top+c.padding.bottom))/ce.y;if(xe<0||ge<0)return void h.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const be=Math.min(b.scaleZoom(b.scale*Math.min(ge,xe)),c.maxZoom),ze=h.P.convert(c.offset),ke=new h.P((c.padding.left-c.padding.right)/2,(c.padding.top-c.padding.bottom)/2).rotate(h.b8(l)),Ne=ze.add(ke).mult(b.scale/b.zoomScale(be));return{center:b.unproject(E.add(k).div(2).sub(Ne)),zoom:be,bearing:l}}fitBounds(t,s,l){return this._fitInternal(this.cameraForBounds(t,s),s,l)}fitScreenCoordinates(t,s,l,c,f){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(h.P.convert(t)),this.transform.pointLocation(h.P.convert(s)),l,c),c,f)}_fitInternal(t,s,l){return t?(delete(s=h.e(t,s)).padding,s.linear?this.easeTo(s,l):this.flyTo(s,l)):this}jumpTo(t,s){this.stop();const l=this._getTransformForUpdate();let c=!1,f=!1,b=!1;return"zoom"in t&&l.zoom!==+t.zoom&&(c=!0,l.zoom=+t.zoom),t.center!==void 0&&(l.center=h.M.convert(t.center)),"bearing"in t&&l.bearing!==+t.bearing&&(f=!0,l.bearing=+t.bearing),"pitch"in t&&l.pitch!==+t.pitch&&(b=!0,l.pitch=+t.pitch),t.padding==null||l.isPaddingEqual(t.padding)||(l.padding=t.padding),this._applyUpdatedTransform(l),this.fire(new h.k("movestart",s)).fire(new h.k("move",s)),c&&this.fire(new h.k("zoomstart",s)).fire(new h.k("zoom",s)).fire(new h.k("zoomend",s)),f&&this.fire(new h.k("rotatestart",s)).fire(new h.k("rotate",s)).fire(new h.k("rotateend",s)),b&&this.fire(new h.k("pitchstart",s)).fire(new h.k("pitch",s)).fire(new h.k("pitchend",s)),this.fire(new h.k("moveend",s))}calculateCameraOptionsFromTo(t,s,l,c=0){const f=h.Y.fromLngLat(t,s),b=h.Y.fromLngLat(l,c),w=b.x-f.x,A=b.y-f.y,E=b.z-f.z,M=Math.hypot(w,A,E);if(M===0)throw new Error("Can't calculate camera options with same From and To");const k=Math.hypot(w,A),O=this.transform.scaleZoom(this.transform.cameraToCenterDistance/M/this.transform.tileSize),W=180*Math.atan2(w,-A)/Math.PI;let Z=180*Math.acos(k/M)/Math.PI;return Z=E<0?90-Z:90+Z,{center:b.toLngLat(),zoom:O,pitch:Z,bearing:W}}easeTo(t,s){var l;this._stop(!1,t.easeId),((t=h.e({offset:[0,0],duration:500,easing:h.b7},t)).animate===!1||!t.essential&&N.prefersReducedMotion)&&(t.duration=0);const c=this._getTransformForUpdate(),f=this.getZoom(),b=this.getBearing(),w=this.getPitch(),A=this.getPadding(),E="bearing"in t?this._normalizeBearing(t.bearing,b):b,M="pitch"in t?+t.pitch:w,k="padding"in t?t.padding:c.padding,O=h.P.convert(t.offset);let W=c.centerPoint.add(O);const Z=c.pointLocation(W),{center:Y,zoom:q}=c.getConstrained(h.M.convert(t.center||Z),(l=t.zoom)!==null&&l!==void 0?l:f);this._normalizeCenter(Y);const se=c.project(Z),me=c.project(Y).sub(se),Q=c.zoomScale(q-f);let ce,ge;t.around&&(ce=h.M.convert(t.around),ge=c.locationPoint(ce));const xe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||q!==f,this._rotating=this._rotating||b!==E,this._pitching=this._pitching||M!==w,this._padding=!c.isPaddingEqual(k),this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,xe),this.terrain&&this._prepareElevation(Y),this._ease(be=>{if(this._zooming&&(c.zoom=h.z.number(f,q,be)),this._rotating&&(c.bearing=h.z.number(b,E,be)),this._pitching&&(c.pitch=h.z.number(w,M,be)),this._padding&&(c.interpolatePadding(A,k,be),W=c.centerPoint.add(O)),this.terrain&&!t.freezeElevation&&this._updateElevation(be),ce)c.setLocationAtPoint(ce,ge);else{const ze=c.zoomScale(c.zoom-f),ke=q>f?Math.min(2,Q):Math.max(.5,Q),Ne=Math.pow(ke,1-be),je=c.unproject(se.add(me.mult(be*Ne)).mult(ze));c.setLocationAtPoint(c.renderWorldCopies?je.wrap():je,W)}this._applyUpdatedTransform(c),this._fireMoveEvents(s)},be=>{this.terrain&&this._finalizeElevation(),this._afterEase(s,be)},t),this}_prepareEase(t,s,l={}){this._moving=!0,s||l.moving||this.fire(new h.k("movestart",t)),this._zooming&&!l.zooming&&this.fire(new h.k("zoomstart",t)),this._rotating&&!l.rotating&&this.fire(new h.k("rotatestart",t)),this._pitching&&!l.pitching&&this.fire(new h.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&s!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(l-(s-(l*t+this._elevationStart))/(1-t)),this._elevationTarget=s}this.transform.elevation=h.z.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const s=t.clone(),{center:l,zoom:c,pitch:f,bearing:b,elevation:w}=this.transformCameraUpdate(s);l&&(s.center=l),c!==void 0&&(s.zoom=c),f!==void 0&&(s.pitch=f),b!==void 0&&(s.bearing=b),w!==void 0&&(s.elevation=w),this.transform.apply(s)}_fireMoveEvents(t){this.fire(new h.k("move",t)),this._zooming&&this.fire(new h.k("zoom",t)),this._rotating&&this.fire(new h.k("rotate",t)),this._pitching&&this.fire(new h.k("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const l=this._zooming,c=this._rotating,f=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,l&&this.fire(new h.k("zoomend",t)),c&&this.fire(new h.k("rotateend",t)),f&&this.fire(new h.k("pitchend",t)),this.fire(new h.k("moveend",t))}flyTo(t,s){var l;if(!t.essential&&N.prefersReducedMotion){const Kt=h.L(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Kt,s)}this.stop(),t=h.e({offset:[0,0],speed:1.2,curve:1.42,easing:h.b7},t);const c=this._getTransformForUpdate(),f=this.getZoom(),b=this.getBearing(),w=this.getPitch(),A=this.getPadding(),E="bearing"in t?this._normalizeBearing(t.bearing,b):b,M="pitch"in t?+t.pitch:w,k="padding"in t?t.padding:c.padding,O=h.P.convert(t.offset);let W=c.centerPoint.add(O);const Z=c.pointLocation(W),{center:Y,zoom:q}=c.getConstrained(h.M.convert(t.center||Z),(l=t.zoom)!==null&&l!==void 0?l:f);this._normalizeCenter(Y);const se=c.zoomScale(q-f),me=c.project(Z),Q=c.project(Y).sub(me);let ce=t.curve;const ge=Math.max(c.width,c.height),xe=ge/se,be=Q.mag();if("minZoom"in t){const Kt=h.ac(Math.min(t.minZoom,f,q),c.minZoom,c.maxZoom),At=ge/c.zoomScale(Kt-f);ce=Math.sqrt(At/be*2)}const ze=ce*ce;function ke(Kt){const At=(xe*xe-ge*ge+(Kt?-1:1)*ze*ze*be*be)/(2*(Kt?xe:ge)*ze*be);return Math.log(Math.sqrt(At*At+1)-At)}function Ne(Kt){return(Math.exp(Kt)-Math.exp(-Kt))/2}function je(Kt){return(Math.exp(Kt)+Math.exp(-Kt))/2}const Rt=ke(!1);let Ge=function(Kt){return je(Rt)/je(Rt+ce*Kt)},wt=function(Kt){return ge*((je(Rt)*(Ne(At=Rt+ce*Kt)/je(At))-Ne(Rt))/ze)/be;var At},Lt=(ke(!0)-Rt)/ce;if(Math.abs(be)<1e-6||!isFinite(Lt)){if(Math.abs(ge-xe)<1e-6)return this.easeTo(t,s);const Kt=xe<ge?-1:1;Lt=Math.abs(Math.log(xe/ge))/ce,wt=function(){return 0},Ge=function(At){return Math.exp(Kt*ce*At)}}return t.duration="duration"in t?+t.duration:1e3*Lt/("screenSpeed"in t?+t.screenSpeed/ce:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=b!==E,this._pitching=M!==w,this._padding=!c.isPaddingEqual(k),this._prepareEase(s,!1),this.terrain&&this._prepareElevation(Y),this._ease(Kt=>{const At=Kt*Lt,Ot=1/Ge(At);c.zoom=Kt===1?q:f+c.scaleZoom(Ot),this._rotating&&(c.bearing=h.z.number(b,E,Kt)),this._pitching&&(c.pitch=h.z.number(w,M,Kt)),this._padding&&(c.interpolatePadding(A,k,Kt),W=c.centerPoint.add(O)),this.terrain&&!t.freezeElevation&&this._updateElevation(Kt);const $t=Kt===1?Y:c.unproject(me.add(Q.mult(wt(At))).mult(Ot));c.setLocationAtPoint(c.renderWorldCopies?$t.wrap():$t,W),this._applyUpdatedTransform(c),this._fireMoveEvents(s)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(s)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const l=this._onEaseEnd;delete this._onEaseEnd,l.call(this,s)}if(!t){const l=this.handlers;l&&l.stop(!1)}return this}_ease(t,s,l){l.animate===!1||l.duration===0?(t(1),s()):(this._easeStart=N.now(),this._easeOptions=l,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,s){t=h.b1(t,-180,180);const l=Math.abs(t-s);return Math.abs(t-360-s)<l&&(t-=360),Math.abs(t+360-s)<l&&(t+=360),t}_normalizeCenter(t){const s=this.transform;if(!s.renderWorldCopies||s.lngRange)return;const l=t.lng-s.center.lng;t.lng+=l>180?-360:l<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(h.M.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}const Dl={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class mn{constructor(t=Dl){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=V.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=V.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=V.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){V.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,s){const l=this._map._getUIString(`AttributionControl.${s}`);t.title=l,t.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(c=>typeof c!="string"?"":c)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}const s=this._map.style.sourceCaches;for(const c in s){const f=s[c];if(f.used||f.usedForTerrain){const b=f.getSource();b.attribution&&t.indexOf(b.attribution)<0&&t.push(b.attribution)}}t=t.filter(c=>String(c).trim()),t.sort((c,f)=>c.length-f.length),t=t.filter((c,f)=>{for(let b=f+1;b<t.length;b++)if(t[b].indexOf(c)>=0)return!1;return!0});const l=t.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,t.length?(this._innerContainer.innerHTML=l,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class xu{constructor(t={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const l=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=V.create("div","maplibregl-ctrl");const s=V.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){V.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Eo{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,l=s?this._queue.concat(s):this._queue;for(const c of l)if(c.id===t)return void(c.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const l of s)if(!l.cancelled&&(l.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Ri=h.X([{name:"a_pos3d",type:"Int16",components:3}]);class Ui extends h.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,s){this.sourceCache.update(t,s),this._renderableTilesKeys=[];const l={};for(const c of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))l[c.key]=!0,this._renderableTilesKeys.push(c.key),this._tiles[c.key]||(c.posMatrix=new Float64Array(16),h.aN(c.posMatrix,0,h.W,0,h.W,0,1),this._tiles[c.key]=new pi(c,this.tileSize));for(const c in this._tiles)l[c]||delete this._tiles[c]}freeRtt(t){for(const s in this._tiles){const l=this._tiles[s];(!t||l.tileID.equals(t)||l.tileID.isChildOf(t)||t.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const s={};for(const l of this._renderableTilesKeys){const c=this._tiles[l].tileID;if(c.canonical.equals(t.canonical)){const f=t.clone();f.posMatrix=new Float64Array(16),h.aN(f.posMatrix,0,h.W,0,h.W,0,1),s[l]=f}else if(c.canonical.isChildOf(t.canonical)){const f=t.clone();f.posMatrix=new Float64Array(16);const b=c.canonical.z-t.canonical.z,w=c.canonical.x-(c.canonical.x>>b<<b),A=c.canonical.y-(c.canonical.y>>b<<b),E=h.W>>b;h.aN(f.posMatrix,0,E,0,E,0,1),h.H(f.posMatrix,f.posMatrix,[-w*E,-A*E,0]),s[l]=f}else if(t.canonical.isChildOf(c.canonical)){const f=t.clone();f.posMatrix=new Float64Array(16);const b=t.canonical.z-c.canonical.z,w=t.canonical.x-(t.canonical.x>>b<<b),A=t.canonical.y-(t.canonical.y>>b<<b),E=h.W>>b;h.aN(f.posMatrix,0,h.W,0,h.W,0,1),h.H(f.posMatrix,f.posMatrix,[w*E,A*E,0]),h.J(f.posMatrix,f.posMatrix,[1/2**b,1/2**b,0]),s[l]=f}}return s}getSourceTile(t,s){const l=this.sourceCache._source;let c=t.overscaledZ-this.deltaZoom;if(c>l.maxzoom&&(c=l.maxzoom),c<l.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(c).key);let f=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!f||!f.dem)&&s)for(;c>=l.minzoom&&(!f||!f.dem);)f=this.sourceCache.getTileByID(t.scaledTo(c--).key);return f}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(s=>s.timeAdded>=t)}}class vu{constructor(t,s,l){this.painter=t,this.sourceCache=new Ui(s),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,s,l,c=h.W){var f;if(!(s>=0&&s<c&&l>=0&&l<c))return 0;const b=this.getTerrainData(t),w=(f=b.tile)===null||f===void 0?void 0:f.dem;if(!w)return 0;const A=function(Z,Y,q){var se=Y[0],me=Y[1];return Z[0]=q[0]*se+q[4]*me+q[12],Z[1]=q[1]*se+q[5]*me+q[13],Z}([],[s/c*h.W,l/c*h.W],b.u_terrain_matrix),E=[A[0]*w.dim,A[1]*w.dim],M=Math.floor(E[0]),k=Math.floor(E[1]),O=E[0]-M,W=E[1]-k;return w.get(M,k)*(1-O)*(1-W)+w.get(M+1,k)*O*(1-W)+w.get(M,k+1)*(1-O)*W+w.get(M+1,k+1)*O*W}getElevationForLngLatZoom(t,s){const{tileID:l,mercatorX:c,mercatorY:f}=this._getOverscaledTileIDFromLngLatZoom(t,s);return this.getElevation(l,c%h.W,f%h.W,h.W)}getElevation(t,s,l,c=h.W){return this.getDEMElevation(t,s,l,c)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const c=this.painter.context,f=new h.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new vt(c,f,c.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new vt(c,new h.R({width:1,height:1}),c.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=h.an([])}const s=this.sourceCache.getSourceTile(t,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const c=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new vt(c,s.dem.getPixels(),c.gl.RGBA,{premultiply:!1}),s.demTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const l=s&&s+s.tileID.key+t.key;if(l&&!this._demMatrixCache[l]){const c=this.sourceCache.sourceCache._source.maxzoom;let f=t.canonical.z-s.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=c?f=t.canonical.z-c:h.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const b=t.canonical.x-(t.canonical.x>>f<<f),w=t.canonical.y-(t.canonical.y>>f<<f),A=h.b9(new Float64Array(16),[1/(h.W<<f),1/(h.W<<f),0]);h.H(A,A,[b*h.W,w*h.W,0]),this._demMatrixCache[t.key]={matrix:A,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(t){const s=this.painter,l=s.width/devicePixelRatio,c=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===c||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new vt(s.context,{width:l,height:c,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new vt(s.context,{width:l,height:c,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(l,c,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,l,c))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let f=0,b=0;f<this._coordsTextureSize;f++)for(let w=0;w<this._coordsTextureSize;w++,b+=4)s[b+0]=255&w,s[b+1]=255&f,s[b+2]=w>>8<<4|f>>8,s[b+3]=0;const l=new h.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),c=new vt(t,l,t.gl.RGBA,{premultiply:!1});return c.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=c,c}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const s=new Uint8Array(4),l=this.painter.context,c=l.gl,f=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),b=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),w=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),c.readPixels(f,w-b-1,1,1,c.RGBA,c.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null);const A=s[0]+(s[2]>>4<<8),E=s[1]+((15&s[2])<<8),M=this.coordsIndex[255-s[3]],k=M&&this.sourceCache.getTileByID(M);if(!k)return null;const O=this._coordsTextureSize,W=(1<<k.tileID.canonical.z)*O;return new h.Y((k.tileID.canonical.x*O+A)/W+k.tileID.wrap,(k.tileID.canonical.y*O+E)/W,this.getElevation(k.tileID,A,E,O))}depthAtPoint(t){const s=new Uint8Array(4),l=this.painter.context,c=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),c.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null),(s[0]/16777216+s[1]/65536+s[2]/256+s[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,s=new h.ba,l=new h.aX,c=this.meshSize,f=h.W/c,b=c*c;for(let k=0;k<=c;k++)for(let O=0;O<=c;O++)s.emplaceBack(O*f,k*f,0);for(let k=0;k<b;k+=c+1)for(let O=0;O<c;O++)l.emplaceBack(O+k,c+O+k+1,c+O+k+2),l.emplaceBack(O+k,c+O+k+2,O+k+1);const w=s.length,A=w+2*(c+1);for(const k of[0,1])for(let O=0;O<=c;O++)for(const W of[0,1])s.emplaceBack(O*f,k*h.W,W);for(let k=0;k<2*c;k+=2)l.emplaceBack(A+k,A+k+1,A+k+3),l.emplaceBack(A+k,A+k+3,A+k+2),l.emplaceBack(w+k,w+k+3,w+k+1),l.emplaceBack(w+k,w+k+2,w+k+3);const E=s.length,M=E+2*(c+1);for(const k of[0,1])for(let O=0;O<=c;O++)for(const W of[0,1])s.emplaceBack(k*h.W,O*f,W);for(let k=0;k<2*c;k+=2)l.emplaceBack(E+k,E+k+1,E+k+3),l.emplaceBack(E+k,E+k+3,E+k+2),l.emplaceBack(M+k,M+k+3,M+k+1),l.emplaceBack(M+k,M+k+2,M+k+3);return this._mesh={indexBuffer:t.createIndexBuffer(l),vertexBuffer:t.createVertexBuffer(s,Ri.members),segments:h.$.simpleSegment(0,0,s.length,l.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*h.bb/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,s){var l;const{tileID:c}=this._getOverscaledTileIDFromLngLatZoom(t,s);return(l=this.getMinMaxElevation(c).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(t){const s=this.getTerrainData(t).tile,l={minElevation:null,maxElevation:null};return s&&s.dem&&(l.minElevation=s.dem.min*this.exaggeration,l.maxElevation=s.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(t,s){const l=h.Y.fromLngLat(t.wrap()),c=(1<<s)*h.W,f=l.x*c,b=l.y*c,w=Math.floor(f/h.W),A=Math.floor(b/h.W);return{tileID:new h.Q(s,0,s,w,A),mercatorX:f,mercatorY:b}}}class Po{constructor(t,s,l){this._context=t,this._size=s,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new vt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(l.texture),{id:t,fbo:s,texture:l,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(s=>t.id!==s),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const Dn={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class zl{constructor(t,s){this.painter=t,this.terrain=s,this.pool=new Po(t.context,30,s.sourceCache.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(l=>!t._layers[l].isHidden(s)),this._coordsDescendingInv={};for(const l in t.sourceCaches){this._coordsDescendingInv[l]={};const c=t.sourceCaches[l].getVisibleCoordinates();for(const f of c){const b=this.terrain.sourceCache.getTerrainCoords(f);for(const w in b)this._coordsDescendingInv[l][w]||(this._coordsDescendingInv[l][w]=[]),this._coordsDescendingInv[l][w].push(b[w])}}this._coordsDescendingInvStr={};for(const l of t._order){const c=t._layers[l],f=c.source;if(Dn[c.type]&&!this._coordsDescendingInvStr[f]){this._coordsDescendingInvStr[f]={};for(const b in this._coordsDescendingInv[f])this._coordsDescendingInvStr[f][b]=this._coordsDescendingInv[f][b].map(w=>w.key).sort().join()}}for(const l of this._renderableTiles)for(const c in this._coordsDescendingInvStr){const f=this._coordsDescendingInvStr[c][l.tileID.key];f&&f!==l.rttCoords[c]&&(l.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const s=t.type,l=this.painter,c=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Dn[s]&&(this._prevType&&Dn[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(t.id),!c))return!0;if(Dn[this._prevType]||Dn[s]&&c){this._prevType=s;const f=this._stacks.length-1,b=this._stacks[f]||[];for(const w of this._renderableTiles){if(this.pool.isFull()&&(xa(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(w),w.rtt[f]){const E=this.pool.getObjectForId(w.rtt[f].id);if(E.stamp===w.rtt[f].stamp){this.pool.useObject(E);continue}}const A=this.pool.getOrCreateFreeObject();this.pool.useObject(A),this.pool.stampObject(A),w.rtt[f]={id:A.id,stamp:A.stamp},l.context.bindFramebuffer.set(A.fbo.framebuffer),l.context.clear({color:h.aO.transparent,stencil:0}),l.currentStencilSource=void 0;for(let E=0;E<b.length;E++){const M=l.style._layers[b[E]],k=M.source?this._coordsDescendingInv[M.source][w.tileID.key]:[w.tileID];l.context.viewport.set([0,0,A.fbo.width,A.fbo.height]),l._renderTileClippingMasks(M,k),l.renderLayer(l,l.style.sourceCaches[M.source],M,k),M.source&&(w.rttCoords[M.source]=this._coordsDescendingInvStr[M.source][w.tileID.key])}}return xa(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Dn[s]}return!1}}const Rl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ll=L,Co={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Dl,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:h.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Ia=p=>{p.touchstart=p.dragStart,p.touchmoveWindow=p.dragMove,p.touchend=p.dragEnd},Fl={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ol{constructor(t,s,l=!1){this.mousedown=b=>{this.startMouse(h.e({},b,{ctrlKey:!0,preventDefault:()=>b.preventDefault()}),V.mousePos(this.element,b)),V.addEventListener(window,"mousemove",this.mousemove),V.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=b=>{this.moveMouse(b,V.mousePos(this.element,b))},this.mouseup=b=>{this.mouseRotate.dragEnd(b),this.mousePitch&&this.mousePitch.dragEnd(b),this.offTemp()},this.touchstart=b=>{b.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=V.touchPos(this.element,b.targetTouches)[0],this.startTouch(b,this._startPos),V.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),V.addEventListener(window,"touchend",this.touchend))},this.touchmove=b=>{b.targetTouches.length!==1?this.reset():(this._lastPos=V.touchPos(this.element,b.targetTouches)[0],this.moveTouch(b,this._lastPos))},this.touchend=b=>{b.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const c=t.dragRotate._mouseRotate.getClickTolerance(),f=t.dragRotate._mousePitch.getClickTolerance();this.element=s,this.mouseRotate=Ns({clickTolerance:c,enable:!0}),this.touchRotate=(({enable:b,clickTolerance:w,bearingDegreesPerPixelMoved:A=.8})=>{const E=new it;return new Bs({clickTolerance:w,move:(M,k)=>({bearingDelta:(k.x-M.x)*A}),moveStateManager:E,enable:b,assignEvents:Ia})})({clickTolerance:c,enable:!0}),this.map=t,l&&(this.mousePitch=Vs({clickTolerance:f,enable:!0}),this.touchPitch=(({enable:b,clickTolerance:w,pitchDegreesPerPixelMoved:A=-.5})=>{const E=new it;return new Bs({clickTolerance:w,move:(M,k)=>({pitchDelta:(k.y-M.y)*A}),moveStateManager:E,enable:b,assignEvents:Ia})})({clickTolerance:f,enable:!0})),V.addEventListener(s,"mousedown",this.mousedown),V.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),V.addEventListener(s,"touchcancel",this.reset)}startMouse(t,s){this.mouseRotate.dragStart(t,s),this.mousePitch&&this.mousePitch.dragStart(t,s),V.disableDrag()}startTouch(t,s){this.touchRotate.dragStart(t,s),this.touchPitch&&this.touchPitch.dragStart(t,s),V.disableDrag()}moveMouse(t,s){const l=this.map,{bearingDelta:c}=this.mouseRotate.dragMove(t,s)||{};if(c&&l.setBearing(l.getBearing()+c),this.mousePitch){const{pitchDelta:f}=this.mousePitch.dragMove(t,s)||{};f&&l.setPitch(l.getPitch()+f)}}moveTouch(t,s){const l=this.map,{bearingDelta:c}=this.touchRotate.dragMove(t,s)||{};if(c&&l.setBearing(l.getBearing()+c),this.touchPitch){const{pitchDelta:f}=this.touchPitch.dragMove(t,s)||{};f&&l.setPitch(l.getPitch()+f)}}off(){const t=this.element;V.removeEventListener(t,"mousedown",this.mousedown),V.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),V.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),V.removeEventListener(window,"touchend",this.touchend),V.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){V.enableDrag(),V.removeEventListener(window,"mousemove",this.mousemove),V.removeEventListener(window,"mouseup",this.mouseup),V.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),V.removeEventListener(window,"touchend",this.touchend)}}let zn;function Ea(p,t,s){const l=new h.M(p.lng,p.lat);if(p=new h.M(p.lng,p.lat),t){const c=new h.M(p.lng-360,p.lat),f=new h.M(p.lng+360,p.lat),b=s.locationPoint(p).distSqr(t);s.locationPoint(c).distSqr(t)<b?p=c:s.locationPoint(f).distSqr(t)<b&&(p=f)}for(;Math.abs(p.lng-s.center.lng)>180;){const c=s.locationPoint(p);if(c.x>=0&&c.y>=0&&c.x<=s.width&&c.y<=s.height)break;p.lng>s.center.lng?p.lng-=360:p.lng+=360}return p.lng!==l.lng&&s.locationPoint(p).y>s.height/2-s.getHorizon()?p:l}const Mo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Pa(p,t,s){const l=p.classList;for(const c in Mo)l.remove(`maplibregl-${s}-anchor-${c}`);l.add(`maplibregl-${s}-anchor-${t}`)}class ko extends h.E{constructor(t){if(super(),this._onKeyPress=s=>{const l=s.code,c=s.charCode||s.keyCode;l!=="Space"&&l!=="Enter"&&c!==32&&c!==13||this.togglePopup()},this._onMapClick=s=>{const l=s.originalEvent.target,c=this._element;this._popup&&(l===c||c.contains(l))&&this.togglePopup()},this._update=s=>{var l;if(!this._map)return;const c=this._map.loaded()&&!this._map.isMoving();((s==null?void 0:s.type)==="terrain"||(s==null?void 0:s.type)==="render"&&!c)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Ea(this._lngLat,this._flatPos,this._map.transform):(l=this._lngLat)===null||l===void 0?void 0:l.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let f="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?f=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(f=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let b="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?b="rotateX(0deg)":this._pitchAlignment==="map"&&(b=`rotateX(${this._map.getPitch()}deg)`),s&&s.type!=="moveend"||(this._pos=this._pos.round()),V.setTransform(this._element,`${Mo[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${b} ${f}`),N.frameAsync(new AbortController).then(()=>{this._updateOpacity(s&&s.type==="moveend")}).catch(()=>{})},this._onMove=s=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new h.k("dragstart"))),this.fire(new h.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new h.k("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(t==null?void 0:t.opacity,t==null?void 0:t.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=h.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=V.create("div"),this._element.setAttribute("aria-label","Map marker");const s=V.createNS("http://www.w3.org/2000/svg","svg"),l=41,c=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${l}px`),s.setAttributeNS(null,"width",`${c}px`),s.setAttributeNS(null,"viewBox",`0 0 ${c} ${l}`);const f=V.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"stroke","none"),f.setAttributeNS(null,"stroke-width","1"),f.setAttributeNS(null,"fill","none"),f.setAttributeNS(null,"fill-rule","evenodd");const b=V.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"fill-rule","nonzero");const w=V.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const A=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const se of A){const me=V.createNS("http://www.w3.org/2000/svg","ellipse");me.setAttributeNS(null,"opacity","0.04"),me.setAttributeNS(null,"cx","10.5"),me.setAttributeNS(null,"cy","5.80029008"),me.setAttributeNS(null,"rx",se.rx),me.setAttributeNS(null,"ry",se.ry),w.appendChild(me)}const E=V.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill",this._color);const M=V.createNS("http://www.w3.org/2000/svg","path");M.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),E.appendChild(M);const k=V.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"opacity","0.25"),k.setAttributeNS(null,"fill","#000000");const O=V.createNS("http://www.w3.org/2000/svg","path");O.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),k.appendChild(O);const W=V.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"transform","translate(6.0, 7.0)"),W.setAttributeNS(null,"fill","#FFFFFF");const Z=V.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Y=V.createNS("http://www.w3.org/2000/svg","circle");Y.setAttributeNS(null,"fill","#000000"),Y.setAttributeNS(null,"opacity","0.25"),Y.setAttributeNS(null,"cx","5.5"),Y.setAttributeNS(null,"cy","5.5"),Y.setAttributeNS(null,"r","5.4999962");const q=V.createNS("http://www.w3.org/2000/svg","circle");q.setAttributeNS(null,"fill","#FFFFFF"),q.setAttributeNS(null,"cx","5.5"),q.setAttributeNS(null,"cy","5.5"),q.setAttributeNS(null,"r","5.4999962"),Z.appendChild(Y),Z.appendChild(q),b.appendChild(w),b.appendChild(E),b.appendChild(k),b.appendChild(W),b.appendChild(Z),s.appendChild(b),s.setAttributeNS(null,"height",l*this._scale+"px"),s.setAttributeNS(null,"width",c*this._scale+"px"),this._element.appendChild(s),this._offset=h.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",s=>{s.preventDefault()}),this._element.addEventListener("mousedown",s=>{s.preventDefault()}),Pa(this._element,this._anchor,"marker"),t&&t.className)for(const s of t.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),V.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=h.M.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const c=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[c,-1*(38.1-13.5+c)],"bottom-right":[-c,-1*(38.1-13.5+c)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var s,l;if(!(!((s=this._map)===null||s===void 0)&&s.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const c=this._map,f=c.terrain.depthAtPoint(this._pos),b=c.terrain.getElevationForLngLatZoom(this._lngLat,c.transform.tileZoom);if(c.transform.lngLatToCameraDepth(this._lngLat,b)-f<.006)return void(this._element.style.opacity=this._opacity);const w=-this._offset.y/c.transform._pixelPerMeter,A=Math.sin(c.getPitch()*Math.PI/180)*w,E=c.terrain.depthAtPoint(new h.P(this._pos.x,this._pos.y-this._offset.y)),M=c.transform.lngLatToCameraDepth(this._lngLat,b+A)-E>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&M&&this._popup.remove(),this._element.style.opacity=M?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=h.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,s){return t===void 0&&s===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),s!==void 0&&(this._opacityWhenCovered=s),this._map&&this._updateOpacity(!0),this}}const Ca={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Us=0,ms=!1;const Ma={maxWidth:100,unit:"metric"};function ka(p,t,s){const l=s&&s.maxWidth||100,c=p._container.clientHeight/2,f=p.unproject([0,c]),b=p.unproject([l,c]),w=f.distanceTo(b);if(s&&s.unit==="imperial"){const A=3.2808*w;A>5280?gs(t,l,A/5280,p._getUIString("ScaleControl.Miles")):gs(t,l,A,p._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?gs(t,l,w/1852,p._getUIString("ScaleControl.NauticalMiles")):w>=1e3?gs(t,l,w/1e3,p._getUIString("ScaleControl.Kilometers")):gs(t,l,w,p._getUIString("ScaleControl.Meters"))}function gs(p,t,s,l){const c=function(f){const b=Math.pow(10,`${Math.floor(f)}`.length-1);let w=f/b;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:function(A){const E=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*E)/E}(w),b*w}(s);p.style.width=t*(c/s)+"px",p.innerHTML=`${c}&nbsp;${l}`}const Bl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Nl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Da(p){if(p){if(typeof p=="number"){const t=Math.round(Math.abs(p)/Math.SQRT2);return{center:new h.P(0,0),top:new h.P(0,p),"top-left":new h.P(t,t),"top-right":new h.P(-t,t),bottom:new h.P(0,-p),"bottom-left":new h.P(t,-t),"bottom-right":new h.P(-t,-t),left:new h.P(p,0),right:new h.P(-p,0)}}if(p instanceof h.P||Array.isArray(p)){const t=h.P.convert(p);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:h.P.convert(p.center||[0,0]),top:h.P.convert(p.top||[0,0]),"top-left":h.P.convert(p["top-left"]||[0,0]),"top-right":h.P.convert(p["top-right"]||[0,0]),bottom:h.P.convert(p.bottom||[0,0]),"bottom-left":h.P.convert(p["bottom-left"]||[0,0]),"bottom-right":h.P.convert(p["bottom-right"]||[0,0]),left:h.P.convert(p.left||[0,0]),right:h.P.convert(p.right||[0,0])}}return Da(new h.P(0,0))}const bu=L;v.AJAXError=h.be,v.Evented=h.E,v.LngLat=h.M,v.MercatorCoordinate=h.Y,v.Point=h.P,v.addProtocol=h.bf,v.config=h.a,v.removeProtocol=h.bg,v.AttributionControl=mn,v.BoxZoomHandler=pn,v.CanvasSource=nt,v.CooperativeGesturesHandler=ut,v.DoubleClickZoomHandler=Ml,v.DragPanHandler=yu,v.DragRotateHandler=fn,v.EdgeInsets=Fs,v.FullscreenControl=class extends h.E{constructor(p={}){super(),this._onFullscreenChange=()=>{var t;let s=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=s==null?void 0:s.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)s=s.shadowRoot.fullscreenElement;s===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:h.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){V.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const p=this._fullscreenButton=V.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);V.create("span","maplibregl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.title=p}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new h.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new h.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},v.GeoJSONSource=et,v.GeolocateControl=class extends h.E{constructor(p){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new h.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new h.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const s=new h.M(t.coords.longitude,t.coords.latitude),l=t.coords.accuracy,c=this._map.getBearing(),f=h.e({bearing:c},this.options.fitBoundsOptions),b=ie.fromLngLat(s,l);this._map.fitBounds(b,f,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const s=new h.M(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&ms)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new h.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=V.create("button","maplibregl-ctrl-geolocate",this._container),V.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){h.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=V.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new ko({element:this._dotElement}),this._circleElement=V.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ko({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new h.k("trackuserlocationend")))})}},this.options=h.e({},Ca,p)}onAdd(p){return this._map=p,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return h._(this,arguments,void 0,function*(t=!1){if(zn!==void 0&&!t)return zn;if(window.navigator.permissions===void 0)return zn=!!window.navigator.geolocation,zn;try{zn=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{zn=!!window.navigator.geolocation}return zn})}().then(t=>this._setupUI(t)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),V.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Us=0,ms=!1}_isOutOfMapMaxBounds(p){const t=this._map.getMaxBounds(),s=p.coords;return t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const p=this._map.getBounds(),t=p.getSouthEast(),s=p.getNorthEast(),l=t.distanceTo(s),c=Math.ceil(this._accuracy/(l/this._map._container.clientHeight)*2);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}trigger(){if(!this._setup)return h.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new h.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Us--,ms=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new h.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new h.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Us++,Us>1?(p={maximumAge:6e5,timeout:0},ms=!0):(p=this.options.positionOptions,ms=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},v.Hash=Il,v.ImageSource=Oe,v.KeyboardHandler=Wn,v.LngLatBounds=ie,v.LogoControl=xu,v.Map=class extends Lr{constructor(p){if(h.bc.mark(h.bd.create),(p=h.e({},Co,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new va(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),{bearingSnap:p.bearingSnap}),this._contextLost=t=>{t.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new h.k("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new h.k("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=p.interactive,this._maxTileCacheSize=p.maxTileCacheSize,this._maxTileCacheZoomLevels=p.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._renderTaskQueue=new Eo,this._controls=[],this._mapId=h.a3(),this._locale=h.e({},Rl,p.locale),this._clickTolerance=p.clickTolerance,this._overridePixelRatio=p.pixelRatio,this._maxCanvasSize=p.maxCanvasSize,this.transformCameraUpdate=p.transformCameraUpdate,this._imageQueueHandle=ye.addThrottleControl(()=>this.isMoving()),this._requestManager=new Be(p.transformRequest),typeof p.container=="string"){if(this._container=document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(p.maxBounds&&this.setMaxBounds(p.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let t=!1;const s=Al(l=>{this._trackResize&&!this._removed&&this.resize(l)._update()},50);this._resizeObserver=new ResizeObserver(l=>{t?s(l):t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new kl(this,p),this._hash=p.hash&&new Il(typeof p.hash=="string"&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,h.e({},p.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=p.localIdeographFontFamily,this._validateStyle=p.validateStyle,p.style&&this.setStyle(p.style,{localIdeographFontFamily:p.localIdeographFontFamily}),p.attributionControl&&this.addControl(new mn(typeof p.attributionControl=="boolean"?void 0:p.attributionControl)),p.maplibreLogo&&this.addControl(new xu,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new h.k(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new h.k(`${t.dataType}dataloading`,t))}),this.on("dataabort",t=>{this.fire(new h.k("sourcedataabort",t))})}_getMapId(){return this._mapId}addControl(p,t){if(t===void 0&&(t=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new h.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=p.onAdd(this);this._controls.push(p);const l=this._controlPositions[t];return t.indexOf("bottom")!==-1?l.insertBefore(s,l.firstChild):l.appendChild(s),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new h.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(p);return t>-1&&this._controls.splice(t,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}calculateCameraOptionsFromTo(p,t,s,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(p,t,s,l)}resize(p){var t;const s=this._containerDimensions(),l=s[0],c=s[1],f=this._getClampedPixelRatio(l,c);if(this._resizeCanvas(l,c,f),this.painter.resize(l,c,f),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const A=this._getClampedPixelRatio(l,c);this._resizeCanvas(l,c,A),this.painter.resize(l,c,A)}this.transform.resize(l,c),(t=this._requestedCameraState)===null||t===void 0||t.resize(l,c);const b=!this._moving;return b&&(this.stop(),this.fire(new h.k("movestart",p)).fire(new h.k("move",p))),this.fire(new h.k("resize",p)),b&&this.fire(new h.k("moveend",p)),this}_getClampedPixelRatio(p,t){const{0:s,1:l}=this._maxCanvasSize,c=this.getPixelRatio(),f=p*c,b=t*c;return Math.min(f>s?s/f:1,b>l?l/b:1)*c}getPixelRatio(){var p;return(p=this._overridePixelRatio)!==null&&p!==void 0?p:devicePixelRatio}setPixelRatio(p){this._overridePixelRatio=p,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(p){return this.transform.setMaxBounds(ie.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p&&this.setZoom(p),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p&&this.setZoom(p),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p&&this.setPitch(p),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p&&this.setPitch(p),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}project(p){return this.transform.locationPoint(h.M.convert(p),this.style&&this.terrain)}unproject(p){return this.transform.pointLocation(h.P.convert(p),this.terrain)}isMoving(){var p;return this._moving||((p=this.handlers)===null||p===void 0?void 0:p.isMoving())}isZooming(){var p;return this._zooming||((p=this.handlers)===null||p===void 0?void 0:p.isZooming())}isRotating(){var p;return this._rotating||((p=this.handlers)===null||p===void 0?void 0:p.isRotating())}_createDelegatedListener(p,t,s){if(p==="mouseenter"||p==="mouseover"){let l=!1;return{layer:t,listener:s,delegates:{mousemove:f=>{const b=this.getLayer(t)?this.queryRenderedFeatures(f.point,{layers:[t]}):[];b.length?l||(l=!0,s.call(this,new Rr(p,this,f.originalEvent,{features:b}))):l=!1},mouseout:()=>{l=!1}}}}if(p==="mouseleave"||p==="mouseout"){let l=!1;return{layer:t,listener:s,delegates:{mousemove:b=>{(this.getLayer(t)?this.queryRenderedFeatures(b.point,{layers:[t]}):[]).length?l=!0:l&&(l=!1,s.call(this,new Rr(p,this,b.originalEvent)))},mouseout:b=>{l&&(l=!1,s.call(this,new Rr(p,this,b.originalEvent)))}}}}{const l=c=>{const f=this.getLayer(t)?this.queryRenderedFeatures(c.point,{layers:[t]}):[];f.length&&(c.features=f,s.call(this,c),delete c.features)};return{layer:t,listener:s,delegates:{[p]:l}}}}on(p,t,s){if(s===void 0)return super.on(p,t);const l=this._createDelegatedListener(p,t,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(l);for(const c in l.delegates)this.on(c,l.delegates[c]);return this}once(p,t,s){if(s===void 0)return super.once(p,t);const l=this._createDelegatedListener(p,t,s);for(const c in l.delegates)this.once(c,l.delegates[c]);return this}off(p,t,s){return s===void 0?super.off(p,t):(this._delegatedListeners&&this._delegatedListeners[p]&&(l=>{const c=this._delegatedListeners[p];for(let f=0;f<c.length;f++){const b=c[f];if(b.layer===t&&b.listener===s){for(const w in b.delegates)this.off(w,b.delegates[w]);return c.splice(f,1),this}}})(),this)}queryRenderedFeatures(p,t){if(!this.style)return[];let s;const l=p instanceof h.P||Array.isArray(p),c=l?p:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(l?{}:p)||{},c instanceof h.P||typeof c[0]=="number")s=[h.P.convert(c)];else{const f=h.P.convert(c[0]),b=h.P.convert(c[1]);s=[f,new h.P(b.x,f.y),b,new h.P(f.x,b.y),f]}return this.style.queryRenderedFeatures(s,t,this.transform)}querySourceFeatures(p,t){return this.style.querySourceFeatures(p,t)}setStyle(p,t){return(t=h.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&p?(this._diffStyle(p,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(p,t))}setTransformRequest(p){return this._requestManager.setTransformRequest(p),this}_getUIString(p){const t=this._locale[p];if(t==null)throw new Error(`Missing UI string '${p}'`);return t}_updateStyle(p,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(p,t));const s=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!p)),p?(this.style=new qr(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p,t,s):this.style.loadJSON(p,t,s),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new qr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,t){if(typeof p=="string"){const s=this._requestManager.transformRequest(p,"Style");h.h(s,new AbortController).then(l=>{this._updateDiff(l.data,t)}).catch(l=>{l&&this.fire(new h.j(l))})}else typeof p=="object"&&this._updateDiff(p,t)}_updateDiff(p,t){try{this.style.setState(p,t)&&this._update(!0)}catch(s){h.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(p,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():h.w("There is no style added to the map.")}addSource(p,t){return this._lazyInitEmptyStyle(),this.style.addSource(p,t),this._update(!0)}isSourceLoaded(p){const t=this.style&&this.style.sourceCaches[p];if(t!==void 0)return t.loaded();this.fire(new h.j(new Error(`There is no source with ID '${p}'`)))}setTerrain(p){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),p){const t=this.style.sourceCaches[p.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${p.source}`);this.terrain===null&&t.reload();for(const s in this.style._layers){const l=this.style._layers[s];l.type==="hillshade"&&l.source===p.source&&h.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new vu(this.painter,t,p),this.painter.renderToTexture=new zl(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=s=>{s.dataType==="style"?this.terrain.sourceCache.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==p.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new h.k("terrain",{terrain:p})),this}getTerrain(){var p,t;return(t=(p=this.terrain)===null||p===void 0?void 0:p.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const p=this.style&&this.style.sourceCaches;for(const t in p){const s=p[t]._tiles;for(const l in s){const c=s[l];if(c.state!=="loaded"&&c.state!=="errored")return!1}}return!0}removeSource(p){return this.style.removeSource(p),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,t,s={}){const{pixelRatio:l=1,sdf:c=!1,stretchX:f,stretchY:b,content:w}=s;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||h.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new h.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:E,data:M}=t,k=t;return this.style.addImage(p,{data:new h.R({width:A,height:E},new Uint8Array(M)),pixelRatio:l,stretchX:f,stretchY:b,content:w,sdf:c,version:0,userImage:k}),k.onAdd&&k.onAdd(this,p),this}}{const{width:A,height:E,data:M}=N.getImageData(t);this.style.addImage(p,{data:new h.R({width:A,height:E},M),pixelRatio:l,stretchX:f,stretchY:b,content:w,sdf:c,version:0})}}updateImage(p,t){const s=this.style.getImage(p);if(!s)return this.fire(new h.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=t instanceof HTMLImageElement||h.b(t)?N.getImageData(t):t,{width:c,height:f,data:b}=l;if(c===void 0||f===void 0)return this.fire(new h.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(c!==s.data.width||f!==s.data.height)return this.fire(new h.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(t instanceof HTMLImageElement||h.b(t));return s.data.replace(b,w),this.style.updateImage(p,s),this}getImage(p){return this.style.getImage(p)}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new h.j(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p){return ye.getImage(this._requestManager.transformRequest(p,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(p,t){return this._lazyInitEmptyStyle(),this.style.addLayer(p,t),this._update(!0)}moveLayer(p,t){return this.style.moveLayer(p,t),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(p,t,s){return this.style.setLayerZoomRange(p,t,s),this._update(!0)}setFilter(p,t,s={}){return this.style.setFilter(p,t,s),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,t,s,l={}){return this.style.setPaintProperty(p,t,s,l),this._update(!0)}getPaintProperty(p,t){return this.style.getPaintProperty(p,t)}setLayoutProperty(p,t,s,l={}){return this.style.setLayoutProperty(p,t,s,l),this._update(!0)}getLayoutProperty(p,t){return this.style.getLayoutProperty(p,t)}setGlyphs(p,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(p,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(p,t,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(p,t,s,l=>{l||this._update(!0)}),this}removeSprite(p){return this._lazyInitEmptyStyle(),this.style.removeSprite(p),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(p,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(p,t,s=>{s||this._update(!0)}),this}setLight(p,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(p,t){return this.style.setFeatureState(p,t),this._update()}removeFeatureState(p,t){return this.style.removeFeatureState(p,t),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let p=0,t=0;return this._container&&(p=this._container.clientWidth||400,t=this._container.clientHeight||300),[p,t]}_setupContainer(){const p=this._container;p.classList.add("maplibregl-map");const t=this._canvasContainer=V.create("div","maplibregl-canvas-container",p);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=V.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),l=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],l);const c=this._controlContainer=V.create("div","maplibregl-control-container",p),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{f[b]=V.create("div",`maplibregl-ctrl-${b} `,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,t,s){this._canvas.width=Math.floor(s*p),this._canvas.height=Math.floor(s*t),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const p={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",l=>{t={requestedAttributes:p},l&&(t.statusMessage=l.statusMessage,t.type=l.type)},{once:!0});const s=this._canvas.getContext("webgl2",p)||this._canvas.getContext("webgl",p);if(!s){const l="Failed to initialize WebGL";throw t?(t.message=l,new Error(JSON.stringify(t))):new Error(l)}this.painter=new au(s,this.transform),de.testSupport(s)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_render(p){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._removed)return;let s=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const c=this.transform.zoom,f=N.now();this.style.zoomHistory.update(c,f);const b=new h.a8(c,{now:f,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),w=b.crossFadingFactor();w===1&&w===this._crossFadingFactor||(s=!0,this._crossFadingFactor=w),this.style.update(b)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new h.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,h.bc.mark(h.bd.load),this.fire(new h.k("load"))),this.style&&(this.style.hasTransitions()||s)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const l=this._sourcesDirty||this._styleDirty||this._placementDirty;return l||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new h.k("idle")),!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,h.bc.mark(h.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var p;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ye.removeThrottleControl(this._imageQueueHandle),(p=this._resizeObserver)===null||p===void 0||p.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),V.remove(this._canvasContainer),V.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),h.bc.clearMetrics(),this._removed=!0,this.fire(new h.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,N.frameAsync(this._frameRequest).then(p=>{h.bc.frame(p),this._frameRequest=null,this._render(p)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get version(){return Ll}getCameraTargetElevation(){return this.transform.elevation}},v.MapMouseEvent=Rr,v.MapTouchEvent=Sn,v.MapWheelEvent=El,v.Marker=ko,v.NavigationControl=class{constructor(p){this._updateZoomButtons=()=>{const t=this._map.getZoom(),s=t===this._map.getMaxZoom(),l=t===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,s)=>{const l=this._map._getUIString(`NavigationControl.${s}`);t.title=l,t.setAttribute("aria-label",l)},this.options=h.e({},Fl,p),this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),V.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),V.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=V.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ol(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){V.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(p,t){const s=V.create("button",p,this._container);return s.type="button",s.addEventListener("click",t),s}},v.Popup=class extends h.E{constructor(p){super(),this.remove=()=>(this._content&&V.remove(this._content),this._container&&(V.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new h.k("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{var s;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=V.create("div","maplibregl-popup",this._map.getContainer()),this._tip=V.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const w of this.options.className.split(" "))this._container.classList.add(w);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Ea(this._lngLat,this._flatPos,this._map.transform):(s=this._lngLat)===null||s===void 0?void 0:s.wrap(),this._trackPointer&&!t)return;const l=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationPoint(this._lngLat));let c=this.options.anchor;const f=Da(this.options.offset);if(!c){const w=this._container.offsetWidth,A=this._container.offsetHeight;let E;E=l.y+f.bottom.y<A?["top"]:l.y>this._map.transform.height-A?["bottom"]:[],l.x<w/2?E.push("left"):l.x>this._map.transform.width-w/2&&E.push("right"),c=E.length===0?"bottom":E.join("-")}let b=l.add(f[c]);this.options.subpixelPositioning||(b=b.round()),V.setTransform(this._container,`${Mo[c]} translate(${b.x}px,${b.y}px)`),Pa(this._container,c,"popup")},this._onClose=()=>{this.remove()},this.options=h.e(Object.create(Bl),p)}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new h.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(p){return this._lngLat=h.M.convert(p),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const t=document.createDocumentFragment(),s=document.createElement("body");let l;for(s.innerHTML=p;l=s.firstChild,l;)t.appendChild(l);return this.setDOMContent(t)}getMaxWidth(){var p;return(p=this._container)===null||p===void 0?void 0:p.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=V.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(p){this._container&&this._container.classList.add(p)}removeClassName(p){this._container&&this._container.classList.remove(p)}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){if(this._container)return this._container.classList.toggle(p)}setSubpixelPositioning(p){this.options.subpixelPositioning=p}_createCloseButton(){this.options.closeButton&&(this._closeButton=V.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(Nl);p&&p.focus()}},v.RasterDEMTileSource=qe,v.RasterTileSource=ee,v.ScaleControl=class{constructor(p){this._onMove=()=>{ka(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,ka(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Ma),p)}getDefaultPosition(){return"bottom-left"}onAdd(p){return this._map=p,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){V.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},v.ScrollZoomHandler=Ta,v.Style=qr,v.TerrainControl=class{constructor(p){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=p}onAdd(p){return this._map=p,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=V.create("button","maplibregl-ctrl-terrain",this._container),V.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){V.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},v.TwoFingersTouchPitchHandler=mu,v.TwoFingersTouchRotateHandler=Cl,v.TwoFingersTouchZoomHandler=fu,v.TwoFingersTouchZoomRotateHandler=Ao,v.VectorTileSource=De,v.VideoSource=Fe,v.addSourceType=(p,t)=>h._(void 0,void 0,void 0,function*(){if(ft(p))throw new Error(`A source type called "${p}" already exists.`);((s,l)=>{bt[s]=l})(p,t)}),v.clearPrewarmedResources=function(){const p=gr;p&&(p.isPreloaded()&&p.numActive()===1?(p.release(oi),gr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},v.getMaxParallelImageRequests=function(){return h.a.MAX_PARALLEL_IMAGE_REQUESTS},v.getRTLTextPluginStatus=function(){return Ce().getRTLTextPluginStatus()},v.getVersion=function(){return bu},v.getWorkerCount=function(){return hr.workerCount},v.getWorkerUrl=function(){return h.a.WORKER_URL},v.importScriptInWorkers=function(p){return Qe().broadcast("IS",p)},v.prewarm=function(){Pe().acquire(oi)},v.setMaxParallelImageRequests=function(p){h.a.MAX_PARALLEL_IMAGE_REQUESTS=p},v.setRTLTextPlugin=function(p,t){return Ce().setRTLTextPlugin(p,t)},v.setWorkerCount=function(p){hr.workerCount=p},v.setWorkerUrl=function(p){h.a.WORKER_URL=p}});var T=d;return T})})(Py);var $w=Py.exports;const Bg=Ey($w),Uw=Cs("MapStore",{state:()=>({map:{},currentTopicMapStyle:{}})}),Lh=Cs("MainStore",{state:()=>({lastSearchMethod:"",currentAddress:""}),actions:{setCurrentAddress(n){this.currentAddress=n},setLastSearchMethod(n){this.lastSearchMethod=n}}}),un=Cs("AddressStore",{state:()=>({addressData:{}}),actions:{async fillAddressData(n){try{const a=await fetch(`https://api.phila.gov/ais/v1/search/${n}?include_units=false`);if(a.ok)console.log("Address - await resolved and HTTP status is successful"),this.addressData=await a.json();else{console.log("Address - await resolved but HTTP status was not successful"),this.addressData={};const d=Lh();d.currentAddress=""}}catch{console.error("Address - await never resolved, failed to fetch address data")}}},getters:{getOpaOwners:n=>n.addressData.features[0].properties.opa_owners.join(", ")}});function My(n,a){return function(){return n.apply(a,arguments)}}const{toString:jw}=Object.prototype,{getPrototypeOf:rf}=Object,Fh=(n=>a=>{const d=jw.call(a);return n[d]||(n[d]=d.slice(8,-1).toLowerCase())})(Object.create(null)),as=n=>(n=n.toLowerCase(),a=>Fh(a)===n),Oh=n=>a=>typeof a===n,{isArray:al}=Array,Mc=Oh("undefined");function qw(n){return n!==null&&!Mc(n)&&n.constructor!==null&&!Mc(n.constructor)&&kn(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const ky=as("ArrayBuffer");function Gw(n){let a;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?a=ArrayBuffer.isView(n):a=n&&n.buffer&&ky(n.buffer),a}const Hw=Oh("string"),kn=Oh("function"),Dy=Oh("number"),Bh=n=>n!==null&&typeof n=="object",Zw=n=>n===!0||n===!1,rh=n=>{if(Fh(n)!=="object")return!1;const a=rf(n);return(a===null||a===Object.prototype||Object.getPrototypeOf(a)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},Ww=as("Date"),Kw=as("File"),Xw=as("Blob"),Yw=as("FileList"),Jw=n=>Bh(n)&&kn(n.pipe),Qw=n=>{let a;return n&&(typeof FormData=="function"&&n instanceof FormData||kn(n.append)&&((a=Fh(n))==="formdata"||a==="object"&&kn(n.toString)&&n.toString()==="[object FormData]"))},e2=as("URLSearchParams"),t2=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Lc(n,a,{allOwnKeys:d=!1}={}){if(n===null||typeof n>"u")return;let m,x;if(typeof n!="object"&&(n=[n]),al(n))for(m=0,x=n.length;m<x;m++)a.call(null,n[m],m,n);else{const T=d?Object.getOwnPropertyNames(n):Object.keys(n),v=T.length;let h;for(m=0;m<v;m++)h=T[m],a.call(null,n[h],h,n)}}function zy(n,a){a=a.toLowerCase();const d=Object.keys(n);let m=d.length,x;for(;m-- >0;)if(x=d[m],a===x.toLowerCase())return x;return null}const Ry=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Ly=n=>!Mc(n)&&n!==Ry;function Ep(){const{caseless:n}=Ly(this)&&this||{},a={},d=(m,x)=>{const T=n&&zy(a,x)||x;rh(a[T])&&rh(m)?a[T]=Ep(a[T],m):rh(m)?a[T]=Ep({},m):al(m)?a[T]=m.slice():a[T]=m};for(let m=0,x=arguments.length;m<x;m++)arguments[m]&&Lc(arguments[m],d);return a}const i2=(n,a,d,{allOwnKeys:m}={})=>(Lc(a,(x,T)=>{d&&kn(x)?n[T]=My(x,d):n[T]=x},{allOwnKeys:m}),n),r2=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),n2=(n,a,d,m)=>{n.prototype=Object.create(a.prototype,m),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:a.prototype}),d&&Object.assign(n.prototype,d)},s2=(n,a,d,m)=>{let x,T,v;const h={};if(a=a||{},n==null)return a;do{for(x=Object.getOwnPropertyNames(n),T=x.length;T-- >0;)v=x[T],(!m||m(v,n,a))&&!h[v]&&(a[v]=n[v],h[v]=!0);n=d!==!1&&rf(n)}while(n&&(!d||d(n,a))&&n!==Object.prototype);return a},o2=(n,a,d)=>{n=String(n),(d===void 0||d>n.length)&&(d=n.length),d-=a.length;const m=n.indexOf(a,d);return m!==-1&&m===d},a2=n=>{if(!n)return null;if(al(n))return n;let a=n.length;if(!Dy(a))return null;const d=new Array(a);for(;a-- >0;)d[a]=n[a];return d},l2=(n=>a=>n&&a instanceof n)(typeof Uint8Array<"u"&&rf(Uint8Array)),c2=(n,a)=>{const m=(n&&n[Symbol.iterator]).call(n);let x;for(;(x=m.next())&&!x.done;){const T=x.value;a.call(n,T[0],T[1])}},u2=(n,a)=>{let d;const m=[];for(;(d=n.exec(a))!==null;)m.push(d);return m},h2=as("HTMLFormElement"),d2=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(d,m,x){return m.toUpperCase()+x}),Ng=(({hasOwnProperty:n})=>(a,d)=>n.call(a,d))(Object.prototype),p2=as("RegExp"),Fy=(n,a)=>{const d=Object.getOwnPropertyDescriptors(n),m={};Lc(d,(x,T)=>{let v;(v=a(x,T,n))!==!1&&(m[T]=v||x)}),Object.defineProperties(n,m)},f2=n=>{Fy(n,(a,d)=>{if(kn(n)&&["arguments","caller","callee"].indexOf(d)!==-1)return!1;const m=n[d];if(kn(m)){if(a.enumerable=!1,"writable"in a){a.writable=!1;return}a.set||(a.set=()=>{throw Error("Can not rewrite read-only method '"+d+"'")})}})},m2=(n,a)=>{const d={},m=x=>{x.forEach(T=>{d[T]=!0})};return al(n)?m(n):m(String(n).split(a)),d},g2=()=>{},_2=(n,a)=>(n=+n,Number.isFinite(n)?n:a),sp="abcdefghijklmnopqrstuvwxyz",Vg="0123456789",Oy={DIGIT:Vg,ALPHA:sp,ALPHA_DIGIT:sp+sp.toUpperCase()+Vg},y2=(n=16,a=Oy.ALPHA_DIGIT)=>{let d="";const{length:m}=a;for(;n--;)d+=a[Math.random()*m|0];return d};function x2(n){return!!(n&&kn(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const v2=n=>{const a=new Array(10),d=(m,x)=>{if(Bh(m)){if(a.indexOf(m)>=0)return;if(!("toJSON"in m)){a[x]=m;const T=al(m)?[]:{};return Lc(m,(v,h)=>{const L=d(v,x+1);!Mc(L)&&(T[h]=L)}),a[x]=void 0,T}}return m};return d(n,0)},b2=as("AsyncFunction"),w2=n=>n&&(Bh(n)||kn(n))&&kn(n.then)&&kn(n.catch),Re={isArray:al,isArrayBuffer:ky,isBuffer:qw,isFormData:Qw,isArrayBufferView:Gw,isString:Hw,isNumber:Dy,isBoolean:Zw,isObject:Bh,isPlainObject:rh,isUndefined:Mc,isDate:Ww,isFile:Kw,isBlob:Xw,isRegExp:p2,isFunction:kn,isStream:Jw,isURLSearchParams:e2,isTypedArray:l2,isFileList:Yw,forEach:Lc,merge:Ep,extend:i2,trim:t2,stripBOM:r2,inherits:n2,toFlatObject:s2,kindOf:Fh,kindOfTest:as,endsWith:o2,toArray:a2,forEachEntry:c2,matchAll:u2,isHTMLForm:h2,hasOwnProperty:Ng,hasOwnProp:Ng,reduceDescriptors:Fy,freezeMethods:f2,toObjectSet:m2,toCamelCase:d2,noop:g2,toFiniteNumber:_2,findKey:zy,global:Ry,isContextDefined:Ly,ALPHABET:Oy,generateString:y2,isSpecCompliantForm:x2,toJSONObject:v2,isAsyncFn:b2,isThenable:w2};function ni(n,a,d,m,x){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",a&&(this.code=a),d&&(this.config=d),m&&(this.request=m),x&&(this.response=x)}Re.inherits(ni,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Re.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const By=ni.prototype,Ny={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{Ny[n]={value:n}});Object.defineProperties(ni,Ny);Object.defineProperty(By,"isAxiosError",{value:!0});ni.from=(n,a,d,m,x,T)=>{const v=Object.create(By);return Re.toFlatObject(n,v,function(L){return L!==Error.prototype},h=>h!=="isAxiosError"),ni.call(v,n.message,a,d,m,x),v.cause=n,v.name=n.name,T&&Object.assign(v,T),v};const S2=null;function Pp(n){return Re.isPlainObject(n)||Re.isArray(n)}function Vy(n){return Re.endsWith(n,"[]")?n.slice(0,-2):n}function $g(n,a,d){return n?n.concat(a).map(function(x,T){return x=Vy(x),!d&&T?"["+x+"]":x}).join(d?".":""):a}function T2(n){return Re.isArray(n)&&!n.some(Pp)}const A2=Re.toFlatObject(Re,{},null,function(a){return/^is[A-Z]/.test(a)});function Nh(n,a,d){if(!Re.isObject(n))throw new TypeError("target must be an object");a=a||new FormData,d=Re.toFlatObject(d,{metaTokens:!0,dots:!1,indexes:!1},!1,function(Ie,Je){return!Re.isUndefined(Je[Ie])});const m=d.metaTokens,x=d.visitor||j,T=d.dots,v=d.indexes,L=(d.Blob||typeof Blob<"u"&&Blob)&&Re.isSpecCompliantForm(a);if(!Re.isFunction(x))throw new TypeError("visitor must be a function");function U(_e){if(_e===null)return"";if(Re.isDate(_e))return _e.toISOString();if(!L&&Re.isBlob(_e))throw new ni("Blob is not supported. Use a Buffer instead.");return Re.isArrayBuffer(_e)||Re.isTypedArray(_e)?L&&typeof Blob=="function"?new Blob([_e]):Buffer.from(_e):_e}function j(_e,Ie,Je){let Ue=_e;if(_e&&!Je&&typeof _e=="object"){if(Re.endsWith(Ie,"{}"))Ie=m?Ie:Ie.slice(0,-2),_e=JSON.stringify(_e);else if(Re.isArray(_e)&&T2(_e)||(Re.isFileList(_e)||Re.endsWith(Ie,"[]"))&&(Ue=Re.toArray(_e)))return Ie=Vy(Ie),Ue.forEach(function(ye,Be){!(Re.isUndefined(ye)||ye===null)&&a.append(v===!0?$g([Ie],Be,T):v===null?Ie:Ie+"[]",U(ye))}),!1}return Pp(_e)?!0:(a.append($g(Je,Ie,T),U(_e)),!1)}const N=[],V=Object.assign(A2,{defaultVisitor:j,convertValue:U,isVisitable:Pp});function de(_e,Ie){if(!Re.isUndefined(_e)){if(N.indexOf(_e)!==-1)throw Error("Circular reference detected in "+Ie.join("."));N.push(_e),Re.forEach(_e,function(Ue,We){(!(Re.isUndefined(Ue)||Ue===null)&&x.call(a,Ue,Re.isString(We)?We.trim():We,Ie,V))===!0&&de(Ue,Ie?Ie.concat(We):[We])}),N.pop()}}if(!Re.isObject(n))throw new TypeError("data must be an object");return de(n),a}function Ug(n){const a={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(m){return a[m]})}function nf(n,a){this._pairs=[],n&&Nh(n,this,a)}const $y=nf.prototype;$y.append=function(a,d){this._pairs.push([a,d])};$y.toString=function(a){const d=a?function(m){return a.call(this,m,Ug)}:Ug;return this._pairs.map(function(x){return d(x[0])+"="+d(x[1])},"").join("&")};function I2(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Uy(n,a,d){if(!a)return n;const m=d&&d.encode||I2,x=d&&d.serialize;let T;if(x?T=x(a,d):T=Re.isURLSearchParams(a)?a.toString():new nf(a,d).toString(m),T){const v=n.indexOf("#");v!==-1&&(n=n.slice(0,v)),n+=(n.indexOf("?")===-1?"?":"&")+T}return n}class jg{constructor(){this.handlers=[]}use(a,d,m){return this.handlers.push({fulfilled:a,rejected:d,synchronous:m?m.synchronous:!1,runWhen:m?m.runWhen:null}),this.handlers.length-1}eject(a){this.handlers[a]&&(this.handlers[a]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(a){Re.forEach(this.handlers,function(m){m!==null&&a(m)})}}const jy={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},E2=typeof URLSearchParams<"u"?URLSearchParams:nf,P2=typeof FormData<"u"?FormData:null,C2=typeof Blob<"u"?Blob:null,M2={isBrowser:!0,classes:{URLSearchParams:E2,FormData:P2,Blob:C2},protocols:["http","https","file","blob","url","data"]},qy=typeof window<"u"&&typeof document<"u",k2=(n=>qy&&["ReactNative","NativeScript","NS"].indexOf(n)<0)(typeof navigator<"u"&&navigator.product),D2=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",z2=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:qy,hasStandardBrowserEnv:k2,hasStandardBrowserWebWorkerEnv:D2},Symbol.toStringTag,{value:"Module"})),ns={...z2,...M2};function R2(n,a){return Nh(n,new ns.classes.URLSearchParams,Object.assign({visitor:function(d,m,x,T){return ns.isNode&&Re.isBuffer(d)?(this.append(m,d.toString("base64")),!1):T.defaultVisitor.apply(this,arguments)}},a))}function L2(n){return Re.matchAll(/\w+|\[(\w*)]/g,n).map(a=>a[0]==="[]"?"":a[1]||a[0])}function F2(n){const a={},d=Object.keys(n);let m;const x=d.length;let T;for(m=0;m<x;m++)T=d[m],a[T]=n[T];return a}function Gy(n){function a(d,m,x,T){let v=d[T++];if(v==="__proto__")return!0;const h=Number.isFinite(+v),L=T>=d.length;return v=!v&&Re.isArray(x)?x.length:v,L?(Re.hasOwnProp(x,v)?x[v]=[x[v],m]:x[v]=m,!h):((!x[v]||!Re.isObject(x[v]))&&(x[v]=[]),a(d,m,x[v],T)&&Re.isArray(x[v])&&(x[v]=F2(x[v])),!h)}if(Re.isFormData(n)&&Re.isFunction(n.entries)){const d={};return Re.forEachEntry(n,(m,x)=>{a(L2(m),x,d,0)}),d}return null}function O2(n,a,d){if(Re.isString(n))try{return(a||JSON.parse)(n),Re.trim(n)}catch(m){if(m.name!=="SyntaxError")throw m}return(d||JSON.stringify)(n)}const sf={transitional:jy,adapter:["xhr","http"],transformRequest:[function(a,d){const m=d.getContentType()||"",x=m.indexOf("application/json")>-1,T=Re.isObject(a);if(T&&Re.isHTMLForm(a)&&(a=new FormData(a)),Re.isFormData(a))return x?JSON.stringify(Gy(a)):a;if(Re.isArrayBuffer(a)||Re.isBuffer(a)||Re.isStream(a)||Re.isFile(a)||Re.isBlob(a))return a;if(Re.isArrayBufferView(a))return a.buffer;if(Re.isURLSearchParams(a))return d.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),a.toString();let h;if(T){if(m.indexOf("application/x-www-form-urlencoded")>-1)return R2(a,this.formSerializer).toString();if((h=Re.isFileList(a))||m.indexOf("multipart/form-data")>-1){const L=this.env&&this.env.FormData;return Nh(h?{"files[]":a}:a,L&&new L,this.formSerializer)}}return T||x?(d.setContentType("application/json",!1),O2(a)):a}],transformResponse:[function(a){const d=this.transitional||sf.transitional,m=d&&d.forcedJSONParsing,x=this.responseType==="json";if(a&&Re.isString(a)&&(m&&!this.responseType||x)){const v=!(d&&d.silentJSONParsing)&&x;try{return JSON.parse(a)}catch(h){if(v)throw h.name==="SyntaxError"?ni.from(h,ni.ERR_BAD_RESPONSE,this,null,this.response):h}}return a}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ns.classes.FormData,Blob:ns.classes.Blob},validateStatus:function(a){return a>=200&&a<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Re.forEach(["delete","get","head","post","put","patch"],n=>{sf.headers[n]={}});const of=sf,B2=Re.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),N2=n=>{const a={};let d,m,x;return n&&n.split(`
`).forEach(function(v){x=v.indexOf(":"),d=v.substring(0,x).trim().toLowerCase(),m=v.substring(x+1).trim(),!(!d||a[d]&&B2[d])&&(d==="set-cookie"?a[d]?a[d].push(m):a[d]=[m]:a[d]=a[d]?a[d]+", "+m:m)}),a},qg=Symbol("internals");function hc(n){return n&&String(n).trim().toLowerCase()}function nh(n){return n===!1||n==null?n:Re.isArray(n)?n.map(nh):String(n)}function V2(n){const a=Object.create(null),d=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let m;for(;m=d.exec(n);)a[m[1]]=m[2];return a}const $2=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function op(n,a,d,m,x){if(Re.isFunction(m))return m.call(this,a,d);if(x&&(a=d),!!Re.isString(a)){if(Re.isString(m))return a.indexOf(m)!==-1;if(Re.isRegExp(m))return m.test(a)}}function U2(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(a,d,m)=>d.toUpperCase()+m)}function j2(n,a){const d=Re.toCamelCase(" "+a);["get","set","has"].forEach(m=>{Object.defineProperty(n,m+d,{value:function(x,T,v){return this[m].call(this,a,x,T,v)},configurable:!0})})}class Vh{constructor(a){a&&this.set(a)}set(a,d,m){const x=this;function T(h,L,U){const j=hc(L);if(!j)throw new Error("header name must be a non-empty string");const N=Re.findKey(x,j);(!N||x[N]===void 0||U===!0||U===void 0&&x[N]!==!1)&&(x[N||L]=nh(h))}const v=(h,L)=>Re.forEach(h,(U,j)=>T(U,j,L));return Re.isPlainObject(a)||a instanceof this.constructor?v(a,d):Re.isString(a)&&(a=a.trim())&&!$2(a)?v(N2(a),d):a!=null&&T(d,a,m),this}get(a,d){if(a=hc(a),a){const m=Re.findKey(this,a);if(m){const x=this[m];if(!d)return x;if(d===!0)return V2(x);if(Re.isFunction(d))return d.call(this,x,m);if(Re.isRegExp(d))return d.exec(x);throw new TypeError("parser must be boolean|regexp|function")}}}has(a,d){if(a=hc(a),a){const m=Re.findKey(this,a);return!!(m&&this[m]!==void 0&&(!d||op(this,this[m],m,d)))}return!1}delete(a,d){const m=this;let x=!1;function T(v){if(v=hc(v),v){const h=Re.findKey(m,v);h&&(!d||op(m,m[h],h,d))&&(delete m[h],x=!0)}}return Re.isArray(a)?a.forEach(T):T(a),x}clear(a){const d=Object.keys(this);let m=d.length,x=!1;for(;m--;){const T=d[m];(!a||op(this,this[T],T,a,!0))&&(delete this[T],x=!0)}return x}normalize(a){const d=this,m={};return Re.forEach(this,(x,T)=>{const v=Re.findKey(m,T);if(v){d[v]=nh(x),delete d[T];return}const h=a?U2(T):String(T).trim();h!==T&&delete d[T],d[h]=nh(x),m[h]=!0}),this}concat(...a){return this.constructor.concat(this,...a)}toJSON(a){const d=Object.create(null);return Re.forEach(this,(m,x)=>{m!=null&&m!==!1&&(d[x]=a&&Re.isArray(m)?m.join(", "):m)}),d}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([a,d])=>a+": "+d).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(a){return a instanceof this?a:new this(a)}static concat(a,...d){const m=new this(a);return d.forEach(x=>m.set(x)),m}static accessor(a){const m=(this[qg]=this[qg]={accessors:{}}).accessors,x=this.prototype;function T(v){const h=hc(v);m[h]||(j2(x,v),m[h]=!0)}return Re.isArray(a)?a.forEach(T):T(a),this}}Vh.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Re.reduceDescriptors(Vh.prototype,({value:n},a)=>{let d=a[0].toUpperCase()+a.slice(1);return{get:()=>n,set(m){this[d]=m}}});Re.freezeMethods(Vh);const Es=Vh;function ap(n,a){const d=this||of,m=a||d,x=Es.from(m.headers);let T=m.data;return Re.forEach(n,function(h){T=h.call(d,T,x.normalize(),a?a.status:void 0)}),x.normalize(),T}function Hy(n){return!!(n&&n.__CANCEL__)}function Fc(n,a,d){ni.call(this,n??"canceled",ni.ERR_CANCELED,a,d),this.name="CanceledError"}Re.inherits(Fc,ni,{__CANCEL__:!0});function q2(n,a,d){const m=d.config.validateStatus;!d.status||!m||m(d.status)?n(d):a(new ni("Request failed with status code "+d.status,[ni.ERR_BAD_REQUEST,ni.ERR_BAD_RESPONSE][Math.floor(d.status/100)-4],d.config,d.request,d))}const G2=ns.hasStandardBrowserEnv?{write(n,a,d,m,x,T){const v=[n+"="+encodeURIComponent(a)];Re.isNumber(d)&&v.push("expires="+new Date(d).toGMTString()),Re.isString(m)&&v.push("path="+m),Re.isString(x)&&v.push("domain="+x),T===!0&&v.push("secure"),document.cookie=v.join("; ")},read(n){const a=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return a?decodeURIComponent(a[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function H2(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function Z2(n,a){return a?n.replace(/\/?\/$/,"")+"/"+a.replace(/^\/+/,""):n}function Zy(n,a){return n&&!H2(a)?Z2(n,a):a}const W2=ns.hasStandardBrowserEnv?function(){const a=/(msie|trident)/i.test(navigator.userAgent),d=document.createElement("a");let m;function x(T){let v=T;return a&&(d.setAttribute("href",v),v=d.href),d.setAttribute("href",v),{href:d.href,protocol:d.protocol?d.protocol.replace(/:$/,""):"",host:d.host,search:d.search?d.search.replace(/^\?/,""):"",hash:d.hash?d.hash.replace(/^#/,""):"",hostname:d.hostname,port:d.port,pathname:d.pathname.charAt(0)==="/"?d.pathname:"/"+d.pathname}}return m=x(window.location.href),function(v){const h=Re.isString(v)?x(v):v;return h.protocol===m.protocol&&h.host===m.host}}():function(){return function(){return!0}}();function K2(n){const a=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return a&&a[1]||""}function X2(n,a){n=n||10;const d=new Array(n),m=new Array(n);let x=0,T=0,v;return a=a!==void 0?a:1e3,function(L){const U=Date.now(),j=m[T];v||(v=U),d[x]=L,m[x]=U;let N=T,V=0;for(;N!==x;)V+=d[N++],N=N%n;if(x=(x+1)%n,x===T&&(T=(T+1)%n),U-v<a)return;const de=j&&U-j;return de?Math.round(V*1e3/de):void 0}}function Gg(n,a){let d=0;const m=X2(50,250);return x=>{const T=x.loaded,v=x.lengthComputable?x.total:void 0,h=T-d,L=m(h),U=T<=v;d=T;const j={loaded:T,total:v,progress:v?T/v:void 0,bytes:h,rate:L||void 0,estimated:L&&v&&U?(v-T)/L:void 0,event:x};j[a?"download":"upload"]=!0,n(j)}}const Y2=typeof XMLHttpRequest<"u",J2=Y2&&function(n){return new Promise(function(d,m){let x=n.data;const T=Es.from(n.headers).normalize();let{responseType:v,withXSRFToken:h}=n,L;function U(){n.cancelToken&&n.cancelToken.unsubscribe(L),n.signal&&n.signal.removeEventListener("abort",L)}let j;if(Re.isFormData(x)){if(ns.hasStandardBrowserEnv||ns.hasStandardBrowserWebWorkerEnv)T.setContentType(!1);else if((j=T.getContentType())!==!1){const[Ie,...Je]=j?j.split(";").map(Ue=>Ue.trim()).filter(Boolean):[];T.setContentType([Ie||"multipart/form-data",...Je].join("; "))}}let N=new XMLHttpRequest;if(n.auth){const Ie=n.auth.username||"",Je=n.auth.password?unescape(encodeURIComponent(n.auth.password)):"";T.set("Authorization","Basic "+btoa(Ie+":"+Je))}const V=Zy(n.baseURL,n.url);N.open(n.method.toUpperCase(),Uy(V,n.params,n.paramsSerializer),!0),N.timeout=n.timeout;function de(){if(!N)return;const Ie=Es.from("getAllResponseHeaders"in N&&N.getAllResponseHeaders()),Ue={data:!v||v==="text"||v==="json"?N.responseText:N.response,status:N.status,statusText:N.statusText,headers:Ie,config:n,request:N};q2(function(ye){d(ye),U()},function(ye){m(ye),U()},Ue),N=null}if("onloadend"in N?N.onloadend=de:N.onreadystatechange=function(){!N||N.readyState!==4||N.status===0&&!(N.responseURL&&N.responseURL.indexOf("file:")===0)||setTimeout(de)},N.onabort=function(){N&&(m(new ni("Request aborted",ni.ECONNABORTED,n,N)),N=null)},N.onerror=function(){m(new ni("Network Error",ni.ERR_NETWORK,n,N)),N=null},N.ontimeout=function(){let Je=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const Ue=n.transitional||jy;n.timeoutErrorMessage&&(Je=n.timeoutErrorMessage),m(new ni(Je,Ue.clarifyTimeoutError?ni.ETIMEDOUT:ni.ECONNABORTED,n,N)),N=null},ns.hasStandardBrowserEnv&&(h&&Re.isFunction(h)&&(h=h(n)),h||h!==!1&&W2(V))){const Ie=n.xsrfHeaderName&&n.xsrfCookieName&&G2.read(n.xsrfCookieName);Ie&&T.set(n.xsrfHeaderName,Ie)}x===void 0&&T.setContentType(null),"setRequestHeader"in N&&Re.forEach(T.toJSON(),function(Je,Ue){N.setRequestHeader(Ue,Je)}),Re.isUndefined(n.withCredentials)||(N.withCredentials=!!n.withCredentials),v&&v!=="json"&&(N.responseType=n.responseType),typeof n.onDownloadProgress=="function"&&N.addEventListener("progress",Gg(n.onDownloadProgress,!0)),typeof n.onUploadProgress=="function"&&N.upload&&N.upload.addEventListener("progress",Gg(n.onUploadProgress)),(n.cancelToken||n.signal)&&(L=Ie=>{N&&(m(!Ie||Ie.type?new Fc(null,n,N):Ie),N.abort(),N=null)},n.cancelToken&&n.cancelToken.subscribe(L),n.signal&&(n.signal.aborted?L():n.signal.addEventListener("abort",L)));const _e=K2(V);if(_e&&ns.protocols.indexOf(_e)===-1){m(new ni("Unsupported protocol "+_e+":",ni.ERR_BAD_REQUEST,n));return}N.send(x||null)})},Cp={http:S2,xhr:J2};Re.forEach(Cp,(n,a)=>{if(n){try{Object.defineProperty(n,"name",{value:a})}catch{}Object.defineProperty(n,"adapterName",{value:a})}});const Hg=n=>`- ${n}`,Q2=n=>Re.isFunction(n)||n===null||n===!1,Wy={getAdapter:n=>{n=Re.isArray(n)?n:[n];const{length:a}=n;let d,m;const x={};for(let T=0;T<a;T++){d=n[T];let v;if(m=d,!Q2(d)&&(m=Cp[(v=String(d)).toLowerCase()],m===void 0))throw new ni(`Unknown adapter '${v}'`);if(m)break;x[v||"#"+T]=m}if(!m){const T=Object.entries(x).map(([h,L])=>`adapter ${h} `+(L===!1?"is not supported by the environment":"is not available in the build"));let v=a?T.length>1?`since :
`+T.map(Hg).join(`
`):" "+Hg(T[0]):"as no adapter specified";throw new ni("There is no suitable adapter to dispatch the request "+v,"ERR_NOT_SUPPORT")}return m},adapters:Cp};function lp(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Fc(null,n)}function Zg(n){return lp(n),n.headers=Es.from(n.headers),n.data=ap.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),Wy.getAdapter(n.adapter||of.adapter)(n).then(function(m){return lp(n),m.data=ap.call(n,n.transformResponse,m),m.headers=Es.from(m.headers),m},function(m){return Hy(m)||(lp(n),m&&m.response&&(m.response.data=ap.call(n,n.transformResponse,m.response),m.response.headers=Es.from(m.response.headers))),Promise.reject(m)})}const Wg=n=>n instanceof Es?{...n}:n;function sl(n,a){a=a||{};const d={};function m(U,j,N){return Re.isPlainObject(U)&&Re.isPlainObject(j)?Re.merge.call({caseless:N},U,j):Re.isPlainObject(j)?Re.merge({},j):Re.isArray(j)?j.slice():j}function x(U,j,N){if(Re.isUndefined(j)){if(!Re.isUndefined(U))return m(void 0,U,N)}else return m(U,j,N)}function T(U,j){if(!Re.isUndefined(j))return m(void 0,j)}function v(U,j){if(Re.isUndefined(j)){if(!Re.isUndefined(U))return m(void 0,U)}else return m(void 0,j)}function h(U,j,N){if(N in a)return m(U,j);if(N in n)return m(void 0,U)}const L={url:T,method:T,data:T,baseURL:v,transformRequest:v,transformResponse:v,paramsSerializer:v,timeout:v,timeoutMessage:v,withCredentials:v,withXSRFToken:v,adapter:v,responseType:v,xsrfCookieName:v,xsrfHeaderName:v,onUploadProgress:v,onDownloadProgress:v,decompress:v,maxContentLength:v,maxBodyLength:v,beforeRedirect:v,transport:v,httpAgent:v,httpsAgent:v,cancelToken:v,socketPath:v,responseEncoding:v,validateStatus:h,headers:(U,j)=>x(Wg(U),Wg(j),!0)};return Re.forEach(Object.keys(Object.assign({},n,a)),function(j){const N=L[j]||x,V=N(n[j],a[j],j);Re.isUndefined(V)&&N!==h||(d[j]=V)}),d}const Ky="1.6.8",af={};["object","boolean","number","function","string","symbol"].forEach((n,a)=>{af[n]=function(m){return typeof m===n||"a"+(a<1?"n ":" ")+n}});const Kg={};af.transitional=function(a,d,m){function x(T,v){return"[Axios v"+Ky+"] Transitional option '"+T+"'"+v+(m?". "+m:"")}return(T,v,h)=>{if(a===!1)throw new ni(x(v," has been removed"+(d?" in "+d:"")),ni.ERR_DEPRECATED);return d&&!Kg[v]&&(Kg[v]=!0,console.warn(x(v," has been deprecated since v"+d+" and will be removed in the near future"))),a?a(T,v,h):!0}};function eS(n,a,d){if(typeof n!="object")throw new ni("options must be an object",ni.ERR_BAD_OPTION_VALUE);const m=Object.keys(n);let x=m.length;for(;x-- >0;){const T=m[x],v=a[T];if(v){const h=n[T],L=h===void 0||v(h,T,n);if(L!==!0)throw new ni("option "+T+" must be "+L,ni.ERR_BAD_OPTION_VALUE);continue}if(d!==!0)throw new ni("Unknown option "+T,ni.ERR_BAD_OPTION)}}const Mp={assertOptions:eS,validators:af},Ys=Mp.validators;class fh{constructor(a){this.defaults=a,this.interceptors={request:new jg,response:new jg}}async request(a,d){try{return await this._request(a,d)}catch(m){if(m instanceof Error){let x;Error.captureStackTrace?Error.captureStackTrace(x={}):x=new Error;const T=x.stack?x.stack.replace(/^.+\n/,""):"";m.stack?T&&!String(m.stack).endsWith(T.replace(/^.+\n.+\n/,""))&&(m.stack+=`
`+T):m.stack=T}throw m}}_request(a,d){typeof a=="string"?(d=d||{},d.url=a):d=a||{},d=sl(this.defaults,d);const{transitional:m,paramsSerializer:x,headers:T}=d;m!==void 0&&Mp.assertOptions(m,{silentJSONParsing:Ys.transitional(Ys.boolean),forcedJSONParsing:Ys.transitional(Ys.boolean),clarifyTimeoutError:Ys.transitional(Ys.boolean)},!1),x!=null&&(Re.isFunction(x)?d.paramsSerializer={serialize:x}:Mp.assertOptions(x,{encode:Ys.function,serialize:Ys.function},!0)),d.method=(d.method||this.defaults.method||"get").toLowerCase();let v=T&&Re.merge(T.common,T[d.method]);T&&Re.forEach(["delete","get","head","post","put","patch","common"],_e=>{delete T[_e]}),d.headers=Es.concat(v,T);const h=[];let L=!0;this.interceptors.request.forEach(function(Ie){typeof Ie.runWhen=="function"&&Ie.runWhen(d)===!1||(L=L&&Ie.synchronous,h.unshift(Ie.fulfilled,Ie.rejected))});const U=[];this.interceptors.response.forEach(function(Ie){U.push(Ie.fulfilled,Ie.rejected)});let j,N=0,V;if(!L){const _e=[Zg.bind(this),void 0];for(_e.unshift.apply(_e,h),_e.push.apply(_e,U),V=_e.length,j=Promise.resolve(d);N<V;)j=j.then(_e[N++],_e[N++]);return j}V=h.length;let de=d;for(N=0;N<V;){const _e=h[N++],Ie=h[N++];try{de=_e(de)}catch(Je){Ie.call(this,Je);break}}try{j=Zg.call(this,de)}catch(_e){return Promise.reject(_e)}for(N=0,V=U.length;N<V;)j=j.then(U[N++],U[N++]);return j}getUri(a){a=sl(this.defaults,a);const d=Zy(a.baseURL,a.url);return Uy(d,a.params,a.paramsSerializer)}}Re.forEach(["delete","get","head","options"],function(a){fh.prototype[a]=function(d,m){return this.request(sl(m||{},{method:a,url:d,data:(m||{}).data}))}});Re.forEach(["post","put","patch"],function(a){function d(m){return function(T,v,h){return this.request(sl(h||{},{method:a,headers:m?{"Content-Type":"multipart/form-data"}:{},url:T,data:v}))}}fh.prototype[a]=d(),fh.prototype[a+"Form"]=d(!0)});const sh=fh;class lf{constructor(a){if(typeof a!="function")throw new TypeError("executor must be a function.");let d;this.promise=new Promise(function(T){d=T});const m=this;this.promise.then(x=>{if(!m._listeners)return;let T=m._listeners.length;for(;T-- >0;)m._listeners[T](x);m._listeners=null}),this.promise.then=x=>{let T;const v=new Promise(h=>{m.subscribe(h),T=h}).then(x);return v.cancel=function(){m.unsubscribe(T)},v},a(function(T,v,h){m.reason||(m.reason=new Fc(T,v,h),d(m.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(a){if(this.reason){a(this.reason);return}this._listeners?this._listeners.push(a):this._listeners=[a]}unsubscribe(a){if(!this._listeners)return;const d=this._listeners.indexOf(a);d!==-1&&this._listeners.splice(d,1)}static source(){let a;return{token:new lf(function(x){a=x}),cancel:a}}}const tS=lf;function iS(n){return function(d){return n.apply(null,d)}}function rS(n){return Re.isObject(n)&&n.isAxiosError===!0}const kp={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(kp).forEach(([n,a])=>{kp[a]=n});const nS=kp;function Xy(n){const a=new sh(n),d=My(sh.prototype.request,a);return Re.extend(d,sh.prototype,a,{allOwnKeys:!0}),Re.extend(d,a,null,{allOwnKeys:!0}),d.create=function(x){return Xy(sl(n,x))},d}const Vi=Xy(of);Vi.Axios=sh;Vi.CanceledError=Fc;Vi.CancelToken=tS;Vi.isCancel=Hy;Vi.VERSION=Ky;Vi.toFormData=Nh;Vi.AxiosError=ni;Vi.Cancel=Vi.CanceledError;Vi.all=function(a){return Promise.all(a)};Vi.spread=iS;Vi.isAxiosError=rS;Vi.mergeConfig=sl;Vi.AxiosHeaders=Es;Vi.formToJSON=n=>Gy(Re.isHTMLForm(n)?new FormData(n):n);Vi.getAdapter=Wy.getAdapter;Vi.HttpStatusCode=nS;Vi.default=Vi;const Oc=Cs("CondosStore",{state:()=>({condosData:{}}),actions:{async fillCondoData(n){console.log("fillCondoData is runnning, address",n);const d=un().addressData.features[0];let m={include_units:!0,opa_only:!0,page:1};const x=await Vi(`//api.phila.gov/ais/v1/search/${n}`,{params:m});if(console.log("response",x),x.data.features.length>0){let T=[];for(let v of x.data.features)v.properties.address_low_frac!==d.properties.address_low_frac||v.properties.street_address===d.properties.street_address?x.data.total_size=x.data.total_size-1:T.push(v);this.condosData=T}}}}),$h=Cs("ParcelsStore",{state:()=>({PWD:{},DOR:{}}),actions:{async fillPwdParcelData(){const a=un().addressData.features[0],d=a.properties.pwd_parcel_id;if(!d){console.log("no PWD parcel in AIS"),await this.fillParcelDataByLngLat(a.geometry.coordinates[0],a.geometry.coordinates[1],"PWD");return}try{const m=await fetch(`https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/PWD_PARCELS/FeatureServer/0/query?where=PARCELID=%27${d}%27&outSR=4326&f=geojson&outFields=*&returnGeometry=true`);m.ok?this.PWD=await m.json():console.error("Failed to fetch PWD parcel data")}catch{console.error("Failed to fetch PWD parcel data")}},async fillDorParcelData(){const a=un().addressData.features[0],d=a.properties.dor_parcel_id;if(!d){console.log("no DOR parcel in AIS"),await this.fillParcelDataByLngLat(a.geometry.coordinates[0],a.geometry.coordinates[1],"DOR");return}try{const m=await fetch(`https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/DOR_Parcel/FeatureServer/0/query?where=MAPREG=%27${d}%27&outSR=4326&f=geojson&outFields=*&returnGeometry=true`);m.ok?this.DOR=await m.json():console.error("Failed to fetch DOR parcel data")}catch{console.error("Failed to fetch DOR parcel data")}},async fillParcelDataByLngLat(n,a,d){console.log("fillParcelDataByLngLat, lng:",n,"lat:",a,"parcelLayer:",d);let m=d==="PWD"?"PWD_PARCELS":"DOR_Parcel",x={where:"1=1",outSR:4326,f:"geojson",outFields:"*",returnGeometry:!0,geometry:`{ "x": ${n}, "y": ${a}, "spatialReference":{ "wkid":4326 }}`,geometryType:"esriGeometryPoint",spatialRel:"esriSpatialRelWithin"};const T=await Vi(`https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/${m}/FeatureServer/0/query`,{params:x});console.log("response",T),T.data.features.length>0&&(this[d]=T.data)}}});function sS(){return{pwdDrawnMapStyle:{version:8,name:"pwdDrawnMap",sources:{pwd:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityBasemap/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},pwdLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityBasemap_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256}},layers:[{id:"pwd",source:"pwd",type:"raster"},{id:"pwdLabels",source:"pwdLabels",type:"raster"}]},dorDrawnMapStyle:{version:8,name:"dorDrawnMap",sources:{dor:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/DORBasemap/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},dorLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/DORBasemap_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256}},layers:[{id:"dor",source:"dor",type:"raster"},{id:"dorLabels",source:"dorLabels",type:"raster"}]},zoningDrawnMapStyle:{version:8,name:"dorDrawnMap",sources:{dor:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/DORBasemap/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},dorLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/DORBasemap_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},zoning:{tiles:["https://citygeo-geoserver.databridge.phila.gov/geoserver/wms?service=WMS&version=1.1.0&request=GetMap&layers=atlas_zoning_grouped&bbox={bbox-epsg-3857}&width=256&height=256&srs=EPSG%3A3857&styles=&format=image/png&transparent=true"],type:"raster",tileSize:256}},layers:[{id:"dor",source:"dor",type:"raster"},{id:"dorLabels",source:"dorLabels",type:"raster"},{id:"zoning",source:"zoning",type:"raster"}]},imageryMapStyle:{version:8,name:"imageryMap",sources:{imagery:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2022_2in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},imageryLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},stormwater:{tiles:["https://stormwater.phila.gov/arcgis/rest/services/parcel_viewer/pv_data/MapServer/export?dpi=110            &transparent=true            &format=png36            &bbox={bbox-epsg-3857}            &bboxSR=3857            &imageSR=3857            &size=512,512            &f=image          "],type:"raster",tileSize:256}},layers:[{id:"imagery",source:"imagery",type:"raster"},{id:"imageryLabels",source:"imageryLabels",type:"raster"}]}}}var Dp={exports:{}};/*!
 * accounting.js v0.4.1
 * Copyright 2014 Open Exchange Rates
 *
 * Freely distributable under the MIT license.
 * Portions of accounting.js are inspired or borrowed from underscore.js
 *
 * Full details and documentation:
 * http://openexchangerates.github.io/accounting.js/
 */(function(n,a){(function(d,m){var x={};x.version="0.4.1",x.settings={currency:{symbol:"$",format:"%s%v",decimal:".",thousand:",",precision:2,grouping:3},number:{precision:0,grouping:3,thousand:",",decimal:"."}};var T=Array.prototype.map,v=Array.isArray,h=Object.prototype.toString;function L(ye){return!!(ye===""||ye&&ye.charCodeAt&&ye.substr)}function U(ye){return v?v(ye):h.call(ye)==="[object Array]"}function j(ye){return ye&&h.call(ye)==="[object Object]"}function N(ye,Be){var ot;ye=ye||{},Be=Be||{};for(ot in Be)Be.hasOwnProperty(ot)&&ye[ot]==null&&(ye[ot]=Be[ot]);return ye}function V(ye,Be,ot){var at=[],xt,St;if(!ye)return at;if(T&&ye.map===T)return ye.map(Be,ot);for(xt=0,St=ye.length;xt<St;xt++)at[xt]=Be.call(ot,ye[xt],xt,ye);return at}function de(ye,Be){return ye=Math.round(Math.abs(ye)),isNaN(ye)?Be:ye}function _e(ye){var Be=x.settings.currency.format;return typeof ye=="function"&&(ye=ye()),L(ye)&&ye.match("%v")?{pos:ye,neg:ye.replace("-","").replace("%v","-%v"),zero:ye}:!ye||!ye.pos||!ye.pos.match("%v")?L(Be)?x.settings.currency.format={pos:Be,neg:Be.replace("%v","-%v"),zero:Be}:Be:ye}var Ie=x.unformat=x.parse=function(ye,Be){if(U(ye))return V(ye,function(xt){return Ie(xt,Be)});if(ye=ye||0,typeof ye=="number")return ye;Be=Be||x.settings.number.decimal;var ot=new RegExp("[^0-9-"+Be+"]",["g"]),at=parseFloat((""+ye).replace(/\((.*)\)/,"-$1").replace(ot,"").replace(Be,"."));return isNaN(at)?0:at},Je=x.toFixed=function(ye,Be){Be=de(Be,x.settings.number.precision);var ot=Math.pow(10,Be);return(Math.round(x.unformat(ye)*ot)/ot).toFixed(Be)},Ue=x.formatNumber=x.format=function(ye,Be,ot,at){if(U(ye))return V(ye,function(pt){return Ue(pt,Be,ot,at)});ye=Ie(ye);var xt=N(j(Be)?Be:{precision:Be,thousand:ot,decimal:at},x.settings.number),St=de(xt.precision),dt=ye<0?"-":"",kt=parseInt(Je(Math.abs(ye||0),St),10)+"",vt=kt.length>3?kt.length%3:0;return dt+(vt?kt.substr(0,vt)+xt.thousand:"")+kt.substr(vt).replace(/(\d{3})(?=\d)/g,"$1"+xt.thousand)+(St?xt.decimal+Je(Math.abs(ye),St).split(".")[1]:"")},We=x.formatMoney=function(ye,Be,ot,at,xt,St){if(U(ye))return V(ye,function(pt){return We(pt,Be,ot,at,xt,St)});ye=Ie(ye);var dt=N(j(Be)?Be:{symbol:Be,precision:ot,thousand:at,decimal:xt,format:St},x.settings.currency),kt=_e(dt.format),vt=ye>0?kt.pos:ye<0?kt.neg:kt.zero;return vt.replace("%s",dt.symbol).replace("%v",Ue(Math.abs(ye),de(dt.precision),dt.thousand,dt.decimal))};x.formatColumn=function(ye,Be,ot,at,xt,St){if(!ye)return[];var dt=N(j(Be)?Be:{symbol:Be,precision:ot,thousand:at,decimal:xt,format:St},x.settings.currency),kt=_e(dt.format),vt=kt.pos.indexOf("%s")<kt.pos.indexOf("%v"),pt=0,Bt=V(ye,function(Pt,di){if(U(Pt))return x.formatColumn(Pt,dt);Pt=Ie(Pt);var It=Pt>0?kt.pos:Pt<0?kt.neg:kt.zero,Ct=It.replace("%s",dt.symbol).replace("%v",Ue(Math.abs(Pt),de(dt.precision),dt.thousand,dt.decimal));return Ct.length>pt&&(pt=Ct.length),Ct});return V(Bt,function(Pt,di){return L(Pt)&&Pt.length<pt?vt?Pt.replace(dt.symbol,dt.symbol+new Array(pt-Pt.length+1).join(" ")):new Array(pt-Pt.length+1).join(" ")+Pt:Pt})},n.exports&&(a=n.exports=x),a.accounting=x})()})(Dp,Dp.exports);var oS=Dp.exports;const Yy=Ey(oS);function hn(n){const a=Object.prototype.toString.call(n);return n instanceof Date||typeof n=="object"&&a==="[object Date]"?new n.constructor(+n):typeof n=="number"||a==="[object Number]"||typeof n=="string"||a==="[object String]"?new Date(n):new Date(NaN)}function $n(n,a){return n instanceof Date?new n.constructor(a):new Date(a)}function Jy(n,a){const d=hn(n);return isNaN(a)?$n(n,NaN):(a&&d.setDate(d.getDate()+a),d)}function Qy(n,a){const d=hn(n);if(isNaN(a))return $n(n,NaN);if(!a)return d;const m=d.getDate(),x=$n(n,d.getTime());x.setMonth(d.getMonth()+a+1,0);const T=x.getDate();return m>=T?x:(d.setFullYear(x.getFullYear(),x.getMonth(),m),d)}function aS(n,a){const d=+hn(n);return $n(n,d+a)}const ex=6048e5,lS=864e5,tx=6e4,cf=36e5;function cS(n,a){return aS(n,a*cf)}let uS={};function Uh(){return uS}function kc(n,a){var h,L,U,j;const d=Uh(),m=(a==null?void 0:a.weekStartsOn)??((L=(h=a==null?void 0:a.locale)==null?void 0:h.options)==null?void 0:L.weekStartsOn)??d.weekStartsOn??((j=(U=d.locale)==null?void 0:U.options)==null?void 0:j.weekStartsOn)??0,x=hn(n),T=x.getDay(),v=(T<m?7:0)+T-m;return x.setDate(x.getDate()-v),x.setHours(0,0,0,0),x}function mh(n){return kc(n,{weekStartsOn:1})}function ix(n){const a=hn(n),d=a.getFullYear(),m=$n(n,0);m.setFullYear(d+1,0,4),m.setHours(0,0,0,0);const x=mh(m),T=$n(n,0);T.setFullYear(d,0,4),T.setHours(0,0,0,0);const v=mh(T);return a.getTime()>=x.getTime()?d+1:a.getTime()>=v.getTime()?d:d-1}function Xg(n){const a=hn(n);return a.setHours(0,0,0,0),a}function Yg(n){const a=hn(n),d=new Date(Date.UTC(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds()));return d.setUTCFullYear(a.getFullYear()),+n-+d}function hS(n,a){const d=Xg(n),m=Xg(a),x=+d-Yg(d),T=+m-Yg(m);return Math.round((x-T)/lS)}function dS(n){const a=ix(n),d=$n(n,0);return d.setFullYear(a,0,4),d.setHours(0,0,0,0),mh(d)}function pS(n,a){const d=a*7;return Jy(n,d)}function fS(n,a){return Qy(n,a*12)}function mS(n){return n instanceof Date||typeof n=="object"&&Object.prototype.toString.call(n)==="[object Date]"}function gS(n){if(!mS(n)&&typeof n!="number")return!1;const a=hn(n);return!isNaN(Number(a))}function _S(n){const a=hn(n),d=$n(n,0);return d.setFullYear(a.getFullYear(),0,1),d.setHours(0,0,0,0),d}const yS={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},xS=(n,a,d)=>{let m;const x=yS[n];return typeof x=="string"?m=x:a===1?m=x.one:m=x.other.replace("{{count}}",a.toString()),d!=null&&d.addSuffix?d.comparison&&d.comparison>0?"in "+m:m+" ago":m};function cp(n){return(a={})=>{const d=a.width?String(a.width):n.defaultWidth;return n.formats[d]||n.formats[n.defaultWidth]}}const vS={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},bS={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},wS={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},SS={date:cp({formats:vS,defaultWidth:"full"}),time:cp({formats:bS,defaultWidth:"full"}),dateTime:cp({formats:wS,defaultWidth:"full"})},TS={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},AS=(n,a,d,m)=>TS[n];function dc(n){return(a,d)=>{const m=d!=null&&d.context?String(d.context):"standalone";let x;if(m==="formatting"&&n.formattingValues){const v=n.defaultFormattingWidth||n.defaultWidth,h=d!=null&&d.width?String(d.width):v;x=n.formattingValues[h]||n.formattingValues[v]}else{const v=n.defaultWidth,h=d!=null&&d.width?String(d.width):n.defaultWidth;x=n.values[h]||n.values[v]}const T=n.argumentCallback?n.argumentCallback(a):a;return x[T]}}const IS={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},ES={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},PS={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},CS={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},MS={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},kS={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},DS=(n,a)=>{const d=Number(n),m=d%100;if(m>20||m<10)switch(m%10){case 1:return d+"st";case 2:return d+"nd";case 3:return d+"rd"}return d+"th"},zS={ordinalNumber:DS,era:dc({values:IS,defaultWidth:"wide"}),quarter:dc({values:ES,defaultWidth:"wide",argumentCallback:n=>n-1}),month:dc({values:PS,defaultWidth:"wide"}),day:dc({values:CS,defaultWidth:"wide"}),dayPeriod:dc({values:MS,defaultWidth:"wide",formattingValues:kS,defaultFormattingWidth:"wide"})};function pc(n){return(a,d={})=>{const m=d.width,x=m&&n.matchPatterns[m]||n.matchPatterns[n.defaultMatchWidth],T=a.match(x);if(!T)return null;const v=T[0],h=m&&n.parsePatterns[m]||n.parsePatterns[n.defaultParseWidth],L=Array.isArray(h)?LS(h,N=>N.test(v)):RS(h,N=>N.test(v));let U;U=n.valueCallback?n.valueCallback(L):L,U=d.valueCallback?d.valueCallback(U):U;const j=a.slice(v.length);return{value:U,rest:j}}}function RS(n,a){for(const d in n)if(Object.prototype.hasOwnProperty.call(n,d)&&a(n[d]))return d}function LS(n,a){for(let d=0;d<n.length;d++)if(a(n[d]))return d}function FS(n){return(a,d={})=>{const m=a.match(n.matchPattern);if(!m)return null;const x=m[0],T=a.match(n.parsePattern);if(!T)return null;let v=n.valueCallback?n.valueCallback(T[0]):T[0];v=d.valueCallback?d.valueCallback(v):v;const h=a.slice(x.length);return{value:v,rest:h}}}const OS=/^(\d+)(th|st|nd|rd)?/i,BS=/\d+/i,NS={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},VS={any:[/^b/i,/^(a|c)/i]},$S={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},US={any:[/1/i,/2/i,/3/i,/4/i]},jS={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},qS={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},GS={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},HS={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},ZS={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},WS={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},KS={ordinalNumber:FS({matchPattern:OS,parsePattern:BS,valueCallback:n=>parseInt(n,10)}),era:pc({matchPatterns:NS,defaultMatchWidth:"wide",parsePatterns:VS,defaultParseWidth:"any"}),quarter:pc({matchPatterns:$S,defaultMatchWidth:"wide",parsePatterns:US,defaultParseWidth:"any",valueCallback:n=>n+1}),month:pc({matchPatterns:jS,defaultMatchWidth:"wide",parsePatterns:qS,defaultParseWidth:"any"}),day:pc({matchPatterns:GS,defaultMatchWidth:"wide",parsePatterns:HS,defaultParseWidth:"any"}),dayPeriod:pc({matchPatterns:ZS,defaultMatchWidth:"any",parsePatterns:WS,defaultParseWidth:"any"})},XS={code:"en-US",formatDistance:xS,formatLong:SS,formatRelative:AS,localize:zS,match:KS,options:{weekStartsOn:0,firstWeekContainsDate:1}};function YS(n){const a=hn(n);return hS(a,_S(a))+1}function JS(n){const a=hn(n),d=+mh(a)-+dS(a);return Math.round(d/ex)+1}function rx(n,a){var j,N,V,de;const d=hn(n),m=d.getFullYear(),x=Uh(),T=(a==null?void 0:a.firstWeekContainsDate)??((N=(j=a==null?void 0:a.locale)==null?void 0:j.options)==null?void 0:N.firstWeekContainsDate)??x.firstWeekContainsDate??((de=(V=x.locale)==null?void 0:V.options)==null?void 0:de.firstWeekContainsDate)??1,v=$n(n,0);v.setFullYear(m+1,0,T),v.setHours(0,0,0,0);const h=kc(v,a),L=$n(n,0);L.setFullYear(m,0,T),L.setHours(0,0,0,0);const U=kc(L,a);return d.getTime()>=h.getTime()?m+1:d.getTime()>=U.getTime()?m:m-1}function QS(n,a){var h,L,U,j;const d=Uh(),m=(a==null?void 0:a.firstWeekContainsDate)??((L=(h=a==null?void 0:a.locale)==null?void 0:h.options)==null?void 0:L.firstWeekContainsDate)??d.firstWeekContainsDate??((j=(U=d.locale)==null?void 0:U.options)==null?void 0:j.firstWeekContainsDate)??1,x=rx(n,a),T=$n(n,0);return T.setFullYear(x,0,m),T.setHours(0,0,0,0),kc(T,a)}function eT(n,a){const d=hn(n),m=+kc(d,a)-+QS(d,a);return Math.round(m/ex)+1}function _i(n,a){const d=n<0?"-":"",m=Math.abs(n).toString().padStart(a,"0");return d+m}const Js={y(n,a){const d=n.getFullYear(),m=d>0?d:1-d;return _i(a==="yy"?m%100:m,a.length)},M(n,a){const d=n.getMonth();return a==="M"?String(d+1):_i(d+1,2)},d(n,a){return _i(n.getDate(),a.length)},a(n,a){const d=n.getHours()/12>=1?"pm":"am";switch(a){case"a":case"aa":return d.toUpperCase();case"aaa":return d;case"aaaaa":return d[0];case"aaaa":default:return d==="am"?"a.m.":"p.m."}},h(n,a){return _i(n.getHours()%12||12,a.length)},H(n,a){return _i(n.getHours(),a.length)},m(n,a){return _i(n.getMinutes(),a.length)},s(n,a){return _i(n.getSeconds(),a.length)},S(n,a){const d=a.length,m=n.getMilliseconds(),x=Math.trunc(m*Math.pow(10,d-3));return _i(x,a.length)}},Ha={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Jg={G:function(n,a,d){const m=n.getFullYear()>0?1:0;switch(a){case"G":case"GG":case"GGG":return d.era(m,{width:"abbreviated"});case"GGGGG":return d.era(m,{width:"narrow"});case"GGGG":default:return d.era(m,{width:"wide"})}},y:function(n,a,d){if(a==="yo"){const m=n.getFullYear(),x=m>0?m:1-m;return d.ordinalNumber(x,{unit:"year"})}return Js.y(n,a)},Y:function(n,a,d,m){const x=rx(n,m),T=x>0?x:1-x;if(a==="YY"){const v=T%100;return _i(v,2)}return a==="Yo"?d.ordinalNumber(T,{unit:"year"}):_i(T,a.length)},R:function(n,a){const d=ix(n);return _i(d,a.length)},u:function(n,a){const d=n.getFullYear();return _i(d,a.length)},Q:function(n,a,d){const m=Math.ceil((n.getMonth()+1)/3);switch(a){case"Q":return String(m);case"QQ":return _i(m,2);case"Qo":return d.ordinalNumber(m,{unit:"quarter"});case"QQQ":return d.quarter(m,{width:"abbreviated",context:"formatting"});case"QQQQQ":return d.quarter(m,{width:"narrow",context:"formatting"});case"QQQQ":default:return d.quarter(m,{width:"wide",context:"formatting"})}},q:function(n,a,d){const m=Math.ceil((n.getMonth()+1)/3);switch(a){case"q":return String(m);case"qq":return _i(m,2);case"qo":return d.ordinalNumber(m,{unit:"quarter"});case"qqq":return d.quarter(m,{width:"abbreviated",context:"standalone"});case"qqqqq":return d.quarter(m,{width:"narrow",context:"standalone"});case"qqqq":default:return d.quarter(m,{width:"wide",context:"standalone"})}},M:function(n,a,d){const m=n.getMonth();switch(a){case"M":case"MM":return Js.M(n,a);case"Mo":return d.ordinalNumber(m+1,{unit:"month"});case"MMM":return d.month(m,{width:"abbreviated",context:"formatting"});case"MMMMM":return d.month(m,{width:"narrow",context:"formatting"});case"MMMM":default:return d.month(m,{width:"wide",context:"formatting"})}},L:function(n,a,d){const m=n.getMonth();switch(a){case"L":return String(m+1);case"LL":return _i(m+1,2);case"Lo":return d.ordinalNumber(m+1,{unit:"month"});case"LLL":return d.month(m,{width:"abbreviated",context:"standalone"});case"LLLLL":return d.month(m,{width:"narrow",context:"standalone"});case"LLLL":default:return d.month(m,{width:"wide",context:"standalone"})}},w:function(n,a,d,m){const x=eT(n,m);return a==="wo"?d.ordinalNumber(x,{unit:"week"}):_i(x,a.length)},I:function(n,a,d){const m=JS(n);return a==="Io"?d.ordinalNumber(m,{unit:"week"}):_i(m,a.length)},d:function(n,a,d){return a==="do"?d.ordinalNumber(n.getDate(),{unit:"date"}):Js.d(n,a)},D:function(n,a,d){const m=YS(n);return a==="Do"?d.ordinalNumber(m,{unit:"dayOfYear"}):_i(m,a.length)},E:function(n,a,d){const m=n.getDay();switch(a){case"E":case"EE":case"EEE":return d.day(m,{width:"abbreviated",context:"formatting"});case"EEEEE":return d.day(m,{width:"narrow",context:"formatting"});case"EEEEEE":return d.day(m,{width:"short",context:"formatting"});case"EEEE":default:return d.day(m,{width:"wide",context:"formatting"})}},e:function(n,a,d,m){const x=n.getDay(),T=(x-m.weekStartsOn+8)%7||7;switch(a){case"e":return String(T);case"ee":return _i(T,2);case"eo":return d.ordinalNumber(T,{unit:"day"});case"eee":return d.day(x,{width:"abbreviated",context:"formatting"});case"eeeee":return d.day(x,{width:"narrow",context:"formatting"});case"eeeeee":return d.day(x,{width:"short",context:"formatting"});case"eeee":default:return d.day(x,{width:"wide",context:"formatting"})}},c:function(n,a,d,m){const x=n.getDay(),T=(x-m.weekStartsOn+8)%7||7;switch(a){case"c":return String(T);case"cc":return _i(T,a.length);case"co":return d.ordinalNumber(T,{unit:"day"});case"ccc":return d.day(x,{width:"abbreviated",context:"standalone"});case"ccccc":return d.day(x,{width:"narrow",context:"standalone"});case"cccccc":return d.day(x,{width:"short",context:"standalone"});case"cccc":default:return d.day(x,{width:"wide",context:"standalone"})}},i:function(n,a,d){const m=n.getDay(),x=m===0?7:m;switch(a){case"i":return String(x);case"ii":return _i(x,a.length);case"io":return d.ordinalNumber(x,{unit:"day"});case"iii":return d.day(m,{width:"abbreviated",context:"formatting"});case"iiiii":return d.day(m,{width:"narrow",context:"formatting"});case"iiiiii":return d.day(m,{width:"short",context:"formatting"});case"iiii":default:return d.day(m,{width:"wide",context:"formatting"})}},a:function(n,a,d){const x=n.getHours()/12>=1?"pm":"am";switch(a){case"a":case"aa":return d.dayPeriod(x,{width:"abbreviated",context:"formatting"});case"aaa":return d.dayPeriod(x,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return d.dayPeriod(x,{width:"narrow",context:"formatting"});case"aaaa":default:return d.dayPeriod(x,{width:"wide",context:"formatting"})}},b:function(n,a,d){const m=n.getHours();let x;switch(m===12?x=Ha.noon:m===0?x=Ha.midnight:x=m/12>=1?"pm":"am",a){case"b":case"bb":return d.dayPeriod(x,{width:"abbreviated",context:"formatting"});case"bbb":return d.dayPeriod(x,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return d.dayPeriod(x,{width:"narrow",context:"formatting"});case"bbbb":default:return d.dayPeriod(x,{width:"wide",context:"formatting"})}},B:function(n,a,d){const m=n.getHours();let x;switch(m>=17?x=Ha.evening:m>=12?x=Ha.afternoon:m>=4?x=Ha.morning:x=Ha.night,a){case"B":case"BB":case"BBB":return d.dayPeriod(x,{width:"abbreviated",context:"formatting"});case"BBBBB":return d.dayPeriod(x,{width:"narrow",context:"formatting"});case"BBBB":default:return d.dayPeriod(x,{width:"wide",context:"formatting"})}},h:function(n,a,d){if(a==="ho"){let m=n.getHours()%12;return m===0&&(m=12),d.ordinalNumber(m,{unit:"hour"})}return Js.h(n,a)},H:function(n,a,d){return a==="Ho"?d.ordinalNumber(n.getHours(),{unit:"hour"}):Js.H(n,a)},K:function(n,a,d){const m=n.getHours()%12;return a==="Ko"?d.ordinalNumber(m,{unit:"hour"}):_i(m,a.length)},k:function(n,a,d){let m=n.getHours();return m===0&&(m=24),a==="ko"?d.ordinalNumber(m,{unit:"hour"}):_i(m,a.length)},m:function(n,a,d){return a==="mo"?d.ordinalNumber(n.getMinutes(),{unit:"minute"}):Js.m(n,a)},s:function(n,a,d){return a==="so"?d.ordinalNumber(n.getSeconds(),{unit:"second"}):Js.s(n,a)},S:function(n,a){return Js.S(n,a)},X:function(n,a,d){const m=n.getTimezoneOffset();if(m===0)return"Z";switch(a){case"X":return e_(m);case"XXXX":case"XX":return No(m);case"XXXXX":case"XXX":default:return No(m,":")}},x:function(n,a,d){const m=n.getTimezoneOffset();switch(a){case"x":return e_(m);case"xxxx":case"xx":return No(m);case"xxxxx":case"xxx":default:return No(m,":")}},O:function(n,a,d){const m=n.getTimezoneOffset();switch(a){case"O":case"OO":case"OOO":return"GMT"+Qg(m,":");case"OOOO":default:return"GMT"+No(m,":")}},z:function(n,a,d){const m=n.getTimezoneOffset();switch(a){case"z":case"zz":case"zzz":return"GMT"+Qg(m,":");case"zzzz":default:return"GMT"+No(m,":")}},t:function(n,a,d){const m=Math.trunc(n.getTime()/1e3);return _i(m,a.length)},T:function(n,a,d){const m=n.getTime();return _i(m,a.length)}};function Qg(n,a=""){const d=n>0?"-":"+",m=Math.abs(n),x=Math.trunc(m/60),T=m%60;return T===0?d+String(x):d+String(x)+a+_i(T,2)}function e_(n,a){return n%60===0?(n>0?"-":"+")+_i(Math.abs(n)/60,2):No(n,a)}function No(n,a=""){const d=n>0?"-":"+",m=Math.abs(n),x=_i(Math.trunc(m/60),2),T=_i(m%60,2);return d+x+a+T}const t_=(n,a)=>{switch(n){case"P":return a.date({width:"short"});case"PP":return a.date({width:"medium"});case"PPP":return a.date({width:"long"});case"PPPP":default:return a.date({width:"full"})}},nx=(n,a)=>{switch(n){case"p":return a.time({width:"short"});case"pp":return a.time({width:"medium"});case"ppp":return a.time({width:"long"});case"pppp":default:return a.time({width:"full"})}},tT=(n,a)=>{const d=n.match(/(P+)(p+)?/)||[],m=d[1],x=d[2];if(!x)return t_(n,a);let T;switch(m){case"P":T=a.dateTime({width:"short"});break;case"PP":T=a.dateTime({width:"medium"});break;case"PPP":T=a.dateTime({width:"long"});break;case"PPPP":default:T=a.dateTime({width:"full"});break}return T.replace("{{date}}",t_(m,a)).replace("{{time}}",nx(x,a))},iT={p:nx,P:tT},rT=/^D+$/,nT=/^Y+$/,sT=["D","DD","YY","YYYY"];function oT(n){return rT.test(n)}function aT(n){return nT.test(n)}function lT(n,a,d){const m=cT(n,a,d);if(console.warn(m),sT.includes(n))throw new RangeError(m)}function cT(n,a,d){const m=n[0]==="Y"?"years":"days of the month";return`Use \`${n.toLowerCase()}\` instead of \`${n}\` (in \`${a}\`) for formatting ${m} to the input \`${d}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const uT=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,hT=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,dT=/^'([^]*?)'?$/,pT=/''/g,fT=/[a-zA-Z]/;function zp(n,a,d){var j,N,V,de,_e,Ie,Je,Ue;const m=Uh(),x=(d==null?void 0:d.locale)??m.locale??XS,T=(d==null?void 0:d.firstWeekContainsDate)??((N=(j=d==null?void 0:d.locale)==null?void 0:j.options)==null?void 0:N.firstWeekContainsDate)??m.firstWeekContainsDate??((de=(V=m.locale)==null?void 0:V.options)==null?void 0:de.firstWeekContainsDate)??1,v=(d==null?void 0:d.weekStartsOn)??((Ie=(_e=d==null?void 0:d.locale)==null?void 0:_e.options)==null?void 0:Ie.weekStartsOn)??m.weekStartsOn??((Ue=(Je=m.locale)==null?void 0:Je.options)==null?void 0:Ue.weekStartsOn)??0,h=hn(n);if(!gS(h))throw new RangeError("Invalid time value");let L=a.match(hT).map(We=>{const ye=We[0];if(ye==="p"||ye==="P"){const Be=iT[ye];return Be(We,x.formatLong)}return We}).join("").match(uT).map(We=>{if(We==="''")return{isToken:!1,value:"'"};const ye=We[0];if(ye==="'")return{isToken:!1,value:mT(We)};if(Jg[ye])return{isToken:!0,value:We};if(ye.match(fT))throw new RangeError("Format string contains an unescaped latin alphabet character `"+ye+"`");return{isToken:!1,value:We}});x.localize.preprocessor&&(L=x.localize.preprocessor(h,L));const U={firstWeekContainsDate:T,weekStartsOn:v,locale:x};return L.map(We=>{if(!We.isToken)return We.value;const ye=We.value;(!(d!=null&&d.useAdditionalWeekYearTokens)&&aT(ye)||!(d!=null&&d.useAdditionalDayOfYearTokens)&&oT(ye))&&lT(ye,a,String(n));const Be=Jg[ye[0]];return Be(h,ye,x.localize,U)}).join("")}function mT(n){const a=n.match(dT);return a?a[1].replace(pT,"'"):n}function gT(n,a){return Jy(n,-a)}function _T(n,a){const d=(a==null?void 0:a.additionalDigits)??2,m=bT(n);let x;if(m.date){const L=wT(m.date,d);x=ST(L.restDateString,L.year)}if(!x||isNaN(x.getTime()))return new Date(NaN);const T=x.getTime();let v=0,h;if(m.time&&(v=TT(m.time),isNaN(v)))return new Date(NaN);if(m.timezone){if(h=AT(m.timezone),isNaN(h))return new Date(NaN)}else{const L=new Date(T+v),U=new Date(0);return U.setFullYear(L.getUTCFullYear(),L.getUTCMonth(),L.getUTCDate()),U.setHours(L.getUTCHours(),L.getUTCMinutes(),L.getUTCSeconds(),L.getUTCMilliseconds()),U}return new Date(T+v+h)}const Xu={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},yT=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,xT=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,vT=/^([+-])(\d{2})(?::?(\d{2}))?$/;function bT(n){const a={},d=n.split(Xu.dateTimeDelimiter);let m;if(d.length>2)return a;if(/:/.test(d[0])?m=d[0]:(a.date=d[0],m=d[1],Xu.timeZoneDelimiter.test(a.date)&&(a.date=n.split(Xu.timeZoneDelimiter)[0],m=n.substr(a.date.length,n.length))),m){const x=Xu.timezone.exec(m);x?(a.time=m.replace(x[1],""),a.timezone=x[1]):a.time=m}return a}function wT(n,a){const d=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+a)+"})|(\\d{2}|[+-]\\d{"+(2+a)+"})$)"),m=n.match(d);if(!m)return{year:NaN,restDateString:""};const x=m[1]?parseInt(m[1]):null,T=m[2]?parseInt(m[2]):null;return{year:T===null?x:T*100,restDateString:n.slice((m[1]||m[2]).length)}}function ST(n,a){if(a===null)return new Date(NaN);const d=n.match(yT);if(!d)return new Date(NaN);const m=!!d[4],x=fc(d[1]),T=fc(d[2])-1,v=fc(d[3]),h=fc(d[4]),L=fc(d[5])-1;if(m)return MT(a,h,L)?IT(a,h,L):new Date(NaN);{const U=new Date(0);return!PT(a,T,v)||!CT(a,x)?new Date(NaN):(U.setUTCFullYear(a,T,Math.max(x,v)),U)}}function fc(n){return n?parseInt(n):1}function TT(n){const a=n.match(xT);if(!a)return NaN;const d=up(a[1]),m=up(a[2]),x=up(a[3]);return kT(d,m,x)?d*cf+m*tx+x*1e3:NaN}function up(n){return n&&parseFloat(n.replace(",","."))||0}function AT(n){if(n==="Z")return 0;const a=n.match(vT);if(!a)return 0;const d=a[1]==="+"?-1:1,m=parseInt(a[2]),x=a[3]&&parseInt(a[3])||0;return DT(m,x)?d*(m*cf+x*tx):NaN}function IT(n,a,d){const m=new Date(0);m.setUTCFullYear(n,0,4);const x=m.getUTCDay()||7,T=(a-1)*7+d+1-x;return m.setUTCDate(m.getUTCDate()+T),m}const ET=[31,null,31,30,31,30,31,31,30,31,30,31];function sx(n){return n%400===0||n%4===0&&n%100!==0}function PT(n,a,d){return a>=0&&a<=11&&d>=1&&d<=(ET[a]||(sx(n)?29:28))}function CT(n,a){return a>=1&&a<=(sx(n)?366:365)}function MT(n,a,d){return a>=1&&a<=53&&d>=0&&d<=6}function kT(n,a,d){return n===24?a===0&&d===0:d>=0&&d<60&&a>=0&&a<60&&n>=0&&n<25}function DT(n,a){return a>=0&&a<=59}function zT(n,a){return Qy(n,-a)}function RT(n,a){return cS(n,-a)}function LT(n,a){return pS(n,-a)}function FT(n,a){return fS(n,-a)}Yy.settings.currency.precision=0;function uf(){return{bold:m=>"<strong>"+m+"</strong>",currency:m=>Yy.formatMoney(m),date:m=>{let x;return typeof m=="string"?x=zp(_T(m),"MM/dd/yyyy"):x=zp(m,"MM/dd/yyyy"),x}}}const{currency:i_,date:OT}=uf(),ox=Cs("OpaStore",{state:()=>({opaData:{}}),actions:{async fillOpaData(){const a=un().addressData.features[0].properties.opa_account_num,d=await fetch(`https://phl.carto.com/api/v2/sql?q=select+*+from+opa_properties_public+where+parcel_number+%3D+%27${a}%27`);this.opaData=await d.json()}},getters:{getMarketValue:n=>i_(n.opaData.rows[0].market_value||null),getSaleDate:n=>OT(n.opaData.rows[0].sale_date),getSalePrice:n=>i_(n.opaData.rows[0].sale_price)}}),ax=Cs("LiStore",{state:()=>({liInspections:{},liPermits:{}}),actions:{async fillLiInspections(){const a=un().addressData.features[0];let d="https://phl.carto.com/api/v2/sql?q=";const m=a.properties.eclipse_location_id.replace(/\|/g,"', '"),x=a.properties.street_address,T=a.properties.opa_account_num?` AND opa_account_num IN ('${a.properties.opa_account_num}')`:"",v=a.properties.pwd_parcel_id,h=a.properties.li_address_key.replace(/\|/g,"', '"),L=d+=`SELECT * FROM case_investigations WHERE (address = '${x}' or addressobjectid IN ('${h}'))           AND systemofrecord IN ('HANSEN') ${T} UNION SELECT * FROM case_investigations WHERE           addressobjectid IN ('${m}') OR parcel_id_num IN ( '${v}' )           AND systemofrecord IN ('ECLIPSE') ${T}`,U=await fetch(L);this.liInspections=await U.json()},async fillLiPermits(){const a=un().addressData.features[0];let d="https://phl.carto.com/api/v2/sql?q=";const m=a.properties.eclipse_location_id.replace(/\|/g,"', '"),x=a.properties.street_address,T=a.properties.opa_account_num?` AND opa_account_num IN ('${a.properties.opa_account_num}')`:"",v=a.properties.pwd_parcel_id,h=a.properties.li_address_key.replace(/\|/g,"', '"),L=d+=`SELECT * FROM PERMITS WHERE address = '${x}' or addressobjectid IN ('${h}')       AND systemofrecord IN ('HANSEN') ${T}       UNION SELECT * FROM PERMITS WHERE addressobjectid IN ('${m}') OR parcel_id_num IN ( '${v}' )       AND systemofrecord IN ('ECLIPSE')${T}      ORDER BY permittype`,U=await fetch(L);this.liPermits=await U.json()}},getters:{}}),Ka=function(n){var a=n?String(n):"";return a=a.replace(/\s+/g,""),[null,"0"].indexOf(a)>-1?"":a},BT=function(n,a){console.log("concatDorAddress is running, parcel:",n),a=!!a;var d=["STDIR","STNAM","STDES","STDESSUF"],m=n.properties,x=Ka(m.HOUSE),T=Ka(m.STEX),v=Ka(m.SUF),h=x;h=h+(T?"-"+T:""),h=h+(v||"");var L=Ka(m.UNIT);L&&(L="# "+L);var U=d.map(function(j){return m[j]});return U=U.map(Ka),U=[h].concat(U),a&&(U=U.concat([L])),h=U.filter(Boolean).join(" "),h===""&&(h="Parcel has no address"),console.log("concatDorAddress address result:",h),h},lx=Cs("DorStore",{state:()=>({dorDocuments:{}}),actions:{async initializeDorDocuments(){this.dorDocuments={};const n=$h(),a=un(),d="//services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/RTT_SUMMARY/FeatureServer/0/query",m=function(x){console.log("where function is running, feature:",x);var T=BT(x),v=a.addressData.features[0].properties,h;if(!T||T==="null")h="MATCHED_REGMAP = '"+n.DOR.features[0].properties.BASEREG+"'";else{var L=a.addressData.features[0].properties,U=L.address_low,j=Math.floor(U/100,1)*100,N=U-j,V=L.address_high,de=V||U;h="(((ADDRESS_LOW >= "+U+" AND ADDRESS_LOW <= "+de+") OR (ADDRESS_LOW >= "+j+" AND ADDRESS_LOW <= "+de+" AND ADDRESS_HIGH >= "+N+" )) AND STREET_NAME = '"+v.street_name+"' AND STREET_SUFFIX = '"+v.street_suffix+"' AND (MOD(ADDRESS_LOW,2) = MOD( "+U+",2))",v.street_predir!=""&&(h+=" AND STREET_PREDIR = '"+v.street_predir+"'"),v.address_low_suffix!=""&&(h+=" AND ADDRESS_LOW_SUFFIX = '"+v.address_low_suffix+"'"),v.address_low_suffix==""&&(h+=" AND ADDRESS_LOW_SUFFIX = ''"),v.address_low_frac==="1/2"&&(h+=" AND ADDRESS_LOW_SUFFIX = '2'"),v.street_postdir!=""&&(h+=" AND STREET_POSTDIR = '"+v.street_postdir+"'");var _e=Ka(x.properties.UNIT),Ie=v.unit_num;_e?h+=" AND UNIT_NUM = '"+_e+"'":Ie!==""&&(h+=" AND UNIT_NUM = '"+Ie+"'"),h+=") or MATCHED_REGMAP = '"+n.DOR.features[0].properties.BASEREG+"'",h+=" or REG_MAP_ID = '"+n.DOR.features[0].properties.BASEREG+"'"}return h};for(let x of n.DOR.features){const v={where:m(x),outFields:"DOCUMENT_ID, DISPLAY_DATE, DOCUMENT_TYPE, GRANTORS, GRANTEES",returnDistinctValues:"true",returnGeometry:"false",f:"json",sqlFormat:"standard"};console.log("params:",v);const h=await Vi(d,{params:v});this.dorDocuments[x.properties.OBJECTID]=h}}}}),NT=(n,a)=>{const d={};if(!a.options.params)return d;const m=Object.entries(a.options.params);(void 0).store.state;for(let[x,T]of m){let v;typeof T=="function"?v=T(n):v=T,d[x]=v}return d},r_=(n,a)=>{const d=NT(n,a);a.url;const m=a.options,x=m.table,T=m.dateMinNum||null,v=m.dateMinType||null,h=m.dateField||null;m.success;const L=m.distances||250,U=m.groupby||null,j="ST_Distance(the_geom::geography, ST_SetSRID(ST_Point("+n.geometry.coordinates[0]+","+n.geometry.coordinates[1]+"),4326)::geography)",N="ST_Y(the_geom)",V="ST_X(the_geom)";let de;U?de=U+", the_geom":de="*",de=de+", "+j+"as distance,"+N+"as lat, "+V+"as lng",d.q="select "+de+" from "+x+" where "+j+" < "+L;let _e;if(T){switch(v){case"hour":_e=RT;break;case"day":_e=gT;break;case"week":_e=LT;break;case"month":_e=zT;break;case"year":_e=FT;break}d.q=d.q+" and "+h+" > '"+zp(_e(new Date,T),"yyyy-MM-dd")+"'"}return U&&(d.q=d.q+" group by "+U+", the_geom"),d},cx=Cs("NearbyActivityStore",{state:()=>({nearby311:{},nearbyCrimeIncidents:null,nearbyZoningAppeals:null,nearbyVacantIndicatorPoints:null,nearbyConstructionPermits:null,nearbyDemolitionPermits:null,nearbyImminentlyDangerous:null}),actions:{async fetchData(n){console.log("fetchData is runnning, dataType:",n),n==="nearby311"?await this.fillNearby311():n==="nearbyCrimeIncidents"&&await this.fillNearbyCrimeIncidents()},async fillNearby311(){const a=un().addressData.features[0];let d={url:"https://phl.carto.com/api/v2/sql?",options:{table:"public_cases_fc",dateMinNum:30,dateMinType:"day",dateField:"requested_datetime"}},m=r_(a,d);const x=await Vi.get(d.url,{params:m});this.nearby311=x},async fillNearbyCrimeIncidents(){const a=un().addressData.features[0];let d={url:"https://phl.carto.com/api/v2/sql?",options:{table:"incidents_part1_part2",dateMinNum:30,dateMinType:"day",dateField:"dispatch_date"}},m=r_(a,d);const x=await Vi.get(d.url,{params:m});this.nearbyCrimeIncidents=x}}});function VT(){return{addressDataFetch:async x=>{console.log("addressDataFetch is running"),await un().fillAddressData(x)},parcelsDataFetch:async()=>{const x=$h();await x.fillPwdParcelData(),await x.fillDorParcelData()},condosDataFetch:async x=>{console.log("condosDataFetch is running"),await Oc().fillCondoData(x)},topicDataFetch:async x=>{if(console.log("topicDataFetch is running, topic:",x),x==="Property"&&await ox().fillOpaData(),x==="Licenses & Inspections"){const T=ax();await T.fillLiInspections(),await T.fillLiPermits()}x==="Deeds"&&await lx().initializeDorDocuments(),x==="Nearby Activity"&&await cx().fillNearby311()}}}const Bc=(n,a)=>{const d=n.__vccOpts||n;for(const[m,x]of a)d[m]=x;return d},$T={class:"topic-name has-text-left"},UT={key:0,class:"topic-loading has-text-right"},jT={key:0},qT={class:"inside-topic"},GT={__name:"Topic",props:{topicName:String,loading:Boolean},setup(n){const a=Lh(),d=n,{currentAddress:m}=z1(a),x=tf(),T=Iy();x.params.topic;const v=ar(()=>x.params.topic==d.topicName),h=()=>{console.log("topic clicked:",d.topicName),x.params.topic==d.topicName?T.push({name:"address",params:{address:m.value}}):T.push({name:"address-and-topic",params:{address:m.value,topic:d.topicName}})};return(L,U)=>(Nt(),ri("section",null,[fe("div",{class:"topic",onClick:h},[fe("span",$T,ei(n.topicName),1),v.value&&n.loading?(Nt(),ri("span",UT,"Loading...")):br("",!0)]),v.value?(Nt(),ri("div",jT,[fe("div",qT,[mb(L.$slots,"default",{},void 0,!0)])])):br("",!0)]))}},Bo=Bc(GT,[["__scopeId","data-v-33aef821"]]),lo=n=>(Ah("data-v-49281eb6"),n=n(),Ih(),n),HT={key:0,class:"box"},ZT={key:1,class:"vert-table"},WT={class:"columns"},KT=lo(()=>fe("div",{class:"column is-4"},"OPA Account #",-1)),XT={class:"column is-8"},YT={class:"columns"},JT=lo(()=>fe("div",{class:"column is-4"},"OPA Address",-1)),QT={class:"column is-8"},eA={class:"columns"},tA=lo(()=>fe("div",{class:"column is-4"},"Owners",-1)),iA={class:"column is-8"},rA={class:"columns"},nA=lo(()=>fe("div",{class:"column is-4"},"Assessed Value",-1)),sA={class:"column is-8"},oA={class:"columns"},aA=lo(()=>fe("div",{class:"column is-4"},"Sale Date",-1)),lA={class:"column is-8"},cA={class:"columns"},uA=lo(()=>fe("div",{class:"column is-4"},"Sale Price",-1)),hA={class:"column is-8"},dA={key:2},pA={class:"title is-5"},fA=lo(()=>fe("p",null,"You can use the Condominiums tab below to see information for an individual unit.",-1)),mA={key:3},gA=lo(()=>fe("p",null,"There is no property assessment record for this address.",-1)),_A=[gA],yA={__name:"Property",setup(n){console.log("Property.vue setup");const a=un(),d=ox(),m=Oc();return(x,T)=>(Nt(),ri("section",null,[qt(d).opaData.rows.length?(Nt(),ri("div",HT," Property assessment and sale information for this address. Source: Office of Property Assessments (OPA). OPA was formerly a part of the Bureau of Revision of Taxes (BRT) and some City records may still use that name. ")):br("",!0),qt(d).opaData.rows.length?(Nt(),ri("div",ZT,[fe("div",WT,[KT,fe("div",XT,ei(qt(a).addressData.features[0].properties.opa_account_num),1)]),fe("div",YT,[JT,fe("div",QT,ei(qt(a).addressData.features[0].properties.opa_address),1)]),fe("div",eA,[tA,fe("div",iA,ei(qt(a).getOpaOwners),1)]),fe("div",rA,[nA,fe("div",sA,ei(qt(d).getMarketValue),1)]),fe("div",oA,[aA,fe("div",lA,ei(qt(d).getSaleDate),1)]),fe("div",cA,[uA,fe("div",hA,ei(qt(d).getSalePrice),1)])])):br("",!0),!qt(d).opaData.rows.length&&qt(m).condosData.length?(Nt(),ri("div",dA,[fe("h5",pA,"There are "+ei(qt(m).condosData.length)+" condominium units at this address.",1),fA])):qt(d).opaData.rows.length?br("",!0):(Nt(),ri("div",mA,_A))]))}},xA=Bc(yA,[["__scopeId","data-v-49281eb6"]]),vA=fe("div",{class:"box"}," Condominium units at your search address, as recorded for property assessment purposes. Click one of the addresses below to see information for that unit. Use the back button to return to this list. Source: Office of Property Assessment ",-1),bA=fe("h5",{class:"subtitle is-5"},"Condominiums",-1),wA={class:"table is-fullwidth is-striped"},SA=fe("thead",null,[fe("tr",null,[fe("th",null,"Address"),fe("th",null,"OPA Account #")])],-1),TA={__name:"Condos",setup(n){console.log("Condos.vue setup");const a=Oc(),d=ar(()=>a.condosData);return(m,x)=>(Nt(),ri("section",null,[vA,bA,fe("table",wA,[SA,fe("tbody",null,[(Nt(!0),ri(pr,null,qo(d.value,T=>(Nt(),ri("tr",null,[fe("td",null,[Ni(qt(Ty),{to:{name:"address-and-topic",params:{address:T.properties.opa_address,topic:"Property"}}},{default:Ts(()=>[sy(ei(T.properties.opa_address),1)]),_:2},1032,["to"])]),fe("td",null,ei(T.properties.opa_account_num),1)]))),256))])])]))}},Un=n=>(Ah("data-v-071ec60b"),n=n(),Ih(),n),AA=Un(()=>fe("div",{class:"box"},"Deed information and document transactions for this address. The map faithfully reflects property boundaries as described in recorded deeds including multiple types of easements. The property boundaries displayed on the map are for reference only and should not be used in place of the recorded deeds or land surveys. Source: Department of Records",-1)),IA={class:"columns is-multiline"},EA=["onClick"],PA=Un(()=>fe("h5",{class:"title is-5"},"Parcel Details",-1)),CA={key:0,class:"vert-table"},MA={class:"columns"},kA=Un(()=>fe("div",{class:"column is-4"},"Map Registry #",-1)),DA={class:"column is-8"},zA={class:"columns"},RA=Un(()=>fe("div",{class:"column is-4"},"Parcel Address",-1)),LA={class:"column is-8"},FA={class:"columns"},OA=Un(()=>fe("div",{class:"column is-4"},"Status",-1)),BA={class:"column is-8"},NA={class:"columns"},VA=Un(()=>fe("div",{class:"column is-4"},"Origination Date",-1)),$A={class:"column is-8"},UA={class:"columns"},jA=Un(()=>fe("div",{class:"column is-4"},"Inactive Date",-1)),qA={class:"column is-8"},GA={class:"columns"},HA=Un(()=>fe("div",{class:"column is-4"},"Has Air Rights",-1)),ZA={class:"column is-8"},WA={class:"columns"},KA=Un(()=>fe("div",{class:"column is-4"},"Is Condo",-1)),XA={class:"column is-8"},YA={class:"mt-6"},JA=Un(()=>fe("h5",{class:"subtitle is-5"},"Documents",-1)),QA={class:"table is-fullwidth is-striped"},eI=Un(()=>fe("thead",null,[fe("tr",null,[fe("th",null,"ID"),fe("th",null,"Date"),fe("th",null,"Type"),fe("th",null,"Grantor"),fe("th",null,"Grantee")])],-1)),tI={__name:"Deeds",setup(n){un();const a=$h(),d=lx(),m=ss(""),x=ar(()=>a.DOR.features.filter(h=>h.id===m.value)[0]),T=ar(()=>d.dorDocuments[m.value].data.features);G_(()=>{console.log("Deeds.vue onBeforeMount"),m.value=a.DOR.features[0].properties.OBJECTID}),Kp(()=>{console.log("Deeds.vue onMounted")});const v={1:"Active",2:"Inactive",3:"Remainder"};return(h,L)=>(Nt(),ri(pr,null,[AA,fe("div",IA,[(Nt(!0),ri(pr,null,qo(qt(a).DOR.features,U=>(Nt(),ri("div",{key:U.properties.OBJECTID,onClick:j=>m.value=U.properties.OBJECTID,class:Dc(["column is-3 add-borders",{"is-selected":U.properties.OBJECTID===m.value}])},ei(U.properties.MAPREG),11,EA))),128))]),PA,qt(a).DOR.features.length?(Nt(),ri("div",CA,[fe("div",MA,[kA,fe("div",DA,ei(x.value.properties.MAPREG),1)]),fe("div",zA,[RA,fe("div",LA,ei(x.value.properties.ADDR_SOURCE),1)]),fe("div",FA,[OA,fe("div",BA,ei(v[x.value.properties.STATUS]),1)]),fe("div",NA,[VA,fe("div",$A,ei(x.value.properties.ORIG_DATE),1)]),fe("div",UA,[jA,fe("div",qA,ei(x.value.properties.INACTDATE||"None"),1)]),fe("div",GA,[HA,fe("div",ZA,ei(x.value.properties.SUFFIX?"Yes":"No"),1)]),fe("div",WA,[KA,fe("div",XA,ei(x.value.properties.CONDOFLAG?"Yes":"No"),1)])])):br("",!0),fe("div",YA,[JA,fe("table",QA,[eI,fe("tbody",null,[(Nt(!0),ri(pr,null,qo(T.value,U=>(Nt(),ri("tr",null,[fe("td",null,ei(U.attributes.DOCUMENT_ID),1),fe("td",null,ei(U.attributes.DISPLAY_DATE),1),fe("td",null,ei(U.attributes.DOCUMENT_TYPE),1),fe("td",null,ei(U.attributes.GRANTORS),1),fe("td",null,ei(U.attributes.GRANTEES),1)]))),256))])])])],64))}},iI=Bc(tI,[["__scopeId","data-v-071ec60b"]]),rI=fe("div",{class:"box"}," Licenses, inspections, permits, property maintenance violations, and zoning permit documents at your search address. Source: Department of Licenses & Inspections ",-1),nI=fe("h5",{class:"subtitle is-5"},"Permits",-1),sI={class:"table is-fullwidth is-striped"},oI=fe("thead",null,[fe("tr",null,[fe("th",null,"Date"),fe("th",null,"ID"),fe("th",null,"Description"),fe("th",null,"Status")])],-1),aI=fe("h5",{class:"subtitle is-5"},"Inspections",-1),lI={class:"table is-fullwidth is-striped"},cI=fe("thead",null,[fe("tr",null,[fe("th",null,"Date"),fe("th",null,"ID"),fe("th",null,"Description"),fe("th",null,"Status")])],-1),uI=["innerHTML"],hI={__name:"LI",setup(n){console.log("LI.vue setup");const a=un(),d=ax(),{currency:m,date:x}=uf(),T=(j,N)=>new Date(N.permitissuedate)-new Date(j.permitissuedate),v=ar(()=>d.liPermits.rows.sort(T).slice(0,5)),h=(j,N)=>new Date(N.investigationcompleted)-new Date(j.investigationcompleted),L=ar(()=>d.liInspections.rows.sort(h).slice(0,5)),U=j=>{let N=a.addressData.features[0].properties.street_address;return j.unit_num&&j.unit_num!=null&&(N+=" Unit "+j.unit_num),"<a target='_blank' href='https://li.phila.gov/Property-History/search/Violation-Detail?address="+encodeURIComponent(N)+"&Id="+j.casenumber+"'>"+j.casenumber+" <i class='fa fa-external-link-alt'></i></a>"};return(j,N)=>(Nt(),ri("section",null,[rI,nI,fe("table",sI,[oI,fe("tbody",null,[(Nt(!0),ri(pr,null,qo(v.value,V=>(Nt(),ri("tr",null,[fe("td",null,ei(qt(x)(V.permitissuedate)),1),fe("td",null,ei(V.permitnumber),1),fe("td",null,ei(V.permitdescription),1),fe("td",null,ei(V.status),1)]))),256))])]),aI,fe("table",lI,[cI,fe("tbody",null,[(Nt(!0),ri(pr,null,qo(L.value,V=>(Nt(),ri("tr",null,[fe("td",null,ei(qt(x)(V.investigationcompleted)),1),fe("td",{innerHTML:U(V)},null,8,uI),fe("td",null,ei(V.investigationtype),1),fe("td",null,ei(V.investigationstatus),1)]))),256))])])]))}},dI=fe("h1",null,"Zoning Content",-1),pI=[dI],fI={__name:"Zoning",setup(n){return console.log("Zoning.vue setup"),(a,d)=>(Nt(),ri("section",null,pI))}},mI=fe("h1",null,"Voting Content",-1),gI=[mI],_I={__name:"Voting",setup(n){return console.log("Voting.vue setup"),(a,d)=>(Nt(),ri("section",null,gI))}},yI=fe("div",{class:"box"}," See recent activity near your search address including 311 service requests, crimes, zoning appeals, and more. Hover over a record below to highlight it on the map. ",-1),xI=fe("div",{class:"dropdown-trigger"},[fe("button",{class:"button","aria-haspopup":"true","aria-controls":"dropdown-menu"},[fe("span",null,"What nearby activity would you like to see?"),fe("span",{class:"icon is-small"},[fe("i",{class:"fas fa-angle-down","aria-hidden":"true"})])])],-1),vI={class:"dropdown-menu",id:"dropdown-menu",role:"menu"},bI={class:"dropdown-content"},wI={key:0},SI=fe("h5",{class:"subtitle is-5"},"Service Requests",-1),TI={class:"table is-fullwidth is-striped"},AI=fe("thead",null,[fe("tr",null,[fe("th",null,"Date"),fe("th",null,"Location"),fe("th",null,"Type"),fe("th",null,"Distance")])],-1),II=fe("td",null,null,-1),EI={key:1},PI=fe("h5",{class:"subtitle is-5"},"Crime Incidents",-1),CI={class:"table is-fullwidth is-striped"},MI=fe("thead",null,[fe("tr",null,[fe("th",null,"Date"),fe("th",null,"Location"),fe("th",null,"Description"),fe("th",null,"Distance")])],-1),kI=fe("td",null,null,-1),DI={__name:"NearbyActivity",setup(n){console.log("Nearby.vue setup");const a=cx(),{currency:d,date:m}=uf(),x=(V,de)=>new Date(de.requested_datetime)-new Date(V.requested_datetime),T=ar(()=>a.nearby311.data.rows.sort(x)),v=(V,de)=>new Date(de.requested_datetime)-new Date(V.requested_datetime),h=ar(()=>a.nearbyCrimeIncidents.data.rows.sort(v)),L=ss("nearby311"),U=async V=>{console.log("setDataType:",V),L.value=V,console.log(a[V]),a[V]===null&&(console.log("fetching new data"),await a.fetchData(V))},j=ss(!1),N=()=>{j.value=!j.value};return(V,de)=>(Nt(),ri("section",null,[yI,fe("div",{class:Dc(j.value?"dropdown is-active":"dropdown"),onClick:N},[xI,fe("div",vI,[fe("div",bI,[fe("a",{class:"dropdown-item",onClick:de[0]||(de[0]=_e=>U("nearby311"))},"311 Requests"),fe("a",{class:"dropdown-item",onClick:de[1]||(de[1]=_e=>U("nearbyCrimeIncidents"))},"Crime Incidents"),fe("a",{class:"dropdown-item",onClick:de[2]||(de[2]=_e=>U("nearbyZoningAppeals"))},"Zoning Appeals"),fe("a",{class:"dropdown-item",onClick:de[3]||(de[3]=_e=>U("nearbyVacantIndicatorPoints"))},"Vacant Properties"),fe("a",{class:"dropdown-item",onClick:de[4]||(de[4]=_e=>U("nearbyConstructionPermits"))},"Construction Permits"),fe("a",{class:"dropdown-item",onClick:de[5]||(de[5]=_e=>U("nearbyDemolitionPermits"))},"Demolition Permits"),fe("a",{class:"dropdown-item",onClick:de[6]||(de[6]=_e=>U("nearbyImminentlyDangerous"))},"Imminently Dangerous")])])],2),L.value=="nearby311"?(Nt(),ri("div",wI,[SI,fe("table",TI,[AI,fe("tbody",null,[(Nt(!0),ri(pr,null,qo(T.value,_e=>(Nt(),ri("tr",null,[fe("td",null,ei(qt(m)(_e.requested_datetime)),1),fe("td",null,ei(_e.address),1),fe("td",null,ei(_e.service_name),1),II]))),256))])])])):br("",!0),L.value=="nearbyCrimeIncidents"?(Nt(),ri("div",EI,[PI,fe("table",CI,[MI,fe("tbody",null,[(Nt(!0),ri(pr,null,qo(h.value,_e=>(Nt(),ri("tr",null,[fe("td",null,ei(_e.dispatch_date),1),fe("td",null,ei(_e.location_block),1),fe("td",null,ei(_e.text_general_code),1),kI]))),256))])])])):br("",!0)]))}},zI=n=>(Ah("data-v-22fbd821"),n=n(),Ih(),n),RI={key:0,class:"columns"},LI=Bb('<div class="column is-12" data-v-22fbd821><h3 class="subtitle is-3" data-v-22fbd821>Atlas is your front door to the City of Philadelphia.</h3><p class="subtitle is-5" data-v-22fbd821>Here are some things you can do with Atlas:</p><ul data-v-22fbd821><li data-v-22fbd821>Find your polling place</li><li data-v-22fbd821>Get the history of permits, licenses, and inspections at any address</li><li data-v-22fbd821>Research real estate information including property values, zoning, and document archives</li><li data-v-22fbd821>Get easy access to a variety of hard-to-find City resources</li><li data-v-22fbd821>View recent activity around your address, such as crimes, 311 service requests, and more</li><li data-v-22fbd821>Explore historical imagery and maps</li></ul><p data-v-22fbd821>To get started, click anywhere on the map, or type an address, intersection, property assessment account number, or Department of Records Map Registry number into the search box.</p></div>',1),FI=[LI],OI={key:1,class:"columns"},BI=zI(()=>fe("div",{class:"column is-12"},[fe("p",null,"We couldn't find that address. Are you sure everything was spelled correctly?"),fe("p",null,"Here are some examples of things you can search for:"),fe("ul",null,[fe("li",null,"1234 Market St"),fe("li",null,"1001 Pine Street #201"),fe("li",null,"12th & Market"),fe("li",null,"12th & Market"),fe("li",null,"883309050 (an OPA number with no hyphens or other characters)")])],-1)),NI=[BI],VI={key:2},$I={class:"columns"},UI={class:"column is-12"},jI={class:"subtitle is-3"},qI={__name:"TopicPanel",setup(n){const a=ln("addressDataLoadedFlagKey"),d=ln("dataSourcesLoadedArrayKey");console.log("addressDataLoadedFlag:",a,"dataSourcesLoadedArray:",d.value);const m=Lh(),x=Oc(),T=tf();console.log("TopicPanel setup, route.params:",T.params,"route:",T);const v=ar(()=>m.currentAddress);return(h,L)=>(Nt(),ri("section",null,[qt(T).name=="home"?(Nt(),ri("div",RI,FI)):br("",!0),qt(T).name=="not-found"?(Nt(),ri("div",OI,NI)):br("",!0),qt(T).params.address?(Nt(),ri("div",VI,[fe("div",$I,[fe("div",UI,[fe("h3",jI,ei(v.value),1)])]),Ni(Bo,{"topic-name":"Property",loading:!qt(d).includes("Property")},{default:Ts(()=>[qt(d).includes("Property")?(Nt(),ts(xA,{key:0})):br("",!0)]),_:1},8,["loading"]),$_(Ni(Bo,{"topic-name":"Condominiums",loading:!qt(d).includes("Condominiums")},{default:Ts(()=>[qt(d).includes("Condominiums")?(Nt(),ts(TA,{key:0})):br("",!0)]),_:1},8,["loading"]),[[t1,qt(x).condosData.length>0]]),Ni(Bo,{"topic-name":"Deeds",loading:!qt(d).includes("Deeds")},{default:Ts(()=>[qt(d).includes("Deeds")?(Nt(),ts(iI,{key:0})):br("",!0)]),_:1},8,["loading"]),Ni(Bo,{"topic-name":"Licenses & Inspections",loading:!qt(d).includes("Licenses & Inspections")},{default:Ts(()=>[qt(d).includes("Licenses & Inspections")?(Nt(),ts(hI,{key:0})):br("",!0)]),_:1},8,["loading"]),Ni(Bo,{"topic-name":"Zoning",loading:!qt(d).includes("Zoning")},{default:Ts(()=>[qt(d).includes("Zoning")?(Nt(),ts(fI,{key:0})):br("",!0)]),_:1},8,["loading"]),Ni(Bo,{"topic-name":"Voting",loading:!qt(d).includes("Voting")},{default:Ts(()=>[qt(d).includes("Voting")?(Nt(),ts(_I,{key:0})):br("",!0)]),_:1},8,["loading"]),Ni(Bo,{"topic-name":"Nearby Activity",loading:!qt(d).includes("Nearby Activity")},{default:Ts(()=>[qt(d).includes("Nearby Activity")?(Nt(),ts(DI,{key:0})):br("",!0)]),_:1},8,["loading"])])):br("",!0)]))}},GI=Bc(qI,[["__scopeId","data-v-22fbd821"]]),ux=n=>(Ah("data-v-e9b318c5"),n=n(),Ih(),n),HI=ux(()=>fe("div",{class:"container"},[fe("h1",{class:"title is-1"},"Vue3 Atlas")],-1)),ZI={class:"container"},WI={class:"columns"},KI={class:"column is-10"},XI={class:"small-container"},YI={class:"columns"},JI={class:"column is-6"},QI=ux(()=>fe("div",{id:"map-panel",class:"column is-6"},[fe("div",{id:"map",class:"map-class"})],-1)),eE={__name:"Home",setup(n){const a=Uw(),d=Lh(),m=un(),x=Oc(),T=$h(),v=tf(),h=Iy(),{noMapStyle:L,pwdDrawnMapStyle:U,dorDrawnMapStyle:j,zoningDrawnMapStyle:N,imageryMapStyle:V}=sS(),{addressDataFetch:de,parcelsDataFetch:_e,condosDataFetch:Ie,topicDataFetch:Je}=VT(),Ue=ss(!1);el("addressDataLoadedFlagKey",Ue);const We=ss([]);el("dataSourcesLoadedArrayKey",We);const ye=ss("");let Be;const ot=[],at={undefined:"PWD",Property:"PWD",Condos:"PWD",Deeds:"DOR","Licenses & Inspections":"PWD",Zoning:"DOR",Voting:"PWD","Nearby Activity":"PWD"},xt={Property:U,Condos:U,Deeds:j,"Licenses & Inspections":U,Zoning:N,Voting:U,"Nearby Activity":U},St=()=>{console.log("toggleImagery, map.getStyle:",Be.getStyle()),Be.getStyle().name==="imageryMap"?Be.setStyle(a.currentTopicMapStyle):Be.setStyle(V)},dt=pt=>{console.log("routeToAddress is running, currentAddress:",pt),d.currentAddress&&v.params.topic?h.push({name:"address-and-topic",params:{address:d.currentAddress,topic:v.params.topic}}):d.currentAddress&&h.push({name:"address-and-topic",params:{address:d.currentAddress,topic:"Property"}})};Kp(async()=>{v.name==="not-found"&&h.push({name:"home"}),v.params.address&&(ye.value=v.params.address,vt());let pt;v.params.topic?pt=xt[v.params.topic]:pt=U,a.currentTopicMapStyle=pt;let Bt;v.params.address?Bt=17:Bt=12,Be=new Bg.Map({container:"map",style:pt,center:[-75.163471,39.953338],zoom:Bt,minZoom:6,maxZoom:22}),Be.on("click",async Pt=>{console.log("map click event:",Pt.lngLat,"route.params.topic:",v.params.topic);let di;const It=at[v.params.topic];await T.fillParcelDataByLngLat(Pt.lngLat.lng,Pt.lngLat.lat,It);const Ct=It==="PWD"?"ADDRESS":"ADDR_SOURCE";console.log("parcelLayer:",It,"ParcelsStore[parcelLayer].features[0].properties[addressField]:",T[It].features[0].properties[Ct]),di=T[It].features[0].properties[Ct],console.log("currentAddress:",di),d.setCurrentAddress(di),d.setLastSearchMethod("mapClick"),dt(di)})});const kt=async pt=>{if(console.log("getAddressAndPutInStore is running, address:",pt),Ue.value=!1,We.value=[],await de(pt),!m.addressData.features){h.push({name:"not-found"});return}const Bt=m.addressData.features[0].properties.street_address;d.setCurrentAddress(Bt),Ue.value=!0},vt=async()=>{await kt(ye.value),d.setLastSearchMethod("address");const pt=d.currentAddress;console.log("currentAddress:",pt),pt&&dt(pt)};return h.afterEach(async(pt,Bt)=>{if(console.log("router.afterEach to:",pt,"from:",Bt,"to.name:",pt.name),pt.name==="not-found"){ot.forEach(di=>di.remove());return}const Pt=Be.getStyle();if(Pt&&Pt.name!=="imageryMap"&&(pt.params.topic?(Be.setStyle(xt[pt.params.topic]),a.currentTopicMapStyle=xt[pt.params.topic]):(Be.setStyle(U),a.currentTopicMapStyle=U)),pt.params.address!==Bt.params.address)await kt(pt.params.address);else if(We.value.includes(pt.params.topic))return;if(pt.params.topic==Bt.params.topic&&pt.params.address||Bt.params.topic==null&&pt.params.address){const di=m.addressData.features[0].geometry.coordinates;ot.forEach(Ct=>Ct.remove());const It=new Bg.Marker().setLngLat(di).addTo(Be);ot.push(It),d.lastSearchMethod==="address"&&(Be.setCenter(di),Be.setZoom(17))}if(await _e(),await Ie(pt.params.address),pt.params.topic=="Condominiums"&&!x.condosData.length){h.push({name:"address-and-topic",params:{address:pt.params.address,topic:"Property"}});return}await Je(pt.params.topic),We.value.push(pt.params.topic)}),(pt,Bt)=>(Nt(),ri("main",null,[HI,fe("div",ZI,[fe("div",WI,[fe("div",KI,[$_(fe("input",{class:"input",type:"text",placeholder:"Search an address","onUpdate:modelValue":Bt[0]||(Bt[0]=Pt=>ye.value=Pt),onKeydown:v1(vt,["enter"])},null,544),[[y1,ye.value]])]),fe("button",{class:"button",onClick:vt}," Search "),fe("button",{class:"button",onClick:St},"Toggle Imagery")])]),fe("div",XI,[fe("div",YI,[fe("div",JI,[Ni(GI)]),QI])])]))}},Yu=Bc(eE,[["__scopeId","data-v-e9b318c5"]]),tE=Rw({history:hw("/vue3-atlas2"),routes:[{path:"/:pathMatch(.*)*",name:"NotFound",component:()=>Nw(()=>import("./NotFound-C32cPDpY.js"),[])},{path:"/",name:"home",component:Yu,props:!0,children:[]},{path:"/:address",name:"address",component:Yu},{path:"/:address/:topic",name:"address-and-topic",component:Yu},{path:"/not-found",name:"not-found",component:Yu}]}),hf=S1(Fw);hf.use(E1());hf.use(tE);hf.mount("#app");export{Bc as _,fe as a,sy as b,ri as c,Ni as d,Nt as o,iE as r,Ts as w};
