(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const v of document.querySelectorAll('link[rel="modulepreload"]'))m(v);new MutationObserver(v=>{for(const T of v)if(T.type==="childList")for(const x of T.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&m(x)}).observe(document,{childList:!0,subtree:!0});function d(v){const T={};return v.integrity&&(T.integrity=v.integrity),v.referrerPolicy&&(T.referrerPolicy=v.referrerPolicy),v.crossOrigin==="use-credentials"?T.credentials="include":v.crossOrigin==="anonymous"?T.credentials="omit":T.credentials="same-origin",T}function m(v){if(v.ep)return;v.ep=!0;const T=d(v);fetch(v.href,T)}})();/**
* @vue/shared v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Mp(n,a){const d=new Set(n.split(","));return a?m=>d.has(m.toLowerCase()):m=>d.has(m)}const Li={},Ka=[],Cn=()=>{},W0=()=>!1,dh=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),kp=n=>n.startsWith("onUpdate:"),Mr=Object.assign,Dp=(n,a)=>{const d=n.indexOf(a);d>-1&&n.splice(d,1)},K0=Object.prototype.hasOwnProperty,oi=(n,a)=>K0.call(n,a),Rt=Array.isArray,Xa=n=>ph(n)==="[object Map]",e_=n=>ph(n)==="[object Set]",Vt=n=>typeof n=="function",fr=n=>typeof n=="string",sl=n=>typeof n=="symbol",Fi=n=>n!==null&&typeof n=="object",t_=n=>(Fi(n)||Vt(n))&&Vt(n.then)&&Vt(n.catch),i_=Object.prototype.toString,ph=n=>i_.call(n),X0=n=>ph(n).slice(8,-1),r_=n=>ph(n)==="[object Object]",zp=n=>fr(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,fc=Mp(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),fh=n=>{const a=Object.create(null);return d=>a[d]||(a[d]=n(d))},Y0=/-(\w)/g,ns=fh(n=>n.replace(Y0,(a,d)=>d?d.toUpperCase():"")),J0=/\B([A-Z])/g,Uo=fh(n=>n.replace(J0,"-$1").toLowerCase()),mh=fh(n=>n.charAt(0).toUpperCase()+n.slice(1)),qd=fh(n=>n?`on${mh(n)}`:""),no=(n,a)=>!Object.is(n,a),Ku=(n,a)=>{for(let d=0;d<n.length;d++)n[d](a)},rh=(n,a,d)=>{Object.defineProperty(n,a,{configurable:!0,enumerable:!1,value:d})},ap=n=>{const a=parseFloat(n);return isNaN(a)?n:a};let Om;const n_=()=>Om||(Om=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Rp(n){if(Rt(n)){const a={};for(let d=0;d<n.length;d++){const m=n[d],v=fr(m)?iv(m):Rp(m);if(v)for(const T in v)a[T]=v[T]}return a}else if(fr(n)||Fi(n))return n}const Q0=/;(?![^(]*\))/g,ev=/:([^]+)/,tv=/\/\*[^]*?\*\//g;function iv(n){const a={};return n.replace(tv,"").split(Q0).forEach(d=>{if(d){const m=d.split(ev);m.length>1&&(a[m[0].trim()]=m[1].trim())}}),a}function gh(n){let a="";if(fr(n))a=n;else if(Rt(n))for(let d=0;d<n.length;d++){const m=gh(n[d]);m&&(a+=m+" ")}else if(Fi(n))for(const d in n)n[d]&&(a+=d+" ");return a.trim()}const rv="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",nv=Mp(rv);function s_(n){return!!n||n===""}const pi=n=>fr(n)?n:n==null?"":Rt(n)||Fi(n)&&(n.toString===i_||!Vt(n.toString))?JSON.stringify(n,o_,2):String(n),o_=(n,a)=>a&&a.__v_isRef?o_(n,a.value):Xa(a)?{[`Map(${a.size})`]:[...a.entries()].reduce((d,[m,v],T)=>(d[Gd(m,T)+" =>"]=v,d),{})}:e_(a)?{[`Set(${a.size})`]:[...a.values()].map(d=>Gd(d))}:sl(a)?Gd(a):Fi(a)&&!Rt(a)&&!r_(a)?String(a):a,Gd=(n,a="")=>{var d;return sl(n)?`Symbol(${(d=n.description)!=null?d:a})`:n};/**
* @vue/reactivity v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let xn;class a_{constructor(a=!1){this.detached=a,this._active=!0,this.effects=[],this.cleanups=[],this.parent=xn,!a&&xn&&(this.index=(xn.scopes||(xn.scopes=[])).push(this)-1)}get active(){return this._active}run(a){if(this._active){const d=xn;try{return xn=this,a()}finally{xn=d}}}on(){xn=this}off(){xn=this.parent}stop(a){if(this._active){let d,m;for(d=0,m=this.effects.length;d<m;d++)this.effects[d].stop();for(d=0,m=this.cleanups.length;d<m;d++)this.cleanups[d]();if(this.scopes)for(d=0,m=this.scopes.length;d<m;d++)this.scopes[d].stop(!0);if(!this.detached&&this.parent&&!a){const v=this.parent.scopes.pop();v&&v!==this&&(this.parent.scopes[this.index]=v,v.index=this.index)}this.parent=void 0,this._active=!1}}}function l_(n){return new a_(n)}function sv(n,a=xn){a&&a.active&&a.effects.push(n)}function c_(){return xn}function ov(n){xn&&xn.cleanups.push(n)}let Vo;class Lp{constructor(a,d,m,v){this.fn=a,this.trigger=d,this.scheduler=m,this.active=!0,this.deps=[],this._dirtyLevel=4,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,sv(this,v)}get dirty(){if(this._dirtyLevel===2||this._dirtyLevel===3){this._dirtyLevel=1,jo();for(let a=0;a<this._depsLength;a++){const d=this.deps[a];if(d.computed&&(av(d.computed),this._dirtyLevel>=4))break}this._dirtyLevel===1&&(this._dirtyLevel=0),qo()}return this._dirtyLevel>=4}set dirty(a){this._dirtyLevel=a?4:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let a=to,d=Vo;try{return to=!0,Vo=this,this._runnings++,Bm(this),this.fn()}finally{Nm(this),this._runnings--,Vo=d,to=a}}stop(){var a;this.active&&(Bm(this),Nm(this),(a=this.onStop)==null||a.call(this),this.active=!1)}}function av(n){return n.value}function Bm(n){n._trackId++,n._depsLength=0}function Nm(n){if(n.deps.length>n._depsLength){for(let a=n._depsLength;a<n.deps.length;a++)u_(n.deps[a],n);n.deps.length=n._depsLength}}function u_(n,a){const d=n.get(a);d!==void 0&&a._trackId!==d&&(n.delete(a),n.size===0&&n.cleanup())}let to=!0,lp=0;const h_=[];function jo(){h_.push(to),to=!1}function qo(){const n=h_.pop();to=n===void 0?!0:n}function Fp(){lp++}function Op(){for(lp--;!lp&&cp.length;)cp.shift()()}function d_(n,a,d){if(a.get(n)!==n._trackId){a.set(n,n._trackId);const m=n.deps[n._depsLength];m!==a?(m&&u_(m,n),n.deps[n._depsLength++]=a):n._depsLength++}}const cp=[];function p_(n,a,d){Fp();for(const m of n.keys()){let v;m._dirtyLevel<a&&(v??(v=n.get(m)===m._trackId))&&(m._shouldSchedule||(m._shouldSchedule=m._dirtyLevel===0),m._dirtyLevel=a),m._shouldSchedule&&(v??(v=n.get(m)===m._trackId))&&(m.trigger(),(!m._runnings||m.allowRecurse)&&m._dirtyLevel!==2&&(m._shouldSchedule=!1,m.scheduler&&cp.push(m.scheduler)))}Op()}const f_=(n,a)=>{const d=new Map;return d.cleanup=n,d.computed=a,d},nh=new WeakMap,$o=Symbol(""),up=Symbol("");function cn(n,a,d){if(to&&Vo){let m=nh.get(n);m||nh.set(n,m=new Map);let v=m.get(d);v||m.set(d,v=f_(()=>m.delete(d))),d_(Vo,v)}}function Ss(n,a,d,m,v,T){const x=nh.get(n);if(!x)return;let h=[];if(a==="clear")h=[...x.values()];else if(d==="length"&&Rt(n)){const R=Number(m);x.forEach((j,U)=>{(U==="length"||!sl(U)&&U>=R)&&h.push(j)})}else switch(d!==void 0&&h.push(x.get(d)),a){case"add":Rt(n)?zp(d)&&h.push(x.get("length")):(h.push(x.get($o)),Xa(n)&&h.push(x.get(up)));break;case"delete":Rt(n)||(h.push(x.get($o)),Xa(n)&&h.push(x.get(up)));break;case"set":Xa(n)&&h.push(x.get($o));break}Fp();for(const R of h)R&&p_(R,4);Op()}function lv(n,a){var d;return(d=nh.get(n))==null?void 0:d.get(a)}const cv=Mp("__proto__,__v_isRef,__isVue"),m_=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(sl)),Vm=uv();function uv(){const n={};return["includes","indexOf","lastIndexOf"].forEach(a=>{n[a]=function(...d){const m=ii(this);for(let T=0,x=this.length;T<x;T++)cn(m,"get",T+"");const v=m[a](...d);return v===-1||v===!1?m[a](...d.map(ii)):v}}),["push","pop","shift","unshift","splice"].forEach(a=>{n[a]=function(...d){jo(),Fp();const m=ii(this)[a].apply(this,d);return Op(),qo(),m}}),n}function hv(n){const a=ii(this);return cn(a,"has",n),a.hasOwnProperty(n)}class g_{constructor(a=!1,d=!1){this._isReadonly=a,this._isShallow=d}get(a,d,m){const v=this._isReadonly,T=this._isShallow;if(d==="__v_isReactive")return!v;if(d==="__v_isReadonly")return v;if(d==="__v_isShallow")return T;if(d==="__v_raw")return m===(v?T?Tv:v_:T?x_:y_).get(a)||Object.getPrototypeOf(a)===Object.getPrototypeOf(m)?a:void 0;const x=Rt(a);if(!v){if(x&&oi(Vm,d))return Reflect.get(Vm,d,m);if(d==="hasOwnProperty")return hv}const h=Reflect.get(a,d,m);return(sl(d)?m_.has(d):cv(d))||(v||cn(a,"get",d),T)?h:ar(h)?x&&zp(d)?h:h.value:Fi(h)?v?w_(h):kc(h):h}}class __ extends g_{constructor(a=!1){super(!1,a)}set(a,d,m,v){let T=a[d];if(!this._isShallow){const R=el(T);if(!sh(m)&&!el(m)&&(T=ii(T),m=ii(m)),!Rt(a)&&ar(T)&&!ar(m))return R?!1:(T.value=m,!0)}const x=Rt(a)&&zp(d)?Number(d)<a.length:oi(a,d),h=Reflect.set(a,d,m,v);return a===ii(v)&&(x?no(m,T)&&Ss(a,"set",d,m):Ss(a,"add",d,m)),h}deleteProperty(a,d){const m=oi(a,d);a[d];const v=Reflect.deleteProperty(a,d);return v&&m&&Ss(a,"delete",d,void 0),v}has(a,d){const m=Reflect.has(a,d);return(!sl(d)||!m_.has(d))&&cn(a,"has",d),m}ownKeys(a){return cn(a,"iterate",Rt(a)?"length":$o),Reflect.ownKeys(a)}}class dv extends g_{constructor(a=!1){super(!0,a)}set(a,d){return!0}deleteProperty(a,d){return!0}}const pv=new __,fv=new dv,mv=new __(!0),Bp=n=>n,_h=n=>Reflect.getPrototypeOf(n);function $u(n,a,d=!1,m=!1){n=n.__v_raw;const v=ii(n),T=ii(a);d||(no(a,T)&&cn(v,"get",a),cn(v,"get",T));const{has:x}=_h(v),h=m?Bp:d?$p:wc;if(x.call(v,a))return h(n.get(a));if(x.call(v,T))return h(n.get(T));n!==v&&n.get(a)}function Uu(n,a=!1){const d=this.__v_raw,m=ii(d),v=ii(n);return a||(no(n,v)&&cn(m,"has",n),cn(m,"has",v)),n===v?d.has(n):d.has(n)||d.has(v)}function ju(n,a=!1){return n=n.__v_raw,!a&&cn(ii(n),"iterate",$o),Reflect.get(n,"size",n)}function $m(n){n=ii(n);const a=ii(this);return _h(a).has.call(a,n)||(a.add(n),Ss(a,"add",n,n)),this}function Um(n,a){a=ii(a);const d=ii(this),{has:m,get:v}=_h(d);let T=m.call(d,n);T||(n=ii(n),T=m.call(d,n));const x=v.call(d,n);return d.set(n,a),T?no(a,x)&&Ss(d,"set",n,a):Ss(d,"add",n,a),this}function jm(n){const a=ii(this),{has:d,get:m}=_h(a);let v=d.call(a,n);v||(n=ii(n),v=d.call(a,n)),m&&m.call(a,n);const T=a.delete(n);return v&&Ss(a,"delete",n,void 0),T}function qm(){const n=ii(this),a=n.size!==0,d=n.clear();return a&&Ss(n,"clear",void 0,void 0),d}function qu(n,a){return function(m,v){const T=this,x=T.__v_raw,h=ii(x),R=a?Bp:n?$p:wc;return!n&&cn(h,"iterate",$o),x.forEach((j,U)=>m.call(v,R(j),R(U),T))}}function Gu(n,a,d){return function(...m){const v=this.__v_raw,T=ii(v),x=Xa(T),h=n==="entries"||n===Symbol.iterator&&x,R=n==="keys"&&x,j=v[n](...m),U=d?Bp:a?$p:wc;return!a&&cn(T,"iterate",R?up:$o),{next(){const{value:N,done:$}=j.next();return $?{value:N,done:$}:{value:h?[U(N[0]),U(N[1])]:U(N),done:$}},[Symbol.iterator](){return this}}}}function Hs(n){return function(...a){return n==="delete"?!1:n==="clear"?void 0:this}}function gv(){const n={get(T){return $u(this,T)},get size(){return ju(this)},has:Uu,add:$m,set:Um,delete:jm,clear:qm,forEach:qu(!1,!1)},a={get(T){return $u(this,T,!1,!0)},get size(){return ju(this)},has:Uu,add:$m,set:Um,delete:jm,clear:qm,forEach:qu(!1,!0)},d={get(T){return $u(this,T,!0)},get size(){return ju(this,!0)},has(T){return Uu.call(this,T,!0)},add:Hs("add"),set:Hs("set"),delete:Hs("delete"),clear:Hs("clear"),forEach:qu(!0,!1)},m={get(T){return $u(this,T,!0,!0)},get size(){return ju(this,!0)},has(T){return Uu.call(this,T,!0)},add:Hs("add"),set:Hs("set"),delete:Hs("delete"),clear:Hs("clear"),forEach:qu(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(T=>{n[T]=Gu(T,!1,!1),d[T]=Gu(T,!0,!1),a[T]=Gu(T,!1,!0),m[T]=Gu(T,!0,!0)}),[n,d,a,m]}const[_v,yv,xv,vv]=gv();function Np(n,a){const d=a?n?vv:xv:n?yv:_v;return(m,v,T)=>v==="__v_isReactive"?!n:v==="__v_isReadonly"?n:v==="__v_raw"?m:Reflect.get(oi(d,v)&&v in m?d:m,v,T)}const bv={get:Np(!1,!1)},wv={get:Np(!1,!0)},Sv={get:Np(!0,!1)},y_=new WeakMap,x_=new WeakMap,v_=new WeakMap,Tv=new WeakMap;function Ev(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Iv(n){return n.__v_skip||!Object.isExtensible(n)?0:Ev(X0(n))}function kc(n){return el(n)?n:Vp(n,!1,pv,bv,y_)}function b_(n){return Vp(n,!1,mv,wv,x_)}function w_(n){return Vp(n,!0,fv,Sv,v_)}function Vp(n,a,d,m,v){if(!Fi(n)||n.__v_raw&&!(a&&n.__v_isReactive))return n;const T=v.get(n);if(T)return T;const x=Iv(n);if(x===0)return n;const h=new Proxy(n,x===2?m:d);return v.set(n,h),h}function Ts(n){return el(n)?Ts(n.__v_raw):!!(n&&n.__v_isReactive)}function el(n){return!!(n&&n.__v_isReadonly)}function sh(n){return!!(n&&n.__v_isShallow)}function S_(n){return Ts(n)||el(n)}function ii(n){const a=n&&n.__v_raw;return a?ii(a):n}function yh(n){return Object.isExtensible(n)&&rh(n,"__v_skip",!0),n}const wc=n=>Fi(n)?kc(n):n,$p=n=>Fi(n)?w_(n):n;class T_{constructor(a,d,m,v){this.getter=a,this._setter=d,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this.effect=new Lp(()=>a(this._value),()=>Xu(this,this.effect._dirtyLevel===2?2:3)),this.effect.computed=this,this.effect.active=this._cacheable=!v,this.__v_isReadonly=m}get value(){const a=ii(this);return(!a._cacheable||a.effect.dirty)&&no(a._value,a._value=a.effect.run())&&Xu(a,4),E_(a),a.effect._dirtyLevel>=2&&Xu(a,2),a._value}set value(a){this._setter(a)}get _dirty(){return this.effect.dirty}set _dirty(a){this.effect.dirty=a}}function Av(n,a,d=!1){let m,v;const T=Vt(n);return T?(m=n,v=Cn):(m=n.get,v=n.set),new T_(m,v,T||!v,d)}function E_(n){var a;to&&Vo&&(n=ii(n),d_(Vo,(a=n.dep)!=null?a:n.dep=f_(()=>n.dep=void 0,n instanceof T_?n:void 0)))}function Xu(n,a=4,d){n=ii(n);const m=n.dep;m&&p_(m,a)}function ar(n){return!!(n&&n.__v_isRef===!0)}function io(n){return I_(n,!1)}function Pv(n){return I_(n,!0)}function I_(n,a){return ar(n)?n:new Cv(n,a)}class Cv{constructor(a,d){this.__v_isShallow=d,this.dep=void 0,this.__v_isRef=!0,this._rawValue=d?a:ii(a),this._value=d?a:wc(a)}get value(){return E_(this),this._value}set value(a){const d=this.__v_isShallow||sh(a)||el(a);a=d?a:ii(a),no(a,this._rawValue)&&(this._rawValue=a,this._value=d?a:wc(a),Xu(this,4))}}function Qt(n){return ar(n)?n.value:n}const Mv={get:(n,a,d)=>Qt(Reflect.get(n,a,d)),set:(n,a,d,m)=>{const v=n[a];return ar(v)&&!ar(d)?(v.value=d,!0):Reflect.set(n,a,d,m)}};function A_(n){return Ts(n)?n:new Proxy(n,Mv)}function kv(n){const a=Rt(n)?new Array(n.length):{};for(const d in n)a[d]=P_(n,d);return a}class Dv{constructor(a,d,m){this._object=a,this._key=d,this._defaultValue=m,this.__v_isRef=!0}get value(){const a=this._object[this._key];return a===void 0?this._defaultValue:a}set value(a){this._object[this._key]=a}get dep(){return lv(ii(this._object),this._key)}}class zv{constructor(a){this._getter=a,this.__v_isRef=!0,this.__v_isReadonly=!0}get value(){return this._getter()}}function Rv(n,a,d){return ar(n)?n:Vt(n)?new zv(n):Fi(n)&&arguments.length>1?P_(n,a,d):io(n)}function P_(n,a,d){const m=n[a];return ar(m)?m:new Dv(n,a,d)}/**
* @vue/runtime-core v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function ro(n,a,d,m){try{return m?n(...m):n()}catch(v){xh(v,a,d)}}function Nn(n,a,d,m){if(Vt(n)){const T=ro(n,a,d,m);return T&&t_(T)&&T.catch(x=>{xh(x,a,d)}),T}const v=[];for(let T=0;T<n.length;T++)v.push(Nn(n[T],a,d,m));return v}function xh(n,a,d,m=!0){const v=a?a.vnode:null;if(a){let T=a.parent;const x=a.proxy,h=`https://vuejs.org/error-reference/#runtime-${d}`;for(;T;){const j=T.ec;if(j){for(let U=0;U<j.length;U++)if(j[U](n,x,h)===!1)return}T=T.parent}const R=a.appContext.config.errorHandler;if(R){ro(R,null,10,[n,x,h]);return}}Lv(n,d,v,m)}function Lv(n,a,d,m=!0){console.error(n)}let Sc=!1,hp=!1;const Vr=[];let is=0;const Ya=[];let Ys=null,Bo=0;const C_=Promise.resolve();let Up=null;function jp(n){const a=Up||C_;return n?a.then(this?n.bind(this):n):a}function Fv(n){let a=is+1,d=Vr.length;for(;a<d;){const m=a+d>>>1,v=Vr[m],T=Tc(v);T<n||T===n&&v.pre?a=m+1:d=m}return a}function qp(n){(!Vr.length||!Vr.includes(n,Sc&&n.allowRecurse?is+1:is))&&(n.id==null?Vr.push(n):Vr.splice(Fv(n.id),0,n),M_())}function M_(){!Sc&&!hp&&(hp=!0,Up=C_.then(D_))}function Ov(n){const a=Vr.indexOf(n);a>is&&Vr.splice(a,1)}function Bv(n){Rt(n)?Ya.push(...n):(!Ys||!Ys.includes(n,n.allowRecurse?Bo+1:Bo))&&Ya.push(n),M_()}function Gm(n,a,d=Sc?is+1:0){for(;d<Vr.length;d++){const m=Vr[d];if(m&&m.pre){if(n&&m.id!==n.uid)continue;Vr.splice(d,1),d--,m()}}}function k_(n){if(Ya.length){const a=[...new Set(Ya)].sort((d,m)=>Tc(d)-Tc(m));if(Ya.length=0,Ys){Ys.push(...a);return}for(Ys=a,Bo=0;Bo<Ys.length;Bo++)Ys[Bo]();Ys=null,Bo=0}}const Tc=n=>n.id==null?1/0:n.id,Nv=(n,a)=>{const d=Tc(n)-Tc(a);if(d===0){if(n.pre&&!a.pre)return-1;if(a.pre&&!n.pre)return 1}return d};function D_(n){hp=!1,Sc=!0,Vr.sort(Nv);try{for(is=0;is<Vr.length;is++){const a=Vr[is];a&&a.active!==!1&&ro(a,null,14)}}finally{is=0,Vr.length=0,k_(),Sc=!1,Up=null,(Vr.length||Ya.length)&&D_()}}function Vv(n,a,...d){if(n.isUnmounted)return;const m=n.vnode.props||Li;let v=d;const T=a.startsWith("update:"),x=T&&a.slice(7);if(x&&x in m){const U=`${x==="modelValue"?"model":x}Modifiers`,{number:N,trim:$}=m[U]||Li;$&&(v=d.map(ge=>fr(ge)?ge.trim():ge)),N&&(v=d.map(ap))}let h,R=m[h=qd(a)]||m[h=qd(ns(a))];!R&&T&&(R=m[h=qd(Uo(a))]),R&&Nn(R,n,6,v);const j=m[h+"Once"];if(j){if(!n.emitted)n.emitted={};else if(n.emitted[h])return;n.emitted[h]=!0,Nn(j,n,6,v)}}function z_(n,a,d=!1){const m=a.emitsCache,v=m.get(n);if(v!==void 0)return v;const T=n.emits;let x={},h=!1;if(!Vt(n)){const R=j=>{const U=z_(j,a,!0);U&&(h=!0,Mr(x,U))};!d&&a.mixins.length&&a.mixins.forEach(R),n.extends&&R(n.extends),n.mixins&&n.mixins.forEach(R)}return!T&&!h?(Fi(n)&&m.set(n,null),null):(Rt(T)?T.forEach(R=>x[R]=null):Mr(x,T),Fi(n)&&m.set(n,x),x)}function vh(n,a){return!n||!dh(a)?!1:(a=a.slice(2).replace(/Once$/,""),oi(n,a[0].toLowerCase()+a.slice(1))||oi(n,Uo(a))||oi(n,a))}let pr=null,bh=null;function oh(n){const a=pr;return pr=n,bh=n&&n.type.__scopeId||null,a}function wh(n){bh=n}function Sh(){bh=null}function Fo(n,a=pr,d){if(!a||n._n)return n;const m=(...v)=>{m._d&&ig(-1);const T=oh(a);let x;try{x=n(...v)}finally{oh(T),m._d&&ig(1)}return x};return m._n=!0,m._c=!0,m._d=!0,m}function Hd(n){const{type:a,vnode:d,proxy:m,withProxy:v,props:T,propsOptions:[x],slots:h,attrs:R,emit:j,render:U,renderCache:N,data:$,setupState:ge,ctx:xe,inheritAttrs:Ee}=n;let Ke,Ne;const He=oh(n);try{if(d.shapeFlag&4){const We=v||m,lt=We;Ke=ts(U.call(lt,We,N,T,ge,$,xe)),Ne=R}else{const We=a;Ke=ts(We.length>1?We(T,{attrs:R,slots:h,emit:j}):We(T,null)),Ne=a.props?R:$v(R)}}catch(We){yc.length=0,xh(We,n,1),Ke=Zi(so)}let me=Ke;if(Ne&&Ee!==!1){const We=Object.keys(Ne),{shapeFlag:lt}=me;We.length&&lt&7&&(x&&We.some(kp)&&(Ne=Uv(Ne,x)),me=tl(me,Ne))}return d.dirs&&(me=tl(me),me.dirs=me.dirs?me.dirs.concat(d.dirs):d.dirs),d.transition&&(me.transition=d.transition),Ke=me,oh(He),Ke}const $v=n=>{let a;for(const d in n)(d==="class"||d==="style"||dh(d))&&((a||(a={}))[d]=n[d]);return a},Uv=(n,a)=>{const d={};for(const m in n)(!kp(m)||!(m.slice(9)in a))&&(d[m]=n[m]);return d};function jv(n,a,d){const{props:m,children:v,component:T}=n,{props:x,children:h,patchFlag:R}=a,j=T.emitsOptions;if(a.dirs||a.transition)return!0;if(d&&R>=0){if(R&1024)return!0;if(R&16)return m?Hm(m,x,j):!!x;if(R&8){const U=a.dynamicProps;for(let N=0;N<U.length;N++){const $=U[N];if(x[$]!==m[$]&&!vh(j,$))return!0}}}else return(v||h)&&(!h||!h.$stable)?!0:m===x?!1:m?x?Hm(m,x,j):!0:!!x;return!1}function Hm(n,a,d){const m=Object.keys(a);if(m.length!==Object.keys(n).length)return!0;for(let v=0;v<m.length;v++){const T=m[v];if(a[T]!==n[T]&&!vh(d,T))return!0}return!1}function qv({vnode:n,parent:a},d){for(;a;){const m=a.subTree;if(m.suspense&&m.suspense.activeBranch===n&&(m.el=n.el),m===n)(n=a.vnode).el=d,a=a.parent;else break}}const R_="components";function FI(n,a){return Hv(R_,n,!0,a)||n}const Gv=Symbol.for("v-ndc");function Hv(n,a,d=!0,m=!1){const v=pr||Cr;if(v){const T=v.type;if(n===R_){const h=Ub(T,!1);if(h&&(h===a||h===ns(a)||h===mh(ns(a))))return T}const x=Zm(v[n]||T[n],a)||Zm(v.appContext[n],a);return!x&&m?T:x}}function Zm(n,a){return n&&(n[a]||n[ns(a)]||n[mh(ns(a))])}const Zv=n=>n.__isSuspense;function Wv(n,a){a&&a.pendingBranch?Rt(n)?a.effects.push(...n):a.effects.push(n):Bv(n)}const Kv=Symbol.for("v-scx"),Xv=()=>ln(Kv),Hu={};function mc(n,a,d){return L_(n,a,d)}function L_(n,a,{immediate:d,deep:m,flush:v,once:T,onTrack:x,onTrigger:h}=Li){if(a&&T){const ct=a;a=(...vt)=>{ct(...vt),lt()}}const R=Cr,j=ct=>m===!0?ct:No(ct,m===!1?1:void 0);let U,N=!1,$=!1;if(ar(n)?(U=()=>n.value,N=sh(n)):Ts(n)?(U=()=>j(n),N=!0):Rt(n)?($=!0,N=n.some(ct=>Ts(ct)||sh(ct)),U=()=>n.map(ct=>{if(ar(ct))return ct.value;if(Ts(ct))return j(ct);if(Vt(ct))return ro(ct,R,2)})):Vt(n)?a?U=()=>ro(n,R,2):U=()=>(ge&&ge(),Nn(n,R,3,[xe])):U=Cn,a&&m){const ct=U;U=()=>No(ct())}let ge,xe=ct=>{ge=me.onStop=()=>{ro(ct,R,4),ge=me.onStop=void 0}},Ee;if(Ah)if(xe=Cn,a?d&&Nn(a,R,3,[U(),$?[]:void 0,xe]):U(),v==="sync"){const ct=Xv();Ee=ct.__watcherHandles||(ct.__watcherHandles=[])}else return Cn;let Ke=$?new Array(n.length).fill(Hu):Hu;const Ne=()=>{if(!(!me.active||!me.dirty))if(a){const ct=me.run();(m||N||($?ct.some((vt,tt)=>no(vt,Ke[tt])):no(ct,Ke)))&&(ge&&ge(),Nn(a,R,3,[ct,Ke===Hu?void 0:$&&Ke[0]===Hu?[]:Ke,xe]),Ke=ct)}else me.run()};Ne.allowRecurse=!!a;let He;v==="sync"?He=Ne:v==="post"?He=()=>an(Ne,R&&R.suspense):(Ne.pre=!0,R&&(Ne.id=R.uid),He=()=>qp(Ne));const me=new Lp(U,Cn,He),We=c_(),lt=()=>{me.stop(),We&&Dp(We.effects,me)};return a?d?Ne():Ke=me.run():v==="post"?an(me.run.bind(me),R&&R.suspense):me.run(),Ee&&Ee.push(lt),lt}function Yv(n,a,d){const m=this.proxy,v=fr(n)?n.includes(".")?F_(m,n):()=>m[n]:n.bind(m,m);let T;Vt(a)?T=a:(T=a.handler,d=a);const x=Dc(this),h=L_(v,T.bind(m),d);return x(),h}function F_(n,a){const d=a.split(".");return()=>{let m=n;for(let v=0;v<d.length&&m;v++)m=m[d[v]];return m}}function No(n,a,d=0,m){if(!Fi(n)||n.__v_skip)return n;if(a&&a>0){if(d>=a)return n;d++}if(m=m||new Set,m.has(n))return n;if(m.add(n),ar(n))No(n.value,a,d,m);else if(Rt(n))for(let v=0;v<n.length;v++)No(n[v],a,d,m);else if(e_(n)||Xa(n))n.forEach(v=>{No(v,a,d,m)});else if(r_(n))for(const v in n)No(n[v],a,d,m);return n}function Jv(n,a){if(pr===null)return n;const d=Ph(pr)||pr.proxy,m=n.dirs||(n.dirs=[]);for(let v=0;v<a.length;v++){let[T,x,h,R=Li]=a[v];T&&(Vt(T)&&(T={mounted:T,updated:T}),T.deep&&No(x),m.push({dir:T,instance:d,value:x,oldValue:void 0,arg:h,modifiers:R}))}return n}function Ro(n,a,d,m){const v=n.dirs,T=a&&a.dirs;for(let x=0;x<v.length;x++){const h=v[x];T&&(h.oldValue=T[x].value);let R=h.dir[m];R&&(jo(),Nn(R,d,8,[n.el,h,n,a]),qo())}}/*! #__NO_SIDE_EFFECTS__ */function O_(n,a){return Vt(n)?Mr({name:n.name},a,{setup:n}):n}const gc=n=>!!n.type.__asyncLoader,B_=n=>n.type.__isKeepAlive;function Qv(n,a){N_(n,"a",a)}function eb(n,a){N_(n,"da",a)}function N_(n,a,d=Cr){const m=n.__wdc||(n.__wdc=()=>{let v=d;for(;v;){if(v.isDeactivated)return;v=v.parent}return n()});if(Th(a,m,d),d){let v=d.parent;for(;v&&v.parent;)B_(v.parent.vnode)&&tb(m,a,d,v),v=v.parent}}function tb(n,a,d,m){const v=Th(a,n,m,!0);$_(()=>{Dp(m[a],v)},d)}function Th(n,a,d=Cr,m=!1){if(d){const v=d[n]||(d[n]=[]),T=a.__weh||(a.__weh=(...x)=>{if(d.isUnmounted)return;jo();const h=Dc(d),R=Nn(a,d,n,x);return h(),qo(),R});return m?v.unshift(T):v.push(T),T}}const Is=n=>(a,d=Cr)=>(!Ah||n==="sp")&&Th(n,(...m)=>a(...m),d),V_=Is("bm"),Gp=Is("m"),ib=Is("bu"),rb=Is("u"),nb=Is("bum"),$_=Is("um"),sb=Is("sp"),ob=Is("rtg"),ab=Is("rtc");function lb(n,a=Cr){Th("ec",n,a)}function Ec(n,a,d,m){let v;const T=d&&d[m];if(Rt(n)||fr(n)){v=new Array(n.length);for(let x=0,h=n.length;x<h;x++)v[x]=a(n[x],x,void 0,T&&T[x])}else if(typeof n=="number"){v=new Array(n);for(let x=0;x<n;x++)v[x]=a(x+1,x,void 0,T&&T[x])}else if(Fi(n))if(n[Symbol.iterator])v=Array.from(n,(x,h)=>a(x,h,void 0,T&&T[h]));else{const x=Object.keys(n);v=new Array(x.length);for(let h=0,R=x.length;h<R;h++){const j=x[h];v[h]=a(n[j],j,h,T&&T[h])}}else v=[];return d&&(d[m]=v),v}function cb(n,a,d={},m,v){if(pr.isCE||pr.parent&&gc(pr.parent)&&pr.parent.isCE)return a!=="default"&&(d.name=a),Zi("slot",d,m&&m());let T=n[a];T&&T._c&&(T._d=!1),Xt();const x=T&&U_(T(d)),h=ws(Pr,{key:d.key||x&&x.key||`_${a}`},x||(m?m():[]),x&&n._===1?64:-2);return!v&&h.scopeId&&(h.slotScopeIds=[h.scopeId+"-s"]),T&&T._c&&(T._d=!0),h}function U_(n){return n.some(a=>lh(a)?!(a.type===so||a.type===Pr&&!U_(a.children)):!0)?n:null}const dp=n=>n?ey(n)?Ph(n)||n.proxy:dp(n.parent):null,_c=Mr(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>dp(n.parent),$root:n=>dp(n.root),$emit:n=>n.emit,$options:n=>Hp(n),$forceUpdate:n=>n.f||(n.f=()=>{n.effect.dirty=!0,qp(n.update)}),$nextTick:n=>n.n||(n.n=jp.bind(n.proxy)),$watch:n=>Yv.bind(n)}),Zd=(n,a)=>n!==Li&&!n.__isScriptSetup&&oi(n,a),ub={get({_:n},a){const{ctx:d,setupState:m,data:v,props:T,accessCache:x,type:h,appContext:R}=n;let j;if(a[0]!=="$"){const ge=x[a];if(ge!==void 0)switch(ge){case 1:return m[a];case 2:return v[a];case 4:return d[a];case 3:return T[a]}else{if(Zd(m,a))return x[a]=1,m[a];if(v!==Li&&oi(v,a))return x[a]=2,v[a];if((j=n.propsOptions[0])&&oi(j,a))return x[a]=3,T[a];if(d!==Li&&oi(d,a))return x[a]=4,d[a];pp&&(x[a]=0)}}const U=_c[a];let N,$;if(U)return a==="$attrs"&&cn(n,"get",a),U(n);if((N=h.__cssModules)&&(N=N[a]))return N;if(d!==Li&&oi(d,a))return x[a]=4,d[a];if($=R.config.globalProperties,oi($,a))return $[a]},set({_:n},a,d){const{data:m,setupState:v,ctx:T}=n;return Zd(v,a)?(v[a]=d,!0):m!==Li&&oi(m,a)?(m[a]=d,!0):oi(n.props,a)||a[0]==="$"&&a.slice(1)in n?!1:(T[a]=d,!0)},has({_:{data:n,setupState:a,accessCache:d,ctx:m,appContext:v,propsOptions:T}},x){let h;return!!d[x]||n!==Li&&oi(n,x)||Zd(a,x)||(h=T[0])&&oi(h,x)||oi(m,x)||oi(_c,x)||oi(v.config.globalProperties,x)},defineProperty(n,a,d){return d.get!=null?n._.accessCache[a]=0:oi(d,"value")&&this.set(n,a,d.value,null),Reflect.defineProperty(n,a,d)}};function Wm(n){return Rt(n)?n.reduce((a,d)=>(a[d]=null,a),{}):n}let pp=!0;function hb(n){const a=Hp(n),d=n.proxy,m=n.ctx;pp=!1,a.beforeCreate&&Km(a.beforeCreate,n,"bc");const{data:v,computed:T,methods:x,watch:h,provide:R,inject:j,created:U,beforeMount:N,mounted:$,beforeUpdate:ge,updated:xe,activated:Ee,deactivated:Ke,beforeDestroy:Ne,beforeUnmount:He,destroyed:me,unmounted:We,render:lt,renderTracked:ct,renderTriggered:vt,errorCaptured:tt,serverPrefetch:ot,expose:bt,inheritAttrs:gt,components:ei,directives:ri,filters:$t}=a;if(j&&db(j,m,null),x)for(const Ft in x){const Ht=x[Ft];Vt(Ht)&&(m[Ft]=Ht.bind(d))}if(v){const Ft=v.call(d,d);Fi(Ft)&&(n.data=kc(Ft))}if(pp=!0,T)for(const Ft in T){const Ht=T[Ft],cr=Vt(Ht)?Ht.bind(d,d):Vt(Ht.get)?Ht.get.bind(d,d):Cn,vr=!Vt(Ht)&&Vt(Ht.set)?Ht.set.bind(d):Cn,vi=dr({get:cr,set:vr});Object.defineProperty(m,Ft,{enumerable:!0,configurable:!0,get:()=>vi.value,set:ni=>vi.value=ni})}if(h)for(const Ft in h)j_(h[Ft],m,d,Ft);if(R){const Ft=Vt(R)?R.call(d):R;Reflect.ownKeys(Ft).forEach(Ht=>{Qa(Ht,Ft[Ht])})}U&&Km(U,n,"c");function Lt(Ft,Ht){Rt(Ht)?Ht.forEach(cr=>Ft(cr.bind(d))):Ht&&Ft(Ht.bind(d))}if(Lt(V_,N),Lt(Gp,$),Lt(ib,ge),Lt(rb,xe),Lt(Qv,Ee),Lt(eb,Ke),Lt(lb,tt),Lt(ab,ct),Lt(ob,vt),Lt(nb,He),Lt($_,We),Lt(sb,ot),Rt(bt))if(bt.length){const Ft=n.exposed||(n.exposed={});bt.forEach(Ht=>{Object.defineProperty(Ft,Ht,{get:()=>d[Ht],set:cr=>d[Ht]=cr})})}else n.exposed||(n.exposed={});lt&&n.render===Cn&&(n.render=lt),gt!=null&&(n.inheritAttrs=gt),ei&&(n.components=ei),ri&&(n.directives=ri)}function db(n,a,d=Cn){Rt(n)&&(n=fp(n));for(const m in n){const v=n[m];let T;Fi(v)?"default"in v?T=ln(v.from||m,v.default,!0):T=ln(v.from||m):T=ln(v),ar(T)?Object.defineProperty(a,m,{enumerable:!0,configurable:!0,get:()=>T.value,set:x=>T.value=x}):a[m]=T}}function Km(n,a,d){Nn(Rt(n)?n.map(m=>m.bind(a.proxy)):n.bind(a.proxy),a,d)}function j_(n,a,d,m){const v=m.includes(".")?F_(d,m):()=>d[m];if(fr(n)){const T=a[n];Vt(T)&&mc(v,T)}else if(Vt(n))mc(v,n.bind(d));else if(Fi(n))if(Rt(n))n.forEach(T=>j_(T,a,d,m));else{const T=Vt(n.handler)?n.handler.bind(d):a[n.handler];Vt(T)&&mc(v,T,n)}}function Hp(n){const a=n.type,{mixins:d,extends:m}=a,{mixins:v,optionsCache:T,config:{optionMergeStrategies:x}}=n.appContext,h=T.get(a);let R;return h?R=h:!v.length&&!d&&!m?R=a:(R={},v.length&&v.forEach(j=>ah(R,j,x,!0)),ah(R,a,x)),Fi(a)&&T.set(a,R),R}function ah(n,a,d,m=!1){const{mixins:v,extends:T}=a;T&&ah(n,T,d,!0),v&&v.forEach(x=>ah(n,x,d,!0));for(const x in a)if(!(m&&x==="expose")){const h=pb[x]||d&&d[x];n[x]=h?h(n[x],a[x]):a[x]}return n}const pb={data:Xm,props:Ym,emits:Ym,methods:pc,computed:pc,beforeCreate:Yr,created:Yr,beforeMount:Yr,mounted:Yr,beforeUpdate:Yr,updated:Yr,beforeDestroy:Yr,beforeUnmount:Yr,destroyed:Yr,unmounted:Yr,activated:Yr,deactivated:Yr,errorCaptured:Yr,serverPrefetch:Yr,components:pc,directives:pc,watch:mb,provide:Xm,inject:fb};function Xm(n,a){return a?n?function(){return Mr(Vt(n)?n.call(this,this):n,Vt(a)?a.call(this,this):a)}:a:n}function fb(n,a){return pc(fp(n),fp(a))}function fp(n){if(Rt(n)){const a={};for(let d=0;d<n.length;d++)a[n[d]]=n[d];return a}return n}function Yr(n,a){return n?[...new Set([].concat(n,a))]:a}function pc(n,a){return n?Mr(Object.create(null),n,a):a}function Ym(n,a){return n?Rt(n)&&Rt(a)?[...new Set([...n,...a])]:Mr(Object.create(null),Wm(n),Wm(a??{})):a}function mb(n,a){if(!n)return a;if(!a)return n;const d=Mr(Object.create(null),n);for(const m in a)d[m]=Yr(n[m],a[m]);return d}function q_(){return{app:null,config:{isNativeTag:W0,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let gb=0;function _b(n,a){return function(m,v=null){Vt(m)||(m=Mr({},m)),v!=null&&!Fi(v)&&(v=null);const T=q_(),x=new WeakSet;let h=!1;const R=T.app={_uid:gb++,_component:m,_props:v,_container:null,_context:T,_instance:null,version:qb,get config(){return T.config},set config(j){},use(j,...U){return x.has(j)||(j&&Vt(j.install)?(x.add(j),j.install(R,...U)):Vt(j)&&(x.add(j),j(R,...U))),R},mixin(j){return T.mixins.includes(j)||T.mixins.push(j),R},component(j,U){return U?(T.components[j]=U,R):T.components[j]},directive(j,U){return U?(T.directives[j]=U,R):T.directives[j]},mount(j,U,N){if(!h){const $=Zi(m,v);return $.appContext=T,N===!0?N="svg":N===!1&&(N=void 0),U&&a?a($,j):n($,j,N),h=!0,R._container=j,j.__vue_app__=R,Ph($.component)||$.component.proxy}},unmount(){h&&(n(null,R._container),delete R._container.__vue_app__)},provide(j,U){return T.provides[j]=U,R},runWithContext(j){const U=Ja;Ja=R;try{return j()}finally{Ja=U}}};return R}}let Ja=null;function Qa(n,a){if(Cr){let d=Cr.provides;const m=Cr.parent&&Cr.parent.provides;m===d&&(d=Cr.provides=Object.create(m)),d[n]=a}}function ln(n,a,d=!1){const m=Cr||pr;if(m||Ja){const v=m?m.parent==null?m.vnode.appContext&&m.vnode.appContext.provides:m.parent.provides:Ja._context.provides;if(v&&n in v)return v[n];if(arguments.length>1)return d&&Vt(a)?a.call(m&&m.proxy):a}}function yb(){return!!(Cr||pr||Ja)}function xb(n,a,d,m=!1){const v={},T={};rh(T,Ih,1),n.propsDefaults=Object.create(null),G_(n,a,v,T);for(const x in n.propsOptions[0])x in v||(v[x]=void 0);d?n.props=m?v:b_(v):n.type.props?n.props=v:n.props=T,n.attrs=T}function vb(n,a,d,m){const{props:v,attrs:T,vnode:{patchFlag:x}}=n,h=ii(v),[R]=n.propsOptions;let j=!1;if((m||x>0)&&!(x&16)){if(x&8){const U=n.vnode.dynamicProps;for(let N=0;N<U.length;N++){let $=U[N];if(vh(n.emitsOptions,$))continue;const ge=a[$];if(R)if(oi(T,$))ge!==T[$]&&(T[$]=ge,j=!0);else{const xe=ns($);v[xe]=mp(R,h,xe,ge,n,!1)}else ge!==T[$]&&(T[$]=ge,j=!0)}}}else{G_(n,a,v,T)&&(j=!0);let U;for(const N in h)(!a||!oi(a,N)&&((U=Uo(N))===N||!oi(a,U)))&&(R?d&&(d[N]!==void 0||d[U]!==void 0)&&(v[N]=mp(R,h,N,void 0,n,!0)):delete v[N]);if(T!==h)for(const N in T)(!a||!oi(a,N))&&(delete T[N],j=!0)}j&&Ss(n,"set","$attrs")}function G_(n,a,d,m){const[v,T]=n.propsOptions;let x=!1,h;if(a)for(let R in a){if(fc(R))continue;const j=a[R];let U;v&&oi(v,U=ns(R))?!T||!T.includes(U)?d[U]=j:(h||(h={}))[U]=j:vh(n.emitsOptions,R)||(!(R in m)||j!==m[R])&&(m[R]=j,x=!0)}if(T){const R=ii(d),j=h||Li;for(let U=0;U<T.length;U++){const N=T[U];d[N]=mp(v,R,N,j[N],n,!oi(j,N))}}return x}function mp(n,a,d,m,v,T){const x=n[d];if(x!=null){const h=oi(x,"default");if(h&&m===void 0){const R=x.default;if(x.type!==Function&&!x.skipFactory&&Vt(R)){const{propsDefaults:j}=v;if(d in j)m=j[d];else{const U=Dc(v);m=j[d]=R.call(null,a),U()}}else m=R}x[0]&&(T&&!h?m=!1:x[1]&&(m===""||m===Uo(d))&&(m=!0))}return m}function H_(n,a,d=!1){const m=a.propsCache,v=m.get(n);if(v)return v;const T=n.props,x={},h=[];let R=!1;if(!Vt(n)){const U=N=>{R=!0;const[$,ge]=H_(N,a,!0);Mr(x,$),ge&&h.push(...ge)};!d&&a.mixins.length&&a.mixins.forEach(U),n.extends&&U(n.extends),n.mixins&&n.mixins.forEach(U)}if(!T&&!R)return Fi(n)&&m.set(n,Ka),Ka;if(Rt(T))for(let U=0;U<T.length;U++){const N=ns(T[U]);Jm(N)&&(x[N]=Li)}else if(T)for(const U in T){const N=ns(U);if(Jm(N)){const $=T[U],ge=x[N]=Rt($)||Vt($)?{type:$}:Mr({},$);if(ge){const xe=tg(Boolean,ge.type),Ee=tg(String,ge.type);ge[0]=xe>-1,ge[1]=Ee<0||xe<Ee,(xe>-1||oi(ge,"default"))&&h.push(N)}}}const j=[x,h];return Fi(n)&&m.set(n,j),j}function Jm(n){return n[0]!=="$"&&!fc(n)}function Qm(n){return n===null?"null":typeof n=="function"?n.name||"":typeof n=="object"&&n.constructor&&n.constructor.name||""}function eg(n,a){return Qm(n)===Qm(a)}function tg(n,a){return Rt(a)?a.findIndex(d=>eg(d,n)):Vt(a)&&eg(a,n)?0:-1}const Z_=n=>n[0]==="_"||n==="$stable",Zp=n=>Rt(n)?n.map(ts):[ts(n)],bb=(n,a,d)=>{if(a._n)return a;const m=Fo((...v)=>Zp(a(...v)),d);return m._c=!1,m},W_=(n,a,d)=>{const m=n._ctx;for(const v in n){if(Z_(v))continue;const T=n[v];if(Vt(T))a[v]=bb(v,T,m);else if(T!=null){const x=Zp(T);a[v]=()=>x}}},K_=(n,a)=>{const d=Zp(a);n.slots.default=()=>d},wb=(n,a)=>{if(n.vnode.shapeFlag&32){const d=a._;d?(n.slots=ii(a),rh(a,"_",d)):W_(a,n.slots={})}else n.slots={},a&&K_(n,a);rh(n.slots,Ih,1)},Sb=(n,a,d)=>{const{vnode:m,slots:v}=n;let T=!0,x=Li;if(m.shapeFlag&32){const h=a._;h?d&&h===1?T=!1:(Mr(v,a),!d&&h===1&&delete v._):(T=!a.$stable,W_(a,v)),x=a}else a&&(K_(n,a),x={default:1});if(T)for(const h in v)!Z_(h)&&x[h]==null&&delete v[h]};function gp(n,a,d,m,v=!1){if(Rt(n)){n.forEach(($,ge)=>gp($,a&&(Rt(a)?a[ge]:a),d,m,v));return}if(gc(m)&&!v)return;const T=m.shapeFlag&4?Ph(m.component)||m.component.proxy:m.el,x=v?null:T,{i:h,r:R}=n,j=a&&a.r,U=h.refs===Li?h.refs={}:h.refs,N=h.setupState;if(j!=null&&j!==R&&(fr(j)?(U[j]=null,oi(N,j)&&(N[j]=null)):ar(j)&&(j.value=null)),Vt(R))ro(R,h,12,[x,U]);else{const $=fr(R),ge=ar(R);if($||ge){const xe=()=>{if(n.f){const Ee=$?oi(N,R)?N[R]:U[R]:R.value;v?Rt(Ee)&&Dp(Ee,T):Rt(Ee)?Ee.includes(T)||Ee.push(T):$?(U[R]=[T],oi(N,R)&&(N[R]=U[R])):(R.value=[T],n.k&&(U[n.k]=R.value))}else $?(U[R]=x,oi(N,R)&&(N[R]=x)):ge&&(R.value=x,n.k&&(U[n.k]=x))};x?(xe.id=-1,an(xe,d)):xe()}}}const an=Wv;function Tb(n){return Eb(n)}function Eb(n,a){const d=n_();d.__VUE__=!0;const{insert:m,remove:v,patchProp:T,createElement:x,createText:h,createComment:R,setText:j,setElementText:U,parentNode:N,nextSibling:$,setScopeId:ge=Cn,insertStaticContent:xe}=n,Ee=(J,ie,ye,De=null,ee=null,je=null,et=void 0,Ie=null,Oe=!!ie.dynamicChildren)=>{if(J===ie)return;J&&!ac(J,ie)&&(De=Pe(J),ni(J,ee,je,!0),J=null),ie.patchFlag===-2&&(Oe=!1,ie.dynamicChildren=null);const{type:Fe,ref:st,shapeFlag:wt}=ie;switch(Fe){case Eh:Ke(J,ie,ye,De);break;case so:Ne(J,ie,ye,De);break;case Yu:J==null&&He(ie,ye,De,et);break;case Pr:ei(J,ie,ye,De,ee,je,et,Ie,Oe);break;default:wt&1?lt(J,ie,ye,De,ee,je,et,Ie,Oe):wt&6?ri(J,ie,ye,De,ee,je,et,Ie,Oe):(wt&64||wt&128)&&Fe.process(J,ie,ye,De,ee,je,et,Ie,Oe,ht)}st!=null&&ee&&gp(st,J&&J.ref,je,ie||J,!ie)},Ke=(J,ie,ye,De)=>{if(J==null)m(ie.el=h(ie.children),ye,De);else{const ee=ie.el=J.el;ie.children!==J.children&&j(ee,ie.children)}},Ne=(J,ie,ye,De)=>{J==null?m(ie.el=R(ie.children||""),ye,De):ie.el=J.el},He=(J,ie,ye,De)=>{[J.el,J.anchor]=xe(J.children,ie,ye,De,J.el,J.anchor)},me=({el:J,anchor:ie},ye,De)=>{let ee;for(;J&&J!==ie;)ee=$(J),m(J,ye,De),J=ee;m(ie,ye,De)},We=({el:J,anchor:ie})=>{let ye;for(;J&&J!==ie;)ye=$(J),v(J),J=ye;v(ie)},lt=(J,ie,ye,De,ee,je,et,Ie,Oe)=>{ie.type==="svg"?et="svg":ie.type==="math"&&(et="mathml"),J==null?ct(ie,ye,De,ee,je,et,Ie,Oe):ot(J,ie,ee,je,et,Ie,Oe)},ct=(J,ie,ye,De,ee,je,et,Ie)=>{let Oe,Fe;const{props:st,shapeFlag:wt,transition:ft,dirs:Tt}=J;if(Oe=J.el=x(J.type,je,st&&st.is,st),wt&8?U(Oe,J.children):wt&16&&tt(J.children,Oe,null,De,ee,Wd(J,je),et,Ie),Tt&&Ro(J,null,De,"created"),vt(Oe,J,J.scopeId,et,De),st){for(const Zt in st)Zt!=="value"&&!fc(Zt)&&T(Oe,Zt,null,st[Zt],je,J.children,De,ee,bi);"value"in st&&T(Oe,"value",null,st.value,je),(Fe=st.onVnodeBeforeMount)&&es(Fe,De,J)}Tt&&Ro(J,null,De,"beforeMount");const Nt=Ib(ee,ft);Nt&&ft.beforeEnter(Oe),m(Oe,ie,ye),((Fe=st&&st.onVnodeMounted)||Nt||Tt)&&an(()=>{Fe&&es(Fe,De,J),Nt&&ft.enter(Oe),Tt&&Ro(J,null,De,"mounted")},ee)},vt=(J,ie,ye,De,ee)=>{if(ye&&ge(J,ye),De)for(let je=0;je<De.length;je++)ge(J,De[je]);if(ee){let je=ee.subTree;if(ie===je){const et=ee.vnode;vt(J,et,et.scopeId,et.slotScopeIds,ee.parent)}}},tt=(J,ie,ye,De,ee,je,et,Ie,Oe=0)=>{for(let Fe=Oe;Fe<J.length;Fe++){const st=J[Fe]=Ie?Js(J[Fe]):ts(J[Fe]);Ee(null,st,ie,ye,De,ee,je,et,Ie)}},ot=(J,ie,ye,De,ee,je,et)=>{const Ie=ie.el=J.el;let{patchFlag:Oe,dynamicChildren:Fe,dirs:st}=ie;Oe|=J.patchFlag&16;const wt=J.props||Li,ft=ie.props||Li;let Tt;if(ye&&Lo(ye,!1),(Tt=ft.onVnodeBeforeUpdate)&&es(Tt,ye,ie,J),st&&Ro(ie,J,ye,"beforeUpdate"),ye&&Lo(ye,!0),Fe?bt(J.dynamicChildren,Fe,Ie,ye,De,Wd(ie,ee),je):et||Ht(J,ie,Ie,null,ye,De,Wd(ie,ee),je,!1),Oe>0){if(Oe&16)gt(Ie,ie,wt,ft,ye,De,ee);else if(Oe&2&&wt.class!==ft.class&&T(Ie,"class",null,ft.class,ee),Oe&4&&T(Ie,"style",wt.style,ft.style,ee),Oe&8){const Nt=ie.dynamicProps;for(let Zt=0;Zt<Nt.length;Zt++){const Ce=Nt[Zt],ui=wt[Ce],wi=ft[Ce];(wi!==ui||Ce==="value")&&T(Ie,Ce,ui,wi,ee,J.children,ye,De,bi)}}Oe&1&&J.children!==ie.children&&U(Ie,ie.children)}else!et&&Fe==null&&gt(Ie,ie,wt,ft,ye,De,ee);((Tt=ft.onVnodeUpdated)||st)&&an(()=>{Tt&&es(Tt,ye,ie,J),st&&Ro(ie,J,ye,"updated")},De)},bt=(J,ie,ye,De,ee,je,et)=>{for(let Ie=0;Ie<ie.length;Ie++){const Oe=J[Ie],Fe=ie[Ie],st=Oe.el&&(Oe.type===Pr||!ac(Oe,Fe)||Oe.shapeFlag&70)?N(Oe.el):ye;Ee(Oe,Fe,st,null,De,ee,je,et,!0)}},gt=(J,ie,ye,De,ee,je,et)=>{if(ye!==De){if(ye!==Li)for(const Ie in ye)!fc(Ie)&&!(Ie in De)&&T(J,Ie,ye[Ie],null,et,ie.children,ee,je,bi);for(const Ie in De){if(fc(Ie))continue;const Oe=De[Ie],Fe=ye[Ie];Oe!==Fe&&Ie!=="value"&&T(J,Ie,Fe,Oe,et,ie.children,ee,je,bi)}"value"in De&&T(J,"value",ye.value,De.value,et)}},ei=(J,ie,ye,De,ee,je,et,Ie,Oe)=>{const Fe=ie.el=J?J.el:h(""),st=ie.anchor=J?J.anchor:h("");let{patchFlag:wt,dynamicChildren:ft,slotScopeIds:Tt}=ie;Tt&&(Ie=Ie?Ie.concat(Tt):Tt),J==null?(m(Fe,ye,De),m(st,ye,De),tt(ie.children||[],ye,st,ee,je,et,Ie,Oe)):wt>0&&wt&64&&ft&&J.dynamicChildren?(bt(J.dynamicChildren,ft,ye,ee,je,et,Ie),(ie.key!=null||ee&&ie===ee.subTree)&&X_(J,ie,!0)):Ht(J,ie,ye,st,ee,je,et,Ie,Oe)},ri=(J,ie,ye,De,ee,je,et,Ie,Oe)=>{ie.slotScopeIds=Ie,J==null?ie.shapeFlag&512?ee.ctx.activate(ie,ye,De,et,Oe):$t(ie,ye,De,ee,je,et,Oe):Ki(J,ie,Oe)},$t=(J,ie,ye,De,ee,je,et)=>{const Ie=J.component=Ob(J,De,ee);if(B_(J)&&(Ie.ctx.renderer=ht),Bb(Ie),Ie.asyncDep){if(ee&&ee.registerDep(Ie,Lt),!J.el){const Oe=Ie.subTree=Zi(so);Ne(null,Oe,ie,ye)}}else Lt(Ie,J,ie,ye,ee,je,et)},Ki=(J,ie,ye)=>{const De=ie.component=J.component;if(jv(J,ie,ye))if(De.asyncDep&&!De.asyncResolved){Ft(De,ie,ye);return}else De.next=ie,Ov(De.update),De.effect.dirty=!0,De.update();else ie.el=J.el,De.vnode=ie},Lt=(J,ie,ye,De,ee,je,et)=>{const Ie=()=>{if(J.isMounted){let{next:st,bu:wt,u:ft,parent:Tt,vnode:Nt}=J;{const en=Y_(J);if(en){st&&(st.el=Nt.el,Ft(J,st,et)),en.asyncDep.then(()=>{J.isUnmounted||Ie()});return}}let Zt=st,Ce;Lo(J,!1),st?(st.el=Nt.el,Ft(J,st,et)):st=Nt,wt&&Ku(wt),(Ce=st.props&&st.props.onVnodeBeforeUpdate)&&es(Ce,Tt,st,Nt),Lo(J,!0);const ui=Hd(J),wi=J.subTree;J.subTree=ui,Ee(wi,ui,N(wi.el),Pe(wi),J,ee,je),st.el=ui.el,Zt===null&&qv(J,ui.el),ft&&an(ft,ee),(Ce=st.props&&st.props.onVnodeUpdated)&&an(()=>es(Ce,Tt,st,Nt),ee)}else{let st;const{el:wt,props:ft}=ie,{bm:Tt,m:Nt,parent:Zt}=J,Ce=gc(ie);if(Lo(J,!1),Tt&&Ku(Tt),!Ce&&(st=ft&&ft.onVnodeBeforeMount)&&es(st,Zt,ie),Lo(J,!0),wt&&Yt){const ui=()=>{J.subTree=Hd(J),Yt(wt,J.subTree,J,ee,null)};Ce?ie.type.__asyncLoader().then(()=>!J.isUnmounted&&ui()):ui()}else{const ui=J.subTree=Hd(J);Ee(null,ui,ye,De,J,ee,je),ie.el=ui.el}if(Nt&&an(Nt,ee),!Ce&&(st=ft&&ft.onVnodeMounted)){const ui=ie;an(()=>es(st,Zt,ui),ee)}(ie.shapeFlag&256||Zt&&gc(Zt.vnode)&&Zt.vnode.shapeFlag&256)&&J.a&&an(J.a,ee),J.isMounted=!0,ie=ye=De=null}},Oe=J.effect=new Lp(Ie,Cn,()=>qp(Fe),J.scope),Fe=J.update=()=>{Oe.dirty&&Oe.run()};Fe.id=J.uid,Lo(J,!0),Fe()},Ft=(J,ie,ye)=>{ie.component=J;const De=J.vnode.props;J.vnode=ie,J.next=null,vb(J,ie.props,De,ye),Sb(J,ie.children,ye),jo(),Gm(J),qo()},Ht=(J,ie,ye,De,ee,je,et,Ie,Oe=!1)=>{const Fe=J&&J.children,st=J?J.shapeFlag:0,wt=ie.children,{patchFlag:ft,shapeFlag:Tt}=ie;if(ft>0){if(ft&128){vr(Fe,wt,ye,De,ee,je,et,Ie,Oe);return}else if(ft&256){cr(Fe,wt,ye,De,ee,je,et,Ie,Oe);return}}Tt&8?(st&16&&bi(Fe,ee,je),wt!==Fe&&U(ye,wt)):st&16?Tt&16?vr(Fe,wt,ye,De,ee,je,et,Ie,Oe):bi(Fe,ee,je,!0):(st&8&&U(ye,""),Tt&16&&tt(wt,ye,De,ee,je,et,Ie,Oe))},cr=(J,ie,ye,De,ee,je,et,Ie,Oe)=>{J=J||Ka,ie=ie||Ka;const Fe=J.length,st=ie.length,wt=Math.min(Fe,st);let ft;for(ft=0;ft<wt;ft++){const Tt=ie[ft]=Oe?Js(ie[ft]):ts(ie[ft]);Ee(J[ft],Tt,ye,null,ee,je,et,Ie,Oe)}Fe>st?bi(J,ee,je,!0,!1,wt):tt(ie,ye,De,ee,je,et,Ie,Oe,wt)},vr=(J,ie,ye,De,ee,je,et,Ie,Oe)=>{let Fe=0;const st=ie.length;let wt=J.length-1,ft=st-1;for(;Fe<=wt&&Fe<=ft;){const Tt=J[Fe],Nt=ie[Fe]=Oe?Js(ie[Fe]):ts(ie[Fe]);if(ac(Tt,Nt))Ee(Tt,Nt,ye,null,ee,je,et,Ie,Oe);else break;Fe++}for(;Fe<=wt&&Fe<=ft;){const Tt=J[wt],Nt=ie[ft]=Oe?Js(ie[ft]):ts(ie[ft]);if(ac(Tt,Nt))Ee(Tt,Nt,ye,null,ee,je,et,Ie,Oe);else break;wt--,ft--}if(Fe>wt){if(Fe<=ft){const Tt=ft+1,Nt=Tt<st?ie[Tt].el:De;for(;Fe<=ft;)Ee(null,ie[Fe]=Oe?Js(ie[Fe]):ts(ie[Fe]),ye,Nt,ee,je,et,Ie,Oe),Fe++}}else if(Fe>ft)for(;Fe<=wt;)ni(J[Fe],ee,je,!0),Fe++;else{const Tt=Fe,Nt=Fe,Zt=new Map;for(Fe=Nt;Fe<=ft;Fe++){const _t=ie[Fe]=Oe?Js(ie[Fe]):ts(ie[Fe]);_t.key!=null&&Zt.set(_t.key,Fe)}let Ce,ui=0;const wi=ft-Nt+1;let en=!1,Xi=0;const Ve=new Array(wi);for(Fe=0;Fe<wi;Fe++)Ve[Fe]=0;for(Fe=Tt;Fe<=wt;Fe++){const _t=J[Fe];if(ui>=wi){ni(_t,ee,je,!0);continue}let si;if(_t.key!=null)si=Zt.get(_t.key);else for(Ce=Nt;Ce<=ft;Ce++)if(Ve[Ce-Nt]===0&&ac(_t,ie[Ce])){si=Ce;break}si===void 0?ni(_t,ee,je,!0):(Ve[si-Nt]=Fe+1,si>=Xi?Xi=si:en=!0,Ee(_t,ie[si],ye,null,ee,je,et,Ie,Oe),ui++)}const At=en?Ab(Ve):Ka;for(Ce=At.length-1,Fe=wi-1;Fe>=0;Fe--){const _t=Nt+Fe,si=ie[_t],$r=_t+1<st?ie[_t+1].el:De;Ve[Fe]===0?Ee(null,si,ye,$r,ee,je,et,Ie,Oe):en&&(Ce<0||Fe!==At[Ce]?vi(si,ye,$r,2):Ce--)}}},vi=(J,ie,ye,De,ee=null)=>{const{el:je,type:et,transition:Ie,children:Oe,shapeFlag:Fe}=J;if(Fe&6){vi(J.component.subTree,ie,ye,De);return}if(Fe&128){J.suspense.move(ie,ye,De);return}if(Fe&64){et.move(J,ie,ye,ht);return}if(et===Pr){m(je,ie,ye);for(let wt=0;wt<Oe.length;wt++)vi(Oe[wt],ie,ye,De);m(J.anchor,ie,ye);return}if(et===Yu){me(J,ie,ye);return}if(De!==2&&Fe&1&&Ie)if(De===0)Ie.beforeEnter(je),m(je,ie,ye),an(()=>Ie.enter(je),ee);else{const{leave:wt,delayLeave:ft,afterLeave:Tt}=Ie,Nt=()=>m(je,ie,ye),Zt=()=>{wt(je,()=>{Nt(),Tt&&Tt()})};ft?ft(je,Nt,Zt):Zt()}else m(je,ie,ye)},ni=(J,ie,ye,De=!1,ee=!1)=>{const{type:je,props:et,ref:Ie,children:Oe,dynamicChildren:Fe,shapeFlag:st,patchFlag:wt,dirs:ft}=J;if(Ie!=null&&gp(Ie,null,ye,J,!0),st&256){ie.ctx.deactivate(J);return}const Tt=st&1&&ft,Nt=!gc(J);let Zt;if(Nt&&(Zt=et&&et.onVnodeBeforeUnmount)&&es(Zt,ie,J),st&6)mr(J.component,ye,De);else{if(st&128){J.suspense.unmount(ye,De);return}Tt&&Ro(J,null,ie,"beforeUnmount"),st&64?J.type.remove(J,ie,ye,ee,ht,De):Fe&&(je!==Pr||wt>0&&wt&64)?bi(Fe,ie,ye,!1,!0):(je===Pr&&wt&384||!ee&&st&16)&&bi(Oe,ie,ye),De&&ur(J)}(Nt&&(Zt=et&&et.onVnodeUnmounted)||Tt)&&an(()=>{Zt&&es(Zt,ie,J),Tt&&Ro(J,null,ie,"unmounted")},ye)},ur=J=>{const{type:ie,el:ye,anchor:De,transition:ee}=J;if(ie===Pr){Qr(ye,De);return}if(ie===Yu){We(J);return}const je=()=>{v(ye),ee&&!ee.persisted&&ee.afterLeave&&ee.afterLeave()};if(J.shapeFlag&1&&ee&&!ee.persisted){const{leave:et,delayLeave:Ie}=ee,Oe=()=>et(ye,je);Ie?Ie(J.el,je,Oe):Oe()}else je()},Qr=(J,ie)=>{let ye;for(;J!==ie;)ye=$(J),v(J),J=ye;v(ie)},mr=(J,ie,ye)=>{const{bum:De,scope:ee,update:je,subTree:et,um:Ie}=J;De&&Ku(De),ee.stop(),je&&(je.active=!1,ni(et,J,ie,ye)),Ie&&an(Ie,ie),an(()=>{J.isUnmounted=!0},ie),ie&&ie.pendingBranch&&!ie.isUnmounted&&J.asyncDep&&!J.asyncResolved&&J.suspenseId===ie.pendingId&&(ie.deps--,ie.deps===0&&ie.resolve())},bi=(J,ie,ye,De=!1,ee=!1,je=0)=>{for(let et=je;et<J.length;et++)ni(J[et],ie,ye,De,ee)},Pe=J=>J.shapeFlag&6?Pe(J.component.subTree):J.shapeFlag&128?J.suspense.next():$(J.anchor||J.el);let it=!1;const Qe=(J,ie,ye)=>{J==null?ie._vnode&&ni(ie._vnode,null,null,!0):Ee(ie._vnode||null,J,ie,null,null,null,ye),it||(it=!0,Gm(),k_(),it=!1),ie._vnode=J},ht={p:Ee,um:ni,m:vi,r:ur,mt:$t,mc:tt,pc:Ht,pbc:bt,n:Pe,o:n};let Kt,Yt;return a&&([Kt,Yt]=a(ht)),{render:Qe,hydrate:Kt,createApp:_b(Qe,Kt)}}function Wd({type:n,props:a},d){return d==="svg"&&n==="foreignObject"||d==="mathml"&&n==="annotation-xml"&&a&&a.encoding&&a.encoding.includes("html")?void 0:d}function Lo({effect:n,update:a},d){n.allowRecurse=a.allowRecurse=d}function Ib(n,a){return(!n||n&&!n.pendingBranch)&&a&&!a.persisted}function X_(n,a,d=!1){const m=n.children,v=a.children;if(Rt(m)&&Rt(v))for(let T=0;T<m.length;T++){const x=m[T];let h=v[T];h.shapeFlag&1&&!h.dynamicChildren&&((h.patchFlag<=0||h.patchFlag===32)&&(h=v[T]=Js(v[T]),h.el=x.el),d||X_(x,h)),h.type===Eh&&(h.el=x.el)}}function Ab(n){const a=n.slice(),d=[0];let m,v,T,x,h;const R=n.length;for(m=0;m<R;m++){const j=n[m];if(j!==0){if(v=d[d.length-1],n[v]<j){a[m]=v,d.push(m);continue}for(T=0,x=d.length-1;T<x;)h=T+x>>1,n[d[h]]<j?T=h+1:x=h;j<n[d[T]]&&(T>0&&(a[m]=d[T-1]),d[T]=m)}}for(T=d.length,x=d[T-1];T-- >0;)d[T]=x,x=a[x];return d}function Y_(n){const a=n.subTree.component;if(a)return a.asyncDep&&!a.asyncResolved?a:Y_(a)}const Pb=n=>n.__isTeleport,Pr=Symbol.for("v-fgt"),Eh=Symbol.for("v-txt"),so=Symbol.for("v-cmt"),Yu=Symbol.for("v-stc"),yc=[];let Bn=null;function Xt(n=!1){yc.push(Bn=n?null:[])}function Cb(){yc.pop(),Bn=yc[yc.length-1]||null}let Ic=1;function ig(n){Ic+=n}function J_(n){return n.dynamicChildren=Ic>0?Bn||Ka:null,Cb(),Ic>0&&Bn&&Bn.push(n),n}function xi(n,a,d,m,v,T){return J_(Te(n,a,d,m,v,T,!0))}function ws(n,a,d,m,v){return J_(Zi(n,a,d,m,v,!0))}function lh(n){return n?n.__v_isVNode===!0:!1}function ac(n,a){return n.type===a.type&&n.key===a.key}const Ih="__vInternal",Q_=({key:n})=>n??null,Ju=({ref:n,ref_key:a,ref_for:d})=>(typeof n=="number"&&(n=""+n),n!=null?fr(n)||ar(n)||Vt(n)?{i:pr,r:n,k:a,f:!!d}:n:null);function Te(n,a=null,d=null,m=0,v=null,T=n===Pr?0:1,x=!1,h=!1){const R={__v_isVNode:!0,__v_skip:!0,type:n,props:a,key:a&&Q_(a),ref:a&&Ju(a),scopeId:bh,slotScopeIds:null,children:d,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:T,patchFlag:m,dynamicProps:v,dynamicChildren:null,appContext:null,ctx:pr};return h?(Wp(R,d),T&128&&n.normalize(R)):d&&(R.shapeFlag|=fr(d)?8:16),Ic>0&&!x&&Bn&&(R.patchFlag>0||T&6)&&R.patchFlag!==32&&Bn.push(R),R}const Zi=Mb;function Mb(n,a=null,d=null,m=0,v=null,T=!1){if((!n||n===Gv)&&(n=so),lh(n)){const h=tl(n,a,!0);return d&&Wp(h,d),Ic>0&&!T&&Bn&&(h.shapeFlag&6?Bn[Bn.indexOf(n)]=h:Bn.push(h)),h.patchFlag|=-2,h}if(jb(n)&&(n=n.__vccOpts),a){a=kb(a);let{class:h,style:R}=a;h&&!fr(h)&&(a.class=gh(h)),Fi(R)&&(S_(R)&&!Rt(R)&&(R=Mr({},R)),a.style=Rp(R))}const x=fr(n)?1:Zv(n)?128:Pb(n)?64:Fi(n)?4:Vt(n)?2:0;return Te(n,a,d,m,v,x,T,!0)}function kb(n){return n?S_(n)||Ih in n?Mr({},n):n:null}function tl(n,a,d=!1){const{props:m,ref:v,patchFlag:T,children:x}=n,h=a?Rb(m||{},a):m;return{__v_isVNode:!0,__v_skip:!0,type:n.type,props:h,key:h&&Q_(h),ref:a&&a.ref?d&&v?Rt(v)?v.concat(Ju(a)):[v,Ju(a)]:Ju(a):v,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:x,target:n.target,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:a&&n.type!==Pr?T===-1?16:T|16:T,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:n.transition,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&tl(n.ssContent),ssFallback:n.ssFallback&&tl(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce}}function Db(n=" ",a=0){return Zi(Eh,null,n,a)}function zb(n,a){const d=Zi(Yu,null,n);return d.staticCount=a,d}function Jr(n="",a=!1){return a?(Xt(),ws(so,null,n)):Zi(so,null,n)}function ts(n){return n==null||typeof n=="boolean"?Zi(so):Rt(n)?Zi(Pr,null,n.slice()):typeof n=="object"?Js(n):Zi(Eh,null,String(n))}function Js(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:tl(n)}function Wp(n,a){let d=0;const{shapeFlag:m}=n;if(a==null)a=null;else if(Rt(a))d=16;else if(typeof a=="object")if(m&65){const v=a.default;v&&(v._c&&(v._d=!1),Wp(n,v()),v._c&&(v._d=!0));return}else{d=32;const v=a._;!v&&!(Ih in a)?a._ctx=pr:v===3&&pr&&(pr.slots._===1?a._=1:(a._=2,n.patchFlag|=1024))}else Vt(a)?(a={default:a,_ctx:pr},d=32):(a=String(a),m&64?(d=16,a=[Db(a)]):d=8);n.children=a,n.shapeFlag|=d}function Rb(...n){const a={};for(let d=0;d<n.length;d++){const m=n[d];for(const v in m)if(v==="class")a.class!==m.class&&(a.class=gh([a.class,m.class]));else if(v==="style")a.style=Rp([a.style,m.style]);else if(dh(v)){const T=a[v],x=m[v];x&&T!==x&&!(Rt(T)&&T.includes(x))&&(a[v]=T?[].concat(T,x):x)}else v!==""&&(a[v]=m[v])}return a}function es(n,a,d,m=null){Nn(n,a,7,[d,m])}const Lb=q_();let Fb=0;function Ob(n,a,d){const m=n.type,v=(a?a.appContext:n.appContext)||Lb,T={uid:Fb++,vnode:n,type:m,parent:a,appContext:v,root:null,next:null,subTree:null,effect:null,update:null,scope:new a_(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:a?a.provides:Object.create(v.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:H_(m,v),emitsOptions:z_(m,v),emit:null,emitted:null,propsDefaults:Li,inheritAttrs:m.inheritAttrs,ctx:Li,data:Li,props:Li,attrs:Li,slots:Li,refs:Li,setupState:Li,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:d,suspenseId:d?d.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return T.ctx={_:T},T.root=a?a.root:T,T.emit=Vv.bind(null,T),n.ce&&n.ce(T),T}let Cr=null,ch,_p;{const n=n_(),a=(d,m)=>{let v;return(v=n[d])||(v=n[d]=[]),v.push(m),T=>{v.length>1?v.forEach(x=>x(T)):v[0](T)}};ch=a("__VUE_INSTANCE_SETTERS__",d=>Cr=d),_p=a("__VUE_SSR_SETTERS__",d=>Ah=d)}const Dc=n=>{const a=Cr;return ch(n),n.scope.on(),()=>{n.scope.off(),ch(a)}},rg=()=>{Cr&&Cr.scope.off(),ch(null)};function ey(n){return n.vnode.shapeFlag&4}let Ah=!1;function Bb(n,a=!1){a&&_p(a);const{props:d,children:m}=n.vnode,v=ey(n);xb(n,d,v,a),wb(n,m);const T=v?Nb(n,a):void 0;return a&&_p(!1),T}function Nb(n,a){const d=n.type;n.accessCache=Object.create(null),n.proxy=yh(new Proxy(n.ctx,ub));const{setup:m}=d;if(m){const v=n.setupContext=m.length>1?$b(n):null,T=Dc(n);jo();const x=ro(m,n,0,[n.props,v]);if(qo(),T(),t_(x)){if(x.then(rg,rg),a)return x.then(h=>{ng(n,h,a)}).catch(h=>{xh(h,n,0)});n.asyncDep=x}else ng(n,x,a)}else ty(n,a)}function ng(n,a,d){Vt(a)?n.type.__ssrInlineRender?n.ssrRender=a:n.render=a:Fi(a)&&(n.setupState=A_(a)),ty(n,d)}let sg;function ty(n,a,d){const m=n.type;if(!n.render){if(!a&&sg&&!m.render){const v=m.template||Hp(n).template;if(v){const{isCustomElement:T,compilerOptions:x}=n.appContext.config,{delimiters:h,compilerOptions:R}=m,j=Mr(Mr({isCustomElement:T,delimiters:h},x),R);m.render=sg(v,j)}}n.render=m.render||Cn}{const v=Dc(n);jo();try{hb(n)}finally{qo(),v()}}}function Vb(n){return n.attrsProxy||(n.attrsProxy=new Proxy(n.attrs,{get(a,d){return cn(n,"get","$attrs"),a[d]}}))}function $b(n){const a=d=>{n.exposed=d||{}};return{get attrs(){return Vb(n)},slots:n.slots,emit:n.emit,expose:a}}function Ph(n){if(n.exposed)return n.exposeProxy||(n.exposeProxy=new Proxy(A_(yh(n.exposed)),{get(a,d){if(d in a)return a[d];if(d in _c)return _c[d](n)},has(a,d){return d in a||d in _c}}))}function Ub(n,a=!0){return Vt(n)?n.displayName||n.name:n.name||a&&n.__name}function jb(n){return Vt(n)&&"__vccOpts"in n}const dr=(n,a)=>Av(n,a,Ah);function iy(n,a,d){const m=arguments.length;return m===2?Fi(a)&&!Rt(a)?lh(a)?Zi(n,null,[a]):Zi(n,a):Zi(n,null,a):(m>3?d=Array.prototype.slice.call(arguments,2):m===3&&lh(d)&&(d=[d]),Zi(n,a,d))}const qb="3.4.21";/**
* @vue/runtime-dom v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const Gb="http://www.w3.org/2000/svg",Hb="http://www.w3.org/1998/Math/MathML",Qs=typeof document<"u"?document:null,og=Qs&&Qs.createElement("template"),Zb={insert:(n,a,d)=>{a.insertBefore(n,d||null)},remove:n=>{const a=n.parentNode;a&&a.removeChild(n)},createElement:(n,a,d,m)=>{const v=a==="svg"?Qs.createElementNS(Gb,n):a==="mathml"?Qs.createElementNS(Hb,n):Qs.createElement(n,d?{is:d}:void 0);return n==="select"&&m&&m.multiple!=null&&v.setAttribute("multiple",m.multiple),v},createText:n=>Qs.createTextNode(n),createComment:n=>Qs.createComment(n),setText:(n,a)=>{n.nodeValue=a},setElementText:(n,a)=>{n.textContent=a},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>Qs.querySelector(n),setScopeId(n,a){n.setAttribute(a,"")},insertStaticContent(n,a,d,m,v,T){const x=d?d.previousSibling:a.lastChild;if(v&&(v===T||v.nextSibling))for(;a.insertBefore(v.cloneNode(!0),d),!(v===T||!(v=v.nextSibling)););else{og.innerHTML=m==="svg"?`<svg>${n}</svg>`:m==="mathml"?`<math>${n}</math>`:n;const h=og.content;if(m==="svg"||m==="mathml"){const R=h.firstChild;for(;R.firstChild;)h.appendChild(R.firstChild);h.removeChild(R)}a.insertBefore(h,d)}return[x?x.nextSibling:a.firstChild,d?d.previousSibling:a.lastChild]}},Wb=Symbol("_vtc");function Kb(n,a,d){const m=n[Wb];m&&(a=(a?[a,...m]:[...m]).join(" ")),a==null?n.removeAttribute("class"):d?n.setAttribute("class",a):n.className=a}const ag=Symbol("_vod"),Xb=Symbol("_vsh"),Yb=Symbol(""),Jb=/(^|;)\s*display\s*:/;function Qb(n,a,d){const m=n.style,v=fr(d);let T=!1;if(d&&!v){if(a)if(fr(a))for(const x of a.split(";")){const h=x.slice(0,x.indexOf(":")).trim();d[h]==null&&Qu(m,h,"")}else for(const x in a)d[x]==null&&Qu(m,x,"");for(const x in d)x==="display"&&(T=!0),Qu(m,x,d[x])}else if(v){if(a!==d){const x=m[Yb];x&&(d+=";"+x),m.cssText=d,T=Jb.test(d)}}else a&&n.removeAttribute("style");ag in n&&(n[ag]=T?m.display:"",n[Xb]&&(m.display="none"))}const lg=/\s*!important$/;function Qu(n,a,d){if(Rt(d))d.forEach(m=>Qu(n,a,m));else if(d==null&&(d=""),a.startsWith("--"))n.setProperty(a,d);else{const m=e1(n,a);lg.test(d)?n.setProperty(Uo(m),d.replace(lg,""),"important"):n[m]=d}}const cg=["Webkit","Moz","ms"],Kd={};function e1(n,a){const d=Kd[a];if(d)return d;let m=ns(a);if(m!=="filter"&&m in n)return Kd[a]=m;m=mh(m);for(let v=0;v<cg.length;v++){const T=cg[v]+m;if(T in n)return Kd[a]=T}return a}const ug="http://www.w3.org/1999/xlink";function t1(n,a,d,m,v){if(m&&a.startsWith("xlink:"))d==null?n.removeAttributeNS(ug,a.slice(6,a.length)):n.setAttributeNS(ug,a,d);else{const T=nv(a);d==null||T&&!s_(d)?n.removeAttribute(a):n.setAttribute(a,T?"":d)}}function i1(n,a,d,m,v,T,x){if(a==="innerHTML"||a==="textContent"){m&&x(m,v,T),n[a]=d??"";return}const h=n.tagName;if(a==="value"&&h!=="PROGRESS"&&!h.includes("-")){const j=h==="OPTION"?n.getAttribute("value")||"":n.value,U=d??"";(j!==U||!("_value"in n))&&(n.value=U),d==null&&n.removeAttribute(a),n._value=d;return}let R=!1;if(d===""||d==null){const j=typeof n[a];j==="boolean"?d=s_(d):d==null&&j==="string"?(d="",R=!0):j==="number"&&(d=0,R=!0)}try{n[a]=d}catch{}R&&n.removeAttribute(a)}function Ha(n,a,d,m){n.addEventListener(a,d,m)}function r1(n,a,d,m){n.removeEventListener(a,d,m)}const hg=Symbol("_vei");function n1(n,a,d,m,v=null){const T=n[hg]||(n[hg]={}),x=T[a];if(m&&x)x.value=m;else{const[h,R]=s1(a);if(m){const j=T[a]=l1(m,v);Ha(n,h,j,R)}else x&&(r1(n,h,x,R),T[a]=void 0)}}const dg=/(?:Once|Passive|Capture)$/;function s1(n){let a;if(dg.test(n)){a={};let m;for(;m=n.match(dg);)n=n.slice(0,n.length-m[0].length),a[m[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):Uo(n.slice(2)),a]}let Xd=0;const o1=Promise.resolve(),a1=()=>Xd||(o1.then(()=>Xd=0),Xd=Date.now());function l1(n,a){const d=m=>{if(!m._vts)m._vts=Date.now();else if(m._vts<=d.attached)return;Nn(c1(m,d.value),a,5,[m])};return d.value=n,d.attached=a1(),d}function c1(n,a){if(Rt(a)){const d=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{d.call(n),n._stopped=!0},a.map(m=>v=>!v._stopped&&m&&m(v))}else return a}const pg=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,u1=(n,a,d,m,v,T,x,h,R)=>{const j=v==="svg";a==="class"?Kb(n,m,j):a==="style"?Qb(n,d,m):dh(a)?kp(a)||n1(n,a,d,m,x):(a[0]==="."?(a=a.slice(1),!0):a[0]==="^"?(a=a.slice(1),!1):h1(n,a,m,j))?i1(n,a,m,T,x,h,R):(a==="true-value"?n._trueValue=m:a==="false-value"&&(n._falseValue=m),t1(n,a,m,j))};function h1(n,a,d,m){if(m)return!!(a==="innerHTML"||a==="textContent"||a in n&&pg(a)&&Vt(d));if(a==="spellcheck"||a==="draggable"||a==="translate"||a==="form"||a==="list"&&n.tagName==="INPUT"||a==="type"&&n.tagName==="TEXTAREA")return!1;if(a==="width"||a==="height"){const v=n.tagName;if(v==="IMG"||v==="VIDEO"||v==="CANVAS"||v==="SOURCE")return!1}return pg(a)&&fr(d)?!1:a in n}const fg=n=>{const a=n.props["onUpdate:modelValue"]||!1;return Rt(a)?d=>Ku(a,d):a};function d1(n){n.target.composing=!0}function mg(n){const a=n.target;a.composing&&(a.composing=!1,a.dispatchEvent(new Event("input")))}const Yd=Symbol("_assign"),p1={created(n,{modifiers:{lazy:a,trim:d,number:m}},v){n[Yd]=fg(v);const T=m||v.props&&v.props.type==="number";Ha(n,a?"change":"input",x=>{if(x.target.composing)return;let h=n.value;d&&(h=h.trim()),T&&(h=ap(h)),n[Yd](h)}),d&&Ha(n,"change",()=>{n.value=n.value.trim()}),a||(Ha(n,"compositionstart",d1),Ha(n,"compositionend",mg),Ha(n,"change",mg))},mounted(n,{value:a}){n.value=a??""},beforeUpdate(n,{value:a,modifiers:{lazy:d,trim:m,number:v}},T){if(n[Yd]=fg(T),n.composing)return;const x=v||n.type==="number"?ap(n.value):n.value,h=a??"";x!==h&&(document.activeElement===n&&n.type!=="range"&&(d||m&&n.value.trim()===h)||(n.value=h))}},f1={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},m1=(n,a)=>{const d=n._withKeys||(n._withKeys={}),m=a.join(".");return d[m]||(d[m]=v=>{if(!("key"in v))return;const T=Uo(v.key);if(a.some(x=>x===T||f1[x]===T))return n(v)})},g1=Mr({patchProp:u1},Zb);let gg;function _1(){return gg||(gg=Tb(g1))}const y1=(...n)=>{const a=_1().createApp(...n),{mount:d}=a;return a.mount=m=>{const v=v1(m);if(!v)return;const T=a._component;!Vt(T)&&!T.render&&!T.template&&(T.template=v.innerHTML),v.innerHTML="";const x=d(v,!1,x1(v));return v instanceof Element&&(v.removeAttribute("v-cloak"),v.setAttribute("data-v-app","")),x},a};function x1(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function v1(n){return fr(n)?document.querySelector(n):n}var b1=!1;/*!
 * pinia v2.1.7
 * (c) 2023 Eduardo San Martin Morote
 * @license MIT
 */let ry;const Ch=n=>ry=n,ny=Symbol();function yp(n){return n&&typeof n=="object"&&Object.prototype.toString.call(n)==="[object Object]"&&typeof n.toJSON!="function"}var xc;(function(n){n.direct="direct",n.patchObject="patch object",n.patchFunction="patch function"})(xc||(xc={}));function w1(){const n=l_(!0),a=n.run(()=>io({}));let d=[],m=[];const v=yh({install(T){Ch(v),v._a=T,T.provide(ny,v),T.config.globalProperties.$pinia=v,m.forEach(x=>d.push(x)),m=[]},use(T){return!this._a&&!b1?m.push(T):d.push(T),this},_p:d,_a:null,_e:n,_s:new Map,state:a});return v}const sy=()=>{};function _g(n,a,d,m=sy){n.push(a);const v=()=>{const T=n.indexOf(a);T>-1&&(n.splice(T,1),m())};return!d&&c_()&&ov(v),v}function ja(n,...a){n.slice().forEach(d=>{d(...a)})}const S1=n=>n();function xp(n,a){n instanceof Map&&a instanceof Map&&a.forEach((d,m)=>n.set(m,d)),n instanceof Set&&a instanceof Set&&a.forEach(n.add,n);for(const d in a){if(!a.hasOwnProperty(d))continue;const m=a[d],v=n[d];yp(v)&&yp(m)&&n.hasOwnProperty(d)&&!ar(m)&&!Ts(m)?n[d]=xp(v,m):n[d]=m}return n}const T1=Symbol();function E1(n){return!yp(n)||!n.hasOwnProperty(T1)}const{assign:Xs}=Object;function I1(n){return!!(ar(n)&&n.effect)}function A1(n,a,d,m){const{state:v,actions:T,getters:x}=a,h=d.state.value[n];let R;function j(){h||(d.state.value[n]=v?v():{});const U=kv(d.state.value[n]);return Xs(U,T,Object.keys(x||{}).reduce((N,$)=>(N[$]=yh(dr(()=>{Ch(d);const ge=d._s.get(n);return x[$].call(ge,ge)})),N),{}))}return R=oy(n,j,a,d,m,!0),R}function oy(n,a,d={},m,v,T){let x;const h=Xs({actions:{}},d),R={deep:!0};let j,U,N=[],$=[],ge;const xe=m.state.value[n];!T&&!xe&&(m.state.value[n]={}),io({});let Ee;function Ke(tt){let ot;j=U=!1,typeof tt=="function"?(tt(m.state.value[n]),ot={type:xc.patchFunction,storeId:n,events:ge}):(xp(m.state.value[n],tt),ot={type:xc.patchObject,payload:tt,storeId:n,events:ge});const bt=Ee=Symbol();jp().then(()=>{Ee===bt&&(j=!0)}),U=!0,ja(N,ot,m.state.value[n])}const Ne=T?function(){const{state:ot}=d,bt=ot?ot():{};this.$patch(gt=>{Xs(gt,bt)})}:sy;function He(){x.stop(),N=[],$=[],m._s.delete(n)}function me(tt,ot){return function(){Ch(m);const bt=Array.from(arguments),gt=[],ei=[];function ri(Lt){gt.push(Lt)}function $t(Lt){ei.push(Lt)}ja($,{args:bt,name:tt,store:lt,after:ri,onError:$t});let Ki;try{Ki=ot.apply(this&&this.$id===n?this:lt,bt)}catch(Lt){throw ja(ei,Lt),Lt}return Ki instanceof Promise?Ki.then(Lt=>(ja(gt,Lt),Lt)).catch(Lt=>(ja(ei,Lt),Promise.reject(Lt))):(ja(gt,Ki),Ki)}}const We={_p:m,$id:n,$onAction:_g.bind(null,$),$patch:Ke,$reset:Ne,$subscribe(tt,ot={}){const bt=_g(N,tt,ot.detached,()=>gt()),gt=x.run(()=>mc(()=>m.state.value[n],ei=>{(ot.flush==="sync"?U:j)&&tt({storeId:n,type:xc.direct,events:ge},ei)},Xs({},R,ot)));return bt},$dispose:He},lt=kc(We);m._s.set(n,lt);const vt=(m._a&&m._a.runWithContext||S1)(()=>m._e.run(()=>(x=l_()).run(a)));for(const tt in vt){const ot=vt[tt];if(ar(ot)&&!I1(ot)||Ts(ot))T||(xe&&E1(ot)&&(ar(ot)?ot.value=xe[tt]:xp(ot,xe[tt])),m.state.value[n][tt]=ot);else if(typeof ot=="function"){const bt=me(tt,ot);vt[tt]=bt,h.actions[tt]=ot}}return Xs(lt,vt),Xs(ii(lt),vt),Object.defineProperty(lt,"$state",{get:()=>m.state.value[n],set:tt=>{Ke(ot=>{Xs(ot,tt)})}}),m._p.forEach(tt=>{Xs(lt,x.run(()=>tt({store:lt,app:m._a,pinia:m,options:h})))}),xe&&T&&d.hydrate&&d.hydrate(lt.$state,xe),j=!0,U=!0,lt}function oo(n,a,d){let m,v;const T=typeof a=="function";typeof n=="string"?(m=n,v=T?d:a):(v=n,m=n.id);function x(h,R){const j=yb();return h=h||(j?ln(ny,null):null),h&&Ch(h),h=ry,h._s.has(m)||(T?oy(m,a,v,h):A1(m,v,h)),h._s.get(m)}return x.$id=m,x}function P1(n){{n=ii(n);const a={};for(const d in n){const m=n[d];(ar(m)||Ts(m))&&(a[d]=Rv(n,d))}return a}}/*!
  * vue-router v4.3.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const Za=typeof document<"u";function C1(n){return n.__esModule||n[Symbol.toStringTag]==="Module"}const gi=Object.assign;function Jd(n,a){const d={};for(const m in a){const v=a[m];d[m]=Vn(v)?v.map(n):n(v)}return d}const vc=()=>{},Vn=Array.isArray,ay=/#/g,M1=/&/g,k1=/\//g,D1=/=/g,z1=/\?/g,ly=/\+/g,R1=/%5B/g,L1=/%5D/g,cy=/%5E/g,F1=/%60/g,uy=/%7B/g,O1=/%7C/g,hy=/%7D/g,B1=/%20/g;function Kp(n){return encodeURI(""+n).replace(O1,"|").replace(R1,"[").replace(L1,"]")}function N1(n){return Kp(n).replace(uy,"{").replace(hy,"}").replace(cy,"^")}function vp(n){return Kp(n).replace(ly,"%2B").replace(B1,"+").replace(ay,"%23").replace(M1,"%26").replace(F1,"`").replace(uy,"{").replace(hy,"}").replace(cy,"^")}function V1(n){return vp(n).replace(D1,"%3D")}function $1(n){return Kp(n).replace(ay,"%23").replace(z1,"%3F")}function U1(n){return n==null?"":$1(n).replace(k1,"%2F")}function Ac(n){try{return decodeURIComponent(""+n)}catch{}return""+n}const j1=/\/$/,q1=n=>n.replace(j1,"");function Qd(n,a,d="/"){let m,v={},T="",x="";const h=a.indexOf("#");let R=a.indexOf("?");return h<R&&h>=0&&(R=-1),R>-1&&(m=a.slice(0,R),T=a.slice(R+1,h>-1?h:a.length),v=n(T)),h>-1&&(m=m||a.slice(0,h),x=a.slice(h,a.length)),m=W1(m??a,d),{fullPath:m+(T&&"?")+T+x,path:m,query:v,hash:Ac(x)}}function G1(n,a){const d=a.query?n(a.query):"";return a.path+(d&&"?")+d+(a.hash||"")}function yg(n,a){return!a||!n.toLowerCase().startsWith(a.toLowerCase())?n:n.slice(a.length)||"/"}function H1(n,a,d){const m=a.matched.length-1,v=d.matched.length-1;return m>-1&&m===v&&il(a.matched[m],d.matched[v])&&dy(a.params,d.params)&&n(a.query)===n(d.query)&&a.hash===d.hash}function il(n,a){return(n.aliasOf||n)===(a.aliasOf||a)}function dy(n,a){if(Object.keys(n).length!==Object.keys(a).length)return!1;for(const d in n)if(!Z1(n[d],a[d]))return!1;return!0}function Z1(n,a){return Vn(n)?xg(n,a):Vn(a)?xg(a,n):n===a}function xg(n,a){return Vn(a)?n.length===a.length&&n.every((d,m)=>d===a[m]):n.length===1&&n[0]===a}function W1(n,a){if(n.startsWith("/"))return n;if(!n)return a;const d=a.split("/"),m=n.split("/"),v=m[m.length-1];(v===".."||v===".")&&m.push("");let T=d.length-1,x,h;for(x=0;x<m.length;x++)if(h=m[x],h!==".")if(h==="..")T>1&&T--;else break;return d.slice(0,T).join("/")+"/"+m.slice(x).join("/")}var Pc;(function(n){n.pop="pop",n.push="push"})(Pc||(Pc={}));var bc;(function(n){n.back="back",n.forward="forward",n.unknown=""})(bc||(bc={}));function K1(n){if(!n)if(Za){const a=document.querySelector("base");n=a&&a.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),q1(n)}const X1=/^[^#]+#/;function Y1(n,a){return n.replace(X1,"#")+a}function J1(n,a){const d=document.documentElement.getBoundingClientRect(),m=n.getBoundingClientRect();return{behavior:a.behavior,left:m.left-d.left-(a.left||0),top:m.top-d.top-(a.top||0)}}const Mh=()=>({left:window.scrollX,top:window.scrollY});function Q1(n){let a;if("el"in n){const d=n.el,m=typeof d=="string"&&d.startsWith("#"),v=typeof d=="string"?m?document.getElementById(d.slice(1)):document.querySelector(d):d;if(!v)return;a=J1(v,n)}else a=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(a):window.scrollTo(a.left!=null?a.left:window.scrollX,a.top!=null?a.top:window.scrollY)}function vg(n,a){return(history.state?history.state.position-a:-1)+n}const bp=new Map;function ew(n,a){bp.set(n,a)}function tw(n){const a=bp.get(n);return bp.delete(n),a}let iw=()=>location.protocol+"//"+location.host;function py(n,a){const{pathname:d,search:m,hash:v}=a,T=n.indexOf("#");if(T>-1){let h=v.includes(n.slice(T))?n.slice(T).length:1,R=v.slice(h);return R[0]!=="/"&&(R="/"+R),yg(R,"")}return yg(d,n)+m+v}function rw(n,a,d,m){let v=[],T=[],x=null;const h=({state:$})=>{const ge=py(n,location),xe=d.value,Ee=a.value;let Ke=0;if($){if(d.value=ge,a.value=$,x&&x===xe){x=null;return}Ke=Ee?$.position-Ee.position:0}else m(ge);v.forEach(Ne=>{Ne(d.value,xe,{delta:Ke,type:Pc.pop,direction:Ke?Ke>0?bc.forward:bc.back:bc.unknown})})};function R(){x=d.value}function j($){v.push($);const ge=()=>{const xe=v.indexOf($);xe>-1&&v.splice(xe,1)};return T.push(ge),ge}function U(){const{history:$}=window;$.state&&$.replaceState(gi({},$.state,{scroll:Mh()}),"")}function N(){for(const $ of T)$();T=[],window.removeEventListener("popstate",h),window.removeEventListener("beforeunload",U)}return window.addEventListener("popstate",h),window.addEventListener("beforeunload",U,{passive:!0}),{pauseListeners:R,listen:j,destroy:N}}function bg(n,a,d,m=!1,v=!1){return{back:n,current:a,forward:d,replaced:m,position:window.history.length,scroll:v?Mh():null}}function nw(n){const{history:a,location:d}=window,m={value:py(n,d)},v={value:a.state};v.value||T(m.value,{back:null,current:m.value,forward:null,position:a.length-1,replaced:!0,scroll:null},!0);function T(R,j,U){const N=n.indexOf("#"),$=N>-1?(d.host&&document.querySelector("base")?n:n.slice(N))+R:iw()+n+R;try{a[U?"replaceState":"pushState"](j,"",$),v.value=j}catch(ge){console.error(ge),d[U?"replace":"assign"]($)}}function x(R,j){const U=gi({},a.state,bg(v.value.back,R,v.value.forward,!0),j,{position:v.value.position});T(R,U,!0),m.value=R}function h(R,j){const U=gi({},v.value,a.state,{forward:R,scroll:Mh()});T(U.current,U,!0);const N=gi({},bg(m.value,R,null),{position:U.position+1},j);T(R,N,!1),m.value=R}return{location:m,state:v,push:h,replace:x}}function sw(n){n=K1(n);const a=nw(n),d=rw(n,a.state,a.location,a.replace);function m(T,x=!0){x||d.pauseListeners(),history.go(T)}const v=gi({location:"",base:n,go:m,createHref:Y1.bind(null,n)},a,d);return Object.defineProperty(v,"location",{enumerable:!0,get:()=>a.location.value}),Object.defineProperty(v,"state",{enumerable:!0,get:()=>a.state.value}),v}function ow(n){return n=location.host?n||location.pathname+location.search:"",n.includes("#")||(n+="#"),sw(n)}function aw(n){return typeof n=="string"||n&&typeof n=="object"}function fy(n){return typeof n=="string"||typeof n=="symbol"}const Zs={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},my=Symbol("");var wg;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(wg||(wg={}));function rl(n,a){return gi(new Error,{type:n,[my]:!0},a)}function bs(n,a){return n instanceof Error&&my in n&&(a==null||!!(n.type&a))}const Sg="[^/]+?",lw={sensitive:!1,strict:!1,start:!0,end:!0},cw=/[.+*?^${}()[\]/\\]/g;function uw(n,a){const d=gi({},lw,a),m=[];let v=d.start?"^":"";const T=[];for(const j of n){const U=j.length?[]:[90];d.strict&&!j.length&&(v+="/");for(let N=0;N<j.length;N++){const $=j[N];let ge=40+(d.sensitive?.25:0);if($.type===0)N||(v+="/"),v+=$.value.replace(cw,"\\$&"),ge+=40;else if($.type===1){const{value:xe,repeatable:Ee,optional:Ke,regexp:Ne}=$;T.push({name:xe,repeatable:Ee,optional:Ke});const He=Ne||Sg;if(He!==Sg){ge+=10;try{new RegExp(`(${He})`)}catch(We){throw new Error(`Invalid custom RegExp for param "${xe}" (${He}): `+We.message)}}let me=Ee?`((?:${He})(?:/(?:${He}))*)`:`(${He})`;N||(me=Ke&&j.length<2?`(?:/${me})`:"/"+me),Ke&&(me+="?"),v+=me,ge+=20,Ke&&(ge+=-8),Ee&&(ge+=-20),He===".*"&&(ge+=-50)}U.push(ge)}m.push(U)}if(d.strict&&d.end){const j=m.length-1;m[j][m[j].length-1]+=.7000000000000001}d.strict||(v+="/?"),d.end?v+="$":d.strict&&(v+="(?:/|$)");const x=new RegExp(v,d.sensitive?"":"i");function h(j){const U=j.match(x),N={};if(!U)return null;for(let $=1;$<U.length;$++){const ge=U[$]||"",xe=T[$-1];N[xe.name]=ge&&xe.repeatable?ge.split("/"):ge}return N}function R(j){let U="",N=!1;for(const $ of n){(!N||!U.endsWith("/"))&&(U+="/"),N=!1;for(const ge of $)if(ge.type===0)U+=ge.value;else if(ge.type===1){const{value:xe,repeatable:Ee,optional:Ke}=ge,Ne=xe in j?j[xe]:"";if(Vn(Ne)&&!Ee)throw new Error(`Provided param "${xe}" is an array but it is not repeatable (* or + modifiers)`);const He=Vn(Ne)?Ne.join("/"):Ne;if(!He)if(Ke)$.length<2&&(U.endsWith("/")?U=U.slice(0,-1):N=!0);else throw new Error(`Missing required param "${xe}"`);U+=He}}return U||"/"}return{re:x,score:m,keys:T,parse:h,stringify:R}}function hw(n,a){let d=0;for(;d<n.length&&d<a.length;){const m=a[d]-n[d];if(m)return m;d++}return n.length<a.length?n.length===1&&n[0]===80?-1:1:n.length>a.length?a.length===1&&a[0]===80?1:-1:0}function dw(n,a){let d=0;const m=n.score,v=a.score;for(;d<m.length&&d<v.length;){const T=hw(m[d],v[d]);if(T)return T;d++}if(Math.abs(v.length-m.length)===1){if(Tg(m))return 1;if(Tg(v))return-1}return v.length-m.length}function Tg(n){const a=n[n.length-1];return n.length>0&&a[a.length-1]<0}const pw={type:0,value:""},fw=/[a-zA-Z0-9_]/;function mw(n){if(!n)return[[]];if(n==="/")return[[pw]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function a(ge){throw new Error(`ERR (${d})/"${j}": ${ge}`)}let d=0,m=d;const v=[];let T;function x(){T&&v.push(T),T=[]}let h=0,R,j="",U="";function N(){j&&(d===0?T.push({type:0,value:j}):d===1||d===2||d===3?(T.length>1&&(R==="*"||R==="+")&&a(`A repeatable param (${j}) must be alone in its segment. eg: '/:ids+.`),T.push({type:1,value:j,regexp:U,repeatable:R==="*"||R==="+",optional:R==="*"||R==="?"})):a("Invalid state to consume buffer"),j="")}function $(){j+=R}for(;h<n.length;){if(R=n[h++],R==="\\"&&d!==2){m=d,d=4;continue}switch(d){case 0:R==="/"?(j&&N(),x()):R===":"?(N(),d=1):$();break;case 4:$(),d=m;break;case 1:R==="("?d=2:fw.test(R)?$():(N(),d=0,R!=="*"&&R!=="?"&&R!=="+"&&h--);break;case 2:R===")"?U[U.length-1]=="\\"?U=U.slice(0,-1)+R:d=3:U+=R;break;case 3:N(),d=0,R!=="*"&&R!=="?"&&R!=="+"&&h--,U="";break;default:a("Unknown state");break}}return d===2&&a(`Unfinished custom RegExp for param "${j}"`),N(),x(),v}function gw(n,a,d){const m=uw(mw(n.path),d),v=gi(m,{record:n,parent:a,children:[],alias:[]});return a&&!v.record.aliasOf==!a.record.aliasOf&&a.children.push(v),v}function _w(n,a){const d=[],m=new Map;a=Ag({strict:!1,end:!0,sensitive:!1},a);function v(U){return m.get(U)}function T(U,N,$){const ge=!$,xe=yw(U);xe.aliasOf=$&&$.record;const Ee=Ag(a,U),Ke=[xe];if("alias"in U){const me=typeof U.alias=="string"?[U.alias]:U.alias;for(const We of me)Ke.push(gi({},xe,{components:$?$.record.components:xe.components,path:We,aliasOf:$?$.record:xe}))}let Ne,He;for(const me of Ke){const{path:We}=me;if(N&&We[0]!=="/"){const lt=N.record.path,ct=lt[lt.length-1]==="/"?"":"/";me.path=N.record.path+(We&&ct+We)}if(Ne=gw(me,N,Ee),$?$.alias.push(Ne):(He=He||Ne,He!==Ne&&He.alias.push(Ne),ge&&U.name&&!Ig(Ne)&&x(U.name)),xe.children){const lt=xe.children;for(let ct=0;ct<lt.length;ct++)T(lt[ct],Ne,$&&$.children[ct])}$=$||Ne,(Ne.record.components&&Object.keys(Ne.record.components).length||Ne.record.name||Ne.record.redirect)&&R(Ne)}return He?()=>{x(He)}:vc}function x(U){if(fy(U)){const N=m.get(U);N&&(m.delete(U),d.splice(d.indexOf(N),1),N.children.forEach(x),N.alias.forEach(x))}else{const N=d.indexOf(U);N>-1&&(d.splice(N,1),U.record.name&&m.delete(U.record.name),U.children.forEach(x),U.alias.forEach(x))}}function h(){return d}function R(U){let N=0;for(;N<d.length&&dw(U,d[N])>=0&&(U.record.path!==d[N].record.path||!gy(U,d[N]));)N++;d.splice(N,0,U),U.record.name&&!Ig(U)&&m.set(U.record.name,U)}function j(U,N){let $,ge={},xe,Ee;if("name"in U&&U.name){if($=m.get(U.name),!$)throw rl(1,{location:U});Ee=$.record.name,ge=gi(Eg(N.params,$.keys.filter(He=>!He.optional).concat($.parent?$.parent.keys.filter(He=>He.optional):[]).map(He=>He.name)),U.params&&Eg(U.params,$.keys.map(He=>He.name))),xe=$.stringify(ge)}else if(U.path!=null)xe=U.path,$=d.find(He=>He.re.test(xe)),$&&(ge=$.parse(xe),Ee=$.record.name);else{if($=N.name?m.get(N.name):d.find(He=>He.re.test(N.path)),!$)throw rl(1,{location:U,currentLocation:N});Ee=$.record.name,ge=gi({},N.params,U.params),xe=$.stringify(ge)}const Ke=[];let Ne=$;for(;Ne;)Ke.unshift(Ne.record),Ne=Ne.parent;return{name:Ee,path:xe,params:ge,matched:Ke,meta:vw(Ke)}}return n.forEach(U=>T(U)),{addRoute:T,resolve:j,removeRoute:x,getRoutes:h,getRecordMatcher:v}}function Eg(n,a){const d={};for(const m of a)m in n&&(d[m]=n[m]);return d}function yw(n){return{path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:void 0,beforeEnter:n.beforeEnter,props:xw(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}}}function xw(n){const a={},d=n.props||!1;if("component"in n)a.default=d;else for(const m in n.components)a[m]=typeof d=="object"?d[m]:d;return a}function Ig(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function vw(n){return n.reduce((a,d)=>gi(a,d.meta),{})}function Ag(n,a){const d={};for(const m in n)d[m]=m in a?a[m]:n[m];return d}function gy(n,a){return a.children.some(d=>d===n||gy(n,d))}function bw(n){const a={};if(n===""||n==="?")return a;const m=(n[0]==="?"?n.slice(1):n).split("&");for(let v=0;v<m.length;++v){const T=m[v].replace(ly," "),x=T.indexOf("="),h=Ac(x<0?T:T.slice(0,x)),R=x<0?null:Ac(T.slice(x+1));if(h in a){let j=a[h];Vn(j)||(j=a[h]=[j]),j.push(R)}else a[h]=R}return a}function Pg(n){let a="";for(let d in n){const m=n[d];if(d=V1(d),m==null){m!==void 0&&(a+=(a.length?"&":"")+d);continue}(Vn(m)?m.map(T=>T&&vp(T)):[m&&vp(m)]).forEach(T=>{T!==void 0&&(a+=(a.length?"&":"")+d,T!=null&&(a+="="+T))})}return a}function ww(n){const a={};for(const d in n){const m=n[d];m!==void 0&&(a[d]=Vn(m)?m.map(v=>v==null?null:""+v):m==null?m:""+m)}return a}const Sw=Symbol(""),Cg=Symbol(""),kh=Symbol(""),Xp=Symbol(""),wp=Symbol("");function lc(){let n=[];function a(m){return n.push(m),()=>{const v=n.indexOf(m);v>-1&&n.splice(v,1)}}function d(){n=[]}return{add:a,list:()=>n.slice(),reset:d}}function eo(n,a,d,m,v,T=x=>x()){const x=m&&(m.enterCallbacks[v]=m.enterCallbacks[v]||[]);return()=>new Promise((h,R)=>{const j=$=>{$===!1?R(rl(4,{from:d,to:a})):$ instanceof Error?R($):aw($)?R(rl(2,{from:a,to:$})):(x&&m.enterCallbacks[v]===x&&typeof $=="function"&&x.push($),h())},U=T(()=>n.call(m&&m.instances[v],a,d,j));let N=Promise.resolve(U);n.length<3&&(N=N.then(j)),N.catch($=>R($))})}function ep(n,a,d,m,v=T=>T()){const T=[];for(const x of n)for(const h in x.components){let R=x.components[h];if(!(a!=="beforeRouteEnter"&&!x.instances[h]))if(Tw(R)){const U=(R.__vccOpts||R)[a];U&&T.push(eo(U,d,m,x,h,v))}else{let j=R();T.push(()=>j.then(U=>{if(!U)return Promise.reject(new Error(`Couldn't resolve component "${h}" at "${x.path}"`));const N=C1(U)?U.default:U;x.components[h]=N;const ge=(N.__vccOpts||N)[a];return ge&&eo(ge,d,m,x,h,v)()}))}}return T}function Tw(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function Mg(n){const a=ln(kh),d=ln(Xp),m=dr(()=>a.resolve(Qt(n.to))),v=dr(()=>{const{matched:R}=m.value,{length:j}=R,U=R[j-1],N=d.matched;if(!U||!N.length)return-1;const $=N.findIndex(il.bind(null,U));if($>-1)return $;const ge=kg(R[j-2]);return j>1&&kg(U)===ge&&N[N.length-1].path!==ge?N.findIndex(il.bind(null,R[j-2])):$}),T=dr(()=>v.value>-1&&Pw(d.params,m.value.params)),x=dr(()=>v.value>-1&&v.value===d.matched.length-1&&dy(d.params,m.value.params));function h(R={}){return Aw(R)?a[Qt(n.replace)?"replace":"push"](Qt(n.to)).catch(vc):Promise.resolve()}return{route:m,href:dr(()=>m.value.href),isActive:T,isExactActive:x,navigate:h}}const Ew=O_({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:Mg,setup(n,{slots:a}){const d=kc(Mg(n)),{options:m}=ln(kh),v=dr(()=>({[Dg(n.activeClass,m.linkActiveClass,"router-link-active")]:d.isActive,[Dg(n.exactActiveClass,m.linkExactActiveClass,"router-link-exact-active")]:d.isExactActive}));return()=>{const T=a.default&&a.default(d);return n.custom?T:iy("a",{"aria-current":d.isExactActive?n.ariaCurrentValue:null,href:d.href,onClick:d.navigate,class:v.value},T)}}}),Iw=Ew;function Aw(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const a=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(a))return}return n.preventDefault&&n.preventDefault(),!0}}function Pw(n,a){for(const d in a){const m=a[d],v=n[d];if(typeof m=="string"){if(m!==v)return!1}else if(!Vn(v)||v.length!==m.length||m.some((T,x)=>T!==v[x]))return!1}return!0}function kg(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const Dg=(n,a,d)=>n??a??d,Cw=O_({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:a,slots:d}){const m=ln(wp),v=dr(()=>n.route||m.value),T=ln(Cg,0),x=dr(()=>{let j=Qt(T);const{matched:U}=v.value;let N;for(;(N=U[j])&&!N.components;)j++;return j}),h=dr(()=>v.value.matched[x.value]);Qa(Cg,dr(()=>x.value+1)),Qa(Sw,h),Qa(wp,v);const R=io();return mc(()=>[R.value,h.value,n.name],([j,U,N],[$,ge,xe])=>{U&&(U.instances[N]=j,ge&&ge!==U&&j&&j===$&&(U.leaveGuards.size||(U.leaveGuards=ge.leaveGuards),U.updateGuards.size||(U.updateGuards=ge.updateGuards))),j&&U&&(!ge||!il(U,ge)||!$)&&(U.enterCallbacks[N]||[]).forEach(Ee=>Ee(j))},{flush:"post"}),()=>{const j=v.value,U=n.name,N=h.value,$=N&&N.components[U];if(!$)return zg(d.default,{Component:$,route:j});const ge=N.props[U],xe=ge?ge===!0?j.params:typeof ge=="function"?ge(j):ge:null,Ke=iy($,gi({},xe,a,{onVnodeUnmounted:Ne=>{Ne.component.isUnmounted&&(N.instances[U]=null)},ref:R}));return zg(d.default,{Component:Ke,route:j})||Ke}}});function zg(n,a){if(!n)return null;const d=n(a);return d.length===1?d[0]:d}const _y=Cw;function Mw(n){const a=_w(n.routes,n),d=n.parseQuery||bw,m=n.stringifyQuery||Pg,v=n.history,T=lc(),x=lc(),h=lc(),R=Pv(Zs);let j=Zs;Za&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const U=Jd.bind(null,Pe=>""+Pe),N=Jd.bind(null,U1),$=Jd.bind(null,Ac);function ge(Pe,it){let Qe,ht;return fy(Pe)?(Qe=a.getRecordMatcher(Pe),ht=it):ht=Pe,a.addRoute(ht,Qe)}function xe(Pe){const it=a.getRecordMatcher(Pe);it&&a.removeRoute(it)}function Ee(){return a.getRoutes().map(Pe=>Pe.record)}function Ke(Pe){return!!a.getRecordMatcher(Pe)}function Ne(Pe,it){if(it=gi({},it||R.value),typeof Pe=="string"){const ie=Qd(d,Pe,it.path),ye=a.resolve({path:ie.path},it),De=v.createHref(ie.fullPath);return gi(ie,ye,{params:$(ye.params),hash:Ac(ie.hash),redirectedFrom:void 0,href:De})}let Qe;if(Pe.path!=null)Qe=gi({},Pe,{path:Qd(d,Pe.path,it.path).path});else{const ie=gi({},Pe.params);for(const ye in ie)ie[ye]==null&&delete ie[ye];Qe=gi({},Pe,{params:N(ie)}),it.params=N(it.params)}const ht=a.resolve(Qe,it),Kt=Pe.hash||"";ht.params=U($(ht.params));const Yt=G1(m,gi({},Pe,{hash:N1(Kt),path:ht.path})),J=v.createHref(Yt);return gi({fullPath:Yt,hash:Kt,query:m===Pg?ww(Pe.query):Pe.query||{}},ht,{redirectedFrom:void 0,href:J})}function He(Pe){return typeof Pe=="string"?Qd(d,Pe,R.value.path):gi({},Pe)}function me(Pe,it){if(j!==Pe)return rl(8,{from:it,to:Pe})}function We(Pe){return vt(Pe)}function lt(Pe){return We(gi(He(Pe),{replace:!0}))}function ct(Pe){const it=Pe.matched[Pe.matched.length-1];if(it&&it.redirect){const{redirect:Qe}=it;let ht=typeof Qe=="function"?Qe(Pe):Qe;return typeof ht=="string"&&(ht=ht.includes("?")||ht.includes("#")?ht=He(ht):{path:ht},ht.params={}),gi({query:Pe.query,hash:Pe.hash,params:ht.path!=null?{}:Pe.params},ht)}}function vt(Pe,it){const Qe=j=Ne(Pe),ht=R.value,Kt=Pe.state,Yt=Pe.force,J=Pe.replace===!0,ie=ct(Qe);if(ie)return vt(gi(He(ie),{state:typeof ie=="object"?gi({},Kt,ie.state):Kt,force:Yt,replace:J}),it||Qe);const ye=Qe;ye.redirectedFrom=it;let De;return!Yt&&H1(m,ht,Qe)&&(De=rl(16,{to:ye,from:ht}),vi(ht,ht,!0,!1)),(De?Promise.resolve(De):bt(ye,ht)).catch(ee=>bs(ee)?bs(ee,2)?ee:vr(ee):Ht(ee,ye,ht)).then(ee=>{if(ee){if(bs(ee,2))return vt(gi({replace:J},He(ee.to),{state:typeof ee.to=="object"?gi({},Kt,ee.to.state):Kt,force:Yt}),it||ye)}else ee=ei(ye,ht,!0,J,Kt);return gt(ye,ht,ee),ee})}function tt(Pe,it){const Qe=me(Pe,it);return Qe?Promise.reject(Qe):Promise.resolve()}function ot(Pe){const it=Qr.values().next().value;return it&&typeof it.runWithContext=="function"?it.runWithContext(Pe):Pe()}function bt(Pe,it){let Qe;const[ht,Kt,Yt]=kw(Pe,it);Qe=ep(ht.reverse(),"beforeRouteLeave",Pe,it);for(const ie of ht)ie.leaveGuards.forEach(ye=>{Qe.push(eo(ye,Pe,it))});const J=tt.bind(null,Pe,it);return Qe.push(J),bi(Qe).then(()=>{Qe=[];for(const ie of T.list())Qe.push(eo(ie,Pe,it));return Qe.push(J),bi(Qe)}).then(()=>{Qe=ep(Kt,"beforeRouteUpdate",Pe,it);for(const ie of Kt)ie.updateGuards.forEach(ye=>{Qe.push(eo(ye,Pe,it))});return Qe.push(J),bi(Qe)}).then(()=>{Qe=[];for(const ie of Yt)if(ie.beforeEnter)if(Vn(ie.beforeEnter))for(const ye of ie.beforeEnter)Qe.push(eo(ye,Pe,it));else Qe.push(eo(ie.beforeEnter,Pe,it));return Qe.push(J),bi(Qe)}).then(()=>(Pe.matched.forEach(ie=>ie.enterCallbacks={}),Qe=ep(Yt,"beforeRouteEnter",Pe,it,ot),Qe.push(J),bi(Qe))).then(()=>{Qe=[];for(const ie of x.list())Qe.push(eo(ie,Pe,it));return Qe.push(J),bi(Qe)}).catch(ie=>bs(ie,8)?ie:Promise.reject(ie))}function gt(Pe,it,Qe){h.list().forEach(ht=>ot(()=>ht(Pe,it,Qe)))}function ei(Pe,it,Qe,ht,Kt){const Yt=me(Pe,it);if(Yt)return Yt;const J=it===Zs,ie=Za?history.state:{};Qe&&(ht||J?v.replace(Pe.fullPath,gi({scroll:J&&ie&&ie.scroll},Kt)):v.push(Pe.fullPath,Kt)),R.value=Pe,vi(Pe,it,Qe,J),vr()}let ri;function $t(){ri||(ri=v.listen((Pe,it,Qe)=>{if(!mr.listening)return;const ht=Ne(Pe),Kt=ct(ht);if(Kt){vt(gi(Kt,{replace:!0}),ht).catch(vc);return}j=ht;const Yt=R.value;Za&&ew(vg(Yt.fullPath,Qe.delta),Mh()),bt(ht,Yt).catch(J=>bs(J,12)?J:bs(J,2)?(vt(J.to,ht).then(ie=>{bs(ie,20)&&!Qe.delta&&Qe.type===Pc.pop&&v.go(-1,!1)}).catch(vc),Promise.reject()):(Qe.delta&&v.go(-Qe.delta,!1),Ht(J,ht,Yt))).then(J=>{J=J||ei(ht,Yt,!1),J&&(Qe.delta&&!bs(J,8)?v.go(-Qe.delta,!1):Qe.type===Pc.pop&&bs(J,20)&&v.go(-1,!1)),gt(ht,Yt,J)}).catch(vc)}))}let Ki=lc(),Lt=lc(),Ft;function Ht(Pe,it,Qe){vr(Pe);const ht=Lt.list();return ht.length?ht.forEach(Kt=>Kt(Pe,it,Qe)):console.error(Pe),Promise.reject(Pe)}function cr(){return Ft&&R.value!==Zs?Promise.resolve():new Promise((Pe,it)=>{Ki.add([Pe,it])})}function vr(Pe){return Ft||(Ft=!Pe,$t(),Ki.list().forEach(([it,Qe])=>Pe?Qe(Pe):it()),Ki.reset()),Pe}function vi(Pe,it,Qe,ht){const{scrollBehavior:Kt}=n;if(!Za||!Kt)return Promise.resolve();const Yt=!Qe&&tw(vg(Pe.fullPath,0))||(ht||!Qe)&&history.state&&history.state.scroll||null;return jp().then(()=>Kt(Pe,it,Yt)).then(J=>J&&Q1(J)).catch(J=>Ht(J,Pe,it))}const ni=Pe=>v.go(Pe);let ur;const Qr=new Set,mr={currentRoute:R,listening:!0,addRoute:ge,removeRoute:xe,hasRoute:Ke,getRoutes:Ee,resolve:Ne,options:n,push:We,replace:lt,go:ni,back:()=>ni(-1),forward:()=>ni(1),beforeEach:T.add,beforeResolve:x.add,afterEach:h.add,onError:Lt.add,isReady:cr,install(Pe){const it=this;Pe.component("RouterLink",Iw),Pe.component("RouterView",_y),Pe.config.globalProperties.$router=it,Object.defineProperty(Pe.config.globalProperties,"$route",{enumerable:!0,get:()=>Qt(R)}),Za&&!ur&&R.value===Zs&&(ur=!0,We(v.location).catch(Kt=>{}));const Qe={};for(const Kt in Zs)Object.defineProperty(Qe,Kt,{get:()=>R.value[Kt],enumerable:!0});Pe.provide(kh,it),Pe.provide(Xp,b_(Qe)),Pe.provide(wp,R);const ht=Pe.unmount;Qr.add(Pe),Pe.unmount=function(){Qr.delete(Pe),Qr.size<1&&(j=Zs,ri&&ri(),ri=null,R.value=Zs,ur=!1,Ft=!1),ht()}}};function bi(Pe){return Pe.reduce((it,Qe)=>it.then(()=>ot(Qe)),Promise.resolve())}return mr}function kw(n,a){const d=[],m=[],v=[],T=Math.max(a.matched.length,n.matched.length);for(let x=0;x<T;x++){const h=a.matched[x];h&&(n.matched.find(j=>il(j,h))?m.push(h):d.push(h));const R=n.matched[x];R&&(a.matched.find(j=>il(j,R))||v.push(R))}return[d,m,v]}function yy(){return ln(kh)}function Yp(){return ln(Xp)}const Dw={__name:"App",setup(n){return(a,d)=>(Xt(),ws(Qt(_y)))}},zw="modulepreload",Rw=function(n){return"/vue3-atlas2/"+n},Rg={},Lw=function(a,d,m){let v=Promise.resolve();if(d&&d.length>0){const T=document.getElementsByTagName("link"),x=document.querySelector("meta[property=csp-nonce]"),h=(x==null?void 0:x.nonce)||(x==null?void 0:x.getAttribute("nonce"));v=Promise.all(d.map(R=>{if(R=Rw(R),R in Rg)return;Rg[R]=!0;const j=R.endsWith(".css"),U=j?'[rel="stylesheet"]':"";if(!!m)for(let ge=T.length-1;ge>=0;ge--){const xe=T[ge];if(xe.href===R&&(!j||xe.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${R}"]${U}`))return;const $=document.createElement("link");if($.rel=j?"stylesheet":zw,j||($.as="script",$.crossOrigin=""),$.href=R,h&&$.setAttribute("nonce",h),document.head.appendChild($),j)return new Promise((ge,xe)=>{$.addEventListener("load",ge),$.addEventListener("error",()=>xe(new Error(`Unable to preload CSS for ${R}`)))})}))}return v.then(()=>a()).catch(T=>{const x=new Event("vite:preloadError",{cancelable:!0});if(x.payload=T,window.dispatchEvent(x),!x.defaultPrevented)throw T})};var Fw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function xy(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var vy={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.3/LICENSE.txt
 */(function(n,a){(function(d,m){n.exports=m()})(Fw,function(){var d={},m={};function v(x,h,R){if(m[x]=R,x==="index"){var j="var sharedModule = {}; ("+m.shared+")(sharedModule); ("+m.worker+")(sharedModule);",U={};return m.shared(U),m.index(d,U),typeof window<"u"&&d.setWorkerUrl(window.URL.createObjectURL(new Blob([j],{type:"text/javascript"}))),d}}v("shared",["exports"],function(x){function h(i,e,r,o){return new(r||(r=Promise))(function(u,g){function _(I){try{S(o.next(I))}catch(P){g(P)}}function y(I){try{S(o.throw(I))}catch(P){g(P)}}function S(I){var P;I.done?u(I.value):(P=I.value,P instanceof r?P:new r(function(C){C(P)})).then(_,y)}S((o=o.apply(i,e||[])).next())})}function R(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var j=U;function U(i,e){this.x=i,this.y=e}U.prototype={clone:function(){return new U(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),o=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=o,this},_rotateAround:function(i,e){var r=Math.cos(i),o=Math.sin(i),u=e.y+o*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-o*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},U.convert=function(i){return i instanceof U?i:Array.isArray(i)?new U(i[0],i[1]):i};var N=R(j),$=ge;function ge(i,e,r,o){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=o}ge.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,o=0;o<8;o++){var u=this.sampleCurveX(r)-i;if(Math.abs(u)<e)return r;var g=this.sampleCurveDerivativeX(r);if(Math.abs(g)<1e-6)break;r-=u/g}var _=0,y=1;for(r=i,o=0;o<20&&(u=this.sampleCurveX(r),!(Math.abs(u-i)<e));o++)i>u?_=r:y=r,r=.5*(y-_)+_;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var xe=R($);let Ee,Ke;function Ne(){return Ee==null&&(Ee=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ee}function He(){if(Ke==null&&(Ke=!1,Ne())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let o=0;o<5*5;o++){const u=4*o;e.fillStyle=`rgb(${u},${u+1},${u+2})`,e.fillRect(o%5,Math.floor(o/5),1,1)}const r=e.getImageData(0,0,5,5).data;for(let o=0;o<5*5*4;o++)if(o%4!=3&&r[o]!==o){Ke=!0;break}}}return Ke||!1}function me(i,e,r,o){const u=new xe(i,e,r,o);return function(g){return u.solve(g)}}const We=me(.25,.1,.25,1);function lt(i,e,r){return Math.min(r,Math.max(e,i))}function ct(i,e,r){const o=r-e,u=((i-e)%o+o)%o+e;return u===e?r:u}function vt(i,...e){for(const r of e)for(const o in r)i[o]=r[o];return i}let tt=1;function ot(i,e,r){const o={};for(const u in i)o[u]=e.call(r||this,i[u],u,i);return o}function bt(i,e,r){const o={};for(const u in i)e.call(r||this,i[u],u,i)&&(o[u]=i[u]);return o}function gt(i){return Array.isArray(i)?i.map(gt):typeof i=="object"&&i?ot(i,gt):i}const ei={};function ri(i){ei[i]||(typeof console<"u"&&console.warn(i),ei[i]=!0)}function $t(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function Ki(i){let e=0;for(let r,o,u=0,g=i.length,_=g-1;u<g;_=u++)r=i[u],o=i[_],e+=(o.x-r.x)*(r.y+o.y);return e}function Lt(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let Ft=null;function Ht(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const cr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function vr(i,e,r,o,u){return h(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const g=new VideoFrame(i,{timestamp:0});try{const _=g==null?void 0:g.format;if(!_||!_.startsWith("BGR")&&!_.startsWith("RGB"))throw new Error(`Unrecognized format ${_}`);const y=_.startsWith("BGR"),S=new Uint8ClampedArray(o*u*4);if(yield g.copyTo(S,function(I,P,C,z,F){const B=4*Math.max(-P,0),G=(Math.max(0,C)-C)*z*4+B,K=4*z,te=Math.max(0,P),he=Math.max(0,C);return{rect:{x:te,y:he,width:Math.min(I.width,P+z)-te,height:Math.min(I.height,C+F)-he},layout:[{offset:G,stride:K}]}}(i,e,r,o,u)),y)for(let I=0;I<S.length;I+=4){const P=S[I];S[I]=S[I+2],S[I+2]=P}return S}finally{g.close()}})}let vi,ni;const ur="AbortError";function Qr(){return new Error(ur)}const mr={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function bi(i){return mr.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const Pe="global-dispatcher";class it extends Error{constructor(e,r,o,u){super(`AJAXError: ${r} (${e}): ${o}`),this.status=e,this.statusText=r,this.url=o,this.body=u}}const Qe=()=>Lt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,ht=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const o=bi(i.url);if(o)return o(i,e);if(Lt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:Pe},e)}if(!(/^file:/.test(r=i.url)||/^file:/.test(Qe())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(o,u){return h(this,void 0,void 0,function*(){const g=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:Qe(),signal:u.signal});o.type==="json"&&g.headers.set("Accept","application/json");const _=yield fetch(g);if(!_.ok){const I=yield _.blob();throw new it(_.status,_.statusText,o.url,I)}let y;y=o.type==="arrayBuffer"||o.type==="image"?_.arrayBuffer():o.type==="json"?_.json():_.text();const S=yield y;if(u.signal.aborted)throw Qr();return{data:S,cacheControl:_.headers.get("Cache-Control"),expires:_.headers.get("Expires")}})}(i,e);if(Lt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:Pe},e)}var r;return function(o,u){return new Promise((g,_)=>{const y=new XMLHttpRequest;y.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(y.responseType="arraybuffer");for(const S in o.headers)y.setRequestHeader(S,o.headers[S]);o.type==="json"&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials=o.credentials==="include",y.onerror=()=>{_(new Error(y.statusText))},y.onload=()=>{if(!u.signal.aborted)if((y.status>=200&&y.status<300||y.status===0)&&y.response!==null){let S=y.response;if(o.type==="json")try{S=JSON.parse(y.response)}catch(I){return void _(I)}g({data:S,cacheControl:y.getResponseHeader("Cache-Control"),expires:y.getResponseHeader("Expires")})}else{const S=new Blob([y.response],{type:y.getResponseHeader("Content-Type")});_(new it(y.status,y.statusText,o.url,S))}},u.signal.addEventListener("abort",()=>{y.abort(),_(Qr())}),y.send(o.body)})}(i,e)};function Kt(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),r=window.location;return e.protocol===r.protocol&&e.host===r.host}function Yt(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function J(i,e,r){if(r&&r[i]){const o=r[i].indexOf(e);o!==-1&&r[i].splice(o,1)}}class ie{constructor(e,r={}){vt(this,r),this.type=e}}class ye extends ie{constructor(e,r={}){super("error",vt({error:e},r))}}class De{on(e,r){return this._listeners=this._listeners||{},Yt(e,r,this._listeners),this}off(e,r){return J(e,r,this._listeners),J(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Yt(e,r,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,r){typeof e=="string"&&(e=new ie(e,r||{}));const o=e.type;if(this.listens(o)){e.target=this;const u=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const y of u)y.call(this,e);const g=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const y of g)J(o,y,this._oneTimeListeners),y.call(this,e);const _=this._eventedParent;_&&(vt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(e))}else e instanceof ye&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var ee={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const je=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function et(i,e){const r={};for(const o in i)o!=="ref"&&(r[o]=i[o]);return je.forEach(o=>{o in e&&(r[o]=e[o])}),r}function Ie(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(!Ie(i[r],e[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const r in i)if(!Ie(i[r],e[r]))return!1;return!0}return i===e}function Oe(i,e){i.push(e)}function Fe(i,e,r){Oe(r,{command:"addSource",args:[i,e[i]]})}function st(i,e,r){Oe(e,{command:"removeSource",args:[i]}),r[i]=!0}function wt(i,e,r,o){st(i,r,o),Fe(i,e,r)}function ft(i,e,r){let o;for(o in i[r])if(Object.prototype.hasOwnProperty.call(i[r],o)&&o!=="data"&&!Ie(i[r][o],e[r][o]))return!1;for(o in e[r])if(Object.prototype.hasOwnProperty.call(e[r],o)&&o!=="data"&&!Ie(i[r][o],e[r][o]))return!1;return!0}function Tt(i,e,r,o,u,g){i=i||{},e=e||{};for(const _ in i)Object.prototype.hasOwnProperty.call(i,_)&&(Ie(i[_],e[_])||r.push({command:g,args:[o,_,e[_],u]}));for(const _ in e)Object.prototype.hasOwnProperty.call(e,_)&&!Object.prototype.hasOwnProperty.call(i,_)&&(Ie(i[_],e[_])||r.push({command:g,args:[o,_,e[_],u]}))}function Nt(i){return i.id}function Zt(i,e){return i[e.id]=e,i}class Ce{constructor(e,r,o,u){this.message=(e?`${e}: `:"")+o,u&&(this.identifier=u),r!=null&&r.__line__&&(this.line=r.__line__)}}function ui(i,...e){for(const r of e)for(const o in r)i[o]=r[o];return i}class wi extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class en{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[o,u]of r)this.bindings[o]=u}concat(e){return new en(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Xi={kind:"null"},Ve={kind:"number"},At={kind:"string"},_t={kind:"boolean"},si={kind:"color"},$r={kind:"object"},Pt={kind:"value"},os={kind:"collator"},Yi={kind:"formatted"},X={kind:"padding"},D={kind:"resolvedImage"},L={kind:"variableAnchorOffsetCollection"};function V(i,e){return{kind:"array",itemType:i,N:e}}function H(i){if(i.kind==="array"){const e=H(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const oe=[Xi,Ve,At,_t,si,Yi,$r,V(Pt),X,D,L];function ae(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ae(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of oe)if(!ae(r,e))return null}}return`Expected ${H(i)} but found ${H(e)} instead.`}function ue(i,e){return e.some(r=>r.kind===i.kind)}function ne(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function de(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const Me=.96422,we=.82521,Se=4/29,pt=6/29,yt=3*pt*pt,Ct=pt*pt*pt,It=Math.PI/180,jt=180/Math.PI;function hi(i){return(i%=360)<0&&(i+=360),i}function Si([i,e,r,o]){let u,g;const _=Dt((.2225045*(i=$i(i))+.7168786*(e=$i(e))+.0606169*(r=$i(r)))/1);i===e&&e===r?u=g=_:(u=Dt((.4360747*i+.3850649*e+.1430804*r)/Me),g=Dt((.0139322*i+.0971045*e+.7141733*r)/we));const y=116*_-16;return[y<0?0:y,500*(u-_),200*(_-g),o]}function $i(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Dt(i){return i>Ct?Math.pow(i,1/3):i/yt+Se}function ki([i,e,r,o]){let u=(i+16)/116,g=isNaN(e)?u:u+e/500,_=isNaN(r)?u:u-r/200;return u=1*br(u),g=Me*br(g),_=we*br(_),[Ji(3.1338561*g-1.6168667*u-.4906146*_),Ji(-.9787684*g+1.9161415*u+.033454*_),Ji(.0719453*g-.2289914*u+1.4052427*_),o]}function Ji(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function br(i){return i>pt?i*i*i:yt*(i-Se)}function kr(i){return parseInt(i.padEnd(2,i),16)/255}function lr(i,e){return vn(e?i/100:i,0,1)}function vn(i,e,r){return Math.min(Math.max(e,i),r)}function Fc(i){return!i.some(Number.isNaN)}const Nh={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class ai{constructor(e,r,o,u=1,g=!0){this.r=e,this.g=r,this.b=o,this.a=u,g||(this.r*=u,this.g*=u,this.b*=u,u||this.overwriteGetter("rgb",[e,r,o,u]))}static parse(e){if(e instanceof ai)return e;if(typeof e!="string")return;const r=function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const u=Nh[o];if(u){const[_,y,S]=u;return[_/255,y/255,S/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const _=o.length<6?1:2;let y=1;return[kr(o.slice(y,y+=_)),kr(o.slice(y,y+=_)),kr(o.slice(y,y+=_)),kr(o.slice(y,y+_)||"ff")]}if(o.startsWith("rgb")){const _=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[y,S,I,P,C,z,F,B,G,K,te,he]=_,re=[P||" ",F||" ",K].join("");if(re==="  "||re==="  /"||re===",,"||re===",,,"){const le=[I,z,G].join(""),be=le==="%%%"?100:le===""?255:0;if(be){const Ae=[vn(+S/be,0,1),vn(+C/be,0,1),vn(+B/be,0,1),te?lr(+te,he):1];if(Fc(Ae))return Ae}}return}}const g=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[_,y,S,I,P,C,z,F,B]=g,G=[S||" ",P||" ",z].join("");if(G==="  "||G==="  /"||G===",,"||G===",,,"){const K=[+y,vn(+I,0,100),vn(+C,0,100),F?lr(+F,B):1];if(Fc(K))return function([te,he,re,le]){function be(Ae){const Je=(Ae+te/30)%12,at=he*Math.min(re,1-re);return re-at*Math.max(-1,Math.min(Je-3,9-Je,1))}return te=hi(te),he/=100,re/=100,[be(0),be(8),be(4),le]}(K)}}}(e);return r?new ai(...r,!1):void 0}get rgb(){const{r:e,g:r,b:o,a:u}=this,g=u||1/0;return this.overwriteGetter("rgb",[e/g,r/g,o/g,u])}get hcl(){return this.overwriteGetter("hcl",function(e){const[r,o,u,g]=Si(e),_=Math.sqrt(o*o+u*u);return[Math.round(1e4*_)?hi(Math.atan2(u,o)*jt):NaN,_,r,g]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Si(this.rgb))}overwriteGetter(e,r){return Object.defineProperty(this,e,{value:r}),r}toString(){const[e,r,o,u]=this.rgb;return`rgba(${[e,r,o].map(g=>Math.round(255*g)).join(",")},${u})`}}ai.black=new ai(0,0,0,1),ai.white=new ai(1,1,1,1),ai.transparent=new ai(0,0,0,0),ai.red=new ai(1,0,0,1);class al{constructor(e,r,o){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ll{constructor(e,r,o,u,g){this.text=e,this.image=r,this.scale=o,this.fontStack=u,this.textColor=g}}class Ur{constructor(e){this.sections=e}static fromString(e){return new Ur([new ll(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Ur?e:Ur.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class Dr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Dr)return e;if(typeof e=="number")return new Dr([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Dr(e)}}toString(){return JSON.stringify(this.values)}}const ao=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class tn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof tn)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let r=0;r<e.length;r+=2){const o=e[r],u=e[r+1];if(typeof o!="string"||!ao.has(o)||!Array.isArray(u)||u.length!==2||typeof u[0]!="number"||typeof u[1]!="number")return}return new tn(e)}}toString(){return JSON.stringify(this.values)}}class rn{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new rn({name:e,available:!1}):null}}function As(i,e,r,o){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[i,e,r,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[i,e,r,o]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ho(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof ai||i instanceof al||i instanceof Ur||i instanceof Dr||i instanceof tn||i instanceof rn)return!0;if(Array.isArray(i)){for(const e of i)if(!Ho(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!Ho(i[e]))return!1;return!0}return!1}function Ui(i){if(i===null)return Xi;if(typeof i=="string")return At;if(typeof i=="boolean")return _t;if(typeof i=="number")return Ve;if(i instanceof ai)return si;if(i instanceof al)return os;if(i instanceof Ur)return Yi;if(i instanceof Dr)return X;if(i instanceof tn)return L;if(i instanceof rn)return D;if(Array.isArray(i)){const e=i.length;let r;for(const o of i){const u=Ui(o);if(r){if(r===u)continue;r=Pt;break}r=u}return V(r||Pt,e)}return $r}function lo(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof ai||i instanceof Ur||i instanceof Dr||i instanceof tn||i instanceof rn?i.toString():JSON.stringify(i)}class jn{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ho(e[1]))return r.error("invalid value");const o=e[1];let u=Ui(o);const g=r.expectedType;return u.kind!=="array"||u.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(u=g),new jn(u,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ai{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Zo={string:At,number:Ve,boolean:_t,object:$r};class jr{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let o,u=1;const g=e[0];if(g==="array"){let y,S;if(e.length>2){const I=e[1];if(typeof I!="string"||!(I in Zo)||I==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);y=Zo[I],u++}else y=Pt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);S=e[2],u++}o=V(y,S)}else{if(!Zo[g])throw new Error(`Types doesn't contain name = ${g}`);o=Zo[g]}const _=[];for(;u<e.length;u++){const y=r.parse(e[u],u,Pt);if(!y)return null;_.push(y)}return new jr(o,_)}evaluate(e){for(let r=0;r<this.args.length;r++){const o=this.args[r].evaluate(e);if(!ae(this.type,Ui(o)))return o;if(r===this.args.length-1)throw new Ai(`Expected value to be of type ${H(this.type)}, but found ${H(Ui(o))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Wo={"to-boolean":_t,"to-color":si,"to-number":Ve,"to-string":At};class bn{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const o=e[0];if(!Wo[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&e.length!==2)return r.error("Expected one argument.");const u=Wo[o],g=[];for(let _=1;_<e.length;_++){const y=r.parse(e[_],_,Pt);if(!y)return null;g.push(y)}return new bn(u,g)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let r,o;for(const u of this.args){if(r=u.evaluate(e),o=null,r instanceof ai)return r;if(typeof r=="string"){const g=e.parseColor(r);if(g)return g}else if(Array.isArray(r)&&(o=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:As(r[0],r[1],r[2],r[3]),!o))return new ai(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Ai(o||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const o of this.args){r=o.evaluate(e);const u=Dr.parse(r);if(u)return u}throw new Ai(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const o of this.args){r=o.evaluate(e);const u=tn.parse(r);if(u)return u}throw new Ai(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const o of this.args){if(r=o.evaluate(e),r===null)return 0;const u=Number(r);if(!isNaN(u))return u}throw new Ai(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return Ur.fromString(lo(this.args[0].evaluate(e)));case"resolvedImage":return rn.fromString(lo(this.args[0].evaluate(e)));default:return lo(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const co=["Unknown","Point","LineString","Polygon"];class li{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?co[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=ai.parse(e)),r}}class Ko{constructor(e,r,o=[],u,g=new en,_=[]){this.registry=e,this.path=o,this.key=o.map(y=>`[${y}]`).join(""),this.scope=g,this.errors=_,this.expectedType=u,this._isConstant=r}parse(e,r,o,u,g={}){return r?this.concat(r,o,u)._parse(e,g):this._parse(e,g)}_parse(e,r){function o(u,g,_){return _==="assert"?new jr(g,[u]):_==="coerce"?new bn(g,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[u];if(g){let _=g.parse(e,this);if(!_)return null;if(this.expectedType){const y=this.expectedType,S=_.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||S.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||S.kind!=="value"&&S.kind!=="string")if(y.kind!=="padding"||S.kind!=="value"&&S.kind!=="number"&&S.kind!=="array")if(y.kind!=="variableAnchorOffsetCollection"||S.kind!=="value"&&S.kind!=="array"){if(this.checkSubtype(y,S))return null}else _=o(_,y,r.typeAnnotation||"coerce");else _=o(_,y,r.typeAnnotation||"coerce");else _=o(_,y,r.typeAnnotation||"coerce");else _=o(_,y,r.typeAnnotation||"assert")}if(!(_ instanceof jn)&&_.type.kind!=="resolvedImage"&&this._isConstant(_)){const y=new li;try{_=new jn(_.type,_.evaluate(y))}catch(S){return this.error(S.message),null}}return _}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,o){const u=typeof e=="number"?this.path.concat(e):this.path,g=o?this.scope.concat(o):this.scope;return new Ko(this.registry,this._isConstant,u,r||null,g,this.errors)}error(e,...r){const o=`${this.key}${r.map(u=>`[${u}]`).join("")}`;this.errors.push(new wi(o,e))}checkSubtype(e,r){const o=ae(e,r);return o&&this.error(o),o}}class Ps{constructor(e,r,o){this.type=os,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return r.error("Collator options argument must be an object.");const u=r.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,_t);if(!u)return null;const g=r.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,_t);if(!g)return null;let _=null;return o.locale&&(_=r.parse(o.locale,1,At),!_)?null:new Ps(u,g,_)}evaluate(e){return new al(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const qn=8192;function Xo(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function uo(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function Vh(i,e){const r=(180+i[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(r*u*qn),Math.round(o*u*qn)]}function Oc(i,e,r){const o=i[0]-e[0],u=i[1]-e[1],g=i[0]-r[0],_=i[1]-r[1];return o*_-g*u==0&&o*g<=0&&u*_<=0}function Yo(i,e){let r=!1;for(let _=0,y=e.length;_<y;_++){const S=e[_];for(let I=0,P=S.length;I<P-1;I++){if(Oc(i,S[I],S[I+1]))return!1;(u=S[I])[1]>(o=i)[1]!=(g=S[I+1])[1]>o[1]&&o[0]<(g[0]-u[0])*(o[1]-u[1])/(g[1]-u[1])+u[0]&&(r=!r)}}var o,u,g;return r}function $h(i,e){for(let r=0;r<e.length;r++)if(Yo(i,e[r]))return!0;return!1}function Bc(i,e,r,o){const u=o[0]-r[0],g=o[1]-r[1],_=(i[0]-r[0])*g-u*(i[1]-r[1]),y=(e[0]-r[0])*g-u*(e[1]-r[1]);return _>0&&y<0||_<0&&y>0}function Uh(i,e,r){for(const I of r)for(let P=0;P<I.length-1;++P)if((y=[(_=I[P+1])[0]-(g=I[P])[0],_[1]-g[1]])[0]*(S=[(u=e)[0]-(o=i)[0],u[1]-o[1]])[1]-y[1]*S[0]!=0&&Bc(o,u,g,_)&&Bc(g,_,o,u))return!0;var o,u,g,_,y,S;return!1}function Nc(i,e){for(let r=0;r<i.length;++r)if(!Yo(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(Uh(i[r],i[r+1],e))return!1;return!0}function Vc(i,e){for(let r=0;r<e.length;r++)if(Nc(i,e[r]))return!0;return!1}function Jo(i,e,r){const o=[];for(let u=0;u<i.length;u++){const g=[];for(let _=0;_<i[u].length;_++){const y=Vh(i[u][_],r);Xo(e,y),g.push(y)}o.push(g)}return o}function $c(i,e,r){const o=[];for(let u=0;u<i.length;u++){const g=Jo(i[u],e,r);o.push(g)}return o}function Uc(i,e,r,o){if(i[0]<r[0]||i[0]>r[2]){const u=.5*o;let g=i[0]-r[0]>u?-o:r[0]-i[0]>u?o:0;g===0&&(g=i[0]-r[2]>u?-o:r[2]-i[0]>u?o:0),i[0]+=g}Xo(e,i)}function Qo(i,e,r,o){const u=Math.pow(2,o.z)*qn,g=[o.x*qn,o.y*qn],_=[];for(const y of i)for(const S of y){const I=[S.x+g[0],S.y+g[1]];Uc(I,e,r,u),_.push(I)}return _}function jc(i,e,r,o){const u=Math.pow(2,o.z)*qn,g=[o.x*qn,o.y*qn],_=[];for(const S of i){const I=[];for(const P of S){const C=[P.x+g[0],P.y+g[1]];Xo(e,C),I.push(C)}_.push(I)}if(e[2]-e[0]<=u/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const S of _)for(const I of S)Uc(I,e,r,u)}var y;return _}class as{constructor(e,r){this.type=_t,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ho(e[1])){const o=e[1];if(o.type==="FeatureCollection"){const u=[];for(const g of o.features){const{type:_,coordinates:y}=g.geometry;_==="Polygon"&&u.push(y),_==="MultiPolygon"&&u.push(...y)}if(u.length)return new as(o,{type:"MultiPolygon",coordinates:u})}else if(o.type==="Feature"){const u=o.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new as(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new as(o,o)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,o){const u=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(o.type==="Polygon"){const y=Jo(o.coordinates,g,_),S=Qo(r.geometry(),u,g,_);if(!uo(u,g))return!1;for(const I of S)if(!Yo(I,y))return!1}if(o.type==="MultiPolygon"){const y=$c(o.coordinates,g,_),S=Qo(r.geometry(),u,g,_);if(!uo(u,g))return!1;for(const I of S)if(!$h(I,y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,o){const u=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(o.type==="Polygon"){const y=Jo(o.coordinates,g,_),S=jc(r.geometry(),u,g,_);if(!uo(u,g))return!1;for(const I of S)if(!Nc(I,y))return!1}if(o.type==="MultiPolygon"){const y=$c(o.coordinates,g,_),S=jc(r.geometry(),u,g,_);if(!uo(u,g))return!1;for(const I of S)if(!Vc(I,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class ea{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const o=e[1];return r.scope.has(o)?new ea(o,r.scope.get(o)):r.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class qr{constructor(e,r,o,u){this.name=e,this.type=r,this._evaluate=o,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const o=e[0],u=qr.definitions[o];if(!u)return r.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(u)?u[0]:u.type,_=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,y=_.filter(([I])=>!Array.isArray(I)||I.length===e.length-1);let S=null;for(const[I,P]of y){S=new Ko(r.registry,ho,r.path,null,r.scope);const C=[];let z=!1;for(let F=1;F<e.length;F++){const B=e[F],G=Array.isArray(I)?I[F-1]:I.type,K=S.parse(B,1+C.length,G);if(!K){z=!0;break}C.push(K)}if(!z)if(Array.isArray(I)&&I.length!==C.length)S.error(`Expected ${I.length} arguments, but found ${C.length} instead.`);else{for(let F=0;F<C.length;F++){const B=Array.isArray(I)?I[F]:I.type,G=C[F];S.concat(F+1).checkSubtype(B,G.type)}if(S.errors.length===0)return new qr(o,g,P,C)}}if(y.length===1)r.errors.push(...S.errors);else{const I=(y.length?y:_).map(([C])=>{return z=C,Array.isArray(z)?`(${z.map(H).join(", ")})`:`(${H(z.type)}...)`;var z}).join(" | "),P=[];for(let C=1;C<e.length;C++){const z=r.parse(e[C],1+P.length);if(!z)return null;P.push(H(z.type))}r.error(`Expected arguments of type ${I}, but found (${P.join(", ")}) instead.`)}return null}static register(e,r){qr.definitions=r;for(const o in r)e[o]=qr}}function ho(i){if(i instanceof ea)return ho(i.boundExpression);if(i instanceof qr&&i.name==="error"||i instanceof Ps||i instanceof as)return!1;const e=i instanceof bn||i instanceof jr;let r=!0;return i.eachChild(o=>{r=e?r&&ho(o):r&&o instanceof jn}),!!r&&ta(i)&&fo(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ta(i){if(i instanceof qr&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof as)return!1;let e=!0;return i.eachChild(r=>{e&&!ta(r)&&(e=!1)}),e}function po(i){if(i instanceof qr&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!po(r)&&(e=!1)}),e}function fo(i,e){if(i instanceof qr&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(o=>{r&&!fo(o,e)&&(r=!1)}),r}function mo(i,e){const r=i.length-1;let o,u,g=0,_=r,y=0;for(;g<=_;)if(y=Math.floor((g+_)/2),o=i[y],u=i[y+1],o<=e){if(y===r||e<u)return y;g=y+1}else{if(!(o>e))throw new Ai("Input is not a number.");_=y-1}return 0}class go{constructor(e,r,o){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[u,g]of o)this.labels.push(u),this.outputs.push(g)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const o=r.parse(e[1],1,Ve);if(!o)return null;const u=[];let g=null;r.expectedType&&r.expectedType.kind!=="value"&&(g=r.expectedType);for(let _=1;_<e.length;_+=2){const y=_===1?-1/0:e[_],S=e[_+1],I=_,P=_+1;if(typeof y!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(u.length&&u[u.length-1][0]>=y)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const C=r.parse(S,P,g);if(!C)return null;g=g||C.type,u.push([y,C])}return new go(g,o,u)}evaluate(e){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return o[0].evaluate(e);const g=r.length;return u>=r[g-1]?o[g-1].evaluate(e):o[mo(r,u)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function jh(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var qh=qc;function qc(i,e,r,o){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=o}qc.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,o=0;o<8;o++){var u=this.sampleCurveX(r)-i;if(Math.abs(u)<e)return r;var g=this.sampleCurveDerivativeX(r);if(Math.abs(g)<1e-6)break;r-=u/g}var _=0,y=1;for(r=i,o=0;o<20&&(u=this.sampleCurveX(r),!(Math.abs(u-i)<e));o++)i>u?_=r:y=r,r=.5*(y-_)+_;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var Gh=jh(qh);function ls(i,e,r){return i+r*(e-i)}function ia(i,e,r){return i.map((o,u)=>ls(o,e[u],r))}const wr={number:ls,color:function(i,e,r,o="rgb"){switch(o){case"rgb":{const[u,g,_,y]=ia(i.rgb,e.rgb,r);return new ai(u,g,_,y,!1)}case"hcl":{const[u,g,_,y]=i.hcl,[S,I,P,C]=e.hcl;let z,F;if(isNaN(u)||isNaN(S))isNaN(u)?isNaN(S)?z=NaN:(z=S,_!==1&&_!==0||(F=I)):(z=u,P!==1&&P!==0||(F=g));else{let he=S-u;S>u&&he>180?he-=360:S<u&&u-S>180&&(he+=360),z=u+r*he}const[B,G,K,te]=function([he,re,le,be]){return he=isNaN(he)?0:he*It,ki([le,Math.cos(he)*re,Math.sin(he)*re,be])}([z,F??ls(g,I,r),ls(_,P,r),ls(y,C,r)]);return new ai(B,G,K,te,!1)}case"lab":{const[u,g,_,y]=ki(ia(i.lab,e.lab,r));return new ai(u,g,_,y,!1)}}},array:ia,padding:function(i,e,r){return new Dr(ia(i.values,e.values,r))},variableAnchorOffsetCollection:function(i,e,r){const o=i.values,u=e.values;if(o.length!==u.length)throw new Ai(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${e.toString()}`);const g=[];for(let _=0;_<o.length;_+=2){if(o[_]!==u[_])throw new Ai(`Cannot interpolate values containing mismatched anchors. from[${_}]: ${o[_]}, to[${_}]: ${u[_]}`);g.push(o[_]);const[y,S]=o[_+1],[I,P]=u[_+1];g.push([ls(y,I,r),ls(S,P,r)])}return new tn(g)}};class gr{constructor(e,r,o,u,g){this.type=e,this.operator=r,this.interpolation=o,this.input=u,this.labels=[],this.outputs=[];for(const[_,y]of g)this.labels.push(_),this.outputs.push(y)}static interpolationFactor(e,r,o,u){let g=0;if(e.name==="exponential")g=Jt(r,e.base,o,u);else if(e.name==="linear")g=Jt(r,1,o,u);else if(e.name==="cubic-bezier"){const _=e.controlPoints;g=new Gh(_[0],_[1],_[2],_[3]).solve(Jt(r,1,o,u))}return g}static parse(e,r){let[o,u,g,..._]=e;if(!Array.isArray(u)||u.length===0)return r.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const I=u[1];if(typeof I!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:I}}else{if(u[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const I=u.slice(1);if(I.length!==4||I.some(P=>typeof P!="number"||P<0||P>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:I}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(g=r.parse(g,2,Ve),!g)return null;const y=[];let S=null;o==="interpolate-hcl"||o==="interpolate-lab"?S=si:r.expectedType&&r.expectedType.kind!=="value"&&(S=r.expectedType);for(let I=0;I<_.length;I+=2){const P=_[I],C=_[I+1],z=I+3,F=I+4;if(typeof P!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(y.length&&y[y.length-1][0]>=P)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);const B=r.parse(C,F,S);if(!B)return null;S=S||B.type,y.push([P,B])}return de(S,Ve)||de(S,si)||de(S,X)||de(S,L)||de(S,V(Ve))?new gr(S,o,u,g,y):r.error(`Type ${H(S)} is not interpolatable.`)}evaluate(e){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return o[0].evaluate(e);const g=r.length;if(u>=r[g-1])return o[g-1].evaluate(e);const _=mo(r,u),y=gr.interpolationFactor(this.interpolation,u,r[_],r[_+1]),S=o[_].evaluate(e),I=o[_+1].evaluate(e);switch(this.operator){case"interpolate":return wr[this.type.kind](S,I,y);case"interpolate-hcl":return wr.color(S,I,y,"hcl");case"interpolate-lab":return wr.color(S,I,y,"lab")}}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Jt(i,e,r,o){const u=o-r,g=i-r;return u===0?0:e===1?g/u:(Math.pow(e,g)-1)/(Math.pow(e,u)-1)}class ra{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let o=null;const u=r.expectedType;u&&u.kind!=="value"&&(o=u);const g=[];for(const y of e.slice(1)){const S=r.parse(y,1+g.length,o,void 0,{typeAnnotation:"omit"});if(!S)return null;o=o||S.type,g.push(S)}if(!o)throw new Error("No output type");const _=u&&g.some(y=>ae(u,y.type));return new ra(_?Pt:o,g)}evaluate(e){let r,o=null,u=0;for(const g of this.args)if(u++,o=g.evaluate(e),o&&o instanceof rn&&!o.available&&(r||(r=o.name),o=null,u===this.args.length&&(o=r)),o!==null)break;return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class na{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let g=1;g<e.length-1;g+=2){const _=e[g];if(typeof _!="string")return r.error(`Expected string, but found ${typeof _} instead.`,g);if(/[^a-zA-Z0-9_]/.test(_))return r.error("Variable names must contain only alphanumeric characters or '_'.",g);const y=r.parse(e[g+1],g+1);if(!y)return null;o.push([_,y])}const u=r.parse(e[e.length-1],e.length-1,r.expectedType,o);return u?new na(o,u):null}outputDefined(){return this.result.outputDefined()}}class cl{constructor(e,r,o){this.type=e,this.index=r,this.input=o}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,Ve),u=r.parse(e[2],2,V(r.expectedType||Pt));return o&&u?new cl(u.type.itemType,o,u):null}evaluate(e){const r=this.index.evaluate(e),o=this.input.evaluate(e);if(r<0)throw new Ai(`Array index out of bounds: ${r} < 0.`);if(r>=o.length)throw new Ai(`Array index out of bounds: ${r} > ${o.length-1}.`);if(r!==Math.floor(r))throw new Ai(`Array index must be an integer, but found ${r} instead.`);return o[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class ul{constructor(e,r){this.type=_t,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,Pt),u=r.parse(e[2],2,Pt);return o&&u?ue(o.type,[_t,At,Ve,Xi,Pt])?new ul(o,u):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${H(o.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!ne(r,["boolean","string","number","null"]))throw new Ai(`Expected first argument to be of type boolean, string, number or null, but found ${H(Ui(r))} instead.`);if(!ne(o,["string","array"]))throw new Ai(`Expected second argument to be of type array or string, but found ${H(Ui(o))} instead.`);return o.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class sa{constructor(e,r,o){this.type=Ve,this.needle=e,this.haystack=r,this.fromIndex=o}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,Pt),u=r.parse(e[2],2,Pt);if(!o||!u)return null;if(!ue(o.type,[_t,At,Ve,Xi,Pt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${H(o.type)} instead`);if(e.length===4){const g=r.parse(e[3],3,Ve);return g?new sa(o,u,g):null}return new sa(o,u)}evaluate(e){const r=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!ne(r,["boolean","string","number","null"]))throw new Ai(`Expected first argument to be of type boolean, string, number or null, but found ${H(Ui(r))} instead.`);if(!ne(o,["string","array"]))throw new Ai(`Expected second argument to be of type array or string, but found ${H(Ui(o))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return o.indexOf(r,u)}return o.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class hl{constructor(e,r,o,u,g,_){this.inputType=e,this.type=r,this.input=o,this.cases=u,this.outputs=g,this.otherwise=_}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let o,u;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);const g={},_=[];for(let I=2;I<e.length-1;I+=2){let P=e[I];const C=e[I+1];Array.isArray(P)||(P=[P]);const z=r.concat(I);if(P.length===0)return z.error("Expected at least one branch label.");for(const B of P){if(typeof B!="number"&&typeof B!="string")return z.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return z.error("Numeric branch labels must be integer values.");if(o){if(z.checkSubtype(o,Ui(B)))return null}else o=Ui(B);if(g[String(B)]!==void 0)return z.error("Branch labels must be unique.");g[String(B)]=_.length}const F=r.parse(C,I,u);if(!F)return null;u=u||F.type,_.push(F)}const y=r.parse(e[1],1,Pt);if(!y)return null;const S=r.parse(e[e.length-1],e.length-1,u);return S?y.type.kind!=="value"&&r.concat(1).checkSubtype(o,y.type)?null:new hl(o,u,y,g,_,S):null}evaluate(e){const r=this.input.evaluate(e);return(Ui(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class dl{constructor(e,r,o){this.type=e,this.branches=r,this.otherwise=o}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let o;r.expectedType&&r.expectedType.kind!=="value"&&(o=r.expectedType);const u=[];for(let _=1;_<e.length-1;_+=2){const y=r.parse(e[_],_,_t);if(!y)return null;const S=r.parse(e[_+1],_+1,o);if(!S)return null;u.push([y,S]),o=o||S.type}const g=r.parse(e[e.length-1],e.length-1,o);if(!g)return null;if(!o)throw new Error("Can't infer output type");return new dl(o,u,g)}evaluate(e){for(const[r,o]of this.branches)if(r.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,o]of this.branches)e(r),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class oa{constructor(e,r,o,u){this.type=e,this.input=r,this.beginIndex=o,this.endIndex=u}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,Pt),u=r.parse(e[2],2,Ve);if(!o||!u)return null;if(!ue(o.type,[V(Pt),At,Pt]))return r.error(`Expected first argument to be of type array or string, but found ${H(o.type)} instead`);if(e.length===4){const g=r.parse(e[3],3,Ve);return g?new oa(o.type,o,u,g):null}return new oa(o.type,o,u)}evaluate(e){const r=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!ne(r,["string","array"]))throw new Ai(`Expected first argument to be of type array or string, but found ${H(Ui(r))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return r.slice(o,u)}return r.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Gc(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Hc(i,e,r,o){return o.compare(e,r)===0}function Cs(i,e,r){const o=i!=="=="&&i!=="!=";return class by{constructor(g,_,y){this.type=_t,this.lhs=g,this.rhs=_,this.collator=y,this.hasUntypedArgument=g.type.kind==="value"||_.type.kind==="value"}static parse(g,_){if(g.length!==3&&g.length!==4)return _.error("Expected two or three arguments.");const y=g[0];let S=_.parse(g[1],1,Pt);if(!S)return null;if(!Gc(y,S.type))return _.concat(1).error(`"${y}" comparisons are not supported for type '${H(S.type)}'.`);let I=_.parse(g[2],2,Pt);if(!I)return null;if(!Gc(y,I.type))return _.concat(2).error(`"${y}" comparisons are not supported for type '${H(I.type)}'.`);if(S.type.kind!==I.type.kind&&S.type.kind!=="value"&&I.type.kind!=="value")return _.error(`Cannot compare types '${H(S.type)}' and '${H(I.type)}'.`);o&&(S.type.kind==="value"&&I.type.kind!=="value"?S=new jr(I.type,[S]):S.type.kind!=="value"&&I.type.kind==="value"&&(I=new jr(S.type,[I])));let P=null;if(g.length===4){if(S.type.kind!=="string"&&I.type.kind!=="string"&&S.type.kind!=="value"&&I.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(P=_.parse(g[3],3,os),!P)return null}return new by(S,I,P)}evaluate(g){const _=this.lhs.evaluate(g),y=this.rhs.evaluate(g);if(o&&this.hasUntypedArgument){const S=Ui(_),I=Ui(y);if(S.kind!==I.kind||S.kind!=="string"&&S.kind!=="number")throw new Ai(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${S.kind}, ${I.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const S=Ui(_),I=Ui(y);if(S.kind!=="string"||I.kind!=="string")return e(g,_,y)}return this.collator?r(g,_,y,this.collator.evaluate(g)):e(g,_,y)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}}}const Hh=Cs("==",function(i,e,r){return e===r},Hc),Zh=Cs("!=",function(i,e,r){return e!==r},function(i,e,r,o){return!Hc(0,e,r,o)}),Wh=Cs("<",function(i,e,r){return e<r},function(i,e,r,o){return o.compare(e,r)<0}),Kh=Cs(">",function(i,e,r){return e>r},function(i,e,r,o){return o.compare(e,r)>0}),Xh=Cs("<=",function(i,e,r){return e<=r},function(i,e,r,o){return o.compare(e,r)<=0}),Yh=Cs(">=",function(i,e,r){return e>=r},function(i,e,r,o){return o.compare(e,r)>=0});class pl{constructor(e,r,o,u,g){this.type=At,this.number=e,this.locale=r,this.currency=o,this.minFractionDigits=u,this.maxFractionDigits=g}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const o=r.parse(e[1],1,Ve);if(!o)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return r.error("NumberFormat options argument must be an object.");let g=null;if(u.locale&&(g=r.parse(u.locale,1,At),!g))return null;let _=null;if(u.currency&&(_=r.parse(u.currency,1,At),!_))return null;let y=null;if(u["min-fraction-digits"]&&(y=r.parse(u["min-fraction-digits"],1,Ve),!y))return null;let S=null;return u["max-fraction-digits"]&&(S=r.parse(u["max-fraction-digits"],1,Ve),!S)?null:new pl(o,g,_,y,S)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class aa{constructor(e){this.type=Yi,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return r.error("First argument must be an image or text section.");const u=[];let g=!1;for(let _=1;_<=e.length-1;++_){const y=e[_];if(g&&typeof y=="object"&&!Array.isArray(y)){g=!1;let S=null;if(y["font-scale"]&&(S=r.parse(y["font-scale"],1,Ve),!S))return null;let I=null;if(y["text-font"]&&(I=r.parse(y["text-font"],1,V(At)),!I))return null;let P=null;if(y["text-color"]&&(P=r.parse(y["text-color"],1,si),!P))return null;const C=u[u.length-1];C.scale=S,C.font=I,C.textColor=P}else{const S=r.parse(e[_],1,Pt);if(!S)return null;const I=S.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,u.push({content:S,scale:null,font:null,textColor:null})}}return new aa(u)}evaluate(e){return new Ur(this.sections.map(r=>{const o=r.content.evaluate(e);return Ui(o)===D?new ll("",o,null,null,null):new ll(lo(o),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}}class fl{constructor(e){this.type=D,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const o=r.parse(e[1],1,At);return o?new fl(o):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),o=rn.fromString(r);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(r)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}}class ml{constructor(e){this.type=Ve,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=r.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${H(o.type)} instead.`):new ml(o):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Ai(`Expected value to be of type string or array, but found ${H(Ui(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Ms={"==":Hh,"!=":Zh,">":Kh,"<":Wh,">=":Yh,"<=":Xh,array:jr,at:cl,boolean:jr,case:dl,coalesce:ra,collator:Ps,format:aa,image:fl,in:ul,"index-of":sa,interpolate:gr,"interpolate-hcl":gr,"interpolate-lab":gr,length:ml,let:na,literal:jn,match:hl,number:jr,"number-format":pl,object:jr,slice:oa,step:go,string:jr,"to-boolean":bn,"to-color":bn,"to-number":bn,"to-string":bn,var:ea,within:as};function Zc(i,[e,r,o,u]){e=e.evaluate(i),r=r.evaluate(i),o=o.evaluate(i);const g=u?u.evaluate(i):1,_=As(e,r,o,g);if(_)throw new Ai(_);return new ai(e/255,r/255,o/255,g,!1)}function Wc(i,e){return i in e}function gl(i,e){const r=e[i];return r===void 0?null:r}function cs(i){return{type:i}}function Kc(i){return{result:"success",value:i}}function ks(i){return{result:"error",value:i}}function Ds(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Xc(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function _l(i){return!!i.expression&&i.expression.interpolated}function Wt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function la(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Jh(i){return i}function Yc(i,e){const r=e.type==="color",o=i.stops&&typeof i.stops[0][0]=="object",u=o||!(o||i.property!==void 0),g=i.type||(_l(e)?"exponential":"interval");if(r||e.type==="padding"){const P=r?ai.parse:Dr.parse;(i=ui({},i)).stops&&(i.stops=i.stops.map(C=>[C[0],P(C[1])])),i.default=P(i.default?i.default:e.default)}if(i.colorSpace&&(_=i.colorSpace)!=="rgb"&&_!=="hcl"&&_!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var _;let y,S,I;if(g==="exponential")y=qt;else if(g==="interval")y=Qh;else if(g==="categorical"){y=Bi,S=Object.create(null);for(const P of i.stops)S[P[0]]=P[1];I=typeof i.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);y=yl}if(o){const P={},C=[];for(let B=0;B<i.stops.length;B++){const G=i.stops[B],K=G[0].zoom;P[K]===void 0&&(P[K]={zoom:K,type:i.type,property:i.property,default:i.default,stops:[]},C.push(K)),P[K].stops.push([G[0].value,G[1]])}const z=[];for(const B of C)z.push([P[B].zoom,Yc(P[B],e)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:gr.interpolationFactor.bind(void 0,F),zoomStops:z.map(B=>B[0]),evaluate:({zoom:B},G)=>qt({stops:z,base:i.base},e,B).evaluate(B,G)}}if(u){const P=g==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:gr.interpolationFactor.bind(void 0,P),zoomStops:i.stops.map(C=>C[0]),evaluate:({zoom:C})=>y(i,e,C,S,I)}}return{kind:"source",evaluate(P,C){const z=C&&C.properties?C.properties[i.property]:void 0;return z===void 0?_o(i.default,e.default):y(i,e,z,S,I)}}}function _o(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function Bi(i,e,r,o,u){return _o(typeof r===u?o[r]:void 0,i.default,e.default)}function Qh(i,e,r){if(Wt(r)!=="number")return _o(i.default,e.default);const o=i.stops.length;if(o===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[o-1][0])return i.stops[o-1][1];const u=mo(i.stops.map(g=>g[0]),r);return i.stops[u][1]}function qt(i,e,r){const o=i.base!==void 0?i.base:1;if(Wt(r)!=="number")return _o(i.default,e.default);const u=i.stops.length;if(u===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[u-1][0])return i.stops[u-1][1];const g=mo(i.stops.map(P=>P[0]),r),_=function(P,C,z,F){const B=F-z,G=P-z;return B===0?0:C===1?G/B:(Math.pow(C,G)-1)/(Math.pow(C,B)-1)}(r,o,i.stops[g][0],i.stops[g+1][0]),y=i.stops[g][1],S=i.stops[g+1][1],I=wr[e.type]||Jh;return typeof y.evaluate=="function"?{evaluate(...P){const C=y.evaluate.apply(void 0,P),z=S.evaluate.apply(void 0,P);if(C!==void 0&&z!==void 0)return I(C,z,_,i.colorSpace)}}:I(y,S,_,i.colorSpace)}function yl(i,e,r){switch(e.type){case"color":r=ai.parse(r);break;case"formatted":r=Ur.fromString(r.toString());break;case"resolvedImage":r=rn.fromString(r.toString());break;case"padding":r=Dr.parse(r);break;default:Wt(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return _o(r,i.default,e.default)}qr.register(Ms,{error:[{kind:"error"},[At],(i,[e])=>{throw new Ai(e.evaluate(i))}],typeof:[At,[Pt],(i,[e])=>H(Ui(e.evaluate(i)))],"to-rgba":[V(Ve,4),[si],(i,[e])=>{const[r,o,u,g]=e.evaluate(i).rgb;return[255*r,255*o,255*u,g]}],rgb:[si,[Ve,Ve,Ve],Zc],rgba:[si,[Ve,Ve,Ve,Ve],Zc],has:{type:_t,overloads:[[[At],(i,[e])=>Wc(e.evaluate(i),i.properties())],[[At,$r],(i,[e,r])=>Wc(e.evaluate(i),r.evaluate(i))]]},get:{type:Pt,overloads:[[[At],(i,[e])=>gl(e.evaluate(i),i.properties())],[[At,$r],(i,[e,r])=>gl(e.evaluate(i),r.evaluate(i))]]},"feature-state":[Pt,[At],(i,[e])=>gl(e.evaluate(i),i.featureState||{})],properties:[$r,[],i=>i.properties()],"geometry-type":[At,[],i=>i.geometryType()],id:[Pt,[],i=>i.id()],zoom:[Ve,[],i=>i.globals.zoom],"heatmap-density":[Ve,[],i=>i.globals.heatmapDensity||0],"line-progress":[Ve,[],i=>i.globals.lineProgress||0],accumulated:[Pt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Ve,cs(Ve),(i,e)=>{let r=0;for(const o of e)r+=o.evaluate(i);return r}],"*":[Ve,cs(Ve),(i,e)=>{let r=1;for(const o of e)r*=o.evaluate(i);return r}],"-":{type:Ve,overloads:[[[Ve,Ve],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[Ve],(i,[e])=>-e.evaluate(i)]]},"/":[Ve,[Ve,Ve],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[Ve,[Ve,Ve],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[Ve,[],()=>Math.LN2],pi:[Ve,[],()=>Math.PI],e:[Ve,[],()=>Math.E],"^":[Ve,[Ve,Ve],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[Ve,[Ve],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Ve,[Ve],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Ve,[Ve],(i,[e])=>Math.log(e.evaluate(i))],log2:[Ve,[Ve],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Ve,[Ve],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Ve,[Ve],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Ve,[Ve],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Ve,[Ve],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Ve,[Ve],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Ve,[Ve],(i,[e])=>Math.atan(e.evaluate(i))],min:[Ve,cs(Ve),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[Ve,cs(Ve),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[Ve,[Ve],(i,[e])=>Math.abs(e.evaluate(i))],round:[Ve,[Ve],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[Ve,[Ve],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Ve,[Ve],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[_t,[At,Pt],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[_t,[Pt],(i,[e])=>i.id()===e.value],"filter-type-==":[_t,[At],(i,[e])=>i.geometryType()===e.value],"filter-<":[_t,[At,Pt],(i,[e,r])=>{const o=i.properties()[e.value],u=r.value;return typeof o==typeof u&&o<u}],"filter-id-<":[_t,[Pt],(i,[e])=>{const r=i.id(),o=e.value;return typeof r==typeof o&&r<o}],"filter->":[_t,[At,Pt],(i,[e,r])=>{const o=i.properties()[e.value],u=r.value;return typeof o==typeof u&&o>u}],"filter-id->":[_t,[Pt],(i,[e])=>{const r=i.id(),o=e.value;return typeof r==typeof o&&r>o}],"filter-<=":[_t,[At,Pt],(i,[e,r])=>{const o=i.properties()[e.value],u=r.value;return typeof o==typeof u&&o<=u}],"filter-id-<=":[_t,[Pt],(i,[e])=>{const r=i.id(),o=e.value;return typeof r==typeof o&&r<=o}],"filter->=":[_t,[At,Pt],(i,[e,r])=>{const o=i.properties()[e.value],u=r.value;return typeof o==typeof u&&o>=u}],"filter-id->=":[_t,[Pt],(i,[e])=>{const r=i.id(),o=e.value;return typeof r==typeof o&&r>=o}],"filter-has":[_t,[Pt],(i,[e])=>e.value in i.properties()],"filter-has-id":[_t,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[_t,[V(At)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[_t,[V(Pt)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[_t,[At,V(Pt)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[_t,[At,V(Pt)],(i,[e,r])=>function(o,u,g,_){for(;g<=_;){const y=g+_>>1;if(u[y]===o)return!0;u[y]>o?_=y-1:g=y+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:_t,overloads:[[[_t,_t],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[cs(_t),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:_t,overloads:[[[_t,_t],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[cs(_t),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[_t,[_t],(i,[e])=>!e.evaluate(i)],"is-supported-script":[_t,[At],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[At,[At],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[At,[At],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[At,cs(Pt),(i,e)=>e.map(r=>lo(r.evaluate(i))).join("")],"resolved-locale":[At,[os],(i,[e])=>e.evaluate(i).resolvedLocale()]});class _i{constructor(e,r){var o;this.expression=e,this._warningHistory={},this._evaluator=new li,this._defaultValue=r?(o=r).type==="color"&&la(o.default)?new ai(0,0,0,0):o.type==="color"?ai.parse(o.default)||null:o.type==="padding"?Dr.parse(o.default)||null:o.type==="variableAnchorOffsetCollection"?tn.parse(o.default)||null:o.default===void 0?null:o.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,o,u,g,_){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=o,this._evaluator.canonical=u,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_,this.expression.evaluate(this._evaluator)}evaluate(e,r,o,u,g,_){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=o||null,this._evaluator.canonical=u,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_||null;try{const y=this.expression.evaluate(this._evaluator);if(y==null||typeof y=="number"&&y!=y)return this._defaultValue;if(this._enumValues&&!(y in this._enumValues))throw new Ai(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(y)} instead.`);return y}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}}}function fi(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Ms}function us(i,e){const r=new Ko(Ms,ho,[],e?function(u){const g={color:si,string:At,number:Ve,enum:At,boolean:_t,formatted:Yi,padding:X,resolvedImage:D,variableAnchorOffsetCollection:L};return u.type==="array"?V(g[u.value]||Pt,u.length):g[u.type]}(e):void 0),o=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?Kc(new _i(o,e)):ks(r.errors)}class ca{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!po(r.expression)}evaluateWithoutErrorHandling(e,r,o,u,g,_){return this._styleExpression.evaluateWithoutErrorHandling(e,r,o,u,g,_)}evaluate(e,r,o,u,g,_){return this._styleExpression.evaluate(e,r,o,u,g,_)}}class xl{constructor(e,r,o,u){this.kind=e,this.zoomStops=o,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!po(r.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,r,o,u,g,_){return this._styleExpression.evaluateWithoutErrorHandling(e,r,o,u,g,_)}evaluate(e,r,o,u,g,_){return this._styleExpression.evaluate(e,r,o,u,g,_)}interpolationFactor(e,r,o){return this.interpolationType?gr.interpolationFactor(this.interpolationType,e,r,o):0}}function Jc(i,e){const r=us(i,e);if(r.result==="error")return r;const o=r.value.expression,u=ta(o);if(!u&&!Ds(e))return ks([new wi("","data expressions not supported")]);const g=fo(o,["zoom"]);if(!g&&!Xc(e))return ks([new wi("","zoom expressions not supported")]);const _=ha(o);return _||g?_ instanceof wi?ks([_]):_ instanceof gr&&!_l(e)?ks([new wi("",'"interpolate" expressions cannot be used with this property')]):Kc(_?new xl(u?"camera":"composite",r.value,_.labels,_ instanceof gr?_.interpolation:void 0):new ca(u?"constant":"source",r.value)):ks([new wi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ua{constructor(e,r){this._parameters=e,this._specification=r,ui(this,Yc(this._parameters,this._specification))}static deserialize(e){return new ua(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ha(i){let e=null;if(i instanceof na)e=ha(i.result);else if(i instanceof ra){for(const r of i.args)if(e=ha(r),e)break}else(i instanceof go||i instanceof gr)&&i.input instanceof qr&&i.input.name==="zoom"&&(e=i);return e instanceof wi||i.eachChild(r=>{const o=ha(r);o instanceof wi?e=o:!e&&o?e=new wi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new wi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function da(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!da(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const Qc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function pa(i){if(i==null)return{filter:()=>!0,needGeometry:!1};da(i)||(i=ma(i));const e=us(i,Qc);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,o,u)=>e.value.evaluate(r,o,{},u),needGeometry:fa(i)}}function eu(i,e){return i<e?-1:i>e?1:0}function fa(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(fa(i[e]))return!0;return!1}function ma(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?vl(i[1],i[2],"=="):e==="!="?ga(vl(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?vl(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(ma))):e==="all"?["all"].concat(i.slice(1).map(ma)):e==="none"?["all"].concat(i.slice(1).map(ma).map(ga)):e==="in"?tu(i[1],i.slice(2)):e==="!in"?ga(tu(i[1],i.slice(2))):e==="has"?iu(i[1]):e==="!has"?ga(iu(i[1])):e!=="within"||i;var r}function vl(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function tu(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(eu)]]:["filter-in-small",i,["literal",e]]}}function iu(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function ga(i){return["!",i]}function bl(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let u="[";for(const g of i)u+=`${bl(g)},`;return`${u}]`}const r=Object.keys(i).sort();let o="{";for(let u=0;u<r.length;u++)o+=`${JSON.stringify(r[u])}:${bl(i[r[u]])},`;return`${o}}`}function ed(i){let e="";for(const r of je)e+=`/${bl(i[r])}`;return e}function ru(i){const e=i.value;return e?[new Ce(i.key,e,"constants have been deprecated as of v8")]:[]}function Di(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Gn(i){if(Array.isArray(i))return i.map(Gn);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=Gn(i[r]);return e}return Di(i)}function Sr(i){const e=i.key,r=i.value,o=i.valueSpec||{},u=i.objectElementValidators||{},g=i.style,_=i.styleSpec,y=i.validateSpec;let S=[];const I=Wt(r);if(I!=="object")return[new Ce(e,r,`object expected, ${I} found`)];for(const P in r){const C=P.split(".")[0],z=o[C]||o["*"];let F;if(u[C])F=u[C];else if(o[C])F=y;else if(u["*"])F=u["*"];else{if(!o["*"]){S.push(new Ce(e,r[P],`unknown property "${P}"`));continue}F=y}S=S.concat(F({key:(e&&`${e}.`)+P,value:r[P],valueSpec:z,style:g,styleSpec:_,object:r,objectKey:P,validateSpec:y},r))}for(const P in o)u[P]||o[P].required&&o[P].default===void 0&&r[P]===void 0&&S.push(new Ce(e,r,`missing required property "${P}"`));return S}function wl(i){const e=i.value,r=i.valueSpec,o=i.style,u=i.styleSpec,g=i.key,_=i.arrayElementValidator||i.validateSpec;if(Wt(e)!=="array")return[new Ce(g,e,`array expected, ${Wt(e)} found`)];if(r.length&&e.length!==r.length)return[new Ce(g,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new Ce(g,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let y={type:r.value,values:r.values};u.$version<7&&(y.function=r.function),Wt(r.value)==="object"&&(y=r.value);let S=[];for(let I=0;I<e.length;I++)S=S.concat(_({array:e,arrayIndex:I,value:e[I],valueSpec:y,validateSpec:i.validateSpec,style:o,styleSpec:u,key:`${g}[${I}]`}));return S}function _a(i){const e=i.key,r=i.value,o=i.valueSpec;let u=Wt(r);return u==="number"&&r!=r&&(u="NaN"),u!=="number"?[new Ce(e,r,`number expected, ${u} found`)]:"minimum"in o&&r<o.minimum?[new Ce(e,r,`${r} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&r>o.maximum?[new Ce(e,r,`${r} is greater than the maximum value ${o.maximum}`)]:[]}function nu(i){const e=i.valueSpec,r=Di(i.value.type);let o,u,g,_={};const y=r!=="categorical"&&i.value.property===void 0,S=!y,I=Wt(i.value.stops)==="array"&&Wt(i.value.stops[0])==="array"&&Wt(i.value.stops[0][0])==="object",P=Sr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(F){if(r==="identity")return[new Ce(F.key,F.value,'identity function may not have a "stops" property')];let B=[];const G=F.value;return B=B.concat(wl({key:F.key,value:G,valueSpec:F.valueSpec,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:C})),Wt(G)==="array"&&G.length===0&&B.push(new Ce(F.key,G,"array must have at least one stop")),B},default:function(F){return F.validateSpec({key:F.key,value:F.value,valueSpec:e,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec})}}});return r==="identity"&&y&&P.push(new Ce(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||P.push(new Ce(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!_l(i.valueSpec)&&P.push(new Ce(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(S&&!Ds(i.valueSpec)?P.push(new Ce(i.key,i.value,"property functions not supported")):y&&!Xc(i.valueSpec)&&P.push(new Ce(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!I||i.value.property!==void 0||P.push(new Ce(i.key,i.value,'"property" property is required')),P;function C(F){let B=[];const G=F.value,K=F.key;if(Wt(G)!=="array")return[new Ce(K,G,`array expected, ${Wt(G)} found`)];if(G.length!==2)return[new Ce(K,G,`array length 2 expected, length ${G.length} found`)];if(I){if(Wt(G[0])!=="object")return[new Ce(K,G,`object expected, ${Wt(G[0])} found`)];if(G[0].zoom===void 0)return[new Ce(K,G,"object stop key must have zoom")];if(G[0].value===void 0)return[new Ce(K,G,"object stop key must have value")];if(g&&g>Di(G[0].zoom))return[new Ce(K,G[0].zoom,"stop zoom values must appear in ascending order")];Di(G[0].zoom)!==g&&(g=Di(G[0].zoom),u=void 0,_={}),B=B.concat(Sr({key:`${K}[0]`,value:G[0],valueSpec:{zoom:{}},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:_a,value:z}}))}else B=B.concat(z({key:`${K}[0]`,value:G[0],valueSpec:{},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec},G));return fi(Gn(G[1]))?B.concat([new Ce(`${K}[1]`,G[1],"expressions are not allowed in function stops.")]):B.concat(F.validateSpec({key:`${K}[1]`,value:G[1],valueSpec:e,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec}))}function z(F,B){const G=Wt(F.value),K=Di(F.value),te=F.value!==null?F.value:B;if(o){if(G!==o)return[new Ce(F.key,te,`${G} stop domain type must match previous stop domain type ${o}`)]}else o=G;if(G!=="number"&&G!=="string"&&G!=="boolean")return[new Ce(F.key,te,"stop domain value must be a number, string, or boolean")];if(G!=="number"&&r!=="categorical"){let he=`number expected, ${G} found`;return Ds(e)&&r===void 0&&(he+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ce(F.key,te,he)]}return r!=="categorical"||G!=="number"||isFinite(K)&&Math.floor(K)===K?r!=="categorical"&&G==="number"&&u!==void 0&&K<u?[new Ce(F.key,te,"stop domain values must appear in ascending order")]:(u=K,r==="categorical"&&K in _?[new Ce(F.key,te,"stop domain values must be unique")]:(_[K]=!0,[])):[new Ce(F.key,te,`integer expected, found ${K}`)]}}function Hn(i){const e=(i.expressionContext==="property"?Jc:us)(Gn(i.value),i.valueSpec);if(e.result==="error")return e.value.map(o=>new Ce(`${i.key}${o.key}`,i.value,o.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new Ce(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!po(r))return[new Ce(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!po(r))return[new Ce(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!fo(r,["zoom","feature-state"]))return[new Ce(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!ta(r))return[new Ce(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Zn(i){const e=i.key,r=i.value,o=i.valueSpec,u=[];return Array.isArray(o.values)?o.values.indexOf(Di(r))===-1&&u.push(new Ce(e,r,`expected one of [${o.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(o.values).indexOf(Di(r))===-1&&u.push(new Ce(e,r,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(r)} found`)),u}function zs(i){return da(Gn(i.value))?Hn(ui({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Sl(i)}function Sl(i){const e=i.value,r=i.key;if(Wt(e)!=="array")return[new Ce(r,e,`array expected, ${Wt(e)} found`)];const o=i.styleSpec;let u,g=[];if(e.length<1)return[new Ce(r,e,"filter array must have at least 1 element")];switch(g=g.concat(Zn({key:`${r}[0]`,value:e[0],valueSpec:o.filter_operator,style:i.style,styleSpec:i.styleSpec})),Di(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Di(e[1])==="$type"&&g.push(new Ce(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&g.push(new Ce(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=Wt(e[1]),u!=="string"&&g.push(new Ce(`${r}[1]`,e[1],`string expected, ${u} found`)));for(let _=2;_<e.length;_++)u=Wt(e[_]),Di(e[1])==="$type"?g=g.concat(Zn({key:`${r}[${_}]`,value:e[_],valueSpec:o.geometry_type,style:i.style,styleSpec:i.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&g.push(new Ce(`${r}[${_}]`,e[_],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let _=1;_<e.length;_++)g=g.concat(Sl({key:`${r}[${_}]`,value:e[_],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":u=Wt(e[1]),e.length!==2?g.push(new Ce(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="string"&&g.push(new Ce(`${r}[1]`,e[1],`string expected, ${u} found`));break;case"within":u=Wt(e[1]),e.length!==2?g.push(new Ce(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="object"&&g.push(new Ce(`${r}[1]`,e[1],`object expected, ${u} found`))}return g}function ya(i,e){const r=i.key,o=i.validateSpec,u=i.style,g=i.styleSpec,_=i.value,y=i.objectKey,S=g[`${e}_${i.layerType}`];if(!S)return[];const I=y.match(/^(.*)-transition$/);if(e==="paint"&&I&&S[I[1]]&&S[I[1]].transition)return o({key:r,value:_,valueSpec:g.transition,style:u,styleSpec:g});const P=i.valueSpec||S[y];if(!P)return[new Ce(r,_,`unknown property "${y}"`)];let C;if(Wt(_)==="string"&&Ds(P)&&!P.tokens&&(C=/^{([^}]+)}$/.exec(_)))return[new Ce(r,_,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(C[1])} }\`.`)];const z=[];return i.layerType==="symbol"&&(y==="text-field"&&u&&!u.glyphs&&z.push(new Ce(r,_,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&la(Gn(_))&&Di(_.type)==="identity"&&z.push(new Ce(r,_,'"text-font" does not support identity functions'))),z.concat(o({key:i.key,value:_,valueSpec:P,style:u,styleSpec:g,expressionContext:"property",propertyType:e,propertyKey:y}))}function Tl(i){return ya(i,"paint")}function El(i){return ya(i,"layout")}function yo(i){let e=[];const r=i.value,o=i.key,u=i.style,g=i.styleSpec;r.type||r.ref||e.push(new Ce(o,r,'either "type" or "ref" is required'));let _=Di(r.type);const y=Di(r.ref);if(r.id){const S=Di(r.id);for(let I=0;I<i.arrayIndex;I++){const P=u.layers[I];Di(P.id)===S&&e.push(new Ce(o,r.id,`duplicate layer id "${r.id}", previously used at line ${P.id.__line__}`))}}if("ref"in r){let S;["type","source","source-layer","filter","layout"].forEach(I=>{I in r&&e.push(new Ce(o,r[I],`"${I}" is prohibited for ref layers`))}),u.layers.forEach(I=>{Di(I.id)===y&&(S=I)}),S?S.ref?e.push(new Ce(o,r.ref,"ref cannot reference another ref layer")):_=Di(S.type):e.push(new Ce(o,r.ref,`ref layer "${y}" not found`))}else if(_!=="background")if(r.source){const S=u.sources&&u.sources[r.source],I=S&&Di(S.type);S?I==="vector"&&_==="raster"?e.push(new Ce(o,r.source,`layer "${r.id}" requires a raster source`)):I!=="raster-dem"&&_==="hillshade"?e.push(new Ce(o,r.source,`layer "${r.id}" requires a raster-dem source`)):I==="raster"&&_!=="raster"?e.push(new Ce(o,r.source,`layer "${r.id}" requires a vector source`)):I!=="vector"||r["source-layer"]?I==="raster-dem"&&_!=="hillshade"?e.push(new Ce(o,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):_!=="line"||!r.paint||!r.paint["line-gradient"]||I==="geojson"&&S.lineMetrics||e.push(new Ce(o,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Ce(o,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Ce(o,r.source,`source "${r.source}" not found`))}else e.push(new Ce(o,r,'missing required property "source"'));return e=e.concat(Sr({key:o,value:r,valueSpec:g.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${o}.type`,value:r.type,valueSpec:g.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:zs,layout:S=>Sr({layer:r,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":I=>El(ui({layerType:_},I))}}),paint:S=>Sr({layer:r,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":I=>Tl(ui({layerType:_},I))}})}})),e}function hs(i){const e=i.value,r=i.key,o=Wt(e);return o!=="string"?[new Ce(r,e,`string expected, ${o} found`)]:[]}const su={promoteId:function({key:i,value:e}){if(Wt(e)==="string")return hs({key:i,value:e});{const r=[];for(const o in e)r.push(...hs({key:`${i}.${o}`,value:e[o]}));return r}}};function ou(i){const e=i.value,r=i.key,o=i.styleSpec,u=i.style,g=i.validateSpec;if(!e.type)return[new Ce(r,e,'"type" is required')];const _=Di(e.type);let y;switch(_){case"vector":case"raster":return y=Sr({key:r,value:e,valueSpec:o[`source_${_.replace("-","_")}`],style:i.style,styleSpec:o,objectElementValidators:su,validateSpec:g}),y;case"raster-dem":return y=function(S){var I;const P=(I=S.sourceName)!==null&&I!==void 0?I:"",C=S.value,z=S.styleSpec,F=z.source_raster_dem,B=S.style;let G=[];const K=Wt(C);if(C===void 0)return G;if(K!=="object")return G.push(new Ce("source_raster_dem",C,`object expected, ${K} found`)),G;const te=Di(C.encoding)==="custom",he=["redFactor","greenFactor","blueFactor","baseShift"],re=S.value.encoding?`"${S.value.encoding}"`:"Default";for(const le in C)!te&&he.includes(le)?G.push(new Ce(le,C[le],`In "${P}": "${le}" is only valid when "encoding" is set to "custom". ${re} encoding found`)):F[le]?G=G.concat(S.validateSpec({key:le,value:C[le],valueSpec:F[le],validateSpec:S.validateSpec,style:B,styleSpec:z})):G.push(new Ce(le,C[le],`unknown property "${le}"`));return G}({sourceName:r,value:e,style:i.style,styleSpec:o,validateSpec:g}),y;case"geojson":if(y=Sr({key:r,value:e,valueSpec:o.source_geojson,style:u,styleSpec:o,validateSpec:g,objectElementValidators:su}),e.cluster)for(const S in e.clusterProperties){const[I,P]=e.clusterProperties[S],C=typeof I=="string"?[I,["accumulated"],["get",S]]:I;y.push(...Hn({key:`${r}.${S}.map`,value:P,validateSpec:g,expressionContext:"cluster-map"})),y.push(...Hn({key:`${r}.${S}.reduce`,value:C,validateSpec:g,expressionContext:"cluster-reduce"}))}return y;case"video":return Sr({key:r,value:e,valueSpec:o.source_video,style:u,validateSpec:g,styleSpec:o});case"image":return Sr({key:r,value:e,valueSpec:o.source_image,style:u,validateSpec:g,styleSpec:o});case"canvas":return[new Ce(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Zn({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:u,validateSpec:g,styleSpec:o})}}function au(i){const e=i.value,r=i.styleSpec,o=r.light,u=i.style;let g=[];const _=Wt(e);if(e===void 0)return g;if(_!=="object")return g=g.concat([new Ce("light",e,`object expected, ${_} found`)]),g;for(const y in e){const S=y.match(/^(.*)-transition$/);g=g.concat(S&&o[S[1]]&&o[S[1]].transition?i.validateSpec({key:y,value:e[y],valueSpec:r.transition,validateSpec:i.validateSpec,style:u,styleSpec:r}):o[y]?i.validateSpec({key:y,value:e[y],valueSpec:o[y],validateSpec:i.validateSpec,style:u,styleSpec:r}):[new Ce(y,e[y],`unknown property "${y}"`)])}return g}function lu(i){const e=i.value,r=i.styleSpec,o=r.sky,u=i.style,g=Wt(e);if(e===void 0)return[];if(g!=="object")return[new Ce("sky",e,`object expected, ${g} found`)];let _=[];for(const y in e)_=_.concat(o[y]?wn({key:y,value:e[y],valueSpec:o[y],style:u,styleSpec:r}):[new Ce(y,e[y],`unknown property "${y}"`)]);return _}function xo(i){const e=i.value,r=i.styleSpec,o=r.terrain,u=i.style;let g=[];const _=Wt(e);if(e===void 0)return g;if(_!=="object")return g=g.concat([new Ce("terrain",e,`object expected, ${_} found`)]),g;for(const y in e)g=g.concat(o[y]?i.validateSpec({key:y,value:e[y],valueSpec:o[y],validateSpec:i.validateSpec,style:u,styleSpec:r}):[new Ce(y,e[y],`unknown property "${y}"`)]);return g}function vo(i){let e=[];const r=i.value,o=i.key;if(Array.isArray(r)){const u=[],g=[];for(const _ in r)r[_].id&&u.includes(r[_].id)&&e.push(new Ce(o,r,`all the sprites' ids must be unique, but ${r[_].id} is duplicated`)),u.push(r[_].id),r[_].url&&g.includes(r[_].url)&&e.push(new Ce(o,r,`all the sprites' URLs must be unique, but ${r[_].url} is duplicated`)),g.push(r[_].url),e=e.concat(Sr({key:`${o}[${_}]`,value:r[_],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return hs({key:o,value:r})}const zr={"*":()=>[],array:wl,boolean:function(i){const e=i.value,r=i.key,o=Wt(e);return o!=="boolean"?[new Ce(r,e,`boolean expected, ${o} found`)]:[]},number:_a,color:function(i){const e=i.key,r=i.value,o=Wt(r);return o!=="string"?[new Ce(e,r,`color expected, ${o} found`)]:ai.parse(String(r))?[]:[new Ce(e,r,`color expected, "${r}" found`)]},constants:ru,enum:Zn,filter:zs,function:nu,layer:yo,object:Sr,source:ou,light:au,sky:lu,terrain:xo,string:hs,formatted:function(i){return hs(i).length===0?[]:Hn(i)},resolvedImage:function(i){return hs(i).length===0?[]:Hn(i)},padding:function(i){const e=i.key,r=i.value;if(Wt(r)==="array"){if(r.length<1||r.length>4)return[new Ce(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const o={type:"number"};let u=[];for(let g=0;g<r.length;g++)u=u.concat(i.validateSpec({key:`${e}[${g}]`,value:r[g],validateSpec:i.validateSpec,valueSpec:o}));return u}return _a({key:e,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const e=i.key,r=i.value,o=Wt(r),u=i.styleSpec;if(o!=="array"||r.length<1||r.length%2!=0)return[new Ce(e,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let g=[];for(let _=0;_<r.length;_+=2)g=g.concat(Zn({key:`${e}[${_}]`,value:r[_],valueSpec:u.layout_symbol["text-anchor"]})),g=g.concat(wl({key:`${e}[${_+1}]`,value:r[_+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:u}));return g},sprite:vo};function wn(i){const e=i.value,r=i.valueSpec,o=i.styleSpec;return i.validateSpec=wn,r.expression&&la(Di(e))?nu(i):r.expression&&fi(Gn(e))?Hn(i):r.type&&zr[r.type]?zr[r.type](i):Sr(ui({},i,{valueSpec:r.type?o[r.type]:r}))}function Il(i){const e=i.value,r=i.key,o=hs(i);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new Ce(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new Ce(r,e,'"glyphs" url must include a "{range}" token'))),o}function hn(i,e=ee){let r=[];return r=r.concat(wn({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:wn,objectElementValidators:{glyphs:Il,"*":()=>[]}})),i.constants&&(r=r.concat(ru({key:"constants",value:i.constants,style:i,styleSpec:e,validateSpec:wn}))),Rs(r)}function Sn(i){return function(e){return i({...e,validateSpec:wn})}}function Rs(i){return[].concat(i).sort((e,r)=>e.line-r.line)}function dn(i){return function(...e){return Rs(i.apply(this,e))}}hn.source=dn(Sn(ou)),hn.sprite=dn(Sn(vo)),hn.glyphs=dn(Sn(Il)),hn.light=dn(Sn(au)),hn.sky=dn(Sn(lu)),hn.terrain=dn(Sn(xo)),hn.layer=dn(Sn(yo)),hn.filter=dn(Sn(zs)),hn.paintProperty=dn(Sn(Tl)),hn.layoutProperty=dn(Sn(El));const ds=hn,td=ds.light,Al=ds.paintProperty,id=ds.layoutProperty;function Ls(i,e){let r=!1;if(e&&e.length)for(const o of e)i.fire(new ye(new Error(o.message))),r=!0;return r}class bo{constructor(e,r,o){const u=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const _=new Int32Array(this.arrayBuffer);e=_[0],this.d=(r=_[1])+2*(o=_[2]);for(let S=0;S<this.d*this.d;S++){const I=_[3+S],P=_[3+S+1];u.push(I===P?null:_.subarray(I,P))}const y=_[3+u.length+1];this.keys=_.subarray(_[3+u.length],y),this.bboxes=_.subarray(y),this.insert=this._insertReadonly}else{this.d=r+2*o;for(let _=0;_<this.d*this.d;_++)u.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=o,this.scale=r/e,this.uid=0;const g=o/r*e;this.min=-g,this.max=e+g}insert(e,r,o,u,g){this._forEachCell(r,o,u,g,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(g)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,o,u,g,_){this.cells[g].push(_)}query(e,r,o,u,g){const _=this.min,y=this.max;if(e<=_&&r<=_&&y<=o&&y<=u&&!g)return Array.prototype.slice.call(this.keys);{const S=[];return this._forEachCell(e,r,o,u,this._queryCell,S,{},g),S}}_queryCell(e,r,o,u,g,_,y,S){const I=this.cells[g];if(I!==null){const P=this.keys,C=this.bboxes;for(let z=0;z<I.length;z++){const F=I[z];if(y[F]===void 0){const B=4*F;(S?S(C[B+0],C[B+1],C[B+2],C[B+3]):e<=C[B+2]&&r<=C[B+3]&&o>=C[B+0]&&u>=C[B+1])?(y[F]=!0,_.push(P[F])):y[F]=!1}}}}_forEachCell(e,r,o,u,g,_,y,S){const I=this._convertToCellCoord(e),P=this._convertToCellCoord(r),C=this._convertToCellCoord(o),z=this._convertToCellCoord(u);for(let F=I;F<=C;F++)for(let B=P;B<=z;B++){const G=this.d*B+F;if((!S||S(this._convertFromCellCoord(F),this._convertFromCellCoord(B),this._convertFromCellCoord(F+1),this._convertFromCellCoord(B+1)))&&g.call(this,e,r,o,u,G,_,y,S))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let o=0;for(let _=0;_<this.cells.length;_++)o+=this.cells[_].length;const u=new Int32Array(r+o+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;let g=r;for(let _=0;_<e.length;_++){const y=e[_];u[3+_]=g,u.set(y,g),g+=y.length}return u[3+e.length]=g,u.set(this.keys,g),g+=this.keys.length,u[3+e.length+1]=g,u.set(this.bboxes,g),g+=this.bboxes.length,u.buffer}static serialize(e,r){const o=e.toArrayBuffer();return r&&r.push(o),{buffer:o}}static deserialize(e){return new bo(e.buffer)}}const Tn={};function rt(i,e,r={}){if(Tn[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),Tn[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}rt("Object",Object),rt("TransferableGridIndex",bo),rt("Color",ai),rt("Error",Error),rt("AJAXError",it),rt("ResolvedImage",rn),rt("StylePropertyFunction",ua),rt("StyleExpression",_i,{omit:["_evaluator"]}),rt("ZoomDependentExpression",xl),rt("ZoomConstantExpression",ca),rt("CompoundExpression",qr,{omit:["_evaluate"]});for(const i in Ms)Ms[i]._classRegistryKey||rt(`Expression_${i}`,Ms[i]);function xa(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Fs(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error)return i;if(xa(i)||Ht(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const o of i)r.push(Fs(o,e));return r}if(typeof i=="object"){const r=i.constructor,o=r._classRegistryKey;if(!o)throw new Error(`can't serialize object of unregistered class ${r.name}`);if(!Tn[o])throw new Error(`${o} is not registered.`);const u=r.serialize?r.serialize(i,e):{};if(r.serialize){if(e&&u===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const g in i){if(!i.hasOwnProperty(g)||Tn[o].omit.indexOf(g)>=0)continue;const _=i[g];u[g]=Tn[o].shallow.indexOf(g)>=0?_:Fs(_,e)}i instanceof Error&&(u.message=i.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(u.$name=o),u}throw new Error("can't serialize object of type "+typeof i)}function Os(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||xa(i)||Ht(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(Os);if(typeof i=="object"){const e=i.$name||"Object";if(!Tn[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=Tn[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const o=Object.create(r.prototype);for(const u of Object.keys(i)){if(u==="$name")continue;const g=i[u];o[u]=Tn[e].shallow.indexOf(u)>=0?g:Os(g)}return o}throw new Error("can't deserialize object of type "+typeof i)}class cu{constructor(){this.first=!0}update(e,r){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}const Xe={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Bs(i){for(const e of i)if(va(e.charCodeAt(0)))return!0;return!1}function uu(i){for(const e of i)if(!hu(e.charCodeAt(0)))return!1;return!0}function hu(i){return!(Xe.Arabic(i)||Xe["Arabic Supplement"](i)||Xe["Arabic Extended-A"](i)||Xe["Arabic Presentation Forms-A"](i)||Xe["Arabic Presentation Forms-B"](i))}function va(i){return!(i!==746&&i!==747&&(i<4352||!(Xe["Bopomofo Extended"](i)||Xe.Bopomofo(i)||Xe["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Xe["CJK Compatibility Ideographs"](i)||Xe["CJK Compatibility"](i)||Xe["CJK Radicals Supplement"](i)||Xe["CJK Strokes"](i)||!(!Xe["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Xe["CJK Unified Ideographs Extension A"](i)||Xe["CJK Unified Ideographs"](i)||Xe["Enclosed CJK Letters and Months"](i)||Xe["Hangul Compatibility Jamo"](i)||Xe["Hangul Jamo Extended-A"](i)||Xe["Hangul Jamo Extended-B"](i)||Xe["Hangul Jamo"](i)||Xe["Hangul Syllables"](i)||Xe.Hiragana(i)||Xe["Ideographic Description Characters"](i)||Xe.Kanbun(i)||Xe["Kangxi Radicals"](i)||Xe["Katakana Phonetic Extensions"](i)||Xe.Katakana(i)&&i!==12540||!(!Xe["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Xe["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Xe["Unified Canadian Aboriginal Syllabics"](i)||Xe["Unified Canadian Aboriginal Syllabics Extended"](i)||Xe["Vertical Forms"](i)||Xe["Yijing Hexagram Symbols"](i)||Xe["Yi Syllables"](i)||Xe["Yi Radicals"](i))))}function Pl(i){return!(va(i)||function(e){return!!(Xe["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Xe["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Xe["Letterlike Symbols"](e)||Xe["Number Forms"](e)||Xe["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Xe["Control Pictures"](e)&&e!==9251||Xe["Optical Character Recognition"](e)||Xe["Enclosed Alphanumerics"](e)||Xe["Geometric Shapes"](e)||Xe["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Xe["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Xe["CJK Symbols and Punctuation"](e)||Xe.Katakana(e)||Xe["Private Use Area"](e)||Xe["CJK Compatibility Forms"](e)||Xe["Small Form Variants"](e)||Xe["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function ba(i){return i>=1424&&i<=2303||Xe["Arabic Presentation Forms-A"](i)||Xe["Arabic Presentation Forms-B"](i)}function du(i,e){return!(!e&&ba(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Xe.Khmer(i))}function rd(i){for(const e of i)if(ba(e.charCodeAt(0)))return!0;return!1}const Wn=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Ti{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new cu,this.transition={})}isSupportedScript(e){return function(r,o){for(const u of r)if(!du(u.charCodeAt(0),o))return!1;return!0}(e,Wn.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*r}}}class wo{constructor(e,r){this.property=e,this.value=r,this.expression=function(o,u){if(la(o))return new ua(o,u);if(fi(o)){const g=Jc(o,u);if(g.result==="error")throw new Error(g.value.map(_=>`${_.key}: ${_.message}`).join(", "));return g.value}{let g=o;return u.type==="color"&&typeof o=="string"?g=ai.parse(o):u.type!=="padding"||typeof o!="number"&&!Array.isArray(o)?u.type==="variableAnchorOffsetCollection"&&Array.isArray(o)&&(g=tn.parse(o)):g=Dr.parse(o),{kind:"constant",evaluate:()=>g}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,o){return this.property.possiblyEvaluate(this,e,r,o)}}class wa{constructor(e){this.property=e,this.value=new wo(e,void 0)}transitioned(e,r){return new pu(this.property,this.value,r,vt({},e.transition,this.transition),e.now)}untransitioned(){return new pu(this.property,this.value,null,{},0)}}class Cl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return gt(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new wa(this._values[e].property)),this._values[e].value=new wo(this._values[e].property,r===null?void 0:gt(r))}getTransition(e){return gt(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new wa(this._values[e].property)),this._values[e].transition=gt(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(e[r]=o);const u=this.getTransition(r);u!==void 0&&(e[`${r}-transition`]=u)}return e}transitioned(e,r){const o=new fu(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].transitioned(e,r._values[u]);return o}untransitioned(){const e=new fu(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class pu{constructor(e,r,o,u,g){this.property=e,this.value=r,this.begin=g+u.delay||0,this.end=this.begin+u.duration||0,e.specification.transition&&(u.delay||u.duration)&&(this.prior=o)}possiblyEvaluate(e,r,o){const u=e.now||0,g=this.value.possiblyEvaluate(e,r,o),_=this.prior;if(_){if(u>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(u<this.begin)return _.possiblyEvaluate(e,r,o);{const y=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(e,r,o),g,function(S){if(S<=0)return 0;if(S>=1)return 1;const I=S*S,P=I*S;return 4*(S<.5?P:3*(S-I)+P-.75)}(y))}}return g}}class fu{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,o){const u=new So(this._properties);for(const g of Object.keys(this._values))u._values[g]=this._values[g].possiblyEvaluate(e,r,o);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class mu{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return gt(this._values[e].value)}setValue(e,r){this._values[e]=new wo(this._values[e].property,r===null?void 0:gt(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(e[r]=o)}return e}possiblyEvaluate(e,r,o){const u=new So(this._properties);for(const g of Object.keys(this._values))u._values[g]=this._values[g].possiblyEvaluate(e,r,o);return u}}class pn{constructor(e,r,o){this.property=e,this.value=r,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,o,u){return this.property.evaluate(this.value,this.parameters,e,r,o,u)}}class So{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class dt{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,o){const u=wr[this.specification.type];return u?u(e,r,o):e}}class xt{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,o,u){return new pn(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},o,u)}:e.expression,r)}interpolate(e,r,o){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new pn(this,{kind:"constant",value:void 0},e.parameters);const u=wr[this.specification.type];if(u){const g=u(e.value.value,r.value.value,o);return new pn(this,{kind:"constant",value:g},e.parameters)}return e}evaluate(e,r,o,u,g,_){return e.kind==="constant"?e.value:e.evaluate(r,o,u,g,_)}}class Sa extends xt{possiblyEvaluate(e,r,o,u){if(e.value===void 0)return new pn(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const g=e.expression.evaluate(r,null,{},o,u),_=e.property.specification.type==="resolvedImage"&&typeof g!="string"?g.name:g,y=this._calculate(_,_,_,r);return new pn(this,{kind:"constant",value:y},r)}if(e.expression.kind==="camera"){const g=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new pn(this,{kind:"constant",value:g},r)}return new pn(this,e.expression,r)}evaluate(e,r,o,u,g,_){if(e.kind==="source"){const y=e.evaluate(r,o,u,g,_);return this._calculate(y,y,y,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},o,u),e.evaluate({zoom:Math.floor(r.zoom)},o,u),e.evaluate({zoom:Math.floor(r.zoom)+1},o,u),r):e.value}_calculate(e,r,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:o,to:r}}interpolate(e){return e}}class To{constructor(e){this.specification=e}possiblyEvaluate(e,r,o,u){if(e.value!==void 0){if(e.expression.kind==="constant"){const g=e.expression.evaluate(r,null,{},o,u);return this._calculate(g,g,g,r)}return this._calculate(e.expression.evaluate(new Ti(Math.floor(r.zoom-1),r)),e.expression.evaluate(new Ti(Math.floor(r.zoom),r)),e.expression.evaluate(new Ti(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:o,to:r}}interpolate(e){return e}}class Ml{constructor(e){this.specification=e}possiblyEvaluate(e,r,o,u){return!!e.expression.evaluate(r,null,{},o,u)}interpolate(){return!1}}class Rr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const o=e[r];o.specification.overridable&&this.overridableProperties.push(r);const u=this.defaultPropertyValues[r]=new wo(o,void 0),g=this.defaultTransitionablePropertyValues[r]=new wa(o);this.defaultTransitioningPropertyValues[r]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=u.possiblyEvaluate({})}}}rt("DataDrivenProperty",xt),rt("DataConstantProperty",dt),rt("CrossFadedDataDrivenProperty",Sa),rt("CrossFadedProperty",To),rt("ColorRampProperty",Ml);const kl="-transition";class fn extends De{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new mu(r.layout)),r.paint)){this._transitionablePaint=new Cl(r.paint);for(const o in e.paint)this.setPaintProperty(o,e.paint[o],{validate:!1});for(const o in e.layout)this.setLayoutProperty(o,e.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new So(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,o={}){r!=null&&this._validate(id,`layers.${this.id}.layout.${e}`,e,r,o)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith(kl)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,o={}){if(r!=null&&this._validate(Al,`layers.${this.id}.paint.${e}`,e,r,o))return!1;if(e.endsWith(kl))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const u=this._transitionablePaint._values[e],g=u.property.specification["property-type"]==="cross-faded-data-driven",_=u.value.isDataDriven(),y=u.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const S=this._transitionablePaint._values[e].value;return S.isDataDriven()||_||g||this._handleOverridablePaintPropertyUpdate(e,y,S)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),bt(e,(r,o)=>!(r===void 0||o==="layout"&&!Object.keys(r).length||o==="paint"&&!Object.keys(r).length))}_validate(e,r,o,u,g={}){return(!g||g.validate!==!1)&&Ls(this,e.call(ds,{key:r,layerType:this.type,objectKey:o,value:u,styleSpec:ee,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof pn&&Ds(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const gu={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Eo{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class zi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ni(i,e=1){let r=0,o=0;return{members:i.map(u=>{const g=gu[u.type].BYTES_PER_ELEMENT,_=r=_u(r,Math.max(e,g)),y=u.components||1;return o=Math.max(o,g),r+=g*y,{name:u.name,type:u.type,components:y,offset:_}}),size:_u(r,Math.max(o,e)),alignment:e}}function _u(i,e){return Math.ceil(i/e)*e}class Io extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){const u=2*e;return this.int16[u+0]=r,this.int16[u+1]=o,e}}Io.prototype.bytesPerElement=4,rt("StructArrayLayout2i4",Io);class Dn extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,o)}emplace(e,r,o,u){const g=3*e;return this.int16[g+0]=r,this.int16[g+1]=o,this.int16[g+2]=u,e}}Dn.prototype.bytesPerElement=6,rt("StructArrayLayout3i6",Dn);class Dl extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,u){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,o,u)}emplace(e,r,o,u,g){const _=4*e;return this.int16[_+0]=r,this.int16[_+1]=o,this.int16[_+2]=u,this.int16[_+3]=g,e}}Dl.prototype.bytesPerElement=8,rt("StructArrayLayout4i8",Dl);class zl extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,u,g,_){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,o,u,g,_)}emplace(e,r,o,u,g,_,y){const S=6*e;return this.int16[S+0]=r,this.int16[S+1]=o,this.int16[S+2]=u,this.int16[S+3]=g,this.int16[S+4]=_,this.int16[S+5]=y,e}}zl.prototype.bytesPerElement=12,rt("StructArrayLayout2i4i12",zl);class Rl extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,u,g,_){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,o,u,g,_)}emplace(e,r,o,u,g,_,y){const S=4*e,I=8*e;return this.int16[S+0]=r,this.int16[S+1]=o,this.uint8[I+4]=u,this.uint8[I+5]=g,this.uint8[I+6]=_,this.uint8[I+7]=y,e}}Rl.prototype.bytesPerElement=8,rt("StructArrayLayout2i4ub8",Rl);class Ao extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){const u=2*e;return this.float32[u+0]=r,this.float32[u+1]=o,e}}Ao.prototype.bytesPerElement=8,rt("StructArrayLayout2f8",Ao);class Ta extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,u,g,_,y,S,I,P){const C=this.length;return this.resize(C+1),this.emplace(C,e,r,o,u,g,_,y,S,I,P)}emplace(e,r,o,u,g,_,y,S,I,P,C){const z=10*e;return this.uint16[z+0]=r,this.uint16[z+1]=o,this.uint16[z+2]=u,this.uint16[z+3]=g,this.uint16[z+4]=_,this.uint16[z+5]=y,this.uint16[z+6]=S,this.uint16[z+7]=I,this.uint16[z+8]=P,this.uint16[z+9]=C,e}}Ta.prototype.bytesPerElement=20,rt("StructArrayLayout10ui20",Ta);class Ll extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,u,g,_,y,S,I,P,C,z){const F=this.length;return this.resize(F+1),this.emplace(F,e,r,o,u,g,_,y,S,I,P,C,z)}emplace(e,r,o,u,g,_,y,S,I,P,C,z,F){const B=12*e;return this.int16[B+0]=r,this.int16[B+1]=o,this.int16[B+2]=u,this.int16[B+3]=g,this.uint16[B+4]=_,this.uint16[B+5]=y,this.uint16[B+6]=S,this.uint16[B+7]=I,this.int16[B+8]=P,this.int16[B+9]=C,this.int16[B+10]=z,this.int16[B+11]=F,e}}Ll.prototype.bytesPerElement=24,rt("StructArrayLayout4i4ui4i24",Ll);class Fl extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,o)}emplace(e,r,o,u){const g=3*e;return this.float32[g+0]=r,this.float32[g+1]=o,this.float32[g+2]=u,e}}Fl.prototype.bytesPerElement=12,rt("StructArrayLayout3f12",Fl);class zn extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}zn.prototype.bytesPerElement=4,rt("StructArrayLayout1ul4",zn);class Ea extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,u,g,_,y,S,I){const P=this.length;return this.resize(P+1),this.emplace(P,e,r,o,u,g,_,y,S,I)}emplace(e,r,o,u,g,_,y,S,I,P){const C=10*e,z=5*e;return this.int16[C+0]=r,this.int16[C+1]=o,this.int16[C+2]=u,this.int16[C+3]=g,this.int16[C+4]=_,this.int16[C+5]=y,this.uint32[z+3]=S,this.uint16[C+8]=I,this.uint16[C+9]=P,e}}Ea.prototype.bytesPerElement=20,rt("StructArrayLayout6i1ul2ui20",Ea);class Po extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,u,g,_){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,o,u,g,_)}emplace(e,r,o,u,g,_,y){const S=6*e;return this.int16[S+0]=r,this.int16[S+1]=o,this.int16[S+2]=u,this.int16[S+3]=g,this.int16[S+4]=_,this.int16[S+5]=y,e}}Po.prototype.bytesPerElement=12,rt("StructArrayLayout2i2i2i12",Po);class Ia extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,u,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,o,u,g)}emplace(e,r,o,u,g,_){const y=4*e,S=8*e;return this.float32[y+0]=r,this.float32[y+1]=o,this.float32[y+2]=u,this.int16[S+6]=g,this.int16[S+7]=_,e}}Ia.prototype.bytesPerElement=16,rt("StructArrayLayout2f1f2i16",Ia);class Co extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,u){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,o,u)}emplace(e,r,o,u,g){const _=12*e,y=3*e;return this.uint8[_+0]=r,this.uint8[_+1]=o,this.float32[y+1]=u,this.float32[y+2]=g,e}}Co.prototype.bytesPerElement=12,rt("StructArrayLayout2ub2f12",Co);class Aa extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,o)}emplace(e,r,o,u){const g=3*e;return this.uint16[g+0]=r,this.uint16[g+1]=o,this.uint16[g+2]=u,e}}Aa.prototype.bytesPerElement=6,rt("StructArrayLayout3ui6",Aa);class Ns extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,u,g,_,y,S,I,P,C,z,F,B,G,K,te){const he=this.length;return this.resize(he+1),this.emplace(he,e,r,o,u,g,_,y,S,I,P,C,z,F,B,G,K,te)}emplace(e,r,o,u,g,_,y,S,I,P,C,z,F,B,G,K,te,he){const re=24*e,le=12*e,be=48*e;return this.int16[re+0]=r,this.int16[re+1]=o,this.uint16[re+2]=u,this.uint16[re+3]=g,this.uint32[le+2]=_,this.uint32[le+3]=y,this.uint32[le+4]=S,this.uint16[re+10]=I,this.uint16[re+11]=P,this.uint16[re+12]=C,this.float32[le+7]=z,this.float32[le+8]=F,this.uint8[be+36]=B,this.uint8[be+37]=G,this.uint8[be+38]=K,this.uint32[le+10]=te,this.int16[re+22]=he,e}}Ns.prototype.bytesPerElement=48,rt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Ns);class ps extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,u,g,_,y,S,I,P,C,z,F,B,G,K,te,he,re,le,be,Ae,Je,at,Ye,Ze,$e,nt){const Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,e,r,o,u,g,_,y,S,I,P,C,z,F,B,G,K,te,he,re,le,be,Ae,Je,at,Ye,Ze,$e,nt)}emplace(e,r,o,u,g,_,y,S,I,P,C,z,F,B,G,K,te,he,re,le,be,Ae,Je,at,Ye,Ze,$e,nt,Ge){const Le=32*e,mt=16*e;return this.int16[Le+0]=r,this.int16[Le+1]=o,this.int16[Le+2]=u,this.int16[Le+3]=g,this.int16[Le+4]=_,this.int16[Le+5]=y,this.int16[Le+6]=S,this.int16[Le+7]=I,this.uint16[Le+8]=P,this.uint16[Le+9]=C,this.uint16[Le+10]=z,this.uint16[Le+11]=F,this.uint16[Le+12]=B,this.uint16[Le+13]=G,this.uint16[Le+14]=K,this.uint16[Le+15]=te,this.uint16[Le+16]=he,this.uint16[Le+17]=re,this.uint16[Le+18]=le,this.uint16[Le+19]=be,this.uint16[Le+20]=Ae,this.uint16[Le+21]=Je,this.uint16[Le+22]=at,this.uint32[mt+12]=Ye,this.float32[mt+13]=Ze,this.float32[mt+14]=$e,this.uint16[Le+30]=nt,this.uint16[Le+31]=Ge,e}}ps.prototype.bytesPerElement=64,rt("StructArrayLayout8i15ui1ul2f2ui64",ps);class Pa extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Pa.prototype.bytesPerElement=4,rt("StructArrayLayout1f4",Pa);class Ca extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,o)}emplace(e,r,o,u){const g=3*e;return this.uint16[6*e+0]=r,this.float32[g+1]=o,this.float32[g+2]=u,e}}Ca.prototype.bytesPerElement=12,rt("StructArrayLayout1ui2f12",Ca);class fs extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,o)}emplace(e,r,o,u){const g=4*e;return this.uint32[2*e+0]=r,this.uint16[g+2]=o,this.uint16[g+3]=u,e}}fs.prototype.bytesPerElement=8,rt("StructArrayLayout1ul2ui8",fs);class Ol extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){const u=2*e;return this.uint16[u+0]=r,this.uint16[u+1]=o,e}}Ol.prototype.bytesPerElement=4,rt("StructArrayLayout2ui4",Ol);class Bl extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}Bl.prototype.bytesPerElement=2,rt("StructArrayLayout1ui2",Bl);class Ma extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,u){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,o,u)}emplace(e,r,o,u,g){const _=4*e;return this.float32[_+0]=r,this.float32[_+1]=o,this.float32[_+2]=u,this.float32[_+3]=g,e}}Ma.prototype.bytesPerElement=16,rt("StructArrayLayout4f16",Ma);class yu extends Eo{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new N(this.anchorPointX,this.anchorPointY)}}yu.prototype.size=20;class p extends Ea{get(e){return new yu(this,e)}}rt("CollisionBoxArray",p);class t extends Eo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}t.prototype.size=48;class s extends Ns{get(e){return new t(this,e)}}rt("PlacedSymbolArray",s);class l extends Eo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}l.prototype.size=64;class c extends ps{get(e){return new l(this,e)}}rt("SymbolInstanceArray",c);class f extends Pa{getoffsetX(e){return this.float32[1*e+0]}}rt("GlyphOffsetArray",f);class b extends Dn{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}rt("SymbolLineVertexArray",b);class w extends Eo{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}w.prototype.size=12;class E extends Ca{get(e){return new w(this,e)}}rt("TextAnchorOffsetArray",E);class A extends Eo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}A.prototype.size=8;class M extends fs{get(e){return new A(this,e)}}rt("FeatureIndexArray",M);class k extends Io{}class O extends Io{}class W extends Io{}class Z extends zl{}class Y extends Rl{}class q extends Ao{}class se extends Ta{}class pe extends Ll{}class Q extends Fl{}class ce extends zn{}class fe extends Po{}class _e extends Co{}class ve extends Aa{}class ze extends Ol{}const ke=Ni([{name:"a_pos",components:2,type:"Int16"}],4),{members:Be}=ke;class Ue{constructor(e=[]){this.segments=e}prepareSegment(e,r,o,u){let g=this.segments[this.segments.length-1];return e>Ue.MAX_VERTEX_ARRAY_LENGTH&&ri(`Max vertices per segment is ${Ue.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!g||g.vertexLength+e>Ue.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==u)&&(g={vertexOffset:r.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},u!==void 0&&(g.sortKey=u),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,o,u){return new Ue([{vertexOffset:e,primitiveOffset:r,vertexLength:o,primitiveLength:u,vaos:{},sortKey:0}])}}function Mt(i,e){return 256*(i=lt(Math.floor(i),0,255))+lt(Math.floor(e),0,255)}Ue.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,rt("SegmentVector",Ue);const qe=Ni([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var St={exports:{}},kt={exports:{}};kt.exports=function(i,e){var r,o,u,g,_,y,S,I;for(o=i.length-(r=3&i.length),u=e,_=3432918353,y=461845907,I=0;I<o;)S=255&i.charCodeAt(I)|(255&i.charCodeAt(++I))<<8|(255&i.charCodeAt(++I))<<16|(255&i.charCodeAt(++I))<<24,++I,u=27492+(65535&(g=5*(65535&(u=(u^=S=(65535&(S=(S=(65535&S)*_+(((S>>>16)*_&65535)<<16)&4294967295)<<15|S>>>17))*y+(((S>>>16)*y&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(S=0,r){case 3:S^=(255&i.charCodeAt(I+2))<<16;case 2:S^=(255&i.charCodeAt(I+1))<<8;case 1:u^=S=(65535&(S=(S=(65535&(S^=255&i.charCodeAt(I)))*_+(((S>>>16)*_&65535)<<16)&4294967295)<<15|S>>>17))*y+(((S>>>16)*y&65535)<<16)&4294967295}return u^=i.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0};var Gt=kt.exports,Et={exports:{}};Et.exports=function(i,e){for(var r,o=i.length,u=e^o,g=0;o>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(g)|(255&i.charCodeAt(++g))<<8|(255&i.charCodeAt(++g))<<16|(255&i.charCodeAt(++g))<<24))+((1540483477*(r>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),o-=4,++g;switch(o){case 3:u^=(255&i.charCodeAt(g+2))<<16;case 2:u^=(255&i.charCodeAt(g+1))<<8;case 1:u=1540483477*(65535&(u^=255&i.charCodeAt(g)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0};var zt=Gt,Ot=Et.exports;St.exports=zt,St.exports.murmur3=zt,St.exports.murmur2=Ot;var Ri=R(St.exports);class ci{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,o,u){this.ids.push(Gr(e)),this.positions.push(r,o,u)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Gr(e);let o=0,u=this.ids.length-1;for(;o<u;){const _=o+u>>1;this.ids[_]>=r?u=_:o=_+1}const g=[];for(;this.ids[o]===r;)g.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return g}static serialize(e,r){const o=new Float64Array(e.ids),u=new Uint32Array(e.positions);return Qi(o,u,0,o.length-1),r&&r.push(o.buffer,u.buffer),{ids:o,positions:u}}static deserialize(e){const r=new ci;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function Gr(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Ri(String(i))}function Qi(i,e,r,o){for(;r<o;){const u=i[r+o>>1];let g=r-1,_=o+1;for(;;){do g++;while(i[g]<u);do _--;while(i[_]>u);if(g>=_)break;Pi(i,g,_),Pi(e,3*g,3*_),Pi(e,3*g+1,3*_+1),Pi(e,3*g+2,3*_+2)}_-r<o-_?(Qi(i,e,r,_),r=_+1):(Qi(i,e,_+1,o),o=_)}}function Pi(i,e,r){const o=i[e];i[e]=i[r],i[r]=o}rt("FeaturePositionMap",ci);class er{constructor(e,r){this.gl=e.gl,this.location=r}}class Hr extends er{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class En extends er{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Kn extends er{constructor(e,r){super(e,r),this.current=ai.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Mo=new Float32Array(16);function Xn(i){return[Mt(255*i.r,255*i.g),Mt(255*i.b,255*i.a)]}class In{constructor(e,r,o){this.value=e,this.uniformNames=r.map(u=>`u_${u}`),this.type=o}setUniform(e,r,o){e.set(o.constantOr(this.value))}getBinding(e,r,o){return this.type==="color"?new Kn(e,r):new Hr(e,r)}}class ji{constructor(e,r){this.uniformNames=r.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setUniform(e,r,o,u){const g=u==="u_pattern_to"?this.patternTo:u==="u_pattern_from"?this.patternFrom:u==="u_pixel_ratio_to"?this.pixelRatioTo:u==="u_pixel_ratio_from"?this.pixelRatioFrom:null;g&&e.set(g)}getBinding(e,r,o){return o.substr(0,9)==="u_pattern"?new En(e,r):new Hr(e,r)}}class Ci{constructor(e,r,o,u){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=r.map(g=>({name:`a_${g}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,r,o,u,g){const _=this.paintVertexArray.length,y=this.expression.evaluate(new Ti(0),r,{},u,[],g);this.paintVertexArray.resize(e),this._setPaintValue(_,e,y)}updatePaintArray(e,r,o,u){const g=this.expression.evaluate({zoom:0},o,u);this._setPaintValue(e,r,g)}_setPaintValue(e,r,o){if(this.type==="color"){const u=Xn(o);for(let g=e;g<r;g++)this.paintVertexArray.emplace(g,u[0],u[1])}else{for(let u=e;u<r;u++)this.paintVertexArray.emplace(u,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ei{constructor(e,r,o,u,g,_){this.expression=e,this.uniformNames=r.map(y=>`u_${y}_t`),this.type=o,this.useIntegerZoom=u,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=r.map(y=>({name:`a_${y}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(e,r,o,u,g){const _=this.expression.evaluate(new Ti(this.zoom),r,{},u,[],g),y=this.expression.evaluate(new Ti(this.zoom+1),r,{},u,[],g),S=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(S,e,_,y)}updatePaintArray(e,r,o,u){const g=this.expression.evaluate({zoom:this.zoom},o,u),_=this.expression.evaluate({zoom:this.zoom+1},o,u);this._setPaintValue(e,r,g,_)}_setPaintValue(e,r,o,u){if(this.type==="color"){const g=Xn(o),_=Xn(u);for(let y=e;y<r;y++)this.paintVertexArray.emplace(y,g[0],g[1],_[0],_[1])}else{for(let g=e;g<r;g++)this.paintVertexArray.emplace(g,o,u);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const o=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,u=lt(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(u)}getBinding(e,r,o){return new Hr(e,r)}}class nn{constructor(e,r,o,u,g,_){this.expression=e,this.type=r,this.useIntegerZoom=o,this.zoom=u,this.layerId=_,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(e,r,o){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(u,e,r.patterns&&r.patterns[this.layerId],o)}updatePaintArray(e,r,o,u,g){this._setPaintValues(e,r,o.patterns&&o.patterns[this.layerId],g)}_setPaintValues(e,r,o,u){if(!u||!o)return;const{min:g,mid:_,max:y}=o,S=u[g],I=u[_],P=u[y];if(S&&I&&P)for(let C=e;C<r;C++)this.zoomInPaintVertexArray.emplace(C,I.tl[0],I.tl[1],I.br[0],I.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],I.pixelRatio,S.pixelRatio),this.zoomOutPaintVertexArray.emplace(C,I.tl[0],I.tl[1],I.br[0],I.br[1],P.tl[0],P.tl[1],P.br[0],P.br[1],I.pixelRatio,P.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,qe.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,qe.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class qi{constructor(e,r,o){this.binders={},this._buffers=[];const u=[];for(const g in e.paint._values){if(!o(g))continue;const _=e.paint.get(g);if(!(_ instanceof pn&&Ds(_.property.specification)))continue;const y=sn(g,e.type),S=_.value,I=_.property.specification.type,P=_.property.useIntegerZoom,C=_.property.specification["property-type"],z=C==="cross-faded"||C==="cross-faded-data-driven";if(S.kind==="constant")this.binders[g]=z?new ji(S.value,y):new In(S.value,y,I),u.push(`/u_${g}`);else if(S.kind==="source"||z){const F=Gi(g,I,"source");this.binders[g]=z?new nn(S,I,P,r,F,e.id):new Ci(S,y,I,F),u.push(`/a_${g}`)}else{const F=Gi(g,I,"composite");this.binders[g]=new Ei(S,y,I,P,r,F),u.push(`/z_${g}`)}}this.cacheKey=u.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof Ci||r instanceof Ei?r.maxValue:0}populatePaintArrays(e,r,o,u,g){for(const _ in this.binders){const y=this.binders[_];(y instanceof Ci||y instanceof Ei||y instanceof nn)&&y.populatePaintArray(e,r,o,u,g)}}setConstantPatternPositions(e,r){for(const o in this.binders){const u=this.binders[o];u instanceof ji&&u.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,o,u,g){let _=!1;for(const y in e){const S=r.getPositions(y);for(const I of S){const P=o.feature(I.index);for(const C in this.binders){const z=this.binders[C];if((z instanceof Ci||z instanceof Ei||z instanceof nn)&&z.expression.isStateDependent===!0){const F=u.paint.get(C);z.expression=F.value,z.updatePaintArray(I.start,I.end,P,e[y],g),_=!0}}}}return _}defines(){const e=[];for(const r in this.binders){const o=this.binders[r];(o instanceof In||o instanceof ji)&&e.push(...o.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof Ci||o instanceof Ei)for(let u=0;u<o.paintVertexAttributes.length;u++)e.push(o.paintVertexAttributes[u].name);else if(o instanceof nn)for(let u=0;u<qe.members.length;u++)e.push(qe.members[u].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof In||o instanceof ji||o instanceof Ei)for(const u of o.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const o=[];for(const u in this.binders){const g=this.binders[u];if(g instanceof In||g instanceof ji||g instanceof Ei){for(const _ of g.uniformNames)if(r[_]){const y=g.getBinding(e,r[_],_);o.push({name:_,property:u,binding:y})}}}return o}setUniforms(e,r,o,u){for(const{name:g,property:_,binding:y}of r)this.binders[_].setUniform(y,u,o.get(_),g)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const o=this.binders[r];if(e&&o instanceof nn){const u=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(o instanceof Ci||o instanceof Ei)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const r in this.binders){const o=this.binders[r];(o instanceof Ci||o instanceof Ei||o instanceof nn)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof Ci||r instanceof Ei||r instanceof nn)&&r.destroy()}}}class Mi{constructor(e,r,o=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new qi(u,r,o);this.needsUpload=!1,this._featureMap=new ci,this._bufferOffset=0}populatePaintArrays(e,r,o,u,g,_){for(const y in this.programConfigurations)this.programConfigurations[y].populatePaintArrays(e,r,u,g,_);r.id!==void 0&&this._featureMap.add(r.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,o,u){for(const g of o)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(e,this._featureMap,r,g,u)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function sn(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function Gi(i,e,r){const o={color:{source:Ao,composite:Ma},number:{source:Pa,composite:Ao}},u=function(g){return{"line-pattern":{source:se,composite:se},"fill-pattern":{source:se,composite:se},"fill-extrusion-pattern":{source:se,composite:se}}[g]}(i);return u&&u[r]||o[e][r]}rt("ConstantBinder",In),rt("CrossFadedConstantBinder",ji),rt("SourceExpressionBinder",Ci),rt("CrossFadedCompositeBinder",nn),rt("CompositeExpressionBinder",Ei),rt("ProgramConfiguration",qi,{omit:["_buffers"]}),rt("ProgramConfigurationSet",Mi);const Oi=8192,Nl=Math.pow(2,14)-1,xu=-Nl-1;function ms(i){const e=Oi/i.extent,r=i.loadGeometry();for(let o=0;o<r.length;o++){const u=r[o];for(let g=0;g<u.length;g++){const _=u[g],y=Math.round(_.x*e),S=Math.round(_.y*e);_.x=lt(y,xu,Nl),_.y=lt(S,xu,Nl),(y<_.x||y>_.x+1||S<_.y||S>_.y+1)&&ri("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function gs(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?ms(i):[]}}function ka(i,e,r,o,u){i.emplaceBack(2*e+(o+1)/2,2*r+(u+1)/2)}class Yn{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new O,this.indexArray=new ve,this.segments=new Ue,this.programConfigurations=new Mi(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){const u=this.layers[0],g=[];let _=null,y=!1;u.type==="circle"&&(_=u.layout.get("circle-sort-key"),y=!_.isConstant());for(const{feature:S,id:I,index:P,sourceLayerIndex:C}of e){const z=this.layers[0]._featureFilter.needGeometry,F=gs(S,z);if(!this.layers[0]._featureFilter.filter(new Ti(this.zoom),F,o))continue;const B=y?_.evaluate(F,{},o):void 0,G={id:I,properties:S.properties,type:S.type,sourceLayerIndex:C,index:P,geometry:z?F.geometry:ms(S),patterns:{},sortKey:B};g.push(G)}y&&g.sort((S,I)=>S.sortKey-I.sortKey);for(const S of g){const{geometry:I,index:P,sourceLayerIndex:C}=S,z=e[P].feature;this.addFeature(S,I,P,o),r.featureIndex.insert(z,I,P,C,this.index)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Be),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,o,u){for(const g of r)for(const _ of g){const y=_.x,S=_.y;if(y<0||y>=Oi||S<0||S>=Oi)continue;const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),P=I.vertexLength;ka(this.layoutVertexArray,y,S,-1,-1),ka(this.layoutVertexArray,y,S,1,-1),ka(this.layoutVertexArray,y,S,1,1),ka(this.layoutVertexArray,y,S,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+3,P+2),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},u)}}function Vl(i,e){for(let r=0;r<i.length;r++)if(za(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(za(i,e[r]))return!0;return!!Da(i,e)}function vu(i,e,r){return!!za(i,e)||!!nd(e,i,r)}function $l(i,e){if(i.length===1)return cf(e,i[0]);for(let r=0;r<e.length;r++){const o=e[r];for(let u=0;u<o.length;u++)if(za(i,o[u]))return!0}for(let r=0;r<i.length;r++)if(cf(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Da(i,e[r]))return!0;return!1}function Ul(i,e,r){if(i.length>1){if(Da(i,e))return!0;for(let o=0;o<e.length;o++)if(nd(e[o],i,r))return!0}for(let o=0;o<i.length;o++)if(nd(i[o],e,r))return!0;return!1}function Da(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const o=i[r],u=i[r+1];for(let g=0;g<e.length-1;g++)if(jl(o,u,e[g],e[g+1]))return!0}return!1}function jl(i,e,r,o){return $t(i,r,o)!==$t(e,r,o)&&$t(i,e,r)!==$t(i,e,o)}function nd(i,e,r){const o=r*r;if(e.length===1)return i.distSqr(e[0])<o;for(let u=1;u<e.length;u++)if(lf(i,e[u-1],e[u])<o)return!0;return!1}function lf(i,e,r){const o=e.distSqr(r);if(o===0)return i.distSqr(e);const u=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/o;return i.distSqr(u<0?e:u>1?r:r.sub(e)._mult(u)._add(e))}function cf(i,e){let r,o,u,g=!1;for(let _=0;_<i.length;_++){r=i[_];for(let y=0,S=r.length-1;y<r.length;S=y++)o=r[y],u=r[S],o.y>e.y!=u.y>e.y&&e.x<(u.x-o.x)*(e.y-o.y)/(u.y-o.y)+o.x&&(g=!g)}return g}function za(i,e){let r=!1;for(let o=0,u=i.length-1;o<i.length;u=o++){const g=i[o],_=i[u];g.y>e.y!=_.y>e.y&&e.x<(_.x-g.x)*(e.y-g.y)/(_.y-g.y)+g.x&&(r=!r)}return r}function nx(i,e,r){const o=r[0],u=r[2];if(i.x<o.x&&e.x<o.x||i.x>u.x&&e.x>u.x||i.y<o.y&&e.y<o.y||i.y>u.y&&e.y>u.y)return!1;const g=$t(i,e,r[0]);return g!==$t(i,e,r[1])||g!==$t(i,e,r[2])||g!==$t(i,e,r[3])}function ql(i,e,r){const o=e.paint.get(i).value;return o.kind==="constant"?o.value:r.programConfigurations.get(e.id).getMaxValue(i)}function bu(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function wu(i,e,r,o,u){if(!e[0]&&!e[1])return i;const g=N.convert(e)._mult(u);r==="viewport"&&g._rotate(-o);const _=[];for(let y=0;y<i.length;y++)_.push(i[y].sub(g));return _}let uf,hf;rt("CircleBucket",Yn,{omit:["layers"]});var sx={get paint(){return hf=hf||new Rr({"circle-radius":new xt(ee.paint_circle["circle-radius"]),"circle-color":new xt(ee.paint_circle["circle-color"]),"circle-blur":new xt(ee.paint_circle["circle-blur"]),"circle-opacity":new xt(ee.paint_circle["circle-opacity"]),"circle-translate":new dt(ee.paint_circle["circle-translate"]),"circle-translate-anchor":new dt(ee.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new dt(ee.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new dt(ee.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new xt(ee.paint_circle["circle-stroke-width"]),"circle-stroke-color":new xt(ee.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new xt(ee.paint_circle["circle-stroke-opacity"])})},get layout(){return uf=uf||new Rr({"circle-sort-key":new xt(ee.layout_circle["circle-sort-key"])})}},Lr=1e-6,Ra=typeof Float32Array<"u"?Float32Array:Array;function sd(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function df(i,e,r){var o=e[0],u=e[1],g=e[2],_=e[3],y=e[4],S=e[5],I=e[6],P=e[7],C=e[8],z=e[9],F=e[10],B=e[11],G=e[12],K=e[13],te=e[14],he=e[15],re=r[0],le=r[1],be=r[2],Ae=r[3];return i[0]=re*o+le*y+be*C+Ae*G,i[1]=re*u+le*S+be*z+Ae*K,i[2]=re*g+le*I+be*F+Ae*te,i[3]=re*_+le*P+be*B+Ae*he,i[4]=(re=r[4])*o+(le=r[5])*y+(be=r[6])*C+(Ae=r[7])*G,i[5]=re*u+le*S+be*z+Ae*K,i[6]=re*g+le*I+be*F+Ae*te,i[7]=re*_+le*P+be*B+Ae*he,i[8]=(re=r[8])*o+(le=r[9])*y+(be=r[10])*C+(Ae=r[11])*G,i[9]=re*u+le*S+be*z+Ae*K,i[10]=re*g+le*I+be*F+Ae*te,i[11]=re*_+le*P+be*B+Ae*he,i[12]=(re=r[12])*o+(le=r[13])*y+(be=r[14])*C+(Ae=r[15])*G,i[13]=re*u+le*S+be*z+Ae*K,i[14]=re*g+le*I+be*F+Ae*te,i[15]=re*_+le*P+be*B+Ae*he,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var Gl,ox=df;function Su(i,e,r){var o=e[0],u=e[1],g=e[2],_=e[3];return i[0]=r[0]*o+r[4]*u+r[8]*g+r[12]*_,i[1]=r[1]*o+r[5]*u+r[9]*g+r[13]*_,i[2]=r[2]*o+r[6]*u+r[10]*g+r[14]*_,i[3]=r[3]*o+r[7]*u+r[11]*g+r[15]*_,i}Gl=new Ra(4),Ra!=Float32Array&&(Gl[0]=0,Gl[1]=0,Gl[2]=0,Gl[3]=0);class ax extends fn{constructor(e){super(e,sx)}createBucket(e){return new Yn(e)}queryRadius(e){const r=e;return ql("circle-radius",this,r)+ql("circle-stroke-width",this,r)+bu(this.paint.get("circle-translate"))}queryIntersectsFeature(e,r,o,u,g,_,y,S){const I=wu(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),_.angle,y),P=this.paint.get("circle-radius").evaluate(r,o)+this.paint.get("circle-stroke-width").evaluate(r,o),C=this.paint.get("circle-pitch-alignment")==="map",z=C?I:function(B,G){return B.map(K=>pf(K,G))}(I,S),F=C?P*y:P;for(const B of u)for(const G of B){const K=C?G:pf(G,S);let te=F;const he=Su([],[G.x,G.y,0,1],S);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?te*=he[3]/_.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(te*=_.cameraToCenterDistance/he[3]),vu(z,K,te))return!0}return!1}}function pf(i,e){const r=Su([],[i.x,i.y,0,1],e);return new N(r[0]/r[3],r[1]/r[3])}class ff extends Yn{}let mf;rt("HeatmapBucket",ff,{omit:["layers"]});var lx={get paint(){return mf=mf||new Rr({"heatmap-radius":new xt(ee.paint_heatmap["heatmap-radius"]),"heatmap-weight":new xt(ee.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new dt(ee.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ml(ee.paint_heatmap["heatmap-color"]),"heatmap-opacity":new dt(ee.paint_heatmap["heatmap-opacity"])})}};function od(i,{width:e,height:r},o,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*r*o)throw new RangeError(`mismatched image size. expected: ${u.length} but got: ${e*r*o}`)}else u=new Uint8Array(e*r*o);return i.width=e,i.height=r,i.data=u,i}function gf(i,{width:e,height:r},o){if(e===i.width&&r===i.height)return;const u=od({},{width:e,height:r},o);ad(i,u,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},o),i.width=e,i.height=r,i.data=u.data}function ad(i,e,r,o,u,g){if(u.width===0||u.height===0)return e;if(u.width>i.width||u.height>i.height||r.x>i.width-u.width||r.y>i.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||o.x>e.width-u.width||o.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const _=i.data,y=e.data;if(_===y)throw new Error("srcData equals dstData, so image is already copied");for(let S=0;S<u.height;S++){const I=((r.y+S)*i.width+r.x)*g,P=((o.y+S)*e.width+o.x)*g;for(let C=0;C<u.width*g;C++)y[P+C]=_[I+C]}return e}class Hl{constructor(e,r){od(this,e,1,r)}resize(e){gf(this,e,1)}clone(){return new Hl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,o,u,g){ad(e,r,o,u,g,1)}}class mn{constructor(e,r){od(this,e,4,r)}resize(e){gf(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new mn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,o,u,g){ad(e,r,o,u,g,4)}}function _f(i){const e={},r=i.resolution||256,o=i.clips?i.clips.length:1,u=i.image||new mn({width:r,height:o});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const g=(_,y,S)=>{e[i.evaluationKey]=S;const I=i.expression.evaluate(e);u.data[_+y+0]=Math.floor(255*I.r/I.a),u.data[_+y+1]=Math.floor(255*I.g/I.a),u.data[_+y+2]=Math.floor(255*I.b/I.a),u.data[_+y+3]=Math.floor(255*I.a)};if(i.clips)for(let _=0,y=0;_<o;++_,y+=4*r)for(let S=0,I=0;S<r;S++,I+=4){const P=S/(r-1),{start:C,end:z}=i.clips[_];g(y,I,C*(1-P)+z*P)}else for(let _=0,y=0;_<r;_++,y+=4)g(0,y,_/(r-1));return u}rt("AlphaImage",Hl),rt("RGBAImage",mn);class cx extends fn{createBucket(e){return new ff(e)}constructor(e){super(e,lx),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=_f({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let yf;var ux={get paint(){return yf=yf||new Rr({"hillshade-illumination-direction":new dt(ee.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new dt(ee.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new dt(ee.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new dt(ee.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new dt(ee.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new dt(ee.paint_hillshade["hillshade-accent-color"])})}};class hx extends fn{constructor(e){super(e,ux)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const dx=Ni([{name:"a_pos",components:2,type:"Int16"}],4),{members:px}=dx;var ld={exports:{}};function Tu(i,e,r){r=r||2;var o,u,g,_,y,S,I,P=e&&e.length,C=P?e[0]*r:i.length,z=xf(i,0,C,r,!0),F=[];if(!z||z.next===z.prev)return F;if(P&&(z=function(G,K,te,he){var re,le,be,Ae=[];for(re=0,le=K.length;re<le;re++)(be=xf(G,K[re]*he,re<le-1?K[re+1]*he:G.length,he,!1))===be.next&&(be.steiner=!0),Ae.push(bx(be));for(Ae.sort(yx),re=0;re<Ae.length;re++)te=xx(Ae[re],te);return te}(i,e,z,r)),i.length>80*r){o=g=i[0],u=_=i[1];for(var B=r;B<C;B+=r)(y=i[B])<o&&(o=y),(S=i[B+1])<u&&(u=S),y>g&&(g=y),S>_&&(_=S);I=(I=Math.max(g-o,_-u))!==0?32767/I:0}return Zl(z,F,r,o,u,I,0),F}function xf(i,e,r,o,u){var g,_;if(u===hd(i,e,r,o)>0)for(g=e;g<r;g+=o)_=wf(g,i[g],i[g+1],_);else for(g=r-o;g>=e;g-=o)_=wf(g,i[g],i[g+1],_);return _&&Eu(_,_.next)&&(Kl(_),_=_.next),_}function ko(i,e){if(!i)return i;e||(e=i);var r,o=i;do if(r=!1,o.steiner||!Eu(o,o.next)&&Vi(o.prev,o,o.next)!==0)o=o.next;else{if(Kl(o),(o=e=o.prev)===o.next)break;r=!0}while(r||o!==e);return e}function Zl(i,e,r,o,u,g,_){if(i){!_&&g&&function(P,C,z,F){var B=P;do B.z===0&&(B.z=cd(B.x,B.y,C,z,F)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==P);B.prevZ.nextZ=null,B.prevZ=null,function(G){var K,te,he,re,le,be,Ae,Je,at=1;do{for(te=G,G=null,le=null,be=0;te;){for(be++,he=te,Ae=0,K=0;K<at&&(Ae++,he=he.nextZ);K++);for(Je=at;Ae>0||Je>0&&he;)Ae!==0&&(Je===0||!he||te.z<=he.z)?(re=te,te=te.nextZ,Ae--):(re=he,he=he.nextZ,Je--),le?le.nextZ=re:G=re,re.prevZ=le,le=re;te=he}le.nextZ=null,at*=2}while(be>1)}(B)}(i,o,u,g);for(var y,S,I=i;i.prev!==i.next;)if(y=i.prev,S=i.next,g?mx(i,o,u,g):fx(i))e.push(y.i/r|0),e.push(i.i/r|0),e.push(S.i/r|0),Kl(i),i=S.next,I=S.next;else if((i=S)===I){_?_===1?Zl(i=gx(ko(i),e,r),e,r,o,u,g,2):_===2&&_x(i,e,r,o,u,g):Zl(ko(i),e,r,o,u,g,1);break}}}function fx(i){var e=i.prev,r=i,o=i.next;if(Vi(e,r,o)>=0)return!1;for(var u=e.x,g=r.x,_=o.x,y=e.y,S=r.y,I=o.y,P=u<g?u<_?u:_:g<_?g:_,C=y<S?y<I?y:I:S<I?S:I,z=u>g?u>_?u:_:g>_?g:_,F=y>S?y>I?y:I:S>I?S:I,B=o.next;B!==e;){if(B.x>=P&&B.x<=z&&B.y>=C&&B.y<=F&&La(u,y,g,S,_,I,B.x,B.y)&&Vi(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function mx(i,e,r,o){var u=i.prev,g=i,_=i.next;if(Vi(u,g,_)>=0)return!1;for(var y=u.x,S=g.x,I=_.x,P=u.y,C=g.y,z=_.y,F=y<S?y<I?y:I:S<I?S:I,B=P<C?P<z?P:z:C<z?C:z,G=y>S?y>I?y:I:S>I?S:I,K=P>C?P>z?P:z:C>z?C:z,te=cd(F,B,e,r,o),he=cd(G,K,e,r,o),re=i.prevZ,le=i.nextZ;re&&re.z>=te&&le&&le.z<=he;){if(re.x>=F&&re.x<=G&&re.y>=B&&re.y<=K&&re!==u&&re!==_&&La(y,P,S,C,I,z,re.x,re.y)&&Vi(re.prev,re,re.next)>=0||(re=re.prevZ,le.x>=F&&le.x<=G&&le.y>=B&&le.y<=K&&le!==u&&le!==_&&La(y,P,S,C,I,z,le.x,le.y)&&Vi(le.prev,le,le.next)>=0))return!1;le=le.nextZ}for(;re&&re.z>=te;){if(re.x>=F&&re.x<=G&&re.y>=B&&re.y<=K&&re!==u&&re!==_&&La(y,P,S,C,I,z,re.x,re.y)&&Vi(re.prev,re,re.next)>=0)return!1;re=re.prevZ}for(;le&&le.z<=he;){if(le.x>=F&&le.x<=G&&le.y>=B&&le.y<=K&&le!==u&&le!==_&&La(y,P,S,C,I,z,le.x,le.y)&&Vi(le.prev,le,le.next)>=0)return!1;le=le.nextZ}return!0}function gx(i,e,r){var o=i;do{var u=o.prev,g=o.next.next;!Eu(u,g)&&vf(u,o,o.next,g)&&Wl(u,g)&&Wl(g,u)&&(e.push(u.i/r|0),e.push(o.i/r|0),e.push(g.i/r|0),Kl(o),Kl(o.next),o=i=g),o=o.next}while(o!==i);return ko(o)}function _x(i,e,r,o,u,g){var _=i;do{for(var y=_.next.next;y!==_.prev;){if(_.i!==y.i&&wx(_,y)){var S=bf(_,y);return _=ko(_,_.next),S=ko(S,S.next),Zl(_,e,r,o,u,g,0),void Zl(S,e,r,o,u,g,0)}y=y.next}_=_.next}while(_!==i)}function yx(i,e){return i.x-e.x}function xx(i,e){var r=function(u,g){var _,y=g,S=u.x,I=u.y,P=-1/0;do{if(I<=y.y&&I>=y.next.y&&y.next.y!==y.y){var C=y.x+(I-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(C<=S&&C>P&&(P=C,_=y.x<y.next.x?y:y.next,C===S))return _}y=y.next}while(y!==g);if(!_)return null;var z,F=_,B=_.x,G=_.y,K=1/0;y=_;do S>=y.x&&y.x>=B&&S!==y.x&&La(I<G?S:P,I,B,G,I<G?P:S,I,y.x,y.y)&&(z=Math.abs(I-y.y)/(S-y.x),Wl(y,u)&&(z<K||z===K&&(y.x>_.x||y.x===_.x&&vx(_,y)))&&(_=y,K=z)),y=y.next;while(y!==F);return _}(i,e);if(!r)return e;var o=bf(r,i);return ko(o,o.next),ko(r,r.next)}function vx(i,e){return Vi(i.prev,i,e.prev)<0&&Vi(e.next,i,i.next)<0}function cd(i,e,r,o,u){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*u|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function bx(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function La(i,e,r,o,u,g,_,y){return(u-_)*(e-y)>=(i-_)*(g-y)&&(i-_)*(o-y)>=(r-_)*(e-y)&&(r-_)*(g-y)>=(u-_)*(o-y)}function wx(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,o){var u=r;do{if(u.i!==r.i&&u.next.i!==r.i&&u.i!==o.i&&u.next.i!==o.i&&vf(u,u.next,r,o))return!0;u=u.next}while(u!==r);return!1}(i,e)&&(Wl(i,e)&&Wl(e,i)&&function(r,o){var u=r,g=!1,_=(r.x+o.x)/2,y=(r.y+o.y)/2;do u.y>y!=u.next.y>y&&u.next.y!==u.y&&_<(u.next.x-u.x)*(y-u.y)/(u.next.y-u.y)+u.x&&(g=!g),u=u.next;while(u!==r);return g}(i,e)&&(Vi(i.prev,i,e.prev)||Vi(i,e.prev,e))||Eu(i,e)&&Vi(i.prev,i,i.next)>0&&Vi(e.prev,e,e.next)>0)}function Vi(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function Eu(i,e){return i.x===e.x&&i.y===e.y}function vf(i,e,r,o){var u=Au(Vi(i,e,r)),g=Au(Vi(i,e,o)),_=Au(Vi(r,o,i)),y=Au(Vi(r,o,e));return u!==g&&_!==y||!(u!==0||!Iu(i,r,e))||!(g!==0||!Iu(i,o,e))||!(_!==0||!Iu(r,i,o))||!(y!==0||!Iu(r,e,o))}function Iu(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function Au(i){return i>0?1:i<0?-1:0}function Wl(i,e){return Vi(i.prev,i,i.next)<0?Vi(i,e,i.next)>=0&&Vi(i,i.prev,e)>=0:Vi(i,e,i.prev)<0||Vi(i,i.next,e)<0}function bf(i,e){var r=new ud(i.i,i.x,i.y),o=new ud(e.i,e.x,e.y),u=i.next,g=e.prev;return i.next=e,e.prev=i,r.next=u,u.prev=r,o.next=r,r.prev=o,g.next=o,o.prev=g,o}function wf(i,e,r,o){var u=new ud(i,e,r);return o?(u.next=o.next,u.prev=o,o.next.prev=u,o.next=u):(u.prev=u,u.next=u),u}function Kl(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function ud(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function hd(i,e,r,o){for(var u=0,g=e,_=r-o;g<r;g+=o)u+=(i[_]-i[g])*(i[g+1]+i[_+1]),_=g;return u}ld.exports=Tu,ld.exports.default=Tu,Tu.deviation=function(i,e,r,o){var u=e&&e.length,g=Math.abs(hd(i,0,u?e[0]*r:i.length,r));if(u)for(var _=0,y=e.length;_<y;_++)g-=Math.abs(hd(i,e[_]*r,_<y-1?e[_+1]*r:i.length,r));var S=0;for(_=0;_<o.length;_+=3){var I=o[_]*r,P=o[_+1]*r,C=o[_+2]*r;S+=Math.abs((i[I]-i[C])*(i[P+1]-i[I+1])-(i[I]-i[P])*(i[C+1]-i[I+1]))}return g===0&&S===0?0:Math.abs((S-g)/g)},Tu.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},o=0,u=0;u<i.length;u++){for(var g=0;g<i[u].length;g++)for(var _=0;_<e;_++)r.vertices.push(i[u][g][_]);u>0&&r.holes.push(o+=i[u-1].length)}return r};var Sf=R(ld.exports);function Sx(i,e,r,o,u){Tf(i,e,r||0,o||i.length-1,u||Tx)}function Tf(i,e,r,o,u){for(;o>r;){if(o-r>600){var g=o-r+1,_=e-r+1,y=Math.log(g),S=.5*Math.exp(2*y/3),I=.5*Math.sqrt(y*S*(g-S)/g)*(_-g/2<0?-1:1);Tf(i,e,Math.max(r,Math.floor(e-_*S/g+I)),Math.min(o,Math.floor(e+(g-_)*S/g+I)),u)}var P=i[e],C=r,z=o;for(Xl(i,r,e),u(i[o],P)>0&&Xl(i,r,o);C<z;){for(Xl(i,C,z),C++,z--;u(i[C],P)<0;)C++;for(;u(i[z],P)>0;)z--}u(i[r],P)===0?Xl(i,r,z):Xl(i,++z,o),z<=e&&(r=z+1),e<=z&&(o=z-1)}}function Xl(i,e,r){var o=i[e];i[e]=i[r],i[r]=o}function Tx(i,e){return i<e?-1:i>e?1:0}function dd(i,e){const r=i.length;if(r<=1)return[i];const o=[];let u,g;for(let _=0;_<r;_++){const y=Ki(i[_]);y!==0&&(i[_].area=Math.abs(y),g===void 0&&(g=y<0),g===y<0?(u&&o.push(u),u=[i[_]]):u.push(i[_]))}if(u&&o.push(u),e>1)for(let _=0;_<o.length;_++)o[_].length<=e||(Sx(o[_],e,1,o[_].length-1,Ex),o[_]=o[_].slice(0,e));return o}function Ex(i,e){return e.area-i.area}function pd(i,e,r){const o=r.patternDependencies;let u=!1;for(const g of e){const _=g.paint.get(`${i}-pattern`);_.isConstant()||(u=!0);const y=_.constantOr(null);y&&(u=!0,o[y.to]=!0,o[y.from]=!0)}return u}function fd(i,e,r,o,u){const g=u.patternDependencies;for(const _ of e){const y=_.paint.get(`${i}-pattern`).value;if(y.kind!=="constant"){let S=y.evaluate({zoom:o-1},r,{},u.availableImages),I=y.evaluate({zoom:o},r,{},u.availableImages),P=y.evaluate({zoom:o+1},r,{},u.availableImages);S=S&&S.name?S.name:S,I=I&&I.name?I.name:I,P=P&&P.name?P.name:P,g[S]=!0,g[I]=!0,g[P]=!0,r.patterns[_.id]={min:S,mid:I,max:P}}}return r}class md{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new W,this.indexArray=new ve,this.indexArray2=new ze,this.programConfigurations=new Mi(e.layers,e.zoom),this.segments=new Ue,this.segments2=new Ue,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){this.hasPattern=pd("fill",this.layers,r);const u=this.layers[0].layout.get("fill-sort-key"),g=!u.isConstant(),_=[];for(const{feature:y,id:S,index:I,sourceLayerIndex:P}of e){const C=this.layers[0]._featureFilter.needGeometry,z=gs(y,C);if(!this.layers[0]._featureFilter.filter(new Ti(this.zoom),z,o))continue;const F=g?u.evaluate(z,{},o,r.availableImages):void 0,B={id:S,properties:y.properties,type:y.type,sourceLayerIndex:P,index:I,geometry:C?z.geometry:ms(y),patterns:{},sortKey:F};_.push(B)}g&&_.sort((y,S)=>y.sortKey-S.sortKey);for(const y of _){const{geometry:S,index:I,sourceLayerIndex:P}=y;if(this.hasPattern){const C=fd("fill",this.layers,y,this.zoom,r);this.patternFeatures.push(C)}else this.addFeature(y,S,I,o,{});r.featureIndex.insert(e[I].feature,S,I,P,this.index)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,o)}addFeatures(e,r,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,r,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,px),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,o,u,g){for(const _ of dd(r,500)){let y=0;for(const F of _)y+=F.length;const S=this.segments.prepareSegment(y,this.layoutVertexArray,this.indexArray),I=S.vertexLength,P=[],C=[];for(const F of _){if(F.length===0)continue;F!==_[0]&&C.push(P.length/2);const B=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),G=B.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(G+F.length-1,G),P.push(F[0].x),P.push(F[0].y);for(let K=1;K<F.length;K++)this.layoutVertexArray.emplaceBack(F[K].x,F[K].y),this.indexArray2.emplaceBack(G+K-1,G+K),P.push(F[K].x),P.push(F[K].y);B.vertexLength+=F.length,B.primitiveLength+=F.length}const z=Sf(P,C);for(let F=0;F<z.length;F+=3)this.indexArray.emplaceBack(I+z[F],I+z[F+1],I+z[F+2]);S.vertexLength+=y,S.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,g,u)}}let Ef,If;rt("FillBucket",md,{omit:["layers","patternFeatures"]});var Ix={get paint(){return If=If||new Rr({"fill-antialias":new dt(ee.paint_fill["fill-antialias"]),"fill-opacity":new xt(ee.paint_fill["fill-opacity"]),"fill-color":new xt(ee.paint_fill["fill-color"]),"fill-outline-color":new xt(ee.paint_fill["fill-outline-color"]),"fill-translate":new dt(ee.paint_fill["fill-translate"]),"fill-translate-anchor":new dt(ee.paint_fill["fill-translate-anchor"]),"fill-pattern":new Sa(ee.paint_fill["fill-pattern"])})},get layout(){return Ef=Ef||new Rr({"fill-sort-key":new xt(ee.layout_fill["fill-sort-key"])})}};class Ax extends fn{constructor(e){super(e,Ix)}recalculate(e,r){super.recalculate(e,r);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new md(e)}queryRadius(){return bu(this.paint.get("fill-translate"))}queryIntersectsFeature(e,r,o,u,g,_,y){return $l(wu(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),_.angle,y),u)}isTileClipped(){return!0}}const Px=Ni([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Cx=Ni([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Mx}=Px;var Vs={},kx=j,Af=Fa;function Fa(i,e,r,o,u){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=o,this._values=u,i.readFields(Dx,this,e)}function Dx(i,e,r){i==1?e.id=r.readVarint():i==2?function(o,u){for(var g=o.readVarint()+o.pos;o.pos<g;){var _=u._keys[o.readVarint()],y=u._values[o.readVarint()];u.properties[_]=y}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function zx(i){for(var e,r,o=0,u=0,g=i.length,_=g-1;u<g;_=u++)o+=((r=i[_]).x-(e=i[u]).x)*(e.y+r.y);return o}Fa.types=["Unknown","Point","LineString","Polygon"],Fa.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,o=1,u=0,g=0,_=0,y=[];i.pos<r;){if(u<=0){var S=i.readVarint();o=7&S,u=S>>3}if(u--,o===1||o===2)g+=i.readSVarint(),_+=i.readSVarint(),o===1&&(e&&y.push(e),e=[]),e.push(new kx(g,_));else{if(o!==7)throw new Error("unknown command "+o);e&&e.push(e[0].clone())}}return e&&y.push(e),y},Fa.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,o=0,u=0,g=0,_=1/0,y=-1/0,S=1/0,I=-1/0;i.pos<e;){if(o<=0){var P=i.readVarint();r=7&P,o=P>>3}if(o--,r===1||r===2)(u+=i.readSVarint())<_&&(_=u),u>y&&(y=u),(g+=i.readSVarint())<S&&(S=g),g>I&&(I=g);else if(r!==7)throw new Error("unknown command "+r)}return[_,S,y,I]},Fa.prototype.toGeoJSON=function(i,e,r){var o,u,g=this.extent*Math.pow(2,r),_=this.extent*i,y=this.extent*e,S=this.loadGeometry(),I=Fa.types[this.type];function P(F){for(var B=0;B<F.length;B++){var G=F[B];F[B]=[360*(G.x+_)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(G.y+y)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var C=[];for(o=0;o<S.length;o++)C[o]=S[o][0];P(S=C);break;case 2:for(o=0;o<S.length;o++)P(S[o]);break;case 3:for(S=function(F){var B=F.length;if(B<=1)return[F];for(var G,K,te=[],he=0;he<B;he++){var re=zx(F[he]);re!==0&&(K===void 0&&(K=re<0),K===re<0?(G&&te.push(G),G=[F[he]]):G.push(F[he]))}return G&&te.push(G),te}(S),o=0;o<S.length;o++)for(u=0;u<S[o].length;u++)P(S[o][u])}S.length===1?S=S[0]:I="Multi"+I;var z={type:"Feature",geometry:{type:I,coordinates:S},properties:this.properties};return"id"in this&&(z.id=this.id),z};var Rx=Af,Pf=Cf;function Cf(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Lx,this,e),this.length=this._features.length}function Lx(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(o){for(var u=null,g=o.readVarint()+o.pos;o.pos<g;){var _=o.readVarint()>>3;u=_===1?o.readString():_===2?o.readFloat():_===3?o.readDouble():_===4?o.readVarint64():_===5?o.readVarint():_===6?o.readSVarint():_===7?o.readBoolean():null}return u}(r))}Cf.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new Rx(this._pbf,e,this.extent,this._keys,this._values)};var Fx=Pf;function Ox(i,e,r){if(i===3){var o=new Fx(r,r.readVarint()+r.pos);o.length&&(e[o.name]=o)}}Vs.VectorTile=function(i,e){this.layers=i.readFields(Ox,{},e)},Vs.VectorTileFeature=Af,Vs.VectorTileLayer=Pf;const Bx=Vs.VectorTileFeature.types,gd=Math.pow(2,13);function Yl(i,e,r,o,u,g,_,y){i.emplaceBack(e,r,2*Math.floor(o*gd)+_,u*gd*2,g*gd*2,Math.round(y))}class _d{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Z,this.centroidVertexArray=new k,this.indexArray=new ve,this.programConfigurations=new Mi(e.layers,e.zoom),this.segments=new Ue,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){this.features=[],this.hasPattern=pd("fill-extrusion",this.layers,r);for(const{feature:u,id:g,index:_,sourceLayerIndex:y}of e){const S=this.layers[0]._featureFilter.needGeometry,I=gs(u,S);if(!this.layers[0]._featureFilter.filter(new Ti(this.zoom),I,o))continue;const P={id:g,sourceLayerIndex:y,index:_,geometry:S?I.geometry:ms(u),properties:u.properties,type:u.type,patterns:{}};this.hasPattern?this.features.push(fd("fill-extrusion",this.layers,P,this.zoom,r)):this.addFeature(P,P.geometry,_,o,{}),r.featureIndex.insert(u,P.geometry,_,y,this.index,!0)}}addFeatures(e,r,o){for(const u of this.features){const{geometry:g}=u;this.addFeature(u,g,u.index,r,o)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Mx),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Cx.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,o,u,g){const _={x:0,y:0,vertexCount:0};for(const y of dd(r,500)){let S=0;for(const B of y)S+=B.length;let I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const B of y){if(B.length===0||Vx(B))continue;let G=0;for(let K=0;K<B.length;K++){const te=B[K];if(K>=1){const he=B[K-1];if(!Nx(te,he)){I.vertexLength+4>Ue.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const re=te.sub(he)._perp()._unit(),le=he.dist(te);G+le>32768&&(G=0),Yl(this.layoutVertexArray,te.x,te.y,re.x,re.y,0,0,G),Yl(this.layoutVertexArray,te.x,te.y,re.x,re.y,0,1,G),_.x+=2*te.x,_.y+=2*te.y,_.vertexCount+=2,G+=le,Yl(this.layoutVertexArray,he.x,he.y,re.x,re.y,0,0,G),Yl(this.layoutVertexArray,he.x,he.y,re.x,re.y,0,1,G),_.x+=2*he.x,_.y+=2*he.y,_.vertexCount+=2;const be=I.vertexLength;this.indexArray.emplaceBack(be,be+2,be+1),this.indexArray.emplaceBack(be+1,be+2,be+3),I.vertexLength+=4,I.primitiveLength+=2}}}}if(I.vertexLength+S>Ue.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray)),Bx[e.type]!=="Polygon")continue;const P=[],C=[],z=I.vertexLength;for(const B of y)if(B.length!==0){B!==y[0]&&C.push(P.length/2);for(let G=0;G<B.length;G++){const K=B[G];Yl(this.layoutVertexArray,K.x,K.y,0,0,1,1,0),_.x+=K.x,_.y+=K.y,_.vertexCount+=1,P.push(K.x),P.push(K.y)}}const F=Sf(P,C);for(let B=0;B<F.length;B+=3)this.indexArray.emplaceBack(z+F[B],z+F[B+2],z+F[B+1]);I.primitiveLength+=F.length/3,I.vertexLength+=S}for(let y=0;y<_.vertexCount;y++)this.centroidVertexArray.emplaceBack(Math.floor(_.x/_.vertexCount),Math.floor(_.y/_.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,g,u)}}function Nx(i,e){return i.x===e.x&&(i.x<0||i.x>Oi)||i.y===e.y&&(i.y<0||i.y>Oi)}function Vx(i){return i.every(e=>e.x<0)||i.every(e=>e.x>Oi)||i.every(e=>e.y<0)||i.every(e=>e.y>Oi)}let Mf;rt("FillExtrusionBucket",_d,{omit:["layers","features"]});var $x={get paint(){return Mf=Mf||new Rr({"fill-extrusion-opacity":new dt(ee["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new xt(ee["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new dt(ee["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new dt(ee["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Sa(ee["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new xt(ee["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new xt(ee["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new dt(ee["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Ux extends fn{constructor(e){super(e,$x)}createBucket(e){return new _d(e)}queryRadius(){return bu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,r,o,u,g,_,y,S){const I=wu(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_.angle,y),P=this.paint.get("fill-extrusion-height").evaluate(r,o),C=this.paint.get("fill-extrusion-base").evaluate(r,o),z=function(B,G,K,te){const he=[];for(const re of B){const le=[re.x,re.y,0,1];Su(le,le,G),he.push(new N(le[0]/le[3],le[1]/le[3]))}return he}(I,S),F=function(B,G,K,te){const he=[],re=[],le=te[8]*G,be=te[9]*G,Ae=te[10]*G,Je=te[11]*G,at=te[8]*K,Ye=te[9]*K,Ze=te[10]*K,$e=te[11]*K;for(const nt of B){const Ge=[],Le=[];for(const mt of nt){const ut=mt.x,Bt=mt.y,yi=te[0]*ut+te[4]*Bt+te[12],Ii=te[1]*ut+te[5]*Bt+te[13],ir=te[2]*ut+te[6]*Bt+te[14],on=te[3]*ut+te[7]*Bt+te[15],Fr=ir+Ae,Hi=on+Je,hr=yi+at,yr=Ii+Ye,Or=ir+Ze,Br=on+$e,rr=new N((yi+le)/Hi,(Ii+be)/Hi);rr.z=Fr/Hi,Ge.push(rr);const nr=new N(hr/Br,yr/Br);nr.z=Or/Br,Le.push(nr)}he.push(Ge),re.push(Le)}return[he,re]}(u,C,P,S);return function(B,G,K){let te=1/0;$l(K,G)&&(te=kf(K,G[0]));for(let he=0;he<G.length;he++){const re=G[he],le=B[he];for(let be=0;be<re.length-1;be++){const Ae=re[be],Je=[Ae,re[be+1],le[be+1],le[be],Ae];Vl(K,Je)&&(te=Math.min(te,kf(K,Je)))}}return te!==1/0&&te}(F[0],F[1],z)}}function Jl(i,e){return i.x*e.x+i.y*e.y}function kf(i,e){if(i.length===1){let r=0;const o=e[r++];let u;for(;!u||o.equals(u);)if(u=e[r++],!u)return 1/0;for(;r<e.length;r++){const g=e[r],_=i[0],y=u.sub(o),S=g.sub(o),I=_.sub(o),P=Jl(y,y),C=Jl(y,S),z=Jl(S,S),F=Jl(I,y),B=Jl(I,S),G=P*z-C*C,K=(z*F-C*B)/G,te=(P*B-C*F)/G,he=o.z*(1-K-te)+u.z*K+g.z*te;if(isFinite(he))return he}return 1/0}{let r=1/0;for(const o of e)r=Math.min(r,o.z);return r}}const jx=Ni([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:qx}=jx,Gx=Ni([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Hx}=Gx,Zx=Vs.VectorTileFeature.types,Wx=Math.cos(Math.PI/180*37.5),Df=Math.pow(2,14)/.5;class yd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Y,this.layoutVertexArray2=new q,this.indexArray=new ve,this.programConfigurations=new Mi(e.layers,e.zoom),this.segments=new Ue,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){this.hasPattern=pd("line",this.layers,r);const u=this.layers[0].layout.get("line-sort-key"),g=!u.isConstant(),_=[];for(const{feature:y,id:S,index:I,sourceLayerIndex:P}of e){const C=this.layers[0]._featureFilter.needGeometry,z=gs(y,C);if(!this.layers[0]._featureFilter.filter(new Ti(this.zoom),z,o))continue;const F=g?u.evaluate(z,{},o):void 0,B={id:S,properties:y.properties,type:y.type,sourceLayerIndex:P,index:I,geometry:C?z.geometry:ms(y),patterns:{},sortKey:F};_.push(B)}g&&_.sort((y,S)=>y.sortKey-S.sortKey);for(const y of _){const{geometry:S,index:I,sourceLayerIndex:P}=y;if(this.hasPattern){const C=fd("line",this.layers,y,this.zoom,r);this.patternFeatures.push(C)}else this.addFeature(y,S,I,o,{});r.featureIndex.insert(e[I].feature,S,I,P,this.index)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,o)}addFeatures(e,r,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,r,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Hx)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,qx),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,o,u,g){const _=this.layers[0].layout,y=_.get("line-join").evaluate(e,{}),S=_.get("line-cap"),I=_.get("line-miter-limit"),P=_.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const C of r)this.addLine(C,e,y,S,I,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,g,u)}addLine(e,r,o,u,g,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let te=0;te<e.length-1;te++)this.totalDistance+=e[te].dist(e[te+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y=Zx[r.type]==="Polygon";let S=e.length;for(;S>=2&&e[S-1].equals(e[S-2]);)S--;let I=0;for(;I<S-1&&e[I].equals(e[I+1]);)I++;if(S<(y?3:2))return;o==="bevel"&&(g=1.05);const P=this.overscaling<=16?15*Oi/(512*this.overscaling):0,C=this.segments.prepareSegment(10*S,this.layoutVertexArray,this.indexArray);let z,F,B,G,K;this.e1=this.e2=-1,y&&(z=e[S-2],K=e[I].sub(z)._unit()._perp());for(let te=I;te<S;te++){if(B=te===S-1?y?e[I+1]:void 0:e[te+1],B&&e[te].equals(B))continue;K&&(G=K),z&&(F=z),z=e[te],K=B?B.sub(z)._unit()._perp():G,G=G||K;let he=G.add(K);he.x===0&&he.y===0||he._unit();const re=G.x*K.x+G.y*K.y,le=he.x*K.x+he.y*K.y,be=le!==0?1/le:1/0,Ae=2*Math.sqrt(2-2*le),Je=le<Wx&&F&&B,at=G.x*K.y-G.y*K.x>0;if(Je&&te>I){const $e=z.dist(F);if($e>2*P){const nt=z.sub(z.sub(F)._mult(P/$e)._round());this.updateDistance(F,nt),this.addCurrentVertex(nt,G,0,0,C),F=nt}}const Ye=F&&B;let Ze=Ye?o:y?"butt":u;if(Ye&&Ze==="round"&&(be<_?Ze="miter":be<=2&&(Ze="fakeround")),Ze==="miter"&&be>g&&(Ze="bevel"),Ze==="bevel"&&(be>2&&(Ze="flipbevel"),be<g&&(Ze="miter")),F&&this.updateDistance(F,z),Ze==="miter")he._mult(be),this.addCurrentVertex(z,he,0,0,C);else if(Ze==="flipbevel"){if(be>100)he=K.mult(-1);else{const $e=be*G.add(K).mag()/G.sub(K).mag();he._perp()._mult($e*(at?-1:1))}this.addCurrentVertex(z,he,0,0,C),this.addCurrentVertex(z,he.mult(-1),0,0,C)}else if(Ze==="bevel"||Ze==="fakeround"){const $e=-Math.sqrt(be*be-1),nt=at?$e:0,Ge=at?0:$e;if(F&&this.addCurrentVertex(z,G,nt,Ge,C),Ze==="fakeround"){const Le=Math.round(180*Ae/Math.PI/20);for(let mt=1;mt<Le;mt++){let ut=mt/Le;if(ut!==.5){const yi=ut-.5;ut+=ut*yi*(ut-1)*((1.0904+re*(re*(3.55645-1.43519*re)-3.2452))*yi*yi+(.848013+re*(.215638*re-1.06021)))}const Bt=K.sub(G)._mult(ut)._add(G)._unit()._mult(at?-1:1);this.addHalfVertex(z,Bt.x,Bt.y,!1,at,0,C)}}B&&this.addCurrentVertex(z,K,-nt,-Ge,C)}else if(Ze==="butt")this.addCurrentVertex(z,he,0,0,C);else if(Ze==="square"){const $e=F?1:-1;this.addCurrentVertex(z,he,$e,$e,C)}else Ze==="round"&&(F&&(this.addCurrentVertex(z,G,0,0,C),this.addCurrentVertex(z,G,1,1,C,!0)),B&&(this.addCurrentVertex(z,K,-1,-1,C,!0),this.addCurrentVertex(z,K,0,0,C)));if(Je&&te<S-1){const $e=z.dist(B);if($e>2*P){const nt=z.add(B.sub(z)._mult(P/$e)._round());this.updateDistance(z,nt),this.addCurrentVertex(nt,K,0,0,C),z=nt}}}}addCurrentVertex(e,r,o,u,g,_=!1){const y=r.y*u-r.x,S=-r.y-r.x*u;this.addHalfVertex(e,r.x+r.y*o,r.y-r.x*o,_,!1,o,g),this.addHalfVertex(e,y,S,_,!0,-u,g),this.distance>Df/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,r,o,u,g,_))}addHalfVertex({x:e,y:r},o,u,g,_,y,S){const I=.5*(this.lineClips?this.scaledDistance*(Df-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(g?1:0),(r<<1)+(_?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(y===0?0:y<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const P=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,P),S.primitiveLength++),_?this.e2=P:this.e1=P}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}let zf,Rf;rt("LineBucket",yd,{omit:["layers","patternFeatures"]});var Lf={get paint(){return Rf=Rf||new Rr({"line-opacity":new xt(ee.paint_line["line-opacity"]),"line-color":new xt(ee.paint_line["line-color"]),"line-translate":new dt(ee.paint_line["line-translate"]),"line-translate-anchor":new dt(ee.paint_line["line-translate-anchor"]),"line-width":new xt(ee.paint_line["line-width"]),"line-gap-width":new xt(ee.paint_line["line-gap-width"]),"line-offset":new xt(ee.paint_line["line-offset"]),"line-blur":new xt(ee.paint_line["line-blur"]),"line-dasharray":new To(ee.paint_line["line-dasharray"]),"line-pattern":new Sa(ee.paint_line["line-pattern"]),"line-gradient":new Ml(ee.paint_line["line-gradient"])})},get layout(){return zf=zf||new Rr({"line-cap":new dt(ee.layout_line["line-cap"]),"line-join":new xt(ee.layout_line["line-join"]),"line-miter-limit":new dt(ee.layout_line["line-miter-limit"]),"line-round-limit":new dt(ee.layout_line["line-round-limit"]),"line-sort-key":new xt(ee.layout_line["line-sort-key"])})}};class Kx extends xt{possiblyEvaluate(e,r){return r=new Ti(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,o,u){return r=vt({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,o,u)}}let Pu;class Xx extends fn{constructor(e){super(e,Lf),this.gradientVersion=0,Pu||(Pu=new Kx(Lf.paint.properties["line-width"].specification),Pu.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(o){return o._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof go,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,r){super.recalculate(e,r),this.paint._values["line-floorwidth"]=Pu.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new yd(e)}queryRadius(e){const r=e,o=Ff(ql("line-width",this,r),ql("line-gap-width",this,r)),u=ql("line-offset",this,r);return o/2+Math.abs(u)+bu(this.paint.get("line-translate"))}queryIntersectsFeature(e,r,o,u,g,_,y){const S=wu(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_.angle,y),I=y/2*Ff(this.paint.get("line-width").evaluate(r,o),this.paint.get("line-gap-width").evaluate(r,o)),P=this.paint.get("line-offset").evaluate(r,o);return P&&(u=function(C,z){const F=[];for(let B=0;B<C.length;B++){const G=C[B],K=[];for(let te=0;te<G.length;te++){const he=G[te-1],re=G[te],le=G[te+1],be=te===0?new N(0,0):re.sub(he)._unit()._perp(),Ae=te===G.length-1?new N(0,0):le.sub(re)._unit()._perp(),Je=be._add(Ae)._unit(),at=Je.x*Ae.x+Je.y*Ae.y;at!==0&&Je._mult(1/at),K.push(Je._mult(z)._add(re))}F.push(K)}return F}(u,P*y)),function(C,z,F){for(let B=0;B<z.length;B++){const G=z[B];if(C.length>=3){for(let K=0;K<G.length;K++)if(za(C,G[K]))return!0}if(Ul(C,G,F))return!0}return!1}(S,u,I)}isTileClipped(){return!0}}function Ff(i,e){return e>0?e+2*i:i}const Yx=Ni([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Jx=Ni([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ni([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Qx=Ni([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Ni([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Of=Ni([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),e0=Ni([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function t0(i,e,r){return i.sections.forEach(o=>{o.text=function(u,g,_){const y=g.layout.get("text-transform").evaluate(_,{});return y==="uppercase"?u=u.toLocaleUpperCase():y==="lowercase"&&(u=u.toLocaleLowerCase()),Wn.applyArabicShaping&&(u=Wn.applyArabicShaping(u)),u}(o.text,e,r)}),i}Ni([{name:"triangle",components:3,type:"Uint16"}]),Ni([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ni([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Ni([{type:"Float32",name:"offsetX"}]),Ni([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Ni([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Ql={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var tr=24,Bf=di,Nf=function(i,e,r,o,u){var g,_,y=8*u-o-1,S=(1<<y)-1,I=S>>1,P=-7,C=r?u-1:0,z=r?-1:1,F=i[e+C];for(C+=z,g=F&(1<<-P)-1,F>>=-P,P+=y;P>0;g=256*g+i[e+C],C+=z,P-=8);for(_=g&(1<<-P)-1,g>>=-P,P+=o;P>0;_=256*_+i[e+C],C+=z,P-=8);if(g===0)g=1-I;else{if(g===S)return _?NaN:1/0*(F?-1:1);_+=Math.pow(2,o),g-=I}return(F?-1:1)*_*Math.pow(2,g-o)},Vf=function(i,e,r,o,u,g){var _,y,S,I=8*g-u-1,P=(1<<I)-1,C=P>>1,z=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,F=o?0:g-1,B=o?1:-1,G=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,_=P):(_=Math.floor(Math.log(e)/Math.LN2),e*(S=Math.pow(2,-_))<1&&(_--,S*=2),(e+=_+C>=1?z/S:z*Math.pow(2,1-C))*S>=2&&(_++,S/=2),_+C>=P?(y=0,_=P):_+C>=1?(y=(e*S-1)*Math.pow(2,u),_+=C):(y=e*Math.pow(2,C-1)*Math.pow(2,u),_=0));u>=8;i[r+F]=255&y,F+=B,y/=256,u-=8);for(_=_<<u|y,I+=u;I>0;i[r+F]=255&_,F+=B,_/=256,I-=8);i[r+F-B]|=128*G};function di(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}di.Varint=0,di.Fixed64=1,di.Bytes=2,di.Fixed32=5;var xd=4294967296,$f=1/xd,Uf=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function _s(i){return i.type===di.Bytes?i.readVarint()+i.pos:i.pos+1}function Oa(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function jf(i,e,r){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(o);for(var u=r.pos-1;u>=i;u--)r.buf[u+o]=r.buf[u]}function i0(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function r0(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function n0(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function s0(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function o0(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function a0(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function l0(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function c0(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function u0(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function Cu(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Ba(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function qf(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}di.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var o=this.readVarint(),u=o>>3,g=this.pos;this.type=7&o,i(u,e,this),this.pos===g&&this.skip(o)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=Cu(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=qf(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Cu(this.buf,this.pos)+Cu(this.buf,this.pos+4)*xd;return this.pos+=8,i},readSFixed64:function(){var i=Cu(this.buf,this.pos)+qf(this.buf,this.pos+4)*xd;return this.pos+=8,i},readFloat:function(){var i=Nf(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Nf(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,o=this.buf;return e=127&(r=o[this.pos++]),r<128?e:(e|=(127&(r=o[this.pos++]))<<7,r<128?e:(e|=(127&(r=o[this.pos++]))<<14,r<128?e:(e|=(127&(r=o[this.pos++]))<<21,r<128?e:function(u,g,_){var y,S,I=_.buf;if(y=(112&(S=I[_.pos++]))>>4,S<128||(y|=(127&(S=I[_.pos++]))<<3,S<128)||(y|=(127&(S=I[_.pos++]))<<10,S<128)||(y|=(127&(S=I[_.pos++]))<<17,S<128)||(y|=(127&(S=I[_.pos++]))<<24,S<128)||(y|=(1&(S=I[_.pos++]))<<31,S<128))return Oa(u,y,g);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=o[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&Uf?function(r,o,u){return Uf.decode(r.subarray(o,u))}(this.buf,e,i):function(r,o,u){for(var g="",_=o;_<u;){var y,S,I,P=r[_],C=null,z=P>239?4:P>223?3:P>191?2:1;if(_+z>u)break;z===1?P<128&&(C=P):z===2?(192&(y=r[_+1]))==128&&(C=(31&P)<<6|63&y)<=127&&(C=null):z===3?(S=r[_+2],(192&(y=r[_+1]))==128&&(192&S)==128&&((C=(15&P)<<12|(63&y)<<6|63&S)<=2047||C>=55296&&C<=57343)&&(C=null)):z===4&&(S=r[_+2],I=r[_+3],(192&(y=r[_+1]))==128&&(192&S)==128&&(192&I)==128&&((C=(15&P)<<18|(63&y)<<12|(63&S)<<6|63&I)<=65535||C>=1114112)&&(C=null)),C===null?(C=65533,z=1):C>65535&&(C-=65536,g+=String.fromCharCode(C>>>10&1023|55296),C=56320|1023&C),g+=String.fromCharCode(C),_+=z}return g}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==di.Bytes)return i.push(this.readVarint(e));var r=_s(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==di.Bytes)return i.push(this.readSVarint());var e=_s(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==di.Bytes)return i.push(this.readBoolean());var e=_s(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==di.Bytes)return i.push(this.readFloat());var e=_s(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==di.Bytes)return i.push(this.readDouble());var e=_s(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==di.Bytes)return i.push(this.readFixed32());var e=_s(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==di.Bytes)return i.push(this.readSFixed32());var e=_s(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==di.Bytes)return i.push(this.readFixed64());var e=_s(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==di.Bytes)return i.push(this.readSFixed64());var e=_s(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===di.Varint)for(;this.buf[this.pos++]>127;);else if(e===di.Bytes)this.pos=this.readVarint()+this.pos;else if(e===di.Fixed32)this.pos+=4;else{if(e!==di.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Ba(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Ba(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Ba(this.buf,-1&i,this.pos),Ba(this.buf,Math.floor(i*$f),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Ba(this.buf,-1&i,this.pos),Ba(this.buf,Math.floor(i*$f),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var o,u;if(e>=0?(o=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(o=~(-e%4294967296))?o=o+1|0:(o=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(g,_,y){y.buf[y.pos++]=127&g|128,g>>>=7,y.buf[y.pos++]=127&g|128,g>>>=7,y.buf[y.pos++]=127&g|128,g>>>=7,y.buf[y.pos++]=127&g|128,y.buf[y.pos]=127&(g>>>=7)}(o,0,r),function(g,_){var y=(7&g)<<4;_.buf[_.pos++]|=y|((g>>>=3)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g)))))}(u,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(o,u,g){for(var _,y,S=0;S<u.length;S++){if((_=u.charCodeAt(S))>55295&&_<57344){if(!y){_>56319||S+1===u.length?(o[g++]=239,o[g++]=191,o[g++]=189):y=_;continue}if(_<56320){o[g++]=239,o[g++]=191,o[g++]=189,y=_;continue}_=y-55296<<10|_-56320|65536,y=null}else y&&(o[g++]=239,o[g++]=191,o[g++]=189,y=null);_<128?o[g++]=_:(_<2048?o[g++]=_>>6|192:(_<65536?o[g++]=_>>12|224:(o[g++]=_>>18|240,o[g++]=_>>12&63|128),o[g++]=_>>6&63|128),o[g++]=63&_|128)}return g}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&jf(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),Vf(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Vf(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var o=this.pos-r;o>=128&&jf(r,o,this),this.pos=r-1,this.writeVarint(o),this.pos+=o},writeMessage:function(i,e,r){this.writeTag(i,di.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,i0,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,r0,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,o0,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,n0,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,s0,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,a0,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,l0,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,c0,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,u0,e)},writeBytesField:function(i,e){this.writeTag(i,di.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,di.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,di.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,di.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,di.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,di.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,di.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,di.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,di.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,di.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};var vd=R(Bf);const bd=3;function h0(i,e,r){i===1&&r.readMessage(d0,e)}function d0(i,e,r){if(i===3){const{id:o,bitmap:u,width:g,height:_,left:y,top:S,advance:I}=r.readMessage(p0,{});e.push({id:o,bitmap:new Hl({width:g+2*bd,height:_+2*bd},u),metrics:{width:g,height:_,left:y,top:S,advance:I}})}}function p0(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}const Gf=bd;function Hf(i){let e=0,r=0;for(const _ of i)e+=_.w*_.h,r=Math.max(r,_.w);i.sort((_,y)=>y.h-_.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let u=0,g=0;for(const _ of i)for(let y=o.length-1;y>=0;y--){const S=o[y];if(!(_.w>S.w||_.h>S.h)){if(_.x=S.x,_.y=S.y,g=Math.max(g,_.y+_.h),u=Math.max(u,_.x+_.w),_.w===S.w&&_.h===S.h){const I=o.pop();y<o.length&&(o[y]=I)}else _.h===S.h?(S.x+=_.w,S.w-=_.w):_.w===S.w?(S.y+=_.h,S.h-=_.h):(o.push({x:S.x+_.w,y:S.y,w:S.w-_.w,h:_.h}),S.y+=_.h,S.h-=_.h);break}}return{w:u,h:g,fill:e/(u*g)||0}}const Zr=1;class wd{constructor(e,{pixelRatio:r,version:o,stretchX:u,stretchY:g,content:_}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=u,this.stretchY=g,this.content=_,this.version=o}get tl(){return[this.paddedRect.x+Zr,this.paddedRect.y+Zr]}get br(){return[this.paddedRect.x+this.paddedRect.w-Zr,this.paddedRect.y+this.paddedRect.h-Zr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Zr)/this.pixelRatio,(this.paddedRect.h-2*Zr)/this.pixelRatio]}}class Zf{constructor(e,r){const o={},u={};this.haveRenderCallbacks=[];const g=[];this.addImages(e,o,g),this.addImages(r,u,g);const{w:_,h:y}=Hf(g),S=new mn({width:_||1,height:y||1});for(const I in e){const P=e[I],C=o[I].paddedRect;mn.copy(P.data,S,{x:0,y:0},{x:C.x+Zr,y:C.y+Zr},P.data)}for(const I in r){const P=r[I],C=u[I].paddedRect,z=C.x+Zr,F=C.y+Zr,B=P.data.width,G=P.data.height;mn.copy(P.data,S,{x:0,y:0},{x:z,y:F},P.data),mn.copy(P.data,S,{x:0,y:G-1},{x:z,y:F-1},{width:B,height:1}),mn.copy(P.data,S,{x:0,y:0},{x:z,y:F+G},{width:B,height:1}),mn.copy(P.data,S,{x:B-1,y:0},{x:z-1,y:F},{width:1,height:G}),mn.copy(P.data,S,{x:0,y:0},{x:z+B,y:F},{width:1,height:G})}this.image=S,this.iconPositions=o,this.patternPositions=u}addImages(e,r,o){for(const u in e){const g=e[u],_={x:0,y:0,w:g.data.width+2*Zr,h:g.data.height+2*Zr};o.push(_),r[u]=new wd(_,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),r),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),r)}patchUpdatedImage(e,r,o){if(!e||!r||e.version===r.version)return;e.version=r.version;const[u,g]=e.tl;o.update(r.data,void 0,{x:u,y:g})}}var $s;rt("ImagePosition",wd),rt("ImageAtlas",Zf),x.ah=void 0,($s=x.ah||(x.ah={}))[$s.none=0]="none",$s[$s.horizontal=1]="horizontal",$s[$s.vertical=2]="vertical",$s[$s.horizontalOnly=3]="horizontalOnly";const ec=-17;class tc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const o=new tc;return o.scale=e||1,o.fontStack=r,o}static forImage(e){const r=new tc;return r.imageName=e,r}}class Na{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const o=new Na;for(let u=0;u<e.sections.length;u++){const g=e.sections[u];g.image?o.addImageSection(g):o.addTextSection(g,r)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let o=0;o<e.length;o++){const u=e.charCodeAt(o+1)||null,g=e.charCodeAt(o-1)||null;r+=u&&Pl(u)&&!Ql[e[o+1]]||g&&Pl(g)&&!Ql[e[o-1]]||!Ql[e[o]]?e[o]:Ql[e[o]]}return r}(this.text)}trim(){let e=0;for(let o=0;o<this.text.length&&ku[this.text.charCodeAt(o)];o++)e++;let r=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&ku[this.text.charCodeAt(o)];o--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const o=new Na;return o.text=this.text.substring(e,r),o.sectionIndex=this.sectionIndex.slice(e,r),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(tc.forText(e.scale,e.fontStack||r));const o=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(o)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void ri("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(tc.forImage(r)),this.sectionIndex.push(this.sections.length-1)):ri("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Mu(i,e,r,o,u,g,_,y,S,I,P,C,z,F,B,G){const K=Na.fromFeature(i,u);let te;C===x.ah.vertical&&K.verticalizePunctuation();const{processBidirectionalText:he,processStyledBidirectionalText:re}=Wn;if(he&&K.sections.length===1){te=[];const Ae=he(K.toString(),Sd(K,I,g,e,o,F,B));for(const Je of Ae){const at=new Na;at.text=Je,at.sections=K.sections;for(let Ye=0;Ye<Je.length;Ye++)at.sectionIndex.push(0);te.push(at)}}else if(re){te=[];const Ae=re(K.text,K.sectionIndex,Sd(K,I,g,e,o,F,B));for(const Je of Ae){const at=new Na;at.text=Je[0],at.sectionIndex=Je[1],at.sections=K.sections,te.push(at)}}else te=function(Ae,Je){const at=[],Ye=Ae.text;let Ze=0;for(const $e of Je)at.push(Ae.substring(Ze,$e)),Ze=$e;return Ze<Ye.length&&at.push(Ae.substring(Ze,Ye.length)),at}(K,Sd(K,I,g,e,o,F,B));const le=[],be={positionedLines:le,text:K.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:C,iconsInText:!1,verticalizable:!1};return function(Ae,Je,at,Ye,Ze,$e,nt,Ge,Le,mt,ut,Bt){let yi=0,Ii=ec,ir=0,on=0;const Fr=Ge==="right"?1:Ge==="left"?0:.5;let Hi=0;for(const rr of Ze){rr.trim();const nr=rr.getMaxScale(),Tr=(nr-1)*tr,Nr={positionedGlyphs:[],lineOffset:0};Ae.positionedLines[Hi]=Nr;const Er=Nr.positionedGlyphs;let Wr=0;if(!rr.length()){Ii+=$e,++Hi;continue}for(let sr=0;sr<rr.length();sr++){const Ut=rr.getSection(sr),Ir=rr.getSectionIndex(sr),xr=rr.getCharCode(sr);let or=0,An=null,Rn=null,Ln=null,ys=tr;const Pn=!(Le===x.ah.horizontal||!ut&&!va(xr)||ut&&(ku[xr]||(hr=xr,Xe.Arabic(hr)||Xe["Arabic Supplement"](hr)||Xe["Arabic Extended-A"](hr)||Xe["Arabic Presentation Forms-A"](hr)||Xe["Arabic Presentation Forms-B"](hr))));if(Ut.imageName){const _n=Ye[Ut.imageName];if(!_n)continue;Ln=Ut.imageName,Ae.iconsInText=Ae.iconsInText||!0,Rn=_n.paddedRect;const Xr=_n.displaySize;Ut.scale=Ut.scale*tr/Bt,An={width:Xr[0],height:Xr[1],left:Zr,top:-Gf,advance:Pn?Xr[1]:Xr[0]},or=Tr+(tr-Xr[1]*Ut.scale),ys=An.advance;const xs=Pn?Xr[0]*Ut.scale-tr*nr:Xr[1]*Ut.scale-tr*nr;xs>0&&xs>Wr&&(Wr=xs)}else{const _n=at[Ut.fontStack],Xr=_n&&_n[xr];if(Xr&&Xr.rect)Rn=Xr.rect,An=Xr.metrics;else{const xs=Je[Ut.fontStack],oc=xs&&xs[xr];if(!oc)continue;An=oc.metrics}or=(nr-Ut.scale)*tr}Pn?(Ae.verticalizable=!0,Er.push({glyph:xr,imageName:Ln,x:yi,y:Ii+or,vertical:Pn,scale:Ut.scale,fontStack:Ut.fontStack,sectionIndex:Ir,metrics:An,rect:Rn}),yi+=ys*Ut.scale+mt):(Er.push({glyph:xr,imageName:Ln,x:yi,y:Ii+or,vertical:Pn,scale:Ut.scale,fontStack:Ut.fontStack,sectionIndex:Ir,metrics:An,rect:Rn}),yi+=An.advance*Ut.scale+mt)}Er.length!==0&&(ir=Math.max(yi-mt,ir),g0(Er,0,Er.length-1,Fr,Wr)),yi=0;const Kr=$e*nr+Wr;Nr.lineOffset=Math.max(Wr,Tr),Ii+=Kr,on=Math.max(Kr,on),++Hi}var hr;const yr=Ii-ec,{horizontalAlign:Or,verticalAlign:Br}=Td(nt);(function(rr,nr,Tr,Nr,Er,Wr,Kr,sr,Ut){const Ir=(nr-Tr)*Er;let xr=0;xr=Wr!==Kr?-sr*Nr-ec:(-Nr*Ut+.5)*Kr;for(const or of rr)for(const An of or.positionedGlyphs)An.x+=Ir,An.y+=xr})(Ae.positionedLines,Fr,Or,Br,ir,on,$e,yr,Ze.length),Ae.top+=-Br*yr,Ae.bottom=Ae.top+yr,Ae.left+=-Or*ir,Ae.right=Ae.left+ir}(be,e,r,o,te,_,y,S,C,I,z,G),!function(Ae){for(const Je of Ae)if(Je.positionedGlyphs.length!==0)return!1;return!0}(le)&&be}const ku={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},f0={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Wf(i,e,r,o,u,g){if(e.imageName){const _=o[e.imageName];return _?_.displaySize[0]*e.scale*tr/g+u:0}{const _=r[e.fontStack],y=_&&_[i];return y?y.metrics.advance*e.scale+u:0}}function Kf(i,e,r,o){const u=Math.pow(i-e,2);return o?i<e?u/2:2*u:u+Math.abs(r)*r}function m0(i,e,r){let o=0;return i===10&&(o-=1e4),r&&(o+=150),i!==40&&i!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function Xf(i,e,r,o,u,g){let _=null,y=Kf(e,r,u,g);for(const S of o){const I=Kf(e-S.x,r,u,g)+S.badness;I<=y&&(_=S,y=I)}return{index:i,x:e,priorBreak:_,badness:y}}function Yf(i){return i?Yf(i.priorBreak).concat(i.index):[]}function Sd(i,e,r,o,u,g,_){if(g!=="point")return[];if(!i)return[];const y=[],S=function(z,F,B,G,K,te){let he=0;for(let re=0;re<z.length();re++){const le=z.getSection(re);he+=Wf(z.getCharCode(re),le,G,K,F,te)}return he/Math.max(1,Math.ceil(he/B))}(i,e,r,o,u,_),I=i.text.indexOf("")>=0;let P=0;for(let z=0;z<i.length();z++){const F=i.getSection(z),B=i.getCharCode(z);if(ku[B]||(P+=Wf(B,F,o,u,e,_)),z<i.length()-1){const G=!((C=B)<11904||!(Xe["Bopomofo Extended"](C)||Xe.Bopomofo(C)||Xe["CJK Compatibility Forms"](C)||Xe["CJK Compatibility Ideographs"](C)||Xe["CJK Compatibility"](C)||Xe["CJK Radicals Supplement"](C)||Xe["CJK Strokes"](C)||Xe["CJK Symbols and Punctuation"](C)||Xe["CJK Unified Ideographs Extension A"](C)||Xe["CJK Unified Ideographs"](C)||Xe["Enclosed CJK Letters and Months"](C)||Xe["Halfwidth and Fullwidth Forms"](C)||Xe.Hiragana(C)||Xe["Ideographic Description Characters"](C)||Xe["Kangxi Radicals"](C)||Xe["Katakana Phonetic Extensions"](C)||Xe.Katakana(C)||Xe["Vertical Forms"](C)||Xe["Yi Radicals"](C)||Xe["Yi Syllables"](C)));(f0[B]||G||F.imageName)&&y.push(Xf(z+1,P,S,y,m0(B,i.getCharCode(z+1),G&&I),!1))}}var C;return Yf(Xf(i.length(),P,S,y,0,!0))}function Td(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function g0(i,e,r,o,u){if(!o&&!u)return;const g=i[r],_=(i[r].x+g.metrics.advance*g.scale)*o;for(let y=e;y<=r;y++)i[y].x-=_,i[y].y+=u}function _0(i,e,r){const{horizontalAlign:o,verticalAlign:u}=Td(r),g=e[0]-i.displaySize[0]*o,_=e[1]-i.displaySize[1]*u;return{image:i,top:_,bottom:_+i.displaySize[1],left:g,right:g+i.displaySize[0]}}function Jf(i,e,r,o,u,g){const _=i.image;let y;if(_.content){const K=_.content,te=_.pixelRatio||1;y=[K[0]/te,K[1]/te,_.displaySize[0]-K[2]/te,_.displaySize[1]-K[3]/te]}const S=e.left*g,I=e.right*g;let P,C,z,F;r==="width"||r==="both"?(F=u[0]+S-o[3],C=u[0]+I+o[1]):(F=u[0]+(S+I-_.displaySize[0])/2,C=F+_.displaySize[0]);const B=e.top*g,G=e.bottom*g;return r==="height"||r==="both"?(P=u[1]+B-o[0],z=u[1]+G+o[2]):(P=u[1]+(B+G-_.displaySize[1])/2,z=P+_.displaySize[1]),{image:_,top:P,right:C,bottom:z,left:F,collisionPadding:y}}const ic=255,Jn=128,Us=ic*Jn;function Qf(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Ti(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:u}=r;let g=0;for(;g<o.length&&o[g]<=i;)g++;g=Math.max(0,g-1);let _=g;for(;_<o.length&&o[_]<i+1;)_++;_=Math.min(o.length-1,_);const y=o[g],S=o[_];return r.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:S,interpolationType:u}:{kind:"camera",minZoom:y,maxZoom:S,minSize:r.evaluate(new Ti(y)),maxSize:r.evaluate(new Ti(S)),interpolationType:u}}}function Ed(i,e,r){let o="never";const u=i.get(e);return u?o=u:i.get(r)&&(o="always"),o}const y0=Vs.VectorTileFeature.types,x0=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Du(i,e,r,o,u,g,_,y,S,I,P,C,z){const F=y?Math.min(Us,Math.round(y[0])):0,B=y?Math.min(Us,Math.round(y[1])):0;i.emplaceBack(e,r,Math.round(32*o),Math.round(32*u),g,_,(F<<1)+(S?1:0),B,16*I,16*P,256*C,256*z)}function Id(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function v0(i){for(const e of i.sections)if(rd(e.text))return!0;return!1}class Ad{constructor(e){this.layoutVertexArray=new pe,this.indexArray=new ve,this.programConfigurations=e,this.segments=new Ue,this.dynamicLayoutVertexArray=new Q,this.opacityVertexArray=new ce,this.hasVisibleVertices=!1,this.placedSymbolArray=new s}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,o,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Yx.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Jx.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,x0,!0),this.opacityVertexBuffer.itemSize=1),(o||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}rt("SymbolBuffers",Ad);class Pd{constructor(e,r,o){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new o,this.segments=new Ue,this.collisionVertexArray=new _e}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Qx.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}rt("CollisionBuffers",Pd);class Va{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(_=>_.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=sd([]),this.placementViewportMatrix=sd([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Qf(this.zoom,r["text-size"]),this.iconSizeData=Qf(this.zoom,r["icon-size"]);const o=this.layers[0].layout,u=o.get("symbol-sort-key"),g=o.get("symbol-z-order");this.canOverlap=Ed(o,"text-overlap","text-allow-overlap")!=="never"||Ed(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&!u.isConstant(),this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(_=>x.ah[_])),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=e.sourceID}createArrays(){this.text=new Ad(new Mi(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Ad(new Mi(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new f,this.lineVertexArray=new b,this.symbolInstances=new c,this.textAnchorOffsets=new E}calculateGlyphDependencies(e,r,o,u,g){for(let _=0;_<e.length;_++)if(r[e.charCodeAt(_)]=!0,(o||u)&&g){const y=Ql[e.charAt(_)];y&&(r[y.charCodeAt(0)]=!0)}}populate(e,r,o){const u=this.layers[0],g=u.layout,_=g.get("text-font"),y=g.get("text-field"),S=g.get("icon-image"),I=(y.value.kind!=="constant"||y.value.value instanceof Ur&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&(_.value.kind!=="constant"||_.value.value.length>0),P=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,C=g.get("symbol-sort-key");if(this.features=[],!I&&!P)return;const z=r.iconDependencies,F=r.glyphDependencies,B=r.availableImages,G=new Ti(this.zoom);for(const{feature:K,id:te,index:he,sourceLayerIndex:re}of e){const le=u._featureFilter.needGeometry,be=gs(K,le);if(!u._featureFilter.filter(G,be,o))continue;let Ae,Je;if(le||(be.geometry=ms(K)),I){const Ye=u.getValueAndResolveTokens("text-field",be,o,B),Ze=Ur.factory(Ye),$e=this.hasRTLText=this.hasRTLText||v0(Ze);(!$e||Wn.getRTLTextPluginStatus()==="unavailable"||$e&&Wn.isParsed())&&(Ae=t0(Ze,u,be))}if(P){const Ye=u.getValueAndResolveTokens("icon-image",be,o,B);Je=Ye instanceof rn?Ye:rn.fromString(Ye)}if(!Ae&&!Je)continue;const at=this.sortFeaturesByKey?C.evaluate(be,{},o):void 0;if(this.features.push({id:te,text:Ae,icon:Je,index:he,sourceLayerIndex:re,geometry:be.geometry,properties:K.properties,type:y0[K.type],sortKey:at}),Je&&(z[Je.name]=!0),Ae){const Ye=_.evaluate(be,{},o).join(","),Ze=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(x.ah.vertical)>=0;for(const $e of Ae.sections)if($e.image)z[$e.image.name]=!0;else{const nt=Bs(Ae.toString()),Ge=$e.fontStack||Ye,Le=F[Ge]=F[Ge]||{};this.calculateGlyphDependencies($e.text,Le,Ze,this.allowVerticalPlacement,nt)}}}g.get("symbol-placement")==="line"&&(this.features=function(K){const te={},he={},re=[];let le=0;function be(Ye){re.push(K[Ye]),le++}function Ae(Ye,Ze,$e){const nt=he[Ye];return delete he[Ye],he[Ze]=nt,re[nt].geometry[0].pop(),re[nt].geometry[0]=re[nt].geometry[0].concat($e[0]),nt}function Je(Ye,Ze,$e){const nt=te[Ze];return delete te[Ze],te[Ye]=nt,re[nt].geometry[0].shift(),re[nt].geometry[0]=$e[0].concat(re[nt].geometry[0]),nt}function at(Ye,Ze,$e){const nt=$e?Ze[0][Ze[0].length-1]:Ze[0][0];return`${Ye}:${nt.x}:${nt.y}`}for(let Ye=0;Ye<K.length;Ye++){const Ze=K[Ye],$e=Ze.geometry,nt=Ze.text?Ze.text.toString():null;if(!nt){be(Ye);continue}const Ge=at(nt,$e),Le=at(nt,$e,!0);if(Ge in he&&Le in te&&he[Ge]!==te[Le]){const mt=Je(Ge,Le,$e),ut=Ae(Ge,Le,re[mt].geometry);delete te[Ge],delete he[Le],he[at(nt,re[ut].geometry,!0)]=ut,re[mt].geometry=null}else Ge in he?Ae(Ge,Le,$e):Le in te?Je(Ge,Le,$e):(be(Ye),te[Ge]=le-1,he[Le]=le-1)}return re.filter(Ye=>Ye.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((K,te)=>K.sortKey-te.sortKey)}update(e,r,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,o),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const o=this.lineVertexArray.length;if(e.segment!==void 0){let u=e.dist(r[e.segment+1]),g=e.dist(r[e.segment]);const _={};for(let y=e.segment+1;y<r.length;y++)_[y]={x:r[y].x,y:r[y].y,tileUnitDistanceFromAnchor:u},y<r.length-1&&(u+=r[y+1].dist(r[y]));for(let y=e.segment||0;y>=0;y--)_[y]={x:r[y].x,y:r[y].y,tileUnitDistanceFromAnchor:g},y>0&&(g+=r[y-1].dist(r[y]));for(let y=0;y<r.length;y++){const S=_[y];this.lineVertexArray.emplaceBack(S.x,S.y,S.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,r,o,u,g,_,y,S,I,P,C,z){const F=e.indexArray,B=e.layoutVertexArray,G=e.segments.prepareSegment(4*r.length,B,F,this.canOverlap?_.sortKey:void 0),K=this.glyphOffsetArray.length,te=G.vertexLength,he=this.allowVerticalPlacement&&y===x.ah.vertical?Math.PI/2:0,re=_.text&&_.text.sections;for(let le=0;le<r.length;le++){const{tl:be,tr:Ae,bl:Je,br:at,tex:Ye,pixelOffsetTL:Ze,pixelOffsetBR:$e,minFontScaleX:nt,minFontScaleY:Ge,glyphOffset:Le,isSDF:mt,sectionIndex:ut}=r[le],Bt=G.vertexLength,yi=Le[1];Du(B,S.x,S.y,be.x,yi+be.y,Ye.x,Ye.y,o,mt,Ze.x,Ze.y,nt,Ge),Du(B,S.x,S.y,Ae.x,yi+Ae.y,Ye.x+Ye.w,Ye.y,o,mt,$e.x,Ze.y,nt,Ge),Du(B,S.x,S.y,Je.x,yi+Je.y,Ye.x,Ye.y+Ye.h,o,mt,Ze.x,$e.y,nt,Ge),Du(B,S.x,S.y,at.x,yi+at.y,Ye.x+Ye.w,Ye.y+Ye.h,o,mt,$e.x,$e.y,nt,Ge),Id(e.dynamicLayoutVertexArray,S,he),F.emplaceBack(Bt,Bt+1,Bt+2),F.emplaceBack(Bt+1,Bt+2,Bt+3),G.vertexLength+=4,G.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Le[0]),le!==r.length-1&&ut===r[le+1].sectionIndex||e.programConfigurations.populatePaintArrays(B.length,_,_.index,{},z,re&&re[ut])}e.placedSymbolArray.emplaceBack(S.x,S.y,K,this.glyphOffsetArray.length-K,te,I,P,S.segment,o?o[0]:0,o?o[1]:0,u[0],u[1],y,0,!1,0,C)}_addCollisionDebugVertex(e,r,o,u,g,_){return r.emplaceBack(0,0),e.emplaceBack(o.x,o.y,u,g,Math.round(_.x),Math.round(_.y))}addCollisionDebugVertices(e,r,o,u,g,_,y){const S=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),I=S.vertexLength,P=g.layoutVertexArray,C=g.collisionVertexArray,z=y.anchorX,F=y.anchorY;this._addCollisionDebugVertex(P,C,_,z,F,new N(e,r)),this._addCollisionDebugVertex(P,C,_,z,F,new N(o,r)),this._addCollisionDebugVertex(P,C,_,z,F,new N(o,u)),this._addCollisionDebugVertex(P,C,_,z,F,new N(e,u)),S.vertexLength+=4;const B=g.indexArray;B.emplaceBack(I,I+1),B.emplaceBack(I+1,I+2),B.emplaceBack(I+2,I+3),B.emplaceBack(I+3,I),S.primitiveLength+=4}addDebugCollisionBoxes(e,r,o,u){for(let g=e;g<r;g++){const _=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(_.x1,_.y1,_.x2,_.y2,u?this.textCollisionBox:this.iconCollisionBox,_.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Pd(fe,Of.members,ze),this.iconCollisionBox=new Pd(fe,Of.members,ze);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,o,u,g,_,y,S,I){const P={};for(let C=r;C<o;C++){const z=e.get(C);P.textBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},P.textFeatureIndex=z.featureIndex;break}for(let C=u;C<g;C++){const z=e.get(C);P.verticalTextBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},P.verticalTextFeatureIndex=z.featureIndex;break}for(let C=_;C<y;C++){const z=e.get(C);P.iconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},P.iconFeatureIndex=z.featureIndex;break}for(let C=S;C<I;C++){const z=e.get(C);P.verticalIconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},P.verticalIconFeatureIndex=z.featureIndex;break}return P}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const o=e.placedSymbolArray.get(r),u=o.vertexStartIndex+4*o.numGlyphs;for(let g=o.vertexStartIndex;g<u;g+=4)e.indexArray.emplaceBack(g,g+1,g+2),e.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),o=Math.cos(e),u=[],g=[],_=[];for(let y=0;y<this.symbolInstances.length;++y){_.push(y);const S=this.symbolInstances.get(y);u.push(0|Math.round(r*S.anchorX+o*S.anchorY)),g.push(S.featureIndex)}return _.sort((y,S)=>u[y]-u[S]||g[S]-g[y]),_}addToSortKeyRanges(e,r){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===r?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const o=this.symbolInstances.get(r);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((u,g,_)=>{u>=0&&_.indexOf(u)===g&&this.addIndicesForPlacedSymbol(this.text,u)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let em,tm;rt("SymbolBucket",Va,{omit:["layers","collisionBoxArray","features","compareText"]}),Va.MAX_GLYPHS=65535,Va.addDynamicAttributes=Id;var Cd={get paint(){return tm=tm||new Rr({"icon-opacity":new xt(ee.paint_symbol["icon-opacity"]),"icon-color":new xt(ee.paint_symbol["icon-color"]),"icon-halo-color":new xt(ee.paint_symbol["icon-halo-color"]),"icon-halo-width":new xt(ee.paint_symbol["icon-halo-width"]),"icon-halo-blur":new xt(ee.paint_symbol["icon-halo-blur"]),"icon-translate":new dt(ee.paint_symbol["icon-translate"]),"icon-translate-anchor":new dt(ee.paint_symbol["icon-translate-anchor"]),"text-opacity":new xt(ee.paint_symbol["text-opacity"]),"text-color":new xt(ee.paint_symbol["text-color"],{runtimeType:si,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new xt(ee.paint_symbol["text-halo-color"]),"text-halo-width":new xt(ee.paint_symbol["text-halo-width"]),"text-halo-blur":new xt(ee.paint_symbol["text-halo-blur"]),"text-translate":new dt(ee.paint_symbol["text-translate"]),"text-translate-anchor":new dt(ee.paint_symbol["text-translate-anchor"])})},get layout(){return em=em||new Rr({"symbol-placement":new dt(ee.layout_symbol["symbol-placement"]),"symbol-spacing":new dt(ee.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new dt(ee.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new xt(ee.layout_symbol["symbol-sort-key"]),"symbol-z-order":new dt(ee.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new dt(ee.layout_symbol["icon-allow-overlap"]),"icon-overlap":new dt(ee.layout_symbol["icon-overlap"]),"icon-ignore-placement":new dt(ee.layout_symbol["icon-ignore-placement"]),"icon-optional":new dt(ee.layout_symbol["icon-optional"]),"icon-rotation-alignment":new dt(ee.layout_symbol["icon-rotation-alignment"]),"icon-size":new xt(ee.layout_symbol["icon-size"]),"icon-text-fit":new dt(ee.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new dt(ee.layout_symbol["icon-text-fit-padding"]),"icon-image":new xt(ee.layout_symbol["icon-image"]),"icon-rotate":new xt(ee.layout_symbol["icon-rotate"]),"icon-padding":new xt(ee.layout_symbol["icon-padding"]),"icon-keep-upright":new dt(ee.layout_symbol["icon-keep-upright"]),"icon-offset":new xt(ee.layout_symbol["icon-offset"]),"icon-anchor":new xt(ee.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new dt(ee.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new dt(ee.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new dt(ee.layout_symbol["text-rotation-alignment"]),"text-field":new xt(ee.layout_symbol["text-field"]),"text-font":new xt(ee.layout_symbol["text-font"]),"text-size":new xt(ee.layout_symbol["text-size"]),"text-max-width":new xt(ee.layout_symbol["text-max-width"]),"text-line-height":new dt(ee.layout_symbol["text-line-height"]),"text-letter-spacing":new xt(ee.layout_symbol["text-letter-spacing"]),"text-justify":new xt(ee.layout_symbol["text-justify"]),"text-radial-offset":new xt(ee.layout_symbol["text-radial-offset"]),"text-variable-anchor":new dt(ee.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new xt(ee.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new xt(ee.layout_symbol["text-anchor"]),"text-max-angle":new dt(ee.layout_symbol["text-max-angle"]),"text-writing-mode":new dt(ee.layout_symbol["text-writing-mode"]),"text-rotate":new xt(ee.layout_symbol["text-rotate"]),"text-padding":new dt(ee.layout_symbol["text-padding"]),"text-keep-upright":new dt(ee.layout_symbol["text-keep-upright"]),"text-transform":new xt(ee.layout_symbol["text-transform"]),"text-offset":new xt(ee.layout_symbol["text-offset"]),"text-allow-overlap":new dt(ee.layout_symbol["text-allow-overlap"]),"text-overlap":new dt(ee.layout_symbol["text-overlap"]),"text-ignore-placement":new dt(ee.layout_symbol["text-ignore-placement"]),"text-optional":new dt(ee.layout_symbol["text-optional"])})}};class im{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Xi,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}rt("FormatSectionOverride",im,{omit:["defaultValue"]});class zu extends fn{constructor(e){super(e,Cd)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const u=[];for(const g of o)u.indexOf(g)<0&&u.push(g);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,o,u){const g=this.layout.get(e).evaluate(r,{},o,u),_=this._unevaluatedLayout._values[e];return _.isDataDriven()||fi(_.value)||!g?g:function(y,S){return S.replace(/{([^{}]+)}/g,(I,P)=>y&&P in y?String(y[P]):"")}(r.properties,g)}createBucket(e){return new Va(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Cd.paint.overridableProperties){if(!zu.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),o=new im(r),u=new _i(o,r.property.specification);let g=null;g=r.value.kind==="constant"||r.value.kind==="source"?new ca("source",u):new xl("composite",u,r.value.zoomStops),this.paint._values[e]=new pn(r.property,g,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,o){return!(!this.layout||r.isDataDriven()||o.isDataDriven())&&zu.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const o=e.get("text-field"),u=Cd.paint.properties[r];let g=!1;const _=y=>{for(const S of y)if(u.overrides&&u.overrides.hasOverride(S))return void(g=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Ur)_(o.value.value.sections);else if(o.value.kind==="source"){const y=I=>{g||(I instanceof jn&&Ui(I.value)===Yi?_(I.value.sections):I instanceof aa?_(I.sections):I.eachChild(y))},S=o.value;S._styleExpression&&y(S._styleExpression.expression)}return g}}let rm;var b0={get paint(){return rm=rm||new Rr({"background-color":new dt(ee.paint_background["background-color"]),"background-pattern":new To(ee.paint_background["background-pattern"]),"background-opacity":new dt(ee.paint_background["background-opacity"])})}};class w0 extends fn{constructor(e){super(e,b0)}}let nm;var S0={get paint(){return nm=nm||new Rr({"raster-opacity":new dt(ee.paint_raster["raster-opacity"]),"raster-hue-rotate":new dt(ee.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new dt(ee.paint_raster["raster-brightness-min"]),"raster-brightness-max":new dt(ee.paint_raster["raster-brightness-max"]),"raster-saturation":new dt(ee.paint_raster["raster-saturation"]),"raster-contrast":new dt(ee.paint_raster["raster-contrast"]),"raster-resampling":new dt(ee.paint_raster["raster-resampling"]),"raster-fade-duration":new dt(ee.paint_raster["raster-fade-duration"])})}};class T0 extends fn{constructor(e){super(e,S0)}}class E0 extends fn{constructor(e){super(e,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class I0{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Md=63710088e-1;class js{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new js(ct(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,o=this.lat*r,u=e.lat*r,g=Math.sin(o)*Math.sin(u)+Math.cos(o)*Math.cos(u)*Math.cos((e.lng-this.lng)*r);return Md*Math.acos(Math.min(g,1))}static convert(e){if(e instanceof js)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new js(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new js(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const sm=2*Math.PI*Md;function om(i){return sm*Math.cos(i*Math.PI/180)}function am(i){return(180+i)/360}function lm(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function cm(i,e){return i/om(e)}function kd(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Ru{constructor(e,r,o=0){this.x=+e,this.y=+r,this.z=+o}static fromLngLat(e,r=0){const o=js.convert(e);return new Ru(am(o.lng),lm(o.lat),cm(r,o.lat))}toLngLat(){return new js(360*this.x-180,kd(this.y))}toAltitude(){return this.z*om(kd(this.y))}meterInMercatorCoordinateUnits(){return 1/sm*(e=kd(this.y),1/Math.cos(e*Math.PI/180));var e}}function um(i,e,r){var o=2*Math.PI*6378137/256/Math.pow(2,r);return[i*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class Dd{constructor(e,r,o){if(e<0||e>25||o<0||o>=Math.pow(2,e)||r<0||r>=Math.pow(2,e))throw new Error(`x=${r}, y=${o}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=o,this.key=rc(0,e,e,r,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,o){const u=(_=this.y,y=this.z,S=um(256*(g=this.x),256*(_=Math.pow(2,y)-_-1),y),I=um(256*(g+1),256*(_+1),y),S[0]+","+S[1]+","+I[0]+","+I[1]);var g,_,y,S,I;const P=function(C,z,F){let B,G="";for(let K=C;K>0;K--)B=1<<K-1,G+=(z&B?1:0)+(F&B?2:0);return G}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,P).replace(/{bbox-epsg-3857}/g,u)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new N((e.x*r-this.x)*Oi,(e.y*r-this.y)*Oi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class hm{constructor(e,r){this.wrap=e,this.canonical=r,this.key=rc(e,r.z,r.z,r.x,r.y)}}class gn{constructor(e,r,o,u,g){if(e<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${o}`);this.overscaledZ=e,this.wrap=r,this.canonical=new Dd(o,+u,+g),this.key=rc(r,e,o,u,g)}clone(){return new gn(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new gn(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new gn(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-e;return e>this.canonical.z?rc(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):rc(this.wrap*+r,e,e,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new gn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,o=2*this.canonical.x,u=2*this.canonical.y;return[new gn(r,this.wrap,r,o,u),new gn(r,this.wrap,r,o+1,u),new gn(r,this.wrap,r,o,u+1),new gn(r,this.wrap,r,o+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new gn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new gn(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new hm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Ru(e.x-this.wrap,e.y))}}function rc(i,e,r,o,u){(i*=2)<0&&(i=-1*i-1);const g=1<<r;return(g*g*i+g*u+o).toString(36)+r.toString(36)+e.toString(36)}rt("CanonicalTileID",Dd),rt("OverscaledTileID",gn,{omit:["posMatrix"]});class dm{constructor(e,r,o,u=1,g=1,_=1,y=0){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void ri(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const S=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=u,this.greenFactor=g,this.blueFactor=_,this.baseShift=y;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let I=0;I<S;I++)this.data[this._idx(-1,I)]=this.data[this._idx(0,I)],this.data[this._idx(S,I)]=this.data[this._idx(S-1,I)],this.data[this._idx(I,-1)]=this.data[this._idx(I,0)],this.data[this._idx(I,S)]=this.data[this._idx(I,S-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(S,-1)]=this.data[this._idx(S-1,0)],this.data[this._idx(-1,S)]=this.data[this._idx(0,S-1)],this.data[this._idx(S,S)]=this.data[this._idx(S-1,S-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let I=0;I<S;I++)for(let P=0;P<S;P++){const C=this.get(I,P);C>this.max&&(this.max=C),C<this.min&&(this.min=C)}}get(e,r){const o=new Uint8Array(this.data.buffer),u=4*this._idx(e,r);return this.unpack(o[u],o[u+1],o[u+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}unpack(e,r,o){return e*this.redFactor+r*this.greenFactor+o*this.blueFactor-this.baseShift}getPixels(){return new mn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=r*this.dim,g=r*this.dim+this.dim,_=o*this.dim,y=o*this.dim+this.dim;switch(r){case-1:u=g-1;break;case 1:g=u+1}switch(o){case-1:_=y-1;break;case 1:y=_+1}const S=-r*this.dim,I=-o*this.dim;for(let P=_;P<y;P++)for(let C=u;C<g;C++)this.data[this._idx(C,P)]=e.data[this._idx(C+S,P+I)]}}rt("DEMData",dm);class pm{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const o=e[r];this._stringToNumber[o]=r,this._numberToString[r]=o}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class fm{constructor(e,r,o,u,g){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=o,e._y=u,this.properties=e.properties,this.id=g}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class mm{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new bo(Oi,16,0),this.grid3D=new bo(Oi,16,0),this.featureIndexArray=new M,this.promoteId=r}insert(e,r,o,u,g,_){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,u,g);const S=_?this.grid3D:this.grid;for(let I=0;I<r.length;I++){const P=r[I],C=[1/0,1/0,-1/0,-1/0];for(let z=0;z<P.length;z++){const F=P[z];C[0]=Math.min(C[0],F.x),C[1]=Math.min(C[1],F.y),C[2]=Math.max(C[2],F.x),C[3]=Math.max(C[3],F.y)}C[0]<Oi&&C[1]<Oi&&C[2]>=0&&C[3]>=0&&S.insert(y,C[0],C[1],C[2],C[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Vs.VectorTile(new vd(this.rawTileData)).layers,this.sourceLayerCoder=new pm(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,o,u){this.loadVTLayers();const g=e.params||{},_=Oi/e.tileSize/e.scale,y=pa(g.filter),S=e.queryGeometry,I=e.queryPadding*_,P=_m(S),C=this.grid.query(P.minX-I,P.minY-I,P.maxX+I,P.maxY+I),z=_m(e.cameraQueryGeometry),F=this.grid3D.query(z.minX-I,z.minY-I,z.maxX+I,z.maxY+I,(K,te,he,re)=>function(le,be,Ae,Je,at){for(const Ze of le)if(be<=Ze.x&&Ae<=Ze.y&&Je>=Ze.x&&at>=Ze.y)return!0;const Ye=[new N(be,Ae),new N(be,at),new N(Je,at),new N(Je,Ae)];if(le.length>2){for(const Ze of Ye)if(za(le,Ze))return!0}for(let Ze=0;Ze<le.length-1;Ze++)if(nx(le[Ze],le[Ze+1],Ye))return!0;return!1}(e.cameraQueryGeometry,K-I,te-I,he+I,re+I));for(const K of F)C.push(K);C.sort(A0);const B={};let G;for(let K=0;K<C.length;K++){const te=C[K];if(te===G)continue;G=te;const he=this.featureIndexArray.get(te);let re=null;this.loadMatchingFeature(B,he.bucketIndex,he.sourceLayerIndex,he.featureIndex,y,g.layers,g.availableImages,r,o,u,(le,be,Ae)=>(re||(re=ms(le)),be.queryIntersectsFeature(S,le,Ae,re,this.z,e.transform,_,e.pixelPosMatrix)))}return B}loadMatchingFeature(e,r,o,u,g,_,y,S,I,P,C){const z=this.bucketLayerIDs[r];if(_&&!function(K,te){for(let he=0;he<K.length;he++)if(te.indexOf(K[he])>=0)return!0;return!1}(_,z))return;const F=this.sourceLayerCoder.decode(o),B=this.vtLayers[F].feature(u);if(g.needGeometry){const K=gs(B,!0);if(!g.filter(new Ti(this.tileID.overscaledZ),K,this.tileID.canonical))return}else if(!g.filter(new Ti(this.tileID.overscaledZ),B))return;const G=this.getId(B,F);for(let K=0;K<z.length;K++){const te=z[K];if(_&&_.indexOf(te)<0)continue;const he=S[te];if(!he)continue;let re={};G&&P&&(re=P.getState(he.sourceLayer||"_geojsonTileLayer",G));const le=vt({},I[te]);le.paint=gm(le.paint,he.paint,B,re,y),le.layout=gm(le.layout,he.layout,B,re,y);const be=!C||C(B,he,re);if(!be)continue;const Ae=new fm(B,this.z,this.x,this.y,G);Ae.layer=le;let Je=e[te];Je===void 0&&(Je=e[te]=[]),Je.push({featureIndex:u,feature:Ae,intersectionZ:be})}}lookupSymbolFeatures(e,r,o,u,g,_,y,S){const I={};this.loadVTLayers();const P=pa(g);for(const C of e)this.loadMatchingFeature(I,o,u,C,P,_,y,S,r);return I}hasLayer(e){for(const r of this.bucketLayerIDs)for(const o of r)if(e===o)return!0;return!1}getId(e,r){let o=e.id;return this.promoteId&&(o=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof o=="boolean"&&(o=Number(o))),o}}function gm(i,e,r,o,u){return ot(i,(g,_)=>{const y=e instanceof So?e.get(_):null;return y&&y.evaluate?y.evaluate(r,o,u):y})}function _m(i){let e=1/0,r=1/0,o=-1/0,u=-1/0;for(const g of i)e=Math.min(e,g.x),r=Math.min(r,g.y),o=Math.max(o,g.x),u=Math.max(u,g.y);return{minX:e,minY:r,maxX:o,maxY:u}}function A0(i,e){return e-i}function ym(i,e,r,o,u){const g=[];for(let _=0;_<i.length;_++){const y=i[_];let S;for(let I=0;I<y.length-1;I++){let P=y[I],C=y[I+1];P.x<e&&C.x<e||(P.x<e?P=new N(e,P.y+(e-P.x)/(C.x-P.x)*(C.y-P.y))._round():C.x<e&&(C=new N(e,P.y+(e-P.x)/(C.x-P.x)*(C.y-P.y))._round()),P.y<r&&C.y<r||(P.y<r?P=new N(P.x+(r-P.y)/(C.y-P.y)*(C.x-P.x),r)._round():C.y<r&&(C=new N(P.x+(r-P.y)/(C.y-P.y)*(C.x-P.x),r)._round()),P.x>=o&&C.x>=o||(P.x>=o?P=new N(o,P.y+(o-P.x)/(C.x-P.x)*(C.y-P.y))._round():C.x>=o&&(C=new N(o,P.y+(o-P.x)/(C.x-P.x)*(C.y-P.y))._round()),P.y>=u&&C.y>=u||(P.y>=u?P=new N(P.x+(u-P.y)/(C.y-P.y)*(C.x-P.x),u)._round():C.y>=u&&(C=new N(P.x+(u-P.y)/(C.y-P.y)*(C.x-P.x),u)._round()),S&&P.equals(S[S.length-1])||(S=[P],g.push(S)),S.push(C)))))}}return g}rt("FeatureIndex",mm,{omit:["rawTileData","sourceLayerCoder"]});class qs extends N{constructor(e,r,o,u){super(e,r),this.angle=o,u!==void 0&&(this.segment=u)}clone(){return new qs(this.x,this.y,this.angle,this.segment)}}function xm(i,e,r,o,u){if(e.segment===void 0||r===0)return!0;let g=e,_=e.segment+1,y=0;for(;y>-r/2;){if(_--,_<0)return!1;y-=i[_].dist(g),g=i[_]}y+=i[_].dist(i[_+1]),_++;const S=[];let I=0;for(;y<r/2;){const P=i[_],C=i[_+1];if(!C)return!1;let z=i[_-1].angleTo(P)-P.angleTo(C);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:y,angleDelta:z}),I+=z;y-S[0].distance>o;)I-=S.shift().angleDelta;if(I>u)return!1;_++,y+=P.dist(C)}return!0}function vm(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function bm(i,e,r){return i?.6*e*r:0}function wm(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function P0(i,e,r,o,u,g){const _=bm(r,u,g),y=wm(r,o)*g;let S=0;const I=vm(i)/2;for(let P=0;P<i.length-1;P++){const C=i[P],z=i[P+1],F=C.dist(z);if(S+F>I){const B=(I-S)/F,G=wr.number(C.x,z.x,B),K=wr.number(C.y,z.y,B),te=new qs(G,K,z.angleTo(C),P);return te._round(),!_||xm(i,te,y,_,e)?te:void 0}S+=F}}function C0(i,e,r,o,u,g,_,y,S){const I=bm(o,g,_),P=wm(o,u),C=P*_,z=i[0].x===0||i[0].x===S||i[0].y===0||i[0].y===S;return e-C<e/4&&(e=C+e/4),Sm(i,z?e/2*y%e:(P/2+2*g)*_*y%e,e,I,r,C,z,!1,S)}function Sm(i,e,r,o,u,g,_,y,S){const I=g/2,P=vm(i);let C=0,z=e-r,F=[];for(let B=0;B<i.length-1;B++){const G=i[B],K=i[B+1],te=G.dist(K),he=K.angleTo(G);for(;z+r<C+te;){z+=r;const re=(z-C)/te,le=wr.number(G.x,K.x,re),be=wr.number(G.y,K.y,re);if(le>=0&&le<S&&be>=0&&be<S&&z-I>=0&&z+I<=P){const Ae=new qs(le,be,he,B);Ae._round(),o&&!xm(i,Ae,g,o,u)||F.push(Ae)}}C+=te}return y||F.length||_||(F=Sm(i,C/2,r,o,u,g,_,!0,S)),F}rt("Anchor",qs);const $a=Zr;function Tm(i,e,r,o){const u=[],g=i.image,_=g.pixelRatio,y=g.paddedRect.w-2*$a,S=g.paddedRect.h-2*$a,I=i.right-i.left,P=i.bottom-i.top,C=g.stretchX||[[0,y]],z=g.stretchY||[[0,S]],F=($e,nt)=>$e+nt[1]-nt[0],B=C.reduce(F,0),G=z.reduce(F,0),K=y-B,te=S-G;let he=0,re=B,le=0,be=G,Ae=0,Je=K,at=0,Ye=te;if(g.content&&o){const $e=g.content;he=Lu(C,0,$e[0]),le=Lu(z,0,$e[1]),re=Lu(C,$e[0],$e[2]),be=Lu(z,$e[1],$e[3]),Ae=$e[0]-he,at=$e[1]-le,Je=$e[2]-$e[0]-re,Ye=$e[3]-$e[1]-be}const Ze=($e,nt,Ge,Le)=>{const mt=Fu($e.stretch-he,re,I,i.left),ut=Ou($e.fixed-Ae,Je,$e.stretch,B),Bt=Fu(nt.stretch-le,be,P,i.top),yi=Ou(nt.fixed-at,Ye,nt.stretch,G),Ii=Fu(Ge.stretch-he,re,I,i.left),ir=Ou(Ge.fixed-Ae,Je,Ge.stretch,B),on=Fu(Le.stretch-le,be,P,i.top),Fr=Ou(Le.fixed-at,Ye,Le.stretch,G),Hi=new N(mt,Bt),hr=new N(Ii,Bt),yr=new N(Ii,on),Or=new N(mt,on),Br=new N(ut/_,yi/_),rr=new N(ir/_,Fr/_),nr=e*Math.PI/180;if(nr){const Er=Math.sin(nr),Wr=Math.cos(nr),Kr=[Wr,-Er,Er,Wr];Hi._matMult(Kr),hr._matMult(Kr),Or._matMult(Kr),yr._matMult(Kr)}const Tr=$e.stretch+$e.fixed,Nr=nt.stretch+nt.fixed;return{tl:Hi,tr:hr,bl:Or,br:yr,tex:{x:g.paddedRect.x+$a+Tr,y:g.paddedRect.y+$a+Nr,w:Ge.stretch+Ge.fixed-Tr,h:Le.stretch+Le.fixed-Nr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Br,pixelOffsetBR:rr,minFontScaleX:Je/_/I,minFontScaleY:Ye/_/P,isSDF:r}};if(o&&(g.stretchX||g.stretchY)){const $e=Em(C,K,B),nt=Em(z,te,G);for(let Ge=0;Ge<$e.length-1;Ge++){const Le=$e[Ge],mt=$e[Ge+1];for(let ut=0;ut<nt.length-1;ut++)u.push(Ze(Le,nt[ut],mt,nt[ut+1]))}}else u.push(Ze({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:S+1}));return u}function Lu(i,e,r){let o=0;for(const u of i)o+=Math.max(e,Math.min(r,u[1]))-Math.max(e,Math.min(r,u[0]));return o}function Em(i,e,r){const o=[{fixed:-$a,stretch:0}];for(const[u,g]of i){const _=o[o.length-1];o.push({fixed:u-_.stretch,stretch:_.stretch}),o.push({fixed:u-_.stretch,stretch:_.stretch+(g-u)})}return o.push({fixed:e+$a,stretch:r}),o}function Fu(i,e,r,o){return i/e*r+o}function Ou(i,e,r,o){return i-e*r/o}class Bu{constructor(e,r,o,u,g,_,y,S,I,P){if(this.boxStartIndex=e.length,I){let C=_.top,z=_.bottom;const F=_.collisionPadding;F&&(C-=F[1],z+=F[3]);let B=z-C;B>0&&(B=Math.max(10,B),this.circleDiameter=B)}else{let C=_.top*y-S[0],z=_.bottom*y+S[2],F=_.left*y-S[3],B=_.right*y+S[1];const G=_.collisionPadding;if(G&&(F-=G[0]*y,C-=G[1]*y,B+=G[2]*y,z+=G[3]*y),P){const K=new N(F,C),te=new N(B,C),he=new N(F,z),re=new N(B,z),le=P*Math.PI/180;K._rotate(le),te._rotate(le),he._rotate(le),re._rotate(le),F=Math.min(K.x,te.x,he.x,re.x),B=Math.max(K.x,te.x,he.x,re.x),C=Math.min(K.y,te.y,he.y,re.y),z=Math.max(K.y,te.y,he.y,re.y)}e.emplaceBack(r.x,r.y,F,C,B,z,o,u,g)}this.boxEndIndex=e.length}}class M0{constructor(e=[],r=k0){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:o}=this,u=r[e];for(;e>0;){const g=e-1>>1,_=r[g];if(o(u,_)>=0)break;r[e]=_,e=g}r[e]=u}_down(e){const{data:r,compare:o}=this,u=this.length>>1,g=r[e];for(;e<u;){let _=1+(e<<1),y=r[_];const S=_+1;if(S<this.length&&o(r[S],y)<0&&(_=S,y=r[S]),o(y,g)>=0)break;r[e]=y,e=_}r[e]=g}}function k0(i,e){return i<e?-1:i>e?1:0}function D0(i,e=1,r=!1){let o=1/0,u=1/0,g=-1/0,_=-1/0;const y=i[0];for(let F=0;F<y.length;F++){const B=y[F];(!F||B.x<o)&&(o=B.x),(!F||B.y<u)&&(u=B.y),(!F||B.x>g)&&(g=B.x),(!F||B.y>_)&&(_=B.y)}const S=Math.min(g-o,_-u);let I=S/2;const P=new M0([],z0);if(S===0)return new N(o,u);for(let F=o;F<g;F+=S)for(let B=u;B<_;B+=S)P.push(new Ua(F+I,B+I,I,i));let C=function(F){let B=0,G=0,K=0;const te=F[0];for(let he=0,re=te.length,le=re-1;he<re;le=he++){const be=te[he],Ae=te[le],Je=be.x*Ae.y-Ae.x*be.y;G+=(be.x+Ae.x)*Je,K+=(be.y+Ae.y)*Je,B+=3*Je}return new Ua(G/B,K/B,0,F)}(i),z=P.length;for(;P.length;){const F=P.pop();(F.d>C.d||!C.d)&&(C=F,r&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,z)),F.max-C.d<=e||(I=F.h/2,P.push(new Ua(F.p.x-I,F.p.y-I,I,i)),P.push(new Ua(F.p.x+I,F.p.y-I,I,i)),P.push(new Ua(F.p.x-I,F.p.y+I,I,i)),P.push(new Ua(F.p.x+I,F.p.y+I,I,i)),z+=4)}return r&&(console.log(`num probes: ${z}`),console.log(`best distance: ${C.d}`)),C.p}function z0(i,e){return e.max-i.max}function Ua(i,e,r,o){this.p=new N(i,e),this.h=r,this.d=function(u,g){let _=!1,y=1/0;for(let S=0;S<g.length;S++){const I=g[S];for(let P=0,C=I.length,z=C-1;P<C;z=P++){const F=I[P],B=I[z];F.y>u.y!=B.y>u.y&&u.x<(B.x-F.x)*(u.y-F.y)/(B.y-F.y)+F.x&&(_=!_),y=Math.min(y,lf(u,F,B))}}return(_?1:-1)*Math.sqrt(y)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}var _r;x.ap=void 0,(_r=x.ap||(x.ap={}))[_r.center=1]="center",_r[_r.left=2]="left",_r[_r.right=3]="right",_r[_r.top=4]="top",_r[_r.bottom=5]="bottom",_r[_r["top-left"]=6]="top-left",_r[_r["top-right"]=7]="top-right",_r[_r["bottom-left"]=8]="bottom-left",_r[_r["bottom-right"]=9]="bottom-right";const Gs=7,zd=Number.POSITIVE_INFINITY;function Im(i,e){return e[1]!==zd?function(r,o,u){let g=0,_=0;switch(o=Math.abs(o),u=Math.abs(u),r){case"top-right":case"top-left":case"top":_=u-Gs;break;case"bottom-right":case"bottom-left":case"bottom":_=-u+Gs}switch(r){case"top-right":case"bottom-right":case"right":g=-o;break;case"top-left":case"bottom-left":case"left":g=o}return[g,_]}(i,e[0],e[1]):function(r,o){let u=0,g=0;o<0&&(o=0);const _=o/Math.SQRT2;switch(r){case"top-right":case"top-left":g=_-Gs;break;case"bottom-right":case"bottom-left":g=-_+Gs;break;case"bottom":g=-o+Gs;break;case"top":g=o-Gs}switch(r){case"top-right":case"bottom-right":u=-_;break;case"top-left":case"bottom-left":u=_;break;case"left":u=o;break;case"right":u=-o}return[u,g]}(i,e[0])}function Am(i,e,r){var o;const u=i.layout,g=(o=u.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(e,{},r);if(g){const y=g.values,S=[];for(let I=0;I<y.length;I+=2){const P=S[I]=y[I],C=y[I+1].map(z=>z*tr);P.startsWith("top")?C[1]-=Gs:P.startsWith("bottom")&&(C[1]+=Gs),S[I+1]=C}return new tn(S)}const _=u.get("text-variable-anchor");if(_){let y;y=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[u.get("text-radial-offset").evaluate(e,{},r)*tr,zd]:u.get("text-offset").evaluate(e,{},r).map(I=>I*tr);const S=[];for(const I of _)S.push(I,Im(I,y));return new tn(S)}return null}function Rd(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function R0(i,e,r,o,u,g,_,y,S,I,P){let C=g.textMaxSize.evaluate(e,{});C===void 0&&(C=_);const z=i.layers[0].layout,F=z.get("icon-offset").evaluate(e,{},P),B=Cm(r.horizontal),G=_/24,K=i.tilePixelRatio*G,te=i.tilePixelRatio*C/24,he=i.tilePixelRatio*y,re=i.tilePixelRatio*z.get("symbol-spacing"),le=z.get("text-padding")*i.tilePixelRatio,be=function(Le,mt,ut,Bt=1){const yi=Le.get("icon-padding").evaluate(mt,{},ut),Ii=yi&&yi.values;return[Ii[0]*Bt,Ii[1]*Bt,Ii[2]*Bt,Ii[3]*Bt]}(z,e,P,i.tilePixelRatio),Ae=z.get("text-max-angle")/180*Math.PI,Je=z.get("text-rotation-alignment")!=="viewport"&&z.get("symbol-placement")!=="point",at=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Ye=z.get("symbol-placement"),Ze=re/2,$e=z.get("icon-text-fit");let nt;o&&$e!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(nt=Jf(o,r.vertical,$e,z.get("icon-text-fit-padding"),F,G)),B&&(o=Jf(o,B,$e,z.get("icon-text-fit-padding"),F,G)));const Ge=(Le,mt)=>{mt.x<0||mt.x>=Oi||mt.y<0||mt.y>=Oi||function(ut,Bt,yi,Ii,ir,on,Fr,Hi,hr,yr,Or,Br,rr,nr,Tr,Nr,Er,Wr,Kr,sr,Ut,Ir,xr,or,An){const Rn=ut.addToLineVertexArray(Bt,yi);let Ln,ys,Pn,_n,Xr=0,xs=0,oc=0,zm=0,Ud=-1,jd=-1;const vs={};let Rm=Ri("");if(ut.allowVerticalPlacement&&Ii.vertical){const Ar=Hi.layout.get("text-rotate").evaluate(Ut,{},or)+90;Pn=new Bu(hr,Bt,yr,Or,Br,Ii.vertical,rr,nr,Tr,Ar),Fr&&(_n=new Bu(hr,Bt,yr,Or,Br,Fr,Er,Wr,Tr,Ar))}if(ir){const Ar=Hi.layout.get("icon-rotate").evaluate(Ut,{}),yn=Hi.layout.get("icon-text-fit")!=="none",Do=Tm(ir,Ar,xr,yn),On=Fr?Tm(Fr,Ar,xr,yn):void 0;ys=new Bu(hr,Bt,yr,Or,Br,ir,Er,Wr,!1,Ar),Xr=4*Do.length;const zo=ut.iconSizeData;let Qn=null;zo.kind==="source"?(Qn=[Jn*Hi.layout.get("icon-size").evaluate(Ut,{})],Qn[0]>Us&&ri(`${ut.layerIds[0]}: Value for "icon-size" is >= ${ic}. Reduce your "icon-size".`)):zo.kind==="composite"&&(Qn=[Jn*Ir.compositeIconSizes[0].evaluate(Ut,{},or),Jn*Ir.compositeIconSizes[1].evaluate(Ut,{},or)],(Qn[0]>Us||Qn[1]>Us)&&ri(`${ut.layerIds[0]}: Value for "icon-size" is >= ${ic}. Reduce your "icon-size".`)),ut.addSymbols(ut.icon,Do,Qn,sr,Kr,Ut,x.ah.none,Bt,Rn.lineStartIndex,Rn.lineLength,-1,or),Ud=ut.icon.placedSymbolArray.length-1,On&&(xs=4*On.length,ut.addSymbols(ut.icon,On,Qn,sr,Kr,Ut,x.ah.vertical,Bt,Rn.lineStartIndex,Rn.lineLength,-1,or),jd=ut.icon.placedSymbolArray.length-1)}const Lm=Object.keys(Ii.horizontal);for(const Ar of Lm){const yn=Ii.horizontal[Ar];if(!Ln){Rm=Ri(yn.text);const On=Hi.layout.get("text-rotate").evaluate(Ut,{},or);Ln=new Bu(hr,Bt,yr,Or,Br,yn,rr,nr,Tr,On)}const Do=yn.positionedLines.length===1;if(oc+=Pm(ut,Bt,yn,on,Hi,Tr,Ut,Nr,Rn,Ii.vertical?x.ah.horizontal:x.ah.horizontalOnly,Do?Lm:[Ar],vs,Ud,Ir,or),Do)break}Ii.vertical&&(zm+=Pm(ut,Bt,Ii.vertical,on,Hi,Tr,Ut,Nr,Rn,x.ah.vertical,["vertical"],vs,jd,Ir,or));const O0=Ln?Ln.boxStartIndex:ut.collisionBoxArray.length,B0=Ln?Ln.boxEndIndex:ut.collisionBoxArray.length,N0=Pn?Pn.boxStartIndex:ut.collisionBoxArray.length,V0=Pn?Pn.boxEndIndex:ut.collisionBoxArray.length,$0=ys?ys.boxStartIndex:ut.collisionBoxArray.length,U0=ys?ys.boxEndIndex:ut.collisionBoxArray.length,j0=_n?_n.boxStartIndex:ut.collisionBoxArray.length,q0=_n?_n.boxEndIndex:ut.collisionBoxArray.length;let Fn=-1;const Vu=(Ar,yn)=>Ar&&Ar.circleDiameter?Math.max(Ar.circleDiameter,yn):yn;Fn=Vu(Ln,Fn),Fn=Vu(Pn,Fn),Fn=Vu(ys,Fn),Fn=Vu(_n,Fn);const Fm=Fn>-1?1:0;Fm&&(Fn*=An/tr),ut.glyphOffsetArray.length>=Va.MAX_GLYPHS&&ri("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ut.sortKey!==void 0&&ut.addToSortKeyRanges(ut.symbolInstances.length,Ut.sortKey);const G0=Am(Hi,Ut,or),[H0,Z0]=function(Ar,yn){const Do=Ar.length,On=yn==null?void 0:yn.values;if((On==null?void 0:On.length)>0)for(let zo=0;zo<On.length;zo+=2){const Qn=On[zo+1];Ar.emplaceBack(x.ap[On[zo]],Qn[0],Qn[1])}return[Do,Ar.length]}(ut.textAnchorOffsets,G0);ut.symbolInstances.emplaceBack(Bt.x,Bt.y,vs.right>=0?vs.right:-1,vs.center>=0?vs.center:-1,vs.left>=0?vs.left:-1,vs.vertical||-1,Ud,jd,Rm,O0,B0,N0,V0,$0,U0,j0,q0,yr,oc,zm,Xr,xs,Fm,0,rr,Fn,H0,Z0)}(i,mt,Le,r,o,u,nt,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,K,[le,le,le,le],Je,S,he,be,at,F,e,g,I,P,_)};if(Ye==="line")for(const Le of ym(e.geometry,0,0,Oi,Oi)){const mt=C0(Le,re,Ae,r.vertical||B,o,24,te,i.overscaling,Oi);for(const ut of mt)B&&L0(i,B.text,Ze,ut)||Ge(Le,ut)}else if(Ye==="line-center"){for(const Le of e.geometry)if(Le.length>1){const mt=P0(Le,Ae,r.vertical||B,o,24,te);mt&&Ge(Le,mt)}}else if(e.type==="Polygon")for(const Le of dd(e.geometry,0)){const mt=D0(Le,16);Ge(Le[0],new qs(mt.x,mt.y,0))}else if(e.type==="LineString")for(const Le of e.geometry)Ge(Le,new qs(Le[0].x,Le[0].y,0));else if(e.type==="Point")for(const Le of e.geometry)for(const mt of Le)Ge([mt],new qs(mt.x,mt.y,0))}function Pm(i,e,r,o,u,g,_,y,S,I,P,C,z,F,B){const G=function(he,re,le,be,Ae,Je,at,Ye){const Ze=be.layout.get("text-rotate").evaluate(Je,{})*Math.PI/180,$e=[];for(const nt of re.positionedLines)for(const Ge of nt.positionedGlyphs){if(!Ge.rect)continue;const Le=Ge.rect||{};let mt=Gf+1,ut=!0,Bt=1,yi=0;const Ii=(Ae||Ye)&&Ge.vertical,ir=Ge.metrics.advance*Ge.scale/2;if(Ye&&re.verticalizable&&(yi=nt.lineOffset/2-(Ge.imageName?-(tr-Ge.metrics.width*Ge.scale)/2:(Ge.scale-1)*tr)),Ge.imageName){const sr=at[Ge.imageName];ut=sr.sdf,Bt=sr.pixelRatio,mt=Zr/Bt}const on=Ae?[Ge.x+ir,Ge.y]:[0,0];let Fr=Ae?[0,0]:[Ge.x+ir+le[0],Ge.y+le[1]-yi],Hi=[0,0];Ii&&(Hi=Fr,Fr=[0,0]);const hr=Ge.metrics.isDoubleResolution?2:1,yr=(Ge.metrics.left-mt)*Ge.scale-ir+Fr[0],Or=(-Ge.metrics.top-mt)*Ge.scale+Fr[1],Br=yr+Le.w/hr*Ge.scale/Bt,rr=Or+Le.h/hr*Ge.scale/Bt,nr=new N(yr,Or),Tr=new N(Br,Or),Nr=new N(yr,rr),Er=new N(Br,rr);if(Ii){const sr=new N(-ir,ir-ec),Ut=-Math.PI/2,Ir=tr/2-ir,xr=new N(5-ec-Ir,-(Ge.imageName?Ir:0)),or=new N(...Hi);nr._rotateAround(Ut,sr)._add(xr)._add(or),Tr._rotateAround(Ut,sr)._add(xr)._add(or),Nr._rotateAround(Ut,sr)._add(xr)._add(or),Er._rotateAround(Ut,sr)._add(xr)._add(or)}if(Ze){const sr=Math.sin(Ze),Ut=Math.cos(Ze),Ir=[Ut,-sr,sr,Ut];nr._matMult(Ir),Tr._matMult(Ir),Nr._matMult(Ir),Er._matMult(Ir)}const Wr=new N(0,0),Kr=new N(0,0);$e.push({tl:nr,tr:Tr,bl:Nr,br:Er,tex:Le,writingMode:re.writingMode,glyphOffset:on,sectionIndex:Ge.sectionIndex,isSDF:ut,pixelOffsetTL:Wr,pixelOffsetBR:Kr,minFontScaleX:0,minFontScaleY:0})}return $e}(0,r,y,u,g,_,o,i.allowVerticalPlacement),K=i.textSizeData;let te=null;K.kind==="source"?(te=[Jn*u.layout.get("text-size").evaluate(_,{})],te[0]>Us&&ri(`${i.layerIds[0]}: Value for "text-size" is >= ${ic}. Reduce your "text-size".`)):K.kind==="composite"&&(te=[Jn*F.compositeTextSizes[0].evaluate(_,{},B),Jn*F.compositeTextSizes[1].evaluate(_,{},B)],(te[0]>Us||te[1]>Us)&&ri(`${i.layerIds[0]}: Value for "text-size" is >= ${ic}. Reduce your "text-size".`)),i.addSymbols(i.text,G,te,y,g,_,I,e,S.lineStartIndex,S.lineLength,z,B);for(const he of P)C[he]=i.text.placedSymbolArray.length-1;return 4*G.length}function Cm(i){for(const e in i)return i[e];return null}function L0(i,e,r,o){const u=i.compareText;if(e in u){const g=u[e];for(let _=g.length-1;_>=0;_--)if(o.dist(g[_])<r)return!0}else u[e]=[];return u[e].push(o),!1}const Mm=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ld{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,o]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=o>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const g=Mm[15&o];if(!g)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new Ld(y,_,g,e)}constructor(e,r=64,o=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const g=Mm.indexOf(this.ArrayType),_=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-y%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${o}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+S,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+_+y+S),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+S,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=r,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Fd(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:_,nodeSize:y}=this,S=[0,g.length-1,0],I=[];for(;S.length;){const P=S.pop()||0,C=S.pop()||0,z=S.pop()||0;if(C-z<=y){for(let K=z;K<=C;K++){const te=_[2*K],he=_[2*K+1];te>=e&&te<=o&&he>=r&&he<=u&&I.push(g[K])}continue}const F=z+C>>1,B=_[2*F],G=_[2*F+1];B>=e&&B<=o&&G>=r&&G<=u&&I.push(g[F]),(P===0?e<=B:r<=G)&&(S.push(z),S.push(F-1),S.push(1-P)),(P===0?o>=B:u>=G)&&(S.push(F+1),S.push(C),S.push(1-P))}return I}within(e,r,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:g,nodeSize:_}=this,y=[0,u.length-1,0],S=[],I=o*o;for(;y.length;){const P=y.pop()||0,C=y.pop()||0,z=y.pop()||0;if(C-z<=_){for(let K=z;K<=C;K++)Dm(g[2*K],g[2*K+1],e,r)<=I&&S.push(u[K]);continue}const F=z+C>>1,B=g[2*F],G=g[2*F+1];Dm(B,G,e,r)<=I&&S.push(u[F]),(P===0?e-o<=B:r-o<=G)&&(y.push(z),y.push(F-1),y.push(1-P)),(P===0?e+o>=B:r+o>=G)&&(y.push(F+1),y.push(C),y.push(1-P))}return S}}function Fd(i,e,r,o,u,g){if(u-o<=r)return;const _=o+u>>1;km(i,e,_,o,u,g),Fd(i,e,r,o,_-1,1-g),Fd(i,e,r,_+1,u,1-g)}function km(i,e,r,o,u,g){for(;u>o;){if(u-o>600){const I=u-o+1,P=r-o+1,C=Math.log(I),z=.5*Math.exp(2*C/3),F=.5*Math.sqrt(C*z*(I-z)/I)*(P-I/2<0?-1:1);km(i,e,r,Math.max(o,Math.floor(r-P*z/I+F)),Math.min(u,Math.floor(r+(I-P)*z/I+F)),g)}const _=e[2*r+g];let y=o,S=u;for(nc(i,e,o,r),e[2*u+g]>_&&nc(i,e,o,u);y<S;){for(nc(i,e,y,S),y++,S--;e[2*y+g]<_;)y++;for(;e[2*S+g]>_;)S--}e[2*o+g]===_?nc(i,e,o,S):(S++,nc(i,e,S,u)),S<=r&&(o=S+1),r<=S&&(u=S-1)}}function nc(i,e,r,o){Od(i,r,o),Od(e,2*r,2*o),Od(e,2*r+1,2*o+1)}function Od(i,e,r){const o=i[e];i[e]=i[r],i[r]=o}function Dm(i,e,r,o){const u=i-r,g=e-o;return u*u+g*g}var Bd;x.bd=void 0,(Bd=x.bd||(x.bd={})).create="create",Bd.load="load",Bd.fullLoad="fullLoad";let Nu=null,sc=[];const Nd=1e3/60,Vd="loadTime",$d="fullLoadTime",F0={mark(i){performance.mark(i)},frame(i){const e=i;Nu!=null&&sc.push(e-Nu),Nu=e},clearMetrics(){Nu=null,sc=[],performance.clearMeasures(Vd),performance.clearMeasures($d);for(const i in x.bd)performance.clearMarks(x.bd[i])},getPerformanceMetrics(){performance.measure(Vd,x.bd.create,x.bd.load),performance.measure($d,x.bd.create,x.bd.fullLoad);const i=performance.getEntriesByName(Vd)[0].duration,e=performance.getEntriesByName($d)[0].duration,r=sc.length,o=1/(sc.reduce((g,_)=>g+_,0)/r/1e3),u=sc.filter(g=>g>Nd).reduce((g,_)=>g+(_-Nd)/Nd,0);return{loadTime:i,fullLoadTime:e,fps:o,percentDroppedFrames:u/(r+u)*100,totalFrames:r}}};x.$=Ue,x.A=Ra,x.B=function(i){if(Ft==null){const e=i.navigator?i.navigator.userAgent:null;Ft=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Ft},x.C=class{constructor(i,e){this.target=i,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new I0(()=>this.process()),this.subscription=function(r,o,u,g){return r.addEventListener(o,u,!1),{unsubscribe:()=>{r.removeEventListener(o,u,!1)}}}(this.target,"message",r=>this.receive(r)),this.globalScope=Lt(self)?i:window}registerMessageHandler(i,e){this.messageHandlers[i]=e}sendAsync(i,e){return new Promise((r,o)=>{const u=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[u]={resolve:r,reject:o},e&&e.signal.addEventListener("abort",()=>{delete this.resolveRejects[u];const y={id:u,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(y)},{once:!0});const g=[],_=Object.assign(Object.assign({},i),{id:u,sourceMapId:this.mapId,origin:location.origin,data:Fs(i.data,g)});this.target.postMessage(_,{transfer:g})})}receive(i){const e=i.data,r=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[r];const o=this.abortControllers[r];return delete this.abortControllers[r],void(o&&o.abort())}if(Lt(self)||e.mustQueue)return this.tasks[r]=e,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,e)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){return h(this,void 0,void 0,function*(){if(e.type==="<response>"){const u=this.resolveRejects[i];return delete this.resolveRejects[i],u?void(e.error?u.reject(Os(e.error)):u.resolve(Os(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=Os(e.data),o=new AbortController;this.abortControllers[i]=o;try{const u=yield this.messageHandlers[e.type](e.sourceMapId,r,o);this.completeTask(i,null,u)}catch(u){this.completeTask(i,u)}})}completeTask(i,e,r){const o=[];delete this.abortControllers[i];const u={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?Fs(e):null,data:Fs(r,o)};this.target.postMessage(u,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},x.D=dt,x.E=De,x.F=function(){var i=new Ra(16);return Ra!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},x.G=Pe,x.H=function(i,e,r){var o,u,g,_,y,S,I,P,C,z,F,B,G=r[0],K=r[1],te=r[2];return e===i?(i[12]=e[0]*G+e[4]*K+e[8]*te+e[12],i[13]=e[1]*G+e[5]*K+e[9]*te+e[13],i[14]=e[2]*G+e[6]*K+e[10]*te+e[14],i[15]=e[3]*G+e[7]*K+e[11]*te+e[15]):(u=e[1],g=e[2],_=e[3],y=e[4],S=e[5],I=e[6],P=e[7],C=e[8],z=e[9],F=e[10],B=e[11],i[0]=o=e[0],i[1]=u,i[2]=g,i[3]=_,i[4]=y,i[5]=S,i[6]=I,i[7]=P,i[8]=C,i[9]=z,i[10]=F,i[11]=B,i[12]=o*G+y*K+C*te+e[12],i[13]=u*G+S*K+z*te+e[13],i[14]=g*G+I*K+F*te+e[14],i[15]=_*G+P*K+B*te+e[15]),i},x.I=wd,x.J=function(i,e,r){var o=r[0],u=r[1],g=r[2];return i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i[3]=e[3]*o,i[4]=e[4]*u,i[5]=e[5]*u,i[6]=e[6]*u,i[7]=e[7]*u,i[8]=e[8]*g,i[9]=e[9]*g,i[10]=e[10]*g,i[11]=e[11]*g,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},x.K=df,x.L=function(i,e){const r={};for(let o=0;o<e.length;o++){const u=e[o];u in i&&(r[u]=i[u])}return r},x.M=js,x.N=am,x.O=lm,x.P=N,x.Q=gn,x.R=mn,x.S=Ne,x.T=Cl,x.U=He,x.V=vr,x.W=Oi,x.X=Ni,x.Y=Ru,x.Z=class extends Dl{},x._=h,x.a=mr,x.a$=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},x.a0=Dd,x.a1=Ce,x.a2=i=>{const e=window.document.createElement("video");return e.muted=!0,new Promise(r=>{e.onloadstart=()=>{r(e)};for(const o of i){const u=window.document.createElement("source");Kt(o)||(e.crossOrigin="Anonymous"),u.src=o,e.appendChild(u)}})},x.a3=function(){return tt++},x.a4=p,x.a5=Va,x.a6=pa,x.a7=gs,x.a8=Ti,x.a9=fm,x.aA=gt,x.aB=function(i,e){if(!i)return[{command:"setStyle",args:[e]}];let r=[];try{if(!Ie(i.version,e.version))return[{command:"setStyle",args:[e]}];Ie(i.center,e.center)||r.push({command:"setCenter",args:[e.center]}),Ie(i.zoom,e.zoom)||r.push({command:"setZoom",args:[e.zoom]}),Ie(i.bearing,e.bearing)||r.push({command:"setBearing",args:[e.bearing]}),Ie(i.pitch,e.pitch)||r.push({command:"setPitch",args:[e.pitch]}),Ie(i.sprite,e.sprite)||r.push({command:"setSprite",args:[e.sprite]}),Ie(i.glyphs,e.glyphs)||r.push({command:"setGlyphs",args:[e.glyphs]}),Ie(i.transition,e.transition)||r.push({command:"setTransition",args:[e.transition]}),Ie(i.light,e.light)||r.push({command:"setLight",args:[e.light]}),Ie(i.terrain,e.terrain)||r.push({command:"setTerrain",args:[e.terrain]}),Ie(i.sky,e.sky)||r.push({command:"setSky",args:[e.sky]});const o={},u=[];(function(_,y,S,I){let P;for(P in y=y||{},_=_||{})Object.prototype.hasOwnProperty.call(_,P)&&(Object.prototype.hasOwnProperty.call(y,P)||st(P,S,I));for(P in y)Object.prototype.hasOwnProperty.call(y,P)&&(Object.prototype.hasOwnProperty.call(_,P)?Ie(_[P],y[P])||(_[P].type==="geojson"&&y[P].type==="geojson"&&ft(_,y,P)?Oe(S,{command:"setGeoJSONSourceData",args:[P,y[P].data]}):wt(P,y,S,I)):Fe(P,y,S))})(i.sources,e.sources,u,o);const g=[];i.layers&&i.layers.forEach(_=>{"source"in _&&o[_.source]?r.push({command:"removeLayer",args:[_.id]}):g.push(_)}),r=r.concat(u),function(_,y,S){y=y||[];const I=(_=_||[]).map(Nt),P=y.map(Nt),C=_.reduce(Zt,{}),z=y.reduce(Zt,{}),F=I.slice(),B=Object.create(null);let G,K,te,he,re;for(let le=0,be=0;le<I.length;le++)G=I[le],Object.prototype.hasOwnProperty.call(z,G)?be++:(Oe(S,{command:"removeLayer",args:[G]}),F.splice(F.indexOf(G,be),1));for(let le=0,be=0;le<P.length;le++)G=P[P.length-1-le],F[F.length-1-le]!==G&&(Object.prototype.hasOwnProperty.call(C,G)?(Oe(S,{command:"removeLayer",args:[G]}),F.splice(F.lastIndexOf(G,F.length-be),1)):be++,he=F[F.length-le],Oe(S,{command:"addLayer",args:[z[G],he]}),F.splice(F.length-le,0,G),B[G]=!0);for(let le=0;le<P.length;le++)if(G=P[le],K=C[G],te=z[G],!B[G]&&!Ie(K,te))if(Ie(K.source,te.source)&&Ie(K["source-layer"],te["source-layer"])&&Ie(K.type,te.type)){for(re in Tt(K.layout,te.layout,S,G,null,"setLayoutProperty"),Tt(K.paint,te.paint,S,G,null,"setPaintProperty"),Ie(K.filter,te.filter)||Oe(S,{command:"setFilter",args:[G,te.filter]}),Ie(K.minzoom,te.minzoom)&&Ie(K.maxzoom,te.maxzoom)||Oe(S,{command:"setLayerZoomRange",args:[G,te.minzoom,te.maxzoom]}),K)Object.prototype.hasOwnProperty.call(K,re)&&re!=="layout"&&re!=="paint"&&re!=="filter"&&re!=="metadata"&&re!=="minzoom"&&re!=="maxzoom"&&(re.indexOf("paint.")===0?Tt(K[re],te[re],S,G,re.slice(6),"setPaintProperty"):Ie(K[re],te[re])||Oe(S,{command:"setLayerProperty",args:[G,re,te[re]]}));for(re in te)Object.prototype.hasOwnProperty.call(te,re)&&!Object.prototype.hasOwnProperty.call(K,re)&&re!=="layout"&&re!=="paint"&&re!=="filter"&&re!=="metadata"&&re!=="minzoom"&&re!=="maxzoom"&&(re.indexOf("paint.")===0?Tt(K[re],te[re],S,G,re.slice(6),"setPaintProperty"):Ie(K[re],te[re])||Oe(S,{command:"setLayerProperty",args:[G,re,te[re]]}))}else Oe(S,{command:"removeLayer",args:[G]}),he=F[F.lastIndexOf(G)+1],Oe(S,{command:"addLayer",args:[te,he]})}(g,e.layers,r)}catch(o){console.warn("Unable to compute style diff:",o),r=[{command:"setStyle",args:[e]}]}return r},x.aC=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},x.aD=function i(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(let o=0;o<e.length;o++)if(!i(e[o],r[o]))return!1;return!0}if(typeof e=="object"&&e!==null&&r!==null){if(typeof r!="object"||Object.keys(e).length!==Object.keys(r).length)return!1;for(const o in e)if(!i(e[o],r[o]))return!1;return!0}return e===r},x.aE=ot,x.aF=bt,x.aG=class extends er{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},x.aH=Hr,x.aI=class extends er{constructor(i,e){super(i,e),this.current=Mo}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},x.aJ=En,x.aK=class extends er{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},x.aL=class extends er{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},x.aM=Kn,x.aN=function(i,e,r,o,u,g,_){var y=1/(e-r),S=1/(o-u),I=1/(g-_);return i[0]=-2*y,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*S,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*I,i[11]=0,i[12]=(e+r)*y,i[13]=(u+o)*S,i[14]=(_+g)*I,i[15]=1,i},x.aO=ai,x.aP=ox,x.aQ=class extends Ia{},x.aR=e0,x.aS=class extends Aa{},x.aT=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},x.aU=_f,x.aV=k,x.aW=class extends Bl{},x.aX=ve,x.aY=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]&&i[9]===e[9]&&i[10]===e[10]&&i[11]===e[11]&&i[12]===e[12]&&i[13]===e[13]&&i[14]===e[14]&&i[15]===e[15]},x.aZ=function(i,e){var r=i[0],o=i[1],u=i[2],g=i[3],_=i[4],y=i[5],S=i[6],I=i[7],P=i[8],C=i[9],z=i[10],F=i[11],B=i[12],G=i[13],K=i[14],te=i[15],he=e[0],re=e[1],le=e[2],be=e[3],Ae=e[4],Je=e[5],at=e[6],Ye=e[7],Ze=e[8],$e=e[9],nt=e[10],Ge=e[11],Le=e[12],mt=e[13],ut=e[14],Bt=e[15];return Math.abs(r-he)<=Lr*Math.max(1,Math.abs(r),Math.abs(he))&&Math.abs(o-re)<=Lr*Math.max(1,Math.abs(o),Math.abs(re))&&Math.abs(u-le)<=Lr*Math.max(1,Math.abs(u),Math.abs(le))&&Math.abs(g-be)<=Lr*Math.max(1,Math.abs(g),Math.abs(be))&&Math.abs(_-Ae)<=Lr*Math.max(1,Math.abs(_),Math.abs(Ae))&&Math.abs(y-Je)<=Lr*Math.max(1,Math.abs(y),Math.abs(Je))&&Math.abs(S-at)<=Lr*Math.max(1,Math.abs(S),Math.abs(at))&&Math.abs(I-Ye)<=Lr*Math.max(1,Math.abs(I),Math.abs(Ye))&&Math.abs(P-Ze)<=Lr*Math.max(1,Math.abs(P),Math.abs(Ze))&&Math.abs(C-$e)<=Lr*Math.max(1,Math.abs(C),Math.abs($e))&&Math.abs(z-nt)<=Lr*Math.max(1,Math.abs(z),Math.abs(nt))&&Math.abs(F-Ge)<=Lr*Math.max(1,Math.abs(F),Math.abs(Ge))&&Math.abs(B-Le)<=Lr*Math.max(1,Math.abs(B),Math.abs(Le))&&Math.abs(G-mt)<=Lr*Math.max(1,Math.abs(G),Math.abs(mt))&&Math.abs(K-ut)<=Lr*Math.max(1,Math.abs(K),Math.abs(ut))&&Math.abs(te-Bt)<=Lr*Math.max(1,Math.abs(te),Math.abs(Bt))},x.a_=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},x.aa=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,o,u,g)=>{const _=u||g;return e[o]=!_||_.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e},x.ab=function(i,e){const r=[];for(const o in i)o in e||r.push(o);return r},x.ac=lt,x.ad=function(i,e,r){var o=Math.sin(r),u=Math.cos(r),g=e[0],_=e[1],y=e[2],S=e[3],I=e[4],P=e[5],C=e[6],z=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=g*u+I*o,i[1]=_*u+P*o,i[2]=y*u+C*o,i[3]=S*u+z*o,i[4]=I*u-g*o,i[5]=P*u-_*o,i[6]=C*u-y*o,i[7]=z*u-S*o,i},x.ae=function(i){var e=new Ra(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},x.af=Su,x.ag=function(i,e){let r=0,o=0;if(i.kind==="constant")o=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:u,minZoom:g,maxZoom:_}=i,y=u?lt(gr.interpolationFactor(u,e,g,_),0,1):0;i.kind==="camera"?o=wr.number(i.minSize,i.maxSize,y):r=y}return{uSizeT:r,uSize:o}},x.ai=function(i,{uSize:e,uSizeT:r},{lowerSize:o,upperSize:u}){return i.kind==="source"?o/Jn:i.kind==="composite"?wr.number(o/Jn,u/Jn,r):e},x.aj=Id,x.ak=function(i,e,r,o){const u=e.y-i.y,g=e.x-i.x,_=o.y-r.y,y=o.x-r.x,S=_*g-y*u;if(S===0)return null;const I=(y*(i.y-r.y)-_*(i.x-r.x))/S;return new N(i.x+I*g,i.y+I*u)},x.al=ym,x.am=Vl,x.an=sd,x.ao=tr,x.aq=Ed,x.ar=function(i,e){var r=e[0],o=e[1],u=e[2],g=e[3],_=e[4],y=e[5],S=e[6],I=e[7],P=e[8],C=e[9],z=e[10],F=e[11],B=e[12],G=e[13],K=e[14],te=e[15],he=r*y-o*_,re=r*S-u*_,le=r*I-g*_,be=o*S-u*y,Ae=o*I-g*y,Je=u*I-g*S,at=P*G-C*B,Ye=P*K-z*B,Ze=P*te-F*B,$e=C*K-z*G,nt=C*te-F*G,Ge=z*te-F*K,Le=he*Ge-re*nt+le*$e+be*Ze-Ae*Ye+Je*at;return Le?(i[0]=(y*Ge-S*nt+I*$e)*(Le=1/Le),i[1]=(u*nt-o*Ge-g*$e)*Le,i[2]=(G*Je-K*Ae+te*be)*Le,i[3]=(z*Ae-C*Je-F*be)*Le,i[4]=(S*Ze-_*Ge-I*Ye)*Le,i[5]=(r*Ge-u*Ze+g*Ye)*Le,i[6]=(K*le-B*Je-te*re)*Le,i[7]=(P*Je-z*le+F*re)*Le,i[8]=(_*nt-y*Ze+I*at)*Le,i[9]=(o*Ze-r*nt-g*at)*Le,i[10]=(B*Ae-G*le+te*he)*Le,i[11]=(C*le-P*Ae-F*he)*Le,i[12]=(y*Ye-_*$e-S*at)*Le,i[13]=(r*$e-o*Ye+u*at)*Le,i[14]=(G*re-B*be-K*he)*Le,i[15]=(P*be-C*re+z*he)*Le,i):null},x.as=Rd,x.at=Td,x.au=Ld,x.av=function(){const i={},e=ee.$version;for(const r in ee.$root){const o=ee.$root[r];if(o.required){let u=null;u=r==="version"?e:o.type==="array"?[]:{},u!=null&&(i[r]=u)}}return i},x.aw=cu,x.ax=Qe,x.ay=function(i){i=i.slice();const e=Object.create(null);for(let r=0;r<i.length;r++)e[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=et(i[r],e[i[r].ref]));return i},x.az=function(i){if(i.type==="custom")return new E0(i);switch(i.type){case"background":return new w0(i);case"circle":return new ax(i);case"fill":return new Ax(i);case"fill-extrusion":return new Ux(i);case"heatmap":return new cx(i);case"hillshade":return new hx(i);case"line":return new Xx(i);case"raster":return new T0(i);case"symbol":return new zu(i)}},x.b=Ht,x.b0=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},x.b1=ct,x.b2=hm,x.b3=cm,x.b4=function(i,e,r,o,u){var g,_=1/Math.tan(e/2);return i[0]=_/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=_,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,u!=null&&u!==1/0?(i[10]=(u+o)*(g=1/(o-u)),i[14]=2*u*o*g):(i[10]=-1,i[14]=-2*o),i},x.b5=function(i,e,r){var o=Math.sin(r),u=Math.cos(r),g=e[4],_=e[5],y=e[6],S=e[7],I=e[8],P=e[9],C=e[10],z=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=g*u+I*o,i[5]=_*u+P*o,i[6]=y*u+C*o,i[7]=S*u+z*o,i[8]=I*u-g*o,i[9]=P*u-_*o,i[10]=C*u-y*o,i[11]=z*u-S*o,i},x.b6=me,x.b7=We,x.b8=function(i){return i*Math.PI/180},x.b9=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},x.bA=Wn,x.ba=class extends Dn{},x.bb=Md,x.bc=F0,x.be=it,x.bf=function(i,e){mr.REGISTERED_PROTOCOLS[i]=e},x.bg=function(i){delete mr.REGISTERED_PROTOCOLS[i]},x.bh=function(i,e){const r={};for(let u=0;u<i.length;u++){const g=e&&e[i[u].id]||ed(i[u]);e&&(e[i[u].id]=g);let _=r[g];_||(_=r[g]=[]),_.push(i[u])}const o=[];for(const u in r)o.push(r[u]);return o},x.bi=rt,x.bj=pm,x.bk=mm,x.bl=Zf,x.bm=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=Oi/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],r=e.layout,o=e._unevaluatedLayout._values,u={layoutIconSize:o["icon-size"].possiblyEvaluate(new Ti(i.bucket.zoom+1),i.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new Ti(i.bucket.zoom+1),i.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new Ti(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:I,maxZoom:P}=i.bucket.textSizeData;u.compositeTextSizes=[o["text-size"].possiblyEvaluate(new Ti(I),i.canonical),o["text-size"].possiblyEvaluate(new Ti(P),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:I,maxZoom:P}=i.bucket.iconSizeData;u.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new Ti(I),i.canonical),o["icon-size"].possiblyEvaluate(new Ti(P),i.canonical)]}const g=r.get("text-line-height")*tr,_=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",y=r.get("text-keep-upright"),S=r.get("text-size");for(const I of i.bucket.features){const P=r.get("text-font").evaluate(I,{},i.canonical).join(","),C=S.evaluate(I,{},i.canonical),z=u.layoutTextSize.evaluate(I,{},i.canonical),F=u.layoutIconSize.evaluate(I,{},i.canonical),B={horizontal:{},vertical:void 0},G=I.text;let K,te=[0,0];if(G){const le=G.toString(),be=r.get("text-letter-spacing").evaluate(I,{},i.canonical)*tr,Ae=uu(le)?be:0,Je=r.get("text-anchor").evaluate(I,{},i.canonical),at=Am(e,I,i.canonical);if(!at){const Ge=r.get("text-radial-offset").evaluate(I,{},i.canonical);te=Ge?Im(Je,[Ge*tr,zd]):r.get("text-offset").evaluate(I,{},i.canonical).map(Le=>Le*tr)}let Ye=_?"center":r.get("text-justify").evaluate(I,{},i.canonical);const Ze=r.get("symbol-placement"),$e=Ze==="point"?r.get("text-max-width").evaluate(I,{},i.canonical)*tr:0,nt=()=>{i.bucket.allowVerticalPlacement&&Bs(le)&&(B.vertical=Mu(G,i.glyphMap,i.glyphPositions,i.imagePositions,P,$e,g,Je,"left",Ae,te,x.ah.vertical,!0,Ze,z,C))};if(!_&&at){const Ge=new Set;if(Ye==="auto")for(let mt=0;mt<at.values.length;mt+=2)Ge.add(Rd(at.values[mt]));else Ge.add(Ye);let Le=!1;for(const mt of Ge)if(!B.horizontal[mt])if(Le)B.horizontal[mt]=B.horizontal[0];else{const ut=Mu(G,i.glyphMap,i.glyphPositions,i.imagePositions,P,$e,g,"center",mt,Ae,te,x.ah.horizontal,!1,Ze,z,C);ut&&(B.horizontal[mt]=ut,Le=ut.positionedLines.length===1)}nt()}else{Ye==="auto"&&(Ye=Rd(Je));const Ge=Mu(G,i.glyphMap,i.glyphPositions,i.imagePositions,P,$e,g,Je,Ye,Ae,te,x.ah.horizontal,!1,Ze,z,C);Ge&&(B.horizontal[Ye]=Ge),nt(),Bs(le)&&_&&y&&(B.vertical=Mu(G,i.glyphMap,i.glyphPositions,i.imagePositions,P,$e,g,Je,Ye,Ae,te,x.ah.vertical,!1,Ze,z,C))}}let he=!1;if(I.icon&&I.icon.name){const le=i.imageMap[I.icon.name];le&&(K=_0(i.imagePositions[I.icon.name],r.get("icon-offset").evaluate(I,{},i.canonical),r.get("icon-anchor").evaluate(I,{},i.canonical)),he=!!le.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=he:i.bucket.sdfIcons!==he&&ri("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(le.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const re=Cm(B.horizontal)||B.vertical;i.bucket.iconsInText=!!re&&re.iconsInText,(re||K)&&R0(i.bucket,I,B,K,i.imageMap,u,z,F,te,he,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},x.bn=yd,x.bo=md,x.bp=_d,x.bq=Vs,x.br=vd,x.bs=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},x.bt=function(i,e,r,o,u){return h(this,void 0,void 0,function*(){if(He())try{return yield vr(i,e,r,o,u)}catch{}return function(g,_,y,S,I){const P=g.width,C=g.height;vi&&ni||(vi=new OffscreenCanvas(P,C),ni=vi.getContext("2d",{willReadFrequently:!0})),vi.width=P,vi.height=C,ni.drawImage(g,0,0,P,C);const z=ni.getImageData(_,y,S,I);return ni.clearRect(0,0,P,C),z.data}(i,e,r,o,u)})},x.bu=dm,x.bv=R,x.bw=j,x.bx=Bf,x.by=us,x.bz=function(i){return i.message===ur},x.c=Qr,x.d=i=>h(void 0,void 0,void 0,function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(e)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),x.e=vt,x.f=i=>new Promise((e,r)=>{const o=new Image;o.onload=()=>{e(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame(()=>{o.src=cr})},o.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const u=new Blob([new Uint8Array(i)],{type:"image/png"});o.src=i.byteLength?URL.createObjectURL(u):cr}),x.g=bi,x.h=(i,e)=>ht(vt(i,{type:"json"}),e),x.i=Lt,x.j=ye,x.k=ie,x.l=(i,e)=>ht(vt(i,{type:"arrayBuffer"}),e),x.m=ht,x.n=function(i){return new vd(i).readFields(h0,[])},x.o=Hl,x.p=Hf,x.q=Rr,x.r=td,x.s=Kt,x.t=Ls,x.u=Xe,x.v=ee,x.w=ri,x.x=ds,x.y=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}},x.z=wr}),v("worker",["./shared"],function(x){class h{constructor(D){this.keyCache={},D&&this.replace(D)}replace(D){this._layerConfigs={},this._layers={},this.update(D,[])}update(D,L){for(const H of D){this._layerConfigs[H.id]=H;const oe=this._layers[H.id]=x.az(H);oe._featureFilter=x.a6(oe.filter),this.keyCache[H.id]&&delete this.keyCache[H.id]}for(const H of L)delete this.keyCache[H],delete this._layerConfigs[H],delete this._layers[H];this.familiesBySource={};const V=x.bh(Object.values(this._layerConfigs),this.keyCache);for(const H of V){const oe=H.map(we=>this._layers[we.id]),ae=oe[0];if(ae.visibility==="none")continue;const ue=ae.source||"";let ne=this.familiesBySource[ue];ne||(ne=this.familiesBySource[ue]={});const de=ae.sourceLayer||"_geojsonTileLayer";let Me=ne[de];Me||(Me=ne[de]=[]),Me.push(oe)}}}class R{constructor(D){const L={},V=[];for(const ue in D){const ne=D[ue],de=L[ue]={};for(const Me in ne){const we=ne[+Me];if(!we||we.bitmap.width===0||we.bitmap.height===0)continue;const Se={x:0,y:0,w:we.bitmap.width+2,h:we.bitmap.height+2};V.push(Se),de[Me]={rect:Se,metrics:we.metrics}}}const{w:H,h:oe}=x.p(V),ae=new x.o({width:H||1,height:oe||1});for(const ue in D){const ne=D[ue];for(const de in ne){const Me=ne[+de];if(!Me||Me.bitmap.width===0||Me.bitmap.height===0)continue;const we=L[ue][de].rect;x.o.copy(Me.bitmap,ae,{x:0,y:0},{x:we.x+1,y:we.y+1},Me.bitmap)}}this.image=ae,this.positions=L}}x.bi("GlyphAtlas",R);class j{constructor(D){this.tileID=new x.Q(D.tileID.overscaledZ,D.tileID.wrap,D.tileID.canonical.z,D.tileID.canonical.x,D.tileID.canonical.y),this.uid=D.uid,this.zoom=D.zoom,this.pixelRatio=D.pixelRatio,this.tileSize=D.tileSize,this.source=D.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=D.showCollisionBoxes,this.collectResourceTiming=!!D.collectResourceTiming,this.returnDependencies=!!D.returnDependencies,this.promoteId=D.promoteId,this.inFlightDependencies=[]}parse(D,L,V,H){return x._(this,void 0,void 0,function*(){this.status="parsing",this.data=D,this.collisionBoxArray=new x.a4;const oe=new x.bj(Object.keys(D.layers).sort()),ae=new x.bk(this.tileID,this.promoteId);ae.bucketLayerIDs=[];const ue={},ne={featureIndex:ae,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:V},de=L.familiesBySource[this.source];for(const Dt in de){const ki=D.layers[Dt];if(!ki)continue;ki.version===1&&x.w(`Vector tile source "${this.source}" layer "${Dt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ji=oe.encode(Dt),br=[];for(let kr=0;kr<ki.length;kr++){const lr=ki.feature(kr),vn=ae.getId(lr,Dt);br.push({feature:lr,id:vn,index:kr,sourceLayerIndex:Ji})}for(const kr of de[Dt]){const lr=kr[0];lr.source!==this.source&&x.w(`layer.source = ${lr.source} does not equal this.source = ${this.source}`),lr.minzoom&&this.zoom<Math.floor(lr.minzoom)||lr.maxzoom&&this.zoom>=lr.maxzoom||lr.visibility!=="none"&&(U(kr,this.zoom,V),(ue[lr.id]=lr.createBucket({index:ae.bucketLayerIDs.length,layers:kr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ji,sourceID:this.source})).populate(br,ne,this.tileID.canonical),ae.bucketLayerIDs.push(kr.map(vn=>vn.id)))}}const Me=x.aE(ne.glyphDependencies,Dt=>Object.keys(Dt).map(Number));this.inFlightDependencies.forEach(Dt=>Dt==null?void 0:Dt.abort()),this.inFlightDependencies=[];let we=Promise.resolve({});if(Object.keys(Me).length){const Dt=new AbortController;this.inFlightDependencies.push(Dt),we=H.sendAsync({type:"GG",data:{stacks:Me,source:this.source,tileID:this.tileID,type:"glyphs"}},Dt)}const Se=Object.keys(ne.iconDependencies);let pt=Promise.resolve({});if(Se.length){const Dt=new AbortController;this.inFlightDependencies.push(Dt),pt=H.sendAsync({type:"GI",data:{icons:Se,source:this.source,tileID:this.tileID,type:"icons"}},Dt)}const yt=Object.keys(ne.patternDependencies);let Ct=Promise.resolve({});if(yt.length){const Dt=new AbortController;this.inFlightDependencies.push(Dt),Ct=H.sendAsync({type:"GI",data:{icons:yt,source:this.source,tileID:this.tileID,type:"patterns"}},Dt)}const[It,jt,hi]=yield Promise.all([we,pt,Ct]),Si=new R(It),$i=new x.bl(jt,hi);for(const Dt in ue){const ki=ue[Dt];ki instanceof x.a5?(U(ki.layers,this.zoom,V),x.bm({bucket:ki,glyphMap:It,glyphPositions:Si.positions,imageMap:jt,imagePositions:$i.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):ki.hasPattern&&(ki instanceof x.bn||ki instanceof x.bo||ki instanceof x.bp)&&(U(ki.layers,this.zoom,V),ki.addFeatures(ne,this.tileID.canonical,$i.patternPositions))}return this.status="done",{buckets:Object.values(ue).filter(Dt=>!Dt.isEmpty()),featureIndex:ae,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Si.image,imageAtlas:$i,glyphMap:this.returnDependencies?It:null,iconMap:this.returnDependencies?jt:null,glyphPositions:this.returnDependencies?Si.positions:null}})}}function U(X,D,L){const V=new x.a8(D);for(const H of X)H.recalculate(V,L)}class N{constructor(D,L,V){this.actor=D,this.layerIndex=L,this.availableImages=V,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(D,L){return x._(this,void 0,void 0,function*(){const V=yield x.l(D.request,L);try{return{vectorTile:new x.bq.VectorTile(new x.br(V.data)),rawData:V.data,cacheControl:V.cacheControl,expires:V.expires}}catch(H){const oe=new Uint8Array(V.data);let ae=`Unable to parse the tile at ${D.request.url}, `;throw ae+=oe[0]===31&&oe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${H.messge}`,new Error(ae)}})}loadTile(D){return x._(this,void 0,void 0,function*(){const L=D.uid,V=!!(D&&D.request&&D.request.collectResourceTiming)&&new x.bs(D.request),H=new j(D);this.loading[L]=H;const oe=new AbortController;H.abort=oe;try{const ae=yield this.loadVectorTile(D,oe);if(delete this.loading[L],!ae)return null;const ue=ae.rawData,ne={};ae.expires&&(ne.expires=ae.expires),ae.cacheControl&&(ne.cacheControl=ae.cacheControl);const de={};if(V){const we=V.finish();we&&(de.resourceTiming=JSON.parse(JSON.stringify(we)))}H.vectorTile=ae.vectorTile;const Me=H.parse(ae.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[L]=H,this.fetching[L]={rawTileData:ue,cacheControl:ne,resourceTiming:de};try{const we=yield Me;return x.e({rawTileData:ue.slice(0)},we,ne,de)}finally{delete this.fetching[L]}}catch(ae){throw delete this.loading[L],H.status="done",this.loaded[L]=H,ae}})}reloadTile(D){return x._(this,void 0,void 0,function*(){const L=D.uid;if(!this.loaded||!this.loaded[L])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const V=this.loaded[L];if(V.showCollisionBoxes=D.showCollisionBoxes,V.status==="parsing"){const H=yield V.parse(V.vectorTile,this.layerIndex,this.availableImages,this.actor);let oe;if(this.fetching[L]){const{rawTileData:ae,cacheControl:ue,resourceTiming:ne}=this.fetching[L];delete this.fetching[L],oe=x.e({rawTileData:ae.slice(0)},H,ue,ne)}else oe=H;return oe}if(V.status==="done"&&V.vectorTile)return V.parse(V.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(D){return x._(this,void 0,void 0,function*(){const L=this.loading,V=D.uid;L&&L[V]&&L[V].abort&&(L[V].abort.abort(),delete L[V])})}removeTile(D){return x._(this,void 0,void 0,function*(){this.loaded&&this.loaded[D.uid]&&delete this.loaded[D.uid]})}}class ${constructor(){this.loaded={}}loadTile(D){return x._(this,void 0,void 0,function*(){const{uid:L,encoding:V,rawImageData:H,redFactor:oe,greenFactor:ae,blueFactor:ue,baseShift:ne}=D,de=H.width+2,Me=H.height+2,we=x.b(H)?new x.R({width:de,height:Me},yield x.bt(H,-1,-1,de,Me)):H,Se=new x.bu(L,we,V,oe,ae,ue,ne);return this.loaded=this.loaded||{},this.loaded[L]=Se,Se})}removeTile(D){const L=this.loaded,V=D.uid;L&&L[V]&&delete L[V]}}function ge(X,D){if(X.length!==0){xe(X[0],D);for(var L=1;L<X.length;L++)xe(X[L],!D)}}function xe(X,D){for(var L=0,V=0,H=0,oe=X.length,ae=oe-1;H<oe;ae=H++){var ue=(X[H][0]-X[ae][0])*(X[ae][1]+X[H][1]),ne=L+ue;V+=Math.abs(L)>=Math.abs(ue)?L-ne+ue:ue-ne+L,L=ne}L+V>=0!=!!D&&X.reverse()}var Ee=x.bv(function X(D,L){var V,H=D&&D.type;if(H==="FeatureCollection")for(V=0;V<D.features.length;V++)X(D.features[V],L);else if(H==="GeometryCollection")for(V=0;V<D.geometries.length;V++)X(D.geometries[V],L);else if(H==="Feature")X(D.geometry,L);else if(H==="Polygon")ge(D.coordinates,L);else if(H==="MultiPolygon")for(V=0;V<D.coordinates.length;V++)ge(D.coordinates[V],L);return D});const Ke=x.bq.VectorTileFeature.prototype.toGeoJSON;var Ne={exports:{}},He=x.bw,me=x.bq.VectorTileFeature,We=lt;function lt(X,D){this.options=D||{},this.features=X,this.length=X.length}function ct(X,D){this.id=typeof X.id=="number"?X.id:void 0,this.type=X.type,this.rawGeometry=X.type===1?[X.geometry]:X.geometry,this.properties=X.tags,this.extent=D||4096}lt.prototype.feature=function(X){return new ct(this.features[X],this.options.extent)},ct.prototype.loadGeometry=function(){var X=this.rawGeometry;this.geometry=[];for(var D=0;D<X.length;D++){for(var L=X[D],V=[],H=0;H<L.length;H++)V.push(new He(L[H][0],L[H][1]));this.geometry.push(V)}return this.geometry},ct.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var X=this.geometry,D=1/0,L=-1/0,V=1/0,H=-1/0,oe=0;oe<X.length;oe++)for(var ae=X[oe],ue=0;ue<ae.length;ue++){var ne=ae[ue];D=Math.min(D,ne.x),L=Math.max(L,ne.x),V=Math.min(V,ne.y),H=Math.max(H,ne.y)}return[D,V,L,H]},ct.prototype.toGeoJSON=me.prototype.toGeoJSON;var vt=x.bx,tt=We;function ot(X){var D=new vt;return function(L,V){for(var H in L.layers)V.writeMessage(3,bt,L.layers[H])}(X,D),D.finish()}function bt(X,D){var L;D.writeVarintField(15,X.version||1),D.writeStringField(1,X.name||""),D.writeVarintField(5,X.extent||4096);var V={keys:[],values:[],keycache:{},valuecache:{}};for(L=0;L<X.length;L++)V.feature=X.feature(L),D.writeMessage(2,gt,V);var H=V.keys;for(L=0;L<H.length;L++)D.writeStringField(3,H[L]);var oe=V.values;for(L=0;L<oe.length;L++)D.writeMessage(4,Lt,oe[L])}function gt(X,D){var L=X.feature;L.id!==void 0&&D.writeVarintField(1,L.id),D.writeMessage(2,ei,X),D.writeVarintField(3,L.type),D.writeMessage(4,Ki,L)}function ei(X,D){var L=X.feature,V=X.keys,H=X.values,oe=X.keycache,ae=X.valuecache;for(var ue in L.properties){var ne=L.properties[ue],de=oe[ue];if(ne!==null){de===void 0&&(V.push(ue),oe[ue]=de=V.length-1),D.writeVarint(de);var Me=typeof ne;Me!=="string"&&Me!=="boolean"&&Me!=="number"&&(ne=JSON.stringify(ne));var we=Me+":"+ne,Se=ae[we];Se===void 0&&(H.push(ne),ae[we]=Se=H.length-1),D.writeVarint(Se)}}}function ri(X,D){return(D<<3)+(7&X)}function $t(X){return X<<1^X>>31}function Ki(X,D){for(var L=X.loadGeometry(),V=X.type,H=0,oe=0,ae=L.length,ue=0;ue<ae;ue++){var ne=L[ue],de=1;V===1&&(de=ne.length),D.writeVarint(ri(1,de));for(var Me=V===3?ne.length-1:ne.length,we=0;we<Me;we++){we===1&&V!==1&&D.writeVarint(ri(2,Me-1));var Se=ne[we].x-H,pt=ne[we].y-oe;D.writeVarint($t(Se)),D.writeVarint($t(pt)),H+=Se,oe+=pt}V===3&&D.writeVarint(ri(7,1))}}function Lt(X,D){var L=typeof X;L==="string"?D.writeStringField(1,X):L==="boolean"?D.writeBooleanField(7,X):L==="number"&&(X%1!=0?D.writeDoubleField(3,X):X<0?D.writeSVarintField(6,X):D.writeVarintField(5,X))}Ne.exports=ot,Ne.exports.fromVectorTileJs=ot,Ne.exports.fromGeojsonVt=function(X,D){D=D||{};var L={};for(var V in X)L[V]=new tt(X[V].features,D),L[V].name=V,L[V].version=D.version,L[V].extent=D.extent;return ot({layers:L})},Ne.exports.GeoJSONWrapper=tt;var Ft=x.bv(Ne.exports);const Ht={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:X=>X},cr=Math.fround||(vr=new Float32Array(1),X=>(vr[0]=+X,vr[0]));var vr;const vi=3,ni=5,ur=6;class Qr{constructor(D){this.options=Object.assign(Object.create(Ht),D),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(D){const{log:L,minZoom:V,maxZoom:H}=this.options;L&&console.time("total time");const oe=`prepare ${D.length} points`;L&&console.time(oe),this.points=D;const ae=[];for(let ne=0;ne<D.length;ne++){const de=D[ne];if(!de.geometry)continue;const[Me,we]=de.geometry.coordinates,Se=cr(Pe(Me)),pt=cr(it(we));ae.push(Se,pt,1/0,ne,-1,1),this.options.reduce&&ae.push(0)}let ue=this.trees[H+1]=this._createTree(ae);L&&console.timeEnd(oe);for(let ne=H;ne>=V;ne--){const de=+Date.now();ue=this.trees[ne]=this._createTree(this._cluster(ue,ne)),L&&console.log("z%d: %d clusters in %dms",ne,ue.numItems,+Date.now()-de)}return L&&console.timeEnd("total time"),this}getClusters(D,L){let V=((D[0]+180)%360+360)%360-180;const H=Math.max(-90,Math.min(90,D[1]));let oe=D[2]===180?180:((D[2]+180)%360+360)%360-180;const ae=Math.max(-90,Math.min(90,D[3]));if(D[2]-D[0]>=360)V=-180,oe=180;else if(V>oe){const we=this.getClusters([V,H,180,ae],L),Se=this.getClusters([-180,H,oe,ae],L);return we.concat(Se)}const ue=this.trees[this._limitZoom(L)],ne=ue.range(Pe(V),it(ae),Pe(oe),it(H)),de=ue.data,Me=[];for(const we of ne){const Se=this.stride*we;Me.push(de[Se+ni]>1?mr(de,Se,this.clusterProps):this.points[de[Se+vi]])}return Me}getChildren(D){const L=this._getOriginId(D),V=this._getOriginZoom(D),H="No cluster with the specified id.",oe=this.trees[V];if(!oe)throw new Error(H);const ae=oe.data;if(L*this.stride>=ae.length)throw new Error(H);const ue=this.options.radius/(this.options.extent*Math.pow(2,V-1)),ne=oe.within(ae[L*this.stride],ae[L*this.stride+1],ue),de=[];for(const Me of ne){const we=Me*this.stride;ae[we+4]===D&&de.push(ae[we+ni]>1?mr(ae,we,this.clusterProps):this.points[ae[we+vi]])}if(de.length===0)throw new Error(H);return de}getLeaves(D,L,V){const H=[];return this._appendLeaves(H,D,L=L||10,V=V||0,0),H}getTile(D,L,V){const H=this.trees[this._limitZoom(D)],oe=Math.pow(2,D),{extent:ae,radius:ue}=this.options,ne=ue/ae,de=(V-ne)/oe,Me=(V+1+ne)/oe,we={features:[]};return this._addTileFeatures(H.range((L-ne)/oe,de,(L+1+ne)/oe,Me),H.data,L,V,oe,we),L===0&&this._addTileFeatures(H.range(1-ne/oe,de,1,Me),H.data,oe,V,oe,we),L===oe-1&&this._addTileFeatures(H.range(0,de,ne/oe,Me),H.data,-1,V,oe,we),we.features.length?we:null}getClusterExpansionZoom(D){let L=this._getOriginZoom(D)-1;for(;L<=this.options.maxZoom;){const V=this.getChildren(D);if(L++,V.length!==1)break;D=V[0].properties.cluster_id}return L}_appendLeaves(D,L,V,H,oe){const ae=this.getChildren(L);for(const ue of ae){const ne=ue.properties;if(ne&&ne.cluster?oe+ne.point_count<=H?oe+=ne.point_count:oe=this._appendLeaves(D,ne.cluster_id,V,H,oe):oe<H?oe++:D.push(ue),D.length===V)break}return oe}_createTree(D){const L=new x.au(D.length/this.stride|0,this.options.nodeSize,Float32Array);for(let V=0;V<D.length;V+=this.stride)L.add(D[V],D[V+1]);return L.finish(),L.data=D,L}_addTileFeatures(D,L,V,H,oe,ae){for(const ue of D){const ne=ue*this.stride,de=L[ne+ni]>1;let Me,we,Se;if(de)Me=bi(L,ne,this.clusterProps),we=L[ne],Se=L[ne+1];else{const Ct=this.points[L[ne+vi]];Me=Ct.properties;const[It,jt]=Ct.geometry.coordinates;we=Pe(It),Se=it(jt)}const pt={type:1,geometry:[[Math.round(this.options.extent*(we*oe-V)),Math.round(this.options.extent*(Se*oe-H))]],tags:Me};let yt;yt=de||this.options.generateId?L[ne+vi]:this.points[L[ne+vi]].id,yt!==void 0&&(pt.id=yt),ae.features.push(pt)}}_limitZoom(D){return Math.max(this.options.minZoom,Math.min(Math.floor(+D),this.options.maxZoom+1))}_cluster(D,L){const{radius:V,extent:H,reduce:oe,minPoints:ae}=this.options,ue=V/(H*Math.pow(2,L)),ne=D.data,de=[],Me=this.stride;for(let we=0;we<ne.length;we+=Me){if(ne[we+2]<=L)continue;ne[we+2]=L;const Se=ne[we],pt=ne[we+1],yt=D.within(ne[we],ne[we+1],ue),Ct=ne[we+ni];let It=Ct;for(const jt of yt){const hi=jt*Me;ne[hi+2]>L&&(It+=ne[hi+ni])}if(It>Ct&&It>=ae){let jt,hi=Se*Ct,Si=pt*Ct,$i=-1;const Dt=((we/Me|0)<<5)+(L+1)+this.points.length;for(const ki of yt){const Ji=ki*Me;if(ne[Ji+2]<=L)continue;ne[Ji+2]=L;const br=ne[Ji+ni];hi+=ne[Ji]*br,Si+=ne[Ji+1]*br,ne[Ji+4]=Dt,oe&&(jt||(jt=this._map(ne,we,!0),$i=this.clusterProps.length,this.clusterProps.push(jt)),oe(jt,this._map(ne,Ji)))}ne[we+4]=Dt,de.push(hi/It,Si/It,1/0,Dt,-1,It),oe&&de.push($i)}else{for(let jt=0;jt<Me;jt++)de.push(ne[we+jt]);if(It>1)for(const jt of yt){const hi=jt*Me;if(!(ne[hi+2]<=L)){ne[hi+2]=L;for(let Si=0;Si<Me;Si++)de.push(ne[hi+Si])}}}}return de}_getOriginId(D){return D-this.points.length>>5}_getOriginZoom(D){return(D-this.points.length)%32}_map(D,L,V){if(D[L+ni]>1){const ae=this.clusterProps[D[L+ur]];return V?Object.assign({},ae):ae}const H=this.points[D[L+vi]].properties,oe=this.options.map(H);return V&&oe===H?Object.assign({},oe):oe}}function mr(X,D,L){return{type:"Feature",id:X[D+vi],properties:bi(X,D,L),geometry:{type:"Point",coordinates:[(V=X[D],360*(V-.5)),Qe(X[D+1])]}};var V}function bi(X,D,L){const V=X[D+ni],H=V>=1e4?`${Math.round(V/1e3)}k`:V>=1e3?Math.round(V/100)/10+"k":V,oe=X[D+ur],ae=oe===-1?{}:Object.assign({},L[oe]);return Object.assign(ae,{cluster:!0,cluster_id:X[D+vi],point_count:V,point_count_abbreviated:H})}function Pe(X){return X/360+.5}function it(X){const D=Math.sin(X*Math.PI/180),L=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return L<0?0:L>1?1:L}function Qe(X){const D=(180-360*X)*Math.PI/180;return 360*Math.atan(Math.exp(D))/Math.PI-90}function ht(X,D,L,V){for(var H,oe=V,ae=L-D>>1,ue=L-D,ne=X[D],de=X[D+1],Me=X[L],we=X[L+1],Se=D+3;Se<L;Se+=3){var pt=Kt(X[Se],X[Se+1],ne,de,Me,we);if(pt>oe)H=Se,oe=pt;else if(pt===oe){var yt=Math.abs(Se-ae);yt<ue&&(H=Se,ue=yt)}}oe>V&&(H-D>3&&ht(X,D,H,V),X[H+2]=oe,L-H>3&&ht(X,H,L,V))}function Kt(X,D,L,V,H,oe){var ae=H-L,ue=oe-V;if(ae!==0||ue!==0){var ne=((X-L)*ae+(D-V)*ue)/(ae*ae+ue*ue);ne>1?(L=H,V=oe):ne>0&&(L+=ae*ne,V+=ue*ne)}return(ae=X-L)*ae+(ue=D-V)*ue}function Yt(X,D,L,V){var H={id:X===void 0?null:X,type:D,geometry:L,tags:V,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(oe){var ae=oe.geometry,ue=oe.type;if(ue==="Point"||ue==="MultiPoint"||ue==="LineString")J(oe,ae);else if(ue==="Polygon"||ue==="MultiLineString")for(var ne=0;ne<ae.length;ne++)J(oe,ae[ne]);else if(ue==="MultiPolygon")for(ne=0;ne<ae.length;ne++)for(var de=0;de<ae[ne].length;de++)J(oe,ae[ne][de])}(H),H}function J(X,D){for(var L=0;L<D.length;L+=3)X.minX=Math.min(X.minX,D[L]),X.minY=Math.min(X.minY,D[L+1]),X.maxX=Math.max(X.maxX,D[L]),X.maxY=Math.max(X.maxY,D[L+1])}function ie(X,D,L,V){if(D.geometry){var H=D.geometry.coordinates,oe=D.geometry.type,ae=Math.pow(L.tolerance/((1<<L.maxZoom)*L.extent),2),ue=[],ne=D.id;if(L.promoteId?ne=D.properties[L.promoteId]:L.generateId&&(ne=V||0),oe==="Point")ye(H,ue);else if(oe==="MultiPoint")for(var de=0;de<H.length;de++)ye(H[de],ue);else if(oe==="LineString")De(H,ue,ae,!1);else if(oe==="MultiLineString"){if(L.lineMetrics){for(de=0;de<H.length;de++)De(H[de],ue=[],ae,!1),X.push(Yt(ne,"LineString",ue,D.properties));return}ee(H,ue,ae,!1)}else if(oe==="Polygon")ee(H,ue,ae,!0);else{if(oe!=="MultiPolygon"){if(oe==="GeometryCollection"){for(de=0;de<D.geometry.geometries.length;de++)ie(X,{id:ne,geometry:D.geometry.geometries[de],properties:D.properties},L,V);return}throw new Error("Input data is not a valid GeoJSON object.")}for(de=0;de<H.length;de++){var Me=[];ee(H[de],Me,ae,!0),ue.push(Me)}}X.push(Yt(ne,oe,ue,D.properties))}}function ye(X,D){D.push(je(X[0])),D.push(et(X[1])),D.push(0)}function De(X,D,L,V){for(var H,oe,ae=0,ue=0;ue<X.length;ue++){var ne=je(X[ue][0]),de=et(X[ue][1]);D.push(ne),D.push(de),D.push(0),ue>0&&(ae+=V?(H*de-ne*oe)/2:Math.sqrt(Math.pow(ne-H,2)+Math.pow(de-oe,2))),H=ne,oe=de}var Me=D.length-3;D[2]=1,ht(D,0,Me,L),D[Me+2]=1,D.size=Math.abs(ae),D.start=0,D.end=D.size}function ee(X,D,L,V){for(var H=0;H<X.length;H++){var oe=[];De(X[H],oe,L,V),D.push(oe)}}function je(X){return X/360+.5}function et(X){var D=Math.sin(X*Math.PI/180),L=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return L<0?0:L>1?1:L}function Ie(X,D,L,V,H,oe,ae,ue){if(V/=D,oe>=(L/=D)&&ae<V)return X;if(ae<L||oe>=V)return null;for(var ne=[],de=0;de<X.length;de++){var Me=X[de],we=Me.geometry,Se=Me.type,pt=H===0?Me.minX:Me.minY,yt=H===0?Me.maxX:Me.maxY;if(pt>=L&&yt<V)ne.push(Me);else if(!(yt<L||pt>=V)){var Ct=[];if(Se==="Point"||Se==="MultiPoint")Oe(we,Ct,L,V,H);else if(Se==="LineString")Fe(we,Ct,L,V,H,!1,ue.lineMetrics);else if(Se==="MultiLineString")wt(we,Ct,L,V,H,!1);else if(Se==="Polygon")wt(we,Ct,L,V,H,!0);else if(Se==="MultiPolygon")for(var It=0;It<we.length;It++){var jt=[];wt(we[It],jt,L,V,H,!0),jt.length&&Ct.push(jt)}if(Ct.length){if(ue.lineMetrics&&Se==="LineString"){for(It=0;It<Ct.length;It++)ne.push(Yt(Me.id,Se,Ct[It],Me.tags));continue}Se!=="LineString"&&Se!=="MultiLineString"||(Ct.length===1?(Se="LineString",Ct=Ct[0]):Se="MultiLineString"),Se!=="Point"&&Se!=="MultiPoint"||(Se=Ct.length===3?"Point":"MultiPoint"),ne.push(Yt(Me.id,Se,Ct,Me.tags))}}}return ne.length?ne:null}function Oe(X,D,L,V,H){for(var oe=0;oe<X.length;oe+=3){var ae=X[oe+H];ae>=L&&ae<=V&&(D.push(X[oe]),D.push(X[oe+1]),D.push(X[oe+2]))}}function Fe(X,D,L,V,H,oe,ae){for(var ue,ne,de=st(X),Me=H===0?Tt:Nt,we=X.start,Se=0;Se<X.length-3;Se+=3){var pt=X[Se],yt=X[Se+1],Ct=X[Se+2],It=X[Se+3],jt=X[Se+4],hi=H===0?pt:yt,Si=H===0?It:jt,$i=!1;ae&&(ue=Math.sqrt(Math.pow(pt-It,2)+Math.pow(yt-jt,2))),hi<L?Si>L&&(ne=Me(de,pt,yt,It,jt,L),ae&&(de.start=we+ue*ne)):hi>V?Si<V&&(ne=Me(de,pt,yt,It,jt,V),ae&&(de.start=we+ue*ne)):ft(de,pt,yt,Ct),Si<L&&hi>=L&&(ne=Me(de,pt,yt,It,jt,L),$i=!0),Si>V&&hi<=V&&(ne=Me(de,pt,yt,It,jt,V),$i=!0),!oe&&$i&&(ae&&(de.end=we+ue*ne),D.push(de),de=st(X)),ae&&(we+=ue)}var Dt=X.length-3;pt=X[Dt],yt=X[Dt+1],Ct=X[Dt+2],(hi=H===0?pt:yt)>=L&&hi<=V&&ft(de,pt,yt,Ct),Dt=de.length-3,oe&&Dt>=3&&(de[Dt]!==de[0]||de[Dt+1]!==de[1])&&ft(de,de[0],de[1],de[2]),de.length&&D.push(de)}function st(X){var D=[];return D.size=X.size,D.start=X.start,D.end=X.end,D}function wt(X,D,L,V,H,oe){for(var ae=0;ae<X.length;ae++)Fe(X[ae],D,L,V,H,oe,!1)}function ft(X,D,L,V){X.push(D),X.push(L),X.push(V)}function Tt(X,D,L,V,H,oe){var ae=(oe-D)/(V-D);return X.push(oe),X.push(L+(H-L)*ae),X.push(1),ae}function Nt(X,D,L,V,H,oe){var ae=(oe-L)/(H-L);return X.push(D+(V-D)*ae),X.push(oe),X.push(1),ae}function Zt(X,D){for(var L=[],V=0;V<X.length;V++){var H,oe=X[V],ae=oe.type;if(ae==="Point"||ae==="MultiPoint"||ae==="LineString")H=Ce(oe.geometry,D);else if(ae==="MultiLineString"||ae==="Polygon"){H=[];for(var ue=0;ue<oe.geometry.length;ue++)H.push(Ce(oe.geometry[ue],D))}else if(ae==="MultiPolygon")for(H=[],ue=0;ue<oe.geometry.length;ue++){for(var ne=[],de=0;de<oe.geometry[ue].length;de++)ne.push(Ce(oe.geometry[ue][de],D));H.push(ne)}L.push(Yt(oe.id,ae,H,oe.tags))}return L}function Ce(X,D){var L=[];L.size=X.size,X.start!==void 0&&(L.start=X.start,L.end=X.end);for(var V=0;V<X.length;V+=3)L.push(X[V]+D,X[V+1],X[V+2]);return L}function ui(X,D){if(X.transformed)return X;var L,V,H,oe=1<<X.z,ae=X.x,ue=X.y;for(L=0;L<X.features.length;L++){var ne=X.features[L],de=ne.geometry,Me=ne.type;if(ne.geometry=[],Me===1)for(V=0;V<de.length;V+=2)ne.geometry.push(wi(de[V],de[V+1],D,oe,ae,ue));else for(V=0;V<de.length;V++){var we=[];for(H=0;H<de[V].length;H+=2)we.push(wi(de[V][H],de[V][H+1],D,oe,ae,ue));ne.geometry.push(we)}}return X.transformed=!0,X}function wi(X,D,L,V,H,oe){return[Math.round(L*(X*V-H)),Math.round(L*(D*V-oe))]}function en(X,D,L,V,H){for(var oe=D===H.maxZoom?0:H.tolerance/((1<<D)*H.extent),ae={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:L,y:V,z:D,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ue=0;ue<X.length;ue++){ae.numFeatures++,Xi(ae,X[ue],oe,H);var ne=X[ue].minX,de=X[ue].minY,Me=X[ue].maxX,we=X[ue].maxY;ne<ae.minX&&(ae.minX=ne),de<ae.minY&&(ae.minY=de),Me>ae.maxX&&(ae.maxX=Me),we>ae.maxY&&(ae.maxY=we)}return ae}function Xi(X,D,L,V){var H=D.geometry,oe=D.type,ae=[];if(oe==="Point"||oe==="MultiPoint")for(var ue=0;ue<H.length;ue+=3)ae.push(H[ue]),ae.push(H[ue+1]),X.numPoints++,X.numSimplified++;else if(oe==="LineString")Ve(ae,H,X,L,!1,!1);else if(oe==="MultiLineString"||oe==="Polygon")for(ue=0;ue<H.length;ue++)Ve(ae,H[ue],X,L,oe==="Polygon",ue===0);else if(oe==="MultiPolygon")for(var ne=0;ne<H.length;ne++){var de=H[ne];for(ue=0;ue<de.length;ue++)Ve(ae,de[ue],X,L,!0,ue===0)}if(ae.length){var Me=D.tags||null;if(oe==="LineString"&&V.lineMetrics){for(var we in Me={},D.tags)Me[we]=D.tags[we];Me.mapbox_clip_start=H.start/H.size,Me.mapbox_clip_end=H.end/H.size}var Se={geometry:ae,type:oe==="Polygon"||oe==="MultiPolygon"?3:oe==="LineString"||oe==="MultiLineString"?2:1,tags:Me};D.id!==null&&(Se.id=D.id),X.features.push(Se)}}function Ve(X,D,L,V,H,oe){var ae=V*V;if(V>0&&D.size<(H?ae:V))L.numPoints+=D.length/3;else{for(var ue=[],ne=0;ne<D.length;ne+=3)(V===0||D[ne+2]>ae)&&(L.numSimplified++,ue.push(D[ne]),ue.push(D[ne+1])),L.numPoints++;H&&function(de,Me){for(var we=0,Se=0,pt=de.length,yt=pt-2;Se<pt;yt=Se,Se+=2)we+=(de[Se]-de[yt])*(de[Se+1]+de[yt+1]);if(we>0===Me)for(Se=0,pt=de.length;Se<pt/2;Se+=2){var Ct=de[Se],It=de[Se+1];de[Se]=de[pt-2-Se],de[Se+1]=de[pt-1-Se],de[pt-2-Se]=Ct,de[pt-1-Se]=It}}(ue,oe),X.push(ue)}}function At(X,D){var L=(D=this.options=function(H,oe){for(var ae in oe)H[ae]=oe[ae];return H}(Object.create(this.options),D)).debug;if(L&&console.time("preprocess data"),D.maxZoom<0||D.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(D.promoteId&&D.generateId)throw new Error("promoteId and generateId cannot be used together.");var V=function(H,oe){var ae=[];if(H.type==="FeatureCollection")for(var ue=0;ue<H.features.length;ue++)ie(ae,H.features[ue],oe,ue);else ie(ae,H.type==="Feature"?H:{geometry:H},oe);return ae}(X,D);this.tiles={},this.tileCoords=[],L&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",D.indexMaxZoom,D.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),V=function(H,oe){var ae=oe.buffer/oe.extent,ue=H,ne=Ie(H,1,-1-ae,ae,0,-1,2,oe),de=Ie(H,1,1-ae,2+ae,0,-1,2,oe);return(ne||de)&&(ue=Ie(H,1,-ae,1+ae,0,-1,2,oe)||[],ne&&(ue=Zt(ne,1).concat(ue)),de&&(ue=ue.concat(Zt(de,-1)))),ue}(V,D),V.length&&this.splitTile(V,0,0,0),L&&(V.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function _t(X,D,L){return 32*((1<<X)*L+D)+X}function si(X,D){return D?X.properties[D]:X.id}function $r(X,D){if(X==null)return!0;if(X.type==="Feature")return si(X,D)!=null;if(X.type==="FeatureCollection"){const L=new Set;for(const V of X.features){const H=si(V,D);if(H==null||L.has(H))return!1;L.add(H)}return!0}return!1}function Pt(X,D){const L=new Map;if(X!=null)if(X.type==="Feature")L.set(si(X,D),X);else for(const V of X.features)L.set(si(V,D),V);return L}At.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},At.prototype.splitTile=function(X,D,L,V,H,oe,ae){for(var ue=[X,D,L,V],ne=this.options,de=ne.debug;ue.length;){V=ue.pop(),L=ue.pop(),D=ue.pop(),X=ue.pop();var Me=1<<D,we=_t(D,L,V),Se=this.tiles[we];if(!Se&&(de>1&&console.time("creation"),Se=this.tiles[we]=en(X,D,L,V,ne),this.tileCoords.push({z:D,x:L,y:V}),de)){de>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",D,L,V,Se.numFeatures,Se.numPoints,Se.numSimplified),console.timeEnd("creation"));var pt="z"+D;this.stats[pt]=(this.stats[pt]||0)+1,this.total++}if(Se.source=X,H){if(D===ne.maxZoom||D===H)continue;var yt=1<<H-D;if(L!==Math.floor(oe/yt)||V!==Math.floor(ae/yt))continue}else if(D===ne.indexMaxZoom||Se.numPoints<=ne.indexMaxPoints)continue;if(Se.source=null,X.length!==0){de>1&&console.time("clipping");var Ct,It,jt,hi,Si,$i,Dt=.5*ne.buffer/ne.extent,ki=.5-Dt,Ji=.5+Dt,br=1+Dt;Ct=It=jt=hi=null,Si=Ie(X,Me,L-Dt,L+Ji,0,Se.minX,Se.maxX,ne),$i=Ie(X,Me,L+ki,L+br,0,Se.minX,Se.maxX,ne),X=null,Si&&(Ct=Ie(Si,Me,V-Dt,V+Ji,1,Se.minY,Se.maxY,ne),It=Ie(Si,Me,V+ki,V+br,1,Se.minY,Se.maxY,ne),Si=null),$i&&(jt=Ie($i,Me,V-Dt,V+Ji,1,Se.minY,Se.maxY,ne),hi=Ie($i,Me,V+ki,V+br,1,Se.minY,Se.maxY,ne),$i=null),de>1&&console.timeEnd("clipping"),ue.push(Ct||[],D+1,2*L,2*V),ue.push(It||[],D+1,2*L,2*V+1),ue.push(jt||[],D+1,2*L+1,2*V),ue.push(hi||[],D+1,2*L+1,2*V+1)}}},At.prototype.getTile=function(X,D,L){var V=this.options,H=V.extent,oe=V.debug;if(X<0||X>24)return null;var ae=1<<X,ue=_t(X,D=(D%ae+ae)%ae,L);if(this.tiles[ue])return ui(this.tiles[ue],H);oe>1&&console.log("drilling down to z%d-%d-%d",X,D,L);for(var ne,de=X,Me=D,we=L;!ne&&de>0;)de--,Me=Math.floor(Me/2),we=Math.floor(we/2),ne=this.tiles[_t(de,Me,we)];return ne&&ne.source?(oe>1&&console.log("found parent tile z%d-%d-%d",de,Me,we),oe>1&&console.time("drilling down"),this.splitTile(ne.source,de,Me,we,X,D,L),oe>1&&console.timeEnd("drilling down"),this.tiles[ue]?ui(this.tiles[ue],H):null):null};class os extends N{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(D,L){return x._(this,void 0,void 0,function*(){const V=D.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const H=this._geoJSONIndex.getTile(V.z,V.x,V.y);if(!H)return null;const oe=new class{constructor(ue){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=x.W,this.length=ue.length,this._features=ue}feature(ue){return new class{constructor(ne){this._feature=ne,this.extent=x.W,this.type=ne.type,this.properties=ne.tags,"id"in ne&&!isNaN(ne.id)&&(this.id=parseInt(ne.id,10))}loadGeometry(){if(this._feature.type===1){const ne=[];for(const de of this._feature.geometry)ne.push([new x.P(de[0],de[1])]);return ne}{const ne=[];for(const de of this._feature.geometry){const Me=[];for(const we of de)Me.push(new x.P(we[0],we[1]));ne.push(Me)}return ne}}toGeoJSON(ne,de,Me){return Ke.call(this,ne,de,Me)}}(this._features[ue])}}(H.features);let ae=Ft(oe);return ae.byteOffset===0&&ae.byteLength===ae.buffer.byteLength||(ae=new Uint8Array(ae)),{vectorTile:oe,rawData:ae.buffer}})}loadData(D){return x._(this,void 0,void 0,function*(){var L;(L=this._pendingRequest)===null||L===void 0||L.abort();const V=!!(D&&D.request&&D.request.collectResourceTiming)&&new x.bs(D.request);this._pendingRequest=new AbortController;try{let H=yield this.loadGeoJSON(D,this._pendingRequest);if(delete this._pendingRequest,typeof H!="object")throw new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`);if(Ee(H,!0),D.filter){const ae=x.by(D.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ae.result==="error")throw new Error(ae.value.map(ne=>`${ne.key}: ${ne.message}`).join(", "));H={type:"FeatureCollection",features:H.features.filter(ne=>ae.value.evaluate({zoom:0},ne))}}this._geoJSONIndex=D.cluster?new Qr(function({superclusterOptions:ae,clusterProperties:ue}){if(!ue||!ae)return ae;const ne={},de={},Me={accumulated:null,zoom:0},we={properties:null},Se=Object.keys(ue);for(const pt of Se){const[yt,Ct]=ue[pt],It=x.by(Ct),jt=x.by(typeof yt=="string"?[yt,["accumulated"],["get",pt]]:yt);ne[pt]=It.value,de[pt]=jt.value}return ae.map=pt=>{we.properties=pt;const yt={};for(const Ct of Se)yt[Ct]=ne[Ct].evaluate(Me,we);return yt},ae.reduce=(pt,yt)=>{we.properties=yt;for(const Ct of Se)Me.accumulated=pt[Ct],pt[Ct]=de[Ct].evaluate(Me,we)},ae}(D)).load(H.features):function(ae,ue){return new At(ae,ue)}(H,D.geojsonVtOptions),this.loaded={};const oe={};if(V){const ae=V.finish();ae&&(oe.resourceTiming={},oe.resourceTiming[D.source]=JSON.parse(JSON.stringify(ae)))}return oe}catch(H){if(delete this._pendingRequest,x.bz(H))return{abandoned:!0};throw H}})}reloadTile(D){const L=this.loaded;return L&&L[D.uid]?super.reloadTile(D):this.loadTile(D)}loadGeoJSON(D,L){return x._(this,void 0,void 0,function*(){const{promoteId:V}=D;if(D.request){const H=yield x.h(D.request,L);return this._dataUpdateable=$r(H.data,V)?Pt(H.data,V):void 0,H.data}if(typeof D.data=="string")try{const H=JSON.parse(D.data);return this._dataUpdateable=$r(H,V)?Pt(H,V):void 0,H}catch{throw new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`)}if(!D.dataDiff)throw new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${D.source}`);return function(H,oe,ae){var ue,ne,de,Me;if(oe.removeAll&&H.clear(),oe.remove)for(const we of oe.remove)H.delete(we);if(oe.add)for(const we of oe.add){const Se=si(we,ae);Se!=null&&H.set(Se,we)}if(oe.update)for(const we of oe.update){let Se=H.get(we.id);if(Se==null)continue;const pt=!we.removeAllProperties&&(((ue=we.removeProperties)===null||ue===void 0?void 0:ue.length)>0||((ne=we.addOrUpdateProperties)===null||ne===void 0?void 0:ne.length)>0);if((we.newGeometry||we.removeAllProperties||pt)&&(Se=Object.assign({},Se),H.set(we.id,Se),pt&&(Se.properties=Object.assign({},Se.properties))),we.newGeometry&&(Se.geometry=we.newGeometry),we.removeAllProperties)Se.properties={};else if(((de=we.removeProperties)===null||de===void 0?void 0:de.length)>0)for(const yt of we.removeProperties)Object.prototype.hasOwnProperty.call(Se.properties,yt)&&delete Se.properties[yt];if(((Me=we.addOrUpdateProperties)===null||Me===void 0?void 0:Me.length)>0)for(const{key:yt,value:Ct}of we.addOrUpdateProperties)Se.properties[yt]=Ct}}(this._dataUpdateable,D.dataDiff,V),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(D){return x._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(D){return this._geoJSONIndex.getClusterExpansionZoom(D.clusterId)}getClusterChildren(D){return this._geoJSONIndex.getChildren(D.clusterId)}getClusterLeaves(D){return this._geoJSONIndex.getLeaves(D.clusterId,D.limit,D.offset)}}class Yi{constructor(D){this.self=D,this.actor=new x.C(D),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(L,V)=>{if(this.externalWorkerSourceTypes[L])throw new Error(`Worker source with name "${L}" already registered.`);this.externalWorkerSourceTypes[L]=V},this.self.addProtocol=x.bf,this.self.removeProtocol=x.bg,this.self.registerRTLTextPlugin=L=>{if(x.bA.isParsed())throw new Error("RTL text plugin already registered.");x.bA.setMethods(L)},this.actor.registerMessageHandler("LDT",(L,V)=>this._getDEMWorkerSource(L,V.source).loadTile(V)),this.actor.registerMessageHandler("RDT",(L,V)=>x._(this,void 0,void 0,function*(){this._getDEMWorkerSource(L,V.source).removeTile(V)})),this.actor.registerMessageHandler("GCEZ",(L,V)=>x._(this,void 0,void 0,function*(){return this._getWorkerSource(L,V.type,V.source).getClusterExpansionZoom(V)})),this.actor.registerMessageHandler("GCC",(L,V)=>x._(this,void 0,void 0,function*(){return this._getWorkerSource(L,V.type,V.source).getClusterChildren(V)})),this.actor.registerMessageHandler("GCL",(L,V)=>x._(this,void 0,void 0,function*(){return this._getWorkerSource(L,V.type,V.source).getClusterLeaves(V)})),this.actor.registerMessageHandler("LD",(L,V)=>this._getWorkerSource(L,V.type,V.source).loadData(V)),this.actor.registerMessageHandler("LT",(L,V)=>this._getWorkerSource(L,V.type,V.source).loadTile(V)),this.actor.registerMessageHandler("RT",(L,V)=>this._getWorkerSource(L,V.type,V.source).reloadTile(V)),this.actor.registerMessageHandler("AT",(L,V)=>this._getWorkerSource(L,V.type,V.source).abortTile(V)),this.actor.registerMessageHandler("RMT",(L,V)=>this._getWorkerSource(L,V.type,V.source).removeTile(V)),this.actor.registerMessageHandler("RS",(L,V)=>x._(this,void 0,void 0,function*(){if(!this.workerSources[L]||!this.workerSources[L][V.type]||!this.workerSources[L][V.type][V.source])return;const H=this.workerSources[L][V.type][V.source];delete this.workerSources[L][V.type][V.source],H.removeSource!==void 0&&H.removeSource(V)})),this.actor.registerMessageHandler("RM",L=>x._(this,void 0,void 0,function*(){delete this.layerIndexes[L],delete this.availableImages[L],delete this.workerSources[L],delete this.demWorkerSources[L]})),this.actor.registerMessageHandler("SR",(L,V)=>x._(this,void 0,void 0,function*(){this.referrer=V})),this.actor.registerMessageHandler("SRPS",(L,V)=>this._syncRTLPluginState(L,V)),this.actor.registerMessageHandler("IS",(L,V)=>x._(this,void 0,void 0,function*(){this.self.importScripts(V)})),this.actor.registerMessageHandler("SI",(L,V)=>this._setImages(L,V)),this.actor.registerMessageHandler("UL",(L,V)=>x._(this,void 0,void 0,function*(){this._getLayerIndex(L).update(V.layers,V.removedIds)})),this.actor.registerMessageHandler("SL",(L,V)=>x._(this,void 0,void 0,function*(){this._getLayerIndex(L).replace(V)}))}_setImages(D,L){return x._(this,void 0,void 0,function*(){this.availableImages[D]=L;for(const V in this.workerSources[D]){const H=this.workerSources[D][V];for(const oe in H)H[oe].availableImages=L}})}_syncRTLPluginState(D,L){return x._(this,void 0,void 0,function*(){if(x.bA.isParsed())return x.bA.getState();if(L.pluginStatus!=="loading")return x.bA.setState(L),L;const V=L.pluginURL;if(this.self.importScripts(V),x.bA.isParsed()){const H={pluginStatus:"loaded",pluginURL:V};return x.bA.setState(H),H}throw x.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${V}`)})}_getAvailableImages(D){let L=this.availableImages[D];return L||(L=[]),L}_getLayerIndex(D){let L=this.layerIndexes[D];return L||(L=this.layerIndexes[D]=new h),L}_getWorkerSource(D,L,V){if(this.workerSources[D]||(this.workerSources[D]={}),this.workerSources[D][L]||(this.workerSources[D][L]={}),!this.workerSources[D][L][V]){const H={sendAsync:(oe,ae)=>(oe.targetMapId=D,this.actor.sendAsync(oe,ae))};switch(L){case"vector":this.workerSources[D][L][V]=new N(H,this._getLayerIndex(D),this._getAvailableImages(D));break;case"geojson":this.workerSources[D][L][V]=new os(H,this._getLayerIndex(D),this._getAvailableImages(D));break;default:this.workerSources[D][L][V]=new this.externalWorkerSourceTypes[L](H,this._getLayerIndex(D),this._getAvailableImages(D))}}return this.workerSources[D][L][V]}_getDEMWorkerSource(D,L){return this.demWorkerSources[D]||(this.demWorkerSources[D]={}),this.demWorkerSources[D][L]||(this.demWorkerSources[D][L]=new $),this.demWorkerSources[D][L]}}return x.i(self)&&(self.worker=new Yi(self)),Yi}),v("index",["exports","./shared"],function(x,h){var R="4.1.3";let j,U;const N={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:p=>new Promise((t,s)=>{const l=requestAnimationFrame(t);p.signal.addEventListener("abort",()=>{cancelAnimationFrame(l),s(h.c())})}),getImageData(p,t=0){return this.getImageCanvasContext(p).getImageData(-t,-t,p.width+2*t,p.height+2*t)},getImageCanvasContext(p){const t=window.document.createElement("canvas"),s=t.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return t.width=p.width,t.height=p.height,s.drawImage(p,0,0,p.width,p.height),s},resolveURL:p=>(j||(j=document.createElement("a")),j.href=p,j.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(U==null&&(U=matchMedia("(prefers-reduced-motion: reduce)")),U.matches)}};class ${static testProp(t){if(!$.docStyle)return t[0];for(let s=0;s<t.length;s++)if(t[s]in $.docStyle)return t[s];return t[0]}static create(t,s,l){const c=window.document.createElement(t);return s!==void 0&&(c.className=s),l&&l.appendChild(c),c}static createNS(t,s){return window.document.createElementNS(t,s)}static disableDrag(){$.docStyle&&$.selectProp&&($.userSelect=$.docStyle[$.selectProp],$.docStyle[$.selectProp]="none")}static enableDrag(){$.docStyle&&$.selectProp&&($.docStyle[$.selectProp]=$.userSelect)}static setTransform(t,s){t.style[$.transformProp]=s}static addEventListener(t,s,l,c={}){t.addEventListener(s,l,"passive"in c?c:c.capture)}static removeEventListener(t,s,l,c={}){t.removeEventListener(s,l,"passive"in c?c:c.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",$.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",$.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",$.suppressClickInternal,!0)},0)}static getScale(t){const s=t.getBoundingClientRect();return{x:s.width/t.offsetWidth||1,y:s.height/t.offsetHeight||1,boundingClientRect:s}}static getPoint(t,s,l){const c=s.boundingClientRect;return new h.P((l.clientX-c.left)/s.x-t.clientLeft,(l.clientY-c.top)/s.y-t.clientTop)}static mousePos(t,s){const l=$.getScale(t);return $.getPoint(t,l,s)}static touchPos(t,s){const l=[],c=$.getScale(t);for(let f=0;f<s.length;f++)l.push($.getPoint(t,c,s[f]));return l}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}$.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,$.selectProp=$.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),$.transformProp=$.testProp(["transform","WebkitTransform"]);const ge={supported:!1,testSupport:function(p){!Ke&&Ee&&(Ne?He(p):xe=p)}};let xe,Ee,Ke=!1,Ne=!1;function He(p){const t=p.createTexture();p.bindTexture(p.TEXTURE_2D,t);try{if(p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,Ee),p.isContextLost())return;ge.supported=!0}catch{}p.deleteTexture(t),Ke=!0}var me;typeof document<"u"&&(Ee=document.createElement("img"),Ee.onload=function(){xe&&He(xe),xe=null,Ne=!0},Ee.onerror=function(){Ke=!0,xe=null},Ee.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(p){let t,s,l,c;p.resetRequestQueue=()=>{t=[],s=0,l=0,c={}},p.addThrottleControl=E=>{const A=l++;return c[A]=E,A},p.removeThrottleControl=E=>{delete c[E],b()},p.getImage=(E,A,M=!0)=>new Promise((k,O)=>{ge.supported&&(E.headers||(E.headers={}),E.headers.accept="image/webp,*/*"),h.e(E,{type:"image"}),t.push({abortController:A,requestParameters:E,supportImageRefresh:M,state:"queued",onError:W=>{O(W)},onSuccess:W=>{k(W)}}),b()});const f=E=>h._(this,void 0,void 0,function*(){E.state="running";const{requestParameters:A,supportImageRefresh:M,onError:k,onSuccess:O,abortController:W}=E,Z=M===!1&&!h.i(self)&&!h.g(A.url)&&(!A.headers||Object.keys(A.headers).reduce((se,pe)=>se&&pe==="accept",!0));s++;const Y=Z?w(A,W):h.m(A,W);try{const se=yield Y;delete E.abortController,E.state="completed",se.data instanceof HTMLImageElement||h.b(se.data)?O(se):se.data&&O({data:yield(q=se.data,typeof createImageBitmap=="function"?h.d(q):h.f(q)),cacheControl:se.cacheControl,expires:se.expires})}catch(se){delete E.abortController,k(se)}finally{s--,b()}var q}),b=()=>{const E=(()=>{for(const A of Object.keys(c))if(c[A]())return!0;return!1})()?h.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:h.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let A=s;A<E&&t.length>0;A++){const M=t.shift();M.abortController.signal.aborted?A--:f(M)}},w=(E,A)=>new Promise((M,k)=>{const O=new Image,W=E.url,Z=E.credentials;Z&&Z==="include"?O.crossOrigin="use-credentials":(Z&&Z==="same-origin"||!h.s(W))&&(O.crossOrigin="anonymous"),A.signal.addEventListener("abort",()=>{O.src="",k(h.c())}),O.fetchPriority="high",O.onload=()=>{O.onerror=O.onload=null,M({data:O})},O.onerror=()=>{O.onerror=O.onload=null,A.signal.aborted||k(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},O.src=W})}(me||(me={})),me.resetRequestQueue();class We{constructor(t){this._transformRequestFn=t}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}normalizeSpriteURL(t,s,l){const c=function(f){const b=f.match(lt);if(!b)throw new Error(`Unable to parse URL "${f}"`);return{protocol:b[1],authority:b[2],path:b[3]||"/",params:b[4]?b[4].split("&"):[]}}(t);return c.path+=`${s}${l}`,function(f){const b=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${b}`}(c)}setTransformRequest(t){this._transformRequestFn=t}}const lt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ct(p){var t=new h.A(3);return t[0]=p[0],t[1]=p[1],t[2]=p[2],t}var vt,tt=function(p,t,s){return p[0]=t[0]-s[0],p[1]=t[1]-s[1],p[2]=t[2]-s[2],p};vt=new h.A(3),h.A!=Float32Array&&(vt[0]=0,vt[1]=0,vt[2]=0);var ot=function(p){var t=p[0],s=p[1];return t*t+s*s};function bt(p){const t=[];if(typeof p=="string")t.push({id:"default",url:p});else if(p&&p.length>0){const s=[];for(const{id:l,url:c}of p){const f=`${l}${c}`;s.indexOf(f)===-1&&(s.push(f),t.push({id:l,url:c}))}}return t}(function(){var p=new h.A(2);h.A!=Float32Array&&(p[0]=0,p[1]=0)})();class gt{constructor(t,s,l,c){this.context=t,this.format=l,this.texture=t.gl.createTexture(),this.update(s,c)}update(t,s,l){const{width:c,height:f}=t,b=!(this.size&&this.size[0]===c&&this.size[1]===f||l),{context:w}=this,{gl:E}=w;if(this.useMipmap=!!(s&&s.useMipmap),E.bindTexture(E.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===E.RGBA&&(!s||s.premultiply!==!1)),b)this.size=[c,f],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||h.b(t)?E.texImage2D(E.TEXTURE_2D,0,this.format,this.format,E.UNSIGNED_BYTE,t):E.texImage2D(E.TEXTURE_2D,0,this.format,c,f,0,this.format,E.UNSIGNED_BYTE,t.data);else{const{x:A,y:M}=l||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||h.b(t)?E.texSubImage2D(E.TEXTURE_2D,0,A,M,E.RGBA,E.UNSIGNED_BYTE,t):E.texSubImage2D(E.TEXTURE_2D,0,A,M,c,f,E.RGBA,E.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&E.generateMipmap(E.TEXTURE_2D)}bind(t,s,l){const{context:c}=this,{gl:f}=c;f.bindTexture(f.TEXTURE_2D,this.texture),l!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=f.LINEAR),t!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,t),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,l||t),this.filter=t),s!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,s),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function ei(p){const{userImage:t}=p;return!!(t&&t.render&&t.render())&&(p.data.replace(new Uint8Array(t.data.buffer)),!0)}class ri extends h.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new h.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:s,promiseResolve:l}of this.requestors)l(this._getImagesForIds(s));this.requestors=[]}}getImage(t){const s=this.images[t];if(s&&!s.data&&s.spriteData){const l=s.spriteData;s.data=new h.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),s.spriteData=null}return s}addImage(t,s){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,s)&&(this.images[t]=s)}_validate(t,s){let l=!0;const c=s.data||s.spriteData;return this._validateStretch(s.stretchX,c&&c.width)||(this.fire(new h.j(new Error(`Image "${t}" has invalid "stretchX" value`))),l=!1),this._validateStretch(s.stretchY,c&&c.height)||(this.fire(new h.j(new Error(`Image "${t}" has invalid "stretchY" value`))),l=!1),this._validateContent(s.content,s)||(this.fire(new h.j(new Error(`Image "${t}" has invalid "content" value`))),l=!1),l}_validateStretch(t,s){if(!t)return!0;let l=0;for(const c of t){if(c[0]<l||c[1]<c[0]||s<c[1])return!1;l=c[1]}return!0}_validateContent(t,s){if(!t)return!0;if(t.length!==4)return!1;const l=s.spriteData,c=l&&l.width||s.data.width,f=l&&l.height||s.data.height;return!(t[0]<0||c<t[0]||t[1]<0||f<t[1]||t[2]<0||c<t[2]||t[3]<0||f<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,s,l=!0){const c=this.getImage(t);if(l&&(c.data.width!==s.data.width||c.data.height!==s.data.height))throw new Error(`size mismatch between old image (${c.data.width}x${c.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=c.version+1,this.images[t]=s,this.updatedImages[t]=!0}removeImage(t){const s=this.images[t];delete this.images[t],delete this.patterns[t],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise((s,l)=>{let c=!0;if(!this.isLoaded())for(const f of t)this.images[f]||(c=!1);this.isLoaded()||c?s(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:s})})}_getImagesForIds(t){const s={};for(const l of t){let c=this.getImage(l);c||(this.fire(new h.k("styleimagemissing",{id:l})),c=this.getImage(l)),c?s[l]={data:c.data.clone(),pixelRatio:c.pixelRatio,sdf:c.sdf,version:c.version,stretchX:c.stretchX,stretchY:c.stretchY,content:c.content,hasRenderCallback:!!(c.userImage&&c.userImage.render)}:h.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return s}getPixelSize(){const{width:t,height:s}=this.atlasImage;return{width:t,height:s}}getPattern(t){const s=this.patterns[t],l=this.getImage(t);if(!l)return null;if(s&&s.position.version===l.version)return s.position;if(s)s.position.version=l.version;else{const c={w:l.data.width+2,h:l.data.height+2,x:0,y:0},f=new h.I(c,l);this.patterns[t]={bin:c,position:f}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const s=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new gt(t,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const f in this.patterns)t.push(this.patterns[f].bin);const{w:s,h:l}=h.p(t),c=this.atlasImage;c.resize({width:s||1,height:l||1});for(const f in this.patterns){const{bin:b}=this.patterns[f],w=b.x+1,E=b.y+1,A=this.getImage(f).data,M=A.width,k=A.height;h.R.copy(A,c,{x:0,y:0},{x:w,y:E},{width:M,height:k}),h.R.copy(A,c,{x:0,y:k-1},{x:w,y:E-1},{width:M,height:1}),h.R.copy(A,c,{x:0,y:0},{x:w,y:E+k},{width:M,height:1}),h.R.copy(A,c,{x:M-1,y:0},{x:w-1,y:E},{width:1,height:k}),h.R.copy(A,c,{x:0,y:0},{x:w+M,y:E},{width:1,height:k})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const s of t){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const l=this.getImage(s);l||h.w(`Image with ID: "${s}" was not found`),ei(l)&&this.updateImage(s,l)}}}const $t=1e20;function Ki(p,t,s,l,c,f,b,w,E){for(let A=t;A<t+l;A++)Lt(p,s*f+A,f,c,b,w,E);for(let A=s;A<s+c;A++)Lt(p,A*f+t,1,l,b,w,E)}function Lt(p,t,s,l,c,f,b){f[0]=0,b[0]=-$t,b[1]=$t,c[0]=p[t];for(let w=1,E=0,A=0;w<l;w++){c[w]=p[t+w*s];const M=w*w;do{const k=f[E];A=(c[w]-c[k]+M-k*k)/(w-k)/2}while(A<=b[E]&&--E>-1);E++,f[E]=w,b[E]=A,b[E+1]=$t}for(let w=0,E=0;w<l;w++){for(;b[E+1]<w;)E++;const A=f[E],M=w-A;p[t+w*s]=c[A]+M*M}}class Ft{constructor(t,s){this.requestManager=t,this.localIdeographFontFamily=s,this.entries={}}setURL(t){this.url=t}getGlyphs(t){return h._(this,void 0,void 0,function*(){const s=[];for(const f in t)for(const b of t[f])s.push(this._getAndCacheGlyphsPromise(f,b));const l=yield Promise.all(s),c={};for(const{stack:f,id:b,glyph:w}of l)c[f]||(c[f]={}),c[f][b]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics};return c})}_getAndCacheGlyphsPromise(t,s){return h._(this,void 0,void 0,function*(){let l=this.entries[t];l||(l=this.entries[t]={glyphs:{},requests:{},ranges:{}});let c=l.glyphs[s];if(c!==void 0)return{stack:t,id:s,glyph:c};if(c=this._tinySDF(l,t,s),c)return l.glyphs[s]=c,{stack:t,id:s,glyph:c};const f=Math.floor(s/256);if(256*f>65535)throw new Error("glyphs > 65535 not supported");if(l.ranges[f])return{stack:t,id:s,glyph:c};if(!this.url)throw new Error("glyphsUrl is not set");if(!l.requests[f]){const w=Ft.loadGlyphRange(t,f,this.url,this.requestManager);l.requests[f]=w}const b=yield l.requests[f];for(const w in b)this._doesCharSupportLocalGlyph(+w)||(l.glyphs[+w]=b[+w]);return l.ranges[f]=!0,{stack:t,id:s,glyph:b[s]||null}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(h.u["CJK Unified Ideographs"](t)||h.u["Hangul Syllables"](t)||h.u.Hiragana(t)||h.u.Katakana(t))}_tinySDF(t,s,l){const c=this.localIdeographFontFamily;if(!c||!this._doesCharSupportLocalGlyph(l))return;let f=t.tinySDF;if(!f){let w="400";/bold/i.test(s)?w="900":/medium/i.test(s)?w="500":/light/i.test(s)&&(w="200"),f=t.tinySDF=new Ft.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:w})}const b=f.draw(String.fromCharCode(l));return{id:l,bitmap:new h.o({width:b.width||60,height:b.height||60},b.data),metrics:{width:b.glyphWidth/2||24,height:b.glyphHeight/2||24,left:b.glyphLeft/2+.5||0,top:b.glyphTop/2-27.5||-8,advance:b.glyphAdvance/2||24,isDoubleResolution:!0}}}}Ft.loadGlyphRange=function(p,t,s,l){return h._(this,void 0,void 0,function*(){const c=256*t,f=c+255,b=l.transformRequest(s.replace("{fontstack}",p).replace("{range}",`${c}-${f}`),"Glyphs"),w=yield h.l(b,new AbortController);if(!w||!w.data)throw new Error(`Could not load glyph range. range: ${t}, ${c}-${f}`);const E={};for(const A of h.n(w.data))E[A.id]=A;return E})},Ft.TinySDF=class{constructor({fontSize:p=24,buffer:t=3,radius:s=8,cutoff:l=.25,fontFamily:c="sans-serif",fontWeight:f="normal",fontStyle:b="normal"}={}){this.buffer=t,this.cutoff=l,this.radius=s;const w=this.size=p+4*t,E=this._createCanvas(w),A=this.ctx=E.getContext("2d",{willReadFrequently:!0});A.font=`${b} ${f} ${p}px ${c}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(p){const t=document.createElement("canvas");return t.width=t.height=p,t}draw(p){const{width:t,actualBoundingBoxAscent:s,actualBoundingBoxDescent:l,actualBoundingBoxLeft:c,actualBoundingBoxRight:f}=this.ctx.measureText(p),b=Math.ceil(s),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-c))),E=Math.min(this.size-this.buffer,b+Math.ceil(l)),A=w+2*this.buffer,M=E+2*this.buffer,k=Math.max(A*M,0),O=new Uint8ClampedArray(k),W={data:O,width:A,height:M,glyphWidth:w,glyphHeight:E,glyphTop:b,glyphLeft:0,glyphAdvance:t};if(w===0||E===0)return W;const{ctx:Z,buffer:Y,gridInner:q,gridOuter:se}=this;Z.clearRect(Y,Y,w,E),Z.fillText(p,Y,Y+b);const pe=Z.getImageData(Y,Y,w,E);se.fill($t,0,k),q.fill(0,0,k);for(let Q=0;Q<E;Q++)for(let ce=0;ce<w;ce++){const fe=pe.data[4*(Q*w+ce)+3]/255;if(fe===0)continue;const _e=(Q+Y)*A+ce+Y;if(fe===1)se[_e]=0,q[_e]=$t;else{const ve=.5-fe;se[_e]=ve>0?ve*ve:0,q[_e]=ve<0?ve*ve:0}}Ki(se,0,0,A,M,A,this.f,this.v,this.z),Ki(q,Y,Y,w,E,A,this.f,this.v,this.z);for(let Q=0;Q<k;Q++){const ce=Math.sqrt(se[Q])-Math.sqrt(q[Q]);O[Q]=Math.round(255-255*(ce/this.radius+this.cutoff))}return W}};class Ht{constructor(){this.specification=h.v.light.position}possiblyEvaluate(t,s){return h.y(t.expression.evaluate(s))}interpolate(t,s,l){return{x:h.z.number(t.x,s.x,l),y:h.z.number(t.y,s.y,l),z:h.z.number(t.z,s.z,l)}}}let cr;class vr extends h.E{constructor(t){super(),cr=cr||new h.q({anchor:new h.D(h.v.light.anchor),position:new Ht,color:new h.D(h.v.light.color),intensity:new h.D(h.v.light.intensity)}),this._transitionable=new h.T(cr),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s={}){if(!this._validate(h.r,t,s))for(const l in t){const c=t[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),c):this._transitionable.setValue(l,c)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,l){return(!l||l.validate!==!1)&&h.t(this,t.call(h.x,{value:s,style:{glyphs:!0,sprite:!0},styleSpec:h.v}))}}class vi{constructor(t,s){this.width=t,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,s){const l=t.join(",")+String(s);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(t,s)),this.dashEntry[l]}getDashRanges(t,s,l){const c=[];let f=t.length%2==1?-t[t.length-1]*l:0,b=t[0]*l,w=!0;c.push({left:f,right:b,isDash:w,zeroLength:t[0]===0});let E=t[0];for(let A=1;A<t.length;A++){w=!w;const M=t[A];f=E*l,E+=M,b=E*l,c.push({left:f,right:b,isDash:w,zeroLength:M===0})}return c}addRoundDash(t,s,l){const c=s/2;for(let f=-l;f<=l;f++){const b=this.width*(this.nextRow+l+f);let w=0,E=t[w];for(let A=0;A<this.width;A++){A/E.right>1&&(E=t[++w]);const M=Math.abs(A-E.left),k=Math.abs(A-E.right),O=Math.min(M,k);let W;const Z=f/l*(c+1);if(E.isDash){const Y=c-Math.abs(Z);W=Math.sqrt(O*O+Y*Y)}else W=c-Math.sqrt(O*O+Z*Z);this.data[b+A]=Math.max(0,Math.min(255,W+128))}}}addRegularDash(t){for(let w=t.length-1;w>=0;--w){const E=t[w],A=t[w+1];E.zeroLength?t.splice(w,1):A&&A.isDash===E.isDash&&(A.left=E.left,t.splice(w,1))}const s=t[0],l=t[t.length-1];s.isDash===l.isDash&&(s.left=l.left-this.width,l.right=s.right+this.width);const c=this.width*this.nextRow;let f=0,b=t[f];for(let w=0;w<this.width;w++){w/b.right>1&&(b=t[++f]);const E=Math.abs(w-b.left),A=Math.abs(w-b.right),M=Math.min(E,A);this.data[c+w]=Math.max(0,Math.min(255,(b.isDash?M:-M)+128))}}addDash(t,s){const l=s?7:0,c=2*l+1;if(this.nextRow+c>this.height)return h.w("LineAtlas out of space"),null;let f=0;for(let w=0;w<t.length;w++)f+=t[w];if(f!==0){const w=this.width/f,E=this.getDashRanges(t,this.width,w);s?this.addRoundDash(E,w,l):this.addRegularDash(E)}const b={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:f};return this.nextRow+=c,this.dirty=!0,b}bind(t){const s=t.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}const ni="maplibre_preloaded_worker_pool";class ur{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<ur.workerCount;)this.workers.push(new Worker(h.a.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ni]}numActive(){return Object.keys(this.active).length}}const Qr=Math.floor(N.hardwareConcurrency/2);let mr,bi;function Pe(){return mr||(mr=new ur),mr}ur.workerCount=h.B(globalThis)?Math.max(Math.min(Qr,3),1):1;class it{constructor(t,s){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=s;const l=this.workerPool.acquire(s);for(let c=0;c<l.length;c++){const f=new h.C(l[c],s);f.name=`Worker ${c}`,this.actors.push(f)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,s){const l=[];for(const c of this.actors)l.push(c.sendAsync({type:t,data:s}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(s=>{s.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,s){for(const l of this.actors)l.registerMessageHandler(t,s)}}function Qe(){return bi||(bi=new it(Pe(),h.G),bi.registerMessageHandler("GR",(p,t,s)=>h.m(t,s))),bi}function ht(p,t){const s=h.F();return h.H(s,s,[1,1,0]),h.J(s,s,[.5*p.width,.5*p.height,1]),h.K(s,s,p.calculatePosMatrix(t.toUnwrapped()))}function Kt(p,t,s,l,c,f){const b=function(k,O,W){if(k)for(const Z of k){const Y=O[Z];if(Y&&Y.source===W&&Y.type==="fill-extrusion")return!0}else for(const Z in O){const Y=O[Z];if(Y.source===W&&Y.type==="fill-extrusion")return!0}return!1}(c&&c.layers,t,p.id),w=f.maxPitchScaleFactor(),E=p.tilesIn(l,w,b);E.sort(Yt);const A=[];for(const k of E)A.push({wrappedTileID:k.tileID.wrapped().key,queryResults:k.tile.queryRenderedFeatures(t,s,p._state,k.queryGeometry,k.cameraQueryGeometry,k.scale,c,f,w,ht(p.transform,k.tileID))});const M=function(k){const O={},W={};for(const Z of k){const Y=Z.queryResults,q=Z.wrappedTileID,se=W[q]=W[q]||{};for(const pe in Y){const Q=Y[pe],ce=se[pe]=se[pe]||{},fe=O[pe]=O[pe]||[];for(const _e of Q)ce[_e.featureIndex]||(ce[_e.featureIndex]=!0,fe.push(_e))}}return O}(A);for(const k in M)M[k].forEach(O=>{const W=O.feature,Z=p.getFeatureState(W.layer["source-layer"],W.id);W.source=W.layer.source,W.layer["source-layer"]&&(W.sourceLayer=W.layer["source-layer"]),W.state=Z});return M}function Yt(p,t){const s=p.tileID,l=t.tileID;return s.overscaledZ-l.overscaledZ||s.canonical.y-l.canonical.y||s.wrap-l.wrap||s.canonical.x-l.canonical.x}function J(p,t,s){return h._(this,void 0,void 0,function*(){let l=p;if(p.url?l=(yield h.h(t.transformRequest(p.url,"Source"),s)).data:yield N.frameAsync(s),!l)return null;const c=h.L(h.e(l,p),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(c.vectorLayerIds=l.vector_layers.map(f=>f.id)),c})}class ie{constructor(t,s){t&&(s?this.setSouthWest(t).setNorthEast(s):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof h.M?new h.M(t.lng,t.lat):h.M.convert(t),this}setSouthWest(t){return this._sw=t instanceof h.M?new h.M(t.lng,t.lat):h.M.convert(t),this}extend(t){const s=this._sw,l=this._ne;let c,f;if(t instanceof h.M)c=t,f=t;else{if(!(t instanceof ie))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(ie.convert(t)):this.extend(h.M.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(h.M.convert(t)):this;if(c=t._sw,f=t._ne,!c||!f)return this}return s||l?(s.lng=Math.min(c.lng,s.lng),s.lat=Math.min(c.lat,s.lat),l.lng=Math.max(f.lng,l.lng),l.lat=Math.max(f.lat,l.lat)):(this._sw=new h.M(c.lng,c.lat),this._ne=new h.M(f.lng,f.lat)),this}getCenter(){return new h.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new h.M(this.getWest(),this.getNorth())}getSouthEast(){return new h.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:s,lat:l}=h.M.convert(t);let c=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&c}static convert(t){return t instanceof ie?t:t&&new ie(t)}static fromLngLat(t,s=0){const l=360*s/40075017,c=l/Math.cos(Math.PI/180*t.lat);return new ie(new h.M(t.lng-c,t.lat-l),new h.M(t.lng+c,t.lat+l))}}class ye{constructor(t,s,l){this.bounds=ie.convert(this.validateBounds(t)),this.minzoom=s||0,this.maxzoom=l||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const s=Math.pow(2,t.z),l=Math.floor(h.N(this.bounds.getWest())*s),c=Math.floor(h.O(this.bounds.getNorth())*s),f=Math.ceil(h.N(this.bounds.getEast())*s),b=Math.ceil(h.O(this.bounds.getSouth())*s);return t.x>=l&&t.x<f&&t.y>=c&&t.y<b}}class De extends h.E{constructor(t,s,l,c){if(super(),this.id=t,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,h.e(this,h.L(s,["url","scheme","tileSize","promoteId"])),this._options=h.e({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(c)}load(){return h._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new h.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield J(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(h.e(this,t),t.bounds&&(this.tileBounds=new ye(t.bounds,this.minzoom,this.maxzoom)),this.fire(new h.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new h.j(t))}})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return h.e({},this._options)}loadTile(t){return h._(this,void 0,void 0,function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(s,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};l.request.collectResourceTiming=this._collectResourceTiming;let c="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise((f,b)=>{t.reloadPromise={resolve:f,reject:b}})}else t.actor=this.dispatcher.getActor(),c="LT";t.abortController=new AbortController;try{const f=yield t.actor.sendAsync({type:c,data:l},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,f)}catch(f){if(delete t.abortController,t.aborted)return;if(f&&f.status!==404)throw f;this._afterTileLoadWorkerResponse(t,null)}})}_afterTileLoadWorkerResponse(t,s){if(s&&s.resourceTiming&&(t.resourceTiming=s.resourceTiming),s&&this.map._refreshExpiredTiles&&t.setExpiryData(s),t.loadVectorData(s,this.map.painter),t.reloadPromise){const l=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(l.resolve).catch(l.reject)}}abortTile(t){return h._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))})}unloadTile(t){return h._(this,void 0,void 0,function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ee extends h.E{constructor(t,s,l,c){super(),this.id=t,this.dispatcher=l,this.setEventedParent(c),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=h.e({type:"raster"},s),h.e(this,h.L(s,["url","scheme","tileSize"]))}load(){return h._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new h.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield J(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,t&&(h.e(this,t),t.bounds&&(this.tileBounds=new ye(t.bounds,this.minzoom,this.maxzoom)),this.fire(new h.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new h.j(t))}})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}serialize(){return h.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return h._(this,void 0,void 0,function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const l=yield me.getImage(this.map._requestManager.transformRequest(s,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&l.cacheControl&&l.expires&&t.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const c=this.map.painter.context,f=c.gl,b=l.data;t.texture=this.map.painter.getTileTexture(b.width),t.texture?t.texture.update(b,{useMipmap:!0}):(t.texture=new gt(c,b,f.RGBA,{useMipmap:!0}),t.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE,f.LINEAR_MIPMAP_NEAREST),c.extTextureFilterAnisotropic&&f.texParameterf(f.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax)),t.state="loaded"}}catch(l){if(delete t.abortController,t.aborted)t.state="unloaded";else if(l)throw t.state="errored",l}})}abortTile(t){return h._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)})}unloadTile(t){return h._(this,void 0,void 0,function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)})}hasTransition(){return!1}}class je extends ee{constructor(t,s,l,c){super(t,s,l,c),this.type="raster-dem",this.maxzoom=22,this._options=h.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox",this.redFactor=s.redFactor,this.greenFactor=s.greenFactor,this.blueFactor=s.blueFactor,this.baseShift=s.baseShift}loadTile(t){return h._(this,void 0,void 0,function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(s,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const c=yield me.getImage(l,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(c&&c.data){const f=c.data;this.map._refreshExpiredTiles&&c.cacheControl&&c.expires&&t.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const b=h.b(f)&&h.S()?f:yield this.readImageNow(f),w={type:this.type,uid:t.uid,source:this.id,rawImageData:b,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const E=yield t.actor.sendAsync({type:"LDT",data:w});t.dem=E,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(c){if(delete t.abortController,t.aborted)t.state="unloaded";else if(c)throw t.state="errored",c}})}readImageNow(t){return h._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&h.U()){const s=t.width+2,l=t.height+2;try{return new h.R({width:s,height:l},yield h.V(t,-1,-1,s,l))}catch{}}return N.getImageData(t,1)})}_getNeighboringTiles(t){const s=t.canonical,l=Math.pow(2,s.z),c=(s.x-1+l)%l,f=s.x===0?t.wrap-1:t.wrap,b=(s.x+1+l)%l,w=s.x+1===l?t.wrap+1:t.wrap,E={};return E[new h.Q(t.overscaledZ,f,s.z,c,s.y).key]={backfilled:!1},E[new h.Q(t.overscaledZ,w,s.z,b,s.y).key]={backfilled:!1},s.y>0&&(E[new h.Q(t.overscaledZ,f,s.z,c,s.y-1).key]={backfilled:!1},E[new h.Q(t.overscaledZ,t.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},E[new h.Q(t.overscaledZ,w,s.z,b,s.y-1).key]={backfilled:!1}),s.y+1<l&&(E[new h.Q(t.overscaledZ,f,s.z,c,s.y+1).key]={backfilled:!1},E[new h.Q(t.overscaledZ,t.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},E[new h.Q(t.overscaledZ,w,s.z,b,s.y+1).key]={backfilled:!1}),E}unloadTile(t){return h._(this,void 0,void 0,function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))})}}class et extends h.E{constructor(t,s,l,c){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=l.getActor(),this.setEventedParent(c),this._data=s.data,this._options=h.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const f=h.W/this.tileSize;this.workerOptions=h.e({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*f,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*f,extent:h.W,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:h.W,radius:(s.clusterRadius||50)*f,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return h._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,s,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:s,offset:l}})}_updateWorkerData(t){return h._(this,void 0,void 0,function*(){const s=h.e({type:this.type},this.workerOptions);t?s.dataDiff=t:typeof this._data=="string"?(s.request=this.map._requestManager.transformRequest(N.resolveURL(this._data),"Source"),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new h.k("dataloading",{dataType:"source"}));try{const l=yield this.actor.sendAsync({type:"LD",data:s});if(this._pendingLoads--,this._removed||l.abandoned)return void this.fire(new h.k("dataabort",{dataType:"source"}));let c=null;l.resourceTiming&&l.resourceTiming[this.id]&&(c=l.resourceTiming[this.id].slice(0));const f={dataType:"source"};this._collectResourceTiming&&c&&c.length>0&&h.e(f,{resourceTiming:c}),this.fire(new h.k("data",Object.assign(Object.assign({},f),{sourceDataType:"metadata"}))),this.fire(new h.k("data",Object.assign(Object.assign({},f),{sourceDataType:"content"})))}catch(l){if(this._pendingLoads--,this._removed)return void this.fire(new h.k("dataabort",{dataType:"source"}));this.fire(new h.j(l))}})}loaded(){return this._pendingLoads===0}loadTile(t){return h._(this,void 0,void 0,function*(){const s=t.actor?"RT":"LT";t.actor=this.actor;const l={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.abortController=new AbortController;const c=yield this.actor.sendAsync({type:s,data:l},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(c,this.map.painter,s==="RT")})}abortTile(t){return h._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0})}unloadTile(t){return h._(this,void 0,void 0,function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return h.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Ie=h.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Oe extends h.E{constructor(t,s,l,c){super(),this.id=t,this.dispatcher=l,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(c),this.options=s}load(t){return h._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new h.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const s=yield me.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,s&&s.data&&(this.image=s.data,t&&(this.coordinates=t),this._finishLoading())}catch(s){this._request=null,this._loaded=!0,this.fire(new h.j(s))}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new h.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const s=t.map(h.Y.fromLngLat);this.tileID=function(c){let f=1/0,b=1/0,w=-1/0,E=-1/0;for(const O of c)f=Math.min(f,O.x),b=Math.min(b,O.y),w=Math.max(w,O.x),E=Math.max(E,O.y);const A=Math.max(w-f,E-b),M=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),k=Math.pow(2,M);return new h.a0(M,Math.floor((f+w)/2*k),Math.floor((b+E)/2*k))}(s),this.minzoom=this.maxzoom=this.tileID.z;const l=s.map(c=>this.tileID.getTilePoint(c)._round());return this._boundsArray=new h.Z,this._boundsArray.emplaceBack(l[0].x,l[0].y,0,0),this._boundsArray.emplaceBack(l[1].x,l[1].y,h.W,0),this._boundsArray.emplaceBack(l[3].x,l[3].y,0,h.W),this._boundsArray.emplaceBack(l[2].x,l[2].y,h.W,h.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new h.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,s=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Ie.members)),this.boundsSegments||(this.boundsSegments=h.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new gt(t,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let l=!1;for(const c in this.tiles){const f=this.tiles[c];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture,l=!0)}l&&this.fire(new h.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return h._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Fe extends Oe{constructor(t,s,l,c){super(t,s,l,c),this.roundZoom=!0,this.type="video",this.options=s}load(){return h._(this,void 0,void 0,function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const s of t.urls)this.urls.push(this.map._requestManager.transformRequest(s,"Source").url);try{const s=yield h.a2(this.urls);if(this._loaded=!0,!s)return;this.video=s,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(s){this.fire(new h.j(s))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const s=this.video.seekable;t<s.start(0)||t>s.end(0)?this.fire(new h.j(new h.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,s=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Ie.members)),this.boundsSegments||(this.boundsSegments=h.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new gt(t,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let l=!1;for(const c in this.tiles){const f=this.tiles[c];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture,l=!0)}l&&this.fire(new h.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class st extends Oe{constructor(t,s,l,c){super(t,s,l,c),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(f=>!Array.isArray(f)||f.length!==2||f.some(b=>typeof b!="number"))||this.fire(new h.j(new h.a1(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new h.j(new h.a1(`sources.${t}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new h.j(new h.a1(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new h.j(new h.a1(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new h.j(new h.a1(`sources.${t}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){return h._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new h.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,l=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,Ie.members)),this.boundsSegments||(this.boundsSegments=h.$.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new gt(s,this.canvas,l.RGBA,{premultiply:!0});let c=!1;for(const f in this.tiles){const b=this.tiles[f];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,c=!0)}c&&this.fire(new h.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const wt={},ft=p=>{switch(p){case"geojson":return et;case"image":return Oe;case"raster":return ee;case"raster-dem":return je;case"vector":return De;case"video":return Fe;case"canvas":return st}return wt[p]},Tt="RTLPluginLoaded";class Nt extends h.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Qe()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch(s=>{throw this.status="error",s})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return h._(this,arguments,void 0,function*(s,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=N.resolveURL(s),!this.url)throw new Error(`requested url ${s} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return h._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new h.k(Tt))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Zt=null;function Ce(){return Zt||(Zt=new Nt),Zt}class ui{constructor(t,s){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=h.a3(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const s=t+this.timeAdded;s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,s,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(c,f){const b={};if(!f)return b;for(const w of c){const E=w.layerIds.map(A=>f.getLayer(A)).filter(Boolean);if(E.length!==0){w.layers=E,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(A=>E.filter(M=>M.id===A)[0]));for(const A of E)b[A.id]=w}}return b}(t.buckets,s.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const f=this.buckets[c];if(f instanceof h.a5){if(this.hasSymbolBuckets=!0,!l)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const f=this.buckets[c];if(f instanceof h.a5&&f.hasRTLText){this.hasRTLText=!0,Ce().lazyLoad();break}}this.queryPadding=0;for(const c in this.buckets){const f=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(c).queryRadius(f))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new h.a4}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const l in this.buckets){const c=this.buckets[l];c.uploadPending()&&c.upload(t)}const s=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new gt(t,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new gt(t,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,s,l,c,f,b,w,E,A,M){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:f,scale:b,tileSize:this.tileSize,pixelPosMatrix:M,transform:E,params:w,queryPadding:this.queryPadding*A},t,s,l):{}}querySourceFeatures(t,s){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const c=l.loadVTLayers(),f=s&&s.sourceLayer?s.sourceLayer:"",b=c._geojsonTileLayer||c[f];if(!b)return;const w=h.a6(s&&s.filter),{z:E,x:A,y:M}=this.tileID.canonical,k={z:E,x:A,y:M};for(let O=0;O<b.length;O++){const W=b.feature(O);if(w.needGeometry){const q=h.a7(W,!0);if(!w.filter(new h.a8(this.tileID.overscaledZ),q,this.tileID.canonical))continue}else if(!w.filter(new h.a8(this.tileID.overscaledZ),W))continue;const Z=l.getId(W,f),Y=new h.a9(W,E,A,M,Z);Y.tile=k,t.push(Y)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const l=h.aa(t.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const l=Date.now();let c=!1;if(this.expirationTime>l)c=!1;else if(s)if(this.expirationTime<s)c=!0;else{const f=this.expirationTime-s;f?this.expirationTime=l+Math.max(f,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const c in this.buckets){if(!s.style.hasLayer(c))continue;const f=this.buckets[c],b=f.layers[0].sourceLayer||"_geojsonTileLayer",w=l[b],E=t[b];if(!w||!E||Object.keys(E).length===0)continue;f.update(E,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});const A=s&&s.style&&s.style.getLayer(c);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(f)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<N.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=N.now()+t}setDependencies(t,s){const l={};for(const c of s)l[c]=!0;this.dependencies[t]=l}hasDependency(t,s){for(const l of t){const c=this.dependencies[l];if(c){for(const f of s)if(c[f])return!0}}return!1}}class wi{constructor(t,s){this.max=t,this.onRemove=s,this.reset()}reset(){for(const t in this.data)for(const s of this.data[t])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(t,s,l){const c=t.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const f={value:s,timeout:void 0};if(l!==void 0&&(f.timeout=setTimeout(()=>{this.remove(t,f)},l)),this.data[c].push(f),this.order.push(c),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const s=this.data[t].shift();return s.timeout&&clearTimeout(s.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),s.value}getByKey(t){const s=this.data[t];return s?s[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,s){if(!this.has(t))return this;const l=t.wrapped().key,c=s===void 0?0:this.data[l].indexOf(s),f=this.data[l][c];return this.data[l].splice(c,1),f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(f.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(t){const s=[];for(const l in this.data)for(const c of this.data[l])t(c.value)||s.push(c);for(const l of s)this.remove(l.value.tileID,l)}}class en{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,l){const c=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][c]=this.stateChanges[t][c]||{},h.e(this.stateChanges[t][c],l),this.deletedStates[t]===null){this.deletedStates[t]={};for(const f in this.state[t])f!==c&&(this.deletedStates[t][f]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][c]===null){this.deletedStates[t][c]={};for(const f in this.state[t][c])l[f]||(this.deletedStates[t][c][f]=null)}else for(const f in l)this.deletedStates[t]&&this.deletedStates[t][c]&&this.deletedStates[t][c][f]===null&&delete this.deletedStates[t][c][f]}removeFeatureState(t,s,l){if(this.deletedStates[t]===null)return;const c=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},l&&s!==void 0)this.deletedStates[t][c]!==null&&(this.deletedStates[t][c]=this.deletedStates[t][c]||{},this.deletedStates[t][c][l]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][c])for(l in this.deletedStates[t][c]={},this.stateChanges[t][c])this.deletedStates[t][c][l]=null;else this.deletedStates[t][c]=null;else this.deletedStates[t]=null}getState(t,s){const l=String(s),c=h.e({},(this.state[t]||{})[l],(this.stateChanges[t]||{})[l]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const f=this.deletedStates[t][s];if(f===null)return{};for(const b in f)delete c[b]}return c}initializeTileState(t,s){t.setFeatureState(this.state,s)}coalesceChanges(t,s){const l={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const f={};for(const b in this.stateChanges[c])this.state[c][b]||(this.state[c][b]={}),h.e(this.state[c][b],this.stateChanges[c][b]),f[b]=this.state[c][b];l[c]=f}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const f={};if(this.deletedStates[c]===null)for(const b in this.state[c])f[b]={},this.state[c][b]={};else for(const b in this.deletedStates[c]){if(this.deletedStates[c][b]===null)this.state[c][b]={};else for(const w of Object.keys(this.deletedStates[c][b]))delete this.state[c][b][w];f[b]=this.state[c][b]}l[c]=l[c]||{},h.e(l[c],f)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const c in t)t[c].setFeatureState(l,s)}}class Xi extends h.E{constructor(t,s,l){super(),this.id=t,this.dispatcher=l,this.on("data",c=>this._dataHandler(c)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((c,f,b,w)=>{const E=new(ft(f.type))(c,f,b,w);if(E.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${E.id}`);return E})(t,s,l,this),this._tiles={},this._cache=new wi(0,c=>this._unloadTile(c)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new en,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const s=this._tiles[t];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,s,l){return h._(this,void 0,void 0,function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,s,l)}catch(c){t.state="errored",c.status!==404?this._source.fire(new h.j(c,{tile:t})):this.update(this.transform,this.terrain)}})}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new h.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const l=this._tiles[s];l.upload(t),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Ve).map(t=>t.key)}getRenderableIds(t){const s=[];for(const l in this._tiles)this._isIdRenderable(l,t)&&s.push(this._tiles[l]);return t?s.sort((l,c)=>{const f=l.tileID,b=c.tileID,w=new h.P(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),E=new h.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-b.overscaledZ||E.y-w.y||E.x-w.x}).map(l=>l.tileID.key):s.map(l=>l.tileID).sort(Ve).map(l=>l.key)}hasRenderableParent(t){const s=this.findLoadedParent(t,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(t,s){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(s||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,s){return h._(this,void 0,void 0,function*(){const l=this._tiles[t];l&&(l.state!=="loading"&&(l.state=s),yield this._loadTile(l,t,s))})}_tileLoaded(t,s,l){t.timeAdded=N.now(),l==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new h.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const s=this.getRenderableIds();for(let c=0;c<s.length;c++){const f=s[c];if(t.neighboringTiles&&t.neighboringTiles[f]){const b=this.getTileByID(f);l(t,b),l(b,t)}}function l(c,f){c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0;let b=f.tileID.canonical.x-c.tileID.canonical.x;const w=f.tileID.canonical.y-c.tileID.canonical.y,E=Math.pow(2,c.tileID.canonical.z),A=f.tileID.key;b===0&&w===0||Math.abs(w)>1||(Math.abs(b)>1&&(Math.abs(b+E)===1?b+=E:Math.abs(b-E)===1&&(b-=E)),f.dem&&c.dem&&(c.dem.backfillBorder(f.dem,b,w),c.neighboringTiles&&c.neighboringTiles[A]&&(c.neighboringTiles[A].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,s,l,c){for(const f in this._tiles){let b=this._tiles[f];if(c[f]||!b.hasData()||b.tileID.overscaledZ<=s||b.tileID.overscaledZ>l)continue;let w=b.tileID;for(;b&&b.tileID.overscaledZ>s+1;){const A=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[A.key],b&&b.hasData()&&(w=A)}let E=w;for(;E.overscaledZ>s;)if(E=E.scaledTo(E.overscaledZ-1),t[E.key]){c[w.key]=w;break}}}findLoadedParent(t,s){if(t.key in this._loadedParentTiles){const l=this._loadedParentTiles[t.key];return l&&l.tileID.overscaledZ>=s?l:null}for(let l=t.overscaledZ-1;l>=s;l--){const c=t.scaledTo(l),f=this._getLoadedTile(c);if(f)return f}}_getLoadedTile(t){const s=this._tiles[t.key];return s&&s.hasData()?s:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const s=Math.ceil(t.width/this._source.tileSize)+1,l=Math.ceil(t.height/this._source.tileSize)+1,c=Math.floor(s*l*(this._maxTileCacheZoomLevels===null?h.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),f=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,c):c;this._cache.setMaxSize(f)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,s){const l={};for(const c in this._tiles){const f=this._tiles[c];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+s),l[f.tileID.key]=f}this._tiles=l;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(c,this._tiles[c])}}update(t,s){if(!this._sourceLoaded||this._paused)return;let l;this.transform=t,this.terrain=s,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new h.Q(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y)):(l=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(l=l.filter(M=>this._source.hasTile(M)))):l=[];const c=t.coveringZoomLevel(this._source),f=Math.max(c-Xi.maxOverzooming,this._source.minzoom),b=Math.max(c+Xi.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const M={};for(const k of l)if(k.canonical.z>this._source.minzoom){const O=k.scaledTo(k.canonical.z-1);M[O.key]=O;const W=k.scaledTo(Math.max(this._source.minzoom,Math.min(k.canonical.z,5)));M[W.key]=W}l=l.concat(Object.values(M))}const w=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,w&&this.fire(new h.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const E=this._updateRetainedTiles(l,c);if(At(this._source.type)){const M={},k={},O=Object.keys(E),W=N.now();for(const Z of O){const Y=E[Z],q=this._tiles[Z];if(!q||q.fadeEndTime!==0&&q.fadeEndTime<=W)continue;const se=this.findLoadedParent(Y,f);se&&(this._addTile(se.tileID),M[se.tileID.key]=se.tileID),k[Z]=Y}this._retainLoadedChildren(k,c,b,E);for(const Z in M)E[Z]||(this._coveredTiles[Z]=!0,E[Z]=M[Z]);if(s){const Z={},Y={};for(const q of l)this._tiles[q.key].hasData()?Z[q.key]=q:Y[q.key]=q;for(const q in Y){const se=Y[q].children(this._source.maxzoom);this._tiles[se[0].key]&&this._tiles[se[1].key]&&this._tiles[se[2].key]&&this._tiles[se[3].key]&&(Z[se[0].key]=E[se[0].key]=se[0],Z[se[1].key]=E[se[1].key]=se[1],Z[se[2].key]=E[se[2].key]=se[2],Z[se[3].key]=E[se[3].key]=se[3],delete Y[q])}for(const q in Y){const se=this.findLoadedParent(Y[q],this._source.minzoom);if(se){Z[se.tileID.key]=E[se.tileID.key]=se.tileID;for(const pe in Z)Z[pe].isChildOf(se.tileID)&&delete Z[pe]}}for(const q in this._tiles)Z[q]||(this._coveredTiles[q]=!0)}}for(const M in E)this._tiles[M].clearFadeHold();const A=h.ab(this._tiles,E);for(const M of A){const k=this._tiles[M];k.hasSymbolBuckets&&!k.holdingForFade()?k.setHoldDuration(this.map._fadeDuration):k.hasSymbolBuckets&&!k.symbolFadeFinished()||this._removeTile(M)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,s){const l={},c={},f=Math.max(s-Xi.maxOverzooming,this._source.minzoom),b=Math.max(s+Xi.maxUnderzooming,this._source.minzoom),w={};for(const E of t){const A=this._addTile(E);l[E.key]=E,A.hasData()||s<this._source.maxzoom&&(w[E.key]=E)}this._retainLoadedChildren(w,s,b,l);for(const E of t){let A=this._tiles[E.key];if(A.hasData())continue;if(s+1>this._source.maxzoom){const k=E.children(this._source.maxzoom)[0],O=this.getTile(k);if(O&&O.hasData()){l[k.key]=k;continue}}else{const k=E.children(this._source.maxzoom);if(l[k[0].key]&&l[k[1].key]&&l[k[2].key]&&l[k[3].key])continue}let M=A.wasRequested();for(let k=E.overscaledZ-1;k>=f;--k){const O=E.scaledTo(k);if(c[O.key])break;if(c[O.key]=!0,A=this.getTile(O),!A&&M&&(A=this._addTile(O)),A){const W=A.hasData();if((M||W)&&(l[O.key]=O),M=A.wasRequested(),W)break}}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const s=[];let l,c=this._tiles[t].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){l=this._loadedParentTiles[c.key];break}s.push(c.key);const f=c.scaledTo(c.overscaledZ-1);if(l=this._getLoadedTile(f),l)break;c=f}for(const f of s)this._loadedParentTiles[f]=l}}_addTile(t){let s=this._tiles[t.key];if(s)return s;s=this._cache.getAndRemove(t),s&&(this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,s)));const l=s;return s||(s=new ui(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(s,t.key,s.state)),s.uses++,this._tiles[t.key]=s,l||this._source.fire(new h.k("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(t,s){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const l=s.getExpiryTimeout();l&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},l))}_removeTile(t){const s=this._tiles[t];s&&(s.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}_dataHandler(t){const s=t.sourceDataType;t.dataType==="source"&&s==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&t.dataType==="source"&&s==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,s,l){const c=[],f=this.transform;if(!f)return c;const b=l?f.getCameraQueryGeometry(t):t,w=t.map(Z=>f.pointCoordinate(Z,this.terrain)),E=b.map(Z=>f.pointCoordinate(Z,this.terrain)),A=this.getIds();let M=1/0,k=1/0,O=-1/0,W=-1/0;for(const Z of E)M=Math.min(M,Z.x),k=Math.min(k,Z.y),O=Math.max(O,Z.x),W=Math.max(W,Z.y);for(let Z=0;Z<A.length;Z++){const Y=this._tiles[A[Z]];if(Y.holdingForFade())continue;const q=Y.tileID,se=Math.pow(2,f.zoom-Y.tileID.overscaledZ),pe=s*Y.queryPadding*h.W/Y.tileSize/se,Q=[q.getTilePoint(new h.Y(M,k)),q.getTilePoint(new h.Y(O,W))];if(Q[0].x-pe<h.W&&Q[0].y-pe<h.W&&Q[1].x+pe>=0&&Q[1].y+pe>=0){const ce=w.map(_e=>q.getTilePoint(_e)),fe=E.map(_e=>q.getTilePoint(_e));c.push({tile:Y,tileID:q,queryGeometry:ce,cameraQueryGeometry:fe,scale:se})}}return c}getVisibleCoordinates(t){const s=this.getRenderableIds(t).map(l=>this._tiles[l].tileID);for(const l of s)l.posMatrix=this.transform.calculatePosMatrix(l.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(At(this._source.type)){const t=N.now();for(const s in this._tiles)if(this._tiles[s].fadeEndTime>=t)return!0}return!1}setFeatureState(t,s,l){this._state.updateState(t=t||"_geojsonTileLayer",s,l)}removeFeatureState(t,s,l){this._state.removeFeatureState(t=t||"_geojsonTileLayer",s,l)}getFeatureState(t,s){return this._state.getState(t=t||"_geojsonTileLayer",s)}setDependencies(t,s,l){const c=this._tiles[t];c&&c.setDependencies(s,l)}reloadTilesForDependencies(t,s){for(const l in this._tiles)this._tiles[l].hasDependency(t,s)&&this._reloadTile(l,"reloading");this._cache.filter(l=>!l.hasDependency(t,s))}}function Ve(p,t){const s=Math.abs(2*p.wrap)-+(p.wrap<0),l=Math.abs(2*t.wrap)-+(t.wrap<0);return p.overscaledZ-t.overscaledZ||l-s||t.canonical.y-p.canonical.y||t.canonical.x-p.canonical.x}function At(p){return p==="raster"||p==="image"||p==="video"}Xi.maxOverzooming=10,Xi.maxUnderzooming=3;class _t{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=h.ac(t,0,1);let s=1,l=this._distances[s];const c=t*this.paddedLength+this.padding;for(;l<c&&s<this._distances.length;)l=this._distances[++s];const f=s-1,b=this._distances[f],w=l-b,E=w>0?(c-b)/w:0;return this.points[f].mult(1-E).add(this.points[s].mult(E))}}function si(p,t){let s=!0;return p==="always"||p!=="never"&&t!=="never"||(s=!1),s}class $r{constructor(t,s,l){const c=this.boxCells=[],f=this.circleCells=[];this.xCellCount=Math.ceil(t/l),this.yCellCount=Math.ceil(s/l);for(let b=0;b<this.xCellCount*this.yCellCount;b++)c.push([]),f.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,l,c,f){this._forEachCell(s,l,c,f,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(c),this.bboxes.push(f)}insertCircle(t,s,l,c){this._forEachCell(s-c,l-c,s+c,l+c,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(l),this.circles.push(c)}_insertBoxCell(t,s,l,c,f,b){this.boxCells[f].push(b)}_insertCircleCell(t,s,l,c,f,b){this.circleCells[f].push(b)}_query(t,s,l,c,f,b,w){if(l<0||t>this.width||c<0||s>this.height)return[];const E=[];if(t<=0&&s<=0&&this.width<=l&&this.height<=c){if(f)return[{key:null,x1:t,y1:s,x2:l,y2:c}];for(let A=0;A<this.boxKeys.length;A++)E.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const M=this.circles[3*A],k=this.circles[3*A+1],O=this.circles[3*A+2];E.push({key:this.circleKeys[A],x1:M-O,y1:k-O,x2:M+O,y2:k+O})}}else this._forEachCell(t,s,l,c,this._queryCell,E,{hitTest:f,overlapMode:b,seenUids:{box:{},circle:{}}},w);return E}query(t,s,l,c){return this._query(t,s,l,c,!1,null)}hitTest(t,s,l,c,f,b){return this._query(t,s,l,c,!0,f,b).length>0}hitTestCircle(t,s,l,c,f){const b=t-l,w=t+l,E=s-l,A=s+l;if(w<0||b>this.width||A<0||E>this.height)return!1;const M=[];return this._forEachCell(b,E,w,A,this._queryCellCircle,M,{hitTest:!0,overlapMode:c,circle:{x:t,y:s,radius:l},seenUids:{box:{},circle:{}}},f),M.length>0}_queryCell(t,s,l,c,f,b,w,E){const{seenUids:A,hitTest:M,overlapMode:k}=w,O=this.boxCells[f];if(O!==null){const Z=this.bboxes;for(const Y of O)if(!A.box[Y]){A.box[Y]=!0;const q=4*Y,se=this.boxKeys[Y];if(t<=Z[q+2]&&s<=Z[q+3]&&l>=Z[q+0]&&c>=Z[q+1]&&(!E||E(se))&&(!M||!si(k,se.overlapMode))&&(b.push({key:se,x1:Z[q],y1:Z[q+1],x2:Z[q+2],y2:Z[q+3]}),M))return!0}}const W=this.circleCells[f];if(W!==null){const Z=this.circles;for(const Y of W)if(!A.circle[Y]){A.circle[Y]=!0;const q=3*Y,se=this.circleKeys[Y];if(this._circleAndRectCollide(Z[q],Z[q+1],Z[q+2],t,s,l,c)&&(!E||E(se))&&(!M||!si(k,se.overlapMode))){const pe=Z[q],Q=Z[q+1],ce=Z[q+2];if(b.push({key:se,x1:pe-ce,y1:Q-ce,x2:pe+ce,y2:Q+ce}),M)return!0}}}return!1}_queryCellCircle(t,s,l,c,f,b,w,E){const{circle:A,seenUids:M,overlapMode:k}=w,O=this.boxCells[f];if(O!==null){const Z=this.bboxes;for(const Y of O)if(!M.box[Y]){M.box[Y]=!0;const q=4*Y,se=this.boxKeys[Y];if(this._circleAndRectCollide(A.x,A.y,A.radius,Z[q+0],Z[q+1],Z[q+2],Z[q+3])&&(!E||E(se))&&!si(k,se.overlapMode))return b.push(!0),!0}}const W=this.circleCells[f];if(W!==null){const Z=this.circles;for(const Y of W)if(!M.circle[Y]){M.circle[Y]=!0;const q=3*Y,se=this.circleKeys[Y];if(this._circlesCollide(Z[q],Z[q+1],Z[q+2],A.x,A.y,A.radius)&&(!E||E(se))&&!si(k,se.overlapMode))return b.push(!0),!0}}}_forEachCell(t,s,l,c,f,b,w,E){const A=this._convertToXCellCoord(t),M=this._convertToYCellCoord(s),k=this._convertToXCellCoord(l),O=this._convertToYCellCoord(c);for(let W=A;W<=k;W++)for(let Z=M;Z<=O;Z++)if(f.call(this,t,s,l,c,this.xCellCount*Z+W,b,w,E))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,l,c,f,b){const w=c-t,E=f-s,A=l+b;return A*A>w*w+E*E}_circleAndRectCollide(t,s,l,c,f,b,w){const E=(b-c)/2,A=Math.abs(t-(c+E));if(A>E+l)return!1;const M=(w-f)/2,k=Math.abs(s-(f+M));if(k>M+l)return!1;if(A<=E||k<=M)return!0;const O=A-E,W=k-M;return O*O+W*W<=l*l}}function Pt(p,t,s,l,c){const f=h.F();return t?(h.J(f,f,[1/c,1/c,1]),s||h.ad(f,f,l.angle)):h.K(f,l.labelPlaneMatrix,p),f}function os(p,t,s,l,c){if(t){const f=h.ae(p);return h.J(f,f,[c,c,1]),s||h.ad(f,f,-l.angle),f}return l.glCoordMatrix}function Yi(p,t,s){let l;s?(l=[p.x,p.y,s(p.x,p.y),1],h.af(l,l,t)):(l=[p.x,p.y,0,1],pt(l,l,t));const c=l[3];return{point:new h.P(l[0]/c,l[1]/c),signedDistanceFromCamera:c}}function X(p,t){return .5+p/t*.5}function D(p,t){const s=p[0]/p[3],l=p[1]/p[3];return s>=-t[0]&&s<=t[0]&&l>=-t[1]&&l<=t[1]}function L(p,t,s,l,c,f,b,w,E,A){const M=l?p.textSizeData:p.iconSizeData,k=h.ag(M,s.transform.zoom),O=[256/s.width*2+1,256/s.height*2+1],W=l?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;W.clear();const Z=p.lineVertexArray,Y=l?p.text.placedSymbolArray:p.icon.placedSymbolArray,q=s.transform.width/s.transform.height;let se=!1;for(let pe=0;pe<Y.length;pe++){const Q=Y.get(pe);if(Q.hidden||Q.writingMode===h.ah.vertical&&!se){Se(Q.numGlyphs,W);continue}let ce;if(se=!1,A?(ce=[Q.anchorX,Q.anchorY,A(Q.anchorX,Q.anchorY),1],h.af(ce,ce,t)):(ce=[Q.anchorX,Q.anchorY,0,1],pt(ce,ce,t)),!D(ce,O)){Se(Q.numGlyphs,W);continue}const fe=X(s.transform.cameraToCenterDistance,ce[3]),_e=h.ai(M,k,Q),ve=b?_e/fe:_e*fe,ze=new h.P(Q.anchorX,Q.anchorY),ke=Yi(ze,c,A).point,Be={projections:{},offsets:{}},Ue=oe(Q,ve,!1,w,t,c,f,p.glyphOffsetArray,Z,W,ke,ze,Be,q,E,A);se=Ue.useVertical,(Ue.notEnoughRoom||se||Ue.needsFlipping&&oe(Q,ve,!0,w,t,c,f,p.glyphOffsetArray,Z,W,ke,ze,Be,q,E,A).notEnoughRoom)&&Se(Q.numGlyphs,W)}l?p.text.dynamicLayoutVertexBuffer.updateData(W):p.icon.dynamicLayoutVertexBuffer.updateData(W)}function V(p,t,s,l,c,f,b,w,E,A,M,k,O){const W=w.glyphStartIndex+w.numGlyphs,Z=w.lineStartIndex,Y=w.lineStartIndex+w.lineLength,q=t.getoffsetX(w.glyphStartIndex),se=t.getoffsetX(W-1),pe=Me(p*q,s,l,c,f,b,w.segment,Z,Y,E,A,M,k,O);if(!pe)return null;const Q=Me(p*se,s,l,c,f,b,w.segment,Z,Y,E,A,M,k,O);return Q?{first:pe,last:Q}:null}function H(p,t,s,l){return p===h.ah.horizontal&&Math.abs(s.y-t.y)>Math.abs(s.x-t.x)*l?{useVertical:!0}:(p===h.ah.vertical?t.y<s.y:t.x>s.x)?{needsFlipping:!0}:null}function oe(p,t,s,l,c,f,b,w,E,A,M,k,O,W,Z,Y){const q=t/24,se=p.lineOffsetX*q,pe=p.lineOffsetY*q;let Q;if(p.numGlyphs>1){const ce=p.glyphStartIndex+p.numGlyphs,fe=p.lineStartIndex,_e=p.lineStartIndex+p.lineLength,ve=V(q,w,se,pe,s,M,k,p,E,f,O,Z,Y);if(!ve)return{notEnoughRoom:!0};const ze=Yi(ve.first.point,b,Y).point,ke=Yi(ve.last.point,b,Y).point;if(l&&!s){const Be=H(p.writingMode,ze,ke,W);if(Be)return Be}Q=[ve.first];for(let Be=p.glyphStartIndex+1;Be<ce-1;Be++)Q.push(Me(q*w.getoffsetX(Be),se,pe,s,M,k,p.segment,fe,_e,E,f,O,Z,Y));Q.push(ve.last)}else{if(l&&!s){const fe=Yi(k,c,Y).point,_e=p.lineStartIndex+p.segment+1,ve=new h.P(E.getx(_e),E.gety(_e)),ze=Yi(ve,c,Y),ke=ze.signedDistanceFromCamera>0?ze.point:ae(k,ve,fe,1,c,Y),Be=H(p.writingMode,fe,ke,W);if(Be)return Be}const ce=Me(q*w.getoffsetX(p.glyphStartIndex),se,pe,s,M,k,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,E,f,O,Z,Y);if(!ce)return{notEnoughRoom:!0};Q=[ce]}for(const ce of Q)h.aj(A,ce.point,ce.angle);return{}}function ae(p,t,s,l,c,f){const b=Yi(p.add(p.sub(t)._unit()),c,f).point,w=s.sub(b);return s.add(w._mult(l/w.mag()))}function ue(p,t){const{projectionCache:s,lineVertexArray:l,labelPlaneMatrix:c,tileAnchorPoint:f,distanceFromAnchor:b,getElevation:w,previousVertex:E,direction:A,absOffsetX:M}=t;if(s.projections[p])return s.projections[p];const k=new h.P(l.getx(p),l.gety(p)),O=Yi(k,c,w);if(O.signedDistanceFromCamera>0)return s.projections[p]=O.point,O.point;const W=p-A;return ae(b===0?f:new h.P(l.getx(W),l.gety(W)),k,E,M-b+1,c,w)}function ne(p,t,s){return p._unit()._perp()._mult(t*s)}function de(p,t,s,l,c,f,b,w){const{projectionCache:E,direction:A}=w;if(E.offsets[p])return E.offsets[p];const M=s.add(t);if(p+A<l||p+A>=c)return E.offsets[p]=M,M;const k=ue(p+A,w),O=ne(k.sub(s),b,A),W=s.add(O),Z=k.add(O);return E.offsets[p]=h.ak(f,M,W,Z)||M,E.offsets[p]}function Me(p,t,s,l,c,f,b,w,E,A,M,k,O,W){const Z=l?p-t:p+t;let Y=Z>0?1:-1,q=0;l&&(Y*=-1,q=Math.PI),Y<0&&(q+=Math.PI);let se,pe,Q=Y>0?w+b:w+b+1,ce=c,fe=c,_e=0,ve=0;const ze=Math.abs(Z),ke=[];let Be;for(;_e+ve<=ze;){if(Q+=Y,Q<w||Q>=E)return null;_e+=ve,fe=ce,pe=se;const qe={projectionCache:k,lineVertexArray:A,labelPlaneMatrix:M,tileAnchorPoint:f,distanceFromAnchor:_e,getElevation:W,previousVertex:fe,direction:Y,absOffsetX:ze};if(ce=ue(Q,qe),s===0)ke.push(fe),Be=ce.sub(fe);else{let St;const kt=ce.sub(fe);St=kt.mag()===0?ne(ue(Q+Y,qe).sub(ce),s,Y):ne(kt,s,Y),pe||(pe=fe.add(St)),se=de(Q,St,ce,w,E,pe,s,qe),ke.push(pe),Be=se.sub(pe)}ve=Be.mag()}const Ue=Be._mult((ze-_e)/ve)._add(pe||fe),Mt=q+Math.atan2(ce.y-fe.y,ce.x-fe.x);return ke.push(Ue),{point:Ue,angle:O?Mt:0,path:ke}}const we=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Se(p,t){for(let s=0;s<p;s++){const l=t.length;t.resize(l+4),t.float32.set(we,3*l)}}function pt(p,t,s){const l=t[0],c=t[1];return p[0]=s[0]*l+s[4]*c+s[12],p[1]=s[1]*l+s[5]*c+s[13],p[3]=s[3]*l+s[7]*c+s[15],p}const yt=100;class Ct{constructor(t,s=new $r(t.width+200,t.height+200,25),l=new $r(t.width+200,t.height+200,25)){this.transform=t,this.grid=s,this.ignoredGrid=l,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+yt,this.screenBottomBoundary=t.height+yt,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,s,l,c,f,b){const w=this.projectAndGetPerspectiveRatio(c,t.anchorPointX,t.anchorPointY,b),E=l*w.perspectiveRatio,A=t.x1*E+w.point.x,M=t.y1*E+w.point.y,k=t.x2*E+w.point.x,O=t.y2*E+w.point.y;return!this.isInsideGrid(A,M,k,O)||s!=="always"&&this.grid.hitTest(A,M,k,O,s,f)||w.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[A,M,k,O],offscreen:this.isOffscreen(A,M,k,O)}}placeCollisionCircles(t,s,l,c,f,b,w,E,A,M,k,O,W,Z){const Y=[],q=new h.P(s.anchorX,s.anchorY),se=Yi(q,b,Z),pe=X(this.transform.cameraToCenterDistance,se.signedDistanceFromCamera),Q=(M?f/pe:f*pe)/h.ao,ce=Yi(q,w,Z).point,fe=V(Q,c,s.lineOffsetX*Q,s.lineOffsetY*Q,!1,ce,q,s,l,w,{projections:{},offsets:{}},!1,Z);let _e=!1,ve=!1,ze=!0;if(fe){const ke=.5*O*pe+W,Be=new h.P(-100,-100),Ue=new h.P(this.screenRightBoundary,this.screenBottomBoundary),Mt=new _t,qe=fe.first,St=fe.last;let kt=[];for(let zt=qe.path.length-1;zt>=1;zt--)kt.push(qe.path[zt]);for(let zt=1;zt<St.path.length;zt++)kt.push(St.path[zt]);const Gt=2.5*ke;if(E){const zt=kt.map(Ot=>Yi(Ot,E,Z));kt=zt.some(Ot=>Ot.signedDistanceFromCamera<=0)?[]:zt.map(Ot=>Ot.point)}let Et=[];if(kt.length>0){const zt=kt[0].clone(),Ot=kt[0].clone();for(let Ri=1;Ri<kt.length;Ri++)zt.x=Math.min(zt.x,kt[Ri].x),zt.y=Math.min(zt.y,kt[Ri].y),Ot.x=Math.max(Ot.x,kt[Ri].x),Ot.y=Math.max(Ot.y,kt[Ri].y);Et=zt.x>=Be.x&&Ot.x<=Ue.x&&zt.y>=Be.y&&Ot.y<=Ue.y?[kt]:Ot.x<Be.x||zt.x>Ue.x||Ot.y<Be.y||zt.y>Ue.y?[]:h.al([kt],Be.x,Be.y,Ue.x,Ue.y)}for(const zt of Et){Mt.reset(zt,.25*ke);let Ot=0;Ot=Mt.length<=.5*ke?1:Math.ceil(Mt.paddedLength/Gt)+1;for(let Ri=0;Ri<Ot;Ri++){const ci=Ri/Math.max(Ot-1,1),Gr=Mt.lerp(ci),Qi=Gr.x+yt,Pi=Gr.y+yt;Y.push(Qi,Pi,ke,0);const er=Qi-ke,Hr=Pi-ke,En=Qi+ke,Kn=Pi+ke;if(ze=ze&&this.isOffscreen(er,Hr,En,Kn),ve=ve||this.isInsideGrid(er,Hr,En,Kn),t!=="always"&&this.grid.hitTestCircle(Qi,Pi,ke,t,k)&&(_e=!0,!A))return{circles:[],offscreen:!1,collisionDetected:_e}}}}return{circles:!A&&_e||!ve||pe<this.perspectiveRatioCutoff?[]:Y,offscreen:ze,collisionDetected:_e}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let l=1/0,c=1/0,f=-1/0,b=-1/0;for(const M of t){const k=new h.P(M.x+yt,M.y+yt);l=Math.min(l,k.x),c=Math.min(c,k.y),f=Math.max(f,k.x),b=Math.max(b,k.y),s.push(k)}const w=this.grid.query(l,c,f,b).concat(this.ignoredGrid.query(l,c,f,b)),E={},A={};for(const M of w){const k=M.key;if(E[k.bucketInstanceId]===void 0&&(E[k.bucketInstanceId]={}),E[k.bucketInstanceId][k.featureIndex])continue;const O=[new h.P(M.x1,M.y1),new h.P(M.x2,M.y1),new h.P(M.x2,M.y2),new h.P(M.x1,M.y2)];h.am(s,O)&&(E[k.bucketInstanceId][k.featureIndex]=!0,A[k.bucketInstanceId]===void 0&&(A[k.bucketInstanceId]=[]),A[k.bucketInstanceId].push(k.featureIndex))}return A}insertCollisionBox(t,s,l,c,f,b){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:f,collisionGroupID:b,overlapMode:s},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,l,c,f,b){const w=l?this.ignoredGrid:this.grid,E={bucketInstanceId:c,featureIndex:f,collisionGroupID:b,overlapMode:s};for(let A=0;A<t.length;A+=4)w.insertCircle(E,t[A],t[A+1],t[A+2])}projectAndGetPerspectiveRatio(t,s,l,c){let f;return c?(f=[s,l,c(s,l),1],h.af(f,f,t)):(f=[s,l,0,1],pt(f,f,t)),{point:new h.P((f[0]/f[3]+1)/2*this.transform.width+yt,(-f[1]/f[3]+1)/2*this.transform.height+yt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/f[3]*.5}}isOffscreen(t,s,l,c){return l<yt||t>=this.screenRightBoundary||c<yt||s>this.screenBottomBoundary}isInsideGrid(t,s,l,c){return l>=0&&t<this.gridRightBoundary&&c>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=h.an([]);return h.H(t,t,[-100,-100,0]),t}}function It(p,t,s){return t*(h.W/(p.tileSize*Math.pow(2,s-p.tileID.overscaledZ)))}class jt{constructor(t,s,l,c){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):c&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class hi{constructor(t,s,l,c,f){this.text=new jt(t?t.text:null,s,l,f),this.icon=new jt(t?t.icon:null,s,c,f)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Si{constructor(t,s,l){this.text=t,this.icon=s,this.skipFade=l}}class $i{constructor(){this.invProjMatrix=h.F(),this.viewportMatrix=h.F(),this.circles=[]}}class Dt{constructor(t,s,l,c,f){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=l,this.bucketIndex=c,this.tileID=f}}class ki{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:l=>l.collisionGroupID===s}}return this.collisionGroups[t]}}function Ji(p,t,s,l,c){const{horizontalAlign:f,verticalAlign:b}=h.at(p);return new h.P(-(f-.5)*t+l[0]*c,-(b-.5)*s+l[1]*c)}function br(p,t,s,l,c,f){const{x1:b,x2:w,y1:E,y2:A,anchorPointX:M,anchorPointY:k}=p,O=new h.P(t,s);return l&&O._rotate(c?f:-f),{x1:b+O.x,y1:E+O.y,x2:w+O.x,y2:A+O.y,anchorPointX:M,anchorPointY:k}}class kr{constructor(t,s,l,c,f){this.transform=t.clone(),this.terrain=s,this.collisionIndex=new Ct(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new ki(c),this.collisionCircleArrays={},this.prevPlacement=f,f&&(f.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,s,l,c){const f=l.getBucket(s),b=l.latestFeatureIndex;if(!f||!b||s.id!==f.layerIds[0])return;const w=l.collisionBoxArray,E=f.layers[0].layout,A=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),M=l.tileSize/h.W,k=this.transform.calculatePosMatrix(l.tileID.toUnwrapped()),O=E.get("text-pitch-alignment")==="map",W=E.get("text-rotation-alignment")==="map",Z=It(l,1,this.transform.zoom),Y=Pt(k,O,W,this.transform,Z);let q=null;if(O){const pe=os(k,O,W,this.transform,Z);q=h.K([],this.transform.labelPlaneMatrix,pe)}this.retainedQueryData[f.bucketInstanceId]=new Dt(f.bucketInstanceId,b,f.sourceLayerIndex,f.index,l.tileID);const se={bucket:f,layout:E,posMatrix:k,textLabelPlaneMatrix:Y,labelToScreenMatrix:q,scale:A,textPixelRatio:M,holdingForFade:l.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:h.ag(f.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(f.sourceID)};if(c)for(const pe of f.sortKeyRanges){const{sortKey:Q,symbolInstanceStart:ce,symbolInstanceEnd:fe}=pe;t.push({sortKey:Q,symbolInstanceStart:ce,symbolInstanceEnd:fe,parameters:se})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:f.symbolInstances.length,parameters:se})}attemptAnchorPlacement(t,s,l,c,f,b,w,E,A,M,k,O,W,Z,Y,q){const se=h.ap[t.textAnchor],pe=[t.textOffset0,t.textOffset1],Q=Ji(se,l,c,pe,f),ce=this.collisionIndex.placeCollisionBox(br(s,Q.x,Q.y,b,w,this.transform.angle),k,E,A,M.predicate,q);if((!Y||this.collisionIndex.placeCollisionBox(br(Y,Q.x,Q.y,b,w,this.transform.angle),k,E,A,M.predicate,q).box.length!==0)&&ce.box.length>0){let fe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID].text&&(fe=this.prevPlacement.variableOffsets[O.crossTileID].anchor),O.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[O.crossTileID]={textOffset:pe,width:l,height:c,anchor:se,textBoxScale:f,prevAnchor:fe},this.markUsedJustification(W,se,O,Z),W.allowVerticalPlacement&&(this.markUsedOrientation(W,Z,O),this.placedOrientations[O.crossTileID]=Z),{shift:Q,placedGlyphBoxes:ce}}}placeLayerBucketPart(t,s,l){const{bucket:c,layout:f,posMatrix:b,textLabelPlaneMatrix:w,labelToScreenMatrix:E,textPixelRatio:A,holdingForFade:M,collisionBoxArray:k,partiallyEvaluatedTextSize:O,collisionGroup:W}=t.parameters,Z=f.get("text-optional"),Y=f.get("icon-optional"),q=h.aq(f,"text-overlap","text-allow-overlap"),se=q==="always",pe=h.aq(f,"icon-overlap","icon-allow-overlap"),Q=pe==="always",ce=f.get("text-rotation-alignment")==="map",fe=f.get("text-pitch-alignment")==="map",_e=f.get("icon-text-fit")!=="none",ve=f.get("symbol-z-order")==="viewport-y",ze=se&&(Q||!c.hasIconData()||Y),ke=Q&&(se||!c.hasTextData()||Z);!c.collisionArrays&&k&&c.deserializeCollisionBoxes(k);const Be=this.retainedQueryData[c.bucketInstanceId].tileID,Ue=this.terrain?(qe,St)=>this.terrain.getElevation(Be,qe,St):null,Mt=(qe,St)=>{var kt,Gt;if(s[qe.crossTileID])return;if(M)return void(this.placements[qe.crossTileID]=new Si(!1,!1,!1));let Et=!1,zt=!1,Ot=!0,Ri=null,ci={box:null,offscreen:null},Gr={box:null,offscreen:null},Qi=null,Pi=null,er=null,Hr=0,En=0,Kn=0;St.textFeatureIndex?Hr=St.textFeatureIndex:qe.useRuntimeCollisionCircles&&(Hr=qe.featureIndex),St.verticalTextFeatureIndex&&(En=St.verticalTextFeatureIndex);const Mo=St.textBox;if(Mo){const ji=qi=>{let Mi=h.ah.horizontal;if(c.allowVerticalPlacement&&!qi&&this.prevPlacement){const sn=this.prevPlacement.placedOrientations[qe.crossTileID];sn&&(this.placedOrientations[qe.crossTileID]=sn,Mi=sn,this.markUsedOrientation(c,Mi,qe))}return Mi},Ci=(qi,Mi)=>{if(c.allowVerticalPlacement&&qe.numVerticalGlyphVertices>0&&St.verticalTextBox){for(const sn of c.writingModes)if(sn===h.ah.vertical?(ci=Mi(),Gr=ci):ci=qi(),ci&&ci.box&&ci.box.length)break}else ci=qi()},Ei=qe.textAnchorOffsetStartIndex,nn=qe.textAnchorOffsetEndIndex;if(nn===Ei){const qi=(Mi,sn)=>{const Gi=this.collisionIndex.placeCollisionBox(Mi,q,A,b,W.predicate,Ue);return Gi&&Gi.box&&Gi.box.length&&(this.markUsedOrientation(c,sn,qe),this.placedOrientations[qe.crossTileID]=sn),Gi};Ci(()=>qi(Mo,h.ah.horizontal),()=>{const Mi=St.verticalTextBox;return c.allowVerticalPlacement&&qe.numVerticalGlyphVertices>0&&Mi?qi(Mi,h.ah.vertical):{box:null,offscreen:null}}),ji(ci&&ci.box&&ci.box.length)}else{let qi=h.ap[(Gt=(kt=this.prevPlacement)===null||kt===void 0?void 0:kt.variableOffsets[qe.crossTileID])===null||Gt===void 0?void 0:Gt.anchor];const Mi=(Gi,Oi,Nl)=>{const xu=Gi.x2-Gi.x1,ms=Gi.y2-Gi.y1,gs=qe.textBoxScale,ka=_e&&pe==="never"?Oi:null;let Yn={box:[],offscreen:!1},Vl=q==="never"?1:2,vu="never";qi&&Vl++;for(let $l=0;$l<Vl;$l++){for(let Ul=Ei;Ul<nn;Ul++){const Da=c.textAnchorOffsets.get(Ul);if(qi&&Da.textAnchor!==qi)continue;const jl=this.attemptAnchorPlacement(Da,Gi,xu,ms,gs,ce,fe,A,b,W,vu,qe,c,Nl,ka,Ue);if(jl&&(Yn=jl.placedGlyphBoxes,Yn&&Yn.box&&Yn.box.length))return Et=!0,Ri=jl.shift,Yn}qi?qi=null:vu=q}return Yn};Ci(()=>Mi(Mo,St.iconBox,h.ah.horizontal),()=>{const Gi=St.verticalTextBox;return c.allowVerticalPlacement&&!(ci&&ci.box&&ci.box.length)&&qe.numVerticalGlyphVertices>0&&Gi?Mi(Gi,St.verticalIconBox,h.ah.vertical):{box:null,offscreen:null}}),ci&&(Et=ci.box,Ot=ci.offscreen);const sn=ji(ci&&ci.box);if(!Et&&this.prevPlacement){const Gi=this.prevPlacement.variableOffsets[qe.crossTileID];Gi&&(this.variableOffsets[qe.crossTileID]=Gi,this.markUsedJustification(c,Gi.anchor,qe,sn))}}}if(Qi=ci,Et=Qi&&Qi.box&&Qi.box.length>0,Ot=Qi&&Qi.offscreen,qe.useRuntimeCollisionCircles){const ji=c.text.placedSymbolArray.get(qe.centerJustifiedTextSymbolIndex),Ci=h.ai(c.textSizeData,O,ji),Ei=f.get("text-padding");Pi=this.collisionIndex.placeCollisionCircles(q,ji,c.lineVertexArray,c.glyphOffsetArray,Ci,b,w,E,l,fe,W.predicate,qe.collisionCircleDiameter,Ei,Ue),Pi.circles.length&&Pi.collisionDetected&&!l&&h.w("Collisions detected, but collision boxes are not shown"),Et=se||Pi.circles.length>0&&!Pi.collisionDetected,Ot=Ot&&Pi.offscreen}if(St.iconFeatureIndex&&(Kn=St.iconFeatureIndex),St.iconBox){const ji=Ci=>{const Ei=_e&&Ri?br(Ci,Ri.x,Ri.y,ce,fe,this.transform.angle):Ci;return this.collisionIndex.placeCollisionBox(Ei,pe,A,b,W.predicate,Ue)};Gr&&Gr.box&&Gr.box.length&&St.verticalIconBox?(er=ji(St.verticalIconBox),zt=er.box.length>0):(er=ji(St.iconBox),zt=er.box.length>0),Ot=Ot&&er.offscreen}const Xn=Z||qe.numHorizontalGlyphVertices===0&&qe.numVerticalGlyphVertices===0,In=Y||qe.numIconVertices===0;if(Xn||In?In?Xn||(zt=zt&&Et):Et=zt&&Et:zt=Et=zt&&Et,Et&&Qi&&Qi.box&&this.collisionIndex.insertCollisionBox(Qi.box,q,f.get("text-ignore-placement"),c.bucketInstanceId,Gr&&Gr.box&&En?En:Hr,W.ID),zt&&er&&this.collisionIndex.insertCollisionBox(er.box,pe,f.get("icon-ignore-placement"),c.bucketInstanceId,Kn,W.ID),Pi&&(Et&&this.collisionIndex.insertCollisionCircles(Pi.circles,q,f.get("text-ignore-placement"),c.bucketInstanceId,Hr,W.ID),l)){const ji=c.bucketInstanceId;let Ci=this.collisionCircleArrays[ji];Ci===void 0&&(Ci=this.collisionCircleArrays[ji]=new $i);for(let Ei=0;Ei<Pi.circles.length;Ei+=4)Ci.circles.push(Pi.circles[Ei+0]),Ci.circles.push(Pi.circles[Ei+1]),Ci.circles.push(Pi.circles[Ei+2]),Ci.circles.push(Pi.collisionDetected?1:0)}if(qe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(c.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[qe.crossTileID]=new Si(Et||ze,zt||ke,Ot||c.justReloaded),s[qe.crossTileID]=!0};if(ve){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const qe=c.getSortedSymbolIndexes(this.transform.angle);for(let St=qe.length-1;St>=0;--St){const kt=qe[St];Mt(c.symbolInstances.get(kt),c.collisionArrays[kt])}}else for(let qe=t.symbolInstanceStart;qe<t.symbolInstanceEnd;qe++)Mt(c.symbolInstances.get(qe),c.collisionArrays[qe]);if(l&&c.bucketInstanceId in this.collisionCircleArrays){const qe=this.collisionCircleArrays[c.bucketInstanceId];h.ar(qe.invProjMatrix,b),qe.viewportMatrix=this.collisionIndex.getViewportMatrix()}c.justReloaded=!1}markUsedJustification(t,s,l,c){let f;f=c===h.ah.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[h.as(s)];const b=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const w of b)w>=0&&(t.text.placedSymbolArray.get(w).crossTileID=f>=0&&w!==f?0:l.crossTileID)}markUsedOrientation(t,s,l){const c=s===h.ah.horizontal||s===h.ah.horizontalOnly?s:0,f=s===h.ah.vertical?s:0,b=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const w of b)t.text.placedSymbolArray.get(w).placedOrientation=c;l.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=f)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let l=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const c=s?s.symbolFadeChange(t):1,f=s?s.opacities:{},b=s?s.variableOffsets:{},w=s?s.placedOrientations:{};for(const E in this.placements){const A=this.placements[E],M=f[E];M?(this.opacities[E]=new hi(M,c,A.text,A.icon),l=l||A.text!==M.text.placed||A.icon!==M.icon.placed):(this.opacities[E]=new hi(null,c,A.text,A.icon,A.skipFade),l=l||A.text||A.icon)}for(const E in f){const A=f[E];if(!this.opacities[E]){const M=new hi(A,c,!1,!1);M.isHidden()||(this.opacities[E]=M,l=l||A.text.placed||A.icon.placed)}}for(const E in b)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=b[E]);for(const E in w)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=w[E]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s){const l={};for(const c of s){const f=c.getBucket(t);f&&c.latestFeatureIndex&&t.id===f.layerIds[0]&&this.updateBucketOpacities(f,l,c.collisionBoxArray)}}updateBucketOpacities(t,s,l){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const c=t.layers[0],f=c.layout,b=new hi(null,0,!1,!1,!0),w=f.get("text-allow-overlap"),E=f.get("icon-allow-overlap"),A=c._unevaluatedLayout.hasValue("text-variable-anchor")||c._unevaluatedLayout.hasValue("text-variable-anchor-offset"),M=f.get("text-rotation-alignment")==="map",k=f.get("text-pitch-alignment")==="map",O=f.get("icon-text-fit")!=="none",W=new hi(null,0,w&&(E||!t.hasIconData()||f.get("icon-optional")),E&&(w||!t.hasTextData()||f.get("text-optional")),!0);!t.collisionArrays&&l&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(l);const Z=(Y,q,se)=>{for(let pe=0;pe<q/4;pe++)Y.opacityVertexArray.emplaceBack(se);Y.hasVisibleVertices=Y.hasVisibleVertices||se!==ao};for(let Y=0;Y<t.symbolInstances.length;Y++){const q=t.symbolInstances.get(Y),{numHorizontalGlyphVertices:se,numVerticalGlyphVertices:pe,crossTileID:Q}=q;let ce=this.opacities[Q];s[Q]?ce=b:ce||(ce=W,this.opacities[Q]=ce),s[Q]=!0;const fe=q.numIconVertices>0,_e=this.placedOrientations[q.crossTileID],ve=_e===h.ah.vertical,ze=_e===h.ah.horizontal||_e===h.ah.horizontalOnly;if(se>0||pe>0){const ke=Dr(ce.text);Z(t.text,se,ve?ao:ke),Z(t.text,pe,ze?ao:ke);const Be=ce.text.isHidden();[q.rightJustifiedTextSymbolIndex,q.centerJustifiedTextSymbolIndex,q.leftJustifiedTextSymbolIndex].forEach(qe=>{qe>=0&&(t.text.placedSymbolArray.get(qe).hidden=Be||ve?1:0)}),q.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(q.verticalPlacedTextSymbolIndex).hidden=Be||ze?1:0);const Ue=this.variableOffsets[q.crossTileID];Ue&&this.markUsedJustification(t,Ue.anchor,q,_e);const Mt=this.placedOrientations[q.crossTileID];Mt&&(this.markUsedJustification(t,"left",q,Mt),this.markUsedOrientation(t,Mt,q))}if(fe){const ke=Dr(ce.icon),Be=!(O&&q.verticalPlacedIconSymbolIndex&&ve);q.placedIconSymbolIndex>=0&&(Z(t.icon,q.numIconVertices,Be?ke:ao),t.icon.placedSymbolArray.get(q.placedIconSymbolIndex).hidden=ce.icon.isHidden()),q.verticalPlacedIconSymbolIndex>=0&&(Z(t.icon,q.numVerticalIconVertices,Be?ao:ke),t.icon.placedSymbolArray.get(q.verticalPlacedIconSymbolIndex).hidden=ce.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const ke=t.collisionArrays[Y];if(ke){let Be=new h.P(0,0);if(ke.textBox||ke.verticalTextBox){let Mt=!0;if(A){const qe=this.variableOffsets[Q];qe?(Be=Ji(qe.anchor,qe.width,qe.height,qe.textOffset,qe.textBoxScale),M&&Be._rotate(k?this.transform.angle:-this.transform.angle)):Mt=!1}ke.textBox&&lr(t.textCollisionBox.collisionVertexArray,ce.text.placed,!Mt||ve,Be.x,Be.y),ke.verticalTextBox&&lr(t.textCollisionBox.collisionVertexArray,ce.text.placed,!Mt||ze,Be.x,Be.y)}const Ue=!!(!ze&&ke.verticalIconBox);ke.iconBox&&lr(t.iconCollisionBox.collisionVertexArray,ce.icon.placed,Ue,O?Be.x:0,O?Be.y:0),ke.verticalIconBox&&lr(t.iconCollisionBox.collisionVertexArray,ce.icon.placed,!Ue,O?Be.x:0,O?Be.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const Y=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=Y.invProjMatrix,t.placementViewportMatrix=Y.viewportMatrix,t.collisionCircleArray=Y.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const l=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*l>t}setStale(){this.stale=!0}}function lr(p,t,s,l,c){p.emplaceBack(t?1:0,s?1:0,l||0,c||0),p.emplaceBack(t?1:0,s?1:0,l||0,c||0),p.emplaceBack(t?1:0,s?1:0,l||0,c||0),p.emplaceBack(t?1:0,s?1:0,l||0,c||0)}const vn=Math.pow(2,25),Fc=Math.pow(2,24),Nh=Math.pow(2,17),ai=Math.pow(2,16),al=Math.pow(2,9),ll=Math.pow(2,8),Ur=Math.pow(2,1);function Dr(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const t=p.placed?1:0,s=Math.floor(127*p.opacity);return s*vn+t*Fc+s*Nh+t*ai+s*al+t*ll+s*Ur+t}const ao=0;class tn{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,s,l,c,f){const b=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(b,c,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,f())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort((w,E)=>w.sortKey-E.sortKey));this._currentPartIndex<b.length;)if(s.placeLayerBucketPart(b[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,f())return!0;return!1}}class rn{constructor(t,s,l,c,f,b,w,E){this.placement=new kr(t,s,b,w,E),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=f,this._done=!1}isDone(){return this._done}continuePlacement(t,s,l){const c=N.now(),f=()=>!this._forceFullPlacement&&N.now()-c>2;for(;this._currentPlacementIndex>=0;){const b=s[t[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(b.type==="symbol"&&(!b.minzoom||b.minzoom<=w)&&(!b.maxzoom||b.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new tn(b)),this._inProgressLayer.continuePlacement(l[b.source],this.placement,this._showCollisionBoxes,b,f))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const As=512/h.W/2;class Ho{constructor(t,s,l){this.tileID=t,this.bucketInstanceId=l,this._symbolsByKey={};const c=new Map;for(let f=0;f<s.length;f++){const b=s.get(f),w=b.key,E=c.get(w);E?E.push(b):c.set(w,[b])}for(const[f,b]of c){const w={positions:b.map(E=>({x:Math.floor(E.anchorX*As),y:Math.floor(E.anchorY*As)})),crossTileIDs:b.map(E=>E.crossTileID)};if(w.positions.length>128){const E=new h.au(w.positions.length,16,Uint16Array);for(const{x:A,y:M}of w.positions)E.add(A,M);E.finish(),delete w.positions,w.index=E}this._symbolsByKey[f]=w}}getScaledCoordinates(t,s){const{x:l,y:c,z:f}=this.tileID.canonical,{x:b,y:w,z:E}=s.canonical,A=As/Math.pow(2,E-f),M=(w*h.W+t.anchorY)*A,k=c*h.W*As;return{x:Math.floor((b*h.W+t.anchorX)*A-l*h.W*As),y:Math.floor(M-k)}}findMatches(t,s,l){const c=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let f=0;f<t.length;f++){const b=t.get(f);if(b.crossTileID)continue;const w=this._symbolsByKey[b.key];if(!w)continue;const E=this.getScaledCoordinates(b,s);if(w.index){const A=w.index.range(E.x-c,E.y-c,E.x+c,E.y+c).sort();for(const M of A){const k=w.crossTileIDs[M];if(!l[k]){l[k]=!0,b.crossTileID=k;break}}}else if(w.positions)for(let A=0;A<w.positions.length;A++){const M=w.positions[A],k=w.crossTileIDs[A];if(Math.abs(M.x-E.x)<=c&&Math.abs(M.y-E.y)<=c&&!l[k]){l[k]=!0,b.crossTileID=k;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class Ui{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class lo{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const l in this.indexes){const c=this.indexes[l],f={};for(const b in c){const w=c[b];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+s),f[w.tileID.key]=w}this.indexes[l]=f}this.lng=t}addBucket(t,s,l){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let f=0;f<s.symbolInstances.length;f++)s.symbolInstances.get(f).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const c=this.usedCrossTileIDs[t.overscaledZ];for(const f in this.indexes){const b=this.indexes[f];if(Number(f)>t.overscaledZ)for(const w in b){const E=b[w];E.tileID.isChildOf(t)&&E.findMatches(s.symbolInstances,t,c)}else{const w=b[t.scaledTo(Number(f)).key];w&&w.findMatches(s.symbolInstances,t,c)}}for(let f=0;f<s.symbolInstances.length;f++){const b=s.symbolInstances.get(f);b.crossTileID||(b.crossTileID=l.generate(),c[b.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ho(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const l of s.getCrossTileIDsLists())for(const c of l)delete this.usedCrossTileIDs[t][c]}removeStaleBuckets(t){let s=!1;for(const l in this.indexes){const c=this.indexes[l];for(const f in c)t[c[f].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,c[f]),delete c[f],s=!0)}return s}}class jn{constructor(){this.layerIndexes={},this.crossTileIDs=new Ui,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,l){let c=this.layerIndexes[t.id];c===void 0&&(c=this.layerIndexes[t.id]=new lo);let f=!1;const b={};c.handleWrapJump(l);for(const w of s){const E=w.getBucket(t);E&&t.id===E.layerIds[0]&&(E.bucketInstanceId||(E.bucketInstanceId=++this.maxBucketInstanceId),c.addBucket(w.tileID,E,this.crossTileIDs)&&(f=!0),b[E.bucketInstanceId]=!0)}return c.removeStaleBuckets(b)&&(f=!0),f}pruneUnusedLayers(t){const s={};t.forEach(l=>{s[l]=!0});for(const l in this.layerIndexes)s[l]||delete this.layerIndexes[l]}}const Ai=(p,t)=>h.t(p,t&&t.filter(s=>s.identifier!=="source.canvas")),Zo=h.av();class jr extends h.E{constructor(t,s={}){super(),this._rtlPluginLoaded=()=>{for(const l in this.sourceCaches){const c=this.sourceCaches[l].getSource().type;c!=="vector"&&c!=="geojson"||this.sourceCaches[l].reload()}},this.map=t,this.dispatcher=new it(Pe(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",(l,c)=>this.getGlyphs(l,c)),this.dispatcher.registerMessageHandler("GI",(l,c)=>this.getImages(l,c)),this.imageManager=new ri,this.imageManager.setEventedParent(this),this.glyphManager=new Ft(t._requestManager,s.localIdeographFontFamily),this.lineAtlas=new vi(256,512),this.crossTileSymbolIndex=new jn,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new h.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",h.ax()),Ce().on(Tt,this._rtlPluginLoaded),this.on("data",l=>{if(l.dataType!=="source"||l.sourceDataType!=="metadata")return;const c=this.sourceCaches[l.sourceId];if(!c)return;const f=c.getSource();if(f&&f.vectorLayerIds)for(const b in this._layers){const w=this._layers[b];w.source===f.id&&this._validateLayer(w)}})}loadURL(t,s={},l){this.fire(new h.k("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const c=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController,h.h(c,this._loadStyleRequest).then(f=>{this._loadStyleRequest=null,this._load(f.data,s,l)}).catch(f=>{this._loadStyleRequest=null,f&&this.fire(new h.j(f))})}loadJSON(t,s={},l){this.fire(new h.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,N.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,s.validate=s.validate!==!1,this._load(t,s,l)}).catch(()=>{})}loadEmpty(){this.fire(new h.k("dataloading",{dataType:"style"})),this._load(Zo,{validate:!1})}_load(t,s,l){var c;const f=s.transformStyle?s.transformStyle(l,t):t;if(!s.validate||!Ai(this,h.x(f))){this._loaded=!0,this.stylesheet=f;for(const b in f.sources)this.addSource(b,f.sources[b],{validate:!1});f.sprite?this._loadSprite(f.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(f.glyphs),this._createLayers(),this.light=new vr(this.stylesheet.light),this.map.setTerrain((c=this.stylesheet.terrain)!==null&&c!==void 0?c:null),this.fire(new h.k("data",{dataType:"style"})),this.fire(new h.k("style.load"))}}_createLayers(){const t=h.ay(this.stylesheet.layers);this.dispatcher.broadcast("SL",t),this._order=t.map(s=>s.id),this._layers={},this._serializedLayers=null;for(const s of t){const l=h.az(s);l.setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=l}}_loadSprite(t,s=!1,l=void 0){let c;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(f,b,w,E){return h._(this,void 0,void 0,function*(){const A=bt(f),M=w>1?"@2x":"",k={},O={};for(const{id:W,url:Z}of A){const Y=b.transformRequest(b.normalizeSpriteURL(Z,M,".json"),"SpriteJSON");k[W]=h.h(Y,E);const q=b.transformRequest(b.normalizeSpriteURL(Z,M,".png"),"SpriteImage");O[W]=me.getImage(q,E)}return yield Promise.all([...Object.values(k),...Object.values(O)]),function(W,Z){return h._(this,void 0,void 0,function*(){const Y={};for(const q in W){Y[q]={};const se=N.getImageCanvasContext((yield Z[q]).data),pe=(yield W[q]).data;for(const Q in pe){const{width:ce,height:fe,x:_e,y:ve,sdf:ze,pixelRatio:ke,stretchX:Be,stretchY:Ue,content:Mt}=pe[Q];Y[q][Q]={data:null,pixelRatio:ke,sdf:ze,stretchX:Be,stretchY:Ue,content:Mt,spriteData:{width:ce,height:fe,x:_e,y:ve,context:se}}}}return Y})}(k,O)})}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(f=>{if(this._spriteRequest=null,f)for(const b in f){this._spritesImagesIds[b]=[];const w=this._spritesImagesIds[b]?this._spritesImagesIds[b].filter(E=>!(E in f)):[];for(const E of w)this.imageManager.removeImage(E),this._changedImages[E]=!0;for(const E in f[b]){const A=b==="default"?E:`${b}:${E}`;this._spritesImagesIds[b].push(A),A in this.imageManager.images?this.imageManager.updateImage(A,f[b][E],!1):this.imageManager.addImage(A,f[b][E]),s&&(this._changedImages[A]=!0)}}}).catch(f=>{this._spriteRequest=null,c=f,this.fire(new h.j(c))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.k("data",{dataType:"style"})),l&&l(c)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.k("data",{dataType:"style"}))}_validateLayer(t){const s=this.sourceCaches[t.source];if(!s)return;const l=t.sourceLayer;if(!l)return;const c=s.getSource();(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(l)===-1)&&this.fire(new h.j(new Error(`Source layer "${l}" does not exist on source "${c.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const s=this._serializedAllLayers();if(!t||t.length===0)return Object.values(s);const l=[];for(const c of t)s[c]&&l.push(s[c]);return l}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const s=Object.keys(this._layers);for(const l of s){const c=this._layers[l];c.type!=="custom"&&(t[l]=c.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const s=this._changed;if(s){const c=Object.keys(this._updatedLayers),f=Object.keys(this._removedLayers);(c.length||f.length)&&this._updateWorkerLayers(c,f);for(const b in this._updatedSources){const w=this._updatedSources[b];if(w==="reload")this._reloadSource(b);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(b)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const b in this._updatedPaintProps)this._layers[b].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const l={};for(const c in this.sourceCaches){const f=this.sourceCaches[c];l[c]=f.used,f.used=!1}for(const c of this._order){const f=this._layers[c];f.recalculate(t,this._availableImages),!f.isHidden(t.zoom)&&f.source&&(this.sourceCaches[f.source].used=!0)}for(const c in l){const f=this.sourceCaches[c];!!l[c]!=!!f.used&&f.fire(new h.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:c}))}this.light.recalculate(t),this.z=t.zoom,s&&this.fire(new h.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,s){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,s={}){var l;this._checkLoaded();const c=this.serialize();if(t=s.transformStyle?s.transformStyle(c,t):t,((l=s.validate)===null||l===void 0||l)&&Ai(this,h.x(t)))return!1;(t=h.aA(t)).layers=h.ay(t.layers);const f=h.aB(c,t),b=this._getOperationsToPerform(f);if(b.unimplemented.length>0)throw new Error(`Unimplemented: ${b.unimplemented.join(", ")}.`);if(b.operations.length===0)return!1;for(const w of b.operations)w();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const s=[],l=[];for(const c of t)switch(c.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":s.push(()=>this.addLayer.apply(this,c.args));break;case"removeLayer":s.push(()=>this.removeLayer.apply(this,c.args));break;case"setPaintProperty":s.push(()=>this.setPaintProperty.apply(this,c.args));break;case"setLayoutProperty":s.push(()=>this.setLayoutProperty.apply(this,c.args));break;case"setFilter":s.push(()=>this.setFilter.apply(this,c.args));break;case"addSource":s.push(()=>this.addSource.apply(this,c.args));break;case"removeSource":s.push(()=>this.removeSource.apply(this,c.args));break;case"setLayerZoomRange":s.push(()=>this.setLayerZoomRange.apply(this,c.args));break;case"setLight":s.push(()=>this.setLight.apply(this,c.args));break;case"setGeoJSONSourceData":s.push(()=>this.setGeoJSONSourceData.apply(this,c.args));break;case"setGlyphs":s.push(()=>this.setGlyphs.apply(this,c.args));break;case"setSprite":s.push(()=>this.setSprite.apply(this,c.args));break;case"setTerrain":s.push(()=>this.map.setTerrain.apply(this,c.args));break;case"setTransition":s.push(()=>{});break;default:l.push(c.command)}return{operations:s,unimplemented:l}}addImage(t,s){if(this.getImage(t))return this.fire(new h.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,s),this._afterImageUpdated(t)}updateImage(t,s){this.imageManager.updateImage(t,s)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new h.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,s,l={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(h.x.source,`sources.${t}`,s,null,l))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const c=this.sourceCaches[t]=new Xi(t,s,this.dispatcher);c.style=this,c.setEventedParent(this,()=>({isSourceLoaded:c.loaded(),source:c.serialize(),sourceId:t})),c.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===t)return this.fire(new h.j(new Error(`Source "${t}" cannot be removed while layer "${l}" is using it.`)));const s=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],s.fire(new h.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,s){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const l=this.sourceCaches[t].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(s),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,s,l={}){this._checkLoaded();const c=t.id;if(this.getLayer(c))return void this.fire(new h.j(new Error(`Layer "${c}" already exists on this map.`)));let f;if(t.type==="custom"){if(Ai(this,h.aC(t)))return;f=h.az(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(c,t.source),t=h.aA(t),t=h.e(t,{source:c})),this._validate(h.x.layer,`layers.${c}`,t,{arrayIndex:-1},l))return;f=h.az(t),this._validateLayer(f),f.setEventedParent(this,{layer:{id:c}})}const b=s?this._order.indexOf(s):this._order.length;if(s&&b===-1)this.fire(new h.j(new Error(`Cannot add layer "${c}" before non-existing layer "${s}".`)));else{if(this._order.splice(b,0,c),this._layerOrderChanged=!0,this._layers[c]=f,this._removedLayers[c]&&f.source&&f.type!=="custom"){const w=this._removedLayers[c];delete this._removedLayers[c],w.type!==f.type?this._updatedSources[f.source]="clear":(this._updatedSources[f.source]="reload",this.sourceCaches[f.source].pause())}this._updateLayer(f),f.onAdd&&f.onAdd(this.map)}}moveLayer(t,s){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new h.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===s)return;const l=this._order.indexOf(t);this._order.splice(l,1);const c=s?this._order.indexOf(s):this._order.length;s&&c===-1?this.fire(new h.j(new Error(`Cannot move layer "${t}" before non-existing layer "${s}".`))):(this._order.splice(c,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const s=this._layers[t];if(!s)return void this.fire(new h.j(new Error(`Cannot remove non-existing layer "${t}".`)));s.setEventedParent(null);const l=this._order.indexOf(t);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=s,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],s.onRemove&&s.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,s,l){this._checkLoaded();const c=this.getLayer(t);c?c.minzoom===s&&c.maxzoom===l||(s!=null&&(c.minzoom=s),l!=null&&(c.maxzoom=l),this._updateLayer(c)):this.fire(new h.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,s,l={}){this._checkLoaded();const c=this.getLayer(t);if(c){if(!h.aD(c.filter,s))return s==null?(c.filter=void 0,void this._updateLayer(c)):void(this._validate(h.x.filter,`layers.${c.id}.filter`,s,null,l)||(c.filter=h.aA(s),this._updateLayer(c)))}else this.fire(new h.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return h.aA(this.getLayer(t).filter)}setLayoutProperty(t,s,l,c={}){this._checkLoaded();const f=this.getLayer(t);f?h.aD(f.getLayoutProperty(s),l)||(f.setLayoutProperty(s,l,c),this._updateLayer(f)):this.fire(new h.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,s){const l=this.getLayer(t);if(l)return l.getLayoutProperty(s);this.fire(new h.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,s,l,c={}){this._checkLoaded();const f=this.getLayer(t);f?h.aD(f.getPaintProperty(s),l)||(f.setPaintProperty(s,l,c)&&this._updateLayer(f),this._changed=!0,this._updatedPaintProps[t]=!0,this._serializedLayers=null):this.fire(new h.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,s){return this.getLayer(t).getPaintProperty(s)}setFeatureState(t,s){this._checkLoaded();const l=t.source,c=t.sourceLayer,f=this.sourceCaches[l];if(f===void 0)return void this.fire(new h.j(new Error(`The source '${l}' does not exist in the map's style.`)));const b=f.getSource().type;b==="geojson"&&c?this.fire(new h.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):b!=="vector"||c?(t.id===void 0&&this.fire(new h.j(new Error("The feature id parameter must be provided."))),f.setFeatureState(c,t.id,s)):this.fire(new h.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,s){this._checkLoaded();const l=t.source,c=this.sourceCaches[l];if(c===void 0)return void this.fire(new h.j(new Error(`The source '${l}' does not exist in the map's style.`)));const f=c.getSource().type,b=f==="vector"?t.sourceLayer:void 0;f!=="vector"||b?s&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new h.j(new Error("A feature id is required to remove its specific state property."))):c.removeFeatureState(b,t.id,s):this.fire(new h.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const s=t.source,l=t.sourceLayer,c=this.sourceCaches[s];if(c!==void 0)return c.getSource().type!=="vector"||l?(t.id===void 0&&this.fire(new h.j(new Error("The feature id parameter must be provided."))),c.getFeatureState(l,t.id)):void this.fire(new h.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new h.j(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return h.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=h.aE(this.sourceCaches,f=>f.serialize()),s=this._serializeByIds(this._order),l=this.map.getTerrain()||void 0,c=this.stylesheet;return h.aF({version:c.version,name:c.name,metadata:c.metadata,light:c.light,center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,sprite:c.sprite,glyphs:c.glyphs,transition:c.transition,sources:t,layers:s,terrain:l},f=>f!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const s=b=>this._layers[b].type==="fill-extrusion",l={},c=[];for(let b=this._order.length-1;b>=0;b--){const w=this._order[b];if(s(w)){l[w]=b;for(const E of t){const A=E[w];if(A)for(const M of A)c.push(M)}}}c.sort((b,w)=>w.intersectionZ-b.intersectionZ);const f=[];for(let b=this._order.length-1;b>=0;b--){const w=this._order[b];if(s(w))for(let E=c.length-1;E>=0;E--){const A=c[E].feature;if(l[A.layer.id]<b)break;f.push(A),c.pop()}else for(const E of t){const A=E[w];if(A)for(const M of A)f.push(M.feature)}}return f}queryRenderedFeatures(t,s,l){s&&s.filter&&this._validate(h.x.filter,"queryRenderedFeatures.filter",s.filter,null,s);const c={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new h.j(new Error("parameters.layers must be an Array."))),[];for(const w of s.layers){const E=this._layers[w];if(!E)return this.fire(new h.j(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];c[E.source]=!0}}const f=[];s.availableImages=this._availableImages;const b=this._serializedAllLayers();for(const w in this.sourceCaches)s.layers&&!c[w]||f.push(Kt(this.sourceCaches[w],this._layers,b,t,s,l));return this.placement&&f.push(function(w,E,A,M,k,O,W){const Z={},Y=O.queryRenderedSymbols(M),q=[];for(const se of Object.keys(Y).map(Number))q.push(W[se]);q.sort(Yt);for(const se of q){const pe=se.featureIndex.lookupSymbolFeatures(Y[se.bucketInstanceId],E,se.bucketIndex,se.sourceLayerIndex,k.filter,k.layers,k.availableImages,w);for(const Q in pe){const ce=Z[Q]=Z[Q]||[],fe=pe[Q];fe.sort((_e,ve)=>{const ze=se.featureSortOrder;if(ze){const ke=ze.indexOf(_e.featureIndex);return ze.indexOf(ve.featureIndex)-ke}return ve.featureIndex-_e.featureIndex});for(const _e of fe)ce.push(_e)}}for(const se in Z)Z[se].forEach(pe=>{const Q=pe.feature,ce=A[w[se].source].getFeatureState(Q.layer["source-layer"],Q.id);Q.source=Q.layer.source,Q.layer["source-layer"]&&(Q.sourceLayer=Q.layer["source-layer"]),Q.state=ce});return Z}(this._layers,b,this.sourceCaches,t,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(f)}querySourceFeatures(t,s){s&&s.filter&&this._validate(h.x.filter,"querySourceFeatures.filter",s.filter,null,s);const l=this.sourceCaches[t];return l?function(c,f){const b=c.getRenderableIds().map(A=>c.getTileByID(A)),w=[],E={};for(let A=0;A<b.length;A++){const M=b[A],k=M.tileID.canonical.key;E[k]||(E[k]=!0,M.querySourceFeatures(w,f))}return w}(l,s):[]}getLight(){return this.light.getLight()}setLight(t,s={}){this._checkLoaded();const l=this.light.getLight();let c=!1;for(const b in t)if(!h.aD(t[b],l[b])){c=!0;break}if(!c)return;const f={now:N.now(),transition:h.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,s),this.light.updateTransitions(f)}_validate(t,s,l,c,f={}){return(!f||f.validate!==!1)&&Ai(this,t.call(h.x,h.e({key:s,style:this.serialize(),value:l,styleSpec:h.v},c)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Ce().off(Tt,this._rtlPluginLoaded);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const l=this.sourceCaches[s];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const s in this.sourceCaches)this.sourceCaches[s].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,s,l,c,f=!1){let b=!1,w=!1;const E={};for(const A of this._order){const M=this._layers[A];if(M.type!=="symbol")continue;if(!E[M.source]){const O=this.sourceCaches[M.source];E[M.source]=O.getRenderableIds(!0).map(W=>O.getTileByID(W)).sort((W,Z)=>Z.tileID.overscaledZ-W.tileID.overscaledZ||(W.tileID.isLessThan(Z.tileID)?-1:1))}const k=this.crossTileSymbolIndex.addLayer(M,E[M.source],t.center.lng);b=b||k}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((f=f||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(N.now(),t.zoom))&&(this.pauseablePlacement=new rn(t,this.map.terrain,this._order,f,s,l,c,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,E),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(N.now()),w=!0),b&&this.pauseablePlacement.placement.setStale()),w||b)for(const A of this._order){const M=this._layers[A];M.type==="symbol"&&this.placement.updateLayerOpacities(M,E[M.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(N.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,s){return h._(this,void 0,void 0,function*(){const l=yield this.imageManager.getImages(s.icons);this._updateTilesForChangedImages();const c=this.sourceCaches[s.source];return c&&c.setDependencies(s.tileID.key,s.type,s.icons),l})}getGlyphs(t,s){return h._(this,void 0,void 0,function*(){const l=yield this.glyphManager.getGlyphs(s.stacks),c=this.sourceCaches[s.source];return c&&c.setDependencies(s.tileID.key,s.type,[""]),l})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,s={}){this._checkLoaded(),t&&this._validate(h.x.glyphs,"glyphs",t,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,s,l={},c){this._checkLoaded();const f=[{id:t,url:s}],b=[...bt(this.stylesheet.sprite),...f];this._validate(h.x.sprite,"sprite",b,null,l)||(this.stylesheet.sprite=b,this._loadSprite(f,!0,c))}removeSprite(t){this._checkLoaded();const s=bt(this.stylesheet.sprite);if(s.find(l=>l.id===t)){if(this._spritesImagesIds[t])for(const l of this._spritesImagesIds[t])this.imageManager.removeImage(l),this._changedImages[l]=!0;s.splice(s.findIndex(l=>l.id===t),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.k("data",{dataType:"style"}))}else this.fire(new h.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return bt(this.stylesheet.sprite)}setSprite(t,s={},l){this._checkLoaded(),t&&this._validate(h.x.sprite,"sprite",t,null,s)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,l):(this._unloadSprite(),l&&l(null)))}}var Wo=h.X([{name:"a_pos",type:"Int16",components:2}]),bn="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const co={prelude:li(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:li(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:li(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:li(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:li("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:li(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:li(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:li("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:li("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:li("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:li(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:li(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:li(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:li(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:li(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:li(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:li(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:li(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:li(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:li(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:li(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:li(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:li(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:li(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:li(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:li(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:li("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",bn),terrainDepth:li("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",bn),terrainCoords:li("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",bn)};function li(p,t){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=t.match(/attribute ([\w]+) ([\w]+)/g),c=p.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),f=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=f?f.concat(c):c,w={};return{fragmentSource:p=p.replace(s,(E,A,M,k,O)=>(w[O]=!0,A==="define"?`
#ifndef HAS_UNIFORM_u_${O}
varying ${M} ${k} ${O};
#else
uniform ${M} ${k} u_${O};
#endif
`:`
#ifdef HAS_UNIFORM_u_${O}
    ${M} ${k} ${O} = u_${O};
#endif
`)),vertexSource:t=t.replace(s,(E,A,M,k,O)=>{const W=k==="float"?"vec2":"vec4",Z=O.match(/color/)?"color":W;return w[O]?A==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
attribute ${M} ${W} a_${O};
varying ${M} ${k} ${O};
#else
uniform ${M} ${k} u_${O};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = a_${O};
#else
    ${M} ${k} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = unpack_mix_${Z}(a_${O}, u_${O}_t);
#else
    ${M} ${k} ${O} = u_${O};
#endif
`:A==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
attribute ${M} ${W} a_${O};
#else
uniform ${M} ${k} u_${O};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${M} ${k} ${O} = a_${O};
#else
    ${M} ${k} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${M} ${k} ${O} = unpack_mix_${Z}(a_${O}, u_${O}_t);
#else
    ${M} ${k} ${O} = u_${O};
#endif
`}),staticAttributes:l,staticUniforms:b}}class Ko{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,s,l,c,f,b,w,E,A){this.context=t;let M=this.boundPaintVertexBuffers.length!==c.length;for(let k=0;!M&&k<c.length;k++)this.boundPaintVertexBuffers[k]!==c[k]&&(M=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==l||M||this.boundIndexBuffer!==f||this.boundVertexOffset!==b||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==E||this.boundDynamicVertexBuffer3!==A?this.freshBind(s,l,c,f,b,w,E,A):(t.bindVertexArray.set(this.vao),w&&w.bind(),f&&f.dynamicDraw&&f.bind(),E&&E.bind(),A&&A.bind())}freshBind(t,s,l,c,f,b,w,E){const A=t.numAttributes,M=this.context,k=M.gl;this.vao&&this.destroy(),this.vao=M.createVertexArray(),M.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=c,this.boundVertexOffset=f,this.boundDynamicVertexBuffer=b,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=E,s.enableAttributes(k,t);for(const O of l)O.enableAttributes(k,t);b&&b.enableAttributes(k,t),w&&w.enableAttributes(k,t),E&&E.enableAttributes(k,t),s.bind(),s.setVertexAttribPointers(k,t,f);for(const O of l)O.bind(),O.setVertexAttribPointers(k,t,f);b&&(b.bind(),b.setVertexAttribPointers(k,t,f)),c&&c.bind(),w&&(w.bind(),w.setVertexAttribPointers(k,t,f)),E&&(E.bind(),E.setVertexAttribPointers(k,t,f)),M.currentNumAttributes=A}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Ps(p){const t=[];for(let s=0;s<p.length;s++){if(p[s]===null)continue;const l=p[s].split(" ");t.push(l.pop())}return t}class qn{constructor(t,s,l,c,f,b){const w=t.gl;this.program=w.createProgram();const E=Ps(s.staticAttributes),A=l?l.getBinderAttributes():[],M=E.concat(A),k=co.prelude.staticUniforms?Ps(co.prelude.staticUniforms):[],O=s.staticUniforms?Ps(s.staticUniforms):[],W=l?l.getBinderUniforms():[],Z=k.concat(O).concat(W),Y=[];for(const _e of Z)Y.indexOf(_e)<0&&Y.push(_e);const q=l?l.defines():[];f&&q.push("#define OVERDRAW_INSPECTOR;"),b&&q.push("#define TERRAIN3D;");const se=q.concat(co.prelude.fragmentSource,s.fragmentSource).join(`
`),pe=q.concat(co.prelude.vertexSource,s.vertexSource).join(`
`),Q=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(Q,se),w.compileShader(Q),!w.getShaderParameter(Q,w.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${w.getShaderInfoLog(Q)}`);w.attachShader(this.program,Q);const ce=w.createShader(w.VERTEX_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(ce,pe),w.compileShader(ce),!w.getShaderParameter(ce,w.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${w.getShaderInfoLog(ce)}`);w.attachShader(this.program,ce),this.attributes={};const fe={};this.numAttributes=M.length;for(let _e=0;_e<this.numAttributes;_e++)M[_e]&&(w.bindAttribLocation(this.program,_e,M[_e]),this.attributes[M[_e]]=_e);if(w.linkProgram(this.program),!w.getProgramParameter(this.program,w.LINK_STATUS))throw new Error(`Program failed to link: ${w.getProgramInfoLog(this.program)}`);w.deleteShader(ce),w.deleteShader(Q);for(let _e=0;_e<Y.length;_e++){const ve=Y[_e];if(ve&&!fe[ve]){const ze=w.getUniformLocation(this.program,ve);ze&&(fe[ve]=ze)}}this.fixedUniforms=c(t,fe),this.terrainUniforms=((_e,ve)=>({u_depth:new h.aG(_e,ve.u_depth),u_terrain:new h.aG(_e,ve.u_terrain),u_terrain_dim:new h.aH(_e,ve.u_terrain_dim),u_terrain_matrix:new h.aI(_e,ve.u_terrain_matrix),u_terrain_unpack:new h.aJ(_e,ve.u_terrain_unpack),u_terrain_exaggeration:new h.aH(_e,ve.u_terrain_exaggeration)}))(t,fe),this.binderUniforms=l?l.getUniforms(t,fe):[]}draw(t,s,l,c,f,b,w,E,A,M,k,O,W,Z,Y,q,se,pe){const Q=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(l),t.setStencilMode(c),t.setColorMode(f),t.setCullFace(b),E){t.activeTexture.set(Q.TEXTURE2),Q.bindTexture(Q.TEXTURE_2D,E.depthTexture),t.activeTexture.set(Q.TEXTURE3),Q.bindTexture(Q.TEXTURE_2D,E.texture);for(const fe in this.terrainUniforms)this.terrainUniforms[fe].set(E[fe])}for(const fe in this.fixedUniforms)this.fixedUniforms[fe].set(w[fe]);Y&&Y.setUniforms(t,this.binderUniforms,W,{zoom:Z});let ce=0;switch(s){case Q.LINES:ce=2;break;case Q.TRIANGLES:ce=3;break;case Q.LINE_STRIP:ce=1}for(const fe of O.get()){const _e=fe.vaos||(fe.vaos={});(_e[A]||(_e[A]=new Ko)).bind(t,this,M,Y?Y.getPaintVertexBuffers():[],k,fe.vertexOffset,q,se,pe),Q.drawElements(s,fe.primitiveLength*ce,Q.UNSIGNED_SHORT,fe.primitiveOffset*ce*2)}}}function Xo(p,t,s){const l=1/It(s,1,t.transform.tileZoom),c=Math.pow(2,s.tileID.overscaledZ),f=s.tileSize*Math.pow(2,t.transform.tileZoom)/c,b=f*(s.tileID.canonical.x+s.tileID.wrap*c),w=f*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[l,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[b>>16,w>>16],u_pixel_coord_lower:[65535&b,65535&w]}}const uo=(p,t,s,l)=>{const c=t.style.light,f=c.properties.get("position"),b=[f.x,f.y,f.z],w=function(){var A=new h.A(9);return h.A!=Float32Array&&(A[1]=0,A[2]=0,A[3]=0,A[5]=0,A[6]=0,A[7]=0),A[0]=1,A[4]=1,A[8]=1,A}();c.properties.get("anchor")==="viewport"&&function(A,M){var k=Math.sin(M),O=Math.cos(M);A[0]=O,A[1]=k,A[2]=0,A[3]=-k,A[4]=O,A[5]=0,A[6]=0,A[7]=0,A[8]=1}(w,-t.transform.angle),function(A,M,k){var O=M[0],W=M[1],Z=M[2];A[0]=O*k[0]+W*k[3]+Z*k[6],A[1]=O*k[1]+W*k[4]+Z*k[7],A[2]=O*k[2]+W*k[5]+Z*k[8]}(b,b,w);const E=c.properties.get("color");return{u_matrix:p,u_lightpos:b,u_lightintensity:c.properties.get("intensity"),u_lightcolor:[E.r,E.g,E.b],u_vertical_gradient:+s,u_opacity:l}},Vh=(p,t,s,l,c,f,b)=>h.e(uo(p,t,s,l),Xo(f,t,b),{u_height_factor:-Math.pow(2,c.overscaledZ)/b.tileSize/8}),Oc=p=>({u_matrix:p}),Yo=(p,t,s,l)=>h.e(Oc(p),Xo(s,t,l)),$h=(p,t)=>({u_matrix:p,u_world:t}),Bc=(p,t,s,l,c)=>h.e(Yo(p,t,s,l),{u_world:c}),Uh=(p,t,s,l)=>{const c=p.transform;let f,b;if(l.paint.get("circle-pitch-alignment")==="map"){const w=It(s,1,c.zoom);f=!0,b=[w,w]}else f=!1,b=c.pixelsToGLUnits;return{u_camera_to_center_distance:c.cameraToCenterDistance,u_scale_with_map:+(l.paint.get("circle-pitch-scale")==="map"),u_matrix:p.translatePosMatrix(t.posMatrix,s,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_pitch_with_map:+f,u_device_pixel_ratio:p.pixelRatio,u_extrude_scale:b}},Nc=(p,t,s)=>{const l=It(s,1,t.zoom),c=Math.pow(2,t.zoom-s.tileID.overscaledZ),f=s.tileID.overscaleFactor();return{u_matrix:p,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:l,u_extrude_scale:[t.pixelsToGLUnits[0]/(l*c),t.pixelsToGLUnits[1]/(l*c)],u_overscale_factor:f}},Vc=(p,t,s=1)=>({u_matrix:p,u_color:t,u_overlay:0,u_overlay_scale:s}),Jo=p=>({u_matrix:p}),$c=(p,t,s,l)=>({u_matrix:p,u_extrude_scale:It(t,1,s),u_intensity:l});function Uc(p,t){const s=Math.pow(2,t.canonical.z),l=t.canonical.y;return[new h.Y(0,l/s).toLngLat().lat,new h.Y(0,(l+1)/s).toLngLat().lat]}const Qo=(p,t,s,l)=>{const c=p.transform;return{u_matrix:ho(p,t,s,l),u_ratio:1/It(t,1,c.zoom),u_device_pixel_ratio:p.pixelRatio,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]]}},jc=(p,t,s,l,c)=>h.e(Qo(p,t,s,c),{u_image:0,u_image_height:l}),as=(p,t,s,l,c)=>{const f=p.transform,b=qr(t,f);return{u_matrix:ho(p,t,s,c),u_texsize:t.imageAtlasTexture.size,u_ratio:1/It(t,1,f.zoom),u_device_pixel_ratio:p.pixelRatio,u_image:0,u_scale:[b,l.fromScale,l.toScale],u_fade:l.t,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},ea=(p,t,s,l,c,f)=>{const b=p.lineAtlas,w=qr(t,p.transform),E=s.layout.get("line-cap")==="round",A=b.getDash(l.from,E),M=b.getDash(l.to,E),k=A.width*c.fromScale,O=M.width*c.toScale;return h.e(Qo(p,t,s,f),{u_patternscale_a:[w/k,-A.height/2],u_patternscale_b:[w/O,-M.height/2],u_sdfgamma:b.width/(256*Math.min(k,O)*p.pixelRatio)/2,u_image:0,u_tex_y_a:A.y,u_tex_y_b:M.y,u_mix:c.t})};function qr(p,t){return 1/It(p,1,t.tileZoom)}function ho(p,t,s,l){return p.translatePosMatrix(l?l.posMatrix:t.tileID.posMatrix,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const ta=(p,t,s,l,c)=>{return{u_matrix:p,u_tl_parent:t,u_scale_parent:s,u_buffer_scale:1,u_fade_t:l.mix,u_opacity:l.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(b=c.paint.get("raster-saturation"),b>0?1-1/(1.001-b):-b),u_contrast_factor:(f=c.paint.get("raster-contrast"),f>0?1/(1-f):1+f),u_spin_weights:po(c.paint.get("raster-hue-rotate"))};var f,b};function po(p){p*=Math.PI/180;const t=Math.sin(p),s=Math.cos(p);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const fo=(p,t,s,l,c,f,b,w,E,A)=>{const M=c.transform;return{u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:M.cameraToCenterDistance,u_pitch:M.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:M.width/M.height,u_fade_change:c.options.fadeDuration?c.symbolFadeChange:1,u_matrix:f,u_label_plane_matrix:b,u_coord_matrix:w,u_is_text:+E,u_pitch_with_map:+l,u_texsize:A,u_texture:0}},mo=(p,t,s,l,c,f,b,w,E,A,M)=>{const k=c.transform;return h.e(fo(p,t,s,l,c,f,b,w,E,A),{u_gamma_scale:l?Math.cos(k._pitch)*k.cameraToCenterDistance:1,u_device_pixel_ratio:c.pixelRatio,u_is_halo:+M})},go=(p,t,s,l,c,f,b,w,E,A)=>h.e(mo(p,t,s,l,c,f,b,w,!0,E,!0),{u_texsize_icon:A,u_texture_icon:1}),jh=(p,t,s)=>({u_matrix:p,u_opacity:t,u_color:s}),qh=(p,t,s,l,c,f)=>h.e(function(b,w,E,A){const M=E.imageManager.getPattern(b.from.toString()),k=E.imageManager.getPattern(b.to.toString()),{width:O,height:W}=E.imageManager.getPixelSize(),Z=Math.pow(2,A.tileID.overscaledZ),Y=A.tileSize*Math.pow(2,E.transform.tileZoom)/Z,q=Y*(A.tileID.canonical.x+A.tileID.wrap*Z),se=Y*A.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:M.tl,u_pattern_br_a:M.br,u_pattern_tl_b:k.tl,u_pattern_br_b:k.br,u_texsize:[O,W],u_mix:w.t,u_pattern_size_a:M.displaySize,u_pattern_size_b:k.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/It(A,1,E.transform.tileZoom),u_pixel_coord_upper:[q>>16,se>>16],u_pixel_coord_lower:[65535&q,65535&se]}}(l,f,s,c),{u_matrix:p,u_opacity:t}),qc={fillExtrusion:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_lightpos:new h.aK(p,t.u_lightpos),u_lightintensity:new h.aH(p,t.u_lightintensity),u_lightcolor:new h.aK(p,t.u_lightcolor),u_vertical_gradient:new h.aH(p,t.u_vertical_gradient),u_opacity:new h.aH(p,t.u_opacity)}),fillExtrusionPattern:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_lightpos:new h.aK(p,t.u_lightpos),u_lightintensity:new h.aH(p,t.u_lightintensity),u_lightcolor:new h.aK(p,t.u_lightcolor),u_vertical_gradient:new h.aH(p,t.u_vertical_gradient),u_height_factor:new h.aH(p,t.u_height_factor),u_image:new h.aG(p,t.u_image),u_texsize:new h.aL(p,t.u_texsize),u_pixel_coord_upper:new h.aL(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.aL(p,t.u_pixel_coord_lower),u_scale:new h.aK(p,t.u_scale),u_fade:new h.aH(p,t.u_fade),u_opacity:new h.aH(p,t.u_opacity)}),fill:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix)}),fillPattern:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_image:new h.aG(p,t.u_image),u_texsize:new h.aL(p,t.u_texsize),u_pixel_coord_upper:new h.aL(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.aL(p,t.u_pixel_coord_lower),u_scale:new h.aK(p,t.u_scale),u_fade:new h.aH(p,t.u_fade)}),fillOutline:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_world:new h.aL(p,t.u_world)}),fillOutlinePattern:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_world:new h.aL(p,t.u_world),u_image:new h.aG(p,t.u_image),u_texsize:new h.aL(p,t.u_texsize),u_pixel_coord_upper:new h.aL(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.aL(p,t.u_pixel_coord_lower),u_scale:new h.aK(p,t.u_scale),u_fade:new h.aH(p,t.u_fade)}),circle:(p,t)=>({u_camera_to_center_distance:new h.aH(p,t.u_camera_to_center_distance),u_scale_with_map:new h.aG(p,t.u_scale_with_map),u_pitch_with_map:new h.aG(p,t.u_pitch_with_map),u_extrude_scale:new h.aL(p,t.u_extrude_scale),u_device_pixel_ratio:new h.aH(p,t.u_device_pixel_ratio),u_matrix:new h.aI(p,t.u_matrix)}),collisionBox:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_camera_to_center_distance:new h.aH(p,t.u_camera_to_center_distance),u_pixels_to_tile_units:new h.aH(p,t.u_pixels_to_tile_units),u_extrude_scale:new h.aL(p,t.u_extrude_scale),u_overscale_factor:new h.aH(p,t.u_overscale_factor)}),collisionCircle:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_inv_matrix:new h.aI(p,t.u_inv_matrix),u_camera_to_center_distance:new h.aH(p,t.u_camera_to_center_distance),u_viewport_size:new h.aL(p,t.u_viewport_size)}),debug:(p,t)=>({u_color:new h.aM(p,t.u_color),u_matrix:new h.aI(p,t.u_matrix),u_overlay:new h.aG(p,t.u_overlay),u_overlay_scale:new h.aH(p,t.u_overlay_scale)}),clippingMask:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix)}),heatmap:(p,t)=>({u_extrude_scale:new h.aH(p,t.u_extrude_scale),u_intensity:new h.aH(p,t.u_intensity),u_matrix:new h.aI(p,t.u_matrix)}),heatmapTexture:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_world:new h.aL(p,t.u_world),u_image:new h.aG(p,t.u_image),u_color_ramp:new h.aG(p,t.u_color_ramp),u_opacity:new h.aH(p,t.u_opacity)}),hillshade:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_image:new h.aG(p,t.u_image),u_latrange:new h.aL(p,t.u_latrange),u_light:new h.aL(p,t.u_light),u_shadow:new h.aM(p,t.u_shadow),u_highlight:new h.aM(p,t.u_highlight),u_accent:new h.aM(p,t.u_accent)}),hillshadePrepare:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_image:new h.aG(p,t.u_image),u_dimension:new h.aL(p,t.u_dimension),u_zoom:new h.aH(p,t.u_zoom),u_unpack:new h.aJ(p,t.u_unpack)}),line:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_ratio:new h.aH(p,t.u_ratio),u_device_pixel_ratio:new h.aH(p,t.u_device_pixel_ratio),u_units_to_pixels:new h.aL(p,t.u_units_to_pixels)}),lineGradient:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_ratio:new h.aH(p,t.u_ratio),u_device_pixel_ratio:new h.aH(p,t.u_device_pixel_ratio),u_units_to_pixels:new h.aL(p,t.u_units_to_pixels),u_image:new h.aG(p,t.u_image),u_image_height:new h.aH(p,t.u_image_height)}),linePattern:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_texsize:new h.aL(p,t.u_texsize),u_ratio:new h.aH(p,t.u_ratio),u_device_pixel_ratio:new h.aH(p,t.u_device_pixel_ratio),u_image:new h.aG(p,t.u_image),u_units_to_pixels:new h.aL(p,t.u_units_to_pixels),u_scale:new h.aK(p,t.u_scale),u_fade:new h.aH(p,t.u_fade)}),lineSDF:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_ratio:new h.aH(p,t.u_ratio),u_device_pixel_ratio:new h.aH(p,t.u_device_pixel_ratio),u_units_to_pixels:new h.aL(p,t.u_units_to_pixels),u_patternscale_a:new h.aL(p,t.u_patternscale_a),u_patternscale_b:new h.aL(p,t.u_patternscale_b),u_sdfgamma:new h.aH(p,t.u_sdfgamma),u_image:new h.aG(p,t.u_image),u_tex_y_a:new h.aH(p,t.u_tex_y_a),u_tex_y_b:new h.aH(p,t.u_tex_y_b),u_mix:new h.aH(p,t.u_mix)}),raster:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_tl_parent:new h.aL(p,t.u_tl_parent),u_scale_parent:new h.aH(p,t.u_scale_parent),u_buffer_scale:new h.aH(p,t.u_buffer_scale),u_fade_t:new h.aH(p,t.u_fade_t),u_opacity:new h.aH(p,t.u_opacity),u_image0:new h.aG(p,t.u_image0),u_image1:new h.aG(p,t.u_image1),u_brightness_low:new h.aH(p,t.u_brightness_low),u_brightness_high:new h.aH(p,t.u_brightness_high),u_saturation_factor:new h.aH(p,t.u_saturation_factor),u_contrast_factor:new h.aH(p,t.u_contrast_factor),u_spin_weights:new h.aK(p,t.u_spin_weights)}),symbolIcon:(p,t)=>({u_is_size_zoom_constant:new h.aG(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new h.aG(p,t.u_is_size_feature_constant),u_size_t:new h.aH(p,t.u_size_t),u_size:new h.aH(p,t.u_size),u_camera_to_center_distance:new h.aH(p,t.u_camera_to_center_distance),u_pitch:new h.aH(p,t.u_pitch),u_rotate_symbol:new h.aG(p,t.u_rotate_symbol),u_aspect_ratio:new h.aH(p,t.u_aspect_ratio),u_fade_change:new h.aH(p,t.u_fade_change),u_matrix:new h.aI(p,t.u_matrix),u_label_plane_matrix:new h.aI(p,t.u_label_plane_matrix),u_coord_matrix:new h.aI(p,t.u_coord_matrix),u_is_text:new h.aG(p,t.u_is_text),u_pitch_with_map:new h.aG(p,t.u_pitch_with_map),u_texsize:new h.aL(p,t.u_texsize),u_texture:new h.aG(p,t.u_texture)}),symbolSDF:(p,t)=>({u_is_size_zoom_constant:new h.aG(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new h.aG(p,t.u_is_size_feature_constant),u_size_t:new h.aH(p,t.u_size_t),u_size:new h.aH(p,t.u_size),u_camera_to_center_distance:new h.aH(p,t.u_camera_to_center_distance),u_pitch:new h.aH(p,t.u_pitch),u_rotate_symbol:new h.aG(p,t.u_rotate_symbol),u_aspect_ratio:new h.aH(p,t.u_aspect_ratio),u_fade_change:new h.aH(p,t.u_fade_change),u_matrix:new h.aI(p,t.u_matrix),u_label_plane_matrix:new h.aI(p,t.u_label_plane_matrix),u_coord_matrix:new h.aI(p,t.u_coord_matrix),u_is_text:new h.aG(p,t.u_is_text),u_pitch_with_map:new h.aG(p,t.u_pitch_with_map),u_texsize:new h.aL(p,t.u_texsize),u_texture:new h.aG(p,t.u_texture),u_gamma_scale:new h.aH(p,t.u_gamma_scale),u_device_pixel_ratio:new h.aH(p,t.u_device_pixel_ratio),u_is_halo:new h.aG(p,t.u_is_halo)}),symbolTextAndIcon:(p,t)=>({u_is_size_zoom_constant:new h.aG(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new h.aG(p,t.u_is_size_feature_constant),u_size_t:new h.aH(p,t.u_size_t),u_size:new h.aH(p,t.u_size),u_camera_to_center_distance:new h.aH(p,t.u_camera_to_center_distance),u_pitch:new h.aH(p,t.u_pitch),u_rotate_symbol:new h.aG(p,t.u_rotate_symbol),u_aspect_ratio:new h.aH(p,t.u_aspect_ratio),u_fade_change:new h.aH(p,t.u_fade_change),u_matrix:new h.aI(p,t.u_matrix),u_label_plane_matrix:new h.aI(p,t.u_label_plane_matrix),u_coord_matrix:new h.aI(p,t.u_coord_matrix),u_is_text:new h.aG(p,t.u_is_text),u_pitch_with_map:new h.aG(p,t.u_pitch_with_map),u_texsize:new h.aL(p,t.u_texsize),u_texsize_icon:new h.aL(p,t.u_texsize_icon),u_texture:new h.aG(p,t.u_texture),u_texture_icon:new h.aG(p,t.u_texture_icon),u_gamma_scale:new h.aH(p,t.u_gamma_scale),u_device_pixel_ratio:new h.aH(p,t.u_device_pixel_ratio),u_is_halo:new h.aG(p,t.u_is_halo)}),background:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_opacity:new h.aH(p,t.u_opacity),u_color:new h.aM(p,t.u_color)}),backgroundPattern:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_opacity:new h.aH(p,t.u_opacity),u_image:new h.aG(p,t.u_image),u_pattern_tl_a:new h.aL(p,t.u_pattern_tl_a),u_pattern_br_a:new h.aL(p,t.u_pattern_br_a),u_pattern_tl_b:new h.aL(p,t.u_pattern_tl_b),u_pattern_br_b:new h.aL(p,t.u_pattern_br_b),u_texsize:new h.aL(p,t.u_texsize),u_mix:new h.aH(p,t.u_mix),u_pattern_size_a:new h.aL(p,t.u_pattern_size_a),u_pattern_size_b:new h.aL(p,t.u_pattern_size_b),u_scale_a:new h.aH(p,t.u_scale_a),u_scale_b:new h.aH(p,t.u_scale_b),u_pixel_coord_upper:new h.aL(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.aL(p,t.u_pixel_coord_lower),u_tile_units_to_pixels:new h.aH(p,t.u_tile_units_to_pixels)}),terrain:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_texture:new h.aG(p,t.u_texture),u_ele_delta:new h.aH(p,t.u_ele_delta)}),terrainDepth:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_ele_delta:new h.aH(p,t.u_ele_delta)}),terrainCoords:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_texture:new h.aG(p,t.u_texture),u_terrain_coords_id:new h.aH(p,t.u_terrain_coords_id),u_ele_delta:new h.aH(p,t.u_ele_delta)})};class Gh{constructor(t,s,l){this.context=t;const c=t.gl;this.buffer=c.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ls={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ia{constructor(t,s,l,c){this.length=s.length,this.attributes=l,this.itemSize=s.bytesPerElement,this.dynamicDraw=c,this.context=t;const f=t.gl;this.buffer=f.createBuffer(),t.bindVertexBuffer.set(this.buffer),f.bufferData(f.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let l=0;l<this.attributes.length;l++){const c=s.attributes[this.attributes[l].name];c!==void 0&&t.enableVertexAttribArray(c)}}setVertexAttribPointers(t,s,l){for(let c=0;c<this.attributes.length;c++){const f=this.attributes[c],b=s.attributes[f.name];b!==void 0&&t.vertexAttribPointer(b,f.components,t[ls[f.type]],!1,this.itemSize,f.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const wr=new WeakMap;function gr(p){var t;if(wr.has(p))return wr.get(p);{const s=(t=p.getParameter(p.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return wr.set(p,s),s}}class Jt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ra extends Jt{getDefault(){return h.aO.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class na extends Jt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class cl extends Jt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class ul extends Jt{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class sa extends Jt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class hl extends Jt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class dl extends Jt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class oa extends Jt{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Gc extends Jt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class Hc extends Jt{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Cs extends Jt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class Hh extends Jt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Zh extends Jt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class Wh extends Jt{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Kh extends Jt{getDefault(){return h.aO.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Xh extends Jt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Yh extends Jt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class pl extends Jt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class aa extends Jt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class fl extends Jt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class ml extends Jt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Ms extends Jt{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Zc extends Jt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Wc extends Jt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class gl extends Jt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class cs extends Jt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Kc extends Jt{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ks extends Jt{getDefault(){return null}set(t){var s;if(t===this.current&&!this.dirty)return;const l=this.gl;gr(l)?l.bindVertexArray(t):(s=l.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Ds extends Jt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Xc extends Jt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class _l extends Jt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Wt extends Jt{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class la extends Wt{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Jh extends Wt{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Yc extends Wt{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class _o{constructor(t,s,l,c,f){this.context=t,this.width=s,this.height=l;const b=t.gl,w=this.framebuffer=b.createFramebuffer();if(this.colorAttachment=new la(t,w),c)this.depthAttachment=f?new Yc(t,w):new Jh(t,w);else if(f)throw new Error("Stencil cannot be set without depth");if(b.checkFramebufferStatus(b.FRAMEBUFFER)!==b.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,s=this.colorAttachment.get();if(s&&t.deleteTexture(s),this.depthAttachment){const l=this.depthAttachment.get();l&&t.deleteRenderbuffer(l)}t.deleteFramebuffer(this.framebuffer)}}class Bi{constructor(t,s,l){this.blendFunction=t,this.blendColor=s,this.mask=l}}Bi.Replace=[1,0],Bi.disabled=new Bi(Bi.Replace,h.aO.transparent,[!1,!1,!1,!1]),Bi.unblended=new Bi(Bi.Replace,h.aO.transparent,[!0,!0,!0,!0]),Bi.alphaBlended=new Bi([1,771],h.aO.transparent,[!0,!0,!0,!0]);class Qh{constructor(t){var s,l;if(this.gl=t,this.clearColor=new ra(this),this.clearDepth=new na(this),this.clearStencil=new cl(this),this.colorMask=new ul(this),this.depthMask=new sa(this),this.stencilMask=new hl(this),this.stencilFunc=new dl(this),this.stencilOp=new oa(this),this.stencilTest=new Gc(this),this.depthRange=new Hc(this),this.depthTest=new Cs(this),this.depthFunc=new Hh(this),this.blend=new Zh(this),this.blendFunc=new Wh(this),this.blendColor=new Kh(this),this.blendEquation=new Xh(this),this.cullFace=new Yh(this),this.cullFaceSide=new pl(this),this.frontFace=new aa(this),this.program=new fl(this),this.activeTexture=new ml(this),this.viewport=new Ms(this),this.bindFramebuffer=new Zc(this),this.bindRenderbuffer=new Wc(this),this.bindTexture=new gl(this),this.bindVertexBuffer=new cs(this),this.bindElementBuffer=new Kc(this),this.bindVertexArray=new ks(this),this.pixelStoreUnpack=new Ds(this),this.pixelStoreUnpackPremultiplyAlpha=new Xc(this),this.pixelStoreUnpackFlipY=new _l(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),gr(t)){this.HALF_FLOAT=t.HALF_FLOAT;const c=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=t.RGBA16F)!==null&&s!==void 0?s:c==null?void 0:c.RGBA16F_EXT,this.RGB16F=(l=t.RGB16F)!==null&&l!==void 0?l:c==null?void 0:c.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const c=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=c==null?void 0:c.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s){return new Gh(this,t,s)}createVertexBuffer(t,s,l){return new ia(this,t,s,l)}createRenderbuffer(t,s,l){const c=this.gl,f=c.createRenderbuffer();return this.bindRenderbuffer.set(f),c.renderbufferStorage(c.RENDERBUFFER,t,s,l),this.bindRenderbuffer.set(null),f}createFramebuffer(t,s,l,c){return new _o(this,t,s,l,c)}clear({color:t,depth:s,stencil:l}){const c=this.gl;let f=0;t&&(f|=c.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(f|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),l!==void 0&&(f|=c.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),c.clear(f)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){h.aD(t.blendFunction,Bi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return gr(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var s;return gr(this.gl)?this.gl.deleteVertexArray(t):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class qt{constructor(t,s,l){this.func=t,this.mask=s,this.range=l}}qt.ReadOnly=!1,qt.ReadWrite=!0,qt.disabled=new qt(519,qt.ReadOnly,[0,1]);const yl=7680;class _i{constructor(t,s,l,c,f,b){this.test=t,this.ref=s,this.mask=l,this.fail=c,this.depthFail=f,this.pass=b}}_i.disabled=new _i({func:519,mask:0},0,0,yl,yl,yl);class fi{constructor(t,s,l){this.enable=t,this.mode=s,this.frontFace=l}}let us;function ca(p,t,s,l,c,f,b){const w=p.context,E=w.gl,A=p.useProgram("collisionBox"),M=[];let k=0,O=0;for(let Q=0;Q<l.length;Q++){const ce=l[Q],fe=t.getTile(ce),_e=fe.getBucket(s);if(!_e)continue;let ve=ce.posMatrix;c[0]===0&&c[1]===0||(ve=p.translatePosMatrix(ce.posMatrix,fe,c,f));const ze=b?_e.textCollisionBox:_e.iconCollisionBox,ke=_e.collisionCircleArray;if(ke.length>0){const Be=h.F(),Ue=ve;h.aP(Be,_e.placementInvProjMatrix,p.transform.glCoordMatrix),h.aP(Be,Be,_e.placementViewportMatrix),M.push({circleArray:ke,circleOffset:O,transform:Ue,invTransform:Be,coord:ce}),k+=ke.length/4,O=k}ze&&A.draw(w,E.LINES,qt.disabled,_i.disabled,p.colorModeForRenderPass(),fi.disabled,Nc(ve,p.transform,fe),p.style.map.terrain&&p.style.map.terrain.getTerrainData(ce),s.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,null,p.transform.zoom,null,null,ze.collisionVertexBuffer)}if(!b||!M.length)return;const W=p.useProgram("collisionCircle"),Z=new h.aQ;Z.resize(4*k),Z._trim();let Y=0;for(const Q of M)for(let ce=0;ce<Q.circleArray.length/4;ce++){const fe=4*ce,_e=Q.circleArray[fe+0],ve=Q.circleArray[fe+1],ze=Q.circleArray[fe+2],ke=Q.circleArray[fe+3];Z.emplace(Y++,_e,ve,ze,ke,0),Z.emplace(Y++,_e,ve,ze,ke,1),Z.emplace(Y++,_e,ve,ze,ke,2),Z.emplace(Y++,_e,ve,ze,ke,3)}(!us||us.length<2*k)&&(us=function(Q){const ce=2*Q,fe=new h.aS;fe.resize(ce),fe._trim();for(let _e=0;_e<ce;_e++){const ve=6*_e;fe.uint16[ve+0]=4*_e+0,fe.uint16[ve+1]=4*_e+1,fe.uint16[ve+2]=4*_e+2,fe.uint16[ve+3]=4*_e+2,fe.uint16[ve+4]=4*_e+3,fe.uint16[ve+5]=4*_e+0}return fe}(k));const q=w.createIndexBuffer(us,!0),se=w.createVertexBuffer(Z,h.aR.members,!0);for(const Q of M){const ce={u_matrix:Q.transform,u_inv_matrix:Q.invTransform,u_camera_to_center_distance:(pe=p.transform).cameraToCenterDistance,u_viewport_size:[pe.width,pe.height]};W.draw(w,E.TRIANGLES,qt.disabled,_i.disabled,p.colorModeForRenderPass(),fi.disabled,ce,p.style.map.terrain&&p.style.map.terrain.getTerrainData(Q.coord),s.id,se,q,h.$.simpleSegment(0,2*Q.circleOffset,Q.circleArray.length,Q.circleArray.length/2),null,p.transform.zoom,null,null,null)}var pe;se.destroy(),q.destroy()}fi.disabled=new fi(!1,1029,2305),fi.backCCW=new fi(!0,1029,2305);const xl=h.an(new Float32Array(16));function Jc(p,t,s,l,c,f){const{horizontalAlign:b,verticalAlign:w}=h.at(p);return new h.P((-(b-.5)*t/c+l[0])*f,(-(w-.5)*s/c+l[1])*f)}function ua(p,t,s,l,c,f,b,w,E,A,M){const k=p.text.placedSymbolArray,O=p.text.dynamicLayoutVertexArray,W=p.icon.dynamicLayoutVertexArray,Z={};O.clear();for(let Y=0;Y<k.length;Y++){const q=k.get(Y),se=q.hidden||!q.crossTileID||p.allowVerticalPlacement&&!q.placedOrientation?null:l[q.crossTileID];if(se){const pe=new h.P(q.anchorX,q.anchorY),Q=Yi(pe,s?b:f,M),ce=X(c.cameraToCenterDistance,Q.signedDistanceFromCamera);let fe=h.ai(p.textSizeData,E,q)*ce/h.ao;s&&(fe*=p.tilePixelRatio/w);const{width:_e,height:ve,anchor:ze,textOffset:ke,textBoxScale:Be}=se,Ue=Jc(ze,_e,ve,ke,Be,fe),Mt=s?Yi(pe.add(Ue),f,M).point:Q.point.add(t?Ue.rotate(-c.angle):Ue),qe=p.allowVerticalPlacement&&q.placedOrientation===h.ah.vertical?Math.PI/2:0;for(let St=0;St<q.numGlyphs;St++)h.aj(O,Mt,qe);A&&q.associatedIconIndex>=0&&(Z[q.associatedIconIndex]={shiftedAnchor:Mt,angle:qe})}else Se(q.numGlyphs,O)}if(A){W.clear();const Y=p.icon.placedSymbolArray;for(let q=0;q<Y.length;q++){const se=Y.get(q);if(se.hidden)Se(se.numGlyphs,W);else{const pe=Z[q];if(pe)for(let Q=0;Q<se.numGlyphs;Q++)h.aj(W,pe.shiftedAnchor,pe.angle);else Se(se.numGlyphs,W)}}p.icon.dynamicLayoutVertexBuffer.updateData(W)}p.text.dynamicLayoutVertexBuffer.updateData(O)}function ha(p,t,s){return s.iconsInText&&t?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function da(p,t,s,l,c,f,b,w,E,A,M,k){const O=p.context,W=O.gl,Z=p.transform,Y=w==="map",q=E==="map",se=w!=="viewport"&&s.layout.get("symbol-placement")!=="point",pe=Y&&!q&&!se,Q=!s.layout.get("symbol-sort-key").isConstant();let ce=!1;const fe=p.depthModeForSublayer(0,qt.ReadOnly),_e=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ve=[];for(const ze of l){const ke=t.getTile(ze),Be=ke.getBucket(s);if(!Be)continue;const Ue=c?Be.text:Be.icon;if(!Ue||!Ue.segments.get().length||!Ue.hasVisibleVertices)continue;const Mt=Ue.programConfigurations.get(s.id),qe=c||Be.sdfIcons,St=c?Be.textSizeData:Be.iconSizeData,kt=q||Z.pitch!==0,Gt=p.useProgram(ha(qe,c,Be),Mt),Et=h.ag(St,Z.zoom),zt=p.style.map.terrain&&p.style.map.terrain.getTerrainData(ze);let Ot,Ri,ci,Gr,Qi=[0,0],Pi=null;if(c)Ri=ke.glyphAtlasTexture,ci=W.LINEAR,Ot=ke.glyphAtlasTexture.size,Be.iconsInText&&(Qi=ke.imageAtlasTexture.size,Pi=ke.imageAtlasTexture,Gr=kt||p.options.rotating||p.options.zooming||St.kind==="composite"||St.kind==="camera"?W.LINEAR:W.NEAREST);else{const qi=s.layout.get("icon-size").constantOr(0)!==1||Be.iconsNeedLinear;Ri=ke.imageAtlasTexture,ci=qe||p.options.rotating||p.options.zooming||qi||kt?W.LINEAR:W.NEAREST,Ot=ke.imageAtlasTexture.size}const er=It(ke,1,p.transform.zoom),Hr=Pt(ze.posMatrix,q,Y,p.transform,er),En=os(ze.posMatrix,q,Y,p.transform,er),Kn=_e&&Be.hasTextData(),Mo=s.layout.get("icon-text-fit")!=="none"&&Kn&&Be.hasIconData();if(se){const qi=p.style.map.terrain?(sn,Gi)=>p.style.map.terrain.getElevation(ze,sn,Gi):null,Mi=s.layout.get("text-rotation-alignment")==="map";L(Be,ze.posMatrix,p,c,Hr,En,q,A,Mi,qi)}const Xn=p.translatePosMatrix(ze.posMatrix,ke,f,b),In=se||c&&_e||Mo?xl:Hr,ji=p.translatePosMatrix(En,ke,f,b,!0),Ci=qe&&s.paint.get(c?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ei;Ei=qe?Be.iconsInText?go(St.kind,Et,pe,q,p,Xn,In,ji,Ot,Qi):mo(St.kind,Et,pe,q,p,Xn,In,ji,c,Ot,!0):fo(St.kind,Et,pe,q,p,Xn,In,ji,c,Ot);const nn={program:Gt,buffers:Ue,uniformValues:Ei,atlasTexture:Ri,atlasTextureIcon:Pi,atlasInterpolation:ci,atlasInterpolationIcon:Gr,isSDF:qe,hasHalo:Ci};if(Q&&Be.canOverlap){ce=!0;const qi=Ue.segments.get();for(const Mi of qi)ve.push({segments:new h.$([Mi]),sortKey:Mi.sortKey,state:nn,terrainData:zt})}else ve.push({segments:Ue.segments,sortKey:0,state:nn,terrainData:zt})}ce&&ve.sort((ze,ke)=>ze.sortKey-ke.sortKey);for(const ze of ve){const ke=ze.state;if(O.activeTexture.set(W.TEXTURE0),ke.atlasTexture.bind(ke.atlasInterpolation,W.CLAMP_TO_EDGE),ke.atlasTextureIcon&&(O.activeTexture.set(W.TEXTURE1),ke.atlasTextureIcon&&ke.atlasTextureIcon.bind(ke.atlasInterpolationIcon,W.CLAMP_TO_EDGE)),ke.isSDF){const Be=ke.uniformValues;ke.hasHalo&&(Be.u_is_halo=1,Qc(ke.buffers,ze.segments,s,p,ke.program,fe,M,k,Be,ze.terrainData)),Be.u_is_halo=0}Qc(ke.buffers,ze.segments,s,p,ke.program,fe,M,k,ke.uniformValues,ze.terrainData)}}function Qc(p,t,s,l,c,f,b,w,E,A){const M=l.context;c.draw(M,M.gl.TRIANGLES,f,b,w,fi.disabled,E,A,s.id,p.layoutVertexBuffer,p.indexBuffer,t,s.paint,l.transform.zoom,p.programConfigurations.get(s.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function pa(p,t,s,l,c){if(!s||!l||!l.imageAtlas)return;const f=l.imageAtlas.patternPositions;let b=f[s.to.toString()],w=f[s.from.toString()];if(!b&&w&&(b=w),!w&&b&&(w=b),!b||!w){const E=c.getPaintProperty(t);b=f[E],w=f[E]}b&&w&&p.setConstantPatternPositions(b,w)}function eu(p,t,s,l,c,f,b){const w=p.context.gl,E="fill-pattern",A=s.paint.get(E),M=A&&A.constantOr(1),k=s.getCrossfadeParameters();let O,W,Z,Y,q;b?(W=M&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=w.LINES):(W=M?"fillPattern":"fill",O=w.TRIANGLES);const se=A.constantOr(null);for(const pe of l){const Q=t.getTile(pe);if(M&&!Q.patternsLoaded())continue;const ce=Q.getBucket(s);if(!ce)continue;const fe=ce.programConfigurations.get(s.id),_e=p.useProgram(W,fe),ve=p.style.map.terrain&&p.style.map.terrain.getTerrainData(pe);M&&(p.context.activeTexture.set(w.TEXTURE0),Q.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),fe.updatePaintBuffers(k)),pa(fe,E,se,Q,s);const ze=ve?pe:null,ke=p.translatePosMatrix(ze?ze.posMatrix:pe.posMatrix,Q,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(b){Y=ce.indexBuffer2,q=ce.segments2;const Be=[w.drawingBufferWidth,w.drawingBufferHeight];Z=W==="fillOutlinePattern"&&M?Bc(ke,p,k,Q,Be):$h(ke,Be)}else Y=ce.indexBuffer,q=ce.segments,Z=M?Yo(ke,p,k,Q):Oc(ke);_e.draw(p.context,O,c,p.stencilModeForClipping(pe),f,fi.disabled,Z,ve,s.id,ce.layoutVertexBuffer,Y,q,s.paint,p.transform.zoom,fe)}}function fa(p,t,s,l,c,f,b){const w=p.context,E=w.gl,A="fill-extrusion-pattern",M=s.paint.get(A),k=M.constantOr(1),O=s.getCrossfadeParameters(),W=s.paint.get("fill-extrusion-opacity"),Z=M.constantOr(null);for(const Y of l){const q=t.getTile(Y),se=q.getBucket(s);if(!se)continue;const pe=p.style.map.terrain&&p.style.map.terrain.getTerrainData(Y),Q=se.programConfigurations.get(s.id),ce=p.useProgram(k?"fillExtrusionPattern":"fillExtrusion",Q);k&&(p.context.activeTexture.set(E.TEXTURE0),q.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),Q.updatePaintBuffers(O)),pa(Q,A,Z,q,s);const fe=p.translatePosMatrix(Y.posMatrix,q,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),_e=s.paint.get("fill-extrusion-vertical-gradient"),ve=k?Vh(fe,p,_e,W,Y,O,q):uo(fe,p,_e,W);ce.draw(w,w.gl.TRIANGLES,c,f,b,fi.backCCW,ve,pe,s.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,s.paint,p.transform.zoom,Q,p.style.map.terrain&&se.centroidVertexBuffer)}}function ma(p,t,s,l,c,f,b){const w=p.context,E=w.gl,A=s.fbo;if(!A)return;const M=p.useProgram("hillshade"),k=p.style.map.terrain&&p.style.map.terrain.getTerrainData(t);w.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,A.colorAttachment.get()),M.draw(w,E.TRIANGLES,c,f,b,fi.disabled,((O,W,Z,Y)=>{const q=Z.paint.get("hillshade-shadow-color"),se=Z.paint.get("hillshade-highlight-color"),pe=Z.paint.get("hillshade-accent-color");let Q=Z.paint.get("hillshade-illumination-direction")*(Math.PI/180);Z.paint.get("hillshade-illumination-anchor")==="viewport"&&(Q-=O.transform.angle);const ce=!O.options.moving;return{u_matrix:Y?Y.posMatrix:O.transform.calculatePosMatrix(W.tileID.toUnwrapped(),ce),u_image:0,u_latrange:Uc(0,W.tileID),u_light:[Z.paint.get("hillshade-exaggeration"),Q],u_shadow:q,u_highlight:se,u_accent:pe}})(p,s,l,k?t:null),k,l.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}function vl(p,t,s,l,c,f){const b=p.context,w=b.gl,E=t.dem;if(E&&E.data){const A=E.dim,M=E.stride,k=E.getPixels();if(b.activeTexture.set(w.TEXTURE1),b.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||p.getTileTexture(M),t.demTexture){const W=t.demTexture;W.update(k,{premultiply:!1}),W.bind(w.NEAREST,w.CLAMP_TO_EDGE)}else t.demTexture=new gt(b,k,w.RGBA,{premultiply:!1}),t.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);b.activeTexture.set(w.TEXTURE0);let O=t.fbo;if(!O){const W=new gt(b,{width:A,height:A,data:null},w.RGBA);W.bind(w.LINEAR,w.CLAMP_TO_EDGE),O=t.fbo=b.createFramebuffer(A,A,!0,!1),O.colorAttachment.set(W.texture)}b.bindFramebuffer.set(O.framebuffer),b.viewport.set([0,0,A,A]),p.useProgram("hillshadePrepare").draw(b,w.TRIANGLES,l,c,f,fi.disabled,((W,Z)=>{const Y=Z.stride,q=h.F();return h.aN(q,0,h.W,-h.W,0,0,1),h.H(q,q,[0,-h.W,0]),{u_matrix:q,u_image:1,u_dimension:[Y,Y],u_zoom:W.overscaledZ,u_unpack:Z.getUnpackVector()}})(t.tileID,E),null,s.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function tu(p,t,s,l,c,f){const b=l.paint.get("raster-fade-duration");if(!f&&b>0){const w=N.now(),E=(w-p.timeAdded)/b,A=t?(w-t.timeAdded)/b:-1,M=s.getSource(),k=c.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),O=!t||Math.abs(t.tileID.overscaledZ-k)>Math.abs(p.tileID.overscaledZ-k),W=O&&p.refreshedUponExpiration?1:h.ac(O?E:1-A,0,1);return p.refreshedUponExpiration&&E>=1&&(p.refreshedUponExpiration=!1),t?{opacity:1,mix:1-W}:{opacity:W,mix:0}}return{opacity:1,mix:0}}const iu=new h.aO(1,0,0,1),ga=new h.aO(0,1,0,1),bl=new h.aO(0,0,1,1),ed=new h.aO(1,0,1,1),ru=new h.aO(0,1,1,1);function Di(p,t,s,l){Sr(p,0,t+s/2,p.transform.width,s,l)}function Gn(p,t,s,l){Sr(p,t-s/2,0,s,p.transform.height,l)}function Sr(p,t,s,l,c,f){const b=p.context,w=b.gl;w.enable(w.SCISSOR_TEST),w.scissor(t*p.pixelRatio,s*p.pixelRatio,l*p.pixelRatio,c*p.pixelRatio),b.clear({color:f}),w.disable(w.SCISSOR_TEST)}function wl(p,t,s){const l=p.context,c=l.gl,f=s.posMatrix,b=p.useProgram("debug"),w=qt.disabled,E=_i.disabled,A=p.colorModeForRenderPass(),M="$debug",k=p.style.map.terrain&&p.style.map.terrain.getTerrainData(s);l.activeTexture.set(c.TEXTURE0);const O=t.getTileByID(s.key).latestRawTileData,W=Math.floor((O&&O.byteLength||0)/1024),Z=t.getTile(s).tileSize,Y=512/Math.min(Z,512)*(s.overscaledZ/p.transform.zoom)*.5;let q=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(q+=` => ${s.overscaledZ}`),function(se,pe){se.initDebugOverlayCanvas();const Q=se.debugOverlayCanvas,ce=se.context.gl,fe=se.debugOverlayCanvas.getContext("2d");fe.clearRect(0,0,Q.width,Q.height),fe.shadowColor="white",fe.shadowBlur=2,fe.lineWidth=1.5,fe.strokeStyle="white",fe.textBaseline="top",fe.font="bold 36px Open Sans, sans-serif",fe.fillText(pe,5,5),fe.strokeText(pe,5,5),se.debugOverlayTexture.update(Q),se.debugOverlayTexture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE)}(p,`${q} ${W}kB`),b.draw(l,c.TRIANGLES,w,E,Bi.alphaBlended,fi.disabled,Vc(f,h.aO.transparent,Y),null,M,p.debugBuffer,p.quadTriangleIndexBuffer,p.debugSegments),b.draw(l,c.LINE_STRIP,w,E,A,fi.disabled,Vc(f,h.aO.red),k,M,p.debugBuffer,p.tileBorderIndexBuffer,p.debugSegments)}function _a(p,t,s){const l=p.context,c=l.gl,f=p.colorModeForRenderPass(),b=new qt(c.LEQUAL,qt.ReadWrite,p.depthRangeFor3D),w=p.useProgram("terrain"),E=t.getTerrainMesh();l.bindFramebuffer.set(null),l.viewport.set([0,0,p.width,p.height]);for(const A of s){const M=p.renderToTexture.getTexture(A),k=t.getTerrainData(A.tileID);l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,M.texture);const O={u_matrix:p.transform.calculatePosMatrix(A.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(p.transform.zoom)};w.draw(l,c.TRIANGLES,b,_i.disabled,f,fi.backCCW,O,k,"terrain",E.vertexBuffer,E.indexBuffer,E.segments)}}class nu{constructor(t,s){this.context=new Qh(t),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:h.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Xi.maxUnderzooming+Xi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new jn}resize(t,s,l){if(this.width=Math.floor(t*l),this.height=Math.floor(s*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style._order)this.style._layers[c].resize()}setup(){const t=this.context,s=new h.aV;s.emplaceBack(0,0),s.emplaceBack(h.W,0),s.emplaceBack(0,h.W),s.emplaceBack(h.W,h.W),this.tileExtentBuffer=t.createVertexBuffer(s,Wo.members),this.tileExtentSegments=h.$.simpleSegment(0,0,4,2);const l=new h.aV;l.emplaceBack(0,0),l.emplaceBack(h.W,0),l.emplaceBack(0,h.W),l.emplaceBack(h.W,h.W),this.debugBuffer=t.createVertexBuffer(l,Wo.members),this.debugSegments=h.$.simpleSegment(0,0,4,5);const c=new h.Z;c.emplaceBack(0,0,0,0),c.emplaceBack(h.W,0,h.W,0),c.emplaceBack(0,h.W,0,h.W),c.emplaceBack(h.W,h.W,h.W,h.W),this.rasterBoundsBuffer=t.createVertexBuffer(c,Ie.members),this.rasterBoundsSegments=h.$.simpleSegment(0,0,4,2);const f=new h.aV;f.emplaceBack(0,0),f.emplaceBack(1,0),f.emplaceBack(0,1),f.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(f,Wo.members),this.viewportSegments=h.$.simpleSegment(0,0,4,2);const b=new h.aW;b.emplaceBack(0),b.emplaceBack(1),b.emplaceBack(3),b.emplaceBack(2),b.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(b);const w=new h.aX;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(w);const E=this.context.gl;this.stencilClearMode=new _i({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO)}clearStencil(){const t=this.context,s=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=h.F();h.aN(l,0,this.width,this.height,0,0,1),h.J(l,l,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,s.TRIANGLES,qt.disabled,this.stencilClearMode,Bi.disabled,fi.disabled,Jo(l),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,s){if(this.currentStencilSource===t.source||!t.isTileClipped()||!s||!s.length)return;this.currentStencilSource=t.source;const l=this.context,c=l.gl;this.nextStencilID+s.length>256&&this.clearStencil(),l.setColorMode(Bi.disabled),l.setDepthMode(qt.disabled);const f=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const b of s){const w=this._tileClippingMaskIDs[b.key]=this.nextStencilID++,E=this.style.map.terrain&&this.style.map.terrain.getTerrainData(b);f.draw(l,c.TRIANGLES,qt.disabled,new _i({func:c.ALWAYS,mask:0},w,255,c.KEEP,c.KEEP,c.REPLACE),Bi.disabled,fi.disabled,Jo(b.posMatrix),E,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new _i({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){const s=this.context.gl;return new _i({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){const s=this.context.gl,l=t.sort((b,w)=>w.overscaledZ-b.overscaledZ),c=l[l.length-1].overscaledZ,f=l[0].overscaledZ-c+1;if(f>1){this.currentStencilSource=void 0,this.nextStencilID+f>256&&this.clearStencil();const b={};for(let w=0;w<f;w++)b[w+c]=new _i({func:s.GEQUAL,mask:255},w+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=f,[b,l]}return[{[c]:_i.disabled},l]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Bi([t.CONSTANT_COLOR,t.ONE],new h.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Bi.unblended:Bi.alphaBlended}depthModeForSublayer(t,s,l){if(!this.opaquePassEnabledForLayer())return qt.disabled;const c=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new qt(l||this.context.gl.LEQUAL,s,[c,c])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,s){this.style=t,this.options=s,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(N.now()),this.imageManager.beginFrame();const l=this.style._order,c=this.style.sourceCaches,f={},b={},w={};for(const E in c){const A=c[E];A.used&&A.prepare(this.context),f[E]=A.getVisibleCoordinates(),b[E]=f[E].slice().reverse(),w[E]=A.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let E=0;E<l.length;E++)if(this.style._layers[l[E]].is3D()){this.opaquePassCutoff=E;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const E of l){const A=this.style._layers[E];if(!A.hasOffscreenPass()||A.isHidden(this.transform.zoom))continue;const M=b[A.source];(A.type==="custom"||M.length)&&this.renderLayer(this,c[A.source],A,M)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?h.aO.black:h.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=l.length-1;this.currentLayer>=0;this.currentLayer--){const E=this.style._layers[l[this.currentLayer]],A=c[E.source],M=f[E.source];this._renderTileClippingMasks(E,M),this.renderLayer(this,A,E,M)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<l.length;this.currentLayer++){const E=this.style._layers[l[this.currentLayer]],A=c[E.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(E))continue;const M=(E.type==="symbol"?w:b)[E.source];this._renderTileClippingMasks(E,f[E.source]),this.renderLayer(this,A,E,M)}if(this.options.showTileBoundaries){const E=function(A,M){let k=null;const O=Object.values(A._layers).flatMap(q=>q.source&&!q.isHidden(M)?[A.sourceCaches[q.source]]:[]),W=O.filter(q=>q.getSource().type==="vector"),Z=O.filter(q=>q.getSource().type!=="vector"),Y=q=>{(!k||k.getSource().maxzoom<q.getSource().maxzoom)&&(k=q)};return W.forEach(q=>Y(q)),k||Z.forEach(q=>Y(q)),k}(this.style,this.transform.zoom);E&&function(A,M,k){for(let O=0;O<k.length;O++)wl(A,M,k[O])}(this,E,E.getVisibleCoordinates())}this.options.showPadding&&function(E){const A=E.transform.padding;Di(E,E.transform.height-(A.top||0),3,iu),Di(E,A.bottom||0,3,ga),Gn(E,A.left||0,3,bl),Gn(E,E.transform.width-(A.right||0),3,ed);const M=E.transform.centerPoint;(function(k,O,W,Z){Sr(k,O-1,W-10,2,20,Z),Sr(k,O-10,W-1,20,2,Z)})(E,M.x,E.transform.height-M.y,ru)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const s=this.terrainFacilitator.matrix,l=this.transform.projMatrix;let c=this.terrainFacilitator.dirty;c||(c=t?!h.aY(s,l):!h.aZ(s,l)),c||(c=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),c&&(h.a_(s,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(f,b){const w=f.context,E=w.gl,A=Bi.unblended,M=new qt(E.LEQUAL,qt.ReadWrite,[0,1]),k=b.getTerrainMesh(),O=b.sourceCache.getRenderableTiles(),W=f.useProgram("terrainDepth");w.bindFramebuffer.set(b.getFramebuffer("depth").framebuffer),w.viewport.set([0,0,f.width/devicePixelRatio,f.height/devicePixelRatio]),w.clear({color:h.aO.transparent,depth:1});for(const Z of O){const Y=b.getTerrainData(Z.tileID),q={u_matrix:f.transform.calculatePosMatrix(Z.tileID.toUnwrapped()),u_ele_delta:b.getMeshFrameDelta(f.transform.zoom)};W.draw(w,E.TRIANGLES,M,_i.disabled,A,fi.backCCW,q,Y,"terrain",k.vertexBuffer,k.indexBuffer,k.segments)}w.bindFramebuffer.set(null),w.viewport.set([0,0,f.width,f.height])}(this,this.style.map.terrain),function(f,b){const w=f.context,E=w.gl,A=Bi.unblended,M=new qt(E.LEQUAL,qt.ReadWrite,[0,1]),k=b.getTerrainMesh(),O=b.getCoordsTexture(),W=b.sourceCache.getRenderableTiles(),Z=f.useProgram("terrainCoords");w.bindFramebuffer.set(b.getFramebuffer("coords").framebuffer),w.viewport.set([0,0,f.width/devicePixelRatio,f.height/devicePixelRatio]),w.clear({color:h.aO.transparent,depth:1}),b.coordsIndex=[];for(const Y of W){const q=b.getTerrainData(Y.tileID);w.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,O.texture);const se={u_matrix:f.transform.calculatePosMatrix(Y.tileID.toUnwrapped()),u_terrain_coords_id:(255-b.coordsIndex.length)/255,u_texture:0,u_ele_delta:b.getMeshFrameDelta(f.transform.zoom)};Z.draw(w,E.TRIANGLES,M,_i.disabled,A,fi.backCCW,se,q,"terrain",k.vertexBuffer,k.indexBuffer,k.segments),b.coordsIndex.push(Y.tileID.key)}w.bindFramebuffer.set(null),w.viewport.set([0,0,f.width,f.height])}(this,this.style.map.terrain))}renderLayer(t,s,l,c){if(!l.isHidden(this.transform.zoom)&&(l.type==="background"||l.type==="custom"||(c||[]).length))switch(this.id=l.id,l.type){case"symbol":(function(f,b,w,E,A){if(f.renderPass!=="translucent")return;const M=_i.disabled,k=f.colorModeForRenderPass();(w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(O,W,Z,Y,q,se,pe){const Q=W.transform,ce=q==="map",fe=se==="map";for(const _e of O){const ve=Y.getTile(_e),ze=ve.getBucket(Z);if(!ze||!ze.text||!ze.text.segments.get().length)continue;const ke=h.ag(ze.textSizeData,Q.zoom),Be=It(ve,1,W.transform.zoom),Ue=Pt(_e.posMatrix,fe,ce,W.transform,Be),Mt=Z.layout.get("icon-text-fit")!=="none"&&ze.hasIconData();if(ke){const qe=Math.pow(2,Q.zoom-ve.tileID.overscaledZ);ua(ze,ce,fe,pe,Q,Ue,_e.posMatrix,qe,ke,Mt,W.style.map.terrain?(St,kt)=>W.style.map.terrain.getElevation(_e,St,kt):null)}}}(E,f,w,b,w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),A),w.paint.get("icon-opacity").constantOr(1)!==0&&da(f,b,w,E,!1,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),w.layout.get("icon-rotation-alignment"),w.layout.get("icon-pitch-alignment"),w.layout.get("icon-keep-upright"),M,k),w.paint.get("text-opacity").constantOr(1)!==0&&da(f,b,w,E,!0,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.layout.get("text-keep-upright"),M,k),b.map.showCollisionBoxes&&(ca(f,b,w,E,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),!0),ca(f,b,w,E,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),!1))})(t,s,l,c,this.style.placement.variableOffsets);break;case"circle":(function(f,b,w,E){if(f.renderPass!=="translucent")return;const A=w.paint.get("circle-opacity"),M=w.paint.get("circle-stroke-width"),k=w.paint.get("circle-stroke-opacity"),O=!w.layout.get("circle-sort-key").isConstant();if(A.constantOr(1)===0&&(M.constantOr(1)===0||k.constantOr(1)===0))return;const W=f.context,Z=W.gl,Y=f.depthModeForSublayer(0,qt.ReadOnly),q=_i.disabled,se=f.colorModeForRenderPass(),pe=[];for(let Q=0;Q<E.length;Q++){const ce=E[Q],fe=b.getTile(ce),_e=fe.getBucket(w);if(!_e)continue;const ve=_e.programConfigurations.get(w.id),ze=f.useProgram("circle",ve),ke=_e.layoutVertexBuffer,Be=_e.indexBuffer,Ue=f.style.map.terrain&&f.style.map.terrain.getTerrainData(ce),Mt={programConfiguration:ve,program:ze,layoutVertexBuffer:ke,indexBuffer:Be,uniformValues:Uh(f,ce,fe,w),terrainData:Ue};if(O){const qe=_e.segments.get();for(const St of qe)pe.push({segments:new h.$([St]),sortKey:St.sortKey,state:Mt})}else pe.push({segments:_e.segments,sortKey:0,state:Mt})}O&&pe.sort((Q,ce)=>Q.sortKey-ce.sortKey);for(const Q of pe){const{programConfiguration:ce,program:fe,layoutVertexBuffer:_e,indexBuffer:ve,uniformValues:ze,terrainData:ke}=Q.state;fe.draw(W,Z.TRIANGLES,Y,q,se,fi.disabled,ze,ke,w.id,_e,ve,Q.segments,w.paint,f.transform.zoom,ce)}})(t,s,l,c);break;case"heatmap":(function(f,b,w,E){if(w.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const A=f.context,M=A.gl,k=_i.disabled,O=new Bi([M.ONE,M.ONE],h.aO.transparent,[!0,!0,!0,!0]);(function(W,Z,Y){const q=W.gl;W.activeTexture.set(q.TEXTURE1),W.viewport.set([0,0,Z.width/4,Z.height/4]);let se=Y.heatmapFbo;if(se)q.bindTexture(q.TEXTURE_2D,se.colorAttachment.get()),W.bindFramebuffer.set(se.framebuffer);else{const pe=q.createTexture();q.bindTexture(q.TEXTURE_2D,pe),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,q.LINEAR),se=Y.heatmapFbo=W.createFramebuffer(Z.width/4,Z.height/4,!1,!1),function(Q,ce,fe,_e){var ve,ze;const ke=Q.gl,Be=(ve=Q.HALF_FLOAT)!==null&&ve!==void 0?ve:ke.UNSIGNED_BYTE,Ue=(ze=Q.RGBA16F)!==null&&ze!==void 0?ze:ke.RGBA;ke.texImage2D(ke.TEXTURE_2D,0,Ue,ce.width/4,ce.height/4,0,ke.RGBA,Be,null),_e.colorAttachment.set(fe)}(W,Z,pe,se)}})(A,f,w),A.clear({color:h.aO.transparent});for(let W=0;W<E.length;W++){const Z=E[W];if(b.hasRenderableParent(Z))continue;const Y=b.getTile(Z),q=Y.getBucket(w);if(!q)continue;const se=q.programConfigurations.get(w.id),pe=f.useProgram("heatmap",se),{zoom:Q}=f.transform;pe.draw(A,M.TRIANGLES,qt.disabled,k,O,fi.disabled,$c(Z.posMatrix,Y,Q,w.paint.get("heatmap-intensity")),null,w.id,q.layoutVertexBuffer,q.indexBuffer,q.segments,w.paint,f.transform.zoom,se)}A.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(A,M){const k=A.context,O=k.gl,W=M.heatmapFbo;if(!W)return;k.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,W.colorAttachment.get()),k.activeTexture.set(O.TEXTURE1);let Z=M.colorRampTexture;Z||(Z=M.colorRampTexture=new gt(k,M.colorRamp,O.RGBA)),Z.bind(O.LINEAR,O.CLAMP_TO_EDGE),A.useProgram("heatmapTexture").draw(k,O.TRIANGLES,qt.disabled,_i.disabled,A.colorModeForRenderPass(),fi.disabled,((Y,q,se,pe)=>{const Q=h.F();h.aN(Q,0,Y.width,Y.height,0,0,1);const ce=Y.context.gl;return{u_matrix:Q,u_world:[ce.drawingBufferWidth,ce.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:q.paint.get("heatmap-opacity")}})(A,M),null,M.id,A.viewportBuffer,A.quadTriangleIndexBuffer,A.viewportSegments,M.paint,A.transform.zoom)}(f,w))})(t,s,l,c);break;case"line":(function(f,b,w,E){if(f.renderPass!=="translucent")return;const A=w.paint.get("line-opacity"),M=w.paint.get("line-width");if(A.constantOr(1)===0||M.constantOr(1)===0)return;const k=f.depthModeForSublayer(0,qt.ReadOnly),O=f.colorModeForRenderPass(),W=w.paint.get("line-dasharray"),Z=w.paint.get("line-pattern"),Y=Z.constantOr(1),q=w.paint.get("line-gradient"),se=w.getCrossfadeParameters(),pe=Y?"linePattern":W?"lineSDF":q?"lineGradient":"line",Q=f.context,ce=Q.gl;let fe=!0;for(const _e of E){const ve=b.getTile(_e);if(Y&&!ve.patternsLoaded())continue;const ze=ve.getBucket(w);if(!ze)continue;const ke=ze.programConfigurations.get(w.id),Be=f.context.program.get(),Ue=f.useProgram(pe,ke),Mt=fe||Ue.program!==Be,qe=f.style.map.terrain&&f.style.map.terrain.getTerrainData(_e),St=Z.constantOr(null);if(St&&ve.imageAtlas){const Et=ve.imageAtlas,zt=Et.patternPositions[St.to.toString()],Ot=Et.patternPositions[St.from.toString()];zt&&Ot&&ke.setConstantPatternPositions(zt,Ot)}const kt=qe?_e:null,Gt=Y?as(f,ve,w,se,kt):W?ea(f,ve,w,W,se,kt):q?jc(f,ve,w,ze.lineClipsArray.length,kt):Qo(f,ve,w,kt);if(Y)Q.activeTexture.set(ce.TEXTURE0),ve.imageAtlasTexture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE),ke.updatePaintBuffers(se);else if(W&&(Mt||f.lineAtlas.dirty))Q.activeTexture.set(ce.TEXTURE0),f.lineAtlas.bind(Q);else if(q){const Et=ze.gradients[w.id];let zt=Et.texture;if(w.gradientVersion!==Et.version){let Ot=256;if(w.stepInterpolant){const Ri=b.getSource().maxzoom,ci=_e.canonical.z===Ri?Math.ceil(1<<f.transform.maxZoom-_e.canonical.z):1;Ot=h.ac(h.aT(ze.maxLineLength/h.W*1024*ci),256,Q.maxTextureSize)}Et.gradient=h.aU({expression:w.gradientExpression(),evaluationKey:"lineProgress",resolution:Ot,image:Et.gradient||void 0,clips:ze.lineClipsArray}),Et.texture?Et.texture.update(Et.gradient):Et.texture=new gt(Q,Et.gradient,ce.RGBA),Et.version=w.gradientVersion,zt=Et.texture}Q.activeTexture.set(ce.TEXTURE0),zt.bind(w.stepInterpolant?ce.NEAREST:ce.LINEAR,ce.CLAMP_TO_EDGE)}Ue.draw(Q,ce.TRIANGLES,k,f.stencilModeForClipping(_e),O,fi.disabled,Gt,qe,w.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,w.paint,f.transform.zoom,ke,ze.layoutVertexBuffer2),fe=!1}})(t,s,l,c);break;case"fill":(function(f,b,w,E){const A=w.paint.get("fill-color"),M=w.paint.get("fill-opacity");if(M.constantOr(1)===0)return;const k=f.colorModeForRenderPass(),O=w.paint.get("fill-pattern"),W=f.opaquePassEnabledForLayer()&&!O.constantOr(1)&&A.constantOr(h.aO.transparent).a===1&&M.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===W){const Z=f.depthModeForSublayer(1,f.renderPass==="opaque"?qt.ReadWrite:qt.ReadOnly);eu(f,b,w,E,Z,k,!1)}if(f.renderPass==="translucent"&&w.paint.get("fill-antialias")){const Z=f.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,qt.ReadOnly);eu(f,b,w,E,Z,k,!0)}})(t,s,l,c);break;case"fill-extrusion":(function(f,b,w,E){const A=w.paint.get("fill-extrusion-opacity");if(A!==0&&f.renderPass==="translucent"){const M=new qt(f.context.gl.LEQUAL,qt.ReadWrite,f.depthRangeFor3D);if(A!==1||w.paint.get("fill-extrusion-pattern").constantOr(1))fa(f,b,w,E,M,_i.disabled,Bi.disabled),fa(f,b,w,E,M,f.stencilModeFor3D(),f.colorModeForRenderPass());else{const k=f.colorModeForRenderPass();fa(f,b,w,E,M,_i.disabled,k)}}})(t,s,l,c);break;case"hillshade":(function(f,b,w,E){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent")return;const A=f.context,M=f.depthModeForSublayer(0,qt.ReadOnly),k=f.colorModeForRenderPass(),[O,W]=f.renderPass==="translucent"?f.stencilConfigForOverlap(E):[{},E];for(const Z of W){const Y=b.getTile(Z);Y.needsHillshadePrepare!==void 0&&Y.needsHillshadePrepare&&f.renderPass==="offscreen"?vl(f,Y,w,M,_i.disabled,k):f.renderPass==="translucent"&&ma(f,Z,Y,w,M,O[Z.overscaledZ],k)}A.viewport.set([0,0,f.width,f.height])})(t,s,l,c);break;case"raster":(function(f,b,w,E){if(f.renderPass!=="translucent"||w.paint.get("raster-opacity")===0||!E.length)return;const A=f.context,M=A.gl,k=b.getSource(),O=f.useProgram("raster"),W=f.colorModeForRenderPass(),[Z,Y]=k instanceof Oe?[{},E]:f.stencilConfigForOverlap(E),q=Y[Y.length-1].overscaledZ,se=!f.options.moving;for(const pe of Y){const Q=f.depthModeForSublayer(pe.overscaledZ-q,w.paint.get("raster-opacity")===1?qt.ReadWrite:qt.ReadOnly,M.LESS),ce=b.getTile(pe);ce.registerFadeDuration(w.paint.get("raster-fade-duration"));const fe=b.findLoadedParent(pe,0),_e=tu(ce,fe,b,w,f.transform,f.style.map.terrain);let ve,ze;const ke=w.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;A.activeTexture.set(M.TEXTURE0),ce.texture.bind(ke,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),A.activeTexture.set(M.TEXTURE1),fe?(fe.texture.bind(ke,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),ve=Math.pow(2,fe.tileID.overscaledZ-ce.tileID.overscaledZ),ze=[ce.tileID.canonical.x*ve%1,ce.tileID.canonical.y*ve%1]):ce.texture.bind(ke,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST);const Be=f.style.map.terrain&&f.style.map.terrain.getTerrainData(pe),Ue=Be?pe:null,Mt=Ue?Ue.posMatrix:f.transform.calculatePosMatrix(pe.toUnwrapped(),se),qe=ta(Mt,ze||[0,0],ve||1,_e,w);k instanceof Oe?O.draw(A,M.TRIANGLES,Q,_i.disabled,W,fi.disabled,qe,Be,w.id,k.boundsBuffer,f.quadTriangleIndexBuffer,k.boundsSegments):O.draw(A,M.TRIANGLES,Q,Z[pe.overscaledZ],W,fi.disabled,qe,Be,w.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}})(t,s,l,c);break;case"background":(function(f,b,w,E){const A=w.paint.get("background-color"),M=w.paint.get("background-opacity");if(M===0)return;const k=f.context,O=k.gl,W=f.transform,Z=W.tileSize,Y=w.paint.get("background-pattern");if(f.isPatternMissing(Y))return;const q=!Y&&A.a===1&&M===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==q)return;const se=_i.disabled,pe=f.depthModeForSublayer(0,q==="opaque"?qt.ReadWrite:qt.ReadOnly),Q=f.colorModeForRenderPass(),ce=f.useProgram(Y?"backgroundPattern":"background"),fe=E||W.coveringTiles({tileSize:Z,terrain:f.style.map.terrain});Y&&(k.activeTexture.set(O.TEXTURE0),f.imageManager.bind(f.context));const _e=w.getCrossfadeParameters();for(const ve of fe){const ze=E?ve.posMatrix:f.transform.calculatePosMatrix(ve.toUnwrapped()),ke=Y?qh(ze,M,f,Y,{tileID:ve,tileSize:Z},_e):jh(ze,M,A),Be=f.style.map.terrain&&f.style.map.terrain.getTerrainData(ve);ce.draw(k,O.TRIANGLES,pe,se,Q,fi.disabled,ke,Be,w.id,f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}})(t,0,l,c);break;case"custom":(function(f,b,w){const E=f.context,A=w.implementation;if(f.renderPass==="offscreen"){const M=A.prerender;M&&(f.setCustomLayerDefaults(),E.setColorMode(f.colorModeForRenderPass()),M.call(A,E.gl,f.transform.customLayerMatrix()),E.setDirty(),f.setBaseState())}else if(f.renderPass==="translucent"){f.setCustomLayerDefaults(),E.setColorMode(f.colorModeForRenderPass()),E.setStencilMode(_i.disabled);const M=A.renderingMode==="3d"?new qt(f.context.gl.LEQUAL,qt.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,qt.ReadOnly);E.setDepthMode(M),A.render(E.gl,f.transform.customLayerMatrix()),E.setDirty(),f.setBaseState(),E.bindFramebuffer.set(null)}})(t,0,l)}}translatePosMatrix(t,s,l,c,f){if(!l[0]&&!l[1])return t;const b=f?c==="map"?this.transform.angle:0:c==="viewport"?-this.transform.angle:0;if(b){const A=Math.sin(b),M=Math.cos(b);l=[l[0]*M-l[1]*A,l[0]*A+l[1]*M]}const w=[f?l[0]:It(s,l[0],this.transform.zoom),f?l[1]:It(s,l[1],this.transform.zoom),0],E=new Float32Array(16);return h.H(E,t,w),E}saveTileTexture(t){const s=this._tileTextures[t.size[0]];s?s.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const s=this.imageManager.getPattern(t.from.toString()),l=this.imageManager.getPattern(t.to.toString());return!s||!l}useProgram(t,s){this.cache=this.cache||{};const l=t+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[l]||(this.cache[l]=new qn(this.context,co[t],s,qc[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[l]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new gt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:s}=this.context.gl;return this.width!==t||this.height!==s}}class Hn{constructor(t,s){this.points=t,this.planes=s}static fromInvProjectionMatrix(t,s,l){const c=Math.pow(2,l),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const E=1/(w=h.af([],w,t))[3]/s*c;return h.a$(w,w,[E,E,1/w[3],E])}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const E=function(O,W){var Z=W[0],Y=W[1],q=W[2],se=Z*Z+Y*Y+q*q;return se>0&&(se=1/Math.sqrt(se)),O[0]=W[0]*se,O[1]=W[1]*se,O[2]=W[2]*se,O}([],function(O,W,Z){var Y=W[0],q=W[1],se=W[2],pe=Z[0],Q=Z[1],ce=Z[2];return O[0]=q*ce-se*Q,O[1]=se*pe-Y*ce,O[2]=Y*Q-q*pe,O}([],tt([],f[w[0]],f[w[1]]),tt([],f[w[2]],f[w[1]]))),A=-((M=E)[0]*(k=f[w[1]])[0]+M[1]*k[1]+M[2]*k[2]);var M,k;return E.concat(A)});return new Hn(f,b)}}class Zn{constructor(t,s){this.min=t,this.max=s,this.center=function(l,c,f){return l[0]=.5*c[0],l[1]=.5*c[1],l[2]=.5*c[2],l}([],function(l,c,f){return l[0]=c[0]+f[0],l[1]=c[1]+f[1],l[2]=c[2]+f[2],l}([],this.min,this.max))}quadrant(t){const s=[t%2==0,t<2],l=ct(this.min),c=ct(this.max);for(let f=0;f<s.length;f++)l[f]=s[f]?this.min[f]:this.center[f],c[f]=s[f]?this.center[f]:this.max[f];return c[2]=this.max[2],new Zn(l,c)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let l=!0;for(let c=0;c<t.planes.length;c++){const f=t.planes[c];let b=0;for(let w=0;w<s.length;w++)h.b0(f,s[w])>=0&&b++;if(b===0)return 0;b!==s.length&&(l=!1)}if(l)return 2;for(let c=0;c<3;c++){let f=Number.MAX_VALUE,b=-Number.MAX_VALUE;for(let w=0;w<t.points.length;w++){const E=t.points[w][c]-this.min[c];f=Math.min(f,E),b=Math.max(b,E)}if(b<0||f>this.max[c]-this.min[c])return 0}return 1}}class zs{constructor(t=0,s=0,l=0,c=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(l)||l<0||isNaN(c)||c<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=l,this.right=c}interpolate(t,s,l){return s.top!=null&&t.top!=null&&(this.top=h.z.number(t.top,s.top,l)),s.bottom!=null&&t.bottom!=null&&(this.bottom=h.z.number(t.bottom,s.bottom,l)),s.left!=null&&t.left!=null&&(this.left=h.z.number(t.left,s.left,l)),s.right!=null&&t.right!=null&&(this.right=h.z.number(t.right,s.right,l)),this}getCenter(t,s){const l=h.ac((this.left+t-this.right)/2,0,t),c=h.ac((this.top+s-this.bottom)/2,0,s);return new h.P(l,c)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new zs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Sl=85.051129;class ya{constructor(t,s,l,c,f){this.tileSize=512,this._renderWorldCopies=f===void 0||!!f,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=l??0,this._maxPitch=c??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new h.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new zs,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const t=new ya(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this.minElevationForCurrentTile=t.minElevationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new h.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const s=-h.b1(t,-180,180)*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=function(){var l=new h.A(4);return h.A!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l}(),function(l,c,f){var b=c[0],w=c[1],E=c[2],A=c[3],M=Math.sin(f),k=Math.cos(f);l[0]=b*k+E*M,l[1]=w*k+A*M,l[2]=b*-M+E*k,l[3]=w*-M+A*k}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const s=h.ac(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.tileZoom=Math.max(0,Math.floor(s)),this.scale=this.zoomScale(s),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,l){this._unmodified=!1,this._edgeInsets.interpolate(t,s,l),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){const s=[new h.b2(0,t)];if(this._renderWorldCopies){const l=this.pointCoordinate(new h.P(0,0)),c=this.pointCoordinate(new h.P(this.width,0)),f=this.pointCoordinate(new h.P(this.width,this.height)),b=this.pointCoordinate(new h.P(0,this.height)),w=Math.floor(Math.min(l.x,c.x,f.x,b.x)),E=Math.floor(Math.max(l.x,c.x,f.x,b.x)),A=1;for(let M=w-A;M<=E+A;M++)M!==0&&s.push(new h.b2(M,t))}return s}coveringTiles(t){var s,l;let c=this.coveringZoomLevel(t);const f=c;if(t.minzoom!==void 0&&c<t.minzoom)return[];t.maxzoom!==void 0&&c>t.maxzoom&&(c=t.maxzoom);const b=this.pointCoordinate(this.getCameraPoint()),w=h.Y.fromLngLat(this.center),E=Math.pow(2,c),A=[E*b.x,E*b.y,0],M=[E*w.x,E*w.y,0],k=Hn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c);let O=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(O=c);const W=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,Z=Q=>({aabb:new Zn([Q*E,0,0],[(Q+1)*E,E,0]),zoom:0,x:0,y:0,wrap:Q,fullyVisible:!1}),Y=[],q=[],se=c,pe=t.reparseOverscaled?f:c;if(this._renderWorldCopies)for(let Q=1;Q<=3;Q++)Y.push(Z(-Q)),Y.push(Z(Q));for(Y.push(Z(0));Y.length>0;){const Q=Y.pop(),ce=Q.x,fe=Q.y;let _e=Q.fullyVisible;if(!_e){const Ue=Q.aabb.intersects(k);if(Ue===0)continue;_e=Ue===2}const ve=t.terrain?A:M,ze=Q.aabb.distanceX(ve),ke=Q.aabb.distanceY(ve),Be=Math.max(Math.abs(ze),Math.abs(ke));if(Q.zoom===se||Be>W+(1<<se-Q.zoom)-2&&Q.zoom>=O){const Ue=se-Q.zoom,Mt=A[0]-.5-(ce<<Ue),qe=A[1]-.5-(fe<<Ue);q.push({tileID:new h.Q(Q.zoom===se?pe:Q.zoom,Q.wrap,Q.zoom,ce,fe),distanceSq:ot([M[0]-.5-ce,M[1]-.5-fe]),tileDistanceToCamera:Math.sqrt(Mt*Mt+qe*qe)})}else for(let Ue=0;Ue<4;Ue++){const Mt=(ce<<1)+Ue%2,qe=(fe<<1)+(Ue>>1),St=Q.zoom+1;let kt=Q.aabb.quadrant(Ue);if(t.terrain){const Gt=new h.Q(St,Q.wrap,St,Mt,qe),Et=t.terrain.getMinMaxElevation(Gt),zt=(s=Et.minElevation)!==null&&s!==void 0?s:this.elevation,Ot=(l=Et.maxElevation)!==null&&l!==void 0?l:this.elevation;kt=new Zn([kt.min[0],kt.min[1],zt],[kt.max[0],kt.max[1],Ot])}Y.push({aabb:kt,zoom:St,x:Mt,y:qe,wrap:Q.wrap,fullyVisible:_e})}}return q.sort((Q,ce)=>Q.distanceSq-ce.distanceSq).map(Q=>Q.tileID)}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const s=h.ac(t.lat,-85.051129,Sl);return new h.P(h.N(t.lng)*this.worldSize,h.O(s)*this.worldSize)}unproject(t){return new h.Y(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const s=this.elevation,l=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,c=this.pointLocation(this.centerPoint,t),f=t.getElevationForLngLatZoom(c,this.tileZoom);if(!(this.elevation-f))return;const b=l+s-f,w=Math.cos(this._pitch)*this.cameraToCenterDistance/b/h.b3(1,c.lat),E=this.scaleZoom(w/this.tileSize);this._elevation=f,this._center=c,this.zoom=E}setLocationAtPoint(t,s){const l=this.pointCoordinate(s),c=this.pointCoordinate(this.centerPoint),f=this.locationCoordinate(t),b=new h.Y(f.x-(l.x-c.x),f.y-(l.y-c.y));this.center=this.coordinateLocation(b),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,s){return s?this.coordinatePoint(this.locationCoordinate(t),s.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,s){return this.coordinateLocation(this.pointCoordinate(t,s))}locationCoordinate(t){return h.Y.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,s){if(s){const O=s.pointCoordinate(t);if(O!=null)return O}const l=[t.x,t.y,0,1],c=[t.x,t.y,1,1];h.af(l,l,this.pixelMatrixInverse),h.af(c,c,this.pixelMatrixInverse);const f=l[3],b=c[3],w=l[1]/f,E=c[1]/b,A=l[2]/f,M=c[2]/b,k=A===M?0:(0-A)/(M-A);return new h.Y(h.z.number(l[0]/f,c[0]/b,k)/this.worldSize,h.z.number(w,E,k)/this.worldSize)}coordinatePoint(t,s=0,l=this.pixelMatrix){const c=[t.x*this.worldSize,t.y*this.worldSize,s,1];return h.af(c,c,l),new h.P(c[0]/c[3],c[1]/c[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new ie().extend(this.pointLocation(new h.P(0,t))).extend(this.pointLocation(new h.P(this.width,t))).extend(this.pointLocation(new h.P(this.width,this.height))).extend(this.pointLocation(new h.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new ie([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Sl])}calculatePosMatrix(t,s=!1){const l=t.key,c=s?this._alignedPosMatrixCache:this._posMatrixCache;if(c[l])return c[l];const f=t.canonical,b=this.worldSize/this.zoomScale(f.z),w=f.x+Math.pow(2,f.z)*t.wrap,E=h.an(new Float64Array(16));return h.H(E,E,[w*b,f.y*b,0]),h.J(E,E,[b/h.W,b/h.W,1]),h.K(E,s?this.alignedProjMatrix:this.projMatrix,E),c[l]=new Float32Array(E),c[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(t,s){s=h.ac(+s,this.minZoom,this.maxZoom);const l={center:new h.M(t.lng,t.lat),zoom:s};let c=this.lngRange;if(!this._renderWorldCopies&&c===null){const Q=179.9999999999;c=[-Q,Q]}const f=this.tileSize*this.zoomScale(l.zoom);let b=0,w=f,E=0,A=f,M=0,k=0;const{x:O,y:W}=this.size;if(this.latRange){const Q=this.latRange;b=h.O(Q[1])*f,w=h.O(Q[0])*f,w-b<W&&(M=W/(w-b))}c&&(E=h.b1(h.N(c[0])*f,0,f),A=h.b1(h.N(c[1])*f,0,f),A<E&&(A+=f),A-E<O&&(k=O/(A-E)));const{x:Z,y:Y}=this.project.call({worldSize:f},t);let q,se;const pe=Math.max(k||0,M||0);if(pe){const Q=new h.P(k?(A+E)/2:Z,M?(w+b)/2:Y);return l.center=this.unproject.call({worldSize:f},Q).wrap(),l.zoom+=this.scaleZoom(pe),l}if(this.latRange){const Q=W/2;Y-Q<b&&(se=b+Q),Y+Q>w&&(se=w-Q)}if(c){const Q=(E+A)/2;let ce=Z;this._renderWorldCopies&&(ce=h.b1(Z,Q-f/2,Q+f/2));const fe=O/2;ce-fe<E&&(q=E+fe),ce+fe>A&&(q=A-fe)}if(q!==void 0||se!==void 0){const Q=new h.P(q??Z,se??Y);l.center=this.unproject.call({worldSize:f},Q).wrap()}return l}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:s,zoom:l}=this.getConstrained(this.center,this.zoom);this.center=s,this.zoom=l,this._unmodified=t,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,s=this.point.x,l=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=h.b3(1,this.center.lat)*this.worldSize;let c=h.an(new Float64Array(16));h.J(c,c,[this.width/2,-this.height/2,1]),h.H(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=h.an(new Float64Array(16)),h.J(c,c,[1,-1,1]),h.H(c,c,[-1,-1,0]),h.J(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c;const f=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),b=Math.min(this.elevation,this.minElevationForCurrentTile),w=f-b*this._pixelPerMeter/Math.cos(this._pitch),E=b<0?w:f,A=Math.PI/2+this._pitch,M=this._fov*(.5+t.y/this.height),k=Math.sin(M)*E/Math.sin(h.ac(Math.PI-A-M,.01,Math.PI-.01)),O=this.getHorizon(),W=2*Math.atan(O/this.cameraToCenterDistance)*(.5+t.y/(2*O)),Z=Math.sin(W)*E/Math.sin(h.ac(Math.PI-A-W,.01,Math.PI-.01)),Y=Math.min(k,Z),q=1.01*(Math.cos(Math.PI/2-this._pitch)*Y+E),se=this.height/50;c=new Float64Array(16),h.b4(c,this._fov,this.width/this.height,se,q),c[8]=2*-t.x/this.width,c[9]=2*t.y/this.height,h.J(c,c,[1,-1,1]),h.H(c,c,[0,0,-this.cameraToCenterDistance]),h.b5(c,c,this._pitch),h.ad(c,c,this.angle),h.H(c,c,[-s,-l,0]),this.mercatorMatrix=h.J([],c,[this.worldSize,this.worldSize,this.worldSize]),h.J(c,c,[1,1,this._pixelPerMeter]),this.pixelMatrix=h.K(new Float64Array(16),this.labelPlaneMatrix,c),h.H(c,c,[0,0,-this.elevation]),this.projMatrix=c,this.invProjMatrix=h.ar([],c),this.pixelMatrix3D=h.K(new Float64Array(16),this.labelPlaneMatrix,c);const pe=this.width%2/2,Q=this.height%2/2,ce=Math.cos(this.angle),fe=Math.sin(this.angle),_e=s-Math.round(s)+ce*pe+fe*Q,ve=l-Math.round(l)+ce*Q+fe*pe,ze=new Float64Array(c);if(h.H(ze,ze,[_e>.5?_e-1:_e,ve>.5?ve-1:ve,0]),this.alignedProjMatrix=ze,c=h.ar(new Float64Array(16),this.pixelMatrix),!c)throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new h.P(0,0)),s=[t.x*this.worldSize,t.y*this.worldSize,0,1];return h.af(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new h.P(0,t))}getCameraQueryGeometry(t){const s=this.getCameraPoint();if(t.length===1)return[t[0],s];{let l=s.x,c=s.y,f=s.x,b=s.y;for(const w of t)l=Math.min(l,w.x),c=Math.min(c,w.y),f=Math.max(f,w.x),b=Math.max(b,w.y);return[new h.P(l,c),new h.P(f,c),new h.P(f,b),new h.P(l,b),new h.P(l,c)]}}lngLatToCameraDepth(t,s){const l=this.locationCoordinate(t),c=[l.x*this.worldSize,l.y*this.worldSize,s,1];return h.af(c,c,this.projMatrix),c[2]/c[3]}}function Tl(p,t){let s,l=!1,c=null,f=null;const b=()=>{c=null,l&&(p.apply(f,s),c=setTimeout(b,t),l=!1)};return(...w)=>(l=!0,f=this,s=w,c||b(),c)}class El{constructor(t){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let l;return s.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(l=c)}),(l&&l[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(s.length>=3&&!s.some(l=>isNaN(l))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:l,pitch:+(s[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,s)}catch{}},this._updateHash=Tl(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const s=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,c=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),f=Math.pow(10,c),b=Math.round(s.lng*f)/f,w=Math.round(s.lat*f)/f,E=this._map.getBearing(),A=this._map.getPitch();let M="";if(M+=t?`/${b}/${w}/${l}`:`${l}/${w}/${b}`,(E||A)&&(M+="/"+Math.round(10*E)/10),A&&(M+=`/${Math.round(A)}`),this._hashName){const k=this._hashName;let O=!1;const W=window.location.hash.slice(1).split("&").map(Z=>{const Y=Z.split("=")[0];return Y===k?(O=!0,`${Y}=${M}`):Z}).filter(Z=>Z);return O||W.push(`${k}=${M}`),`#${W.join("&")}`}return`#${M}`}}const yo={linearity:.3,easing:h.b6(0,0,.3,1)},hs=h.e({deceleration:2500,maxSpeed:1400},yo),su=h.e({deceleration:20,maxSpeed:1400},yo),ou=h.e({deceleration:1e3,maxSpeed:360},yo),au=h.e({deceleration:1e3,maxSpeed:90},yo);class lu{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:N.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=N.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new h.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:f}of this._inertiaBuffer)s.zoom+=f.zoomDelta||0,s.bearing+=f.bearingDelta||0,s.pitch+=f.pitchDelta||0,f.panDelta&&s.pan._add(f.panDelta),f.around&&(s.around=f.around),f.pinchAround&&(s.pinchAround=f.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,c={};if(s.pan.mag()){const f=vo(s.pan.mag(),l,h.e({},hs,t||{}));c.offset=s.pan.mult(f.amount/s.pan.mag()),c.center=this._map.transform.center,xo(c,f)}if(s.zoom){const f=vo(s.zoom,l,su);c.zoom=this._map.transform.zoom+f.amount,xo(c,f)}if(s.bearing){const f=vo(s.bearing,l,ou);c.bearing=this._map.transform.bearing+h.ac(f.amount,-179,179),xo(c,f)}if(s.pitch){const f=vo(s.pitch,l,au);c.pitch=this._map.transform.pitch+f.amount,xo(c,f)}if(c.zoom||c.bearing){const f=s.pinchAround===void 0?s.around:s.pinchAround;c.around=f?this._map.unproject(f):this._map.getCenter()}return this.clear(),h.e(c,{noMoveStart:!0})}}function xo(p,t){(!p.duration||p.duration<t.duration)&&(p.duration=t.duration,p.easing=t.easing)}function vo(p,t,s){const{maxSpeed:l,linearity:c,deceleration:f}=s,b=h.ac(p*c/(t/1e3),-l,l),w=Math.abs(b)/(f*c);return{easing:s.easing,duration:1e3*w,amount:b*(w/2)}}class zr extends h.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,l,c={}){const f=$.mousePos(s.getCanvas(),l),b=s.unproject(f);super(t,h.e({point:f,lngLat:b,originalEvent:l},c)),this._defaultPrevented=!1,this.target=s}}class wn extends h.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,l){const c=t==="touchend"?l.changedTouches:l.touches,f=$.touchPos(s.getCanvasContainer(),c),b=f.map(E=>s.unproject(E)),w=f.reduce((E,A,M,k)=>E.add(A.div(k.length)),new h.P(0,0));super(t,{points:f,point:w,lngLats:b,lngLat:s.unproject(w),originalEvent:l}),this._defaultPrevented=!1}}class Il extends h.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,l){super(t,{originalEvent:l}),this._defaultPrevented=!1}}class hn{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Il(t.type,this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new zr(t.type,this._map,t))}mouseup(t){this._map.fire(new zr(t.type,this._map,t))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new zr(t.type,this._map,t))}dblclick(t){return this._firePreventable(new zr(t.type,this._map,t))}mouseover(t){this._map.fire(new zr(t.type,this._map,t))}mouseout(t){this._map.fire(new zr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new wn(t.type,this._map,t))}touchmove(t){this._map.fire(new wn(t.type,this._map,t))}touchend(t){this._map.fire(new wn(t.type,this._map,t))}touchcancel(t){this._map.fire(new wn(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Sn{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new zr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new zr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new zr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Rs{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(h.P.convert(t),this._map.terrain)}}class dn{constructor(t,s){this._map=t,this._tr=new Rs(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&($.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const l=s;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const c=this._startPos;this._lastPos=l,this._box||(this._box=$.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const f=Math.min(c.x,l.x),b=Math.max(c.x,l.x),w=Math.min(c.y,l.y),E=Math.max(c.y,l.y);$.setTransform(this._box,`translate(${f}px,${w}px)`),this._box.style.width=b-f+"px",this._box.style.height=E-w+"px"}mouseupWindow(t,s){if(!this._active||t.button!==0)return;const l=this._startPos,c=s;if(this.reset(),$.suppressClick(),l.x!==c.x||l.y!==c.y)return this._map.fire(new h.k("boxzoomend",{originalEvent:t})),{cameraAnimation:f=>f.fitScreenCoordinates(l,c,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&($.remove(this._box),this._box=null),$.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new h.k(t,{originalEvent:s}))}}function ds(p,t){if(p.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${p.length}, points ${t.length}`);const s={};for(let l=0;l<p.length;l++)s[p[l].identifier]=t[l];return s}class td{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,s,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),l.length===this.numTouches&&(this.centroid=function(c){const f=new h.P(0,0);for(const b of c)f._add(b);return f.div(c.length)}(s),this.touches=ds(l,s)))}touchmove(t,s,l){if(this.aborted||!this.centroid)return;const c=ds(l,s);for(const f in this.touches){const b=c[f];(!b||b.dist(this.touches[f])>30)&&(this.aborted=!0)}}touchend(t,s,l){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const c=!this.aborted&&this.centroid;if(this.reset(),c)return c}}}class Al{constructor(t){this.singleTap=new td(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,s,l){this.singleTap.touchstart(t,s,l)}touchmove(t,s,l){this.singleTap.touchmove(t,s,l)}touchend(t,s,l){const c=this.singleTap.touchend(t,s,l);if(c){const f=t.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(c)<30;if(f&&b||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=c,this.count===this.numTaps)return this.reset(),c}}}class id{constructor(t){this._tr=new Rs(t),this._zoomIn=new Al({numTouches:1,numTaps:2}),this._zoomOut=new Al({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,l){this._zoomIn.touchstart(t,s,l),this._zoomOut.touchstart(t,s,l)}touchmove(t,s,l){this._zoomIn.touchmove(t,s,l),this._zoomOut.touchmove(t,s,l)}touchend(t,s,l){const c=this._zoomIn.touchend(t,s,l),f=this._zoomOut.touchend(t,s,l),b=this._tr;return c?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:b.zoom+1,around:b.unproject(c)},{originalEvent:t})}):f?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:b.zoom-1,around:b.unproject(f)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ls{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const s=this._moveFunction(...t);if(s.bearingDelta||s.pitchDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(t,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=s.length?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,s){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const c=s.length?s[0]:s;return!this._moved&&c.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=c,this._move(l,c))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&$.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const bo={0:1,2:2};class Tn{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const s=$.mouseButton(t);this._eventButton=s}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(s,l){const c=bo[l];return s.buttons===void 0||(s.buttons&c)!==c}(t,this._eventButton)}isValidEndEvent(t){return $.mouseButton(t)===this._eventButton}}class rt{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const xa=p=>{p.mousedown=p.dragStart,p.mousemoveWindow=p.dragMove,p.mouseup=p.dragEnd,p.contextmenu=function(t){t.preventDefault()}},Fs=({enable:p,clickTolerance:t,bearingDegreesPerPixelMoved:s=.8})=>{const l=new Tn({checkCorrectEvent:c=>$.mouseButton(c)===0&&c.ctrlKey||$.mouseButton(c)===2});return new Ls({clickTolerance:t,move:(c,f)=>({bearingDelta:(f.x-c.x)*s}),moveStateManager:l,enable:p,assignEvents:xa})},Os=({enable:p,clickTolerance:t,pitchDegreesPerPixelMoved:s=-.5})=>{const l=new Tn({checkCorrectEvent:c=>$.mouseButton(c)===0&&c.ctrlKey||$.mouseButton(c)===2});return new Ls({clickTolerance:t,move:(c,f)=>({pitchDelta:(f.y-c.y)*s}),moveStateManager:l,enable:p,assignEvents:xa})};class cu{constructor(t,s){this._clickTolerance=t.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new h.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(t,s,l){return this._calculateTransform(t,s,l)}touchmove(t,s,l){if(this._active&&!(l.length<this.minTouchs()))return t.preventDefault(),this._calculateTransform(t,s,l)}touchend(t,s,l){this._calculateTransform(t,s,l),this._active&&l.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,l){l.length>0&&(this._active=!0);const c=ds(l,s),f=new h.P(0,0),b=new h.P(0,0);let w=0;for(const A in c){const M=c[A],k=this._touches[A];k&&(f._add(M),b._add(M.sub(k)),w++,c[A]=M)}if(this._touches=c,w<this.minTouchs()||!b.mag())return;const E=b.div(w);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:f.div(w),panDelta:E}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xe{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,s,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,l){if(!this._firstTwoTouches)return;t.preventDefault();const[c,f]=this._firstTwoTouches,b=Bs(l,s,c),w=Bs(l,s,f);if(!b||!w)return;const E=this._aroundCenter?null:b.add(w).div(2);return this._move([b,w],E,t)}touchend(t,s,l){if(!this._firstTwoTouches)return;const[c,f]=this._firstTwoTouches,b=Bs(l,s,c),w=Bs(l,s,f);b&&w||(this._active&&$.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Bs(p,t,s){for(let l=0;l<p.length;l++)if(p[l].identifier===s)return t[l]}function uu(p,t){return Math.log(p/t)/Math.LN2}class hu extends Xe{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const l=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(uu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:uu(this._distance,l),pinchAround:s}}}function va(p,t){return 180*p.angleWith(t)/Math.PI}class Pl extends Xe{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s,l){const c=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:va(this._vector,c),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,l=va(t,this._startVector);return Math.abs(l)<s}}function ba(p){return Math.abs(p.y)>Math.abs(p.x)}class du extends Xe{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,s,l){super.touchstart(t,s,l),this._currentTouchCount=l.length}_start(t){this._lastPoints=t,ba(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const c=t[0].sub(this._lastPoints[0]),f=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(c,f,l.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(c.y+f.y)/2*-.5}):void 0}gestureBeginsVertically(t,s,l){if(this._valid!==void 0)return this._valid;const c=t.mag()>=2,f=s.mag()>=2;if(!c&&!f)return;if(!c||!f)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const b=t.y>0==s.y>0;return ba(t)&&ba(s)&&b}}const rd={panStep:100,bearingStep:15,pitchStep:10};class Wn{constructor(t){this._tr=new Rs(t);const s=rd;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,l=0,c=0,f=0,b=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?l=-1:(t.preventDefault(),f=-1);break;case 39:t.shiftKey?l=1:(t.preventDefault(),f=1);break;case 38:t.shiftKey?c=1:(t.preventDefault(),b=-1);break;case 40:t.shiftKey?c=-1:(t.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(l=0,c=0),{cameraAnimation:w=>{const E=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:Ti,zoom:s?Math.round(E.zoom)+s*(t.shiftKey?2:1):E.zoom,bearing:E.bearing+l*this._bearingStep,pitch:E.pitch+c*this._pitchStep,offset:[-f*this._panStep,-b*this._panStep],center:E.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ti(p){return p*(2-p)}const wo=4.000244140625;class wa{constructor(t,s){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=t,this._tr=new Rs(t),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!t[this._map.cooperativeGestures._bypassKey])return;let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const l=N.now(),c=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,s!==0&&s%wo==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":c>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(c*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=$.mousePos(this._map.getCanvas(),t),l=this._tr;this._around=s.y>l.transform.height/2-l.transform.getHorizon()?h.M.convert(this._aroundCenter?l.center:l.unproject(s)):h.M.convert(l.center),this._aroundPoint=l.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const w=this._type==="wheel"&&Math.abs(this._delta)>wo?this._wheelZoomRate:this._defaultZoomRate;let E=2/(1+Math.exp(-Math.abs(this._delta*w)));this._delta<0&&E!==0&&(E=1/E);const A=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(A*E))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,l=this._startZoom,c=this._easing;let f,b=!1;if(this._type==="wheel"&&l&&c){const w=Math.min((N.now()-this._lastWheelEventTime)/200,1),E=c(w);f=h.z.number(l,s,E),w<1?this._frameId||(this._frameId=!0):b=!0}else f=s,b=!0;return this._active=!0,b&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!b,zoomDelta:f-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=h.b7;if(this._prevEase){const l=this._prevEase,c=(N.now()-l.start)/l.duration,f=l.easing(c+.01)-l.easing(c),b=.27/Math.sqrt(f*f+1e-4)*.01,w=Math.sqrt(.0729-b*b);s=h.b6(b,w,.25,1)}return this._prevEase={start:N.now(),duration:t,easing:s},s}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Cl{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class pu{constructor(t){this._tr=new Rs(t),this.reset()}reset(){this._active=!1}dblclick(t,s){return t.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class fu{constructor(){this._tap=new Al({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,s,l){if(!this._swipePoint)if(this._tapTime){const c=s[0],f=t.timeStamp-this._tapTime<500,b=this._tapPoint.dist(c)<30;f&&b?l.length>0&&(this._swipePoint=c,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(t,s,l)}touchmove(t,s,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const c=s[0],f=c.y-this._swipePoint.y;return this._swipePoint=c,t.preventDefault(),this._active=!0,{zoomDelta:f/128}}}else this._tap.touchmove(t,s,l)}touchend(t,s,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const c=this._tap.touchend(t,s,l);c&&(this._tapTime=t.timeStamp,this._tapPoint=c)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mu{constructor(t,s,l){this._el=t,this._mousePan=s,this._touchPan=l}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class pn{constructor(t,s,l){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=l}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class So{constructor(t,s,l,c){this._el=t,this._touchZoom=s,this._touchRotate=l,this._tapDragZoom=c,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class dt{constructor(t,s){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=s,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=$.create("div","maplibregl-cooperative-gesture-screen",t);let s=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(s=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),c=document.createElement("div");c.className="maplibregl-desktop-message",c.textContent=s,this._container.appendChild(c);const f=document.createElement("div");f.className="maplibregl-mobile-message",f.textContent=l,this._container.appendChild(f),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&($.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(t){this._onCooperativeGesture(t.touches.length===1)}wheel(t){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!t[this._bypassKey])}_onCooperativeGesture(t){this._enabled&&t&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const xt=p=>p.zoom||p.drag||p.pitch||p.rotate;class Sa extends h.k{}function To(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class Ml{constructor(t,s){this.handleWindowEvent=c=>{this.handleEvent(c,`${c.type}Window`)},this.handleEvent=(c,f)=>{if(c.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const b=c.type==="renderFrame"?void 0:c,w={needsRenderFrame:!1},E={},A={},M=c.touches,k=M?this._getMapTouches(M):void 0,O=k?$.touchPos(this._map.getCanvas(),k):$.mousePos(this._map.getCanvas(),c);for(const{handlerName:Y,handler:q,allowed:se}of this._handlers){if(!q.isEnabled())continue;let pe;this._blockedByActive(A,se,Y)?q.reset():q[f||c.type]&&(pe=q[f||c.type](c,O,k),this.mergeHandlerResult(w,E,pe,Y,b),pe&&pe.needsRenderFrame&&this._triggerRenderFrame()),(pe||q.isActive())&&(A[Y]=q)}const W={};for(const Y in this._previousActiveHandlers)A[Y]||(W[Y]=b);this._previousActiveHandlers=A,(Object.keys(W).length||To(w))&&(this._changes.push([w,E,W]),this._triggerRenderFrame()),(Object.keys(A).length||To(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Z}=w;Z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Z(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new lu(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[c,f,b]of this._listeners)$.addEventListener(c,f,c===document?this.handleWindowEvent:this.handleEvent,b)}destroy(){for(const[t,s,l]of this._listeners)$.removeEventListener(t,s,t===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(t){const s=this._map,l=s.getCanvasContainer();this._add("mapEvent",new hn(s,t));const c=s.boxZoom=new dn(s,t);this._add("boxZoom",c),t.interactive&&t.boxZoom&&c.enable();const f=s.cooperativeGestures=new dt(s,t.cooperativeGestures);this._add("cooperativeGestures",f),t.cooperativeGestures&&f.enable();const b=new id(s),w=new pu(s);s.doubleClickZoom=new Cl(w,b),this._add("tapZoom",b),this._add("clickZoom",w),t.interactive&&t.doubleClickZoom&&s.doubleClickZoom.enable();const E=new fu;this._add("tapDragZoom",E);const A=s.touchPitch=new du(s);this._add("touchPitch",A),t.interactive&&t.touchPitch&&s.touchPitch.enable(t.touchPitch);const M=Fs(t),k=Os(t);s.dragRotate=new pn(t,M,k),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]),t.interactive&&t.dragRotate&&s.dragRotate.enable();const O=(({enable:pe,clickTolerance:Q})=>{const ce=new Tn({checkCorrectEvent:fe=>$.mouseButton(fe)===0&&!fe.ctrlKey});return new Ls({clickTolerance:Q,move:(fe,_e)=>({around:_e,panDelta:_e.sub(fe)}),activateOnStart:!0,moveStateManager:ce,enable:pe,assignEvents:xa})})(t),W=new cu(t,s);s.dragPan=new mu(l,O,W),this._add("mousePan",O),this._add("touchPan",W,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&s.dragPan.enable(t.dragPan);const Z=new Pl,Y=new hu;s.touchZoomRotate=new So(l,Y,Z,E),this._add("touchRotate",Z,["touchPan","touchZoom"]),this._add("touchZoom",Y,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&s.touchZoomRotate.enable(t.touchZoomRotate);const q=s.scrollZoom=new wa(s,()=>this._triggerRenderFrame());this._add("scrollZoom",q,["mousePan"]),t.interactive&&t.scrollZoom&&s.scrollZoom.enable(t.scrollZoom);const se=s.keyboard=new Wn(s);this._add("keyboard",se),t.interactive&&t.keyboard&&s.keyboard.enable(),this._add("blockableMapEvent",new Sn(s))}_add(t,s,l){this._handlers.push({handlerName:t,handler:s,allowed:l}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!xt(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,s,l){for(const c in t)if(c!==l&&(!s||s.indexOf(c)<0))return!0;return!1}_getMapTouches(t){const s=[];for(const l of t)this._el.contains(l.target)&&s.push(l);return s}mergeHandlerResult(t,s,l,c,f){if(!l)return;h.e(t,l);const b={handlerName:c,originalEvent:l.originalEvent||f};l.zoomDelta!==void 0&&(s.zoom=b),l.panDelta!==void 0&&(s.drag=b),l.pitchDelta!==void 0&&(s.pitch=b),l.bearingDelta!==void 0&&(s.rotate=b)}_applyChanges(){const t={},s={},l={};for(const[c,f,b]of this._changes)c.panDelta&&(t.panDelta=(t.panDelta||new h.P(0,0))._add(c.panDelta)),c.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+c.zoomDelta),c.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+c.bearingDelta),c.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+c.pitchDelta),c.around!==void 0&&(t.around=c.around),c.pinchAround!==void 0&&(t.pinchAround=c.pinchAround),c.noInertia&&(t.noInertia=c.noInertia),h.e(s,f),h.e(l,b);this._updateMapTransform(t,s,l),this._changes=[]}_updateMapTransform(t,s,l){const c=this._map,f=c._getTransformForUpdate(),b=c.terrain;if(!(To(t)||b&&this._terrainMovement))return this._fireEvents(s,l,!0);let{panDelta:w,zoomDelta:E,bearingDelta:A,pitchDelta:M,around:k,pinchAround:O}=t;O!==void 0&&(k=O),c._stop(!0),k=k||c.transform.centerPoint;const W=f.pointLocation(w?k.sub(w):k);A&&(f.bearing+=A),M&&(f.pitch+=M),E&&(f.zoom+=E),b?this._terrainMovement||!s.drag&&!s.zoom?s.drag&&this._terrainMovement?f.center=f.pointLocation(f.centerPoint.sub(w)):f.setLocationAtPoint(W,k):(this._terrainMovement=!0,this._map._elevationFreeze=!0,f.setLocationAtPoint(W,k),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,f.recalculateZoom(c.terrain)})):f.setLocationAtPoint(W,k),c._applyUpdatedTransform(f),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,l,!0)}_fireEvents(t,s,l){const c=xt(this._eventsInProgress),f=xt(t),b={};for(const M in t){const{originalEvent:k}=t[M];this._eventsInProgress[M]||(b[`${M}start`]=k),this._eventsInProgress[M]=t[M]}!c&&f&&this._fireEvent("movestart",f.originalEvent);for(const M in b)this._fireEvent(M,b[M]);f&&this._fireEvent("move",f.originalEvent);for(const M in t){const{originalEvent:k}=t[M];this._fireEvent(M,k)}const w={};let E;for(const M in this._eventsInProgress){const{handlerName:k,originalEvent:O}=this._eventsInProgress[M];this._handlersById[k].isActive()||(delete this._eventsInProgress[M],E=s[k]||O,w[`${M}end`]=E)}for(const M in w)this._fireEvent(M,w[M]);const A=xt(this._eventsInProgress);if(l&&(c||f)&&!A){this._updatingCamera=!0;const M=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),k=O=>O!==0&&-this._bearingSnap<O&&O<this._bearingSnap;!M||!M.essential&&N.prefersReducedMotion?(this._map.fire(new h.k("moveend",{originalEvent:E})),k(this._map.getBearing())&&this._map.resetNorth()):(k(M.bearing||this._map.getBearing())&&(M.bearing=0),M.freezeElevation=!0,this._map.easeTo(M,{originalEvent:E})),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new h.k(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Sa("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Rr extends h.E{constructor(t,s){super(),this._renderFrameCallback=()=>{const l=Math.min((N.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(l)),l<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new h.M(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,l){return t=h.P.convert(t).mult(-1),this.panTo(this.transform.center,h.e({offset:t},s),l)}panTo(t,s,l){return this.easeTo(h.e({center:t},s),l)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,l){return this.easeTo(h.e({zoom:t},s),l)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,l){return this.easeTo(h.e({bearing:t},s),l)}resetNorth(t,s){return this.rotateTo(0,h.e({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(h.e({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){t=ie.convert(t);const l=s&&s.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),l,s)}_cameraForBoxAndBearing(t,s,l,c){const f={top:0,bottom:0,right:0,left:0};if(typeof(c=h.e({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){const Ue=c.padding;c.padding={top:Ue,bottom:Ue,right:Ue,left:Ue}}c.padding=h.e(f,c.padding);const b=this.transform,w=b.padding,E=new ie(t,s),A=b.project(E.getNorthWest()),M=b.project(E.getNorthEast()),k=b.project(E.getSouthEast()),O=b.project(E.getSouthWest()),W=h.b8(-l),Z=A.rotate(W),Y=M.rotate(W),q=k.rotate(W),se=O.rotate(W),pe=new h.P(Math.max(Z.x,Y.x,se.x,q.x),Math.max(Z.y,Y.y,se.y,q.y)),Q=new h.P(Math.min(Z.x,Y.x,se.x,q.x),Math.min(Z.y,Y.y,se.y,q.y)),ce=pe.sub(Q),fe=(b.width-(w.left+w.right+c.padding.left+c.padding.right))/ce.x,_e=(b.height-(w.top+w.bottom+c.padding.top+c.padding.bottom))/ce.y;if(_e<0||fe<0)return void h.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ve=Math.min(b.scaleZoom(b.scale*Math.min(fe,_e)),c.maxZoom),ze=h.P.convert(c.offset),ke=new h.P((c.padding.left-c.padding.right)/2,(c.padding.top-c.padding.bottom)/2).rotate(h.b8(l)),Be=ze.add(ke).mult(b.scale/b.zoomScale(ve));return{center:b.unproject(A.add(k).div(2).sub(Be)),zoom:ve,bearing:l}}fitBounds(t,s,l){return this._fitInternal(this.cameraForBounds(t,s),s,l)}fitScreenCoordinates(t,s,l,c,f){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(h.P.convert(t)),this.transform.pointLocation(h.P.convert(s)),l,c),c,f)}_fitInternal(t,s,l){return t?(delete(s=h.e(t,s)).padding,s.linear?this.easeTo(s,l):this.flyTo(s,l)):this}jumpTo(t,s){this.stop();const l=this._getTransformForUpdate();let c=!1,f=!1,b=!1;return"zoom"in t&&l.zoom!==+t.zoom&&(c=!0,l.zoom=+t.zoom),t.center!==void 0&&(l.center=h.M.convert(t.center)),"bearing"in t&&l.bearing!==+t.bearing&&(f=!0,l.bearing=+t.bearing),"pitch"in t&&l.pitch!==+t.pitch&&(b=!0,l.pitch=+t.pitch),t.padding==null||l.isPaddingEqual(t.padding)||(l.padding=t.padding),this._applyUpdatedTransform(l),this.fire(new h.k("movestart",s)).fire(new h.k("move",s)),c&&this.fire(new h.k("zoomstart",s)).fire(new h.k("zoom",s)).fire(new h.k("zoomend",s)),f&&this.fire(new h.k("rotatestart",s)).fire(new h.k("rotate",s)).fire(new h.k("rotateend",s)),b&&this.fire(new h.k("pitchstart",s)).fire(new h.k("pitch",s)).fire(new h.k("pitchend",s)),this.fire(new h.k("moveend",s))}calculateCameraOptionsFromTo(t,s,l,c=0){const f=h.Y.fromLngLat(t,s),b=h.Y.fromLngLat(l,c),w=b.x-f.x,E=b.y-f.y,A=b.z-f.z,M=Math.hypot(w,E,A);if(M===0)throw new Error("Can't calculate camera options with same From and To");const k=Math.hypot(w,E),O=this.transform.scaleZoom(this.transform.cameraToCenterDistance/M/this.transform.tileSize),W=180*Math.atan2(w,-E)/Math.PI;let Z=180*Math.acos(k/M)/Math.PI;return Z=A<0?90-Z:90+Z,{center:b.toLngLat(),zoom:O,pitch:Z,bearing:W}}easeTo(t,s){var l;this._stop(!1,t.easeId),((t=h.e({offset:[0,0],duration:500,easing:h.b7},t)).animate===!1||!t.essential&&N.prefersReducedMotion)&&(t.duration=0);const c=this._getTransformForUpdate(),f=this.getZoom(),b=this.getBearing(),w=this.getPitch(),E=this.getPadding(),A="bearing"in t?this._normalizeBearing(t.bearing,b):b,M="pitch"in t?+t.pitch:w,k="padding"in t?t.padding:c.padding,O=h.P.convert(t.offset);let W=c.centerPoint.add(O);const Z=c.pointLocation(W),{center:Y,zoom:q}=c.getConstrained(h.M.convert(t.center||Z),(l=t.zoom)!==null&&l!==void 0?l:f);this._normalizeCenter(Y);const se=c.project(Z),pe=c.project(Y).sub(se),Q=c.zoomScale(q-f);let ce,fe;t.around&&(ce=h.M.convert(t.around),fe=c.locationPoint(ce));const _e={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||q!==f,this._rotating=this._rotating||b!==A,this._pitching=this._pitching||M!==w,this._padding=!c.isPaddingEqual(k),this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,_e),this.terrain&&this._prepareElevation(Y),this._ease(ve=>{if(this._zooming&&(c.zoom=h.z.number(f,q,ve)),this._rotating&&(c.bearing=h.z.number(b,A,ve)),this._pitching&&(c.pitch=h.z.number(w,M,ve)),this._padding&&(c.interpolatePadding(E,k,ve),W=c.centerPoint.add(O)),this.terrain&&!t.freezeElevation&&this._updateElevation(ve),ce)c.setLocationAtPoint(ce,fe);else{const ze=c.zoomScale(c.zoom-f),ke=q>f?Math.min(2,Q):Math.max(.5,Q),Be=Math.pow(ke,1-ve),Ue=c.unproject(se.add(pe.mult(ve*Be)).mult(ze));c.setLocationAtPoint(c.renderWorldCopies?Ue.wrap():Ue,W)}this._applyUpdatedTransform(c),this._fireMoveEvents(s)},ve=>{this.terrain&&this._finalizeElevation(),this._afterEase(s,ve)},t),this}_prepareEase(t,s,l={}){this._moving=!0,s||l.moving||this.fire(new h.k("movestart",t)),this._zooming&&!l.zooming&&this.fire(new h.k("zoomstart",t)),this._rotating&&!l.rotating&&this.fire(new h.k("rotatestart",t)),this._pitching&&!l.pitching&&this.fire(new h.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&s!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(l-(s-(l*t+this._elevationStart))/(1-t)),this._elevationTarget=s}this.transform.elevation=h.z.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const s=t.clone(),{center:l,zoom:c,pitch:f,bearing:b,elevation:w}=this.transformCameraUpdate(s);l&&(s.center=l),c!==void 0&&(s.zoom=c),f!==void 0&&(s.pitch=f),b!==void 0&&(s.bearing=b),w!==void 0&&(s.elevation=w),this.transform.apply(s)}_fireMoveEvents(t){this.fire(new h.k("move",t)),this._zooming&&this.fire(new h.k("zoom",t)),this._rotating&&this.fire(new h.k("rotate",t)),this._pitching&&this.fire(new h.k("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const l=this._zooming,c=this._rotating,f=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,l&&this.fire(new h.k("zoomend",t)),c&&this.fire(new h.k("rotateend",t)),f&&this.fire(new h.k("pitchend",t)),this.fire(new h.k("moveend",t))}flyTo(t,s){var l;if(!t.essential&&N.prefersReducedMotion){const Gt=h.L(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Gt,s)}this.stop(),t=h.e({offset:[0,0],speed:1.2,curve:1.42,easing:h.b7},t);const c=this._getTransformForUpdate(),f=this.getZoom(),b=this.getBearing(),w=this.getPitch(),E=this.getPadding(),A="bearing"in t?this._normalizeBearing(t.bearing,b):b,M="pitch"in t?+t.pitch:w,k="padding"in t?t.padding:c.padding,O=h.P.convert(t.offset);let W=c.centerPoint.add(O);const Z=c.pointLocation(W),{center:Y,zoom:q}=c.getConstrained(h.M.convert(t.center||Z),(l=t.zoom)!==null&&l!==void 0?l:f);this._normalizeCenter(Y);const se=c.zoomScale(q-f),pe=c.project(Z),Q=c.project(Y).sub(pe);let ce=t.curve;const fe=Math.max(c.width,c.height),_e=fe/se,ve=Q.mag();if("minZoom"in t){const Gt=h.ac(Math.min(t.minZoom,f,q),c.minZoom,c.maxZoom),Et=fe/c.zoomScale(Gt-f);ce=Math.sqrt(Et/ve*2)}const ze=ce*ce;function ke(Gt){const Et=(_e*_e-fe*fe+(Gt?-1:1)*ze*ze*ve*ve)/(2*(Gt?_e:fe)*ze*ve);return Math.log(Math.sqrt(Et*Et+1)-Et)}function Be(Gt){return(Math.exp(Gt)-Math.exp(-Gt))/2}function Ue(Gt){return(Math.exp(Gt)+Math.exp(-Gt))/2}const Mt=ke(!1);let qe=function(Gt){return Ue(Mt)/Ue(Mt+ce*Gt)},St=function(Gt){return fe*((Ue(Mt)*(Be(Et=Mt+ce*Gt)/Ue(Et))-Be(Mt))/ze)/ve;var Et},kt=(ke(!0)-Mt)/ce;if(Math.abs(ve)<1e-6||!isFinite(kt)){if(Math.abs(fe-_e)<1e-6)return this.easeTo(t,s);const Gt=_e<fe?-1:1;kt=Math.abs(Math.log(_e/fe))/ce,St=function(){return 0},qe=function(Et){return Math.exp(Gt*ce*Et)}}return t.duration="duration"in t?+t.duration:1e3*kt/("screenSpeed"in t?+t.screenSpeed/ce:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=b!==A,this._pitching=M!==w,this._padding=!c.isPaddingEqual(k),this._prepareEase(s,!1),this.terrain&&this._prepareElevation(Y),this._ease(Gt=>{const Et=Gt*kt,zt=1/qe(Et);c.zoom=Gt===1?q:f+c.scaleZoom(zt),this._rotating&&(c.bearing=h.z.number(b,A,Gt)),this._pitching&&(c.pitch=h.z.number(w,M,Gt)),this._padding&&(c.interpolatePadding(E,k,Gt),W=c.centerPoint.add(O)),this.terrain&&!t.freezeElevation&&this._updateElevation(Gt);const Ot=Gt===1?Y:c.unproject(pe.add(Q.mult(St(Et))).mult(zt));c.setLocationAtPoint(c.renderWorldCopies?Ot.wrap():Ot,W),this._applyUpdatedTransform(c),this._fireMoveEvents(s)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(s)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const l=this._onEaseEnd;delete this._onEaseEnd,l.call(this,s)}if(!t){const l=this.handlers;l&&l.stop(!1)}return this}_ease(t,s,l){l.animate===!1||l.duration===0?(t(1),s()):(this._easeStart=N.now(),this._easeOptions=l,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,s){t=h.b1(t,-180,180);const l=Math.abs(t-s);return Math.abs(t-360-s)<l&&(t-=360),Math.abs(t+360-s)<l&&(t+=360),t}_normalizeCenter(t){const s=this.transform;if(!s.renderWorldCopies||s.lngRange)return;const l=t.lng-s.center.lng;t.lng+=l>180?-360:l<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(h.M.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}const kl={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class fn{constructor(t=kl){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=$.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=$.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=$.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){$.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,s){const l=this._map._getUIString(`AttributionControl.${s}`);t.title=l,t.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(c=>typeof c!="string"?"":c)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}const s=this._map.style.sourceCaches;for(const c in s){const f=s[c];if(f.used||f.usedForTerrain){const b=f.getSource();b.attribution&&t.indexOf(b.attribution)<0&&t.push(b.attribution)}}t=t.filter(c=>String(c).trim()),t.sort((c,f)=>c.length-f.length),t=t.filter((c,f)=>{for(let b=f+1;b<t.length;b++)if(t[b].indexOf(c)>=0)return!1;return!0});const l=t.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,t.length?(this._innerContainer.innerHTML=l,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class gu{constructor(t={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const l=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=$.create("div","maplibregl-ctrl");const s=$.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){$.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Eo{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,l=s?this._queue.concat(s):this._queue;for(const c of l)if(c.id===t)return void(c.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const l of s)if(!l.cancelled&&(l.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var zi=h.X([{name:"a_pos3d",type:"Int16",components:3}]);class Ni extends h.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,s){this.sourceCache.update(t,s),this._renderableTilesKeys=[];const l={};for(const c of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))l[c.key]=!0,this._renderableTilesKeys.push(c.key),this._tiles[c.key]||(c.posMatrix=new Float64Array(16),h.aN(c.posMatrix,0,h.W,0,h.W,0,1),this._tiles[c.key]=new ui(c,this.tileSize));for(const c in this._tiles)l[c]||delete this._tiles[c]}freeRtt(t){for(const s in this._tiles){const l=this._tiles[s];(!t||l.tileID.equals(t)||l.tileID.isChildOf(t)||t.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const s={};for(const l of this._renderableTilesKeys){const c=this._tiles[l].tileID;if(c.canonical.equals(t.canonical)){const f=t.clone();f.posMatrix=new Float64Array(16),h.aN(f.posMatrix,0,h.W,0,h.W,0,1),s[l]=f}else if(c.canonical.isChildOf(t.canonical)){const f=t.clone();f.posMatrix=new Float64Array(16);const b=c.canonical.z-t.canonical.z,w=c.canonical.x-(c.canonical.x>>b<<b),E=c.canonical.y-(c.canonical.y>>b<<b),A=h.W>>b;h.aN(f.posMatrix,0,A,0,A,0,1),h.H(f.posMatrix,f.posMatrix,[-w*A,-E*A,0]),s[l]=f}else if(t.canonical.isChildOf(c.canonical)){const f=t.clone();f.posMatrix=new Float64Array(16);const b=t.canonical.z-c.canonical.z,w=t.canonical.x-(t.canonical.x>>b<<b),E=t.canonical.y-(t.canonical.y>>b<<b),A=h.W>>b;h.aN(f.posMatrix,0,h.W,0,h.W,0,1),h.H(f.posMatrix,f.posMatrix,[w*A,E*A,0]),h.J(f.posMatrix,f.posMatrix,[1/2**b,1/2**b,0]),s[l]=f}}return s}getSourceTile(t,s){const l=this.sourceCache._source;let c=t.overscaledZ-this.deltaZoom;if(c>l.maxzoom&&(c=l.maxzoom),c<l.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(c).key);let f=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!f||!f.dem)&&s)for(;c>=l.minzoom&&(!f||!f.dem);)f=this.sourceCache.getTileByID(t.scaledTo(c--).key);return f}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(s=>s.timeAdded>=t)}}class _u{constructor(t,s,l){this.painter=t,this.sourceCache=new Ni(s),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,s,l,c=h.W){var f;if(!(s>=0&&s<c&&l>=0&&l<c))return 0;const b=this.getTerrainData(t),w=(f=b.tile)===null||f===void 0?void 0:f.dem;if(!w)return 0;const E=function(Z,Y,q){var se=Y[0],pe=Y[1];return Z[0]=q[0]*se+q[4]*pe+q[12],Z[1]=q[1]*se+q[5]*pe+q[13],Z}([],[s/c*h.W,l/c*h.W],b.u_terrain_matrix),A=[E[0]*w.dim,E[1]*w.dim],M=Math.floor(A[0]),k=Math.floor(A[1]),O=A[0]-M,W=A[1]-k;return w.get(M,k)*(1-O)*(1-W)+w.get(M+1,k)*O*(1-W)+w.get(M,k+1)*(1-O)*W+w.get(M+1,k+1)*O*W}getElevationForLngLatZoom(t,s){const{tileID:l,mercatorX:c,mercatorY:f}=this._getOverscaledTileIDFromLngLatZoom(t,s);return this.getElevation(l,c%h.W,f%h.W,h.W)}getElevation(t,s,l,c=h.W){return this.getDEMElevation(t,s,l,c)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const c=this.painter.context,f=new h.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new gt(c,f,c.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new gt(c,new h.R({width:1,height:1}),c.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=h.an([])}const s=this.sourceCache.getSourceTile(t,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const c=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new gt(c,s.dem.getPixels(),c.gl.RGBA,{premultiply:!1}),s.demTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const l=s&&s+s.tileID.key+t.key;if(l&&!this._demMatrixCache[l]){const c=this.sourceCache.sourceCache._source.maxzoom;let f=t.canonical.z-s.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=c?f=t.canonical.z-c:h.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const b=t.canonical.x-(t.canonical.x>>f<<f),w=t.canonical.y-(t.canonical.y>>f<<f),E=h.b9(new Float64Array(16),[1/(h.W<<f),1/(h.W<<f),0]);h.H(E,E,[b*h.W,w*h.W,0]),this._demMatrixCache[t.key]={matrix:E,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(t){const s=this.painter,l=s.width/devicePixelRatio,c=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===c||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new gt(s.context,{width:l,height:c,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new gt(s.context,{width:l,height:c,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(l,c,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,l,c))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let f=0,b=0;f<this._coordsTextureSize;f++)for(let w=0;w<this._coordsTextureSize;w++,b+=4)s[b+0]=255&w,s[b+1]=255&f,s[b+2]=w>>8<<4|f>>8,s[b+3]=0;const l=new h.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),c=new gt(t,l,t.gl.RGBA,{premultiply:!1});return c.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=c,c}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const s=new Uint8Array(4),l=this.painter.context,c=l.gl,f=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),b=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),w=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),c.readPixels(f,w-b-1,1,1,c.RGBA,c.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null);const E=s[0]+(s[2]>>4<<8),A=s[1]+((15&s[2])<<8),M=this.coordsIndex[255-s[3]],k=M&&this.sourceCache.getTileByID(M);if(!k)return null;const O=this._coordsTextureSize,W=(1<<k.tileID.canonical.z)*O;return new h.Y((k.tileID.canonical.x*O+E)/W+k.tileID.wrap,(k.tileID.canonical.y*O+A)/W,this.getElevation(k.tileID,E,A,O))}depthAtPoint(t){const s=new Uint8Array(4),l=this.painter.context,c=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),c.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null),(s[0]/16777216+s[1]/65536+s[2]/256+s[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,s=new h.ba,l=new h.aX,c=this.meshSize,f=h.W/c,b=c*c;for(let k=0;k<=c;k++)for(let O=0;O<=c;O++)s.emplaceBack(O*f,k*f,0);for(let k=0;k<b;k+=c+1)for(let O=0;O<c;O++)l.emplaceBack(O+k,c+O+k+1,c+O+k+2),l.emplaceBack(O+k,c+O+k+2,O+k+1);const w=s.length,E=w+2*(c+1);for(const k of[0,1])for(let O=0;O<=c;O++)for(const W of[0,1])s.emplaceBack(O*f,k*h.W,W);for(let k=0;k<2*c;k+=2)l.emplaceBack(E+k,E+k+1,E+k+3),l.emplaceBack(E+k,E+k+3,E+k+2),l.emplaceBack(w+k,w+k+3,w+k+1),l.emplaceBack(w+k,w+k+2,w+k+3);const A=s.length,M=A+2*(c+1);for(const k of[0,1])for(let O=0;O<=c;O++)for(const W of[0,1])s.emplaceBack(k*h.W,O*f,W);for(let k=0;k<2*c;k+=2)l.emplaceBack(A+k,A+k+1,A+k+3),l.emplaceBack(A+k,A+k+3,A+k+2),l.emplaceBack(M+k,M+k+3,M+k+1),l.emplaceBack(M+k,M+k+2,M+k+3);return this._mesh={indexBuffer:t.createIndexBuffer(l),vertexBuffer:t.createVertexBuffer(s,zi.members),segments:h.$.simpleSegment(0,0,s.length,l.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*h.bb/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,s){var l;const{tileID:c}=this._getOverscaledTileIDFromLngLatZoom(t,s);return(l=this.getMinMaxElevation(c).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(t){const s=this.getTerrainData(t).tile,l={minElevation:null,maxElevation:null};return s&&s.dem&&(l.minElevation=s.dem.min*this.exaggeration,l.maxElevation=s.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(t,s){const l=h.Y.fromLngLat(t.wrap()),c=(1<<s)*h.W,f=l.x*c,b=l.y*c,w=Math.floor(f/h.W),E=Math.floor(b/h.W);return{tileID:new h.Q(s,0,s,w,E),mercatorX:f,mercatorY:b}}}class Io{constructor(t,s,l){this._context=t,this._size=s,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new gt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(l.texture),{id:t,fbo:s,texture:l,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(s=>t.id!==s),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const Dn={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Dl{constructor(t,s){this.painter=t,this.terrain=s,this.pool=new Io(t.context,30,s.sourceCache.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(l=>!t._layers[l].isHidden(s)),this._coordsDescendingInv={};for(const l in t.sourceCaches){this._coordsDescendingInv[l]={};const c=t.sourceCaches[l].getVisibleCoordinates();for(const f of c){const b=this.terrain.sourceCache.getTerrainCoords(f);for(const w in b)this._coordsDescendingInv[l][w]||(this._coordsDescendingInv[l][w]=[]),this._coordsDescendingInv[l][w].push(b[w])}}this._coordsDescendingInvStr={};for(const l of t._order){const c=t._layers[l],f=c.source;if(Dn[c.type]&&!this._coordsDescendingInvStr[f]){this._coordsDescendingInvStr[f]={};for(const b in this._coordsDescendingInv[f])this._coordsDescendingInvStr[f][b]=this._coordsDescendingInv[f][b].map(w=>w.key).sort().join()}}for(const l of this._renderableTiles)for(const c in this._coordsDescendingInvStr){const f=this._coordsDescendingInvStr[c][l.tileID.key];f&&f!==l.rttCoords[c]&&(l.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const s=t.type,l=this.painter,c=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Dn[s]&&(this._prevType&&Dn[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(t.id),!c))return!0;if(Dn[this._prevType]||Dn[s]&&c){this._prevType=s;const f=this._stacks.length-1,b=this._stacks[f]||[];for(const w of this._renderableTiles){if(this.pool.isFull()&&(_a(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(w),w.rtt[f]){const A=this.pool.getObjectForId(w.rtt[f].id);if(A.stamp===w.rtt[f].stamp){this.pool.useObject(A);continue}}const E=this.pool.getOrCreateFreeObject();this.pool.useObject(E),this.pool.stampObject(E),w.rtt[f]={id:E.id,stamp:E.stamp},l.context.bindFramebuffer.set(E.fbo.framebuffer),l.context.clear({color:h.aO.transparent,stencil:0}),l.currentStencilSource=void 0;for(let A=0;A<b.length;A++){const M=l.style._layers[b[A]],k=M.source?this._coordsDescendingInv[M.source][w.tileID.key]:[w.tileID];l.context.viewport.set([0,0,E.fbo.width,E.fbo.height]),l._renderTileClippingMasks(M,k),l.renderLayer(l,l.style.sourceCaches[M.source],M,k),M.source&&(w.rttCoords[M.source]=this._coordsDescendingInvStr[M.source][w.tileID.key])}}return _a(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Dn[s]}return!1}}const zl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Rl=R,Ao={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:kl,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:h.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Ta=p=>{p.touchstart=p.dragStart,p.touchmoveWindow=p.dragMove,p.touchend=p.dragEnd},Ll={showCompass:!0,showZoom:!0,visualizePitch:!1};class Fl{constructor(t,s,l=!1){this.mousedown=b=>{this.startMouse(h.e({},b,{ctrlKey:!0,preventDefault:()=>b.preventDefault()}),$.mousePos(this.element,b)),$.addEventListener(window,"mousemove",this.mousemove),$.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=b=>{this.moveMouse(b,$.mousePos(this.element,b))},this.mouseup=b=>{this.mouseRotate.dragEnd(b),this.mousePitch&&this.mousePitch.dragEnd(b),this.offTemp()},this.touchstart=b=>{b.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=$.touchPos(this.element,b.targetTouches)[0],this.startTouch(b,this._startPos),$.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),$.addEventListener(window,"touchend",this.touchend))},this.touchmove=b=>{b.targetTouches.length!==1?this.reset():(this._lastPos=$.touchPos(this.element,b.targetTouches)[0],this.moveTouch(b,this._lastPos))},this.touchend=b=>{b.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const c=t.dragRotate._mouseRotate.getClickTolerance(),f=t.dragRotate._mousePitch.getClickTolerance();this.element=s,this.mouseRotate=Fs({clickTolerance:c,enable:!0}),this.touchRotate=(({enable:b,clickTolerance:w,bearingDegreesPerPixelMoved:E=.8})=>{const A=new rt;return new Ls({clickTolerance:w,move:(M,k)=>({bearingDelta:(k.x-M.x)*E}),moveStateManager:A,enable:b,assignEvents:Ta})})({clickTolerance:c,enable:!0}),this.map=t,l&&(this.mousePitch=Os({clickTolerance:f,enable:!0}),this.touchPitch=(({enable:b,clickTolerance:w,pitchDegreesPerPixelMoved:E=-.5})=>{const A=new rt;return new Ls({clickTolerance:w,move:(M,k)=>({pitchDelta:(k.y-M.y)*E}),moveStateManager:A,enable:b,assignEvents:Ta})})({clickTolerance:f,enable:!0})),$.addEventListener(s,"mousedown",this.mousedown),$.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),$.addEventListener(s,"touchcancel",this.reset)}startMouse(t,s){this.mouseRotate.dragStart(t,s),this.mousePitch&&this.mousePitch.dragStart(t,s),$.disableDrag()}startTouch(t,s){this.touchRotate.dragStart(t,s),this.touchPitch&&this.touchPitch.dragStart(t,s),$.disableDrag()}moveMouse(t,s){const l=this.map,{bearingDelta:c}=this.mouseRotate.dragMove(t,s)||{};if(c&&l.setBearing(l.getBearing()+c),this.mousePitch){const{pitchDelta:f}=this.mousePitch.dragMove(t,s)||{};f&&l.setPitch(l.getPitch()+f)}}moveTouch(t,s){const l=this.map,{bearingDelta:c}=this.touchRotate.dragMove(t,s)||{};if(c&&l.setBearing(l.getBearing()+c),this.touchPitch){const{pitchDelta:f}=this.touchPitch.dragMove(t,s)||{};f&&l.setPitch(l.getPitch()+f)}}off(){const t=this.element;$.removeEventListener(t,"mousedown",this.mousedown),$.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),$.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),$.removeEventListener(window,"touchend",this.touchend),$.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){$.enableDrag(),$.removeEventListener(window,"mousemove",this.mousemove),$.removeEventListener(window,"mouseup",this.mouseup),$.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),$.removeEventListener(window,"touchend",this.touchend)}}let zn;function Ea(p,t,s){const l=new h.M(p.lng,p.lat);if(p=new h.M(p.lng,p.lat),t){const c=new h.M(p.lng-360,p.lat),f=new h.M(p.lng+360,p.lat),b=s.locationPoint(p).distSqr(t);s.locationPoint(c).distSqr(t)<b?p=c:s.locationPoint(f).distSqr(t)<b&&(p=f)}for(;Math.abs(p.lng-s.center.lng)>180;){const c=s.locationPoint(p);if(c.x>=0&&c.y>=0&&c.x<=s.width&&c.y<=s.height)break;p.lng>s.center.lng?p.lng-=360:p.lng+=360}return p.lng!==l.lng&&s.locationPoint(p).y>s.height/2-s.getHorizon()?p:l}const Po={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ia(p,t,s){const l=p.classList;for(const c in Po)l.remove(`maplibregl-${s}-anchor-${c}`);l.add(`maplibregl-${s}-anchor-${t}`)}class Co extends h.E{constructor(t){if(super(),this._onKeyPress=s=>{const l=s.code,c=s.charCode||s.keyCode;l!=="Space"&&l!=="Enter"&&c!==32&&c!==13||this.togglePopup()},this._onMapClick=s=>{const l=s.originalEvent.target,c=this._element;this._popup&&(l===c||c.contains(l))&&this.togglePopup()},this._update=s=>{var l;if(!this._map)return;const c=this._map.loaded()&&!this._map.isMoving();((s==null?void 0:s.type)==="terrain"||(s==null?void 0:s.type)==="render"&&!c)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Ea(this._lngLat,this._flatPos,this._map.transform):(l=this._lngLat)===null||l===void 0?void 0:l.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let f="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?f=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(f=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let b="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?b="rotateX(0deg)":this._pitchAlignment==="map"&&(b=`rotateX(${this._map.getPitch()}deg)`),s&&s.type!=="moveend"||(this._pos=this._pos.round()),$.setTransform(this._element,`${Po[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${b} ${f}`),N.frameAsync(new AbortController).then(()=>{this._updateOpacity(s&&s.type==="moveend")}).catch(()=>{})},this._onMove=s=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new h.k("dragstart"))),this.fire(new h.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new h.k("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(t==null?void 0:t.opacity,t==null?void 0:t.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=h.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=$.create("div"),this._element.setAttribute("aria-label","Map marker");const s=$.createNS("http://www.w3.org/2000/svg","svg"),l=41,c=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${l}px`),s.setAttributeNS(null,"width",`${c}px`),s.setAttributeNS(null,"viewBox",`0 0 ${c} ${l}`);const f=$.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"stroke","none"),f.setAttributeNS(null,"stroke-width","1"),f.setAttributeNS(null,"fill","none"),f.setAttributeNS(null,"fill-rule","evenodd");const b=$.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"fill-rule","nonzero");const w=$.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const E=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const se of E){const pe=$.createNS("http://www.w3.org/2000/svg","ellipse");pe.setAttributeNS(null,"opacity","0.04"),pe.setAttributeNS(null,"cx","10.5"),pe.setAttributeNS(null,"cy","5.80029008"),pe.setAttributeNS(null,"rx",se.rx),pe.setAttributeNS(null,"ry",se.ry),w.appendChild(pe)}const A=$.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill",this._color);const M=$.createNS("http://www.w3.org/2000/svg","path");M.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),A.appendChild(M);const k=$.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"opacity","0.25"),k.setAttributeNS(null,"fill","#000000");const O=$.createNS("http://www.w3.org/2000/svg","path");O.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),k.appendChild(O);const W=$.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"transform","translate(6.0, 7.0)"),W.setAttributeNS(null,"fill","#FFFFFF");const Z=$.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Y=$.createNS("http://www.w3.org/2000/svg","circle");Y.setAttributeNS(null,"fill","#000000"),Y.setAttributeNS(null,"opacity","0.25"),Y.setAttributeNS(null,"cx","5.5"),Y.setAttributeNS(null,"cy","5.5"),Y.setAttributeNS(null,"r","5.4999962");const q=$.createNS("http://www.w3.org/2000/svg","circle");q.setAttributeNS(null,"fill","#FFFFFF"),q.setAttributeNS(null,"cx","5.5"),q.setAttributeNS(null,"cy","5.5"),q.setAttributeNS(null,"r","5.4999962"),Z.appendChild(Y),Z.appendChild(q),b.appendChild(w),b.appendChild(A),b.appendChild(k),b.appendChild(W),b.appendChild(Z),s.appendChild(b),s.setAttributeNS(null,"height",l*this._scale+"px"),s.setAttributeNS(null,"width",c*this._scale+"px"),this._element.appendChild(s),this._offset=h.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",s=>{s.preventDefault()}),this._element.addEventListener("mousedown",s=>{s.preventDefault()}),Ia(this._element,this._anchor,"marker"),t&&t.className)for(const s of t.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),$.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=h.M.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const c=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[c,-1*(38.1-13.5+c)],"bottom-right":[-c,-1*(38.1-13.5+c)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var s,l;if(!(!((s=this._map)===null||s===void 0)&&s.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const c=this._map,f=c.terrain.depthAtPoint(this._pos),b=c.terrain.getElevationForLngLatZoom(this._lngLat,c.transform.tileZoom);if(c.transform.lngLatToCameraDepth(this._lngLat,b)-f<.006)return void(this._element.style.opacity=this._opacity);const w=-this._offset.y/c.transform._pixelPerMeter,E=Math.sin(c.getPitch()*Math.PI/180)*w,A=c.terrain.depthAtPoint(new h.P(this._pos.x,this._pos.y-this._offset.y)),M=c.transform.lngLatToCameraDepth(this._lngLat,b+E)-A>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&M&&this._popup.remove(),this._element.style.opacity=M?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=h.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,s){return t===void 0&&s===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),s!==void 0&&(this._opacityWhenCovered=s),this._map&&this._updateOpacity(!0),this}}const Aa={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ns=0,ps=!1;const Pa={maxWidth:100,unit:"metric"};function Ca(p,t,s){const l=s&&s.maxWidth||100,c=p._container.clientHeight/2,f=p.unproject([0,c]),b=p.unproject([l,c]),w=f.distanceTo(b);if(s&&s.unit==="imperial"){const E=3.2808*w;E>5280?fs(t,l,E/5280,p._getUIString("ScaleControl.Miles")):fs(t,l,E,p._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?fs(t,l,w/1852,p._getUIString("ScaleControl.NauticalMiles")):w>=1e3?fs(t,l,w/1e3,p._getUIString("ScaleControl.Kilometers")):fs(t,l,w,p._getUIString("ScaleControl.Meters"))}function fs(p,t,s,l){const c=function(f){const b=Math.pow(10,`${Math.floor(f)}`.length-1);let w=f/b;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:function(E){const A=Math.pow(10,Math.ceil(-Math.log(E)/Math.LN10));return Math.round(E*A)/A}(w),b*w}(s);p.style.width=t*(c/s)+"px",p.innerHTML=`${c}&nbsp;${l}`}const Ol={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Bl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ma(p){if(p){if(typeof p=="number"){const t=Math.round(Math.abs(p)/Math.SQRT2);return{center:new h.P(0,0),top:new h.P(0,p),"top-left":new h.P(t,t),"top-right":new h.P(-t,t),bottom:new h.P(0,-p),"bottom-left":new h.P(t,-t),"bottom-right":new h.P(-t,-t),left:new h.P(p,0),right:new h.P(-p,0)}}if(p instanceof h.P||Array.isArray(p)){const t=h.P.convert(p);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:h.P.convert(p.center||[0,0]),top:h.P.convert(p.top||[0,0]),"top-left":h.P.convert(p["top-left"]||[0,0]),"top-right":h.P.convert(p["top-right"]||[0,0]),bottom:h.P.convert(p.bottom||[0,0]),"bottom-left":h.P.convert(p["bottom-left"]||[0,0]),"bottom-right":h.P.convert(p["bottom-right"]||[0,0]),left:h.P.convert(p.left||[0,0]),right:h.P.convert(p.right||[0,0])}}return Ma(new h.P(0,0))}const yu=R;x.AJAXError=h.be,x.Evented=h.E,x.LngLat=h.M,x.MercatorCoordinate=h.Y,x.Point=h.P,x.addProtocol=h.bf,x.config=h.a,x.removeProtocol=h.bg,x.AttributionControl=fn,x.BoxZoomHandler=dn,x.CanvasSource=st,x.CooperativeGesturesHandler=dt,x.DoubleClickZoomHandler=Cl,x.DragPanHandler=mu,x.DragRotateHandler=pn,x.EdgeInsets=zs,x.FullscreenControl=class extends h.E{constructor(p={}){super(),this._onFullscreenChange=()=>{var t;let s=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=s==null?void 0:s.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)s=s.shadowRoot.fullscreenElement;s===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:h.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){$.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const p=this._fullscreenButton=$.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);$.create("span","maplibregl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.title=p}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new h.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new h.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},x.GeoJSONSource=et,x.GeolocateControl=class extends h.E{constructor(p){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new h.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new h.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const s=new h.M(t.coords.longitude,t.coords.latitude),l=t.coords.accuracy,c=this._map.getBearing(),f=h.e({bearing:c},this.options.fitBoundsOptions),b=ie.fromLngLat(s,l);this._map.fitBounds(b,f,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const s=new h.M(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&ps)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new h.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=$.create("button","maplibregl-ctrl-geolocate",this._container),$.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){h.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=$.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Co({element:this._dotElement}),this._circleElement=$.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Co({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new h.k("trackuserlocationend")))})}},this.options=h.e({},Aa,p)}onAdd(p){return this._map=p,this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return h._(this,arguments,void 0,function*(t=!1){if(zn!==void 0&&!t)return zn;if(window.navigator.permissions===void 0)return zn=!!window.navigator.geolocation,zn;try{zn=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{zn=!!window.navigator.geolocation}return zn})}().then(t=>this._setupUI(t)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),$.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ns=0,ps=!1}_isOutOfMapMaxBounds(p){const t=this._map.getMaxBounds(),s=p.coords;return t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const p=this._map.getBounds(),t=p.getSouthEast(),s=p.getNorthEast(),l=t.distanceTo(s),c=Math.ceil(this._accuracy/(l/this._map._container.clientHeight)*2);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}trigger(){if(!this._setup)return h.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new h.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ns--,ps=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new h.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new h.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ns++,Ns>1?(p={maximumAge:6e5,timeout:0},ps=!0):(p=this.options.positionOptions,ps=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},x.Hash=El,x.ImageSource=Oe,x.KeyboardHandler=Wn,x.LngLatBounds=ie,x.LogoControl=gu,x.Map=class extends Rr{constructor(p){if(h.bc.mark(h.bd.create),(p=h.e({},Ao,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ya(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),{bearingSnap:p.bearingSnap}),this._contextLost=t=>{t.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new h.k("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new h.k("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=p.interactive,this._maxTileCacheSize=p.maxTileCacheSize,this._maxTileCacheZoomLevels=p.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._renderTaskQueue=new Eo,this._controls=[],this._mapId=h.a3(),this._locale=h.e({},zl,p.locale),this._clickTolerance=p.clickTolerance,this._overridePixelRatio=p.pixelRatio,this._maxCanvasSize=p.maxCanvasSize,this.transformCameraUpdate=p.transformCameraUpdate,this._imageQueueHandle=me.addThrottleControl(()=>this.isMoving()),this._requestManager=new We(p.transformRequest),typeof p.container=="string"){if(this._container=document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(p.maxBounds&&this.setMaxBounds(p.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let t=!1;const s=Tl(l=>{this._trackResize&&!this._removed&&this.resize(l)._update()},50);this._resizeObserver=new ResizeObserver(l=>{t?s(l):t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Ml(this,p),this._hash=p.hash&&new El(typeof p.hash=="string"&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,h.e({},p.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=p.localIdeographFontFamily,this._validateStyle=p.validateStyle,p.style&&this.setStyle(p.style,{localIdeographFontFamily:p.localIdeographFontFamily}),p.attributionControl&&this.addControl(new fn(typeof p.attributionControl=="boolean"?void 0:p.attributionControl)),p.maplibreLogo&&this.addControl(new gu,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new h.k(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new h.k(`${t.dataType}dataloading`,t))}),this.on("dataabort",t=>{this.fire(new h.k("sourcedataabort",t))})}_getMapId(){return this._mapId}addControl(p,t){if(t===void 0&&(t=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new h.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=p.onAdd(this);this._controls.push(p);const l=this._controlPositions[t];return t.indexOf("bottom")!==-1?l.insertBefore(s,l.firstChild):l.appendChild(s),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new h.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(p);return t>-1&&this._controls.splice(t,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}calculateCameraOptionsFromTo(p,t,s,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(p,t,s,l)}resize(p){var t;const s=this._containerDimensions(),l=s[0],c=s[1],f=this._getClampedPixelRatio(l,c);if(this._resizeCanvas(l,c,f),this.painter.resize(l,c,f),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const E=this._getClampedPixelRatio(l,c);this._resizeCanvas(l,c,E),this.painter.resize(l,c,E)}this.transform.resize(l,c),(t=this._requestedCameraState)===null||t===void 0||t.resize(l,c);const b=!this._moving;return b&&(this.stop(),this.fire(new h.k("movestart",p)).fire(new h.k("move",p))),this.fire(new h.k("resize",p)),b&&this.fire(new h.k("moveend",p)),this}_getClampedPixelRatio(p,t){const{0:s,1:l}=this._maxCanvasSize,c=this.getPixelRatio(),f=p*c,b=t*c;return Math.min(f>s?s/f:1,b>l?l/b:1)*c}getPixelRatio(){var p;return(p=this._overridePixelRatio)!==null&&p!==void 0?p:devicePixelRatio}setPixelRatio(p){this._overridePixelRatio=p,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(p){return this.transform.setMaxBounds(ie.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p&&this.setZoom(p),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p&&this.setZoom(p),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p&&this.setPitch(p),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p&&this.setPitch(p),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}project(p){return this.transform.locationPoint(h.M.convert(p),this.style&&this.terrain)}unproject(p){return this.transform.pointLocation(h.P.convert(p),this.terrain)}isMoving(){var p;return this._moving||((p=this.handlers)===null||p===void 0?void 0:p.isMoving())}isZooming(){var p;return this._zooming||((p=this.handlers)===null||p===void 0?void 0:p.isZooming())}isRotating(){var p;return this._rotating||((p=this.handlers)===null||p===void 0?void 0:p.isRotating())}_createDelegatedListener(p,t,s){if(p==="mouseenter"||p==="mouseover"){let l=!1;return{layer:t,listener:s,delegates:{mousemove:f=>{const b=this.getLayer(t)?this.queryRenderedFeatures(f.point,{layers:[t]}):[];b.length?l||(l=!0,s.call(this,new zr(p,this,f.originalEvent,{features:b}))):l=!1},mouseout:()=>{l=!1}}}}if(p==="mouseleave"||p==="mouseout"){let l=!1;return{layer:t,listener:s,delegates:{mousemove:b=>{(this.getLayer(t)?this.queryRenderedFeatures(b.point,{layers:[t]}):[]).length?l=!0:l&&(l=!1,s.call(this,new zr(p,this,b.originalEvent)))},mouseout:b=>{l&&(l=!1,s.call(this,new zr(p,this,b.originalEvent)))}}}}{const l=c=>{const f=this.getLayer(t)?this.queryRenderedFeatures(c.point,{layers:[t]}):[];f.length&&(c.features=f,s.call(this,c),delete c.features)};return{layer:t,listener:s,delegates:{[p]:l}}}}on(p,t,s){if(s===void 0)return super.on(p,t);const l=this._createDelegatedListener(p,t,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(l);for(const c in l.delegates)this.on(c,l.delegates[c]);return this}once(p,t,s){if(s===void 0)return super.once(p,t);const l=this._createDelegatedListener(p,t,s);for(const c in l.delegates)this.once(c,l.delegates[c]);return this}off(p,t,s){return s===void 0?super.off(p,t):(this._delegatedListeners&&this._delegatedListeners[p]&&(l=>{const c=this._delegatedListeners[p];for(let f=0;f<c.length;f++){const b=c[f];if(b.layer===t&&b.listener===s){for(const w in b.delegates)this.off(w,b.delegates[w]);return c.splice(f,1),this}}})(),this)}queryRenderedFeatures(p,t){if(!this.style)return[];let s;const l=p instanceof h.P||Array.isArray(p),c=l?p:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(l?{}:p)||{},c instanceof h.P||typeof c[0]=="number")s=[h.P.convert(c)];else{const f=h.P.convert(c[0]),b=h.P.convert(c[1]);s=[f,new h.P(b.x,f.y),b,new h.P(f.x,b.y),f]}return this.style.queryRenderedFeatures(s,t,this.transform)}querySourceFeatures(p,t){return this.style.querySourceFeatures(p,t)}setStyle(p,t){return(t=h.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&p?(this._diffStyle(p,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(p,t))}setTransformRequest(p){return this._requestManager.setTransformRequest(p),this}_getUIString(p){const t=this._locale[p];if(t==null)throw new Error(`Missing UI string '${p}'`);return t}_updateStyle(p,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(p,t));const s=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!p)),p?(this.style=new jr(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p,t,s):this.style.loadJSON(p,t,s),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new jr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,t){if(typeof p=="string"){const s=this._requestManager.transformRequest(p,"Style");h.h(s,new AbortController).then(l=>{this._updateDiff(l.data,t)}).catch(l=>{l&&this.fire(new h.j(l))})}else typeof p=="object"&&this._updateDiff(p,t)}_updateDiff(p,t){try{this.style.setState(p,t)&&this._update(!0)}catch(s){h.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(p,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():h.w("There is no style added to the map.")}addSource(p,t){return this._lazyInitEmptyStyle(),this.style.addSource(p,t),this._update(!0)}isSourceLoaded(p){const t=this.style&&this.style.sourceCaches[p];if(t!==void 0)return t.loaded();this.fire(new h.j(new Error(`There is no source with ID '${p}'`)))}setTerrain(p){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),p){const t=this.style.sourceCaches[p.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${p.source}`);this.terrain===null&&t.reload();for(const s in this.style._layers){const l=this.style._layers[s];l.type==="hillshade"&&l.source===p.source&&h.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new _u(this.painter,t,p),this.painter.renderToTexture=new Dl(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=s=>{s.dataType==="style"?this.terrain.sourceCache.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==p.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new h.k("terrain",{terrain:p})),this}getTerrain(){var p,t;return(t=(p=this.terrain)===null||p===void 0?void 0:p.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const p=this.style&&this.style.sourceCaches;for(const t in p){const s=p[t]._tiles;for(const l in s){const c=s[l];if(c.state!=="loaded"&&c.state!=="errored")return!1}}return!0}removeSource(p){return this.style.removeSource(p),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,t,s={}){const{pixelRatio:l=1,sdf:c=!1,stretchX:f,stretchY:b,content:w}=s;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||h.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new h.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:E,height:A,data:M}=t,k=t;return this.style.addImage(p,{data:new h.R({width:E,height:A},new Uint8Array(M)),pixelRatio:l,stretchX:f,stretchY:b,content:w,sdf:c,version:0,userImage:k}),k.onAdd&&k.onAdd(this,p),this}}{const{width:E,height:A,data:M}=N.getImageData(t);this.style.addImage(p,{data:new h.R({width:E,height:A},M),pixelRatio:l,stretchX:f,stretchY:b,content:w,sdf:c,version:0})}}updateImage(p,t){const s=this.style.getImage(p);if(!s)return this.fire(new h.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=t instanceof HTMLImageElement||h.b(t)?N.getImageData(t):t,{width:c,height:f,data:b}=l;if(c===void 0||f===void 0)return this.fire(new h.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(c!==s.data.width||f!==s.data.height)return this.fire(new h.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(t instanceof HTMLImageElement||h.b(t));return s.data.replace(b,w),this.style.updateImage(p,s),this}getImage(p){return this.style.getImage(p)}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new h.j(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p){return me.getImage(this._requestManager.transformRequest(p,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(p,t){return this._lazyInitEmptyStyle(),this.style.addLayer(p,t),this._update(!0)}moveLayer(p,t){return this.style.moveLayer(p,t),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(p,t,s){return this.style.setLayerZoomRange(p,t,s),this._update(!0)}setFilter(p,t,s={}){return this.style.setFilter(p,t,s),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,t,s,l={}){return this.style.setPaintProperty(p,t,s,l),this._update(!0)}getPaintProperty(p,t){return this.style.getPaintProperty(p,t)}setLayoutProperty(p,t,s,l={}){return this.style.setLayoutProperty(p,t,s,l),this._update(!0)}getLayoutProperty(p,t){return this.style.getLayoutProperty(p,t)}setGlyphs(p,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(p,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(p,t,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(p,t,s,l=>{l||this._update(!0)}),this}removeSprite(p){return this._lazyInitEmptyStyle(),this.style.removeSprite(p),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(p,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(p,t,s=>{s||this._update(!0)}),this}setLight(p,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(p,t){return this.style.setFeatureState(p,t),this._update()}removeFeatureState(p,t){return this.style.removeFeatureState(p,t),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let p=0,t=0;return this._container&&(p=this._container.clientWidth||400,t=this._container.clientHeight||300),[p,t]}_setupContainer(){const p=this._container;p.classList.add("maplibregl-map");const t=this._canvasContainer=$.create("div","maplibregl-canvas-container",p);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=$.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),l=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],l);const c=this._controlContainer=$.create("div","maplibregl-control-container",p),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{f[b]=$.create("div",`maplibregl-ctrl-${b} `,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,t,s){this._canvas.width=Math.floor(s*p),this._canvas.height=Math.floor(s*t),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const p={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",l=>{t={requestedAttributes:p},l&&(t.statusMessage=l.statusMessage,t.type=l.type)},{once:!0});const s=this._canvas.getContext("webgl2",p)||this._canvas.getContext("webgl",p);if(!s){const l="Failed to initialize WebGL";throw t?(t.message=l,new Error(JSON.stringify(t))):new Error(l)}this.painter=new nu(s,this.transform),ge.testSupport(s)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_render(p){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._removed)return;let s=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const c=this.transform.zoom,f=N.now();this.style.zoomHistory.update(c,f);const b=new h.a8(c,{now:f,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),w=b.crossFadingFactor();w===1&&w===this._crossFadingFactor||(s=!0,this._crossFadingFactor=w),this.style.update(b)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new h.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,h.bc.mark(h.bd.load),this.fire(new h.k("load"))),this.style&&(this.style.hasTransitions()||s)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const l=this._sourcesDirty||this._styleDirty||this._placementDirty;return l||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new h.k("idle")),!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,h.bc.mark(h.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var p;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),me.removeThrottleControl(this._imageQueueHandle),(p=this._resizeObserver)===null||p===void 0||p.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),$.remove(this._canvasContainer),$.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),h.bc.clearMetrics(),this._removed=!0,this.fire(new h.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,N.frameAsync(this._frameRequest).then(p=>{h.bc.frame(p),this._frameRequest=null,this._render(p)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get version(){return Rl}getCameraTargetElevation(){return this.transform.elevation}},x.MapMouseEvent=zr,x.MapTouchEvent=wn,x.MapWheelEvent=Il,x.Marker=Co,x.NavigationControl=class{constructor(p){this._updateZoomButtons=()=>{const t=this._map.getZoom(),s=t===this._map.getMaxZoom(),l=t===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,s)=>{const l=this._map._getUIString(`NavigationControl.${s}`);t.title=l,t.setAttribute("aria-label",l)},this.options=h.e({},Ll,p),this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),$.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),$.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=$.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Fl(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){$.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(p,t){const s=$.create("button",p,this._container);return s.type="button",s.addEventListener("click",t),s}},x.Popup=class extends h.E{constructor(p){super(),this.remove=()=>(this._content&&$.remove(this._content),this._container&&($.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new h.k("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{var s;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=$.create("div","maplibregl-popup",this._map.getContainer()),this._tip=$.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const w of this.options.className.split(" "))this._container.classList.add(w);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Ea(this._lngLat,this._flatPos,this._map.transform):(s=this._lngLat)===null||s===void 0?void 0:s.wrap(),this._trackPointer&&!t)return;const l=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationPoint(this._lngLat));let c=this.options.anchor;const f=Ma(this.options.offset);if(!c){const w=this._container.offsetWidth,E=this._container.offsetHeight;let A;A=l.y+f.bottom.y<E?["top"]:l.y>this._map.transform.height-E?["bottom"]:[],l.x<w/2?A.push("left"):l.x>this._map.transform.width-w/2&&A.push("right"),c=A.length===0?"bottom":A.join("-")}let b=l.add(f[c]);this.options.subpixelPositioning||(b=b.round()),$.setTransform(this._container,`${Po[c]} translate(${b.x}px,${b.y}px)`),Ia(this._container,c,"popup")},this._onClose=()=>{this.remove()},this.options=h.e(Object.create(Ol),p)}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new h.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(p){return this._lngLat=h.M.convert(p),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const t=document.createDocumentFragment(),s=document.createElement("body");let l;for(s.innerHTML=p;l=s.firstChild,l;)t.appendChild(l);return this.setDOMContent(t)}getMaxWidth(){var p;return(p=this._container)===null||p===void 0?void 0:p.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=$.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(p){this._container&&this._container.classList.add(p)}removeClassName(p){this._container&&this._container.classList.remove(p)}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){if(this._container)return this._container.classList.toggle(p)}setSubpixelPositioning(p){this.options.subpixelPositioning=p}_createCloseButton(){this.options.closeButton&&(this._closeButton=$.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(Bl);p&&p.focus()}},x.RasterDEMTileSource=je,x.RasterTileSource=ee,x.ScaleControl=class{constructor(p){this._onMove=()=>{Ca(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Ca(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Pa),p)}getDefaultPosition(){return"bottom-left"}onAdd(p){return this._map=p,this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){$.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},x.ScrollZoomHandler=wa,x.Style=jr,x.TerrainControl=class{constructor(p){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=p}onAdd(p){return this._map=p,this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=$.create("button","maplibregl-ctrl-terrain",this._container),$.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){$.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},x.TwoFingersTouchPitchHandler=du,x.TwoFingersTouchRotateHandler=Pl,x.TwoFingersTouchZoomHandler=hu,x.TwoFingersTouchZoomRotateHandler=So,x.VectorTileSource=De,x.VideoSource=Fe,x.addSourceType=(p,t)=>h._(void 0,void 0,void 0,function*(){if(ft(p))throw new Error(`A source type called "${p}" already exists.`);((s,l)=>{wt[s]=l})(p,t)}),x.clearPrewarmedResources=function(){const p=mr;p&&(p.isPreloaded()&&p.numActive()===1?(p.release(ni),mr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},x.getMaxParallelImageRequests=function(){return h.a.MAX_PARALLEL_IMAGE_REQUESTS},x.getRTLTextPluginStatus=function(){return Ce().getRTLTextPluginStatus()},x.getVersion=function(){return yu},x.getWorkerCount=function(){return ur.workerCount},x.getWorkerUrl=function(){return h.a.WORKER_URL},x.importScriptInWorkers=function(p){return Qe().broadcast("IS",p)},x.prewarm=function(){Pe().acquire(ni)},x.setMaxParallelImageRequests=function(p){h.a.MAX_PARALLEL_IMAGE_REQUESTS=p},x.setRTLTextPlugin=function(p,t){return Ce().setRTLTextPlugin(p,t)},x.setWorkerCount=function(p){ur.workerCount=p},x.setWorkerUrl=function(p){h.a.WORKER_URL=p}});var T=d;return T})})(vy);var Ow=vy.exports;const Lg=xy(Ow),Bw=oo("MapStore",{state:()=>({map:{},currentTopicMapStyle:{}})}),wy=oo("MainStore",{state:()=>({lastSearchMethod:"",currentAddress:""}),actions:{setCurrentAddress(n){this.currentAddress=n},setLastSearchMethod(n){this.lastSearchMethod=n}}}),kn=oo("AddressStore",{state:()=>({addressData:{}}),actions:{async fillAddressData(n){try{const a=await fetch(`https://api.phila.gov/ais/v1/search/${n}?include_units=false`);a.ok?(console.log("Address - await resolved and HTTP status is successful"),this.addressData=await a.json()):(console.log("Address - await resolved but HTTP status was not successful"),this.addressData={})}catch{console.error("Address - await never resolved, failed to fetch address data")}}},getters:{getOpaOwners:n=>n.addressData.features[0].properties.opa_owners.join(", ")}});function Sy(n,a){return function(){return n.apply(a,arguments)}}const{toString:Nw}=Object.prototype,{getPrototypeOf:Jp}=Object,Dh=(n=>a=>{const d=Nw.call(a);return n[d]||(n[d]=d.slice(8,-1).toLowerCase())})(Object.create(null)),ss=n=>(n=n.toLowerCase(),a=>Dh(a)===n),zh=n=>a=>typeof a===n,{isArray:ol}=Array,Cc=zh("undefined");function Vw(n){return n!==null&&!Cc(n)&&n.constructor!==null&&!Cc(n.constructor)&&Mn(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const Ty=ss("ArrayBuffer");function $w(n){let a;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?a=ArrayBuffer.isView(n):a=n&&n.buffer&&Ty(n.buffer),a}const Uw=zh("string"),Mn=zh("function"),Ey=zh("number"),Rh=n=>n!==null&&typeof n=="object",jw=n=>n===!0||n===!1,eh=n=>{if(Dh(n)!=="object")return!1;const a=Jp(n);return(a===null||a===Object.prototype||Object.getPrototypeOf(a)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},qw=ss("Date"),Gw=ss("File"),Hw=ss("Blob"),Zw=ss("FileList"),Ww=n=>Rh(n)&&Mn(n.pipe),Kw=n=>{let a;return n&&(typeof FormData=="function"&&n instanceof FormData||Mn(n.append)&&((a=Dh(n))==="formdata"||a==="object"&&Mn(n.toString)&&n.toString()==="[object FormData]"))},Xw=ss("URLSearchParams"),Yw=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function zc(n,a,{allOwnKeys:d=!1}={}){if(n===null||typeof n>"u")return;let m,v;if(typeof n!="object"&&(n=[n]),ol(n))for(m=0,v=n.length;m<v;m++)a.call(null,n[m],m,n);else{const T=d?Object.getOwnPropertyNames(n):Object.keys(n),x=T.length;let h;for(m=0;m<x;m++)h=T[m],a.call(null,n[h],h,n)}}function Iy(n,a){a=a.toLowerCase();const d=Object.keys(n);let m=d.length,v;for(;m-- >0;)if(v=d[m],a===v.toLowerCase())return v;return null}const Ay=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Py=n=>!Cc(n)&&n!==Ay;function Sp(){const{caseless:n}=Py(this)&&this||{},a={},d=(m,v)=>{const T=n&&Iy(a,v)||v;eh(a[T])&&eh(m)?a[T]=Sp(a[T],m):eh(m)?a[T]=Sp({},m):ol(m)?a[T]=m.slice():a[T]=m};for(let m=0,v=arguments.length;m<v;m++)arguments[m]&&zc(arguments[m],d);return a}const Jw=(n,a,d,{allOwnKeys:m}={})=>(zc(a,(v,T)=>{d&&Mn(v)?n[T]=Sy(v,d):n[T]=v},{allOwnKeys:m}),n),Qw=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),e2=(n,a,d,m)=>{n.prototype=Object.create(a.prototype,m),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:a.prototype}),d&&Object.assign(n.prototype,d)},t2=(n,a,d,m)=>{let v,T,x;const h={};if(a=a||{},n==null)return a;do{for(v=Object.getOwnPropertyNames(n),T=v.length;T-- >0;)x=v[T],(!m||m(x,n,a))&&!h[x]&&(a[x]=n[x],h[x]=!0);n=d!==!1&&Jp(n)}while(n&&(!d||d(n,a))&&n!==Object.prototype);return a},i2=(n,a,d)=>{n=String(n),(d===void 0||d>n.length)&&(d=n.length),d-=a.length;const m=n.indexOf(a,d);return m!==-1&&m===d},r2=n=>{if(!n)return null;if(ol(n))return n;let a=n.length;if(!Ey(a))return null;const d=new Array(a);for(;a-- >0;)d[a]=n[a];return d},n2=(n=>a=>n&&a instanceof n)(typeof Uint8Array<"u"&&Jp(Uint8Array)),s2=(n,a)=>{const m=(n&&n[Symbol.iterator]).call(n);let v;for(;(v=m.next())&&!v.done;){const T=v.value;a.call(n,T[0],T[1])}},o2=(n,a)=>{let d;const m=[];for(;(d=n.exec(a))!==null;)m.push(d);return m},a2=ss("HTMLFormElement"),l2=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(d,m,v){return m.toUpperCase()+v}),Fg=(({hasOwnProperty:n})=>(a,d)=>n.call(a,d))(Object.prototype),c2=ss("RegExp"),Cy=(n,a)=>{const d=Object.getOwnPropertyDescriptors(n),m={};zc(d,(v,T)=>{let x;(x=a(v,T,n))!==!1&&(m[T]=x||v)}),Object.defineProperties(n,m)},u2=n=>{Cy(n,(a,d)=>{if(Mn(n)&&["arguments","caller","callee"].indexOf(d)!==-1)return!1;const m=n[d];if(Mn(m)){if(a.enumerable=!1,"writable"in a){a.writable=!1;return}a.set||(a.set=()=>{throw Error("Can not rewrite read-only method '"+d+"'")})}})},h2=(n,a)=>{const d={},m=v=>{v.forEach(T=>{d[T]=!0})};return ol(n)?m(n):m(String(n).split(a)),d},d2=()=>{},p2=(n,a)=>(n=+n,Number.isFinite(n)?n:a),tp="abcdefghijklmnopqrstuvwxyz",Og="0123456789",My={DIGIT:Og,ALPHA:tp,ALPHA_DIGIT:tp+tp.toUpperCase()+Og},f2=(n=16,a=My.ALPHA_DIGIT)=>{let d="";const{length:m}=a;for(;n--;)d+=a[Math.random()*m|0];return d};function m2(n){return!!(n&&Mn(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const g2=n=>{const a=new Array(10),d=(m,v)=>{if(Rh(m)){if(a.indexOf(m)>=0)return;if(!("toJSON"in m)){a[v]=m;const T=ol(m)?[]:{};return zc(m,(x,h)=>{const R=d(x,v+1);!Cc(R)&&(T[h]=R)}),a[v]=void 0,T}}return m};return d(n,0)},_2=ss("AsyncFunction"),y2=n=>n&&(Rh(n)||Mn(n))&&Mn(n.then)&&Mn(n.catch),Re={isArray:ol,isArrayBuffer:Ty,isBuffer:Vw,isFormData:Kw,isArrayBufferView:$w,isString:Uw,isNumber:Ey,isBoolean:jw,isObject:Rh,isPlainObject:eh,isUndefined:Cc,isDate:qw,isFile:Gw,isBlob:Hw,isRegExp:c2,isFunction:Mn,isStream:Ww,isURLSearchParams:Xw,isTypedArray:n2,isFileList:Zw,forEach:zc,merge:Sp,extend:Jw,trim:Yw,stripBOM:Qw,inherits:e2,toFlatObject:t2,kindOf:Dh,kindOfTest:ss,endsWith:i2,toArray:r2,forEachEntry:s2,matchAll:o2,isHTMLForm:a2,hasOwnProperty:Fg,hasOwnProp:Fg,reduceDescriptors:Cy,freezeMethods:u2,toObjectSet:h2,toCamelCase:l2,noop:d2,toFiniteNumber:p2,findKey:Iy,global:Ay,isContextDefined:Py,ALPHABET:My,generateString:f2,isSpecCompliantForm:m2,toJSONObject:g2,isAsyncFn:_2,isThenable:y2};function ti(n,a,d,m,v){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",a&&(this.code=a),d&&(this.config=d),m&&(this.request=m),v&&(this.response=v)}Re.inherits(ti,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Re.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const ky=ti.prototype,Dy={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{Dy[n]={value:n}});Object.defineProperties(ti,Dy);Object.defineProperty(ky,"isAxiosError",{value:!0});ti.from=(n,a,d,m,v,T)=>{const x=Object.create(ky);return Re.toFlatObject(n,x,function(R){return R!==Error.prototype},h=>h!=="isAxiosError"),ti.call(x,n.message,a,d,m,v),x.cause=n,x.name=n.name,T&&Object.assign(x,T),x};const x2=null;function Tp(n){return Re.isPlainObject(n)||Re.isArray(n)}function zy(n){return Re.endsWith(n,"[]")?n.slice(0,-2):n}function Bg(n,a,d){return n?n.concat(a).map(function(v,T){return v=zy(v),!d&&T?"["+v+"]":v}).join(d?".":""):a}function v2(n){return Re.isArray(n)&&!n.some(Tp)}const b2=Re.toFlatObject(Re,{},null,function(a){return/^is[A-Z]/.test(a)});function Lh(n,a,d){if(!Re.isObject(n))throw new TypeError("target must be an object");a=a||new FormData,d=Re.toFlatObject(d,{metaTokens:!0,dots:!1,indexes:!1},!1,function(Ee,Ke){return!Re.isUndefined(Ke[Ee])});const m=d.metaTokens,v=d.visitor||U,T=d.dots,x=d.indexes,R=(d.Blob||typeof Blob<"u"&&Blob)&&Re.isSpecCompliantForm(a);if(!Re.isFunction(v))throw new TypeError("visitor must be a function");function j(xe){if(xe===null)return"";if(Re.isDate(xe))return xe.toISOString();if(!R&&Re.isBlob(xe))throw new ti("Blob is not supported. Use a Buffer instead.");return Re.isArrayBuffer(xe)||Re.isTypedArray(xe)?R&&typeof Blob=="function"?new Blob([xe]):Buffer.from(xe):xe}function U(xe,Ee,Ke){let Ne=xe;if(xe&&!Ke&&typeof xe=="object"){if(Re.endsWith(Ee,"{}"))Ee=m?Ee:Ee.slice(0,-2),xe=JSON.stringify(xe);else if(Re.isArray(xe)&&v2(xe)||(Re.isFileList(xe)||Re.endsWith(Ee,"[]"))&&(Ne=Re.toArray(xe)))return Ee=zy(Ee),Ne.forEach(function(me,We){!(Re.isUndefined(me)||me===null)&&a.append(x===!0?Bg([Ee],We,T):x===null?Ee:Ee+"[]",j(me))}),!1}return Tp(xe)?!0:(a.append(Bg(Ke,Ee,T),j(xe)),!1)}const N=[],$=Object.assign(b2,{defaultVisitor:U,convertValue:j,isVisitable:Tp});function ge(xe,Ee){if(!Re.isUndefined(xe)){if(N.indexOf(xe)!==-1)throw Error("Circular reference detected in "+Ee.join("."));N.push(xe),Re.forEach(xe,function(Ne,He){(!(Re.isUndefined(Ne)||Ne===null)&&v.call(a,Ne,Re.isString(He)?He.trim():He,Ee,$))===!0&&ge(Ne,Ee?Ee.concat(He):[He])}),N.pop()}}if(!Re.isObject(n))throw new TypeError("data must be an object");return ge(n),a}function Ng(n){const a={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(m){return a[m]})}function Qp(n,a){this._pairs=[],n&&Lh(n,this,a)}const Ry=Qp.prototype;Ry.append=function(a,d){this._pairs.push([a,d])};Ry.toString=function(a){const d=a?function(m){return a.call(this,m,Ng)}:Ng;return this._pairs.map(function(v){return d(v[0])+"="+d(v[1])},"").join("&")};function w2(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Ly(n,a,d){if(!a)return n;const m=d&&d.encode||w2,v=d&&d.serialize;let T;if(v?T=v(a,d):T=Re.isURLSearchParams(a)?a.toString():new Qp(a,d).toString(m),T){const x=n.indexOf("#");x!==-1&&(n=n.slice(0,x)),n+=(n.indexOf("?")===-1?"?":"&")+T}return n}class Vg{constructor(){this.handlers=[]}use(a,d,m){return this.handlers.push({fulfilled:a,rejected:d,synchronous:m?m.synchronous:!1,runWhen:m?m.runWhen:null}),this.handlers.length-1}eject(a){this.handlers[a]&&(this.handlers[a]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(a){Re.forEach(this.handlers,function(m){m!==null&&a(m)})}}const Fy={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},S2=typeof URLSearchParams<"u"?URLSearchParams:Qp,T2=typeof FormData<"u"?FormData:null,E2=typeof Blob<"u"?Blob:null,I2={isBrowser:!0,classes:{URLSearchParams:S2,FormData:T2,Blob:E2},protocols:["http","https","file","blob","url","data"]},Oy=typeof window<"u"&&typeof document<"u",A2=(n=>Oy&&["ReactNative","NativeScript","NS"].indexOf(n)<0)(typeof navigator<"u"&&navigator.product),P2=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",C2=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Oy,hasStandardBrowserEnv:A2,hasStandardBrowserWebWorkerEnv:P2},Symbol.toStringTag,{value:"Module"})),rs={...C2,...I2};function M2(n,a){return Lh(n,new rs.classes.URLSearchParams,Object.assign({visitor:function(d,m,v,T){return rs.isNode&&Re.isBuffer(d)?(this.append(m,d.toString("base64")),!1):T.defaultVisitor.apply(this,arguments)}},a))}function k2(n){return Re.matchAll(/\w+|\[(\w*)]/g,n).map(a=>a[0]==="[]"?"":a[1]||a[0])}function D2(n){const a={},d=Object.keys(n);let m;const v=d.length;let T;for(m=0;m<v;m++)T=d[m],a[T]=n[T];return a}function By(n){function a(d,m,v,T){let x=d[T++];if(x==="__proto__")return!0;const h=Number.isFinite(+x),R=T>=d.length;return x=!x&&Re.isArray(v)?v.length:x,R?(Re.hasOwnProp(v,x)?v[x]=[v[x],m]:v[x]=m,!h):((!v[x]||!Re.isObject(v[x]))&&(v[x]=[]),a(d,m,v[x],T)&&Re.isArray(v[x])&&(v[x]=D2(v[x])),!h)}if(Re.isFormData(n)&&Re.isFunction(n.entries)){const d={};return Re.forEachEntry(n,(m,v)=>{a(k2(m),v,d,0)}),d}return null}function z2(n,a,d){if(Re.isString(n))try{return(a||JSON.parse)(n),Re.trim(n)}catch(m){if(m.name!=="SyntaxError")throw m}return(d||JSON.stringify)(n)}const ef={transitional:Fy,adapter:["xhr","http"],transformRequest:[function(a,d){const m=d.getContentType()||"",v=m.indexOf("application/json")>-1,T=Re.isObject(a);if(T&&Re.isHTMLForm(a)&&(a=new FormData(a)),Re.isFormData(a))return v?JSON.stringify(By(a)):a;if(Re.isArrayBuffer(a)||Re.isBuffer(a)||Re.isStream(a)||Re.isFile(a)||Re.isBlob(a))return a;if(Re.isArrayBufferView(a))return a.buffer;if(Re.isURLSearchParams(a))return d.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),a.toString();let h;if(T){if(m.indexOf("application/x-www-form-urlencoded")>-1)return M2(a,this.formSerializer).toString();if((h=Re.isFileList(a))||m.indexOf("multipart/form-data")>-1){const R=this.env&&this.env.FormData;return Lh(h?{"files[]":a}:a,R&&new R,this.formSerializer)}}return T||v?(d.setContentType("application/json",!1),z2(a)):a}],transformResponse:[function(a){const d=this.transitional||ef.transitional,m=d&&d.forcedJSONParsing,v=this.responseType==="json";if(a&&Re.isString(a)&&(m&&!this.responseType||v)){const x=!(d&&d.silentJSONParsing)&&v;try{return JSON.parse(a)}catch(h){if(x)throw h.name==="SyntaxError"?ti.from(h,ti.ERR_BAD_RESPONSE,this,null,this.response):h}}return a}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:rs.classes.FormData,Blob:rs.classes.Blob},validateStatus:function(a){return a>=200&&a<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Re.forEach(["delete","get","head","post","put","patch"],n=>{ef.headers[n]={}});const tf=ef,R2=Re.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),L2=n=>{const a={};let d,m,v;return n&&n.split(`
`).forEach(function(x){v=x.indexOf(":"),d=x.substring(0,v).trim().toLowerCase(),m=x.substring(v+1).trim(),!(!d||a[d]&&R2[d])&&(d==="set-cookie"?a[d]?a[d].push(m):a[d]=[m]:a[d]=a[d]?a[d]+", "+m:m)}),a},$g=Symbol("internals");function cc(n){return n&&String(n).trim().toLowerCase()}function th(n){return n===!1||n==null?n:Re.isArray(n)?n.map(th):String(n)}function F2(n){const a=Object.create(null),d=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let m;for(;m=d.exec(n);)a[m[1]]=m[2];return a}const O2=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function ip(n,a,d,m,v){if(Re.isFunction(m))return m.call(this,a,d);if(v&&(a=d),!!Re.isString(a)){if(Re.isString(m))return a.indexOf(m)!==-1;if(Re.isRegExp(m))return m.test(a)}}function B2(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(a,d,m)=>d.toUpperCase()+m)}function N2(n,a){const d=Re.toCamelCase(" "+a);["get","set","has"].forEach(m=>{Object.defineProperty(n,m+d,{value:function(v,T,x){return this[m].call(this,a,v,T,x)},configurable:!0})})}class Fh{constructor(a){a&&this.set(a)}set(a,d,m){const v=this;function T(h,R,j){const U=cc(R);if(!U)throw new Error("header name must be a non-empty string");const N=Re.findKey(v,U);(!N||v[N]===void 0||j===!0||j===void 0&&v[N]!==!1)&&(v[N||R]=th(h))}const x=(h,R)=>Re.forEach(h,(j,U)=>T(j,U,R));return Re.isPlainObject(a)||a instanceof this.constructor?x(a,d):Re.isString(a)&&(a=a.trim())&&!O2(a)?x(L2(a),d):a!=null&&T(d,a,m),this}get(a,d){if(a=cc(a),a){const m=Re.findKey(this,a);if(m){const v=this[m];if(!d)return v;if(d===!0)return F2(v);if(Re.isFunction(d))return d.call(this,v,m);if(Re.isRegExp(d))return d.exec(v);throw new TypeError("parser must be boolean|regexp|function")}}}has(a,d){if(a=cc(a),a){const m=Re.findKey(this,a);return!!(m&&this[m]!==void 0&&(!d||ip(this,this[m],m,d)))}return!1}delete(a,d){const m=this;let v=!1;function T(x){if(x=cc(x),x){const h=Re.findKey(m,x);h&&(!d||ip(m,m[h],h,d))&&(delete m[h],v=!0)}}return Re.isArray(a)?a.forEach(T):T(a),v}clear(a){const d=Object.keys(this);let m=d.length,v=!1;for(;m--;){const T=d[m];(!a||ip(this,this[T],T,a,!0))&&(delete this[T],v=!0)}return v}normalize(a){const d=this,m={};return Re.forEach(this,(v,T)=>{const x=Re.findKey(m,T);if(x){d[x]=th(v),delete d[T];return}const h=a?B2(T):String(T).trim();h!==T&&delete d[T],d[h]=th(v),m[h]=!0}),this}concat(...a){return this.constructor.concat(this,...a)}toJSON(a){const d=Object.create(null);return Re.forEach(this,(m,v)=>{m!=null&&m!==!1&&(d[v]=a&&Re.isArray(m)?m.join(", "):m)}),d}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([a,d])=>a+": "+d).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(a){return a instanceof this?a:new this(a)}static concat(a,...d){const m=new this(a);return d.forEach(v=>m.set(v)),m}static accessor(a){const m=(this[$g]=this[$g]={accessors:{}}).accessors,v=this.prototype;function T(x){const h=cc(x);m[h]||(N2(v,x),m[h]=!0)}return Re.isArray(a)?a.forEach(T):T(a),this}}Fh.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Re.reduceDescriptors(Fh.prototype,({value:n},a)=>{let d=a[0].toUpperCase()+a.slice(1);return{get:()=>n,set(m){this[d]=m}}});Re.freezeMethods(Fh);const Es=Fh;function rp(n,a){const d=this||tf,m=a||d,v=Es.from(m.headers);let T=m.data;return Re.forEach(n,function(h){T=h.call(d,T,v.normalize(),a?a.status:void 0)}),v.normalize(),T}function Ny(n){return!!(n&&n.__CANCEL__)}function Rc(n,a,d){ti.call(this,n??"canceled",ti.ERR_CANCELED,a,d),this.name="CanceledError"}Re.inherits(Rc,ti,{__CANCEL__:!0});function V2(n,a,d){const m=d.config.validateStatus;!d.status||!m||m(d.status)?n(d):a(new ti("Request failed with status code "+d.status,[ti.ERR_BAD_REQUEST,ti.ERR_BAD_RESPONSE][Math.floor(d.status/100)-4],d.config,d.request,d))}const $2=rs.hasStandardBrowserEnv?{write(n,a,d,m,v,T){const x=[n+"="+encodeURIComponent(a)];Re.isNumber(d)&&x.push("expires="+new Date(d).toGMTString()),Re.isString(m)&&x.push("path="+m),Re.isString(v)&&x.push("domain="+v),T===!0&&x.push("secure"),document.cookie=x.join("; ")},read(n){const a=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return a?decodeURIComponent(a[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function U2(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function j2(n,a){return a?n.replace(/\/?\/$/,"")+"/"+a.replace(/^\/+/,""):n}function Vy(n,a){return n&&!U2(a)?j2(n,a):a}const q2=rs.hasStandardBrowserEnv?function(){const a=/(msie|trident)/i.test(navigator.userAgent),d=document.createElement("a");let m;function v(T){let x=T;return a&&(d.setAttribute("href",x),x=d.href),d.setAttribute("href",x),{href:d.href,protocol:d.protocol?d.protocol.replace(/:$/,""):"",host:d.host,search:d.search?d.search.replace(/^\?/,""):"",hash:d.hash?d.hash.replace(/^#/,""):"",hostname:d.hostname,port:d.port,pathname:d.pathname.charAt(0)==="/"?d.pathname:"/"+d.pathname}}return m=v(window.location.href),function(x){const h=Re.isString(x)?v(x):x;return h.protocol===m.protocol&&h.host===m.host}}():function(){return function(){return!0}}();function G2(n){const a=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return a&&a[1]||""}function H2(n,a){n=n||10;const d=new Array(n),m=new Array(n);let v=0,T=0,x;return a=a!==void 0?a:1e3,function(R){const j=Date.now(),U=m[T];x||(x=j),d[v]=R,m[v]=j;let N=T,$=0;for(;N!==v;)$+=d[N++],N=N%n;if(v=(v+1)%n,v===T&&(T=(T+1)%n),j-x<a)return;const ge=U&&j-U;return ge?Math.round($*1e3/ge):void 0}}function Ug(n,a){let d=0;const m=H2(50,250);return v=>{const T=v.loaded,x=v.lengthComputable?v.total:void 0,h=T-d,R=m(h),j=T<=x;d=T;const U={loaded:T,total:x,progress:x?T/x:void 0,bytes:h,rate:R||void 0,estimated:R&&x&&j?(x-T)/R:void 0,event:v};U[a?"download":"upload"]=!0,n(U)}}const Z2=typeof XMLHttpRequest<"u",W2=Z2&&function(n){return new Promise(function(d,m){let v=n.data;const T=Es.from(n.headers).normalize();let{responseType:x,withXSRFToken:h}=n,R;function j(){n.cancelToken&&n.cancelToken.unsubscribe(R),n.signal&&n.signal.removeEventListener("abort",R)}let U;if(Re.isFormData(v)){if(rs.hasStandardBrowserEnv||rs.hasStandardBrowserWebWorkerEnv)T.setContentType(!1);else if((U=T.getContentType())!==!1){const[Ee,...Ke]=U?U.split(";").map(Ne=>Ne.trim()).filter(Boolean):[];T.setContentType([Ee||"multipart/form-data",...Ke].join("; "))}}let N=new XMLHttpRequest;if(n.auth){const Ee=n.auth.username||"",Ke=n.auth.password?unescape(encodeURIComponent(n.auth.password)):"";T.set("Authorization","Basic "+btoa(Ee+":"+Ke))}const $=Vy(n.baseURL,n.url);N.open(n.method.toUpperCase(),Ly($,n.params,n.paramsSerializer),!0),N.timeout=n.timeout;function ge(){if(!N)return;const Ee=Es.from("getAllResponseHeaders"in N&&N.getAllResponseHeaders()),Ne={data:!x||x==="text"||x==="json"?N.responseText:N.response,status:N.status,statusText:N.statusText,headers:Ee,config:n,request:N};V2(function(me){d(me),j()},function(me){m(me),j()},Ne),N=null}if("onloadend"in N?N.onloadend=ge:N.onreadystatechange=function(){!N||N.readyState!==4||N.status===0&&!(N.responseURL&&N.responseURL.indexOf("file:")===0)||setTimeout(ge)},N.onabort=function(){N&&(m(new ti("Request aborted",ti.ECONNABORTED,n,N)),N=null)},N.onerror=function(){m(new ti("Network Error",ti.ERR_NETWORK,n,N)),N=null},N.ontimeout=function(){let Ke=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const Ne=n.transitional||Fy;n.timeoutErrorMessage&&(Ke=n.timeoutErrorMessage),m(new ti(Ke,Ne.clarifyTimeoutError?ti.ETIMEDOUT:ti.ECONNABORTED,n,N)),N=null},rs.hasStandardBrowserEnv&&(h&&Re.isFunction(h)&&(h=h(n)),h||h!==!1&&q2($))){const Ee=n.xsrfHeaderName&&n.xsrfCookieName&&$2.read(n.xsrfCookieName);Ee&&T.set(n.xsrfHeaderName,Ee)}v===void 0&&T.setContentType(null),"setRequestHeader"in N&&Re.forEach(T.toJSON(),function(Ke,Ne){N.setRequestHeader(Ne,Ke)}),Re.isUndefined(n.withCredentials)||(N.withCredentials=!!n.withCredentials),x&&x!=="json"&&(N.responseType=n.responseType),typeof n.onDownloadProgress=="function"&&N.addEventListener("progress",Ug(n.onDownloadProgress,!0)),typeof n.onUploadProgress=="function"&&N.upload&&N.upload.addEventListener("progress",Ug(n.onUploadProgress)),(n.cancelToken||n.signal)&&(R=Ee=>{N&&(m(!Ee||Ee.type?new Rc(null,n,N):Ee),N.abort(),N=null)},n.cancelToken&&n.cancelToken.subscribe(R),n.signal&&(n.signal.aborted?R():n.signal.addEventListener("abort",R)));const xe=G2($);if(xe&&rs.protocols.indexOf(xe)===-1){m(new ti("Unsupported protocol "+xe+":",ti.ERR_BAD_REQUEST,n));return}N.send(v||null)})},Ep={http:x2,xhr:W2};Re.forEach(Ep,(n,a)=>{if(n){try{Object.defineProperty(n,"name",{value:a})}catch{}Object.defineProperty(n,"adapterName",{value:a})}});const jg=n=>`- ${n}`,K2=n=>Re.isFunction(n)||n===null||n===!1,$y={getAdapter:n=>{n=Re.isArray(n)?n:[n];const{length:a}=n;let d,m;const v={};for(let T=0;T<a;T++){d=n[T];let x;if(m=d,!K2(d)&&(m=Ep[(x=String(d)).toLowerCase()],m===void 0))throw new ti(`Unknown adapter '${x}'`);if(m)break;v[x||"#"+T]=m}if(!m){const T=Object.entries(v).map(([h,R])=>`adapter ${h} `+(R===!1?"is not supported by the environment":"is not available in the build"));let x=a?T.length>1?`since :
`+T.map(jg).join(`
`):" "+jg(T[0]):"as no adapter specified";throw new ti("There is no suitable adapter to dispatch the request "+x,"ERR_NOT_SUPPORT")}return m},adapters:Ep};function np(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Rc(null,n)}function qg(n){return np(n),n.headers=Es.from(n.headers),n.data=rp.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),$y.getAdapter(n.adapter||tf.adapter)(n).then(function(m){return np(n),m.data=rp.call(n,n.transformResponse,m),m.headers=Es.from(m.headers),m},function(m){return Ny(m)||(np(n),m&&m.response&&(m.response.data=rp.call(n,n.transformResponse,m.response),m.response.headers=Es.from(m.response.headers))),Promise.reject(m)})}const Gg=n=>n instanceof Es?{...n}:n;function nl(n,a){a=a||{};const d={};function m(j,U,N){return Re.isPlainObject(j)&&Re.isPlainObject(U)?Re.merge.call({caseless:N},j,U):Re.isPlainObject(U)?Re.merge({},U):Re.isArray(U)?U.slice():U}function v(j,U,N){if(Re.isUndefined(U)){if(!Re.isUndefined(j))return m(void 0,j,N)}else return m(j,U,N)}function T(j,U){if(!Re.isUndefined(U))return m(void 0,U)}function x(j,U){if(Re.isUndefined(U)){if(!Re.isUndefined(j))return m(void 0,j)}else return m(void 0,U)}function h(j,U,N){if(N in a)return m(j,U);if(N in n)return m(void 0,j)}const R={url:T,method:T,data:T,baseURL:x,transformRequest:x,transformResponse:x,paramsSerializer:x,timeout:x,timeoutMessage:x,withCredentials:x,withXSRFToken:x,adapter:x,responseType:x,xsrfCookieName:x,xsrfHeaderName:x,onUploadProgress:x,onDownloadProgress:x,decompress:x,maxContentLength:x,maxBodyLength:x,beforeRedirect:x,transport:x,httpAgent:x,httpsAgent:x,cancelToken:x,socketPath:x,responseEncoding:x,validateStatus:h,headers:(j,U)=>v(Gg(j),Gg(U),!0)};return Re.forEach(Object.keys(Object.assign({},n,a)),function(U){const N=R[U]||v,$=N(n[U],a[U],U);Re.isUndefined($)&&N!==h||(d[U]=$)}),d}const Uy="1.6.8",rf={};["object","boolean","number","function","string","symbol"].forEach((n,a)=>{rf[n]=function(m){return typeof m===n||"a"+(a<1?"n ":" ")+n}});const Hg={};rf.transitional=function(a,d,m){function v(T,x){return"[Axios v"+Uy+"] Transitional option '"+T+"'"+x+(m?". "+m:"")}return(T,x,h)=>{if(a===!1)throw new ti(v(x," has been removed"+(d?" in "+d:"")),ti.ERR_DEPRECATED);return d&&!Hg[x]&&(Hg[x]=!0,console.warn(v(x," has been deprecated since v"+d+" and will be removed in the near future"))),a?a(T,x,h):!0}};function X2(n,a,d){if(typeof n!="object")throw new ti("options must be an object",ti.ERR_BAD_OPTION_VALUE);const m=Object.keys(n);let v=m.length;for(;v-- >0;){const T=m[v],x=a[T];if(x){const h=n[T],R=h===void 0||x(h,T,n);if(R!==!0)throw new ti("option "+T+" must be "+R,ti.ERR_BAD_OPTION_VALUE);continue}if(d!==!0)throw new ti("Unknown option "+T,ti.ERR_BAD_OPTION)}}const Ip={assertOptions:X2,validators:rf},Ws=Ip.validators;class uh{constructor(a){this.defaults=a,this.interceptors={request:new Vg,response:new Vg}}async request(a,d){try{return await this._request(a,d)}catch(m){if(m instanceof Error){let v;Error.captureStackTrace?Error.captureStackTrace(v={}):v=new Error;const T=v.stack?v.stack.replace(/^.+\n/,""):"";m.stack?T&&!String(m.stack).endsWith(T.replace(/^.+\n.+\n/,""))&&(m.stack+=`
`+T):m.stack=T}throw m}}_request(a,d){typeof a=="string"?(d=d||{},d.url=a):d=a||{},d=nl(this.defaults,d);const{transitional:m,paramsSerializer:v,headers:T}=d;m!==void 0&&Ip.assertOptions(m,{silentJSONParsing:Ws.transitional(Ws.boolean),forcedJSONParsing:Ws.transitional(Ws.boolean),clarifyTimeoutError:Ws.transitional(Ws.boolean)},!1),v!=null&&(Re.isFunction(v)?d.paramsSerializer={serialize:v}:Ip.assertOptions(v,{encode:Ws.function,serialize:Ws.function},!0)),d.method=(d.method||this.defaults.method||"get").toLowerCase();let x=T&&Re.merge(T.common,T[d.method]);T&&Re.forEach(["delete","get","head","post","put","patch","common"],xe=>{delete T[xe]}),d.headers=Es.concat(x,T);const h=[];let R=!0;this.interceptors.request.forEach(function(Ee){typeof Ee.runWhen=="function"&&Ee.runWhen(d)===!1||(R=R&&Ee.synchronous,h.unshift(Ee.fulfilled,Ee.rejected))});const j=[];this.interceptors.response.forEach(function(Ee){j.push(Ee.fulfilled,Ee.rejected)});let U,N=0,$;if(!R){const xe=[qg.bind(this),void 0];for(xe.unshift.apply(xe,h),xe.push.apply(xe,j),$=xe.length,U=Promise.resolve(d);N<$;)U=U.then(xe[N++],xe[N++]);return U}$=h.length;let ge=d;for(N=0;N<$;){const xe=h[N++],Ee=h[N++];try{ge=xe(ge)}catch(Ke){Ee.call(this,Ke);break}}try{U=qg.call(this,ge)}catch(xe){return Promise.reject(xe)}for(N=0,$=j.length;N<$;)U=U.then(j[N++],j[N++]);return U}getUri(a){a=nl(this.defaults,a);const d=Vy(a.baseURL,a.url);return Ly(d,a.params,a.paramsSerializer)}}Re.forEach(["delete","get","head","options"],function(a){uh.prototype[a]=function(d,m){return this.request(nl(m||{},{method:a,url:d,data:(m||{}).data}))}});Re.forEach(["post","put","patch"],function(a){function d(m){return function(T,x,h){return this.request(nl(h||{},{method:a,headers:m?{"Content-Type":"multipart/form-data"}:{},url:T,data:x}))}}uh.prototype[a]=d(),uh.prototype[a+"Form"]=d(!0)});const ih=uh;class nf{constructor(a){if(typeof a!="function")throw new TypeError("executor must be a function.");let d;this.promise=new Promise(function(T){d=T});const m=this;this.promise.then(v=>{if(!m._listeners)return;let T=m._listeners.length;for(;T-- >0;)m._listeners[T](v);m._listeners=null}),this.promise.then=v=>{let T;const x=new Promise(h=>{m.subscribe(h),T=h}).then(v);return x.cancel=function(){m.unsubscribe(T)},x},a(function(T,x,h){m.reason||(m.reason=new Rc(T,x,h),d(m.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(a){if(this.reason){a(this.reason);return}this._listeners?this._listeners.push(a):this._listeners=[a]}unsubscribe(a){if(!this._listeners)return;const d=this._listeners.indexOf(a);d!==-1&&this._listeners.splice(d,1)}static source(){let a;return{token:new nf(function(v){a=v}),cancel:a}}}const Y2=nf;function J2(n){return function(d){return n.apply(null,d)}}function Q2(n){return Re.isObject(n)&&n.isAxiosError===!0}const Ap={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Ap).forEach(([n,a])=>{Ap[a]=n});const eS=Ap;function jy(n){const a=new ih(n),d=Sy(ih.prototype.request,a);return Re.extend(d,ih.prototype,a,{allOwnKeys:!0}),Re.extend(d,a,null,{allOwnKeys:!0}),d.create=function(v){return jy(nl(n,v))},d}const Wi=jy(tf);Wi.Axios=ih;Wi.CanceledError=Rc;Wi.CancelToken=Y2;Wi.isCancel=Ny;Wi.VERSION=Uy;Wi.toFormData=Lh;Wi.AxiosError=ti;Wi.Cancel=Wi.CanceledError;Wi.all=function(a){return Promise.all(a)};Wi.spread=J2;Wi.isAxiosError=Q2;Wi.mergeConfig=nl;Wi.AxiosHeaders=Es;Wi.formToJSON=n=>By(Re.isHTMLForm(n)?new FormData(n):n);Wi.getAdapter=$y.getAdapter;Wi.HttpStatusCode=eS;Wi.default=Wi;const Oh=oo("ParcelsStore",{state:()=>({PWD:{},DOR:{}}),actions:{async fillPwdParcelData(){const a=kn().addressData.features[0].properties.pwd_parcel_id;if(!a){console.log("no PWD parcel in AIS");return}try{const d=await fetch(`https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/PWD_PARCELS/FeatureServer/0/query?where=PARCELID=%27${a}%27&outSR=4326&f=geojson&outFields=*&returnGeometry=true`);d.ok?this.PWD=await d.json():console.error("Failed to fetch PWD parcel data")}catch{console.error("Failed to fetch PWD parcel data")}},async fillDorParcelData(){const a=kn().addressData.features[0].properties.dor_parcel_id;if(!a){console.log("no DOR parcel in AIS");return}try{const d=await fetch(`https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/DOR_Parcel/FeatureServer/0/query?where=MAPREG=%27${a}%27&outSR=4326&f=geojson&outFields=*&returnGeometry=true`);d.ok?this.DOR=await d.json():console.error("Failed to fetch DOR parcel data")}catch{console.error("Failed to fetch DOR parcel data")}},async fillParcelDataByLngLat(n,a,d){console.log("fillParcelDataByLngLat, lng:",n,"lat:",a,"parcelLayer:",d);let m=d==="PWD"?"PWD_PARCELS":"DOR_Parcel",v={where:"1=1",outSR:4326,f:"geojson",outFields:"*",returnGeometry:!0,geometry:`{ "x": ${n}, "y": ${a}, "spatialReference":{ "wkid":4326 }}`,geometryType:"esriGeometryPoint",spatialRel:"esriSpatialRelWithin"};const T=await Wi(`https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/${m}/FeatureServer/0/query`,{params:v});console.log("response",T),this[d]=T.data.features[0]}}});function tS(){return{pwdDrawnMapStyle:{version:8,name:"pwdDrawnMap",sources:{pwd:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityBasemap/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},pwdLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityBasemap_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256}},layers:[{id:"pwd",source:"pwd",type:"raster"},{id:"pwdLabels",source:"pwdLabels",type:"raster"}]},dorDrawnMapStyle:{version:8,name:"dorDrawnMap",sources:{dor:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/DORBasemap/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},dorLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/DORBasemap_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256}},layers:[{id:"dor",source:"dor",type:"raster"},{id:"dorLabels",source:"dorLabels",type:"raster"}]},zoningDrawnMapStyle:{version:8,name:"dorDrawnMap",sources:{dor:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/DORBasemap/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},dorLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/DORBasemap_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},zoning:{tiles:["https://citygeo-geoserver.databridge.phila.gov/geoserver/wms?service=WMS&version=1.1.0&request=GetMap&layers=atlas_zoning_grouped&bbox={bbox-epsg-3857}&width=256&height=256&srs=EPSG%3A3857&styles=&format=image/png&transparent=true"],type:"raster",tileSize:256}},layers:[{id:"dor",source:"dor",type:"raster"},{id:"dorLabels",source:"dorLabels",type:"raster"},{id:"zoning",source:"zoning",type:"raster"}]},imageryMapStyle:{version:8,name:"imageryMap",sources:{imagery:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2022_2in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},imageryLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},stormwater:{tiles:["https://stormwater.phila.gov/arcgis/rest/services/parcel_viewer/pv_data/MapServer/export?dpi=110            &transparent=true            &format=png36            &bbox={bbox-epsg-3857}            &bboxSR=3857            &imageSR=3857            &size=512,512            &f=image          "],type:"raster",tileSize:256}},layers:[{id:"imagery",source:"imagery",type:"raster"},{id:"imageryLabels",source:"imageryLabels",type:"raster"}]}}}var Pp={exports:{}};/*!
 * accounting.js v0.4.1
 * Copyright 2014 Open Exchange Rates
 *
 * Freely distributable under the MIT license.
 * Portions of accounting.js are inspired or borrowed from underscore.js
 *
 * Full details and documentation:
 * http://openexchangerates.github.io/accounting.js/
 */(function(n,a){(function(d,m){var v={};v.version="0.4.1",v.settings={currency:{symbol:"$",format:"%s%v",decimal:".",thousand:",",precision:2,grouping:3},number:{precision:0,grouping:3,thousand:",",decimal:"."}};var T=Array.prototype.map,x=Array.isArray,h=Object.prototype.toString;function R(me){return!!(me===""||me&&me.charCodeAt&&me.substr)}function j(me){return x?x(me):h.call(me)==="[object Array]"}function U(me){return me&&h.call(me)==="[object Object]"}function N(me,We){var lt;me=me||{},We=We||{};for(lt in We)We.hasOwnProperty(lt)&&me[lt]==null&&(me[lt]=We[lt]);return me}function $(me,We,lt){var ct=[],vt,tt;if(!me)return ct;if(T&&me.map===T)return me.map(We,lt);for(vt=0,tt=me.length;vt<tt;vt++)ct[vt]=We.call(lt,me[vt],vt,me);return ct}function ge(me,We){return me=Math.round(Math.abs(me)),isNaN(me)?We:me}function xe(me){var We=v.settings.currency.format;return typeof me=="function"&&(me=me()),R(me)&&me.match("%v")?{pos:me,neg:me.replace("-","").replace("%v","-%v"),zero:me}:!me||!me.pos||!me.pos.match("%v")?R(We)?v.settings.currency.format={pos:We,neg:We.replace("%v","-%v"),zero:We}:We:me}var Ee=v.unformat=v.parse=function(me,We){if(j(me))return $(me,function(vt){return Ee(vt,We)});if(me=me||0,typeof me=="number")return me;We=We||v.settings.number.decimal;var lt=new RegExp("[^0-9-"+We+"]",["g"]),ct=parseFloat((""+me).replace(/\((.*)\)/,"-$1").replace(lt,"").replace(We,"."));return isNaN(ct)?0:ct},Ke=v.toFixed=function(me,We){We=ge(We,v.settings.number.precision);var lt=Math.pow(10,We);return(Math.round(v.unformat(me)*lt)/lt).toFixed(We)},Ne=v.formatNumber=v.format=function(me,We,lt,ct){if(j(me))return $(me,function(ei){return Ne(ei,We,lt,ct)});me=Ee(me);var vt=N(U(We)?We:{precision:We,thousand:lt,decimal:ct},v.settings.number),tt=ge(vt.precision),ot=me<0?"-":"",bt=parseInt(Ke(Math.abs(me||0),tt),10)+"",gt=bt.length>3?bt.length%3:0;return ot+(gt?bt.substr(0,gt)+vt.thousand:"")+bt.substr(gt).replace(/(\d{3})(?=\d)/g,"$1"+vt.thousand)+(tt?vt.decimal+Ke(Math.abs(me),tt).split(".")[1]:"")},He=v.formatMoney=function(me,We,lt,ct,vt,tt){if(j(me))return $(me,function(ei){return He(ei,We,lt,ct,vt,tt)});me=Ee(me);var ot=N(U(We)?We:{symbol:We,precision:lt,thousand:ct,decimal:vt,format:tt},v.settings.currency),bt=xe(ot.format),gt=me>0?bt.pos:me<0?bt.neg:bt.zero;return gt.replace("%s",ot.symbol).replace("%v",Ne(Math.abs(me),ge(ot.precision),ot.thousand,ot.decimal))};v.formatColumn=function(me,We,lt,ct,vt,tt){if(!me)return[];var ot=N(U(We)?We:{symbol:We,precision:lt,thousand:ct,decimal:vt,format:tt},v.settings.currency),bt=xe(ot.format),gt=bt.pos.indexOf("%s")<bt.pos.indexOf("%v"),ei=0,ri=$(me,function($t,Ki){if(j($t))return v.formatColumn($t,ot);$t=Ee($t);var Lt=$t>0?bt.pos:$t<0?bt.neg:bt.zero,Ft=Lt.replace("%s",ot.symbol).replace("%v",Ne(Math.abs($t),ge(ot.precision),ot.thousand,ot.decimal));return Ft.length>ei&&(ei=Ft.length),Ft});return $(ri,function($t,Ki){return R($t)&&$t.length<ei?gt?$t.replace(ot.symbol,ot.symbol+new Array(ei-$t.length+1).join(" ")):new Array(ei-$t.length+1).join(" ")+$t:$t})},n.exports&&(a=n.exports=v),a.accounting=v})()})(Pp,Pp.exports);var iS=Pp.exports;const qy=xy(iS);function un(n){const a=Object.prototype.toString.call(n);return n instanceof Date||typeof n=="object"&&a==="[object Date]"?new n.constructor(+n):typeof n=="number"||a==="[object Number]"||typeof n=="string"||a==="[object String]"?new Date(n):new Date(NaN)}function $n(n,a){return n instanceof Date?new n.constructor(a):new Date(a)}function Gy(n,a){const d=un(n);return isNaN(a)?$n(n,NaN):(a&&d.setDate(d.getDate()+a),d)}function Hy(n,a){const d=un(n);if(isNaN(a))return $n(n,NaN);if(!a)return d;const m=d.getDate(),v=$n(n,d.getTime());v.setMonth(d.getMonth()+a+1,0);const T=v.getDate();return m>=T?v:(d.setFullYear(v.getFullYear(),v.getMonth(),m),d)}function rS(n,a){const d=+un(n);return $n(n,d+a)}const Zy=6048e5,nS=864e5,Wy=6e4,sf=36e5;function sS(n,a){return rS(n,a*sf)}let oS={};function Bh(){return oS}function Mc(n,a){var h,R,j,U;const d=Bh(),m=(a==null?void 0:a.weekStartsOn)??((R=(h=a==null?void 0:a.locale)==null?void 0:h.options)==null?void 0:R.weekStartsOn)??d.weekStartsOn??((U=(j=d.locale)==null?void 0:j.options)==null?void 0:U.weekStartsOn)??0,v=un(n),T=v.getDay(),x=(T<m?7:0)+T-m;return v.setDate(v.getDate()-x),v.setHours(0,0,0,0),v}function hh(n){return Mc(n,{weekStartsOn:1})}function Ky(n){const a=un(n),d=a.getFullYear(),m=$n(n,0);m.setFullYear(d+1,0,4),m.setHours(0,0,0,0);const v=hh(m),T=$n(n,0);T.setFullYear(d,0,4),T.setHours(0,0,0,0);const x=hh(T);return a.getTime()>=v.getTime()?d+1:a.getTime()>=x.getTime()?d:d-1}function Zg(n){const a=un(n);return a.setHours(0,0,0,0),a}function Wg(n){const a=un(n),d=new Date(Date.UTC(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds()));return d.setUTCFullYear(a.getFullYear()),+n-+d}function aS(n,a){const d=Zg(n),m=Zg(a),v=+d-Wg(d),T=+m-Wg(m);return Math.round((v-T)/nS)}function lS(n){const a=Ky(n),d=$n(n,0);return d.setFullYear(a,0,4),d.setHours(0,0,0,0),hh(d)}function cS(n,a){const d=a*7;return Gy(n,d)}function uS(n,a){return Hy(n,a*12)}function hS(n){return n instanceof Date||typeof n=="object"&&Object.prototype.toString.call(n)==="[object Date]"}function dS(n){if(!hS(n)&&typeof n!="number")return!1;const a=un(n);return!isNaN(Number(a))}function pS(n){const a=un(n),d=$n(n,0);return d.setFullYear(a.getFullYear(),0,1),d.setHours(0,0,0,0),d}const fS={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},mS=(n,a,d)=>{let m;const v=fS[n];return typeof v=="string"?m=v:a===1?m=v.one:m=v.other.replace("{{count}}",a.toString()),d!=null&&d.addSuffix?d.comparison&&d.comparison>0?"in "+m:m+" ago":m};function sp(n){return(a={})=>{const d=a.width?String(a.width):n.defaultWidth;return n.formats[d]||n.formats[n.defaultWidth]}}const gS={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},_S={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},yS={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},xS={date:sp({formats:gS,defaultWidth:"full"}),time:sp({formats:_S,defaultWidth:"full"}),dateTime:sp({formats:yS,defaultWidth:"full"})},vS={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},bS=(n,a,d,m)=>vS[n];function uc(n){return(a,d)=>{const m=d!=null&&d.context?String(d.context):"standalone";let v;if(m==="formatting"&&n.formattingValues){const x=n.defaultFormattingWidth||n.defaultWidth,h=d!=null&&d.width?String(d.width):x;v=n.formattingValues[h]||n.formattingValues[x]}else{const x=n.defaultWidth,h=d!=null&&d.width?String(d.width):n.defaultWidth;v=n.values[h]||n.values[x]}const T=n.argumentCallback?n.argumentCallback(a):a;return v[T]}}const wS={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},SS={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},TS={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},ES={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},IS={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},AS={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},PS=(n,a)=>{const d=Number(n),m=d%100;if(m>20||m<10)switch(m%10){case 1:return d+"st";case 2:return d+"nd";case 3:return d+"rd"}return d+"th"},CS={ordinalNumber:PS,era:uc({values:wS,defaultWidth:"wide"}),quarter:uc({values:SS,defaultWidth:"wide",argumentCallback:n=>n-1}),month:uc({values:TS,defaultWidth:"wide"}),day:uc({values:ES,defaultWidth:"wide"}),dayPeriod:uc({values:IS,defaultWidth:"wide",formattingValues:AS,defaultFormattingWidth:"wide"})};function hc(n){return(a,d={})=>{const m=d.width,v=m&&n.matchPatterns[m]||n.matchPatterns[n.defaultMatchWidth],T=a.match(v);if(!T)return null;const x=T[0],h=m&&n.parsePatterns[m]||n.parsePatterns[n.defaultParseWidth],R=Array.isArray(h)?kS(h,N=>N.test(x)):MS(h,N=>N.test(x));let j;j=n.valueCallback?n.valueCallback(R):R,j=d.valueCallback?d.valueCallback(j):j;const U=a.slice(x.length);return{value:j,rest:U}}}function MS(n,a){for(const d in n)if(Object.prototype.hasOwnProperty.call(n,d)&&a(n[d]))return d}function kS(n,a){for(let d=0;d<n.length;d++)if(a(n[d]))return d}function DS(n){return(a,d={})=>{const m=a.match(n.matchPattern);if(!m)return null;const v=m[0],T=a.match(n.parsePattern);if(!T)return null;let x=n.valueCallback?n.valueCallback(T[0]):T[0];x=d.valueCallback?d.valueCallback(x):x;const h=a.slice(v.length);return{value:x,rest:h}}}const zS=/^(\d+)(th|st|nd|rd)?/i,RS=/\d+/i,LS={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},FS={any:[/^b/i,/^(a|c)/i]},OS={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},BS={any:[/1/i,/2/i,/3/i,/4/i]},NS={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},VS={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},$S={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},US={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},jS={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},qS={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},GS={ordinalNumber:DS({matchPattern:zS,parsePattern:RS,valueCallback:n=>parseInt(n,10)}),era:hc({matchPatterns:LS,defaultMatchWidth:"wide",parsePatterns:FS,defaultParseWidth:"any"}),quarter:hc({matchPatterns:OS,defaultMatchWidth:"wide",parsePatterns:BS,defaultParseWidth:"any",valueCallback:n=>n+1}),month:hc({matchPatterns:NS,defaultMatchWidth:"wide",parsePatterns:VS,defaultParseWidth:"any"}),day:hc({matchPatterns:$S,defaultMatchWidth:"wide",parsePatterns:US,defaultParseWidth:"any"}),dayPeriod:hc({matchPatterns:jS,defaultMatchWidth:"any",parsePatterns:qS,defaultParseWidth:"any"})},HS={code:"en-US",formatDistance:mS,formatLong:xS,formatRelative:bS,localize:CS,match:GS,options:{weekStartsOn:0,firstWeekContainsDate:1}};function ZS(n){const a=un(n);return aS(a,pS(a))+1}function WS(n){const a=un(n),d=+hh(a)-+lS(a);return Math.round(d/Zy)+1}function Xy(n,a){var U,N,$,ge;const d=un(n),m=d.getFullYear(),v=Bh(),T=(a==null?void 0:a.firstWeekContainsDate)??((N=(U=a==null?void 0:a.locale)==null?void 0:U.options)==null?void 0:N.firstWeekContainsDate)??v.firstWeekContainsDate??((ge=($=v.locale)==null?void 0:$.options)==null?void 0:ge.firstWeekContainsDate)??1,x=$n(n,0);x.setFullYear(m+1,0,T),x.setHours(0,0,0,0);const h=Mc(x,a),R=$n(n,0);R.setFullYear(m,0,T),R.setHours(0,0,0,0);const j=Mc(R,a);return d.getTime()>=h.getTime()?m+1:d.getTime()>=j.getTime()?m:m-1}function KS(n,a){var h,R,j,U;const d=Bh(),m=(a==null?void 0:a.firstWeekContainsDate)??((R=(h=a==null?void 0:a.locale)==null?void 0:h.options)==null?void 0:R.firstWeekContainsDate)??d.firstWeekContainsDate??((U=(j=d.locale)==null?void 0:j.options)==null?void 0:U.firstWeekContainsDate)??1,v=Xy(n,a),T=$n(n,0);return T.setFullYear(v,0,m),T.setHours(0,0,0,0),Mc(T,a)}function XS(n,a){const d=un(n),m=+Mc(d,a)-+KS(d,a);return Math.round(m/Zy)+1}function mi(n,a){const d=n<0?"-":"",m=Math.abs(n).toString().padStart(a,"0");return d+m}const Ks={y(n,a){const d=n.getFullYear(),m=d>0?d:1-d;return mi(a==="yy"?m%100:m,a.length)},M(n,a){const d=n.getMonth();return a==="M"?String(d+1):mi(d+1,2)},d(n,a){return mi(n.getDate(),a.length)},a(n,a){const d=n.getHours()/12>=1?"pm":"am";switch(a){case"a":case"aa":return d.toUpperCase();case"aaa":return d;case"aaaaa":return d[0];case"aaaa":default:return d==="am"?"a.m.":"p.m."}},h(n,a){return mi(n.getHours()%12||12,a.length)},H(n,a){return mi(n.getHours(),a.length)},m(n,a){return mi(n.getMinutes(),a.length)},s(n,a){return mi(n.getSeconds(),a.length)},S(n,a){const d=a.length,m=n.getMilliseconds(),v=Math.trunc(m*Math.pow(10,d-3));return mi(v,a.length)}},qa={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Kg={G:function(n,a,d){const m=n.getFullYear()>0?1:0;switch(a){case"G":case"GG":case"GGG":return d.era(m,{width:"abbreviated"});case"GGGGG":return d.era(m,{width:"narrow"});case"GGGG":default:return d.era(m,{width:"wide"})}},y:function(n,a,d){if(a==="yo"){const m=n.getFullYear(),v=m>0?m:1-m;return d.ordinalNumber(v,{unit:"year"})}return Ks.y(n,a)},Y:function(n,a,d,m){const v=Xy(n,m),T=v>0?v:1-v;if(a==="YY"){const x=T%100;return mi(x,2)}return a==="Yo"?d.ordinalNumber(T,{unit:"year"}):mi(T,a.length)},R:function(n,a){const d=Ky(n);return mi(d,a.length)},u:function(n,a){const d=n.getFullYear();return mi(d,a.length)},Q:function(n,a,d){const m=Math.ceil((n.getMonth()+1)/3);switch(a){case"Q":return String(m);case"QQ":return mi(m,2);case"Qo":return d.ordinalNumber(m,{unit:"quarter"});case"QQQ":return d.quarter(m,{width:"abbreviated",context:"formatting"});case"QQQQQ":return d.quarter(m,{width:"narrow",context:"formatting"});case"QQQQ":default:return d.quarter(m,{width:"wide",context:"formatting"})}},q:function(n,a,d){const m=Math.ceil((n.getMonth()+1)/3);switch(a){case"q":return String(m);case"qq":return mi(m,2);case"qo":return d.ordinalNumber(m,{unit:"quarter"});case"qqq":return d.quarter(m,{width:"abbreviated",context:"standalone"});case"qqqqq":return d.quarter(m,{width:"narrow",context:"standalone"});case"qqqq":default:return d.quarter(m,{width:"wide",context:"standalone"})}},M:function(n,a,d){const m=n.getMonth();switch(a){case"M":case"MM":return Ks.M(n,a);case"Mo":return d.ordinalNumber(m+1,{unit:"month"});case"MMM":return d.month(m,{width:"abbreviated",context:"formatting"});case"MMMMM":return d.month(m,{width:"narrow",context:"formatting"});case"MMMM":default:return d.month(m,{width:"wide",context:"formatting"})}},L:function(n,a,d){const m=n.getMonth();switch(a){case"L":return String(m+1);case"LL":return mi(m+1,2);case"Lo":return d.ordinalNumber(m+1,{unit:"month"});case"LLL":return d.month(m,{width:"abbreviated",context:"standalone"});case"LLLLL":return d.month(m,{width:"narrow",context:"standalone"});case"LLLL":default:return d.month(m,{width:"wide",context:"standalone"})}},w:function(n,a,d,m){const v=XS(n,m);return a==="wo"?d.ordinalNumber(v,{unit:"week"}):mi(v,a.length)},I:function(n,a,d){const m=WS(n);return a==="Io"?d.ordinalNumber(m,{unit:"week"}):mi(m,a.length)},d:function(n,a,d){return a==="do"?d.ordinalNumber(n.getDate(),{unit:"date"}):Ks.d(n,a)},D:function(n,a,d){const m=ZS(n);return a==="Do"?d.ordinalNumber(m,{unit:"dayOfYear"}):mi(m,a.length)},E:function(n,a,d){const m=n.getDay();switch(a){case"E":case"EE":case"EEE":return d.day(m,{width:"abbreviated",context:"formatting"});case"EEEEE":return d.day(m,{width:"narrow",context:"formatting"});case"EEEEEE":return d.day(m,{width:"short",context:"formatting"});case"EEEE":default:return d.day(m,{width:"wide",context:"formatting"})}},e:function(n,a,d,m){const v=n.getDay(),T=(v-m.weekStartsOn+8)%7||7;switch(a){case"e":return String(T);case"ee":return mi(T,2);case"eo":return d.ordinalNumber(T,{unit:"day"});case"eee":return d.day(v,{width:"abbreviated",context:"formatting"});case"eeeee":return d.day(v,{width:"narrow",context:"formatting"});case"eeeeee":return d.day(v,{width:"short",context:"formatting"});case"eeee":default:return d.day(v,{width:"wide",context:"formatting"})}},c:function(n,a,d,m){const v=n.getDay(),T=(v-m.weekStartsOn+8)%7||7;switch(a){case"c":return String(T);case"cc":return mi(T,a.length);case"co":return d.ordinalNumber(T,{unit:"day"});case"ccc":return d.day(v,{width:"abbreviated",context:"standalone"});case"ccccc":return d.day(v,{width:"narrow",context:"standalone"});case"cccccc":return d.day(v,{width:"short",context:"standalone"});case"cccc":default:return d.day(v,{width:"wide",context:"standalone"})}},i:function(n,a,d){const m=n.getDay(),v=m===0?7:m;switch(a){case"i":return String(v);case"ii":return mi(v,a.length);case"io":return d.ordinalNumber(v,{unit:"day"});case"iii":return d.day(m,{width:"abbreviated",context:"formatting"});case"iiiii":return d.day(m,{width:"narrow",context:"formatting"});case"iiiiii":return d.day(m,{width:"short",context:"formatting"});case"iiii":default:return d.day(m,{width:"wide",context:"formatting"})}},a:function(n,a,d){const v=n.getHours()/12>=1?"pm":"am";switch(a){case"a":case"aa":return d.dayPeriod(v,{width:"abbreviated",context:"formatting"});case"aaa":return d.dayPeriod(v,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return d.dayPeriod(v,{width:"narrow",context:"formatting"});case"aaaa":default:return d.dayPeriod(v,{width:"wide",context:"formatting"})}},b:function(n,a,d){const m=n.getHours();let v;switch(m===12?v=qa.noon:m===0?v=qa.midnight:v=m/12>=1?"pm":"am",a){case"b":case"bb":return d.dayPeriod(v,{width:"abbreviated",context:"formatting"});case"bbb":return d.dayPeriod(v,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return d.dayPeriod(v,{width:"narrow",context:"formatting"});case"bbbb":default:return d.dayPeriod(v,{width:"wide",context:"formatting"})}},B:function(n,a,d){const m=n.getHours();let v;switch(m>=17?v=qa.evening:m>=12?v=qa.afternoon:m>=4?v=qa.morning:v=qa.night,a){case"B":case"BB":case"BBB":return d.dayPeriod(v,{width:"abbreviated",context:"formatting"});case"BBBBB":return d.dayPeriod(v,{width:"narrow",context:"formatting"});case"BBBB":default:return d.dayPeriod(v,{width:"wide",context:"formatting"})}},h:function(n,a,d){if(a==="ho"){let m=n.getHours()%12;return m===0&&(m=12),d.ordinalNumber(m,{unit:"hour"})}return Ks.h(n,a)},H:function(n,a,d){return a==="Ho"?d.ordinalNumber(n.getHours(),{unit:"hour"}):Ks.H(n,a)},K:function(n,a,d){const m=n.getHours()%12;return a==="Ko"?d.ordinalNumber(m,{unit:"hour"}):mi(m,a.length)},k:function(n,a,d){let m=n.getHours();return m===0&&(m=24),a==="ko"?d.ordinalNumber(m,{unit:"hour"}):mi(m,a.length)},m:function(n,a,d){return a==="mo"?d.ordinalNumber(n.getMinutes(),{unit:"minute"}):Ks.m(n,a)},s:function(n,a,d){return a==="so"?d.ordinalNumber(n.getSeconds(),{unit:"second"}):Ks.s(n,a)},S:function(n,a){return Ks.S(n,a)},X:function(n,a,d){const m=n.getTimezoneOffset();if(m===0)return"Z";switch(a){case"X":return Yg(m);case"XXXX":case"XX":return Oo(m);case"XXXXX":case"XXX":default:return Oo(m,":")}},x:function(n,a,d){const m=n.getTimezoneOffset();switch(a){case"x":return Yg(m);case"xxxx":case"xx":return Oo(m);case"xxxxx":case"xxx":default:return Oo(m,":")}},O:function(n,a,d){const m=n.getTimezoneOffset();switch(a){case"O":case"OO":case"OOO":return"GMT"+Xg(m,":");case"OOOO":default:return"GMT"+Oo(m,":")}},z:function(n,a,d){const m=n.getTimezoneOffset();switch(a){case"z":case"zz":case"zzz":return"GMT"+Xg(m,":");case"zzzz":default:return"GMT"+Oo(m,":")}},t:function(n,a,d){const m=Math.trunc(n.getTime()/1e3);return mi(m,a.length)},T:function(n,a,d){const m=n.getTime();return mi(m,a.length)}};function Xg(n,a=""){const d=n>0?"-":"+",m=Math.abs(n),v=Math.trunc(m/60),T=m%60;return T===0?d+String(v):d+String(v)+a+mi(T,2)}function Yg(n,a){return n%60===0?(n>0?"-":"+")+mi(Math.abs(n)/60,2):Oo(n,a)}function Oo(n,a=""){const d=n>0?"-":"+",m=Math.abs(n),v=mi(Math.trunc(m/60),2),T=mi(m%60,2);return d+v+a+T}const Jg=(n,a)=>{switch(n){case"P":return a.date({width:"short"});case"PP":return a.date({width:"medium"});case"PPP":return a.date({width:"long"});case"PPPP":default:return a.date({width:"full"})}},Yy=(n,a)=>{switch(n){case"p":return a.time({width:"short"});case"pp":return a.time({width:"medium"});case"ppp":return a.time({width:"long"});case"pppp":default:return a.time({width:"full"})}},YS=(n,a)=>{const d=n.match(/(P+)(p+)?/)||[],m=d[1],v=d[2];if(!v)return Jg(n,a);let T;switch(m){case"P":T=a.dateTime({width:"short"});break;case"PP":T=a.dateTime({width:"medium"});break;case"PPP":T=a.dateTime({width:"long"});break;case"PPPP":default:T=a.dateTime({width:"full"});break}return T.replace("{{date}}",Jg(m,a)).replace("{{time}}",Yy(v,a))},JS={p:Yy,P:YS},QS=/^D+$/,eT=/^Y+$/,tT=["D","DD","YY","YYYY"];function iT(n){return QS.test(n)}function rT(n){return eT.test(n)}function nT(n,a,d){const m=sT(n,a,d);if(console.warn(m),tT.includes(n))throw new RangeError(m)}function sT(n,a,d){const m=n[0]==="Y"?"years":"days of the month";return`Use \`${n.toLowerCase()}\` instead of \`${n}\` (in \`${a}\`) for formatting ${m} to the input \`${d}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const oT=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,aT=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,lT=/^'([^]*?)'?$/,cT=/''/g,uT=/[a-zA-Z]/;function Cp(n,a,d){var U,N,$,ge,xe,Ee,Ke,Ne;const m=Bh(),v=(d==null?void 0:d.locale)??m.locale??HS,T=(d==null?void 0:d.firstWeekContainsDate)??((N=(U=d==null?void 0:d.locale)==null?void 0:U.options)==null?void 0:N.firstWeekContainsDate)??m.firstWeekContainsDate??((ge=($=m.locale)==null?void 0:$.options)==null?void 0:ge.firstWeekContainsDate)??1,x=(d==null?void 0:d.weekStartsOn)??((Ee=(xe=d==null?void 0:d.locale)==null?void 0:xe.options)==null?void 0:Ee.weekStartsOn)??m.weekStartsOn??((Ne=(Ke=m.locale)==null?void 0:Ke.options)==null?void 0:Ne.weekStartsOn)??0,h=un(n);if(!dS(h))throw new RangeError("Invalid time value");let R=a.match(aT).map(He=>{const me=He[0];if(me==="p"||me==="P"){const We=JS[me];return We(He,v.formatLong)}return He}).join("").match(oT).map(He=>{if(He==="''")return{isToken:!1,value:"'"};const me=He[0];if(me==="'")return{isToken:!1,value:hT(He)};if(Kg[me])return{isToken:!0,value:He};if(me.match(uT))throw new RangeError("Format string contains an unescaped latin alphabet character `"+me+"`");return{isToken:!1,value:He}});v.localize.preprocessor&&(R=v.localize.preprocessor(h,R));const j={firstWeekContainsDate:T,weekStartsOn:x,locale:v};return R.map(He=>{if(!He.isToken)return He.value;const me=He.value;(!(d!=null&&d.useAdditionalWeekYearTokens)&&rT(me)||!(d!=null&&d.useAdditionalDayOfYearTokens)&&iT(me))&&nT(me,a,String(n));const We=Kg[me[0]];return We(h,me,v.localize,j)}).join("")}function hT(n){const a=n.match(lT);return a?a[1].replace(cT,"'"):n}function dT(n,a){return Gy(n,-a)}function pT(n,a){const d=(a==null?void 0:a.additionalDigits)??2,m=_T(n);let v;if(m.date){const R=yT(m.date,d);v=xT(R.restDateString,R.year)}if(!v||isNaN(v.getTime()))return new Date(NaN);const T=v.getTime();let x=0,h;if(m.time&&(x=vT(m.time),isNaN(x)))return new Date(NaN);if(m.timezone){if(h=bT(m.timezone),isNaN(h))return new Date(NaN)}else{const R=new Date(T+x),j=new Date(0);return j.setFullYear(R.getUTCFullYear(),R.getUTCMonth(),R.getUTCDate()),j.setHours(R.getUTCHours(),R.getUTCMinutes(),R.getUTCSeconds(),R.getUTCMilliseconds()),j}return new Date(T+x+h)}const Zu={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},fT=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,mT=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,gT=/^([+-])(\d{2})(?::?(\d{2}))?$/;function _T(n){const a={},d=n.split(Zu.dateTimeDelimiter);let m;if(d.length>2)return a;if(/:/.test(d[0])?m=d[0]:(a.date=d[0],m=d[1],Zu.timeZoneDelimiter.test(a.date)&&(a.date=n.split(Zu.timeZoneDelimiter)[0],m=n.substr(a.date.length,n.length))),m){const v=Zu.timezone.exec(m);v?(a.time=m.replace(v[1],""),a.timezone=v[1]):a.time=m}return a}function yT(n,a){const d=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+a)+"})|(\\d{2}|[+-]\\d{"+(2+a)+"})$)"),m=n.match(d);if(!m)return{year:NaN,restDateString:""};const v=m[1]?parseInt(m[1]):null,T=m[2]?parseInt(m[2]):null;return{year:T===null?v:T*100,restDateString:n.slice((m[1]||m[2]).length)}}function xT(n,a){if(a===null)return new Date(NaN);const d=n.match(fT);if(!d)return new Date(NaN);const m=!!d[4],v=dc(d[1]),T=dc(d[2])-1,x=dc(d[3]),h=dc(d[4]),R=dc(d[5])-1;if(m)return IT(a,h,R)?wT(a,h,R):new Date(NaN);{const j=new Date(0);return!TT(a,T,x)||!ET(a,v)?new Date(NaN):(j.setUTCFullYear(a,T,Math.max(v,x)),j)}}function dc(n){return n?parseInt(n):1}function vT(n){const a=n.match(mT);if(!a)return NaN;const d=op(a[1]),m=op(a[2]),v=op(a[3]);return AT(d,m,v)?d*sf+m*Wy+v*1e3:NaN}function op(n){return n&&parseFloat(n.replace(",","."))||0}function bT(n){if(n==="Z")return 0;const a=n.match(gT);if(!a)return 0;const d=a[1]==="+"?-1:1,m=parseInt(a[2]),v=a[3]&&parseInt(a[3])||0;return PT(m,v)?d*(m*sf+v*Wy):NaN}function wT(n,a,d){const m=new Date(0);m.setUTCFullYear(n,0,4);const v=m.getUTCDay()||7,T=(a-1)*7+d+1-v;return m.setUTCDate(m.getUTCDate()+T),m}const ST=[31,null,31,30,31,30,31,31,30,31,30,31];function Jy(n){return n%400===0||n%4===0&&n%100!==0}function TT(n,a,d){return a>=0&&a<=11&&d>=1&&d<=(ST[a]||(Jy(n)?29:28))}function ET(n,a){return a>=1&&a<=(Jy(n)?366:365)}function IT(n,a,d){return a>=1&&a<=53&&d>=0&&d<=6}function AT(n,a,d){return n===24?a===0&&d===0:d>=0&&d<60&&a>=0&&a<60&&n>=0&&n<25}function PT(n,a){return a>=0&&a<=59}function CT(n,a){return Hy(n,-a)}function MT(n,a){return sS(n,-a)}function kT(n,a){return cS(n,-a)}function DT(n,a){return uS(n,-a)}qy.settings.currency.precision=0;function of(){return{bold:m=>"<strong>"+m+"</strong>",currency:m=>qy.formatMoney(m),date:m=>{let v;return typeof m=="string"?v=Cp(pT(m),"MM/dd/yyyy"):v=Cp(m,"MM/dd/yyyy"),v}}}const{currency:Qg,date:zT}=of(),Qy=oo("OpaStore",{state:()=>({opaData:{}}),actions:{async fillOpaData(){const a=kn().addressData.features[0].properties.opa_account_num,d=await fetch(`https://phl.carto.com/api/v2/sql?q=select+*+from+opa_properties_public+where+parcel_number+%3D+%27${a}%27`);this.opaData=await d.json()}},getters:{getMarketValue:n=>Qg(n.opaData.rows[0].market_value||null),getSaleDate:n=>zT(n.opaData.rows[0].sale_date),getSalePrice:n=>Qg(n.opaData.rows[0].sale_price)}}),ex=oo("LiStore",{state:()=>({liInspections:{},liPermits:{}}),actions:{async fillLiInspections(){const a=kn().addressData.features[0];let d="https://phl.carto.com/api/v2/sql?q=";const m=a.properties.eclipse_location_id.replace(/\|/g,"', '"),v=a.properties.street_address,T=a.properties.opa_account_num?` AND opa_account_num IN ('${a.properties.opa_account_num}')`:"",x=a.properties.pwd_parcel_id,h=a.properties.li_address_key.replace(/\|/g,"', '"),R=d+=`SELECT * FROM case_investigations WHERE (address = '${v}' or addressobjectid IN ('${h}'))           AND systemofrecord IN ('HANSEN') ${T} UNION SELECT * FROM case_investigations WHERE           addressobjectid IN ('${m}') OR parcel_id_num IN ( '${x}' )           AND systemofrecord IN ('ECLIPSE') ${T}`,j=await fetch(R);this.liInspections=await j.json()},async fillLiPermits(){const a=kn().addressData.features[0];let d="https://phl.carto.com/api/v2/sql?q=";const m=a.properties.eclipse_location_id.replace(/\|/g,"', '"),v=a.properties.street_address,T=a.properties.opa_account_num?` AND opa_account_num IN ('${a.properties.opa_account_num}')`:"",x=a.properties.pwd_parcel_id,h=a.properties.li_address_key.replace(/\|/g,"', '"),R=d+=`SELECT * FROM PERMITS WHERE address = '${v}' or addressobjectid IN ('${h}')       AND systemofrecord IN ('HANSEN') ${T}       UNION SELECT * FROM PERMITS WHERE addressobjectid IN ('${m}') OR parcel_id_num IN ( '${x}' )       AND systemofrecord IN ('ECLIPSE')${T}      ORDER BY permittype`,j=await fetch(R);this.liPermits=await j.json()}},getters:{}}),Wa=function(n){var a=n?String(n):"";return a=a.replace(/\s+/g,""),[null,"0"].indexOf(a)>-1?"":a},RT=function(n,a){console.log("concatDorAddress is running, parcel:",n),a=!!a;var d=["STDIR","STNAM","STDES","STDESSUF"],m=n.properties,v=Wa(m.HOUSE),T=Wa(m.STEX),x=Wa(m.SUF),h=v;h=h+(T?"-"+T:""),h=h+(x||"");var R=Wa(m.UNIT);R&&(R="# "+R);var j=d.map(function(U){return m[U]});return j=j.map(Wa),j=[h].concat(j),a&&(j=j.concat([R])),h=j.filter(Boolean).join(" "),h===""&&(h="Parcel has no address"),console.log("concatDorAddress address result:",h),h},tx=oo("DorStore",{state:()=>({dorDocuments:{}}),actions:{async initializeDorDocuments(){this.dorDocuments={};const n=Oh(),a=kn(),d="//services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/RTT_SUMMARY/FeatureServer/0/query",m=function(v){console.log("where function is running, feature:",v);var T=RT(v),x=a.addressData.features[0].properties,h;if(!T||T==="null")h="MATCHED_REGMAP = '"+n.DOR.features[0].properties.BASEREG+"'";else{var R=a.addressData.features[0].properties,j=R.address_low,U=Math.floor(j/100,1)*100,N=j-U,$=R.address_high,ge=$||j;h="(((ADDRESS_LOW >= "+j+" AND ADDRESS_LOW <= "+ge+") OR (ADDRESS_LOW >= "+U+" AND ADDRESS_LOW <= "+ge+" AND ADDRESS_HIGH >= "+N+" )) AND STREET_NAME = '"+x.street_name+"' AND STREET_SUFFIX = '"+x.street_suffix+"' AND (MOD(ADDRESS_LOW,2) = MOD( "+j+",2))",x.street_predir!=""&&(h+=" AND STREET_PREDIR = '"+x.street_predir+"'"),x.address_low_suffix!=""&&(h+=" AND ADDRESS_LOW_SUFFIX = '"+x.address_low_suffix+"'"),x.address_low_suffix==""&&(h+=" AND ADDRESS_LOW_SUFFIX = ''"),x.address_low_frac==="1/2"&&(h+=" AND ADDRESS_LOW_SUFFIX = '2'"),x.street_postdir!=""&&(h+=" AND STREET_POSTDIR = '"+x.street_postdir+"'");var xe=Wa(v.properties.UNIT),Ee=x.unit_num;xe?h+=" AND UNIT_NUM = '"+xe+"'":Ee!==""&&(h+=" AND UNIT_NUM = '"+Ee+"'"),h+=") or MATCHED_REGMAP = '"+n.DOR.features[0].properties.BASEREG+"'",h+=" or REG_MAP_ID = '"+n.DOR.features[0].properties.BASEREG+"'"}return h};for(let v of n.DOR.features){const x={where:m(v),outFields:"DOCUMENT_ID, DISPLAY_DATE, DOCUMENT_TYPE, GRANTORS, GRANTEES",returnDistinctValues:"true",returnGeometry:"false",f:"json",sqlFormat:"standard"};console.log("params:",x);const h=await Wi(d,{params:x});this.dorDocuments[v.properties.OBJECTID]=h}}}}),LT=(n,a)=>{const d={};if(!a.options.params)return d;const m=Object.entries(a.options.params);(void 0).store.state;for(let[v,T]of m){let x;typeof T=="function"?x=T(n):x=T,d[v]=x}return d},FT=(n,a)=>{const d=LT(n,a);a.url;const m=a.options,v=m.table,T=m.dateMinNum||null,x=m.dateMinType||null,h=m.dateField||null;m.success;const R=m.distances||250,j=m.groupby||null,U="ST_Distance(the_geom::geography, ST_SetSRID(ST_Point("+n.geometry.coordinates[0]+","+n.geometry.coordinates[1]+"),4326)::geography)",N="ST_Y(the_geom)",$="ST_X(the_geom)";let ge;j?ge=j+", the_geom":ge="*",ge=ge+", "+U+"as distance,"+N+"as lat, "+$+"as lng",d.q="select "+ge+" from "+v+" where "+U+" < "+R;let xe;if(T){switch(x){case"hour":xe=MT;break;case"day":xe=dT;break;case"week":xe=kT;break;case"month":xe=CT;break;case"year":xe=DT;break}d.q=d.q+" and "+h+" > '"+Cp(xe(new Date,T),"yyyy-MM-dd")+"'"}return j&&(d.q=d.q+" group by "+j+", the_geom"),d},ix=oo("NearbyActivityStore",{state:()=>({nearby311:{}}),actions:{async fillNearby311(){const a=kn().addressData.features[0];let d={url:"https://phl.carto.com/api/v2/sql?",options:{table:"public_cases_fc",dateMinNum:30,dateMinType:"day",dateField:"requested_datetime"}},m=FT(a,d);const v=await Wi.get(d.url,{params:m});this.nearby311=v}}});function OT(){return{addressDataFetch:async m=>{console.log("addressDataFetch is running"),await kn().fillAddressData(m)},parcelsDataFetch:async()=>{const m=Oh();await m.fillPwdParcelData(),await m.fillDorParcelData()},topicDataFetch:async m=>{if(console.log("topicDataFetch is running, topic:",m),m==="Property"&&await Qy().fillOpaData(),m==="Licenses & Inspections"){const v=ex();await v.fillLiInspections(),await v.fillLiPermits()}m==="Deeds"&&await tx().initializeDorDocuments(),m==="Nearby Activity"&&await ix().fillNearby311()}}}const Lc=(n,a)=>{const d=n.__vccOpts||n;for(const[m,v]of a)d[m]=v;return d},BT={class:"topic-name has-text-left"},NT={key:0,class:"topic-loading has-text-right"},VT={key:0},$T={class:"inside-topic"},UT={__name:"Topic",props:{topicName:String,loading:Boolean},setup(n){const a=wy(),d=n,{currentAddress:m}=P1(a),v=Yp(),T=yy();v.params.topic;const x=dr(()=>v.params.topic==d.topicName),h=()=>{console.log("topic clicked:",d.topicName),v.params.topic==d.topicName?T.push({name:"address",params:{address:m.value}}):T.push({name:"address-and-topic",params:{address:m.value,topic:d.topicName}})};return(R,j)=>(Xt(),xi("section",null,[Te("div",{class:"topic",onClick:h},[Te("span",BT,pi(n.topicName),1),x.value&&n.loading?(Xt(),xi("span",NT,"Loading...")):Jr("",!0)]),x.value?(Xt(),xi("div",VT,[Te("div",$T,[cb(R.$slots,"default",{},void 0,!0)])])):Jr("",!0)]))}},Ga=Lc(UT,[["__scopeId","data-v-33aef821"]]),Go=n=>(wh("data-v-f9f0e161"),n=n(),Sh(),n),jT={key:0,class:"box"},qT={key:1,class:"vert-table"},GT={class:"columns"},HT=Go(()=>Te("div",{class:"column is-4"},"OPA Account #",-1)),ZT={class:"column is-8"},WT={class:"columns"},KT=Go(()=>Te("div",{class:"column is-4"},"OPA Address",-1)),XT={class:"column is-8"},YT={class:"columns"},JT=Go(()=>Te("div",{class:"column is-4"},"Owners",-1)),QT={class:"column is-8"},eE={class:"columns"},tE=Go(()=>Te("div",{class:"column is-4"},"Assessed Value",-1)),iE={class:"column is-8"},rE={class:"columns"},nE=Go(()=>Te("div",{class:"column is-4"},"Sale Date",-1)),sE={class:"column is-8"},oE={class:"columns"},aE=Go(()=>Te("div",{class:"column is-4"},"Sale Price",-1)),lE={class:"column is-8"},cE={key:2},uE=Go(()=>Te("p",null,"There is no property assessment record for this address.",-1)),hE=[uE],dE={__name:"Property",setup(n){console.log("Property.vue setup");const a=kn(),d=Qy();return(m,v)=>(Xt(),xi("section",null,[Qt(d).opaData.rows.length?(Xt(),xi("div",jT," Property assessment and sale information for this address. Source: Office of Property Assessments (OPA). OPA was formerly a part of the Bureau of Revision of Taxes (BRT) and some City records may still use that name. ")):Jr("",!0),Qt(d).opaData.rows.length?(Xt(),xi("div",qT,[Te("div",GT,[HT,Te("div",ZT,pi(Qt(a).addressData.features[0].properties.opa_account_num),1)]),Te("div",WT,[KT,Te("div",XT,pi(Qt(a).addressData.features[0].properties.opa_address),1)]),Te("div",YT,[JT,Te("div",QT,pi(Qt(a).getOpaOwners),1)]),Te("div",eE,[tE,Te("div",iE,pi(Qt(d).getMarketValue),1)]),Te("div",rE,[nE,Te("div",sE,pi(Qt(d).getSaleDate),1)]),Te("div",oE,[aE,Te("div",lE,pi(Qt(d).getSalePrice),1)])])):Jr("",!0),Qt(d).opaData.rows.length?Jr("",!0):(Xt(),xi("div",cE,hE))]))}},pE=Lc(dE,[["__scopeId","data-v-f9f0e161"]]),Un=n=>(wh("data-v-071ec60b"),n=n(),Sh(),n),fE=Un(()=>Te("div",{class:"box"},"Deed information and document transactions for this address. The map faithfully reflects property boundaries as described in recorded deeds including multiple types of easements. The property boundaries displayed on the map are for reference only and should not be used in place of the recorded deeds or land surveys. Source: Department of Records",-1)),mE={class:"columns is-multiline"},gE=["onClick"],_E=Un(()=>Te("h5",{class:"title is-5"},"Parcel Details",-1)),yE={key:0,class:"vert-table"},xE={class:"columns"},vE=Un(()=>Te("div",{class:"column is-4"},"Map Registry #",-1)),bE={class:"column is-8"},wE={class:"columns"},SE=Un(()=>Te("div",{class:"column is-4"},"Parcel Address",-1)),TE={class:"column is-8"},EE={class:"columns"},IE=Un(()=>Te("div",{class:"column is-4"},"Status",-1)),AE={class:"column is-8"},PE={class:"columns"},CE=Un(()=>Te("div",{class:"column is-4"},"Origination Date",-1)),ME={class:"column is-8"},kE={class:"columns"},DE=Un(()=>Te("div",{class:"column is-4"},"Inactive Date",-1)),zE={class:"column is-8"},RE={class:"columns"},LE=Un(()=>Te("div",{class:"column is-4"},"Has Air Rights",-1)),FE={class:"column is-8"},OE={class:"columns"},BE=Un(()=>Te("div",{class:"column is-4"},"Is Condo",-1)),NE={class:"column is-8"},VE={class:"mt-6"},$E=Un(()=>Te("h5",{class:"subtitle is-5"},"Documents",-1)),UE={class:"table is-fullwidth is-striped"},jE=Un(()=>Te("thead",null,[Te("tr",null,[Te("th",null,"ID"),Te("th",null,"Date"),Te("th",null,"Type"),Te("th",null,"Grantor"),Te("th",null,"Grantee")])],-1)),qE={__name:"Deeds",setup(n){kn();const a=Oh(),d=tx(),m=io(""),v=dr(()=>a.DOR.features.filter(h=>h.id===m.value)[0]),T=dr(()=>d.dorDocuments[m.value].data.features);V_(()=>{console.log("Deeds.vue onBeforeMount"),m.value=a.DOR.features[0].properties.OBJECTID}),Gp(()=>{console.log("Deeds.vue onMounted")});const x={1:"Active",2:"Inactive",3:"Remainder"};return(h,R)=>(Xt(),xi(Pr,null,[fE,Te("div",mE,[(Xt(!0),xi(Pr,null,Ec(Qt(a).DOR.features,j=>(Xt(),xi("div",{key:j.properties.OBJECTID,onClick:U=>m.value=j.properties.OBJECTID,class:gh(["column is-3 add-borders",{"is-selected":j.properties.OBJECTID===m.value}])},pi(j.properties.MAPREG),11,gE))),128))]),_E,Qt(a).DOR.features.length?(Xt(),xi("div",yE,[Te("div",xE,[vE,Te("div",bE,pi(v.value.properties.MAPREG),1)]),Te("div",wE,[SE,Te("div",TE,pi(v.value.properties.ADDR_SOURCE),1)]),Te("div",EE,[IE,Te("div",AE,pi(x[v.value.properties.STATUS]),1)]),Te("div",PE,[CE,Te("div",ME,pi(v.value.properties.ORIG_DATE),1)]),Te("div",kE,[DE,Te("div",zE,pi(v.value.properties.INACTDATE||"None"),1)]),Te("div",RE,[LE,Te("div",FE,pi(v.value.properties.SUFFIX?"Yes":"No"),1)]),Te("div",OE,[BE,Te("div",NE,pi(v.value.properties.CONDOFLAG?"Yes":"No"),1)])])):Jr("",!0),Te("div",VE,[$E,Te("table",UE,[jE,Te("tbody",null,[(Xt(!0),xi(Pr,null,Ec(T.value,j=>(Xt(),xi("tr",null,[Te("td",null,pi(j.attributes.DOCUMENT_ID),1),Te("td",null,pi(j.attributes.DISPLAY_DATE),1),Te("td",null,pi(j.attributes.DOCUMENT_TYPE),1),Te("td",null,pi(j.attributes.GRANTORS),1),Te("td",null,pi(j.attributes.GRANTEES),1)]))),256))])])])],64))}},GE=Lc(qE,[["__scopeId","data-v-071ec60b"]]),HE=Te("div",{class:"box"}," Licenses, inspections, permits, property maintenance violations, and zoning permit documents at your search address. Source: Department of Licenses & Inspections ",-1),ZE=Te("h5",{class:"subtitle is-5"},"Permits",-1),WE={class:"table is-fullwidth is-striped"},KE=Te("thead",null,[Te("tr",null,[Te("th",null,"Date"),Te("th",null,"ID"),Te("th",null,"Description"),Te("th",null,"Status")])],-1),XE=Te("h5",{class:"subtitle is-5"},"Inspections",-1),YE={class:"table is-fullwidth is-striped"},JE=Te("thead",null,[Te("tr",null,[Te("th",null,"Date"),Te("th",null,"ID"),Te("th",null,"Description"),Te("th",null,"Status")])],-1),QE=["innerHTML"],eI={__name:"LI",setup(n){console.log("LI.vue setup");const a=kn(),d=ex(),{currency:m,date:v}=of(),T=(U,N)=>new Date(N.permitissuedate)-new Date(U.permitissuedate),x=dr(()=>d.liPermits.rows.sort(T).slice(0,5)),h=(U,N)=>new Date(N.investigationcompleted)-new Date(U.investigationcompleted),R=dr(()=>d.liInspections.rows.sort(h).slice(0,5)),j=U=>{let N=a.addressData.features[0].properties.street_address;return U.unit_num&&U.unit_num!=null&&(N+=" Unit "+U.unit_num),"<a target='_blank' href='https://li.phila.gov/Property-History/search/Violation-Detail?address="+encodeURIComponent(N)+"&Id="+U.casenumber+"'>"+U.casenumber+" <i class='fa fa-external-link-alt'></i></a>"};return(U,N)=>(Xt(),xi("section",null,[HE,ZE,Te("table",WE,[KE,Te("tbody",null,[(Xt(!0),xi(Pr,null,Ec(x.value,$=>(Xt(),xi("tr",null,[Te("td",null,pi(Qt(v)($.permitissuedate)),1),Te("td",null,pi($.permitnumber),1),Te("td",null,pi($.permitdescription),1),Te("td",null,pi($.status),1)]))),256))])]),XE,Te("table",YE,[JE,Te("tbody",null,[(Xt(!0),xi(Pr,null,Ec(R.value,$=>(Xt(),xi("tr",null,[Te("td",null,pi(Qt(v)($.investigationcompleted)),1),Te("td",{innerHTML:j($)},null,8,QE),Te("td",null,pi($.investigationtype),1),Te("td",null,pi($.investigationstatus),1)]))),256))])])]))}},tI=Te("h1",null,"Zoning Content",-1),iI=[tI],rI={__name:"Zoning",setup(n){return console.log("Zoning.vue setup"),(a,d)=>(Xt(),xi("section",null,iI))}},nI=Te("h1",null,"Voting Content",-1),sI=[nI],oI={__name:"Voting",setup(n){return console.log("Voting.vue setup"),(a,d)=>(Xt(),xi("section",null,sI))}},aI=Te("div",{class:"box"}," See recent activity near your search address including 311 service requests, crimes, zoning appeals, and more. Hover over a record below to highlight it on the map. ",-1),lI=Te("h5",{class:"subtitle is-5"},"Service Requests",-1),cI={class:"table is-fullwidth is-striped"},uI=Te("thead",null,[Te("tr",null,[Te("th",null,"Date"),Te("th",null,"Location"),Te("th",null,"Type"),Te("th",null,"Distance")])],-1),hI=Te("td",null,null,-1),dI={__name:"NearbyActivity",setup(n){console.log("Nearby.vue setup");const a=ix(),{currency:d,date:m}=of(),v=(x,h)=>new Date(h.requested_datetime)-new Date(x.requested_datetime),T=dr(()=>a.nearby311.data.rows.sort(v));return(x,h)=>(Xt(),xi("section",null,[aI,lI,Te("table",cI,[uI,Te("tbody",null,[(Xt(!0),xi(Pr,null,Ec(T.value,R=>(Xt(),xi("tr",null,[Te("td",null,pi(Qt(m)(R.requested_datetime)),1),Te("td",null,pi(R.address),1),Te("td",null,pi(R.service_name),1),hI]))),256))])])]))}},pI=n=>(wh("data-v-77e73449"),n=n(),Sh(),n),fI={key:0,class:"columns"},mI=zb('<div class="column is-12" data-v-77e73449><h3 class="subtitle is-3" data-v-77e73449>Atlas is your front door to the City of Philadelphia.</h3><p class="subtitle is-5" data-v-77e73449>Here are some things you can do with Atlas:</p><ul data-v-77e73449><li data-v-77e73449>Find your polling place</li><li data-v-77e73449>Get the history of permits, licenses, and inspections at any address</li><li data-v-77e73449>Research real estate information including property values, zoning, and document archives</li><li data-v-77e73449>Get easy access to a variety of hard-to-find City resources</li><li data-v-77e73449>View recent activity around your address, such as crimes, 311 service requests, and more</li><li data-v-77e73449>Explore historical imagery and maps</li></ul><p data-v-77e73449>To get started, click anywhere on the map, or type an address, intersection, property assessment account number, or Department of Records Map Registry number into the search box.</p></div>',1),gI=[mI],_I={key:1,class:"columns"},yI=pI(()=>Te("div",{class:"column is-12"},[Te("p",null,"We couldn't find that address. Are you sure everything was spelled correctly?"),Te("p",null,"Here are some examples of things you can search for:"),Te("ul",null,[Te("li",null,"1234 Market St"),Te("li",null,"1001 Pine Street #201"),Te("li",null,"12th & Market"),Te("li",null,"12th & Market"),Te("li",null,"883309050 (an OPA number with no hyphens or other characters)")])],-1)),xI=[yI],vI={key:2},bI={class:"columns"},wI={class:"column is-12"},SI={class:"subtitle is-3"},TI={__name:"TopicPanel",setup(n){const a=ln("addressDataLoadedFlagKey"),d=ln("dataSourcesLoadedArrayKey");console.log("addressDataLoadedFlag:",a,"dataSourcesLoadedArray:",d.value);const m=Yp();console.log("TopicPanel setup, route.params:",m.params,"route:",m);const v=dr(()=>m.params.address);return(T,x)=>(Xt(),xi("section",null,[Qt(m).name=="home"?(Xt(),xi("div",fI,gI)):Jr("",!0),Qt(m).name=="not-found"?(Xt(),xi("div",_I,xI)):Jr("",!0),Qt(m).params.address?(Xt(),xi("div",vI,[Te("div",bI,[Te("div",wI,[Te("h3",SI,pi(v.value),1)])]),Zi(Ga,{"topic-name":"Property",loading:!Qt(d).includes("Property")},{default:Fo(()=>[Qt(d).includes("Property")?(Xt(),ws(pE,{key:0})):Jr("",!0)]),_:1},8,["loading"]),Zi(Ga,{"topic-name":"Deeds",loading:!Qt(d).includes("Deeds")},{default:Fo(()=>[Qt(d).includes("Deeds")?(Xt(),ws(GE,{key:0})):Jr("",!0)]),_:1},8,["loading"]),Zi(Ga,{"topic-name":"Licenses & Inspections",loading:!Qt(d).includes("Licenses & Inspections")},{default:Fo(()=>[Qt(d).includes("Licenses & Inspections")?(Xt(),ws(eI,{key:0})):Jr("",!0)]),_:1},8,["loading"]),Zi(Ga,{"topic-name":"Zoning",loading:!Qt(d).includes("Zoning")},{default:Fo(()=>[Qt(d).includes("Zoning")?(Xt(),ws(rI,{key:0})):Jr("",!0)]),_:1},8,["loading"]),Zi(Ga,{"topic-name":"Voting",loading:!Qt(d).includes("Voting")},{default:Fo(()=>[Qt(d).includes("Voting")?(Xt(),ws(oI,{key:0})):Jr("",!0)]),_:1},8,["loading"]),Zi(Ga,{"topic-name":"Nearby Activity",loading:!Qt(d).includes("Nearby Activity")},{default:Fo(()=>[Qt(d).includes("Nearby Activity")?(Xt(),ws(dI,{key:0})):Jr("",!0)]),_:1},8,["loading"])])):Jr("",!0)]))}},EI=Lc(TI,[["__scopeId","data-v-77e73449"]]),rx=n=>(wh("data-v-28d0cae0"),n=n(),Sh(),n),II=rx(()=>Te("div",{class:"container"},[Te("h1",{class:"title is-1"},"Vue3 Atlas")],-1)),AI={class:"container"},PI={class:"columns"},CI={class:"column is-10"},MI={class:"small-container"},kI={class:"columns"},DI={class:"column is-6"},zI=rx(()=>Te("div",{id:"map-panel",class:"column is-6"},[Te("div",{id:"map",class:"map-class"})],-1)),RI={__name:"Home",setup(n){const a=Bw(),d=wy(),m=kn(),v=Oh(),T=Yp(),x=yy(),{noMapStyle:h,pwdDrawnMapStyle:R,dorDrawnMapStyle:j,zoningDrawnMapStyle:U,imageryMapStyle:N}=tS(),{addressDataFetch:$,parcelsDataFetch:ge,topicDataFetch:xe}=OT(),Ee=io(!1);Qa("addressDataLoadedFlagKey",Ee);const Ke=io([]);Qa("dataSourcesLoadedArrayKey",Ke);const Ne=io("");let He;const me=[],We={undefined:"PWD",Property:"PWD",Deeds:"DOR","Licenses & Inspections":"PWD",Zoning:"DOR",Voting:"PWD","Nearby Activity":"PWD"},lt={Property:R,Deeds:j,"Licenses & Inspections":R,Zoning:U,Voting:R,"Nearby Activity":R},ct=()=>{console.log("toggleImagery, map.getStyle:",He.getStyle()),He.getStyle().name==="imageryMap"?He.setStyle(a.currentTopicMapStyle):He.setStyle(N)};Gp(async()=>{T.params.address&&(Ne.value=T.params.address,vt());let tt;T.params.topic?tt=lt[T.params.topic]:tt=R,a.currentTopicMapStyle=tt,He=new Lg.Map({container:"map",style:tt,center:[-75.163471,39.953338],zoom:12,minZoom:6,maxZoom:22}),He.on("click",async ot=>{console.log("map click event:",ot.lngLat,"route.params.topic:",T.params.topic);let bt;const gt=We[T.params.topic];await v.fillParcelDataByLngLat(ot.lngLat.lng,ot.lngLat.lat,gt);const ei=gt==="PWD"?"ADDRESS":"ADDR_SOURCE";bt=v[gt].properties[ei],d.setCurrentAddress(bt),d.setLastSearchMethod("mapClick"),bt&&T.params.topic?x.push({name:"address-and-topic",params:{address:bt,topic:T.params.topic}}):bt&&x.push({name:"address-and-topic",params:{address:bt,topic:"Property"}})})});const vt=async()=>{if(Ee.value=!1,Ke.value=[],await $(Ne.value),!m.addressData.features){x.push({name:"not-found"}),Ne.value="";return}const tt=m.addressData.features[0].properties.street_address;d.setCurrentAddress(tt),Ee.value=!0,d.setLastSearchMethod("address"),tt&&T.params.topic?x.push({name:"address-and-topic",params:{address:tt,topic:T.params.topic}}):tt&&x.push({name:"address-and-topic",params:{address:tt,topic:"Property"}})};return x.afterEach(async(tt,ot)=>{if(console.log("router.afterEach to:",tt,"from:",ot),tt.name!=="not-found"){if(He.setStyle(lt[tt.params.topic]),a.currentTopicMapStyle=lt[tt.params.topic],tt.params.address!==ot.params.address){Ee.value=!1,Ke.value=[],await $(tt.params.address);const bt=m.addressData.features[0].properties.street_address;d.setCurrentAddress(bt),Ee.value=!0}else if(Ke.value.includes(tt.params.topic)){console.log("data source already loaded, quitting router.afterEach");return}if(tt.params.address){const bt=m.addressData.features[0].geometry.coordinates;me.forEach(ei=>ei.remove()),d.lastSearchMethod==="address"&&He.setCenter(bt);const gt=new Lg.Marker().setLngLat(bt).addTo(He);me.push(gt)}await ge(),await xe(tt.params.topic),Ke.value.push(tt.params.topic)}}),(tt,ot)=>(Xt(),xi("main",null,[II,Te("div",AI,[Te("div",PI,[Te("div",CI,[Jv(Te("input",{class:"input",type:"text",placeholder:"Search an address","onUpdate:modelValue":ot[0]||(ot[0]=bt=>Ne.value=bt),onKeydown:m1(vt,["enter"])},null,544),[[p1,Ne.value]])]),Te("button",{class:"button",onClick:vt}," Search "),Te("button",{class:"button",onClick:ct},"Toggle Imagery")])]),Te("div",MI,[Te("div",kI,[Te("div",DI,[Zi(EI)]),zI])])]))}},Wu=Lc(RI,[["__scopeId","data-v-28d0cae0"]]),LI=Mw({history:ow("/vue3-atlas2"),routes:[{path:"/:pathMatch(.*)*",name:"NotFound",component:()=>Lw(()=>import("./NotFound-Bqi-POdm.js"),[])},{path:"/",name:"home",component:Wu,props:!0,children:[]},{path:"/:address",name:"address",component:Wu},{path:"/:address/:topic",name:"address-and-topic",component:Wu},{path:"/not-found",name:"not-found",component:Wu}]}),af=y1(Dw);af.use(w1());af.use(LI);af.mount("#app");export{Lc as _,Te as a,Db as b,xi as c,Zi as d,Xt as o,FI as r,Fo as w};
