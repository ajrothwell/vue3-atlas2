(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))h(p);new MutationObserver(p=>{for(const y of p)if(y.type==="childList")for(const m of y.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&h(m)}).observe(document,{childList:!0,subtree:!0});function a(p){const y={};return p.integrity&&(y.integrity=p.integrity),p.referrerPolicy&&(y.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?y.credentials="include":p.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function h(p){if(p.ep)return;p.ep=!0;const y=a(p);fetch(p.href,y)}})();/**
* @vue/shared v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function cm(t,r){const a=new Set(t.split(","));return r?h=>a.has(h.toLowerCase()):h=>a.has(h)}const qi={},kl=[],Kr=()=>{},Ib=()=>!1,kd=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&(t.charCodeAt(2)>122||t.charCodeAt(2)<97),hm=t=>t.startsWith("onUpdate:"),Us=Object.assign,um=(t,r)=>{const a=t.indexOf(r);a>-1&&t.splice(a,1)},Pb=Object.prototype.hasOwnProperty,di=(t,r)=>Pb.call(t,r),Ge=Array.isArray,Rl=t=>Rd(t)==="[object Map]",r0=t=>Rd(t)==="[object Set]",Ye=t=>typeof t=="function",Ss=t=>typeof t=="string",Hl=t=>typeof t=="symbol",Gi=t=>t!==null&&typeof t=="object",n0=t=>(Gi(t)||Ye(t))&&Ye(t.then)&&Ye(t.catch),a0=Object.prototype.toString,Rd=t=>a0.call(t),Cb=t=>Rd(t).slice(8,-1),o0=t=>Rd(t)==="[object Object]",dm=t=>Ss(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,oh=cm(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),zd=t=>{const r=Object.create(null);return a=>r[a]||(r[a]=t(a))},Db=/-(\w)/g,Cn=zd(t=>t.replace(Db,(r,a)=>a?a.toUpperCase():"")),kb=/\B([A-Z])/g,wo=zd(t=>t.replace(kb,"-$1").toLowerCase()),Ld=zd(t=>t.charAt(0).toUpperCase()+t.slice(1)),pp=zd(t=>t?`on${Ld(t)}`:""),Ra=(t,r)=>!Object.is(t,r),rd=(t,r)=>{for(let a=0;a<t.length;a++)t[a](r)},md=(t,r,a)=>{Object.defineProperty(t,r,{configurable:!0,enumerable:!1,value:a})},zp=t=>{const r=parseFloat(t);return isNaN(r)?t:r};let w_;const l0=()=>w_||(w_=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function fm(t){if(Ge(t)){const r={};for(let a=0;a<t.length;a++){const h=t[a],p=Ss(h)?Ob(h):fm(h);if(p)for(const y in p)r[y]=p[y]}return r}else if(Ss(t)||Gi(t))return t}const Rb=/;(?![^(]*\))/g,zb=/:([^]+)/,Lb=/\/\*[^]*?\*\//g;function Ob(t){const r={};return t.replace(Lb,"").split(Rb).forEach(a=>{if(a){const h=a.split(zb);h.length>1&&(r[h[0].trim()]=h[1].trim())}}),r}function _o(t){let r="";if(Ss(t))r=t;else if(Ge(t))for(let a=0;a<t.length;a++){const h=_o(t[a]);h&&(r+=h+" ")}else if(Gi(t))for(const a in t)t[a]&&(r+=a+" ");return r.trim()}const Fb="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Bb=cm(Fb);function c0(t){return!!t||t===""}const Fe=t=>Ss(t)?t:t==null?"":Ge(t)||Gi(t)&&(t.toString===a0||!Ye(t.toString))?JSON.stringify(t,h0,2):String(t),h0=(t,r)=>r&&r.__v_isRef?h0(t,r.value):Rl(r)?{[`Map(${r.size})`]:[...r.entries()].reduce((a,[h,p],y)=>(a[mp(h,y)+" =>"]=p,a),{})}:r0(r)?{[`Set(${r.size})`]:[...r.values()].map(a=>mp(a))}:Hl(r)?mp(r):Gi(r)&&!Ge(r)&&!o0(r)?String(r):r,mp=(t,r="")=>{var a;return Hl(t)?`Symbol(${(a=t.description)!=null?a:r})`:t};/**
* @vue/reactivity v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Or;class u0{constructor(r=!1){this.detached=r,this._active=!0,this.effects=[],this.cleanups=[],this.parent=Or,!r&&Or&&(this.index=(Or.scopes||(Or.scopes=[])).push(this)-1)}get active(){return this._active}run(r){if(this._active){const a=Or;try{return Or=this,r()}finally{Or=a}}}on(){Or=this}off(){Or=this.parent}stop(r){if(this._active){let a,h;for(a=0,h=this.effects.length;a<h;a++)this.effects[a].stop();for(a=0,h=this.cleanups.length;a<h;a++)this.cleanups[a]();if(this.scopes)for(a=0,h=this.scopes.length;a<h;a++)this.scopes[a].stop(!0);if(!this.detached&&this.parent&&!r){const p=this.parent.scopes.pop();p&&p!==this&&(this.parent.scopes[this.index]=p,p.index=this.index)}this.parent=void 0,this._active=!1}}}function d0(t){return new u0(t)}function Nb(t,r=Or){r&&r.active&&r.effects.push(t)}function f0(){return Or}function $b(t){Or&&Or.cleanups.push(t)}let yo;class pm{constructor(r,a,h,p){this.fn=r,this.trigger=a,this.scheduler=h,this.active=!0,this.deps=[],this._dirtyLevel=4,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,Nb(this,p)}get dirty(){if(this._dirtyLevel===2||this._dirtyLevel===3){this._dirtyLevel=1,Mo();for(let r=0;r<this._depsLength;r++){const a=this.deps[r];if(a.computed&&(Vb(a.computed),this._dirtyLevel>=4))break}this._dirtyLevel===1&&(this._dirtyLevel=0),So()}return this._dirtyLevel>=4}set dirty(r){this._dirtyLevel=r?4:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let r=Ca,a=yo;try{return Ca=!0,yo=this,this._runnings++,M_(this),this.fn()}finally{S_(this),this._runnings--,yo=a,Ca=r}}stop(){var r;this.active&&(M_(this),S_(this),(r=this.onStop)==null||r.call(this),this.active=!1)}}function Vb(t){return t.value}function M_(t){t._trackId++,t._depsLength=0}function S_(t){if(t.deps.length>t._depsLength){for(let r=t._depsLength;r<t.deps.length;r++)p0(t.deps[r],t);t.deps.length=t._depsLength}}function p0(t,r){const a=t.get(r);a!==void 0&&r._trackId!==a&&(t.delete(r),t.size===0&&t.cleanup())}let Ca=!0,Lp=0;const m0=[];function Mo(){m0.push(Ca),Ca=!1}function So(){const t=m0.pop();Ca=t===void 0?!0:t}function mm(){Lp++}function gm(){for(Lp--;!Lp&&Op.length;)Op.shift()()}function g0(t,r,a){if(r.get(t)!==t._trackId){r.set(t,t._trackId);const h=t.deps[t._depsLength];h!==r?(h&&p0(h,t),t.deps[t._depsLength++]=r):t._depsLength++}}const Op=[];function _0(t,r,a){mm();for(const h of t.keys()){let p;h._dirtyLevel<r&&(p??(p=t.get(h)===h._trackId))&&(h._shouldSchedule||(h._shouldSchedule=h._dirtyLevel===0),h._dirtyLevel=r),h._shouldSchedule&&(p??(p=t.get(h)===h._trackId))&&(h.trigger(),(!h._runnings||h.allowRecurse)&&h._dirtyLevel!==2&&(h._shouldSchedule=!1,h.scheduler&&Op.push(h.scheduler)))}gm()}const y0=(t,r)=>{const a=new Map;return a.cleanup=t,a.computed=r,a},gd=new WeakMap,vo=Symbol(""),Fp=Symbol("");function Tr(t,r,a){if(Ca&&yo){let h=gd.get(t);h||gd.set(t,h=new Map);let p=h.get(a);p||h.set(a,p=y0(()=>h.delete(a))),g0(yo,p)}}function Xn(t,r,a,h,p,y){const m=gd.get(t);if(!m)return;let l=[];if(r==="clear")l=[...m.values()];else if(a==="length"&&Ge(t)){const T=Number(h);m.forEach((I,k)=>{(k==="length"||!Hl(k)&&k>=T)&&l.push(I)})}else switch(a!==void 0&&l.push(m.get(a)),r){case"add":Ge(t)?dm(a)&&l.push(m.get("length")):(l.push(m.get(vo)),Rl(t)&&l.push(m.get(Fp)));break;case"delete":Ge(t)||(l.push(m.get(vo)),Rl(t)&&l.push(m.get(Fp)));break;case"set":Rl(t)&&l.push(m.get(vo));break}mm();for(const T of l)T&&_0(T,4);gm()}function Ub(t,r){var a;return(a=gd.get(t))==null?void 0:a.get(r)}const qb=cm("__proto__,__v_isRef,__isVue"),v0=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(Hl)),T_=jb();function jb(){const t={};return["includes","indexOf","lastIndexOf"].forEach(r=>{t[r]=function(...a){const h=ci(this);for(let y=0,m=this.length;y<m;y++)Tr(h,"get",y+"");const p=h[r](...a);return p===-1||p===!1?h[r](...a.map(ci)):p}}),["push","pop","shift","unshift","splice"].forEach(r=>{t[r]=function(...a){Mo(),mm();const h=ci(this)[r].apply(this,a);return gm(),So(),h}}),t}function Gb(t){const r=ci(this);return Tr(r,"has",t),r.hasOwnProperty(t)}class x0{constructor(r=!1,a=!1){this._isReadonly=r,this._isShallow=a}get(r,a,h){const p=this._isReadonly,y=this._isShallow;if(a==="__v_isReactive")return!p;if(a==="__v_isReadonly")return p;if(a==="__v_isShallow")return y;if(a==="__v_raw")return h===(p?y?rw:S0:y?M0:w0).get(r)||Object.getPrototypeOf(r)===Object.getPrototypeOf(h)?r:void 0;const m=Ge(r);if(!p){if(m&&di(T_,a))return Reflect.get(T_,a,h);if(a==="hasOwnProperty")return Gb}const l=Reflect.get(r,a,h);return(Hl(a)?v0.has(a):qb(a))||(p||Tr(r,"get",a),y)?l:ys(l)?m&&dm(a)?l:l.value:Gi(l)?p?A0(l):Dh(l):l}}class b0 extends x0{constructor(r=!1){super(!1,r)}set(r,a,h,p){let y=r[a];if(!this._isShallow){const T=Nl(y);if(!_d(h)&&!Nl(h)&&(y=ci(y),h=ci(h)),!Ge(r)&&ys(y)&&!ys(h))return T?!1:(y.value=h,!0)}const m=Ge(r)&&dm(a)?Number(a)<r.length:di(r,a),l=Reflect.set(r,a,h,p);return r===ci(p)&&(m?Ra(h,y)&&Xn(r,"set",a,h):Xn(r,"add",a,h)),l}deleteProperty(r,a){const h=di(r,a);r[a];const p=Reflect.deleteProperty(r,a);return p&&h&&Xn(r,"delete",a,void 0),p}has(r,a){const h=Reflect.has(r,a);return(!Hl(a)||!v0.has(a))&&Tr(r,"has",a),h}ownKeys(r){return Tr(r,"iterate",Ge(r)?"length":vo),Reflect.ownKeys(r)}}class Hb extends x0{constructor(r=!1){super(!0,r)}set(r,a){return!0}deleteProperty(r,a){return!0}}const Wb=new b0,Zb=new Hb,Kb=new b0(!0),_m=t=>t,Od=t=>Reflect.getPrototypeOf(t);function Wu(t,r,a=!1,h=!1){t=t.__v_raw;const p=ci(t),y=ci(r);a||(Ra(r,y)&&Tr(p,"get",r),Tr(p,"get",y));const{has:m}=Od(p),l=h?_m:a?xm:xh;if(m.call(p,r))return l(t.get(r));if(m.call(p,y))return l(t.get(y));t!==p&&t.get(r)}function Zu(t,r=!1){const a=this.__v_raw,h=ci(a),p=ci(t);return r||(Ra(t,p)&&Tr(h,"has",t),Tr(h,"has",p)),t===p?a.has(t):a.has(t)||a.has(p)}function Ku(t,r=!1){return t=t.__v_raw,!r&&Tr(ci(t),"iterate",vo),Reflect.get(t,"size",t)}function A_(t){t=ci(t);const r=ci(this);return Od(r).has.call(r,t)||(r.add(t),Xn(r,"add",t,t)),this}function E_(t,r){r=ci(r);const a=ci(this),{has:h,get:p}=Od(a);let y=h.call(a,t);y||(t=ci(t),y=h.call(a,t));const m=p.call(a,t);return a.set(t,r),y?Ra(r,m)&&Xn(a,"set",t,r):Xn(a,"add",t,r),this}function I_(t){const r=ci(this),{has:a,get:h}=Od(r);let p=a.call(r,t);p||(t=ci(t),p=a.call(r,t)),h&&h.call(r,t);const y=r.delete(t);return p&&Xn(r,"delete",t,void 0),y}function P_(){const t=ci(this),r=t.size!==0,a=t.clear();return r&&Xn(t,"clear",void 0,void 0),a}function Xu(t,r){return function(h,p){const y=this,m=y.__v_raw,l=ci(m),T=r?_m:t?xm:xh;return!t&&Tr(l,"iterate",vo),m.forEach((I,k)=>h.call(p,T(I),T(k),y))}}function Yu(t,r,a){return function(...h){const p=this.__v_raw,y=ci(p),m=Rl(y),l=t==="entries"||t===Symbol.iterator&&m,T=t==="keys"&&m,I=p[t](...h),k=a?_m:r?xm:xh;return!r&&Tr(y,"iterate",T?Fp:vo),{next(){const{value:P,done:L}=I.next();return L?{value:P,done:L}:{value:l?[k(P[0]),k(P[1])]:k(P),done:L}},[Symbol.iterator](){return this}}}}function ba(t){return function(...r){return t==="delete"?!1:t==="clear"?void 0:this}}function Xb(){const t={get(y){return Wu(this,y)},get size(){return Ku(this)},has:Zu,add:A_,set:E_,delete:I_,clear:P_,forEach:Xu(!1,!1)},r={get(y){return Wu(this,y,!1,!0)},get size(){return Ku(this)},has:Zu,add:A_,set:E_,delete:I_,clear:P_,forEach:Xu(!1,!0)},a={get(y){return Wu(this,y,!0)},get size(){return Ku(this,!0)},has(y){return Zu.call(this,y,!0)},add:ba("add"),set:ba("set"),delete:ba("delete"),clear:ba("clear"),forEach:Xu(!0,!1)},h={get(y){return Wu(this,y,!0,!0)},get size(){return Ku(this,!0)},has(y){return Zu.call(this,y,!0)},add:ba("add"),set:ba("set"),delete:ba("delete"),clear:ba("clear"),forEach:Xu(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(y=>{t[y]=Yu(y,!1,!1),a[y]=Yu(y,!0,!1),r[y]=Yu(y,!1,!0),h[y]=Yu(y,!0,!0)}),[t,a,r,h]}const[Yb,Jb,Qb,tw]=Xb();function ym(t,r){const a=r?t?tw:Qb:t?Jb:Yb;return(h,p,y)=>p==="__v_isReactive"?!t:p==="__v_isReadonly"?t:p==="__v_raw"?h:Reflect.get(di(a,p)&&p in h?a:h,p,y)}const ew={get:ym(!1,!1)},iw={get:ym(!1,!0)},sw={get:ym(!0,!1)},w0=new WeakMap,M0=new WeakMap,S0=new WeakMap,rw=new WeakMap;function nw(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function aw(t){return t.__v_skip||!Object.isExtensible(t)?0:nw(Cb(t))}function Dh(t){return Nl(t)?t:vm(t,!1,Wb,ew,w0)}function T0(t){return vm(t,!1,Kb,iw,M0)}function A0(t){return vm(t,!0,Zb,sw,S0)}function vm(t,r,a,h,p){if(!Gi(t)||t.__v_raw&&!(r&&t.__v_isReactive))return t;const y=p.get(t);if(y)return y;const m=aw(t);if(m===0)return t;const l=new Proxy(t,m===2?h:a);return p.set(t,l),l}function Yn(t){return Nl(t)?Yn(t.__v_raw):!!(t&&t.__v_isReactive)}function Nl(t){return!!(t&&t.__v_isReadonly)}function _d(t){return!!(t&&t.__v_isShallow)}function E0(t){return Yn(t)||Nl(t)}function ci(t){const r=t&&t.__v_raw;return r?ci(r):t}function Fd(t){return Object.isExtensible(t)&&md(t,"__v_skip",!0),t}const xh=t=>Gi(t)?Dh(t):t,xm=t=>Gi(t)?A0(t):t;class I0{constructor(r,a,h,p){this.getter=r,this._setter=a,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this.effect=new pm(()=>r(this._value),()=>nd(this,this.effect._dirtyLevel===2?2:3)),this.effect.computed=this,this.effect.active=this._cacheable=!p,this.__v_isReadonly=h}get value(){const r=ci(this);return(!r._cacheable||r.effect.dirty)&&Ra(r._value,r._value=r.effect.run())&&nd(r,4),P0(r),r.effect._dirtyLevel>=2&&nd(r,2),r._value}set value(r){this._setter(r)}get _dirty(){return this.effect.dirty}set _dirty(r){this.effect.dirty=r}}function ow(t,r,a=!1){let h,p;const y=Ye(t);return y?(h=t,p=Kr):(h=t.get,p=t.set),new I0(h,p,y||!p,a)}function P0(t){var r;Ca&&yo&&(t=ci(t),g0(yo,(r=t.dep)!=null?r:t.dep=y0(()=>t.dep=void 0,t instanceof I0?t:void 0)))}function nd(t,r=4,a){t=ci(t);const h=t.dep;h&&_0(h,r)}function ys(t){return!!(t&&t.__v_isRef===!0)}function Mr(t){return C0(t,!1)}function lw(t){return C0(t,!0)}function C0(t,r){return ys(t)?t:new cw(t,r)}class cw{constructor(r,a){this.__v_isShallow=a,this.dep=void 0,this.__v_isRef=!0,this._rawValue=a?r:ci(r),this._value=a?r:xh(r)}get value(){return P0(this),this._value}set value(r){const a=this.__v_isShallow||_d(r)||Nl(r);r=a?r:ci(r),Ra(r,this._rawValue)&&(this._rawValue=r,this._value=a?r:xh(r),nd(this,4))}}function Xe(t){return ys(t)?t.value:t}const hw={get:(t,r,a)=>Xe(Reflect.get(t,r,a)),set:(t,r,a,h)=>{const p=t[r];return ys(p)&&!ys(a)?(p.value=a,!0):Reflect.set(t,r,a,h)}};function D0(t){return Yn(t)?t:new Proxy(t,hw)}function uw(t){const r=Ge(t)?new Array(t.length):{};for(const a in t)r[a]=k0(t,a);return r}class dw{constructor(r,a,h){this._object=r,this._key=a,this._defaultValue=h,this.__v_isRef=!0}get value(){const r=this._object[this._key];return r===void 0?this._defaultValue:r}set value(r){this._object[this._key]=r}get dep(){return Ub(ci(this._object),this._key)}}class fw{constructor(r){this._getter=r,this.__v_isRef=!0,this.__v_isReadonly=!0}get value(){return this._getter()}}function pw(t,r,a){return ys(t)?t:Ye(t)?new fw(t):Gi(t)&&arguments.length>1?k0(t,r,a):Mr(t)}function k0(t,r,a){const h=t[r];return ys(h)?h:new dw(t,r,a)}/**
* @vue/runtime-core v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Da(t,r,a,h){try{return h?t(...h):t()}catch(p){Bd(p,r,a)}}function nn(t,r,a,h){if(Ye(t)){const y=Da(t,r,a,h);return y&&n0(y)&&y.catch(m=>{Bd(m,r,a)}),y}const p=[];for(let y=0;y<t.length;y++)p.push(nn(t[y],r,a,h));return p}function Bd(t,r,a,h=!0){const p=r?r.vnode:null;if(r){let y=r.parent;const m=r.proxy,l=`https://vuejs.org/error-reference/#runtime-${a}`;for(;y;){const I=y.ec;if(I){for(let k=0;k<I.length;k++)if(I[k](t,m,l)===!1)return}y=y.parent}const T=r.appContext.config.errorHandler;if(T){Da(T,null,10,[t,m,l]);return}}mw(t,a,p,h)}function mw(t,r,a,h=!0){console.error(t)}let bh=!1,Bp=!1;const Qs=[];let Tn=0;const zl=[];let Aa=null,mo=0;const R0=Promise.resolve();let bm=null;function wm(t){const r=bm||R0;return t?r.then(this?t.bind(this):t):r}function gw(t){let r=Tn+1,a=Qs.length;for(;r<a;){const h=r+a>>>1,p=Qs[h],y=wh(p);y<t||y===t&&p.pre?r=h+1:a=h}return r}function Mm(t){(!Qs.length||!Qs.includes(t,bh&&t.allowRecurse?Tn+1:Tn))&&(t.id==null?Qs.push(t):Qs.splice(gw(t.id),0,t),z0())}function z0(){!bh&&!Bp&&(Bp=!0,bm=R0.then(O0))}function _w(t){const r=Qs.indexOf(t);r>Tn&&Qs.splice(r,1)}function yw(t){Ge(t)?zl.push(...t):(!Aa||!Aa.includes(t,t.allowRecurse?mo+1:mo))&&zl.push(t),z0()}function C_(t,r,a=bh?Tn+1:0){for(;a<Qs.length;a++){const h=Qs[a];if(h&&h.pre){if(t&&h.id!==t.uid)continue;Qs.splice(a,1),a--,h()}}}function L0(t){if(zl.length){const r=[...new Set(zl)].sort((a,h)=>wh(a)-wh(h));if(zl.length=0,Aa){Aa.push(...r);return}for(Aa=r,mo=0;mo<Aa.length;mo++)Aa[mo]();Aa=null,mo=0}}const wh=t=>t.id==null?1/0:t.id,vw=(t,r)=>{const a=wh(t)-wh(r);if(a===0){if(t.pre&&!r.pre)return-1;if(r.pre&&!t.pre)return 1}return a};function O0(t){Bp=!1,bh=!0,Qs.sort(vw);try{for(Tn=0;Tn<Qs.length;Tn++){const r=Qs[Tn];r&&r.active!==!1&&Da(r,null,14)}}finally{Tn=0,Qs.length=0,L0(),bh=!1,bm=null,(Qs.length||zl.length)&&O0()}}function xw(t,r,...a){if(t.isUnmounted)return;const h=t.vnode.props||qi;let p=a;const y=r.startsWith("update:"),m=y&&r.slice(7);if(m&&m in h){const k=`${m==="modelValue"?"model":m}Modifiers`,{number:P,trim:L}=h[k]||qi;L&&(p=a.map(K=>Ss(K)?K.trim():K)),P&&(p=a.map(zp))}let l,T=h[l=pp(r)]||h[l=pp(Cn(r))];!T&&y&&(T=h[l=pp(wo(r))]),T&&nn(T,t,6,p);const I=h[l+"Once"];if(I){if(!t.emitted)t.emitted={};else if(t.emitted[l])return;t.emitted[l]=!0,nn(I,t,6,p)}}function F0(t,r,a=!1){const h=r.emitsCache,p=h.get(t);if(p!==void 0)return p;const y=t.emits;let m={},l=!1;if(!Ye(t)){const T=I=>{const k=F0(I,r,!0);k&&(l=!0,Us(m,k))};!a&&r.mixins.length&&r.mixins.forEach(T),t.extends&&T(t.extends),t.mixins&&t.mixins.forEach(T)}return!y&&!l?(Gi(t)&&h.set(t,null),null):(Ge(y)?y.forEach(T=>m[T]=null):Us(m,y),Gi(t)&&h.set(t,m),m)}function Nd(t,r){return!t||!kd(r)?!1:(r=r.slice(2).replace(/Once$/,""),di(t,r[0].toLowerCase()+r.slice(1))||di(t,wo(r))||di(t,r))}let Ms=null,$d=null;function yd(t){const r=Ms;return Ms=t,$d=t&&t.type.__scopeId||null,r}function Vd(t){$d=t}function Ud(){$d=null}function Kn(t,r=Ms,a){if(!r||t._n)return t;const h=(...p)=>{h._d&&V_(-1);const y=yd(r);let m;try{m=t(...p)}finally{yd(y),h._d&&V_(1)}return m};return h._n=!0,h._c=!0,h._d=!0,h}function gp(t){const{type:r,vnode:a,proxy:h,withProxy:p,props:y,propsOptions:[m],slots:l,attrs:T,emit:I,render:k,renderCache:P,data:L,setupState:K,ctx:tt,inheritAttrs:ot}=t;let vt,yt;const At=yd(t);try{if(a.shapeFlag&4){const Tt=p||h,$t=Tt;vt=Sn(k.call($t,Tt,P,y,K,L,tt)),yt=T}else{const Tt=r;vt=Sn(Tt.length>1?Tt(y,{attrs:T,slots:l,emit:I}):Tt(y,null)),yt=r.props?T:bw(T)}}catch(Tt){uh.length=0,Bd(Tt,t,1),vt=Zi(za)}let ht=vt;if(yt&&ot!==!1){const Tt=Object.keys(yt),{shapeFlag:$t}=ht;Tt.length&&$t&7&&(m&&Tt.some(hm)&&(yt=ww(yt,m)),ht=$l(ht,yt))}return a.dirs&&(ht=$l(ht),ht.dirs=ht.dirs?ht.dirs.concat(a.dirs):a.dirs),a.transition&&(ht.transition=a.transition),vt=ht,yd(At),vt}const bw=t=>{let r;for(const a in t)(a==="class"||a==="style"||kd(a))&&((r||(r={}))[a]=t[a]);return r},ww=(t,r)=>{const a={};for(const h in t)(!hm(h)||!(h.slice(9)in r))&&(a[h]=t[h]);return a};function Mw(t,r,a){const{props:h,children:p,component:y}=t,{props:m,children:l,patchFlag:T}=r,I=y.emitsOptions;if(r.dirs||r.transition)return!0;if(a&&T>=0){if(T&1024)return!0;if(T&16)return h?D_(h,m,I):!!m;if(T&8){const k=r.dynamicProps;for(let P=0;P<k.length;P++){const L=k[P];if(m[L]!==h[L]&&!Nd(I,L))return!0}}}else return(p||l)&&(!l||!l.$stable)?!0:h===m?!1:h?m?D_(h,m,I):!0:!!m;return!1}function D_(t,r,a){const h=Object.keys(r);if(h.length!==Object.keys(t).length)return!0;for(let p=0;p<h.length;p++){const y=h[p];if(r[y]!==t[y]&&!Nd(a,y))return!0}return!1}function Sw({vnode:t,parent:r},a){for(;r;){const h=r.subTree;if(h.suspense&&h.suspense.activeBranch===t&&(h.el=t.el),h===t)(t=r.vnode).el=a,r=r.parent;else break}}const B0="components";function NR(t,r){return Aw(B0,t,!0,r)||t}const Tw=Symbol.for("v-ndc");function Aw(t,r,a=!0,h=!1){const p=Ms||$s;if(p){const y=p.type;if(t===B0){const l=x2(y,!1);if(l&&(l===r||l===Cn(r)||l===Ld(Cn(r))))return y}const m=k_(p[t]||y[t],r)||k_(p.appContext[t],r);return!m&&h?y:m}}function k_(t,r){return t&&(t[r]||t[Cn(r)]||t[Ld(Cn(r))])}const Ew=t=>t.__isSuspense;function Iw(t,r){r&&r.pendingBranch?Ge(t)?r.effects.push(...t):r.effects.push(t):yw(t)}const Pw=Symbol.for("v-scx"),Cw=()=>Sr(Pw),Ju={};function lh(t,r,a){return N0(t,r,a)}function N0(t,r,{immediate:a,deep:h,flush:p,once:y,onTrack:m,onTrigger:l}=qi){if(r&&y){const qt=r;r=(...oe)=>{qt(...oe),$t()}}const T=$s,I=qt=>h===!0?qt:go(qt,h===!1?1:void 0);let k,P=!1,L=!1;if(ys(t)?(k=()=>t.value,P=_d(t)):Yn(t)?(k=()=>I(t),P=!0):Ge(t)?(L=!0,P=t.some(qt=>Yn(qt)||_d(qt)),k=()=>t.map(qt=>{if(ys(qt))return qt.value;if(Yn(qt))return I(qt);if(Ye(qt))return Da(qt,T,2)})):Ye(t)?r?k=()=>Da(t,T,2):k=()=>(K&&K(),nn(t,T,3,[tt])):k=Kr,r&&h){const qt=k;k=()=>go(qt())}let K,tt=qt=>{K=ht.onStop=()=>{Da(qt,T,4),K=ht.onStop=void 0}},ot;if(Hd)if(tt=Kr,r?a&&nn(r,T,3,[k(),L?[]:void 0,tt]):k(),p==="sync"){const qt=Cw();ot=qt.__watcherHandles||(qt.__watcherHandles=[])}else return Kr;let vt=L?new Array(t.length).fill(Ju):Ju;const yt=()=>{if(!(!ht.active||!ht.dirty))if(r){const qt=ht.run();(h||P||(L?qt.some((oe,ne)=>Ra(oe,vt[ne])):Ra(qt,vt)))&&(K&&K(),nn(r,T,3,[qt,vt===Ju?void 0:L&&vt[0]===Ju?[]:vt,tt]),vt=qt)}else ht.run()};yt.allowRecurse=!!r;let At;p==="sync"?At=yt:p==="post"?At=()=>wr(yt,T&&T.suspense):(yt.pre=!0,T&&(yt.id=T.uid),At=()=>Mm(yt));const ht=new pm(k,Kr,At),Tt=f0(),$t=()=>{ht.stop(),Tt&&um(Tt.effects,ht)};return r?a?yt():vt=ht.run():p==="post"?wr(ht.run.bind(ht),T&&T.suspense):ht.run(),ot&&ot.push($t),$t}function Dw(t,r,a){const h=this.proxy,p=Ss(t)?t.includes(".")?$0(h,t):()=>h[t]:t.bind(h,h);let y;Ye(r)?y=r:(y=r.handler,a=r);const m=kh(this),l=N0(p,y.bind(h),a);return m(),l}function $0(t,r){const a=r.split(".");return()=>{let h=t;for(let p=0;p<a.length&&h;p++)h=h[a[p]];return h}}function go(t,r,a=0,h){if(!Gi(t)||t.__v_skip)return t;if(r&&r>0){if(a>=r)return t;a++}if(h=h||new Set,h.has(t))return t;if(h.add(t),ys(t))go(t.value,r,a,h);else if(Ge(t))for(let p=0;p<t.length;p++)go(t[p],r,a,h);else if(r0(t)||Rl(t))t.forEach(p=>{go(p,r,a,h)});else if(o0(t))for(const p in t)go(t[p],r,a,h);return t}function V0(t,r){if(Ms===null)return t;const a=Wd(Ms)||Ms.proxy,h=t.dirs||(t.dirs=[]);for(let p=0;p<r.length;p++){let[y,m,l,T=qi]=r[p];y&&(Ye(y)&&(y={mounted:y,updated:y}),y.deep&&go(m),h.push({dir:y,instance:a,value:m,oldValue:void 0,arg:l,modifiers:T}))}return t}function ho(t,r,a,h){const p=t.dirs,y=r&&r.dirs;for(let m=0;m<p.length;m++){const l=p[m];y&&(l.oldValue=y[m].value);let T=l.dir[h];T&&(Mo(),nn(T,a,8,[t.el,l,t,r]),So())}}/*! #__NO_SIDE_EFFECTS__ */function U0(t,r){return Ye(t)?Us({name:t.name},r,{setup:t}):t}const ch=t=>!!t.type.__asyncLoader,q0=t=>t.type.__isKeepAlive;function kw(t,r){j0(t,"a",r)}function Rw(t,r){j0(t,"da",r)}function j0(t,r,a=$s){const h=t.__wdc||(t.__wdc=()=>{let p=a;for(;p;){if(p.isDeactivated)return;p=p.parent}return t()});if(qd(r,h,a),a){let p=a.parent;for(;p&&p.parent;)q0(p.parent.vnode)&&zw(h,r,a,p),p=p.parent}}function zw(t,r,a,h){const p=qd(r,t,h,!0);H0(()=>{um(h[r],p)},a)}function qd(t,r,a=$s,h=!1){if(a){const p=a[t]||(a[t]=[]),y=r.__weh||(r.__weh=(...m)=>{if(a.isUnmounted)return;Mo();const l=kh(a),T=nn(r,a,t,m);return l(),So(),T});return h?p.unshift(y):p.push(y),y}}const Qn=t=>(r,a=$s)=>(!Hd||t==="sp")&&qd(t,(...h)=>r(...h),a),G0=Qn("bm"),Sm=Qn("m"),Lw=Qn("bu"),Ow=Qn("u"),Fw=Qn("bum"),H0=Qn("um"),Bw=Qn("sp"),Nw=Qn("rtg"),$w=Qn("rtc");function Vw(t,r=$s){qd("ec",t,r)}function An(t,r,a,h){let p;const y=a&&a[h];if(Ge(t)||Ss(t)){p=new Array(t.length);for(let m=0,l=t.length;m<l;m++)p[m]=r(t[m],m,void 0,y&&y[m])}else if(typeof t=="number"){p=new Array(t);for(let m=0;m<t;m++)p[m]=r(m+1,m,void 0,y&&y[m])}else if(Gi(t))if(t[Symbol.iterator])p=Array.from(t,(m,l)=>r(m,l,void 0,y&&y[l]));else{const m=Object.keys(t);p=new Array(m.length);for(let l=0,T=m.length;l<T;l++){const I=m[l];p[l]=r(t[I],I,l,y&&y[l])}}else p=[];return a&&(a[h]=p),p}function Uw(t,r,a={},h,p){if(Ms.isCE||Ms.parent&&ch(Ms.parent)&&Ms.parent.isCE)return r!=="default"&&(a.name=r),Zi("slot",a,h&&h());let y=t[r];y&&y._c&&(y._d=!1),Ie();const m=y&&W0(y(a)),l=Mn(ns,{key:a.key||m&&m.key||`_${r}`},m||(h?h():[]),m&&t._===1?64:-2);return!p&&l.scopeId&&(l.slotScopeIds=[l.scopeId+"-s"]),y&&y._c&&(y._d=!0),l}function W0(t){return t.some(r=>xd(r)?!(r.type===za||r.type===ns&&!W0(r.children)):!0)?t:null}const Np=t=>t?av(t)?Wd(t)||t.proxy:Np(t.parent):null,hh=Us(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>Np(t.parent),$root:t=>Np(t.root),$emit:t=>t.emit,$options:t=>Tm(t),$forceUpdate:t=>t.f||(t.f=()=>{t.effect.dirty=!0,Mm(t.update)}),$nextTick:t=>t.n||(t.n=wm.bind(t.proxy)),$watch:t=>Dw.bind(t)}),_p=(t,r)=>t!==qi&&!t.__isScriptSetup&&di(t,r),qw={get({_:t},r){const{ctx:a,setupState:h,data:p,props:y,accessCache:m,type:l,appContext:T}=t;let I;if(r[0]!=="$"){const K=m[r];if(K!==void 0)switch(K){case 1:return h[r];case 2:return p[r];case 4:return a[r];case 3:return y[r]}else{if(_p(h,r))return m[r]=1,h[r];if(p!==qi&&di(p,r))return m[r]=2,p[r];if((I=t.propsOptions[0])&&di(I,r))return m[r]=3,y[r];if(a!==qi&&di(a,r))return m[r]=4,a[r];$p&&(m[r]=0)}}const k=hh[r];let P,L;if(k)return r==="$attrs"&&Tr(t,"get",r),k(t);if((P=l.__cssModules)&&(P=P[r]))return P;if(a!==qi&&di(a,r))return m[r]=4,a[r];if(L=T.config.globalProperties,di(L,r))return L[r]},set({_:t},r,a){const{data:h,setupState:p,ctx:y}=t;return _p(p,r)?(p[r]=a,!0):h!==qi&&di(h,r)?(h[r]=a,!0):di(t.props,r)||r[0]==="$"&&r.slice(1)in t?!1:(y[r]=a,!0)},has({_:{data:t,setupState:r,accessCache:a,ctx:h,appContext:p,propsOptions:y}},m){let l;return!!a[m]||t!==qi&&di(t,m)||_p(r,m)||(l=y[0])&&di(l,m)||di(h,m)||di(hh,m)||di(p.config.globalProperties,m)},defineProperty(t,r,a){return a.get!=null?t._.accessCache[r]=0:di(a,"value")&&this.set(t,r,a.value,null),Reflect.defineProperty(t,r,a)}};function R_(t){return Ge(t)?t.reduce((r,a)=>(r[a]=null,r),{}):t}let $p=!0;function jw(t){const r=Tm(t),a=t.proxy,h=t.ctx;$p=!1,r.beforeCreate&&z_(r.beforeCreate,t,"bc");const{data:p,computed:y,methods:m,watch:l,provide:T,inject:I,created:k,beforeMount:P,mounted:L,beforeUpdate:K,updated:tt,activated:ot,deactivated:vt,beforeDestroy:yt,beforeUnmount:At,destroyed:ht,unmounted:Tt,render:$t,renderTracked:qt,renderTriggered:oe,errorCaptured:ne,serverPrefetch:Vt,expose:Gt,inheritAttrs:Dt,components:de,directives:De,filters:ke}=r;if(I&&Gw(I,h,null),m)for(const Le in m){const ii=m[Le];Ye(ii)&&(h[Le]=ii.bind(a))}if(p){const Le=p.call(a,a);Gi(Le)&&(t.data=Dh(Le))}if($p=!0,y)for(const Le in y){const ii=y[Le],xs=Ye(ii)?ii.bind(a,a):Ye(ii.get)?ii.get.bind(a,a):Kr,Ds=!Ye(ii)&&Ye(ii.set)?ii.set.bind(a):Kr,Ei=ji({get:xs,set:Ds});Object.defineProperty(h,Le,{enumerable:!0,configurable:!0,get:()=>Ei.value,set:hi=>Ei.value=hi})}if(l)for(const Le in l)Z0(l[Le],h,a,Le);if(T){const Le=Ye(T)?T.call(a):T;Reflect.ownKeys(Le).forEach(ii=>{Ol(ii,Le[ii])})}k&&z_(k,t,"c");function Re(Le,ii){Ge(ii)?ii.forEach(xs=>Le(xs.bind(a))):ii&&Le(ii.bind(a))}if(Re(G0,P),Re(Sm,L),Re(Lw,K),Re(Ow,tt),Re(kw,ot),Re(Rw,vt),Re(Vw,ne),Re($w,qt),Re(Nw,oe),Re(Fw,At),Re(H0,Tt),Re(Bw,Vt),Ge(Gt))if(Gt.length){const Le=t.exposed||(t.exposed={});Gt.forEach(ii=>{Object.defineProperty(Le,ii,{get:()=>a[ii],set:xs=>a[ii]=xs})})}else t.exposed||(t.exposed={});$t&&t.render===Kr&&(t.render=$t),Dt!=null&&(t.inheritAttrs=Dt),de&&(t.components=de),De&&(t.directives=De)}function Gw(t,r,a=Kr){Ge(t)&&(t=Vp(t));for(const h in t){const p=t[h];let y;Gi(p)?"default"in p?y=Sr(p.from||h,p.default,!0):y=Sr(p.from||h):y=Sr(p),ys(y)?Object.defineProperty(r,h,{enumerable:!0,configurable:!0,get:()=>y.value,set:m=>y.value=m}):r[h]=y}}function z_(t,r,a){nn(Ge(t)?t.map(h=>h.bind(r.proxy)):t.bind(r.proxy),r,a)}function Z0(t,r,a,h){const p=h.includes(".")?$0(a,h):()=>a[h];if(Ss(t)){const y=r[t];Ye(y)&&lh(p,y)}else if(Ye(t))lh(p,t.bind(a));else if(Gi(t))if(Ge(t))t.forEach(y=>Z0(y,r,a,h));else{const y=Ye(t.handler)?t.handler.bind(a):r[t.handler];Ye(y)&&lh(p,y,t)}}function Tm(t){const r=t.type,{mixins:a,extends:h}=r,{mixins:p,optionsCache:y,config:{optionMergeStrategies:m}}=t.appContext,l=y.get(r);let T;return l?T=l:!p.length&&!a&&!h?T=r:(T={},p.length&&p.forEach(I=>vd(T,I,m,!0)),vd(T,r,m)),Gi(r)&&y.set(r,T),T}function vd(t,r,a,h=!1){const{mixins:p,extends:y}=r;y&&vd(t,y,a,!0),p&&p.forEach(m=>vd(t,m,a,!0));for(const m in r)if(!(h&&m==="expose")){const l=Hw[m]||a&&a[m];t[m]=l?l(t[m],r[m]):r[m]}return t}const Hw={data:L_,props:O_,emits:O_,methods:sh,computed:sh,beforeCreate:hr,created:hr,beforeMount:hr,mounted:hr,beforeUpdate:hr,updated:hr,beforeDestroy:hr,beforeUnmount:hr,destroyed:hr,unmounted:hr,activated:hr,deactivated:hr,errorCaptured:hr,serverPrefetch:hr,components:sh,directives:sh,watch:Zw,provide:L_,inject:Ww};function L_(t,r){return r?t?function(){return Us(Ye(t)?t.call(this,this):t,Ye(r)?r.call(this,this):r)}:r:t}function Ww(t,r){return sh(Vp(t),Vp(r))}function Vp(t){if(Ge(t)){const r={};for(let a=0;a<t.length;a++)r[t[a]]=t[a];return r}return t}function hr(t,r){return t?[...new Set([].concat(t,r))]:r}function sh(t,r){return t?Us(Object.create(null),t,r):r}function O_(t,r){return t?Ge(t)&&Ge(r)?[...new Set([...t,...r])]:Us(Object.create(null),R_(t),R_(r??{})):r}function Zw(t,r){if(!t)return r;if(!r)return t;const a=Us(Object.create(null),t);for(const h in r)a[h]=hr(t[h],r[h]);return a}function K0(){return{app:null,config:{isNativeTag:Ib,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Kw=0;function Xw(t,r){return function(h,p=null){Ye(h)||(h=Us({},h)),p!=null&&!Gi(p)&&(p=null);const y=K0(),m=new WeakSet;let l=!1;const T=y.app={_uid:Kw++,_component:h,_props:p,_container:null,_context:y,_instance:null,version:w2,get config(){return y.config},set config(I){},use(I,...k){return m.has(I)||(I&&Ye(I.install)?(m.add(I),I.install(T,...k)):Ye(I)&&(m.add(I),I(T,...k))),T},mixin(I){return y.mixins.includes(I)||y.mixins.push(I),T},component(I,k){return k?(y.components[I]=k,T):y.components[I]},directive(I,k){return k?(y.directives[I]=k,T):y.directives[I]},mount(I,k,P){if(!l){const L=Zi(h,p);return L.appContext=y,P===!0?P="svg":P===!1&&(P=void 0),k&&r?r(L,I):t(L,I,P),l=!0,T._container=I,I.__vue_app__=T,Wd(L.component)||L.component.proxy}},unmount(){l&&(t(null,T._container),delete T._container.__vue_app__)},provide(I,k){return y.provides[I]=k,T},runWithContext(I){const k=Ll;Ll=T;try{return I()}finally{Ll=k}}};return T}}let Ll=null;function Ol(t,r){if($s){let a=$s.provides;const h=$s.parent&&$s.parent.provides;h===a&&(a=$s.provides=Object.create(h)),a[t]=r}}function Sr(t,r,a=!1){const h=$s||Ms;if(h||Ll){const p=h?h.parent==null?h.vnode.appContext&&h.vnode.appContext.provides:h.parent.provides:Ll._context.provides;if(p&&t in p)return p[t];if(arguments.length>1)return a&&Ye(r)?r.call(h&&h.proxy):r}}function Yw(){return!!($s||Ms||Ll)}function Jw(t,r,a,h=!1){const p={},y={};md(y,Gd,1),t.propsDefaults=Object.create(null),X0(t,r,p,y);for(const m in t.propsOptions[0])m in p||(p[m]=void 0);a?t.props=h?p:T0(p):t.type.props?t.props=p:t.props=y,t.attrs=y}function Qw(t,r,a,h){const{props:p,attrs:y,vnode:{patchFlag:m}}=t,l=ci(p),[T]=t.propsOptions;let I=!1;if((h||m>0)&&!(m&16)){if(m&8){const k=t.vnode.dynamicProps;for(let P=0;P<k.length;P++){let L=k[P];if(Nd(t.emitsOptions,L))continue;const K=r[L];if(T)if(di(y,L))K!==y[L]&&(y[L]=K,I=!0);else{const tt=Cn(L);p[tt]=Up(T,l,tt,K,t,!1)}else K!==y[L]&&(y[L]=K,I=!0)}}}else{X0(t,r,p,y)&&(I=!0);let k;for(const P in l)(!r||!di(r,P)&&((k=wo(P))===P||!di(r,k)))&&(T?a&&(a[P]!==void 0||a[k]!==void 0)&&(p[P]=Up(T,l,P,void 0,t,!0)):delete p[P]);if(y!==l)for(const P in y)(!r||!di(r,P))&&(delete y[P],I=!0)}I&&Xn(t,"set","$attrs")}function X0(t,r,a,h){const[p,y]=t.propsOptions;let m=!1,l;if(r)for(let T in r){if(oh(T))continue;const I=r[T];let k;p&&di(p,k=Cn(T))?!y||!y.includes(k)?a[k]=I:(l||(l={}))[k]=I:Nd(t.emitsOptions,T)||(!(T in h)||I!==h[T])&&(h[T]=I,m=!0)}if(y){const T=ci(a),I=l||qi;for(let k=0;k<y.length;k++){const P=y[k];a[P]=Up(p,T,P,I[P],t,!di(I,P))}}return m}function Up(t,r,a,h,p,y){const m=t[a];if(m!=null){const l=di(m,"default");if(l&&h===void 0){const T=m.default;if(m.type!==Function&&!m.skipFactory&&Ye(T)){const{propsDefaults:I}=p;if(a in I)h=I[a];else{const k=kh(p);h=I[a]=T.call(null,r),k()}}else h=T}m[0]&&(y&&!l?h=!1:m[1]&&(h===""||h===wo(a))&&(h=!0))}return h}function Y0(t,r,a=!1){const h=r.propsCache,p=h.get(t);if(p)return p;const y=t.props,m={},l=[];let T=!1;if(!Ye(t)){const k=P=>{T=!0;const[L,K]=Y0(P,r,!0);Us(m,L),K&&l.push(...K)};!a&&r.mixins.length&&r.mixins.forEach(k),t.extends&&k(t.extends),t.mixins&&t.mixins.forEach(k)}if(!y&&!T)return Gi(t)&&h.set(t,kl),kl;if(Ge(y))for(let k=0;k<y.length;k++){const P=Cn(y[k]);F_(P)&&(m[P]=qi)}else if(y)for(const k in y){const P=Cn(k);if(F_(P)){const L=y[k],K=m[P]=Ge(L)||Ye(L)?{type:L}:Us({},L);if(K){const tt=$_(Boolean,K.type),ot=$_(String,K.type);K[0]=tt>-1,K[1]=ot<0||tt<ot,(tt>-1||di(K,"default"))&&l.push(P)}}}const I=[m,l];return Gi(t)&&h.set(t,I),I}function F_(t){return t[0]!=="$"&&!oh(t)}function B_(t){return t===null?"null":typeof t=="function"?t.name||"":typeof t=="object"&&t.constructor&&t.constructor.name||""}function N_(t,r){return B_(t)===B_(r)}function $_(t,r){return Ge(r)?r.findIndex(a=>N_(a,t)):Ye(r)&&N_(r,t)?0:-1}const J0=t=>t[0]==="_"||t==="$stable",Am=t=>Ge(t)?t.map(Sn):[Sn(t)],t2=(t,r,a)=>{if(r._n)return r;const h=Kn((...p)=>Am(r(...p)),a);return h._c=!1,h},Q0=(t,r,a)=>{const h=t._ctx;for(const p in t){if(J0(p))continue;const y=t[p];if(Ye(y))r[p]=t2(p,y,h);else if(y!=null){const m=Am(y);r[p]=()=>m}}},tv=(t,r)=>{const a=Am(r);t.slots.default=()=>a},e2=(t,r)=>{if(t.vnode.shapeFlag&32){const a=r._;a?(t.slots=ci(r),md(r,"_",a)):Q0(r,t.slots={})}else t.slots={},r&&tv(t,r);md(t.slots,Gd,1)},i2=(t,r,a)=>{const{vnode:h,slots:p}=t;let y=!0,m=qi;if(h.shapeFlag&32){const l=r._;l?a&&l===1?y=!1:(Us(p,r),!a&&l===1&&delete p._):(y=!r.$stable,Q0(r,p)),m=r}else r&&(tv(t,r),m={default:1});if(y)for(const l in p)!J0(l)&&m[l]==null&&delete p[l]};function qp(t,r,a,h,p=!1){if(Ge(t)){t.forEach((L,K)=>qp(L,r&&(Ge(r)?r[K]:r),a,h,p));return}if(ch(h)&&!p)return;const y=h.shapeFlag&4?Wd(h.component)||h.component.proxy:h.el,m=p?null:y,{i:l,r:T}=t,I=r&&r.r,k=l.refs===qi?l.refs={}:l.refs,P=l.setupState;if(I!=null&&I!==T&&(Ss(I)?(k[I]=null,di(P,I)&&(P[I]=null)):ys(I)&&(I.value=null)),Ye(T))Da(T,l,12,[m,k]);else{const L=Ss(T),K=ys(T);if(L||K){const tt=()=>{if(t.f){const ot=L?di(P,T)?P[T]:k[T]:T.value;p?Ge(ot)&&um(ot,y):Ge(ot)?ot.includes(y)||ot.push(y):L?(k[T]=[y],di(P,T)&&(P[T]=k[T])):(T.value=[y],t.k&&(k[t.k]=T.value))}else L?(k[T]=m,di(P,T)&&(P[T]=m)):K&&(T.value=m,t.k&&(k[t.k]=m))};m?(tt.id=-1,wr(tt,a)):tt()}}}const wr=Iw;function s2(t){return r2(t)}function r2(t,r){const a=l0();a.__VUE__=!0;const{insert:h,remove:p,patchProp:y,createElement:m,createText:l,createComment:T,setText:I,setElementText:k,parentNode:P,nextSibling:L,setScopeId:K=Kr,insertStaticContent:tt}=t,ot=(Q,rt,Mt,Ft=null,it=null,Jt=null,le=void 0,Ct=null,Ht=!!rt.dynamicChildren)=>{if(Q===rt)return;Q&&!Kc(Q,rt)&&(Ft=Rt(Q),hi(Q,it,Jt,!0),Q=null),rt.patchFlag===-2&&(Ht=!1,rt.dynamicChildren=null);const{type:jt,ref:fe,shapeFlag:Ae}=rt;switch(jt){case jd:vt(Q,rt,Mt,Ft);break;case za:yt(Q,rt,Mt,Ft);break;case ad:Q==null&&At(rt,Mt,Ft,le);break;case ns:de(Q,rt,Mt,Ft,it,Jt,le,Ct,Ht);break;default:Ae&1?$t(Q,rt,Mt,Ft,it,Jt,le,Ct,Ht):Ae&6?De(Q,rt,Mt,Ft,it,Jt,le,Ct,Ht):(Ae&64||Ae&128)&&jt.process(Q,rt,Mt,Ft,it,Jt,le,Ct,Ht,ye)}fe!=null&&it&&qp(fe,Q&&Q.ref,Jt,rt||Q,!rt)},vt=(Q,rt,Mt,Ft)=>{if(Q==null)h(rt.el=l(rt.children),Mt,Ft);else{const it=rt.el=Q.el;rt.children!==Q.children&&I(it,rt.children)}},yt=(Q,rt,Mt,Ft)=>{Q==null?h(rt.el=T(rt.children||""),Mt,Ft):rt.el=Q.el},At=(Q,rt,Mt,Ft)=>{[Q.el,Q.anchor]=tt(Q.children,rt,Mt,Ft,Q.el,Q.anchor)},ht=({el:Q,anchor:rt},Mt,Ft)=>{let it;for(;Q&&Q!==rt;)it=L(Q),h(Q,Mt,Ft),Q=it;h(rt,Mt,Ft)},Tt=({el:Q,anchor:rt})=>{let Mt;for(;Q&&Q!==rt;)Mt=L(Q),p(Q),Q=Mt;p(rt)},$t=(Q,rt,Mt,Ft,it,Jt,le,Ct,Ht)=>{rt.type==="svg"?le="svg":rt.type==="math"&&(le="mathml"),Q==null?qt(rt,Mt,Ft,it,Jt,le,Ct,Ht):Vt(Q,rt,it,Jt,le,Ct,Ht)},qt=(Q,rt,Mt,Ft,it,Jt,le,Ct)=>{let Ht,jt;const{props:fe,shapeFlag:Ae,transition:be,dirs:Pe}=Q;if(Ht=Q.el=m(Q.type,Jt,fe&&fe.is,fe),Ae&8?k(Ht,Q.children):Ae&16&&ne(Q.children,Ht,null,Ft,it,yp(Q,Jt),le,Ct),Pe&&ho(Q,null,Ft,"created"),oe(Ht,Q,Q.scopeId,le,Ft),fe){for(const si in fe)si!=="value"&&!oh(si)&&y(Ht,si,null,fe[si],Jt,Q.children,Ft,it,Ii);"value"in fe&&y(Ht,"value",null,fe.value,Jt),(jt=fe.onVnodeBeforeMount)&&bn(jt,Ft,Q)}Pe&&ho(Q,null,Ft,"beforeMount");const Ke=n2(it,be);Ke&&be.beforeEnter(Ht),h(Ht,rt,Mt),((jt=fe&&fe.onVnodeMounted)||Ke||Pe)&&wr(()=>{jt&&bn(jt,Ft,Q),Ke&&be.enter(Ht),Pe&&ho(Q,null,Ft,"mounted")},it)},oe=(Q,rt,Mt,Ft,it)=>{if(Mt&&K(Q,Mt),Ft)for(let Jt=0;Jt<Ft.length;Jt++)K(Q,Ft[Jt]);if(it){let Jt=it.subTree;if(rt===Jt){const le=it.vnode;oe(Q,le,le.scopeId,le.slotScopeIds,it.parent)}}},ne=(Q,rt,Mt,Ft,it,Jt,le,Ct,Ht=0)=>{for(let jt=Ht;jt<Q.length;jt++){const fe=Q[jt]=Ct?Ea(Q[jt]):Sn(Q[jt]);ot(null,fe,rt,Mt,Ft,it,Jt,le,Ct)}},Vt=(Q,rt,Mt,Ft,it,Jt,le)=>{const Ct=rt.el=Q.el;let{patchFlag:Ht,dynamicChildren:jt,dirs:fe}=rt;Ht|=Q.patchFlag&16;const Ae=Q.props||qi,be=rt.props||qi;let Pe;if(Mt&&uo(Mt,!1),(Pe=be.onVnodeBeforeUpdate)&&bn(Pe,Mt,rt,Q),fe&&ho(rt,Q,Mt,"beforeUpdate"),Mt&&uo(Mt,!0),jt?Gt(Q.dynamicChildren,jt,Ct,Mt,Ft,yp(rt,it),Jt):le||ii(Q,rt,Ct,null,Mt,Ft,yp(rt,it),Jt,!1),Ht>0){if(Ht&16)Dt(Ct,rt,Ae,be,Mt,Ft,it);else if(Ht&2&&Ae.class!==be.class&&y(Ct,"class",null,be.class,it),Ht&4&&y(Ct,"style",Ae.style,be.style,it),Ht&8){const Ke=rt.dynamicProps;for(let si=0;si<Ke.length;si++){const zt=Ke[si],_i=Ae[zt],Pi=be[zt];(Pi!==_i||zt==="value")&&y(Ct,zt,_i,Pi,it,Q.children,Mt,Ft,Ii)}}Ht&1&&Q.children!==rt.children&&k(Ct,rt.children)}else!le&&jt==null&&Dt(Ct,rt,Ae,be,Mt,Ft,it);((Pe=be.onVnodeUpdated)||fe)&&wr(()=>{Pe&&bn(Pe,Mt,rt,Q),fe&&ho(rt,Q,Mt,"updated")},Ft)},Gt=(Q,rt,Mt,Ft,it,Jt,le)=>{for(let Ct=0;Ct<rt.length;Ct++){const Ht=Q[Ct],jt=rt[Ct],fe=Ht.el&&(Ht.type===ns||!Kc(Ht,jt)||Ht.shapeFlag&70)?P(Ht.el):Mt;ot(Ht,jt,fe,null,Ft,it,Jt,le,!0)}},Dt=(Q,rt,Mt,Ft,it,Jt,le)=>{if(Mt!==Ft){if(Mt!==qi)for(const Ct in Mt)!oh(Ct)&&!(Ct in Ft)&&y(Q,Ct,Mt[Ct],null,le,rt.children,it,Jt,Ii);for(const Ct in Ft){if(oh(Ct))continue;const Ht=Ft[Ct],jt=Mt[Ct];Ht!==jt&&Ct!=="value"&&y(Q,Ct,jt,Ht,le,rt.children,it,Jt,Ii)}"value"in Ft&&y(Q,"value",Mt.value,Ft.value,le)}},de=(Q,rt,Mt,Ft,it,Jt,le,Ct,Ht)=>{const jt=rt.el=Q?Q.el:l(""),fe=rt.anchor=Q?Q.anchor:l("");let{patchFlag:Ae,dynamicChildren:be,slotScopeIds:Pe}=rt;Pe&&(Ct=Ct?Ct.concat(Pe):Pe),Q==null?(h(jt,Mt,Ft),h(fe,Mt,Ft),ne(rt.children||[],Mt,fe,it,Jt,le,Ct,Ht)):Ae>0&&Ae&64&&be&&Q.dynamicChildren?(Gt(Q.dynamicChildren,be,Mt,it,Jt,le,Ct),(rt.key!=null||it&&rt===it.subTree)&&ev(Q,rt,!0)):ii(Q,rt,Mt,fe,it,Jt,le,Ct,Ht)},De=(Q,rt,Mt,Ft,it,Jt,le,Ct,Ht)=>{rt.slotScopeIds=Ct,Q==null?rt.shapeFlag&512?it.ctx.activate(rt,Mt,Ft,le,Ht):ke(rt,Mt,Ft,it,Jt,le,Ht):gi(Q,rt,Ht)},ke=(Q,rt,Mt,Ft,it,Jt,le)=>{const Ct=Q.component=m2(Q,Ft,it);if(q0(Q)&&(Ct.ctx.renderer=ye),g2(Ct),Ct.asyncDep){if(it&&it.registerDep(Ct,Re),!Q.el){const Ht=Ct.subTree=Zi(za);yt(null,Ht,rt,Mt)}}else Re(Ct,Q,rt,Mt,it,Jt,le)},gi=(Q,rt,Mt)=>{const Ft=rt.component=Q.component;if(Mw(Q,rt,Mt))if(Ft.asyncDep&&!Ft.asyncResolved){Le(Ft,rt,Mt);return}else Ft.next=rt,_w(Ft.update),Ft.effect.dirty=!0,Ft.update();else rt.el=Q.el,Ft.vnode=rt},Re=(Q,rt,Mt,Ft,it,Jt,le)=>{const Ct=()=>{if(Q.isMounted){let{next:fe,bu:Ae,u:be,parent:Pe,vnode:Ke}=Q;{const pr=iv(Q);if(pr){fe&&(fe.el=Ke.el,Le(Q,fe,le)),pr.asyncDep.then(()=>{Q.isUnmounted||Ct()});return}}let si=fe,zt;uo(Q,!1),fe?(fe.el=Ke.el,Le(Q,fe,le)):fe=Ke,Ae&&rd(Ae),(zt=fe.props&&fe.props.onVnodeBeforeUpdate)&&bn(zt,Pe,fe,Ke),uo(Q,!0);const _i=gp(Q),Pi=Q.subTree;Q.subTree=_i,ot(Pi,_i,P(Pi.el),Rt(Pi),Q,it,Jt),fe.el=_i.el,si===null&&Sw(Q,_i.el),be&&wr(be,it),(zt=fe.props&&fe.props.onVnodeUpdated)&&wr(()=>bn(zt,Pe,fe,Ke),it)}else{let fe;const{el:Ae,props:be}=rt,{bm:Pe,m:Ke,parent:si}=Q,zt=ch(rt);if(uo(Q,!1),Pe&&rd(Pe),!zt&&(fe=be&&be.onVnodeBeforeMount)&&bn(fe,si,rt),uo(Q,!0),Ae&&ai){const _i=()=>{Q.subTree=gp(Q),ai(Ae,Q.subTree,Q,it,null)};zt?rt.type.__asyncLoader().then(()=>!Q.isUnmounted&&_i()):_i()}else{const _i=Q.subTree=gp(Q);ot(null,_i,Mt,Ft,Q,it,Jt),rt.el=_i.el}if(Ke&&wr(Ke,it),!zt&&(fe=be&&be.onVnodeMounted)){const _i=rt;wr(()=>bn(fe,si,_i),it)}(rt.shapeFlag&256||si&&ch(si.vnode)&&si.vnode.shapeFlag&256)&&Q.a&&wr(Q.a,it),Q.isMounted=!0,rt=Mt=Ft=null}},Ht=Q.effect=new pm(Ct,Kr,()=>Mm(jt),Q.scope),jt=Q.update=()=>{Ht.dirty&&Ht.run()};jt.id=Q.uid,uo(Q,!0),jt()},Le=(Q,rt,Mt)=>{rt.component=Q;const Ft=Q.vnode.props;Q.vnode=rt,Q.next=null,Qw(Q,rt.props,Ft,Mt),i2(Q,rt.children,Mt),Mo(),C_(Q),So()},ii=(Q,rt,Mt,Ft,it,Jt,le,Ct,Ht=!1)=>{const jt=Q&&Q.children,fe=Q?Q.shapeFlag:0,Ae=rt.children,{patchFlag:be,shapeFlag:Pe}=rt;if(be>0){if(be&128){Ds(jt,Ae,Mt,Ft,it,Jt,le,Ct,Ht);return}else if(be&256){xs(jt,Ae,Mt,Ft,it,Jt,le,Ct,Ht);return}}Pe&8?(fe&16&&Ii(jt,it,Jt),Ae!==jt&&k(Mt,Ae)):fe&16?Pe&16?Ds(jt,Ae,Mt,Ft,it,Jt,le,Ct,Ht):Ii(jt,it,Jt,!0):(fe&8&&k(Mt,""),Pe&16&&ne(Ae,Mt,Ft,it,Jt,le,Ct,Ht))},xs=(Q,rt,Mt,Ft,it,Jt,le,Ct,Ht)=>{Q=Q||kl,rt=rt||kl;const jt=Q.length,fe=rt.length,Ae=Math.min(jt,fe);let be;for(be=0;be<Ae;be++){const Pe=rt[be]=Ht?Ea(rt[be]):Sn(rt[be]);ot(Q[be],Pe,Mt,null,it,Jt,le,Ct,Ht)}jt>fe?Ii(Q,it,Jt,!0,!1,Ae):ne(rt,Mt,Ft,it,Jt,le,Ct,Ht,Ae)},Ds=(Q,rt,Mt,Ft,it,Jt,le,Ct,Ht)=>{let jt=0;const fe=rt.length;let Ae=Q.length-1,be=fe-1;for(;jt<=Ae&&jt<=be;){const Pe=Q[jt],Ke=rt[jt]=Ht?Ea(rt[jt]):Sn(rt[jt]);if(Kc(Pe,Ke))ot(Pe,Ke,Mt,null,it,Jt,le,Ct,Ht);else break;jt++}for(;jt<=Ae&&jt<=be;){const Pe=Q[Ae],Ke=rt[be]=Ht?Ea(rt[be]):Sn(rt[be]);if(Kc(Pe,Ke))ot(Pe,Ke,Mt,null,it,Jt,le,Ct,Ht);else break;Ae--,be--}if(jt>Ae){if(jt<=be){const Pe=be+1,Ke=Pe<fe?rt[Pe].el:Ft;for(;jt<=be;)ot(null,rt[jt]=Ht?Ea(rt[jt]):Sn(rt[jt]),Mt,Ke,it,Jt,le,Ct,Ht),jt++}}else if(jt>be)for(;jt<=Ae;)hi(Q[jt],it,Jt,!0),jt++;else{const Pe=jt,Ke=jt,si=new Map;for(jt=Ke;jt<=be;jt++){const Me=rt[jt]=Ht?Ea(rt[jt]):Sn(rt[jt]);Me.key!=null&&si.set(Me.key,jt)}let zt,_i=0;const Pi=be-Ke+1;let pr=!1,as=0;const Zt=new Array(Pi);for(jt=0;jt<Pi;jt++)Zt[jt]=0;for(jt=Pe;jt<=Ae;jt++){const Me=Q[jt];if(_i>=Pi){hi(Me,it,Jt,!0);continue}let ui;if(Me.key!=null)ui=si.get(Me.key);else for(zt=Ke;zt<=be;zt++)if(Zt[zt-Ke]===0&&Kc(Me,rt[zt])){ui=zt;break}ui===void 0?hi(Me,it,Jt,!0):(Zt[ui-Ke]=jt+1,ui>=as?as=ui:pr=!0,ot(Me,rt[ui],Mt,null,it,Jt,le,Ct,Ht),_i++)}const Oe=pr?a2(Zt):kl;for(zt=Oe.length-1,jt=Pi-1;jt>=0;jt--){const Me=Ke+jt,ui=rt[Me],tr=Me+1<fe?rt[Me+1].el:Ft;Zt[jt]===0?ot(null,ui,Mt,tr,it,Jt,le,Ct,Ht):pr&&(zt<0||jt!==Oe[zt]?Ei(ui,Mt,tr,2):zt--)}}},Ei=(Q,rt,Mt,Ft,it=null)=>{const{el:Jt,type:le,transition:Ct,children:Ht,shapeFlag:jt}=Q;if(jt&6){Ei(Q.component.subTree,rt,Mt,Ft);return}if(jt&128){Q.suspense.move(rt,Mt,Ft);return}if(jt&64){le.move(Q,rt,Mt,ye);return}if(le===ns){h(Jt,rt,Mt);for(let Ae=0;Ae<Ht.length;Ae++)Ei(Ht[Ae],rt,Mt,Ft);h(Q.anchor,rt,Mt);return}if(le===ad){ht(Q,rt,Mt);return}if(Ft!==2&&jt&1&&Ct)if(Ft===0)Ct.beforeEnter(Jt),h(Jt,rt,Mt),wr(()=>Ct.enter(Jt),it);else{const{leave:Ae,delayLeave:be,afterLeave:Pe}=Ct,Ke=()=>h(Jt,rt,Mt),si=()=>{Ae(Jt,()=>{Ke(),Pe&&Pe()})};be?be(Jt,Ke,si):si()}else h(Jt,rt,Mt)},hi=(Q,rt,Mt,Ft=!1,it=!1)=>{const{type:Jt,props:le,ref:Ct,children:Ht,dynamicChildren:jt,shapeFlag:fe,patchFlag:Ae,dirs:be}=Q;if(Ct!=null&&qp(Ct,null,Mt,Q,!0),fe&256){rt.ctx.deactivate(Q);return}const Pe=fe&1&&be,Ke=!ch(Q);let si;if(Ke&&(si=le&&le.onVnodeBeforeUnmount)&&bn(si,rt,Q),fe&6)As(Q.component,Mt,Ft);else{if(fe&128){Q.suspense.unmount(Mt,Ft);return}Pe&&ho(Q,null,rt,"beforeUnmount"),fe&64?Q.type.remove(Q,rt,Mt,it,ye,Ft):jt&&(Jt!==ns||Ae>0&&Ae&64)?Ii(jt,rt,Mt,!1,!0):(Jt===ns&&Ae&384||!it&&fe&16)&&Ii(Ht,rt,Mt),Ft&&bs(Q)}(Ke&&(si=le&&le.onVnodeUnmounted)||Pe)&&wr(()=>{si&&bn(si,rt,Q),Pe&&ho(Q,null,rt,"unmounted")},Mt)},bs=Q=>{const{type:rt,el:Mt,anchor:Ft,transition:it}=Q;if(rt===ns){fr(Mt,Ft);return}if(rt===ad){Tt(Q);return}const Jt=()=>{p(Mt),it&&!it.persisted&&it.afterLeave&&it.afterLeave()};if(Q.shapeFlag&1&&it&&!it.persisted){const{leave:le,delayLeave:Ct}=it,Ht=()=>le(Mt,Jt);Ct?Ct(Q.el,Jt,Ht):Ht()}else Jt()},fr=(Q,rt)=>{let Mt;for(;Q!==rt;)Mt=L(Q),p(Q),Q=Mt;p(rt)},As=(Q,rt,Mt)=>{const{bum:Ft,scope:it,update:Jt,subTree:le,um:Ct}=Q;Ft&&rd(Ft),it.stop(),Jt&&(Jt.active=!1,hi(le,Q,rt,Mt)),Ct&&wr(Ct,rt),wr(()=>{Q.isUnmounted=!0},rt),rt&&rt.pendingBranch&&!rt.isUnmounted&&Q.asyncDep&&!Q.asyncResolved&&Q.suspenseId===rt.pendingId&&(rt.deps--,rt.deps===0&&rt.resolve())},Ii=(Q,rt,Mt,Ft=!1,it=!1,Jt=0)=>{for(let le=Jt;le<Q.length;le++)hi(Q[le],rt,Mt,Ft,it)},Rt=Q=>Q.shapeFlag&6?Rt(Q.component.subTree):Q.shapeFlag&128?Q.suspense.next():L(Q.anchor||Q.el);let ce=!1;const ae=(Q,rt,Mt)=>{Q==null?rt._vnode&&hi(rt._vnode,null,null,!0):ot(rt._vnode||null,Q,rt,null,null,null,Mt),ce||(ce=!0,C_(),L0(),ce=!1),rt._vnode=Q},ye={p:ot,um:hi,m:Ei,r:bs,mt:ke,mc:ne,pc:ii,pbc:Gt,n:Rt,o:t};let ni,ai;return r&&([ni,ai]=r(ye)),{render:ae,hydrate:ni,createApp:Xw(ae,ni)}}function yp({type:t,props:r},a){return a==="svg"&&t==="foreignObject"||a==="mathml"&&t==="annotation-xml"&&r&&r.encoding&&r.encoding.includes("html")?void 0:a}function uo({effect:t,update:r},a){t.allowRecurse=r.allowRecurse=a}function n2(t,r){return(!t||t&&!t.pendingBranch)&&r&&!r.persisted}function ev(t,r,a=!1){const h=t.children,p=r.children;if(Ge(h)&&Ge(p))for(let y=0;y<h.length;y++){const m=h[y];let l=p[y];l.shapeFlag&1&&!l.dynamicChildren&&((l.patchFlag<=0||l.patchFlag===32)&&(l=p[y]=Ea(p[y]),l.el=m.el),a||ev(m,l)),l.type===jd&&(l.el=m.el)}}function a2(t){const r=t.slice(),a=[0];let h,p,y,m,l;const T=t.length;for(h=0;h<T;h++){const I=t[h];if(I!==0){if(p=a[a.length-1],t[p]<I){r[h]=p,a.push(h);continue}for(y=0,m=a.length-1;y<m;)l=y+m>>1,t[a[l]]<I?y=l+1:m=l;I<t[a[y]]&&(y>0&&(r[h]=a[y-1]),a[y]=h)}}for(y=a.length,m=a[y-1];y-- >0;)a[y]=m,m=r[m];return a}function iv(t){const r=t.subTree.component;if(r)return r.asyncDep&&!r.asyncResolved?r:iv(r)}const o2=t=>t.__isTeleport,ns=Symbol.for("v-fgt"),jd=Symbol.for("v-txt"),za=Symbol.for("v-cmt"),ad=Symbol.for("v-stc"),uh=[];let rn=null;function Ie(t=!1){uh.push(rn=t?null:[])}function l2(){uh.pop(),rn=uh[uh.length-1]||null}let Mh=1;function V_(t){Mh+=t}function sv(t){return t.dynamicChildren=Mh>0?rn||kl:null,l2(),Mh>0&&rn&&rn.push(t),t}function je(t,r,a,h,p,y){return sv(ct(t,r,a,h,p,y,!0))}function Mn(t,r,a,h,p){return sv(Zi(t,r,a,h,p,!0))}function xd(t){return t?t.__v_isVNode===!0:!1}function Kc(t,r){return t.type===r.type&&t.key===r.key}const Gd="__vInternal",rv=({key:t})=>t??null,od=({ref:t,ref_key:r,ref_for:a})=>(typeof t=="number"&&(t=""+t),t!=null?Ss(t)||ys(t)||Ye(t)?{i:Ms,r:t,k:r,f:!!a}:t:null);function ct(t,r=null,a=null,h=0,p=null,y=t===ns?0:1,m=!1,l=!1){const T={__v_isVNode:!0,__v_skip:!0,type:t,props:r,key:r&&rv(r),ref:r&&od(r),scopeId:$d,slotScopeIds:null,children:a,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:y,patchFlag:h,dynamicProps:p,dynamicChildren:null,appContext:null,ctx:Ms};return l?(Em(T,a),y&128&&t.normalize(T)):a&&(T.shapeFlag|=Ss(a)?8:16),Mh>0&&!m&&rn&&(T.patchFlag>0||y&6)&&T.patchFlag!==32&&rn.push(T),T}const Zi=c2;function c2(t,r=null,a=null,h=0,p=null,y=!1){if((!t||t===Tw)&&(t=za),xd(t)){const l=$l(t,r,!0);return a&&Em(l,a),Mh>0&&!y&&rn&&(l.shapeFlag&6?rn[rn.indexOf(t)]=l:rn.push(l)),l.patchFlag|=-2,l}if(b2(t)&&(t=t.__vccOpts),r){r=h2(r);let{class:l,style:T}=r;l&&!Ss(l)&&(r.class=_o(l)),Gi(T)&&(E0(T)&&!Ge(T)&&(T=Us({},T)),r.style=fm(T))}const m=Ss(t)?1:Ew(t)?128:o2(t)?64:Gi(t)?4:Ye(t)?2:0;return ct(t,r,a,h,p,m,y,!0)}function h2(t){return t?E0(t)||Gd in t?Us({},t):t:null}function $l(t,r,a=!1){const{props:h,ref:p,patchFlag:y,children:m}=t,l=r?d2(h||{},r):h;return{__v_isVNode:!0,__v_skip:!0,type:t.type,props:l,key:l&&rv(l),ref:r&&r.ref?a&&p?Ge(p)?p.concat(od(r)):[p,od(r)]:od(r):p,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:m,target:t.target,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:r&&t.type!==ns?y===-1?16:y|16:y,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:t.transition,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&$l(t.ssContent),ssFallback:t.ssFallback&&$l(t.ssFallback),el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce}}function nv(t=" ",r=0){return Zi(jd,null,t,r)}function u2(t,r){const a=Zi(ad,null,t);return a.staticCount=r,a}function Wi(t="",r=!1){return r?(Ie(),Mn(za,null,t)):Zi(za,null,t)}function Sn(t){return t==null||typeof t=="boolean"?Zi(za):Ge(t)?Zi(ns,null,t.slice()):typeof t=="object"?Ea(t):Zi(jd,null,String(t))}function Ea(t){return t.el===null&&t.patchFlag!==-1||t.memo?t:$l(t)}function Em(t,r){let a=0;const{shapeFlag:h}=t;if(r==null)r=null;else if(Ge(r))a=16;else if(typeof r=="object")if(h&65){const p=r.default;p&&(p._c&&(p._d=!1),Em(t,p()),p._c&&(p._d=!0));return}else{a=32;const p=r._;!p&&!(Gd in r)?r._ctx=Ms:p===3&&Ms&&(Ms.slots._===1?r._=1:(r._=2,t.patchFlag|=1024))}else Ye(r)?(r={default:r,_ctx:Ms},a=32):(r=String(r),h&64?(a=16,r=[nv(r)]):a=8);t.children=r,t.shapeFlag|=a}function d2(...t){const r={};for(let a=0;a<t.length;a++){const h=t[a];for(const p in h)if(p==="class")r.class!==h.class&&(r.class=_o([r.class,h.class]));else if(p==="style")r.style=fm([r.style,h.style]);else if(kd(p)){const y=r[p],m=h[p];m&&y!==m&&!(Ge(y)&&y.includes(m))&&(r[p]=y?[].concat(y,m):m)}else p!==""&&(r[p]=h[p])}return r}function bn(t,r,a,h=null){nn(t,r,7,[a,h])}const f2=K0();let p2=0;function m2(t,r,a){const h=t.type,p=(r?r.appContext:t.appContext)||f2,y={uid:p2++,vnode:t,type:h,parent:r,appContext:p,root:null,next:null,subTree:null,effect:null,update:null,scope:new u0(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:r?r.provides:Object.create(p.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Y0(h,p),emitsOptions:F0(h,p),emit:null,emitted:null,propsDefaults:qi,inheritAttrs:h.inheritAttrs,ctx:qi,data:qi,props:qi,attrs:qi,slots:qi,refs:qi,setupState:qi,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:a,suspenseId:a?a.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return y.ctx={_:y},y.root=r?r.root:y,y.emit=xw.bind(null,y),t.ce&&t.ce(y),y}let $s=null,bd,jp;{const t=l0(),r=(a,h)=>{let p;return(p=t[a])||(p=t[a]=[]),p.push(h),y=>{p.length>1?p.forEach(m=>m(y)):p[0](y)}};bd=r("__VUE_INSTANCE_SETTERS__",a=>$s=a),jp=r("__VUE_SSR_SETTERS__",a=>Hd=a)}const kh=t=>{const r=$s;return bd(t),t.scope.on(),()=>{t.scope.off(),bd(r)}},U_=()=>{$s&&$s.scope.off(),bd(null)};function av(t){return t.vnode.shapeFlag&4}let Hd=!1;function g2(t,r=!1){r&&jp(r);const{props:a,children:h}=t.vnode,p=av(t);Jw(t,a,p,r),e2(t,h);const y=p?_2(t,r):void 0;return r&&jp(!1),y}function _2(t,r){const a=t.type;t.accessCache=Object.create(null),t.proxy=Fd(new Proxy(t.ctx,qw));const{setup:h}=a;if(h){const p=t.setupContext=h.length>1?v2(t):null,y=kh(t);Mo();const m=Da(h,t,0,[t.props,p]);if(So(),y(),n0(m)){if(m.then(U_,U_),r)return m.then(l=>{q_(t,l,r)}).catch(l=>{Bd(l,t,0)});t.asyncDep=m}else q_(t,m,r)}else ov(t,r)}function q_(t,r,a){Ye(r)?t.type.__ssrInlineRender?t.ssrRender=r:t.render=r:Gi(r)&&(t.setupState=D0(r)),ov(t,a)}let j_;function ov(t,r,a){const h=t.type;if(!t.render){if(!r&&j_&&!h.render){const p=h.template||Tm(t).template;if(p){const{isCustomElement:y,compilerOptions:m}=t.appContext.config,{delimiters:l,compilerOptions:T}=h,I=Us(Us({isCustomElement:y,delimiters:l},m),T);h.render=j_(p,I)}}t.render=h.render||Kr}{const p=kh(t);Mo();try{jw(t)}finally{So(),p()}}}function y2(t){return t.attrsProxy||(t.attrsProxy=new Proxy(t.attrs,{get(r,a){return Tr(t,"get","$attrs"),r[a]}}))}function v2(t){const r=a=>{t.exposed=a||{}};return{get attrs(){return y2(t)},slots:t.slots,emit:t.emit,expose:r}}function Wd(t){if(t.exposed)return t.exposeProxy||(t.exposeProxy=new Proxy(D0(Fd(t.exposed)),{get(r,a){if(a in r)return r[a];if(a in hh)return hh[a](t)},has(r,a){return a in r||a in hh}}))}function x2(t,r=!0){return Ye(t)?t.displayName||t.name:t.name||r&&t.__name}function b2(t){return Ye(t)&&"__vccOpts"in t}const ji=(t,r)=>ow(t,r,Hd);function lv(t,r,a){const h=arguments.length;return h===2?Gi(r)&&!Ge(r)?xd(r)?Zi(t,null,[r]):Zi(t,r):Zi(t,null,r):(h>3?a=Array.prototype.slice.call(arguments,2):h===3&&xd(a)&&(a=[a]),Zi(t,r,a))}const w2="3.4.21";/**
* @vue/runtime-dom v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const M2="http://www.w3.org/2000/svg",S2="http://www.w3.org/1998/Math/MathML",Ia=typeof document<"u"?document:null,G_=Ia&&Ia.createElement("template"),T2={insert:(t,r,a)=>{r.insertBefore(t,a||null)},remove:t=>{const r=t.parentNode;r&&r.removeChild(t)},createElement:(t,r,a,h)=>{const p=r==="svg"?Ia.createElementNS(M2,t):r==="mathml"?Ia.createElementNS(S2,t):Ia.createElement(t,a?{is:a}:void 0);return t==="select"&&h&&h.multiple!=null&&p.setAttribute("multiple",h.multiple),p},createText:t=>Ia.createTextNode(t),createComment:t=>Ia.createComment(t),setText:(t,r)=>{t.nodeValue=r},setElementText:(t,r)=>{t.textContent=r},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>Ia.querySelector(t),setScopeId(t,r){t.setAttribute(r,"")},insertStaticContent(t,r,a,h,p,y){const m=a?a.previousSibling:r.lastChild;if(p&&(p===y||p.nextSibling))for(;r.insertBefore(p.cloneNode(!0),a),!(p===y||!(p=p.nextSibling)););else{G_.innerHTML=h==="svg"?`<svg>${t}</svg>`:h==="mathml"?`<math>${t}</math>`:t;const l=G_.content;if(h==="svg"||h==="mathml"){const T=l.firstChild;for(;T.firstChild;)l.appendChild(T.firstChild);l.removeChild(T)}r.insertBefore(l,a)}return[m?m.nextSibling:r.firstChild,a?a.previousSibling:r.lastChild]}},A2=Symbol("_vtc");function E2(t,r,a){const h=t[A2];h&&(r=(r?[r,...h]:[...h]).join(" ")),r==null?t.removeAttribute("class"):a?t.setAttribute("class",r):t.className=r}const wd=Symbol("_vod"),cv=Symbol("_vsh"),I2={beforeMount(t,{value:r},{transition:a}){t[wd]=t.style.display==="none"?"":t.style.display,a&&r?a.beforeEnter(t):Xc(t,r)},mounted(t,{value:r},{transition:a}){a&&r&&a.enter(t)},updated(t,{value:r,oldValue:a},{transition:h}){!r!=!a&&(h?r?(h.beforeEnter(t),Xc(t,!0),h.enter(t)):h.leave(t,()=>{Xc(t,!1)}):Xc(t,r))},beforeUnmount(t,{value:r}){Xc(t,r)}};function Xc(t,r){t.style.display=r?t[wd]:"none",t[cv]=!r}const P2=Symbol(""),C2=/(^|;)\s*display\s*:/;function D2(t,r,a){const h=t.style,p=Ss(a);let y=!1;if(a&&!p){if(r)if(Ss(r))for(const m of r.split(";")){const l=m.slice(0,m.indexOf(":")).trim();a[l]==null&&ld(h,l,"")}else for(const m in r)a[m]==null&&ld(h,m,"");for(const m in a)m==="display"&&(y=!0),ld(h,m,a[m])}else if(p){if(r!==a){const m=h[P2];m&&(a+=";"+m),h.cssText=a,y=C2.test(a)}}else r&&t.removeAttribute("style");wd in t&&(t[wd]=y?h.display:"",t[cv]&&(h.display="none"))}const H_=/\s*!important$/;function ld(t,r,a){if(Ge(a))a.forEach(h=>ld(t,r,h));else if(a==null&&(a=""),r.startsWith("--"))t.setProperty(r,a);else{const h=k2(t,r);H_.test(a)?t.setProperty(wo(h),a.replace(H_,""),"important"):t[h]=a}}const W_=["Webkit","Moz","ms"],vp={};function k2(t,r){const a=vp[r];if(a)return a;let h=Cn(r);if(h!=="filter"&&h in t)return vp[r]=h;h=Ld(h);for(let p=0;p<W_.length;p++){const y=W_[p]+h;if(y in t)return vp[r]=y}return r}const Z_="http://www.w3.org/1999/xlink";function R2(t,r,a,h,p){if(h&&r.startsWith("xlink:"))a==null?t.removeAttributeNS(Z_,r.slice(6,r.length)):t.setAttributeNS(Z_,r,a);else{const y=Bb(r);a==null||y&&!c0(a)?t.removeAttribute(r):t.setAttribute(r,y?"":a)}}function z2(t,r,a,h,p,y,m){if(r==="innerHTML"||r==="textContent"){h&&m(h,p,y),t[r]=a??"";return}const l=t.tagName;if(r==="value"&&l!=="PROGRESS"&&!l.includes("-")){const I=l==="OPTION"?t.getAttribute("value")||"":t.value,k=a??"";(I!==k||!("_value"in t))&&(t.value=k),a==null&&t.removeAttribute(r),t._value=a;return}let T=!1;if(a===""||a==null){const I=typeof t[r];I==="boolean"?a=c0(a):a==null&&I==="string"?(a="",T=!0):I==="number"&&(a=0,T=!0)}try{t[r]=a}catch{}T&&t.removeAttribute(r)}function Sl(t,r,a,h){t.addEventListener(r,a,h)}function L2(t,r,a,h){t.removeEventListener(r,a,h)}const K_=Symbol("_vei");function O2(t,r,a,h,p=null){const y=t[K_]||(t[K_]={}),m=y[r];if(h&&m)m.value=h;else{const[l,T]=F2(r);if(h){const I=y[r]=$2(h,p);Sl(t,l,I,T)}else m&&(L2(t,l,m,T),y[r]=void 0)}}const X_=/(?:Once|Passive|Capture)$/;function F2(t){let r;if(X_.test(t)){r={};let h;for(;h=t.match(X_);)t=t.slice(0,t.length-h[0].length),r[h[0].toLowerCase()]=!0}return[t[2]===":"?t.slice(3):wo(t.slice(2)),r]}let xp=0;const B2=Promise.resolve(),N2=()=>xp||(B2.then(()=>xp=0),xp=Date.now());function $2(t,r){const a=h=>{if(!h._vts)h._vts=Date.now();else if(h._vts<=a.attached)return;nn(V2(h,a.value),r,5,[h])};return a.value=t,a.attached=N2(),a}function V2(t,r){if(Ge(r)){const a=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{a.call(t),t._stopped=!0},r.map(h=>p=>!p._stopped&&h&&h(p))}else return r}const Y_=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&t.charCodeAt(2)>96&&t.charCodeAt(2)<123,U2=(t,r,a,h,p,y,m,l,T)=>{const I=p==="svg";r==="class"?E2(t,h,I):r==="style"?D2(t,a,h):kd(r)?hm(r)||O2(t,r,a,h,m):(r[0]==="."?(r=r.slice(1),!0):r[0]==="^"?(r=r.slice(1),!1):q2(t,r,h,I))?z2(t,r,h,y,m,l,T):(r==="true-value"?t._trueValue=h:r==="false-value"&&(t._falseValue=h),R2(t,r,h,I))};function q2(t,r,a,h){if(h)return!!(r==="innerHTML"||r==="textContent"||r in t&&Y_(r)&&Ye(a));if(r==="spellcheck"||r==="draggable"||r==="translate"||r==="form"||r==="list"&&t.tagName==="INPUT"||r==="type"&&t.tagName==="TEXTAREA")return!1;if(r==="width"||r==="height"){const p=t.tagName;if(p==="IMG"||p==="VIDEO"||p==="CANVAS"||p==="SOURCE")return!1}return Y_(r)&&Ss(a)?!1:r in t}const J_=t=>{const r=t.props["onUpdate:modelValue"]||!1;return Ge(r)?a=>rd(r,a):r};function j2(t){t.target.composing=!0}function Q_(t){const r=t.target;r.composing&&(r.composing=!1,r.dispatchEvent(new Event("input")))}const bp=Symbol("_assign"),G2={created(t,{modifiers:{lazy:r,trim:a,number:h}},p){t[bp]=J_(p);const y=h||p.props&&p.props.type==="number";Sl(t,r?"change":"input",m=>{if(m.target.composing)return;let l=t.value;a&&(l=l.trim()),y&&(l=zp(l)),t[bp](l)}),a&&Sl(t,"change",()=>{t.value=t.value.trim()}),r||(Sl(t,"compositionstart",j2),Sl(t,"compositionend",Q_),Sl(t,"change",Q_))},mounted(t,{value:r}){t.value=r??""},beforeUpdate(t,{value:r,modifiers:{lazy:a,trim:h,number:p}},y){if(t[bp]=J_(y),t.composing)return;const m=p||t.type==="number"?zp(t.value):t.value,l=r??"";m!==l&&(document.activeElement===t&&t.type!=="range"&&(a||h&&t.value.trim()===l)||(t.value=l))}},H2={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},W2=(t,r)=>{const a=t._withKeys||(t._withKeys={}),h=r.join(".");return a[h]||(a[h]=p=>{if(!("key"in p))return;const y=wo(p.key);if(r.some(m=>m===y||H2[m]===y))return t(p)})},Z2=Us({patchProp:U2},T2);let ty;function K2(){return ty||(ty=s2(Z2))}const X2=(...t)=>{const r=K2().createApp(...t),{mount:a}=r;return r.mount=h=>{const p=J2(h);if(!p)return;const y=r._component;!Ye(y)&&!y.render&&!y.template&&(y.template=p.innerHTML),p.innerHTML="";const m=a(p,!1,Y2(p));return p instanceof Element&&(p.removeAttribute("v-cloak"),p.setAttribute("data-v-app","")),m},r};function Y2(t){if(t instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&t instanceof MathMLElement)return"mathml"}function J2(t){return Ss(t)?document.querySelector(t):t}var Q2=!1;/*!
 * pinia v2.1.7
 * (c) 2023 Eduardo San Martin Morote
 * @license MIT
 */let hv;const Zd=t=>hv=t,uv=Symbol();function Gp(t){return t&&typeof t=="object"&&Object.prototype.toString.call(t)==="[object Object]"&&typeof t.toJSON!="function"}var dh;(function(t){t.direct="direct",t.patchObject="patch object",t.patchFunction="patch function"})(dh||(dh={}));function tM(){const t=d0(!0),r=t.run(()=>Mr({}));let a=[],h=[];const p=Fd({install(y){Zd(p),p._a=y,y.provide(uv,p),y.config.globalProperties.$pinia=p,h.forEach(m=>a.push(m)),h=[]},use(y){return!this._a&&!Q2?h.push(y):a.push(y),this},_p:a,_a:null,_e:t,_s:new Map,state:r});return p}const dv=()=>{};function ey(t,r,a,h=dv){t.push(r);const p=()=>{const y=t.indexOf(r);y>-1&&(t.splice(y,1),h())};return!a&&f0()&&$b(p),p}function wl(t,...r){t.slice().forEach(a=>{a(...r)})}const eM=t=>t();function Hp(t,r){t instanceof Map&&r instanceof Map&&r.forEach((a,h)=>t.set(h,a)),t instanceof Set&&r instanceof Set&&r.forEach(t.add,t);for(const a in r){if(!r.hasOwnProperty(a))continue;const h=r[a],p=t[a];Gp(p)&&Gp(h)&&t.hasOwnProperty(a)&&!ys(h)&&!Yn(h)?t[a]=Hp(p,h):t[a]=h}return t}const iM=Symbol();function sM(t){return!Gp(t)||!t.hasOwnProperty(iM)}const{assign:Ta}=Object;function rM(t){return!!(ys(t)&&t.effect)}function nM(t,r,a,h){const{state:p,actions:y,getters:m}=r,l=a.state.value[t];let T;function I(){l||(a.state.value[t]=p?p():{});const k=uw(a.state.value[t]);return Ta(k,y,Object.keys(m||{}).reduce((P,L)=>(P[L]=Fd(ji(()=>{Zd(a);const K=a._s.get(t);return m[L].call(K,K)})),P),{}))}return T=fv(t,I,r,a,h,!0),T}function fv(t,r,a={},h,p,y){let m;const l=Ta({actions:{}},a),T={deep:!0};let I,k,P=[],L=[],K;const tt=h.state.value[t];!y&&!tt&&(h.state.value[t]={}),Mr({});let ot;function vt(ne){let Vt;I=k=!1,typeof ne=="function"?(ne(h.state.value[t]),Vt={type:dh.patchFunction,storeId:t,events:K}):(Hp(h.state.value[t],ne),Vt={type:dh.patchObject,payload:ne,storeId:t,events:K});const Gt=ot=Symbol();wm().then(()=>{ot===Gt&&(I=!0)}),k=!0,wl(P,Vt,h.state.value[t])}const yt=y?function(){const{state:Vt}=a,Gt=Vt?Vt():{};this.$patch(Dt=>{Ta(Dt,Gt)})}:dv;function At(){m.stop(),P=[],L=[],h._s.delete(t)}function ht(ne,Vt){return function(){Zd(h);const Gt=Array.from(arguments),Dt=[],de=[];function De(Re){Dt.push(Re)}function ke(Re){de.push(Re)}wl(L,{args:Gt,name:ne,store:$t,after:De,onError:ke});let gi;try{gi=Vt.apply(this&&this.$id===t?this:$t,Gt)}catch(Re){throw wl(de,Re),Re}return gi instanceof Promise?gi.then(Re=>(wl(Dt,Re),Re)).catch(Re=>(wl(de,Re),Promise.reject(Re))):(wl(Dt,gi),gi)}}const Tt={_p:h,$id:t,$onAction:ey.bind(null,L),$patch:vt,$reset:yt,$subscribe(ne,Vt={}){const Gt=ey(P,ne,Vt.detached,()=>Dt()),Dt=m.run(()=>lh(()=>h.state.value[t],de=>{(Vt.flush==="sync"?k:I)&&ne({storeId:t,type:dh.direct,events:K},de)},Ta({},T,Vt)));return Gt},$dispose:At},$t=Dh(Tt);h._s.set(t,$t);const oe=(h._a&&h._a.runWithContext||eM)(()=>h._e.run(()=>(m=d0()).run(r)));for(const ne in oe){const Vt=oe[ne];if(ys(Vt)&&!rM(Vt)||Yn(Vt))y||(tt&&sM(Vt)&&(ys(Vt)?Vt.value=tt[ne]:Hp(Vt,tt[ne])),h.state.value[t][ne]=Vt);else if(typeof Vt=="function"){const Gt=ht(ne,Vt);oe[ne]=Gt,l.actions[ne]=Vt}}return Ta($t,oe),Ta(ci($t),oe),Object.defineProperty($t,"$state",{get:()=>h.state.value[t],set:ne=>{vt(Vt=>{Ta(Vt,ne)})}}),h._p.forEach(ne=>{Ta($t,m.run(()=>ne({store:$t,app:h._a,pinia:h,options:l})))}),tt&&y&&a.hydrate&&a.hydrate($t.$state,tt),I=!0,k=!0,$t}function ta(t,r,a){let h,p;const y=typeof r=="function";typeof t=="string"?(h=t,p=y?a:r):(p=t,h=t.id);function m(l,T){const I=Yw();return l=l||(I?Sr(uv,null):null),l&&Zd(l),l=hv,l._s.has(h)||(y?fv(h,r,p,l):nM(h,p,l)),l._s.get(h)}return m.$id=h,m}function aM(t){{t=ci(t);const r={};for(const a in t){const h=t[a];(ys(h)||Yn(h))&&(r[a]=pw(t,a))}return r}}/*!
  * vue-router v4.3.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const Tl=typeof document<"u";function oM(t){return t.__esModule||t[Symbol.toStringTag]==="Module"}const Si=Object.assign;function wp(t,r){const a={};for(const h in r){const p=r[h];a[h]=on(p)?p.map(t):t(p)}return a}const fh=()=>{},on=Array.isArray,pv=/#/g,lM=/&/g,cM=/\//g,hM=/=/g,uM=/\?/g,mv=/\+/g,dM=/%5B/g,fM=/%5D/g,gv=/%5E/g,pM=/%60/g,_v=/%7B/g,mM=/%7C/g,yv=/%7D/g,gM=/%20/g;function Im(t){return encodeURI(""+t).replace(mM,"|").replace(dM,"[").replace(fM,"]")}function _M(t){return Im(t).replace(_v,"{").replace(yv,"}").replace(gv,"^")}function Wp(t){return Im(t).replace(mv,"%2B").replace(gM,"+").replace(pv,"%23").replace(lM,"%26").replace(pM,"`").replace(_v,"{").replace(yv,"}").replace(gv,"^")}function yM(t){return Wp(t).replace(hM,"%3D")}function vM(t){return Im(t).replace(pv,"%23").replace(uM,"%3F")}function xM(t){return t==null?"":vM(t).replace(cM,"%2F")}function Sh(t){try{return decodeURIComponent(""+t)}catch{}return""+t}const bM=/\/$/,wM=t=>t.replace(bM,"");function Mp(t,r,a="/"){let h,p={},y="",m="";const l=r.indexOf("#");let T=r.indexOf("?");return l<T&&l>=0&&(T=-1),T>-1&&(h=r.slice(0,T),y=r.slice(T+1,l>-1?l:r.length),p=t(y)),l>-1&&(h=h||r.slice(0,l),m=r.slice(l,r.length)),h=AM(h??r,a),{fullPath:h+(y&&"?")+y+m,path:h,query:p,hash:Sh(m)}}function MM(t,r){const a=r.query?t(r.query):"";return r.path+(a&&"?")+a+(r.hash||"")}function iy(t,r){return!r||!t.toLowerCase().startsWith(r.toLowerCase())?t:t.slice(r.length)||"/"}function SM(t,r,a){const h=r.matched.length-1,p=a.matched.length-1;return h>-1&&h===p&&Vl(r.matched[h],a.matched[p])&&vv(r.params,a.params)&&t(r.query)===t(a.query)&&r.hash===a.hash}function Vl(t,r){return(t.aliasOf||t)===(r.aliasOf||r)}function vv(t,r){if(Object.keys(t).length!==Object.keys(r).length)return!1;for(const a in t)if(!TM(t[a],r[a]))return!1;return!0}function TM(t,r){return on(t)?sy(t,r):on(r)?sy(r,t):t===r}function sy(t,r){return on(r)?t.length===r.length&&t.every((a,h)=>a===r[h]):t.length===1&&t[0]===r}function AM(t,r){if(t.startsWith("/"))return t;if(!t)return r;const a=r.split("/"),h=t.split("/"),p=h[h.length-1];(p===".."||p===".")&&h.push("");let y=a.length-1,m,l;for(m=0;m<h.length;m++)if(l=h[m],l!==".")if(l==="..")y>1&&y--;else break;return a.slice(0,y).join("/")+"/"+h.slice(m).join("/")}var Th;(function(t){t.pop="pop",t.push="push"})(Th||(Th={}));var ph;(function(t){t.back="back",t.forward="forward",t.unknown=""})(ph||(ph={}));function EM(t){if(!t)if(Tl){const r=document.querySelector("base");t=r&&r.getAttribute("href")||"/",t=t.replace(/^\w+:\/\/[^\/]+/,"")}else t="/";return t[0]!=="/"&&t[0]!=="#"&&(t="/"+t),wM(t)}const IM=/^[^#]+#/;function PM(t,r){return t.replace(IM,"#")+r}function CM(t,r){const a=document.documentElement.getBoundingClientRect(),h=t.getBoundingClientRect();return{behavior:r.behavior,left:h.left-a.left-(r.left||0),top:h.top-a.top-(r.top||0)}}const Kd=()=>({left:window.scrollX,top:window.scrollY});function DM(t){let r;if("el"in t){const a=t.el,h=typeof a=="string"&&a.startsWith("#"),p=typeof a=="string"?h?document.getElementById(a.slice(1)):document.querySelector(a):a;if(!p)return;r=CM(p,t)}else r=t;"scrollBehavior"in document.documentElement.style?window.scrollTo(r):window.scrollTo(r.left!=null?r.left:window.scrollX,r.top!=null?r.top:window.scrollY)}function ry(t,r){return(history.state?history.state.position-r:-1)+t}const Zp=new Map;function kM(t,r){Zp.set(t,r)}function RM(t){const r=Zp.get(t);return Zp.delete(t),r}let zM=()=>location.protocol+"//"+location.host;function xv(t,r){const{pathname:a,search:h,hash:p}=r,y=t.indexOf("#");if(y>-1){let l=p.includes(t.slice(y))?t.slice(y).length:1,T=p.slice(l);return T[0]!=="/"&&(T="/"+T),iy(T,"")}return iy(a,t)+h+p}function LM(t,r,a,h){let p=[],y=[],m=null;const l=({state:L})=>{const K=xv(t,location),tt=a.value,ot=r.value;let vt=0;if(L){if(a.value=K,r.value=L,m&&m===tt){m=null;return}vt=ot?L.position-ot.position:0}else h(K);p.forEach(yt=>{yt(a.value,tt,{delta:vt,type:Th.pop,direction:vt?vt>0?ph.forward:ph.back:ph.unknown})})};function T(){m=a.value}function I(L){p.push(L);const K=()=>{const tt=p.indexOf(L);tt>-1&&p.splice(tt,1)};return y.push(K),K}function k(){const{history:L}=window;L.state&&L.replaceState(Si({},L.state,{scroll:Kd()}),"")}function P(){for(const L of y)L();y=[],window.removeEventListener("popstate",l),window.removeEventListener("beforeunload",k)}return window.addEventListener("popstate",l),window.addEventListener("beforeunload",k,{passive:!0}),{pauseListeners:T,listen:I,destroy:P}}function ny(t,r,a,h=!1,p=!1){return{back:t,current:r,forward:a,replaced:h,position:window.history.length,scroll:p?Kd():null}}function OM(t){const{history:r,location:a}=window,h={value:xv(t,a)},p={value:r.state};p.value||y(h.value,{back:null,current:h.value,forward:null,position:r.length-1,replaced:!0,scroll:null},!0);function y(T,I,k){const P=t.indexOf("#"),L=P>-1?(a.host&&document.querySelector("base")?t:t.slice(P))+T:zM()+t+T;try{r[k?"replaceState":"pushState"](I,"",L),p.value=I}catch(K){console.error(K),a[k?"replace":"assign"](L)}}function m(T,I){const k=Si({},r.state,ny(p.value.back,T,p.value.forward,!0),I,{position:p.value.position});y(T,k,!0),h.value=T}function l(T,I){const k=Si({},p.value,r.state,{forward:T,scroll:Kd()});y(k.current,k,!0);const P=Si({},ny(h.value,T,null),{position:k.position+1},I);y(T,P,!1),h.value=T}return{location:h,state:p,push:l,replace:m}}function FM(t){t=EM(t);const r=OM(t),a=LM(t,r.state,r.location,r.replace);function h(y,m=!0){m||a.pauseListeners(),history.go(y)}const p=Si({location:"",base:t,go:h,createHref:PM.bind(null,t)},r,a);return Object.defineProperty(p,"location",{enumerable:!0,get:()=>r.location.value}),Object.defineProperty(p,"state",{enumerable:!0,get:()=>r.state.value}),p}function BM(t){return t=location.host?t||location.pathname+location.search:"",t.includes("#")||(t+="#"),FM(t)}function NM(t){return typeof t=="string"||t&&typeof t=="object"}function bv(t){return typeof t=="string"||typeof t=="symbol"}const wa={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},wv=Symbol("");var ay;(function(t){t[t.aborted=4]="aborted",t[t.cancelled=8]="cancelled",t[t.duplicated=16]="duplicated"})(ay||(ay={}));function Ul(t,r){return Si(new Error,{type:t,[wv]:!0},r)}function Zn(t,r){return t instanceof Error&&wv in t&&(r==null||!!(t.type&r))}const oy="[^/]+?",$M={sensitive:!1,strict:!1,start:!0,end:!0},VM=/[.+*?^${}()[\]/\\]/g;function UM(t,r){const a=Si({},$M,r),h=[];let p=a.start?"^":"";const y=[];for(const I of t){const k=I.length?[]:[90];a.strict&&!I.length&&(p+="/");for(let P=0;P<I.length;P++){const L=I[P];let K=40+(a.sensitive?.25:0);if(L.type===0)P||(p+="/"),p+=L.value.replace(VM,"\\$&"),K+=40;else if(L.type===1){const{value:tt,repeatable:ot,optional:vt,regexp:yt}=L;y.push({name:tt,repeatable:ot,optional:vt});const At=yt||oy;if(At!==oy){K+=10;try{new RegExp(`(${At})`)}catch(Tt){throw new Error(`Invalid custom RegExp for param "${tt}" (${At}): `+Tt.message)}}let ht=ot?`((?:${At})(?:/(?:${At}))*)`:`(${At})`;P||(ht=vt&&I.length<2?`(?:/${ht})`:"/"+ht),vt&&(ht+="?"),p+=ht,K+=20,vt&&(K+=-8),ot&&(K+=-20),At===".*"&&(K+=-50)}k.push(K)}h.push(k)}if(a.strict&&a.end){const I=h.length-1;h[I][h[I].length-1]+=.7000000000000001}a.strict||(p+="/?"),a.end?p+="$":a.strict&&(p+="(?:/|$)");const m=new RegExp(p,a.sensitive?"":"i");function l(I){const k=I.match(m),P={};if(!k)return null;for(let L=1;L<k.length;L++){const K=k[L]||"",tt=y[L-1];P[tt.name]=K&&tt.repeatable?K.split("/"):K}return P}function T(I){let k="",P=!1;for(const L of t){(!P||!k.endsWith("/"))&&(k+="/"),P=!1;for(const K of L)if(K.type===0)k+=K.value;else if(K.type===1){const{value:tt,repeatable:ot,optional:vt}=K,yt=tt in I?I[tt]:"";if(on(yt)&&!ot)throw new Error(`Provided param "${tt}" is an array but it is not repeatable (* or + modifiers)`);const At=on(yt)?yt.join("/"):yt;if(!At)if(vt)L.length<2&&(k.endsWith("/")?k=k.slice(0,-1):P=!0);else throw new Error(`Missing required param "${tt}"`);k+=At}}return k||"/"}return{re:m,score:h,keys:y,parse:l,stringify:T}}function qM(t,r){let a=0;for(;a<t.length&&a<r.length;){const h=r[a]-t[a];if(h)return h;a++}return t.length<r.length?t.length===1&&t[0]===80?-1:1:t.length>r.length?r.length===1&&r[0]===80?1:-1:0}function jM(t,r){let a=0;const h=t.score,p=r.score;for(;a<h.length&&a<p.length;){const y=qM(h[a],p[a]);if(y)return y;a++}if(Math.abs(p.length-h.length)===1){if(ly(h))return 1;if(ly(p))return-1}return p.length-h.length}function ly(t){const r=t[t.length-1];return t.length>0&&r[r.length-1]<0}const GM={type:0,value:""},HM=/[a-zA-Z0-9_]/;function WM(t){if(!t)return[[]];if(t==="/")return[[GM]];if(!t.startsWith("/"))throw new Error(`Invalid path "${t}"`);function r(K){throw new Error(`ERR (${a})/"${I}": ${K}`)}let a=0,h=a;const p=[];let y;function m(){y&&p.push(y),y=[]}let l=0,T,I="",k="";function P(){I&&(a===0?y.push({type:0,value:I}):a===1||a===2||a===3?(y.length>1&&(T==="*"||T==="+")&&r(`A repeatable param (${I}) must be alone in its segment. eg: '/:ids+.`),y.push({type:1,value:I,regexp:k,repeatable:T==="*"||T==="+",optional:T==="*"||T==="?"})):r("Invalid state to consume buffer"),I="")}function L(){I+=T}for(;l<t.length;){if(T=t[l++],T==="\\"&&a!==2){h=a,a=4;continue}switch(a){case 0:T==="/"?(I&&P(),m()):T===":"?(P(),a=1):L();break;case 4:L(),a=h;break;case 1:T==="("?a=2:HM.test(T)?L():(P(),a=0,T!=="*"&&T!=="?"&&T!=="+"&&l--);break;case 2:T===")"?k[k.length-1]=="\\"?k=k.slice(0,-1)+T:a=3:k+=T;break;case 3:P(),a=0,T!=="*"&&T!=="?"&&T!=="+"&&l--,k="";break;default:r("Unknown state");break}}return a===2&&r(`Unfinished custom RegExp for param "${I}"`),P(),m(),p}function ZM(t,r,a){const h=UM(WM(t.path),a),p=Si(h,{record:t,parent:r,children:[],alias:[]});return r&&!p.record.aliasOf==!r.record.aliasOf&&r.children.push(p),p}function KM(t,r){const a=[],h=new Map;r=uy({strict:!1,end:!0,sensitive:!1},r);function p(k){return h.get(k)}function y(k,P,L){const K=!L,tt=XM(k);tt.aliasOf=L&&L.record;const ot=uy(r,k),vt=[tt];if("alias"in k){const ht=typeof k.alias=="string"?[k.alias]:k.alias;for(const Tt of ht)vt.push(Si({},tt,{components:L?L.record.components:tt.components,path:Tt,aliasOf:L?L.record:tt}))}let yt,At;for(const ht of vt){const{path:Tt}=ht;if(P&&Tt[0]!=="/"){const $t=P.record.path,qt=$t[$t.length-1]==="/"?"":"/";ht.path=P.record.path+(Tt&&qt+Tt)}if(yt=ZM(ht,P,ot),L?L.alias.push(yt):(At=At||yt,At!==yt&&At.alias.push(yt),K&&k.name&&!hy(yt)&&m(k.name)),tt.children){const $t=tt.children;for(let qt=0;qt<$t.length;qt++)y($t[qt],yt,L&&L.children[qt])}L=L||yt,(yt.record.components&&Object.keys(yt.record.components).length||yt.record.name||yt.record.redirect)&&T(yt)}return At?()=>{m(At)}:fh}function m(k){if(bv(k)){const P=h.get(k);P&&(h.delete(k),a.splice(a.indexOf(P),1),P.children.forEach(m),P.alias.forEach(m))}else{const P=a.indexOf(k);P>-1&&(a.splice(P,1),k.record.name&&h.delete(k.record.name),k.children.forEach(m),k.alias.forEach(m))}}function l(){return a}function T(k){let P=0;for(;P<a.length&&jM(k,a[P])>=0&&(k.record.path!==a[P].record.path||!Mv(k,a[P]));)P++;a.splice(P,0,k),k.record.name&&!hy(k)&&h.set(k.record.name,k)}function I(k,P){let L,K={},tt,ot;if("name"in k&&k.name){if(L=h.get(k.name),!L)throw Ul(1,{location:k});ot=L.record.name,K=Si(cy(P.params,L.keys.filter(At=>!At.optional).concat(L.parent?L.parent.keys.filter(At=>At.optional):[]).map(At=>At.name)),k.params&&cy(k.params,L.keys.map(At=>At.name))),tt=L.stringify(K)}else if(k.path!=null)tt=k.path,L=a.find(At=>At.re.test(tt)),L&&(K=L.parse(tt),ot=L.record.name);else{if(L=P.name?h.get(P.name):a.find(At=>At.re.test(P.path)),!L)throw Ul(1,{location:k,currentLocation:P});ot=L.record.name,K=Si({},P.params,k.params),tt=L.stringify(K)}const vt=[];let yt=L;for(;yt;)vt.unshift(yt.record),yt=yt.parent;return{name:ot,path:tt,params:K,matched:vt,meta:JM(vt)}}return t.forEach(k=>y(k)),{addRoute:y,resolve:I,removeRoute:m,getRoutes:l,getRecordMatcher:p}}function cy(t,r){const a={};for(const h of r)h in t&&(a[h]=t[h]);return a}function XM(t){return{path:t.path,redirect:t.redirect,name:t.name,meta:t.meta||{},aliasOf:void 0,beforeEnter:t.beforeEnter,props:YM(t),children:t.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in t?t.components||null:t.component&&{default:t.component}}}function YM(t){const r={},a=t.props||!1;if("component"in t)r.default=a;else for(const h in t.components)r[h]=typeof a=="object"?a[h]:a;return r}function hy(t){for(;t;){if(t.record.aliasOf)return!0;t=t.parent}return!1}function JM(t){return t.reduce((r,a)=>Si(r,a.meta),{})}function uy(t,r){const a={};for(const h in t)a[h]=h in r?r[h]:t[h];return a}function Mv(t,r){return r.children.some(a=>a===t||Mv(t,a))}function QM(t){const r={};if(t===""||t==="?")return r;const h=(t[0]==="?"?t.slice(1):t).split("&");for(let p=0;p<h.length;++p){const y=h[p].replace(mv," "),m=y.indexOf("="),l=Sh(m<0?y:y.slice(0,m)),T=m<0?null:Sh(y.slice(m+1));if(l in r){let I=r[l];on(I)||(I=r[l]=[I]),I.push(T)}else r[l]=T}return r}function dy(t){let r="";for(let a in t){const h=t[a];if(a=yM(a),h==null){h!==void 0&&(r+=(r.length?"&":"")+a);continue}(on(h)?h.map(y=>y&&Wp(y)):[h&&Wp(h)]).forEach(y=>{y!==void 0&&(r+=(r.length?"&":"")+a,y!=null&&(r+="="+y))})}return r}function tS(t){const r={};for(const a in t){const h=t[a];h!==void 0&&(r[a]=on(h)?h.map(p=>p==null?null:""+p):h==null?h:""+h)}return r}const eS=Symbol(""),fy=Symbol(""),Xd=Symbol(""),Pm=Symbol(""),Kp=Symbol("");function Yc(){let t=[];function r(h){return t.push(h),()=>{const p=t.indexOf(h);p>-1&&t.splice(p,1)}}function a(){t=[]}return{add:r,list:()=>t.slice(),reset:a}}function Pa(t,r,a,h,p,y=m=>m()){const m=h&&(h.enterCallbacks[p]=h.enterCallbacks[p]||[]);return()=>new Promise((l,T)=>{const I=L=>{L===!1?T(Ul(4,{from:a,to:r})):L instanceof Error?T(L):NM(L)?T(Ul(2,{from:r,to:L})):(m&&h.enterCallbacks[p]===m&&typeof L=="function"&&m.push(L),l())},k=y(()=>t.call(h&&h.instances[p],r,a,I));let P=Promise.resolve(k);t.length<3&&(P=P.then(I)),P.catch(L=>T(L))})}function Sp(t,r,a,h,p=y=>y()){const y=[];for(const m of t)for(const l in m.components){let T=m.components[l];if(!(r!=="beforeRouteEnter"&&!m.instances[l]))if(iS(T)){const k=(T.__vccOpts||T)[r];k&&y.push(Pa(k,a,h,m,l,p))}else{let I=T();y.push(()=>I.then(k=>{if(!k)return Promise.reject(new Error(`Couldn't resolve component "${l}" at "${m.path}"`));const P=oM(k)?k.default:k;m.components[l]=P;const K=(P.__vccOpts||P)[r];return K&&Pa(K,a,h,m,l,p)()}))}}return y}function iS(t){return typeof t=="object"||"displayName"in t||"props"in t||"__vccOpts"in t}function py(t){const r=Sr(Xd),a=Sr(Pm),h=ji(()=>r.resolve(Xe(t.to))),p=ji(()=>{const{matched:T}=h.value,{length:I}=T,k=T[I-1],P=a.matched;if(!k||!P.length)return-1;const L=P.findIndex(Vl.bind(null,k));if(L>-1)return L;const K=my(T[I-2]);return I>1&&my(k)===K&&P[P.length-1].path!==K?P.findIndex(Vl.bind(null,T[I-2])):L}),y=ji(()=>p.value>-1&&nS(a.params,h.value.params)),m=ji(()=>p.value>-1&&p.value===a.matched.length-1&&vv(a.params,h.value.params));function l(T={}){return rS(T)?r[Xe(t.replace)?"replace":"push"](Xe(t.to)).catch(fh):Promise.resolve()}return{route:h,href:ji(()=>h.value.href),isActive:y,isExactActive:m,navigate:l}}const sS=U0({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:py,setup(t,{slots:r}){const a=Dh(py(t)),{options:h}=Sr(Xd),p=ji(()=>({[gy(t.activeClass,h.linkActiveClass,"router-link-active")]:a.isActive,[gy(t.exactActiveClass,h.linkExactActiveClass,"router-link-exact-active")]:a.isExactActive}));return()=>{const y=r.default&&r.default(a);return t.custom?y:lv("a",{"aria-current":a.isExactActive?t.ariaCurrentValue:null,href:a.href,onClick:a.navigate,class:p.value},y)}}}),Sv=sS;function rS(t){if(!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)&&!t.defaultPrevented&&!(t.button!==void 0&&t.button!==0)){if(t.currentTarget&&t.currentTarget.getAttribute){const r=t.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(r))return}return t.preventDefault&&t.preventDefault(),!0}}function nS(t,r){for(const a in r){const h=r[a],p=t[a];if(typeof h=="string"){if(h!==p)return!1}else if(!on(p)||p.length!==h.length||h.some((y,m)=>y!==p[m]))return!1}return!0}function my(t){return t?t.aliasOf?t.aliasOf.path:t.path:""}const gy=(t,r,a)=>t??r??a,aS=U0({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(t,{attrs:r,slots:a}){const h=Sr(Kp),p=ji(()=>t.route||h.value),y=Sr(fy,0),m=ji(()=>{let I=Xe(y);const{matched:k}=p.value;let P;for(;(P=k[I])&&!P.components;)I++;return I}),l=ji(()=>p.value.matched[m.value]);Ol(fy,ji(()=>m.value+1)),Ol(eS,l),Ol(Kp,p);const T=Mr();return lh(()=>[T.value,l.value,t.name],([I,k,P],[L,K,tt])=>{k&&(k.instances[P]=I,K&&K!==k&&I&&I===L&&(k.leaveGuards.size||(k.leaveGuards=K.leaveGuards),k.updateGuards.size||(k.updateGuards=K.updateGuards))),I&&k&&(!K||!Vl(k,K)||!L)&&(k.enterCallbacks[P]||[]).forEach(ot=>ot(I))},{flush:"post"}),()=>{const I=p.value,k=t.name,P=l.value,L=P&&P.components[k];if(!L)return _y(a.default,{Component:L,route:I});const K=P.props[k],tt=K?K===!0?I.params:typeof K=="function"?K(I):K:null,vt=lv(L,Si({},tt,r,{onVnodeUnmounted:yt=>{yt.component.isUnmounted&&(P.instances[k]=null)},ref:T}));return _y(a.default,{Component:vt,route:I})||vt}}});function _y(t,r){if(!t)return null;const a=t(r);return a.length===1?a[0]:a}const Tv=aS;function oS(t){const r=KM(t.routes,t),a=t.parseQuery||QM,h=t.stringifyQuery||dy,p=t.history,y=Yc(),m=Yc(),l=Yc(),T=lw(wa);let I=wa;Tl&&t.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const k=wp.bind(null,Rt=>""+Rt),P=wp.bind(null,xM),L=wp.bind(null,Sh);function K(Rt,ce){let ae,ye;return bv(Rt)?(ae=r.getRecordMatcher(Rt),ye=ce):ye=Rt,r.addRoute(ye,ae)}function tt(Rt){const ce=r.getRecordMatcher(Rt);ce&&r.removeRoute(ce)}function ot(){return r.getRoutes().map(Rt=>Rt.record)}function vt(Rt){return!!r.getRecordMatcher(Rt)}function yt(Rt,ce){if(ce=Si({},ce||T.value),typeof Rt=="string"){const rt=Mp(a,Rt,ce.path),Mt=r.resolve({path:rt.path},ce),Ft=p.createHref(rt.fullPath);return Si(rt,Mt,{params:L(Mt.params),hash:Sh(rt.hash),redirectedFrom:void 0,href:Ft})}let ae;if(Rt.path!=null)ae=Si({},Rt,{path:Mp(a,Rt.path,ce.path).path});else{const rt=Si({},Rt.params);for(const Mt in rt)rt[Mt]==null&&delete rt[Mt];ae=Si({},Rt,{params:P(rt)}),ce.params=P(ce.params)}const ye=r.resolve(ae,ce),ni=Rt.hash||"";ye.params=k(L(ye.params));const ai=MM(h,Si({},Rt,{hash:_M(ni),path:ye.path})),Q=p.createHref(ai);return Si({fullPath:ai,hash:ni,query:h===dy?tS(Rt.query):Rt.query||{}},ye,{redirectedFrom:void 0,href:Q})}function At(Rt){return typeof Rt=="string"?Mp(a,Rt,T.value.path):Si({},Rt)}function ht(Rt,ce){if(I!==Rt)return Ul(8,{from:ce,to:Rt})}function Tt(Rt){return oe(Rt)}function $t(Rt){return Tt(Si(At(Rt),{replace:!0}))}function qt(Rt){const ce=Rt.matched[Rt.matched.length-1];if(ce&&ce.redirect){const{redirect:ae}=ce;let ye=typeof ae=="function"?ae(Rt):ae;return typeof ye=="string"&&(ye=ye.includes("?")||ye.includes("#")?ye=At(ye):{path:ye},ye.params={}),Si({query:Rt.query,hash:Rt.hash,params:ye.path!=null?{}:Rt.params},ye)}}function oe(Rt,ce){const ae=I=yt(Rt),ye=T.value,ni=Rt.state,ai=Rt.force,Q=Rt.replace===!0,rt=qt(ae);if(rt)return oe(Si(At(rt),{state:typeof rt=="object"?Si({},ni,rt.state):ni,force:ai,replace:Q}),ce||ae);const Mt=ae;Mt.redirectedFrom=ce;let Ft;return!ai&&SM(h,ye,ae)&&(Ft=Ul(16,{to:Mt,from:ye}),Ei(ye,ye,!0,!1)),(Ft?Promise.resolve(Ft):Gt(Mt,ye)).catch(it=>Zn(it)?Zn(it,2)?it:Ds(it):ii(it,Mt,ye)).then(it=>{if(it){if(Zn(it,2))return oe(Si({replace:Q},At(it.to),{state:typeof it.to=="object"?Si({},ni,it.to.state):ni,force:ai}),ce||Mt)}else it=de(Mt,ye,!0,Q,ni);return Dt(Mt,ye,it),it})}function ne(Rt,ce){const ae=ht(Rt,ce);return ae?Promise.reject(ae):Promise.resolve()}function Vt(Rt){const ce=fr.values().next().value;return ce&&typeof ce.runWithContext=="function"?ce.runWithContext(Rt):Rt()}function Gt(Rt,ce){let ae;const[ye,ni,ai]=lS(Rt,ce);ae=Sp(ye.reverse(),"beforeRouteLeave",Rt,ce);for(const rt of ye)rt.leaveGuards.forEach(Mt=>{ae.push(Pa(Mt,Rt,ce))});const Q=ne.bind(null,Rt,ce);return ae.push(Q),Ii(ae).then(()=>{ae=[];for(const rt of y.list())ae.push(Pa(rt,Rt,ce));return ae.push(Q),Ii(ae)}).then(()=>{ae=Sp(ni,"beforeRouteUpdate",Rt,ce);for(const rt of ni)rt.updateGuards.forEach(Mt=>{ae.push(Pa(Mt,Rt,ce))});return ae.push(Q),Ii(ae)}).then(()=>{ae=[];for(const rt of ai)if(rt.beforeEnter)if(on(rt.beforeEnter))for(const Mt of rt.beforeEnter)ae.push(Pa(Mt,Rt,ce));else ae.push(Pa(rt.beforeEnter,Rt,ce));return ae.push(Q),Ii(ae)}).then(()=>(Rt.matched.forEach(rt=>rt.enterCallbacks={}),ae=Sp(ai,"beforeRouteEnter",Rt,ce,Vt),ae.push(Q),Ii(ae))).then(()=>{ae=[];for(const rt of m.list())ae.push(Pa(rt,Rt,ce));return ae.push(Q),Ii(ae)}).catch(rt=>Zn(rt,8)?rt:Promise.reject(rt))}function Dt(Rt,ce,ae){l.list().forEach(ye=>Vt(()=>ye(Rt,ce,ae)))}function de(Rt,ce,ae,ye,ni){const ai=ht(Rt,ce);if(ai)return ai;const Q=ce===wa,rt=Tl?history.state:{};ae&&(ye||Q?p.replace(Rt.fullPath,Si({scroll:Q&&rt&&rt.scroll},ni)):p.push(Rt.fullPath,ni)),T.value=Rt,Ei(Rt,ce,ae,Q),Ds()}let De;function ke(){De||(De=p.listen((Rt,ce,ae)=>{if(!As.listening)return;const ye=yt(Rt),ni=qt(ye);if(ni){oe(Si(ni,{replace:!0}),ye).catch(fh);return}I=ye;const ai=T.value;Tl&&kM(ry(ai.fullPath,ae.delta),Kd()),Gt(ye,ai).catch(Q=>Zn(Q,12)?Q:Zn(Q,2)?(oe(Q.to,ye).then(rt=>{Zn(rt,20)&&!ae.delta&&ae.type===Th.pop&&p.go(-1,!1)}).catch(fh),Promise.reject()):(ae.delta&&p.go(-ae.delta,!1),ii(Q,ye,ai))).then(Q=>{Q=Q||de(ye,ai,!1),Q&&(ae.delta&&!Zn(Q,8)?p.go(-ae.delta,!1):ae.type===Th.pop&&Zn(Q,20)&&p.go(-1,!1)),Dt(ye,ai,Q)}).catch(fh)}))}let gi=Yc(),Re=Yc(),Le;function ii(Rt,ce,ae){Ds(Rt);const ye=Re.list();return ye.length?ye.forEach(ni=>ni(Rt,ce,ae)):console.error(Rt),Promise.reject(Rt)}function xs(){return Le&&T.value!==wa?Promise.resolve():new Promise((Rt,ce)=>{gi.add([Rt,ce])})}function Ds(Rt){return Le||(Le=!Rt,ke(),gi.list().forEach(([ce,ae])=>Rt?ae(Rt):ce()),gi.reset()),Rt}function Ei(Rt,ce,ae,ye){const{scrollBehavior:ni}=t;if(!Tl||!ni)return Promise.resolve();const ai=!ae&&RM(ry(Rt.fullPath,0))||(ye||!ae)&&history.state&&history.state.scroll||null;return wm().then(()=>ni(Rt,ce,ai)).then(Q=>Q&&DM(Q)).catch(Q=>ii(Q,Rt,ce))}const hi=Rt=>p.go(Rt);let bs;const fr=new Set,As={currentRoute:T,listening:!0,addRoute:K,removeRoute:tt,hasRoute:vt,getRoutes:ot,resolve:yt,options:t,push:Tt,replace:$t,go:hi,back:()=>hi(-1),forward:()=>hi(1),beforeEach:y.add,beforeResolve:m.add,afterEach:l.add,onError:Re.add,isReady:xs,install(Rt){const ce=this;Rt.component("RouterLink",Sv),Rt.component("RouterView",Tv),Rt.config.globalProperties.$router=ce,Object.defineProperty(Rt.config.globalProperties,"$route",{enumerable:!0,get:()=>Xe(T)}),Tl&&!bs&&T.value===wa&&(bs=!0,Tt(p.location).catch(ni=>{}));const ae={};for(const ni in wa)Object.defineProperty(ae,ni,{get:()=>T.value[ni],enumerable:!0});Rt.provide(Xd,ce),Rt.provide(Pm,T0(ae)),Rt.provide(Kp,T);const ye=Rt.unmount;fr.add(Rt),Rt.unmount=function(){fr.delete(Rt),fr.size<1&&(I=wa,De&&De(),De=null,T.value=wa,bs=!1,Le=!1),ye()}}};function Ii(Rt){return Rt.reduce((ce,ae)=>ce.then(()=>Vt(ae)),Promise.resolve())}return As}function lS(t,r){const a=[],h=[],p=[],y=Math.max(r.matched.length,t.matched.length);for(let m=0;m<y;m++){const l=r.matched[m];l&&(t.matched.find(I=>Vl(I,l))?h.push(l):a.push(l));const T=t.matched[m];T&&(r.matched.find(I=>Vl(I,T))||p.push(T))}return[a,h,p]}function Av(){return Sr(Xd)}function Cm(){return Sr(Pm)}const cS={__name:"App",setup(t){return(r,a)=>(Ie(),Mn(Xe(Tv)))}},hS="modulepreload",uS=function(t){return"/vue3-atlas2/"+t},yy={},dS=function(r,a,h){let p=Promise.resolve();if(a&&a.length>0){const y=document.getElementsByTagName("link"),m=document.querySelector("meta[property=csp-nonce]"),l=(m==null?void 0:m.nonce)||(m==null?void 0:m.getAttribute("nonce"));p=Promise.all(a.map(T=>{if(T=uS(T),T in yy)return;yy[T]=!0;const I=T.endsWith(".css"),k=I?'[rel="stylesheet"]':"";if(!!h)for(let K=y.length-1;K>=0;K--){const tt=y[K];if(tt.href===T&&(!I||tt.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${T}"]${k}`))return;const L=document.createElement("link");if(L.rel=I?"stylesheet":hS,I||(L.as="script",L.crossOrigin=""),L.href=T,l&&L.setAttribute("nonce",l),document.head.appendChild(L),I)return new Promise((K,tt)=>{L.addEventListener("load",K),L.addEventListener("error",()=>tt(new Error(`Unable to preload CSS for ${T}`)))})}))}return p.then(()=>r()).catch(y=>{const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=y,window.dispatchEvent(m),!m.defaultPrevented)throw y})};var fS=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ev(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Iv={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.3/LICENSE.txt
 */(function(t,r){(function(a,h){t.exports=h()})(fS,function(){var a={},h={};function p(m,l,T){if(h[m]=T,m==="index"){var I="var sharedModule = {}; ("+h.shared+")(sharedModule); ("+h.worker+")(sharedModule);",k={};return h.shared(k),h.index(a,k),typeof window<"u"&&a.setWorkerUrl(window.URL.createObjectURL(new Blob([I],{type:"text/javascript"}))),a}}p("shared",["exports"],function(m){function l(s,e,n,c){return new(n||(n=Promise))(function(f,v){function x(E){try{S(c.next(E))}catch(D){v(D)}}function b(E){try{S(c.throw(E))}catch(D){v(D)}}function S(E){var D;E.done?f(E.value):(D=E.value,D instanceof n?D:new n(function(R){R(D)})).then(x,b)}S((c=c.apply(s,e||[])).next())})}function T(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}typeof SuppressedError=="function"&&SuppressedError;var I=k;function k(s,e){this.x=s,this.y=e}k.prototype={clone:function(){return new k(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,e){return this.clone()._rotateAround(s,e)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var e=s.x-this.x,n=s.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,e){return Math.atan2(this.x*e-this.y*s,this.x*s+this.y*e)},_matMult:function(s){var e=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=e,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var e=Math.cos(s),n=Math.sin(s),c=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=c,this},_rotateAround:function(s,e){var n=Math.cos(s),c=Math.sin(s),f=e.y+c*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-c*(this.y-e.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},k.convert=function(s){return s instanceof k?s:Array.isArray(s)?new k(s[0],s[1]):s};var P=T(I),L=K;function K(s,e,n,c){this.cx=3*s,this.bx=3*(n-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(c-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=e,this.p2x=n,this.p2y=c}K.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,e){if(e===void 0&&(e=1e-6),s<0)return 0;if(s>1)return 1;for(var n=s,c=0;c<8;c++){var f=this.sampleCurveX(n)-s;if(Math.abs(f)<e)return n;var v=this.sampleCurveDerivativeX(n);if(Math.abs(v)<1e-6)break;n-=f/v}var x=0,b=1;for(n=s,c=0;c<20&&(f=this.sampleCurveX(n),!(Math.abs(f-s)<e));c++)s>f?x=n:b=n,n=.5*(b-x)+x;return n},solve:function(s,e){return this.sampleCurveY(this.solveCurveX(s,e))}};var tt=T(L);let ot,vt;function yt(){return ot==null&&(ot=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ot}function At(){if(vt==null&&(vt=!1,yt())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let c=0;c<5*5;c++){const f=4*c;e.fillStyle=`rgb(${f},${f+1},${f+2})`,e.fillRect(c%5,Math.floor(c/5),1,1)}const n=e.getImageData(0,0,5,5).data;for(let c=0;c<5*5*4;c++)if(c%4!=3&&n[c]!==c){vt=!0;break}}}return vt||!1}function ht(s,e,n,c){const f=new tt(s,e,n,c);return function(v){return f.solve(v)}}const Tt=ht(.25,.1,.25,1);function $t(s,e,n){return Math.min(n,Math.max(e,s))}function qt(s,e,n){const c=n-e,f=((s-e)%c+c)%c+e;return f===e?n:f}function oe(s,...e){for(const n of e)for(const c in n)s[c]=n[c];return s}let ne=1;function Vt(s,e,n){const c={};for(const f in s)c[f]=e.call(n||this,s[f],f,s);return c}function Gt(s,e,n){const c={};for(const f in s)e.call(n||this,s[f],f,s)&&(c[f]=s[f]);return c}function Dt(s){return Array.isArray(s)?s.map(Dt):typeof s=="object"&&s?Vt(s,Dt):s}const de={};function De(s){de[s]||(typeof console<"u"&&console.warn(s),de[s]=!0)}function ke(s,e,n){return(n.y-s.y)*(e.x-s.x)>(e.y-s.y)*(n.x-s.x)}function gi(s){let e=0;for(let n,c,f=0,v=s.length,x=v-1;f<v;x=f++)n=s[f],c=s[x],e+=(c.x-n.x)*(n.y+c.y);return e}function Re(s){return typeof WorkerGlobalScope<"u"&&s!==void 0&&s instanceof WorkerGlobalScope}let Le=null;function ii(s){return typeof ImageBitmap<"u"&&s instanceof ImageBitmap}const xs="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ds(s,e,n,c,f){return l(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const v=new VideoFrame(s,{timestamp:0});try{const x=v==null?void 0:v.format;if(!x||!x.startsWith("BGR")&&!x.startsWith("RGB"))throw new Error(`Unrecognized format ${x}`);const b=x.startsWith("BGR"),S=new Uint8ClampedArray(c*f*4);if(yield v.copyTo(S,function(E,D,R,B,$){const U=4*Math.max(-D,0),G=(Math.max(0,R)-R)*B*4+U,X=4*B,st=Math.max(0,D),gt=Math.max(0,R);return{rect:{x:st,y:gt,width:Math.min(E.width,D+B)-st,height:Math.min(E.height,R+$)-gt},layout:[{offset:G,stride:X}]}}(s,e,n,c,f)),b)for(let E=0;E<S.length;E+=4){const D=S[E];S[E]=S[E+2],S[E+2]=D}return S}finally{v.close()}})}let Ei,hi;const bs="AbortError";function fr(){return new Error(bs)}const As={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Ii(s){return As.REGISTERED_PROTOCOLS[s.substring(0,s.indexOf("://"))]}const Rt="global-dispatcher";class ce extends Error{constructor(e,n,c,f){super(`AJAXError: ${n} (${e}): ${c}`),this.status=e,this.statusText=n,this.url=c,this.body=f}}const ae=()=>Re(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,ye=function(s,e){if(/:\/\//.test(s.url)&&!/^https?:|^file:/.test(s.url)){const c=Ii(s.url);if(c)return c(s,e);if(Re(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,targetMapId:Rt},e)}if(!(/^file:/.test(n=s.url)||/^file:/.test(ae())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(c,f){return l(this,void 0,void 0,function*(){const v=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,cache:c.cache,referrer:ae(),signal:f.signal});c.type==="json"&&v.headers.set("Accept","application/json");const x=yield fetch(v);if(!x.ok){const E=yield x.blob();throw new ce(x.status,x.statusText,c.url,E)}let b;b=c.type==="arrayBuffer"||c.type==="image"?x.arrayBuffer():c.type==="json"?x.json():x.text();const S=yield b;if(f.signal.aborted)throw fr();return{data:S,cacheControl:x.headers.get("Cache-Control"),expires:x.headers.get("Expires")}})}(s,e);if(Re(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,mustQueue:!0,targetMapId:Rt},e)}var n;return function(c,f){return new Promise((v,x)=>{const b=new XMLHttpRequest;b.open(c.method||"GET",c.url,!0),c.type!=="arrayBuffer"&&c.type!=="image"||(b.responseType="arraybuffer");for(const S in c.headers)b.setRequestHeader(S,c.headers[S]);c.type==="json"&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials=c.credentials==="include",b.onerror=()=>{x(new Error(b.statusText))},b.onload=()=>{if(!f.signal.aborted)if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){let S=b.response;if(c.type==="json")try{S=JSON.parse(b.response)}catch(E){return void x(E)}v({data:S,cacheControl:b.getResponseHeader("Cache-Control"),expires:b.getResponseHeader("Expires")})}else{const S=new Blob([b.response],{type:b.getResponseHeader("Content-Type")});x(new ce(b.status,b.statusText,c.url,S))}},f.signal.addEventListener("abort",()=>{b.abort(),x(fr())}),b.send(c.body)})}(s,e)};function ni(s){if(!s||s.indexOf("://")<=0||s.indexOf("data:image/")===0||s.indexOf("blob:")===0)return!0;const e=new URL(s),n=window.location;return e.protocol===n.protocol&&e.host===n.host}function ai(s,e,n){n[s]&&n[s].indexOf(e)!==-1||(n[s]=n[s]||[],n[s].push(e))}function Q(s,e,n){if(n&&n[s]){const c=n[s].indexOf(e);c!==-1&&n[s].splice(c,1)}}class rt{constructor(e,n={}){oe(this,n),this.type=e}}class Mt extends rt{constructor(e,n={}){super("error",oe({error:e},n))}}class Ft{on(e,n){return this._listeners=this._listeners||{},ai(e,n,this._listeners),this}off(e,n){return Q(e,n,this._listeners),Q(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},ai(e,n,this._oneTimeListeners),this):new Promise(c=>this.once(e,c))}fire(e,n){typeof e=="string"&&(e=new rt(e,n||{}));const c=e.type;if(this.listens(c)){e.target=this;const f=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const b of f)b.call(this,e);const v=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const b of v)Q(c,b,this._oneTimeListeners),b.call(this,e);const x=this._eventedParent;x&&(oe(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(e))}else e instanceof Mt&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var it={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Jt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function le(s,e){const n={};for(const c in s)c!=="ref"&&(n[c]=s[c]);return Jt.forEach(c=>{c in e&&(n[c]=e[c])}),n}function Ct(s,e){if(Array.isArray(s)){if(!Array.isArray(e)||s.length!==e.length)return!1;for(let n=0;n<s.length;n++)if(!Ct(s[n],e[n]))return!1;return!0}if(typeof s=="object"&&s!==null&&e!==null){if(typeof e!="object"||Object.keys(s).length!==Object.keys(e).length)return!1;for(const n in s)if(!Ct(s[n],e[n]))return!1;return!0}return s===e}function Ht(s,e){s.push(e)}function jt(s,e,n){Ht(n,{command:"addSource",args:[s,e[s]]})}function fe(s,e,n){Ht(e,{command:"removeSource",args:[s]}),n[s]=!0}function Ae(s,e,n,c){fe(s,n,c),jt(s,e,n)}function be(s,e,n){let c;for(c in s[n])if(Object.prototype.hasOwnProperty.call(s[n],c)&&c!=="data"&&!Ct(s[n][c],e[n][c]))return!1;for(c in e[n])if(Object.prototype.hasOwnProperty.call(e[n],c)&&c!=="data"&&!Ct(s[n][c],e[n][c]))return!1;return!0}function Pe(s,e,n,c,f,v){s=s||{},e=e||{};for(const x in s)Object.prototype.hasOwnProperty.call(s,x)&&(Ct(s[x],e[x])||n.push({command:v,args:[c,x,e[x],f]}));for(const x in e)Object.prototype.hasOwnProperty.call(e,x)&&!Object.prototype.hasOwnProperty.call(s,x)&&(Ct(s[x],e[x])||n.push({command:v,args:[c,x,e[x],f]}))}function Ke(s){return s.id}function si(s,e){return s[e.id]=e,s}class zt{constructor(e,n,c,f){this.message=(e?`${e}: `:"")+c,f&&(this.identifier=f),n!=null&&n.__line__&&(this.line=n.__line__)}}function _i(s,...e){for(const n of e)for(const c in n)s[c]=n[c];return s}class Pi extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class pr{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[c,f]of n)this.bindings[c]=f}concat(e){return new pr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const as={kind:"null"},Zt={kind:"number"},Oe={kind:"string"},Me={kind:"boolean"},ui={kind:"color"},tr={kind:"object"},Be={kind:"value"},Rn={kind:"collator"},os={kind:"formatted"},Y={kind:"padding"},F={kind:"resolvedImage"},N={kind:"variableAnchorOffsetCollection"};function q(s,e){return{kind:"array",itemType:s,N:e}}function H(s){if(s.kind==="array"){const e=H(s.itemType);return typeof s.N=="number"?`array<${e}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${e}>`}return s.kind}const ut=[as,Zt,Oe,Me,ui,os,tr,q(Be),Y,F,N];function dt(s,e){if(e.kind==="error")return null;if(s.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!dt(s.itemType,e.itemType))&&(typeof s.N!="number"||s.N===e.N))return null}else{if(s.kind===e.kind)return null;if(s.kind==="value"){for(const n of ut)if(!dt(n,e))return null}}return`Expected ${H(s)} but found ${H(e)} instead.`}function mt(s,e){return e.some(n=>n.kind===s.kind)}function at(s,e){return e.some(n=>n==="null"?s===null:n==="array"?Array.isArray(s):n==="object"?s&&!Array.isArray(s)&&typeof s=="object":n===typeof s)}function _t(s,e){return s.kind==="array"&&e.kind==="array"?s.itemType.kind===e.itemType.kind&&typeof s.N=="number":s.kind===e.kind}const Lt=.96422,It=.82521,Pt=4/29,xe=6/29,Se=3*xe*xe,Ne=xe*xe*xe,ze=Math.PI/180,Qe=180/Math.PI;function yi(s){return(s%=360)<0&&(s+=360),s}function Ci([s,e,n,c]){let f,v;const x=Ue((.2225045*(s=Qi(s))+.7168786*(e=Qi(e))+.0606169*(n=Qi(n)))/1);s===e&&e===n?f=v=x:(f=Ue((.4360747*s+.3850649*e+.1430804*n)/Lt),v=Ue((.0139322*s+.0971045*e+.7141733*n)/It));const b=116*x-16;return[b<0?0:b,500*(f-x),200*(x-v),c]}function Qi(s){return s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function Ue(s){return s>Ne?Math.pow(s,1/3):s/Se+Pt}function Ni([s,e,n,c]){let f=(s+16)/116,v=isNaN(e)?f:f+e/500,x=isNaN(n)?f:f-n/200;return f=1*ks(f),v=Lt*ks(v),x=It*ks(x),[ls(3.1338561*v-1.6168667*f-.4906146*x),ls(-.9787684*v+1.9161415*f+.033454*x),ls(.0719453*v-.2289914*f+1.4052427*x),c]}function ls(s){return(s=s<=.00304?12.92*s:1.055*Math.pow(s,1/2.4)-.055)<0?0:s>1?1:s}function ks(s){return s>xe?s*s*s:Se*(s-Pt)}function qs(s){return parseInt(s.padEnd(2,s),16)/255}function vs(s,e){return Br(e?s/100:s,0,1)}function Br(s,e,n){return Math.min(Math.max(e,s),n)}function Uh(s){return!s.some(Number.isNaN)}const cf={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class fi{constructor(e,n,c,f=1,v=!0){this.r=e,this.g=n,this.b=c,this.a=f,v||(this.r*=f,this.g*=f,this.b*=f,f||this.overwriteGetter("rgb",[e,n,c,f]))}static parse(e){if(e instanceof fi)return e;if(typeof e!="string")return;const n=function(c){if((c=c.toLowerCase().trim())==="transparent")return[0,0,0,0];const f=cf[c];if(f){const[x,b,S]=f;return[x/255,b/255,S/255,1]}if(c.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(c)){const x=c.length<6?1:2;let b=1;return[qs(c.slice(b,b+=x)),qs(c.slice(b,b+=x)),qs(c.slice(b,b+=x)),qs(c.slice(b,b+x)||"ff")]}if(c.startsWith("rgb")){const x=c.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[b,S,E,D,R,B,$,U,G,X,st,gt]=x,nt=[D||" ",$||" ",X].join("");if(nt==="  "||nt==="  /"||nt===",,"||nt===",,,"){const ft=[E,B,G].join(""),Et=ft==="%%%"?100:ft===""?255:0;if(Et){const kt=[Br(+S/Et,0,1),Br(+R/Et,0,1),Br(+U/Et,0,1),st?vs(+st,gt):1];if(Uh(kt))return kt}}return}}const v=c.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[x,b,S,E,D,R,B,$,U]=v,G=[S||" ",D||" ",B].join("");if(G==="  "||G==="  /"||G===",,"||G===",,,"){const X=[+b,Br(+E,0,100),Br(+R,0,100),$?vs(+$,U):1];if(Uh(X))return function([st,gt,nt,ft]){function Et(kt){const re=(kt+st/30)%12,me=gt*Math.min(nt,1-nt);return nt-me*Math.max(-1,Math.min(re-3,9-re,1))}return st=yi(st),gt/=100,nt/=100,[Et(0),Et(8),Et(4),ft]}(X)}}}(e);return n?new fi(...n,!1):void 0}get rgb(){const{r:e,g:n,b:c,a:f}=this,v=f||1/0;return this.overwriteGetter("rgb",[e/v,n/v,c/v,f])}get hcl(){return this.overwriteGetter("hcl",function(e){const[n,c,f,v]=Ci(e),x=Math.sqrt(c*c+f*f);return[Math.round(1e4*x)?yi(Math.atan2(f,c)*Qe):NaN,x,n,v]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Ci(this.rgb))}overwriteGetter(e,n){return Object.defineProperty(this,e,{value:n}),n}toString(){const[e,n,c,f]=this.rgb;return`rgba(${[e,n,c].map(v=>Math.round(255*v)).join(",")},${f})`}}fi.black=new fi(0,0,0,1),fi.white=new fi(1,1,1,1),fi.transparent=new fi(0,0,0,0),fi.red=new fi(1,0,0,1);class Kl{constructor(e,n,c){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Xl{constructor(e,n,c,f,v){this.text=e,this.image=n,this.scale=c,this.fontStack=f,this.textColor=v}}class er{constructor(e){this.sections=e}static fromString(e){return new er([new Xl(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof er?e:er.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class js{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof js)return e;if(typeof e=="number")return new js([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const n of e)if(typeof n!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new js(e)}}toString(){return JSON.stringify(this.values)}}const Ba=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class mr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof mr)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let n=0;n<e.length;n+=2){const c=e[n],f=e[n+1];if(typeof c!="string"||!Ba.has(c)||!Array.isArray(f)||f.length!==2||typeof f[0]!="number"||typeof f[1]!="number")return}return new mr(e)}}toString(){return JSON.stringify(this.values)}}class gr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new gr({name:e,available:!1}):null}}function ia(s,e,n,c){return typeof s=="number"&&s>=0&&s<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[s,e,n,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[s,e,n,c]:[s,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function To(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof fi||s instanceof Kl||s instanceof er||s instanceof js||s instanceof mr||s instanceof gr)return!0;if(Array.isArray(s)){for(const e of s)if(!To(e))return!1;return!0}if(typeof s=="object"){for(const e in s)if(!To(s[e]))return!1;return!0}return!1}function ts(s){if(s===null)return as;if(typeof s=="string")return Oe;if(typeof s=="boolean")return Me;if(typeof s=="number")return Zt;if(s instanceof fi)return ui;if(s instanceof Kl)return Rn;if(s instanceof er)return os;if(s instanceof js)return Y;if(s instanceof mr)return N;if(s instanceof gr)return F;if(Array.isArray(s)){const e=s.length;let n;for(const c of s){const f=ts(c);if(n){if(n===f)continue;n=Be;break}n=f}return q(n||Be,e)}return tr}function Na(s){const e=typeof s;return s===null?"":e==="string"||e==="number"||e==="boolean"?String(s):s instanceof fi||s instanceof er||s instanceof js||s instanceof mr||s instanceof gr?s.toString():JSON.stringify(s)}class hn{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!To(e[1]))return n.error("invalid value");const c=e[1];let f=ts(c);const v=n.expectedType;return f.kind!=="array"||f.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(f=v),new hn(f,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Li{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Ao={string:Oe,number:Zt,boolean:Me,object:tr};class ir{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let c,f=1;const v=e[0];if(v==="array"){let b,S;if(e.length>2){const E=e[1];if(typeof E!="string"||!(E in Ao)||E==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);b=Ao[E],f++}else b=Be;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);S=e[2],f++}c=q(b,S)}else{if(!Ao[v])throw new Error(`Types doesn't contain name = ${v}`);c=Ao[v]}const x=[];for(;f<e.length;f++){const b=n.parse(e[f],f,Be);if(!b)return null;x.push(b)}return new ir(c,x)}evaluate(e){for(let n=0;n<this.args.length;n++){const c=this.args[n].evaluate(e);if(!dt(this.type,ts(c)))return c;if(n===this.args.length-1)throw new Li(`Expected value to be of type ${H(this.type)}, but found ${H(ts(c))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Eo={"to-boolean":Me,"to-color":ui,"to-number":Zt,"to-string":Oe};class Nr{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const c=e[0];if(!Eo[c])throw new Error(`Can't parse ${c} as it is not part of the known types`);if((c==="to-boolean"||c==="to-string")&&e.length!==2)return n.error("Expected one argument.");const f=Eo[c],v=[];for(let x=1;x<e.length;x++){const b=n.parse(e[x],x,Be);if(!b)return null;v.push(b)}return new Nr(f,v)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let n,c;for(const f of this.args){if(n=f.evaluate(e),c=null,n instanceof fi)return n;if(typeof n=="string"){const v=e.parseColor(n);if(v)return v}else if(Array.isArray(n)&&(c=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:ia(n[0],n[1],n[2],n[3]),!c))return new fi(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Li(c||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const c of this.args){n=c.evaluate(e);const f=js.parse(n);if(f)return f}throw new Li(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const c of this.args){n=c.evaluate(e);const f=mr.parse(n);if(f)return f}throw new Li(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const c of this.args){if(n=c.evaluate(e),n===null)return 0;const f=Number(n);if(!isNaN(f))return f}throw new Li(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return er.fromString(Na(this.args[0].evaluate(e)));case"resolvedImage":return gr.fromString(Na(this.args[0].evaluate(e)));default:return Na(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const $a=["Unknown","Point","LineString","Polygon"];class pi{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?$a[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=fi.parse(e)),n}}class Io{constructor(e,n,c=[],f,v=new pr,x=[]){this.registry=e,this.path=c,this.key=c.map(b=>`[${b}]`).join(""),this.scope=v,this.errors=x,this.expectedType=f,this._isConstant=n}parse(e,n,c,f,v={}){return n?this.concat(n,c,f)._parse(e,v):this._parse(e,v)}_parse(e,n){function c(f,v,x){return x==="assert"?new ir(v,[f]):x==="coerce"?new Nr(v,[f]):f}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=e[0];if(typeof f!="string")return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[f];if(v){let x=v.parse(e,this);if(!x)return null;if(this.expectedType){const b=this.expectedType,S=x.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||S.kind!=="value")if(b.kind!=="color"&&b.kind!=="formatted"&&b.kind!=="resolvedImage"||S.kind!=="value"&&S.kind!=="string")if(b.kind!=="padding"||S.kind!=="value"&&S.kind!=="number"&&S.kind!=="array")if(b.kind!=="variableAnchorOffsetCollection"||S.kind!=="value"&&S.kind!=="array"){if(this.checkSubtype(b,S))return null}else x=c(x,b,n.typeAnnotation||"coerce");else x=c(x,b,n.typeAnnotation||"coerce");else x=c(x,b,n.typeAnnotation||"coerce");else x=c(x,b,n.typeAnnotation||"assert")}if(!(x instanceof hn)&&x.type.kind!=="resolvedImage"&&this._isConstant(x)){const b=new pi;try{x=new hn(x.type,x.evaluate(b))}catch(S){return this.error(S.message),null}}return x}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,c){const f=typeof e=="number"?this.path.concat(e):this.path,v=c?this.scope.concat(c):this.scope;return new Io(this.registry,this._isConstant,f,n||null,v,this.errors)}error(e,...n){const c=`${this.key}${n.map(f=>`[${f}]`).join("")}`;this.errors.push(new Pi(c,e))}checkSubtype(e,n){const c=dt(e,n);return c&&this.error(c),c}}class sa{constructor(e,n,c){this.type=Rn,this.locale=c,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const c=e[1];if(typeof c!="object"||Array.isArray(c))return n.error("Collator options argument must be an object.");const f=n.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,Me);if(!f)return null;const v=n.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,Me);if(!v)return null;let x=null;return c.locale&&(x=n.parse(c.locale,1,Oe),!x)?null:new sa(f,v,x)}evaluate(e){return new Kl(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const un=8192;function Po(s,e){s[0]=Math.min(s[0],e[0]),s[1]=Math.min(s[1],e[1]),s[2]=Math.max(s[2],e[0]),s[3]=Math.max(s[3],e[1])}function Va(s,e){return!(s[0]<=e[0]||s[2]>=e[2]||s[1]<=e[1]||s[3]>=e[3])}function hf(s,e){const n=(180+s[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,f=Math.pow(2,e.z);return[Math.round(n*f*un),Math.round(c*f*un)]}function qh(s,e,n){const c=s[0]-e[0],f=s[1]-e[1],v=s[0]-n[0],x=s[1]-n[1];return c*x-v*f==0&&c*v<=0&&f*x<=0}function Co(s,e){let n=!1;for(let x=0,b=e.length;x<b;x++){const S=e[x];for(let E=0,D=S.length;E<D-1;E++){if(qh(s,S[E],S[E+1]))return!1;(f=S[E])[1]>(c=s)[1]!=(v=S[E+1])[1]>c[1]&&c[0]<(v[0]-f[0])*(c[1]-f[1])/(v[1]-f[1])+f[0]&&(n=!n)}}var c,f,v;return n}function uf(s,e){for(let n=0;n<e.length;n++)if(Co(s,e[n]))return!0;return!1}function jh(s,e,n,c){const f=c[0]-n[0],v=c[1]-n[1],x=(s[0]-n[0])*v-f*(s[1]-n[1]),b=(e[0]-n[0])*v-f*(e[1]-n[1]);return x>0&&b<0||x<0&&b>0}function df(s,e,n){for(const E of n)for(let D=0;D<E.length-1;++D)if((b=[(x=E[D+1])[0]-(v=E[D])[0],x[1]-v[1]])[0]*(S=[(f=e)[0]-(c=s)[0],f[1]-c[1]])[1]-b[1]*S[0]!=0&&jh(c,f,v,x)&&jh(v,x,c,f))return!0;var c,f,v,x,b,S;return!1}function Gh(s,e){for(let n=0;n<s.length;++n)if(!Co(s[n],e))return!1;for(let n=0;n<s.length-1;++n)if(df(s[n],s[n+1],e))return!1;return!0}function Hh(s,e){for(let n=0;n<e.length;n++)if(Gh(s,e[n]))return!0;return!1}function Do(s,e,n){const c=[];for(let f=0;f<s.length;f++){const v=[];for(let x=0;x<s[f].length;x++){const b=hf(s[f][x],n);Po(e,b),v.push(b)}c.push(v)}return c}function Wh(s,e,n){const c=[];for(let f=0;f<s.length;f++){const v=Do(s[f],e,n);c.push(v)}return c}function Zh(s,e,n,c){if(s[0]<n[0]||s[0]>n[2]){const f=.5*c;let v=s[0]-n[0]>f?-c:n[0]-s[0]>f?c:0;v===0&&(v=s[0]-n[2]>f?-c:n[2]-s[0]>f?c:0),s[0]+=v}Po(e,s)}function ko(s,e,n,c){const f=Math.pow(2,c.z)*un,v=[c.x*un,c.y*un],x=[];for(const b of s)for(const S of b){const E=[S.x+v[0],S.y+v[1]];Zh(E,e,n,f),x.push(E)}return x}function Kh(s,e,n,c){const f=Math.pow(2,c.z)*un,v=[c.x*un,c.y*un],x=[];for(const S of s){const E=[];for(const D of S){const R=[D.x+v[0],D.y+v[1]];Po(e,R),E.push(R)}x.push(E)}if(e[2]-e[0]<=f/2){(b=e)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const S of x)for(const E of S)Zh(E,e,n,f)}var b;return x}class zn{constructor(e,n){this.type=Me,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(To(e[1])){const c=e[1];if(c.type==="FeatureCollection"){const f=[];for(const v of c.features){const{type:x,coordinates:b}=v.geometry;x==="Polygon"&&f.push(b),x==="MultiPolygon"&&f.push(...b)}if(f.length)return new zn(c,{type:"MultiPolygon",coordinates:f})}else if(c.type==="Feature"){const f=c.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new zn(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new zn(c,c)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,c){const f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=n.canonicalID();if(c.type==="Polygon"){const b=Do(c.coordinates,v,x),S=ko(n.geometry(),f,v,x);if(!Va(f,v))return!1;for(const E of S)if(!Co(E,b))return!1}if(c.type==="MultiPolygon"){const b=Wh(c.coordinates,v,x),S=ko(n.geometry(),f,v,x);if(!Va(f,v))return!1;for(const E of S)if(!uf(E,b))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,c){const f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=n.canonicalID();if(c.type==="Polygon"){const b=Do(c.coordinates,v,x),S=Kh(n.geometry(),f,v,x);if(!Va(f,v))return!1;for(const E of S)if(!Gh(E,b))return!1}if(c.type==="MultiPolygon"){const b=Wh(c.coordinates,v,x),S=Kh(n.geometry(),f,v,x);if(!Va(f,v))return!1;for(const E of S)if(!Hh(E,b))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Ro{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const c=e[1];return n.scope.has(c)?new Ro(c,n.scope.get(c)):n.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class sr{constructor(e,n,c,f){this.name=e,this.type=n,this._evaluate=c,this.args=f}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,n){const c=e[0],f=sr.definitions[c];if(!f)return n.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(f)?f[0]:f.type,x=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,b=x.filter(([E])=>!Array.isArray(E)||E.length===e.length-1);let S=null;for(const[E,D]of b){S=new Io(n.registry,Ua,n.path,null,n.scope);const R=[];let B=!1;for(let $=1;$<e.length;$++){const U=e[$],G=Array.isArray(E)?E[$-1]:E.type,X=S.parse(U,1+R.length,G);if(!X){B=!0;break}R.push(X)}if(!B)if(Array.isArray(E)&&E.length!==R.length)S.error(`Expected ${E.length} arguments, but found ${R.length} instead.`);else{for(let $=0;$<R.length;$++){const U=Array.isArray(E)?E[$]:E.type,G=R[$];S.concat($+1).checkSubtype(U,G.type)}if(S.errors.length===0)return new sr(c,v,D,R)}}if(b.length===1)n.errors.push(...S.errors);else{const E=(b.length?b:x).map(([R])=>{return B=R,Array.isArray(B)?`(${B.map(H).join(", ")})`:`(${H(B.type)}...)`;var B}).join(" | "),D=[];for(let R=1;R<e.length;R++){const B=n.parse(e[R],1+D.length);if(!B)return null;D.push(H(B.type))}n.error(`Expected arguments of type ${E}, but found (${D.join(", ")}) instead.`)}return null}static register(e,n){sr.definitions=n;for(const c in n)e[c]=sr}}function Ua(s){if(s instanceof Ro)return Ua(s.boundExpression);if(s instanceof sr&&s.name==="error"||s instanceof sa||s instanceof zn)return!1;const e=s instanceof Nr||s instanceof ir;let n=!0;return s.eachChild(c=>{n=e?n&&Ua(c):n&&c instanceof hn}),!!n&&zo(s)&&ja(s,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function zo(s){if(s instanceof sr&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof zn)return!1;let e=!0;return s.eachChild(n=>{e&&!zo(n)&&(e=!1)}),e}function qa(s){if(s instanceof sr&&s.name==="feature-state")return!1;let e=!0;return s.eachChild(n=>{e&&!qa(n)&&(e=!1)}),e}function ja(s,e){if(s instanceof sr&&e.indexOf(s.name)>=0)return!1;let n=!0;return s.eachChild(c=>{n&&!ja(c,e)&&(n=!1)}),n}function Ga(s,e){const n=s.length-1;let c,f,v=0,x=n,b=0;for(;v<=x;)if(b=Math.floor((v+x)/2),c=s[b],f=s[b+1],c<=e){if(b===n||e<f)return b;v=b+1}else{if(!(c>e))throw new Li("Input is not a number.");x=b-1}return 0}class Ha{constructor(e,n,c){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[f,v]of c)this.labels.push(f),this.outputs.push(v)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const c=n.parse(e[1],1,Zt);if(!c)return null;const f=[];let v=null;n.expectedType&&n.expectedType.kind!=="value"&&(v=n.expectedType);for(let x=1;x<e.length;x+=2){const b=x===1?-1/0:e[x],S=e[x+1],E=x,D=x+1;if(typeof b!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(f.length&&f[f.length-1][0]>=b)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const R=n.parse(S,D,v);if(!R)return null;v=v||R.type,f.push([b,R])}return new Ha(v,c,f)}evaluate(e){const n=this.labels,c=this.outputs;if(n.length===1)return c[0].evaluate(e);const f=this.input.evaluate(e);if(f<=n[0])return c[0].evaluate(e);const v=n.length;return f>=n[v-1]?c[v-1].evaluate(e):c[Ga(n,f)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function ff(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var pf=Xh;function Xh(s,e,n,c){this.cx=3*s,this.bx=3*(n-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(c-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=e,this.p2x=n,this.p2y=c}Xh.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,e){if(e===void 0&&(e=1e-6),s<0)return 0;if(s>1)return 1;for(var n=s,c=0;c<8;c++){var f=this.sampleCurveX(n)-s;if(Math.abs(f)<e)return n;var v=this.sampleCurveDerivativeX(n);if(Math.abs(v)<1e-6)break;n-=f/v}var x=0,b=1;for(n=s,c=0;c<20&&(f=this.sampleCurveX(n),!(Math.abs(f-s)<e));c++)s>f?x=n:b=n,n=.5*(b-x)+x;return n},solve:function(s,e){return this.sampleCurveY(this.solveCurveX(s,e))}};var mf=ff(pf);function Ln(s,e,n){return s+n*(e-s)}function Lo(s,e,n){return s.map((c,f)=>Ln(c,e[f],n))}const Rs={number:Ln,color:function(s,e,n,c="rgb"){switch(c){case"rgb":{const[f,v,x,b]=Lo(s.rgb,e.rgb,n);return new fi(f,v,x,b,!1)}case"hcl":{const[f,v,x,b]=s.hcl,[S,E,D,R]=e.hcl;let B,$;if(isNaN(f)||isNaN(S))isNaN(f)?isNaN(S)?B=NaN:(B=S,x!==1&&x!==0||($=E)):(B=f,D!==1&&D!==0||($=v));else{let gt=S-f;S>f&&gt>180?gt-=360:S<f&&f-S>180&&(gt+=360),B=f+n*gt}const[U,G,X,st]=function([gt,nt,ft,Et]){return gt=isNaN(gt)?0:gt*ze,Ni([ft,Math.cos(gt)*nt,Math.sin(gt)*nt,Et])}([B,$??Ln(v,E,n),Ln(x,D,n),Ln(b,R,n)]);return new fi(U,G,X,st,!1)}case"lab":{const[f,v,x,b]=Ni(Lo(s.lab,e.lab,n));return new fi(f,v,x,b,!1)}}},array:Lo,padding:function(s,e,n){return new js(Lo(s.values,e.values,n))},variableAnchorOffsetCollection:function(s,e,n){const c=s.values,f=e.values;if(c.length!==f.length)throw new Li(`Cannot interpolate values of different length. from: ${s.toString()}, to: ${e.toString()}`);const v=[];for(let x=0;x<c.length;x+=2){if(c[x]!==f[x])throw new Li(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${c[x]}, to[${x}]: ${f[x]}`);v.push(c[x]);const[b,S]=c[x+1],[E,D]=f[x+1];v.push([Ln(b,E,n),Ln(S,D,n)])}return new mr(v)}};class Es{constructor(e,n,c,f,v){this.type=e,this.operator=n,this.interpolation=c,this.input=f,this.labels=[],this.outputs=[];for(const[x,b]of v)this.labels.push(x),this.outputs.push(b)}static interpolationFactor(e,n,c,f){let v=0;if(e.name==="exponential")v=oi(n,e.base,c,f);else if(e.name==="linear")v=oi(n,1,c,f);else if(e.name==="cubic-bezier"){const x=e.controlPoints;v=new mf(x[0],x[1],x[2],x[3]).solve(oi(n,1,c,f))}return v}static parse(e,n){let[c,f,v,...x]=e;if(!Array.isArray(f)||f.length===0)return n.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){const E=f[1];if(typeof E!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:E}}else{if(f[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const E=f.slice(1);if(E.length!==4||E.some(D=>typeof D!="number"||D<0||D>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:E}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(v=n.parse(v,2,Zt),!v)return null;const b=[];let S=null;c==="interpolate-hcl"||c==="interpolate-lab"?S=ui:n.expectedType&&n.expectedType.kind!=="value"&&(S=n.expectedType);for(let E=0;E<x.length;E+=2){const D=x[E],R=x[E+1],B=E+3,$=E+4;if(typeof D!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(b.length&&b[b.length-1][0]>=D)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',B);const U=n.parse(R,$,S);if(!U)return null;S=S||U.type,b.push([D,U])}return _t(S,Zt)||_t(S,ui)||_t(S,Y)||_t(S,N)||_t(S,q(Zt))?new Es(S,c,f,v,b):n.error(`Type ${H(S)} is not interpolatable.`)}evaluate(e){const n=this.labels,c=this.outputs;if(n.length===1)return c[0].evaluate(e);const f=this.input.evaluate(e);if(f<=n[0])return c[0].evaluate(e);const v=n.length;if(f>=n[v-1])return c[v-1].evaluate(e);const x=Ga(n,f),b=Es.interpolationFactor(this.interpolation,f,n[x],n[x+1]),S=c[x].evaluate(e),E=c[x+1].evaluate(e);switch(this.operator){case"interpolate":return Rs[this.type.kind](S,E,b);case"interpolate-hcl":return Rs.color(S,E,b,"hcl");case"interpolate-lab":return Rs.color(S,E,b,"lab")}}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function oi(s,e,n,c){const f=c-n,v=s-n;return f===0?0:e===1?v/f:(Math.pow(e,v)-1)/(Math.pow(e,f)-1)}class Oo{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let c=null;const f=n.expectedType;f&&f.kind!=="value"&&(c=f);const v=[];for(const b of e.slice(1)){const S=n.parse(b,1+v.length,c,void 0,{typeAnnotation:"omit"});if(!S)return null;c=c||S.type,v.push(S)}if(!c)throw new Error("No output type");const x=f&&v.some(b=>dt(f,b.type));return new Oo(x?Be:c,v)}evaluate(e){let n,c=null,f=0;for(const v of this.args)if(f++,c=v.evaluate(e),c&&c instanceof gr&&!c.available&&(n||(n=c.name),c=null,f===this.args.length&&(c=n)),c!==null)break;return c}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class Fo{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const c=[];for(let v=1;v<e.length-1;v+=2){const x=e[v];if(typeof x!="string")return n.error(`Expected string, but found ${typeof x} instead.`,v);if(/[^a-zA-Z0-9_]/.test(x))return n.error("Variable names must contain only alphanumeric characters or '_'.",v);const b=n.parse(e[v+1],v+1);if(!b)return null;c.push([x,b])}const f=n.parse(e[e.length-1],e.length-1,n.expectedType,c);return f?new Fo(c,f):null}outputDefined(){return this.result.outputDefined()}}class Yl{constructor(e,n,c){this.type=e,this.index=n,this.input=c}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const c=n.parse(e[1],1,Zt),f=n.parse(e[2],2,q(n.expectedType||Be));return c&&f?new Yl(f.type.itemType,c,f):null}evaluate(e){const n=this.index.evaluate(e),c=this.input.evaluate(e);if(n<0)throw new Li(`Array index out of bounds: ${n} < 0.`);if(n>=c.length)throw new Li(`Array index out of bounds: ${n} > ${c.length-1}.`);if(n!==Math.floor(n))throw new Li(`Array index must be an integer, but found ${n} instead.`);return c[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Jl{constructor(e,n){this.type=Me,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const c=n.parse(e[1],1,Be),f=n.parse(e[2],2,Be);return c&&f?mt(c.type,[Me,Oe,Zt,as,Be])?new Jl(c,f):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${H(c.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(!c)return!1;if(!at(n,["boolean","string","number","null"]))throw new Li(`Expected first argument to be of type boolean, string, number or null, but found ${H(ts(n))} instead.`);if(!at(c,["string","array"]))throw new Li(`Expected second argument to be of type array or string, but found ${H(ts(c))} instead.`);return c.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Bo{constructor(e,n,c){this.type=Zt,this.needle=e,this.haystack=n,this.fromIndex=c}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const c=n.parse(e[1],1,Be),f=n.parse(e[2],2,Be);if(!c||!f)return null;if(!mt(c.type,[Me,Oe,Zt,as,Be]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${H(c.type)} instead`);if(e.length===4){const v=n.parse(e[3],3,Zt);return v?new Bo(c,f,v):null}return new Bo(c,f)}evaluate(e){const n=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(!at(n,["boolean","string","number","null"]))throw new Li(`Expected first argument to be of type boolean, string, number or null, but found ${H(ts(n))} instead.`);if(!at(c,["string","array"]))throw new Li(`Expected second argument to be of type array or string, but found ${H(ts(c))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(e);return c.indexOf(n,f)}return c.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Ql{constructor(e,n,c,f,v,x){this.inputType=e,this.type=n,this.input=c,this.cases=f,this.outputs=v,this.otherwise=x}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let c,f;n.expectedType&&n.expectedType.kind!=="value"&&(f=n.expectedType);const v={},x=[];for(let E=2;E<e.length-1;E+=2){let D=e[E];const R=e[E+1];Array.isArray(D)||(D=[D]);const B=n.concat(E);if(D.length===0)return B.error("Expected at least one branch label.");for(const U of D){if(typeof U!="number"&&typeof U!="string")return B.error("Branch labels must be numbers or strings.");if(typeof U=="number"&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return B.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof U=="number"&&Math.floor(U)!==U)return B.error("Numeric branch labels must be integer values.");if(c){if(B.checkSubtype(c,ts(U)))return null}else c=ts(U);if(v[String(U)]!==void 0)return B.error("Branch labels must be unique.");v[String(U)]=x.length}const $=n.parse(R,E,f);if(!$)return null;f=f||$.type,x.push($)}const b=n.parse(e[1],1,Be);if(!b)return null;const S=n.parse(e[e.length-1],e.length-1,f);return S?b.type.kind!=="value"&&n.concat(1).checkSubtype(c,b.type)?null:new Ql(c,f,b,v,x,S):null}evaluate(e){const n=this.input.evaluate(e);return(ts(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class tc{constructor(e,n,c){this.type=e,this.branches=n,this.otherwise=c}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);const f=[];for(let x=1;x<e.length-1;x+=2){const b=n.parse(e[x],x,Me);if(!b)return null;const S=n.parse(e[x+1],x+1,c);if(!S)return null;f.push([b,S]),c=c||S.type}const v=n.parse(e[e.length-1],e.length-1,c);if(!v)return null;if(!c)throw new Error("Can't infer output type");return new tc(c,f,v)}evaluate(e){for(const[n,c]of this.branches)if(n.evaluate(e))return c.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,c]of this.branches)e(n),e(c);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class No{constructor(e,n,c,f){this.type=e,this.input=n,this.beginIndex=c,this.endIndex=f}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const c=n.parse(e[1],1,Be),f=n.parse(e[2],2,Zt);if(!c||!f)return null;if(!mt(c.type,[q(Be),Oe,Be]))return n.error(`Expected first argument to be of type array or string, but found ${H(c.type)} instead`);if(e.length===4){const v=n.parse(e[3],3,Zt);return v?new No(c.type,c,f,v):null}return new No(c.type,c,f)}evaluate(e){const n=this.input.evaluate(e),c=this.beginIndex.evaluate(e);if(!at(n,["string","array"]))throw new Li(`Expected first argument to be of type array or string, but found ${H(ts(n))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(e);return n.slice(c,f)}return n.slice(c)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Yh(s,e){return s==="=="||s==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Jh(s,e,n,c){return c.compare(e,n)===0}function ra(s,e,n){const c=s!=="=="&&s!=="!=";return class Pv{constructor(v,x,b){this.type=Me,this.lhs=v,this.rhs=x,this.collator=b,this.hasUntypedArgument=v.type.kind==="value"||x.type.kind==="value"}static parse(v,x){if(v.length!==3&&v.length!==4)return x.error("Expected two or three arguments.");const b=v[0];let S=x.parse(v[1],1,Be);if(!S)return null;if(!Yh(b,S.type))return x.concat(1).error(`"${b}" comparisons are not supported for type '${H(S.type)}'.`);let E=x.parse(v[2],2,Be);if(!E)return null;if(!Yh(b,E.type))return x.concat(2).error(`"${b}" comparisons are not supported for type '${H(E.type)}'.`);if(S.type.kind!==E.type.kind&&S.type.kind!=="value"&&E.type.kind!=="value")return x.error(`Cannot compare types '${H(S.type)}' and '${H(E.type)}'.`);c&&(S.type.kind==="value"&&E.type.kind!=="value"?S=new ir(E.type,[S]):S.type.kind!=="value"&&E.type.kind==="value"&&(E=new ir(S.type,[E])));let D=null;if(v.length===4){if(S.type.kind!=="string"&&E.type.kind!=="string"&&S.type.kind!=="value"&&E.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(D=x.parse(v[3],3,Rn),!D)return null}return new Pv(S,E,D)}evaluate(v){const x=this.lhs.evaluate(v),b=this.rhs.evaluate(v);if(c&&this.hasUntypedArgument){const S=ts(x),E=ts(b);if(S.kind!==E.kind||S.kind!=="string"&&S.kind!=="number")throw new Li(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${S.kind}, ${E.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const S=ts(x),E=ts(b);if(S.kind!=="string"||E.kind!=="string")return e(v,x,b)}return this.collator?n(v,x,b,this.collator.evaluate(v)):e(v,x,b)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}}}const gf=ra("==",function(s,e,n){return e===n},Jh),_f=ra("!=",function(s,e,n){return e!==n},function(s,e,n,c){return!Jh(0,e,n,c)}),yf=ra("<",function(s,e,n){return e<n},function(s,e,n,c){return c.compare(e,n)<0}),vf=ra(">",function(s,e,n){return e>n},function(s,e,n,c){return c.compare(e,n)>0}),xf=ra("<=",function(s,e,n){return e<=n},function(s,e,n,c){return c.compare(e,n)<=0}),bf=ra(">=",function(s,e,n){return e>=n},function(s,e,n,c){return c.compare(e,n)>=0});class ec{constructor(e,n,c,f,v){this.type=Oe,this.number=e,this.locale=n,this.currency=c,this.minFractionDigits=f,this.maxFractionDigits=v}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const c=n.parse(e[1],1,Zt);if(!c)return null;const f=e[2];if(typeof f!="object"||Array.isArray(f))return n.error("NumberFormat options argument must be an object.");let v=null;if(f.locale&&(v=n.parse(f.locale,1,Oe),!v))return null;let x=null;if(f.currency&&(x=n.parse(f.currency,1,Oe),!x))return null;let b=null;if(f["min-fraction-digits"]&&(b=n.parse(f["min-fraction-digits"],1,Zt),!b))return null;let S=null;return f["max-fraction-digits"]&&(S=n.parse(f["max-fraction-digits"],1,Zt),!S)?null:new ec(c,v,x,b,S)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class $o{constructor(e){this.type=os,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const c=e[1];if(!Array.isArray(c)&&typeof c=="object")return n.error("First argument must be an image or text section.");const f=[];let v=!1;for(let x=1;x<=e.length-1;++x){const b=e[x];if(v&&typeof b=="object"&&!Array.isArray(b)){v=!1;let S=null;if(b["font-scale"]&&(S=n.parse(b["font-scale"],1,Zt),!S))return null;let E=null;if(b["text-font"]&&(E=n.parse(b["text-font"],1,q(Oe)),!E))return null;let D=null;if(b["text-color"]&&(D=n.parse(b["text-color"],1,ui),!D))return null;const R=f[f.length-1];R.scale=S,R.font=E,R.textColor=D}else{const S=n.parse(e[x],1,Be);if(!S)return null;const E=S.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,f.push({content:S,scale:null,font:null,textColor:null})}}return new $o(f)}evaluate(e){return new er(this.sections.map(n=>{const c=n.content.evaluate(e);return ts(c)===F?new Xl("",c,null,null,null):new Xl(Na(c),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}}class ic{constructor(e){this.type=F,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const c=n.parse(e[1],1,Oe);return c?new ic(c):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),c=gr.fromString(n);return c&&e.availableImages&&(c.available=e.availableImages.indexOf(n)>-1),c}eachChild(e){e(this.input)}outputDefined(){return!1}}class sc{constructor(e){this.type=Zt,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const c=n.parse(e[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${H(c.type)} instead.`):new sc(c):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new Li(`Expected value to be of type string or array, but found ${H(ts(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const na={"==":gf,"!=":_f,">":vf,"<":yf,">=":bf,"<=":xf,array:ir,at:Yl,boolean:ir,case:tc,coalesce:Oo,collator:sa,format:$o,image:ic,in:Jl,"index-of":Bo,interpolate:Es,"interpolate-hcl":Es,"interpolate-lab":Es,length:sc,let:Fo,literal:hn,match:Ql,number:ir,"number-format":ec,object:ir,slice:No,step:Ha,string:ir,"to-boolean":Nr,"to-color":Nr,"to-number":Nr,"to-string":Nr,var:Ro,within:zn};function Qh(s,[e,n,c,f]){e=e.evaluate(s),n=n.evaluate(s),c=c.evaluate(s);const v=f?f.evaluate(s):1,x=ia(e,n,c,v);if(x)throw new Li(x);return new fi(e/255,n/255,c/255,v,!1)}function tu(s,e){return s in e}function rc(s,e){const n=e[s];return n===void 0?null:n}function On(s){return{type:s}}function eu(s){return{result:"success",value:s}}function aa(s){return{result:"error",value:s}}function oa(s){return s["property-type"]==="data-driven"||s["property-type"]==="cross-faded-data-driven"}function iu(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function nc(s){return!!s.expression&&s.expression.interpolated}function ri(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function Vo(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function wf(s){return s}function su(s,e){const n=e.type==="color",c=s.stops&&typeof s.stops[0][0]=="object",f=c||!(c||s.property!==void 0),v=s.type||(nc(e)?"exponential":"interval");if(n||e.type==="padding"){const D=n?fi.parse:js.parse;(s=_i({},s)).stops&&(s.stops=s.stops.map(R=>[R[0],D(R[1])])),s.default=D(s.default?s.default:e.default)}if(s.colorSpace&&(x=s.colorSpace)!=="rgb"&&x!=="hcl"&&x!=="lab")throw new Error(`Unknown color space: "${s.colorSpace}"`);var x;let b,S,E;if(v==="exponential")b=ti;else if(v==="interval")b=Mf;else if(v==="categorical"){b=Ki,S=Object.create(null);for(const D of s.stops)S[D[0]]=D[1];E=typeof s.stops[0][0]}else{if(v!=="identity")throw new Error(`Unknown function type "${v}"`);b=ac}if(c){const D={},R=[];for(let U=0;U<s.stops.length;U++){const G=s.stops[U],X=G[0].zoom;D[X]===void 0&&(D[X]={zoom:X,type:s.type,property:s.property,default:s.default,stops:[]},R.push(X)),D[X].stops.push([G[0].value,G[1]])}const B=[];for(const U of R)B.push([D[U].zoom,su(D[U],e)]);const $={name:"linear"};return{kind:"composite",interpolationType:$,interpolationFactor:Es.interpolationFactor.bind(void 0,$),zoomStops:B.map(U=>U[0]),evaluate:({zoom:U},G)=>ti({stops:B,base:s.base},e,U).evaluate(U,G)}}if(f){const D=v==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:Es.interpolationFactor.bind(void 0,D),zoomStops:s.stops.map(R=>R[0]),evaluate:({zoom:R})=>b(s,e,R,S,E)}}return{kind:"source",evaluate(D,R){const B=R&&R.properties?R.properties[s.property]:void 0;return B===void 0?Wa(s.default,e.default):b(s,e,B,S,E)}}}function Wa(s,e,n){return s!==void 0?s:e!==void 0?e:n!==void 0?n:void 0}function Ki(s,e,n,c,f){return Wa(typeof n===f?c[n]:void 0,s.default,e.default)}function Mf(s,e,n){if(ri(n)!=="number")return Wa(s.default,e.default);const c=s.stops.length;if(c===1||n<=s.stops[0][0])return s.stops[0][1];if(n>=s.stops[c-1][0])return s.stops[c-1][1];const f=Ga(s.stops.map(v=>v[0]),n);return s.stops[f][1]}function ti(s,e,n){const c=s.base!==void 0?s.base:1;if(ri(n)!=="number")return Wa(s.default,e.default);const f=s.stops.length;if(f===1||n<=s.stops[0][0])return s.stops[0][1];if(n>=s.stops[f-1][0])return s.stops[f-1][1];const v=Ga(s.stops.map(D=>D[0]),n),x=function(D,R,B,$){const U=$-B,G=D-B;return U===0?0:R===1?G/U:(Math.pow(R,G)-1)/(Math.pow(R,U)-1)}(n,c,s.stops[v][0],s.stops[v+1][0]),b=s.stops[v][1],S=s.stops[v+1][1],E=Rs[e.type]||wf;return typeof b.evaluate=="function"?{evaluate(...D){const R=b.evaluate.apply(void 0,D),B=S.evaluate.apply(void 0,D);if(R!==void 0&&B!==void 0)return E(R,B,x,s.colorSpace)}}:E(b,S,x,s.colorSpace)}function ac(s,e,n){switch(e.type){case"color":n=fi.parse(n);break;case"formatted":n=er.fromString(n.toString());break;case"resolvedImage":n=gr.fromString(n.toString());break;case"padding":n=js.parse(n);break;default:ri(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0)}return Wa(n,s.default,e.default)}sr.register(na,{error:[{kind:"error"},[Oe],(s,[e])=>{throw new Li(e.evaluate(s))}],typeof:[Oe,[Be],(s,[e])=>H(ts(e.evaluate(s)))],"to-rgba":[q(Zt,4),[ui],(s,[e])=>{const[n,c,f,v]=e.evaluate(s).rgb;return[255*n,255*c,255*f,v]}],rgb:[ui,[Zt,Zt,Zt],Qh],rgba:[ui,[Zt,Zt,Zt,Zt],Qh],has:{type:Me,overloads:[[[Oe],(s,[e])=>tu(e.evaluate(s),s.properties())],[[Oe,tr],(s,[e,n])=>tu(e.evaluate(s),n.evaluate(s))]]},get:{type:Be,overloads:[[[Oe],(s,[e])=>rc(e.evaluate(s),s.properties())],[[Oe,tr],(s,[e,n])=>rc(e.evaluate(s),n.evaluate(s))]]},"feature-state":[Be,[Oe],(s,[e])=>rc(e.evaluate(s),s.featureState||{})],properties:[tr,[],s=>s.properties()],"geometry-type":[Oe,[],s=>s.geometryType()],id:[Be,[],s=>s.id()],zoom:[Zt,[],s=>s.globals.zoom],"heatmap-density":[Zt,[],s=>s.globals.heatmapDensity||0],"line-progress":[Zt,[],s=>s.globals.lineProgress||0],accumulated:[Be,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[Zt,On(Zt),(s,e)=>{let n=0;for(const c of e)n+=c.evaluate(s);return n}],"*":[Zt,On(Zt),(s,e)=>{let n=1;for(const c of e)n*=c.evaluate(s);return n}],"-":{type:Zt,overloads:[[[Zt,Zt],(s,[e,n])=>e.evaluate(s)-n.evaluate(s)],[[Zt],(s,[e])=>-e.evaluate(s)]]},"/":[Zt,[Zt,Zt],(s,[e,n])=>e.evaluate(s)/n.evaluate(s)],"%":[Zt,[Zt,Zt],(s,[e,n])=>e.evaluate(s)%n.evaluate(s)],ln2:[Zt,[],()=>Math.LN2],pi:[Zt,[],()=>Math.PI],e:[Zt,[],()=>Math.E],"^":[Zt,[Zt,Zt],(s,[e,n])=>Math.pow(e.evaluate(s),n.evaluate(s))],sqrt:[Zt,[Zt],(s,[e])=>Math.sqrt(e.evaluate(s))],log10:[Zt,[Zt],(s,[e])=>Math.log(e.evaluate(s))/Math.LN10],ln:[Zt,[Zt],(s,[e])=>Math.log(e.evaluate(s))],log2:[Zt,[Zt],(s,[e])=>Math.log(e.evaluate(s))/Math.LN2],sin:[Zt,[Zt],(s,[e])=>Math.sin(e.evaluate(s))],cos:[Zt,[Zt],(s,[e])=>Math.cos(e.evaluate(s))],tan:[Zt,[Zt],(s,[e])=>Math.tan(e.evaluate(s))],asin:[Zt,[Zt],(s,[e])=>Math.asin(e.evaluate(s))],acos:[Zt,[Zt],(s,[e])=>Math.acos(e.evaluate(s))],atan:[Zt,[Zt],(s,[e])=>Math.atan(e.evaluate(s))],min:[Zt,On(Zt),(s,e)=>Math.min(...e.map(n=>n.evaluate(s)))],max:[Zt,On(Zt),(s,e)=>Math.max(...e.map(n=>n.evaluate(s)))],abs:[Zt,[Zt],(s,[e])=>Math.abs(e.evaluate(s))],round:[Zt,[Zt],(s,[e])=>{const n=e.evaluate(s);return n<0?-Math.round(-n):Math.round(n)}],floor:[Zt,[Zt],(s,[e])=>Math.floor(e.evaluate(s))],ceil:[Zt,[Zt],(s,[e])=>Math.ceil(e.evaluate(s))],"filter-==":[Me,[Oe,Be],(s,[e,n])=>s.properties()[e.value]===n.value],"filter-id-==":[Me,[Be],(s,[e])=>s.id()===e.value],"filter-type-==":[Me,[Oe],(s,[e])=>s.geometryType()===e.value],"filter-<":[Me,[Oe,Be],(s,[e,n])=>{const c=s.properties()[e.value],f=n.value;return typeof c==typeof f&&c<f}],"filter-id-<":[Me,[Be],(s,[e])=>{const n=s.id(),c=e.value;return typeof n==typeof c&&n<c}],"filter->":[Me,[Oe,Be],(s,[e,n])=>{const c=s.properties()[e.value],f=n.value;return typeof c==typeof f&&c>f}],"filter-id->":[Me,[Be],(s,[e])=>{const n=s.id(),c=e.value;return typeof n==typeof c&&n>c}],"filter-<=":[Me,[Oe,Be],(s,[e,n])=>{const c=s.properties()[e.value],f=n.value;return typeof c==typeof f&&c<=f}],"filter-id-<=":[Me,[Be],(s,[e])=>{const n=s.id(),c=e.value;return typeof n==typeof c&&n<=c}],"filter->=":[Me,[Oe,Be],(s,[e,n])=>{const c=s.properties()[e.value],f=n.value;return typeof c==typeof f&&c>=f}],"filter-id->=":[Me,[Be],(s,[e])=>{const n=s.id(),c=e.value;return typeof n==typeof c&&n>=c}],"filter-has":[Me,[Be],(s,[e])=>e.value in s.properties()],"filter-has-id":[Me,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[Me,[q(Oe)],(s,[e])=>e.value.indexOf(s.geometryType())>=0],"filter-id-in":[Me,[q(Be)],(s,[e])=>e.value.indexOf(s.id())>=0],"filter-in-small":[Me,[Oe,q(Be)],(s,[e,n])=>n.value.indexOf(s.properties()[e.value])>=0],"filter-in-large":[Me,[Oe,q(Be)],(s,[e,n])=>function(c,f,v,x){for(;v<=x;){const b=v+x>>1;if(f[b]===c)return!0;f[b]>c?x=b-1:v=b+1}return!1}(s.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Me,overloads:[[[Me,Me],(s,[e,n])=>e.evaluate(s)&&n.evaluate(s)],[On(Me),(s,e)=>{for(const n of e)if(!n.evaluate(s))return!1;return!0}]]},any:{type:Me,overloads:[[[Me,Me],(s,[e,n])=>e.evaluate(s)||n.evaluate(s)],[On(Me),(s,e)=>{for(const n of e)if(n.evaluate(s))return!0;return!1}]]},"!":[Me,[Me],(s,[e])=>!e.evaluate(s)],"is-supported-script":[Me,[Oe],(s,[e])=>{const n=s.globals&&s.globals.isSupportedScript;return!n||n(e.evaluate(s))}],upcase:[Oe,[Oe],(s,[e])=>e.evaluate(s).toUpperCase()],downcase:[Oe,[Oe],(s,[e])=>e.evaluate(s).toLowerCase()],concat:[Oe,On(Be),(s,e)=>e.map(n=>Na(n.evaluate(s))).join("")],"resolved-locale":[Oe,[Rn],(s,[e])=>e.evaluate(s).resolvedLocale()]});class Ti{constructor(e,n){var c;this.expression=e,this._warningHistory={},this._evaluator=new pi,this._defaultValue=n?(c=n).type==="color"&&Vo(c.default)?new fi(0,0,0,0):c.type==="color"?fi.parse(c.default)||null:c.type==="padding"?js.parse(c.default)||null:c.type==="variableAnchorOffsetCollection"?mr.parse(c.default)||null:c.default===void 0?null:c.default:null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,c,f,v,x){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=c,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(e,n,c,f,v,x){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=c||null,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x||null;try{const b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new Li(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function xi(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in na}function Fn(s,e){const n=new Io(na,Ua,[],e?function(f){const v={color:ui,string:Oe,number:Zt,enum:Oe,boolean:Me,formatted:os,padding:Y,resolvedImage:F,variableAnchorOffsetCollection:N};return f.type==="array"?q(v[f.value]||Be,f.length):v[f.type]}(e):void 0),c=n.parse(s,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?eu(new Ti(c,e)):aa(n.errors)}class Uo{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!qa(n.expression)}evaluateWithoutErrorHandling(e,n,c,f,v,x){return this._styleExpression.evaluateWithoutErrorHandling(e,n,c,f,v,x)}evaluate(e,n,c,f,v,x){return this._styleExpression.evaluate(e,n,c,f,v,x)}}class oc{constructor(e,n,c,f){this.kind=e,this.zoomStops=c,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!qa(n.expression),this.interpolationType=f}evaluateWithoutErrorHandling(e,n,c,f,v,x){return this._styleExpression.evaluateWithoutErrorHandling(e,n,c,f,v,x)}evaluate(e,n,c,f,v,x){return this._styleExpression.evaluate(e,n,c,f,v,x)}interpolationFactor(e,n,c){return this.interpolationType?Es.interpolationFactor(this.interpolationType,e,n,c):0}}function ru(s,e){const n=Fn(s,e);if(n.result==="error")return n;const c=n.value.expression,f=zo(c);if(!f&&!oa(e))return aa([new Pi("","data expressions not supported")]);const v=ja(c,["zoom"]);if(!v&&!iu(e))return aa([new Pi("","zoom expressions not supported")]);const x=jo(c);return x||v?x instanceof Pi?aa([x]):x instanceof Es&&!nc(e)?aa([new Pi("",'"interpolate" expressions cannot be used with this property')]):eu(x?new oc(f?"camera":"composite",n.value,x.labels,x instanceof Es?x.interpolation:void 0):new Uo(f?"constant":"source",n.value)):aa([new Pi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class qo{constructor(e,n){this._parameters=e,this._specification=n,_i(this,su(this._parameters,this._specification))}static deserialize(e){return new qo(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function jo(s){let e=null;if(s instanceof Fo)e=jo(s.result);else if(s instanceof Oo){for(const n of s.args)if(e=jo(n),e)break}else(s instanceof Ha||s instanceof Es)&&s.input instanceof sr&&s.input.name==="zoom"&&(e=s);return e instanceof Pi||s.eachChild(n=>{const c=jo(n);c instanceof Pi?e=c:!e&&c?e=new Pi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&c&&e!==c&&(e=new Pi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Go(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const e of s.slice(1))if(!Go(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const nu={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ho(s){if(s==null)return{filter:()=>!0,needGeometry:!1};Go(s)||(s=Zo(s));const e=Fn(s,nu);if(e.result==="error")throw new Error(e.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,c,f)=>e.value.evaluate(n,c,{},f),needGeometry:Wo(s)}}function au(s,e){return s<e?-1:s>e?1:0}function Wo(s){if(!Array.isArray(s))return!1;if(s[0]==="within")return!0;for(let e=1;e<s.length;e++)if(Wo(s[e]))return!0;return!1}function Zo(s){if(!s)return!0;const e=s[0];return s.length<=1?e!=="any":e==="=="?lc(s[1],s[2],"=="):e==="!="?Ko(lc(s[1],s[2],"==")):e==="<"||e===">"||e==="<="||e===">="?lc(s[1],s[2],e):e==="any"?(n=s.slice(1),["any"].concat(n.map(Zo))):e==="all"?["all"].concat(s.slice(1).map(Zo)):e==="none"?["all"].concat(s.slice(1).map(Zo).map(Ko)):e==="in"?ou(s[1],s.slice(2)):e==="!in"?Ko(ou(s[1],s.slice(2))):e==="has"?lu(s[1]):e==="!has"?Ko(lu(s[1])):e!=="within"||s;var n}function lc(s,e,n){switch(s){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,s,e]}}function ou(s,e){if(e.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",s,["literal",e.sort(au)]]:["filter-in-small",s,["literal",e]]}}function lu(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function Ko(s){return["!",s]}function cc(s){const e=typeof s;if(e==="number"||e==="boolean"||e==="string"||s==null)return JSON.stringify(s);if(Array.isArray(s)){let f="[";for(const v of s)f+=`${cc(v)},`;return`${f}]`}const n=Object.keys(s).sort();let c="{";for(let f=0;f<n.length;f++)c+=`${JSON.stringify(n[f])}:${cc(s[n[f]])},`;return`${c}}`}function Sf(s){let e="";for(const n of Jt)e+=`/${cc(s[n])}`;return e}function cu(s){const e=s.value;return e?[new zt(s.key,e,"constants have been deprecated as of v8")]:[]}function $i(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function dn(s){if(Array.isArray(s))return s.map(dn);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const e={};for(const n in s)e[n]=dn(s[n]);return e}return $i(s)}function zs(s){const e=s.key,n=s.value,c=s.valueSpec||{},f=s.objectElementValidators||{},v=s.style,x=s.styleSpec,b=s.validateSpec;let S=[];const E=ri(n);if(E!=="object")return[new zt(e,n,`object expected, ${E} found`)];for(const D in n){const R=D.split(".")[0],B=c[R]||c["*"];let $;if(f[R])$=f[R];else if(c[R])$=b;else if(f["*"])$=f["*"];else{if(!c["*"]){S.push(new zt(e,n[D],`unknown property "${D}"`));continue}$=b}S=S.concat($({key:(e&&`${e}.`)+D,value:n[D],valueSpec:B,style:v,styleSpec:x,object:n,objectKey:D,validateSpec:b},n))}for(const D in c)f[D]||c[D].required&&c[D].default===void 0&&n[D]===void 0&&S.push(new zt(e,n,`missing required property "${D}"`));return S}function hc(s){const e=s.value,n=s.valueSpec,c=s.style,f=s.styleSpec,v=s.key,x=s.arrayElementValidator||s.validateSpec;if(ri(e)!=="array")return[new zt(v,e,`array expected, ${ri(e)} found`)];if(n.length&&e.length!==n.length)return[new zt(v,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new zt(v,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let b={type:n.value,values:n.values};f.$version<7&&(b.function=n.function),ri(n.value)==="object"&&(b=n.value);let S=[];for(let E=0;E<e.length;E++)S=S.concat(x({array:e,arrayIndex:E,value:e[E],valueSpec:b,validateSpec:s.validateSpec,style:c,styleSpec:f,key:`${v}[${E}]`}));return S}function Xo(s){const e=s.key,n=s.value,c=s.valueSpec;let f=ri(n);return f==="number"&&n!=n&&(f="NaN"),f!=="number"?[new zt(e,n,`number expected, ${f} found`)]:"minimum"in c&&n<c.minimum?[new zt(e,n,`${n} is less than the minimum value ${c.minimum}`)]:"maximum"in c&&n>c.maximum?[new zt(e,n,`${n} is greater than the maximum value ${c.maximum}`)]:[]}function hu(s){const e=s.valueSpec,n=$i(s.value.type);let c,f,v,x={};const b=n!=="categorical"&&s.value.property===void 0,S=!b,E=ri(s.value.stops)==="array"&&ri(s.value.stops[0])==="array"&&ri(s.value.stops[0][0])==="object",D=zs({key:s.key,value:s.value,valueSpec:s.styleSpec.function,validateSpec:s.validateSpec,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function($){if(n==="identity")return[new zt($.key,$.value,'identity function may not have a "stops" property')];let U=[];const G=$.value;return U=U.concat(hc({key:$.key,value:G,valueSpec:$.valueSpec,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec,arrayElementValidator:R})),ri(G)==="array"&&G.length===0&&U.push(new zt($.key,G,"array must have at least one stop")),U},default:function($){return $.validateSpec({key:$.key,value:$.value,valueSpec:e,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec})}}});return n==="identity"&&b&&D.push(new zt(s.key,s.value,'missing required property "property"')),n==="identity"||s.value.stops||D.push(new zt(s.key,s.value,'missing required property "stops"')),n==="exponential"&&s.valueSpec.expression&&!nc(s.valueSpec)&&D.push(new zt(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(S&&!oa(s.valueSpec)?D.push(new zt(s.key,s.value,"property functions not supported")):b&&!iu(s.valueSpec)&&D.push(new zt(s.key,s.value,"zoom functions not supported"))),n!=="categorical"&&!E||s.value.property!==void 0||D.push(new zt(s.key,s.value,'"property" property is required')),D;function R($){let U=[];const G=$.value,X=$.key;if(ri(G)!=="array")return[new zt(X,G,`array expected, ${ri(G)} found`)];if(G.length!==2)return[new zt(X,G,`array length 2 expected, length ${G.length} found`)];if(E){if(ri(G[0])!=="object")return[new zt(X,G,`object expected, ${ri(G[0])} found`)];if(G[0].zoom===void 0)return[new zt(X,G,"object stop key must have zoom")];if(G[0].value===void 0)return[new zt(X,G,"object stop key must have value")];if(v&&v>$i(G[0].zoom))return[new zt(X,G[0].zoom,"stop zoom values must appear in ascending order")];$i(G[0].zoom)!==v&&(v=$i(G[0].zoom),f=void 0,x={}),U=U.concat(zs({key:`${X}[0]`,value:G[0],valueSpec:{zoom:{}},validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec,objectElementValidators:{zoom:Xo,value:B}}))}else U=U.concat(B({key:`${X}[0]`,value:G[0],valueSpec:{},validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec},G));return xi(dn(G[1]))?U.concat([new zt(`${X}[1]`,G[1],"expressions are not allowed in function stops.")]):U.concat($.validateSpec({key:`${X}[1]`,value:G[1],valueSpec:e,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec}))}function B($,U){const G=ri($.value),X=$i($.value),st=$.value!==null?$.value:U;if(c){if(G!==c)return[new zt($.key,st,`${G} stop domain type must match previous stop domain type ${c}`)]}else c=G;if(G!=="number"&&G!=="string"&&G!=="boolean")return[new zt($.key,st,"stop domain value must be a number, string, or boolean")];if(G!=="number"&&n!=="categorical"){let gt=`number expected, ${G} found`;return oa(e)&&n===void 0&&(gt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new zt($.key,st,gt)]}return n!=="categorical"||G!=="number"||isFinite(X)&&Math.floor(X)===X?n!=="categorical"&&G==="number"&&f!==void 0&&X<f?[new zt($.key,st,"stop domain values must appear in ascending order")]:(f=X,n==="categorical"&&X in x?[new zt($.key,st,"stop domain values must be unique")]:(x[X]=!0,[])):[new zt($.key,st,`integer expected, found ${X}`)]}}function fn(s){const e=(s.expressionContext==="property"?ru:Fn)(dn(s.value),s.valueSpec);if(e.result==="error")return e.value.map(c=>new zt(`${s.key}${c.key}`,s.value,c.message));const n=e.value.expression||e.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!n.outputDefined())return[new zt(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!qa(n))return[new zt(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter"&&!qa(n))return[new zt(s.key,s.value,'"feature-state" data expressions are not supported with filters.')];if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!ja(n,["zoom","feature-state"]))return[new zt(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!zo(n))return[new zt(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function pn(s){const e=s.key,n=s.value,c=s.valueSpec,f=[];return Array.isArray(c.values)?c.values.indexOf($i(n))===-1&&f.push(new zt(e,n,`expected one of [${c.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(c.values).indexOf($i(n))===-1&&f.push(new zt(e,n,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(n)} found`)),f}function la(s){return Go(dn(s.value))?fn(_i({},s,{expressionContext:"filter",valueSpec:{value:"boolean"}})):uc(s)}function uc(s){const e=s.value,n=s.key;if(ri(e)!=="array")return[new zt(n,e,`array expected, ${ri(e)} found`)];const c=s.styleSpec;let f,v=[];if(e.length<1)return[new zt(n,e,"filter array must have at least 1 element")];switch(v=v.concat(pn({key:`${n}[0]`,value:e[0],valueSpec:c.filter_operator,style:s.style,styleSpec:s.styleSpec})),$i(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&$i(e[1])==="$type"&&v.push(new zt(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&v.push(new zt(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(f=ri(e[1]),f!=="string"&&v.push(new zt(`${n}[1]`,e[1],`string expected, ${f} found`)));for(let x=2;x<e.length;x++)f=ri(e[x]),$i(e[1])==="$type"?v=v.concat(pn({key:`${n}[${x}]`,value:e[x],valueSpec:c.geometry_type,style:s.style,styleSpec:s.styleSpec})):f!=="string"&&f!=="number"&&f!=="boolean"&&v.push(new zt(`${n}[${x}]`,e[x],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let x=1;x<e.length;x++)v=v.concat(uc({key:`${n}[${x}]`,value:e[x],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":f=ri(e[1]),e.length!==2?v.push(new zt(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):f!=="string"&&v.push(new zt(`${n}[1]`,e[1],`string expected, ${f} found`));break;case"within":f=ri(e[1]),e.length!==2?v.push(new zt(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):f!=="object"&&v.push(new zt(`${n}[1]`,e[1],`object expected, ${f} found`))}return v}function Yo(s,e){const n=s.key,c=s.validateSpec,f=s.style,v=s.styleSpec,x=s.value,b=s.objectKey,S=v[`${e}_${s.layerType}`];if(!S)return[];const E=b.match(/^(.*)-transition$/);if(e==="paint"&&E&&S[E[1]]&&S[E[1]].transition)return c({key:n,value:x,valueSpec:v.transition,style:f,styleSpec:v});const D=s.valueSpec||S[b];if(!D)return[new zt(n,x,`unknown property "${b}"`)];let R;if(ri(x)==="string"&&oa(D)&&!D.tokens&&(R=/^{([^}]+)}$/.exec(x)))return[new zt(n,x,`"${b}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(R[1])} }\`.`)];const B=[];return s.layerType==="symbol"&&(b==="text-field"&&f&&!f.glyphs&&B.push(new zt(n,x,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&Vo(dn(x))&&$i(x.type)==="identity"&&B.push(new zt(n,x,'"text-font" does not support identity functions'))),B.concat(c({key:s.key,value:x,valueSpec:D,style:f,styleSpec:v,expressionContext:"property",propertyType:e,propertyKey:b}))}function dc(s){return Yo(s,"paint")}function fc(s){return Yo(s,"layout")}function Za(s){let e=[];const n=s.value,c=s.key,f=s.style,v=s.styleSpec;n.type||n.ref||e.push(new zt(c,n,'either "type" or "ref" is required'));let x=$i(n.type);const b=$i(n.ref);if(n.id){const S=$i(n.id);for(let E=0;E<s.arrayIndex;E++){const D=f.layers[E];$i(D.id)===S&&e.push(new zt(c,n.id,`duplicate layer id "${n.id}", previously used at line ${D.id.__line__}`))}}if("ref"in n){let S;["type","source","source-layer","filter","layout"].forEach(E=>{E in n&&e.push(new zt(c,n[E],`"${E}" is prohibited for ref layers`))}),f.layers.forEach(E=>{$i(E.id)===b&&(S=E)}),S?S.ref?e.push(new zt(c,n.ref,"ref cannot reference another ref layer")):x=$i(S.type):e.push(new zt(c,n.ref,`ref layer "${b}" not found`))}else if(x!=="background")if(n.source){const S=f.sources&&f.sources[n.source],E=S&&$i(S.type);S?E==="vector"&&x==="raster"?e.push(new zt(c,n.source,`layer "${n.id}" requires a raster source`)):E!=="raster-dem"&&x==="hillshade"?e.push(new zt(c,n.source,`layer "${n.id}" requires a raster-dem source`)):E==="raster"&&x!=="raster"?e.push(new zt(c,n.source,`layer "${n.id}" requires a vector source`)):E!=="vector"||n["source-layer"]?E==="raster-dem"&&x!=="hillshade"?e.push(new zt(c,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!n.paint||!n.paint["line-gradient"]||E==="geojson"&&S.lineMetrics||e.push(new zt(c,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new zt(c,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new zt(c,n.source,`source "${n.source}" not found`))}else e.push(new zt(c,n,'missing required property "source"'));return e=e.concat(zs({key:c,value:n,valueSpec:v.layer,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,objectElementValidators:{"*":()=>[],type:()=>s.validateSpec({key:`${c}.type`,value:n.type,valueSpec:v.layer.type,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,object:n,objectKey:"type"}),filter:la,layout:S=>zs({layer:n,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":E=>fc(_i({layerType:x},E))}}),paint:S=>zs({layer:n,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":E=>dc(_i({layerType:x},E))}})}})),e}function Bn(s){const e=s.value,n=s.key,c=ri(e);return c!=="string"?[new zt(n,e,`string expected, ${c} found`)]:[]}const uu={promoteId:function({key:s,value:e}){if(ri(e)==="string")return Bn({key:s,value:e});{const n=[];for(const c in e)n.push(...Bn({key:`${s}.${c}`,value:e[c]}));return n}}};function du(s){const e=s.value,n=s.key,c=s.styleSpec,f=s.style,v=s.validateSpec;if(!e.type)return[new zt(n,e,'"type" is required')];const x=$i(e.type);let b;switch(x){case"vector":case"raster":return b=zs({key:n,value:e,valueSpec:c[`source_${x.replace("-","_")}`],style:s.style,styleSpec:c,objectElementValidators:uu,validateSpec:v}),b;case"raster-dem":return b=function(S){var E;const D=(E=S.sourceName)!==null&&E!==void 0?E:"",R=S.value,B=S.styleSpec,$=B.source_raster_dem,U=S.style;let G=[];const X=ri(R);if(R===void 0)return G;if(X!=="object")return G.push(new zt("source_raster_dem",R,`object expected, ${X} found`)),G;const st=$i(R.encoding)==="custom",gt=["redFactor","greenFactor","blueFactor","baseShift"],nt=S.value.encoding?`"${S.value.encoding}"`:"Default";for(const ft in R)!st&&gt.includes(ft)?G.push(new zt(ft,R[ft],`In "${D}": "${ft}" is only valid when "encoding" is set to "custom". ${nt} encoding found`)):$[ft]?G=G.concat(S.validateSpec({key:ft,value:R[ft],valueSpec:$[ft],validateSpec:S.validateSpec,style:U,styleSpec:B})):G.push(new zt(ft,R[ft],`unknown property "${ft}"`));return G}({sourceName:n,value:e,style:s.style,styleSpec:c,validateSpec:v}),b;case"geojson":if(b=zs({key:n,value:e,valueSpec:c.source_geojson,style:f,styleSpec:c,validateSpec:v,objectElementValidators:uu}),e.cluster)for(const S in e.clusterProperties){const[E,D]=e.clusterProperties[S],R=typeof E=="string"?[E,["accumulated"],["get",S]]:E;b.push(...fn({key:`${n}.${S}.map`,value:D,validateSpec:v,expressionContext:"cluster-map"})),b.push(...fn({key:`${n}.${S}.reduce`,value:R,validateSpec:v,expressionContext:"cluster-reduce"}))}return b;case"video":return zs({key:n,value:e,valueSpec:c.source_video,style:f,validateSpec:v,styleSpec:c});case"image":return zs({key:n,value:e,valueSpec:c.source_image,style:f,validateSpec:v,styleSpec:c});case"canvas":return[new zt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return pn({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:f,validateSpec:v,styleSpec:c})}}function fu(s){const e=s.value,n=s.styleSpec,c=n.light,f=s.style;let v=[];const x=ri(e);if(e===void 0)return v;if(x!=="object")return v=v.concat([new zt("light",e,`object expected, ${x} found`)]),v;for(const b in e){const S=b.match(/^(.*)-transition$/);v=v.concat(S&&c[S[1]]&&c[S[1]].transition?s.validateSpec({key:b,value:e[b],valueSpec:n.transition,validateSpec:s.validateSpec,style:f,styleSpec:n}):c[b]?s.validateSpec({key:b,value:e[b],valueSpec:c[b],validateSpec:s.validateSpec,style:f,styleSpec:n}):[new zt(b,e[b],`unknown property "${b}"`)])}return v}function pu(s){const e=s.value,n=s.styleSpec,c=n.sky,f=s.style,v=ri(e);if(e===void 0)return[];if(v!=="object")return[new zt("sky",e,`object expected, ${v} found`)];let x=[];for(const b in e)x=x.concat(c[b]?$r({key:b,value:e[b],valueSpec:c[b],style:f,styleSpec:n}):[new zt(b,e[b],`unknown property "${b}"`)]);return x}function Ka(s){const e=s.value,n=s.styleSpec,c=n.terrain,f=s.style;let v=[];const x=ri(e);if(e===void 0)return v;if(x!=="object")return v=v.concat([new zt("terrain",e,`object expected, ${x} found`)]),v;for(const b in e)v=v.concat(c[b]?s.validateSpec({key:b,value:e[b],valueSpec:c[b],validateSpec:s.validateSpec,style:f,styleSpec:n}):[new zt(b,e[b],`unknown property "${b}"`)]);return v}function Xa(s){let e=[];const n=s.value,c=s.key;if(Array.isArray(n)){const f=[],v=[];for(const x in n)n[x].id&&f.includes(n[x].id)&&e.push(new zt(c,n,`all the sprites' ids must be unique, but ${n[x].id} is duplicated`)),f.push(n[x].id),n[x].url&&v.includes(n[x].url)&&e.push(new zt(c,n,`all the sprites' URLs must be unique, but ${n[x].url} is duplicated`)),v.push(n[x].url),e=e.concat(zs({key:`${c}[${x}]`,value:n[x],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:s.validateSpec}));return e}return Bn({key:c,value:n})}const Gs={"*":()=>[],array:hc,boolean:function(s){const e=s.value,n=s.key,c=ri(e);return c!=="boolean"?[new zt(n,e,`boolean expected, ${c} found`)]:[]},number:Xo,color:function(s){const e=s.key,n=s.value,c=ri(n);return c!=="string"?[new zt(e,n,`color expected, ${c} found`)]:fi.parse(String(n))?[]:[new zt(e,n,`color expected, "${n}" found`)]},constants:cu,enum:pn,filter:la,function:hu,layer:Za,object:zs,source:du,light:fu,sky:pu,terrain:Ka,string:Bn,formatted:function(s){return Bn(s).length===0?[]:fn(s)},resolvedImage:function(s){return Bn(s).length===0?[]:fn(s)},padding:function(s){const e=s.key,n=s.value;if(ri(n)==="array"){if(n.length<1||n.length>4)return[new zt(e,n,`padding requires 1 to 4 values; ${n.length} values found`)];const c={type:"number"};let f=[];for(let v=0;v<n.length;v++)f=f.concat(s.validateSpec({key:`${e}[${v}]`,value:n[v],validateSpec:s.validateSpec,valueSpec:c}));return f}return Xo({key:e,value:n,valueSpec:{}})},variableAnchorOffsetCollection:function(s){const e=s.key,n=s.value,c=ri(n),f=s.styleSpec;if(c!=="array"||n.length<1||n.length%2!=0)return[new zt(e,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let v=[];for(let x=0;x<n.length;x+=2)v=v.concat(pn({key:`${e}[${x}]`,value:n[x],valueSpec:f.layout_symbol["text-anchor"]})),v=v.concat(hc({key:`${e}[${x+1}]`,value:n[x+1],valueSpec:{length:2,value:"number"},validateSpec:s.validateSpec,style:s.style,styleSpec:f}));return v},sprite:Xa};function $r(s){const e=s.value,n=s.valueSpec,c=s.styleSpec;return s.validateSpec=$r,n.expression&&Vo($i(e))?hu(s):n.expression&&xi(dn(e))?fn(s):n.type&&Gs[n.type]?Gs[n.type](s):zs(_i({},s,{valueSpec:n.type?c[n.type]:n}))}function pc(s){const e=s.value,n=s.key,c=Bn(s);return c.length||(e.indexOf("{fontstack}")===-1&&c.push(new zt(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&c.push(new zt(n,e,'"glyphs" url must include a "{range}" token'))),c}function Ir(s,e=it){let n=[];return n=n.concat($r({key:"",value:s,valueSpec:e.$root,styleSpec:e,style:s,validateSpec:$r,objectElementValidators:{glyphs:pc,"*":()=>[]}})),s.constants&&(n=n.concat(cu({key:"constants",value:s.constants,style:s,styleSpec:e,validateSpec:$r}))),ca(n)}function Vr(s){return function(e){return s({...e,validateSpec:$r})}}function ca(s){return[].concat(s).sort((e,n)=>e.line-n.line)}function Pr(s){return function(...e){return ca(s.apply(this,e))}}Ir.source=Pr(Vr(du)),Ir.sprite=Pr(Vr(Xa)),Ir.glyphs=Pr(Vr(pc)),Ir.light=Pr(Vr(fu)),Ir.sky=Pr(Vr(pu)),Ir.terrain=Pr(Vr(Ka)),Ir.layer=Pr(Vr(Za)),Ir.filter=Pr(Vr(la)),Ir.paintProperty=Pr(Vr(dc)),Ir.layoutProperty=Pr(Vr(fc));const Nn=Ir,Tf=Nn.light,mc=Nn.paintProperty,Af=Nn.layoutProperty;function ha(s,e){let n=!1;if(e&&e.length)for(const c of e)s.fire(new Mt(new Error(c.message))),n=!0;return n}class Ya{constructor(e,n,c){const f=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const x=new Int32Array(this.arrayBuffer);e=x[0],this.d=(n=x[1])+2*(c=x[2]);for(let S=0;S<this.d*this.d;S++){const E=x[3+S],D=x[3+S+1];f.push(E===D?null:x.subarray(E,D))}const b=x[3+f.length+1];this.keys=x.subarray(x[3+f.length],b),this.bboxes=x.subarray(b),this.insert=this._insertReadonly}else{this.d=n+2*c;for(let x=0;x<this.d*this.d;x++)f.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=e,this.padding=c,this.scale=n/e,this.uid=0;const v=c/n*e;this.min=-v,this.max=e+v}insert(e,n,c,f,v){this._forEachCell(n,c,f,v,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(n),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(v)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,n,c,f,v,x){this.cells[v].push(x)}query(e,n,c,f,v){const x=this.min,b=this.max;if(e<=x&&n<=x&&b<=c&&b<=f&&!v)return Array.prototype.slice.call(this.keys);{const S=[];return this._forEachCell(e,n,c,f,this._queryCell,S,{},v),S}}_queryCell(e,n,c,f,v,x,b,S){const E=this.cells[v];if(E!==null){const D=this.keys,R=this.bboxes;for(let B=0;B<E.length;B++){const $=E[B];if(b[$]===void 0){const U=4*$;(S?S(R[U+0],R[U+1],R[U+2],R[U+3]):e<=R[U+2]&&n<=R[U+3]&&c>=R[U+0]&&f>=R[U+1])?(b[$]=!0,x.push(D[$])):b[$]=!1}}}}_forEachCell(e,n,c,f,v,x,b,S){const E=this._convertToCellCoord(e),D=this._convertToCellCoord(n),R=this._convertToCellCoord(c),B=this._convertToCellCoord(f);for(let $=E;$<=R;$++)for(let U=D;U<=B;U++){const G=this.d*U+$;if((!S||S(this._convertFromCellCoord($),this._convertFromCellCoord(U),this._convertFromCellCoord($+1),this._convertFromCellCoord(U+1)))&&v.call(this,e,n,c,f,G,x,b,S))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,n=3+this.cells.length+1+1;let c=0;for(let x=0;x<this.cells.length;x++)c+=this.cells[x].length;const f=new Int32Array(n+c+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;let v=n;for(let x=0;x<e.length;x++){const b=e[x];f[3+x]=v,f.set(b,v),v+=b.length}return f[3+e.length]=v,f.set(this.keys,v),v+=this.keys.length,f[3+e.length+1]=v,f.set(this.bboxes,v),v+=this.bboxes.length,f.buffer}static serialize(e,n){const c=e.toArrayBuffer();return n&&n.push(c),{buffer:c}}static deserialize(e){return new Ya(e.buffer)}}const Ur={};function he(s,e,n={}){if(Ur[s])throw new Error(`${s} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:s,writeable:!1}),Ur[s]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}he("Object",Object),he("TransferableGridIndex",Ya),he("Color",fi),he("Error",Error),he("AJAXError",ce),he("ResolvedImage",gr),he("StylePropertyFunction",qo),he("StyleExpression",Ti,{omit:["_evaluator"]}),he("ZoomDependentExpression",oc),he("ZoomConstantExpression",Uo),he("CompoundExpression",sr,{omit:["_evaluate"]});for(const s in na)na[s]._classRegistryKey||he(`Expression_${s}`,na[s]);function Jo(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function ua(s,e){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||s instanceof Error)return s;if(Jo(s)||ii(s))return e&&e.push(s),s;if(ArrayBuffer.isView(s)){const n=s;return e&&e.push(n.buffer),n}if(s instanceof ImageData)return e&&e.push(s.data.buffer),s;if(Array.isArray(s)){const n=[];for(const c of s)n.push(ua(c,e));return n}if(typeof s=="object"){const n=s.constructor,c=n._classRegistryKey;if(!c)throw new Error(`can't serialize object of unregistered class ${n.name}`);if(!Ur[c])throw new Error(`${c} is not registered.`);const f=n.serialize?n.serialize(s,e):{};if(n.serialize){if(e&&f===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const v in s){if(!s.hasOwnProperty(v)||Ur[c].omit.indexOf(v)>=0)continue;const x=s[v];f[v]=Ur[c].shallow.indexOf(v)>=0?x:ua(x,e)}s instanceof Error&&(f.message=s.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(f.$name=c),f}throw new Error("can't serialize object of type "+typeof s)}function da(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||s instanceof Error||Jo(s)||ii(s)||ArrayBuffer.isView(s)||s instanceof ImageData)return s;if(Array.isArray(s))return s.map(da);if(typeof s=="object"){const e=s.$name||"Object";if(!Ur[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:n}=Ur[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(s);const c=Object.create(n.prototype);for(const f of Object.keys(s)){if(f==="$name")continue;const v=s[f];c[f]=Ur[e].shallow.indexOf(f)>=0?v:da(v)}return c}throw new Error("can't deserialize object of type "+typeof s)}class mu{constructor(){this.first=!0}update(e,n){const c=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=n),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=c,!0))}}const ie={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function fa(s){for(const e of s)if(Qo(e.charCodeAt(0)))return!0;return!1}function gu(s){for(const e of s)if(!_u(e.charCodeAt(0)))return!1;return!0}function _u(s){return!(ie.Arabic(s)||ie["Arabic Supplement"](s)||ie["Arabic Extended-A"](s)||ie["Arabic Presentation Forms-A"](s)||ie["Arabic Presentation Forms-B"](s))}function Qo(s){return!(s!==746&&s!==747&&(s<4352||!(ie["Bopomofo Extended"](s)||ie.Bopomofo(s)||ie["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||ie["CJK Compatibility Ideographs"](s)||ie["CJK Compatibility"](s)||ie["CJK Radicals Supplement"](s)||ie["CJK Strokes"](s)||!(!ie["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||ie["CJK Unified Ideographs Extension A"](s)||ie["CJK Unified Ideographs"](s)||ie["Enclosed CJK Letters and Months"](s)||ie["Hangul Compatibility Jamo"](s)||ie["Hangul Jamo Extended-A"](s)||ie["Hangul Jamo Extended-B"](s)||ie["Hangul Jamo"](s)||ie["Hangul Syllables"](s)||ie.Hiragana(s)||ie["Ideographic Description Characters"](s)||ie.Kanbun(s)||ie["Kangxi Radicals"](s)||ie["Katakana Phonetic Extensions"](s)||ie.Katakana(s)&&s!==12540||!(!ie["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!ie["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||ie["Unified Canadian Aboriginal Syllabics"](s)||ie["Unified Canadian Aboriginal Syllabics Extended"](s)||ie["Vertical Forms"](s)||ie["Yijing Hexagram Symbols"](s)||ie["Yi Syllables"](s)||ie["Yi Radicals"](s))))}function gc(s){return!(Qo(s)||function(e){return!!(ie["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||ie["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||ie["Letterlike Symbols"](e)||ie["Number Forms"](e)||ie["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||ie["Control Pictures"](e)&&e!==9251||ie["Optical Character Recognition"](e)||ie["Enclosed Alphanumerics"](e)||ie["Geometric Shapes"](e)||ie["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ie["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ie["CJK Symbols and Punctuation"](e)||ie.Katakana(e)||ie["Private Use Area"](e)||ie["CJK Compatibility Forms"](e)||ie["Small Form Variants"](e)||ie["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(s))}function tl(s){return s>=1424&&s<=2303||ie["Arabic Presentation Forms-A"](s)||ie["Arabic Presentation Forms-B"](s)}function yu(s,e){return!(!e&&tl(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||ie.Khmer(s))}function Ef(s){for(const e of s)if(tl(e.charCodeAt(0)))return!0;return!1}const mn=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(s){this.pluginStatus=s.pluginStatus,this.pluginURL=s.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(s){this.applyArabicShaping=s.applyArabicShaping,this.processBidirectionalText=s.processBidirectionalText,this.processStyledBidirectionalText=s.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Di{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new mu,this.transition={})}isSupportedScript(e){return function(n,c){for(const f of n)if(!yu(f.charCodeAt(0),c))return!1;return!0}(e,mn.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,n=e-Math.floor(e),c=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*n}}}class Ja{constructor(e,n){this.property=e,this.value=n,this.expression=function(c,f){if(Vo(c))return new qo(c,f);if(xi(c)){const v=ru(c,f);if(v.result==="error")throw new Error(v.value.map(x=>`${x.key}: ${x.message}`).join(", "));return v.value}{let v=c;return f.type==="color"&&typeof c=="string"?v=fi.parse(c):f.type!=="padding"||typeof c!="number"&&!Array.isArray(c)?f.type==="variableAnchorOffsetCollection"&&Array.isArray(c)&&(v=mr.parse(c)):v=js.parse(c),{kind:"constant",evaluate:()=>v}}}(n===void 0?e.specification.default:n,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,c){return this.property.possiblyEvaluate(this,e,n,c)}}class el{constructor(e){this.property=e,this.value=new Ja(e,void 0)}transitioned(e,n){return new vu(this.property,this.value,n,oe({},e.transition,this.transition),e.now)}untransitioned(){return new vu(this.property,this.value,null,{},0)}}class _c{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Dt(this._values[e].value.value)}setValue(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new el(this._values[e].property)),this._values[e].value=new Ja(this._values[e].property,n===null?void 0:Dt(n))}getTransition(e){return Dt(this._values[e].transition)}setTransition(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new el(this._values[e].property)),this._values[e].transition=Dt(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const c=this.getValue(n);c!==void 0&&(e[n]=c);const f=this.getTransition(n);f!==void 0&&(e[`${n}-transition`]=f)}return e}transitioned(e,n){const c=new xu(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].transitioned(e,n._values[f]);return c}untransitioned(){const e=new xu(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class vu{constructor(e,n,c,f,v){this.property=e,this.value=n,this.begin=v+f.delay||0,this.end=this.begin+f.duration||0,e.specification.transition&&(f.delay||f.duration)&&(this.prior=c)}possiblyEvaluate(e,n,c){const f=e.now||0,v=this.value.possiblyEvaluate(e,n,c),x=this.prior;if(x){if(f>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(f<this.begin)return x.possiblyEvaluate(e,n,c);{const b=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(e,n,c),v,function(S){if(S<=0)return 0;if(S>=1)return 1;const E=S*S,D=E*S;return 4*(S<.5?D:3*(S-E)+D-.75)}(b))}}return v}}class xu{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,c){const f=new Qa(this._properties);for(const v of Object.keys(this._values))f._values[v]=this._values[v].possiblyEvaluate(e,n,c);return f}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class bu{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return Dt(this._values[e].value)}setValue(e,n){this._values[e]=new Ja(this._values[e].property,n===null?void 0:Dt(n))}serialize(){const e={};for(const n of Object.keys(this._values)){const c=this.getValue(n);c!==void 0&&(e[n]=c)}return e}possiblyEvaluate(e,n,c){const f=new Qa(this._properties);for(const v of Object.keys(this._values))f._values[v]=this._values[v].possiblyEvaluate(e,n,c);return f}}class Cr{constructor(e,n,c){this.property=e,this.value=n,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,c,f){return this.property.evaluate(this.value,this.parameters,e,n,c,f)}}class Qa{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ve{constructor(e){this.specification=e}possiblyEvaluate(e,n){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(n)}interpolate(e,n,c){const f=Rs[this.specification.type];return f?f(e,n,c):e}}class Te{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,c,f){return new Cr(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},c,f)}:e.expression,n)}interpolate(e,n,c){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new Cr(this,{kind:"constant",value:void 0},e.parameters);const f=Rs[this.specification.type];if(f){const v=f(e.value.value,n.value.value,c);return new Cr(this,{kind:"constant",value:v},e.parameters)}return e}evaluate(e,n,c,f,v,x){return e.kind==="constant"?e.value:e.evaluate(n,c,f,v,x)}}class il extends Te{possiblyEvaluate(e,n,c,f){if(e.value===void 0)return new Cr(this,{kind:"constant",value:void 0},n);if(e.expression.kind==="constant"){const v=e.expression.evaluate(n,null,{},c,f),x=e.property.specification.type==="resolvedImage"&&typeof v!="string"?v.name:v,b=this._calculate(x,x,x,n);return new Cr(this,{kind:"constant",value:b},n)}if(e.expression.kind==="camera"){const v=this._calculate(e.expression.evaluate({zoom:n.zoom-1}),e.expression.evaluate({zoom:n.zoom}),e.expression.evaluate({zoom:n.zoom+1}),n);return new Cr(this,{kind:"constant",value:v},n)}return new Cr(this,e.expression,n)}evaluate(e,n,c,f,v,x){if(e.kind==="source"){const b=e.evaluate(n,c,f,v,x);return this._calculate(b,b,b,n)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(n.zoom)-1},c,f),e.evaluate({zoom:Math.floor(n.zoom)},c,f),e.evaluate({zoom:Math.floor(n.zoom)+1},c,f),n):e.value}_calculate(e,n,c,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:c,to:n}}interpolate(e){return e}}class to{constructor(e){this.specification=e}possiblyEvaluate(e,n,c,f){if(e.value!==void 0){if(e.expression.kind==="constant"){const v=e.expression.evaluate(n,null,{},c,f);return this._calculate(v,v,v,n)}return this._calculate(e.expression.evaluate(new Di(Math.floor(n.zoom-1),n)),e.expression.evaluate(new Di(Math.floor(n.zoom),n)),e.expression.evaluate(new Di(Math.floor(n.zoom+1),n)),n)}}_calculate(e,n,c,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:c,to:n}}interpolate(e){return e}}class yc{constructor(e){this.specification=e}possiblyEvaluate(e,n,c,f){return!!e.expression.evaluate(n,null,{},c,f)}interpolate(){return!1}}class Hs{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in e){const c=e[n];c.specification.overridable&&this.overridableProperties.push(n);const f=this.defaultPropertyValues[n]=new Ja(c,void 0),v=this.defaultTransitionablePropertyValues[n]=new el(c);this.defaultTransitioningPropertyValues[n]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=f.possiblyEvaluate({})}}}he("DataDrivenProperty",Te),he("DataConstantProperty",ve),he("CrossFadedDataDrivenProperty",il),he("CrossFadedProperty",to),he("ColorRampProperty",yc);const vc="-transition";class Dr extends Ft{constructor(e,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new bu(n.layout)),n.paint)){this._transitionablePaint=new _c(n.paint);for(const c in e.paint)this.setPaintProperty(c,e.paint[c],{validate:!1});for(const c in e.layout)this.setLayoutProperty(c,e.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Qa(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,c={}){n!=null&&this._validate(Af,`layers.${this.id}.layout.${e}`,e,n,c)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return e.endsWith(vc)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,c={}){if(n!=null&&this._validate(mc,`layers.${this.id}.paint.${e}`,e,n,c))return!1;if(e.endsWith(vc))return this._transitionablePaint.setTransition(e.slice(0,-11),n||void 0),!1;{const f=this._transitionablePaint._values[e],v=f.property.specification["property-type"]==="cross-faded-data-driven",x=f.value.isDataDriven(),b=f.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const S=this._transitionablePaint._values[e].value;return S.isDataDriven()||x||v||this._handleOverridablePaintPropertyUpdate(e,b,S)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,n,c){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Gt(e,(n,c)=>!(n===void 0||c==="layout"&&!Object.keys(n).length||c==="paint"&&!Object.keys(n).length))}_validate(e,n,c,f,v={}){return(!v||v.validate!==!1)&&ha(this,e.call(Nn,{key:n,layerType:this.type,objectKey:c,value:f,styleSpec:it,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof Cr&&oa(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const wu={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class eo{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Vi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Xi(s,e=1){let n=0,c=0;return{members:s.map(f=>{const v=wu[f.type].BYTES_PER_ELEMENT,x=n=Mu(n,Math.max(e,v)),b=f.components||1;return c=Math.max(c,v),n+=v*b,{name:f.name,type:f.type,components:b,offset:x}}),size:Mu(n,Math.max(c,e)),alignment:e}}function Mu(s,e){return Math.ceil(s/e)*e}class io extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const c=this.length;return this.resize(c+1),this.emplace(c,e,n)}emplace(e,n,c){const f=2*e;return this.int16[f+0]=n,this.int16[f+1]=c,e}}io.prototype.bytesPerElement=4,he("StructArrayLayout2i4",io);class Yr extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,c)}emplace(e,n,c,f){const v=3*e;return this.int16[v+0]=n,this.int16[v+1]=c,this.int16[v+2]=f,e}}Yr.prototype.bytesPerElement=6,he("StructArrayLayout3i6",Yr);class xc extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,c,f){const v=this.length;return this.resize(v+1),this.emplace(v,e,n,c,f)}emplace(e,n,c,f,v){const x=4*e;return this.int16[x+0]=n,this.int16[x+1]=c,this.int16[x+2]=f,this.int16[x+3]=v,e}}xc.prototype.bytesPerElement=8,he("StructArrayLayout4i8",xc);class bc extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,c,f,v,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,c,f,v,x)}emplace(e,n,c,f,v,x,b){const S=6*e;return this.int16[S+0]=n,this.int16[S+1]=c,this.int16[S+2]=f,this.int16[S+3]=v,this.int16[S+4]=x,this.int16[S+5]=b,e}}bc.prototype.bytesPerElement=12,he("StructArrayLayout2i4i12",bc);class wc extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,c,f,v,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,c,f,v,x)}emplace(e,n,c,f,v,x,b){const S=4*e,E=8*e;return this.int16[S+0]=n,this.int16[S+1]=c,this.uint8[E+4]=f,this.uint8[E+5]=v,this.uint8[E+6]=x,this.uint8[E+7]=b,e}}wc.prototype.bytesPerElement=8,he("StructArrayLayout2i4ub8",wc);class so extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const c=this.length;return this.resize(c+1),this.emplace(c,e,n)}emplace(e,n,c){const f=2*e;return this.float32[f+0]=n,this.float32[f+1]=c,e}}so.prototype.bytesPerElement=8,he("StructArrayLayout2f8",so);class sl extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,c,f,v,x,b,S,E,D){const R=this.length;return this.resize(R+1),this.emplace(R,e,n,c,f,v,x,b,S,E,D)}emplace(e,n,c,f,v,x,b,S,E,D,R){const B=10*e;return this.uint16[B+0]=n,this.uint16[B+1]=c,this.uint16[B+2]=f,this.uint16[B+3]=v,this.uint16[B+4]=x,this.uint16[B+5]=b,this.uint16[B+6]=S,this.uint16[B+7]=E,this.uint16[B+8]=D,this.uint16[B+9]=R,e}}sl.prototype.bytesPerElement=20,he("StructArrayLayout10ui20",sl);class Mc extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,c,f,v,x,b,S,E,D,R,B){const $=this.length;return this.resize($+1),this.emplace($,e,n,c,f,v,x,b,S,E,D,R,B)}emplace(e,n,c,f,v,x,b,S,E,D,R,B,$){const U=12*e;return this.int16[U+0]=n,this.int16[U+1]=c,this.int16[U+2]=f,this.int16[U+3]=v,this.uint16[U+4]=x,this.uint16[U+5]=b,this.uint16[U+6]=S,this.uint16[U+7]=E,this.int16[U+8]=D,this.int16[U+9]=R,this.int16[U+10]=B,this.int16[U+11]=$,e}}Mc.prototype.bytesPerElement=24,he("StructArrayLayout4i4ui4i24",Mc);class Sc extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,c)}emplace(e,n,c,f){const v=3*e;return this.float32[v+0]=n,this.float32[v+1]=c,this.float32[v+2]=f,e}}Sc.prototype.bytesPerElement=12,he("StructArrayLayout3f12",Sc);class Jr extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}Jr.prototype.bytesPerElement=4,he("StructArrayLayout1ul4",Jr);class rl extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,c,f,v,x,b,S,E){const D=this.length;return this.resize(D+1),this.emplace(D,e,n,c,f,v,x,b,S,E)}emplace(e,n,c,f,v,x,b,S,E,D){const R=10*e,B=5*e;return this.int16[R+0]=n,this.int16[R+1]=c,this.int16[R+2]=f,this.int16[R+3]=v,this.int16[R+4]=x,this.int16[R+5]=b,this.uint32[B+3]=S,this.uint16[R+8]=E,this.uint16[R+9]=D,e}}rl.prototype.bytesPerElement=20,he("StructArrayLayout6i1ul2ui20",rl);class ro extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,c,f,v,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,c,f,v,x)}emplace(e,n,c,f,v,x,b){const S=6*e;return this.int16[S+0]=n,this.int16[S+1]=c,this.int16[S+2]=f,this.int16[S+3]=v,this.int16[S+4]=x,this.int16[S+5]=b,e}}ro.prototype.bytesPerElement=12,he("StructArrayLayout2i2i2i12",ro);class nl extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,c,f,v){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,c,f,v)}emplace(e,n,c,f,v,x){const b=4*e,S=8*e;return this.float32[b+0]=n,this.float32[b+1]=c,this.float32[b+2]=f,this.int16[S+6]=v,this.int16[S+7]=x,e}}nl.prototype.bytesPerElement=16,he("StructArrayLayout2f1f2i16",nl);class no extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,f){const v=this.length;return this.resize(v+1),this.emplace(v,e,n,c,f)}emplace(e,n,c,f,v){const x=12*e,b=3*e;return this.uint8[x+0]=n,this.uint8[x+1]=c,this.float32[b+1]=f,this.float32[b+2]=v,e}}no.prototype.bytesPerElement=12,he("StructArrayLayout2ub2f12",no);class al extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,c)}emplace(e,n,c,f){const v=3*e;return this.uint16[v+0]=n,this.uint16[v+1]=c,this.uint16[v+2]=f,e}}al.prototype.bytesPerElement=6,he("StructArrayLayout3ui6",al);class pa extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,f,v,x,b,S,E,D,R,B,$,U,G,X,st){const gt=this.length;return this.resize(gt+1),this.emplace(gt,e,n,c,f,v,x,b,S,E,D,R,B,$,U,G,X,st)}emplace(e,n,c,f,v,x,b,S,E,D,R,B,$,U,G,X,st,gt){const nt=24*e,ft=12*e,Et=48*e;return this.int16[nt+0]=n,this.int16[nt+1]=c,this.uint16[nt+2]=f,this.uint16[nt+3]=v,this.uint32[ft+2]=x,this.uint32[ft+3]=b,this.uint32[ft+4]=S,this.uint16[nt+10]=E,this.uint16[nt+11]=D,this.uint16[nt+12]=R,this.float32[ft+7]=B,this.float32[ft+8]=$,this.uint8[Et+36]=U,this.uint8[Et+37]=G,this.uint8[Et+38]=X,this.uint32[ft+10]=st,this.int16[nt+22]=gt,e}}pa.prototype.bytesPerElement=48,he("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",pa);class $n extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,f,v,x,b,S,E,D,R,B,$,U,G,X,st,gt,nt,ft,Et,kt,re,me,se,ee,Kt,ue){const te=this.length;return this.resize(te+1),this.emplace(te,e,n,c,f,v,x,b,S,E,D,R,B,$,U,G,X,st,gt,nt,ft,Et,kt,re,me,se,ee,Kt,ue)}emplace(e,n,c,f,v,x,b,S,E,D,R,B,$,U,G,X,st,gt,nt,ft,Et,kt,re,me,se,ee,Kt,ue,te){const Ut=32*e,we=16*e;return this.int16[Ut+0]=n,this.int16[Ut+1]=c,this.int16[Ut+2]=f,this.int16[Ut+3]=v,this.int16[Ut+4]=x,this.int16[Ut+5]=b,this.int16[Ut+6]=S,this.int16[Ut+7]=E,this.uint16[Ut+8]=D,this.uint16[Ut+9]=R,this.uint16[Ut+10]=B,this.uint16[Ut+11]=$,this.uint16[Ut+12]=U,this.uint16[Ut+13]=G,this.uint16[Ut+14]=X,this.uint16[Ut+15]=st,this.uint16[Ut+16]=gt,this.uint16[Ut+17]=nt,this.uint16[Ut+18]=ft,this.uint16[Ut+19]=Et,this.uint16[Ut+20]=kt,this.uint16[Ut+21]=re,this.uint16[Ut+22]=me,this.uint32[we+12]=se,this.float32[we+13]=ee,this.float32[we+14]=Kt,this.uint16[Ut+30]=ue,this.uint16[Ut+31]=te,e}}$n.prototype.bytesPerElement=64,he("StructArrayLayout8i15ui1ul2f2ui64",$n);class ol extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}ol.prototype.bytesPerElement=4,he("StructArrayLayout1f4",ol);class ll extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,c)}emplace(e,n,c,f){const v=3*e;return this.uint16[6*e+0]=n,this.float32[v+1]=c,this.float32[v+2]=f,e}}ll.prototype.bytesPerElement=12,he("StructArrayLayout1ui2f12",ll);class Vn extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,c)}emplace(e,n,c,f){const v=4*e;return this.uint32[2*e+0]=n,this.uint16[v+2]=c,this.uint16[v+3]=f,e}}Vn.prototype.bytesPerElement=8,he("StructArrayLayout1ul2ui8",Vn);class Tc extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const c=this.length;return this.resize(c+1),this.emplace(c,e,n)}emplace(e,n,c){const f=2*e;return this.uint16[f+0]=n,this.uint16[f+1]=c,e}}Tc.prototype.bytesPerElement=4,he("StructArrayLayout2ui4",Tc);class Ac extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}Ac.prototype.bytesPerElement=2,he("StructArrayLayout1ui2",Ac);class cl extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,f){const v=this.length;return this.resize(v+1),this.emplace(v,e,n,c,f)}emplace(e,n,c,f,v){const x=4*e;return this.float32[x+0]=n,this.float32[x+1]=c,this.float32[x+2]=f,this.float32[x+3]=v,e}}cl.prototype.bytesPerElement=16,he("StructArrayLayout4f16",cl);class Su extends eo{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new P(this.anchorPointX,this.anchorPointY)}}Su.prototype.size=20;class g extends rl{get(e){return new Su(this,e)}}he("CollisionBoxArray",g);class i extends eo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}i.prototype.size=48;class o extends pa{get(e){return new i(this,e)}}he("PlacedSymbolArray",o);class u extends eo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}u.prototype.size=64;class d extends $n{get(e){return new u(this,e)}}he("SymbolInstanceArray",d);class _ extends ol{getoffsetX(e){return this.float32[1*e+0]}}he("GlyphOffsetArray",_);class w extends Yr{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}he("SymbolLineVertexArray",w);class M extends eo{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}M.prototype.size=12;class A extends ll{get(e){return new M(this,e)}}he("TextAnchorOffsetArray",A);class C extends eo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}C.prototype.size=8;class z extends Vn{get(e){return new C(this,e)}}he("FeatureIndexArray",z);class O extends io{}class V extends io{}class Z extends io{}class W extends bc{}class J extends wc{}class j extends so{}class lt extends sl{}class xt extends Mc{}class et extends Sc{}class pt extends Jr{}class bt extends ro{}class wt extends no{}class St extends al{}class Bt extends Tc{}const Ot=Xi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Wt}=Ot;class Xt{constructor(e=[]){this.segments=e}prepareSegment(e,n,c,f){let v=this.segments[this.segments.length-1];return e>Xt.MAX_VERTEX_ARRAY_LENGTH&&De(`Max vertices per segment is ${Xt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!v||v.vertexLength+e>Xt.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==f)&&(v={vertexOffset:n.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},f!==void 0&&(v.sortKey=f),this.segments.push(v)),v}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,c,f){return new Xt([{vertexOffset:e,primitiveOffset:n,vertexLength:c,primitiveLength:f,vaos:{},sortKey:0}])}}function $e(s,e){return 256*(s=$t(Math.floor(s),0,255))+$t(Math.floor(e),0,255)}Xt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,he("SegmentVector",Xt);const Qt=Xi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Ee={exports:{}},Ve={exports:{}};Ve.exports=function(s,e){var n,c,f,v,x,b,S,E;for(c=s.length-(n=3&s.length),f=e,x=3432918353,b=461845907,E=0;E<c;)S=255&s.charCodeAt(E)|(255&s.charCodeAt(++E))<<8|(255&s.charCodeAt(++E))<<16|(255&s.charCodeAt(++E))<<24,++E,f=27492+(65535&(v=5*(65535&(f=(f^=S=(65535&(S=(S=(65535&S)*x+(((S>>>16)*x&65535)<<16)&4294967295)<<15|S>>>17))*b+(((S>>>16)*b&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(S=0,n){case 3:S^=(255&s.charCodeAt(E+2))<<16;case 2:S^=(255&s.charCodeAt(E+1))<<8;case 1:f^=S=(65535&(S=(S=(65535&(S^=255&s.charCodeAt(E)))*x+(((S>>>16)*x&65535)<<16)&4294967295)<<15|S>>>17))*b+(((S>>>16)*b&65535)<<16)&4294967295}return f^=s.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0};var ei=Ve.exports,Ce={exports:{}};Ce.exports=function(s,e){for(var n,c=s.length,f=e^c,v=0;c>=4;)n=1540483477*(65535&(n=255&s.charCodeAt(v)|(255&s.charCodeAt(++v))<<8|(255&s.charCodeAt(++v))<<16|(255&s.charCodeAt(++v))<<24))+((1540483477*(n>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),c-=4,++v;switch(c){case 3:f^=(255&s.charCodeAt(v+2))<<16;case 2:f^=(255&s.charCodeAt(v+1))<<8;case 1:f=1540483477*(65535&(f^=255&s.charCodeAt(v)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0};var qe=ei,He=Ce.exports;Ee.exports=qe,Ee.exports.murmur3=qe,Ee.exports.murmur2=He;var Ui=T(Ee.exports);class mi{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,c,f){this.ids.push(rr(e)),this.positions.push(n,c,f)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=rr(e);let c=0,f=this.ids.length-1;for(;c<f;){const x=c+f>>1;this.ids[x]>=n?f=x:c=x+1}const v=[];for(;this.ids[c]===n;)v.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return v}static serialize(e,n){const c=new Float64Array(e.ids),f=new Uint32Array(e.positions);return cs(c,f,0,c.length-1),n&&n.push(c.buffer,f.buffer),{ids:c,positions:f}}static deserialize(e){const n=new mi;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function rr(s){const e=+s;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Ui(String(s))}function cs(s,e,n,c){for(;n<c;){const f=s[n+c>>1];let v=n-1,x=c+1;for(;;){do v++;while(s[v]<f);do x--;while(s[x]>f);if(v>=x)break;Oi(s,v,x),Oi(e,3*v,3*x),Oi(e,3*v+1,3*x+1),Oi(e,3*v+2,3*x+2)}x-n<c-x?(cs(s,e,n,x),n=x+1):(cs(s,e,x+1,c),c=x)}}function Oi(s,e,n){const c=s[e];s[e]=s[n],s[n]=c}he("FeaturePositionMap",mi);class hs{constructor(e,n){this.gl=e.gl,this.location=n}}class nr extends hs{constructor(e,n){super(e,n),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class qr extends hs{constructor(e,n){super(e,n),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class gn extends hs{constructor(e,n){super(e,n),this.current=fi.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const ao=new Float32Array(16);function _n(s){return[$e(255*s.r,255*s.g),$e(255*s.b,255*s.a)]}class jr{constructor(e,n,c){this.value=e,this.uniformNames=n.map(f=>`u_${f}`),this.type=c}setUniform(e,n,c){e.set(c.constantOr(this.value))}getBinding(e,n,c){return this.type==="color"?new gn(e,n):new nr(e,n)}}class es{constructor(e,n){this.uniformNames=n.map(c=>`u_${c}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=e.tlbr}setUniform(e,n,c,f){const v=f==="u_pattern_to"?this.patternTo:f==="u_pattern_from"?this.patternFrom:f==="u_pixel_ratio_to"?this.pixelRatioTo:f==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&e.set(v)}getBinding(e,n,c){return c.substr(0,9)==="u_pattern"?new qr(e,n):new nr(e,n)}}class Fi{constructor(e,n,c,f){this.expression=e,this.type=c,this.maxValue=0,this.paintVertexAttributes=n.map(v=>({name:`a_${v}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,n,c,f,v){const x=this.paintVertexArray.length,b=this.expression.evaluate(new Di(0),n,{},f,[],v);this.paintVertexArray.resize(e),this._setPaintValue(x,e,b)}updatePaintArray(e,n,c,f){const v=this.expression.evaluate({zoom:0},c,f);this._setPaintValue(e,n,v)}_setPaintValue(e,n,c){if(this.type==="color"){const f=_n(c);for(let v=e;v<n;v++)this.paintVertexArray.emplace(v,f[0],f[1])}else{for(let f=e;f<n;f++)this.paintVertexArray.emplace(f,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ki{constructor(e,n,c,f,v,x){this.expression=e,this.uniformNames=n.map(b=>`u_${b}_t`),this.type=c,this.useIntegerZoom=f,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=n.map(b=>({name:`a_${b}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(e,n,c,f,v){const x=this.expression.evaluate(new Di(this.zoom),n,{},f,[],v),b=this.expression.evaluate(new Di(this.zoom+1),n,{},f,[],v),S=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(S,e,x,b)}updatePaintArray(e,n,c,f){const v=this.expression.evaluate({zoom:this.zoom},c,f),x=this.expression.evaluate({zoom:this.zoom+1},c,f);this._setPaintValue(e,n,v,x)}_setPaintValue(e,n,c,f){if(this.type==="color"){const v=_n(c),x=_n(f);for(let b=e;b<n;b++)this.paintVertexArray.emplace(b,v[0],v[1],x[0],x[1])}else{for(let v=e;v<n;v++)this.paintVertexArray.emplace(v,c,f);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(f))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n){const c=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,f=$t(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);e.set(f)}getBinding(e,n,c){return new nr(e,n)}}class _r{constructor(e,n,c,f,v,x){this.expression=e,this.type=n,this.useIntegerZoom=c,this.zoom=f,this.layerId=x,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v}populatePaintArray(e,n,c){const f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(f,e,n.patterns&&n.patterns[this.layerId],c)}updatePaintArray(e,n,c,f,v){this._setPaintValues(e,n,c.patterns&&c.patterns[this.layerId],v)}_setPaintValues(e,n,c,f){if(!f||!c)return;const{min:v,mid:x,max:b}=c,S=f[v],E=f[x],D=f[b];if(S&&E&&D)for(let R=e;R<n;R++)this.zoomInPaintVertexArray.emplace(R,E.tl[0],E.tl[1],E.br[0],E.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],E.pixelRatio,S.pixelRatio),this.zoomOutPaintVertexArray.emplace(R,E.tl[0],E.tl[1],E.br[0],E.br[1],D.tl[0],D.tl[1],D.br[0],D.br[1],E.pixelRatio,D.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Qt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Qt.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class is{constructor(e,n,c){this.binders={},this._buffers=[];const f=[];for(const v in e.paint._values){if(!c(v))continue;const x=e.paint.get(v);if(!(x instanceof Cr&&oa(x.property.specification)))continue;const b=yr(v,e.type),S=x.value,E=x.property.specification.type,D=x.property.useIntegerZoom,R=x.property.specification["property-type"],B=R==="cross-faded"||R==="cross-faded-data-driven";if(S.kind==="constant")this.binders[v]=B?new es(S.value,b):new jr(S.value,b,E),f.push(`/u_${v}`);else if(S.kind==="source"||B){const $=ss(v,E,"source");this.binders[v]=B?new _r(S,E,D,n,$,e.id):new Fi(S,b,E,$),f.push(`/a_${v}`)}else{const $=ss(v,E,"composite");this.binders[v]=new ki(S,b,E,D,n,$),f.push(`/z_${v}`)}}this.cacheKey=f.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof Fi||n instanceof ki?n.maxValue:0}populatePaintArrays(e,n,c,f,v){for(const x in this.binders){const b=this.binders[x];(b instanceof Fi||b instanceof ki||b instanceof _r)&&b.populatePaintArray(e,n,c,f,v)}}setConstantPatternPositions(e,n){for(const c in this.binders){const f=this.binders[c];f instanceof es&&f.setConstantPatternPositions(e,n)}}updatePaintArrays(e,n,c,f,v){let x=!1;for(const b in e){const S=n.getPositions(b);for(const E of S){const D=c.feature(E.index);for(const R in this.binders){const B=this.binders[R];if((B instanceof Fi||B instanceof ki||B instanceof _r)&&B.expression.isStateDependent===!0){const $=f.paint.get(R);B.expression=$.value,B.updatePaintArray(E.start,E.end,D,e[b],v),x=!0}}}}return x}defines(){const e=[];for(const n in this.binders){const c=this.binders[n];(c instanceof jr||c instanceof es)&&e.push(...c.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const c=this.binders[n];if(c instanceof Fi||c instanceof ki)for(let f=0;f<c.paintVertexAttributes.length;f++)e.push(c.paintVertexAttributes[f].name);else if(c instanceof _r)for(let f=0;f<Qt.members.length;f++)e.push(Qt.members[f].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const c=this.binders[n];if(c instanceof jr||c instanceof es||c instanceof ki)for(const f of c.uniformNames)e.push(f)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,n){const c=[];for(const f in this.binders){const v=this.binders[f];if(v instanceof jr||v instanceof es||v instanceof ki){for(const x of v.uniformNames)if(n[x]){const b=v.getBinding(e,n[x],x);c.push({name:x,property:f,binding:b})}}}return c}setUniforms(e,n,c,f){for(const{name:v,property:x,binding:b}of n)this.binders[x].setUniform(b,f,c.get(x),v)}updatePaintBuffers(e){this._buffers=[];for(const n in this.binders){const c=this.binders[n];if(e&&c instanceof _r){const f=e.fromScale===2?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(c instanceof Fi||c instanceof ki)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}}upload(e){for(const n in this.binders){const c=this.binders[n];(c instanceof Fi||c instanceof ki||c instanceof _r)&&c.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof Fi||n instanceof ki||n instanceof _r)&&n.destroy()}}}class Bi{constructor(e,n,c=()=>!0){this.programConfigurations={};for(const f of e)this.programConfigurations[f.id]=new is(f,n,c);this.needsUpload=!1,this._featureMap=new mi,this._bufferOffset=0}populatePaintArrays(e,n,c,f,v,x){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,n,f,v,x);n.id!==void 0&&this._featureMap.add(n.id,c,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,c,f){for(const v of c)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(e,this._featureMap,n,v,f)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function yr(s,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[s]||[s.replace(`${e}-`,"").replace(/-/g,"_")]}function ss(s,e,n){const c={color:{source:so,composite:cl},number:{source:ol,composite:so}},f=function(v){return{"line-pattern":{source:lt,composite:lt},"fill-pattern":{source:lt,composite:lt},"fill-extrusion-pattern":{source:lt,composite:lt}}[v]}(s);return f&&f[n]||c[e][n]}he("ConstantBinder",jr),he("CrossFadedConstantBinder",es),he("SourceExpressionBinder",Fi),he("CrossFadedCompositeBinder",_r),he("CompositeExpressionBinder",ki),he("ProgramConfiguration",is,{omit:["_buffers"]}),he("ProgramConfigurationSet",Bi);const Hi=8192,Ec=Math.pow(2,14)-1,Tu=-Ec-1;function Un(s){const e=Hi/s.extent,n=s.loadGeometry();for(let c=0;c<n.length;c++){const f=n[c];for(let v=0;v<f.length;v++){const x=f[v],b=Math.round(x.x*e),S=Math.round(x.y*e);x.x=$t(b,Tu,Ec),x.y=$t(S,Tu,Ec),(b<x.x||b>x.x+1||S<x.y||S>x.y+1)&&De("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function qn(s,e){return{type:s.type,id:s.id,properties:s.properties,geometry:e?Un(s):[]}}function hl(s,e,n,c,f){s.emplaceBack(2*e+(c+1)/2,2*n+(f+1)/2)}class yn{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new V,this.indexArray=new St,this.segments=new Xt,this.programConfigurations=new Bi(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,c){const f=this.layers[0],v=[];let x=null,b=!1;f.type==="circle"&&(x=f.layout.get("circle-sort-key"),b=!x.isConstant());for(const{feature:S,id:E,index:D,sourceLayerIndex:R}of e){const B=this.layers[0]._featureFilter.needGeometry,$=qn(S,B);if(!this.layers[0]._featureFilter.filter(new Di(this.zoom),$,c))continue;const U=b?x.evaluate($,{},c):void 0,G={id:E,properties:S.properties,type:S.type,sourceLayerIndex:R,index:D,geometry:B?$.geometry:Un(S),patterns:{},sortKey:U};v.push(G)}b&&v.sort((S,E)=>S.sortKey-E.sortKey);for(const S of v){const{geometry:E,index:D,sourceLayerIndex:R}=S,B=e[D].feature;this.addFeature(S,E,D,c),n.featureIndex.insert(B,E,D,R,this.index)}}update(e,n,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Wt),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,c,f){for(const v of n)for(const x of v){const b=x.x,S=x.y;if(b<0||b>=Hi||S<0||S>=Hi)continue;const E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),D=E.vertexLength;hl(this.layoutVertexArray,b,S,-1,-1),hl(this.layoutVertexArray,b,S,1,-1),hl(this.layoutVertexArray,b,S,1,1),hl(this.layoutVertexArray,b,S,-1,1),this.indexArray.emplaceBack(D,D+1,D+2),this.indexArray.emplaceBack(D,D+3,D+2),E.vertexLength+=4,E.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,{},f)}}function Ic(s,e){for(let n=0;n<s.length;n++)if(dl(e,s[n]))return!0;for(let n=0;n<e.length;n++)if(dl(s,e[n]))return!0;return!!ul(s,e)}function Au(s,e,n){return!!dl(s,e)||!!If(e,s,n)}function Pc(s,e){if(s.length===1)return Zm(e,s[0]);for(let n=0;n<e.length;n++){const c=e[n];for(let f=0;f<c.length;f++)if(dl(s,c[f]))return!0}for(let n=0;n<s.length;n++)if(Zm(e,s[n]))return!0;for(let n=0;n<e.length;n++)if(ul(s,e[n]))return!0;return!1}function Cc(s,e,n){if(s.length>1){if(ul(s,e))return!0;for(let c=0;c<e.length;c++)if(If(e[c],s,n))return!0}for(let c=0;c<s.length;c++)if(If(s[c],e,n))return!0;return!1}function ul(s,e){if(s.length===0||e.length===0)return!1;for(let n=0;n<s.length-1;n++){const c=s[n],f=s[n+1];for(let v=0;v<e.length-1;v++)if(Dc(c,f,e[v],e[v+1]))return!0}return!1}function Dc(s,e,n,c){return ke(s,n,c)!==ke(e,n,c)&&ke(s,e,n)!==ke(s,e,c)}function If(s,e,n){const c=n*n;if(e.length===1)return s.distSqr(e[0])<c;for(let f=1;f<e.length;f++)if(Wm(s,e[f-1],e[f])<c)return!0;return!1}function Wm(s,e,n){const c=e.distSqr(n);if(c===0)return s.distSqr(e);const f=((s.x-e.x)*(n.x-e.x)+(s.y-e.y)*(n.y-e.y))/c;return s.distSqr(f<0?e:f>1?n:n.sub(e)._mult(f)._add(e))}function Zm(s,e){let n,c,f,v=!1;for(let x=0;x<s.length;x++){n=s[x];for(let b=0,S=n.length-1;b<n.length;S=b++)c=n[b],f=n[S],c.y>e.y!=f.y>e.y&&e.x<(f.x-c.x)*(e.y-c.y)/(f.y-c.y)+c.x&&(v=!v)}return v}function dl(s,e){let n=!1;for(let c=0,f=s.length-1;c<s.length;f=c++){const v=s[c],x=s[f];v.y>e.y!=x.y>e.y&&e.x<(x.x-v.x)*(e.y-v.y)/(x.y-v.y)+v.x&&(n=!n)}return n}function Bx(s,e,n){const c=n[0],f=n[2];if(s.x<c.x&&e.x<c.x||s.x>f.x&&e.x>f.x||s.y<c.y&&e.y<c.y||s.y>f.y&&e.y>f.y)return!1;const v=ke(s,e,n[0]);return v!==ke(s,e,n[1])||v!==ke(s,e,n[2])||v!==ke(s,e,n[3])}function kc(s,e,n){const c=e.paint.get(s).value;return c.kind==="constant"?c.value:n.programConfigurations.get(e.id).getMaxValue(s)}function Eu(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function Iu(s,e,n,c,f){if(!e[0]&&!e[1])return s;const v=P.convert(e)._mult(f);n==="viewport"&&v._rotate(-c);const x=[];for(let b=0;b<s.length;b++)x.push(s[b].sub(v));return x}let Km,Xm;he("CircleBucket",yn,{omit:["layers"]});var Nx={get paint(){return Xm=Xm||new Hs({"circle-radius":new Te(it.paint_circle["circle-radius"]),"circle-color":new Te(it.paint_circle["circle-color"]),"circle-blur":new Te(it.paint_circle["circle-blur"]),"circle-opacity":new Te(it.paint_circle["circle-opacity"]),"circle-translate":new ve(it.paint_circle["circle-translate"]),"circle-translate-anchor":new ve(it.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ve(it.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ve(it.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Te(it.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Te(it.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Te(it.paint_circle["circle-stroke-opacity"])})},get layout(){return Km=Km||new Hs({"circle-sort-key":new Te(it.layout_circle["circle-sort-key"])})}},Ws=1e-6,fl=typeof Float32Array<"u"?Float32Array:Array;function Pf(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Ym(s,e,n){var c=e[0],f=e[1],v=e[2],x=e[3],b=e[4],S=e[5],E=e[6],D=e[7],R=e[8],B=e[9],$=e[10],U=e[11],G=e[12],X=e[13],st=e[14],gt=e[15],nt=n[0],ft=n[1],Et=n[2],kt=n[3];return s[0]=nt*c+ft*b+Et*R+kt*G,s[1]=nt*f+ft*S+Et*B+kt*X,s[2]=nt*v+ft*E+Et*$+kt*st,s[3]=nt*x+ft*D+Et*U+kt*gt,s[4]=(nt=n[4])*c+(ft=n[5])*b+(Et=n[6])*R+(kt=n[7])*G,s[5]=nt*f+ft*S+Et*B+kt*X,s[6]=nt*v+ft*E+Et*$+kt*st,s[7]=nt*x+ft*D+Et*U+kt*gt,s[8]=(nt=n[8])*c+(ft=n[9])*b+(Et=n[10])*R+(kt=n[11])*G,s[9]=nt*f+ft*S+Et*B+kt*X,s[10]=nt*v+ft*E+Et*$+kt*st,s[11]=nt*x+ft*D+Et*U+kt*gt,s[12]=(nt=n[12])*c+(ft=n[13])*b+(Et=n[14])*R+(kt=n[15])*G,s[13]=nt*f+ft*S+Et*B+kt*X,s[14]=nt*v+ft*E+Et*$+kt*st,s[15]=nt*x+ft*D+Et*U+kt*gt,s}Math.hypot||(Math.hypot=function(){for(var s=0,e=arguments.length;e--;)s+=arguments[e]*arguments[e];return Math.sqrt(s)});var Rc,$x=Ym;function Pu(s,e,n){var c=e[0],f=e[1],v=e[2],x=e[3];return s[0]=n[0]*c+n[4]*f+n[8]*v+n[12]*x,s[1]=n[1]*c+n[5]*f+n[9]*v+n[13]*x,s[2]=n[2]*c+n[6]*f+n[10]*v+n[14]*x,s[3]=n[3]*c+n[7]*f+n[11]*v+n[15]*x,s}Rc=new fl(4),fl!=Float32Array&&(Rc[0]=0,Rc[1]=0,Rc[2]=0,Rc[3]=0);class Vx extends Dr{constructor(e){super(e,Nx)}createBucket(e){return new yn(e)}queryRadius(e){const n=e;return kc("circle-radius",this,n)+kc("circle-stroke-width",this,n)+Eu(this.paint.get("circle-translate"))}queryIntersectsFeature(e,n,c,f,v,x,b,S){const E=Iu(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,b),D=this.paint.get("circle-radius").evaluate(n,c)+this.paint.get("circle-stroke-width").evaluate(n,c),R=this.paint.get("circle-pitch-alignment")==="map",B=R?E:function(U,G){return U.map(X=>Jm(X,G))}(E,S),$=R?D*b:D;for(const U of f)for(const G of U){const X=R?G:Jm(G,S);let st=$;const gt=Pu([],[G.x,G.y,0,1],S);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?st*=gt[3]/x.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(st*=x.cameraToCenterDistance/gt[3]),Au(B,X,st))return!0}return!1}}function Jm(s,e){const n=Pu([],[s.x,s.y,0,1],e);return new P(n[0]/n[3],n[1]/n[3])}class Qm extends yn{}let tg;he("HeatmapBucket",Qm,{omit:["layers"]});var Ux={get paint(){return tg=tg||new Hs({"heatmap-radius":new Te(it.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Te(it.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ve(it.paint_heatmap["heatmap-intensity"]),"heatmap-color":new yc(it.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ve(it.paint_heatmap["heatmap-opacity"])})}};function Cf(s,{width:e,height:n},c,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==e*n*c)throw new RangeError(`mismatched image size. expected: ${f.length} but got: ${e*n*c}`)}else f=new Uint8Array(e*n*c);return s.width=e,s.height=n,s.data=f,s}function eg(s,{width:e,height:n},c){if(e===s.width&&n===s.height)return;const f=Cf({},{width:e,height:n},c);Df(s,f,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,e),height:Math.min(s.height,n)},c),s.width=e,s.height=n,s.data=f.data}function Df(s,e,n,c,f,v){if(f.width===0||f.height===0)return e;if(f.width>s.width||f.height>s.height||n.x>s.width-f.width||n.y>s.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>e.width||f.height>e.height||c.x>e.width-f.width||c.y>e.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const x=s.data,b=e.data;if(x===b)throw new Error("srcData equals dstData, so image is already copied");for(let S=0;S<f.height;S++){const E=((n.y+S)*s.width+n.x)*v,D=((c.y+S)*e.width+c.x)*v;for(let R=0;R<f.width*v;R++)b[D+R]=x[E+R]}return e}class zc{constructor(e,n){Cf(this,e,1,n)}resize(e){eg(this,e,1)}clone(){return new zc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,c,f,v){Df(e,n,c,f,v,1)}}class kr{constructor(e,n){Cf(this,e,4,n)}resize(e){eg(this,e,4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new kr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,c,f,v){Df(e,n,c,f,v,4)}}function ig(s){const e={},n=s.resolution||256,c=s.clips?s.clips.length:1,f=s.image||new kr({width:n,height:c});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const v=(x,b,S)=>{e[s.evaluationKey]=S;const E=s.expression.evaluate(e);f.data[x+b+0]=Math.floor(255*E.r/E.a),f.data[x+b+1]=Math.floor(255*E.g/E.a),f.data[x+b+2]=Math.floor(255*E.b/E.a),f.data[x+b+3]=Math.floor(255*E.a)};if(s.clips)for(let x=0,b=0;x<c;++x,b+=4*n)for(let S=0,E=0;S<n;S++,E+=4){const D=S/(n-1),{start:R,end:B}=s.clips[x];v(b,E,R*(1-D)+B*D)}else for(let x=0,b=0;x<n;x++,b+=4)v(0,b,x/(n-1));return f}he("AlphaImage",zc),he("RGBAImage",kr);class qx extends Dr{createBucket(e){return new Qm(e)}constructor(e){super(e,Ux),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ig({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let sg;var jx={get paint(){return sg=sg||new Hs({"hillshade-illumination-direction":new ve(it.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ve(it.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ve(it.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ve(it.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ve(it.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ve(it.paint_hillshade["hillshade-accent-color"])})}};class Gx extends Dr{constructor(e){super(e,jx)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Hx=Xi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Wx}=Hx;var kf={exports:{}};function Cu(s,e,n){n=n||2;var c,f,v,x,b,S,E,D=e&&e.length,R=D?e[0]*n:s.length,B=rg(s,0,R,n,!0),$=[];if(!B||B.next===B.prev)return $;if(D&&(B=function(G,X,st,gt){var nt,ft,Et,kt=[];for(nt=0,ft=X.length;nt<ft;nt++)(Et=rg(G,X[nt]*gt,nt<ft-1?X[nt+1]*gt:G.length,gt,!1))===Et.next&&(Et.steiner=!0),kt.push(e1(Et));for(kt.sort(Jx),nt=0;nt<kt.length;nt++)st=Qx(kt[nt],st);return st}(s,e,B,n)),s.length>80*n){c=v=s[0],f=x=s[1];for(var U=n;U<R;U+=n)(b=s[U])<c&&(c=b),(S=s[U+1])<f&&(f=S),b>v&&(v=b),S>x&&(x=S);E=(E=Math.max(v-c,x-f))!==0?32767/E:0}return Lc(B,$,n,c,f,E,0),$}function rg(s,e,n,c,f){var v,x;if(f===Lf(s,e,n,c)>0)for(v=e;v<n;v+=c)x=og(v,s[v],s[v+1],x);else for(v=n-c;v>=e;v-=c)x=og(v,s[v],s[v+1],x);return x&&Du(x,x.next)&&(Fc(x),x=x.next),x}function oo(s,e){if(!s)return s;e||(e=s);var n,c=s;do if(n=!1,c.steiner||!Du(c,c.next)&&Yi(c.prev,c,c.next)!==0)c=c.next;else{if(Fc(c),(c=e=c.prev)===c.next)break;n=!0}while(n||c!==e);return e}function Lc(s,e,n,c,f,v,x){if(s){!x&&v&&function(D,R,B,$){var U=D;do U.z===0&&(U.z=Rf(U.x,U.y,R,B,$)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next;while(U!==D);U.prevZ.nextZ=null,U.prevZ=null,function(G){var X,st,gt,nt,ft,Et,kt,re,me=1;do{for(st=G,G=null,ft=null,Et=0;st;){for(Et++,gt=st,kt=0,X=0;X<me&&(kt++,gt=gt.nextZ);X++);for(re=me;kt>0||re>0&&gt;)kt!==0&&(re===0||!gt||st.z<=gt.z)?(nt=st,st=st.nextZ,kt--):(nt=gt,gt=gt.nextZ,re--),ft?ft.nextZ=nt:G=nt,nt.prevZ=ft,ft=nt;st=gt}ft.nextZ=null,me*=2}while(Et>1)}(U)}(s,c,f,v);for(var b,S,E=s;s.prev!==s.next;)if(b=s.prev,S=s.next,v?Kx(s,c,f,v):Zx(s))e.push(b.i/n|0),e.push(s.i/n|0),e.push(S.i/n|0),Fc(s),s=S.next,E=S.next;else if((s=S)===E){x?x===1?Lc(s=Xx(oo(s),e,n),e,n,c,f,v,2):x===2&&Yx(s,e,n,c,f,v):Lc(oo(s),e,n,c,f,v,1);break}}}function Zx(s){var e=s.prev,n=s,c=s.next;if(Yi(e,n,c)>=0)return!1;for(var f=e.x,v=n.x,x=c.x,b=e.y,S=n.y,E=c.y,D=f<v?f<x?f:x:v<x?v:x,R=b<S?b<E?b:E:S<E?S:E,B=f>v?f>x?f:x:v>x?v:x,$=b>S?b>E?b:E:S>E?S:E,U=c.next;U!==e;){if(U.x>=D&&U.x<=B&&U.y>=R&&U.y<=$&&pl(f,b,v,S,x,E,U.x,U.y)&&Yi(U.prev,U,U.next)>=0)return!1;U=U.next}return!0}function Kx(s,e,n,c){var f=s.prev,v=s,x=s.next;if(Yi(f,v,x)>=0)return!1;for(var b=f.x,S=v.x,E=x.x,D=f.y,R=v.y,B=x.y,$=b<S?b<E?b:E:S<E?S:E,U=D<R?D<B?D:B:R<B?R:B,G=b>S?b>E?b:E:S>E?S:E,X=D>R?D>B?D:B:R>B?R:B,st=Rf($,U,e,n,c),gt=Rf(G,X,e,n,c),nt=s.prevZ,ft=s.nextZ;nt&&nt.z>=st&&ft&&ft.z<=gt;){if(nt.x>=$&&nt.x<=G&&nt.y>=U&&nt.y<=X&&nt!==f&&nt!==x&&pl(b,D,S,R,E,B,nt.x,nt.y)&&Yi(nt.prev,nt,nt.next)>=0||(nt=nt.prevZ,ft.x>=$&&ft.x<=G&&ft.y>=U&&ft.y<=X&&ft!==f&&ft!==x&&pl(b,D,S,R,E,B,ft.x,ft.y)&&Yi(ft.prev,ft,ft.next)>=0))return!1;ft=ft.nextZ}for(;nt&&nt.z>=st;){if(nt.x>=$&&nt.x<=G&&nt.y>=U&&nt.y<=X&&nt!==f&&nt!==x&&pl(b,D,S,R,E,B,nt.x,nt.y)&&Yi(nt.prev,nt,nt.next)>=0)return!1;nt=nt.prevZ}for(;ft&&ft.z<=gt;){if(ft.x>=$&&ft.x<=G&&ft.y>=U&&ft.y<=X&&ft!==f&&ft!==x&&pl(b,D,S,R,E,B,ft.x,ft.y)&&Yi(ft.prev,ft,ft.next)>=0)return!1;ft=ft.nextZ}return!0}function Xx(s,e,n){var c=s;do{var f=c.prev,v=c.next.next;!Du(f,v)&&ng(f,c,c.next,v)&&Oc(f,v)&&Oc(v,f)&&(e.push(f.i/n|0),e.push(c.i/n|0),e.push(v.i/n|0),Fc(c),Fc(c.next),c=s=v),c=c.next}while(c!==s);return oo(c)}function Yx(s,e,n,c,f,v){var x=s;do{for(var b=x.next.next;b!==x.prev;){if(x.i!==b.i&&i1(x,b)){var S=ag(x,b);return x=oo(x,x.next),S=oo(S,S.next),Lc(x,e,n,c,f,v,0),void Lc(S,e,n,c,f,v,0)}b=b.next}x=x.next}while(x!==s)}function Jx(s,e){return s.x-e.x}function Qx(s,e){var n=function(f,v){var x,b=v,S=f.x,E=f.y,D=-1/0;do{if(E<=b.y&&E>=b.next.y&&b.next.y!==b.y){var R=b.x+(E-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(R<=S&&R>D&&(D=R,x=b.x<b.next.x?b:b.next,R===S))return x}b=b.next}while(b!==v);if(!x)return null;var B,$=x,U=x.x,G=x.y,X=1/0;b=x;do S>=b.x&&b.x>=U&&S!==b.x&&pl(E<G?S:D,E,U,G,E<G?D:S,E,b.x,b.y)&&(B=Math.abs(E-b.y)/(S-b.x),Oc(b,f)&&(B<X||B===X&&(b.x>x.x||b.x===x.x&&t1(x,b)))&&(x=b,X=B)),b=b.next;while(b!==$);return x}(s,e);if(!n)return e;var c=ag(n,s);return oo(c,c.next),oo(n,n.next)}function t1(s,e){return Yi(s.prev,s,e.prev)<0&&Yi(e.next,s,s.next)<0}function Rf(s,e,n,c,f){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-n)*f|0)|s<<8))|s<<4))|s<<2))|s<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-c)*f|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function e1(s){var e=s,n=s;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==s);return n}function pl(s,e,n,c,f,v,x,b){return(f-x)*(e-b)>=(s-x)*(v-b)&&(s-x)*(c-b)>=(n-x)*(e-b)&&(n-x)*(v-b)>=(f-x)*(c-b)}function i1(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!function(n,c){var f=n;do{if(f.i!==n.i&&f.next.i!==n.i&&f.i!==c.i&&f.next.i!==c.i&&ng(f,f.next,n,c))return!0;f=f.next}while(f!==n);return!1}(s,e)&&(Oc(s,e)&&Oc(e,s)&&function(n,c){var f=n,v=!1,x=(n.x+c.x)/2,b=(n.y+c.y)/2;do f.y>b!=f.next.y>b&&f.next.y!==f.y&&x<(f.next.x-f.x)*(b-f.y)/(f.next.y-f.y)+f.x&&(v=!v),f=f.next;while(f!==n);return v}(s,e)&&(Yi(s.prev,s,e.prev)||Yi(s,e.prev,e))||Du(s,e)&&Yi(s.prev,s,s.next)>0&&Yi(e.prev,e,e.next)>0)}function Yi(s,e,n){return(e.y-s.y)*(n.x-e.x)-(e.x-s.x)*(n.y-e.y)}function Du(s,e){return s.x===e.x&&s.y===e.y}function ng(s,e,n,c){var f=Ru(Yi(s,e,n)),v=Ru(Yi(s,e,c)),x=Ru(Yi(n,c,s)),b=Ru(Yi(n,c,e));return f!==v&&x!==b||!(f!==0||!ku(s,n,e))||!(v!==0||!ku(s,c,e))||!(x!==0||!ku(n,s,c))||!(b!==0||!ku(n,e,c))}function ku(s,e,n){return e.x<=Math.max(s.x,n.x)&&e.x>=Math.min(s.x,n.x)&&e.y<=Math.max(s.y,n.y)&&e.y>=Math.min(s.y,n.y)}function Ru(s){return s>0?1:s<0?-1:0}function Oc(s,e){return Yi(s.prev,s,s.next)<0?Yi(s,e,s.next)>=0&&Yi(s,s.prev,e)>=0:Yi(s,e,s.prev)<0||Yi(s,s.next,e)<0}function ag(s,e){var n=new zf(s.i,s.x,s.y),c=new zf(e.i,e.x,e.y),f=s.next,v=e.prev;return s.next=e,e.prev=s,n.next=f,f.prev=n,c.next=n,n.prev=c,v.next=c,c.prev=v,c}function og(s,e,n,c){var f=new zf(s,e,n);return c?(f.next=c.next,f.prev=c,c.next.prev=f,c.next=f):(f.prev=f,f.next=f),f}function Fc(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function zf(s,e,n){this.i=s,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Lf(s,e,n,c){for(var f=0,v=e,x=n-c;v<n;v+=c)f+=(s[x]-s[v])*(s[v+1]+s[x+1]),x=v;return f}kf.exports=Cu,kf.exports.default=Cu,Cu.deviation=function(s,e,n,c){var f=e&&e.length,v=Math.abs(Lf(s,0,f?e[0]*n:s.length,n));if(f)for(var x=0,b=e.length;x<b;x++)v-=Math.abs(Lf(s,e[x]*n,x<b-1?e[x+1]*n:s.length,n));var S=0;for(x=0;x<c.length;x+=3){var E=c[x]*n,D=c[x+1]*n,R=c[x+2]*n;S+=Math.abs((s[E]-s[R])*(s[D+1]-s[E+1])-(s[E]-s[D])*(s[R+1]-s[E+1]))}return v===0&&S===0?0:Math.abs((S-v)/v)},Cu.flatten=function(s){for(var e=s[0][0].length,n={vertices:[],holes:[],dimensions:e},c=0,f=0;f<s.length;f++){for(var v=0;v<s[f].length;v++)for(var x=0;x<e;x++)n.vertices.push(s[f][v][x]);f>0&&n.holes.push(c+=s[f-1].length)}return n};var lg=T(kf.exports);function s1(s,e,n,c,f){cg(s,e,n||0,c||s.length-1,f||r1)}function cg(s,e,n,c,f){for(;c>n;){if(c-n>600){var v=c-n+1,x=e-n+1,b=Math.log(v),S=.5*Math.exp(2*b/3),E=.5*Math.sqrt(b*S*(v-S)/v)*(x-v/2<0?-1:1);cg(s,e,Math.max(n,Math.floor(e-x*S/v+E)),Math.min(c,Math.floor(e+(v-x)*S/v+E)),f)}var D=s[e],R=n,B=c;for(Bc(s,n,e),f(s[c],D)>0&&Bc(s,n,c);R<B;){for(Bc(s,R,B),R++,B--;f(s[R],D)<0;)R++;for(;f(s[B],D)>0;)B--}f(s[n],D)===0?Bc(s,n,B):Bc(s,++B,c),B<=e&&(n=B+1),e<=B&&(c=B-1)}}function Bc(s,e,n){var c=s[e];s[e]=s[n],s[n]=c}function r1(s,e){return s<e?-1:s>e?1:0}function Of(s,e){const n=s.length;if(n<=1)return[s];const c=[];let f,v;for(let x=0;x<n;x++){const b=gi(s[x]);b!==0&&(s[x].area=Math.abs(b),v===void 0&&(v=b<0),v===b<0?(f&&c.push(f),f=[s[x]]):f.push(s[x]))}if(f&&c.push(f),e>1)for(let x=0;x<c.length;x++)c[x].length<=e||(s1(c[x],e,1,c[x].length-1,n1),c[x]=c[x].slice(0,e));return c}function n1(s,e){return e.area-s.area}function Ff(s,e,n){const c=n.patternDependencies;let f=!1;for(const v of e){const x=v.paint.get(`${s}-pattern`);x.isConstant()||(f=!0);const b=x.constantOr(null);b&&(f=!0,c[b.to]=!0,c[b.from]=!0)}return f}function Bf(s,e,n,c,f){const v=f.patternDependencies;for(const x of e){const b=x.paint.get(`${s}-pattern`).value;if(b.kind!=="constant"){let S=b.evaluate({zoom:c-1},n,{},f.availableImages),E=b.evaluate({zoom:c},n,{},f.availableImages),D=b.evaluate({zoom:c+1},n,{},f.availableImages);S=S&&S.name?S.name:S,E=E&&E.name?E.name:E,D=D&&D.name?D.name:D,v[S]=!0,v[E]=!0,v[D]=!0,n.patterns[x.id]={min:S,mid:E,max:D}}}return n}class Nf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Z,this.indexArray=new St,this.indexArray2=new Bt,this.programConfigurations=new Bi(e.layers,e.zoom),this.segments=new Xt,this.segments2=new Xt,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,c){this.hasPattern=Ff("fill",this.layers,n);const f=this.layers[0].layout.get("fill-sort-key"),v=!f.isConstant(),x=[];for(const{feature:b,id:S,index:E,sourceLayerIndex:D}of e){const R=this.layers[0]._featureFilter.needGeometry,B=qn(b,R);if(!this.layers[0]._featureFilter.filter(new Di(this.zoom),B,c))continue;const $=v?f.evaluate(B,{},c,n.availableImages):void 0,U={id:S,properties:b.properties,type:b.type,sourceLayerIndex:D,index:E,geometry:R?B.geometry:Un(b),patterns:{},sortKey:$};x.push(U)}v&&x.sort((b,S)=>b.sortKey-S.sortKey);for(const b of x){const{geometry:S,index:E,sourceLayerIndex:D}=b;if(this.hasPattern){const R=Bf("fill",this.layers,b,this.zoom,n);this.patternFeatures.push(R)}else this.addFeature(b,S,E,c,{});n.featureIndex.insert(e[E].feature,S,E,D,this.index)}}update(e,n,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,c)}addFeatures(e,n,c){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,n,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Wx),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,c,f,v){for(const x of Of(n,500)){let b=0;for(const $ of x)b+=$.length;const S=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),E=S.vertexLength,D=[],R=[];for(const $ of x){if($.length===0)continue;$!==x[0]&&R.push(D.length/2);const U=this.segments2.prepareSegment($.length,this.layoutVertexArray,this.indexArray2),G=U.vertexLength;this.layoutVertexArray.emplaceBack($[0].x,$[0].y),this.indexArray2.emplaceBack(G+$.length-1,G),D.push($[0].x),D.push($[0].y);for(let X=1;X<$.length;X++)this.layoutVertexArray.emplaceBack($[X].x,$[X].y),this.indexArray2.emplaceBack(G+X-1,G+X),D.push($[X].x),D.push($[X].y);U.vertexLength+=$.length,U.primitiveLength+=$.length}const B=lg(D,R);for(let $=0;$<B.length;$+=3)this.indexArray.emplaceBack(E+B[$],E+B[$+1],E+B[$+2]);S.vertexLength+=b,S.primitiveLength+=B.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,v,f)}}let hg,ug;he("FillBucket",Nf,{omit:["layers","patternFeatures"]});var a1={get paint(){return ug=ug||new Hs({"fill-antialias":new ve(it.paint_fill["fill-antialias"]),"fill-opacity":new Te(it.paint_fill["fill-opacity"]),"fill-color":new Te(it.paint_fill["fill-color"]),"fill-outline-color":new Te(it.paint_fill["fill-outline-color"]),"fill-translate":new ve(it.paint_fill["fill-translate"]),"fill-translate-anchor":new ve(it.paint_fill["fill-translate-anchor"]),"fill-pattern":new il(it.paint_fill["fill-pattern"])})},get layout(){return hg=hg||new Hs({"fill-sort-key":new Te(it.layout_fill["fill-sort-key"])})}};class o1 extends Dr{constructor(e){super(e,a1)}recalculate(e,n){super.recalculate(e,n);const c=this.paint._values["fill-outline-color"];c.value.kind==="constant"&&c.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Nf(e)}queryRadius(){return Eu(this.paint.get("fill-translate"))}queryIntersectsFeature(e,n,c,f,v,x,b){return Pc(Iu(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,b),f)}isTileClipped(){return!0}}const l1=Xi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),c1=Xi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:h1}=l1;var ma={},u1=I,dg=ml;function ml(s,e,n,c,f){this.properties={},this.extent=n,this.type=0,this._pbf=s,this._geometry=-1,this._keys=c,this._values=f,s.readFields(d1,this,e)}function d1(s,e,n){s==1?e.id=n.readVarint():s==2?function(c,f){for(var v=c.readVarint()+c.pos;c.pos<v;){var x=f._keys[c.readVarint()],b=f._values[c.readVarint()];f.properties[x]=b}}(n,e):s==3?e.type=n.readVarint():s==4&&(e._geometry=n.pos)}function f1(s){for(var e,n,c=0,f=0,v=s.length,x=v-1;f<v;x=f++)c+=((n=s[x]).x-(e=s[f]).x)*(e.y+n.y);return c}ml.types=["Unknown","Point","LineString","Polygon"],ml.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var e,n=s.readVarint()+s.pos,c=1,f=0,v=0,x=0,b=[];s.pos<n;){if(f<=0){var S=s.readVarint();c=7&S,f=S>>3}if(f--,c===1||c===2)v+=s.readSVarint(),x+=s.readSVarint(),c===1&&(e&&b.push(e),e=[]),e.push(new u1(v,x));else{if(c!==7)throw new Error("unknown command "+c);e&&e.push(e[0].clone())}}return e&&b.push(e),b},ml.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var e=s.readVarint()+s.pos,n=1,c=0,f=0,v=0,x=1/0,b=-1/0,S=1/0,E=-1/0;s.pos<e;){if(c<=0){var D=s.readVarint();n=7&D,c=D>>3}if(c--,n===1||n===2)(f+=s.readSVarint())<x&&(x=f),f>b&&(b=f),(v+=s.readSVarint())<S&&(S=v),v>E&&(E=v);else if(n!==7)throw new Error("unknown command "+n)}return[x,S,b,E]},ml.prototype.toGeoJSON=function(s,e,n){var c,f,v=this.extent*Math.pow(2,n),x=this.extent*s,b=this.extent*e,S=this.loadGeometry(),E=ml.types[this.type];function D($){for(var U=0;U<$.length;U++){var G=$[U];$[U]=[360*(G.x+x)/v-180,360/Math.PI*Math.atan(Math.exp((180-360*(G.y+b)/v)*Math.PI/180))-90]}}switch(this.type){case 1:var R=[];for(c=0;c<S.length;c++)R[c]=S[c][0];D(S=R);break;case 2:for(c=0;c<S.length;c++)D(S[c]);break;case 3:for(S=function($){var U=$.length;if(U<=1)return[$];for(var G,X,st=[],gt=0;gt<U;gt++){var nt=f1($[gt]);nt!==0&&(X===void 0&&(X=nt<0),X===nt<0?(G&&st.push(G),G=[$[gt]]):G.push($[gt]))}return G&&st.push(G),st}(S),c=0;c<S.length;c++)for(f=0;f<S[c].length;f++)D(S[c][f])}S.length===1?S=S[0]:E="Multi"+E;var B={type:"Feature",geometry:{type:E,coordinates:S},properties:this.properties};return"id"in this&&(B.id=this.id),B};var p1=dg,fg=pg;function pg(s,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(m1,this,e),this.length=this._features.length}function m1(s,e,n){s===15?e.version=n.readVarint():s===1?e.name=n.readString():s===5?e.extent=n.readVarint():s===2?e._features.push(n.pos):s===3?e._keys.push(n.readString()):s===4&&e._values.push(function(c){for(var f=null,v=c.readVarint()+c.pos;c.pos<v;){var x=c.readVarint()>>3;f=x===1?c.readString():x===2?c.readFloat():x===3?c.readDouble():x===4?c.readVarint64():x===5?c.readVarint():x===6?c.readSVarint():x===7?c.readBoolean():null}return f}(n))}pg.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var e=this._pbf.readVarint()+this._pbf.pos;return new p1(this._pbf,e,this.extent,this._keys,this._values)};var g1=fg;function _1(s,e,n){if(s===3){var c=new g1(n,n.readVarint()+n.pos);c.length&&(e[c.name]=c)}}ma.VectorTile=function(s,e){this.layers=s.readFields(_1,{},e)},ma.VectorTileFeature=dg,ma.VectorTileLayer=fg;const y1=ma.VectorTileFeature.types,$f=Math.pow(2,13);function Nc(s,e,n,c,f,v,x,b){s.emplaceBack(e,n,2*Math.floor(c*$f)+x,f*$f*2,v*$f*2,Math.round(b))}class Vf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new W,this.centroidVertexArray=new O,this.indexArray=new St,this.programConfigurations=new Bi(e.layers,e.zoom),this.segments=new Xt,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,c){this.features=[],this.hasPattern=Ff("fill-extrusion",this.layers,n);for(const{feature:f,id:v,index:x,sourceLayerIndex:b}of e){const S=this.layers[0]._featureFilter.needGeometry,E=qn(f,S);if(!this.layers[0]._featureFilter.filter(new Di(this.zoom),E,c))continue;const D={id:v,sourceLayerIndex:b,index:x,geometry:S?E.geometry:Un(f),properties:f.properties,type:f.type,patterns:{}};this.hasPattern?this.features.push(Bf("fill-extrusion",this.layers,D,this.zoom,n)):this.addFeature(D,D.geometry,x,c,{}),n.featureIndex.insert(f,D.geometry,x,b,this.index,!0)}}addFeatures(e,n,c){for(const f of this.features){const{geometry:v}=f;this.addFeature(f,v,f.index,n,c)}}update(e,n,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,c)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,h1),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,c1.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,n,c,f,v){const x={x:0,y:0,vertexCount:0};for(const b of Of(n,500)){let S=0;for(const U of b)S+=U.length;let E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const U of b){if(U.length===0||x1(U))continue;let G=0;for(let X=0;X<U.length;X++){const st=U[X];if(X>=1){const gt=U[X-1];if(!v1(st,gt)){E.vertexLength+4>Xt.MAX_VERTEX_ARRAY_LENGTH&&(E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const nt=st.sub(gt)._perp()._unit(),ft=gt.dist(st);G+ft>32768&&(G=0),Nc(this.layoutVertexArray,st.x,st.y,nt.x,nt.y,0,0,G),Nc(this.layoutVertexArray,st.x,st.y,nt.x,nt.y,0,1,G),x.x+=2*st.x,x.y+=2*st.y,x.vertexCount+=2,G+=ft,Nc(this.layoutVertexArray,gt.x,gt.y,nt.x,nt.y,0,0,G),Nc(this.layoutVertexArray,gt.x,gt.y,nt.x,nt.y,0,1,G),x.x+=2*gt.x,x.y+=2*gt.y,x.vertexCount+=2;const Et=E.vertexLength;this.indexArray.emplaceBack(Et,Et+2,Et+1),this.indexArray.emplaceBack(Et+1,Et+2,Et+3),E.vertexLength+=4,E.primitiveLength+=2}}}}if(E.vertexLength+S>Xt.MAX_VERTEX_ARRAY_LENGTH&&(E=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray)),y1[e.type]!=="Polygon")continue;const D=[],R=[],B=E.vertexLength;for(const U of b)if(U.length!==0){U!==b[0]&&R.push(D.length/2);for(let G=0;G<U.length;G++){const X=U[G];Nc(this.layoutVertexArray,X.x,X.y,0,0,1,1,0),x.x+=X.x,x.y+=X.y,x.vertexCount+=1,D.push(X.x),D.push(X.y)}}const $=lg(D,R);for(let U=0;U<$.length;U+=3)this.indexArray.emplaceBack(B+$[U],B+$[U+2],B+$[U+1]);E.primitiveLength+=$.length/3,E.vertexLength+=S}for(let b=0;b<x.vertexCount;b++)this.centroidVertexArray.emplaceBack(Math.floor(x.x/x.vertexCount),Math.floor(x.y/x.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,v,f)}}function v1(s,e){return s.x===e.x&&(s.x<0||s.x>Hi)||s.y===e.y&&(s.y<0||s.y>Hi)}function x1(s){return s.every(e=>e.x<0)||s.every(e=>e.x>Hi)||s.every(e=>e.y<0)||s.every(e=>e.y>Hi)}let mg;he("FillExtrusionBucket",Vf,{omit:["layers","features"]});var b1={get paint(){return mg=mg||new Hs({"fill-extrusion-opacity":new ve(it["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Te(it["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ve(it["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ve(it["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new il(it["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Te(it["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Te(it["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ve(it["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class w1 extends Dr{constructor(e){super(e,b1)}createBucket(e){return new Vf(e)}queryRadius(){return Eu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,n,c,f,v,x,b,S){const E=Iu(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,b),D=this.paint.get("fill-extrusion-height").evaluate(n,c),R=this.paint.get("fill-extrusion-base").evaluate(n,c),B=function(U,G,X,st){const gt=[];for(const nt of U){const ft=[nt.x,nt.y,0,1];Pu(ft,ft,G),gt.push(new P(ft[0]/ft[3],ft[1]/ft[3]))}return gt}(E,S),$=function(U,G,X,st){const gt=[],nt=[],ft=st[8]*G,Et=st[9]*G,kt=st[10]*G,re=st[11]*G,me=st[8]*X,se=st[9]*X,ee=st[10]*X,Kt=st[11]*X;for(const ue of U){const te=[],Ut=[];for(const we of ue){const ge=we.x,Ze=we.y,Ai=st[0]*ge+st[4]*Ze+st[12],Ri=st[1]*ge+st[5]*Ze+st[13],ds=st[2]*ge+st[6]*Ze+st[14],vr=st[3]*ge+st[7]*Ze+st[15],Zs=ds+kt,rs=vr+re,ws=Ai+me,Ps=Ri+se,Ks=ds+ee,Xs=vr+Kt,fs=new P((Ai+ft)/rs,(Ri+Et)/rs);fs.z=Zs/rs,te.push(fs);const ps=new P(ws/Xs,Ps/Xs);ps.z=Ks/Xs,Ut.push(ps)}gt.push(te),nt.push(Ut)}return[gt,nt]}(f,R,D,S);return function(U,G,X){let st=1/0;Pc(X,G)&&(st=gg(X,G[0]));for(let gt=0;gt<G.length;gt++){const nt=G[gt],ft=U[gt];for(let Et=0;Et<nt.length-1;Et++){const kt=nt[Et],re=[kt,nt[Et+1],ft[Et+1],ft[Et],kt];Ic(X,re)&&(st=Math.min(st,gg(X,re)))}}return st!==1/0&&st}($[0],$[1],B)}}function $c(s,e){return s.x*e.x+s.y*e.y}function gg(s,e){if(s.length===1){let n=0;const c=e[n++];let f;for(;!f||c.equals(f);)if(f=e[n++],!f)return 1/0;for(;n<e.length;n++){const v=e[n],x=s[0],b=f.sub(c),S=v.sub(c),E=x.sub(c),D=$c(b,b),R=$c(b,S),B=$c(S,S),$=$c(E,b),U=$c(E,S),G=D*B-R*R,X=(B*$-R*U)/G,st=(D*U-R*$)/G,gt=c.z*(1-X-st)+f.z*X+v.z*st;if(isFinite(gt))return gt}return 1/0}{let n=1/0;for(const c of e)n=Math.min(n,c.z);return n}}const M1=Xi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:S1}=M1,T1=Xi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:A1}=T1,E1=ma.VectorTileFeature.types,I1=Math.cos(Math.PI/180*37.5),_g=Math.pow(2,14)/.5;class Uf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new J,this.layoutVertexArray2=new j,this.indexArray=new St,this.programConfigurations=new Bi(e.layers,e.zoom),this.segments=new Xt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,c){this.hasPattern=Ff("line",this.layers,n);const f=this.layers[0].layout.get("line-sort-key"),v=!f.isConstant(),x=[];for(const{feature:b,id:S,index:E,sourceLayerIndex:D}of e){const R=this.layers[0]._featureFilter.needGeometry,B=qn(b,R);if(!this.layers[0]._featureFilter.filter(new Di(this.zoom),B,c))continue;const $=v?f.evaluate(B,{},c):void 0,U={id:S,properties:b.properties,type:b.type,sourceLayerIndex:D,index:E,geometry:R?B.geometry:Un(b),patterns:{},sortKey:$};x.push(U)}v&&x.sort((b,S)=>b.sortKey-S.sortKey);for(const b of x){const{geometry:S,index:E,sourceLayerIndex:D}=b;if(this.hasPattern){const R=Bf("line",this.layers,b,this.zoom,n);this.patternFeatures.push(R)}else this.addFeature(b,S,E,c,{});n.featureIndex.insert(e[E].feature,S,E,D,this.index)}}update(e,n,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,c)}addFeatures(e,n,c){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,n,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,A1)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,S1),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,c,f,v){const x=this.layers[0].layout,b=x.get("line-join").evaluate(e,{}),S=x.get("line-cap"),E=x.get("line-miter-limit"),D=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const R of n)this.addLine(R,e,b,S,E,D);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,v,f)}addLine(e,n,c,f,v,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let st=0;st<e.length-1;st++)this.totalDistance+=e[st].dist(e[st+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const b=E1[n.type]==="Polygon";let S=e.length;for(;S>=2&&e[S-1].equals(e[S-2]);)S--;let E=0;for(;E<S-1&&e[E].equals(e[E+1]);)E++;if(S<(b?3:2))return;c==="bevel"&&(v=1.05);const D=this.overscaling<=16?15*Hi/(512*this.overscaling):0,R=this.segments.prepareSegment(10*S,this.layoutVertexArray,this.indexArray);let B,$,U,G,X;this.e1=this.e2=-1,b&&(B=e[S-2],X=e[E].sub(B)._unit()._perp());for(let st=E;st<S;st++){if(U=st===S-1?b?e[E+1]:void 0:e[st+1],U&&e[st].equals(U))continue;X&&(G=X),B&&($=B),B=e[st],X=U?U.sub(B)._unit()._perp():G,G=G||X;let gt=G.add(X);gt.x===0&&gt.y===0||gt._unit();const nt=G.x*X.x+G.y*X.y,ft=gt.x*X.x+gt.y*X.y,Et=ft!==0?1/ft:1/0,kt=2*Math.sqrt(2-2*ft),re=ft<I1&&$&&U,me=G.x*X.y-G.y*X.x>0;if(re&&st>E){const Kt=B.dist($);if(Kt>2*D){const ue=B.sub(B.sub($)._mult(D/Kt)._round());this.updateDistance($,ue),this.addCurrentVertex(ue,G,0,0,R),$=ue}}const se=$&&U;let ee=se?c:b?"butt":f;if(se&&ee==="round"&&(Et<x?ee="miter":Et<=2&&(ee="fakeround")),ee==="miter"&&Et>v&&(ee="bevel"),ee==="bevel"&&(Et>2&&(ee="flipbevel"),Et<v&&(ee="miter")),$&&this.updateDistance($,B),ee==="miter")gt._mult(Et),this.addCurrentVertex(B,gt,0,0,R);else if(ee==="flipbevel"){if(Et>100)gt=X.mult(-1);else{const Kt=Et*G.add(X).mag()/G.sub(X).mag();gt._perp()._mult(Kt*(me?-1:1))}this.addCurrentVertex(B,gt,0,0,R),this.addCurrentVertex(B,gt.mult(-1),0,0,R)}else if(ee==="bevel"||ee==="fakeround"){const Kt=-Math.sqrt(Et*Et-1),ue=me?Kt:0,te=me?0:Kt;if($&&this.addCurrentVertex(B,G,ue,te,R),ee==="fakeround"){const Ut=Math.round(180*kt/Math.PI/20);for(let we=1;we<Ut;we++){let ge=we/Ut;if(ge!==.5){const Ai=ge-.5;ge+=ge*Ai*(ge-1)*((1.0904+nt*(nt*(3.55645-1.43519*nt)-3.2452))*Ai*Ai+(.848013+nt*(.215638*nt-1.06021)))}const Ze=X.sub(G)._mult(ge)._add(G)._unit()._mult(me?-1:1);this.addHalfVertex(B,Ze.x,Ze.y,!1,me,0,R)}}U&&this.addCurrentVertex(B,X,-ue,-te,R)}else if(ee==="butt")this.addCurrentVertex(B,gt,0,0,R);else if(ee==="square"){const Kt=$?1:-1;this.addCurrentVertex(B,gt,Kt,Kt,R)}else ee==="round"&&($&&(this.addCurrentVertex(B,G,0,0,R),this.addCurrentVertex(B,G,1,1,R,!0)),U&&(this.addCurrentVertex(B,X,-1,-1,R,!0),this.addCurrentVertex(B,X,0,0,R)));if(re&&st<S-1){const Kt=B.dist(U);if(Kt>2*D){const ue=B.add(U.sub(B)._mult(D/Kt)._round());this.updateDistance(B,ue),this.addCurrentVertex(ue,X,0,0,R),B=ue}}}}addCurrentVertex(e,n,c,f,v,x=!1){const b=n.y*f-n.x,S=-n.y-n.x*f;this.addHalfVertex(e,n.x+n.y*c,n.y-n.x*c,x,!1,c,v),this.addHalfVertex(e,b,S,x,!0,-f,v),this.distance>_g/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,n,c,f,v,x))}addHalfVertex({x:e,y:n},c,f,v,x,b,S){const E=.5*(this.lineClips?this.scaledDistance*(_g-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(v?1:0),(n<<1)+(x?1:0),Math.round(63*c)+128,Math.round(63*f)+128,1+(b===0?0:b<0?-1:1)|(63&E)<<2,E>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const D=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),S.primitiveLength++),x?this.e2=D:this.e1=D}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}let yg,vg;he("LineBucket",Uf,{omit:["layers","patternFeatures"]});var xg={get paint(){return vg=vg||new Hs({"line-opacity":new Te(it.paint_line["line-opacity"]),"line-color":new Te(it.paint_line["line-color"]),"line-translate":new ve(it.paint_line["line-translate"]),"line-translate-anchor":new ve(it.paint_line["line-translate-anchor"]),"line-width":new Te(it.paint_line["line-width"]),"line-gap-width":new Te(it.paint_line["line-gap-width"]),"line-offset":new Te(it.paint_line["line-offset"]),"line-blur":new Te(it.paint_line["line-blur"]),"line-dasharray":new to(it.paint_line["line-dasharray"]),"line-pattern":new il(it.paint_line["line-pattern"]),"line-gradient":new yc(it.paint_line["line-gradient"])})},get layout(){return yg=yg||new Hs({"line-cap":new ve(it.layout_line["line-cap"]),"line-join":new Te(it.layout_line["line-join"]),"line-miter-limit":new ve(it.layout_line["line-miter-limit"]),"line-round-limit":new ve(it.layout_line["line-round-limit"]),"line-sort-key":new Te(it.layout_line["line-sort-key"])})}};class P1 extends Te{possiblyEvaluate(e,n){return n=new Di(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(e,n)}evaluate(e,n,c,f){return n=oe({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,c,f)}}let zu;class C1 extends Dr{constructor(e){super(e,xg),this.gradientVersion=0,zu||(zu=new P1(xg.paint.properties["line-width"].specification),zu.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!function(c){return c._styleExpression!==void 0}(n)&&n._styleExpression.expression instanceof Ha,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,n){super.recalculate(e,n),this.paint._values["line-floorwidth"]=zu.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Uf(e)}queryRadius(e){const n=e,c=bg(kc("line-width",this,n),kc("line-gap-width",this,n)),f=kc("line-offset",this,n);return c/2+Math.abs(f)+Eu(this.paint.get("line-translate"))}queryIntersectsFeature(e,n,c,f,v,x,b){const S=Iu(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,b),E=b/2*bg(this.paint.get("line-width").evaluate(n,c),this.paint.get("line-gap-width").evaluate(n,c)),D=this.paint.get("line-offset").evaluate(n,c);return D&&(f=function(R,B){const $=[];for(let U=0;U<R.length;U++){const G=R[U],X=[];for(let st=0;st<G.length;st++){const gt=G[st-1],nt=G[st],ft=G[st+1],Et=st===0?new P(0,0):nt.sub(gt)._unit()._perp(),kt=st===G.length-1?new P(0,0):ft.sub(nt)._unit()._perp(),re=Et._add(kt)._unit(),me=re.x*kt.x+re.y*kt.y;me!==0&&re._mult(1/me),X.push(re._mult(B)._add(nt))}$.push(X)}return $}(f,D*b)),function(R,B,$){for(let U=0;U<B.length;U++){const G=B[U];if(R.length>=3){for(let X=0;X<G.length;X++)if(dl(R,G[X]))return!0}if(Cc(R,G,$))return!0}return!1}(S,f,E)}isTileClipped(){return!0}}function bg(s,e){return e>0?e+2*s:s}const D1=Xi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),k1=Xi([{name:"a_projected_pos",components:3,type:"Float32"}],4);Xi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const R1=Xi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Xi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const wg=Xi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),z1=Xi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function L1(s,e,n){return s.sections.forEach(c=>{c.text=function(f,v,x){const b=v.layout.get("text-transform").evaluate(x,{});return b==="uppercase"?f=f.toLocaleUpperCase():b==="lowercase"&&(f=f.toLocaleLowerCase()),mn.applyArabicShaping&&(f=mn.applyArabicShaping(f)),f}(c.text,e,n)}),s}Xi([{name:"triangle",components:3,type:"Uint16"}]),Xi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Xi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Xi([{type:"Float32",name:"offsetX"}]),Xi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Xi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Vc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var us=24,Mg=vi,Sg=function(s,e,n,c,f){var v,x,b=8*f-c-1,S=(1<<b)-1,E=S>>1,D=-7,R=n?f-1:0,B=n?-1:1,$=s[e+R];for(R+=B,v=$&(1<<-D)-1,$>>=-D,D+=b;D>0;v=256*v+s[e+R],R+=B,D-=8);for(x=v&(1<<-D)-1,v>>=-D,D+=c;D>0;x=256*x+s[e+R],R+=B,D-=8);if(v===0)v=1-E;else{if(v===S)return x?NaN:1/0*($?-1:1);x+=Math.pow(2,c),v-=E}return($?-1:1)*x*Math.pow(2,v-c)},Tg=function(s,e,n,c,f,v){var x,b,S,E=8*v-f-1,D=(1<<E)-1,R=D>>1,B=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,$=c?0:v-1,U=c?1:-1,G=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(b=isNaN(e)?1:0,x=D):(x=Math.floor(Math.log(e)/Math.LN2),e*(S=Math.pow(2,-x))<1&&(x--,S*=2),(e+=x+R>=1?B/S:B*Math.pow(2,1-R))*S>=2&&(x++,S/=2),x+R>=D?(b=0,x=D):x+R>=1?(b=(e*S-1)*Math.pow(2,f),x+=R):(b=e*Math.pow(2,R-1)*Math.pow(2,f),x=0));f>=8;s[n+$]=255&b,$+=U,b/=256,f-=8);for(x=x<<f|b,E+=f;E>0;s[n+$]=255&x,$+=U,x/=256,E-=8);s[n+$-U]|=128*G};function vi(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}vi.Varint=0,vi.Fixed64=1,vi.Bytes=2,vi.Fixed32=5;var qf=4294967296,Ag=1/qf,Eg=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function jn(s){return s.type===vi.Bytes?s.readVarint()+s.pos:s.pos+1}function gl(s,e,n){return n?4294967296*e+(s>>>0):4294967296*(e>>>0)+(s>>>0)}function Ig(s,e,n){var c=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(c);for(var f=n.pos-1;f>=s;f--)n.buf[f+c]=n.buf[f]}function O1(s,e){for(var n=0;n<s.length;n++)e.writeVarint(s[n])}function F1(s,e){for(var n=0;n<s.length;n++)e.writeSVarint(s[n])}function B1(s,e){for(var n=0;n<s.length;n++)e.writeFloat(s[n])}function N1(s,e){for(var n=0;n<s.length;n++)e.writeDouble(s[n])}function $1(s,e){for(var n=0;n<s.length;n++)e.writeBoolean(s[n])}function V1(s,e){for(var n=0;n<s.length;n++)e.writeFixed32(s[n])}function U1(s,e){for(var n=0;n<s.length;n++)e.writeSFixed32(s[n])}function q1(s,e){for(var n=0;n<s.length;n++)e.writeFixed64(s[n])}function j1(s,e){for(var n=0;n<s.length;n++)e.writeSFixed64(s[n])}function Lu(s,e){return(s[e]|s[e+1]<<8|s[e+2]<<16)+16777216*s[e+3]}function _l(s,e,n){s[n]=e,s[n+1]=e>>>8,s[n+2]=e>>>16,s[n+3]=e>>>24}function Pg(s,e){return(s[e]|s[e+1]<<8|s[e+2]<<16)+(s[e+3]<<24)}vi.prototype={destroy:function(){this.buf=null},readFields:function(s,e,n){for(n=n||this.length;this.pos<n;){var c=this.readVarint(),f=c>>3,v=this.pos;this.type=7&c,s(f,e,this),this.pos===v&&this.skip(c)}return e},readMessage:function(s,e){return this.readFields(s,e,this.readVarint()+this.pos)},readFixed32:function(){var s=Lu(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=Pg(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=Lu(this.buf,this.pos)+Lu(this.buf,this.pos+4)*qf;return this.pos+=8,s},readSFixed64:function(){var s=Lu(this.buf,this.pos)+Pg(this.buf,this.pos+4)*qf;return this.pos+=8,s},readFloat:function(){var s=Sg(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=Sg(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var e,n,c=this.buf;return e=127&(n=c[this.pos++]),n<128?e:(e|=(127&(n=c[this.pos++]))<<7,n<128?e:(e|=(127&(n=c[this.pos++]))<<14,n<128?e:(e|=(127&(n=c[this.pos++]))<<21,n<128?e:function(f,v,x){var b,S,E=x.buf;if(b=(112&(S=E[x.pos++]))>>4,S<128||(b|=(127&(S=E[x.pos++]))<<3,S<128)||(b|=(127&(S=E[x.pos++]))<<10,S<128)||(b|=(127&(S=E[x.pos++]))<<17,S<128)||(b|=(127&(S=E[x.pos++]))<<24,S<128)||(b|=(1&(S=E[x.pos++]))<<31,S<128))return gl(f,b,v);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=c[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,e=this.pos;return this.pos=s,s-e>=12&&Eg?function(n,c,f){return Eg.decode(n.subarray(c,f))}(this.buf,e,s):function(n,c,f){for(var v="",x=c;x<f;){var b,S,E,D=n[x],R=null,B=D>239?4:D>223?3:D>191?2:1;if(x+B>f)break;B===1?D<128&&(R=D):B===2?(192&(b=n[x+1]))==128&&(R=(31&D)<<6|63&b)<=127&&(R=null):B===3?(S=n[x+2],(192&(b=n[x+1]))==128&&(192&S)==128&&((R=(15&D)<<12|(63&b)<<6|63&S)<=2047||R>=55296&&R<=57343)&&(R=null)):B===4&&(S=n[x+2],E=n[x+3],(192&(b=n[x+1]))==128&&(192&S)==128&&(192&E)==128&&((R=(15&D)<<18|(63&b)<<12|(63&S)<<6|63&E)<=65535||R>=1114112)&&(R=null)),R===null?(R=65533,B=1):R>65535&&(R-=65536,v+=String.fromCharCode(R>>>10&1023|55296),R=56320|1023&R),v+=String.fromCharCode(R),x+=B}return v}(this.buf,e,s)},readBytes:function(){var s=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,s);return this.pos=s,e},readPackedVarint:function(s,e){if(this.type!==vi.Bytes)return s.push(this.readVarint(e));var n=jn(this);for(s=s||[];this.pos<n;)s.push(this.readVarint(e));return s},readPackedSVarint:function(s){if(this.type!==vi.Bytes)return s.push(this.readSVarint());var e=jn(this);for(s=s||[];this.pos<e;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==vi.Bytes)return s.push(this.readBoolean());var e=jn(this);for(s=s||[];this.pos<e;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==vi.Bytes)return s.push(this.readFloat());var e=jn(this);for(s=s||[];this.pos<e;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==vi.Bytes)return s.push(this.readDouble());var e=jn(this);for(s=s||[];this.pos<e;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==vi.Bytes)return s.push(this.readFixed32());var e=jn(this);for(s=s||[];this.pos<e;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==vi.Bytes)return s.push(this.readSFixed32());var e=jn(this);for(s=s||[];this.pos<e;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==vi.Bytes)return s.push(this.readFixed64());var e=jn(this);for(s=s||[];this.pos<e;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==vi.Bytes)return s.push(this.readSFixed64());var e=jn(this);for(s=s||[];this.pos<e;)s.push(this.readSFixed64());return s},skip:function(s){var e=7&s;if(e===vi.Varint)for(;this.buf[this.pos++]>127;);else if(e===vi.Bytes)this.pos=this.readVarint()+this.pos;else if(e===vi.Fixed32)this.pos+=4;else{if(e!==vi.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(s,e){this.writeVarint(s<<3|e)},realloc:function(s){for(var e=this.length||16;e<this.pos+s;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),_l(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),_l(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),_l(this.buf,-1&s,this.pos),_l(this.buf,Math.floor(s*Ag),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),_l(this.buf,-1&s,this.pos),_l(this.buf,Math.floor(s*Ag),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(e,n){var c,f;if(e>=0?(c=e%4294967296|0,f=e/4294967296|0):(f=~(-e/4294967296),4294967295^(c=~(-e%4294967296))?c=c+1|0:(c=0,f=f+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(v,x,b){b.buf[b.pos++]=127&v|128,v>>>=7,b.buf[b.pos++]=127&v|128,v>>>=7,b.buf[b.pos++]=127&v|128,v>>>=7,b.buf[b.pos++]=127&v|128,b.buf[b.pos]=127&(v>>>=7)}(c,0,n),function(v,x){var b=(7&v)<<4;x.buf[x.pos++]|=b|((v>>>=3)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v)))))}(f,n)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var e=this.pos;this.pos=function(c,f,v){for(var x,b,S=0;S<f.length;S++){if((x=f.charCodeAt(S))>55295&&x<57344){if(!b){x>56319||S+1===f.length?(c[v++]=239,c[v++]=191,c[v++]=189):b=x;continue}if(x<56320){c[v++]=239,c[v++]=191,c[v++]=189,b=x;continue}x=b-55296<<10|x-56320|65536,b=null}else b&&(c[v++]=239,c[v++]=191,c[v++]=189,b=null);x<128?c[v++]=x:(x<2048?c[v++]=x>>6|192:(x<65536?c[v++]=x>>12|224:(c[v++]=x>>18|240,c[v++]=x>>12&63|128),c[v++]=x>>6&63|128),c[v++]=63&x|128)}return v}(this.buf,s,this.pos);var n=this.pos-e;n>=128&&Ig(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(s){this.realloc(4),Tg(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),Tg(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var e=s.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=s[n]},writeRawMessage:function(s,e){this.pos++;var n=this.pos;s(e,this);var c=this.pos-n;c>=128&&Ig(n,c,this),this.pos=n-1,this.writeVarint(c),this.pos+=c},writeMessage:function(s,e,n){this.writeTag(s,vi.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(s,e){e.length&&this.writeMessage(s,O1,e)},writePackedSVarint:function(s,e){e.length&&this.writeMessage(s,F1,e)},writePackedBoolean:function(s,e){e.length&&this.writeMessage(s,$1,e)},writePackedFloat:function(s,e){e.length&&this.writeMessage(s,B1,e)},writePackedDouble:function(s,e){e.length&&this.writeMessage(s,N1,e)},writePackedFixed32:function(s,e){e.length&&this.writeMessage(s,V1,e)},writePackedSFixed32:function(s,e){e.length&&this.writeMessage(s,U1,e)},writePackedFixed64:function(s,e){e.length&&this.writeMessage(s,q1,e)},writePackedSFixed64:function(s,e){e.length&&this.writeMessage(s,j1,e)},writeBytesField:function(s,e){this.writeTag(s,vi.Bytes),this.writeBytes(e)},writeFixed32Field:function(s,e){this.writeTag(s,vi.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(s,e){this.writeTag(s,vi.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(s,e){this.writeTag(s,vi.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(s,e){this.writeTag(s,vi.Fixed64),this.writeSFixed64(e)},writeVarintField:function(s,e){this.writeTag(s,vi.Varint),this.writeVarint(e)},writeSVarintField:function(s,e){this.writeTag(s,vi.Varint),this.writeSVarint(e)},writeStringField:function(s,e){this.writeTag(s,vi.Bytes),this.writeString(e)},writeFloatField:function(s,e){this.writeTag(s,vi.Fixed32),this.writeFloat(e)},writeDoubleField:function(s,e){this.writeTag(s,vi.Fixed64),this.writeDouble(e)},writeBooleanField:function(s,e){this.writeVarintField(s,!!e)}};var jf=T(Mg);const Gf=3;function G1(s,e,n){s===1&&n.readMessage(H1,e)}function H1(s,e,n){if(s===3){const{id:c,bitmap:f,width:v,height:x,left:b,top:S,advance:E}=n.readMessage(W1,{});e.push({id:c,bitmap:new zc({width:v+2*Gf,height:x+2*Gf},f),metrics:{width:v,height:x,left:b,top:S,advance:E}})}}function W1(s,e,n){s===1?e.id=n.readVarint():s===2?e.bitmap=n.readBytes():s===3?e.width=n.readVarint():s===4?e.height=n.readVarint():s===5?e.left=n.readSVarint():s===6?e.top=n.readSVarint():s===7&&(e.advance=n.readVarint())}const Cg=Gf;function Dg(s){let e=0,n=0;for(const x of s)e+=x.w*x.h,n=Math.max(n,x.w);s.sort((x,b)=>b.h-x.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let f=0,v=0;for(const x of s)for(let b=c.length-1;b>=0;b--){const S=c[b];if(!(x.w>S.w||x.h>S.h)){if(x.x=S.x,x.y=S.y,v=Math.max(v,x.y+x.h),f=Math.max(f,x.x+x.w),x.w===S.w&&x.h===S.h){const E=c.pop();b<c.length&&(c[b]=E)}else x.h===S.h?(S.x+=x.w,S.w-=x.w):x.w===S.w?(S.y+=x.h,S.h-=x.h):(c.push({x:S.x+x.w,y:S.y,w:S.w-x.w,h:x.h}),S.y+=x.h,S.h-=x.h);break}}return{w:f,h:v,fill:e/(f*v)||0}}const ar=1;class Hf{constructor(e,{pixelRatio:n,version:c,stretchX:f,stretchY:v,content:x}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=f,this.stretchY=v,this.content=x,this.version=c}get tl(){return[this.paddedRect.x+ar,this.paddedRect.y+ar]}get br(){return[this.paddedRect.x+this.paddedRect.w-ar,this.paddedRect.y+this.paddedRect.h-ar]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*ar)/this.pixelRatio,(this.paddedRect.h-2*ar)/this.pixelRatio]}}class kg{constructor(e,n){const c={},f={};this.haveRenderCallbacks=[];const v=[];this.addImages(e,c,v),this.addImages(n,f,v);const{w:x,h:b}=Dg(v),S=new kr({width:x||1,height:b||1});for(const E in e){const D=e[E],R=c[E].paddedRect;kr.copy(D.data,S,{x:0,y:0},{x:R.x+ar,y:R.y+ar},D.data)}for(const E in n){const D=n[E],R=f[E].paddedRect,B=R.x+ar,$=R.y+ar,U=D.data.width,G=D.data.height;kr.copy(D.data,S,{x:0,y:0},{x:B,y:$},D.data),kr.copy(D.data,S,{x:0,y:G-1},{x:B,y:$-1},{width:U,height:1}),kr.copy(D.data,S,{x:0,y:0},{x:B,y:$+G},{width:U,height:1}),kr.copy(D.data,S,{x:U-1,y:0},{x:B-1,y:$},{width:1,height:G}),kr.copy(D.data,S,{x:0,y:0},{x:B+U,y:$},{width:1,height:G})}this.image=S,this.iconPositions=c,this.patternPositions=f}addImages(e,n,c){for(const f in e){const v=e[f],x={x:0,y:0,w:v.data.width+2*ar,h:v.data.height+2*ar};c.push(x),n[f]=new Hf(x,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(e,n){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in e.updatedImages)this.patchUpdatedImage(this.iconPositions[c],e.getImage(c),n),this.patchUpdatedImage(this.patternPositions[c],e.getImage(c),n)}patchUpdatedImage(e,n,c){if(!e||!n||e.version===n.version)return;e.version=n.version;const[f,v]=e.tl;c.update(n.data,void 0,{x:f,y:v})}}var ga;he("ImagePosition",Hf),he("ImageAtlas",kg),m.ah=void 0,(ga=m.ah||(m.ah={}))[ga.none=0]="none",ga[ga.horizontal=1]="horizontal",ga[ga.vertical=2]="vertical",ga[ga.horizontalOnly=3]="horizontalOnly";const Uc=-17;class qc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const c=new qc;return c.scale=e||1,c.fontStack=n,c}static forImage(e){const n=new qc;return n.imageName=e,n}}class yl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const c=new yl;for(let f=0;f<e.sections.length;f++){const v=e.sections[f];v.image?c.addImageSection(v):c.addTextSection(v,n)}return c}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let n="";for(let c=0;c<e.length;c++){const f=e.charCodeAt(c+1)||null,v=e.charCodeAt(c-1)||null;n+=f&&gc(f)&&!Vc[e[c+1]]||v&&gc(v)&&!Vc[e[c-1]]||!Vc[e[c]]?e[c]:Vc[e[c]]}return n}(this.text)}trim(){let e=0;for(let c=0;c<this.text.length&&Fu[this.text.charCodeAt(c)];c++)e++;let n=this.text.length;for(let c=this.text.length-1;c>=0&&c>=e&&Fu[this.text.charCodeAt(c)];c--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const c=new yl;return c.text=this.text.substring(e,n),c.sectionIndex=this.sectionIndex.slice(e,n),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(qc.forText(e.scale,e.fontStack||n));const c=this.sections.length-1;for(let f=0;f<e.text.length;++f)this.sectionIndex.push(c)}addImageSection(e){const n=e.image?e.image.name:"";if(n.length===0)return void De("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(qc.forImage(n)),this.sectionIndex.push(this.sections.length-1)):De("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ou(s,e,n,c,f,v,x,b,S,E,D,R,B,$,U,G){const X=yl.fromFeature(s,f);let st;R===m.ah.vertical&&X.verticalizePunctuation();const{processBidirectionalText:gt,processStyledBidirectionalText:nt}=mn;if(gt&&X.sections.length===1){st=[];const kt=gt(X.toString(),Wf(X,E,v,e,c,$,U));for(const re of kt){const me=new yl;me.text=re,me.sections=X.sections;for(let se=0;se<re.length;se++)me.sectionIndex.push(0);st.push(me)}}else if(nt){st=[];const kt=nt(X.text,X.sectionIndex,Wf(X,E,v,e,c,$,U));for(const re of kt){const me=new yl;me.text=re[0],me.sectionIndex=re[1],me.sections=X.sections,st.push(me)}}else st=function(kt,re){const me=[],se=kt.text;let ee=0;for(const Kt of re)me.push(kt.substring(ee,Kt)),ee=Kt;return ee<se.length&&me.push(kt.substring(ee,se.length)),me}(X,Wf(X,E,v,e,c,$,U));const ft=[],Et={positionedLines:ft,text:X.toString(),top:D[1],bottom:D[1],left:D[0],right:D[0],writingMode:R,iconsInText:!1,verticalizable:!1};return function(kt,re,me,se,ee,Kt,ue,te,Ut,we,ge,Ze){let Ai=0,Ri=Uc,ds=0,vr=0;const Zs=te==="right"?1:te==="left"?0:.5;let rs=0;for(const fs of ee){fs.trim();const ps=fs.getMaxScale(),Ls=(ps-1)*us,Ys={positionedGlyphs:[],lineOffset:0};kt.positionedLines[rs]=Ys;const Os=Ys.positionedGlyphs;let or=0;if(!fs.length()){Ri+=Kt,++rs;continue}for(let ms=0;ms<fs.length();ms++){const Je=fs.getSection(ms),Fs=fs.getSectionIndex(ms),Cs=fs.getCharCode(ms);let gs=0,Gr=null,Qr=null,tn=null,Gn=us;const Hr=!(Ut===m.ah.horizontal||!ge&&!Qo(Cs)||ge&&(Fu[Cs]||(ws=Cs,ie.Arabic(ws)||ie["Arabic Supplement"](ws)||ie["Arabic Extended-A"](ws)||ie["Arabic Presentation Forms-A"](ws)||ie["Arabic Presentation Forms-B"](ws))));if(Je.imageName){const zr=se[Je.imageName];if(!zr)continue;tn=Je.imageName,kt.iconsInText=kt.iconsInText||!0,Qr=zr.paddedRect;const cr=zr.displaySize;Je.scale=Je.scale*us/Ze,Gr={width:cr[0],height:cr[1],left:ar,top:-Cg,advance:Hr?cr[1]:cr[0]},gs=Ls+(us-cr[1]*Je.scale),Gn=Gr.advance;const Hn=Hr?cr[0]*Je.scale-us*ps:cr[1]*Je.scale-us*ps;Hn>0&&Hn>or&&(or=Hn)}else{const zr=me[Je.fontStack],cr=zr&&zr[Cs];if(cr&&cr.rect)Qr=cr.rect,Gr=cr.metrics;else{const Hn=re[Je.fontStack],Zc=Hn&&Hn[Cs];if(!Zc)continue;Gr=Zc.metrics}gs=(ps-Je.scale)*us}Hr?(kt.verticalizable=!0,Os.push({glyph:Cs,imageName:tn,x:Ai,y:Ri+gs,vertical:Hr,scale:Je.scale,fontStack:Je.fontStack,sectionIndex:Fs,metrics:Gr,rect:Qr}),Ai+=Gn*Je.scale+we):(Os.push({glyph:Cs,imageName:tn,x:Ai,y:Ri+gs,vertical:Hr,scale:Je.scale,fontStack:Je.fontStack,sectionIndex:Fs,metrics:Gr,rect:Qr}),Ai+=Gr.advance*Je.scale+we)}Os.length!==0&&(ds=Math.max(Ai-we,ds),X1(Os,0,Os.length-1,Zs,or)),Ai=0;const lr=Kt*ps+or;Ys.lineOffset=Math.max(or,Ls),Ri+=lr,vr=Math.max(lr,vr),++rs}var ws;const Ps=Ri-Uc,{horizontalAlign:Ks,verticalAlign:Xs}=Zf(ue);(function(fs,ps,Ls,Ys,Os,or,lr,ms,Je){const Fs=(ps-Ls)*Os;let Cs=0;Cs=or!==lr?-ms*Ys-Uc:(-Ys*Je+.5)*lr;for(const gs of fs)for(const Gr of gs.positionedGlyphs)Gr.x+=Fs,Gr.y+=Cs})(kt.positionedLines,Zs,Ks,Xs,ds,vr,Kt,Ps,ee.length),kt.top+=-Xs*Ps,kt.bottom=kt.top+Ps,kt.left+=-Ks*ds,kt.right=kt.left+ds}(Et,e,n,c,st,x,b,S,R,E,B,G),!function(kt){for(const re of kt)if(re.positionedGlyphs.length!==0)return!1;return!0}(ft)&&Et}const Fu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Z1={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Rg(s,e,n,c,f,v){if(e.imageName){const x=c[e.imageName];return x?x.displaySize[0]*e.scale*us/v+f:0}{const x=n[e.fontStack],b=x&&x[s];return b?b.metrics.advance*e.scale+f:0}}function zg(s,e,n,c){const f=Math.pow(s-e,2);return c?s<e?f/2:2*f:f+Math.abs(n)*n}function K1(s,e,n){let c=0;return s===10&&(c-=1e4),n&&(c+=150),s!==40&&s!==65288||(c+=50),e!==41&&e!==65289||(c+=50),c}function Lg(s,e,n,c,f,v){let x=null,b=zg(e,n,f,v);for(const S of c){const E=zg(e-S.x,n,f,v)+S.badness;E<=b&&(x=S,b=E)}return{index:s,x:e,priorBreak:x,badness:b}}function Og(s){return s?Og(s.priorBreak).concat(s.index):[]}function Wf(s,e,n,c,f,v,x){if(v!=="point")return[];if(!s)return[];const b=[],S=function(B,$,U,G,X,st){let gt=0;for(let nt=0;nt<B.length();nt++){const ft=B.getSection(nt);gt+=Rg(B.getCharCode(nt),ft,G,X,$,st)}return gt/Math.max(1,Math.ceil(gt/U))}(s,e,n,c,f,x),E=s.text.indexOf("")>=0;let D=0;for(let B=0;B<s.length();B++){const $=s.getSection(B),U=s.getCharCode(B);if(Fu[U]||(D+=Rg(U,$,c,f,e,x)),B<s.length()-1){const G=!((R=U)<11904||!(ie["Bopomofo Extended"](R)||ie.Bopomofo(R)||ie["CJK Compatibility Forms"](R)||ie["CJK Compatibility Ideographs"](R)||ie["CJK Compatibility"](R)||ie["CJK Radicals Supplement"](R)||ie["CJK Strokes"](R)||ie["CJK Symbols and Punctuation"](R)||ie["CJK Unified Ideographs Extension A"](R)||ie["CJK Unified Ideographs"](R)||ie["Enclosed CJK Letters and Months"](R)||ie["Halfwidth and Fullwidth Forms"](R)||ie.Hiragana(R)||ie["Ideographic Description Characters"](R)||ie["Kangxi Radicals"](R)||ie["Katakana Phonetic Extensions"](R)||ie.Katakana(R)||ie["Vertical Forms"](R)||ie["Yi Radicals"](R)||ie["Yi Syllables"](R)));(Z1[U]||G||$.imageName)&&b.push(Lg(B+1,D,S,b,K1(U,s.getCharCode(B+1),G&&E),!1))}}var R;return Og(Lg(s.length(),D,S,b,0,!0))}function Zf(s){let e=.5,n=.5;switch(s){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function X1(s,e,n,c,f){if(!c&&!f)return;const v=s[n],x=(s[n].x+v.metrics.advance*v.scale)*c;for(let b=e;b<=n;b++)s[b].x-=x,s[b].y+=f}function Y1(s,e,n){const{horizontalAlign:c,verticalAlign:f}=Zf(n),v=e[0]-s.displaySize[0]*c,x=e[1]-s.displaySize[1]*f;return{image:s,top:x,bottom:x+s.displaySize[1],left:v,right:v+s.displaySize[0]}}function Fg(s,e,n,c,f,v){const x=s.image;let b;if(x.content){const X=x.content,st=x.pixelRatio||1;b=[X[0]/st,X[1]/st,x.displaySize[0]-X[2]/st,x.displaySize[1]-X[3]/st]}const S=e.left*v,E=e.right*v;let D,R,B,$;n==="width"||n==="both"?($=f[0]+S-c[3],R=f[0]+E+c[1]):($=f[0]+(S+E-x.displaySize[0])/2,R=$+x.displaySize[0]);const U=e.top*v,G=e.bottom*v;return n==="height"||n==="both"?(D=f[1]+U-c[0],B=f[1]+G+c[2]):(D=f[1]+(U+G-x.displaySize[1])/2,B=D+x.displaySize[1]),{image:x,top:D,right:R,bottom:B,left:$,collisionPadding:b}}const jc=255,vn=128,_a=jc*vn;function Bg(s,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Di(s+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:f}=n;let v=0;for(;v<c.length&&c[v]<=s;)v++;v=Math.max(0,v-1);let x=v;for(;x<c.length&&c[x]<s+1;)x++;x=Math.min(c.length-1,x);const b=c[v],S=c[x];return n.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:S,interpolationType:f}:{kind:"camera",minZoom:b,maxZoom:S,minSize:n.evaluate(new Di(b)),maxSize:n.evaluate(new Di(S)),interpolationType:f}}}function Kf(s,e,n){let c="never";const f=s.get(e);return f?c=f:s.get(n)&&(c="always"),c}const J1=ma.VectorTileFeature.types,Q1=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Bu(s,e,n,c,f,v,x,b,S,E,D,R,B){const $=b?Math.min(_a,Math.round(b[0])):0,U=b?Math.min(_a,Math.round(b[1])):0;s.emplaceBack(e,n,Math.round(32*c),Math.round(32*f),v,x,($<<1)+(S?1:0),U,16*E,16*D,256*R,256*B)}function Xf(s,e,n){s.emplaceBack(e.x,e.y,n),s.emplaceBack(e.x,e.y,n),s.emplaceBack(e.x,e.y,n),s.emplaceBack(e.x,e.y,n)}function tb(s){for(const e of s.sections)if(Ef(e.text))return!0;return!1}class Yf{constructor(e){this.layoutVertexArray=new xt,this.indexArray=new St,this.programConfigurations=e,this.segments=new Xt,this.dynamicLayoutVertexArray=new et,this.opacityVertexArray=new pt,this.hasVisibleVertices=!1,this.placedSymbolArray=new o}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,c,f){this.isEmpty()||(c&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,D1.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,k1.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Q1,!0),this.opacityVertexBuffer.itemSize=1),(c||f)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}he("SymbolBuffers",Yf);class Jf{constructor(e,n,c){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new c,this.segments=new Xt,this.collisionVertexArray=new wt}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,R1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}he("CollisionBuffers",Jf);class vl{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(x=>x.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Pf([]),this.placementViewportMatrix=Pf([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Bg(this.zoom,n["text-size"]),this.iconSizeData=Bg(this.zoom,n["icon-size"]);const c=this.layers[0].layout,f=c.get("symbol-sort-key"),v=c.get("symbol-z-order");this.canOverlap=Kf(c,"text-overlap","text-allow-overlap")!=="never"||Kf(c,"icon-overlap","icon-allow-overlap")!=="never"||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&!f.isConstant(),this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,c.get("symbol-placement")==="point"&&(this.writingModes=c.get("text-writing-mode").map(x=>m.ah[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=e.sourceID}createArrays(){this.text=new Yf(new Bi(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Yf(new Bi(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new _,this.lineVertexArray=new w,this.symbolInstances=new d,this.textAnchorOffsets=new A}calculateGlyphDependencies(e,n,c,f,v){for(let x=0;x<e.length;x++)if(n[e.charCodeAt(x)]=!0,(c||f)&&v){const b=Vc[e.charAt(x)];b&&(n[b.charCodeAt(0)]=!0)}}populate(e,n,c){const f=this.layers[0],v=f.layout,x=v.get("text-font"),b=v.get("text-field"),S=v.get("icon-image"),E=(b.value.kind!=="constant"||b.value.value instanceof er&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),D=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,R=v.get("symbol-sort-key");if(this.features=[],!E&&!D)return;const B=n.iconDependencies,$=n.glyphDependencies,U=n.availableImages,G=new Di(this.zoom);for(const{feature:X,id:st,index:gt,sourceLayerIndex:nt}of e){const ft=f._featureFilter.needGeometry,Et=qn(X,ft);if(!f._featureFilter.filter(G,Et,c))continue;let kt,re;if(ft||(Et.geometry=Un(X)),E){const se=f.getValueAndResolveTokens("text-field",Et,c,U),ee=er.factory(se),Kt=this.hasRTLText=this.hasRTLText||tb(ee);(!Kt||mn.getRTLTextPluginStatus()==="unavailable"||Kt&&mn.isParsed())&&(kt=L1(ee,f,Et))}if(D){const se=f.getValueAndResolveTokens("icon-image",Et,c,U);re=se instanceof gr?se:gr.fromString(se)}if(!kt&&!re)continue;const me=this.sortFeaturesByKey?R.evaluate(Et,{},c):void 0;if(this.features.push({id:st,text:kt,icon:re,index:gt,sourceLayerIndex:nt,geometry:Et.geometry,properties:X.properties,type:J1[X.type],sortKey:me}),re&&(B[re.name]=!0),kt){const se=x.evaluate(Et,{},c).join(","),ee=v.get("text-rotation-alignment")!=="viewport"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(m.ah.vertical)>=0;for(const Kt of kt.sections)if(Kt.image)B[Kt.image.name]=!0;else{const ue=fa(kt.toString()),te=Kt.fontStack||se,Ut=$[te]=$[te]||{};this.calculateGlyphDependencies(Kt.text,Ut,ee,this.allowVerticalPlacement,ue)}}}v.get("symbol-placement")==="line"&&(this.features=function(X){const st={},gt={},nt=[];let ft=0;function Et(se){nt.push(X[se]),ft++}function kt(se,ee,Kt){const ue=gt[se];return delete gt[se],gt[ee]=ue,nt[ue].geometry[0].pop(),nt[ue].geometry[0]=nt[ue].geometry[0].concat(Kt[0]),ue}function re(se,ee,Kt){const ue=st[ee];return delete st[ee],st[se]=ue,nt[ue].geometry[0].shift(),nt[ue].geometry[0]=Kt[0].concat(nt[ue].geometry[0]),ue}function me(se,ee,Kt){const ue=Kt?ee[0][ee[0].length-1]:ee[0][0];return`${se}:${ue.x}:${ue.y}`}for(let se=0;se<X.length;se++){const ee=X[se],Kt=ee.geometry,ue=ee.text?ee.text.toString():null;if(!ue){Et(se);continue}const te=me(ue,Kt),Ut=me(ue,Kt,!0);if(te in gt&&Ut in st&&gt[te]!==st[Ut]){const we=re(te,Ut,Kt),ge=kt(te,Ut,nt[we].geometry);delete st[te],delete gt[Ut],gt[me(ue,nt[ge].geometry,!0)]=ge,nt[we].geometry=null}else te in gt?kt(te,Ut,Kt):Ut in st?re(te,Ut,Kt):(Et(se),st[te]=ft-1,gt[Ut]=ft-1)}return nt.filter(se=>se.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((X,st)=>X.sortKey-st.sortKey)}update(e,n,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,c),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,c))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const c=this.lineVertexArray.length;if(e.segment!==void 0){let f=e.dist(n[e.segment+1]),v=e.dist(n[e.segment]);const x={};for(let b=e.segment+1;b<n.length;b++)x[b]={x:n[b].x,y:n[b].y,tileUnitDistanceFromAnchor:f},b<n.length-1&&(f+=n[b+1].dist(n[b]));for(let b=e.segment||0;b>=0;b--)x[b]={x:n[b].x,y:n[b].y,tileUnitDistanceFromAnchor:v},b>0&&(v+=n[b-1].dist(n[b]));for(let b=0;b<n.length;b++){const S=x[b];this.lineVertexArray.emplaceBack(S.x,S.y,S.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(e,n,c,f,v,x,b,S,E,D,R,B){const $=e.indexArray,U=e.layoutVertexArray,G=e.segments.prepareSegment(4*n.length,U,$,this.canOverlap?x.sortKey:void 0),X=this.glyphOffsetArray.length,st=G.vertexLength,gt=this.allowVerticalPlacement&&b===m.ah.vertical?Math.PI/2:0,nt=x.text&&x.text.sections;for(let ft=0;ft<n.length;ft++){const{tl:Et,tr:kt,bl:re,br:me,tex:se,pixelOffsetTL:ee,pixelOffsetBR:Kt,minFontScaleX:ue,minFontScaleY:te,glyphOffset:Ut,isSDF:we,sectionIndex:ge}=n[ft],Ze=G.vertexLength,Ai=Ut[1];Bu(U,S.x,S.y,Et.x,Ai+Et.y,se.x,se.y,c,we,ee.x,ee.y,ue,te),Bu(U,S.x,S.y,kt.x,Ai+kt.y,se.x+se.w,se.y,c,we,Kt.x,ee.y,ue,te),Bu(U,S.x,S.y,re.x,Ai+re.y,se.x,se.y+se.h,c,we,ee.x,Kt.y,ue,te),Bu(U,S.x,S.y,me.x,Ai+me.y,se.x+se.w,se.y+se.h,c,we,Kt.x,Kt.y,ue,te),Xf(e.dynamicLayoutVertexArray,S,gt),$.emplaceBack(Ze,Ze+1,Ze+2),$.emplaceBack(Ze+1,Ze+2,Ze+3),G.vertexLength+=4,G.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ut[0]),ft!==n.length-1&&ge===n[ft+1].sectionIndex||e.programConfigurations.populatePaintArrays(U.length,x,x.index,{},B,nt&&nt[ge])}e.placedSymbolArray.emplaceBack(S.x,S.y,X,this.glyphOffsetArray.length-X,st,E,D,S.segment,c?c[0]:0,c?c[1]:0,f[0],f[1],b,0,!1,0,R)}_addCollisionDebugVertex(e,n,c,f,v,x){return n.emplaceBack(0,0),e.emplaceBack(c.x,c.y,f,v,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(e,n,c,f,v,x,b){const S=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),E=S.vertexLength,D=v.layoutVertexArray,R=v.collisionVertexArray,B=b.anchorX,$=b.anchorY;this._addCollisionDebugVertex(D,R,x,B,$,new P(e,n)),this._addCollisionDebugVertex(D,R,x,B,$,new P(c,n)),this._addCollisionDebugVertex(D,R,x,B,$,new P(c,f)),this._addCollisionDebugVertex(D,R,x,B,$,new P(e,f)),S.vertexLength+=4;const U=v.indexArray;U.emplaceBack(E,E+1),U.emplaceBack(E+1,E+2),U.emplaceBack(E+2,E+3),U.emplaceBack(E+3,E),S.primitiveLength+=4}addDebugCollisionBoxes(e,n,c,f){for(let v=e;v<n;v++){const x=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,f?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,c)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Jf(bt,wg.members,Bt),this.iconCollisionBox=new Jf(bt,wg.members,Bt);for(let e=0;e<this.symbolInstances.length;e++){const n=this.symbolInstances.get(e);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(e,n,c,f,v,x,b,S,E){const D={};for(let R=n;R<c;R++){const B=e.get(R);D.textBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},D.textFeatureIndex=B.featureIndex;break}for(let R=f;R<v;R++){const B=e.get(R);D.verticalTextBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},D.verticalTextFeatureIndex=B.featureIndex;break}for(let R=x;R<b;R++){const B=e.get(R);D.iconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},D.iconFeatureIndex=B.featureIndex;break}for(let R=S;R<E;R++){const B=e.get(R);D.verticalIconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},D.verticalIconFeatureIndex=B.featureIndex;break}return D}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const c=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const c=e.placedSymbolArray.get(n),f=c.vertexStartIndex+4*c.numGlyphs;for(let v=c.vertexStartIndex;v<f;v+=4)e.indexArray.emplaceBack(v,v+1,v+2),e.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),c=Math.cos(e),f=[],v=[],x=[];for(let b=0;b<this.symbolInstances.length;++b){x.push(b);const S=this.symbolInstances.get(b);f.push(0|Math.round(n*S.anchorX+c*S.anchorY)),v.push(S.featureIndex)}return x.sort((b,S)=>f[b]-f[S]||v[S]-v[b]),x}addToSortKeyRanges(e,n){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===n?c.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const c=this.symbolInstances.get(n);this.featureSortOrder.push(c.featureIndex),[c.rightJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.leftJustifiedTextSymbolIndex].forEach((f,v,x)=>{f>=0&&x.indexOf(f)===v&&this.addIndicesForPlacedSymbol(this.text,f)}),c.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,c.verticalPlacedTextSymbolIndex),c.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.placedIconSymbolIndex),c.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Ng,$g;he("SymbolBucket",vl,{omit:["layers","collisionBoxArray","features","compareText"]}),vl.MAX_GLYPHS=65535,vl.addDynamicAttributes=Xf;var Qf={get paint(){return $g=$g||new Hs({"icon-opacity":new Te(it.paint_symbol["icon-opacity"]),"icon-color":new Te(it.paint_symbol["icon-color"]),"icon-halo-color":new Te(it.paint_symbol["icon-halo-color"]),"icon-halo-width":new Te(it.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Te(it.paint_symbol["icon-halo-blur"]),"icon-translate":new ve(it.paint_symbol["icon-translate"]),"icon-translate-anchor":new ve(it.paint_symbol["icon-translate-anchor"]),"text-opacity":new Te(it.paint_symbol["text-opacity"]),"text-color":new Te(it.paint_symbol["text-color"],{runtimeType:ui,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new Te(it.paint_symbol["text-halo-color"]),"text-halo-width":new Te(it.paint_symbol["text-halo-width"]),"text-halo-blur":new Te(it.paint_symbol["text-halo-blur"]),"text-translate":new ve(it.paint_symbol["text-translate"]),"text-translate-anchor":new ve(it.paint_symbol["text-translate-anchor"])})},get layout(){return Ng=Ng||new Hs({"symbol-placement":new ve(it.layout_symbol["symbol-placement"]),"symbol-spacing":new ve(it.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ve(it.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Te(it.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ve(it.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ve(it.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ve(it.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ve(it.layout_symbol["icon-ignore-placement"]),"icon-optional":new ve(it.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ve(it.layout_symbol["icon-rotation-alignment"]),"icon-size":new Te(it.layout_symbol["icon-size"]),"icon-text-fit":new ve(it.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ve(it.layout_symbol["icon-text-fit-padding"]),"icon-image":new Te(it.layout_symbol["icon-image"]),"icon-rotate":new Te(it.layout_symbol["icon-rotate"]),"icon-padding":new Te(it.layout_symbol["icon-padding"]),"icon-keep-upright":new ve(it.layout_symbol["icon-keep-upright"]),"icon-offset":new Te(it.layout_symbol["icon-offset"]),"icon-anchor":new Te(it.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ve(it.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ve(it.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ve(it.layout_symbol["text-rotation-alignment"]),"text-field":new Te(it.layout_symbol["text-field"]),"text-font":new Te(it.layout_symbol["text-font"]),"text-size":new Te(it.layout_symbol["text-size"]),"text-max-width":new Te(it.layout_symbol["text-max-width"]),"text-line-height":new ve(it.layout_symbol["text-line-height"]),"text-letter-spacing":new Te(it.layout_symbol["text-letter-spacing"]),"text-justify":new Te(it.layout_symbol["text-justify"]),"text-radial-offset":new Te(it.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ve(it.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Te(it.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Te(it.layout_symbol["text-anchor"]),"text-max-angle":new ve(it.layout_symbol["text-max-angle"]),"text-writing-mode":new ve(it.layout_symbol["text-writing-mode"]),"text-rotate":new Te(it.layout_symbol["text-rotate"]),"text-padding":new ve(it.layout_symbol["text-padding"]),"text-keep-upright":new ve(it.layout_symbol["text-keep-upright"]),"text-transform":new Te(it.layout_symbol["text-transform"]),"text-offset":new Te(it.layout_symbol["text-offset"]),"text-allow-overlap":new ve(it.layout_symbol["text-allow-overlap"]),"text-overlap":new ve(it.layout_symbol["text-overlap"]),"text-ignore-placement":new ve(it.layout_symbol["text-ignore-placement"]),"text-optional":new ve(it.layout_symbol["text-optional"])})}};class Vg{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:as,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}he("FormatSectionOverride",Vg,{omit:["defaultValue"]});class Nu extends Dr{constructor(e){super(e,Qf)}recalculate(e,n){if(super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const c=this.layout.get("text-writing-mode");if(c){const f=[];for(const v of c)f.indexOf(v)<0&&f.push(v);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,n,c,f){const v=this.layout.get(e).evaluate(n,{},c,f),x=this._unevaluatedLayout._values[e];return x.isDataDriven()||xi(x.value)||!v?v:function(b,S){return S.replace(/{([^{}]+)}/g,(E,D)=>b&&D in b?String(b[D]):"")}(n.properties,v)}createBucket(e){return new vl(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Qf.paint.overridableProperties){if(!Nu.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),c=new Vg(n),f=new Ti(c,n.property.specification);let v=null;v=n.value.kind==="constant"||n.value.kind==="source"?new Uo("source",f):new oc("composite",f,n.value.zoomStops),this.paint._values[e]=new Cr(n.property,v,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,c){return!(!this.layout||n.isDataDriven()||c.isDataDriven())&&Nu.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const c=e.get("text-field"),f=Qf.paint.properties[n];let v=!1;const x=b=>{for(const S of b)if(f.overrides&&f.overrides.hasOverride(S))return void(v=!0)};if(c.value.kind==="constant"&&c.value.value instanceof er)x(c.value.value.sections);else if(c.value.kind==="source"){const b=E=>{v||(E instanceof hn&&ts(E.value)===os?x(E.value.sections):E instanceof $o?x(E.sections):E.eachChild(b))},S=c.value;S._styleExpression&&b(S._styleExpression.expression)}return v}}let Ug;var eb={get paint(){return Ug=Ug||new Hs({"background-color":new ve(it.paint_background["background-color"]),"background-pattern":new to(it.paint_background["background-pattern"]),"background-opacity":new ve(it.paint_background["background-opacity"])})}};class ib extends Dr{constructor(e){super(e,eb)}}let qg;var sb={get paint(){return qg=qg||new Hs({"raster-opacity":new ve(it.paint_raster["raster-opacity"]),"raster-hue-rotate":new ve(it.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ve(it.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ve(it.paint_raster["raster-brightness-max"]),"raster-saturation":new ve(it.paint_raster["raster-saturation"]),"raster-contrast":new ve(it.paint_raster["raster-contrast"]),"raster-resampling":new ve(it.paint_raster["raster-resampling"]),"raster-fade-duration":new ve(it.paint_raster["raster-fade-duration"])})}};class rb extends Dr{constructor(e){super(e,sb)}}class nb extends Dr{constructor(e){super(e,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class ab{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const tp=63710088e-1;class ya{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ya(qt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,c=this.lat*n,f=e.lat*n,v=Math.sin(c)*Math.sin(f)+Math.cos(c)*Math.cos(f)*Math.cos((e.lng-this.lng)*n);return tp*Math.acos(Math.min(v,1))}static convert(e){if(e instanceof ya)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new ya(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new ya(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const jg=2*Math.PI*tp;function Gg(s){return jg*Math.cos(s*Math.PI/180)}function Hg(s){return(180+s)/360}function Wg(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function Zg(s,e){return s/Gg(e)}function ep(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}class $u{constructor(e,n,c=0){this.x=+e,this.y=+n,this.z=+c}static fromLngLat(e,n=0){const c=ya.convert(e);return new $u(Hg(c.lng),Wg(c.lat),Zg(n,c.lat))}toLngLat(){return new ya(360*this.x-180,ep(this.y))}toAltitude(){return this.z*Gg(ep(this.y))}meterInMercatorCoordinateUnits(){return 1/jg*(e=ep(this.y),1/Math.cos(e*Math.PI/180));var e}}function Kg(s,e,n){var c=2*Math.PI*6378137/256/Math.pow(2,n);return[s*c-2*Math.PI*6378137/2,e*c-2*Math.PI*6378137/2]}class ip{constructor(e,n,c){if(e<0||e>25||c<0||c>=Math.pow(2,e)||n<0||n>=Math.pow(2,e))throw new Error(`x=${n}, y=${c}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=n,this.y=c,this.key=Gc(0,e,e,n,c)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n,c){const f=(x=this.y,b=this.z,S=Kg(256*(v=this.x),256*(x=Math.pow(2,b)-x-1),b),E=Kg(256*(v+1),256*(x+1),b),S[0]+","+S[1]+","+E[0]+","+E[1]);var v,x,b,S,E;const D=function(R,B,$){let U,G="";for(let X=R;X>0;X--)U=1<<X-1,G+=(B&U?1:0)+($&U?2:0);return G}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(c==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,D).replace(/{bbox-epsg-3857}/g,f)}isChildOf(e){const n=this.z-e.z;return n>0&&e.x===this.x>>n&&e.y===this.y>>n}getTilePoint(e){const n=Math.pow(2,this.z);return new P((e.x*n-this.x)*Hi,(e.y*n-this.y)*Hi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Xg{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Gc(e,n.z,n.z,n.x,n.y)}}class Rr{constructor(e,n,c,f,v){if(e<c)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${c}`);this.overscaledZ=e,this.wrap=n,this.canonical=new ip(c,+f,+v),this.key=Gc(n,e,c,f,v)}clone(){return new Rr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-e;return e>this.canonical.z?new Rr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Rr(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-e;return e>this.canonical.z?Gc(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y):Gc(this.wrap*+n,e,e,this.canonical.x>>c,this.canonical.y>>c)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new Rr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,c=2*this.canonical.x,f=2*this.canonical.y;return[new Rr(n,this.wrap,n,c,f),new Rr(n,this.wrap,n,c+1,f),new Rr(n,this.wrap,n,c,f+1),new Rr(n,this.wrap,n,c+1,f+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Rr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Rr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Xg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new $u(e.x-this.wrap,e.y))}}function Gc(s,e,n,c,f){(s*=2)<0&&(s=-1*s-1);const v=1<<n;return(v*v*s+v*f+c).toString(36)+n.toString(36)+e.toString(36)}he("CanonicalTileID",ip),he("OverscaledTileID",Rr,{omit:["posMatrix"]});class Yg{constructor(e,n,c,f=1,v=1,x=1,b=0){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(c&&!["mapbox","terrarium","custom"].includes(c))return void De(`"${c}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const S=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),c){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=f,this.greenFactor=v,this.blueFactor=x,this.baseShift=b;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let E=0;E<S;E++)this.data[this._idx(-1,E)]=this.data[this._idx(0,E)],this.data[this._idx(S,E)]=this.data[this._idx(S-1,E)],this.data[this._idx(E,-1)]=this.data[this._idx(E,0)],this.data[this._idx(E,S)]=this.data[this._idx(E,S-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(S,-1)]=this.data[this._idx(S-1,0)],this.data[this._idx(-1,S)]=this.data[this._idx(0,S-1)],this.data[this._idx(S,S)]=this.data[this._idx(S-1,S-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let E=0;E<S;E++)for(let D=0;D<S;D++){const R=this.get(E,D);R>this.max&&(this.max=R),R<this.min&&(this.min=R)}}get(e,n){const c=new Uint8Array(this.data.buffer),f=4*this._idx(e,n);return this.unpack(c[f],c[f+1],c[f+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}unpack(e,n,c){return e*this.redFactor+n*this.greenFactor+c*this.blueFactor-this.baseShift}getPixels(){return new kr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,n,c){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let f=n*this.dim,v=n*this.dim+this.dim,x=c*this.dim,b=c*this.dim+this.dim;switch(n){case-1:f=v-1;break;case 1:v=f+1}switch(c){case-1:x=b-1;break;case 1:b=x+1}const S=-n*this.dim,E=-c*this.dim;for(let D=x;D<b;D++)for(let R=f;R<v;R++)this.data[this._idx(R,D)]=e.data[this._idx(R+S,D+E)]}}he("DEMData",Yg);class Jg{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const c=e[n];this._stringToNumber[c]=n,this._numberToString[n]=c}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Qg{constructor(e,n,c,f,v){this.type="Feature",this._vectorTileFeature=e,e._z=n,e._x=c,e._y=f,this.properties=e.properties,this.id=v}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(e[n]=this[n]);return e}}class t_{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ya(Hi,16,0),this.grid3D=new Ya(Hi,16,0),this.featureIndexArray=new z,this.promoteId=n}insert(e,n,c,f,v,x){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,f,v);const S=x?this.grid3D:this.grid;for(let E=0;E<n.length;E++){const D=n[E],R=[1/0,1/0,-1/0,-1/0];for(let B=0;B<D.length;B++){const $=D[B];R[0]=Math.min(R[0],$.x),R[1]=Math.min(R[1],$.y),R[2]=Math.max(R[2],$.x),R[3]=Math.max(R[3],$.y)}R[0]<Hi&&R[1]<Hi&&R[2]>=0&&R[3]>=0&&S.insert(b,R[0],R[1],R[2],R[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ma.VectorTile(new jf(this.rawTileData)).layers,this.sourceLayerCoder=new Jg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,n,c,f){this.loadVTLayers();const v=e.params||{},x=Hi/e.tileSize/e.scale,b=Ho(v.filter),S=e.queryGeometry,E=e.queryPadding*x,D=i_(S),R=this.grid.query(D.minX-E,D.minY-E,D.maxX+E,D.maxY+E),B=i_(e.cameraQueryGeometry),$=this.grid3D.query(B.minX-E,B.minY-E,B.maxX+E,B.maxY+E,(X,st,gt,nt)=>function(ft,Et,kt,re,me){for(const ee of ft)if(Et<=ee.x&&kt<=ee.y&&re>=ee.x&&me>=ee.y)return!0;const se=[new P(Et,kt),new P(Et,me),new P(re,me),new P(re,kt)];if(ft.length>2){for(const ee of se)if(dl(ft,ee))return!0}for(let ee=0;ee<ft.length-1;ee++)if(Bx(ft[ee],ft[ee+1],se))return!0;return!1}(e.cameraQueryGeometry,X-E,st-E,gt+E,nt+E));for(const X of $)R.push(X);R.sort(ob);const U={};let G;for(let X=0;X<R.length;X++){const st=R[X];if(st===G)continue;G=st;const gt=this.featureIndexArray.get(st);let nt=null;this.loadMatchingFeature(U,gt.bucketIndex,gt.sourceLayerIndex,gt.featureIndex,b,v.layers,v.availableImages,n,c,f,(ft,Et,kt)=>(nt||(nt=Un(ft)),Et.queryIntersectsFeature(S,ft,kt,nt,this.z,e.transform,x,e.pixelPosMatrix)))}return U}loadMatchingFeature(e,n,c,f,v,x,b,S,E,D,R){const B=this.bucketLayerIDs[n];if(x&&!function(X,st){for(let gt=0;gt<X.length;gt++)if(st.indexOf(X[gt])>=0)return!0;return!1}(x,B))return;const $=this.sourceLayerCoder.decode(c),U=this.vtLayers[$].feature(f);if(v.needGeometry){const X=qn(U,!0);if(!v.filter(new Di(this.tileID.overscaledZ),X,this.tileID.canonical))return}else if(!v.filter(new Di(this.tileID.overscaledZ),U))return;const G=this.getId(U,$);for(let X=0;X<B.length;X++){const st=B[X];if(x&&x.indexOf(st)<0)continue;const gt=S[st];if(!gt)continue;let nt={};G&&D&&(nt=D.getState(gt.sourceLayer||"_geojsonTileLayer",G));const ft=oe({},E[st]);ft.paint=e_(ft.paint,gt.paint,U,nt,b),ft.layout=e_(ft.layout,gt.layout,U,nt,b);const Et=!R||R(U,gt,nt);if(!Et)continue;const kt=new Qg(U,this.z,this.x,this.y,G);kt.layer=ft;let re=e[st];re===void 0&&(re=e[st]=[]),re.push({featureIndex:f,feature:kt,intersectionZ:Et})}}lookupSymbolFeatures(e,n,c,f,v,x,b,S){const E={};this.loadVTLayers();const D=Ho(v);for(const R of e)this.loadMatchingFeature(E,c,f,R,D,x,b,S,n);return E}hasLayer(e){for(const n of this.bucketLayerIDs)for(const c of n)if(e===c)return!0;return!1}getId(e,n){let c=e.id;return this.promoteId&&(c=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof c=="boolean"&&(c=Number(c))),c}}function e_(s,e,n,c,f){return Vt(s,(v,x)=>{const b=e instanceof Qa?e.get(x):null;return b&&b.evaluate?b.evaluate(n,c,f):b})}function i_(s){let e=1/0,n=1/0,c=-1/0,f=-1/0;for(const v of s)e=Math.min(e,v.x),n=Math.min(n,v.y),c=Math.max(c,v.x),f=Math.max(f,v.y);return{minX:e,minY:n,maxX:c,maxY:f}}function ob(s,e){return e-s}function s_(s,e,n,c,f){const v=[];for(let x=0;x<s.length;x++){const b=s[x];let S;for(let E=0;E<b.length-1;E++){let D=b[E],R=b[E+1];D.x<e&&R.x<e||(D.x<e?D=new P(e,D.y+(e-D.x)/(R.x-D.x)*(R.y-D.y))._round():R.x<e&&(R=new P(e,D.y+(e-D.x)/(R.x-D.x)*(R.y-D.y))._round()),D.y<n&&R.y<n||(D.y<n?D=new P(D.x+(n-D.y)/(R.y-D.y)*(R.x-D.x),n)._round():R.y<n&&(R=new P(D.x+(n-D.y)/(R.y-D.y)*(R.x-D.x),n)._round()),D.x>=c&&R.x>=c||(D.x>=c?D=new P(c,D.y+(c-D.x)/(R.x-D.x)*(R.y-D.y))._round():R.x>=c&&(R=new P(c,D.y+(c-D.x)/(R.x-D.x)*(R.y-D.y))._round()),D.y>=f&&R.y>=f||(D.y>=f?D=new P(D.x+(f-D.y)/(R.y-D.y)*(R.x-D.x),f)._round():R.y>=f&&(R=new P(D.x+(f-D.y)/(R.y-D.y)*(R.x-D.x),f)._round()),S&&D.equals(S[S.length-1])||(S=[D],v.push(S)),S.push(R)))))}}return v}he("FeatureIndex",t_,{omit:["rawTileData","sourceLayerCoder"]});class va extends P{constructor(e,n,c,f){super(e,n),this.angle=c,f!==void 0&&(this.segment=f)}clone(){return new va(this.x,this.y,this.angle,this.segment)}}function r_(s,e,n,c,f){if(e.segment===void 0||n===0)return!0;let v=e,x=e.segment+1,b=0;for(;b>-n/2;){if(x--,x<0)return!1;b-=s[x].dist(v),v=s[x]}b+=s[x].dist(s[x+1]),x++;const S=[];let E=0;for(;b<n/2;){const D=s[x],R=s[x+1];if(!R)return!1;let B=s[x-1].angleTo(D)-D.angleTo(R);for(B=Math.abs((B+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:b,angleDelta:B}),E+=B;b-S[0].distance>c;)E-=S.shift().angleDelta;if(E>f)return!1;x++,b+=D.dist(R)}return!0}function n_(s){let e=0;for(let n=0;n<s.length-1;n++)e+=s[n].dist(s[n+1]);return e}function a_(s,e,n){return s?.6*e*n:0}function o_(s,e){return Math.max(s?s.right-s.left:0,e?e.right-e.left:0)}function lb(s,e,n,c,f,v){const x=a_(n,f,v),b=o_(n,c)*v;let S=0;const E=n_(s)/2;for(let D=0;D<s.length-1;D++){const R=s[D],B=s[D+1],$=R.dist(B);if(S+$>E){const U=(E-S)/$,G=Rs.number(R.x,B.x,U),X=Rs.number(R.y,B.y,U),st=new va(G,X,B.angleTo(R),D);return st._round(),!x||r_(s,st,b,x,e)?st:void 0}S+=$}}function cb(s,e,n,c,f,v,x,b,S){const E=a_(c,v,x),D=o_(c,f),R=D*x,B=s[0].x===0||s[0].x===S||s[0].y===0||s[0].y===S;return e-R<e/4&&(e=R+e/4),l_(s,B?e/2*b%e:(D/2+2*v)*x*b%e,e,E,n,R,B,!1,S)}function l_(s,e,n,c,f,v,x,b,S){const E=v/2,D=n_(s);let R=0,B=e-n,$=[];for(let U=0;U<s.length-1;U++){const G=s[U],X=s[U+1],st=G.dist(X),gt=X.angleTo(G);for(;B+n<R+st;){B+=n;const nt=(B-R)/st,ft=Rs.number(G.x,X.x,nt),Et=Rs.number(G.y,X.y,nt);if(ft>=0&&ft<S&&Et>=0&&Et<S&&B-E>=0&&B+E<=D){const kt=new va(ft,Et,gt,U);kt._round(),c&&!r_(s,kt,v,c,f)||$.push(kt)}}R+=st}return b||$.length||x||($=l_(s,R/2,n,c,f,v,x,!0,S)),$}he("Anchor",va);const xl=ar;function c_(s,e,n,c){const f=[],v=s.image,x=v.pixelRatio,b=v.paddedRect.w-2*xl,S=v.paddedRect.h-2*xl,E=s.right-s.left,D=s.bottom-s.top,R=v.stretchX||[[0,b]],B=v.stretchY||[[0,S]],$=(Kt,ue)=>Kt+ue[1]-ue[0],U=R.reduce($,0),G=B.reduce($,0),X=b-U,st=S-G;let gt=0,nt=U,ft=0,Et=G,kt=0,re=X,me=0,se=st;if(v.content&&c){const Kt=v.content;gt=Vu(R,0,Kt[0]),ft=Vu(B,0,Kt[1]),nt=Vu(R,Kt[0],Kt[2]),Et=Vu(B,Kt[1],Kt[3]),kt=Kt[0]-gt,me=Kt[1]-ft,re=Kt[2]-Kt[0]-nt,se=Kt[3]-Kt[1]-Et}const ee=(Kt,ue,te,Ut)=>{const we=Uu(Kt.stretch-gt,nt,E,s.left),ge=qu(Kt.fixed-kt,re,Kt.stretch,U),Ze=Uu(ue.stretch-ft,Et,D,s.top),Ai=qu(ue.fixed-me,se,ue.stretch,G),Ri=Uu(te.stretch-gt,nt,E,s.left),ds=qu(te.fixed-kt,re,te.stretch,U),vr=Uu(Ut.stretch-ft,Et,D,s.top),Zs=qu(Ut.fixed-me,se,Ut.stretch,G),rs=new P(we,Ze),ws=new P(Ri,Ze),Ps=new P(Ri,vr),Ks=new P(we,vr),Xs=new P(ge/x,Ai/x),fs=new P(ds/x,Zs/x),ps=e*Math.PI/180;if(ps){const Os=Math.sin(ps),or=Math.cos(ps),lr=[or,-Os,Os,or];rs._matMult(lr),ws._matMult(lr),Ks._matMult(lr),Ps._matMult(lr)}const Ls=Kt.stretch+Kt.fixed,Ys=ue.stretch+ue.fixed;return{tl:rs,tr:ws,bl:Ks,br:Ps,tex:{x:v.paddedRect.x+xl+Ls,y:v.paddedRect.y+xl+Ys,w:te.stretch+te.fixed-Ls,h:Ut.stretch+Ut.fixed-Ys},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Xs,pixelOffsetBR:fs,minFontScaleX:re/x/E,minFontScaleY:se/x/D,isSDF:n}};if(c&&(v.stretchX||v.stretchY)){const Kt=h_(R,X,U),ue=h_(B,st,G);for(let te=0;te<Kt.length-1;te++){const Ut=Kt[te],we=Kt[te+1];for(let ge=0;ge<ue.length-1;ge++)f.push(ee(Ut,ue[ge],we,ue[ge+1]))}}else f.push(ee({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:S+1}));return f}function Vu(s,e,n){let c=0;for(const f of s)c+=Math.max(e,Math.min(n,f[1]))-Math.max(e,Math.min(n,f[0]));return c}function h_(s,e,n){const c=[{fixed:-xl,stretch:0}];for(const[f,v]of s){const x=c[c.length-1];c.push({fixed:f-x.stretch,stretch:x.stretch}),c.push({fixed:f-x.stretch,stretch:x.stretch+(v-f)})}return c.push({fixed:e+xl,stretch:n}),c}function Uu(s,e,n,c){return s/e*n+c}function qu(s,e,n,c){return s-e*n/c}class ju{constructor(e,n,c,f,v,x,b,S,E,D){if(this.boxStartIndex=e.length,E){let R=x.top,B=x.bottom;const $=x.collisionPadding;$&&(R-=$[1],B+=$[3]);let U=B-R;U>0&&(U=Math.max(10,U),this.circleDiameter=U)}else{let R=x.top*b-S[0],B=x.bottom*b+S[2],$=x.left*b-S[3],U=x.right*b+S[1];const G=x.collisionPadding;if(G&&($-=G[0]*b,R-=G[1]*b,U+=G[2]*b,B+=G[3]*b),D){const X=new P($,R),st=new P(U,R),gt=new P($,B),nt=new P(U,B),ft=D*Math.PI/180;X._rotate(ft),st._rotate(ft),gt._rotate(ft),nt._rotate(ft),$=Math.min(X.x,st.x,gt.x,nt.x),U=Math.max(X.x,st.x,gt.x,nt.x),R=Math.min(X.y,st.y,gt.y,nt.y),B=Math.max(X.y,st.y,gt.y,nt.y)}e.emplaceBack(n.x,n.y,$,R,U,B,c,f,v)}this.boxEndIndex=e.length}}class hb{constructor(e=[],n=ub){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:c}=this,f=n[e];for(;e>0;){const v=e-1>>1,x=n[v];if(c(f,x)>=0)break;n[e]=x,e=v}n[e]=f}_down(e){const{data:n,compare:c}=this,f=this.length>>1,v=n[e];for(;e<f;){let x=1+(e<<1),b=n[x];const S=x+1;if(S<this.length&&c(n[S],b)<0&&(x=S,b=n[S]),c(b,v)>=0)break;n[e]=b,e=x}n[e]=v}}function ub(s,e){return s<e?-1:s>e?1:0}function db(s,e=1,n=!1){let c=1/0,f=1/0,v=-1/0,x=-1/0;const b=s[0];for(let $=0;$<b.length;$++){const U=b[$];(!$||U.x<c)&&(c=U.x),(!$||U.y<f)&&(f=U.y),(!$||U.x>v)&&(v=U.x),(!$||U.y>x)&&(x=U.y)}const S=Math.min(v-c,x-f);let E=S/2;const D=new hb([],fb);if(S===0)return new P(c,f);for(let $=c;$<v;$+=S)for(let U=f;U<x;U+=S)D.push(new bl($+E,U+E,E,s));let R=function($){let U=0,G=0,X=0;const st=$[0];for(let gt=0,nt=st.length,ft=nt-1;gt<nt;ft=gt++){const Et=st[gt],kt=st[ft],re=Et.x*kt.y-kt.x*Et.y;G+=(Et.x+kt.x)*re,X+=(Et.y+kt.y)*re,U+=3*re}return new bl(G/U,X/U,0,$)}(s),B=D.length;for(;D.length;){const $=D.pop();($.d>R.d||!R.d)&&(R=$,n&&console.log("found best %d after %d probes",Math.round(1e4*$.d)/1e4,B)),$.max-R.d<=e||(E=$.h/2,D.push(new bl($.p.x-E,$.p.y-E,E,s)),D.push(new bl($.p.x+E,$.p.y-E,E,s)),D.push(new bl($.p.x-E,$.p.y+E,E,s)),D.push(new bl($.p.x+E,$.p.y+E,E,s)),B+=4)}return n&&(console.log(`num probes: ${B}`),console.log(`best distance: ${R.d}`)),R.p}function fb(s,e){return e.max-s.max}function bl(s,e,n,c){this.p=new P(s,e),this.h=n,this.d=function(f,v){let x=!1,b=1/0;for(let S=0;S<v.length;S++){const E=v[S];for(let D=0,R=E.length,B=R-1;D<R;B=D++){const $=E[D],U=E[B];$.y>f.y!=U.y>f.y&&f.x<(U.x-$.x)*(f.y-$.y)/(U.y-$.y)+$.x&&(x=!x),b=Math.min(b,Wm(f,$,U))}}return(x?1:-1)*Math.sqrt(b)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}var Is;m.ap=void 0,(Is=m.ap||(m.ap={}))[Is.center=1]="center",Is[Is.left=2]="left",Is[Is.right=3]="right",Is[Is.top=4]="top",Is[Is.bottom=5]="bottom",Is[Is["top-left"]=6]="top-left",Is[Is["top-right"]=7]="top-right",Is[Is["bottom-left"]=8]="bottom-left",Is[Is["bottom-right"]=9]="bottom-right";const xa=7,sp=Number.POSITIVE_INFINITY;function u_(s,e){return e[1]!==sp?function(n,c,f){let v=0,x=0;switch(c=Math.abs(c),f=Math.abs(f),n){case"top-right":case"top-left":case"top":x=f-xa;break;case"bottom-right":case"bottom-left":case"bottom":x=-f+xa}switch(n){case"top-right":case"bottom-right":case"right":v=-c;break;case"top-left":case"bottom-left":case"left":v=c}return[v,x]}(s,e[0],e[1]):function(n,c){let f=0,v=0;c<0&&(c=0);const x=c/Math.SQRT2;switch(n){case"top-right":case"top-left":v=x-xa;break;case"bottom-right":case"bottom-left":v=-x+xa;break;case"bottom":v=-c+xa;break;case"top":v=c-xa}switch(n){case"top-right":case"bottom-right":f=-x;break;case"top-left":case"bottom-left":f=x;break;case"left":f=c;break;case"right":f=-c}return[f,v]}(s,e[0])}function d_(s,e,n){var c;const f=s.layout,v=(c=f.get("text-variable-anchor-offset"))===null||c===void 0?void 0:c.evaluate(e,{},n);if(v){const b=v.values,S=[];for(let E=0;E<b.length;E+=2){const D=S[E]=b[E],R=b[E+1].map(B=>B*us);D.startsWith("top")?R[1]-=xa:D.startsWith("bottom")&&(R[1]+=xa),S[E+1]=R}return new mr(S)}const x=f.get("text-variable-anchor");if(x){let b;b=s._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[f.get("text-radial-offset").evaluate(e,{},n)*us,sp]:f.get("text-offset").evaluate(e,{},n).map(E=>E*us);const S=[];for(const E of x)S.push(E,u_(E,b));return new mr(S)}return null}function rp(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function pb(s,e,n,c,f,v,x,b,S,E,D){let R=v.textMaxSize.evaluate(e,{});R===void 0&&(R=x);const B=s.layers[0].layout,$=B.get("icon-offset").evaluate(e,{},D),U=p_(n.horizontal),G=x/24,X=s.tilePixelRatio*G,st=s.tilePixelRatio*R/24,gt=s.tilePixelRatio*b,nt=s.tilePixelRatio*B.get("symbol-spacing"),ft=B.get("text-padding")*s.tilePixelRatio,Et=function(Ut,we,ge,Ze=1){const Ai=Ut.get("icon-padding").evaluate(we,{},ge),Ri=Ai&&Ai.values;return[Ri[0]*Ze,Ri[1]*Ze,Ri[2]*Ze,Ri[3]*Ze]}(B,e,D,s.tilePixelRatio),kt=B.get("text-max-angle")/180*Math.PI,re=B.get("text-rotation-alignment")!=="viewport"&&B.get("symbol-placement")!=="point",me=B.get("icon-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",se=B.get("symbol-placement"),ee=nt/2,Kt=B.get("icon-text-fit");let ue;c&&Kt!=="none"&&(s.allowVerticalPlacement&&n.vertical&&(ue=Fg(c,n.vertical,Kt,B.get("icon-text-fit-padding"),$,G)),U&&(c=Fg(c,U,Kt,B.get("icon-text-fit-padding"),$,G)));const te=(Ut,we)=>{we.x<0||we.x>=Hi||we.y<0||we.y>=Hi||function(ge,Ze,Ai,Ri,ds,vr,Zs,rs,ws,Ps,Ks,Xs,fs,ps,Ls,Ys,Os,or,lr,ms,Je,Fs,Cs,gs,Gr){const Qr=ge.addToLineVertexArray(Ze,Ai);let tn,Gn,Hr,zr,cr=0,Hn=0,Zc=0,y_=0,dp=-1,fp=-1;const Wn={};let v_=Ui("");if(ge.allowVerticalPlacement&&Ri.vertical){const Bs=rs.layout.get("text-rotate").evaluate(Je,{},gs)+90;Hr=new ju(ws,Ze,Ps,Ks,Xs,Ri.vertical,fs,ps,Ls,Bs),Zs&&(zr=new ju(ws,Ze,Ps,Ks,Xs,Zs,Os,or,Ls,Bs))}if(ds){const Bs=rs.layout.get("icon-rotate").evaluate(Je,{}),Lr=rs.layout.get("icon-text-fit")!=="none",lo=c_(ds,Bs,Cs,Lr),sn=Zs?c_(Zs,Bs,Cs,Lr):void 0;Gn=new ju(ws,Ze,Ps,Ks,Xs,ds,Os,or,!1,Bs),cr=4*lo.length;const co=ge.iconSizeData;let xn=null;co.kind==="source"?(xn=[vn*rs.layout.get("icon-size").evaluate(Je,{})],xn[0]>_a&&De(`${ge.layerIds[0]}: Value for "icon-size" is >= ${jc}. Reduce your "icon-size".`)):co.kind==="composite"&&(xn=[vn*Fs.compositeIconSizes[0].evaluate(Je,{},gs),vn*Fs.compositeIconSizes[1].evaluate(Je,{},gs)],(xn[0]>_a||xn[1]>_a)&&De(`${ge.layerIds[0]}: Value for "icon-size" is >= ${jc}. Reduce your "icon-size".`)),ge.addSymbols(ge.icon,lo,xn,ms,lr,Je,m.ah.none,Ze,Qr.lineStartIndex,Qr.lineLength,-1,gs),dp=ge.icon.placedSymbolArray.length-1,sn&&(Hn=4*sn.length,ge.addSymbols(ge.icon,sn,xn,ms,lr,Je,m.ah.vertical,Ze,Qr.lineStartIndex,Qr.lineLength,-1,gs),fp=ge.icon.placedSymbolArray.length-1)}const x_=Object.keys(Ri.horizontal);for(const Bs of x_){const Lr=Ri.horizontal[Bs];if(!tn){v_=Ui(Lr.text);const sn=rs.layout.get("text-rotate").evaluate(Je,{},gs);tn=new ju(ws,Ze,Ps,Ks,Xs,Lr,fs,ps,Ls,sn)}const lo=Lr.positionedLines.length===1;if(Zc+=f_(ge,Ze,Lr,vr,rs,Ls,Je,Ys,Qr,Ri.vertical?m.ah.horizontal:m.ah.horizontalOnly,lo?x_:[Bs],Wn,dp,Fs,gs),lo)break}Ri.vertical&&(y_+=f_(ge,Ze,Ri.vertical,vr,rs,Ls,Je,Ys,Qr,m.ah.vertical,["vertical"],Wn,fp,Fs,gs));const _b=tn?tn.boxStartIndex:ge.collisionBoxArray.length,yb=tn?tn.boxEndIndex:ge.collisionBoxArray.length,vb=Hr?Hr.boxStartIndex:ge.collisionBoxArray.length,xb=Hr?Hr.boxEndIndex:ge.collisionBoxArray.length,bb=Gn?Gn.boxStartIndex:ge.collisionBoxArray.length,wb=Gn?Gn.boxEndIndex:ge.collisionBoxArray.length,Mb=zr?zr.boxStartIndex:ge.collisionBoxArray.length,Sb=zr?zr.boxEndIndex:ge.collisionBoxArray.length;let en=-1;const Hu=(Bs,Lr)=>Bs&&Bs.circleDiameter?Math.max(Bs.circleDiameter,Lr):Lr;en=Hu(tn,en),en=Hu(Hr,en),en=Hu(Gn,en),en=Hu(zr,en);const b_=en>-1?1:0;b_&&(en*=Gr/us),ge.glyphOffsetArray.length>=vl.MAX_GLYPHS&&De("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Je.sortKey!==void 0&&ge.addToSortKeyRanges(ge.symbolInstances.length,Je.sortKey);const Tb=d_(rs,Je,gs),[Ab,Eb]=function(Bs,Lr){const lo=Bs.length,sn=Lr==null?void 0:Lr.values;if((sn==null?void 0:sn.length)>0)for(let co=0;co<sn.length;co+=2){const xn=sn[co+1];Bs.emplaceBack(m.ap[sn[co]],xn[0],xn[1])}return[lo,Bs.length]}(ge.textAnchorOffsets,Tb);ge.symbolInstances.emplaceBack(Ze.x,Ze.y,Wn.right>=0?Wn.right:-1,Wn.center>=0?Wn.center:-1,Wn.left>=0?Wn.left:-1,Wn.vertical||-1,dp,fp,v_,_b,yb,vb,xb,bb,wb,Mb,Sb,Ps,Zc,y_,cr,Hn,b_,0,fs,en,Ab,Eb)}(s,we,Ut,n,c,f,ue,s.layers[0],s.collisionBoxArray,e.index,e.sourceLayerIndex,s.index,X,[ft,ft,ft,ft],re,S,gt,Et,me,$,e,v,E,D,x)};if(se==="line")for(const Ut of s_(e.geometry,0,0,Hi,Hi)){const we=cb(Ut,nt,kt,n.vertical||U,c,24,st,s.overscaling,Hi);for(const ge of we)U&&mb(s,U.text,ee,ge)||te(Ut,ge)}else if(se==="line-center"){for(const Ut of e.geometry)if(Ut.length>1){const we=lb(Ut,kt,n.vertical||U,c,24,st);we&&te(Ut,we)}}else if(e.type==="Polygon")for(const Ut of Of(e.geometry,0)){const we=db(Ut,16);te(Ut[0],new va(we.x,we.y,0))}else if(e.type==="LineString")for(const Ut of e.geometry)te(Ut,new va(Ut[0].x,Ut[0].y,0));else if(e.type==="Point")for(const Ut of e.geometry)for(const we of Ut)te([we],new va(we.x,we.y,0))}function f_(s,e,n,c,f,v,x,b,S,E,D,R,B,$,U){const G=function(gt,nt,ft,Et,kt,re,me,se){const ee=Et.layout.get("text-rotate").evaluate(re,{})*Math.PI/180,Kt=[];for(const ue of nt.positionedLines)for(const te of ue.positionedGlyphs){if(!te.rect)continue;const Ut=te.rect||{};let we=Cg+1,ge=!0,Ze=1,Ai=0;const Ri=(kt||se)&&te.vertical,ds=te.metrics.advance*te.scale/2;if(se&&nt.verticalizable&&(Ai=ue.lineOffset/2-(te.imageName?-(us-te.metrics.width*te.scale)/2:(te.scale-1)*us)),te.imageName){const ms=me[te.imageName];ge=ms.sdf,Ze=ms.pixelRatio,we=ar/Ze}const vr=kt?[te.x+ds,te.y]:[0,0];let Zs=kt?[0,0]:[te.x+ds+ft[0],te.y+ft[1]-Ai],rs=[0,0];Ri&&(rs=Zs,Zs=[0,0]);const ws=te.metrics.isDoubleResolution?2:1,Ps=(te.metrics.left-we)*te.scale-ds+Zs[0],Ks=(-te.metrics.top-we)*te.scale+Zs[1],Xs=Ps+Ut.w/ws*te.scale/Ze,fs=Ks+Ut.h/ws*te.scale/Ze,ps=new P(Ps,Ks),Ls=new P(Xs,Ks),Ys=new P(Ps,fs),Os=new P(Xs,fs);if(Ri){const ms=new P(-ds,ds-Uc),Je=-Math.PI/2,Fs=us/2-ds,Cs=new P(5-Uc-Fs,-(te.imageName?Fs:0)),gs=new P(...rs);ps._rotateAround(Je,ms)._add(Cs)._add(gs),Ls._rotateAround(Je,ms)._add(Cs)._add(gs),Ys._rotateAround(Je,ms)._add(Cs)._add(gs),Os._rotateAround(Je,ms)._add(Cs)._add(gs)}if(ee){const ms=Math.sin(ee),Je=Math.cos(ee),Fs=[Je,-ms,ms,Je];ps._matMult(Fs),Ls._matMult(Fs),Ys._matMult(Fs),Os._matMult(Fs)}const or=new P(0,0),lr=new P(0,0);Kt.push({tl:ps,tr:Ls,bl:Ys,br:Os,tex:Ut,writingMode:nt.writingMode,glyphOffset:vr,sectionIndex:te.sectionIndex,isSDF:ge,pixelOffsetTL:or,pixelOffsetBR:lr,minFontScaleX:0,minFontScaleY:0})}return Kt}(0,n,b,f,v,x,c,s.allowVerticalPlacement),X=s.textSizeData;let st=null;X.kind==="source"?(st=[vn*f.layout.get("text-size").evaluate(x,{})],st[0]>_a&&De(`${s.layerIds[0]}: Value for "text-size" is >= ${jc}. Reduce your "text-size".`)):X.kind==="composite"&&(st=[vn*$.compositeTextSizes[0].evaluate(x,{},U),vn*$.compositeTextSizes[1].evaluate(x,{},U)],(st[0]>_a||st[1]>_a)&&De(`${s.layerIds[0]}: Value for "text-size" is >= ${jc}. Reduce your "text-size".`)),s.addSymbols(s.text,G,st,b,v,x,E,e,S.lineStartIndex,S.lineLength,B,U);for(const gt of D)R[gt]=s.text.placedSymbolArray.length-1;return 4*G.length}function p_(s){for(const e in s)return s[e];return null}function mb(s,e,n,c){const f=s.compareText;if(e in f){const v=f[e];for(let x=v.length-1;x>=0;x--)if(c.dist(v[x])<n)return!0}else f[e]=[];return f[e].push(c),!1}const m_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class np{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,c]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const f=c>>4;if(f!==1)throw new Error(`Got v${f} data when expected v1.`);const v=m_[15&c];if(!v)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(e,2,1),[b]=new Uint32Array(e,4,1);return new np(b,x,v,e)}constructor(e,n=64,c=Float64Array,f){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=c,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const v=m_.indexOf(this.ArrayType),x=2*e*this.ArrayType.BYTES_PER_ELEMENT,b=e*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-b%8)%8;if(v<0)throw new Error(`Unexpected typed array class: ${c}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+S,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+x+b+S),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+S,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+v]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=e,this.coords[this._pos++]=n,c}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return ap(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,c,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:x,nodeSize:b}=this,S=[0,v.length-1,0],E=[];for(;S.length;){const D=S.pop()||0,R=S.pop()||0,B=S.pop()||0;if(R-B<=b){for(let X=B;X<=R;X++){const st=x[2*X],gt=x[2*X+1];st>=e&&st<=c&&gt>=n&&gt<=f&&E.push(v[X])}continue}const $=B+R>>1,U=x[2*$],G=x[2*$+1];U>=e&&U<=c&&G>=n&&G<=f&&E.push(v[$]),(D===0?e<=U:n<=G)&&(S.push(B),S.push($-1),S.push(1-D)),(D===0?c>=U:f>=G)&&(S.push($+1),S.push(R),S.push(1-D))}return E}within(e,n,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:v,nodeSize:x}=this,b=[0,f.length-1,0],S=[],E=c*c;for(;b.length;){const D=b.pop()||0,R=b.pop()||0,B=b.pop()||0;if(R-B<=x){for(let X=B;X<=R;X++)__(v[2*X],v[2*X+1],e,n)<=E&&S.push(f[X]);continue}const $=B+R>>1,U=v[2*$],G=v[2*$+1];__(U,G,e,n)<=E&&S.push(f[$]),(D===0?e-c<=U:n-c<=G)&&(b.push(B),b.push($-1),b.push(1-D)),(D===0?e+c>=U:n+c>=G)&&(b.push($+1),b.push(R),b.push(1-D))}return S}}function ap(s,e,n,c,f,v){if(f-c<=n)return;const x=c+f>>1;g_(s,e,x,c,f,v),ap(s,e,n,c,x-1,1-v),ap(s,e,n,x+1,f,1-v)}function g_(s,e,n,c,f,v){for(;f>c;){if(f-c>600){const E=f-c+1,D=n-c+1,R=Math.log(E),B=.5*Math.exp(2*R/3),$=.5*Math.sqrt(R*B*(E-B)/E)*(D-E/2<0?-1:1);g_(s,e,n,Math.max(c,Math.floor(n-D*B/E+$)),Math.min(f,Math.floor(n+(E-D)*B/E+$)),v)}const x=e[2*n+v];let b=c,S=f;for(Hc(s,e,c,n),e[2*f+v]>x&&Hc(s,e,c,f);b<S;){for(Hc(s,e,b,S),b++,S--;e[2*b+v]<x;)b++;for(;e[2*S+v]>x;)S--}e[2*c+v]===x?Hc(s,e,c,S):(S++,Hc(s,e,S,f)),S<=n&&(c=S+1),n<=S&&(f=S-1)}}function Hc(s,e,n,c){op(s,n,c),op(e,2*n,2*c),op(e,2*n+1,2*c+1)}function op(s,e,n){const c=s[e];s[e]=s[n],s[n]=c}function __(s,e,n,c){const f=s-n,v=e-c;return f*f+v*v}var lp;m.bd=void 0,(lp=m.bd||(m.bd={})).create="create",lp.load="load",lp.fullLoad="fullLoad";let Gu=null,Wc=[];const cp=1e3/60,hp="loadTime",up="fullLoadTime",gb={mark(s){performance.mark(s)},frame(s){const e=s;Gu!=null&&Wc.push(e-Gu),Gu=e},clearMetrics(){Gu=null,Wc=[],performance.clearMeasures(hp),performance.clearMeasures(up);for(const s in m.bd)performance.clearMarks(m.bd[s])},getPerformanceMetrics(){performance.measure(hp,m.bd.create,m.bd.load),performance.measure(up,m.bd.create,m.bd.fullLoad);const s=performance.getEntriesByName(hp)[0].duration,e=performance.getEntriesByName(up)[0].duration,n=Wc.length,c=1/(Wc.reduce((v,x)=>v+x,0)/n/1e3),f=Wc.filter(v=>v>cp).reduce((v,x)=>v+(x-cp)/cp,0);return{loadTime:s,fullLoadTime:e,fps:c,percentDroppedFrames:f/(n+f)*100,totalFrames:n}}};m.$=Xt,m.A=fl,m.B=function(s){if(Le==null){const e=s.navigator?s.navigator.userAgent:null;Le=!!s.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Le},m.C=class{constructor(s,e){this.target=s,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new ab(()=>this.process()),this.subscription=function(n,c,f,v){return n.addEventListener(c,f,!1),{unsubscribe:()=>{n.removeEventListener(c,f,!1)}}}(this.target,"message",n=>this.receive(n)),this.globalScope=Re(self)?s:window}registerMessageHandler(s,e){this.messageHandlers[s]=e}sendAsync(s,e){return new Promise((n,c)=>{const f=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[f]={resolve:n,reject:c},e&&e.signal.addEventListener("abort",()=>{delete this.resolveRejects[f];const b={id:f,type:"<cancel>",origin:location.origin,targetMapId:s.targetMapId,sourceMapId:this.mapId};this.target.postMessage(b)},{once:!0});const v=[],x=Object.assign(Object.assign({},s),{id:f,sourceMapId:this.mapId,origin:location.origin,data:ua(s.data,v)});this.target.postMessage(x,{transfer:v})})}receive(s){const e=s.data,n=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[n];const c=this.abortControllers[n];return delete this.abortControllers[n],void(c&&c.abort())}if(Re(self)||e.mustQueue)return this.tasks[n]=e,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,e)}}process(){if(this.taskQueue.length===0)return;const s=this.taskQueue.shift(),e=this.tasks[s];delete this.tasks[s],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(s,e)}processTask(s,e){return l(this,void 0,void 0,function*(){if(e.type==="<response>"){const f=this.resolveRejects[s];return delete this.resolveRejects[s],f?void(e.error?f.reject(da(e.error)):f.resolve(da(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(s,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=da(e.data),c=new AbortController;this.abortControllers[s]=c;try{const f=yield this.messageHandlers[e.type](e.sourceMapId,n,c);this.completeTask(s,null,f)}catch(f){this.completeTask(s,f)}})}completeTask(s,e,n){const c=[];delete this.abortControllers[s];const f={id:s,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?ua(e):null,data:ua(n,c)};this.target.postMessage(f,{transfer:c})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},m.D=ve,m.E=Ft,m.F=function(){var s=new fl(16);return fl!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},m.G=Rt,m.H=function(s,e,n){var c,f,v,x,b,S,E,D,R,B,$,U,G=n[0],X=n[1],st=n[2];return e===s?(s[12]=e[0]*G+e[4]*X+e[8]*st+e[12],s[13]=e[1]*G+e[5]*X+e[9]*st+e[13],s[14]=e[2]*G+e[6]*X+e[10]*st+e[14],s[15]=e[3]*G+e[7]*X+e[11]*st+e[15]):(f=e[1],v=e[2],x=e[3],b=e[4],S=e[5],E=e[6],D=e[7],R=e[8],B=e[9],$=e[10],U=e[11],s[0]=c=e[0],s[1]=f,s[2]=v,s[3]=x,s[4]=b,s[5]=S,s[6]=E,s[7]=D,s[8]=R,s[9]=B,s[10]=$,s[11]=U,s[12]=c*G+b*X+R*st+e[12],s[13]=f*G+S*X+B*st+e[13],s[14]=v*G+E*X+$*st+e[14],s[15]=x*G+D*X+U*st+e[15]),s},m.I=Hf,m.J=function(s,e,n){var c=n[0],f=n[1],v=n[2];return s[0]=e[0]*c,s[1]=e[1]*c,s[2]=e[2]*c,s[3]=e[3]*c,s[4]=e[4]*f,s[5]=e[5]*f,s[6]=e[6]*f,s[7]=e[7]*f,s[8]=e[8]*v,s[9]=e[9]*v,s[10]=e[10]*v,s[11]=e[11]*v,s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15],s},m.K=Ym,m.L=function(s,e){const n={};for(let c=0;c<e.length;c++){const f=e[c];f in s&&(n[f]=s[f])}return n},m.M=ya,m.N=Hg,m.O=Wg,m.P=P,m.Q=Rr,m.R=kr,m.S=yt,m.T=_c,m.U=At,m.V=Ds,m.W=Hi,m.X=Xi,m.Y=$u,m.Z=class extends xc{},m._=l,m.a=As,m.a$=function(s,e,n){return s[0]=e[0]*n[0],s[1]=e[1]*n[1],s[2]=e[2]*n[2],s[3]=e[3]*n[3],s},m.a0=ip,m.a1=zt,m.a2=s=>{const e=window.document.createElement("video");return e.muted=!0,new Promise(n=>{e.onloadstart=()=>{n(e)};for(const c of s){const f=window.document.createElement("source");ni(c)||(e.crossOrigin="Anonymous"),f.src=c,e.appendChild(f)}})},m.a3=function(){return ne++},m.a4=g,m.a5=vl,m.a6=Ho,m.a7=qn,m.a8=Di,m.a9=Qg,m.aA=Dt,m.aB=function(s,e){if(!s)return[{command:"setStyle",args:[e]}];let n=[];try{if(!Ct(s.version,e.version))return[{command:"setStyle",args:[e]}];Ct(s.center,e.center)||n.push({command:"setCenter",args:[e.center]}),Ct(s.zoom,e.zoom)||n.push({command:"setZoom",args:[e.zoom]}),Ct(s.bearing,e.bearing)||n.push({command:"setBearing",args:[e.bearing]}),Ct(s.pitch,e.pitch)||n.push({command:"setPitch",args:[e.pitch]}),Ct(s.sprite,e.sprite)||n.push({command:"setSprite",args:[e.sprite]}),Ct(s.glyphs,e.glyphs)||n.push({command:"setGlyphs",args:[e.glyphs]}),Ct(s.transition,e.transition)||n.push({command:"setTransition",args:[e.transition]}),Ct(s.light,e.light)||n.push({command:"setLight",args:[e.light]}),Ct(s.terrain,e.terrain)||n.push({command:"setTerrain",args:[e.terrain]}),Ct(s.sky,e.sky)||n.push({command:"setSky",args:[e.sky]});const c={},f=[];(function(x,b,S,E){let D;for(D in b=b||{},x=x||{})Object.prototype.hasOwnProperty.call(x,D)&&(Object.prototype.hasOwnProperty.call(b,D)||fe(D,S,E));for(D in b)Object.prototype.hasOwnProperty.call(b,D)&&(Object.prototype.hasOwnProperty.call(x,D)?Ct(x[D],b[D])||(x[D].type==="geojson"&&b[D].type==="geojson"&&be(x,b,D)?Ht(S,{command:"setGeoJSONSourceData",args:[D,b[D].data]}):Ae(D,b,S,E)):jt(D,b,S))})(s.sources,e.sources,f,c);const v=[];s.layers&&s.layers.forEach(x=>{"source"in x&&c[x.source]?n.push({command:"removeLayer",args:[x.id]}):v.push(x)}),n=n.concat(f),function(x,b,S){b=b||[];const E=(x=x||[]).map(Ke),D=b.map(Ke),R=x.reduce(si,{}),B=b.reduce(si,{}),$=E.slice(),U=Object.create(null);let G,X,st,gt,nt;for(let ft=0,Et=0;ft<E.length;ft++)G=E[ft],Object.prototype.hasOwnProperty.call(B,G)?Et++:(Ht(S,{command:"removeLayer",args:[G]}),$.splice($.indexOf(G,Et),1));for(let ft=0,Et=0;ft<D.length;ft++)G=D[D.length-1-ft],$[$.length-1-ft]!==G&&(Object.prototype.hasOwnProperty.call(R,G)?(Ht(S,{command:"removeLayer",args:[G]}),$.splice($.lastIndexOf(G,$.length-Et),1)):Et++,gt=$[$.length-ft],Ht(S,{command:"addLayer",args:[B[G],gt]}),$.splice($.length-ft,0,G),U[G]=!0);for(let ft=0;ft<D.length;ft++)if(G=D[ft],X=R[G],st=B[G],!U[G]&&!Ct(X,st))if(Ct(X.source,st.source)&&Ct(X["source-layer"],st["source-layer"])&&Ct(X.type,st.type)){for(nt in Pe(X.layout,st.layout,S,G,null,"setLayoutProperty"),Pe(X.paint,st.paint,S,G,null,"setPaintProperty"),Ct(X.filter,st.filter)||Ht(S,{command:"setFilter",args:[G,st.filter]}),Ct(X.minzoom,st.minzoom)&&Ct(X.maxzoom,st.maxzoom)||Ht(S,{command:"setLayerZoomRange",args:[G,st.minzoom,st.maxzoom]}),X)Object.prototype.hasOwnProperty.call(X,nt)&&nt!=="layout"&&nt!=="paint"&&nt!=="filter"&&nt!=="metadata"&&nt!=="minzoom"&&nt!=="maxzoom"&&(nt.indexOf("paint.")===0?Pe(X[nt],st[nt],S,G,nt.slice(6),"setPaintProperty"):Ct(X[nt],st[nt])||Ht(S,{command:"setLayerProperty",args:[G,nt,st[nt]]}));for(nt in st)Object.prototype.hasOwnProperty.call(st,nt)&&!Object.prototype.hasOwnProperty.call(X,nt)&&nt!=="layout"&&nt!=="paint"&&nt!=="filter"&&nt!=="metadata"&&nt!=="minzoom"&&nt!=="maxzoom"&&(nt.indexOf("paint.")===0?Pe(X[nt],st[nt],S,G,nt.slice(6),"setPaintProperty"):Ct(X[nt],st[nt])||Ht(S,{command:"setLayerProperty",args:[G,nt,st[nt]]}))}else Ht(S,{command:"removeLayer",args:[G]}),gt=$[$.lastIndexOf(G)+1],Ht(S,{command:"addLayer",args:[st,gt]})}(v,e.layers,n)}catch(c){console.warn("Unable to compute style diff:",c),n=[{command:"setStyle",args:[e]}]}return n},m.aC=function(s){const e=[],n=s.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),s.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},m.aD=function s(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(let c=0;c<e.length;c++)if(!s(e[c],n[c]))return!1;return!0}if(typeof e=="object"&&e!==null&&n!==null){if(typeof n!="object"||Object.keys(e).length!==Object.keys(n).length)return!1;for(const c in e)if(!s(e[c],n[c]))return!1;return!0}return e===n},m.aE=Vt,m.aF=Gt,m.aG=class extends hs{constructor(s,e){super(s,e),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},m.aH=nr,m.aI=class extends hs{constructor(s,e){super(s,e),this.current=ao}set(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let e=1;e<16;e++)if(s[e]!==this.current[e]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}},m.aJ=qr,m.aK=class extends hs{constructor(s,e){super(s,e),this.current=[0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))}},m.aL=class extends hs{constructor(s,e){super(s,e),this.current=[0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))}},m.aM=gn,m.aN=function(s,e,n,c,f,v,x){var b=1/(e-n),S=1/(c-f),E=1/(v-x);return s[0]=-2*b,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*S,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*E,s[11]=0,s[12]=(e+n)*b,s[13]=(f+c)*S,s[14]=(x+v)*E,s[15]=1,s},m.aO=fi,m.aP=$x,m.aQ=class extends nl{},m.aR=z1,m.aS=class extends al{},m.aT=function(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))},m.aU=ig,m.aV=O,m.aW=class extends Ac{},m.aX=St,m.aY=function(s,e){return s[0]===e[0]&&s[1]===e[1]&&s[2]===e[2]&&s[3]===e[3]&&s[4]===e[4]&&s[5]===e[5]&&s[6]===e[6]&&s[7]===e[7]&&s[8]===e[8]&&s[9]===e[9]&&s[10]===e[10]&&s[11]===e[11]&&s[12]===e[12]&&s[13]===e[13]&&s[14]===e[14]&&s[15]===e[15]},m.aZ=function(s,e){var n=s[0],c=s[1],f=s[2],v=s[3],x=s[4],b=s[5],S=s[6],E=s[7],D=s[8],R=s[9],B=s[10],$=s[11],U=s[12],G=s[13],X=s[14],st=s[15],gt=e[0],nt=e[1],ft=e[2],Et=e[3],kt=e[4],re=e[5],me=e[6],se=e[7],ee=e[8],Kt=e[9],ue=e[10],te=e[11],Ut=e[12],we=e[13],ge=e[14],Ze=e[15];return Math.abs(n-gt)<=Ws*Math.max(1,Math.abs(n),Math.abs(gt))&&Math.abs(c-nt)<=Ws*Math.max(1,Math.abs(c),Math.abs(nt))&&Math.abs(f-ft)<=Ws*Math.max(1,Math.abs(f),Math.abs(ft))&&Math.abs(v-Et)<=Ws*Math.max(1,Math.abs(v),Math.abs(Et))&&Math.abs(x-kt)<=Ws*Math.max(1,Math.abs(x),Math.abs(kt))&&Math.abs(b-re)<=Ws*Math.max(1,Math.abs(b),Math.abs(re))&&Math.abs(S-me)<=Ws*Math.max(1,Math.abs(S),Math.abs(me))&&Math.abs(E-se)<=Ws*Math.max(1,Math.abs(E),Math.abs(se))&&Math.abs(D-ee)<=Ws*Math.max(1,Math.abs(D),Math.abs(ee))&&Math.abs(R-Kt)<=Ws*Math.max(1,Math.abs(R),Math.abs(Kt))&&Math.abs(B-ue)<=Ws*Math.max(1,Math.abs(B),Math.abs(ue))&&Math.abs($-te)<=Ws*Math.max(1,Math.abs($),Math.abs(te))&&Math.abs(U-Ut)<=Ws*Math.max(1,Math.abs(U),Math.abs(Ut))&&Math.abs(G-we)<=Ws*Math.max(1,Math.abs(G),Math.abs(we))&&Math.abs(X-ge)<=Ws*Math.max(1,Math.abs(X),Math.abs(ge))&&Math.abs(st-Ze)<=Ws*Math.max(1,Math.abs(st),Math.abs(Ze))},m.a_=function(s,e){return s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[3],s[4]=e[4],s[5]=e[5],s[6]=e[6],s[7]=e[7],s[8]=e[8],s[9]=e[9],s[10]=e[10],s[11]=e[11],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15],s},m.aa=function(s){const e={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,c,f,v)=>{const x=f||v;return e[c]=!x||x.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e},m.ab=function(s,e){const n=[];for(const c in s)c in e||n.push(c);return n},m.ac=$t,m.ad=function(s,e,n){var c=Math.sin(n),f=Math.cos(n),v=e[0],x=e[1],b=e[2],S=e[3],E=e[4],D=e[5],R=e[6],B=e[7];return e!==s&&(s[8]=e[8],s[9]=e[9],s[10]=e[10],s[11]=e[11],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[0]=v*f+E*c,s[1]=x*f+D*c,s[2]=b*f+R*c,s[3]=S*f+B*c,s[4]=E*f-v*c,s[5]=D*f-x*c,s[6]=R*f-b*c,s[7]=B*f-S*c,s},m.ae=function(s){var e=new fl(16);return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],e[9]=s[9],e[10]=s[10],e[11]=s[11],e[12]=s[12],e[13]=s[13],e[14]=s[14],e[15]=s[15],e},m.af=Pu,m.ag=function(s,e){let n=0,c=0;if(s.kind==="constant")c=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:f,minZoom:v,maxZoom:x}=s,b=f?$t(Es.interpolationFactor(f,e,v,x),0,1):0;s.kind==="camera"?c=Rs.number(s.minSize,s.maxSize,b):n=b}return{uSizeT:n,uSize:c}},m.ai=function(s,{uSize:e,uSizeT:n},{lowerSize:c,upperSize:f}){return s.kind==="source"?c/vn:s.kind==="composite"?Rs.number(c/vn,f/vn,n):e},m.aj=Xf,m.ak=function(s,e,n,c){const f=e.y-s.y,v=e.x-s.x,x=c.y-n.y,b=c.x-n.x,S=x*v-b*f;if(S===0)return null;const E=(b*(s.y-n.y)-x*(s.x-n.x))/S;return new P(s.x+E*v,s.y+E*f)},m.al=s_,m.am=Ic,m.an=Pf,m.ao=us,m.aq=Kf,m.ar=function(s,e){var n=e[0],c=e[1],f=e[2],v=e[3],x=e[4],b=e[5],S=e[6],E=e[7],D=e[8],R=e[9],B=e[10],$=e[11],U=e[12],G=e[13],X=e[14],st=e[15],gt=n*b-c*x,nt=n*S-f*x,ft=n*E-v*x,Et=c*S-f*b,kt=c*E-v*b,re=f*E-v*S,me=D*G-R*U,se=D*X-B*U,ee=D*st-$*U,Kt=R*X-B*G,ue=R*st-$*G,te=B*st-$*X,Ut=gt*te-nt*ue+ft*Kt+Et*ee-kt*se+re*me;return Ut?(s[0]=(b*te-S*ue+E*Kt)*(Ut=1/Ut),s[1]=(f*ue-c*te-v*Kt)*Ut,s[2]=(G*re-X*kt+st*Et)*Ut,s[3]=(B*kt-R*re-$*Et)*Ut,s[4]=(S*ee-x*te-E*se)*Ut,s[5]=(n*te-f*ee+v*se)*Ut,s[6]=(X*ft-U*re-st*nt)*Ut,s[7]=(D*re-B*ft+$*nt)*Ut,s[8]=(x*ue-b*ee+E*me)*Ut,s[9]=(c*ee-n*ue-v*me)*Ut,s[10]=(U*kt-G*ft+st*gt)*Ut,s[11]=(R*ft-D*kt-$*gt)*Ut,s[12]=(b*se-x*Kt-S*me)*Ut,s[13]=(n*Kt-c*se+f*me)*Ut,s[14]=(G*nt-U*Et-X*gt)*Ut,s[15]=(D*Et-R*nt+B*gt)*Ut,s):null},m.as=rp,m.at=Zf,m.au=np,m.av=function(){const s={},e=it.$version;for(const n in it.$root){const c=it.$root[n];if(c.required){let f=null;f=n==="version"?e:c.type==="array"?[]:{},f!=null&&(s[n]=f)}}return s},m.aw=mu,m.ax=ae,m.ay=function(s){s=s.slice();const e=Object.create(null);for(let n=0;n<s.length;n++)e[s[n].id]=s[n];for(let n=0;n<s.length;n++)"ref"in s[n]&&(s[n]=le(s[n],e[s[n].ref]));return s},m.az=function(s){if(s.type==="custom")return new nb(s);switch(s.type){case"background":return new ib(s);case"circle":return new Vx(s);case"fill":return new o1(s);case"fill-extrusion":return new w1(s);case"heatmap":return new qx(s);case"hillshade":return new Gx(s);case"line":return new C1(s);case"raster":return new rb(s);case"symbol":return new Nu(s)}},m.b=ii,m.b0=function(s,e){return s[0]*e[0]+s[1]*e[1]+s[2]*e[2]+s[3]*e[3]},m.b1=qt,m.b2=Xg,m.b3=Zg,m.b4=function(s,e,n,c,f){var v,x=1/Math.tan(e/2);return s[0]=x/n,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=x,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,f!=null&&f!==1/0?(s[10]=(f+c)*(v=1/(c-f)),s[14]=2*f*c*v):(s[10]=-1,s[14]=-2*c),s},m.b5=function(s,e,n){var c=Math.sin(n),f=Math.cos(n),v=e[4],x=e[5],b=e[6],S=e[7],E=e[8],D=e[9],R=e[10],B=e[11];return e!==s&&(s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[3],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[4]=v*f+E*c,s[5]=x*f+D*c,s[6]=b*f+R*c,s[7]=S*f+B*c,s[8]=E*f-v*c,s[9]=D*f-x*c,s[10]=R*f-b*c,s[11]=B*f-S*c,s},m.b6=ht,m.b7=Tt,m.b8=function(s){return s*Math.PI/180},m.b9=function(s,e){return s[0]=e[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=e[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=e[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},m.bA=mn,m.ba=class extends Yr{},m.bb=tp,m.bc=gb,m.be=ce,m.bf=function(s,e){As.REGISTERED_PROTOCOLS[s]=e},m.bg=function(s){delete As.REGISTERED_PROTOCOLS[s]},m.bh=function(s,e){const n={};for(let f=0;f<s.length;f++){const v=e&&e[s[f].id]||Sf(s[f]);e&&(e[s[f].id]=v);let x=n[v];x||(x=n[v]=[]),x.push(s[f])}const c=[];for(const f in n)c.push(n[f]);return c},m.bi=he,m.bj=Jg,m.bk=t_,m.bl=kg,m.bm=function(s){s.bucket.createArrays(),s.bucket.tilePixelRatio=Hi/(512*s.bucket.overscaling),s.bucket.compareText={},s.bucket.iconsNeedLinear=!1;const e=s.bucket.layers[0],n=e.layout,c=e._unevaluatedLayout._values,f={layoutIconSize:c["icon-size"].possiblyEvaluate(new Di(s.bucket.zoom+1),s.canonical),layoutTextSize:c["text-size"].possiblyEvaluate(new Di(s.bucket.zoom+1),s.canonical),textMaxSize:c["text-size"].possiblyEvaluate(new Di(18))};if(s.bucket.textSizeData.kind==="composite"){const{minZoom:E,maxZoom:D}=s.bucket.textSizeData;f.compositeTextSizes=[c["text-size"].possiblyEvaluate(new Di(E),s.canonical),c["text-size"].possiblyEvaluate(new Di(D),s.canonical)]}if(s.bucket.iconSizeData.kind==="composite"){const{minZoom:E,maxZoom:D}=s.bucket.iconSizeData;f.compositeIconSizes=[c["icon-size"].possiblyEvaluate(new Di(E),s.canonical),c["icon-size"].possiblyEvaluate(new Di(D),s.canonical)]}const v=n.get("text-line-height")*us,x=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",b=n.get("text-keep-upright"),S=n.get("text-size");for(const E of s.bucket.features){const D=n.get("text-font").evaluate(E,{},s.canonical).join(","),R=S.evaluate(E,{},s.canonical),B=f.layoutTextSize.evaluate(E,{},s.canonical),$=f.layoutIconSize.evaluate(E,{},s.canonical),U={horizontal:{},vertical:void 0},G=E.text;let X,st=[0,0];if(G){const ft=G.toString(),Et=n.get("text-letter-spacing").evaluate(E,{},s.canonical)*us,kt=gu(ft)?Et:0,re=n.get("text-anchor").evaluate(E,{},s.canonical),me=d_(e,E,s.canonical);if(!me){const te=n.get("text-radial-offset").evaluate(E,{},s.canonical);st=te?u_(re,[te*us,sp]):n.get("text-offset").evaluate(E,{},s.canonical).map(Ut=>Ut*us)}let se=x?"center":n.get("text-justify").evaluate(E,{},s.canonical);const ee=n.get("symbol-placement"),Kt=ee==="point"?n.get("text-max-width").evaluate(E,{},s.canonical)*us:0,ue=()=>{s.bucket.allowVerticalPlacement&&fa(ft)&&(U.vertical=Ou(G,s.glyphMap,s.glyphPositions,s.imagePositions,D,Kt,v,re,"left",kt,st,m.ah.vertical,!0,ee,B,R))};if(!x&&me){const te=new Set;if(se==="auto")for(let we=0;we<me.values.length;we+=2)te.add(rp(me.values[we]));else te.add(se);let Ut=!1;for(const we of te)if(!U.horizontal[we])if(Ut)U.horizontal[we]=U.horizontal[0];else{const ge=Ou(G,s.glyphMap,s.glyphPositions,s.imagePositions,D,Kt,v,"center",we,kt,st,m.ah.horizontal,!1,ee,B,R);ge&&(U.horizontal[we]=ge,Ut=ge.positionedLines.length===1)}ue()}else{se==="auto"&&(se=rp(re));const te=Ou(G,s.glyphMap,s.glyphPositions,s.imagePositions,D,Kt,v,re,se,kt,st,m.ah.horizontal,!1,ee,B,R);te&&(U.horizontal[se]=te),ue(),fa(ft)&&x&&b&&(U.vertical=Ou(G,s.glyphMap,s.glyphPositions,s.imagePositions,D,Kt,v,re,se,kt,st,m.ah.vertical,!1,ee,B,R))}}let gt=!1;if(E.icon&&E.icon.name){const ft=s.imageMap[E.icon.name];ft&&(X=Y1(s.imagePositions[E.icon.name],n.get("icon-offset").evaluate(E,{},s.canonical),n.get("icon-anchor").evaluate(E,{},s.canonical)),gt=!!ft.sdf,s.bucket.sdfIcons===void 0?s.bucket.sdfIcons=gt:s.bucket.sdfIcons!==gt&&De("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ft.pixelRatio!==s.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(s.bucket.iconsNeedLinear=!0))}const nt=p_(U.horizontal)||U.vertical;s.bucket.iconsInText=!!nt&&nt.iconsInText,(nt||X)&&pb(s.bucket,E,U,X,s.imageMap,f,B,$,st,gt,s.canonical)}s.showCollisionBoxes&&s.bucket.generateCollisionDebugBuffers()},m.bn=Uf,m.bo=Nf,m.bp=Vf,m.bq=ma,m.br=jf,m.bs=class{constructor(s){this._marks={start:[s.url,"start"].join("#"),end:[s.url,"end"].join("#"),measure:s.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let s=performance.getEntriesByName(this._marks.measure);return s.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),s=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),s}},m.bt=function(s,e,n,c,f){return l(this,void 0,void 0,function*(){if(At())try{return yield Ds(s,e,n,c,f)}catch{}return function(v,x,b,S,E){const D=v.width,R=v.height;Ei&&hi||(Ei=new OffscreenCanvas(D,R),hi=Ei.getContext("2d",{willReadFrequently:!0})),Ei.width=D,Ei.height=R,hi.drawImage(v,0,0,D,R);const B=hi.getImageData(x,b,S,E);return hi.clearRect(0,0,D,R),B.data}(s,e,n,c,f)})},m.bu=Yg,m.bv=T,m.bw=I,m.bx=Mg,m.by=Fn,m.bz=function(s){return s.message===bs},m.c=fr,m.d=s=>l(void 0,void 0,void 0,function*(){if(s.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(s)],{type:"image/png"});try{return createImageBitmap(e)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),m.e=oe,m.f=s=>new Promise((e,n)=>{const c=new Image;c.onload=()=>{e(c),URL.revokeObjectURL(c.src),c.onload=null,window.requestAnimationFrame(()=>{c.src=xs})},c.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const f=new Blob([new Uint8Array(s)],{type:"image/png"});c.src=s.byteLength?URL.createObjectURL(f):xs}),m.g=Ii,m.h=(s,e)=>ye(oe(s,{type:"json"}),e),m.i=Re,m.j=Mt,m.k=rt,m.l=(s,e)=>ye(oe(s,{type:"arrayBuffer"}),e),m.m=ye,m.n=function(s){return new jf(s).readFields(G1,[])},m.o=zc,m.p=Dg,m.q=Hs,m.r=Tf,m.s=ni,m.t=ha,m.u=ie,m.v=it,m.w=De,m.x=Nn,m.y=function([s,e,n]){return e+=90,e*=Math.PI/180,n*=Math.PI/180,{x:s*Math.cos(e)*Math.sin(n),y:s*Math.sin(e)*Math.sin(n),z:s*Math.cos(n)}},m.z=Rs}),p("worker",["./shared"],function(m){class l{constructor(F){this.keyCache={},F&&this.replace(F)}replace(F){this._layerConfigs={},this._layers={},this.update(F,[])}update(F,N){for(const H of F){this._layerConfigs[H.id]=H;const ut=this._layers[H.id]=m.az(H);ut._featureFilter=m.a6(ut.filter),this.keyCache[H.id]&&delete this.keyCache[H.id]}for(const H of N)delete this.keyCache[H],delete this._layerConfigs[H],delete this._layers[H];this.familiesBySource={};const q=m.bh(Object.values(this._layerConfigs),this.keyCache);for(const H of q){const ut=H.map(It=>this._layers[It.id]),dt=ut[0];if(dt.visibility==="none")continue;const mt=dt.source||"";let at=this.familiesBySource[mt];at||(at=this.familiesBySource[mt]={});const _t=dt.sourceLayer||"_geojsonTileLayer";let Lt=at[_t];Lt||(Lt=at[_t]=[]),Lt.push(ut)}}}class T{constructor(F){const N={},q=[];for(const mt in F){const at=F[mt],_t=N[mt]={};for(const Lt in at){const It=at[+Lt];if(!It||It.bitmap.width===0||It.bitmap.height===0)continue;const Pt={x:0,y:0,w:It.bitmap.width+2,h:It.bitmap.height+2};q.push(Pt),_t[Lt]={rect:Pt,metrics:It.metrics}}}const{w:H,h:ut}=m.p(q),dt=new m.o({width:H||1,height:ut||1});for(const mt in F){const at=F[mt];for(const _t in at){const Lt=at[+_t];if(!Lt||Lt.bitmap.width===0||Lt.bitmap.height===0)continue;const It=N[mt][_t].rect;m.o.copy(Lt.bitmap,dt,{x:0,y:0},{x:It.x+1,y:It.y+1},Lt.bitmap)}}this.image=dt,this.positions=N}}m.bi("GlyphAtlas",T);class I{constructor(F){this.tileID=new m.Q(F.tileID.overscaledZ,F.tileID.wrap,F.tileID.canonical.z,F.tileID.canonical.x,F.tileID.canonical.y),this.uid=F.uid,this.zoom=F.zoom,this.pixelRatio=F.pixelRatio,this.tileSize=F.tileSize,this.source=F.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=F.showCollisionBoxes,this.collectResourceTiming=!!F.collectResourceTiming,this.returnDependencies=!!F.returnDependencies,this.promoteId=F.promoteId,this.inFlightDependencies=[]}parse(F,N,q,H){return m._(this,void 0,void 0,function*(){this.status="parsing",this.data=F,this.collisionBoxArray=new m.a4;const ut=new m.bj(Object.keys(F.layers).sort()),dt=new m.bk(this.tileID,this.promoteId);dt.bucketLayerIDs=[];const mt={},at={featureIndex:dt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:q},_t=N.familiesBySource[this.source];for(const Ue in _t){const Ni=F.layers[Ue];if(!Ni)continue;Ni.version===1&&m.w(`Vector tile source "${this.source}" layer "${Ue}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ls=ut.encode(Ue),ks=[];for(let qs=0;qs<Ni.length;qs++){const vs=Ni.feature(qs),Br=dt.getId(vs,Ue);ks.push({feature:vs,id:Br,index:qs,sourceLayerIndex:ls})}for(const qs of _t[Ue]){const vs=qs[0];vs.source!==this.source&&m.w(`layer.source = ${vs.source} does not equal this.source = ${this.source}`),vs.minzoom&&this.zoom<Math.floor(vs.minzoom)||vs.maxzoom&&this.zoom>=vs.maxzoom||vs.visibility!=="none"&&(k(qs,this.zoom,q),(mt[vs.id]=vs.createBucket({index:dt.bucketLayerIDs.length,layers:qs,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ls,sourceID:this.source})).populate(ks,at,this.tileID.canonical),dt.bucketLayerIDs.push(qs.map(Br=>Br.id)))}}const Lt=m.aE(at.glyphDependencies,Ue=>Object.keys(Ue).map(Number));this.inFlightDependencies.forEach(Ue=>Ue==null?void 0:Ue.abort()),this.inFlightDependencies=[];let It=Promise.resolve({});if(Object.keys(Lt).length){const Ue=new AbortController;this.inFlightDependencies.push(Ue),It=H.sendAsync({type:"GG",data:{stacks:Lt,source:this.source,tileID:this.tileID,type:"glyphs"}},Ue)}const Pt=Object.keys(at.iconDependencies);let xe=Promise.resolve({});if(Pt.length){const Ue=new AbortController;this.inFlightDependencies.push(Ue),xe=H.sendAsync({type:"GI",data:{icons:Pt,source:this.source,tileID:this.tileID,type:"icons"}},Ue)}const Se=Object.keys(at.patternDependencies);let Ne=Promise.resolve({});if(Se.length){const Ue=new AbortController;this.inFlightDependencies.push(Ue),Ne=H.sendAsync({type:"GI",data:{icons:Se,source:this.source,tileID:this.tileID,type:"patterns"}},Ue)}const[ze,Qe,yi]=yield Promise.all([It,xe,Ne]),Ci=new T(ze),Qi=new m.bl(Qe,yi);for(const Ue in mt){const Ni=mt[Ue];Ni instanceof m.a5?(k(Ni.layers,this.zoom,q),m.bm({bucket:Ni,glyphMap:ze,glyphPositions:Ci.positions,imageMap:Qe,imagePositions:Qi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Ni.hasPattern&&(Ni instanceof m.bn||Ni instanceof m.bo||Ni instanceof m.bp)&&(k(Ni.layers,this.zoom,q),Ni.addFeatures(at,this.tileID.canonical,Qi.patternPositions))}return this.status="done",{buckets:Object.values(mt).filter(Ue=>!Ue.isEmpty()),featureIndex:dt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ci.image,imageAtlas:Qi,glyphMap:this.returnDependencies?ze:null,iconMap:this.returnDependencies?Qe:null,glyphPositions:this.returnDependencies?Ci.positions:null}})}}function k(Y,F,N){const q=new m.a8(F);for(const H of Y)H.recalculate(q,N)}class P{constructor(F,N,q){this.actor=F,this.layerIndex=N,this.availableImages=q,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(F,N){return m._(this,void 0,void 0,function*(){const q=yield m.l(F.request,N);try{return{vectorTile:new m.bq.VectorTile(new m.br(q.data)),rawData:q.data,cacheControl:q.cacheControl,expires:q.expires}}catch(H){const ut=new Uint8Array(q.data);let dt=`Unable to parse the tile at ${F.request.url}, `;throw dt+=ut[0]===31&&ut[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${H.messge}`,new Error(dt)}})}loadTile(F){return m._(this,void 0,void 0,function*(){const N=F.uid,q=!!(F&&F.request&&F.request.collectResourceTiming)&&new m.bs(F.request),H=new I(F);this.loading[N]=H;const ut=new AbortController;H.abort=ut;try{const dt=yield this.loadVectorTile(F,ut);if(delete this.loading[N],!dt)return null;const mt=dt.rawData,at={};dt.expires&&(at.expires=dt.expires),dt.cacheControl&&(at.cacheControl=dt.cacheControl);const _t={};if(q){const It=q.finish();It&&(_t.resourceTiming=JSON.parse(JSON.stringify(It)))}H.vectorTile=dt.vectorTile;const Lt=H.parse(dt.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[N]=H,this.fetching[N]={rawTileData:mt,cacheControl:at,resourceTiming:_t};try{const It=yield Lt;return m.e({rawTileData:mt.slice(0)},It,at,_t)}finally{delete this.fetching[N]}}catch(dt){throw delete this.loading[N],H.status="done",this.loaded[N]=H,dt}})}reloadTile(F){return m._(this,void 0,void 0,function*(){const N=F.uid;if(!this.loaded||!this.loaded[N])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const q=this.loaded[N];if(q.showCollisionBoxes=F.showCollisionBoxes,q.status==="parsing"){const H=yield q.parse(q.vectorTile,this.layerIndex,this.availableImages,this.actor);let ut;if(this.fetching[N]){const{rawTileData:dt,cacheControl:mt,resourceTiming:at}=this.fetching[N];delete this.fetching[N],ut=m.e({rawTileData:dt.slice(0)},H,mt,at)}else ut=H;return ut}if(q.status==="done"&&q.vectorTile)return q.parse(q.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(F){return m._(this,void 0,void 0,function*(){const N=this.loading,q=F.uid;N&&N[q]&&N[q].abort&&(N[q].abort.abort(),delete N[q])})}removeTile(F){return m._(this,void 0,void 0,function*(){this.loaded&&this.loaded[F.uid]&&delete this.loaded[F.uid]})}}class L{constructor(){this.loaded={}}loadTile(F){return m._(this,void 0,void 0,function*(){const{uid:N,encoding:q,rawImageData:H,redFactor:ut,greenFactor:dt,blueFactor:mt,baseShift:at}=F,_t=H.width+2,Lt=H.height+2,It=m.b(H)?new m.R({width:_t,height:Lt},yield m.bt(H,-1,-1,_t,Lt)):H,Pt=new m.bu(N,It,q,ut,dt,mt,at);return this.loaded=this.loaded||{},this.loaded[N]=Pt,Pt})}removeTile(F){const N=this.loaded,q=F.uid;N&&N[q]&&delete N[q]}}function K(Y,F){if(Y.length!==0){tt(Y[0],F);for(var N=1;N<Y.length;N++)tt(Y[N],!F)}}function tt(Y,F){for(var N=0,q=0,H=0,ut=Y.length,dt=ut-1;H<ut;dt=H++){var mt=(Y[H][0]-Y[dt][0])*(Y[dt][1]+Y[H][1]),at=N+mt;q+=Math.abs(N)>=Math.abs(mt)?N-at+mt:mt-at+N,N=at}N+q>=0!=!!F&&Y.reverse()}var ot=m.bv(function Y(F,N){var q,H=F&&F.type;if(H==="FeatureCollection")for(q=0;q<F.features.length;q++)Y(F.features[q],N);else if(H==="GeometryCollection")for(q=0;q<F.geometries.length;q++)Y(F.geometries[q],N);else if(H==="Feature")Y(F.geometry,N);else if(H==="Polygon")K(F.coordinates,N);else if(H==="MultiPolygon")for(q=0;q<F.coordinates.length;q++)K(F.coordinates[q],N);return F});const vt=m.bq.VectorTileFeature.prototype.toGeoJSON;var yt={exports:{}},At=m.bw,ht=m.bq.VectorTileFeature,Tt=$t;function $t(Y,F){this.options=F||{},this.features=Y,this.length=Y.length}function qt(Y,F){this.id=typeof Y.id=="number"?Y.id:void 0,this.type=Y.type,this.rawGeometry=Y.type===1?[Y.geometry]:Y.geometry,this.properties=Y.tags,this.extent=F||4096}$t.prototype.feature=function(Y){return new qt(this.features[Y],this.options.extent)},qt.prototype.loadGeometry=function(){var Y=this.rawGeometry;this.geometry=[];for(var F=0;F<Y.length;F++){for(var N=Y[F],q=[],H=0;H<N.length;H++)q.push(new At(N[H][0],N[H][1]));this.geometry.push(q)}return this.geometry},qt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Y=this.geometry,F=1/0,N=-1/0,q=1/0,H=-1/0,ut=0;ut<Y.length;ut++)for(var dt=Y[ut],mt=0;mt<dt.length;mt++){var at=dt[mt];F=Math.min(F,at.x),N=Math.max(N,at.x),q=Math.min(q,at.y),H=Math.max(H,at.y)}return[F,q,N,H]},qt.prototype.toGeoJSON=ht.prototype.toGeoJSON;var oe=m.bx,ne=Tt;function Vt(Y){var F=new oe;return function(N,q){for(var H in N.layers)q.writeMessage(3,Gt,N.layers[H])}(Y,F),F.finish()}function Gt(Y,F){var N;F.writeVarintField(15,Y.version||1),F.writeStringField(1,Y.name||""),F.writeVarintField(5,Y.extent||4096);var q={keys:[],values:[],keycache:{},valuecache:{}};for(N=0;N<Y.length;N++)q.feature=Y.feature(N),F.writeMessage(2,Dt,q);var H=q.keys;for(N=0;N<H.length;N++)F.writeStringField(3,H[N]);var ut=q.values;for(N=0;N<ut.length;N++)F.writeMessage(4,Re,ut[N])}function Dt(Y,F){var N=Y.feature;N.id!==void 0&&F.writeVarintField(1,N.id),F.writeMessage(2,de,Y),F.writeVarintField(3,N.type),F.writeMessage(4,gi,N)}function de(Y,F){var N=Y.feature,q=Y.keys,H=Y.values,ut=Y.keycache,dt=Y.valuecache;for(var mt in N.properties){var at=N.properties[mt],_t=ut[mt];if(at!==null){_t===void 0&&(q.push(mt),ut[mt]=_t=q.length-1),F.writeVarint(_t);var Lt=typeof at;Lt!=="string"&&Lt!=="boolean"&&Lt!=="number"&&(at=JSON.stringify(at));var It=Lt+":"+at,Pt=dt[It];Pt===void 0&&(H.push(at),dt[It]=Pt=H.length-1),F.writeVarint(Pt)}}}function De(Y,F){return(F<<3)+(7&Y)}function ke(Y){return Y<<1^Y>>31}function gi(Y,F){for(var N=Y.loadGeometry(),q=Y.type,H=0,ut=0,dt=N.length,mt=0;mt<dt;mt++){var at=N[mt],_t=1;q===1&&(_t=at.length),F.writeVarint(De(1,_t));for(var Lt=q===3?at.length-1:at.length,It=0;It<Lt;It++){It===1&&q!==1&&F.writeVarint(De(2,Lt-1));var Pt=at[It].x-H,xe=at[It].y-ut;F.writeVarint(ke(Pt)),F.writeVarint(ke(xe)),H+=Pt,ut+=xe}q===3&&F.writeVarint(De(7,1))}}function Re(Y,F){var N=typeof Y;N==="string"?F.writeStringField(1,Y):N==="boolean"?F.writeBooleanField(7,Y):N==="number"&&(Y%1!=0?F.writeDoubleField(3,Y):Y<0?F.writeSVarintField(6,Y):F.writeVarintField(5,Y))}yt.exports=Vt,yt.exports.fromVectorTileJs=Vt,yt.exports.fromGeojsonVt=function(Y,F){F=F||{};var N={};for(var q in Y)N[q]=new ne(Y[q].features,F),N[q].name=q,N[q].version=F.version,N[q].extent=F.extent;return Vt({layers:N})},yt.exports.GeoJSONWrapper=ne;var Le=m.bv(yt.exports);const ii={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Y=>Y},xs=Math.fround||(Ds=new Float32Array(1),Y=>(Ds[0]=+Y,Ds[0]));var Ds;const Ei=3,hi=5,bs=6;class fr{constructor(F){this.options=Object.assign(Object.create(ii),F),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(F){const{log:N,minZoom:q,maxZoom:H}=this.options;N&&console.time("total time");const ut=`prepare ${F.length} points`;N&&console.time(ut),this.points=F;const dt=[];for(let at=0;at<F.length;at++){const _t=F[at];if(!_t.geometry)continue;const[Lt,It]=_t.geometry.coordinates,Pt=xs(Rt(Lt)),xe=xs(ce(It));dt.push(Pt,xe,1/0,at,-1,1),this.options.reduce&&dt.push(0)}let mt=this.trees[H+1]=this._createTree(dt);N&&console.timeEnd(ut);for(let at=H;at>=q;at--){const _t=+Date.now();mt=this.trees[at]=this._createTree(this._cluster(mt,at)),N&&console.log("z%d: %d clusters in %dms",at,mt.numItems,+Date.now()-_t)}return N&&console.timeEnd("total time"),this}getClusters(F,N){let q=((F[0]+180)%360+360)%360-180;const H=Math.max(-90,Math.min(90,F[1]));let ut=F[2]===180?180:((F[2]+180)%360+360)%360-180;const dt=Math.max(-90,Math.min(90,F[3]));if(F[2]-F[0]>=360)q=-180,ut=180;else if(q>ut){const It=this.getClusters([q,H,180,dt],N),Pt=this.getClusters([-180,H,ut,dt],N);return It.concat(Pt)}const mt=this.trees[this._limitZoom(N)],at=mt.range(Rt(q),ce(dt),Rt(ut),ce(H)),_t=mt.data,Lt=[];for(const It of at){const Pt=this.stride*It;Lt.push(_t[Pt+hi]>1?As(_t,Pt,this.clusterProps):this.points[_t[Pt+Ei]])}return Lt}getChildren(F){const N=this._getOriginId(F),q=this._getOriginZoom(F),H="No cluster with the specified id.",ut=this.trees[q];if(!ut)throw new Error(H);const dt=ut.data;if(N*this.stride>=dt.length)throw new Error(H);const mt=this.options.radius/(this.options.extent*Math.pow(2,q-1)),at=ut.within(dt[N*this.stride],dt[N*this.stride+1],mt),_t=[];for(const Lt of at){const It=Lt*this.stride;dt[It+4]===F&&_t.push(dt[It+hi]>1?As(dt,It,this.clusterProps):this.points[dt[It+Ei]])}if(_t.length===0)throw new Error(H);return _t}getLeaves(F,N,q){const H=[];return this._appendLeaves(H,F,N=N||10,q=q||0,0),H}getTile(F,N,q){const H=this.trees[this._limitZoom(F)],ut=Math.pow(2,F),{extent:dt,radius:mt}=this.options,at=mt/dt,_t=(q-at)/ut,Lt=(q+1+at)/ut,It={features:[]};return this._addTileFeatures(H.range((N-at)/ut,_t,(N+1+at)/ut,Lt),H.data,N,q,ut,It),N===0&&this._addTileFeatures(H.range(1-at/ut,_t,1,Lt),H.data,ut,q,ut,It),N===ut-1&&this._addTileFeatures(H.range(0,_t,at/ut,Lt),H.data,-1,q,ut,It),It.features.length?It:null}getClusterExpansionZoom(F){let N=this._getOriginZoom(F)-1;for(;N<=this.options.maxZoom;){const q=this.getChildren(F);if(N++,q.length!==1)break;F=q[0].properties.cluster_id}return N}_appendLeaves(F,N,q,H,ut){const dt=this.getChildren(N);for(const mt of dt){const at=mt.properties;if(at&&at.cluster?ut+at.point_count<=H?ut+=at.point_count:ut=this._appendLeaves(F,at.cluster_id,q,H,ut):ut<H?ut++:F.push(mt),F.length===q)break}return ut}_createTree(F){const N=new m.au(F.length/this.stride|0,this.options.nodeSize,Float32Array);for(let q=0;q<F.length;q+=this.stride)N.add(F[q],F[q+1]);return N.finish(),N.data=F,N}_addTileFeatures(F,N,q,H,ut,dt){for(const mt of F){const at=mt*this.stride,_t=N[at+hi]>1;let Lt,It,Pt;if(_t)Lt=Ii(N,at,this.clusterProps),It=N[at],Pt=N[at+1];else{const Ne=this.points[N[at+Ei]];Lt=Ne.properties;const[ze,Qe]=Ne.geometry.coordinates;It=Rt(ze),Pt=ce(Qe)}const xe={type:1,geometry:[[Math.round(this.options.extent*(It*ut-q)),Math.round(this.options.extent*(Pt*ut-H))]],tags:Lt};let Se;Se=_t||this.options.generateId?N[at+Ei]:this.points[N[at+Ei]].id,Se!==void 0&&(xe.id=Se),dt.features.push(xe)}}_limitZoom(F){return Math.max(this.options.minZoom,Math.min(Math.floor(+F),this.options.maxZoom+1))}_cluster(F,N){const{radius:q,extent:H,reduce:ut,minPoints:dt}=this.options,mt=q/(H*Math.pow(2,N)),at=F.data,_t=[],Lt=this.stride;for(let It=0;It<at.length;It+=Lt){if(at[It+2]<=N)continue;at[It+2]=N;const Pt=at[It],xe=at[It+1],Se=F.within(at[It],at[It+1],mt),Ne=at[It+hi];let ze=Ne;for(const Qe of Se){const yi=Qe*Lt;at[yi+2]>N&&(ze+=at[yi+hi])}if(ze>Ne&&ze>=dt){let Qe,yi=Pt*Ne,Ci=xe*Ne,Qi=-1;const Ue=((It/Lt|0)<<5)+(N+1)+this.points.length;for(const Ni of Se){const ls=Ni*Lt;if(at[ls+2]<=N)continue;at[ls+2]=N;const ks=at[ls+hi];yi+=at[ls]*ks,Ci+=at[ls+1]*ks,at[ls+4]=Ue,ut&&(Qe||(Qe=this._map(at,It,!0),Qi=this.clusterProps.length,this.clusterProps.push(Qe)),ut(Qe,this._map(at,ls)))}at[It+4]=Ue,_t.push(yi/ze,Ci/ze,1/0,Ue,-1,ze),ut&&_t.push(Qi)}else{for(let Qe=0;Qe<Lt;Qe++)_t.push(at[It+Qe]);if(ze>1)for(const Qe of Se){const yi=Qe*Lt;if(!(at[yi+2]<=N)){at[yi+2]=N;for(let Ci=0;Ci<Lt;Ci++)_t.push(at[yi+Ci])}}}}return _t}_getOriginId(F){return F-this.points.length>>5}_getOriginZoom(F){return(F-this.points.length)%32}_map(F,N,q){if(F[N+hi]>1){const dt=this.clusterProps[F[N+bs]];return q?Object.assign({},dt):dt}const H=this.points[F[N+Ei]].properties,ut=this.options.map(H);return q&&ut===H?Object.assign({},ut):ut}}function As(Y,F,N){return{type:"Feature",id:Y[F+Ei],properties:Ii(Y,F,N),geometry:{type:"Point",coordinates:[(q=Y[F],360*(q-.5)),ae(Y[F+1])]}};var q}function Ii(Y,F,N){const q=Y[F+hi],H=q>=1e4?`${Math.round(q/1e3)}k`:q>=1e3?Math.round(q/100)/10+"k":q,ut=Y[F+bs],dt=ut===-1?{}:Object.assign({},N[ut]);return Object.assign(dt,{cluster:!0,cluster_id:Y[F+Ei],point_count:q,point_count_abbreviated:H})}function Rt(Y){return Y/360+.5}function ce(Y){const F=Math.sin(Y*Math.PI/180),N=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return N<0?0:N>1?1:N}function ae(Y){const F=(180-360*Y)*Math.PI/180;return 360*Math.atan(Math.exp(F))/Math.PI-90}function ye(Y,F,N,q){for(var H,ut=q,dt=N-F>>1,mt=N-F,at=Y[F],_t=Y[F+1],Lt=Y[N],It=Y[N+1],Pt=F+3;Pt<N;Pt+=3){var xe=ni(Y[Pt],Y[Pt+1],at,_t,Lt,It);if(xe>ut)H=Pt,ut=xe;else if(xe===ut){var Se=Math.abs(Pt-dt);Se<mt&&(H=Pt,mt=Se)}}ut>q&&(H-F>3&&ye(Y,F,H,q),Y[H+2]=ut,N-H>3&&ye(Y,H,N,q))}function ni(Y,F,N,q,H,ut){var dt=H-N,mt=ut-q;if(dt!==0||mt!==0){var at=((Y-N)*dt+(F-q)*mt)/(dt*dt+mt*mt);at>1?(N=H,q=ut):at>0&&(N+=dt*at,q+=mt*at)}return(dt=Y-N)*dt+(mt=F-q)*mt}function ai(Y,F,N,q){var H={id:Y===void 0?null:Y,type:F,geometry:N,tags:q,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ut){var dt=ut.geometry,mt=ut.type;if(mt==="Point"||mt==="MultiPoint"||mt==="LineString")Q(ut,dt);else if(mt==="Polygon"||mt==="MultiLineString")for(var at=0;at<dt.length;at++)Q(ut,dt[at]);else if(mt==="MultiPolygon")for(at=0;at<dt.length;at++)for(var _t=0;_t<dt[at].length;_t++)Q(ut,dt[at][_t])}(H),H}function Q(Y,F){for(var N=0;N<F.length;N+=3)Y.minX=Math.min(Y.minX,F[N]),Y.minY=Math.min(Y.minY,F[N+1]),Y.maxX=Math.max(Y.maxX,F[N]),Y.maxY=Math.max(Y.maxY,F[N+1])}function rt(Y,F,N,q){if(F.geometry){var H=F.geometry.coordinates,ut=F.geometry.type,dt=Math.pow(N.tolerance/((1<<N.maxZoom)*N.extent),2),mt=[],at=F.id;if(N.promoteId?at=F.properties[N.promoteId]:N.generateId&&(at=q||0),ut==="Point")Mt(H,mt);else if(ut==="MultiPoint")for(var _t=0;_t<H.length;_t++)Mt(H[_t],mt);else if(ut==="LineString")Ft(H,mt,dt,!1);else if(ut==="MultiLineString"){if(N.lineMetrics){for(_t=0;_t<H.length;_t++)Ft(H[_t],mt=[],dt,!1),Y.push(ai(at,"LineString",mt,F.properties));return}it(H,mt,dt,!1)}else if(ut==="Polygon")it(H,mt,dt,!0);else{if(ut!=="MultiPolygon"){if(ut==="GeometryCollection"){for(_t=0;_t<F.geometry.geometries.length;_t++)rt(Y,{id:at,geometry:F.geometry.geometries[_t],properties:F.properties},N,q);return}throw new Error("Input data is not a valid GeoJSON object.")}for(_t=0;_t<H.length;_t++){var Lt=[];it(H[_t],Lt,dt,!0),mt.push(Lt)}}Y.push(ai(at,ut,mt,F.properties))}}function Mt(Y,F){F.push(Jt(Y[0])),F.push(le(Y[1])),F.push(0)}function Ft(Y,F,N,q){for(var H,ut,dt=0,mt=0;mt<Y.length;mt++){var at=Jt(Y[mt][0]),_t=le(Y[mt][1]);F.push(at),F.push(_t),F.push(0),mt>0&&(dt+=q?(H*_t-at*ut)/2:Math.sqrt(Math.pow(at-H,2)+Math.pow(_t-ut,2))),H=at,ut=_t}var Lt=F.length-3;F[2]=1,ye(F,0,Lt,N),F[Lt+2]=1,F.size=Math.abs(dt),F.start=0,F.end=F.size}function it(Y,F,N,q){for(var H=0;H<Y.length;H++){var ut=[];Ft(Y[H],ut,N,q),F.push(ut)}}function Jt(Y){return Y/360+.5}function le(Y){var F=Math.sin(Y*Math.PI/180),N=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return N<0?0:N>1?1:N}function Ct(Y,F,N,q,H,ut,dt,mt){if(q/=F,ut>=(N/=F)&&dt<q)return Y;if(dt<N||ut>=q)return null;for(var at=[],_t=0;_t<Y.length;_t++){var Lt=Y[_t],It=Lt.geometry,Pt=Lt.type,xe=H===0?Lt.minX:Lt.minY,Se=H===0?Lt.maxX:Lt.maxY;if(xe>=N&&Se<q)at.push(Lt);else if(!(Se<N||xe>=q)){var Ne=[];if(Pt==="Point"||Pt==="MultiPoint")Ht(It,Ne,N,q,H);else if(Pt==="LineString")jt(It,Ne,N,q,H,!1,mt.lineMetrics);else if(Pt==="MultiLineString")Ae(It,Ne,N,q,H,!1);else if(Pt==="Polygon")Ae(It,Ne,N,q,H,!0);else if(Pt==="MultiPolygon")for(var ze=0;ze<It.length;ze++){var Qe=[];Ae(It[ze],Qe,N,q,H,!0),Qe.length&&Ne.push(Qe)}if(Ne.length){if(mt.lineMetrics&&Pt==="LineString"){for(ze=0;ze<Ne.length;ze++)at.push(ai(Lt.id,Pt,Ne[ze],Lt.tags));continue}Pt!=="LineString"&&Pt!=="MultiLineString"||(Ne.length===1?(Pt="LineString",Ne=Ne[0]):Pt="MultiLineString"),Pt!=="Point"&&Pt!=="MultiPoint"||(Pt=Ne.length===3?"Point":"MultiPoint"),at.push(ai(Lt.id,Pt,Ne,Lt.tags))}}}return at.length?at:null}function Ht(Y,F,N,q,H){for(var ut=0;ut<Y.length;ut+=3){var dt=Y[ut+H];dt>=N&&dt<=q&&(F.push(Y[ut]),F.push(Y[ut+1]),F.push(Y[ut+2]))}}function jt(Y,F,N,q,H,ut,dt){for(var mt,at,_t=fe(Y),Lt=H===0?Pe:Ke,It=Y.start,Pt=0;Pt<Y.length-3;Pt+=3){var xe=Y[Pt],Se=Y[Pt+1],Ne=Y[Pt+2],ze=Y[Pt+3],Qe=Y[Pt+4],yi=H===0?xe:Se,Ci=H===0?ze:Qe,Qi=!1;dt&&(mt=Math.sqrt(Math.pow(xe-ze,2)+Math.pow(Se-Qe,2))),yi<N?Ci>N&&(at=Lt(_t,xe,Se,ze,Qe,N),dt&&(_t.start=It+mt*at)):yi>q?Ci<q&&(at=Lt(_t,xe,Se,ze,Qe,q),dt&&(_t.start=It+mt*at)):be(_t,xe,Se,Ne),Ci<N&&yi>=N&&(at=Lt(_t,xe,Se,ze,Qe,N),Qi=!0),Ci>q&&yi<=q&&(at=Lt(_t,xe,Se,ze,Qe,q),Qi=!0),!ut&&Qi&&(dt&&(_t.end=It+mt*at),F.push(_t),_t=fe(Y)),dt&&(It+=mt)}var Ue=Y.length-3;xe=Y[Ue],Se=Y[Ue+1],Ne=Y[Ue+2],(yi=H===0?xe:Se)>=N&&yi<=q&&be(_t,xe,Se,Ne),Ue=_t.length-3,ut&&Ue>=3&&(_t[Ue]!==_t[0]||_t[Ue+1]!==_t[1])&&be(_t,_t[0],_t[1],_t[2]),_t.length&&F.push(_t)}function fe(Y){var F=[];return F.size=Y.size,F.start=Y.start,F.end=Y.end,F}function Ae(Y,F,N,q,H,ut){for(var dt=0;dt<Y.length;dt++)jt(Y[dt],F,N,q,H,ut,!1)}function be(Y,F,N,q){Y.push(F),Y.push(N),Y.push(q)}function Pe(Y,F,N,q,H,ut){var dt=(ut-F)/(q-F);return Y.push(ut),Y.push(N+(H-N)*dt),Y.push(1),dt}function Ke(Y,F,N,q,H,ut){var dt=(ut-N)/(H-N);return Y.push(F+(q-F)*dt),Y.push(ut),Y.push(1),dt}function si(Y,F){for(var N=[],q=0;q<Y.length;q++){var H,ut=Y[q],dt=ut.type;if(dt==="Point"||dt==="MultiPoint"||dt==="LineString")H=zt(ut.geometry,F);else if(dt==="MultiLineString"||dt==="Polygon"){H=[];for(var mt=0;mt<ut.geometry.length;mt++)H.push(zt(ut.geometry[mt],F))}else if(dt==="MultiPolygon")for(H=[],mt=0;mt<ut.geometry.length;mt++){for(var at=[],_t=0;_t<ut.geometry[mt].length;_t++)at.push(zt(ut.geometry[mt][_t],F));H.push(at)}N.push(ai(ut.id,dt,H,ut.tags))}return N}function zt(Y,F){var N=[];N.size=Y.size,Y.start!==void 0&&(N.start=Y.start,N.end=Y.end);for(var q=0;q<Y.length;q+=3)N.push(Y[q]+F,Y[q+1],Y[q+2]);return N}function _i(Y,F){if(Y.transformed)return Y;var N,q,H,ut=1<<Y.z,dt=Y.x,mt=Y.y;for(N=0;N<Y.features.length;N++){var at=Y.features[N],_t=at.geometry,Lt=at.type;if(at.geometry=[],Lt===1)for(q=0;q<_t.length;q+=2)at.geometry.push(Pi(_t[q],_t[q+1],F,ut,dt,mt));else for(q=0;q<_t.length;q++){var It=[];for(H=0;H<_t[q].length;H+=2)It.push(Pi(_t[q][H],_t[q][H+1],F,ut,dt,mt));at.geometry.push(It)}}return Y.transformed=!0,Y}function Pi(Y,F,N,q,H,ut){return[Math.round(N*(Y*q-H)),Math.round(N*(F*q-ut))]}function pr(Y,F,N,q,H){for(var ut=F===H.maxZoom?0:H.tolerance/((1<<F)*H.extent),dt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:N,y:q,z:F,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},mt=0;mt<Y.length;mt++){dt.numFeatures++,as(dt,Y[mt],ut,H);var at=Y[mt].minX,_t=Y[mt].minY,Lt=Y[mt].maxX,It=Y[mt].maxY;at<dt.minX&&(dt.minX=at),_t<dt.minY&&(dt.minY=_t),Lt>dt.maxX&&(dt.maxX=Lt),It>dt.maxY&&(dt.maxY=It)}return dt}function as(Y,F,N,q){var H=F.geometry,ut=F.type,dt=[];if(ut==="Point"||ut==="MultiPoint")for(var mt=0;mt<H.length;mt+=3)dt.push(H[mt]),dt.push(H[mt+1]),Y.numPoints++,Y.numSimplified++;else if(ut==="LineString")Zt(dt,H,Y,N,!1,!1);else if(ut==="MultiLineString"||ut==="Polygon")for(mt=0;mt<H.length;mt++)Zt(dt,H[mt],Y,N,ut==="Polygon",mt===0);else if(ut==="MultiPolygon")for(var at=0;at<H.length;at++){var _t=H[at];for(mt=0;mt<_t.length;mt++)Zt(dt,_t[mt],Y,N,!0,mt===0)}if(dt.length){var Lt=F.tags||null;if(ut==="LineString"&&q.lineMetrics){for(var It in Lt={},F.tags)Lt[It]=F.tags[It];Lt.mapbox_clip_start=H.start/H.size,Lt.mapbox_clip_end=H.end/H.size}var Pt={geometry:dt,type:ut==="Polygon"||ut==="MultiPolygon"?3:ut==="LineString"||ut==="MultiLineString"?2:1,tags:Lt};F.id!==null&&(Pt.id=F.id),Y.features.push(Pt)}}function Zt(Y,F,N,q,H,ut){var dt=q*q;if(q>0&&F.size<(H?dt:q))N.numPoints+=F.length/3;else{for(var mt=[],at=0;at<F.length;at+=3)(q===0||F[at+2]>dt)&&(N.numSimplified++,mt.push(F[at]),mt.push(F[at+1])),N.numPoints++;H&&function(_t,Lt){for(var It=0,Pt=0,xe=_t.length,Se=xe-2;Pt<xe;Se=Pt,Pt+=2)It+=(_t[Pt]-_t[Se])*(_t[Pt+1]+_t[Se+1]);if(It>0===Lt)for(Pt=0,xe=_t.length;Pt<xe/2;Pt+=2){var Ne=_t[Pt],ze=_t[Pt+1];_t[Pt]=_t[xe-2-Pt],_t[Pt+1]=_t[xe-1-Pt],_t[xe-2-Pt]=Ne,_t[xe-1-Pt]=ze}}(mt,ut),Y.push(mt)}}function Oe(Y,F){var N=(F=this.options=function(H,ut){for(var dt in ut)H[dt]=ut[dt];return H}(Object.create(this.options),F)).debug;if(N&&console.time("preprocess data"),F.maxZoom<0||F.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(F.promoteId&&F.generateId)throw new Error("promoteId and generateId cannot be used together.");var q=function(H,ut){var dt=[];if(H.type==="FeatureCollection")for(var mt=0;mt<H.features.length;mt++)rt(dt,H.features[mt],ut,mt);else rt(dt,H.type==="Feature"?H:{geometry:H},ut);return dt}(Y,F);this.tiles={},this.tileCoords=[],N&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",F.indexMaxZoom,F.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),q=function(H,ut){var dt=ut.buffer/ut.extent,mt=H,at=Ct(H,1,-1-dt,dt,0,-1,2,ut),_t=Ct(H,1,1-dt,2+dt,0,-1,2,ut);return(at||_t)&&(mt=Ct(H,1,-dt,1+dt,0,-1,2,ut)||[],at&&(mt=si(at,1).concat(mt)),_t&&(mt=mt.concat(si(_t,-1)))),mt}(q,F),q.length&&this.splitTile(q,0,0,0),N&&(q.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Me(Y,F,N){return 32*((1<<Y)*N+F)+Y}function ui(Y,F){return F?Y.properties[F]:Y.id}function tr(Y,F){if(Y==null)return!0;if(Y.type==="Feature")return ui(Y,F)!=null;if(Y.type==="FeatureCollection"){const N=new Set;for(const q of Y.features){const H=ui(q,F);if(H==null||N.has(H))return!1;N.add(H)}return!0}return!1}function Be(Y,F){const N=new Map;if(Y!=null)if(Y.type==="Feature")N.set(ui(Y,F),Y);else for(const q of Y.features)N.set(ui(q,F),q);return N}Oe.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Oe.prototype.splitTile=function(Y,F,N,q,H,ut,dt){for(var mt=[Y,F,N,q],at=this.options,_t=at.debug;mt.length;){q=mt.pop(),N=mt.pop(),F=mt.pop(),Y=mt.pop();var Lt=1<<F,It=Me(F,N,q),Pt=this.tiles[It];if(!Pt&&(_t>1&&console.time("creation"),Pt=this.tiles[It]=pr(Y,F,N,q,at),this.tileCoords.push({z:F,x:N,y:q}),_t)){_t>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",F,N,q,Pt.numFeatures,Pt.numPoints,Pt.numSimplified),console.timeEnd("creation"));var xe="z"+F;this.stats[xe]=(this.stats[xe]||0)+1,this.total++}if(Pt.source=Y,H){if(F===at.maxZoom||F===H)continue;var Se=1<<H-F;if(N!==Math.floor(ut/Se)||q!==Math.floor(dt/Se))continue}else if(F===at.indexMaxZoom||Pt.numPoints<=at.indexMaxPoints)continue;if(Pt.source=null,Y.length!==0){_t>1&&console.time("clipping");var Ne,ze,Qe,yi,Ci,Qi,Ue=.5*at.buffer/at.extent,Ni=.5-Ue,ls=.5+Ue,ks=1+Ue;Ne=ze=Qe=yi=null,Ci=Ct(Y,Lt,N-Ue,N+ls,0,Pt.minX,Pt.maxX,at),Qi=Ct(Y,Lt,N+Ni,N+ks,0,Pt.minX,Pt.maxX,at),Y=null,Ci&&(Ne=Ct(Ci,Lt,q-Ue,q+ls,1,Pt.minY,Pt.maxY,at),ze=Ct(Ci,Lt,q+Ni,q+ks,1,Pt.minY,Pt.maxY,at),Ci=null),Qi&&(Qe=Ct(Qi,Lt,q-Ue,q+ls,1,Pt.minY,Pt.maxY,at),yi=Ct(Qi,Lt,q+Ni,q+ks,1,Pt.minY,Pt.maxY,at),Qi=null),_t>1&&console.timeEnd("clipping"),mt.push(Ne||[],F+1,2*N,2*q),mt.push(ze||[],F+1,2*N,2*q+1),mt.push(Qe||[],F+1,2*N+1,2*q),mt.push(yi||[],F+1,2*N+1,2*q+1)}}},Oe.prototype.getTile=function(Y,F,N){var q=this.options,H=q.extent,ut=q.debug;if(Y<0||Y>24)return null;var dt=1<<Y,mt=Me(Y,F=(F%dt+dt)%dt,N);if(this.tiles[mt])return _i(this.tiles[mt],H);ut>1&&console.log("drilling down to z%d-%d-%d",Y,F,N);for(var at,_t=Y,Lt=F,It=N;!at&&_t>0;)_t--,Lt=Math.floor(Lt/2),It=Math.floor(It/2),at=this.tiles[Me(_t,Lt,It)];return at&&at.source?(ut>1&&console.log("found parent tile z%d-%d-%d",_t,Lt,It),ut>1&&console.time("drilling down"),this.splitTile(at.source,_t,Lt,It,Y,F,N),ut>1&&console.timeEnd("drilling down"),this.tiles[mt]?_i(this.tiles[mt],H):null):null};class Rn extends P{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(F,N){return m._(this,void 0,void 0,function*(){const q=F.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const H=this._geoJSONIndex.getTile(q.z,q.x,q.y);if(!H)return null;const ut=new class{constructor(mt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.W,this.length=mt.length,this._features=mt}feature(mt){return new class{constructor(at){this._feature=at,this.extent=m.W,this.type=at.type,this.properties=at.tags,"id"in at&&!isNaN(at.id)&&(this.id=parseInt(at.id,10))}loadGeometry(){if(this._feature.type===1){const at=[];for(const _t of this._feature.geometry)at.push([new m.P(_t[0],_t[1])]);return at}{const at=[];for(const _t of this._feature.geometry){const Lt=[];for(const It of _t)Lt.push(new m.P(It[0],It[1]));at.push(Lt)}return at}}toGeoJSON(at,_t,Lt){return vt.call(this,at,_t,Lt)}}(this._features[mt])}}(H.features);let dt=Le(ut);return dt.byteOffset===0&&dt.byteLength===dt.buffer.byteLength||(dt=new Uint8Array(dt)),{vectorTile:ut,rawData:dt.buffer}})}loadData(F){return m._(this,void 0,void 0,function*(){var N;(N=this._pendingRequest)===null||N===void 0||N.abort();const q=!!(F&&F.request&&F.request.collectResourceTiming)&&new m.bs(F.request);this._pendingRequest=new AbortController;try{let H=yield this.loadGeoJSON(F,this._pendingRequest);if(delete this._pendingRequest,typeof H!="object")throw new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`);if(ot(H,!0),F.filter){const dt=m.by(F.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(dt.result==="error")throw new Error(dt.value.map(at=>`${at.key}: ${at.message}`).join(", "));H={type:"FeatureCollection",features:H.features.filter(at=>dt.value.evaluate({zoom:0},at))}}this._geoJSONIndex=F.cluster?new fr(function({superclusterOptions:dt,clusterProperties:mt}){if(!mt||!dt)return dt;const at={},_t={},Lt={accumulated:null,zoom:0},It={properties:null},Pt=Object.keys(mt);for(const xe of Pt){const[Se,Ne]=mt[xe],ze=m.by(Ne),Qe=m.by(typeof Se=="string"?[Se,["accumulated"],["get",xe]]:Se);at[xe]=ze.value,_t[xe]=Qe.value}return dt.map=xe=>{It.properties=xe;const Se={};for(const Ne of Pt)Se[Ne]=at[Ne].evaluate(Lt,It);return Se},dt.reduce=(xe,Se)=>{It.properties=Se;for(const Ne of Pt)Lt.accumulated=xe[Ne],xe[Ne]=_t[Ne].evaluate(Lt,It)},dt}(F)).load(H.features):function(dt,mt){return new Oe(dt,mt)}(H,F.geojsonVtOptions),this.loaded={};const ut={};if(q){const dt=q.finish();dt&&(ut.resourceTiming={},ut.resourceTiming[F.source]=JSON.parse(JSON.stringify(dt)))}return ut}catch(H){if(delete this._pendingRequest,m.bz(H))return{abandoned:!0};throw H}})}reloadTile(F){const N=this.loaded;return N&&N[F.uid]?super.reloadTile(F):this.loadTile(F)}loadGeoJSON(F,N){return m._(this,void 0,void 0,function*(){const{promoteId:q}=F;if(F.request){const H=yield m.h(F.request,N);return this._dataUpdateable=tr(H.data,q)?Be(H.data,q):void 0,H.data}if(typeof F.data=="string")try{const H=JSON.parse(F.data);return this._dataUpdateable=tr(H,q)?Be(H,q):void 0,H}catch{throw new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`)}if(!F.dataDiff)throw new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${F.source}`);return function(H,ut,dt){var mt,at,_t,Lt;if(ut.removeAll&&H.clear(),ut.remove)for(const It of ut.remove)H.delete(It);if(ut.add)for(const It of ut.add){const Pt=ui(It,dt);Pt!=null&&H.set(Pt,It)}if(ut.update)for(const It of ut.update){let Pt=H.get(It.id);if(Pt==null)continue;const xe=!It.removeAllProperties&&(((mt=It.removeProperties)===null||mt===void 0?void 0:mt.length)>0||((at=It.addOrUpdateProperties)===null||at===void 0?void 0:at.length)>0);if((It.newGeometry||It.removeAllProperties||xe)&&(Pt=Object.assign({},Pt),H.set(It.id,Pt),xe&&(Pt.properties=Object.assign({},Pt.properties))),It.newGeometry&&(Pt.geometry=It.newGeometry),It.removeAllProperties)Pt.properties={};else if(((_t=It.removeProperties)===null||_t===void 0?void 0:_t.length)>0)for(const Se of It.removeProperties)Object.prototype.hasOwnProperty.call(Pt.properties,Se)&&delete Pt.properties[Se];if(((Lt=It.addOrUpdateProperties)===null||Lt===void 0?void 0:Lt.length)>0)for(const{key:Se,value:Ne}of It.addOrUpdateProperties)Pt.properties[Se]=Ne}}(this._dataUpdateable,F.dataDiff,q),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(F){return m._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(F){return this._geoJSONIndex.getClusterExpansionZoom(F.clusterId)}getClusterChildren(F){return this._geoJSONIndex.getChildren(F.clusterId)}getClusterLeaves(F){return this._geoJSONIndex.getLeaves(F.clusterId,F.limit,F.offset)}}class os{constructor(F){this.self=F,this.actor=new m.C(F),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(N,q)=>{if(this.externalWorkerSourceTypes[N])throw new Error(`Worker source with name "${N}" already registered.`);this.externalWorkerSourceTypes[N]=q},this.self.addProtocol=m.bf,this.self.removeProtocol=m.bg,this.self.registerRTLTextPlugin=N=>{if(m.bA.isParsed())throw new Error("RTL text plugin already registered.");m.bA.setMethods(N)},this.actor.registerMessageHandler("LDT",(N,q)=>this._getDEMWorkerSource(N,q.source).loadTile(q)),this.actor.registerMessageHandler("RDT",(N,q)=>m._(this,void 0,void 0,function*(){this._getDEMWorkerSource(N,q.source).removeTile(q)})),this.actor.registerMessageHandler("GCEZ",(N,q)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(N,q.type,q.source).getClusterExpansionZoom(q)})),this.actor.registerMessageHandler("GCC",(N,q)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(N,q.type,q.source).getClusterChildren(q)})),this.actor.registerMessageHandler("GCL",(N,q)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(N,q.type,q.source).getClusterLeaves(q)})),this.actor.registerMessageHandler("LD",(N,q)=>this._getWorkerSource(N,q.type,q.source).loadData(q)),this.actor.registerMessageHandler("LT",(N,q)=>this._getWorkerSource(N,q.type,q.source).loadTile(q)),this.actor.registerMessageHandler("RT",(N,q)=>this._getWorkerSource(N,q.type,q.source).reloadTile(q)),this.actor.registerMessageHandler("AT",(N,q)=>this._getWorkerSource(N,q.type,q.source).abortTile(q)),this.actor.registerMessageHandler("RMT",(N,q)=>this._getWorkerSource(N,q.type,q.source).removeTile(q)),this.actor.registerMessageHandler("RS",(N,q)=>m._(this,void 0,void 0,function*(){if(!this.workerSources[N]||!this.workerSources[N][q.type]||!this.workerSources[N][q.type][q.source])return;const H=this.workerSources[N][q.type][q.source];delete this.workerSources[N][q.type][q.source],H.removeSource!==void 0&&H.removeSource(q)})),this.actor.registerMessageHandler("RM",N=>m._(this,void 0,void 0,function*(){delete this.layerIndexes[N],delete this.availableImages[N],delete this.workerSources[N],delete this.demWorkerSources[N]})),this.actor.registerMessageHandler("SR",(N,q)=>m._(this,void 0,void 0,function*(){this.referrer=q})),this.actor.registerMessageHandler("SRPS",(N,q)=>this._syncRTLPluginState(N,q)),this.actor.registerMessageHandler("IS",(N,q)=>m._(this,void 0,void 0,function*(){this.self.importScripts(q)})),this.actor.registerMessageHandler("SI",(N,q)=>this._setImages(N,q)),this.actor.registerMessageHandler("UL",(N,q)=>m._(this,void 0,void 0,function*(){this._getLayerIndex(N).update(q.layers,q.removedIds)})),this.actor.registerMessageHandler("SL",(N,q)=>m._(this,void 0,void 0,function*(){this._getLayerIndex(N).replace(q)}))}_setImages(F,N){return m._(this,void 0,void 0,function*(){this.availableImages[F]=N;for(const q in this.workerSources[F]){const H=this.workerSources[F][q];for(const ut in H)H[ut].availableImages=N}})}_syncRTLPluginState(F,N){return m._(this,void 0,void 0,function*(){if(m.bA.isParsed())return m.bA.getState();if(N.pluginStatus!=="loading")return m.bA.setState(N),N;const q=N.pluginURL;if(this.self.importScripts(q),m.bA.isParsed()){const H={pluginStatus:"loaded",pluginURL:q};return m.bA.setState(H),H}throw m.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${q}`)})}_getAvailableImages(F){let N=this.availableImages[F];return N||(N=[]),N}_getLayerIndex(F){let N=this.layerIndexes[F];return N||(N=this.layerIndexes[F]=new l),N}_getWorkerSource(F,N,q){if(this.workerSources[F]||(this.workerSources[F]={}),this.workerSources[F][N]||(this.workerSources[F][N]={}),!this.workerSources[F][N][q]){const H={sendAsync:(ut,dt)=>(ut.targetMapId=F,this.actor.sendAsync(ut,dt))};switch(N){case"vector":this.workerSources[F][N][q]=new P(H,this._getLayerIndex(F),this._getAvailableImages(F));break;case"geojson":this.workerSources[F][N][q]=new Rn(H,this._getLayerIndex(F),this._getAvailableImages(F));break;default:this.workerSources[F][N][q]=new this.externalWorkerSourceTypes[N](H,this._getLayerIndex(F),this._getAvailableImages(F))}}return this.workerSources[F][N][q]}_getDEMWorkerSource(F,N){return this.demWorkerSources[F]||(this.demWorkerSources[F]={}),this.demWorkerSources[F][N]||(this.demWorkerSources[F][N]=new L),this.demWorkerSources[F][N]}}return m.i(self)&&(self.worker=new os(self)),os}),p("index",["exports","./shared"],function(m,l){var T="4.1.3";let I,k;const P={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:g=>new Promise((i,o)=>{const u=requestAnimationFrame(i);g.signal.addEventListener("abort",()=>{cancelAnimationFrame(u),o(l.c())})}),getImageData(g,i=0){return this.getImageCanvasContext(g).getImageData(-i,-i,g.width+2*i,g.height+2*i)},getImageCanvasContext(g){const i=window.document.createElement("canvas"),o=i.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return i.width=g.width,i.height=g.height,o.drawImage(g,0,0,g.width,g.height),o},resolveURL:g=>(I||(I=document.createElement("a")),I.href=g,I.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(k==null&&(k=matchMedia("(prefers-reduced-motion: reduce)")),k.matches)}};class L{static testProp(i){if(!L.docStyle)return i[0];for(let o=0;o<i.length;o++)if(i[o]in L.docStyle)return i[o];return i[0]}static create(i,o,u){const d=window.document.createElement(i);return o!==void 0&&(d.className=o),u&&u.appendChild(d),d}static createNS(i,o){return window.document.createElementNS(i,o)}static disableDrag(){L.docStyle&&L.selectProp&&(L.userSelect=L.docStyle[L.selectProp],L.docStyle[L.selectProp]="none")}static enableDrag(){L.docStyle&&L.selectProp&&(L.docStyle[L.selectProp]=L.userSelect)}static setTransform(i,o){i.style[L.transformProp]=o}static addEventListener(i,o,u,d={}){i.addEventListener(o,u,"passive"in d?d:d.capture)}static removeEventListener(i,o,u,d={}){i.removeEventListener(o,u,"passive"in d?d:d.capture)}static suppressClickInternal(i){i.preventDefault(),i.stopPropagation(),window.removeEventListener("click",L.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",L.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",L.suppressClickInternal,!0)},0)}static getScale(i){const o=i.getBoundingClientRect();return{x:o.width/i.offsetWidth||1,y:o.height/i.offsetHeight||1,boundingClientRect:o}}static getPoint(i,o,u){const d=o.boundingClientRect;return new l.P((u.clientX-d.left)/o.x-i.clientLeft,(u.clientY-d.top)/o.y-i.clientTop)}static mousePos(i,o){const u=L.getScale(i);return L.getPoint(i,u,o)}static touchPos(i,o){const u=[],d=L.getScale(i);for(let _=0;_<o.length;_++)u.push(L.getPoint(i,d,o[_]));return u}static mouseButton(i){return i.button}static remove(i){i.parentNode&&i.parentNode.removeChild(i)}}L.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,L.selectProp=L.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),L.transformProp=L.testProp(["transform","WebkitTransform"]);const K={supported:!1,testSupport:function(g){!vt&&ot&&(yt?At(g):tt=g)}};let tt,ot,vt=!1,yt=!1;function At(g){const i=g.createTexture();g.bindTexture(g.TEXTURE_2D,i);try{if(g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,ot),g.isContextLost())return;K.supported=!0}catch{}g.deleteTexture(i),vt=!0}var ht;typeof document<"u"&&(ot=document.createElement("img"),ot.onload=function(){tt&&At(tt),tt=null,yt=!0},ot.onerror=function(){vt=!0,tt=null},ot.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(g){let i,o,u,d;g.resetRequestQueue=()=>{i=[],o=0,u=0,d={}},g.addThrottleControl=A=>{const C=u++;return d[C]=A,C},g.removeThrottleControl=A=>{delete d[A],w()},g.getImage=(A,C,z=!0)=>new Promise((O,V)=>{K.supported&&(A.headers||(A.headers={}),A.headers.accept="image/webp,*/*"),l.e(A,{type:"image"}),i.push({abortController:C,requestParameters:A,supportImageRefresh:z,state:"queued",onError:Z=>{V(Z)},onSuccess:Z=>{O(Z)}}),w()});const _=A=>l._(this,void 0,void 0,function*(){A.state="running";const{requestParameters:C,supportImageRefresh:z,onError:O,onSuccess:V,abortController:Z}=A,W=z===!1&&!l.i(self)&&!l.g(C.url)&&(!C.headers||Object.keys(C.headers).reduce((lt,xt)=>lt&&xt==="accept",!0));o++;const J=W?M(C,Z):l.m(C,Z);try{const lt=yield J;delete A.abortController,A.state="completed",lt.data instanceof HTMLImageElement||l.b(lt.data)?V(lt):lt.data&&V({data:yield(j=lt.data,typeof createImageBitmap=="function"?l.d(j):l.f(j)),cacheControl:lt.cacheControl,expires:lt.expires})}catch(lt){delete A.abortController,O(lt)}finally{o--,w()}var j}),w=()=>{const A=(()=>{for(const C of Object.keys(d))if(d[C]())return!0;return!1})()?l.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let C=o;C<A&&i.length>0;C++){const z=i.shift();z.abortController.signal.aborted?C--:_(z)}},M=(A,C)=>new Promise((z,O)=>{const V=new Image,Z=A.url,W=A.credentials;W&&W==="include"?V.crossOrigin="use-credentials":(W&&W==="same-origin"||!l.s(Z))&&(V.crossOrigin="anonymous"),C.signal.addEventListener("abort",()=>{V.src="",O(l.c())}),V.fetchPriority="high",V.onload=()=>{V.onerror=V.onload=null,z({data:V})},V.onerror=()=>{V.onerror=V.onload=null,C.signal.aborted||O(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},V.src=Z})}(ht||(ht={})),ht.resetRequestQueue();class Tt{constructor(i){this._transformRequestFn=i}transformRequest(i,o){return this._transformRequestFn&&this._transformRequestFn(i,o)||{url:i}}normalizeSpriteURL(i,o,u){const d=function(_){const w=_.match($t);if(!w)throw new Error(`Unable to parse URL "${_}"`);return{protocol:w[1],authority:w[2],path:w[3]||"/",params:w[4]?w[4].split("&"):[]}}(i);return d.path+=`${o}${u}`,function(_){const w=_.params.length?`?${_.params.join("&")}`:"";return`${_.protocol}://${_.authority}${_.path}${w}`}(d)}setTransformRequest(i){this._transformRequestFn=i}}const $t=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function qt(g){var i=new l.A(3);return i[0]=g[0],i[1]=g[1],i[2]=g[2],i}var oe,ne=function(g,i,o){return g[0]=i[0]-o[0],g[1]=i[1]-o[1],g[2]=i[2]-o[2],g};oe=new l.A(3),l.A!=Float32Array&&(oe[0]=0,oe[1]=0,oe[2]=0);var Vt=function(g){var i=g[0],o=g[1];return i*i+o*o};function Gt(g){const i=[];if(typeof g=="string")i.push({id:"default",url:g});else if(g&&g.length>0){const o=[];for(const{id:u,url:d}of g){const _=`${u}${d}`;o.indexOf(_)===-1&&(o.push(_),i.push({id:u,url:d}))}}return i}(function(){var g=new l.A(2);l.A!=Float32Array&&(g[0]=0,g[1]=0)})();class Dt{constructor(i,o,u,d){this.context=i,this.format=u,this.texture=i.gl.createTexture(),this.update(o,d)}update(i,o,u){const{width:d,height:_}=i,w=!(this.size&&this.size[0]===d&&this.size[1]===_||u),{context:M}=this,{gl:A}=M;if(this.useMipmap=!!(o&&o.useMipmap),A.bindTexture(A.TEXTURE_2D,this.texture),M.pixelStoreUnpackFlipY.set(!1),M.pixelStoreUnpack.set(1),M.pixelStoreUnpackPremultiplyAlpha.set(this.format===A.RGBA&&(!o||o.premultiply!==!1)),w)this.size=[d,_],i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||l.b(i)?A.texImage2D(A.TEXTURE_2D,0,this.format,this.format,A.UNSIGNED_BYTE,i):A.texImage2D(A.TEXTURE_2D,0,this.format,d,_,0,this.format,A.UNSIGNED_BYTE,i.data);else{const{x:C,y:z}=u||{x:0,y:0};i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||l.b(i)?A.texSubImage2D(A.TEXTURE_2D,0,C,z,A.RGBA,A.UNSIGNED_BYTE,i):A.texSubImage2D(A.TEXTURE_2D,0,C,z,d,_,A.RGBA,A.UNSIGNED_BYTE,i.data)}this.useMipmap&&this.isSizePowerOfTwo()&&A.generateMipmap(A.TEXTURE_2D)}bind(i,o,u){const{context:d}=this,{gl:_}=d;_.bindTexture(_.TEXTURE_2D,this.texture),u!==_.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=_.LINEAR),i!==this.filter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,i),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,u||i),this.filter=i),o!==this.wrap&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,o),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}function de(g){const{userImage:i}=g;return!!(i&&i.render&&i.render())&&(g.data.replace(new Uint8Array(i.data.buffer)),!0)}class De extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:o,promiseResolve:u}of this.requestors)u(this._getImagesForIds(o));this.requestors=[]}}getImage(i){const o=this.images[i];if(o&&!o.data&&o.spriteData){const u=o.spriteData;o.data=new l.R({width:u.width,height:u.height},u.context.getImageData(u.x,u.y,u.width,u.height).data),o.spriteData=null}return o}addImage(i,o){if(this.images[i])throw new Error(`Image id ${i} already exist, use updateImage instead`);this._validate(i,o)&&(this.images[i]=o)}_validate(i,o){let u=!0;const d=o.data||o.spriteData;return this._validateStretch(o.stretchX,d&&d.width)||(this.fire(new l.j(new Error(`Image "${i}" has invalid "stretchX" value`))),u=!1),this._validateStretch(o.stretchY,d&&d.height)||(this.fire(new l.j(new Error(`Image "${i}" has invalid "stretchY" value`))),u=!1),this._validateContent(o.content,o)||(this.fire(new l.j(new Error(`Image "${i}" has invalid "content" value`))),u=!1),u}_validateStretch(i,o){if(!i)return!0;let u=0;for(const d of i){if(d[0]<u||d[1]<d[0]||o<d[1])return!1;u=d[1]}return!0}_validateContent(i,o){if(!i)return!0;if(i.length!==4)return!1;const u=o.spriteData,d=u&&u.width||o.data.width,_=u&&u.height||o.data.height;return!(i[0]<0||d<i[0]||i[1]<0||_<i[1]||i[2]<0||d<i[2]||i[3]<0||_<i[3]||i[2]<i[0]||i[3]<i[1])}updateImage(i,o,u=!0){const d=this.getImage(i);if(u&&(d.data.width!==o.data.width||d.data.height!==o.data.height))throw new Error(`size mismatch between old image (${d.data.width}x${d.data.height}) and new image (${o.data.width}x${o.data.height}).`);o.version=d.version+1,this.images[i]=o,this.updatedImages[i]=!0}removeImage(i){const o=this.images[i];delete this.images[i],delete this.patterns[i],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i){return new Promise((o,u)=>{let d=!0;if(!this.isLoaded())for(const _ of i)this.images[_]||(d=!1);this.isLoaded()||d?o(this._getImagesForIds(i)):this.requestors.push({ids:i,promiseResolve:o})})}_getImagesForIds(i){const o={};for(const u of i){let d=this.getImage(u);d||(this.fire(new l.k("styleimagemissing",{id:u})),d=this.getImage(u)),d?o[u]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,hasRenderCallback:!!(d.userImage&&d.userImage.render)}:l.w(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return o}getPixelSize(){const{width:i,height:o}=this.atlasImage;return{width:i,height:o}}getPattern(i){const o=this.patterns[i],u=this.getImage(i);if(!u)return null;if(o&&o.position.version===u.version)return o.position;if(o)o.position.version=u.version;else{const d={w:u.data.width+2,h:u.data.height+2,x:0,y:0},_=new l.I(d,u);this.patterns[i]={bin:d,position:_}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const o=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Dt(i,this.atlasImage,o.RGBA),this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const _ in this.patterns)i.push(this.patterns[_].bin);const{w:o,h:u}=l.p(i),d=this.atlasImage;d.resize({width:o||1,height:u||1});for(const _ in this.patterns){const{bin:w}=this.patterns[_],M=w.x+1,A=w.y+1,C=this.getImage(_).data,z=C.width,O=C.height;l.R.copy(C,d,{x:0,y:0},{x:M,y:A},{width:z,height:O}),l.R.copy(C,d,{x:0,y:O-1},{x:M,y:A-1},{width:z,height:1}),l.R.copy(C,d,{x:0,y:0},{x:M,y:A+O},{width:z,height:1}),l.R.copy(C,d,{x:z-1,y:0},{x:M-1,y:A},{width:1,height:O}),l.R.copy(C,d,{x:0,y:0},{x:M+z,y:A},{width:1,height:O})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const o of i){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;const u=this.getImage(o);u||l.w(`Image with ID: "${o}" was not found`),de(u)&&this.updateImage(o,u)}}}const ke=1e20;function gi(g,i,o,u,d,_,w,M,A){for(let C=i;C<i+u;C++)Re(g,o*_+C,_,d,w,M,A);for(let C=o;C<o+d;C++)Re(g,C*_+i,1,u,w,M,A)}function Re(g,i,o,u,d,_,w){_[0]=0,w[0]=-ke,w[1]=ke,d[0]=g[i];for(let M=1,A=0,C=0;M<u;M++){d[M]=g[i+M*o];const z=M*M;do{const O=_[A];C=(d[M]-d[O]+z-O*O)/(M-O)/2}while(C<=w[A]&&--A>-1);A++,_[A]=M,w[A]=C,w[A+1]=ke}for(let M=0,A=0;M<u;M++){for(;w[A+1]<M;)A++;const C=_[A],z=M-C;g[i+M*o]=d[C]+z*z}}class Le{constructor(i,o){this.requestManager=i,this.localIdeographFontFamily=o,this.entries={}}setURL(i){this.url=i}getGlyphs(i){return l._(this,void 0,void 0,function*(){const o=[];for(const _ in i)for(const w of i[_])o.push(this._getAndCacheGlyphsPromise(_,w));const u=yield Promise.all(o),d={};for(const{stack:_,id:w,glyph:M}of u)d[_]||(d[_]={}),d[_][w]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics};return d})}_getAndCacheGlyphsPromise(i,o){return l._(this,void 0,void 0,function*(){let u=this.entries[i];u||(u=this.entries[i]={glyphs:{},requests:{},ranges:{}});let d=u.glyphs[o];if(d!==void 0)return{stack:i,id:o,glyph:d};if(d=this._tinySDF(u,i,o),d)return u.glyphs[o]=d,{stack:i,id:o,glyph:d};const _=Math.floor(o/256);if(256*_>65535)throw new Error("glyphs > 65535 not supported");if(u.ranges[_])return{stack:i,id:o,glyph:d};if(!this.url)throw new Error("glyphsUrl is not set");if(!u.requests[_]){const M=Le.loadGlyphRange(i,_,this.url,this.requestManager);u.requests[_]=M}const w=yield u.requests[_];for(const M in w)this._doesCharSupportLocalGlyph(+M)||(u.glyphs[+M]=w[+M]);return u.ranges[_]=!0,{stack:i,id:o,glyph:w[o]||null}})}_doesCharSupportLocalGlyph(i){return!!this.localIdeographFontFamily&&(l.u["CJK Unified Ideographs"](i)||l.u["Hangul Syllables"](i)||l.u.Hiragana(i)||l.u.Katakana(i))}_tinySDF(i,o,u){const d=this.localIdeographFontFamily;if(!d||!this._doesCharSupportLocalGlyph(u))return;let _=i.tinySDF;if(!_){let M="400";/bold/i.test(o)?M="900":/medium/i.test(o)?M="500":/light/i.test(o)&&(M="200"),_=i.tinySDF=new Le.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:d,fontWeight:M})}const w=_.draw(String.fromCharCode(u));return{id:u,bitmap:new l.o({width:w.width||60,height:w.height||60},w.data),metrics:{width:w.glyphWidth/2||24,height:w.glyphHeight/2||24,left:w.glyphLeft/2+.5||0,top:w.glyphTop/2-27.5||-8,advance:w.glyphAdvance/2||24,isDoubleResolution:!0}}}}Le.loadGlyphRange=function(g,i,o,u){return l._(this,void 0,void 0,function*(){const d=256*i,_=d+255,w=u.transformRequest(o.replace("{fontstack}",g).replace("{range}",`${d}-${_}`),"Glyphs"),M=yield l.l(w,new AbortController);if(!M||!M.data)throw new Error(`Could not load glyph range. range: ${i}, ${d}-${_}`);const A={};for(const C of l.n(M.data))A[C.id]=C;return A})},Le.TinySDF=class{constructor({fontSize:g=24,buffer:i=3,radius:o=8,cutoff:u=.25,fontFamily:d="sans-serif",fontWeight:_="normal",fontStyle:w="normal"}={}){this.buffer=i,this.cutoff=u,this.radius=o;const M=this.size=g+4*i,A=this._createCanvas(M),C=this.ctx=A.getContext("2d",{willReadFrequently:!0});C.font=`${w} ${_} ${g}px ${d}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M)}_createCanvas(g){const i=document.createElement("canvas");return i.width=i.height=g,i}draw(g){const{width:i,actualBoundingBoxAscent:o,actualBoundingBoxDescent:u,actualBoundingBoxLeft:d,actualBoundingBoxRight:_}=this.ctx.measureText(g),w=Math.ceil(o),M=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-d))),A=Math.min(this.size-this.buffer,w+Math.ceil(u)),C=M+2*this.buffer,z=A+2*this.buffer,O=Math.max(C*z,0),V=new Uint8ClampedArray(O),Z={data:V,width:C,height:z,glyphWidth:M,glyphHeight:A,glyphTop:w,glyphLeft:0,glyphAdvance:i};if(M===0||A===0)return Z;const{ctx:W,buffer:J,gridInner:j,gridOuter:lt}=this;W.clearRect(J,J,M,A),W.fillText(g,J,J+w);const xt=W.getImageData(J,J,M,A);lt.fill(ke,0,O),j.fill(0,0,O);for(let et=0;et<A;et++)for(let pt=0;pt<M;pt++){const bt=xt.data[4*(et*M+pt)+3]/255;if(bt===0)continue;const wt=(et+J)*C+pt+J;if(bt===1)lt[wt]=0,j[wt]=ke;else{const St=.5-bt;lt[wt]=St>0?St*St:0,j[wt]=St<0?St*St:0}}gi(lt,0,0,C,z,C,this.f,this.v,this.z),gi(j,J,J,M,A,C,this.f,this.v,this.z);for(let et=0;et<O;et++){const pt=Math.sqrt(lt[et])-Math.sqrt(j[et]);V[et]=Math.round(255-255*(pt/this.radius+this.cutoff))}return Z}};class ii{constructor(){this.specification=l.v.light.position}possiblyEvaluate(i,o){return l.y(i.expression.evaluate(o))}interpolate(i,o,u){return{x:l.z.number(i.x,o.x,u),y:l.z.number(i.y,o.y,u),z:l.z.number(i.z,o.z,u)}}}let xs;class Ds extends l.E{constructor(i){super(),xs=xs||new l.q({anchor:new l.D(l.v.light.anchor),position:new ii,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.T(xs),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,o={}){if(!this._validate(l.r,i,o))for(const u in i){const d=i[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),d):this._transitionable.setValue(u,d)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,o,u){return(!u||u.validate!==!1)&&l.t(this,i.call(l.x,{value:o,style:{glyphs:!0,sprite:!0},styleSpec:l.v}))}}class Ei{constructor(i,o){this.width=i,this.height=o,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(i,o){const u=i.join(",")+String(o);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(i,o)),this.dashEntry[u]}getDashRanges(i,o,u){const d=[];let _=i.length%2==1?-i[i.length-1]*u:0,w=i[0]*u,M=!0;d.push({left:_,right:w,isDash:M,zeroLength:i[0]===0});let A=i[0];for(let C=1;C<i.length;C++){M=!M;const z=i[C];_=A*u,A+=z,w=A*u,d.push({left:_,right:w,isDash:M,zeroLength:z===0})}return d}addRoundDash(i,o,u){const d=o/2;for(let _=-u;_<=u;_++){const w=this.width*(this.nextRow+u+_);let M=0,A=i[M];for(let C=0;C<this.width;C++){C/A.right>1&&(A=i[++M]);const z=Math.abs(C-A.left),O=Math.abs(C-A.right),V=Math.min(z,O);let Z;const W=_/u*(d+1);if(A.isDash){const J=d-Math.abs(W);Z=Math.sqrt(V*V+J*J)}else Z=d-Math.sqrt(V*V+W*W);this.data[w+C]=Math.max(0,Math.min(255,Z+128))}}}addRegularDash(i){for(let M=i.length-1;M>=0;--M){const A=i[M],C=i[M+1];A.zeroLength?i.splice(M,1):C&&C.isDash===A.isDash&&(C.left=A.left,i.splice(M,1))}const o=i[0],u=i[i.length-1];o.isDash===u.isDash&&(o.left=u.left-this.width,u.right=o.right+this.width);const d=this.width*this.nextRow;let _=0,w=i[_];for(let M=0;M<this.width;M++){M/w.right>1&&(w=i[++_]);const A=Math.abs(M-w.left),C=Math.abs(M-w.right),z=Math.min(A,C);this.data[d+M]=Math.max(0,Math.min(255,(w.isDash?z:-z)+128))}}addDash(i,o){const u=o?7:0,d=2*u+1;if(this.nextRow+d>this.height)return l.w("LineAtlas out of space"),null;let _=0;for(let M=0;M<i.length;M++)_+=i[M];if(_!==0){const M=this.width/_,A=this.getDashRanges(i,this.width,M);o?this.addRoundDash(A,M,u):this.addRegularDash(A)}const w={y:(this.nextRow+u+.5)/this.height,height:2*u/this.height,width:_};return this.nextRow+=d,this.dirty=!0,w}bind(i){const o=i.gl;this.texture?(o.bindTexture(o.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,o.texSubImage2D(o.TEXTURE_2D,0,0,0,this.width,this.height,o.ALPHA,o.UNSIGNED_BYTE,this.data))):(this.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.ALPHA,this.width,this.height,0,o.ALPHA,o.UNSIGNED_BYTE,this.data))}}const hi="maplibre_preloaded_worker_pool";class bs{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<bs.workerCount;)this.workers.push(new Worker(l.a.WORKER_URL));return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[hi]}numActive(){return Object.keys(this.active).length}}const fr=Math.floor(P.hardwareConcurrency/2);let As,Ii;function Rt(){return As||(As=new bs),As}bs.workerCount=l.B(globalThis)?Math.max(Math.min(fr,3),1):1;class ce{constructor(i,o){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=o;const u=this.workerPool.acquire(o);for(let d=0;d<u.length;d++){const _=new l.C(u[d],o);_.name=`Worker ${d}`,this.actors.push(_)}if(!this.actors.length)throw new Error("No actors found")}broadcast(i,o){const u=[];for(const d of this.actors)u.push(d.sendAsync({type:i,data:o}));return Promise.all(u)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(i=!0){this.actors.forEach(o=>{o.remove()}),this.actors=[],i&&this.workerPool.release(this.id)}registerMessageHandler(i,o){for(const u of this.actors)u.registerMessageHandler(i,o)}}function ae(){return Ii||(Ii=new ce(Rt(),l.G),Ii.registerMessageHandler("GR",(g,i,o)=>l.m(i,o))),Ii}function ye(g,i){const o=l.F();return l.H(o,o,[1,1,0]),l.J(o,o,[.5*g.width,.5*g.height,1]),l.K(o,o,g.calculatePosMatrix(i.toUnwrapped()))}function ni(g,i,o,u,d,_){const w=function(O,V,Z){if(O)for(const W of O){const J=V[W];if(J&&J.source===Z&&J.type==="fill-extrusion")return!0}else for(const W in V){const J=V[W];if(J.source===Z&&J.type==="fill-extrusion")return!0}return!1}(d&&d.layers,i,g.id),M=_.maxPitchScaleFactor(),A=g.tilesIn(u,M,w);A.sort(ai);const C=[];for(const O of A)C.push({wrappedTileID:O.tileID.wrapped().key,queryResults:O.tile.queryRenderedFeatures(i,o,g._state,O.queryGeometry,O.cameraQueryGeometry,O.scale,d,_,M,ye(g.transform,O.tileID))});const z=function(O){const V={},Z={};for(const W of O){const J=W.queryResults,j=W.wrappedTileID,lt=Z[j]=Z[j]||{};for(const xt in J){const et=J[xt],pt=lt[xt]=lt[xt]||{},bt=V[xt]=V[xt]||[];for(const wt of et)pt[wt.featureIndex]||(pt[wt.featureIndex]=!0,bt.push(wt))}}return V}(C);for(const O in z)z[O].forEach(V=>{const Z=V.feature,W=g.getFeatureState(Z.layer["source-layer"],Z.id);Z.source=Z.layer.source,Z.layer["source-layer"]&&(Z.sourceLayer=Z.layer["source-layer"]),Z.state=W});return z}function ai(g,i){const o=g.tileID,u=i.tileID;return o.overscaledZ-u.overscaledZ||o.canonical.y-u.canonical.y||o.wrap-u.wrap||o.canonical.x-u.canonical.x}function Q(g,i,o){return l._(this,void 0,void 0,function*(){let u=g;if(g.url?u=(yield l.h(i.transformRequest(g.url,"Source"),o)).data:yield P.frameAsync(o),!u)return null;const d=l.L(l.e(u,g),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in u&&u.vector_layers&&(d.vectorLayerIds=u.vector_layers.map(_=>_.id)),d})}class rt{constructor(i,o){i&&(o?this.setSouthWest(i).setNorthEast(o):Array.isArray(i)&&(i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1])))}setNorthEast(i){return this._ne=i instanceof l.M?new l.M(i.lng,i.lat):l.M.convert(i),this}setSouthWest(i){return this._sw=i instanceof l.M?new l.M(i.lng,i.lat):l.M.convert(i),this}extend(i){const o=this._sw,u=this._ne;let d,_;if(i instanceof l.M)d=i,_=i;else{if(!(i instanceof rt))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(rt.convert(i)):this.extend(l.M.convert(i)):i&&("lng"in i||"lon"in i)&&"lat"in i?this.extend(l.M.convert(i)):this;if(d=i._sw,_=i._ne,!d||!_)return this}return o||u?(o.lng=Math.min(d.lng,o.lng),o.lat=Math.min(d.lat,o.lat),u.lng=Math.max(_.lng,u.lng),u.lat=Math.max(_.lat,u.lat)):(this._sw=new l.M(d.lng,d.lat),this._ne=new l.M(_.lng,_.lat)),this}getCenter(){return new l.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.M(this.getWest(),this.getNorth())}getSouthEast(){return new l.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:o,lat:u}=l.M.convert(i);let d=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&d}static convert(i){return i instanceof rt?i:i&&new rt(i)}static fromLngLat(i,o=0){const u=360*o/40075017,d=u/Math.cos(Math.PI/180*i.lat);return new rt(new l.M(i.lng-d,i.lat-u),new l.M(i.lng+d,i.lat+u))}}class Mt{constructor(i,o,u){this.bounds=rt.convert(this.validateBounds(i)),this.minzoom=o||0,this.maxzoom=u||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const o=Math.pow(2,i.z),u=Math.floor(l.N(this.bounds.getWest())*o),d=Math.floor(l.O(this.bounds.getNorth())*o),_=Math.ceil(l.N(this.bounds.getEast())*o),w=Math.ceil(l.O(this.bounds.getSouth())*o);return i.x>=u&&i.x<_&&i.y>=d&&i.y<w}}class Ft extends l.E{constructor(i,o,u,d){if(super(),this.id=i,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.L(o,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d)}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield Q(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),i&&(l.e(this,i),i.bounds&&(this.tileBounds=new Mt(i.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(i){this._tileJSONRequest=null,this.fire(new l.j(i))}})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}setSourceProperty(i){this._tileJSONRequest&&this._tileJSONRequest.abort(),i(),this.load()}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}setUrl(i){return this.setSourceProperty(()=>{this.url=i,this._options.url=i}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(i){return l._(this,void 0,void 0,function*(){const o=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(o,"Tile"),uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};u.request.collectResourceTiming=this._collectResourceTiming;let d="RT";if(i.actor&&i.state!=="expired"){if(i.state==="loading")return new Promise((_,w)=>{i.reloadPromise={resolve:_,reject:w}})}else i.actor=this.dispatcher.getActor(),d="LT";i.abortController=new AbortController;try{const _=yield i.actor.sendAsync({type:d,data:u},i.abortController);if(delete i.abortController,i.aborted)return;this._afterTileLoadWorkerResponse(i,_)}catch(_){if(delete i.abortController,i.aborted)return;if(_&&_.status!==404)throw _;this._afterTileLoadWorkerResponse(i,null)}})}_afterTileLoadWorkerResponse(i,o){if(o&&o.resourceTiming&&(i.resourceTiming=o.resourceTiming),o&&this.map._refreshExpiredTiles&&i.setExpiryData(o),i.loadVectorData(o,this.map.painter),i.reloadPromise){const u=i.reloadPromise;i.reloadPromise=null,this.loadTile(i).then(u.resolve).catch(u.reject)}}abortTile(i){return l._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.actor&&(yield i.actor.sendAsync({type:"AT",data:{uid:i.uid,type:this.type,source:this.id}}))})}unloadTile(i){return l._(this,void 0,void 0,function*(){i.unloadVectorData(),i.actor&&(yield i.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class it extends l.E{constructor(i,o,u,d){super(),this.id=i,this.dispatcher=u,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},o),l.e(this,l.L(o,["url","scheme","tileSize"]))}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield Q(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,i&&(l.e(this,i),i.bounds&&(this.tileBounds=new Mt(i.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(i){this._tileJSONRequest=null,this.fire(new l.j(i))}})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(i){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),i(),this.load()}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}setUrl(i){return this.setSourceProperty(()=>{this.url=i,this._options.url=i}),this}serialize(){return l.e({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i){return l._(this,void 0,void 0,function*(){const o=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);i.abortController=new AbortController;try{const u=yield ht.getImage(this.map._requestManager.transformRequest(o,"Tile"),i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(u&&u.data){this.map._refreshExpiredTiles&&u.cacheControl&&u.expires&&i.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const d=this.map.painter.context,_=d.gl,w=u.data;i.texture=this.map.painter.getTileTexture(w.width),i.texture?i.texture.update(w,{useMipmap:!0}):(i.texture=new Dt(d,w,_.RGBA,{useMipmap:!0}),i.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST),d.extTextureFilterAnisotropic&&_.texParameterf(_.TEXTURE_2D,d.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,d.extTextureFilterAnisotropicMax)),i.state="loaded"}}catch(u){if(delete i.abortController,i.aborted)i.state="unloaded";else if(u)throw i.state="errored",u}})}abortTile(i){return l._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController)})}unloadTile(i){return l._(this,void 0,void 0,function*(){i.texture&&this.map.painter.saveTileTexture(i.texture)})}hasTransition(){return!1}}class Jt extends it{constructor(i,o,u,d){super(i,o,u,d),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox",this.redFactor=o.redFactor,this.greenFactor=o.greenFactor,this.blueFactor=o.blueFactor,this.baseShift=o.baseShift}loadTile(i){return l._(this,void 0,void 0,function*(){const o=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u=this.map._requestManager.transformRequest(o,"Tile");i.neighboringTiles=this._getNeighboringTiles(i.tileID),i.abortController=new AbortController;try{const d=yield ht.getImage(u,i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(d&&d.data){const _=d.data;this.map._refreshExpiredTiles&&d.cacheControl&&d.expires&&i.setExpiryData({cacheControl:d.cacheControl,expires:d.expires});const w=l.b(_)&&l.S()?_:yield this.readImageNow(_),M={type:this.type,uid:i.uid,source:this.id,rawImageData:w,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!i.actor||i.state==="expired"){i.actor=this.dispatcher.getActor();const A=yield i.actor.sendAsync({type:"LDT",data:M});i.dem=A,i.needsHillshadePrepare=!0,i.needsTerrainPrepare=!0,i.state="loaded"}}}catch(d){if(delete i.abortController,i.aborted)i.state="unloaded";else if(d)throw i.state="errored",d}})}readImageNow(i){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.U()){const o=i.width+2,u=i.height+2;try{return new l.R({width:o,height:u},yield l.V(i,-1,-1,o,u))}catch{}}return P.getImageData(i,1)})}_getNeighboringTiles(i){const o=i.canonical,u=Math.pow(2,o.z),d=(o.x-1+u)%u,_=o.x===0?i.wrap-1:i.wrap,w=(o.x+1+u)%u,M=o.x+1===u?i.wrap+1:i.wrap,A={};return A[new l.Q(i.overscaledZ,_,o.z,d,o.y).key]={backfilled:!1},A[new l.Q(i.overscaledZ,M,o.z,w,o.y).key]={backfilled:!1},o.y>0&&(A[new l.Q(i.overscaledZ,_,o.z,d,o.y-1).key]={backfilled:!1},A[new l.Q(i.overscaledZ,i.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},A[new l.Q(i.overscaledZ,M,o.z,w,o.y-1).key]={backfilled:!1}),o.y+1<u&&(A[new l.Q(i.overscaledZ,_,o.z,d,o.y+1).key]={backfilled:!1},A[new l.Q(i.overscaledZ,i.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},A[new l.Q(i.overscaledZ,M,o.z,w,o.y+1).key]={backfilled:!1}),A}unloadTile(i){return l._(this,void 0,void 0,function*(){i.demTexture&&this.map.painter.saveTileTexture(i.demTexture),i.fbo&&(i.fbo.destroy(),delete i.fbo),i.dem&&delete i.dem,delete i.neighboringTiles,i.state="unloaded",i.actor&&(yield i.actor.sendAsync({type:"RDT",data:{type:this.type,uid:i.uid,source:this.id}}))})}}class le extends l.E{constructor(i,o,u,d){super(),this.id=i,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=u.getActor(),this.setEventedParent(d),this._data=o.data,this._options=l.e({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const _=l.W/this.tileSize;this.workerOptions=l.e({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*_,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*_,extent:l.W,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:l.W,radius:(o.clusterRadius||50)*_,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return l._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(i){this.map=i,this.load()}setData(i){return this._data=i,this._updateWorkerData(),this}updateData(i){return this._updateWorkerData(i),this}setClusterOptions(i){return this.workerOptions.cluster=i.cluster,i&&(i.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=i.clusterRadius),i.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=i.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(i){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:i,source:this.id}})}getClusterChildren(i){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:i,source:this.id}})}getClusterLeaves(i,o,u){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:i,limit:o,offset:u}})}_updateWorkerData(i){return l._(this,void 0,void 0,function*(){const o=l.e({type:this.type},this.workerOptions);i?o.dataDiff=i:typeof this._data=="string"?(o.request=this.map._requestManager.transformRequest(P.resolveURL(this._data),"Source"),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.k("dataloading",{dataType:"source"}));try{const u=yield this.actor.sendAsync({type:"LD",data:o});if(this._pendingLoads--,this._removed||u.abandoned)return void this.fire(new l.k("dataabort",{dataType:"source"}));let d=null;u.resourceTiming&&u.resourceTiming[this.id]&&(d=u.resourceTiming[this.id].slice(0));const _={dataType:"source"};this._collectResourceTiming&&d&&d.length>0&&l.e(_,{resourceTiming:d}),this.fire(new l.k("data",Object.assign(Object.assign({},_),{sourceDataType:"metadata"}))),this.fire(new l.k("data",Object.assign(Object.assign({},_),{sourceDataType:"content"})))}catch(u){if(this._pendingLoads--,this._removed)return void this.fire(new l.k("dataabort",{dataType:"source"}));this.fire(new l.j(u))}})}loaded(){return this._pendingLoads===0}loadTile(i){return l._(this,void 0,void 0,function*(){const o=i.actor?"RT":"LT";i.actor=this.actor;const u={type:this.type,uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};i.abortController=new AbortController;const d=yield this.actor.sendAsync({type:o,data:u},i.abortController);delete i.abortController,i.unloadVectorData(),i.aborted||i.loadVectorData(d,this.map.painter,o==="RT")})}abortTile(i){return l._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.aborted=!0})}unloadTile(i){return l._(this,void 0,void 0,function*(){i.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Ct=l.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ht extends l.E{constructor(i,o,u,d){super(),this.id=i,this.dispatcher=u,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=o}load(i){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const o=yield ht.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,o&&o.data&&(this.image=o.data,i&&(this.coordinates=i),this._finishLoading())}catch(o){this._request=null,this._loaded=!0,this.fire(new l.j(o))}})}loaded(){return this._loaded}updateImage(i){return i.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=i.url,this.load(i.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(i){this.coordinates=i;const o=i.map(l.Y.fromLngLat);this.tileID=function(d){let _=1/0,w=1/0,M=-1/0,A=-1/0;for(const V of d)_=Math.min(_,V.x),w=Math.min(w,V.y),M=Math.max(M,V.x),A=Math.max(A,V.y);const C=Math.max(M-_,A-w),z=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),O=Math.pow(2,z);return new l.a0(z,Math.floor((_+M)/2*O),Math.floor((w+A)/2*O))}(o),this.minzoom=this.maxzoom=this.tileID.z;const u=o.map(d=>this.tileID.getTilePoint(d)._round());return this._boundsArray=new l.Z,this._boundsArray.emplaceBack(u[0].x,u[0].y,0,0),this._boundsArray.emplaceBack(u[1].x,u[1].y,l.W,0),this._boundsArray.emplaceBack(u[3].x,u[3].y,0,l.W),this._boundsArray.emplaceBack(u[2].x,u[2].y,l.W,l.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const i=this.map.painter.context,o=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,Ct.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Dt(i,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let u=!1;for(const d in this.tiles){const _=this.tiles[d];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,u=!0)}u&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(i){return l._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={}):i.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class jt extends Ht{constructor(i,o,u,d){super(i,o,u,d),this.roundZoom=!0,this.type="video",this.options=o}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1;const i=this.options;this.urls=[];for(const o of i.urls)this.urls.push(this.map._requestManager.transformRequest(o,"Source").url);try{const o=yield l.a2(this.urls);if(this._loaded=!0,!o)return;this.video=o,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(o){this.fire(new l.j(o))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(i){if(this.video){const o=this.video.seekable;i<o.start(0)||i>o.end(0)?this.fire(new l.j(new l.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=i}}getVideo(){return this.video}onAdd(i){this.map||(this.map=i,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const i=this.map.painter.context,o=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,Ct.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new Dt(i,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let u=!1;for(const d in this.tiles){const _=this.tiles[d];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,u=!0)}u&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class fe extends Ht{constructor(i,o,u,d){super(i,o,u,d),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(w=>typeof w!="number"))||this.fire(new l.j(new l.a1(`sources.${i}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.j(new l.a1(`sources.${i}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new l.j(new l.a1(`sources.${i}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new l.j(new l.a1(`sources.${i}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.j(new l.a1(`sources.${i}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){return l._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(i){this.map=i,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let i=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,i=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,i=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context,u=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Ct.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture?(i||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Dt(o,this.canvas,u.RGBA,{premultiply:!0});let d=!1;for(const _ in this.tiles){const w=this.tiles[_];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,d=!0)}d&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const i of[this.canvas.width,this.canvas.height])if(isNaN(i)||i<=0)return!0;return!1}}const Ae={},be=g=>{switch(g){case"geojson":return le;case"image":return Ht;case"raster":return it;case"raster-dem":return Jt;case"vector":return Ft;case"video":return jt;case"canvas":return fe}return Ae[g]},Pe="RTLPluginLoaded";class Ke extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=ae()}_syncState(i){return this.status=i,this.dispatcher.broadcast("SRPS",{pluginStatus:i,pluginURL:this.url}).catch(o=>{throw this.status="error",o})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(i){return l._(this,arguments,void 0,function*(o,u=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=P.resolveURL(o),!this.url)throw new Error(`requested url ${o} is invalid`);if(this.status==="unavailable"){if(!u)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return l._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.k(Pe))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let si=null;function zt(){return si||(si=new Ke),si}class _i{constructor(i,o){this.timeAdded=0,this.fadeEndTime=0,this.tileID=i,this.uid=l.a3(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(i){const o=i+this.timeAdded;o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(i){this.demTexture&&i.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(i,o,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(d,_){const w={};if(!_)return w;for(const M of d){const A=M.layerIds.map(C=>_.getLayer(C)).filter(Boolean);if(A.length!==0){M.layers=A,M.stateDependentLayerIds&&(M.stateDependentLayers=M.stateDependentLayerIds.map(C=>A.filter(z=>z.id===C)[0]));for(const C of A)w[C.id]=M}}return w}(i.buckets,o.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const _=this.buckets[d];if(_ instanceof l.a5){if(this.hasSymbolBuckets=!0,!u)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const _=this.buckets[d];if(_ instanceof l.a5&&_.hasRTLText){this.hasRTLText=!0,zt().lazyLoad();break}}this.queryPadding=0;for(const d in this.buckets){const _=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(d).queryRadius(_))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage)}else this.collisionBoxArray=new l.a4}unloadVectorData(){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(i){return this.buckets[i.id]}upload(i){for(const u in this.buckets){const d=this.buckets[u];d.uploadPending()&&d.upload(i)}const o=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Dt(i,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Dt(i,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,o,u,d,_,w,M,A,C,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:_,scale:w,tileSize:this.tileSize,pixelPosMatrix:z,transform:A,params:M,queryPadding:this.queryPadding*C},i,o,u):{}}querySourceFeatures(i,o){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const d=u.loadVTLayers(),_=o&&o.sourceLayer?o.sourceLayer:"",w=d._geojsonTileLayer||d[_];if(!w)return;const M=l.a6(o&&o.filter),{z:A,x:C,y:z}=this.tileID.canonical,O={z:A,x:C,y:z};for(let V=0;V<w.length;V++){const Z=w.feature(V);if(M.needGeometry){const j=l.a7(Z,!0);if(!M.filter(new l.a8(this.tileID.overscaledZ),j,this.tileID.canonical))continue}else if(!M.filter(new l.a8(this.tileID.overscaledZ),Z))continue;const W=u.getId(Z,_),J=new l.a9(Z,A,C,z,W);J.tile=O,i.push(J)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const o=this.expirationTime;if(i.cacheControl){const u=l.aa(i.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const u=Date.now();let d=!1;if(this.expirationTime>u)d=!1;else if(o)if(this.expirationTime<o)d=!0;else{const _=this.expirationTime-o;_?this.expirationTime=u+Math.max(_,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(i,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(i).length===0)return;const u=this.latestFeatureIndex.loadVTLayers();for(const d in this.buckets){if(!o.style.hasLayer(d))continue;const _=this.buckets[d],w=_.layers[0].sourceLayer||"_geojsonTileLayer",M=u[w],A=i[w];if(!M||!A||Object.keys(A).length===0)continue;_.update(A,M,this.imageAtlas&&this.imageAtlas.patternPositions||{});const C=o&&o.style&&o.style.getLayer(d);C&&(this.queryPadding=Math.max(this.queryPadding,C.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<P.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=P.now()+i}setDependencies(i,o){const u={};for(const d of o)u[d]=!0;this.dependencies[i]=u}hasDependency(i,o){for(const u of i){const d=this.dependencies[u];if(d){for(const _ of o)if(d[_])return!0}}return!1}}class Pi{constructor(i,o){this.max=i,this.onRemove=o,this.reset()}reset(){for(const i in this.data)for(const o of this.data[i])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(i,o,u){const d=i.wrapped().key;this.data[d]===void 0&&(this.data[d]=[]);const _={value:o,timeout:void 0};if(u!==void 0&&(_.timeout=setTimeout(()=>{this.remove(i,_)},u)),this.data[d].push(_),this.order.push(d),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const o=this.data[i].shift();return o.timeout&&clearTimeout(o.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),o.value}getByKey(i){const o=this.data[i];return o?o[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,o){if(!this.has(i))return this;const u=i.wrapped().key,d=o===void 0?0:this.data[u].indexOf(o),_=this.data[u][d];return this.data[u].splice(d,1),_.timeout&&clearTimeout(_.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(_.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(i){const o=[];for(const u in this.data)for(const d of this.data[u])i(d.value)||o.push(d);for(const u of o)this.remove(u.value.tileID,u)}}class pr{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,o,u){const d=String(o);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][d]=this.stateChanges[i][d]||{},l.e(this.stateChanges[i][d],u),this.deletedStates[i]===null){this.deletedStates[i]={};for(const _ in this.state[i])_!==d&&(this.deletedStates[i][_]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][d]===null){this.deletedStates[i][d]={};for(const _ in this.state[i][d])u[_]||(this.deletedStates[i][d][_]=null)}else for(const _ in u)this.deletedStates[i]&&this.deletedStates[i][d]&&this.deletedStates[i][d][_]===null&&delete this.deletedStates[i][d][_]}removeFeatureState(i,o,u){if(this.deletedStates[i]===null)return;const d=String(o);if(this.deletedStates[i]=this.deletedStates[i]||{},u&&o!==void 0)this.deletedStates[i][d]!==null&&(this.deletedStates[i][d]=this.deletedStates[i][d]||{},this.deletedStates[i][d][u]=null);else if(o!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][d])for(u in this.deletedStates[i][d]={},this.stateChanges[i][d])this.deletedStates[i][d][u]=null;else this.deletedStates[i][d]=null;else this.deletedStates[i]=null}getState(i,o){const u=String(o),d=l.e({},(this.state[i]||{})[u],(this.stateChanges[i]||{})[u]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){const _=this.deletedStates[i][o];if(_===null)return{};for(const w in _)delete d[w]}return d}initializeTileState(i,o){i.setFeatureState(this.state,o)}coalesceChanges(i,o){const u={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const _={};for(const w in this.stateChanges[d])this.state[d][w]||(this.state[d][w]={}),l.e(this.state[d][w],this.stateChanges[d][w]),_[w]=this.state[d][w];u[d]=_}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const _={};if(this.deletedStates[d]===null)for(const w in this.state[d])_[w]={},this.state[d][w]={};else for(const w in this.deletedStates[d]){if(this.deletedStates[d][w]===null)this.state[d][w]={};else for(const M of Object.keys(this.deletedStates[d][w]))delete this.state[d][w][M];_[w]=this.state[d][w]}u[d]=u[d]||{},l.e(u[d],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const d in i)i[d].setFeatureState(u,o)}}class as extends l.E{constructor(i,o,u){super(),this.id=i,this.dispatcher=u,this.on("data",d=>this._dataHandler(d)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((d,_,w,M)=>{const A=new(be(_.type))(d,_,w,M);if(A.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${A.id}`);return A})(i,o,u,this),this._tiles={},this._cache=new Pi(0,d=>this._unloadTile(d)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new pr,this._didEmitContent=!1,this._updated=!1}onAdd(i){this.map=i,this._maxTileCacheSize=i?i._maxTileCacheSize:null,this._maxTileCacheZoomLevels=i?i._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(i)}onRemove(i){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(i)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const i in this._tiles){const o=this._tiles[i];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(i,o,u){return l._(this,void 0,void 0,function*(){try{yield this._source.loadTile(i),this._tileLoaded(i,o,u)}catch(d){i.state="errored",d.status!==404?this._source.fire(new l.j(d,{tile:i})):this.update(this.transform,this.terrain)}})}_unloadTile(i){this._source.unloadTile&&this._source.unloadTile(i)}_abortTile(i){this._source.abortTile&&this._source.abortTile(i),this._source.fire(new l.k("dataabort",{tile:i,coord:i.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const u=this._tiles[o];u.upload(i),u.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(i=>i.tileID).sort(Zt).map(i=>i.key)}getRenderableIds(i){const o=[];for(const u in this._tiles)this._isIdRenderable(u,i)&&o.push(this._tiles[u]);return i?o.sort((u,d)=>{const _=u.tileID,w=d.tileID,M=new l.P(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),A=new l.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-w.overscaledZ||A.y-M.y||A.x-M.x}).map(u=>u.tileID.key):o.map(u=>u.tileID).sort(Zt).map(u=>u.key)}hasRenderableParent(i){const o=this.findLoadedParent(i,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(i,o){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(o||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(i,"reloading")}}_reloadTile(i,o){return l._(this,void 0,void 0,function*(){const u=this._tiles[i];u&&(u.state!=="loading"&&(u.state=o),yield this._loadTile(u,i,o))})}_tileLoaded(i,o,u){i.timeAdded=P.now(),u==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(o,i),this.getSource().type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),i.aborted||this._source.fire(new l.k("data",{dataType:"source",tile:i,coord:i.tileID}))}_backfillDEM(i){const o=this.getRenderableIds();for(let d=0;d<o.length;d++){const _=o[d];if(i.neighboringTiles&&i.neighboringTiles[_]){const w=this.getTileByID(_);u(i,w),u(w,i)}}function u(d,_){d.needsHillshadePrepare=!0,d.needsTerrainPrepare=!0;let w=_.tileID.canonical.x-d.tileID.canonical.x;const M=_.tileID.canonical.y-d.tileID.canonical.y,A=Math.pow(2,d.tileID.canonical.z),C=_.tileID.key;w===0&&M===0||Math.abs(M)>1||(Math.abs(w)>1&&(Math.abs(w+A)===1?w+=A:Math.abs(w-A)===1&&(w-=A)),_.dem&&d.dem&&(d.dem.backfillBorder(_.dem,w,M),d.neighboringTiles&&d.neighboringTiles[C]&&(d.neighboringTiles[C].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,o,u,d){for(const _ in this._tiles){let w=this._tiles[_];if(d[_]||!w.hasData()||w.tileID.overscaledZ<=o||w.tileID.overscaledZ>u)continue;let M=w.tileID;for(;w&&w.tileID.overscaledZ>o+1;){const C=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[C.key],w&&w.hasData()&&(M=C)}let A=M;for(;A.overscaledZ>o;)if(A=A.scaledTo(A.overscaledZ-1),i[A.key]){d[M.key]=M;break}}}findLoadedParent(i,o){if(i.key in this._loadedParentTiles){const u=this._loadedParentTiles[i.key];return u&&u.tileID.overscaledZ>=o?u:null}for(let u=i.overscaledZ-1;u>=o;u--){const d=i.scaledTo(u),_=this._getLoadedTile(d);if(_)return _}}_getLoadedTile(i){const o=this._tiles[i.key];return o&&o.hasData()?o:this._cache.getByKey(i.wrapped().key)}updateCacheSize(i){const o=Math.ceil(i.width/this._source.tileSize)+1,u=Math.ceil(i.height/this._source.tileSize)+1,d=Math.floor(o*u*(this._maxTileCacheZoomLevels===null?l.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(_)}handleWrapJump(i){const o=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,o){const u={};for(const d in this._tiles){const _=this._tiles[d];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+o),u[_.tileID.key]=_}this._tiles=u;for(const d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(const d in this._tiles)this._setTileReloadTimer(d,this._tiles[d])}}update(i,o){if(!this._sourceLoaded||this._paused)return;let u;this.transform=i,this.terrain=o,this.updateCacheSize(i),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(z=>new l.Q(z.canonical.z,z.wrap,z.canonical.z,z.canonical.x,z.canonical.y)):(u=i.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:o}),this._source.hasTile&&(u=u.filter(z=>this._source.hasTile(z)))):u=[];const d=i.coveringZoomLevel(this._source),_=Math.max(d-as.maxOverzooming,this._source.minzoom),w=Math.max(d+as.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const z={};for(const O of u)if(O.canonical.z>this._source.minzoom){const V=O.scaledTo(O.canonical.z-1);z[V.key]=V;const Z=O.scaledTo(Math.max(this._source.minzoom,Math.min(O.canonical.z,5)));z[Z.key]=Z}u=u.concat(Object.values(z))}const M=u.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,M&&this.fire(new l.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const A=this._updateRetainedTiles(u,d);if(Oe(this._source.type)){const z={},O={},V=Object.keys(A),Z=P.now();for(const W of V){const J=A[W],j=this._tiles[W];if(!j||j.fadeEndTime!==0&&j.fadeEndTime<=Z)continue;const lt=this.findLoadedParent(J,_);lt&&(this._addTile(lt.tileID),z[lt.tileID.key]=lt.tileID),O[W]=J}this._retainLoadedChildren(O,d,w,A);for(const W in z)A[W]||(this._coveredTiles[W]=!0,A[W]=z[W]);if(o){const W={},J={};for(const j of u)this._tiles[j.key].hasData()?W[j.key]=j:J[j.key]=j;for(const j in J){const lt=J[j].children(this._source.maxzoom);this._tiles[lt[0].key]&&this._tiles[lt[1].key]&&this._tiles[lt[2].key]&&this._tiles[lt[3].key]&&(W[lt[0].key]=A[lt[0].key]=lt[0],W[lt[1].key]=A[lt[1].key]=lt[1],W[lt[2].key]=A[lt[2].key]=lt[2],W[lt[3].key]=A[lt[3].key]=lt[3],delete J[j])}for(const j in J){const lt=this.findLoadedParent(J[j],this._source.minzoom);if(lt){W[lt.tileID.key]=A[lt.tileID.key]=lt.tileID;for(const xt in W)W[xt].isChildOf(lt.tileID)&&delete W[xt]}}for(const j in this._tiles)W[j]||(this._coveredTiles[j]=!0)}}for(const z in A)this._tiles[z].clearFadeHold();const C=l.ab(this._tiles,A);for(const z of C){const O=this._tiles[z];O.hasSymbolBuckets&&!O.holdingForFade()?O.setHoldDuration(this.map._fadeDuration):O.hasSymbolBuckets&&!O.symbolFadeFinished()||this._removeTile(z)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(i)}_updateRetainedTiles(i,o){const u={},d={},_=Math.max(o-as.maxOverzooming,this._source.minzoom),w=Math.max(o+as.maxUnderzooming,this._source.minzoom),M={};for(const A of i){const C=this._addTile(A);u[A.key]=A,C.hasData()||o<this._source.maxzoom&&(M[A.key]=A)}this._retainLoadedChildren(M,o,w,u);for(const A of i){let C=this._tiles[A.key];if(C.hasData())continue;if(o+1>this._source.maxzoom){const O=A.children(this._source.maxzoom)[0],V=this.getTile(O);if(V&&V.hasData()){u[O.key]=O;continue}}else{const O=A.children(this._source.maxzoom);if(u[O[0].key]&&u[O[1].key]&&u[O[2].key]&&u[O[3].key])continue}let z=C.wasRequested();for(let O=A.overscaledZ-1;O>=_;--O){const V=A.scaledTo(O);if(d[V.key])break;if(d[V.key]=!0,C=this.getTile(V),!C&&z&&(C=this._addTile(V)),C){const Z=C.hasData();if((z||Z)&&(u[V.key]=V),z=C.wasRequested(),Z)break}}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const o=[];let u,d=this._tiles[i].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){u=this._loadedParentTiles[d.key];break}o.push(d.key);const _=d.scaledTo(d.overscaledZ-1);if(u=this._getLoadedTile(_),u)break;d=_}for(const _ of o)this._loadedParentTiles[_]=u}}_addTile(i){let o=this._tiles[i.key];if(o)return o;o=this._cache.getAndRemove(i),o&&(this._setTileReloadTimer(i.key,o),o.tileID=i,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,o)));const u=o;return o||(o=new _i(i,this._source.tileSize*i.overscaleFactor()),this._loadTile(o,i.key,o.state)),o.uses++,this._tiles[i.key]=o,u||this._source.fire(new l.k("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o}_setTileReloadTimer(i,o){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const u=o.getExpiryTimeout();u&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},u))}_removeTile(i){const o=this._tiles[i];o&&(o.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),o.uses>0||(o.hasData()&&o.state!=="reloading"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}_dataHandler(i){const o=i.sourceDataType;i.dataType==="source"&&o==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&i.dataType==="source"&&o==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(i);this._cache.reset()}tilesIn(i,o,u){const d=[],_=this.transform;if(!_)return d;const w=u?_.getCameraQueryGeometry(i):i,M=i.map(W=>_.pointCoordinate(W,this.terrain)),A=w.map(W=>_.pointCoordinate(W,this.terrain)),C=this.getIds();let z=1/0,O=1/0,V=-1/0,Z=-1/0;for(const W of A)z=Math.min(z,W.x),O=Math.min(O,W.y),V=Math.max(V,W.x),Z=Math.max(Z,W.y);for(let W=0;W<C.length;W++){const J=this._tiles[C[W]];if(J.holdingForFade())continue;const j=J.tileID,lt=Math.pow(2,_.zoom-J.tileID.overscaledZ),xt=o*J.queryPadding*l.W/J.tileSize/lt,et=[j.getTilePoint(new l.Y(z,O)),j.getTilePoint(new l.Y(V,Z))];if(et[0].x-xt<l.W&&et[0].y-xt<l.W&&et[1].x+xt>=0&&et[1].y+xt>=0){const pt=M.map(wt=>j.getTilePoint(wt)),bt=A.map(wt=>j.getTilePoint(wt));d.push({tile:J,tileID:j,queryGeometry:pt,cameraQueryGeometry:bt,scale:lt})}}return d}getVisibleCoordinates(i){const o=this.getRenderableIds(i).map(u=>this._tiles[u].tileID);for(const u of o)u.posMatrix=this.transform.calculatePosMatrix(u.toUnwrapped());return o}hasTransition(){if(this._source.hasTransition())return!0;if(Oe(this._source.type)){const i=P.now();for(const o in this._tiles)if(this._tiles[o].fadeEndTime>=i)return!0}return!1}setFeatureState(i,o,u){this._state.updateState(i=i||"_geojsonTileLayer",o,u)}removeFeatureState(i,o,u){this._state.removeFeatureState(i=i||"_geojsonTileLayer",o,u)}getFeatureState(i,o){return this._state.getState(i=i||"_geojsonTileLayer",o)}setDependencies(i,o,u){const d=this._tiles[i];d&&d.setDependencies(o,u)}reloadTilesForDependencies(i,o){for(const u in this._tiles)this._tiles[u].hasDependency(i,o)&&this._reloadTile(u,"reloading");this._cache.filter(u=>!u.hasDependency(i,o))}}function Zt(g,i){const o=Math.abs(2*g.wrap)-+(g.wrap<0),u=Math.abs(2*i.wrap)-+(i.wrap<0);return g.overscaledZ-i.overscaledZ||u-o||i.canonical.y-g.canonical.y||i.canonical.x-g.canonical.x}function Oe(g){return g==="raster"||g==="image"||g==="video"}as.maxOverzooming=10,as.maxUnderzooming=3;class Me{constructor(i,o){this.reset(i,o)}reset(i,o){this.points=i||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=l.ac(i,0,1);let o=1,u=this._distances[o];const d=i*this.paddedLength+this.padding;for(;u<d&&o<this._distances.length;)u=this._distances[++o];const _=o-1,w=this._distances[_],M=u-w,A=M>0?(d-w)/M:0;return this.points[_].mult(1-A).add(this.points[o].mult(A))}}function ui(g,i){let o=!0;return g==="always"||g!=="never"&&i!=="never"||(o=!1),o}class tr{constructor(i,o,u){const d=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(i/u),this.yCellCount=Math.ceil(o/u);for(let w=0;w<this.xCellCount*this.yCellCount;w++)d.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=o,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,o,u,d,_){this._forEachCell(o,u,d,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(d),this.bboxes.push(_)}insertCircle(i,o,u,d){this._forEachCell(o-d,u-d,o+d,u+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(o),this.circles.push(u),this.circles.push(d)}_insertBoxCell(i,o,u,d,_,w){this.boxCells[_].push(w)}_insertCircleCell(i,o,u,d,_,w){this.circleCells[_].push(w)}_query(i,o,u,d,_,w,M){if(u<0||i>this.width||d<0||o>this.height)return[];const A=[];if(i<=0&&o<=0&&this.width<=u&&this.height<=d){if(_)return[{key:null,x1:i,y1:o,x2:u,y2:d}];for(let C=0;C<this.boxKeys.length;C++)A.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const z=this.circles[3*C],O=this.circles[3*C+1],V=this.circles[3*C+2];A.push({key:this.circleKeys[C],x1:z-V,y1:O-V,x2:z+V,y2:O+V})}}else this._forEachCell(i,o,u,d,this._queryCell,A,{hitTest:_,overlapMode:w,seenUids:{box:{},circle:{}}},M);return A}query(i,o,u,d){return this._query(i,o,u,d,!1,null)}hitTest(i,o,u,d,_,w){return this._query(i,o,u,d,!0,_,w).length>0}hitTestCircle(i,o,u,d,_){const w=i-u,M=i+u,A=o-u,C=o+u;if(M<0||w>this.width||C<0||A>this.height)return!1;const z=[];return this._forEachCell(w,A,M,C,this._queryCellCircle,z,{hitTest:!0,overlapMode:d,circle:{x:i,y:o,radius:u},seenUids:{box:{},circle:{}}},_),z.length>0}_queryCell(i,o,u,d,_,w,M,A){const{seenUids:C,hitTest:z,overlapMode:O}=M,V=this.boxCells[_];if(V!==null){const W=this.bboxes;for(const J of V)if(!C.box[J]){C.box[J]=!0;const j=4*J,lt=this.boxKeys[J];if(i<=W[j+2]&&o<=W[j+3]&&u>=W[j+0]&&d>=W[j+1]&&(!A||A(lt))&&(!z||!ui(O,lt.overlapMode))&&(w.push({key:lt,x1:W[j],y1:W[j+1],x2:W[j+2],y2:W[j+3]}),z))return!0}}const Z=this.circleCells[_];if(Z!==null){const W=this.circles;for(const J of Z)if(!C.circle[J]){C.circle[J]=!0;const j=3*J,lt=this.circleKeys[J];if(this._circleAndRectCollide(W[j],W[j+1],W[j+2],i,o,u,d)&&(!A||A(lt))&&(!z||!ui(O,lt.overlapMode))){const xt=W[j],et=W[j+1],pt=W[j+2];if(w.push({key:lt,x1:xt-pt,y1:et-pt,x2:xt+pt,y2:et+pt}),z)return!0}}}return!1}_queryCellCircle(i,o,u,d,_,w,M,A){const{circle:C,seenUids:z,overlapMode:O}=M,V=this.boxCells[_];if(V!==null){const W=this.bboxes;for(const J of V)if(!z.box[J]){z.box[J]=!0;const j=4*J,lt=this.boxKeys[J];if(this._circleAndRectCollide(C.x,C.y,C.radius,W[j+0],W[j+1],W[j+2],W[j+3])&&(!A||A(lt))&&!ui(O,lt.overlapMode))return w.push(!0),!0}}const Z=this.circleCells[_];if(Z!==null){const W=this.circles;for(const J of Z)if(!z.circle[J]){z.circle[J]=!0;const j=3*J,lt=this.circleKeys[J];if(this._circlesCollide(W[j],W[j+1],W[j+2],C.x,C.y,C.radius)&&(!A||A(lt))&&!ui(O,lt.overlapMode))return w.push(!0),!0}}}_forEachCell(i,o,u,d,_,w,M,A){const C=this._convertToXCellCoord(i),z=this._convertToYCellCoord(o),O=this._convertToXCellCoord(u),V=this._convertToYCellCoord(d);for(let Z=C;Z<=O;Z++)for(let W=z;W<=V;W++)if(_.call(this,i,o,u,d,this.xCellCount*W+Z,w,M,A))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,o,u,d,_,w){const M=d-i,A=_-o,C=u+w;return C*C>M*M+A*A}_circleAndRectCollide(i,o,u,d,_,w,M){const A=(w-d)/2,C=Math.abs(i-(d+A));if(C>A+u)return!1;const z=(M-_)/2,O=Math.abs(o-(_+z));if(O>z+u)return!1;if(C<=A||O<=z)return!0;const V=C-A,Z=O-z;return V*V+Z*Z<=u*u}}function Be(g,i,o,u,d){const _=l.F();return i?(l.J(_,_,[1/d,1/d,1]),o||l.ad(_,_,u.angle)):l.K(_,u.labelPlaneMatrix,g),_}function Rn(g,i,o,u,d){if(i){const _=l.ae(g);return l.J(_,_,[d,d,1]),o||l.ad(_,_,-u.angle),_}return u.glCoordMatrix}function os(g,i,o){let u;o?(u=[g.x,g.y,o(g.x,g.y),1],l.af(u,u,i)):(u=[g.x,g.y,0,1],xe(u,u,i));const d=u[3];return{point:new l.P(u[0]/d,u[1]/d),signedDistanceFromCamera:d}}function Y(g,i){return .5+g/i*.5}function F(g,i){const o=g[0]/g[3],u=g[1]/g[3];return o>=-i[0]&&o<=i[0]&&u>=-i[1]&&u<=i[1]}function N(g,i,o,u,d,_,w,M,A,C){const z=u?g.textSizeData:g.iconSizeData,O=l.ag(z,o.transform.zoom),V=[256/o.width*2+1,256/o.height*2+1],Z=u?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;Z.clear();const W=g.lineVertexArray,J=u?g.text.placedSymbolArray:g.icon.placedSymbolArray,j=o.transform.width/o.transform.height;let lt=!1;for(let xt=0;xt<J.length;xt++){const et=J.get(xt);if(et.hidden||et.writingMode===l.ah.vertical&&!lt){Pt(et.numGlyphs,Z);continue}let pt;if(lt=!1,C?(pt=[et.anchorX,et.anchorY,C(et.anchorX,et.anchorY),1],l.af(pt,pt,i)):(pt=[et.anchorX,et.anchorY,0,1],xe(pt,pt,i)),!F(pt,V)){Pt(et.numGlyphs,Z);continue}const bt=Y(o.transform.cameraToCenterDistance,pt[3]),wt=l.ai(z,O,et),St=w?wt/bt:wt*bt,Bt=new l.P(et.anchorX,et.anchorY),Ot=os(Bt,d,C).point,Wt={projections:{},offsets:{}},Xt=ut(et,St,!1,M,i,d,_,g.glyphOffsetArray,W,Z,Ot,Bt,Wt,j,A,C);lt=Xt.useVertical,(Xt.notEnoughRoom||lt||Xt.needsFlipping&&ut(et,St,!0,M,i,d,_,g.glyphOffsetArray,W,Z,Ot,Bt,Wt,j,A,C).notEnoughRoom)&&Pt(et.numGlyphs,Z)}u?g.text.dynamicLayoutVertexBuffer.updateData(Z):g.icon.dynamicLayoutVertexBuffer.updateData(Z)}function q(g,i,o,u,d,_,w,M,A,C,z,O,V){const Z=M.glyphStartIndex+M.numGlyphs,W=M.lineStartIndex,J=M.lineStartIndex+M.lineLength,j=i.getoffsetX(M.glyphStartIndex),lt=i.getoffsetX(Z-1),xt=Lt(g*j,o,u,d,_,w,M.segment,W,J,A,C,z,O,V);if(!xt)return null;const et=Lt(g*lt,o,u,d,_,w,M.segment,W,J,A,C,z,O,V);return et?{first:xt,last:et}:null}function H(g,i,o,u){return g===l.ah.horizontal&&Math.abs(o.y-i.y)>Math.abs(o.x-i.x)*u?{useVertical:!0}:(g===l.ah.vertical?i.y<o.y:i.x>o.x)?{needsFlipping:!0}:null}function ut(g,i,o,u,d,_,w,M,A,C,z,O,V,Z,W,J){const j=i/24,lt=g.lineOffsetX*j,xt=g.lineOffsetY*j;let et;if(g.numGlyphs>1){const pt=g.glyphStartIndex+g.numGlyphs,bt=g.lineStartIndex,wt=g.lineStartIndex+g.lineLength,St=q(j,M,lt,xt,o,z,O,g,A,_,V,W,J);if(!St)return{notEnoughRoom:!0};const Bt=os(St.first.point,w,J).point,Ot=os(St.last.point,w,J).point;if(u&&!o){const Wt=H(g.writingMode,Bt,Ot,Z);if(Wt)return Wt}et=[St.first];for(let Wt=g.glyphStartIndex+1;Wt<pt-1;Wt++)et.push(Lt(j*M.getoffsetX(Wt),lt,xt,o,z,O,g.segment,bt,wt,A,_,V,W,J));et.push(St.last)}else{if(u&&!o){const bt=os(O,d,J).point,wt=g.lineStartIndex+g.segment+1,St=new l.P(A.getx(wt),A.gety(wt)),Bt=os(St,d,J),Ot=Bt.signedDistanceFromCamera>0?Bt.point:dt(O,St,bt,1,d,J),Wt=H(g.writingMode,bt,Ot,Z);if(Wt)return Wt}const pt=Lt(j*M.getoffsetX(g.glyphStartIndex),lt,xt,o,z,O,g.segment,g.lineStartIndex,g.lineStartIndex+g.lineLength,A,_,V,W,J);if(!pt)return{notEnoughRoom:!0};et=[pt]}for(const pt of et)l.aj(C,pt.point,pt.angle);return{}}function dt(g,i,o,u,d,_){const w=os(g.add(g.sub(i)._unit()),d,_).point,M=o.sub(w);return o.add(M._mult(u/M.mag()))}function mt(g,i){const{projectionCache:o,lineVertexArray:u,labelPlaneMatrix:d,tileAnchorPoint:_,distanceFromAnchor:w,getElevation:M,previousVertex:A,direction:C,absOffsetX:z}=i;if(o.projections[g])return o.projections[g];const O=new l.P(u.getx(g),u.gety(g)),V=os(O,d,M);if(V.signedDistanceFromCamera>0)return o.projections[g]=V.point,V.point;const Z=g-C;return dt(w===0?_:new l.P(u.getx(Z),u.gety(Z)),O,A,z-w+1,d,M)}function at(g,i,o){return g._unit()._perp()._mult(i*o)}function _t(g,i,o,u,d,_,w,M){const{projectionCache:A,direction:C}=M;if(A.offsets[g])return A.offsets[g];const z=o.add(i);if(g+C<u||g+C>=d)return A.offsets[g]=z,z;const O=mt(g+C,M),V=at(O.sub(o),w,C),Z=o.add(V),W=O.add(V);return A.offsets[g]=l.ak(_,z,Z,W)||z,A.offsets[g]}function Lt(g,i,o,u,d,_,w,M,A,C,z,O,V,Z){const W=u?g-i:g+i;let J=W>0?1:-1,j=0;u&&(J*=-1,j=Math.PI),J<0&&(j+=Math.PI);let lt,xt,et=J>0?M+w:M+w+1,pt=d,bt=d,wt=0,St=0;const Bt=Math.abs(W),Ot=[];let Wt;for(;wt+St<=Bt;){if(et+=J,et<M||et>=A)return null;wt+=St,bt=pt,xt=lt;const Qt={projectionCache:O,lineVertexArray:C,labelPlaneMatrix:z,tileAnchorPoint:_,distanceFromAnchor:wt,getElevation:Z,previousVertex:bt,direction:J,absOffsetX:Bt};if(pt=mt(et,Qt),o===0)Ot.push(bt),Wt=pt.sub(bt);else{let Ee;const Ve=pt.sub(bt);Ee=Ve.mag()===0?at(mt(et+J,Qt).sub(pt),o,J):at(Ve,o,J),xt||(xt=bt.add(Ee)),lt=_t(et,Ee,pt,M,A,xt,o,Qt),Ot.push(xt),Wt=lt.sub(xt)}St=Wt.mag()}const Xt=Wt._mult((Bt-wt)/St)._add(xt||bt),$e=j+Math.atan2(pt.y-bt.y,pt.x-bt.x);return Ot.push(Xt),{point:Xt,angle:V?$e:0,path:Ot}}const It=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Pt(g,i){for(let o=0;o<g;o++){const u=i.length;i.resize(u+4),i.float32.set(It,3*u)}}function xe(g,i,o){const u=i[0],d=i[1];return g[0]=o[0]*u+o[4]*d+o[12],g[1]=o[1]*u+o[5]*d+o[13],g[3]=o[3]*u+o[7]*d+o[15],g}const Se=100;class Ne{constructor(i,o=new tr(i.width+200,i.height+200,25),u=new tr(i.width+200,i.height+200,25)){this.transform=i,this.grid=o,this.ignoredGrid=u,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Se,this.screenBottomBoundary=i.height+Se,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(i,o,u,d,_,w){const M=this.projectAndGetPerspectiveRatio(d,i.anchorPointX,i.anchorPointY,w),A=u*M.perspectiveRatio,C=i.x1*A+M.point.x,z=i.y1*A+M.point.y,O=i.x2*A+M.point.x,V=i.y2*A+M.point.y;return!this.isInsideGrid(C,z,O,V)||o!=="always"&&this.grid.hitTest(C,z,O,V,o,_)||M.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[C,z,O,V],offscreen:this.isOffscreen(C,z,O,V)}}placeCollisionCircles(i,o,u,d,_,w,M,A,C,z,O,V,Z,W){const J=[],j=new l.P(o.anchorX,o.anchorY),lt=os(j,w,W),xt=Y(this.transform.cameraToCenterDistance,lt.signedDistanceFromCamera),et=(z?_/xt:_*xt)/l.ao,pt=os(j,M,W).point,bt=q(et,d,o.lineOffsetX*et,o.lineOffsetY*et,!1,pt,j,o,u,M,{projections:{},offsets:{}},!1,W);let wt=!1,St=!1,Bt=!0;if(bt){const Ot=.5*V*xt+Z,Wt=new l.P(-100,-100),Xt=new l.P(this.screenRightBoundary,this.screenBottomBoundary),$e=new Me,Qt=bt.first,Ee=bt.last;let Ve=[];for(let qe=Qt.path.length-1;qe>=1;qe--)Ve.push(Qt.path[qe]);for(let qe=1;qe<Ee.path.length;qe++)Ve.push(Ee.path[qe]);const ei=2.5*Ot;if(A){const qe=Ve.map(He=>os(He,A,W));Ve=qe.some(He=>He.signedDistanceFromCamera<=0)?[]:qe.map(He=>He.point)}let Ce=[];if(Ve.length>0){const qe=Ve[0].clone(),He=Ve[0].clone();for(let Ui=1;Ui<Ve.length;Ui++)qe.x=Math.min(qe.x,Ve[Ui].x),qe.y=Math.min(qe.y,Ve[Ui].y),He.x=Math.max(He.x,Ve[Ui].x),He.y=Math.max(He.y,Ve[Ui].y);Ce=qe.x>=Wt.x&&He.x<=Xt.x&&qe.y>=Wt.y&&He.y<=Xt.y?[Ve]:He.x<Wt.x||qe.x>Xt.x||He.y<Wt.y||qe.y>Xt.y?[]:l.al([Ve],Wt.x,Wt.y,Xt.x,Xt.y)}for(const qe of Ce){$e.reset(qe,.25*Ot);let He=0;He=$e.length<=.5*Ot?1:Math.ceil($e.paddedLength/ei)+1;for(let Ui=0;Ui<He;Ui++){const mi=Ui/Math.max(He-1,1),rr=$e.lerp(mi),cs=rr.x+Se,Oi=rr.y+Se;J.push(cs,Oi,Ot,0);const hs=cs-Ot,nr=Oi-Ot,qr=cs+Ot,gn=Oi+Ot;if(Bt=Bt&&this.isOffscreen(hs,nr,qr,gn),St=St||this.isInsideGrid(hs,nr,qr,gn),i!=="always"&&this.grid.hitTestCircle(cs,Oi,Ot,i,O)&&(wt=!0,!C))return{circles:[],offscreen:!1,collisionDetected:wt}}}}return{circles:!C&&wt||!St||xt<this.perspectiveRatioCutoff?[]:J,offscreen:Bt,collisionDetected:wt}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let u=1/0,d=1/0,_=-1/0,w=-1/0;for(const z of i){const O=new l.P(z.x+Se,z.y+Se);u=Math.min(u,O.x),d=Math.min(d,O.y),_=Math.max(_,O.x),w=Math.max(w,O.y),o.push(O)}const M=this.grid.query(u,d,_,w).concat(this.ignoredGrid.query(u,d,_,w)),A={},C={};for(const z of M){const O=z.key;if(A[O.bucketInstanceId]===void 0&&(A[O.bucketInstanceId]={}),A[O.bucketInstanceId][O.featureIndex])continue;const V=[new l.P(z.x1,z.y1),new l.P(z.x2,z.y1),new l.P(z.x2,z.y2),new l.P(z.x1,z.y2)];l.am(o,V)&&(A[O.bucketInstanceId][O.featureIndex]=!0,C[O.bucketInstanceId]===void 0&&(C[O.bucketInstanceId]=[]),C[O.bucketInstanceId].push(O.featureIndex))}return C}insertCollisionBox(i,o,u,d,_,w){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:_,collisionGroupID:w,overlapMode:o},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,o,u,d,_,w){const M=u?this.ignoredGrid:this.grid,A={bucketInstanceId:d,featureIndex:_,collisionGroupID:w,overlapMode:o};for(let C=0;C<i.length;C+=4)M.insertCircle(A,i[C],i[C+1],i[C+2])}projectAndGetPerspectiveRatio(i,o,u,d){let _;return d?(_=[o,u,d(o,u),1],l.af(_,_,i)):(_=[o,u,0,1],xe(_,_,i)),{point:new l.P((_[0]/_[3]+1)/2*this.transform.width+Se,(-_[1]/_[3]+1)/2*this.transform.height+Se),perspectiveRatio:.5+this.transform.cameraToCenterDistance/_[3]*.5}}isOffscreen(i,o,u,d){return u<Se||i>=this.screenRightBoundary||d<Se||o>this.screenBottomBoundary}isInsideGrid(i,o,u,d){return u>=0&&i<this.gridRightBoundary&&d>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const i=l.an([]);return l.H(i,i,[-100,-100,0]),i}}function ze(g,i,o){return i*(l.W/(g.tileSize*Math.pow(2,o-g.tileID.overscaledZ)))}class Qe{constructor(i,o,u,d){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?o:-o))):d&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class yi{constructor(i,o,u,d,_){this.text=new Qe(i?i.text:null,o,u,_),this.icon=new Qe(i?i.icon:null,o,d,_)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ci{constructor(i,o,u){this.text=i,this.icon=o,this.skipFade=u}}class Qi{constructor(){this.invProjMatrix=l.F(),this.viewportMatrix=l.F(),this.circles=[]}}class Ue{constructor(i,o,u,d,_){this.bucketInstanceId=i,this.featureIndex=o,this.sourceLayerIndex=u,this.bucketIndex=d,this.tileID=_}}class Ni{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const o=++this.maxGroupID;this.collisionGroups[i]={ID:o,predicate:u=>u.collisionGroupID===o}}return this.collisionGroups[i]}}function ls(g,i,o,u,d){const{horizontalAlign:_,verticalAlign:w}=l.at(g);return new l.P(-(_-.5)*i+u[0]*d,-(w-.5)*o+u[1]*d)}function ks(g,i,o,u,d,_){const{x1:w,x2:M,y1:A,y2:C,anchorPointX:z,anchorPointY:O}=g,V=new l.P(i,o);return u&&V._rotate(d?_:-_),{x1:w+V.x,y1:A+V.y,x2:M+V.x,y2:C+V.y,anchorPointX:z,anchorPointY:O}}class qs{constructor(i,o,u,d,_){this.transform=i.clone(),this.terrain=o,this.collisionIndex=new Ne(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Ni(d),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,o,u,d){const _=u.getBucket(o),w=u.latestFeatureIndex;if(!_||!w||o.id!==_.layerIds[0])return;const M=u.collisionBoxArray,A=_.layers[0].layout,C=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),z=u.tileSize/l.W,O=this.transform.calculatePosMatrix(u.tileID.toUnwrapped()),V=A.get("text-pitch-alignment")==="map",Z=A.get("text-rotation-alignment")==="map",W=ze(u,1,this.transform.zoom),J=Be(O,V,Z,this.transform,W);let j=null;if(V){const xt=Rn(O,V,Z,this.transform,W);j=l.K([],this.transform.labelPlaneMatrix,xt)}this.retainedQueryData[_.bucketInstanceId]=new Ue(_.bucketInstanceId,w,_.sourceLayerIndex,_.index,u.tileID);const lt={bucket:_,layout:A,posMatrix:O,textLabelPlaneMatrix:J,labelToScreenMatrix:j,scale:C,textPixelRatio:z,holdingForFade:u.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:l.ag(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(d)for(const xt of _.sortKeyRanges){const{sortKey:et,symbolInstanceStart:pt,symbolInstanceEnd:bt}=xt;i.push({sortKey:et,symbolInstanceStart:pt,symbolInstanceEnd:bt,parameters:lt})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:lt})}attemptAnchorPlacement(i,o,u,d,_,w,M,A,C,z,O,V,Z,W,J,j){const lt=l.ap[i.textAnchor],xt=[i.textOffset0,i.textOffset1],et=ls(lt,u,d,xt,_),pt=this.collisionIndex.placeCollisionBox(ks(o,et.x,et.y,w,M,this.transform.angle),O,A,C,z.predicate,j);if((!J||this.collisionIndex.placeCollisionBox(ks(J,et.x,et.y,w,M,this.transform.angle),O,A,C,z.predicate,j).box.length!==0)&&pt.box.length>0){let bt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID].text&&(bt=this.prevPlacement.variableOffsets[V.crossTileID].anchor),V.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[V.crossTileID]={textOffset:xt,width:u,height:d,anchor:lt,textBoxScale:_,prevAnchor:bt},this.markUsedJustification(Z,lt,V,W),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,W,V),this.placedOrientations[V.crossTileID]=W),{shift:et,placedGlyphBoxes:pt}}}placeLayerBucketPart(i,o,u){const{bucket:d,layout:_,posMatrix:w,textLabelPlaneMatrix:M,labelToScreenMatrix:A,textPixelRatio:C,holdingForFade:z,collisionBoxArray:O,partiallyEvaluatedTextSize:V,collisionGroup:Z}=i.parameters,W=_.get("text-optional"),J=_.get("icon-optional"),j=l.aq(_,"text-overlap","text-allow-overlap"),lt=j==="always",xt=l.aq(_,"icon-overlap","icon-allow-overlap"),et=xt==="always",pt=_.get("text-rotation-alignment")==="map",bt=_.get("text-pitch-alignment")==="map",wt=_.get("icon-text-fit")!=="none",St=_.get("symbol-z-order")==="viewport-y",Bt=lt&&(et||!d.hasIconData()||J),Ot=et&&(lt||!d.hasTextData()||W);!d.collisionArrays&&O&&d.deserializeCollisionBoxes(O);const Wt=this.retainedQueryData[d.bucketInstanceId].tileID,Xt=this.terrain?(Qt,Ee)=>this.terrain.getElevation(Wt,Qt,Ee):null,$e=(Qt,Ee)=>{var Ve,ei;if(o[Qt.crossTileID])return;if(z)return void(this.placements[Qt.crossTileID]=new Ci(!1,!1,!1));let Ce=!1,qe=!1,He=!0,Ui=null,mi={box:null,offscreen:null},rr={box:null,offscreen:null},cs=null,Oi=null,hs=null,nr=0,qr=0,gn=0;Ee.textFeatureIndex?nr=Ee.textFeatureIndex:Qt.useRuntimeCollisionCircles&&(nr=Qt.featureIndex),Ee.verticalTextFeatureIndex&&(qr=Ee.verticalTextFeatureIndex);const ao=Ee.textBox;if(ao){const es=is=>{let Bi=l.ah.horizontal;if(d.allowVerticalPlacement&&!is&&this.prevPlacement){const yr=this.prevPlacement.placedOrientations[Qt.crossTileID];yr&&(this.placedOrientations[Qt.crossTileID]=yr,Bi=yr,this.markUsedOrientation(d,Bi,Qt))}return Bi},Fi=(is,Bi)=>{if(d.allowVerticalPlacement&&Qt.numVerticalGlyphVertices>0&&Ee.verticalTextBox){for(const yr of d.writingModes)if(yr===l.ah.vertical?(mi=Bi(),rr=mi):mi=is(),mi&&mi.box&&mi.box.length)break}else mi=is()},ki=Qt.textAnchorOffsetStartIndex,_r=Qt.textAnchorOffsetEndIndex;if(_r===ki){const is=(Bi,yr)=>{const ss=this.collisionIndex.placeCollisionBox(Bi,j,C,w,Z.predicate,Xt);return ss&&ss.box&&ss.box.length&&(this.markUsedOrientation(d,yr,Qt),this.placedOrientations[Qt.crossTileID]=yr),ss};Fi(()=>is(ao,l.ah.horizontal),()=>{const Bi=Ee.verticalTextBox;return d.allowVerticalPlacement&&Qt.numVerticalGlyphVertices>0&&Bi?is(Bi,l.ah.vertical):{box:null,offscreen:null}}),es(mi&&mi.box&&mi.box.length)}else{let is=l.ap[(ei=(Ve=this.prevPlacement)===null||Ve===void 0?void 0:Ve.variableOffsets[Qt.crossTileID])===null||ei===void 0?void 0:ei.anchor];const Bi=(ss,Hi,Ec)=>{const Tu=ss.x2-ss.x1,Un=ss.y2-ss.y1,qn=Qt.textBoxScale,hl=wt&&xt==="never"?Hi:null;let yn={box:[],offscreen:!1},Ic=j==="never"?1:2,Au="never";is&&Ic++;for(let Pc=0;Pc<Ic;Pc++){for(let Cc=ki;Cc<_r;Cc++){const ul=d.textAnchorOffsets.get(Cc);if(is&&ul.textAnchor!==is)continue;const Dc=this.attemptAnchorPlacement(ul,ss,Tu,Un,qn,pt,bt,C,w,Z,Au,Qt,d,Ec,hl,Xt);if(Dc&&(yn=Dc.placedGlyphBoxes,yn&&yn.box&&yn.box.length))return Ce=!0,Ui=Dc.shift,yn}is?is=null:Au=j}return yn};Fi(()=>Bi(ao,Ee.iconBox,l.ah.horizontal),()=>{const ss=Ee.verticalTextBox;return d.allowVerticalPlacement&&!(mi&&mi.box&&mi.box.length)&&Qt.numVerticalGlyphVertices>0&&ss?Bi(ss,Ee.verticalIconBox,l.ah.vertical):{box:null,offscreen:null}}),mi&&(Ce=mi.box,He=mi.offscreen);const yr=es(mi&&mi.box);if(!Ce&&this.prevPlacement){const ss=this.prevPlacement.variableOffsets[Qt.crossTileID];ss&&(this.variableOffsets[Qt.crossTileID]=ss,this.markUsedJustification(d,ss.anchor,Qt,yr))}}}if(cs=mi,Ce=cs&&cs.box&&cs.box.length>0,He=cs&&cs.offscreen,Qt.useRuntimeCollisionCircles){const es=d.text.placedSymbolArray.get(Qt.centerJustifiedTextSymbolIndex),Fi=l.ai(d.textSizeData,V,es),ki=_.get("text-padding");Oi=this.collisionIndex.placeCollisionCircles(j,es,d.lineVertexArray,d.glyphOffsetArray,Fi,w,M,A,u,bt,Z.predicate,Qt.collisionCircleDiameter,ki,Xt),Oi.circles.length&&Oi.collisionDetected&&!u&&l.w("Collisions detected, but collision boxes are not shown"),Ce=lt||Oi.circles.length>0&&!Oi.collisionDetected,He=He&&Oi.offscreen}if(Ee.iconFeatureIndex&&(gn=Ee.iconFeatureIndex),Ee.iconBox){const es=Fi=>{const ki=wt&&Ui?ks(Fi,Ui.x,Ui.y,pt,bt,this.transform.angle):Fi;return this.collisionIndex.placeCollisionBox(ki,xt,C,w,Z.predicate,Xt)};rr&&rr.box&&rr.box.length&&Ee.verticalIconBox?(hs=es(Ee.verticalIconBox),qe=hs.box.length>0):(hs=es(Ee.iconBox),qe=hs.box.length>0),He=He&&hs.offscreen}const _n=W||Qt.numHorizontalGlyphVertices===0&&Qt.numVerticalGlyphVertices===0,jr=J||Qt.numIconVertices===0;if(_n||jr?jr?_n||(qe=qe&&Ce):Ce=qe&&Ce:qe=Ce=qe&&Ce,Ce&&cs&&cs.box&&this.collisionIndex.insertCollisionBox(cs.box,j,_.get("text-ignore-placement"),d.bucketInstanceId,rr&&rr.box&&qr?qr:nr,Z.ID),qe&&hs&&this.collisionIndex.insertCollisionBox(hs.box,xt,_.get("icon-ignore-placement"),d.bucketInstanceId,gn,Z.ID),Oi&&(Ce&&this.collisionIndex.insertCollisionCircles(Oi.circles,j,_.get("text-ignore-placement"),d.bucketInstanceId,nr,Z.ID),u)){const es=d.bucketInstanceId;let Fi=this.collisionCircleArrays[es];Fi===void 0&&(Fi=this.collisionCircleArrays[es]=new Qi);for(let ki=0;ki<Oi.circles.length;ki+=4)Fi.circles.push(Oi.circles[ki+0]),Fi.circles.push(Oi.circles[ki+1]),Fi.circles.push(Oi.circles[ki+2]),Fi.circles.push(Oi.collisionDetected?1:0)}if(Qt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(d.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Qt.crossTileID]=new Ci(Ce||Bt,qe||Ot,He||d.justReloaded),o[Qt.crossTileID]=!0};if(St){if(i.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Qt=d.getSortedSymbolIndexes(this.transform.angle);for(let Ee=Qt.length-1;Ee>=0;--Ee){const Ve=Qt[Ee];$e(d.symbolInstances.get(Ve),d.collisionArrays[Ve])}}else for(let Qt=i.symbolInstanceStart;Qt<i.symbolInstanceEnd;Qt++)$e(d.symbolInstances.get(Qt),d.collisionArrays[Qt]);if(u&&d.bucketInstanceId in this.collisionCircleArrays){const Qt=this.collisionCircleArrays[d.bucketInstanceId];l.ar(Qt.invProjMatrix,w),Qt.viewportMatrix=this.collisionIndex.getViewportMatrix()}d.justReloaded=!1}markUsedJustification(i,o,u,d){let _;_=d===l.ah.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[l.as(o)];const w=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const M of w)M>=0&&(i.text.placedSymbolArray.get(M).crossTileID=_>=0&&M!==_?0:u.crossTileID)}markUsedOrientation(i,o,u){const d=o===l.ah.horizontal||o===l.ah.horizontalOnly?o:0,_=o===l.ah.vertical?o:0,w=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const M of w)i.text.placedSymbolArray.get(M).placedOrientation=d;u.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let u=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const d=o?o.symbolFadeChange(i):1,_=o?o.opacities:{},w=o?o.variableOffsets:{},M=o?o.placedOrientations:{};for(const A in this.placements){const C=this.placements[A],z=_[A];z?(this.opacities[A]=new yi(z,d,C.text,C.icon),u=u||C.text!==z.text.placed||C.icon!==z.icon.placed):(this.opacities[A]=new yi(null,d,C.text,C.icon,C.skipFade),u=u||C.text||C.icon)}for(const A in _){const C=_[A];if(!this.opacities[A]){const z=new yi(C,d,!1,!1);z.isHidden()||(this.opacities[A]=z,u=u||C.text.placed||C.icon.placed)}}for(const A in w)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=w[A]);for(const A in M)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=M[A]);if(o&&o.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");u?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:i)}updateLayerOpacities(i,o){const u={};for(const d of o){const _=d.getBucket(i);_&&d.latestFeatureIndex&&i.id===_.layerIds[0]&&this.updateBucketOpacities(_,u,d.collisionBoxArray)}}updateBucketOpacities(i,o,u){i.hasTextData()&&(i.text.opacityVertexArray.clear(),i.text.hasVisibleVertices=!1),i.hasIconData()&&(i.icon.opacityVertexArray.clear(),i.icon.hasVisibleVertices=!1),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const d=i.layers[0],_=d.layout,w=new yi(null,0,!1,!1,!0),M=_.get("text-allow-overlap"),A=_.get("icon-allow-overlap"),C=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),z=_.get("text-rotation-alignment")==="map",O=_.get("text-pitch-alignment")==="map",V=_.get("icon-text-fit")!=="none",Z=new yi(null,0,M&&(A||!i.hasIconData()||_.get("icon-optional")),A&&(M||!i.hasTextData()||_.get("text-optional")),!0);!i.collisionArrays&&u&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(u);const W=(J,j,lt)=>{for(let xt=0;xt<j/4;xt++)J.opacityVertexArray.emplaceBack(lt);J.hasVisibleVertices=J.hasVisibleVertices||lt!==Ba};for(let J=0;J<i.symbolInstances.length;J++){const j=i.symbolInstances.get(J),{numHorizontalGlyphVertices:lt,numVerticalGlyphVertices:xt,crossTileID:et}=j;let pt=this.opacities[et];o[et]?pt=w:pt||(pt=Z,this.opacities[et]=pt),o[et]=!0;const bt=j.numIconVertices>0,wt=this.placedOrientations[j.crossTileID],St=wt===l.ah.vertical,Bt=wt===l.ah.horizontal||wt===l.ah.horizontalOnly;if(lt>0||xt>0){const Ot=js(pt.text);W(i.text,lt,St?Ba:Ot),W(i.text,xt,Bt?Ba:Ot);const Wt=pt.text.isHidden();[j.rightJustifiedTextSymbolIndex,j.centerJustifiedTextSymbolIndex,j.leftJustifiedTextSymbolIndex].forEach(Qt=>{Qt>=0&&(i.text.placedSymbolArray.get(Qt).hidden=Wt||St?1:0)}),j.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(j.verticalPlacedTextSymbolIndex).hidden=Wt||Bt?1:0);const Xt=this.variableOffsets[j.crossTileID];Xt&&this.markUsedJustification(i,Xt.anchor,j,wt);const $e=this.placedOrientations[j.crossTileID];$e&&(this.markUsedJustification(i,"left",j,$e),this.markUsedOrientation(i,$e,j))}if(bt){const Ot=js(pt.icon),Wt=!(V&&j.verticalPlacedIconSymbolIndex&&St);j.placedIconSymbolIndex>=0&&(W(i.icon,j.numIconVertices,Wt?Ot:Ba),i.icon.placedSymbolArray.get(j.placedIconSymbolIndex).hidden=pt.icon.isHidden()),j.verticalPlacedIconSymbolIndex>=0&&(W(i.icon,j.numVerticalIconVertices,Wt?Ba:Ot),i.icon.placedSymbolArray.get(j.verticalPlacedIconSymbolIndex).hidden=pt.icon.isHidden())}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Ot=i.collisionArrays[J];if(Ot){let Wt=new l.P(0,0);if(Ot.textBox||Ot.verticalTextBox){let $e=!0;if(C){const Qt=this.variableOffsets[et];Qt?(Wt=ls(Qt.anchor,Qt.width,Qt.height,Qt.textOffset,Qt.textBoxScale),z&&Wt._rotate(O?this.transform.angle:-this.transform.angle)):$e=!1}Ot.textBox&&vs(i.textCollisionBox.collisionVertexArray,pt.text.placed,!$e||St,Wt.x,Wt.y),Ot.verticalTextBox&&vs(i.textCollisionBox.collisionVertexArray,pt.text.placed,!$e||Bt,Wt.x,Wt.y)}const Xt=!!(!Bt&&Ot.verticalIconBox);Ot.iconBox&&vs(i.iconCollisionBox.collisionVertexArray,pt.icon.placed,Xt,V?Wt.x:0,V?Wt.y:0),Ot.verticalIconBox&&vs(i.iconCollisionBox.collisionVertexArray,pt.icon.placed,!Xt,V?Wt.x:0,V?Wt.y:0)}}}if(i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.text.opacityVertexArray.length!==i.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${i.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${i.text.layoutVertexArray.length}) / 4`);if(i.icon.opacityVertexArray.length!==i.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${i.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${i.icon.layoutVertexArray.length}) / 4`);if(i.bucketInstanceId in this.collisionCircleArrays){const J=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=J.invProjMatrix,i.placementViewportMatrix=J.viewportMatrix,i.collisionCircleArray=J.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,o){const u=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*u>i}setStale(){this.stale=!0}}function vs(g,i,o,u,d){g.emplaceBack(i?1:0,o?1:0,u||0,d||0),g.emplaceBack(i?1:0,o?1:0,u||0,d||0),g.emplaceBack(i?1:0,o?1:0,u||0,d||0),g.emplaceBack(i?1:0,o?1:0,u||0,d||0)}const Br=Math.pow(2,25),Uh=Math.pow(2,24),cf=Math.pow(2,17),fi=Math.pow(2,16),Kl=Math.pow(2,9),Xl=Math.pow(2,8),er=Math.pow(2,1);function js(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const i=g.placed?1:0,o=Math.floor(127*g.opacity);return o*Br+i*Uh+o*cf+i*fi+o*Kl+i*Xl+o*er+i}const Ba=0;class mr{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&!i.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,o,u,d,_){const w=this._bucketParts;for(;this._currentTileIndex<i.length;)if(o.getBucketParts(w,d,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((M,A)=>M.sortKey-A.sortKey));this._currentPartIndex<w.length;)if(o.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,_())return!0;return!1}}class gr{constructor(i,o,u,d,_,w,M,A){this.placement=new qs(i,o,w,M,A),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(i,o,u){const d=P.now(),_=()=>!this._forceFullPlacement&&P.now()-d>2;for(;this._currentPlacementIndex>=0;){const w=o[i[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=M)&&(!w.maxzoom||w.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new mr(w)),this._inProgressLayer.continuePlacement(u[w.source],this.placement,this._showCollisionBoxes,w,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const ia=512/l.W/2;class To{constructor(i,o,u){this.tileID=i,this.bucketInstanceId=u,this._symbolsByKey={};const d=new Map;for(let _=0;_<o.length;_++){const w=o.get(_),M=w.key,A=d.get(M);A?A.push(w):d.set(M,[w])}for(const[_,w]of d){const M={positions:w.map(A=>({x:Math.floor(A.anchorX*ia),y:Math.floor(A.anchorY*ia)})),crossTileIDs:w.map(A=>A.crossTileID)};if(M.positions.length>128){const A=new l.au(M.positions.length,16,Uint16Array);for(const{x:C,y:z}of M.positions)A.add(C,z);A.finish(),delete M.positions,M.index=A}this._symbolsByKey[_]=M}}getScaledCoordinates(i,o){const{x:u,y:d,z:_}=this.tileID.canonical,{x:w,y:M,z:A}=o.canonical,C=ia/Math.pow(2,A-_),z=(M*l.W+i.anchorY)*C,O=d*l.W*ia;return{x:Math.floor((w*l.W+i.anchorX)*C-u*l.W*ia),y:Math.floor(z-O)}}findMatches(i,o,u){const d=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z);for(let _=0;_<i.length;_++){const w=i.get(_);if(w.crossTileID)continue;const M=this._symbolsByKey[w.key];if(!M)continue;const A=this.getScaledCoordinates(w,o);if(M.index){const C=M.index.range(A.x-d,A.y-d,A.x+d,A.y+d).sort();for(const z of C){const O=M.crossTileIDs[z];if(!u[O]){u[O]=!0,w.crossTileID=O;break}}}else if(M.positions)for(let C=0;C<M.positions.length;C++){const z=M.positions[C],O=M.crossTileIDs[C];if(Math.abs(z.x-A.x)<=d&&Math.abs(z.y-A.y)<=d&&!u[O]){u[O]=!0,w.crossTileID=O;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:i})=>i)}}class ts{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Na{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const o=Math.round((i-this.lng)/360);if(o!==0)for(const u in this.indexes){const d=this.indexes[u],_={};for(const w in d){const M=d[w];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+o),_[M.tileID.key]=M}this.indexes[u]=_}this.lng=i}addBucket(i,o,u){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let _=0;_<o.symbolInstances.length;_++)o.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const d=this.usedCrossTileIDs[i.overscaledZ];for(const _ in this.indexes){const w=this.indexes[_];if(Number(_)>i.overscaledZ)for(const M in w){const A=w[M];A.tileID.isChildOf(i)&&A.findMatches(o.symbolInstances,i,d)}else{const M=w[i.scaledTo(Number(_)).key];M&&M.findMatches(o.symbolInstances,i,d)}}for(let _=0;_<o.symbolInstances.length;_++){const w=o.symbolInstances.get(_);w.crossTileID||(w.crossTileID=u.generate(),d[w.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new To(i,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(i,o){for(const u of o.getCrossTileIDsLists())for(const d of u)delete this.usedCrossTileIDs[i][d]}removeStaleBuckets(i){let o=!1;for(const u in this.indexes){const d=this.indexes[u];for(const _ in d)i[d[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,d[_]),delete d[_],o=!0)}return o}}class hn{constructor(){this.layerIndexes={},this.crossTileIDs=new ts,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,o,u){let d=this.layerIndexes[i.id];d===void 0&&(d=this.layerIndexes[i.id]=new Na);let _=!1;const w={};d.handleWrapJump(u);for(const M of o){const A=M.getBucket(i);A&&i.id===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(M.tileID,A,this.crossTileIDs)&&(_=!0),w[A.bucketInstanceId]=!0)}return d.removeStaleBuckets(w)&&(_=!0),_}pruneUnusedLayers(i){const o={};i.forEach(u=>{o[u]=!0});for(const u in this.layerIndexes)o[u]||delete this.layerIndexes[u]}}const Li=(g,i)=>l.t(g,i&&i.filter(o=>o.identifier!=="source.canvas")),Ao=l.av();class ir extends l.E{constructor(i,o={}){super(),this._rtlPluginLoaded=()=>{for(const u in this.sourceCaches){const d=this.sourceCaches[u].getSource().type;d!=="vector"&&d!=="geojson"||this.sourceCaches[u].reload()}},this.map=i,this.dispatcher=new ce(Rt(),i._getMapId()),this.dispatcher.registerMessageHandler("GG",(u,d)=>this.getGlyphs(u,d)),this.dispatcher.registerMessageHandler("GI",(u,d)=>this.getImages(u,d)),this.imageManager=new De,this.imageManager.setEventedParent(this),this.glyphManager=new Le(i._requestManager,o.localIdeographFontFamily),this.lineAtlas=new Ei(256,512),this.crossTileSymbolIndex=new hn,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",l.ax()),zt().on(Pe,this._rtlPluginLoaded),this.on("data",u=>{if(u.dataType!=="source"||u.sourceDataType!=="metadata")return;const d=this.sourceCaches[u.sourceId];if(!d)return;const _=d.getSource();if(_&&_.vectorLayerIds)for(const w in this._layers){const M=this._layers[w];M.source===_.id&&this._validateLayer(M)}})}loadURL(i,o={},u){this.fire(new l.k("dataloading",{dataType:"style"})),o.validate=typeof o.validate!="boolean"||o.validate;const d=this.map._requestManager.transformRequest(i,"Style");this._loadStyleRequest=new AbortController,l.h(d,this._loadStyleRequest).then(_=>{this._loadStyleRequest=null,this._load(_.data,o,u)}).catch(_=>{this._loadStyleRequest=null,_&&this.fire(new l.j(_))})}loadJSON(i,o={},u){this.fire(new l.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,P.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,o.validate=o.validate!==!1,this._load(i,o,u)}).catch(()=>{})}loadEmpty(){this.fire(new l.k("dataloading",{dataType:"style"})),this._load(Ao,{validate:!1})}_load(i,o,u){var d;const _=o.transformStyle?o.transformStyle(u,i):i;if(!o.validate||!Li(this,l.x(_))){this._loaded=!0,this.stylesheet=_;for(const w in _.sources)this.addSource(w,_.sources[w],{validate:!1});_.sprite?this._loadSprite(_.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(_.glyphs),this._createLayers(),this.light=new Ds(this.stylesheet.light),this.map.setTerrain((d=this.stylesheet.terrain)!==null&&d!==void 0?d:null),this.fire(new l.k("data",{dataType:"style"})),this.fire(new l.k("style.load"))}}_createLayers(){const i=l.ay(this.stylesheet.layers);this.dispatcher.broadcast("SL",i),this._order=i.map(o=>o.id),this._layers={},this._serializedLayers=null;for(const o of i){const u=l.az(o);u.setEventedParent(this,{layer:{id:o.id}}),this._layers[o.id]=u}}_loadSprite(i,o=!1,u=void 0){let d;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(_,w,M,A){return l._(this,void 0,void 0,function*(){const C=Gt(_),z=M>1?"@2x":"",O={},V={};for(const{id:Z,url:W}of C){const J=w.transformRequest(w.normalizeSpriteURL(W,z,".json"),"SpriteJSON");O[Z]=l.h(J,A);const j=w.transformRequest(w.normalizeSpriteURL(W,z,".png"),"SpriteImage");V[Z]=ht.getImage(j,A)}return yield Promise.all([...Object.values(O),...Object.values(V)]),function(Z,W){return l._(this,void 0,void 0,function*(){const J={};for(const j in Z){J[j]={};const lt=P.getImageCanvasContext((yield W[j]).data),xt=(yield Z[j]).data;for(const et in xt){const{width:pt,height:bt,x:wt,y:St,sdf:Bt,pixelRatio:Ot,stretchX:Wt,stretchY:Xt,content:$e}=xt[et];J[j][et]={data:null,pixelRatio:Ot,sdf:Bt,stretchX:Wt,stretchY:Xt,content:$e,spriteData:{width:pt,height:bt,x:wt,y:St,context:lt}}}}return J})}(O,V)})}(i,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(_=>{if(this._spriteRequest=null,_)for(const w in _){this._spritesImagesIds[w]=[];const M=this._spritesImagesIds[w]?this._spritesImagesIds[w].filter(A=>!(A in _)):[];for(const A of M)this.imageManager.removeImage(A),this._changedImages[A]=!0;for(const A in _[w]){const C=w==="default"?A:`${w}:${A}`;this._spritesImagesIds[w].push(C),C in this.imageManager.images?this.imageManager.updateImage(C,_[w][A],!1):this.imageManager.addImage(C,_[w][A]),o&&(this._changedImages[C]=!0)}}}).catch(_=>{this._spriteRequest=null,d=_,this.fire(new l.j(d))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),o&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"})),u&&u(d)})}_unloadSprite(){for(const i of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(i),this._changedImages[i]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}_validateLayer(i){const o=this.sourceCaches[i.source];if(!o)return;const u=i.sourceLayer;if(!u)return;const d=o.getSource();(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(u)===-1)&&this.fire(new l.j(new Error(`Source layer "${u}" does not exist on source "${d.id}" as specified by style layer "${i.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this.sourceCaches)if(!this.sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(i){const o=this._serializedAllLayers();if(!i||i.length===0)return Object.values(o);const u=[];for(const d of i)o[d]&&u.push(o[d]);return u}_serializedAllLayers(){let i=this._serializedLayers;if(i)return i;i=this._serializedLayers={};const o=Object.keys(this._layers);for(const u of o){const d=this._layers[u];d.type!=="custom"&&(i[u]=d.serialize())}return i}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const i in this.sourceCaches)if(this.sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(i){if(!this._loaded)return;const o=this._changed;if(o){const d=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(d.length||_.length)&&this._updateWorkerLayers(d,_);for(const w in this._updatedSources){const M=this._updatedSources[w];if(M==="reload")this._reloadSource(w);else{if(M!=="clear")throw new Error(`Invalid action ${M}`);this._clearSource(w)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(i);this.light.updateTransitions(i),this._resetUpdates()}const u={};for(const d in this.sourceCaches){const _=this.sourceCaches[d];u[d]=_.used,_.used=!1}for(const d of this._order){const _=this._layers[d];_.recalculate(i,this._availableImages),!_.isHidden(i.zoom)&&_.source&&(this.sourceCaches[_.source].used=!0)}for(const d in u){const _=this.sourceCaches[d];!!u[d]!=!!_.used&&_.fire(new l.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:d}))}this.light.recalculate(i),this.z=i.zoom,o&&this.fire(new l.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const i in this.sourceCaches)this.sourceCaches[i].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(i,o){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(i),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(i,o={}){var u;this._checkLoaded();const d=this.serialize();if(i=o.transformStyle?o.transformStyle(d,i):i,((u=o.validate)===null||u===void 0||u)&&Li(this,l.x(i)))return!1;(i=l.aA(i)).layers=l.ay(i.layers);const _=l.aB(d,i),w=this._getOperationsToPerform(_);if(w.unimplemented.length>0)throw new Error(`Unimplemented: ${w.unimplemented.join(", ")}.`);if(w.operations.length===0)return!1;for(const M of w.operations)M();return this.stylesheet=i,this._serializedLayers=null,!0}_getOperationsToPerform(i){const o=[],u=[];for(const d of i)switch(d.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":o.push(()=>this.addLayer.apply(this,d.args));break;case"removeLayer":o.push(()=>this.removeLayer.apply(this,d.args));break;case"setPaintProperty":o.push(()=>this.setPaintProperty.apply(this,d.args));break;case"setLayoutProperty":o.push(()=>this.setLayoutProperty.apply(this,d.args));break;case"setFilter":o.push(()=>this.setFilter.apply(this,d.args));break;case"addSource":o.push(()=>this.addSource.apply(this,d.args));break;case"removeSource":o.push(()=>this.removeSource.apply(this,d.args));break;case"setLayerZoomRange":o.push(()=>this.setLayerZoomRange.apply(this,d.args));break;case"setLight":o.push(()=>this.setLight.apply(this,d.args));break;case"setGeoJSONSourceData":o.push(()=>this.setGeoJSONSourceData.apply(this,d.args));break;case"setGlyphs":o.push(()=>this.setGlyphs.apply(this,d.args));break;case"setSprite":o.push(()=>this.setSprite.apply(this,d.args));break;case"setTerrain":o.push(()=>this.map.setTerrain.apply(this,d.args));break;case"setTransition":o.push(()=>{});break;default:u.push(d.command)}return{operations:o,unimplemented:u}}addImage(i,o){if(this.getImage(i))return this.fire(new l.j(new Error(`An image named "${i}" already exists.`)));this.imageManager.addImage(i,o),this._afterImageUpdated(i)}updateImage(i,o){this.imageManager.updateImage(i,o)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){if(!this.getImage(i))return this.fire(new l.j(new Error(`An image named "${i}" does not exist.`)));this.imageManager.removeImage(i),this._afterImageUpdated(i)}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(i,o,u={}){if(this._checkLoaded(),this.sourceCaches[i]!==void 0)throw new Error(`Source "${i}" already exists.`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(l.x.source,`sources.${i}`,o,null,u))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const d=this.sourceCaches[i]=new as(i,o,this.dispatcher);d.style=this,d.setEventedParent(this,()=>({isSourceLoaded:d.loaded(),source:d.serialize(),sourceId:i})),d.onAdd(this.map),this._changed=!0}removeSource(i){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error("There is no source with this ID");for(const u in this._layers)if(this._layers[u].source===i)return this.fire(new l.j(new Error(`Source "${i}" cannot be removed while layer "${u}" is using it.`)));const o=this.sourceCaches[i];delete this.sourceCaches[i],delete this._updatedSources[i],o.fire(new l.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:i})),o.setEventedParent(null),o.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(i,o){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error(`There is no source with this ID=${i}`);const u=this.sourceCaches[i].getSource();if(u.type!=="geojson")throw new Error(`geojsonSource.type is ${u.type}, which is !== 'geojson`);u.setData(o),this._changed=!0}getSource(i){return this.sourceCaches[i]&&this.sourceCaches[i].getSource()}addLayer(i,o,u={}){this._checkLoaded();const d=i.id;if(this.getLayer(d))return void this.fire(new l.j(new Error(`Layer "${d}" already exists on this map.`)));let _;if(i.type==="custom"){if(Li(this,l.aC(i)))return;_=l.az(i)}else{if("source"in i&&typeof i.source=="object"&&(this.addSource(d,i.source),i=l.aA(i),i=l.e(i,{source:d})),this._validate(l.x.layer,`layers.${d}`,i,{arrayIndex:-1},u))return;_=l.az(i),this._validateLayer(_),_.setEventedParent(this,{layer:{id:d}})}const w=o?this._order.indexOf(o):this._order.length;if(o&&w===-1)this.fire(new l.j(new Error(`Cannot add layer "${d}" before non-existing layer "${o}".`)));else{if(this._order.splice(w,0,d),this._layerOrderChanged=!0,this._layers[d]=_,this._removedLayers[d]&&_.source&&_.type!=="custom"){const M=this._removedLayers[d];delete this._removedLayers[d],M.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",this.sourceCaches[_.source].pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map)}}moveLayer(i,o){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new l.j(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===o)return;const u=this._order.indexOf(i);this._order.splice(u,1);const d=o?this._order.indexOf(o):this._order.length;o&&d===-1?this.fire(new l.j(new Error(`Cannot move layer "${i}" before non-existing layer "${o}".`))):(this._order.splice(d,0,i),this._layerOrderChanged=!0)}removeLayer(i){this._checkLoaded();const o=this._layers[i];if(!o)return void this.fire(new l.j(new Error(`Cannot remove non-existing layer "${i}".`)));o.setEventedParent(null);const u=this._order.indexOf(i);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=o,delete this._layers[i],this._serializedLayers&&delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],o.onRemove&&o.onRemove(this.map)}getLayer(i){return this._layers[i]}getLayersOrder(){return[...this._order]}hasLayer(i){return i in this._layers}setLayerZoomRange(i,o,u){this._checkLoaded();const d=this.getLayer(i);d?d.minzoom===o&&d.maxzoom===u||(o!=null&&(d.minzoom=o),u!=null&&(d.maxzoom=u),this._updateLayer(d)):this.fire(new l.j(new Error(`Cannot set the zoom range of non-existing layer "${i}".`)))}setFilter(i,o,u={}){this._checkLoaded();const d=this.getLayer(i);if(d){if(!l.aD(d.filter,o))return o==null?(d.filter=void 0,void this._updateLayer(d)):void(this._validate(l.x.filter,`layers.${d.id}.filter`,o,null,u)||(d.filter=l.aA(o),this._updateLayer(d)))}else this.fire(new l.j(new Error(`Cannot filter non-existing layer "${i}".`)))}getFilter(i){return l.aA(this.getLayer(i).filter)}setLayoutProperty(i,o,u,d={}){this._checkLoaded();const _=this.getLayer(i);_?l.aD(_.getLayoutProperty(o),u)||(_.setLayoutProperty(o,u,d),this._updateLayer(_)):this.fire(new l.j(new Error(`Cannot style non-existing layer "${i}".`)))}getLayoutProperty(i,o){const u=this.getLayer(i);if(u)return u.getLayoutProperty(o);this.fire(new l.j(new Error(`Cannot get style of non-existing layer "${i}".`)))}setPaintProperty(i,o,u,d={}){this._checkLoaded();const _=this.getLayer(i);_?l.aD(_.getPaintProperty(o),u)||(_.setPaintProperty(o,u,d)&&this._updateLayer(_),this._changed=!0,this._updatedPaintProps[i]=!0,this._serializedLayers=null):this.fire(new l.j(new Error(`Cannot style non-existing layer "${i}".`)))}getPaintProperty(i,o){return this.getLayer(i).getPaintProperty(o)}setFeatureState(i,o){this._checkLoaded();const u=i.source,d=i.sourceLayer,_=this.sourceCaches[u];if(_===void 0)return void this.fire(new l.j(new Error(`The source '${u}' does not exist in the map's style.`)));const w=_.getSource().type;w==="geojson"&&d?this.fire(new l.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):w!=="vector"||d?(i.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),_.setFeatureState(d,i.id,o)):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(i,o){this._checkLoaded();const u=i.source,d=this.sourceCaches[u];if(d===void 0)return void this.fire(new l.j(new Error(`The source '${u}' does not exist in the map's style.`)));const _=d.getSource().type,w=_==="vector"?i.sourceLayer:void 0;_!=="vector"||w?o&&typeof i.id!="string"&&typeof i.id!="number"?this.fire(new l.j(new Error("A feature id is required to remove its specific state property."))):d.removeFeatureState(w,i.id,o):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(i){this._checkLoaded();const o=i.source,u=i.sourceLayer,d=this.sourceCaches[o];if(d!==void 0)return d.getSource().type!=="vector"||u?(i.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),d.getFeatureState(u,i.id)):void this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.j(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const i=l.aE(this.sourceCaches,_=>_.serialize()),o=this._serializeByIds(this._order),u=this.map.getTerrain()||void 0,d=this.stylesheet;return l.aF({version:d.version,name:d.name,metadata:d.metadata,light:d.light,center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch,sprite:d.sprite,glyphs:d.glyphs,transition:d.transition,sources:i,layers:o,terrain:u},_=>_!==void 0)}_updateLayer(i){this._updatedLayers[i.id]=!0,i.source&&!this._updatedSources[i.source]&&this.sourceCaches[i.source].getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",this.sourceCaches[i.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(i){const o=w=>this._layers[w].type==="fill-extrusion",u={},d=[];for(let w=this._order.length-1;w>=0;w--){const M=this._order[w];if(o(M)){u[M]=w;for(const A of i){const C=A[M];if(C)for(const z of C)d.push(z)}}}d.sort((w,M)=>M.intersectionZ-w.intersectionZ);const _=[];for(let w=this._order.length-1;w>=0;w--){const M=this._order[w];if(o(M))for(let A=d.length-1;A>=0;A--){const C=d[A].feature;if(u[C.layer.id]<w)break;_.push(C),d.pop()}else for(const A of i){const C=A[M];if(C)for(const z of C)_.push(z.feature)}}return _}queryRenderedFeatures(i,o,u){o&&o.filter&&this._validate(l.x.filter,"queryRenderedFeatures.filter",o.filter,null,o);const d={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new l.j(new Error("parameters.layers must be an Array."))),[];for(const M of o.layers){const A=this._layers[M];if(!A)return this.fire(new l.j(new Error(`The layer '${M}' does not exist in the map's style and cannot be queried for features.`))),[];d[A.source]=!0}}const _=[];o.availableImages=this._availableImages;const w=this._serializedAllLayers();for(const M in this.sourceCaches)o.layers&&!d[M]||_.push(ni(this.sourceCaches[M],this._layers,w,i,o,u));return this.placement&&_.push(function(M,A,C,z,O,V,Z){const W={},J=V.queryRenderedSymbols(z),j=[];for(const lt of Object.keys(J).map(Number))j.push(Z[lt]);j.sort(ai);for(const lt of j){const xt=lt.featureIndex.lookupSymbolFeatures(J[lt.bucketInstanceId],A,lt.bucketIndex,lt.sourceLayerIndex,O.filter,O.layers,O.availableImages,M);for(const et in xt){const pt=W[et]=W[et]||[],bt=xt[et];bt.sort((wt,St)=>{const Bt=lt.featureSortOrder;if(Bt){const Ot=Bt.indexOf(wt.featureIndex);return Bt.indexOf(St.featureIndex)-Ot}return St.featureIndex-wt.featureIndex});for(const wt of bt)pt.push(wt)}}for(const lt in W)W[lt].forEach(xt=>{const et=xt.feature,pt=C[M[lt].source].getFeatureState(et.layer["source-layer"],et.id);et.source=et.layer.source,et.layer["source-layer"]&&(et.sourceLayer=et.layer["source-layer"]),et.state=pt});return W}(this._layers,w,this.sourceCaches,i,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(i,o){o&&o.filter&&this._validate(l.x.filter,"querySourceFeatures.filter",o.filter,null,o);const u=this.sourceCaches[i];return u?function(d,_){const w=d.getRenderableIds().map(C=>d.getTileByID(C)),M=[],A={};for(let C=0;C<w.length;C++){const z=w[C],O=z.tileID.canonical.key;A[O]||(A[O]=!0,z.querySourceFeatures(M,_))}return M}(u,o):[]}getLight(){return this.light.getLight()}setLight(i,o={}){this._checkLoaded();const u=this.light.getLight();let d=!1;for(const w in i)if(!l.aD(i[w],u[w])){d=!0;break}if(!d)return;const _={now:P.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,o),this.light.updateTransitions(_)}_validate(i,o,u,d,_={}){return(!_||_.validate!==!1)&&Li(this,i.call(l.x,l.e({key:o,style:this.serialize(),value:u,styleSpec:l.v},d)))}_remove(i=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),zt().off(Pe,this._rtlPluginLoaded);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this.sourceCaches){const u=this.sourceCaches[o];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),i&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(i)}_clearSource(i){this.sourceCaches[i].clearTiles()}_reloadSource(i){this.sourceCaches[i].resume(),this.sourceCaches[i].reload()}_updateSources(i){for(const o in this.sourceCaches)this.sourceCaches[o].update(i,this.map.terrain)}_generateCollisionBoxes(){for(const i in this.sourceCaches)this._reloadSource(i)}_updatePlacement(i,o,u,d,_=!1){let w=!1,M=!1;const A={};for(const C of this._order){const z=this._layers[C];if(z.type!=="symbol")continue;if(!A[z.source]){const V=this.sourceCaches[z.source];A[z.source]=V.getRenderableIds(!0).map(Z=>V.getTileByID(Z)).sort((Z,W)=>W.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(W.tileID)?-1:1))}const O=this.crossTileSymbolIndex.addLayer(z,A[z.source],i.center.lng);w=w||O}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((_=_||this._layerOrderChanged||u===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(P.now(),i.zoom))&&(this.pauseablePlacement=new gr(i,this.map.terrain,this._order,_,o,u,d,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(P.now()),M=!0),w&&this.pauseablePlacement.placement.setStale()),M||w)for(const C of this._order){const z=this._layers[C];z.type==="symbol"&&this.placement.updateLayerOpacities(z,A[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(P.now())}_releaseSymbolFadeTiles(){for(const i in this.sourceCaches)this.sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,o){return l._(this,void 0,void 0,function*(){const u=yield this.imageManager.getImages(o.icons);this._updateTilesForChangedImages();const d=this.sourceCaches[o.source];return d&&d.setDependencies(o.tileID.key,o.type,o.icons),u})}getGlyphs(i,o){return l._(this,void 0,void 0,function*(){const u=yield this.glyphManager.getGlyphs(o.stacks),d=this.sourceCaches[o.source];return d&&d.setDependencies(o.tileID.key,o.type,[""]),u})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(i,o={}){this._checkLoaded(),i&&this._validate(l.x.glyphs,"glyphs",i,null,o)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=i,this.glyphManager.entries={},this.glyphManager.setURL(i))}addSprite(i,o,u={},d){this._checkLoaded();const _=[{id:i,url:o}],w=[...Gt(this.stylesheet.sprite),..._];this._validate(l.x.sprite,"sprite",w,null,u)||(this.stylesheet.sprite=w,this._loadSprite(_,!0,d))}removeSprite(i){this._checkLoaded();const o=Gt(this.stylesheet.sprite);if(o.find(u=>u.id===i)){if(this._spritesImagesIds[i])for(const u of this._spritesImagesIds[i])this.imageManager.removeImage(u),this._changedImages[u]=!0;o.splice(o.findIndex(u=>u.id===i),1),this.stylesheet.sprite=o.length>0?o:void 0,delete this._spritesImagesIds[i],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}else this.fire(new l.j(new Error(`Sprite "${i}" doesn't exists on this map.`)))}getSprite(){return Gt(this.stylesheet.sprite)}setSprite(i,o={},u){this._checkLoaded(),i&&this._validate(l.x.sprite,"sprite",i,null,o)||(this.stylesheet.sprite=i,i?this._loadSprite(i,!0,u):(this._unloadSprite(),u&&u(null)))}}var Eo=l.X([{name:"a_pos",type:"Int16",components:2}]),Nr="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const $a={prelude:pi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:pi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:pi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:pi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:pi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:pi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:pi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:pi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:pi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:pi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:pi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:pi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:pi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:pi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:pi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:pi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:pi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:pi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:pi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:pi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:pi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:pi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:pi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:pi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:pi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:pi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:pi("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Nr),terrainDepth:pi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Nr),terrainCoords:pi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Nr)};function pi(g,i){const o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=i.match(/attribute ([\w]+) ([\w]+)/g),d=g.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=i.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=_?_.concat(d):d,M={};return{fragmentSource:g=g.replace(o,(A,C,z,O,V)=>(M[V]=!0,C==="define"?`
#ifndef HAS_UNIFORM_u_${V}
varying ${z} ${O} ${V};
#else
uniform ${z} ${O} u_${V};
#endif
`:`
#ifdef HAS_UNIFORM_u_${V}
    ${z} ${O} ${V} = u_${V};
#endif
`)),vertexSource:i=i.replace(o,(A,C,z,O,V)=>{const Z=O==="float"?"vec2":"vec4",W=V.match(/color/)?"color":Z;return M[V]?C==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
attribute ${z} ${Z} a_${V};
varying ${z} ${O} ${V};
#else
uniform ${z} ${O} u_${V};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = a_${V};
#else
    ${z} ${O} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = unpack_mix_${W}(a_${V}, u_${V}_t);
#else
    ${z} ${O} ${V} = u_${V};
#endif
`:C==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
attribute ${z} ${Z} a_${V};
#else
uniform ${z} ${O} u_${V};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${z} ${O} ${V} = a_${V};
#else
    ${z} ${O} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${z} ${O} ${V} = unpack_mix_${W}(a_${V}, u_${V}_t);
#else
    ${z} ${O} ${V} = u_${V};
#endif
`}),staticAttributes:u,staticUniforms:w}}class Io{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(i,o,u,d,_,w,M,A,C){this.context=i;let z=this.boundPaintVertexBuffers.length!==d.length;for(let O=0;!z&&O<d.length;O++)this.boundPaintVertexBuffers[O]!==d[O]&&(z=!0);!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==u||z||this.boundIndexBuffer!==_||this.boundVertexOffset!==w||this.boundDynamicVertexBuffer!==M||this.boundDynamicVertexBuffer2!==A||this.boundDynamicVertexBuffer3!==C?this.freshBind(o,u,d,_,w,M,A,C):(i.bindVertexArray.set(this.vao),M&&M.bind(),_&&_.dynamicDraw&&_.bind(),A&&A.bind(),C&&C.bind())}freshBind(i,o,u,d,_,w,M,A){const C=i.numAttributes,z=this.context,O=z.gl;this.vao&&this.destroy(),this.vao=z.createVertexArray(),z.bindVertexArray.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=d,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=M,this.boundDynamicVertexBuffer3=A,o.enableAttributes(O,i);for(const V of u)V.enableAttributes(O,i);w&&w.enableAttributes(O,i),M&&M.enableAttributes(O,i),A&&A.enableAttributes(O,i),o.bind(),o.setVertexAttribPointers(O,i,_);for(const V of u)V.bind(),V.setVertexAttribPointers(O,i,_);w&&(w.bind(),w.setVertexAttribPointers(O,i,_)),d&&d.bind(),M&&(M.bind(),M.setVertexAttribPointers(O,i,_)),A&&(A.bind(),A.setVertexAttribPointers(O,i,_)),z.currentNumAttributes=C}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function sa(g){const i=[];for(let o=0;o<g.length;o++){if(g[o]===null)continue;const u=g[o].split(" ");i.push(u.pop())}return i}class un{constructor(i,o,u,d,_,w){const M=i.gl;this.program=M.createProgram();const A=sa(o.staticAttributes),C=u?u.getBinderAttributes():[],z=A.concat(C),O=$a.prelude.staticUniforms?sa($a.prelude.staticUniforms):[],V=o.staticUniforms?sa(o.staticUniforms):[],Z=u?u.getBinderUniforms():[],W=O.concat(V).concat(Z),J=[];for(const wt of W)J.indexOf(wt)<0&&J.push(wt);const j=u?u.defines():[];_&&j.push("#define OVERDRAW_INSPECTOR;"),w&&j.push("#define TERRAIN3D;");const lt=j.concat($a.prelude.fragmentSource,o.fragmentSource).join(`
`),xt=j.concat($a.prelude.vertexSource,o.vertexSource).join(`
`),et=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);if(M.shaderSource(et,lt),M.compileShader(et),!M.getShaderParameter(et,M.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${M.getShaderInfoLog(et)}`);M.attachShader(this.program,et);const pt=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);if(M.shaderSource(pt,xt),M.compileShader(pt),!M.getShaderParameter(pt,M.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${M.getShaderInfoLog(pt)}`);M.attachShader(this.program,pt),this.attributes={};const bt={};this.numAttributes=z.length;for(let wt=0;wt<this.numAttributes;wt++)z[wt]&&(M.bindAttribLocation(this.program,wt,z[wt]),this.attributes[z[wt]]=wt);if(M.linkProgram(this.program),!M.getProgramParameter(this.program,M.LINK_STATUS))throw new Error(`Program failed to link: ${M.getProgramInfoLog(this.program)}`);M.deleteShader(pt),M.deleteShader(et);for(let wt=0;wt<J.length;wt++){const St=J[wt];if(St&&!bt[St]){const Bt=M.getUniformLocation(this.program,St);Bt&&(bt[St]=Bt)}}this.fixedUniforms=d(i,bt),this.terrainUniforms=((wt,St)=>({u_depth:new l.aG(wt,St.u_depth),u_terrain:new l.aG(wt,St.u_terrain),u_terrain_dim:new l.aH(wt,St.u_terrain_dim),u_terrain_matrix:new l.aI(wt,St.u_terrain_matrix),u_terrain_unpack:new l.aJ(wt,St.u_terrain_unpack),u_terrain_exaggeration:new l.aH(wt,St.u_terrain_exaggeration)}))(i,bt),this.binderUniforms=u?u.getUniforms(i,bt):[]}draw(i,o,u,d,_,w,M,A,C,z,O,V,Z,W,J,j,lt,xt){const et=i.gl;if(this.failedToCreate)return;if(i.program.set(this.program),i.setDepthMode(u),i.setStencilMode(d),i.setColorMode(_),i.setCullFace(w),A){i.activeTexture.set(et.TEXTURE2),et.bindTexture(et.TEXTURE_2D,A.depthTexture),i.activeTexture.set(et.TEXTURE3),et.bindTexture(et.TEXTURE_2D,A.texture);for(const bt in this.terrainUniforms)this.terrainUniforms[bt].set(A[bt])}for(const bt in this.fixedUniforms)this.fixedUniforms[bt].set(M[bt]);J&&J.setUniforms(i,this.binderUniforms,Z,{zoom:W});let pt=0;switch(o){case et.LINES:pt=2;break;case et.TRIANGLES:pt=3;break;case et.LINE_STRIP:pt=1}for(const bt of V.get()){const wt=bt.vaos||(bt.vaos={});(wt[C]||(wt[C]=new Io)).bind(i,this,z,J?J.getPaintVertexBuffers():[],O,bt.vertexOffset,j,lt,xt),et.drawElements(o,bt.primitiveLength*pt,et.UNSIGNED_SHORT,bt.primitiveOffset*pt*2)}}}function Po(g,i,o){const u=1/ze(o,1,i.transform.tileZoom),d=Math.pow(2,o.tileID.overscaledZ),_=o.tileSize*Math.pow(2,i.transform.tileZoom)/d,w=_*(o.tileID.canonical.x+o.tileID.wrap*d),M=_*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[u,g.fromScale,g.toScale],u_fade:g.t,u_pixel_coord_upper:[w>>16,M>>16],u_pixel_coord_lower:[65535&w,65535&M]}}const Va=(g,i,o,u)=>{const d=i.style.light,_=d.properties.get("position"),w=[_.x,_.y,_.z],M=function(){var C=new l.A(9);return l.A!=Float32Array&&(C[1]=0,C[2]=0,C[3]=0,C[5]=0,C[6]=0,C[7]=0),C[0]=1,C[4]=1,C[8]=1,C}();d.properties.get("anchor")==="viewport"&&function(C,z){var O=Math.sin(z),V=Math.cos(z);C[0]=V,C[1]=O,C[2]=0,C[3]=-O,C[4]=V,C[5]=0,C[6]=0,C[7]=0,C[8]=1}(M,-i.transform.angle),function(C,z,O){var V=z[0],Z=z[1],W=z[2];C[0]=V*O[0]+Z*O[3]+W*O[6],C[1]=V*O[1]+Z*O[4]+W*O[7],C[2]=V*O[2]+Z*O[5]+W*O[8]}(w,w,M);const A=d.properties.get("color");return{u_matrix:g,u_lightpos:w,u_lightintensity:d.properties.get("intensity"),u_lightcolor:[A.r,A.g,A.b],u_vertical_gradient:+o,u_opacity:u}},hf=(g,i,o,u,d,_,w)=>l.e(Va(g,i,o,u),Po(_,i,w),{u_height_factor:-Math.pow(2,d.overscaledZ)/w.tileSize/8}),qh=g=>({u_matrix:g}),Co=(g,i,o,u)=>l.e(qh(g),Po(o,i,u)),uf=(g,i)=>({u_matrix:g,u_world:i}),jh=(g,i,o,u,d)=>l.e(Co(g,i,o,u),{u_world:d}),df=(g,i,o,u)=>{const d=g.transform;let _,w;if(u.paint.get("circle-pitch-alignment")==="map"){const M=ze(o,1,d.zoom);_=!0,w=[M,M]}else _=!1,w=d.pixelsToGLUnits;return{u_camera_to_center_distance:d.cameraToCenterDistance,u_scale_with_map:+(u.paint.get("circle-pitch-scale")==="map"),u_matrix:g.translatePosMatrix(i.posMatrix,o,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_pitch_with_map:+_,u_device_pixel_ratio:g.pixelRatio,u_extrude_scale:w}},Gh=(g,i,o)=>{const u=ze(o,1,i.zoom),d=Math.pow(2,i.zoom-o.tileID.overscaledZ),_=o.tileID.overscaleFactor();return{u_matrix:g,u_camera_to_center_distance:i.cameraToCenterDistance,u_pixels_to_tile_units:u,u_extrude_scale:[i.pixelsToGLUnits[0]/(u*d),i.pixelsToGLUnits[1]/(u*d)],u_overscale_factor:_}},Hh=(g,i,o=1)=>({u_matrix:g,u_color:i,u_overlay:0,u_overlay_scale:o}),Do=g=>({u_matrix:g}),Wh=(g,i,o,u)=>({u_matrix:g,u_extrude_scale:ze(i,1,o),u_intensity:u});function Zh(g,i){const o=Math.pow(2,i.canonical.z),u=i.canonical.y;return[new l.Y(0,u/o).toLngLat().lat,new l.Y(0,(u+1)/o).toLngLat().lat]}const ko=(g,i,o,u)=>{const d=g.transform;return{u_matrix:Ua(g,i,o,u),u_ratio:1/ze(i,1,d.zoom),u_device_pixel_ratio:g.pixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},Kh=(g,i,o,u,d)=>l.e(ko(g,i,o,d),{u_image:0,u_image_height:u}),zn=(g,i,o,u,d)=>{const _=g.transform,w=sr(i,_);return{u_matrix:Ua(g,i,o,d),u_texsize:i.imageAtlasTexture.size,u_ratio:1/ze(i,1,_.zoom),u_device_pixel_ratio:g.pixelRatio,u_image:0,u_scale:[w,u.fromScale,u.toScale],u_fade:u.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},Ro=(g,i,o,u,d,_)=>{const w=g.lineAtlas,M=sr(i,g.transform),A=o.layout.get("line-cap")==="round",C=w.getDash(u.from,A),z=w.getDash(u.to,A),O=C.width*d.fromScale,V=z.width*d.toScale;return l.e(ko(g,i,o,_),{u_patternscale_a:[M/O,-C.height/2],u_patternscale_b:[M/V,-z.height/2],u_sdfgamma:w.width/(256*Math.min(O,V)*g.pixelRatio)/2,u_image:0,u_tex_y_a:C.y,u_tex_y_b:z.y,u_mix:d.t})};function sr(g,i){return 1/ze(g,1,i.tileZoom)}function Ua(g,i,o,u){return g.translatePosMatrix(u?u.posMatrix:i.tileID.posMatrix,i,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const zo=(g,i,o,u,d)=>{return{u_matrix:g,u_tl_parent:i,u_scale_parent:o,u_buffer_scale:1,u_fade_t:u.mix,u_opacity:u.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:(w=d.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(_=d.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:qa(d.paint.get("raster-hue-rotate"))};var _,w};function qa(g){g*=Math.PI/180;const i=Math.sin(g),o=Math.cos(g);return[(2*o+1)/3,(-Math.sqrt(3)*i-o+1)/3,(Math.sqrt(3)*i-o+1)/3]}const ja=(g,i,o,u,d,_,w,M,A,C)=>{const z=d.transform;return{u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:z.cameraToCenterDistance,u_pitch:z.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:z.width/z.height,u_fade_change:d.options.fadeDuration?d.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:w,u_coord_matrix:M,u_is_text:+A,u_pitch_with_map:+u,u_texsize:C,u_texture:0}},Ga=(g,i,o,u,d,_,w,M,A,C,z)=>{const O=d.transform;return l.e(ja(g,i,o,u,d,_,w,M,A,C),{u_gamma_scale:u?Math.cos(O._pitch)*O.cameraToCenterDistance:1,u_device_pixel_ratio:d.pixelRatio,u_is_halo:+z})},Ha=(g,i,o,u,d,_,w,M,A,C)=>l.e(Ga(g,i,o,u,d,_,w,M,!0,A,!0),{u_texsize_icon:C,u_texture_icon:1}),ff=(g,i,o)=>({u_matrix:g,u_opacity:i,u_color:o}),pf=(g,i,o,u,d,_)=>l.e(function(w,M,A,C){const z=A.imageManager.getPattern(w.from.toString()),O=A.imageManager.getPattern(w.to.toString()),{width:V,height:Z}=A.imageManager.getPixelSize(),W=Math.pow(2,C.tileID.overscaledZ),J=C.tileSize*Math.pow(2,A.transform.tileZoom)/W,j=J*(C.tileID.canonical.x+C.tileID.wrap*W),lt=J*C.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:O.tl,u_pattern_br_b:O.br,u_texsize:[V,Z],u_mix:M.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:O.displaySize,u_scale_a:M.fromScale,u_scale_b:M.toScale,u_tile_units_to_pixels:1/ze(C,1,A.transform.tileZoom),u_pixel_coord_upper:[j>>16,lt>>16],u_pixel_coord_lower:[65535&j,65535&lt]}}(u,_,o,d),{u_matrix:g,u_opacity:i}),Xh={fillExtrusion:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_lightpos:new l.aK(g,i.u_lightpos),u_lightintensity:new l.aH(g,i.u_lightintensity),u_lightcolor:new l.aK(g,i.u_lightcolor),u_vertical_gradient:new l.aH(g,i.u_vertical_gradient),u_opacity:new l.aH(g,i.u_opacity)}),fillExtrusionPattern:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_lightpos:new l.aK(g,i.u_lightpos),u_lightintensity:new l.aH(g,i.u_lightintensity),u_lightcolor:new l.aK(g,i.u_lightcolor),u_vertical_gradient:new l.aH(g,i.u_vertical_gradient),u_height_factor:new l.aH(g,i.u_height_factor),u_image:new l.aG(g,i.u_image),u_texsize:new l.aL(g,i.u_texsize),u_pixel_coord_upper:new l.aL(g,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(g,i.u_pixel_coord_lower),u_scale:new l.aK(g,i.u_scale),u_fade:new l.aH(g,i.u_fade),u_opacity:new l.aH(g,i.u_opacity)}),fill:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix)}),fillPattern:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_image:new l.aG(g,i.u_image),u_texsize:new l.aL(g,i.u_texsize),u_pixel_coord_upper:new l.aL(g,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(g,i.u_pixel_coord_lower),u_scale:new l.aK(g,i.u_scale),u_fade:new l.aH(g,i.u_fade)}),fillOutline:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_world:new l.aL(g,i.u_world)}),fillOutlinePattern:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_world:new l.aL(g,i.u_world),u_image:new l.aG(g,i.u_image),u_texsize:new l.aL(g,i.u_texsize),u_pixel_coord_upper:new l.aL(g,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(g,i.u_pixel_coord_lower),u_scale:new l.aK(g,i.u_scale),u_fade:new l.aH(g,i.u_fade)}),circle:(g,i)=>({u_camera_to_center_distance:new l.aH(g,i.u_camera_to_center_distance),u_scale_with_map:new l.aG(g,i.u_scale_with_map),u_pitch_with_map:new l.aG(g,i.u_pitch_with_map),u_extrude_scale:new l.aL(g,i.u_extrude_scale),u_device_pixel_ratio:new l.aH(g,i.u_device_pixel_ratio),u_matrix:new l.aI(g,i.u_matrix)}),collisionBox:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_camera_to_center_distance:new l.aH(g,i.u_camera_to_center_distance),u_pixels_to_tile_units:new l.aH(g,i.u_pixels_to_tile_units),u_extrude_scale:new l.aL(g,i.u_extrude_scale),u_overscale_factor:new l.aH(g,i.u_overscale_factor)}),collisionCircle:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_inv_matrix:new l.aI(g,i.u_inv_matrix),u_camera_to_center_distance:new l.aH(g,i.u_camera_to_center_distance),u_viewport_size:new l.aL(g,i.u_viewport_size)}),debug:(g,i)=>({u_color:new l.aM(g,i.u_color),u_matrix:new l.aI(g,i.u_matrix),u_overlay:new l.aG(g,i.u_overlay),u_overlay_scale:new l.aH(g,i.u_overlay_scale)}),clippingMask:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix)}),heatmap:(g,i)=>({u_extrude_scale:new l.aH(g,i.u_extrude_scale),u_intensity:new l.aH(g,i.u_intensity),u_matrix:new l.aI(g,i.u_matrix)}),heatmapTexture:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_world:new l.aL(g,i.u_world),u_image:new l.aG(g,i.u_image),u_color_ramp:new l.aG(g,i.u_color_ramp),u_opacity:new l.aH(g,i.u_opacity)}),hillshade:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_image:new l.aG(g,i.u_image),u_latrange:new l.aL(g,i.u_latrange),u_light:new l.aL(g,i.u_light),u_shadow:new l.aM(g,i.u_shadow),u_highlight:new l.aM(g,i.u_highlight),u_accent:new l.aM(g,i.u_accent)}),hillshadePrepare:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_image:new l.aG(g,i.u_image),u_dimension:new l.aL(g,i.u_dimension),u_zoom:new l.aH(g,i.u_zoom),u_unpack:new l.aJ(g,i.u_unpack)}),line:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_ratio:new l.aH(g,i.u_ratio),u_device_pixel_ratio:new l.aH(g,i.u_device_pixel_ratio),u_units_to_pixels:new l.aL(g,i.u_units_to_pixels)}),lineGradient:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_ratio:new l.aH(g,i.u_ratio),u_device_pixel_ratio:new l.aH(g,i.u_device_pixel_ratio),u_units_to_pixels:new l.aL(g,i.u_units_to_pixels),u_image:new l.aG(g,i.u_image),u_image_height:new l.aH(g,i.u_image_height)}),linePattern:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_texsize:new l.aL(g,i.u_texsize),u_ratio:new l.aH(g,i.u_ratio),u_device_pixel_ratio:new l.aH(g,i.u_device_pixel_ratio),u_image:new l.aG(g,i.u_image),u_units_to_pixels:new l.aL(g,i.u_units_to_pixels),u_scale:new l.aK(g,i.u_scale),u_fade:new l.aH(g,i.u_fade)}),lineSDF:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_ratio:new l.aH(g,i.u_ratio),u_device_pixel_ratio:new l.aH(g,i.u_device_pixel_ratio),u_units_to_pixels:new l.aL(g,i.u_units_to_pixels),u_patternscale_a:new l.aL(g,i.u_patternscale_a),u_patternscale_b:new l.aL(g,i.u_patternscale_b),u_sdfgamma:new l.aH(g,i.u_sdfgamma),u_image:new l.aG(g,i.u_image),u_tex_y_a:new l.aH(g,i.u_tex_y_a),u_tex_y_b:new l.aH(g,i.u_tex_y_b),u_mix:new l.aH(g,i.u_mix)}),raster:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_tl_parent:new l.aL(g,i.u_tl_parent),u_scale_parent:new l.aH(g,i.u_scale_parent),u_buffer_scale:new l.aH(g,i.u_buffer_scale),u_fade_t:new l.aH(g,i.u_fade_t),u_opacity:new l.aH(g,i.u_opacity),u_image0:new l.aG(g,i.u_image0),u_image1:new l.aG(g,i.u_image1),u_brightness_low:new l.aH(g,i.u_brightness_low),u_brightness_high:new l.aH(g,i.u_brightness_high),u_saturation_factor:new l.aH(g,i.u_saturation_factor),u_contrast_factor:new l.aH(g,i.u_contrast_factor),u_spin_weights:new l.aK(g,i.u_spin_weights)}),symbolIcon:(g,i)=>({u_is_size_zoom_constant:new l.aG(g,i.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(g,i.u_is_size_feature_constant),u_size_t:new l.aH(g,i.u_size_t),u_size:new l.aH(g,i.u_size),u_camera_to_center_distance:new l.aH(g,i.u_camera_to_center_distance),u_pitch:new l.aH(g,i.u_pitch),u_rotate_symbol:new l.aG(g,i.u_rotate_symbol),u_aspect_ratio:new l.aH(g,i.u_aspect_ratio),u_fade_change:new l.aH(g,i.u_fade_change),u_matrix:new l.aI(g,i.u_matrix),u_label_plane_matrix:new l.aI(g,i.u_label_plane_matrix),u_coord_matrix:new l.aI(g,i.u_coord_matrix),u_is_text:new l.aG(g,i.u_is_text),u_pitch_with_map:new l.aG(g,i.u_pitch_with_map),u_texsize:new l.aL(g,i.u_texsize),u_texture:new l.aG(g,i.u_texture)}),symbolSDF:(g,i)=>({u_is_size_zoom_constant:new l.aG(g,i.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(g,i.u_is_size_feature_constant),u_size_t:new l.aH(g,i.u_size_t),u_size:new l.aH(g,i.u_size),u_camera_to_center_distance:new l.aH(g,i.u_camera_to_center_distance),u_pitch:new l.aH(g,i.u_pitch),u_rotate_symbol:new l.aG(g,i.u_rotate_symbol),u_aspect_ratio:new l.aH(g,i.u_aspect_ratio),u_fade_change:new l.aH(g,i.u_fade_change),u_matrix:new l.aI(g,i.u_matrix),u_label_plane_matrix:new l.aI(g,i.u_label_plane_matrix),u_coord_matrix:new l.aI(g,i.u_coord_matrix),u_is_text:new l.aG(g,i.u_is_text),u_pitch_with_map:new l.aG(g,i.u_pitch_with_map),u_texsize:new l.aL(g,i.u_texsize),u_texture:new l.aG(g,i.u_texture),u_gamma_scale:new l.aH(g,i.u_gamma_scale),u_device_pixel_ratio:new l.aH(g,i.u_device_pixel_ratio),u_is_halo:new l.aG(g,i.u_is_halo)}),symbolTextAndIcon:(g,i)=>({u_is_size_zoom_constant:new l.aG(g,i.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(g,i.u_is_size_feature_constant),u_size_t:new l.aH(g,i.u_size_t),u_size:new l.aH(g,i.u_size),u_camera_to_center_distance:new l.aH(g,i.u_camera_to_center_distance),u_pitch:new l.aH(g,i.u_pitch),u_rotate_symbol:new l.aG(g,i.u_rotate_symbol),u_aspect_ratio:new l.aH(g,i.u_aspect_ratio),u_fade_change:new l.aH(g,i.u_fade_change),u_matrix:new l.aI(g,i.u_matrix),u_label_plane_matrix:new l.aI(g,i.u_label_plane_matrix),u_coord_matrix:new l.aI(g,i.u_coord_matrix),u_is_text:new l.aG(g,i.u_is_text),u_pitch_with_map:new l.aG(g,i.u_pitch_with_map),u_texsize:new l.aL(g,i.u_texsize),u_texsize_icon:new l.aL(g,i.u_texsize_icon),u_texture:new l.aG(g,i.u_texture),u_texture_icon:new l.aG(g,i.u_texture_icon),u_gamma_scale:new l.aH(g,i.u_gamma_scale),u_device_pixel_ratio:new l.aH(g,i.u_device_pixel_ratio),u_is_halo:new l.aG(g,i.u_is_halo)}),background:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_opacity:new l.aH(g,i.u_opacity),u_color:new l.aM(g,i.u_color)}),backgroundPattern:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_opacity:new l.aH(g,i.u_opacity),u_image:new l.aG(g,i.u_image),u_pattern_tl_a:new l.aL(g,i.u_pattern_tl_a),u_pattern_br_a:new l.aL(g,i.u_pattern_br_a),u_pattern_tl_b:new l.aL(g,i.u_pattern_tl_b),u_pattern_br_b:new l.aL(g,i.u_pattern_br_b),u_texsize:new l.aL(g,i.u_texsize),u_mix:new l.aH(g,i.u_mix),u_pattern_size_a:new l.aL(g,i.u_pattern_size_a),u_pattern_size_b:new l.aL(g,i.u_pattern_size_b),u_scale_a:new l.aH(g,i.u_scale_a),u_scale_b:new l.aH(g,i.u_scale_b),u_pixel_coord_upper:new l.aL(g,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(g,i.u_pixel_coord_lower),u_tile_units_to_pixels:new l.aH(g,i.u_tile_units_to_pixels)}),terrain:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_texture:new l.aG(g,i.u_texture),u_ele_delta:new l.aH(g,i.u_ele_delta)}),terrainDepth:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_ele_delta:new l.aH(g,i.u_ele_delta)}),terrainCoords:(g,i)=>({u_matrix:new l.aI(g,i.u_matrix),u_texture:new l.aG(g,i.u_texture),u_terrain_coords_id:new l.aH(g,i.u_terrain_coords_id),u_ele_delta:new l.aH(g,i.u_ele_delta)})};class mf{constructor(i,o,u){this.context=i;const d=i.gl;this.buffer=d.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const o=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ln={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Lo{constructor(i,o,u,d){this.length=o.length,this.attributes=u,this.itemSize=o.bytesPerElement,this.dynamicDraw=d,this.context=i;const _=i.gl;this.buffer=_.createBuffer(),i.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){if(i.length!==this.length)throw new Error(`Length of new data is ${i.length}, which doesn't match current length of ${this.length}`);const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,o){for(let u=0;u<this.attributes.length;u++){const d=o.attributes[this.attributes[u].name];d!==void 0&&i.enableVertexAttribArray(d)}}setVertexAttribPointers(i,o,u){for(let d=0;d<this.attributes.length;d++){const _=this.attributes[d],w=o.attributes[_.name];w!==void 0&&i.vertexAttribPointer(w,_.components,i[Ln[_.type]],!1,this.itemSize,_.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Rs=new WeakMap;function Es(g){var i;if(Rs.has(g))return Rs.get(g);{const o=(i=g.getParameter(g.VERSION))===null||i===void 0?void 0:i.startsWith("WebGL 2.0");return Rs.set(g,o),o}}class oi{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Oo extends oi{getDefault(){return l.aO.transparent}set(i){const o=this.current;(i.r!==o.r||i.g!==o.g||i.b!==o.b||i.a!==o.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Fo extends oi{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class Yl extends oi{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class Jl extends oi{getDefault(){return[!0,!0,!0,!0]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Bo extends oi{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class Ql extends oi{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class tc extends oi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const o=this.current;(i.func!==o.func||i.ref!==o.ref||i.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class No extends oi{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Yh extends oi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=i,this.dirty=!1}}class Jh extends oi{getDefault(){return[0,1]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class ra extends oi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=i,this.dirty=!1}}class gf extends oi{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class _f extends oi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.BLEND):o.disable(o.BLEND),this.current=i,this.dirty=!1}}class yf extends oi{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class vf extends oi{getDefault(){return l.aO.transparent}set(i){const o=this.current;(i.r!==o.r||i.g!==o.g||i.b!==o.b||i.a!==o.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class xf extends oi{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class bf extends oi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=i,this.dirty=!1}}class ec extends oi{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class $o extends oi{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class ic extends oi{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class sc extends oi{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class na extends oi{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Qh extends oi{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class tu extends oi{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class rc extends oi{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class On extends oi{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class eu extends oi{getDefault(){return null}set(i){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class aa extends oi{getDefault(){return null}set(i){var o;if(i===this.current&&!this.dirty)return;const u=this.gl;Es(u)?u.bindVertexArray(i):(o=u.getExtension("OES_vertex_array_object"))===null||o===void 0||o.bindVertexArrayOES(i),this.current=i,this.dirty=!1}}class oa extends oi{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class iu extends oi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class nc extends oi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class ri extends oi{constructor(i,o){super(i),this.context=i,this.parent=o}getDefault(){return null}}class Vo extends ri{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class wf extends ri{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class su extends ri{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Wa{constructor(i,o,u,d,_){this.context=i,this.width=o,this.height=u;const w=i.gl,M=this.framebuffer=w.createFramebuffer();if(this.colorAttachment=new Vo(i,M),d)this.depthAttachment=_?new su(i,M):new wf(i,M);else if(_)throw new Error("Stencil cannot be set without depth");if(w.checkFramebufferStatus(w.FRAMEBUFFER)!==w.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const i=this.context.gl,o=this.colorAttachment.get();if(o&&i.deleteTexture(o),this.depthAttachment){const u=this.depthAttachment.get();u&&i.deleteRenderbuffer(u)}i.deleteFramebuffer(this.framebuffer)}}class Ki{constructor(i,o,u){this.blendFunction=i,this.blendColor=o,this.mask=u}}Ki.Replace=[1,0],Ki.disabled=new Ki(Ki.Replace,l.aO.transparent,[!1,!1,!1,!1]),Ki.unblended=new Ki(Ki.Replace,l.aO.transparent,[!0,!0,!0,!0]),Ki.alphaBlended=new Ki([1,771],l.aO.transparent,[!0,!0,!0,!0]);class Mf{constructor(i){var o,u;if(this.gl=i,this.clearColor=new Oo(this),this.clearDepth=new Fo(this),this.clearStencil=new Yl(this),this.colorMask=new Jl(this),this.depthMask=new Bo(this),this.stencilMask=new Ql(this),this.stencilFunc=new tc(this),this.stencilOp=new No(this),this.stencilTest=new Yh(this),this.depthRange=new Jh(this),this.depthTest=new ra(this),this.depthFunc=new gf(this),this.blend=new _f(this),this.blendFunc=new yf(this),this.blendColor=new vf(this),this.blendEquation=new xf(this),this.cullFace=new bf(this),this.cullFaceSide=new ec(this),this.frontFace=new $o(this),this.program=new ic(this),this.activeTexture=new sc(this),this.viewport=new na(this),this.bindFramebuffer=new Qh(this),this.bindRenderbuffer=new tu(this),this.bindTexture=new rc(this),this.bindVertexBuffer=new On(this),this.bindElementBuffer=new eu(this),this.bindVertexArray=new aa(this),this.pixelStoreUnpack=new oa(this),this.pixelStoreUnpackPremultiplyAlpha=new iu(this),this.pixelStoreUnpackFlipY=new nc(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),Es(i)){this.HALF_FLOAT=i.HALF_FLOAT;const d=i.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(o=i.RGBA16F)!==null&&o!==void 0?o:d==null?void 0:d.RGBA16F_EXT,this.RGB16F=(u=i.RGB16F)!==null&&u!==void 0?u:d==null?void 0:d.RGB16F_EXT,i.getExtension("EXT_color_buffer_float")}else{i.getExtension("EXT_color_buffer_half_float"),i.getExtension("OES_texture_half_float_linear");const d=i.getExtension("OES_texture_half_float");this.HALF_FLOAT=d==null?void 0:d.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,o){return new mf(this,i,o)}createVertexBuffer(i,o,u){return new Lo(this,i,o,u)}createRenderbuffer(i,o,u){const d=this.gl,_=d.createRenderbuffer();return this.bindRenderbuffer.set(_),d.renderbufferStorage(d.RENDERBUFFER,i,o,u),this.bindRenderbuffer.set(null),_}createFramebuffer(i,o,u,d){return new Wa(this,i,o,u,d)}clear({color:i,depth:o,stencil:u}){const d=this.gl;let _=0;i&&(_|=d.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(_|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),u!==void 0&&(_|=d.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),d.clear(_)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){l.aD(i.blendFunction,Ki.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}createVertexArray(){var i;return Es(this.gl)?this.gl.createVertexArray():(i=this.gl.getExtension("OES_vertex_array_object"))===null||i===void 0?void 0:i.createVertexArrayOES()}deleteVertexArray(i){var o;return Es(this.gl)?this.gl.deleteVertexArray(i):(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.deleteVertexArrayOES(i)}unbindVAO(){this.bindVertexArray.set(null)}}class ti{constructor(i,o,u){this.func=i,this.mask=o,this.range=u}}ti.ReadOnly=!1,ti.ReadWrite=!0,ti.disabled=new ti(519,ti.ReadOnly,[0,1]);const ac=7680;class Ti{constructor(i,o,u,d,_,w){this.test=i,this.ref=o,this.mask=u,this.fail=d,this.depthFail=_,this.pass=w}}Ti.disabled=new Ti({func:519,mask:0},0,0,ac,ac,ac);class xi{constructor(i,o,u){this.enable=i,this.mode=o,this.frontFace=u}}let Fn;function Uo(g,i,o,u,d,_,w){const M=g.context,A=M.gl,C=g.useProgram("collisionBox"),z=[];let O=0,V=0;for(let et=0;et<u.length;et++){const pt=u[et],bt=i.getTile(pt),wt=bt.getBucket(o);if(!wt)continue;let St=pt.posMatrix;d[0]===0&&d[1]===0||(St=g.translatePosMatrix(pt.posMatrix,bt,d,_));const Bt=w?wt.textCollisionBox:wt.iconCollisionBox,Ot=wt.collisionCircleArray;if(Ot.length>0){const Wt=l.F(),Xt=St;l.aP(Wt,wt.placementInvProjMatrix,g.transform.glCoordMatrix),l.aP(Wt,Wt,wt.placementViewportMatrix),z.push({circleArray:Ot,circleOffset:V,transform:Xt,invTransform:Wt,coord:pt}),O+=Ot.length/4,V=O}Bt&&C.draw(M,A.LINES,ti.disabled,Ti.disabled,g.colorModeForRenderPass(),xi.disabled,Gh(St,g.transform,bt),g.style.map.terrain&&g.style.map.terrain.getTerrainData(pt),o.id,Bt.layoutVertexBuffer,Bt.indexBuffer,Bt.segments,null,g.transform.zoom,null,null,Bt.collisionVertexBuffer)}if(!w||!z.length)return;const Z=g.useProgram("collisionCircle"),W=new l.aQ;W.resize(4*O),W._trim();let J=0;for(const et of z)for(let pt=0;pt<et.circleArray.length/4;pt++){const bt=4*pt,wt=et.circleArray[bt+0],St=et.circleArray[bt+1],Bt=et.circleArray[bt+2],Ot=et.circleArray[bt+3];W.emplace(J++,wt,St,Bt,Ot,0),W.emplace(J++,wt,St,Bt,Ot,1),W.emplace(J++,wt,St,Bt,Ot,2),W.emplace(J++,wt,St,Bt,Ot,3)}(!Fn||Fn.length<2*O)&&(Fn=function(et){const pt=2*et,bt=new l.aS;bt.resize(pt),bt._trim();for(let wt=0;wt<pt;wt++){const St=6*wt;bt.uint16[St+0]=4*wt+0,bt.uint16[St+1]=4*wt+1,bt.uint16[St+2]=4*wt+2,bt.uint16[St+3]=4*wt+2,bt.uint16[St+4]=4*wt+3,bt.uint16[St+5]=4*wt+0}return bt}(O));const j=M.createIndexBuffer(Fn,!0),lt=M.createVertexBuffer(W,l.aR.members,!0);for(const et of z){const pt={u_matrix:et.transform,u_inv_matrix:et.invTransform,u_camera_to_center_distance:(xt=g.transform).cameraToCenterDistance,u_viewport_size:[xt.width,xt.height]};Z.draw(M,A.TRIANGLES,ti.disabled,Ti.disabled,g.colorModeForRenderPass(),xi.disabled,pt,g.style.map.terrain&&g.style.map.terrain.getTerrainData(et.coord),o.id,lt,j,l.$.simpleSegment(0,2*et.circleOffset,et.circleArray.length,et.circleArray.length/2),null,g.transform.zoom,null,null,null)}var xt;lt.destroy(),j.destroy()}xi.disabled=new xi(!1,1029,2305),xi.backCCW=new xi(!0,1029,2305);const oc=l.an(new Float32Array(16));function ru(g,i,o,u,d,_){const{horizontalAlign:w,verticalAlign:M}=l.at(g);return new l.P((-(w-.5)*i/d+u[0])*_,(-(M-.5)*o/d+u[1])*_)}function qo(g,i,o,u,d,_,w,M,A,C,z){const O=g.text.placedSymbolArray,V=g.text.dynamicLayoutVertexArray,Z=g.icon.dynamicLayoutVertexArray,W={};V.clear();for(let J=0;J<O.length;J++){const j=O.get(J),lt=j.hidden||!j.crossTileID||g.allowVerticalPlacement&&!j.placedOrientation?null:u[j.crossTileID];if(lt){const xt=new l.P(j.anchorX,j.anchorY),et=os(xt,o?w:_,z),pt=Y(d.cameraToCenterDistance,et.signedDistanceFromCamera);let bt=l.ai(g.textSizeData,A,j)*pt/l.ao;o&&(bt*=g.tilePixelRatio/M);const{width:wt,height:St,anchor:Bt,textOffset:Ot,textBoxScale:Wt}=lt,Xt=ru(Bt,wt,St,Ot,Wt,bt),$e=o?os(xt.add(Xt),_,z).point:et.point.add(i?Xt.rotate(-d.angle):Xt),Qt=g.allowVerticalPlacement&&j.placedOrientation===l.ah.vertical?Math.PI/2:0;for(let Ee=0;Ee<j.numGlyphs;Ee++)l.aj(V,$e,Qt);C&&j.associatedIconIndex>=0&&(W[j.associatedIconIndex]={shiftedAnchor:$e,angle:Qt})}else Pt(j.numGlyphs,V)}if(C){Z.clear();const J=g.icon.placedSymbolArray;for(let j=0;j<J.length;j++){const lt=J.get(j);if(lt.hidden)Pt(lt.numGlyphs,Z);else{const xt=W[j];if(xt)for(let et=0;et<lt.numGlyphs;et++)l.aj(Z,xt.shiftedAnchor,xt.angle);else Pt(lt.numGlyphs,Z)}}g.icon.dynamicLayoutVertexBuffer.updateData(Z)}g.text.dynamicLayoutVertexBuffer.updateData(V)}function jo(g,i,o){return o.iconsInText&&i?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function Go(g,i,o,u,d,_,w,M,A,C,z,O){const V=g.context,Z=V.gl,W=g.transform,J=M==="map",j=A==="map",lt=M!=="viewport"&&o.layout.get("symbol-placement")!=="point",xt=J&&!j&&!lt,et=!o.layout.get("symbol-sort-key").isConstant();let pt=!1;const bt=g.depthModeForSublayer(0,ti.ReadOnly),wt=o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"),St=[];for(const Bt of u){const Ot=i.getTile(Bt),Wt=Ot.getBucket(o);if(!Wt)continue;const Xt=d?Wt.text:Wt.icon;if(!Xt||!Xt.segments.get().length||!Xt.hasVisibleVertices)continue;const $e=Xt.programConfigurations.get(o.id),Qt=d||Wt.sdfIcons,Ee=d?Wt.textSizeData:Wt.iconSizeData,Ve=j||W.pitch!==0,ei=g.useProgram(jo(Qt,d,Wt),$e),Ce=l.ag(Ee,W.zoom),qe=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Bt);let He,Ui,mi,rr,cs=[0,0],Oi=null;if(d)Ui=Ot.glyphAtlasTexture,mi=Z.LINEAR,He=Ot.glyphAtlasTexture.size,Wt.iconsInText&&(cs=Ot.imageAtlasTexture.size,Oi=Ot.imageAtlasTexture,rr=Ve||g.options.rotating||g.options.zooming||Ee.kind==="composite"||Ee.kind==="camera"?Z.LINEAR:Z.NEAREST);else{const is=o.layout.get("icon-size").constantOr(0)!==1||Wt.iconsNeedLinear;Ui=Ot.imageAtlasTexture,mi=Qt||g.options.rotating||g.options.zooming||is||Ve?Z.LINEAR:Z.NEAREST,He=Ot.imageAtlasTexture.size}const hs=ze(Ot,1,g.transform.zoom),nr=Be(Bt.posMatrix,j,J,g.transform,hs),qr=Rn(Bt.posMatrix,j,J,g.transform,hs),gn=wt&&Wt.hasTextData(),ao=o.layout.get("icon-text-fit")!=="none"&&gn&&Wt.hasIconData();if(lt){const is=g.style.map.terrain?(yr,ss)=>g.style.map.terrain.getElevation(Bt,yr,ss):null,Bi=o.layout.get("text-rotation-alignment")==="map";N(Wt,Bt.posMatrix,g,d,nr,qr,j,C,Bi,is)}const _n=g.translatePosMatrix(Bt.posMatrix,Ot,_,w),jr=lt||d&&wt||ao?oc:nr,es=g.translatePosMatrix(qr,Ot,_,w,!0),Fi=Qt&&o.paint.get(d?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ki;ki=Qt?Wt.iconsInText?Ha(Ee.kind,Ce,xt,j,g,_n,jr,es,He,cs):Ga(Ee.kind,Ce,xt,j,g,_n,jr,es,d,He,!0):ja(Ee.kind,Ce,xt,j,g,_n,jr,es,d,He);const _r={program:ei,buffers:Xt,uniformValues:ki,atlasTexture:Ui,atlasTextureIcon:Oi,atlasInterpolation:mi,atlasInterpolationIcon:rr,isSDF:Qt,hasHalo:Fi};if(et&&Wt.canOverlap){pt=!0;const is=Xt.segments.get();for(const Bi of is)St.push({segments:new l.$([Bi]),sortKey:Bi.sortKey,state:_r,terrainData:qe})}else St.push({segments:Xt.segments,sortKey:0,state:_r,terrainData:qe})}pt&&St.sort((Bt,Ot)=>Bt.sortKey-Ot.sortKey);for(const Bt of St){const Ot=Bt.state;if(V.activeTexture.set(Z.TEXTURE0),Ot.atlasTexture.bind(Ot.atlasInterpolation,Z.CLAMP_TO_EDGE),Ot.atlasTextureIcon&&(V.activeTexture.set(Z.TEXTURE1),Ot.atlasTextureIcon&&Ot.atlasTextureIcon.bind(Ot.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),Ot.isSDF){const Wt=Ot.uniformValues;Ot.hasHalo&&(Wt.u_is_halo=1,nu(Ot.buffers,Bt.segments,o,g,Ot.program,bt,z,O,Wt,Bt.terrainData)),Wt.u_is_halo=0}nu(Ot.buffers,Bt.segments,o,g,Ot.program,bt,z,O,Ot.uniformValues,Bt.terrainData)}}function nu(g,i,o,u,d,_,w,M,A,C){const z=u.context;d.draw(z,z.gl.TRIANGLES,_,w,M,xi.disabled,A,C,o.id,g.layoutVertexBuffer,g.indexBuffer,i,o.paint,u.transform.zoom,g.programConfigurations.get(o.id),g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer)}function Ho(g,i,o,u,d){if(!o||!u||!u.imageAtlas)return;const _=u.imageAtlas.patternPositions;let w=_[o.to.toString()],M=_[o.from.toString()];if(!w&&M&&(w=M),!M&&w&&(M=w),!w||!M){const A=d.getPaintProperty(i);w=_[A],M=_[A]}w&&M&&g.setConstantPatternPositions(w,M)}function au(g,i,o,u,d,_,w){const M=g.context.gl,A="fill-pattern",C=o.paint.get(A),z=C&&C.constantOr(1),O=o.getCrossfadeParameters();let V,Z,W,J,j;w?(Z=z&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",V=M.LINES):(Z=z?"fillPattern":"fill",V=M.TRIANGLES);const lt=C.constantOr(null);for(const xt of u){const et=i.getTile(xt);if(z&&!et.patternsLoaded())continue;const pt=et.getBucket(o);if(!pt)continue;const bt=pt.programConfigurations.get(o.id),wt=g.useProgram(Z,bt),St=g.style.map.terrain&&g.style.map.terrain.getTerrainData(xt);z&&(g.context.activeTexture.set(M.TEXTURE0),et.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),bt.updatePaintBuffers(O)),Ho(bt,A,lt,et,o);const Bt=St?xt:null,Ot=g.translatePosMatrix(Bt?Bt.posMatrix:xt.posMatrix,et,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(w){J=pt.indexBuffer2,j=pt.segments2;const Wt=[M.drawingBufferWidth,M.drawingBufferHeight];W=Z==="fillOutlinePattern"&&z?jh(Ot,g,O,et,Wt):uf(Ot,Wt)}else J=pt.indexBuffer,j=pt.segments,W=z?Co(Ot,g,O,et):qh(Ot);wt.draw(g.context,V,d,g.stencilModeForClipping(xt),_,xi.disabled,W,St,o.id,pt.layoutVertexBuffer,J,j,o.paint,g.transform.zoom,bt)}}function Wo(g,i,o,u,d,_,w){const M=g.context,A=M.gl,C="fill-extrusion-pattern",z=o.paint.get(C),O=z.constantOr(1),V=o.getCrossfadeParameters(),Z=o.paint.get("fill-extrusion-opacity"),W=z.constantOr(null);for(const J of u){const j=i.getTile(J),lt=j.getBucket(o);if(!lt)continue;const xt=g.style.map.terrain&&g.style.map.terrain.getTerrainData(J),et=lt.programConfigurations.get(o.id),pt=g.useProgram(O?"fillExtrusionPattern":"fillExtrusion",et);O&&(g.context.activeTexture.set(A.TEXTURE0),j.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),et.updatePaintBuffers(V)),Ho(et,C,W,j,o);const bt=g.translatePosMatrix(J.posMatrix,j,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),wt=o.paint.get("fill-extrusion-vertical-gradient"),St=O?hf(bt,g,wt,Z,J,V,j):Va(bt,g,wt,Z);pt.draw(M,M.gl.TRIANGLES,d,_,w,xi.backCCW,St,xt,o.id,lt.layoutVertexBuffer,lt.indexBuffer,lt.segments,o.paint,g.transform.zoom,et,g.style.map.terrain&&lt.centroidVertexBuffer)}}function Zo(g,i,o,u,d,_,w){const M=g.context,A=M.gl,C=o.fbo;if(!C)return;const z=g.useProgram("hillshade"),O=g.style.map.terrain&&g.style.map.terrain.getTerrainData(i);M.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,C.colorAttachment.get()),z.draw(M,A.TRIANGLES,d,_,w,xi.disabled,((V,Z,W,J)=>{const j=W.paint.get("hillshade-shadow-color"),lt=W.paint.get("hillshade-highlight-color"),xt=W.paint.get("hillshade-accent-color");let et=W.paint.get("hillshade-illumination-direction")*(Math.PI/180);W.paint.get("hillshade-illumination-anchor")==="viewport"&&(et-=V.transform.angle);const pt=!V.options.moving;return{u_matrix:J?J.posMatrix:V.transform.calculatePosMatrix(Z.tileID.toUnwrapped(),pt),u_image:0,u_latrange:Zh(0,Z.tileID),u_light:[W.paint.get("hillshade-exaggeration"),et],u_shadow:j,u_highlight:lt,u_accent:xt}})(g,o,u,O?i:null),O,u.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments)}function lc(g,i,o,u,d,_){const w=g.context,M=w.gl,A=i.dem;if(A&&A.data){const C=A.dim,z=A.stride,O=A.getPixels();if(w.activeTexture.set(M.TEXTURE1),w.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||g.getTileTexture(z),i.demTexture){const Z=i.demTexture;Z.update(O,{premultiply:!1}),Z.bind(M.NEAREST,M.CLAMP_TO_EDGE)}else i.demTexture=new Dt(w,O,M.RGBA,{premultiply:!1}),i.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE);w.activeTexture.set(M.TEXTURE0);let V=i.fbo;if(!V){const Z=new Dt(w,{width:C,height:C,data:null},M.RGBA);Z.bind(M.LINEAR,M.CLAMP_TO_EDGE),V=i.fbo=w.createFramebuffer(C,C,!0,!1),V.colorAttachment.set(Z.texture)}w.bindFramebuffer.set(V.framebuffer),w.viewport.set([0,0,C,C]),g.useProgram("hillshadePrepare").draw(w,M.TRIANGLES,u,d,_,xi.disabled,((Z,W)=>{const J=W.stride,j=l.F();return l.aN(j,0,l.W,-l.W,0,0,1),l.H(j,j,[0,-l.W,0]),{u_matrix:j,u_image:1,u_dimension:[J,J],u_zoom:Z.overscaledZ,u_unpack:W.getUnpackVector()}})(i.tileID,A),null,o.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments),i.needsHillshadePrepare=!1}}function ou(g,i,o,u,d,_){const w=u.paint.get("raster-fade-duration");if(!_&&w>0){const M=P.now(),A=(M-g.timeAdded)/w,C=i?(M-i.timeAdded)/w:-1,z=o.getSource(),O=d.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),V=!i||Math.abs(i.tileID.overscaledZ-O)>Math.abs(g.tileID.overscaledZ-O),Z=V&&g.refreshedUponExpiration?1:l.ac(V?A:1-C,0,1);return g.refreshedUponExpiration&&A>=1&&(g.refreshedUponExpiration=!1),i?{opacity:1,mix:1-Z}:{opacity:Z,mix:0}}return{opacity:1,mix:0}}const lu=new l.aO(1,0,0,1),Ko=new l.aO(0,1,0,1),cc=new l.aO(0,0,1,1),Sf=new l.aO(1,0,1,1),cu=new l.aO(0,1,1,1);function $i(g,i,o,u){zs(g,0,i+o/2,g.transform.width,o,u)}function dn(g,i,o,u){zs(g,i-o/2,0,o,g.transform.height,u)}function zs(g,i,o,u,d,_){const w=g.context,M=w.gl;M.enable(M.SCISSOR_TEST),M.scissor(i*g.pixelRatio,o*g.pixelRatio,u*g.pixelRatio,d*g.pixelRatio),w.clear({color:_}),M.disable(M.SCISSOR_TEST)}function hc(g,i,o){const u=g.context,d=u.gl,_=o.posMatrix,w=g.useProgram("debug"),M=ti.disabled,A=Ti.disabled,C=g.colorModeForRenderPass(),z="$debug",O=g.style.map.terrain&&g.style.map.terrain.getTerrainData(o);u.activeTexture.set(d.TEXTURE0);const V=i.getTileByID(o.key).latestRawTileData,Z=Math.floor((V&&V.byteLength||0)/1024),W=i.getTile(o).tileSize,J=512/Math.min(W,512)*(o.overscaledZ/g.transform.zoom)*.5;let j=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(j+=` => ${o.overscaledZ}`),function(lt,xt){lt.initDebugOverlayCanvas();const et=lt.debugOverlayCanvas,pt=lt.context.gl,bt=lt.debugOverlayCanvas.getContext("2d");bt.clearRect(0,0,et.width,et.height),bt.shadowColor="white",bt.shadowBlur=2,bt.lineWidth=1.5,bt.strokeStyle="white",bt.textBaseline="top",bt.font="bold 36px Open Sans, sans-serif",bt.fillText(xt,5,5),bt.strokeText(xt,5,5),lt.debugOverlayTexture.update(et),lt.debugOverlayTexture.bind(pt.LINEAR,pt.CLAMP_TO_EDGE)}(g,`${j} ${Z}kB`),w.draw(u,d.TRIANGLES,M,A,Ki.alphaBlended,xi.disabled,Hh(_,l.aO.transparent,J),null,z,g.debugBuffer,g.quadTriangleIndexBuffer,g.debugSegments),w.draw(u,d.LINE_STRIP,M,A,C,xi.disabled,Hh(_,l.aO.red),O,z,g.debugBuffer,g.tileBorderIndexBuffer,g.debugSegments)}function Xo(g,i,o){const u=g.context,d=u.gl,_=g.colorModeForRenderPass(),w=new ti(d.LEQUAL,ti.ReadWrite,g.depthRangeFor3D),M=g.useProgram("terrain"),A=i.getTerrainMesh();u.bindFramebuffer.set(null),u.viewport.set([0,0,g.width,g.height]);for(const C of o){const z=g.renderToTexture.getTexture(C),O=i.getTerrainData(C.tileID);u.activeTexture.set(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,z.texture);const V={u_matrix:g.transform.calculatePosMatrix(C.tileID.toUnwrapped()),u_texture:0,u_ele_delta:i.getMeshFrameDelta(g.transform.zoom)};M.draw(u,d.TRIANGLES,w,Ti.disabled,_,xi.backCCW,V,O,"terrain",A.vertexBuffer,A.indexBuffer,A.segments)}}class hu{constructor(i,o){this.context=new Mf(i),this.transform=o,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=as.maxUnderzooming+as.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new hn}resize(i,o,u){if(this.width=Math.floor(i*u),this.height=Math.floor(o*u),this.pixelRatio=u,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style._order)this.style._layers[d].resize()}setup(){const i=this.context,o=new l.aV;o.emplaceBack(0,0),o.emplaceBack(l.W,0),o.emplaceBack(0,l.W),o.emplaceBack(l.W,l.W),this.tileExtentBuffer=i.createVertexBuffer(o,Eo.members),this.tileExtentSegments=l.$.simpleSegment(0,0,4,2);const u=new l.aV;u.emplaceBack(0,0),u.emplaceBack(l.W,0),u.emplaceBack(0,l.W),u.emplaceBack(l.W,l.W),this.debugBuffer=i.createVertexBuffer(u,Eo.members),this.debugSegments=l.$.simpleSegment(0,0,4,5);const d=new l.Z;d.emplaceBack(0,0,0,0),d.emplaceBack(l.W,0,l.W,0),d.emplaceBack(0,l.W,0,l.W),d.emplaceBack(l.W,l.W,l.W,l.W),this.rasterBoundsBuffer=i.createVertexBuffer(d,Ct.members),this.rasterBoundsSegments=l.$.simpleSegment(0,0,4,2);const _=new l.aV;_.emplaceBack(0,0),_.emplaceBack(1,0),_.emplaceBack(0,1),_.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(_,Eo.members),this.viewportSegments=l.$.simpleSegment(0,0,4,2);const w=new l.aW;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=i.createIndexBuffer(w);const M=new l.aX;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(M);const A=this.context.gl;this.stencilClearMode=new Ti({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO)}clearStencil(){const i=this.context,o=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const u=l.F();l.aN(u,0,this.width,this.height,0,0,1),l.J(u,u,[o.drawingBufferWidth,o.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(i,o.TRIANGLES,ti.disabled,this.stencilClearMode,Ki.disabled,xi.disabled,Do(u),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(i,o){if(this.currentStencilSource===i.source||!i.isTileClipped()||!o||!o.length)return;this.currentStencilSource=i.source;const u=this.context,d=u.gl;this.nextStencilID+o.length>256&&this.clearStencil(),u.setColorMode(Ki.disabled),u.setDepthMode(ti.disabled);const _=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const w of o){const M=this._tileClippingMaskIDs[w.key]=this.nextStencilID++,A=this.style.map.terrain&&this.style.map.terrain.getTerrainData(w);_.draw(u,d.TRIANGLES,ti.disabled,new Ti({func:d.ALWAYS,mask:0},M,255,d.KEEP,d.KEEP,d.REPLACE),Ki.disabled,xi.disabled,Do(w.posMatrix),A,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,o=this.context.gl;return new Ti({func:o.NOTEQUAL,mask:255},i,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(i){const o=this.context.gl;return new Ti({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(i){const o=this.context.gl,u=i.sort((w,M)=>M.overscaledZ-w.overscaledZ),d=u[u.length-1].overscaledZ,_=u[0].overscaledZ-d+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const w={};for(let M=0;M<_;M++)w[M+d]=new Ti({func:o.GEQUAL,mask:255},M+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=_,[w,u]}return[{[d]:Ti.disabled},u]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new Ki([i.CONSTANT_COLOR,i.ONE],new l.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ki.unblended:Ki.alphaBlended}depthModeForSublayer(i,o,u){if(!this.opaquePassEnabledForLayer())return ti.disabled;const d=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new ti(u||this.context.gl.LEQUAL,o,[d,d])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,o){this.style=i,this.options=o,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(P.now()),this.imageManager.beginFrame();const u=this.style._order,d=this.style.sourceCaches,_={},w={},M={};for(const A in d){const C=d[A];C.used&&C.prepare(this.context),_[A]=C.getVisibleCoordinates(),w[A]=_[A].slice().reverse(),M[A]=C.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let A=0;A<u.length;A++)if(this.style._layers[u[A]].is3D()){this.opaquePassCutoff=A;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const A of u){const C=this.style._layers[A];if(!C.hasOffscreenPass()||C.isHidden(this.transform.zoom))continue;const z=w[C.source];(C.type==="custom"||z.length)&&this.renderLayer(this,d[C.source],C,z)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:o.showOverdrawInspector?l.aO.black:l.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.depthRangeFor3D=[0,1-(i._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=u.length-1;this.currentLayer>=0;this.currentLayer--){const A=this.style._layers[u[this.currentLayer]],C=d[A.source],z=_[A.source];this._renderTileClippingMasks(A,z),this.renderLayer(this,C,A,z)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<u.length;this.currentLayer++){const A=this.style._layers[u[this.currentLayer]],C=d[A.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(A))continue;const z=(A.type==="symbol"?M:w)[A.source];this._renderTileClippingMasks(A,_[A.source]),this.renderLayer(this,C,A,z)}if(this.options.showTileBoundaries){const A=function(C,z){let O=null;const V=Object.values(C._layers).flatMap(j=>j.source&&!j.isHidden(z)?[C.sourceCaches[j.source]]:[]),Z=V.filter(j=>j.getSource().type==="vector"),W=V.filter(j=>j.getSource().type!=="vector"),J=j=>{(!O||O.getSource().maxzoom<j.getSource().maxzoom)&&(O=j)};return Z.forEach(j=>J(j)),O||W.forEach(j=>J(j)),O}(this.style,this.transform.zoom);A&&function(C,z,O){for(let V=0;V<O.length;V++)hc(C,z,O[V])}(this,A,A.getVisibleCoordinates())}this.options.showPadding&&function(A){const C=A.transform.padding;$i(A,A.transform.height-(C.top||0),3,lu),$i(A,C.bottom||0,3,Ko),dn(A,C.left||0,3,cc),dn(A,A.transform.width-(C.right||0),3,Sf);const z=A.transform.centerPoint;(function(O,V,Z,W){zs(O,V-1,Z-10,2,20,W),zs(O,V-10,Z-1,20,2,W)})(A,z.x,A.transform.height-z.y,cu)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(i){if(!this.style||!this.style.map||!this.style.map.terrain)return;const o=this.terrainFacilitator.matrix,u=this.transform.projMatrix;let d=this.terrainFacilitator.dirty;d||(d=i?!l.aY(o,u):!l.aZ(o,u)),d||(d=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),d&&(l.a_(o,u),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(_,w){const M=_.context,A=M.gl,C=Ki.unblended,z=new ti(A.LEQUAL,ti.ReadWrite,[0,1]),O=w.getTerrainMesh(),V=w.sourceCache.getRenderableTiles(),Z=_.useProgram("terrainDepth");M.bindFramebuffer.set(w.getFramebuffer("depth").framebuffer),M.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),M.clear({color:l.aO.transparent,depth:1});for(const W of V){const J=w.getTerrainData(W.tileID),j={u_matrix:_.transform.calculatePosMatrix(W.tileID.toUnwrapped()),u_ele_delta:w.getMeshFrameDelta(_.transform.zoom)};Z.draw(M,A.TRIANGLES,z,Ti.disabled,C,xi.backCCW,j,J,"terrain",O.vertexBuffer,O.indexBuffer,O.segments)}M.bindFramebuffer.set(null),M.viewport.set([0,0,_.width,_.height])}(this,this.style.map.terrain),function(_,w){const M=_.context,A=M.gl,C=Ki.unblended,z=new ti(A.LEQUAL,ti.ReadWrite,[0,1]),O=w.getTerrainMesh(),V=w.getCoordsTexture(),Z=w.sourceCache.getRenderableTiles(),W=_.useProgram("terrainCoords");M.bindFramebuffer.set(w.getFramebuffer("coords").framebuffer),M.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),M.clear({color:l.aO.transparent,depth:1}),w.coordsIndex=[];for(const J of Z){const j=w.getTerrainData(J.tileID);M.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,V.texture);const lt={u_matrix:_.transform.calculatePosMatrix(J.tileID.toUnwrapped()),u_terrain_coords_id:(255-w.coordsIndex.length)/255,u_texture:0,u_ele_delta:w.getMeshFrameDelta(_.transform.zoom)};W.draw(M,A.TRIANGLES,z,Ti.disabled,C,xi.backCCW,lt,j,"terrain",O.vertexBuffer,O.indexBuffer,O.segments),w.coordsIndex.push(J.tileID.key)}M.bindFramebuffer.set(null),M.viewport.set([0,0,_.width,_.height])}(this,this.style.map.terrain))}renderLayer(i,o,u,d){if(!u.isHidden(this.transform.zoom)&&(u.type==="background"||u.type==="custom"||(d||[]).length))switch(this.id=u.id,u.type){case"symbol":(function(_,w,M,A,C){if(_.renderPass!=="translucent")return;const z=Ti.disabled,O=_.colorModeForRenderPass();(M._unevaluatedLayout.hasValue("text-variable-anchor")||M._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(V,Z,W,J,j,lt,xt){const et=Z.transform,pt=j==="map",bt=lt==="map";for(const wt of V){const St=J.getTile(wt),Bt=St.getBucket(W);if(!Bt||!Bt.text||!Bt.text.segments.get().length)continue;const Ot=l.ag(Bt.textSizeData,et.zoom),Wt=ze(St,1,Z.transform.zoom),Xt=Be(wt.posMatrix,bt,pt,Z.transform,Wt),$e=W.layout.get("icon-text-fit")!=="none"&&Bt.hasIconData();if(Ot){const Qt=Math.pow(2,et.zoom-St.tileID.overscaledZ);qo(Bt,pt,bt,xt,et,Xt,wt.posMatrix,Qt,Ot,$e,Z.style.map.terrain?(Ee,Ve)=>Z.style.map.terrain.getElevation(wt,Ee,Ve):null)}}}(A,_,M,w,M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),C),M.paint.get("icon-opacity").constantOr(1)!==0&&Go(_,w,M,A,!1,M.paint.get("icon-translate"),M.paint.get("icon-translate-anchor"),M.layout.get("icon-rotation-alignment"),M.layout.get("icon-pitch-alignment"),M.layout.get("icon-keep-upright"),z,O),M.paint.get("text-opacity").constantOr(1)!==0&&Go(_,w,M,A,!0,M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),M.layout.get("text-keep-upright"),z,O),w.map.showCollisionBoxes&&(Uo(_,w,M,A,M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),!0),Uo(_,w,M,A,M.paint.get("icon-translate"),M.paint.get("icon-translate-anchor"),!1))})(i,o,u,d,this.style.placement.variableOffsets);break;case"circle":(function(_,w,M,A){if(_.renderPass!=="translucent")return;const C=M.paint.get("circle-opacity"),z=M.paint.get("circle-stroke-width"),O=M.paint.get("circle-stroke-opacity"),V=!M.layout.get("circle-sort-key").isConstant();if(C.constantOr(1)===0&&(z.constantOr(1)===0||O.constantOr(1)===0))return;const Z=_.context,W=Z.gl,J=_.depthModeForSublayer(0,ti.ReadOnly),j=Ti.disabled,lt=_.colorModeForRenderPass(),xt=[];for(let et=0;et<A.length;et++){const pt=A[et],bt=w.getTile(pt),wt=bt.getBucket(M);if(!wt)continue;const St=wt.programConfigurations.get(M.id),Bt=_.useProgram("circle",St),Ot=wt.layoutVertexBuffer,Wt=wt.indexBuffer,Xt=_.style.map.terrain&&_.style.map.terrain.getTerrainData(pt),$e={programConfiguration:St,program:Bt,layoutVertexBuffer:Ot,indexBuffer:Wt,uniformValues:df(_,pt,bt,M),terrainData:Xt};if(V){const Qt=wt.segments.get();for(const Ee of Qt)xt.push({segments:new l.$([Ee]),sortKey:Ee.sortKey,state:$e})}else xt.push({segments:wt.segments,sortKey:0,state:$e})}V&&xt.sort((et,pt)=>et.sortKey-pt.sortKey);for(const et of xt){const{programConfiguration:pt,program:bt,layoutVertexBuffer:wt,indexBuffer:St,uniformValues:Bt,terrainData:Ot}=et.state;bt.draw(Z,W.TRIANGLES,J,j,lt,xi.disabled,Bt,Ot,M.id,wt,St,et.segments,M.paint,_.transform.zoom,pt)}})(i,o,u,d);break;case"heatmap":(function(_,w,M,A){if(M.paint.get("heatmap-opacity")!==0)if(_.renderPass==="offscreen"){const C=_.context,z=C.gl,O=Ti.disabled,V=new Ki([z.ONE,z.ONE],l.aO.transparent,[!0,!0,!0,!0]);(function(Z,W,J){const j=Z.gl;Z.activeTexture.set(j.TEXTURE1),Z.viewport.set([0,0,W.width/4,W.height/4]);let lt=J.heatmapFbo;if(lt)j.bindTexture(j.TEXTURE_2D,lt.colorAttachment.get()),Z.bindFramebuffer.set(lt.framebuffer);else{const xt=j.createTexture();j.bindTexture(j.TEXTURE_2D,xt),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,j.LINEAR),lt=J.heatmapFbo=Z.createFramebuffer(W.width/4,W.height/4,!1,!1),function(et,pt,bt,wt){var St,Bt;const Ot=et.gl,Wt=(St=et.HALF_FLOAT)!==null&&St!==void 0?St:Ot.UNSIGNED_BYTE,Xt=(Bt=et.RGBA16F)!==null&&Bt!==void 0?Bt:Ot.RGBA;Ot.texImage2D(Ot.TEXTURE_2D,0,Xt,pt.width/4,pt.height/4,0,Ot.RGBA,Wt,null),wt.colorAttachment.set(bt)}(Z,W,xt,lt)}})(C,_,M),C.clear({color:l.aO.transparent});for(let Z=0;Z<A.length;Z++){const W=A[Z];if(w.hasRenderableParent(W))continue;const J=w.getTile(W),j=J.getBucket(M);if(!j)continue;const lt=j.programConfigurations.get(M.id),xt=_.useProgram("heatmap",lt),{zoom:et}=_.transform;xt.draw(C,z.TRIANGLES,ti.disabled,O,V,xi.disabled,Wh(W.posMatrix,J,et,M.paint.get("heatmap-intensity")),null,M.id,j.layoutVertexBuffer,j.indexBuffer,j.segments,M.paint,_.transform.zoom,lt)}C.viewport.set([0,0,_.width,_.height])}else _.renderPass==="translucent"&&(_.context.setColorMode(_.colorModeForRenderPass()),function(C,z){const O=C.context,V=O.gl,Z=z.heatmapFbo;if(!Z)return;O.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,Z.colorAttachment.get()),O.activeTexture.set(V.TEXTURE1);let W=z.colorRampTexture;W||(W=z.colorRampTexture=new Dt(O,z.colorRamp,V.RGBA)),W.bind(V.LINEAR,V.CLAMP_TO_EDGE),C.useProgram("heatmapTexture").draw(O,V.TRIANGLES,ti.disabled,Ti.disabled,C.colorModeForRenderPass(),xi.disabled,((J,j,lt,xt)=>{const et=l.F();l.aN(et,0,J.width,J.height,0,0,1);const pt=J.context.gl;return{u_matrix:et,u_world:[pt.drawingBufferWidth,pt.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:j.paint.get("heatmap-opacity")}})(C,z),null,z.id,C.viewportBuffer,C.quadTriangleIndexBuffer,C.viewportSegments,z.paint,C.transform.zoom)}(_,M))})(i,o,u,d);break;case"line":(function(_,w,M,A){if(_.renderPass!=="translucent")return;const C=M.paint.get("line-opacity"),z=M.paint.get("line-width");if(C.constantOr(1)===0||z.constantOr(1)===0)return;const O=_.depthModeForSublayer(0,ti.ReadOnly),V=_.colorModeForRenderPass(),Z=M.paint.get("line-dasharray"),W=M.paint.get("line-pattern"),J=W.constantOr(1),j=M.paint.get("line-gradient"),lt=M.getCrossfadeParameters(),xt=J?"linePattern":Z?"lineSDF":j?"lineGradient":"line",et=_.context,pt=et.gl;let bt=!0;for(const wt of A){const St=w.getTile(wt);if(J&&!St.patternsLoaded())continue;const Bt=St.getBucket(M);if(!Bt)continue;const Ot=Bt.programConfigurations.get(M.id),Wt=_.context.program.get(),Xt=_.useProgram(xt,Ot),$e=bt||Xt.program!==Wt,Qt=_.style.map.terrain&&_.style.map.terrain.getTerrainData(wt),Ee=W.constantOr(null);if(Ee&&St.imageAtlas){const Ce=St.imageAtlas,qe=Ce.patternPositions[Ee.to.toString()],He=Ce.patternPositions[Ee.from.toString()];qe&&He&&Ot.setConstantPatternPositions(qe,He)}const Ve=Qt?wt:null,ei=J?zn(_,St,M,lt,Ve):Z?Ro(_,St,M,Z,lt,Ve):j?Kh(_,St,M,Bt.lineClipsArray.length,Ve):ko(_,St,M,Ve);if(J)et.activeTexture.set(pt.TEXTURE0),St.imageAtlasTexture.bind(pt.LINEAR,pt.CLAMP_TO_EDGE),Ot.updatePaintBuffers(lt);else if(Z&&($e||_.lineAtlas.dirty))et.activeTexture.set(pt.TEXTURE0),_.lineAtlas.bind(et);else if(j){const Ce=Bt.gradients[M.id];let qe=Ce.texture;if(M.gradientVersion!==Ce.version){let He=256;if(M.stepInterpolant){const Ui=w.getSource().maxzoom,mi=wt.canonical.z===Ui?Math.ceil(1<<_.transform.maxZoom-wt.canonical.z):1;He=l.ac(l.aT(Bt.maxLineLength/l.W*1024*mi),256,et.maxTextureSize)}Ce.gradient=l.aU({expression:M.gradientExpression(),evaluationKey:"lineProgress",resolution:He,image:Ce.gradient||void 0,clips:Bt.lineClipsArray}),Ce.texture?Ce.texture.update(Ce.gradient):Ce.texture=new Dt(et,Ce.gradient,pt.RGBA),Ce.version=M.gradientVersion,qe=Ce.texture}et.activeTexture.set(pt.TEXTURE0),qe.bind(M.stepInterpolant?pt.NEAREST:pt.LINEAR,pt.CLAMP_TO_EDGE)}Xt.draw(et,pt.TRIANGLES,O,_.stencilModeForClipping(wt),V,xi.disabled,ei,Qt,M.id,Bt.layoutVertexBuffer,Bt.indexBuffer,Bt.segments,M.paint,_.transform.zoom,Ot,Bt.layoutVertexBuffer2),bt=!1}})(i,o,u,d);break;case"fill":(function(_,w,M,A){const C=M.paint.get("fill-color"),z=M.paint.get("fill-opacity");if(z.constantOr(1)===0)return;const O=_.colorModeForRenderPass(),V=M.paint.get("fill-pattern"),Z=_.opaquePassEnabledForLayer()&&!V.constantOr(1)&&C.constantOr(l.aO.transparent).a===1&&z.constantOr(0)===1?"opaque":"translucent";if(_.renderPass===Z){const W=_.depthModeForSublayer(1,_.renderPass==="opaque"?ti.ReadWrite:ti.ReadOnly);au(_,w,M,A,W,O,!1)}if(_.renderPass==="translucent"&&M.paint.get("fill-antialias")){const W=_.depthModeForSublayer(M.getPaintProperty("fill-outline-color")?2:0,ti.ReadOnly);au(_,w,M,A,W,O,!0)}})(i,o,u,d);break;case"fill-extrusion":(function(_,w,M,A){const C=M.paint.get("fill-extrusion-opacity");if(C!==0&&_.renderPass==="translucent"){const z=new ti(_.context.gl.LEQUAL,ti.ReadWrite,_.depthRangeFor3D);if(C!==1||M.paint.get("fill-extrusion-pattern").constantOr(1))Wo(_,w,M,A,z,Ti.disabled,Ki.disabled),Wo(_,w,M,A,z,_.stencilModeFor3D(),_.colorModeForRenderPass());else{const O=_.colorModeForRenderPass();Wo(_,w,M,A,z,Ti.disabled,O)}}})(i,o,u,d);break;case"hillshade":(function(_,w,M,A){if(_.renderPass!=="offscreen"&&_.renderPass!=="translucent")return;const C=_.context,z=_.depthModeForSublayer(0,ti.ReadOnly),O=_.colorModeForRenderPass(),[V,Z]=_.renderPass==="translucent"?_.stencilConfigForOverlap(A):[{},A];for(const W of Z){const J=w.getTile(W);J.needsHillshadePrepare!==void 0&&J.needsHillshadePrepare&&_.renderPass==="offscreen"?lc(_,J,M,z,Ti.disabled,O):_.renderPass==="translucent"&&Zo(_,W,J,M,z,V[W.overscaledZ],O)}C.viewport.set([0,0,_.width,_.height])})(i,o,u,d);break;case"raster":(function(_,w,M,A){if(_.renderPass!=="translucent"||M.paint.get("raster-opacity")===0||!A.length)return;const C=_.context,z=C.gl,O=w.getSource(),V=_.useProgram("raster"),Z=_.colorModeForRenderPass(),[W,J]=O instanceof Ht?[{},A]:_.stencilConfigForOverlap(A),j=J[J.length-1].overscaledZ,lt=!_.options.moving;for(const xt of J){const et=_.depthModeForSublayer(xt.overscaledZ-j,M.paint.get("raster-opacity")===1?ti.ReadWrite:ti.ReadOnly,z.LESS),pt=w.getTile(xt);pt.registerFadeDuration(M.paint.get("raster-fade-duration"));const bt=w.findLoadedParent(xt,0),wt=ou(pt,bt,w,M,_.transform,_.style.map.terrain);let St,Bt;const Ot=M.paint.get("raster-resampling")==="nearest"?z.NEAREST:z.LINEAR;C.activeTexture.set(z.TEXTURE0),pt.texture.bind(Ot,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),C.activeTexture.set(z.TEXTURE1),bt?(bt.texture.bind(Ot,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),St=Math.pow(2,bt.tileID.overscaledZ-pt.tileID.overscaledZ),Bt=[pt.tileID.canonical.x*St%1,pt.tileID.canonical.y*St%1]):pt.texture.bind(Ot,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST);const Wt=_.style.map.terrain&&_.style.map.terrain.getTerrainData(xt),Xt=Wt?xt:null,$e=Xt?Xt.posMatrix:_.transform.calculatePosMatrix(xt.toUnwrapped(),lt),Qt=zo($e,Bt||[0,0],St||1,wt,M);O instanceof Ht?V.draw(C,z.TRIANGLES,et,Ti.disabled,Z,xi.disabled,Qt,Wt,M.id,O.boundsBuffer,_.quadTriangleIndexBuffer,O.boundsSegments):V.draw(C,z.TRIANGLES,et,W[xt.overscaledZ],Z,xi.disabled,Qt,Wt,M.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments)}})(i,o,u,d);break;case"background":(function(_,w,M,A){const C=M.paint.get("background-color"),z=M.paint.get("background-opacity");if(z===0)return;const O=_.context,V=O.gl,Z=_.transform,W=Z.tileSize,J=M.paint.get("background-pattern");if(_.isPatternMissing(J))return;const j=!J&&C.a===1&&z===1&&_.opaquePassEnabledForLayer()?"opaque":"translucent";if(_.renderPass!==j)return;const lt=Ti.disabled,xt=_.depthModeForSublayer(0,j==="opaque"?ti.ReadWrite:ti.ReadOnly),et=_.colorModeForRenderPass(),pt=_.useProgram(J?"backgroundPattern":"background"),bt=A||Z.coveringTiles({tileSize:W,terrain:_.style.map.terrain});J&&(O.activeTexture.set(V.TEXTURE0),_.imageManager.bind(_.context));const wt=M.getCrossfadeParameters();for(const St of bt){const Bt=A?St.posMatrix:_.transform.calculatePosMatrix(St.toUnwrapped()),Ot=J?pf(Bt,z,_,J,{tileID:St,tileSize:W},wt):ff(Bt,z,C),Wt=_.style.map.terrain&&_.style.map.terrain.getTerrainData(St);pt.draw(O,V.TRIANGLES,xt,lt,et,xi.disabled,Ot,Wt,M.id,_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}})(i,0,u,d);break;case"custom":(function(_,w,M){const A=_.context,C=M.implementation;if(_.renderPass==="offscreen"){const z=C.prerender;z&&(_.setCustomLayerDefaults(),A.setColorMode(_.colorModeForRenderPass()),z.call(C,A.gl,_.transform.customLayerMatrix()),A.setDirty(),_.setBaseState())}else if(_.renderPass==="translucent"){_.setCustomLayerDefaults(),A.setColorMode(_.colorModeForRenderPass()),A.setStencilMode(Ti.disabled);const z=C.renderingMode==="3d"?new ti(_.context.gl.LEQUAL,ti.ReadWrite,_.depthRangeFor3D):_.depthModeForSublayer(0,ti.ReadOnly);A.setDepthMode(z),C.render(A.gl,_.transform.customLayerMatrix()),A.setDirty(),_.setBaseState(),A.bindFramebuffer.set(null)}})(i,0,u)}}translatePosMatrix(i,o,u,d,_){if(!u[0]&&!u[1])return i;const w=_?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(w){const C=Math.sin(w),z=Math.cos(w);u=[u[0]*z-u[1]*C,u[0]*C+u[1]*z]}const M=[_?u[0]:ze(o,u[0],this.transform.zoom),_?u[1]:ze(o,u[1],this.transform.zoom),0],A=new Float32Array(16);return l.H(A,i,M),A}saveTileTexture(i){const o=this._tileTextures[i.size[0]];o?o.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const o=this._tileTextures[i];return o&&o.length>0?o.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const o=this.imageManager.getPattern(i.from.toString()),u=this.imageManager.getPattern(i.to.toString());return!o||!u}useProgram(i,o){this.cache=this.cache||{};const u=i+(o?o.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[u]||(this.cache[u]=new un(this.context,$a[i],o,Xh[i],this._showOverdrawInspector,this.style.map.terrain)),this.cache[u]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Dt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:i,drawingBufferHeight:o}=this.context.gl;return this.width!==i||this.height!==o}}class fn{constructor(i,o){this.points=i,this.planes=o}static fromInvProjectionMatrix(i,o,u){const d=Math.pow(2,u),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(M=>{const A=1/(M=l.af([],M,i))[3]/o*d;return l.a$(M,M,[A,A,1/M[3],A])}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(M=>{const A=function(V,Z){var W=Z[0],J=Z[1],j=Z[2],lt=W*W+J*J+j*j;return lt>0&&(lt=1/Math.sqrt(lt)),V[0]=Z[0]*lt,V[1]=Z[1]*lt,V[2]=Z[2]*lt,V}([],function(V,Z,W){var J=Z[0],j=Z[1],lt=Z[2],xt=W[0],et=W[1],pt=W[2];return V[0]=j*pt-lt*et,V[1]=lt*xt-J*pt,V[2]=J*et-j*xt,V}([],ne([],_[M[0]],_[M[1]]),ne([],_[M[2]],_[M[1]]))),C=-((z=A)[0]*(O=_[M[1]])[0]+z[1]*O[1]+z[2]*O[2]);var z,O;return A.concat(C)});return new fn(_,w)}}class pn{constructor(i,o){this.min=i,this.max=o,this.center=function(u,d,_){return u[0]=.5*d[0],u[1]=.5*d[1],u[2]=.5*d[2],u}([],function(u,d,_){return u[0]=d[0]+_[0],u[1]=d[1]+_[1],u[2]=d[2]+_[2],u}([],this.min,this.max))}quadrant(i){const o=[i%2==0,i<2],u=qt(this.min),d=qt(this.max);for(let _=0;_<o.length;_++)u[_]=o[_]?this.min[_]:this.center[_],d[_]=o[_]?this.center[_]:this.max[_];return d[2]=this.max[2],new pn(u,d)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}intersects(i){const o=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let u=!0;for(let d=0;d<i.planes.length;d++){const _=i.planes[d];let w=0;for(let M=0;M<o.length;M++)l.b0(_,o[M])>=0&&w++;if(w===0)return 0;w!==o.length&&(u=!1)}if(u)return 2;for(let d=0;d<3;d++){let _=Number.MAX_VALUE,w=-Number.MAX_VALUE;for(let M=0;M<i.points.length;M++){const A=i.points[M][d]-this.min[d];_=Math.min(_,A),w=Math.max(w,A)}if(w<0||_>this.max[d]-this.min[d])return 0}return 1}}class la{constructor(i=0,o=0,u=0,d=0){if(isNaN(i)||i<0||isNaN(o)||o<0||isNaN(u)||u<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=o,this.left=u,this.right=d}interpolate(i,o,u){return o.top!=null&&i.top!=null&&(this.top=l.z.number(i.top,o.top,u)),o.bottom!=null&&i.bottom!=null&&(this.bottom=l.z.number(i.bottom,o.bottom,u)),o.left!=null&&i.left!=null&&(this.left=l.z.number(i.left,o.left,u)),o.right!=null&&i.right!=null&&(this.right=l.z.number(i.right,o.right,u)),this}getCenter(i,o){const u=l.ac((this.left+i-this.right)/2,0,i),d=l.ac((this.top+o-this.bottom)/2,0,o);return new l.P(u,d)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new la(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const uc=85.051129;class Yo{constructor(i,o,u,d,_){this.tileSize=512,this._renderWorldCopies=_===void 0||!!_,this._minZoom=i||0,this._maxZoom=o||22,this._minPitch=u??0,this._maxPitch=d??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new la,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const i=new Yo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return i.apply(this),i}apply(i){this.tileSize=i.tileSize,this.latRange=i.latRange,this.width=i.width,this.height=i.height,this._center=i._center,this._elevation=i._elevation,this.minElevationForCurrentTile=i.minElevationForCurrentTile,this.zoom=i.zoom,this.angle=i.angle,this._fov=i._fov,this._pitch=i._pitch,this._unmodified=i._unmodified,this._edgeInsets=i._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(i){const o=-l.b1(i,-180,180)*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=function(){var u=new l.A(4);return l.A!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u}(),function(u,d,_){var w=d[0],M=d[1],A=d[2],C=d[3],z=Math.sin(_),O=Math.cos(_);u[0]=w*O+A*z,u[1]=M*O+C*z,u[2]=w*-z+A*O,u[3]=M*-z+C*O}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const o=l.ac(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(i){const o=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._zoom=o,this.tileZoom=Math.max(0,Math.floor(o)),this.scale=this.zoomScale(o),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(i){i!==this._elevation&&(this._elevation=i,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,o,u){this._unmodified=!1,this._edgeInsets.interpolate(i,o,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const o=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(i){const o=[new l.b2(0,i)];if(this._renderWorldCopies){const u=this.pointCoordinate(new l.P(0,0)),d=this.pointCoordinate(new l.P(this.width,0)),_=this.pointCoordinate(new l.P(this.width,this.height)),w=this.pointCoordinate(new l.P(0,this.height)),M=Math.floor(Math.min(u.x,d.x,_.x,w.x)),A=Math.floor(Math.max(u.x,d.x,_.x,w.x)),C=1;for(let z=M-C;z<=A+C;z++)z!==0&&o.push(new l.b2(z,i))}return o}coveringTiles(i){var o,u;let d=this.coveringZoomLevel(i);const _=d;if(i.minzoom!==void 0&&d<i.minzoom)return[];i.maxzoom!==void 0&&d>i.maxzoom&&(d=i.maxzoom);const w=this.pointCoordinate(this.getCameraPoint()),M=l.Y.fromLngLat(this.center),A=Math.pow(2,d),C=[A*w.x,A*w.y,0],z=[A*M.x,A*M.y,0],O=fn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d);let V=i.minzoom||0;!i.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(V=d);const Z=i.terrain?2/Math.min(this.tileSize,i.tileSize)*this.tileSize:3,W=et=>({aabb:new pn([et*A,0,0],[(et+1)*A,A,0]),zoom:0,x:0,y:0,wrap:et,fullyVisible:!1}),J=[],j=[],lt=d,xt=i.reparseOverscaled?_:d;if(this._renderWorldCopies)for(let et=1;et<=3;et++)J.push(W(-et)),J.push(W(et));for(J.push(W(0));J.length>0;){const et=J.pop(),pt=et.x,bt=et.y;let wt=et.fullyVisible;if(!wt){const Xt=et.aabb.intersects(O);if(Xt===0)continue;wt=Xt===2}const St=i.terrain?C:z,Bt=et.aabb.distanceX(St),Ot=et.aabb.distanceY(St),Wt=Math.max(Math.abs(Bt),Math.abs(Ot));if(et.zoom===lt||Wt>Z+(1<<lt-et.zoom)-2&&et.zoom>=V){const Xt=lt-et.zoom,$e=C[0]-.5-(pt<<Xt),Qt=C[1]-.5-(bt<<Xt);j.push({tileID:new l.Q(et.zoom===lt?xt:et.zoom,et.wrap,et.zoom,pt,bt),distanceSq:Vt([z[0]-.5-pt,z[1]-.5-bt]),tileDistanceToCamera:Math.sqrt($e*$e+Qt*Qt)})}else for(let Xt=0;Xt<4;Xt++){const $e=(pt<<1)+Xt%2,Qt=(bt<<1)+(Xt>>1),Ee=et.zoom+1;let Ve=et.aabb.quadrant(Xt);if(i.terrain){const ei=new l.Q(Ee,et.wrap,Ee,$e,Qt),Ce=i.terrain.getMinMaxElevation(ei),qe=(o=Ce.minElevation)!==null&&o!==void 0?o:this.elevation,He=(u=Ce.maxElevation)!==null&&u!==void 0?u:this.elevation;Ve=new pn([Ve.min[0],Ve.min[1],qe],[Ve.max[0],Ve.max[1],He])}J.push({aabb:Ve,zoom:Ee,x:$e,y:Qt,wrap:et.wrap,fullyVisible:wt})}}return j.sort((et,pt)=>et.distanceSq-pt.distanceSq).map(et=>et.tileID)}resize(i,o){this.width=i,this.height=o,this.pixelsToGLUnits=[2/i,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const o=l.ac(i.lat,-85.051129,uc);return new l.P(l.N(i.lng)*this.worldSize,l.O(o)*this.worldSize)}unproject(i){return new l.Y(i.x/this.worldSize,i.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(i){const o=this.elevation,u=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,d=this.pointLocation(this.centerPoint,i),_=i.getElevationForLngLatZoom(d,this.tileZoom);if(!(this.elevation-_))return;const w=u+o-_,M=Math.cos(this._pitch)*this.cameraToCenterDistance/w/l.b3(1,d.lat),A=this.scaleZoom(M/this.tileSize);this._elevation=_,this._center=d,this.zoom=A}setLocationAtPoint(i,o){const u=this.pointCoordinate(o),d=this.pointCoordinate(this.centerPoint),_=this.locationCoordinate(i),w=new l.Y(_.x-(u.x-d.x),_.y-(u.y-d.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(i,o){return o?this.coordinatePoint(this.locationCoordinate(i),o.getElevationForLngLatZoom(i,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(i))}pointLocation(i,o){return this.coordinateLocation(this.pointCoordinate(i,o))}locationCoordinate(i){return l.Y.fromLngLat(i)}coordinateLocation(i){return i&&i.toLngLat()}pointCoordinate(i,o){if(o){const V=o.pointCoordinate(i);if(V!=null)return V}const u=[i.x,i.y,0,1],d=[i.x,i.y,1,1];l.af(u,u,this.pixelMatrixInverse),l.af(d,d,this.pixelMatrixInverse);const _=u[3],w=d[3],M=u[1]/_,A=d[1]/w,C=u[2]/_,z=d[2]/w,O=C===z?0:(0-C)/(z-C);return new l.Y(l.z.number(u[0]/_,d[0]/w,O)/this.worldSize,l.z.number(M,A,O)/this.worldSize)}coordinatePoint(i,o=0,u=this.pixelMatrix){const d=[i.x*this.worldSize,i.y*this.worldSize,o,1];return l.af(d,d,u),new l.P(d[0]/d[3],d[1]/d[3])}getBounds(){const i=Math.max(0,this.height/2-this.getHorizon());return new rt().extend(this.pointLocation(new l.P(0,i))).extend(this.pointLocation(new l.P(this.width,i))).extend(this.pointLocation(new l.P(this.width,this.height))).extend(this.pointLocation(new l.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new rt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(i){i?(this.lngRange=[i.getWest(),i.getEast()],this.latRange=[i.getSouth(),i.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,uc])}calculatePosMatrix(i,o=!1){const u=i.key,d=o?this._alignedPosMatrixCache:this._posMatrixCache;if(d[u])return d[u];const _=i.canonical,w=this.worldSize/this.zoomScale(_.z),M=_.x+Math.pow(2,_.z)*i.wrap,A=l.an(new Float64Array(16));return l.H(A,A,[M*w,_.y*w,0]),l.J(A,A,[w/l.W,w/l.W,1]),l.K(A,o?this.alignedProjMatrix:this.projMatrix,A),d[u]=new Float32Array(A),d[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(i,o){o=l.ac(+o,this.minZoom,this.maxZoom);const u={center:new l.M(i.lng,i.lat),zoom:o};let d=this.lngRange;if(!this._renderWorldCopies&&d===null){const et=179.9999999999;d=[-et,et]}const _=this.tileSize*this.zoomScale(u.zoom);let w=0,M=_,A=0,C=_,z=0,O=0;const{x:V,y:Z}=this.size;if(this.latRange){const et=this.latRange;w=l.O(et[1])*_,M=l.O(et[0])*_,M-w<Z&&(z=Z/(M-w))}d&&(A=l.b1(l.N(d[0])*_,0,_),C=l.b1(l.N(d[1])*_,0,_),C<A&&(C+=_),C-A<V&&(O=V/(C-A)));const{x:W,y:J}=this.project.call({worldSize:_},i);let j,lt;const xt=Math.max(O||0,z||0);if(xt){const et=new l.P(O?(C+A)/2:W,z?(M+w)/2:J);return u.center=this.unproject.call({worldSize:_},et).wrap(),u.zoom+=this.scaleZoom(xt),u}if(this.latRange){const et=Z/2;J-et<w&&(lt=w+et),J+et>M&&(lt=M-et)}if(d){const et=(A+C)/2;let pt=W;this._renderWorldCopies&&(pt=l.b1(W,et-_/2,et+_/2));const bt=V/2;pt-bt<A&&(j=A+bt),pt+bt>C&&(j=C-bt)}if(j!==void 0||lt!==void 0){const et=new l.P(j??W,lt??J);u.center=this.unproject.call({worldSize:_},et).wrap()}return u}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this._unmodified,{center:o,zoom:u}=this.getConstrained(this.center,this.zoom);this.center=o,this.zoom=u,this._unmodified=i,this._constraining=!1}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,o=this.point.x,u=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.b3(1,this.center.lat)*this.worldSize;let d=l.an(new Float64Array(16));l.J(d,d,[this.width/2,-this.height/2,1]),l.H(d,d,[1,-1,0]),this.labelPlaneMatrix=d,d=l.an(new Float64Array(16)),l.J(d,d,[1,-1,1]),l.H(d,d,[-1,-1,0]),l.J(d,d,[2/this.width,2/this.height,1]),this.glCoordMatrix=d;const _=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),w=Math.min(this.elevation,this.minElevationForCurrentTile),M=_-w*this._pixelPerMeter/Math.cos(this._pitch),A=w<0?M:_,C=Math.PI/2+this._pitch,z=this._fov*(.5+i.y/this.height),O=Math.sin(z)*A/Math.sin(l.ac(Math.PI-C-z,.01,Math.PI-.01)),V=this.getHorizon(),Z=2*Math.atan(V/this.cameraToCenterDistance)*(.5+i.y/(2*V)),W=Math.sin(Z)*A/Math.sin(l.ac(Math.PI-C-Z,.01,Math.PI-.01)),J=Math.min(O,W),j=1.01*(Math.cos(Math.PI/2-this._pitch)*J+A),lt=this.height/50;d=new Float64Array(16),l.b4(d,this._fov,this.width/this.height,lt,j),d[8]=2*-i.x/this.width,d[9]=2*i.y/this.height,l.J(d,d,[1,-1,1]),l.H(d,d,[0,0,-this.cameraToCenterDistance]),l.b5(d,d,this._pitch),l.ad(d,d,this.angle),l.H(d,d,[-o,-u,0]),this.mercatorMatrix=l.J([],d,[this.worldSize,this.worldSize,this.worldSize]),l.J(d,d,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.K(new Float64Array(16),this.labelPlaneMatrix,d),l.H(d,d,[0,0,-this.elevation]),this.projMatrix=d,this.invProjMatrix=l.ar([],d),this.pixelMatrix3D=l.K(new Float64Array(16),this.labelPlaneMatrix,d);const xt=this.width%2/2,et=this.height%2/2,pt=Math.cos(this.angle),bt=Math.sin(this.angle),wt=o-Math.round(o)+pt*xt+bt*et,St=u-Math.round(u)+pt*et+bt*xt,Bt=new Float64Array(d);if(l.H(Bt,Bt,[wt>.5?wt-1:wt,St>.5?St-1:St,0]),this.alignedProjMatrix=Bt,d=l.ar(new Float64Array(16),this.pixelMatrix),!d)throw new Error("failed to invert matrix");this.pixelMatrixInverse=d,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const i=this.pointCoordinate(new l.P(0,0)),o=[i.x*this.worldSize,i.y*this.worldSize,0,1];return l.af(o,o,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(0,i))}getCameraQueryGeometry(i){const o=this.getCameraPoint();if(i.length===1)return[i[0],o];{let u=o.x,d=o.y,_=o.x,w=o.y;for(const M of i)u=Math.min(u,M.x),d=Math.min(d,M.y),_=Math.max(_,M.x),w=Math.max(w,M.y);return[new l.P(u,d),new l.P(_,d),new l.P(_,w),new l.P(u,w),new l.P(u,d)]}}lngLatToCameraDepth(i,o){const u=this.locationCoordinate(i),d=[u.x*this.worldSize,u.y*this.worldSize,o,1];return l.af(d,d,this.projMatrix),d[2]/d[3]}}function dc(g,i){let o,u=!1,d=null,_=null;const w=()=>{d=null,u&&(g.apply(_,o),d=setTimeout(w,i),u=!1)};return(...M)=>(u=!0,_=this,o=M,d||w(),d)}class fc{constructor(i){this._getCurrentHash=()=>{const o=window.location.hash.replace("#","");if(this._hashName){let u;return o.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(u=d)}),(u&&u[1]||"").split("/")}return o.split("/")},this._onHashChange=()=>{const o=this._getCurrentHash();if(o.length>=3&&!o.some(u=>isNaN(u))){const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:u,pitch:+(o[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const o=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,o)}catch{}},this._updateHash=dc(this._updateHashUnthrottled,300),this._hashName=i&&encodeURIComponent(i)}addTo(i){return this._map=i,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(i){const o=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,d=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,d),w=Math.round(o.lng*_)/_,M=Math.round(o.lat*_)/_,A=this._map.getBearing(),C=this._map.getPitch();let z="";if(z+=i?`/${w}/${M}/${u}`:`${u}/${M}/${w}`,(A||C)&&(z+="/"+Math.round(10*A)/10),C&&(z+=`/${Math.round(C)}`),this._hashName){const O=this._hashName;let V=!1;const Z=window.location.hash.slice(1).split("&").map(W=>{const J=W.split("=")[0];return J===O?(V=!0,`${J}=${z}`):W}).filter(W=>W);return V||Z.push(`${O}=${z}`),`#${Z.join("&")}`}return`#${z}`}}const Za={linearity:.3,easing:l.b6(0,0,.3,1)},Bn=l.e({deceleration:2500,maxSpeed:1400},Za),uu=l.e({deceleration:20,maxSpeed:1400},Za),du=l.e({deceleration:1e3,maxSpeed:360},Za),fu=l.e({deceleration:1e3,maxSpeed:90},Za);class pu{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:P.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,o=P.now();for(;i.length>0&&o-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const o={zoom:0,bearing:0,pitch:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)o.zoom+=_.zoomDelta||0,o.bearing+=_.bearingDelta||0,o.pitch+=_.pitchDelta||0,_.panDelta&&o.pan._add(_.panDelta),_.around&&(o.around=_.around),_.pinchAround&&(o.pinchAround=_.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(o.pan.mag()){const _=Xa(o.pan.mag(),u,l.e({},Bn,i||{}));d.offset=o.pan.mult(_.amount/o.pan.mag()),d.center=this._map.transform.center,Ka(d,_)}if(o.zoom){const _=Xa(o.zoom,u,uu);d.zoom=this._map.transform.zoom+_.amount,Ka(d,_)}if(o.bearing){const _=Xa(o.bearing,u,du);d.bearing=this._map.transform.bearing+l.ac(_.amount,-179,179),Ka(d,_)}if(o.pitch){const _=Xa(o.pitch,u,fu);d.pitch=this._map.transform.pitch+_.amount,Ka(d,_)}if(d.zoom||d.bearing){const _=o.pinchAround===void 0?o.around:o.pinchAround;d.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),l.e(d,{noMoveStart:!0})}}function Ka(g,i){(!g.duration||g.duration<i.duration)&&(g.duration=i.duration,g.easing=i.easing)}function Xa(g,i,o){const{maxSpeed:u,linearity:d,deceleration:_}=o,w=l.ac(g*d/(i/1e3),-u,u),M=Math.abs(w)/(_*d);return{easing:o.easing,duration:1e3*M,amount:w*(M/2)}}class Gs extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,u,d={}){const _=L.mousePos(o.getCanvas(),u),w=o.unproject(_);super(i,l.e({point:_,lngLat:w,originalEvent:u},d)),this._defaultPrevented=!1,this.target=o}}class $r extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,u){const d=i==="touchend"?u.changedTouches:u.touches,_=L.touchPos(o.getCanvasContainer(),d),w=_.map(A=>o.unproject(A)),M=_.reduce((A,C,z,O)=>A.add(C.div(O.length)),new l.P(0,0));super(i,{points:_,point:M,lngLats:w,lngLat:o.unproject(M),originalEvent:u}),this._defaultPrevented=!1}}class pc extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,u){super(i,{originalEvent:u}),this._defaultPrevented=!1}}class Ir{constructor(i,o){this._map=i,this._clickTolerance=o.clickTolerance}reset(){delete this._mousedownPos}wheel(i){return this._firePreventable(new pc(i.type,this._map,i))}mousedown(i,o){return this._mousedownPos=o,this._firePreventable(new Gs(i.type,this._map,i))}mouseup(i){this._map.fire(new Gs(i.type,this._map,i))}click(i,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||this._map.fire(new Gs(i.type,this._map,i))}dblclick(i){return this._firePreventable(new Gs(i.type,this._map,i))}mouseover(i){this._map.fire(new Gs(i.type,this._map,i))}mouseout(i){this._map.fire(new Gs(i.type,this._map,i))}touchstart(i){return this._firePreventable(new $r(i.type,this._map,i))}touchmove(i){this._map.fire(new $r(i.type,this._map,i))}touchend(i){this._map.fire(new $r(i.type,this._map,i))}touchcancel(i){this._map.fire(new $r(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Vr{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(i){this._map.fire(new Gs(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Gs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._ignoreContextMenu||this._map.fire(new Gs(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ca{constructor(i){this._map=i}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(i){return this.transform.pointLocation(l.P.convert(i),this._map.terrain)}}class Pr{constructor(i,o){this._map=i,this._tr=new ca(i),this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,o){this.isEnabled()&&i.shiftKey&&i.button===0&&(L.disableDrag(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(i,o){if(!this._active)return;const u=o;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const d=this._startPos;this._lastPos=u,this._box||(this._box=L.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",i));const _=Math.min(d.x,u.x),w=Math.max(d.x,u.x),M=Math.min(d.y,u.y),A=Math.max(d.y,u.y);L.setTransform(this._box,`translate(${_}px,${M}px)`),this._box.style.width=w-_+"px",this._box.style.height=A-M+"px"}mouseupWindow(i,o){if(!this._active||i.button!==0)return;const u=this._startPos,d=o;if(this.reset(),L.suppressClick(),u.x!==d.x||u.y!==d.y)return this._map.fire(new l.k("boxzoomend",{originalEvent:i})),{cameraAnimation:_=>_.fitScreenCoordinates(u,d,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",i)}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(L.remove(this._box),this._box=null),L.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(i,o){return this._map.fire(new l.k(i,{originalEvent:o}))}}function Nn(g,i){if(g.length!==i.length)throw new Error(`The number of touches and points are not equal - touches ${g.length}, points ${i.length}`);const o={};for(let u=0;u<g.length;u++)o[g[u].identifier]=i[u];return o}class Tf{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(i,o,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),u.length===this.numTouches&&(this.centroid=function(d){const _=new l.P(0,0);for(const w of d)_._add(w);return _.div(d.length)}(o),this.touches=Nn(u,o)))}touchmove(i,o,u){if(this.aborted||!this.centroid)return;const d=Nn(u,o);for(const _ in this.touches){const w=d[_];(!w||w.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(i,o,u){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const d=!this.aborted&&this.centroid;if(this.reset(),d)return d}}}class mc{constructor(i){this.singleTap=new Tf(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(i,o,u){this.singleTap.touchstart(i,o,u)}touchmove(i,o,u){this.singleTap.touchmove(i,o,u)}touchend(i,o,u){const d=this.singleTap.touchend(i,o,u);if(d){const _=i.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(d)<30;if(_&&w||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class Af{constructor(i){this._tr=new ca(i),this._zoomIn=new mc({numTouches:1,numTaps:2}),this._zoomOut=new mc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,o,u){this._zoomIn.touchstart(i,o,u),this._zoomOut.touchstart(i,o,u)}touchmove(i,o,u){this._zoomIn.touchmove(i,o,u),this._zoomOut.touchmove(i,o,u)}touchend(i,o,u){const d=this._zoomIn.touchend(i,o,u),_=this._zoomOut.touchend(i,o,u),w=this._tr;return d?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:w.zoom+1,around:w.unproject(d)},{originalEvent:i})}):_?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:w.zoom-1,around:w.unproject(_)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ha{constructor(i){this._enabled=!!i.enable,this._moveStateManager=i.moveStateManager,this._clickTolerance=i.clickTolerance||1,this._moveFunction=i.move,this._activateOnStart=!!i.activateOnStart,i.assignEvents(this),this.reset()}reset(i){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(i)}_move(...i){const o=this._moveFunction(...i);if(o.bearingDelta||o.pitchDelta||o.around||o.panDelta)return this._active=!0,o}dragStart(i,o){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(i)&&(this._moveStateManager.startMove(i),this._lastPoint=o.length?o[0]:o,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(i,o){if(!this.isEnabled())return;const u=this._lastPoint;if(!u)return;if(i.preventDefault(),!this._moveStateManager.isValidMoveEvent(i))return void this.reset(i);const d=o.length?o[0]:o;return!this._moved&&d.dist(u)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=d,this._move(u,d))}dragEnd(i){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(i)&&(this._moved&&L.suppressClick(),this.reset(i))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Ya={0:1,2:2};class Ur{constructor(i){this._correctEvent=i.checkCorrectEvent}startMove(i){const o=L.mouseButton(i);this._eventButton=o}endMove(i){delete this._eventButton}isValidStartEvent(i){return this._correctEvent(i)}isValidMoveEvent(i){return!function(o,u){const d=Ya[u];return o.buttons===void 0||(o.buttons&d)!==d}(i,this._eventButton)}isValidEndEvent(i){return L.mouseButton(i)===this._eventButton}}class he{constructor(){this._firstTouch=void 0}_isOneFingerTouch(i){return i.targetTouches.length===1}_isSameTouchEvent(i){return i.targetTouches[0].identifier===this._firstTouch}startMove(i){this._firstTouch=i.targetTouches[0].identifier}endMove(i){delete this._firstTouch}isValidStartEvent(i){return this._isOneFingerTouch(i)}isValidMoveEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}isValidEndEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}}const Jo=g=>{g.mousedown=g.dragStart,g.mousemoveWindow=g.dragMove,g.mouseup=g.dragEnd,g.contextmenu=function(i){i.preventDefault()}},ua=({enable:g,clickTolerance:i,bearingDegreesPerPixelMoved:o=.8})=>{const u=new Ur({checkCorrectEvent:d=>L.mouseButton(d)===0&&d.ctrlKey||L.mouseButton(d)===2});return new ha({clickTolerance:i,move:(d,_)=>({bearingDelta:(_.x-d.x)*o}),moveStateManager:u,enable:g,assignEvents:Jo})},da=({enable:g,clickTolerance:i,pitchDegreesPerPixelMoved:o=-.5})=>{const u=new Ur({checkCorrectEvent:d=>L.mouseButton(d)===0&&d.ctrlKey||L.mouseButton(d)===2});return new ha({clickTolerance:i,move:(d,_)=>({pitchDelta:(_.y-d.y)*o}),moveStateManager:u,enable:g,assignEvents:Jo})};class mu{constructor(i,o){this._clickTolerance=i.clickTolerance||1,this._map=o,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(i,o,u){return this._calculateTransform(i,o,u)}touchmove(i,o,u){if(this._active&&!(u.length<this.minTouchs()))return i.preventDefault(),this._calculateTransform(i,o,u)}touchend(i,o,u){this._calculateTransform(i,o,u),this._active&&u.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,o,u){u.length>0&&(this._active=!0);const d=Nn(u,o),_=new l.P(0,0),w=new l.P(0,0);let M=0;for(const C in d){const z=d[C],O=this._touches[C];O&&(_._add(z),w._add(z.sub(O)),M++,d[C]=z)}if(this._touches=d,M<this.minTouchs()||!w.mag())return;const A=w.div(M);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(M),panDelta:A}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ie{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(i,o,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([o[0],o[1]]))}touchmove(i,o,u){if(!this._firstTwoTouches)return;i.preventDefault();const[d,_]=this._firstTwoTouches,w=fa(u,o,d),M=fa(u,o,_);if(!w||!M)return;const A=this._aroundCenter?null:w.add(M).div(2);return this._move([w,M],A,i)}touchend(i,o,u){if(!this._firstTwoTouches)return;const[d,_]=this._firstTwoTouches,w=fa(u,o,d),M=fa(u,o,_);w&&M||(this._active&&L.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function fa(g,i,o){for(let u=0;u<g.length;u++)if(g[u].identifier===o)return i[u]}function gu(g,i){return Math.log(g/i)/Math.LN2}class _u extends ie{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,o){const u=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(gu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:gu(this._distance,u),pinchAround:o}}}function Qo(g,i){return 180*g.angleWith(i)/Math.PI}class gc extends ie{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,o,u){const d=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Qo(this._vector,d),pinchAround:o}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const o=25/(Math.PI*this._minDiameter)*360,u=Qo(i,this._startVector);return Math.abs(u)<o}}function tl(g){return Math.abs(g.y)>Math.abs(g.x)}class yu extends ie{constructor(i){super(),this._currentTouchCount=0,this._map=i}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(i,o,u){super.touchstart(i,o,u),this._currentTouchCount=u.length}_start(i){this._lastPoints=i,tl(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,o,u){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const d=i[0].sub(this._lastPoints[0]),_=i[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(d,_,u.timeStamp),this._valid?(this._lastPoints=i,this._active=!0,{pitchDelta:(d.y+_.y)/2*-.5}):void 0}gestureBeginsVertically(i,o,u){if(this._valid!==void 0)return this._valid;const d=i.mag()>=2,_=o.mag()>=2;if(!d&&!_)return;if(!d||!_)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;const w=i.y>0==o.y>0;return tl(i)&&tl(o)&&w}}const Ef={panStep:100,bearingStep:15,pitchStep:10};class mn{constructor(i){this._tr=new ca(i);const o=Ef;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let o=0,u=0,d=0,_=0,w=0;switch(i.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:i.shiftKey?u=-1:(i.preventDefault(),_=-1);break;case 39:i.shiftKey?u=1:(i.preventDefault(),_=1);break;case 38:i.shiftKey?d=1:(i.preventDefault(),w=-1);break;case 40:i.shiftKey?d=-1:(i.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(u=0,d=0),{cameraAnimation:M=>{const A=this._tr;M.easeTo({duration:300,easeId:"keyboardHandler",easing:Di,zoom:o?Math.round(A.zoom)+o*(i.shiftKey?2:1):A.zoom,bearing:A.bearing+u*this._bearingStep,pitch:A.pitch+d*this._pitchStep,offset:[-_*this._panStep,-w*this._panStep],center:A.center},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Di(g){return g*(2-g)}const Ja=4.000244140625;class el{constructor(i,o){this._onTimeout=u=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},this._map=i,this._tr=new ca(i),this._triggerRenderFrame=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(i){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!i[this._map.cooperativeGestures._bypassKey])return;let o=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const u=P.now(),d=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,o!==0&&o%Ja==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(d*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),i.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=i,this._delta-=o,this._active||this._start(i)),i.preventDefault()}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=L.mousePos(this._map.getCanvas(),i),u=this._tr;this._around=o.y>u.transform.height/2-u.transform.getHorizon()?l.M.convert(this._aroundCenter?u.center:u.unproject(o)):l.M.convert(u.center),this._aroundPoint=u.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._tr.transform;if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>Ja?this._wheelZoomRate:this._defaultZoomRate;let A=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&A!==0&&(A=1/A);const C=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):i.scale;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(C*A))),this._type==="wheel"&&(this._startZoom=i.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const o=typeof this._targetZoom=="number"?this._targetZoom:i.zoom,u=this._startZoom,d=this._easing;let _,w=!1;if(this._type==="wheel"&&u&&d){const M=Math.min((P.now()-this._lastWheelEventTime)/200,1),A=d(M);_=l.z.number(u,o,A),M<1?this._frameId||(this._frameId=!0):w=!0}else _=o,w=!0;return this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!w,zoomDelta:_-i.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let o=l.b7;if(this._prevEase){const u=this._prevEase,d=(P.now()-u.start)/u.duration,_=u.easing(d+.01)-u.easing(d),w=.27/Math.sqrt(_*_+1e-4)*.01,M=Math.sqrt(.0729-w*w);o=l.b6(w,M,.25,1)}return this._prevEase={start:P.now(),duration:i,easing:o},o}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class _c{constructor(i,o){this._clickZoom=i,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class vu{constructor(i){this._tr=new ca(i),this.reset()}reset(){this._active=!1}dblclick(i,o){return i.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:this._tr.zoom+(i.shiftKey?-1:1),around:this._tr.unproject(o)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xu{constructor(){this._tap=new mc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(i,o,u){if(!this._swipePoint)if(this._tapTime){const d=o[0],_=i.timeStamp-this._tapTime<500,w=this._tapPoint.dist(d)<30;_&&w?u.length>0&&(this._swipePoint=d,this._swipeTouch=u[0].identifier):this.reset()}else this._tap.touchstart(i,o,u)}touchmove(i,o,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const d=o[0],_=d.y-this._swipePoint.y;return this._swipePoint=d,i.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(i,o,u)}touchend(i,o,u){if(this._tapTime)this._swipePoint&&u.length===0&&this.reset();else{const d=this._tap.touchend(i,o,u);d&&(this._tapTime=i.timeStamp,this._tapPoint=d)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bu{constructor(i,o,u){this._el=i,this._mousePan=o,this._touchPan=u}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Cr{constructor(i,o,u){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=o,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Qa{constructor(i,o,u,d){this._el=i,this._touchZoom=o,this._touchRotate=u,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class ve{constructor(i,o){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=i,this._options=o,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const i=this._map.getCanvasContainer();i.classList.add("maplibregl-cooperative-gestures"),this._container=L.create("div","maplibregl-cooperative-gesture-screen",i);let o=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(o=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const u=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),d=document.createElement("div");d.className="maplibregl-desktop-message",d.textContent=o,this._container.appendChild(d);const _=document.createElement("div");_.className="maplibregl-mobile-message",_.textContent=u,this._container.appendChild(_),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(L.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(i){this._onCooperativeGesture(i.touches.length===1)}wheel(i){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!i[this._bypassKey])}_onCooperativeGesture(i){this._enabled&&i&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Te=g=>g.zoom||g.drag||g.pitch||g.rotate;class il extends l.k{}function to(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class yc{constructor(i,o){this.handleWindowEvent=d=>{this.handleEvent(d,`${d.type}Window`)},this.handleEvent=(d,_)=>{if(d.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const w=d.type==="renderFrame"?void 0:d,M={needsRenderFrame:!1},A={},C={},z=d.touches,O=z?this._getMapTouches(z):void 0,V=O?L.touchPos(this._map.getCanvas(),O):L.mousePos(this._map.getCanvas(),d);for(const{handlerName:J,handler:j,allowed:lt}of this._handlers){if(!j.isEnabled())continue;let xt;this._blockedByActive(C,lt,J)?j.reset():j[_||d.type]&&(xt=j[_||d.type](d,V,O),this.mergeHandlerResult(M,A,xt,J,w),xt&&xt.needsRenderFrame&&this._triggerRenderFrame()),(xt||j.isActive())&&(C[J]=j)}const Z={};for(const J in this._previousActiveHandlers)C[J]||(Z[J]=w);this._previousActiveHandlers=C,(Object.keys(Z).length||to(M))&&(this._changes.push([M,A,Z]),this._triggerRenderFrame()),(Object.keys(C).length||to(M))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:W}=M;W&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],W(this._map))},this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new pu(i),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(o);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[d,_,w]of this._listeners)L.addEventListener(d,_,d===document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[i,o,u]of this._listeners)L.removeEventListener(i,o,i===document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(i){const o=this._map,u=o.getCanvasContainer();this._add("mapEvent",new Ir(o,i));const d=o.boxZoom=new Pr(o,i);this._add("boxZoom",d),i.interactive&&i.boxZoom&&d.enable();const _=o.cooperativeGestures=new ve(o,i.cooperativeGestures);this._add("cooperativeGestures",_),i.cooperativeGestures&&_.enable();const w=new Af(o),M=new vu(o);o.doubleClickZoom=new _c(M,w),this._add("tapZoom",w),this._add("clickZoom",M),i.interactive&&i.doubleClickZoom&&o.doubleClickZoom.enable();const A=new xu;this._add("tapDragZoom",A);const C=o.touchPitch=new yu(o);this._add("touchPitch",C),i.interactive&&i.touchPitch&&o.touchPitch.enable(i.touchPitch);const z=ua(i),O=da(i);o.dragRotate=new Cr(i,z,O),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",O,["mouseRotate"]),i.interactive&&i.dragRotate&&o.dragRotate.enable();const V=(({enable:xt,clickTolerance:et})=>{const pt=new Ur({checkCorrectEvent:bt=>L.mouseButton(bt)===0&&!bt.ctrlKey});return new ha({clickTolerance:et,move:(bt,wt)=>({around:wt,panDelta:wt.sub(bt)}),activateOnStart:!0,moveStateManager:pt,enable:xt,assignEvents:Jo})})(i),Z=new mu(i,o);o.dragPan=new bu(u,V,Z),this._add("mousePan",V),this._add("touchPan",Z,["touchZoom","touchRotate"]),i.interactive&&i.dragPan&&o.dragPan.enable(i.dragPan);const W=new gc,J=new _u;o.touchZoomRotate=new Qa(u,J,W,A),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",J,["touchPan","touchRotate"]),i.interactive&&i.touchZoomRotate&&o.touchZoomRotate.enable(i.touchZoomRotate);const j=o.scrollZoom=new el(o,()=>this._triggerRenderFrame());this._add("scrollZoom",j,["mousePan"]),i.interactive&&i.scrollZoom&&o.scrollZoom.enable(i.scrollZoom);const lt=o.keyboard=new mn(o);this._add("keyboard",lt),i.interactive&&i.keyboard&&o.keyboard.enable(),this._add("blockableMapEvent",new Vr(o))}_add(i,o,u){this._handlers.push({handlerName:i,handler:o,allowed:u}),this._handlersById[i]=o}stop(i){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Te(this._eventsInProgress)||this.isZooming()}_blockedByActive(i,o,u){for(const d in i)if(d!==u&&(!o||o.indexOf(d)<0))return!0;return!1}_getMapTouches(i){const o=[];for(const u of i)this._el.contains(u.target)&&o.push(u);return o}mergeHandlerResult(i,o,u,d,_){if(!u)return;l.e(i,u);const w={handlerName:d,originalEvent:u.originalEvent||_};u.zoomDelta!==void 0&&(o.zoom=w),u.panDelta!==void 0&&(o.drag=w),u.pitchDelta!==void 0&&(o.pitch=w),u.bearingDelta!==void 0&&(o.rotate=w)}_applyChanges(){const i={},o={},u={};for(const[d,_,w]of this._changes)d.panDelta&&(i.panDelta=(i.panDelta||new l.P(0,0))._add(d.panDelta)),d.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+d.pitchDelta),d.around!==void 0&&(i.around=d.around),d.pinchAround!==void 0&&(i.pinchAround=d.pinchAround),d.noInertia&&(i.noInertia=d.noInertia),l.e(o,_),l.e(u,w);this._updateMapTransform(i,o,u),this._changes=[]}_updateMapTransform(i,o,u){const d=this._map,_=d._getTransformForUpdate(),w=d.terrain;if(!(to(i)||w&&this._terrainMovement))return this._fireEvents(o,u,!0);let{panDelta:M,zoomDelta:A,bearingDelta:C,pitchDelta:z,around:O,pinchAround:V}=i;V!==void 0&&(O=V),d._stop(!0),O=O||d.transform.centerPoint;const Z=_.pointLocation(M?O.sub(M):O);C&&(_.bearing+=C),z&&(_.pitch+=z),A&&(_.zoom+=A),w?this._terrainMovement||!o.drag&&!o.zoom?o.drag&&this._terrainMovement?_.center=_.pointLocation(_.centerPoint.sub(M)):_.setLocationAtPoint(Z,O):(this._terrainMovement=!0,this._map._elevationFreeze=!0,_.setLocationAtPoint(Z,O),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,_.recalculateZoom(d.terrain)})):_.setLocationAtPoint(Z,O),d._applyUpdatedTransform(_),this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(o,u,!0)}_fireEvents(i,o,u){const d=Te(this._eventsInProgress),_=Te(i),w={};for(const z in i){const{originalEvent:O}=i[z];this._eventsInProgress[z]||(w[`${z}start`]=O),this._eventsInProgress[z]=i[z]}!d&&_&&this._fireEvent("movestart",_.originalEvent);for(const z in w)this._fireEvent(z,w[z]);_&&this._fireEvent("move",_.originalEvent);for(const z in i){const{originalEvent:O}=i[z];this._fireEvent(z,O)}const M={};let A;for(const z in this._eventsInProgress){const{handlerName:O,originalEvent:V}=this._eventsInProgress[z];this._handlersById[O].isActive()||(delete this._eventsInProgress[z],A=o[O]||V,M[`${z}end`]=A)}for(const z in M)this._fireEvent(z,M[z]);const C=Te(this._eventsInProgress);if(u&&(d||_)&&!C){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=V=>V!==0&&-this._bearingSnap<V&&V<this._bearingSnap;!z||!z.essential&&P.prefersReducedMotion?(this._map.fire(new l.k("moveend",{originalEvent:A})),O(this._map.getBearing())&&this._map.resetNorth()):(O(z.bearing||this._map.getBearing())&&(z.bearing=0),z.freezeElevation=!0,this._map.easeTo(z,{originalEvent:A})),this._updatingCamera=!1}}_fireEvent(i,o){this._map.fire(new l.k(i,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{delete this._frameId,this.handleEvent(new il("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Hs extends l.E{constructor(i,o){super(),this._renderFrameCallback=()=>{const u=Math.min((P.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(u)),u<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=o.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new l.M(this.transform.center.lng,this.transform.center.lat)}setCenter(i,o){return this.jumpTo({center:i},o)}panBy(i,o,u){return i=l.P.convert(i).mult(-1),this.panTo(this.transform.center,l.e({offset:i},o),u)}panTo(i,o,u){return this.easeTo(l.e({center:i},o),u)}getZoom(){return this.transform.zoom}setZoom(i,o){return this.jumpTo({zoom:i},o),this}zoomTo(i,o,u){return this.easeTo(l.e({zoom:i},o),u)}zoomIn(i,o){return this.zoomTo(this.getZoom()+1,i,o),this}zoomOut(i,o){return this.zoomTo(this.getZoom()-1,i,o),this}getBearing(){return this.transform.bearing}setBearing(i,o){return this.jumpTo({bearing:i},o),this}getPadding(){return this.transform.padding}setPadding(i,o){return this.jumpTo({padding:i},o),this}rotateTo(i,o,u){return this.easeTo(l.e({bearing:i},o),u)}resetNorth(i,o){return this.rotateTo(0,l.e({duration:1e3},i),o),this}resetNorthPitch(i,o){return this.easeTo(l.e({bearing:0,pitch:0,duration:1e3},i),o),this}snapToNorth(i,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,o):this}getPitch(){return this.transform.pitch}setPitch(i,o){return this.jumpTo({pitch:i},o),this}cameraForBounds(i,o){i=rt.convert(i);const u=o&&o.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),u,o)}_cameraForBoxAndBearing(i,o,u,d){const _={top:0,bottom:0,right:0,left:0};if(typeof(d=l.e({padding:_,offset:[0,0],maxZoom:this.transform.maxZoom},d)).padding=="number"){const Xt=d.padding;d.padding={top:Xt,bottom:Xt,right:Xt,left:Xt}}d.padding=l.e(_,d.padding);const w=this.transform,M=w.padding,A=new rt(i,o),C=w.project(A.getNorthWest()),z=w.project(A.getNorthEast()),O=w.project(A.getSouthEast()),V=w.project(A.getSouthWest()),Z=l.b8(-u),W=C.rotate(Z),J=z.rotate(Z),j=O.rotate(Z),lt=V.rotate(Z),xt=new l.P(Math.max(W.x,J.x,lt.x,j.x),Math.max(W.y,J.y,lt.y,j.y)),et=new l.P(Math.min(W.x,J.x,lt.x,j.x),Math.min(W.y,J.y,lt.y,j.y)),pt=xt.sub(et),bt=(w.width-(M.left+M.right+d.padding.left+d.padding.right))/pt.x,wt=(w.height-(M.top+M.bottom+d.padding.top+d.padding.bottom))/pt.y;if(wt<0||bt<0)return void l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const St=Math.min(w.scaleZoom(w.scale*Math.min(bt,wt)),d.maxZoom),Bt=l.P.convert(d.offset),Ot=new l.P((d.padding.left-d.padding.right)/2,(d.padding.top-d.padding.bottom)/2).rotate(l.b8(u)),Wt=Bt.add(Ot).mult(w.scale/w.zoomScale(St));return{center:w.unproject(C.add(O).div(2).sub(Wt)),zoom:St,bearing:u}}fitBounds(i,o,u){return this._fitInternal(this.cameraForBounds(i,o),o,u)}fitScreenCoordinates(i,o,u,d,_){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.P.convert(i)),this.transform.pointLocation(l.P.convert(o)),u,d),d,_)}_fitInternal(i,o,u){return i?(delete(o=l.e(i,o)).padding,o.linear?this.easeTo(o,u):this.flyTo(o,u)):this}jumpTo(i,o){this.stop();const u=this._getTransformForUpdate();let d=!1,_=!1,w=!1;return"zoom"in i&&u.zoom!==+i.zoom&&(d=!0,u.zoom=+i.zoom),i.center!==void 0&&(u.center=l.M.convert(i.center)),"bearing"in i&&u.bearing!==+i.bearing&&(_=!0,u.bearing=+i.bearing),"pitch"in i&&u.pitch!==+i.pitch&&(w=!0,u.pitch=+i.pitch),i.padding==null||u.isPaddingEqual(i.padding)||(u.padding=i.padding),this._applyUpdatedTransform(u),this.fire(new l.k("movestart",o)).fire(new l.k("move",o)),d&&this.fire(new l.k("zoomstart",o)).fire(new l.k("zoom",o)).fire(new l.k("zoomend",o)),_&&this.fire(new l.k("rotatestart",o)).fire(new l.k("rotate",o)).fire(new l.k("rotateend",o)),w&&this.fire(new l.k("pitchstart",o)).fire(new l.k("pitch",o)).fire(new l.k("pitchend",o)),this.fire(new l.k("moveend",o))}calculateCameraOptionsFromTo(i,o,u,d=0){const _=l.Y.fromLngLat(i,o),w=l.Y.fromLngLat(u,d),M=w.x-_.x,A=w.y-_.y,C=w.z-_.z,z=Math.hypot(M,A,C);if(z===0)throw new Error("Can't calculate camera options with same From and To");const O=Math.hypot(M,A),V=this.transform.scaleZoom(this.transform.cameraToCenterDistance/z/this.transform.tileSize),Z=180*Math.atan2(M,-A)/Math.PI;let W=180*Math.acos(O/z)/Math.PI;return W=C<0?90-W:90+W,{center:w.toLngLat(),zoom:V,pitch:W,bearing:Z}}easeTo(i,o){var u;this._stop(!1,i.easeId),((i=l.e({offset:[0,0],duration:500,easing:l.b7},i)).animate===!1||!i.essential&&P.prefersReducedMotion)&&(i.duration=0);const d=this._getTransformForUpdate(),_=this.getZoom(),w=this.getBearing(),M=this.getPitch(),A=this.getPadding(),C="bearing"in i?this._normalizeBearing(i.bearing,w):w,z="pitch"in i?+i.pitch:M,O="padding"in i?i.padding:d.padding,V=l.P.convert(i.offset);let Z=d.centerPoint.add(V);const W=d.pointLocation(Z),{center:J,zoom:j}=d.getConstrained(l.M.convert(i.center||W),(u=i.zoom)!==null&&u!==void 0?u:_);this._normalizeCenter(J);const lt=d.project(W),xt=d.project(J).sub(lt),et=d.zoomScale(j-_);let pt,bt;i.around&&(pt=l.M.convert(i.around),bt=d.locationPoint(pt));const wt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||j!==_,this._rotating=this._rotating||w!==C,this._pitching=this._pitching||z!==M,this._padding=!d.isPaddingEqual(O),this._easeId=i.easeId,this._prepareEase(o,i.noMoveStart,wt),this.terrain&&this._prepareElevation(J),this._ease(St=>{if(this._zooming&&(d.zoom=l.z.number(_,j,St)),this._rotating&&(d.bearing=l.z.number(w,C,St)),this._pitching&&(d.pitch=l.z.number(M,z,St)),this._padding&&(d.interpolatePadding(A,O,St),Z=d.centerPoint.add(V)),this.terrain&&!i.freezeElevation&&this._updateElevation(St),pt)d.setLocationAtPoint(pt,bt);else{const Bt=d.zoomScale(d.zoom-_),Ot=j>_?Math.min(2,et):Math.max(.5,et),Wt=Math.pow(Ot,1-St),Xt=d.unproject(lt.add(xt.mult(St*Wt)).mult(Bt));d.setLocationAtPoint(d.renderWorldCopies?Xt.wrap():Xt,Z)}this._applyUpdatedTransform(d),this._fireMoveEvents(o)},St=>{this.terrain&&this._finalizeElevation(),this._afterEase(o,St)},i),this}_prepareEase(i,o,u={}){this._moving=!0,o||u.moving||this.fire(new l.k("movestart",i)),this._zooming&&!u.zooming&&this.fire(new l.k("zoomstart",i)),this._rotating&&!u.rotating&&this.fire(new l.k("rotatestart",i)),this._pitching&&!u.pitching&&this.fire(new l.k("pitchstart",i))}_prepareElevation(i){this._elevationCenter=i,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(i){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const o=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(i<1&&o!==this._elevationTarget){const u=this._elevationTarget-this._elevationStart;this._elevationStart+=i*(u-(o-(u*i+this._elevationStart))/(1-i)),this._elevationTarget=o}this.transform.elevation=l.z.number(this._elevationStart,this._elevationTarget,i)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(i){if(!this.transformCameraUpdate)return;const o=i.clone(),{center:u,zoom:d,pitch:_,bearing:w,elevation:M}=this.transformCameraUpdate(o);u&&(o.center=u),d!==void 0&&(o.zoom=d),_!==void 0&&(o.pitch=_),w!==void 0&&(o.bearing=w),M!==void 0&&(o.elevation=M),this.transform.apply(o)}_fireMoveEvents(i){this.fire(new l.k("move",i)),this._zooming&&this.fire(new l.k("zoom",i)),this._rotating&&this.fire(new l.k("rotate",i)),this._pitching&&this.fire(new l.k("pitch",i))}_afterEase(i,o){if(this._easeId&&o&&this._easeId===o)return;delete this._easeId;const u=this._zooming,d=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new l.k("zoomend",i)),d&&this.fire(new l.k("rotateend",i)),_&&this.fire(new l.k("pitchend",i)),this.fire(new l.k("moveend",i))}flyTo(i,o){var u;if(!i.essential&&P.prefersReducedMotion){const ei=l.L(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ei,o)}this.stop(),i=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.b7},i);const d=this._getTransformForUpdate(),_=this.getZoom(),w=this.getBearing(),M=this.getPitch(),A=this.getPadding(),C="bearing"in i?this._normalizeBearing(i.bearing,w):w,z="pitch"in i?+i.pitch:M,O="padding"in i?i.padding:d.padding,V=l.P.convert(i.offset);let Z=d.centerPoint.add(V);const W=d.pointLocation(Z),{center:J,zoom:j}=d.getConstrained(l.M.convert(i.center||W),(u=i.zoom)!==null&&u!==void 0?u:_);this._normalizeCenter(J);const lt=d.zoomScale(j-_),xt=d.project(W),et=d.project(J).sub(xt);let pt=i.curve;const bt=Math.max(d.width,d.height),wt=bt/lt,St=et.mag();if("minZoom"in i){const ei=l.ac(Math.min(i.minZoom,_,j),d.minZoom,d.maxZoom),Ce=bt/d.zoomScale(ei-_);pt=Math.sqrt(Ce/St*2)}const Bt=pt*pt;function Ot(ei){const Ce=(wt*wt-bt*bt+(ei?-1:1)*Bt*Bt*St*St)/(2*(ei?wt:bt)*Bt*St);return Math.log(Math.sqrt(Ce*Ce+1)-Ce)}function Wt(ei){return(Math.exp(ei)-Math.exp(-ei))/2}function Xt(ei){return(Math.exp(ei)+Math.exp(-ei))/2}const $e=Ot(!1);let Qt=function(ei){return Xt($e)/Xt($e+pt*ei)},Ee=function(ei){return bt*((Xt($e)*(Wt(Ce=$e+pt*ei)/Xt(Ce))-Wt($e))/Bt)/St;var Ce},Ve=(Ot(!0)-$e)/pt;if(Math.abs(St)<1e-6||!isFinite(Ve)){if(Math.abs(bt-wt)<1e-6)return this.easeTo(i,o);const ei=wt<bt?-1:1;Ve=Math.abs(Math.log(wt/bt))/pt,Ee=function(){return 0},Qt=function(Ce){return Math.exp(ei*pt*Ce)}}return i.duration="duration"in i?+i.duration:1e3*Ve/("screenSpeed"in i?+i.screenSpeed/pt:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0),this._zooming=!0,this._rotating=w!==C,this._pitching=z!==M,this._padding=!d.isPaddingEqual(O),this._prepareEase(o,!1),this.terrain&&this._prepareElevation(J),this._ease(ei=>{const Ce=ei*Ve,qe=1/Qt(Ce);d.zoom=ei===1?j:_+d.scaleZoom(qe),this._rotating&&(d.bearing=l.z.number(w,C,ei)),this._pitching&&(d.pitch=l.z.number(M,z,ei)),this._padding&&(d.interpolatePadding(A,O,ei),Z=d.centerPoint.add(V)),this.terrain&&!i.freezeElevation&&this._updateElevation(ei);const He=ei===1?J:d.unproject(xt.add(et.mult(Ee(Ce))).mult(qe));d.setLocationAtPoint(d.renderWorldCopies?He.wrap():He,Z),this._applyUpdatedTransform(d),this._fireMoveEvents(o)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(o)},i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const u=this._onEaseEnd;delete this._onEaseEnd,u.call(this,o)}if(!i){const u=this.handlers;u&&u.stop(!1)}return this}_ease(i,o,u){u.animate===!1||u.duration===0?(i(1),o()):(this._easeStart=P.now(),this._easeOptions=u,this._onEaseFrame=i,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(i,o){i=l.b1(i,-180,180);const u=Math.abs(i-o);return Math.abs(i-360-o)<u&&(i-=360),Math.abs(i+360-o)<u&&(i+=360),i}_normalizeCenter(i){const o=this.transform;if(!o.renderWorldCopies||o.lngRange)return;const u=i.lng-o.center.lng;i.lng+=u>180?-360:u<-180?360:0}queryTerrainElevation(i){return this.terrain?this.terrain.getElevationForLngLatZoom(l.M.convert(i),this.transform.tileZoom)-this.transform.elevation:null}}const vc={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Dr{constructor(i=vc){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=o=>{!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"&&o.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=i}getDefaultPosition(){return"bottom-right"}onAdd(i){return this._map=i,this._compact=this.options.compact,this._container=L.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=L.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=L.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){L.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(i,o){const u=this._map._getUIString(`AttributionControl.${o}`);i.title=u,i.setAttribute("aria-label",u)}_updateAttributions(){if(!this._map.style)return;let i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map(d=>typeof d!="string"?"":d)):typeof this.options.customAttribution=="string"&&i.push(this.options.customAttribution)),this._map.style.stylesheet){const d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}const o=this._map.style.sourceCaches;for(const d in o){const _=o[d];if(_.used||_.usedForTerrain){const w=_.getSource();w.attribution&&i.indexOf(w.attribution)<0&&i.push(w.attribution)}}i=i.filter(d=>String(d).trim()),i.sort((d,_)=>d.length-_.length),i=i.filter((d,_)=>{for(let w=_+1;w<i.length;w++)if(i[w].indexOf(d)>=0)return!1;return!0});const u=i.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,i.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class wu{constructor(i={}){this._updateCompact=()=>{const o=this._container.children;if(o.length){const u=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&u.classList.add("maplibregl-compact"):u.classList.remove("maplibregl-compact")}},this.options=i}getDefaultPosition(){return"bottom-left"}onAdd(i){this._map=i,this._compact=this.options&&this.options.compact,this._container=L.create("div","maplibregl-ctrl");const o=L.create("a","maplibregl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://maplibre.org/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){L.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class eo{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const o=++this._id;return this._queue.push({callback:i,id:o,cancelled:!1}),o}remove(i){const o=this._currentlyRunning,u=o?this._queue.concat(o):this._queue;for(const d of u)if(d.id===i)return void(d.cancelled=!0)}run(i=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const o=this._currentlyRunning=this._queue;this._queue=[];for(const u of o)if(!u.cancelled&&(u.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Vi=l.X([{name:"a_pos3d",type:"Int16",components:3}]);class Xi extends l.E{constructor(i){super(),this.sourceCache=i,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,i.usedForTerrain=!0,i.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(i,o){this.sourceCache.update(i,o),this._renderableTilesKeys=[];const u={};for(const d of i.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:o}))u[d.key]=!0,this._renderableTilesKeys.push(d.key),this._tiles[d.key]||(d.posMatrix=new Float64Array(16),l.aN(d.posMatrix,0,l.W,0,l.W,0,1),this._tiles[d.key]=new _i(d,this.tileSize));for(const d in this._tiles)u[d]||delete this._tiles[d]}freeRtt(i){for(const o in this._tiles){const u=this._tiles[o];(!i||u.tileID.equals(i)||u.tileID.isChildOf(i)||i.isChildOf(u.tileID))&&(u.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(i=>this.getTileByID(i))}getTileByID(i){return this._tiles[i]}getTerrainCoords(i){const o={};for(const u of this._renderableTilesKeys){const d=this._tiles[u].tileID;if(d.canonical.equals(i.canonical)){const _=i.clone();_.posMatrix=new Float64Array(16),l.aN(_.posMatrix,0,l.W,0,l.W,0,1),o[u]=_}else if(d.canonical.isChildOf(i.canonical)){const _=i.clone();_.posMatrix=new Float64Array(16);const w=d.canonical.z-i.canonical.z,M=d.canonical.x-(d.canonical.x>>w<<w),A=d.canonical.y-(d.canonical.y>>w<<w),C=l.W>>w;l.aN(_.posMatrix,0,C,0,C,0,1),l.H(_.posMatrix,_.posMatrix,[-M*C,-A*C,0]),o[u]=_}else if(i.canonical.isChildOf(d.canonical)){const _=i.clone();_.posMatrix=new Float64Array(16);const w=i.canonical.z-d.canonical.z,M=i.canonical.x-(i.canonical.x>>w<<w),A=i.canonical.y-(i.canonical.y>>w<<w),C=l.W>>w;l.aN(_.posMatrix,0,l.W,0,l.W,0,1),l.H(_.posMatrix,_.posMatrix,[M*C,A*C,0]),l.J(_.posMatrix,_.posMatrix,[1/2**w,1/2**w,0]),o[u]=_}}return o}getSourceTile(i,o){const u=this.sourceCache._source;let d=i.overscaledZ-this.deltaZoom;if(d>u.maxzoom&&(d=u.maxzoom),d<u.minzoom)return null;this._sourceTileCache[i.key]||(this._sourceTileCache[i.key]=i.scaledTo(d).key);let _=this.sourceCache.getTileByID(this._sourceTileCache[i.key]);if((!_||!_.dem)&&o)for(;d>=u.minzoom&&(!_||!_.dem);)_=this.sourceCache.getTileByID(i.scaledTo(d--).key);return _}tilesAfterTime(i=Date.now()){return Object.values(this._tiles).filter(o=>o.timeAdded>=i)}}class Mu{constructor(i,o,u){this.painter=i,this.sourceCache=new Xi(o),this.options=u,this.exaggeration=typeof u.exaggeration=="number"?u.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(i,o,u,d=l.W){var _;if(!(o>=0&&o<d&&u>=0&&u<d))return 0;const w=this.getTerrainData(i),M=(_=w.tile)===null||_===void 0?void 0:_.dem;if(!M)return 0;const A=function(W,J,j){var lt=J[0],xt=J[1];return W[0]=j[0]*lt+j[4]*xt+j[12],W[1]=j[1]*lt+j[5]*xt+j[13],W}([],[o/d*l.W,u/d*l.W],w.u_terrain_matrix),C=[A[0]*M.dim,A[1]*M.dim],z=Math.floor(C[0]),O=Math.floor(C[1]),V=C[0]-z,Z=C[1]-O;return M.get(z,O)*(1-V)*(1-Z)+M.get(z+1,O)*V*(1-Z)+M.get(z,O+1)*(1-V)*Z+M.get(z+1,O+1)*V*Z}getElevationForLngLatZoom(i,o){const{tileID:u,mercatorX:d,mercatorY:_}=this._getOverscaledTileIDFromLngLatZoom(i,o);return this.getElevation(u,d%l.W,_%l.W,l.W)}getElevation(i,o,u,d=l.W){return this.getDEMElevation(i,o,u,d)*this.exaggeration}getTerrainData(i){if(!this._emptyDemTexture){const d=this.painter.context,_=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Dt(d,_,d.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Dt(d,new l.R({width:1,height:1}),d.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.an([])}const o=this.sourceCache.getSourceTile(i,!0);if(o&&o.dem&&(!o.demTexture||o.needsTerrainPrepare)){const d=this.painter.context;o.demTexture=this.painter.getTileTexture(o.dem.stride),o.demTexture?o.demTexture.update(o.dem.getPixels(),{premultiply:!1}):o.demTexture=new Dt(d,o.dem.getPixels(),d.gl.RGBA,{premultiply:!1}),o.demTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),o.needsTerrainPrepare=!1}const u=o&&o+o.tileID.key+i.key;if(u&&!this._demMatrixCache[u]){const d=this.sourceCache.sourceCache._source.maxzoom;let _=i.canonical.z-o.tileID.canonical.z;i.overscaledZ>i.canonical.z&&(i.canonical.z>=d?_=i.canonical.z-d:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const w=i.canonical.x-(i.canonical.x>>_<<_),M=i.canonical.y-(i.canonical.y>>_<<_),A=l.b9(new Float64Array(16),[1/(l.W<<_),1/(l.W<<_),0]);l.H(A,A,[w*l.W,M*l.W,0]),this._demMatrixCache[i.key]={matrix:A,coord:i}}return{u_depth:2,u_terrain:3,u_terrain_dim:o&&o.dem&&o.dem.dim||1,u_terrain_matrix:u?this._demMatrixCache[i.key].matrix:this._emptyDemMatrix,u_terrain_unpack:o&&o.dem&&o.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(o&&o.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:o}}getFramebuffer(i){const o=this.painter,u=o.width/devicePixelRatio,d=o.height/devicePixelRatio;return!this._fbo||this._fbo.width===u&&this._fbo.height===d||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Dt(o.context,{width:u,height:d,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Dt(o.context,{width:u,height:d,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=o.context.createFramebuffer(u,d,!0,!1),this._fbo.depthAttachment.set(o.context.createRenderbuffer(o.context.gl.DEPTH_COMPONENT16,u,d))),this._fbo.colorAttachment.set(i==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const i=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const o=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let _=0,w=0;_<this._coordsTextureSize;_++)for(let M=0;M<this._coordsTextureSize;M++,w+=4)o[w+0]=255&M,o[w+1]=255&_,o[w+2]=M>>8<<4|_>>8,o[w+3]=0;const u=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(o.buffer)),d=new Dt(i,u,i.gl.RGBA,{premultiply:!1});return d.bind(i.gl.NEAREST,i.gl.CLAMP_TO_EDGE),this._coordsTexture=d,d}pointCoordinate(i){this.painter.maybeDrawDepthAndCoords(!0);const o=new Uint8Array(4),u=this.painter.context,d=u.gl,_=Math.round(i.x*this.painter.pixelRatio/devicePixelRatio),w=Math.round(i.y*this.painter.pixelRatio/devicePixelRatio),M=Math.round(this.painter.height/devicePixelRatio);u.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),d.readPixels(_,M-w-1,1,1,d.RGBA,d.UNSIGNED_BYTE,o),u.bindFramebuffer.set(null);const A=o[0]+(o[2]>>4<<8),C=o[1]+((15&o[2])<<8),z=this.coordsIndex[255-o[3]],O=z&&this.sourceCache.getTileByID(z);if(!O)return null;const V=this._coordsTextureSize,Z=(1<<O.tileID.canonical.z)*V;return new l.Y((O.tileID.canonical.x*V+A)/Z+O.tileID.wrap,(O.tileID.canonical.y*V+C)/Z,this.getElevation(O.tileID,A,C,V))}depthAtPoint(i){const o=new Uint8Array(4),u=this.painter.context,d=u.gl;return u.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),d.readPixels(i.x,this.painter.height/devicePixelRatio-i.y-1,1,1,d.RGBA,d.UNSIGNED_BYTE,o),u.bindFramebuffer.set(null),(o[0]/16777216+o[1]/65536+o[2]/256+o[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const i=this.painter.context,o=new l.ba,u=new l.aX,d=this.meshSize,_=l.W/d,w=d*d;for(let O=0;O<=d;O++)for(let V=0;V<=d;V++)o.emplaceBack(V*_,O*_,0);for(let O=0;O<w;O+=d+1)for(let V=0;V<d;V++)u.emplaceBack(V+O,d+V+O+1,d+V+O+2),u.emplaceBack(V+O,d+V+O+2,V+O+1);const M=o.length,A=M+2*(d+1);for(const O of[0,1])for(let V=0;V<=d;V++)for(const Z of[0,1])o.emplaceBack(V*_,O*l.W,Z);for(let O=0;O<2*d;O+=2)u.emplaceBack(A+O,A+O+1,A+O+3),u.emplaceBack(A+O,A+O+3,A+O+2),u.emplaceBack(M+O,M+O+3,M+O+1),u.emplaceBack(M+O,M+O+2,M+O+3);const C=o.length,z=C+2*(d+1);for(const O of[0,1])for(let V=0;V<=d;V++)for(const Z of[0,1])o.emplaceBack(O*l.W,V*_,Z);for(let O=0;O<2*d;O+=2)u.emplaceBack(C+O,C+O+1,C+O+3),u.emplaceBack(C+O,C+O+3,C+O+2),u.emplaceBack(z+O,z+O+3,z+O+1),u.emplaceBack(z+O,z+O+2,z+O+3);return this._mesh={indexBuffer:i.createIndexBuffer(u),vertexBuffer:i.createVertexBuffer(o,Vi.members),segments:l.$.simpleSegment(0,0,o.length,u.length)},this._mesh}getMeshFrameDelta(i){return 2*Math.PI*l.bb/Math.pow(2,i)/5}getMinTileElevationForLngLatZoom(i,o){var u;const{tileID:d}=this._getOverscaledTileIDFromLngLatZoom(i,o);return(u=this.getMinMaxElevation(d).minElevation)!==null&&u!==void 0?u:0}getMinMaxElevation(i){const o=this.getTerrainData(i).tile,u={minElevation:null,maxElevation:null};return o&&o.dem&&(u.minElevation=o.dem.min*this.exaggeration,u.maxElevation=o.dem.max*this.exaggeration),u}_getOverscaledTileIDFromLngLatZoom(i,o){const u=l.Y.fromLngLat(i.wrap()),d=(1<<o)*l.W,_=u.x*d,w=u.y*d,M=Math.floor(_/l.W),A=Math.floor(w/l.W);return{tileID:new l.Q(o,0,o,M,A),mercatorX:_,mercatorY:w}}}class io{constructor(i,o,u){this._context=i,this._size=o,this._tileSize=u,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const i of this._objects)i.texture.destroy(),i.fbo.destroy()}_createObject(i){const o=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),u=new Dt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return u.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),o.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),o.colorAttachment.set(u.texture),{id:i,fbo:o,texture:u,stamp:-1,inUse:!1}}getObjectForId(i){return this._objects[i]}useObject(i){i.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(o=>i.id!==o),this._recentlyUsed.push(i.id)}stampObject(i){i.stamp=++this._stamp}getOrCreateFreeObject(){for(const o of this._recentlyUsed)if(!this._objects[o].inUse)return this._objects[o];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const i=this._createObject(this._objects.length);return this._objects.push(i),i}freeObject(i){i.inUse=!1}freeAllObjects(){for(const i of this._objects)this.freeObject(i)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(i=>!i.inUse)===!1}}const Yr={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class xc{constructor(i,o){this.painter=i,this.terrain=o,this.pool=new io(i.context,30,o.sourceCache.tileSize*o.qualityFactor)}destruct(){this.pool.destruct()}getTexture(i){return this.pool.getObjectForId(i.rtt[this._stacks.length-1].id).texture}prepareForRender(i,o){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=i._order.filter(u=>!i._layers[u].isHidden(o)),this._coordsDescendingInv={};for(const u in i.sourceCaches){this._coordsDescendingInv[u]={};const d=i.sourceCaches[u].getVisibleCoordinates();for(const _ of d){const w=this.terrain.sourceCache.getTerrainCoords(_);for(const M in w)this._coordsDescendingInv[u][M]||(this._coordsDescendingInv[u][M]=[]),this._coordsDescendingInv[u][M].push(w[M])}}this._coordsDescendingInvStr={};for(const u of i._order){const d=i._layers[u],_=d.source;if(Yr[d.type]&&!this._coordsDescendingInvStr[_]){this._coordsDescendingInvStr[_]={};for(const w in this._coordsDescendingInv[_])this._coordsDescendingInvStr[_][w]=this._coordsDescendingInv[_][w].map(M=>M.key).sort().join()}}for(const u of this._renderableTiles)for(const d in this._coordsDescendingInvStr){const _=this._coordsDescendingInvStr[d][u.tileID.key];_&&_!==u.rttCoords[d]&&(u.rtt=[])}}renderLayer(i){if(i.isHidden(this.painter.transform.zoom))return!1;const o=i.type,u=this.painter,d=this._renderableLayerIds[this._renderableLayerIds.length-1]===i.id;if(Yr[o]&&(this._prevType&&Yr[this._prevType]||this._stacks.push([]),this._prevType=o,this._stacks[this._stacks.length-1].push(i.id),!d))return!0;if(Yr[this._prevType]||Yr[o]&&d){this._prevType=o;const _=this._stacks.length-1,w=this._stacks[_]||[];for(const M of this._renderableTiles){if(this.pool.isFull()&&(Xo(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(M),M.rtt[_]){const C=this.pool.getObjectForId(M.rtt[_].id);if(C.stamp===M.rtt[_].stamp){this.pool.useObject(C);continue}}const A=this.pool.getOrCreateFreeObject();this.pool.useObject(A),this.pool.stampObject(A),M.rtt[_]={id:A.id,stamp:A.stamp},u.context.bindFramebuffer.set(A.fbo.framebuffer),u.context.clear({color:l.aO.transparent,stencil:0}),u.currentStencilSource=void 0;for(let C=0;C<w.length;C++){const z=u.style._layers[w[C]],O=z.source?this._coordsDescendingInv[z.source][M.tileID.key]:[M.tileID];u.context.viewport.set([0,0,A.fbo.width,A.fbo.height]),u._renderTileClippingMasks(z,O),u.renderLayer(u,u.style.sourceCaches[z.source],z,O),z.source&&(M.rttCoords[z.source]=this._coordsDescendingInvStr[z.source][M.tileID.key])}}return Xo(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Yr[o]}return!1}}const bc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},wc=T,so={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:vc,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},sl=g=>{g.touchstart=g.dragStart,g.touchmoveWindow=g.dragMove,g.touchend=g.dragEnd},Mc={showCompass:!0,showZoom:!0,visualizePitch:!1};class Sc{constructor(i,o,u=!1){this.mousedown=w=>{this.startMouse(l.e({},w,{ctrlKey:!0,preventDefault:()=>w.preventDefault()}),L.mousePos(this.element,w)),L.addEventListener(window,"mousemove",this.mousemove),L.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=w=>{this.moveMouse(w,L.mousePos(this.element,w))},this.mouseup=w=>{this.mouseRotate.dragEnd(w),this.mousePitch&&this.mousePitch.dragEnd(w),this.offTemp()},this.touchstart=w=>{w.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=L.touchPos(this.element,w.targetTouches)[0],this.startTouch(w,this._startPos),L.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),L.addEventListener(window,"touchend",this.touchend))},this.touchmove=w=>{w.targetTouches.length!==1?this.reset():(this._lastPos=L.touchPos(this.element,w.targetTouches)[0],this.moveTouch(w,this._lastPos))},this.touchend=w=>{w.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const d=i.dragRotate._mouseRotate.getClickTolerance(),_=i.dragRotate._mousePitch.getClickTolerance();this.element=o,this.mouseRotate=ua({clickTolerance:d,enable:!0}),this.touchRotate=(({enable:w,clickTolerance:M,bearingDegreesPerPixelMoved:A=.8})=>{const C=new he;return new ha({clickTolerance:M,move:(z,O)=>({bearingDelta:(O.x-z.x)*A}),moveStateManager:C,enable:w,assignEvents:sl})})({clickTolerance:d,enable:!0}),this.map=i,u&&(this.mousePitch=da({clickTolerance:_,enable:!0}),this.touchPitch=(({enable:w,clickTolerance:M,pitchDegreesPerPixelMoved:A=-.5})=>{const C=new he;return new ha({clickTolerance:M,move:(z,O)=>({pitchDelta:(O.y-z.y)*A}),moveStateManager:C,enable:w,assignEvents:sl})})({clickTolerance:_,enable:!0})),L.addEventListener(o,"mousedown",this.mousedown),L.addEventListener(o,"touchstart",this.touchstart,{passive:!1}),L.addEventListener(o,"touchcancel",this.reset)}startMouse(i,o){this.mouseRotate.dragStart(i,o),this.mousePitch&&this.mousePitch.dragStart(i,o),L.disableDrag()}startTouch(i,o){this.touchRotate.dragStart(i,o),this.touchPitch&&this.touchPitch.dragStart(i,o),L.disableDrag()}moveMouse(i,o){const u=this.map,{bearingDelta:d}=this.mouseRotate.dragMove(i,o)||{};if(d&&u.setBearing(u.getBearing()+d),this.mousePitch){const{pitchDelta:_}=this.mousePitch.dragMove(i,o)||{};_&&u.setPitch(u.getPitch()+_)}}moveTouch(i,o){const u=this.map,{bearingDelta:d}=this.touchRotate.dragMove(i,o)||{};if(d&&u.setBearing(u.getBearing()+d),this.touchPitch){const{pitchDelta:_}=this.touchPitch.dragMove(i,o)||{};_&&u.setPitch(u.getPitch()+_)}}off(){const i=this.element;L.removeEventListener(i,"mousedown",this.mousedown),L.removeEventListener(i,"touchstart",this.touchstart,{passive:!1}),L.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),L.removeEventListener(window,"touchend",this.touchend),L.removeEventListener(i,"touchcancel",this.reset),this.offTemp()}offTemp(){L.enableDrag(),L.removeEventListener(window,"mousemove",this.mousemove),L.removeEventListener(window,"mouseup",this.mouseup),L.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),L.removeEventListener(window,"touchend",this.touchend)}}let Jr;function rl(g,i,o){const u=new l.M(g.lng,g.lat);if(g=new l.M(g.lng,g.lat),i){const d=new l.M(g.lng-360,g.lat),_=new l.M(g.lng+360,g.lat),w=o.locationPoint(g).distSqr(i);o.locationPoint(d).distSqr(i)<w?g=d:o.locationPoint(_).distSqr(i)<w&&(g=_)}for(;Math.abs(g.lng-o.center.lng)>180;){const d=o.locationPoint(g);if(d.x>=0&&d.y>=0&&d.x<=o.width&&d.y<=o.height)break;g.lng>o.center.lng?g.lng-=360:g.lng+=360}return g.lng!==u.lng&&o.locationPoint(g).y>o.height/2-o.getHorizon()?g:u}const ro={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function nl(g,i,o){const u=g.classList;for(const d in ro)u.remove(`maplibregl-${o}-anchor-${d}`);u.add(`maplibregl-${o}-anchor-${i}`)}class no extends l.E{constructor(i){if(super(),this._onKeyPress=o=>{const u=o.code,d=o.charCode||o.keyCode;u!=="Space"&&u!=="Enter"&&d!==32&&d!==13||this.togglePopup()},this._onMapClick=o=>{const u=o.originalEvent.target,d=this._element;this._popup&&(u===d||d.contains(u))&&this.togglePopup()},this._update=o=>{var u;if(!this._map)return;const d=this._map.loaded()&&!this._map.isMoving();((o==null?void 0:o.type)==="terrain"||(o==null?void 0:o.type)==="render"&&!d)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?rl(this._lngLat,this._flatPos,this._map.transform):(u=this._lngLat)===null||u===void 0?void 0:u.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let _="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?_=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(_=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let w="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?w="rotateX(0deg)":this._pitchAlignment==="map"&&(w=`rotateX(${this._map.getPitch()}deg)`),o&&o.type!=="moveend"||(this._pos=this._pos.round()),L.setTransform(this._element,`${ro[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${w} ${_}`),P.frameAsync(new AbortController).then(()=>{this._updateOpacity(o&&o.type==="moveend")}).catch(()=>{})},this._onMove=o=>{if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.k("dragstart"))),this.fire(new l.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.k("dragend")),this._state="inactive"},this._addDragHandler=o=>{this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment!=="auto"?i.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(i==null?void 0:i.opacity,i==null?void 0:i.opacityWhenCovered),i&&i.element)this._element=i.element,this._offset=l.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=L.create("div"),this._element.setAttribute("aria-label","Map marker");const o=L.createNS("http://www.w3.org/2000/svg","svg"),u=41,d=27;o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height",`${u}px`),o.setAttributeNS(null,"width",`${d}px`),o.setAttributeNS(null,"viewBox",`0 0 ${d} ${u}`);const _=L.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"stroke","none"),_.setAttributeNS(null,"stroke-width","1"),_.setAttributeNS(null,"fill","none"),_.setAttributeNS(null,"fill-rule","evenodd");const w=L.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"fill-rule","nonzero");const M=L.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"transform","translate(3.0, 29.0)"),M.setAttributeNS(null,"fill","#000000");const A=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const lt of A){const xt=L.createNS("http://www.w3.org/2000/svg","ellipse");xt.setAttributeNS(null,"opacity","0.04"),xt.setAttributeNS(null,"cx","10.5"),xt.setAttributeNS(null,"cy","5.80029008"),xt.setAttributeNS(null,"rx",lt.rx),xt.setAttributeNS(null,"ry",lt.ry),M.appendChild(xt)}const C=L.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill",this._color);const z=L.createNS("http://www.w3.org/2000/svg","path");z.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),C.appendChild(z);const O=L.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"opacity","0.25"),O.setAttributeNS(null,"fill","#000000");const V=L.createNS("http://www.w3.org/2000/svg","path");V.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),O.appendChild(V);const Z=L.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Z.setAttributeNS(null,"fill","#FFFFFF");const W=L.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"transform","translate(8.0, 8.0)");const J=L.createNS("http://www.w3.org/2000/svg","circle");J.setAttributeNS(null,"fill","#000000"),J.setAttributeNS(null,"opacity","0.25"),J.setAttributeNS(null,"cx","5.5"),J.setAttributeNS(null,"cy","5.5"),J.setAttributeNS(null,"r","5.4999962");const j=L.createNS("http://www.w3.org/2000/svg","circle");j.setAttributeNS(null,"fill","#FFFFFF"),j.setAttributeNS(null,"cx","5.5"),j.setAttributeNS(null,"cy","5.5"),j.setAttributeNS(null,"r","5.4999962"),W.appendChild(J),W.appendChild(j),w.appendChild(M),w.appendChild(C),w.appendChild(O),w.appendChild(Z),w.appendChild(W),o.appendChild(w),o.setAttributeNS(null,"height",u*this._scale+"px"),o.setAttributeNS(null,"width",d*this._scale+"px"),this._element.appendChild(o),this._offset=l.P.convert(i&&i.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",o=>{o.preventDefault()}),this._element.addEventListener("mousedown",o=>{o.preventDefault()}),nl(this._element,this._anchor,"marker"),i&&i.className)for(const o of i.className.split(" "))this._element.classList.add(o);this._popup=null}addTo(i){return this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._update),i.on("moveend",this._update),i.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),L.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=l.M.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const d=Math.abs(13.5)/Math.SQRT2;i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(38.1-13.5+d)],"bottom-right":[-d,-1*(38.1-13.5+d)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const i=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:i?(i.isOpen()?i.remove():(i.setLngLat(this._lngLat),i.addTo(this._map)),this):this}_updateOpacity(i=!1){var o,u;if(!(!((o=this._map)===null||o===void 0)&&o.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(i)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const d=this._map,_=d.terrain.depthAtPoint(this._pos),w=d.terrain.getElevationForLngLatZoom(this._lngLat,d.transform.tileZoom);if(d.transform.lngLatToCameraDepth(this._lngLat,w)-_<.006)return void(this._element.style.opacity=this._opacity);const M=-this._offset.y/d.transform._pixelPerMeter,A=Math.sin(d.getPitch()*Math.PI/180)*M,C=d.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),z=d.transform.lngLatToCameraDepth(this._lngLat,w+A)-C>.006;!((u=this._popup)===null||u===void 0)&&u.isOpen()&&z&&this._popup.remove(),this._element.style.opacity=z?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(i){return this._offset=l.P.convert(i),this._update(),this}addClassName(i){this._element.classList.add(i)}removeClassName(i){this._element.classList.remove(i)}toggleClassName(i){return this._element.classList.toggle(i)}setDraggable(i){return this._draggable=!!i,this._map&&(i?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i&&i!=="auto"?i:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(i,o){return i===void 0&&o===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),i!==void 0&&(this._opacity=i),o!==void 0&&(this._opacityWhenCovered=o),this._map&&this._updateOpacity(!0),this}}const al={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let pa=0,$n=!1;const ol={maxWidth:100,unit:"metric"};function ll(g,i,o){const u=o&&o.maxWidth||100,d=g._container.clientHeight/2,_=g.unproject([0,d]),w=g.unproject([u,d]),M=_.distanceTo(w);if(o&&o.unit==="imperial"){const A=3.2808*M;A>5280?Vn(i,u,A/5280,g._getUIString("ScaleControl.Miles")):Vn(i,u,A,g._getUIString("ScaleControl.Feet"))}else o&&o.unit==="nautical"?Vn(i,u,M/1852,g._getUIString("ScaleControl.NauticalMiles")):M>=1e3?Vn(i,u,M/1e3,g._getUIString("ScaleControl.Kilometers")):Vn(i,u,M,g._getUIString("ScaleControl.Meters"))}function Vn(g,i,o,u){const d=function(_){const w=Math.pow(10,`${Math.floor(_)}`.length-1);let M=_/w;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(A){const C=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*C)/C}(M),w*M}(o);g.style.width=i*(d/o)+"px",g.innerHTML=`${d}&nbsp;${u}`}const Tc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Ac=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function cl(g){if(g){if(typeof g=="number"){const i=Math.round(Math.abs(g)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,g),"top-left":new l.P(i,i),"top-right":new l.P(-i,i),bottom:new l.P(0,-g),"bottom-left":new l.P(i,-i),"bottom-right":new l.P(-i,-i),left:new l.P(g,0),right:new l.P(-g,0)}}if(g instanceof l.P||Array.isArray(g)){const i=l.P.convert(g);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:l.P.convert(g.center||[0,0]),top:l.P.convert(g.top||[0,0]),"top-left":l.P.convert(g["top-left"]||[0,0]),"top-right":l.P.convert(g["top-right"]||[0,0]),bottom:l.P.convert(g.bottom||[0,0]),"bottom-left":l.P.convert(g["bottom-left"]||[0,0]),"bottom-right":l.P.convert(g["bottom-right"]||[0,0]),left:l.P.convert(g.left||[0,0]),right:l.P.convert(g.right||[0,0])}}return cl(new l.P(0,0))}const Su=T;m.AJAXError=l.be,m.Evented=l.E,m.LngLat=l.M,m.MercatorCoordinate=l.Y,m.Point=l.P,m.addProtocol=l.bf,m.config=l.a,m.removeProtocol=l.bg,m.AttributionControl=Dr,m.BoxZoomHandler=Pr,m.CanvasSource=fe,m.CooperativeGesturesHandler=ve,m.DoubleClickZoomHandler=_c,m.DragPanHandler=bu,m.DragRotateHandler=Cr,m.EdgeInsets=la,m.FullscreenControl=class extends l.E{constructor(g={}){super(),this._onFullscreenChange=()=>{var i;let o=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((i=o==null?void 0:o.shadowRoot)===null||i===void 0)&&i.fullscreenElement;)o=o.shadowRoot.fullscreenElement;o===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){L.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const g=this._fullscreenButton=L.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);L.create("span","maplibregl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.title=g}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},m.GeoJSONSource=le,m.GeolocateControl=class extends l.E{constructor(g){super(),this._onSuccess=i=>{if(this._map){if(this._isOutOfMapMaxBounds(i))return this._setErrorState(),this.fire(new l.k("outofmaxbounds",i)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=i,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(i),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(i),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.k("geolocate",i)),this._finish()}},this._updateCamera=i=>{const o=new l.M(i.coords.longitude,i.coords.latitude),u=i.coords.accuracy,d=this._map.getBearing(),_=l.e({bearing:d},this.options.fitBoundsOptions),w=rt.fromLngLat(o,u);this._map.fitBounds(w,_,{geolocateSource:!0})},this._updateMarker=i=>{if(i){const o=new l.M(i.coords.longitude,i.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=i.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=i=>{if(this._map){if(this.options.trackUserLocation)if(i.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(i.code===3&&$n)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.k("error",i)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=i=>{if(this._map){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=L.create("button","maplibregl-ctrl-geolocate",this._container),L.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",i===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=L.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new no({element:this._dotElement}),this._circleElement=L.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new no({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.k("trackuserlocationend")))})}},this.options=l.e({},al,g)}onAdd(g){return this._map=g,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return l._(this,arguments,void 0,function*(i=!1){if(Jr!==void 0&&!i)return Jr;if(window.navigator.permissions===void 0)return Jr=!!window.navigator.geolocation,Jr;try{Jr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Jr=!!window.navigator.geolocation}return Jr})}().then(i=>this._setupUI(i)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),L.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,pa=0,$n=!1}_isOutOfMapMaxBounds(g){const i=this._map.getMaxBounds(),o=g.coords;return i&&(o.longitude<i.getWest()||o.longitude>i.getEast()||o.latitude<i.getSouth()||o.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const g=this._map.getBounds(),i=g.getSouthEast(),o=g.getNorthEast(),u=i.distanceTo(o),d=Math.ceil(this._accuracy/(u/this._map._container.clientHeight)*2);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":pa--,$n=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),pa++,pa>1?(g={maximumAge:6e5,timeout:0},$n=!0):(g=this.options.positionOptions,$n=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,g)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},m.Hash=fc,m.ImageSource=Ht,m.KeyboardHandler=mn,m.LngLatBounds=rt,m.LogoControl=wu,m.Map=class extends Hs{constructor(g){if(l.bc.mark(l.bd.create),(g=l.e({},so,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Yo(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),{bearingSnap:g.bearingSnap}),this._contextLost=i=>{i.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new l.k("webglcontextlost",{originalEvent:i}))},this._contextRestored=i=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.k("webglcontextrestored",{originalEvent:i}))},this._onMapScroll=i=>{if(i.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=g.interactive,this._maxTileCacheSize=g.maxTileCacheSize,this._maxTileCacheZoomLevels=g.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._renderTaskQueue=new eo,this._controls=[],this._mapId=l.a3(),this._locale=l.e({},bc,g.locale),this._clickTolerance=g.clickTolerance,this._overridePixelRatio=g.pixelRatio,this._maxCanvasSize=g.maxCanvasSize,this.transformCameraUpdate=g.transformCameraUpdate,this._imageQueueHandle=ht.addThrottleControl(()=>this.isMoving()),this._requestManager=new Tt(g.transformRequest),typeof g.container=="string"){if(this._container=document.getElementById(g.container),!this._container)throw new Error(`Container '${g.container}' not found.`)}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(g.maxBounds&&this.setMaxBounds(g.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let i=!1;const o=dc(u=>{this._trackResize&&!this._removed&&this.resize(u)._update()},50);this._resizeObserver=new ResizeObserver(u=>{i?o(u):i=!0}),this._resizeObserver.observe(this._container)}this.handlers=new yc(this,g),this._hash=g.hash&&new fc(typeof g.hash=="string"&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,l.e({},g.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=g.localIdeographFontFamily,this._validateStyle=g.validateStyle,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new Dr(typeof g.attributionControl=="boolean"?void 0:g.attributionControl)),g.maplibreLogo&&this.addControl(new wu,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update(i.dataType==="style"),this.fire(new l.k(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new l.k(`${i.dataType}dataloading`,i))}),this.on("dataabort",i=>{this.fire(new l.k("sourcedataabort",i))})}_getMapId(){return this._mapId}addControl(g,i){if(i===void 0&&(i=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new l.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=g.onAdd(this);this._controls.push(g);const u=this._controlPositions[i];return i.indexOf("bottom")!==-1?u.insertBefore(o,u.firstChild):u.appendChild(o),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new l.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(g);return i>-1&&this._controls.splice(i,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}calculateCameraOptionsFromTo(g,i,o,u){return u==null&&this.terrain&&(u=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(g,i,o,u)}resize(g){var i;const o=this._containerDimensions(),u=o[0],d=o[1],_=this._getClampedPixelRatio(u,d);if(this._resizeCanvas(u,d,_),this.painter.resize(u,d,_),this.painter.overLimit()){const M=this.painter.context.gl;this._maxCanvasSize=[M.drawingBufferWidth,M.drawingBufferHeight];const A=this._getClampedPixelRatio(u,d);this._resizeCanvas(u,d,A),this.painter.resize(u,d,A)}this.transform.resize(u,d),(i=this._requestedCameraState)===null||i===void 0||i.resize(u,d);const w=!this._moving;return w&&(this.stop(),this.fire(new l.k("movestart",g)).fire(new l.k("move",g))),this.fire(new l.k("resize",g)),w&&this.fire(new l.k("moveend",g)),this}_getClampedPixelRatio(g,i){const{0:o,1:u}=this._maxCanvasSize,d=this.getPixelRatio(),_=g*d,w=i*d;return Math.min(_>o?o/_:1,w>u?u/w:1)*d}getPixelRatio(){var g;return(g=this._overridePixelRatio)!==null&&g!==void 0?g:devicePixelRatio}setPixelRatio(g){this._overridePixelRatio=g,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(g){return this.transform.setMaxBounds(rt.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this._update()}project(g){return this.transform.locationPoint(l.M.convert(g),this.style&&this.terrain)}unproject(g){return this.transform.pointLocation(l.P.convert(g),this.terrain)}isMoving(){var g;return this._moving||((g=this.handlers)===null||g===void 0?void 0:g.isMoving())}isZooming(){var g;return this._zooming||((g=this.handlers)===null||g===void 0?void 0:g.isZooming())}isRotating(){var g;return this._rotating||((g=this.handlers)===null||g===void 0?void 0:g.isRotating())}_createDelegatedListener(g,i,o){if(g==="mouseenter"||g==="mouseover"){let u=!1;return{layer:i,listener:o,delegates:{mousemove:_=>{const w=this.getLayer(i)?this.queryRenderedFeatures(_.point,{layers:[i]}):[];w.length?u||(u=!0,o.call(this,new Gs(g,this,_.originalEvent,{features:w}))):u=!1},mouseout:()=>{u=!1}}}}if(g==="mouseleave"||g==="mouseout"){let u=!1;return{layer:i,listener:o,delegates:{mousemove:w=>{(this.getLayer(i)?this.queryRenderedFeatures(w.point,{layers:[i]}):[]).length?u=!0:u&&(u=!1,o.call(this,new Gs(g,this,w.originalEvent)))},mouseout:w=>{u&&(u=!1,o.call(this,new Gs(g,this,w.originalEvent)))}}}}{const u=d=>{const _=this.getLayer(i)?this.queryRenderedFeatures(d.point,{layers:[i]}):[];_.length&&(d.features=_,o.call(this,d),delete d.features)};return{layer:i,listener:o,delegates:{[g]:u}}}}on(g,i,o){if(o===void 0)return super.on(g,i);const u=this._createDelegatedListener(g,i,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(u);for(const d in u.delegates)this.on(d,u.delegates[d]);return this}once(g,i,o){if(o===void 0)return super.once(g,i);const u=this._createDelegatedListener(g,i,o);for(const d in u.delegates)this.once(d,u.delegates[d]);return this}off(g,i,o){return o===void 0?super.off(g,i):(this._delegatedListeners&&this._delegatedListeners[g]&&(u=>{const d=this._delegatedListeners[g];for(let _=0;_<d.length;_++){const w=d[_];if(w.layer===i&&w.listener===o){for(const M in w.delegates)this.off(M,w.delegates[M]);return d.splice(_,1),this}}})(),this)}queryRenderedFeatures(g,i){if(!this.style)return[];let o;const u=g instanceof l.P||Array.isArray(g),d=u?g:[[0,0],[this.transform.width,this.transform.height]];if(i=i||(u?{}:g)||{},d instanceof l.P||typeof d[0]=="number")o=[l.P.convert(d)];else{const _=l.P.convert(d[0]),w=l.P.convert(d[1]);o=[_,new l.P(w.x,_.y),w,new l.P(_.x,w.y),_]}return this.style.queryRenderedFeatures(o,i,this.transform)}querySourceFeatures(g,i){return this.style.querySourceFeatures(g,i)}setStyle(g,i){return(i=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},i)).diff!==!1&&i.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._updateStyle(g,i))}setTransformRequest(g){return this._requestManager.setTransformRequest(g),this}_getUIString(g){const i=this._locale[g];if(i==null)throw new Error(`Missing UI string '${g}'`);return i}_updateStyle(g,i){if(i.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(g,i));const o=this.style&&i.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!g)),g?(this.style=new ir(this,i||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g,i,o):this.style.loadJSON(g,i,o),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ir(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,i){if(typeof g=="string"){const o=this._requestManager.transformRequest(g,"Style");l.h(o,new AbortController).then(u=>{this._updateDiff(u.data,i)}).catch(u=>{u&&this.fire(new l.j(u))})}else typeof g=="object"&&this._updateDiff(g,i)}_updateDiff(g,i){try{this.style.setState(g,i)&&this._update(!0)}catch(o){l.w(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(g,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(g,i){return this._lazyInitEmptyStyle(),this.style.addSource(g,i),this._update(!0)}isSourceLoaded(g){const i=this.style&&this.style.sourceCaches[g];if(i!==void 0)return i.loaded();this.fire(new l.j(new Error(`There is no source with ID '${g}'`)))}setTerrain(g){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),g){const i=this.style.sourceCaches[g.source];if(!i)throw new Error(`cannot load terrain, because there exists no source with ID: ${g.source}`);this.terrain===null&&i.reload();for(const o in this.style._layers){const u=this.style._layers[o];u.type==="hillshade"&&u.source===g.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Mu(this.painter,i,g),this.painter.renderToTexture=new xc(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=o=>{o.dataType==="style"?this.terrain.sourceCache.freeRtt():o.dataType==="source"&&o.tile&&(o.sourceId!==g.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(o.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new l.k("terrain",{terrain:g})),this}getTerrain(){var g,i;return(i=(g=this.terrain)===null||g===void 0?void 0:g.options)!==null&&i!==void 0?i:null}areTilesLoaded(){const g=this.style&&this.style.sourceCaches;for(const i in g){const o=g[i]._tiles;for(const u in o){const d=o[u];if(d.state!=="loaded"&&d.state!=="errored")return!1}}return!0}removeSource(g){return this.style.removeSource(g),this._update(!0)}getSource(g){return this.style.getSource(g)}addImage(g,i,o={}){const{pixelRatio:u=1,sdf:d=!1,stretchX:_,stretchY:w,content:M}=o;if(this._lazyInitEmptyStyle(),!(i instanceof HTMLImageElement||l.b(i))){if(i.width===void 0||i.height===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:C,data:z}=i,O=i;return this.style.addImage(g,{data:new l.R({width:A,height:C},new Uint8Array(z)),pixelRatio:u,stretchX:_,stretchY:w,content:M,sdf:d,version:0,userImage:O}),O.onAdd&&O.onAdd(this,g),this}}{const{width:A,height:C,data:z}=P.getImageData(i);this.style.addImage(g,{data:new l.R({width:A,height:C},z),pixelRatio:u,stretchX:_,stretchY:w,content:M,sdf:d,version:0})}}updateImage(g,i){const o=this.style.getImage(g);if(!o)return this.fire(new l.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=i instanceof HTMLImageElement||l.b(i)?P.getImageData(i):i,{width:d,height:_,data:w}=u;if(d===void 0||_===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(d!==o.data.width||_!==o.data.height)return this.fire(new l.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const M=!(i instanceof HTMLImageElement||l.b(i));return o.data.replace(w,M),this.style.updateImage(g,o),this}getImage(g){return this.style.getImage(g)}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new l.j(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g){return ht.getImage(this._requestManager.transformRequest(g,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(g,i){return this._lazyInitEmptyStyle(),this.style.addLayer(g,i),this._update(!0)}moveLayer(g,i){return this.style.moveLayer(g,i),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(g,i,o){return this.style.setLayerZoomRange(g,i,o),this._update(!0)}setFilter(g,i,o={}){return this.style.setFilter(g,i,o),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,i,o,u={}){return this.style.setPaintProperty(g,i,o,u),this._update(!0)}getPaintProperty(g,i){return this.style.getPaintProperty(g,i)}setLayoutProperty(g,i,o,u={}){return this.style.setLayoutProperty(g,i,o,u),this._update(!0)}getLayoutProperty(g,i){return this.style.getLayoutProperty(g,i)}setGlyphs(g,i={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(g,i),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(g,i,o={}){return this._lazyInitEmptyStyle(),this.style.addSprite(g,i,o,u=>{u||this._update(!0)}),this}removeSprite(g){return this._lazyInitEmptyStyle(),this.style.removeSprite(g),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(g,i={}){return this._lazyInitEmptyStyle(),this.style.setSprite(g,i,o=>{o||this._update(!0)}),this}setLight(g,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,i),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(g,i){return this.style.setFeatureState(g,i),this._update()}removeFeatureState(g,i){return this.style.removeFeatureState(g,i),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let g=0,i=0;return this._container&&(g=this._container.clientWidth||400,i=this._container.clientHeight||300),[g,i]}_setupContainer(){const g=this._container;g.classList.add("maplibregl-map");const i=this._canvasContainer=L.create("div","maplibregl-canvas-container",g);this._interactive&&i.classList.add("maplibregl-interactive"),this._canvas=L.create("canvas","maplibregl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const o=this._containerDimensions(),u=this._getClampedPixelRatio(o[0],o[1]);this._resizeCanvas(o[0],o[1],u);const d=this._controlContainer=L.create("div","maplibregl-control-container",g),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{_[w]=L.create("div",`maplibregl-ctrl-${w} `,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,i,o){this._canvas.width=Math.floor(o*g),this._canvas.height=Math.floor(o*i),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${i}px`}_setupPainter(){const g={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let i=null;this._canvas.addEventListener("webglcontextcreationerror",u=>{i={requestedAttributes:g},u&&(i.statusMessage=u.statusMessage,i.type=u.type)},{once:!0});const o=this._canvas.getContext("webgl2",g)||this._canvas.getContext("webgl",g);if(!o){const u="Failed to initialize WebGL";throw i?(i.message=u,new Error(JSON.stringify(i))):new Error(u)}this.painter=new hu(o,this.transform),K.testSupport(o)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_render(g){const i=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),this._removed)return;let o=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const d=this.transform.zoom,_=P.now();this.style.zoomHistory.update(d,_);const w=new l.a8(d,{now:_,fadeDuration:i,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),M=w.crossFadingFactor();M===1&&M===this._crossFadingFactor||(o=!0,this._crossFadingFactor=M),this.style.update(w)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,i,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:i,showPadding:this.showPadding}),this.fire(new l.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.bc.mark(l.bd.load),this.fire(new l.k("load"))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const u=this._sourcesDirty||this._styleDirty||this._placementDirty;return u||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.k("idle")),!this._loaded||this._fullyLoaded||u||(this._fullyLoaded=!0,l.bc.mark(l.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var g;this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ht.removeThrottleControl(this._imageQueueHandle),(g=this._resizeObserver)===null||g===void 0||g.disconnect();const i=this.painter.context.gl.getExtension("WEBGL_lose_context");i&&i.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),L.remove(this._canvasContainer),L.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),l.bc.clearMetrics(),this._removed=!0,this.fire(new l.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,P.frameAsync(this._frameRequest).then(g=>{l.bc.frame(g),this._frameRequest=null,this._render(g)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get version(){return wc}getCameraTargetElevation(){return this.transform.elevation}},m.MapMouseEvent=Gs,m.MapTouchEvent=$r,m.MapWheelEvent=pc,m.Marker=no,m.NavigationControl=class{constructor(g){this._updateZoomButtons=()=>{const i=this._map.getZoom(),o=i===this._map.getMaxZoom(),u=i===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},this._rotateCompassArrow=()=>{const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=i},this._setButtonTitle=(i,o)=>{const u=this._map._getUIString(`NavigationControl.${o}`);i.title=u,i.setAttribute("aria-label",u)},this.options=l.e({},Mc,g),this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",i=>this._map.zoomIn({},{originalEvent:i})),L.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",i=>this._map.zoomOut({},{originalEvent:i})),L.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",i=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:i}):this._map.resetNorth({},{originalEvent:i})}),this._compassIcon=L.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Sc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){L.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(g,i){const o=L.create("button",g,this._container);return o.type="button",o.addEventListener("click",i),o}},m.Popup=class extends l.E{constructor(g){super(),this.remove=()=>(this._content&&L.remove(this._content),this._container&&(L.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.k("close"))),this),this._onMouseUp=i=>{this._update(i.point)},this._onMouseMove=i=>{this._update(i.point)},this._onDrag=i=>{this._update(i.point)},this._update=i=>{var o;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=L.create("div","maplibregl-popup",this._map.getContainer()),this._tip=L.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const M of this.options.className.split(" "))this._container.classList.add(M);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?rl(this._lngLat,this._flatPos,this._map.transform):(o=this._lngLat)===null||o===void 0?void 0:o.wrap(),this._trackPointer&&!i)return;const u=this._flatPos=this._pos=this._trackPointer&&i?i:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&i?i:this._map.transform.locationPoint(this._lngLat));let d=this.options.anchor;const _=cl(this.options.offset);if(!d){const M=this._container.offsetWidth,A=this._container.offsetHeight;let C;C=u.y+_.bottom.y<A?["top"]:u.y>this._map.transform.height-A?["bottom"]:[],u.x<M/2?C.push("left"):u.x>this._map.transform.width-M/2&&C.push("right"),d=C.length===0?"bottom":C.join("-")}let w=u.add(_[d]);this.options.subpixelPositioning||(w=w.round()),L.setTransform(this._container,`${ro[d]} translate(${w.x}px,${w.y}px)`),nl(this._container,d,"popup")},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(Tc),g)}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(g){return this._lngLat=l.M.convert(g),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const i=document.createDocumentFragment(),o=document.createElement("body");let u;for(o.innerHTML=g;u=o.firstChild,u;)i.appendChild(u);return this.setDOMContent(i)}getMaxWidth(){var g;return(g=this._container)===null||g===void 0?void 0:g.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=L.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(g),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(g){this._container&&this._container.classList.add(g)}removeClassName(g){this._container&&this._container.classList.remove(g)}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){if(this._container)return this._container.classList.toggle(g)}setSubpixelPositioning(g){this.options.subpixelPositioning=g}_createCloseButton(){this.options.closeButton&&(this._closeButton=L.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(Ac);g&&g.focus()}},m.RasterDEMTileSource=Jt,m.RasterTileSource=it,m.ScaleControl=class{constructor(g){this._onMove=()=>{ll(this._map,this._container,this.options)},this.setUnit=i=>{this.options.unit=i,ll(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},ol),g)}getDefaultPosition(){return"bottom-left"}onAdd(g){return this._map=g,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-scale",g.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){L.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},m.ScrollZoomHandler=el,m.Style=ir,m.TerrainControl=class{constructor(g){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=g}onAdd(g){return this._map=g,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=L.create("button","maplibregl-ctrl-terrain",this._container),L.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){L.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},m.TwoFingersTouchPitchHandler=yu,m.TwoFingersTouchRotateHandler=gc,m.TwoFingersTouchZoomHandler=_u,m.TwoFingersTouchZoomRotateHandler=Qa,m.VectorTileSource=Ft,m.VideoSource=jt,m.addSourceType=(g,i)=>l._(void 0,void 0,void 0,function*(){if(be(g))throw new Error(`A source type called "${g}" already exists.`);((o,u)=>{Ae[o]=u})(g,i)}),m.clearPrewarmedResources=function(){const g=As;g&&(g.isPreloaded()&&g.numActive()===1?(g.release(hi),As=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},m.getMaxParallelImageRequests=function(){return l.a.MAX_PARALLEL_IMAGE_REQUESTS},m.getRTLTextPluginStatus=function(){return zt().getRTLTextPluginStatus()},m.getVersion=function(){return Su},m.getWorkerCount=function(){return bs.workerCount},m.getWorkerUrl=function(){return l.a.WORKER_URL},m.importScriptInWorkers=function(g){return ae().broadcast("IS",g)},m.prewarm=function(){Rt().acquire(hi)},m.setMaxParallelImageRequests=function(g){l.a.MAX_PARALLEL_IMAGE_REQUESTS=g},m.setRTLTextPlugin=function(g,i){return zt().setRTLTextPlugin(g,i)},m.setWorkerCount=function(g){bs.workerCount=g},m.setWorkerUrl=function(g){l.a.WORKER_URL=g}});var y=a;return y})})(Iv);var pS=Iv.exports;const vy=Ev(pS);function mS(t){t("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),t("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),t("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),t.WGS84=t["EPSG:4326"],t["EPSG:3785"]=t["EPSG:3857"],t.GOOGLE=t["EPSG:3857"],t["EPSG:900913"]=t["EPSG:3857"],t["EPSG:102113"]=t["EPSG:3857"]}var xo=1,bo=2,Fl=3,gS=4,Xp=5,xy=6378137,_S=6356752314e-3,by=.0066943799901413165,mh=484813681109536e-20,Yt=Math.PI/2,yS=.16666666666666666,vS=.04722222222222222,xS=.022156084656084655,pe=1e-10,Ns=.017453292519943295,En=57.29577951308232,bi=Math.PI/4,Ah=Math.PI*2,_s=3.14159265359,Ar={};Ar.greenwich=0;Ar.lisbon=-9.131906111111;Ar.paris=2.337229166667;Ar.bogota=-74.080916666667;Ar.madrid=-3.687938888889;Ar.rome=12.452333333333;Ar.bern=7.439583333333;Ar.jakarta=106.807719444444;Ar.ferro=-17.666666666667;Ar.brussels=4.367975;Ar.stockholm=18.058277777778;Ar.athens=23.7163375;Ar.oslo=10.722916666667;const bS={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var wy=/[\s_\-\/\(\)]/g;function La(t,r){if(t[r])return t[r];for(var a=Object.keys(t),h=r.toLowerCase().replace(wy,""),p=-1,y,m;++p<a.length;)if(y=a[p],m=y.toLowerCase().replace(wy,""),m===h)return t[y]}function Yp(t){var r={},a=t.split("+").map(function(l){return l.trim()}).filter(function(l){return l}).reduce(function(l,T){var I=T.split("=");return I.push(!0),l[I[0].toLowerCase()]=I[1],l},{}),h,p,y,m={proj:"projName",datum:"datumCode",rf:function(l){r.rf=parseFloat(l)},lat_0:function(l){r.lat0=l*Ns},lat_1:function(l){r.lat1=l*Ns},lat_2:function(l){r.lat2=l*Ns},lat_ts:function(l){r.lat_ts=l*Ns},lon_0:function(l){r.long0=l*Ns},lon_1:function(l){r.long1=l*Ns},lon_2:function(l){r.long2=l*Ns},alpha:function(l){r.alpha=parseFloat(l)*Ns},gamma:function(l){r.rectified_grid_angle=parseFloat(l)},lonc:function(l){r.longc=l*Ns},x_0:function(l){r.x0=parseFloat(l)},y_0:function(l){r.y0=parseFloat(l)},k_0:function(l){r.k0=parseFloat(l)},k:function(l){r.k0=parseFloat(l)},a:function(l){r.a=parseFloat(l)},b:function(l){r.b=parseFloat(l)},r:function(l){r.a=r.b=parseFloat(l)},r_a:function(){r.R_A=!0},zone:function(l){r.zone=parseInt(l,10)},south:function(){r.utmSouth=!0},towgs84:function(l){r.datum_params=l.split(",").map(function(T){return parseFloat(T)})},to_meter:function(l){r.to_meter=parseFloat(l)},units:function(l){r.units=l;var T=La(bS,l);T&&(r.to_meter=T.to_meter)},from_greenwich:function(l){r.from_greenwich=l*Ns},pm:function(l){var T=La(Ar,l);r.from_greenwich=(T||parseFloat(l))*Ns},nadgrids:function(l){l==="@null"?r.datumCode="none":r.nadgrids=l},axis:function(l){var T="ewnsud";l.length===3&&T.indexOf(l.substr(0,1))!==-1&&T.indexOf(l.substr(1,1))!==-1&&T.indexOf(l.substr(2,1))!==-1&&(r.axis=l)},approx:function(){r.approx=!0}};for(h in a)p=a[h],h in m?(y=m[h],typeof y=="function"?y(p):r[y]=p):r[h]=p;return typeof r.datumCode=="string"&&r.datumCode!=="WGS84"&&(r.datumCode=r.datumCode.toLowerCase()),r}var Eh=1,Cv=2,Dv=3,Md=4,kv=5,Dm=-1,wS=/\s/,MS=/[A-Za-z]/,SS=/[A-Za-z84_]/,Yd=/[,\]]/,Rv=/[\d\.E\-\+]/;function ea(t){if(typeof t!="string")throw new Error("not a string");this.text=t.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=Eh}ea.prototype.readCharicter=function(){var t=this.text[this.place++];if(this.state!==Md)for(;wS.test(t);){if(this.place>=this.text.length)return;t=this.text[this.place++]}switch(this.state){case Eh:return this.neutral(t);case Cv:return this.keyword(t);case Md:return this.quoted(t);case kv:return this.afterquote(t);case Dv:return this.number(t);case Dm:return}};ea.prototype.afterquote=function(t){if(t==='"'){this.word+='"',this.state=Md;return}if(Yd.test(t)){this.word=this.word.trim(),this.afterItem(t);return}throw new Error(`havn't handled "`+t+'" in afterquote yet, index '+this.place)};ea.prototype.afterItem=function(t){if(t===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=Eh;return}if(t==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=Eh,this.currentObject=this.stack.pop(),this.currentObject||(this.state=Dm);return}};ea.prototype.number=function(t){if(Rv.test(t)){this.word+=t;return}if(Yd.test(t)){this.word=parseFloat(this.word),this.afterItem(t);return}throw new Error(`havn't handled "`+t+'" in number yet, index '+this.place)};ea.prototype.quoted=function(t){if(t==='"'){this.state=kv;return}this.word+=t};ea.prototype.keyword=function(t){if(SS.test(t)){this.word+=t;return}if(t==="["){var r=[];r.push(this.word),this.level++,this.root===null?this.root=r:this.currentObject.push(r),this.stack.push(this.currentObject),this.currentObject=r,this.state=Eh;return}if(Yd.test(t)){this.afterItem(t);return}throw new Error(`havn't handled "`+t+'" in keyword yet, index '+this.place)};ea.prototype.neutral=function(t){if(MS.test(t)){this.word=t,this.state=Cv;return}if(t==='"'){this.word="",this.state=Md;return}if(Rv.test(t)){this.word=t,this.state=Dv;return}if(Yd.test(t)){this.afterItem(t);return}throw new Error(`havn't handled "`+t+'" in neutral yet, index '+this.place)};ea.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===Dm)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function TS(t){var r=new ea(t);return r.output()}function My(t,r,a){Array.isArray(r)&&(a.unshift(r),r=null);var h=r?{}:t,p=a.reduce(function(y,m){return Il(m,y),y},h);r&&(t[r]=p)}function Il(t,r){if(!Array.isArray(t)){r[t]=!0;return}var a=t.shift();if(a==="PARAMETER"&&(a=t.shift()),t.length===1){if(Array.isArray(t[0])){r[a]={},Il(t[0],r[a]);return}r[a]=t[0];return}if(!t.length){r[a]=!0;return}if(a==="TOWGS84"){r[a]=t;return}if(a==="AXIS"){a in r||(r[a]=[]),r[a].push(t);return}Array.isArray(a)||(r[a]={});var h;switch(a){case"UNIT":case"PRIMEM":case"VERT_DATUM":r[a]={name:t[0].toLowerCase(),convert:t[1]},t.length===3&&Il(t[2],r[a]);return;case"SPHEROID":case"ELLIPSOID":r[a]={name:t[0],a:t[1],rf:t[2]},t.length===4&&Il(t[3],r[a]);return;case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":t[0]=["name",t[0]],My(r,a,t);return;default:for(h=-1;++h<t.length;)if(!Array.isArray(t[h]))return Il(t,r[a]);return My(r,a,t)}}var AS=.017453292519943295;function ES(t,r){var a=r[0],h=r[1];!(a in t)&&h in t&&(t[a]=t[h],r.length===3&&(t[a]=r[2](t[a])))}function wn(t){return t*AS}function IS(t){if(t.type==="GEOGCS"?t.projName="longlat":t.type==="LOCAL_CS"?(t.projName="identity",t.local=!0):typeof t.PROJECTION=="object"?t.projName=Object.keys(t.PROJECTION)[0]:t.projName=t.PROJECTION,t.AXIS){for(var r="",a=0,h=t.AXIS.length;a<h;++a){var p=[t.AXIS[a][0].toLowerCase(),t.AXIS[a][1].toLowerCase()];p[0].indexOf("north")!==-1||(p[0]==="y"||p[0]==="lat")&&p[1]==="north"?r+="n":p[0].indexOf("south")!==-1||(p[0]==="y"||p[0]==="lat")&&p[1]==="south"?r+="s":p[0].indexOf("east")!==-1||(p[0]==="x"||p[0]==="lon")&&p[1]==="east"?r+="e":(p[0].indexOf("west")!==-1||(p[0]==="x"||p[0]==="lon")&&p[1]==="west")&&(r+="w")}r.length===2&&(r+="u"),r.length===3&&(t.axis=r)}t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),t.units==="metre"&&(t.units="meter"),t.UNIT.convert&&(t.type==="GEOGCS"?t.DATUM&&t.DATUM.SPHEROID&&(t.to_meter=t.UNIT.convert*t.DATUM.SPHEROID.a):t.to_meter=t.UNIT.convert));var y=t.GEOGCS;t.type==="GEOGCS"&&(y=t),y&&(y.DATUM?t.datumCode=y.DATUM.name.toLowerCase():t.datumCode=y.name.toLowerCase(),t.datumCode.slice(0,2)==="d_"&&(t.datumCode=t.datumCode.slice(2)),(t.datumCode==="new_zealand_geodetic_datum_1949"||t.datumCode==="new_zealand_1949")&&(t.datumCode="nzgd49"),(t.datumCode==="wgs_1984"||t.datumCode==="world_geodetic_system_1984")&&(t.PROJECTION==="Mercator_Auxiliary_Sphere"&&(t.sphere=!0),t.datumCode="wgs84"),t.datumCode.slice(-6)==="_ferro"&&(t.datumCode=t.datumCode.slice(0,-6)),t.datumCode.slice(-8)==="_jakarta"&&(t.datumCode=t.datumCode.slice(0,-8)),~t.datumCode.indexOf("belge")&&(t.datumCode="rnb72"),y.DATUM&&y.DATUM.SPHEROID&&(t.ellps=y.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),t.ellps.toLowerCase().slice(0,13)==="international"&&(t.ellps="intl"),t.a=y.DATUM.SPHEROID.a,t.rf=parseFloat(y.DATUM.SPHEROID.rf,10)),y.DATUM&&y.DATUM.TOWGS84&&(t.datum_params=y.DATUM.TOWGS84),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36"),~t.datumCode.indexOf("osni_1952")&&(t.datumCode="osni52"),(~t.datumCode.indexOf("tm65")||~t.datumCode.indexOf("geodetic_datum_of_1965"))&&(t.datumCode="ire65"),t.datumCode==="ch1903+"&&(t.datumCode="ch1903"),~t.datumCode.indexOf("israel")&&(t.datumCode="isr93")),t.b&&!isFinite(t.b)&&(t.b=t.a);function m(I){var k=t.to_meter||1;return I*k}var l=function(I){return ES(t,I)},T=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",wn],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",wn],["x0","false_easting",m],["y0","false_northing",m],["long0","central_meridian",wn],["lat0","latitude_of_origin",wn],["lat0","standard_parallel_1",wn],["lat1","standard_parallel_1",wn],["lat2","standard_parallel_2",wn],["azimuth","Azimuth"],["alpha","azimuth",wn],["srsCode","name"]];T.forEach(l),!t.long0&&t.longc&&(t.projName==="Albers_Conic_Equal_Area"||t.projName==="Lambert_Azimuthal_Equal_Area")&&(t.long0=t.longc),!t.lat_ts&&t.lat1&&(t.projName==="Stereographic_South_Pole"||t.projName==="Polar Stereographic (variant B)")?(t.lat0=wn(t.lat1>0?90:-90),t.lat_ts=t.lat1):!t.lat_ts&&t.lat0&&t.projName==="Polar_Stereographic"&&(t.lat_ts=t.lat0,t.lat0=wn(t.lat0>0?90:-90))}function zv(t){var r=TS(t),a=r.shift(),h=r.shift();r.unshift(["name",h]),r.unshift(["type",a]);var p={};return Il(r,p),IS(p),p}function ur(t){var r=this;if(arguments.length===2){var a=arguments[1];typeof a=="string"?a.charAt(0)==="+"?ur[t]=Yp(arguments[1]):ur[t]=zv(arguments[1]):ur[t]=a}else if(arguments.length===1){if(Array.isArray(t))return t.map(function(h){Array.isArray(h)?ur.apply(r,h):ur(h)});if(typeof t=="string"){if(t in ur)return ur[t]}else"EPSG"in t?ur["EPSG:"+t.EPSG]=t:"ESRI"in t?ur["ESRI:"+t.ESRI]=t:"IAU2000"in t?ur["IAU2000:"+t.IAU2000]=t:console.log(t);return}}mS(ur);function PS(t){return typeof t=="string"}function CS(t){return t in ur}var DS=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function kS(t){return DS.some(function(r){return t.indexOf(r)>-1})}var RS=["3857","900913","3785","102113"];function zS(t){var r=La(t,"authority");if(r){var a=La(r,"epsg");return a&&RS.indexOf(a)>-1}}function LS(t){var r=La(t,"extension");if(r)return La(r,"proj4")}function OS(t){return t[0]==="+"}function FS(t){if(PS(t)){if(CS(t))return ur[t];if(kS(t)){var r=zv(t);if(zS(r))return ur["EPSG:3857"];var a=LS(r);return a?Yp(a):r}if(OS(t))return Yp(t)}else return t}function Sy(t,r){t=t||{};var a,h;if(!r)return t;for(h in r)a=r[h],a!==void 0&&(t[h]=a);return t}function Dn(t,r,a){var h=t*r;return a/Math.sqrt(1-h*h)}function Rh(t){return t<0?-1:1}function _e(t){return Math.abs(t)<=_s?t:t-Rh(t)*Ah}function an(t,r,a){var h=t*a,p=.5*t;return h=Math.pow((1-h)/(1+h),p),Math.tan(.5*(Yt-r))/h}function Ih(t,r){for(var a=.5*t,h,p,y=Yt-2*Math.atan(r),m=0;m<=15;m++)if(h=t*Math.sin(y),p=Yt-2*Math.atan(r*Math.pow((1-h)/(1+h),a))-y,y+=p,Math.abs(p)<=1e-10)return y;return-9999}function BS(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=Dn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function NS(t){var r=t.x,a=t.y;if(a*En>90&&a*En<-90&&r*En>180&&r*En<-180)return null;var h,p;if(Math.abs(Math.abs(a)-Yt)<=pe)return null;if(this.sphere)h=this.x0+this.a*this.k0*_e(r-this.long0),p=this.y0+this.a*this.k0*Math.log(Math.tan(bi+.5*a));else{var y=Math.sin(a),m=an(this.e,a,y);h=this.x0+this.a*this.k0*_e(r-this.long0),p=this.y0-this.a*this.k0*Math.log(m)}return t.x=h,t.y=p,t}function $S(t){var r=t.x-this.x0,a=t.y-this.y0,h,p;if(this.sphere)p=Yt-2*Math.atan(Math.exp(-a/(this.a*this.k0)));else{var y=Math.exp(-a/(this.a*this.k0));if(p=Ih(this.e,y),p===-9999)return null}return h=_e(this.long0+r/(this.a*this.k0)),t.x=h,t.y=p,t}var VS=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];const US={init:BS,forward:NS,inverse:$S,names:VS};function qS(){}function Ty(t){return t}var jS=["longlat","identity"];const GS={init:qS,forward:Ty,inverse:Ty,names:jS};var HS=[US,GS],cd={},Sd=[];function Lv(t,r){var a=Sd.length;return t.names?(Sd[a]=t,t.names.forEach(function(h){cd[h.toLowerCase()]=a}),this):(console.log(r),!0)}function WS(t){if(!t)return!1;var r=t.toLowerCase();if(typeof cd[r]<"u"&&Sd[cd[r]])return Sd[cd[r]]}function ZS(){HS.forEach(Lv)}const KS={start:ZS,add:Lv,get:WS};var We={};We.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};We.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};We.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};We.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};We.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"};We.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};We.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};We.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"};We.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};We.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};We.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};We.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"};We.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};We.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"};We.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."};We.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"};We.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"};We.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};We.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};We.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"};We.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"};We.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"};We.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"};We.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"};We.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};We.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};We.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};We.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};We.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};We.hough={a:6378270,rf:297,ellipseName:"Hough"};We.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};We.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};We.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};We.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};We.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"};We.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};We.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};We.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"};We.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"};We.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};We.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};We.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var XS=We.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};We.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function YS(t,r,a,h){var p=t*t,y=r*r,m=(p-y)/p,l=0;h?(t*=1-m*(yS+m*(vS+m*xS)),p=t*t,m=0):l=Math.sqrt(m);var T=(p-y)/y;return{es:m,e:l,ep2:T}}function JS(t,r,a,h,p){if(!t){var y=La(We,h);y||(y=XS),t=y.a,r=y.b,a=y.rf}return a&&!r&&(r=(1-1/a)*t),(a===0||Math.abs(t-r)<pe)&&(p=!0,r=t),{a:t,b:r,rf:a,sphere:p}}var Ts={};Ts.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"};Ts.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"};Ts.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"};Ts.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"};Ts.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"};Ts.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"};Ts.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"};Ts.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"};Ts.militargeographische_institut={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"};Ts.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"};Ts.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"};Ts.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"};Ts.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"};Ts.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"};Ts.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"};Ts.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"};Ts.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"};Ts.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};function QS(t,r,a,h,p,y,m){var l={};return t===void 0||t==="none"?l.datum_type=Xp:l.datum_type=gS,r&&(l.datum_params=r.map(parseFloat),(l.datum_params[0]!==0||l.datum_params[1]!==0||l.datum_params[2]!==0)&&(l.datum_type=xo),l.datum_params.length>3&&(l.datum_params[3]!==0||l.datum_params[4]!==0||l.datum_params[5]!==0||l.datum_params[6]!==0)&&(l.datum_type=bo,l.datum_params[3]*=mh,l.datum_params[4]*=mh,l.datum_params[5]*=mh,l.datum_params[6]=l.datum_params[6]/1e6+1)),m&&(l.datum_type=Fl,l.grids=m),l.a=a,l.b=h,l.es=p,l.ep2=y,l}var Ov={};function tT(t,r){var a=new DataView(r),h=sT(a),p=rT(a,h),y=nT(a,p,h),m={header:p,subgrids:y};return Ov[t]=m,m}function eT(t){if(t===void 0)return null;var r=t.split(",");return r.map(iT)}function iT(t){if(t.length===0)return null;var r=t[0]==="@";return r&&(t=t.slice(1)),t==="null"?{name:"null",mandatory:!r,grid:null,isNull:!0}:{name:t,mandatory:!r,grid:Ov[t]||null,isNull:!1}}function Pl(t){return t/3600*Math.PI/180}function sT(t){var r=t.getInt32(8,!1);return r===11?!1:(r=t.getInt32(8,!0),r!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function rT(t,r){return{nFields:t.getInt32(8,r),nSubgridFields:t.getInt32(24,r),nSubgrids:t.getInt32(40,r),shiftType:Jp(t,56,64).trim(),fromSemiMajorAxis:t.getFloat64(120,r),fromSemiMinorAxis:t.getFloat64(136,r),toSemiMajorAxis:t.getFloat64(152,r),toSemiMinorAxis:t.getFloat64(168,r)}}function Jp(t,r,a){return String.fromCharCode.apply(null,new Uint8Array(t.buffer.slice(r,a)))}function nT(t,r,a){for(var h=176,p=[],y=0;y<r.nSubgrids;y++){var m=oT(t,h,a),l=lT(t,h,m,a),T=Math.round(1+(m.upperLongitude-m.lowerLongitude)/m.longitudeInterval),I=Math.round(1+(m.upperLatitude-m.lowerLatitude)/m.latitudeInterval);p.push({ll:[Pl(m.lowerLongitude),Pl(m.lowerLatitude)],del:[Pl(m.longitudeInterval),Pl(m.latitudeInterval)],lim:[T,I],count:m.gridNodeCount,cvs:aT(l)}),h+=176+m.gridNodeCount*16}return p}function aT(t){return t.map(function(r){return[Pl(r.longitudeShift),Pl(r.latitudeShift)]})}function oT(t,r,a){return{name:Jp(t,r+8,r+16).trim(),parent:Jp(t,r+24,r+24+8).trim(),lowerLatitude:t.getFloat64(r+72,a),upperLatitude:t.getFloat64(r+88,a),lowerLongitude:t.getFloat64(r+104,a),upperLongitude:t.getFloat64(r+120,a),latitudeInterval:t.getFloat64(r+136,a),longitudeInterval:t.getFloat64(r+152,a),gridNodeCount:t.getInt32(r+168,a)}}function lT(t,r,a,h){for(var p=r+176,y=16,m=[],l=0;l<a.gridNodeCount;l++){var T={latitudeShift:t.getFloat32(p+l*y,h),longitudeShift:t.getFloat32(p+l*y+4,h),latitudeAccuracy:t.getFloat32(p+l*y+8,h),longitudeAccuracy:t.getFloat32(p+l*y+12,h)};m.push(T)}return m}function Pn(t,r){if(!(this instanceof Pn))return new Pn(t);r=r||function(I){if(I)throw I};var a=FS(t);if(typeof a!="object"){r(t);return}var h=Pn.projections.get(a.projName);if(!h){r(t);return}if(a.datumCode&&a.datumCode!=="none"){var p=La(Ts,a.datumCode);p&&(a.datum_params=a.datum_params||(p.towgs84?p.towgs84.split(","):null),a.ellps=p.ellipse,a.datumName=p.datumName?p.datumName:a.datumCode)}a.k0=a.k0||1,a.axis=a.axis||"enu",a.ellps=a.ellps||"wgs84",a.lat1=a.lat1||a.lat0;var y=JS(a.a,a.b,a.rf,a.ellps,a.sphere),m=YS(y.a,y.b,y.rf,a.R_A),l=eT(a.nadgrids),T=a.datum||QS(a.datumCode,a.datum_params,y.a,y.b,m.es,m.ep2,l);Sy(this,a),Sy(this,h),this.a=y.a,this.b=y.b,this.rf=y.rf,this.sphere=y.sphere,this.es=m.es,this.e=m.e,this.ep2=m.ep2,this.datum=T,this.init(),r(null,this)}Pn.projections=KS;Pn.projections.start();function cT(t,r){return t.datum_type!==r.datum_type||t.a!==r.a||Math.abs(t.es-r.es)>5e-11?!1:t.datum_type===xo?t.datum_params[0]===r.datum_params[0]&&t.datum_params[1]===r.datum_params[1]&&t.datum_params[2]===r.datum_params[2]:t.datum_type===bo?t.datum_params[0]===r.datum_params[0]&&t.datum_params[1]===r.datum_params[1]&&t.datum_params[2]===r.datum_params[2]&&t.datum_params[3]===r.datum_params[3]&&t.datum_params[4]===r.datum_params[4]&&t.datum_params[5]===r.datum_params[5]&&t.datum_params[6]===r.datum_params[6]:!0}function Fv(t,r,a){var h=t.x,p=t.y,y=t.z?t.z:0,m,l,T,I;if(p<-Yt&&p>-1.001*Yt)p=-Yt;else if(p>Yt&&p<1.001*Yt)p=Yt;else{if(p<-Yt)return{x:-1/0,y:-1/0,z:t.z};if(p>Yt)return{x:1/0,y:1/0,z:t.z}}return h>Math.PI&&(h-=2*Math.PI),l=Math.sin(p),I=Math.cos(p),T=l*l,m=a/Math.sqrt(1-r*T),{x:(m+y)*I*Math.cos(h),y:(m+y)*I*Math.sin(h),z:(m*(1-r)+y)*l}}function Bv(t,r,a,h){var p=1e-12,y=p*p,m=30,l,T,I,k,P,L,K,tt,ot,vt,yt,At,ht,Tt=t.x,$t=t.y,qt=t.z?t.z:0,oe,ne,Vt;if(l=Math.sqrt(Tt*Tt+$t*$t),T=Math.sqrt(Tt*Tt+$t*$t+qt*qt),l/a<p){if(oe=0,T/a<p)return ne=Yt,Vt=-h,{x:t.x,y:t.y,z:t.z}}else oe=Math.atan2($t,Tt);I=qt/T,k=l/T,P=1/Math.sqrt(1-r*(2-r)*k*k),tt=k*(1-r)*P,ot=I*P,ht=0;do ht++,K=a/Math.sqrt(1-r*ot*ot),Vt=l*tt+qt*ot-K*(1-r*ot*ot),L=r*K/(K+Vt),P=1/Math.sqrt(1-L*(2-L)*k*k),vt=k*(1-L)*P,yt=I*P,At=yt*tt-vt*ot,tt=vt,ot=yt;while(At*At>y&&ht<m);return ne=Math.atan(yt/Math.abs(vt)),{x:oe,y:ne,z:Vt}}function hT(t,r,a){if(r===xo)return{x:t.x+a[0],y:t.y+a[1],z:t.z+a[2]};if(r===bo){var h=a[0],p=a[1],y=a[2],m=a[3],l=a[4],T=a[5],I=a[6];return{x:I*(t.x-T*t.y+l*t.z)+h,y:I*(T*t.x+t.y-m*t.z)+p,z:I*(-l*t.x+m*t.y+t.z)+y}}}function uT(t,r,a){if(r===xo)return{x:t.x-a[0],y:t.y-a[1],z:t.z-a[2]};if(r===bo){var h=a[0],p=a[1],y=a[2],m=a[3],l=a[4],T=a[5],I=a[6],k=(t.x-h)/I,P=(t.y-p)/I,L=(t.z-y)/I;return{x:k+T*P-l*L,y:-T*k+P+m*L,z:l*k-m*P+L}}}function Qu(t){return t===xo||t===bo}function dT(t,r,a){if(cT(t,r)||t.datum_type===Xp||r.datum_type===Xp)return a;var h=t.a,p=t.es;if(t.datum_type===Fl){var y=Ay(t,!1,a);if(y!==0)return;h=xy,p=by}var m=r.a,l=r.b,T=r.es;if(r.datum_type===Fl&&(m=xy,l=_S,T=by),p===T&&h===m&&!Qu(t.datum_type)&&!Qu(r.datum_type))return a;if(a=Fv(a,p,h),Qu(t.datum_type)&&(a=hT(a,t.datum_type,t.datum_params)),Qu(r.datum_type)&&(a=uT(a,r.datum_type,r.datum_params)),a=Bv(a,T,m,l),r.datum_type===Fl){var I=Ay(r,!0,a);if(I!==0)return}return a}function Ay(t,r,a){if(t.grids===null||t.grids.length===0)return console.log("Grid shift grids not found"),-1;var h={x:-a.x,y:a.y},p={x:Number.NaN,y:Number.NaN},y=[];t:for(var m=0;m<t.grids.length;m++){var l=t.grids[m];if(y.push(l.name),l.isNull){p=h;break}if(l.mandatory,l.grid===null){if(l.mandatory)return console.log("Unable to find mandatory grid '"+l.name+"'"),-1;continue}for(var T=l.grid.subgrids,I=0,k=T.length;I<k;I++){var P=T[I],L=(Math.abs(P.del[1])+Math.abs(P.del[0]))/1e4,K=P.ll[0]-L,tt=P.ll[1]-L,ot=P.ll[0]+(P.lim[0]-1)*P.del[0]+L,vt=P.ll[1]+(P.lim[1]-1)*P.del[1]+L;if(!(tt>h.y||K>h.x||vt<h.y||ot<h.x)&&(p=fT(h,r,P),!isNaN(p.x)))break t}}return isNaN(p.x)?(console.log("Failed to find a grid shift table for location '"+-h.x*En+" "+h.y*En+" tried: '"+y+"'"),-1):(a.x=-p.x,a.y=p.y,0)}function fT(t,r,a){var h={x:Number.NaN,y:Number.NaN};if(isNaN(t.x))return h;var p={x:t.x,y:t.y};p.x-=a.ll[0],p.y-=a.ll[1],p.x=_e(p.x-Math.PI)+Math.PI;var y=Ey(p,a);if(r){if(isNaN(y.x))return h;y.x=p.x-y.x,y.y=p.y-y.y;var m=9,l=1e-12,T,I;do{if(I=Ey(y,a),isNaN(I.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}T={x:p.x-(I.x+y.x),y:p.y-(I.y+y.y)},y.x+=T.x,y.y+=T.y}while(m--&&Math.abs(T.x)>l&&Math.abs(T.y)>l);if(m<0)return console.log("Inverse grid shift iterator failed to converge."),h;h.x=_e(y.x+a.ll[0]),h.y=y.y+a.ll[1]}else isNaN(y.x)||(h.x=t.x+y.x,h.y=t.y+y.y);return h}function Ey(t,r){var a={x:t.x/r.del[0],y:t.y/r.del[1]},h={x:Math.floor(a.x),y:Math.floor(a.y)},p={x:a.x-1*h.x,y:a.y-1*h.y},y={x:Number.NaN,y:Number.NaN},m;if(h.x<0||h.x>=r.lim[0]||h.y<0||h.y>=r.lim[1])return y;m=h.y*r.lim[0]+h.x;var l={x:r.cvs[m][0],y:r.cvs[m][1]};m++;var T={x:r.cvs[m][0],y:r.cvs[m][1]};m+=r.lim[0];var I={x:r.cvs[m][0],y:r.cvs[m][1]};m--;var k={x:r.cvs[m][0],y:r.cvs[m][1]},P=p.x*p.y,L=p.x*(1-p.y),K=(1-p.x)*(1-p.y),tt=(1-p.x)*p.y;return y.x=K*l.x+L*T.x+tt*k.x+P*I.x,y.y=K*l.y+L*T.y+tt*k.y+P*I.y,y}function Iy(t,r,a){var h=a.x,p=a.y,y=a.z||0,m,l,T,I={};for(T=0;T<3;T++)if(!(r&&T===2&&a.z===void 0))switch(T===0?(m=h,"ew".indexOf(t.axis[T])!==-1?l="x":l="y"):T===1?(m=p,"ns".indexOf(t.axis[T])!==-1?l="y":l="x"):(m=y,l="z"),t.axis[T]){case"e":I[l]=m;break;case"w":I[l]=-m;break;case"n":I[l]=m;break;case"s":I[l]=-m;break;case"u":a[l]!==void 0&&(I.z=m);break;case"d":a[l]!==void 0&&(I.z=-m);break;default:return null}return I}function Nv(t){var r={x:t[0],y:t[1]};return t.length>2&&(r.z=t[2]),t.length>3&&(r.m=t[3]),r}function pT(t){Py(t.x),Py(t.y)}function Py(t){if(typeof Number.isFinite=="function"){if(Number.isFinite(t))return;throw new TypeError("coordinates must be finite numbers")}if(typeof t!="number"||t!==t||!isFinite(t))throw new TypeError("coordinates must be finite numbers")}function mT(t,r){return(t.datum.datum_type===xo||t.datum.datum_type===bo||t.datum.datum_type===Fl)&&r.datumCode!=="WGS84"||(r.datum.datum_type===xo||r.datum.datum_type===bo||r.datum.datum_type===Fl)&&t.datumCode!=="WGS84"}function Td(t,r,a,h){var p;Array.isArray(a)?a=Nv(a):a={x:a.x,y:a.y,z:a.z,m:a.m};var y=a.z!==void 0;if(pT(a),t.datum&&r.datum&&mT(t,r)&&(p=new Pn("WGS84"),a=Td(t,p,a,h),t=p),h&&t.axis!=="enu"&&(a=Iy(t,!1,a)),t.projName==="longlat")a={x:a.x*Ns,y:a.y*Ns,z:a.z||0};else if(t.to_meter&&(a={x:a.x*t.to_meter,y:a.y*t.to_meter,z:a.z||0}),a=t.inverse(a),!a)return;if(t.from_greenwich&&(a.x+=t.from_greenwich),a=dT(t.datum,r.datum,a),!!a)return r.from_greenwich&&(a={x:a.x-r.from_greenwich,y:a.y,z:a.z||0}),r.projName==="longlat"?a={x:a.x*En,y:a.y*En,z:a.z||0}:(a=r.forward(a),r.to_meter&&(a={x:a.x/r.to_meter,y:a.y/r.to_meter,z:a.z||0})),h&&r.axis!=="enu"?Iy(r,!0,a):(a&&!y&&delete a.z,a)}var Cy=Pn("WGS84");function Tp(t,r,a,h){var p,y,m;return Array.isArray(a)?(p=Td(t,r,a,h)||{x:NaN,y:NaN},a.length>2?typeof t.name<"u"&&t.name==="geocent"||typeof r.name<"u"&&r.name==="geocent"?typeof p.z=="number"?[p.x,p.y,p.z].concat(a.splice(3)):[p.x,p.y,a[2]].concat(a.splice(3)):[p.x,p.y].concat(a.splice(2)):[p.x,p.y]):(y=Td(t,r,a,h),m=Object.keys(a),m.length===2||m.forEach(function(l){if(typeof t.name<"u"&&t.name==="geocent"||typeof r.name<"u"&&r.name==="geocent"){if(l==="x"||l==="y"||l==="z")return}else if(l==="x"||l==="y")return;y[l]=a[l]}),y)}function Dy(t){return t instanceof Pn?t:t.oProj?t.oProj:Pn(t)}function Fr(t,r,a){t=Dy(t);var h=!1,p;return typeof r>"u"?(r=t,t=Cy,h=!0):(typeof r.x<"u"||Array.isArray(r))&&(a=r,r=t,t=Cy,h=!0),r=Dy(r),a?Tp(t,r,a):(p={forward:function(y,m){return Tp(t,r,y,m)},inverse:function(y,m){return Tp(r,t,y,m)}},h&&(p.oProj=r),p)}var ky=6,$v="AJSAJS",Vv="AFAFAF",Cl=65,br=73,Wr=79,rh=86,nh=90;const gT={forward:Uv,inverse:_T,toPoint:qv};function Uv(t,r){return r=r||5,xT(yT({lat:t[1],lon:t[0]}),r)}function _T(t){var r=km(Gv(t.toUpperCase()));return r.lat&&r.lon?[r.lon,r.lat,r.lon,r.lat]:[r.left,r.bottom,r.right,r.top]}function qv(t){var r=km(Gv(t.toUpperCase()));return r.lat&&r.lon?[r.lon,r.lat]:[(r.left+r.right)/2,(r.top+r.bottom)/2]}function Ap(t){return t*(Math.PI/180)}function Ry(t){return 180*(t/Math.PI)}function yT(t){var r=t.lat,a=t.lon,h=6378137,p=.00669438,y=.9996,m,l,T,I,k,P,L,K=Ap(r),tt=Ap(a),ot,vt;vt=Math.floor((a+180)/6)+1,a===180&&(vt=60),r>=56&&r<64&&a>=3&&a<12&&(vt=32),r>=72&&r<84&&(a>=0&&a<9?vt=31:a>=9&&a<21?vt=33:a>=21&&a<33?vt=35:a>=33&&a<42&&(vt=37)),m=(vt-1)*6-180+3,ot=Ap(m),l=p/(1-p),T=h/Math.sqrt(1-p*Math.sin(K)*Math.sin(K)),I=Math.tan(K)*Math.tan(K),k=l*Math.cos(K)*Math.cos(K),P=Math.cos(K)*(tt-ot),L=h*((1-p/4-3*p*p/64-5*p*p*p/256)*K-(3*p/8+3*p*p/32+45*p*p*p/1024)*Math.sin(2*K)+(15*p*p/256+45*p*p*p/1024)*Math.sin(4*K)-35*p*p*p/3072*Math.sin(6*K));var yt=y*T*(P+(1-I+k)*P*P*P/6+(5-18*I+I*I+72*k-58*l)*P*P*P*P*P/120)+5e5,At=y*(L+T*Math.tan(K)*(P*P/2+(5-I+9*k+4*k*k)*P*P*P*P/24+(61-58*I+I*I+600*k-330*l)*P*P*P*P*P*P/720));return r<0&&(At+=1e7),{northing:Math.round(At),easting:Math.round(yt),zoneNumber:vt,zoneLetter:vT(r)}}function km(t){var r=t.northing,a=t.easting,h=t.zoneLetter,p=t.zoneNumber;if(p<0||p>60)return null;var y=.9996,m=6378137,l=.00669438,T,I=(1-Math.sqrt(1-l))/(1+Math.sqrt(1-l)),k,P,L,K,tt,ot,vt,yt,At,ht=a-5e5,Tt=r;h<"N"&&(Tt-=1e7),vt=(p-1)*6-180+3,T=l/(1-l),ot=Tt/y,yt=ot/(m*(1-l/4-3*l*l/64-5*l*l*l/256)),At=yt+(3*I/2-27*I*I*I/32)*Math.sin(2*yt)+(21*I*I/16-55*I*I*I*I/32)*Math.sin(4*yt)+151*I*I*I/96*Math.sin(6*yt),k=m/Math.sqrt(1-l*Math.sin(At)*Math.sin(At)),P=Math.tan(At)*Math.tan(At),L=T*Math.cos(At)*Math.cos(At),K=m*(1-l)/Math.pow(1-l*Math.sin(At)*Math.sin(At),1.5),tt=ht/(k*y);var $t=At-k*Math.tan(At)/K*(tt*tt/2-(5+3*P+10*L-4*L*L-9*T)*tt*tt*tt*tt/24+(61+90*P+298*L+45*P*P-252*T-3*L*L)*tt*tt*tt*tt*tt*tt/720);$t=Ry($t);var qt=(tt-(1+2*P+L)*tt*tt*tt/6+(5-2*L+28*P-3*L*L+8*T+24*P*P)*tt*tt*tt*tt*tt/120)/Math.cos(At);qt=vt+Ry(qt);var oe;if(t.accuracy){var ne=km({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});oe={top:ne.lat,right:ne.lon,bottom:$t,left:qt}}else oe={lat:$t,lon:qt};return oe}function vT(t){var r="Z";return 84>=t&&t>=72?r="X":72>t&&t>=64?r="W":64>t&&t>=56?r="V":56>t&&t>=48?r="U":48>t&&t>=40?r="T":40>t&&t>=32?r="S":32>t&&t>=24?r="R":24>t&&t>=16?r="Q":16>t&&t>=8?r="P":8>t&&t>=0?r="N":0>t&&t>=-8?r="M":-8>t&&t>=-16?r="L":-16>t&&t>=-24?r="K":-24>t&&t>=-32?r="J":-32>t&&t>=-40?r="H":-40>t&&t>=-48?r="G":-48>t&&t>=-56?r="F":-56>t&&t>=-64?r="E":-64>t&&t>=-72?r="D":-72>t&&t>=-80&&(r="C"),r}function xT(t,r){var a="00000"+t.easting,h="00000"+t.northing;return t.zoneNumber+t.zoneLetter+bT(t.easting,t.northing,t.zoneNumber)+a.substr(a.length-5,r)+h.substr(h.length-5,r)}function bT(t,r,a){var h=jv(a),p=Math.floor(t/1e5),y=Math.floor(r/1e5)%20;return wT(p,y,h)}function jv(t){var r=t%ky;return r===0&&(r=ky),r}function wT(t,r,a){var h=a-1,p=$v.charCodeAt(h),y=Vv.charCodeAt(h),m=p+t-1,l=y+r,T=!1;m>nh&&(m=m-nh+Cl-1,T=!0),(m===br||p<br&&m>br||(m>br||p<br)&&T)&&m++,(m===Wr||p<Wr&&m>Wr||(m>Wr||p<Wr)&&T)&&(m++,m===br&&m++),m>nh&&(m=m-nh+Cl-1),l>rh?(l=l-rh+Cl-1,T=!0):T=!1,(l===br||y<br&&l>br||(l>br||y<br)&&T)&&l++,(l===Wr||y<Wr&&l>Wr||(l>Wr||y<Wr)&&T)&&(l++,l===br&&l++),l>rh&&(l=l-rh+Cl-1);var I=String.fromCharCode(m)+String.fromCharCode(l);return I}function Gv(t){if(t&&t.length===0)throw"MGRSPoint coverting from nothing";for(var r=t.length,a=null,h="",p,y=0;!/[A-Z]/.test(p=t.charAt(y));){if(y>=2)throw"MGRSPoint bad conversion from: "+t;h+=p,y++}var m=parseInt(h,10);if(y===0||y+3>r)throw"MGRSPoint bad conversion from: "+t;var l=t.charAt(y++);if(l<="A"||l==="B"||l==="Y"||l>="Z"||l==="I"||l==="O")throw"MGRSPoint zone letter "+l+" not handled: "+t;a=t.substring(y,y+=2);for(var T=jv(m),I=MT(a.charAt(0),T),k=ST(a.charAt(1),T);k<TT(l);)k+=2e6;var P=r-y;if(P%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+t;var L=P/2,K=0,tt=0,ot,vt,yt,At,ht;return L>0&&(ot=1e5/Math.pow(10,L),vt=t.substring(y,y+L),K=parseFloat(vt)*ot,yt=t.substring(y+L),tt=parseFloat(yt)*ot),At=K+I,ht=tt+k,{easting:At,northing:ht,zoneLetter:l,zoneNumber:m,accuracy:ot}}function MT(t,r){for(var a=$v.charCodeAt(r-1),h=1e5,p=!1;a!==t.charCodeAt(0);){if(a++,a===br&&a++,a===Wr&&a++,a>nh){if(p)throw"Bad character: "+t;a=Cl,p=!0}h+=1e5}return h}function ST(t,r){if(t>"V")throw"MGRSPoint given invalid Northing "+t;for(var a=Vv.charCodeAt(r-1),h=0,p=!1;a!==t.charCodeAt(0);){if(a++,a===br&&a++,a===Wr&&a++,a>rh){if(p)throw"Bad character: "+t;a=Cl,p=!0}h+=1e5}return h}function TT(t){var r;switch(t){case"C":r=11e5;break;case"D":r=2e6;break;case"E":r=28e5;break;case"F":r=37e5;break;case"G":r=46e5;break;case"H":r=55e5;break;case"J":r=64e5;break;case"K":r=73e5;break;case"L":r=82e5;break;case"M":r=91e5;break;case"N":r=0;break;case"P":r=8e5;break;case"Q":r=17e5;break;case"R":r=26e5;break;case"S":r=35e5;break;case"T":r=44e5;break;case"U":r=53e5;break;case"V":r=62e5;break;case"W":r=7e6;break;case"X":r=79e5;break;default:r=-1}if(r>=0)return r;throw"Invalid zone letter: "+t}function ql(t,r,a){if(!(this instanceof ql))return new ql(t,r,a);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if(typeof t=="object")this.x=t.x,this.y=t.y,this.z=t.z||0;else if(typeof t=="string"&&typeof r>"u"){var h=t.split(",");this.x=parseFloat(h[0],10),this.y=parseFloat(h[1],10),this.z=parseFloat(h[2],10)||0}else this.x=t,this.y=r,this.z=a||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}ql.fromMGRS=function(t){return new ql(qv(t))};ql.prototype.toMGRS=function(t){return Uv([this.x,this.y],t)};var AT=1,ET=.25,zy=.046875,Ly=.01953125,Oy=.01068115234375,IT=.75,PT=.46875,CT=.013020833333333334,DT=.007120768229166667,kT=.3645833333333333,RT=.005696614583333333,zT=.3076171875;function Hv(t){var r=[];r[0]=AT-t*(ET+t*(zy+t*(Ly+t*Oy))),r[1]=t*(IT-t*(zy+t*(Ly+t*Oy)));var a=t*t;return r[2]=a*(PT-t*(CT+t*DT)),a*=t,r[3]=a*(kT-t*RT),r[4]=a*t*zT,r}function Jd(t,r,a,h){return a*=r,r*=r,h[0]*t-a*(h[1]+r*(h[2]+r*(h[3]+r*h[4])))}var LT=20;function Wv(t,r,a){for(var h=1/(1-r),p=t,y=LT;y;--y){var m=Math.sin(p),l=1-r*m*m;if(l=(Jd(p,m,Math.cos(p),a)-t)*(l*Math.sqrt(l))*h,p-=l,Math.abs(l)<pe)return p}return p}function OT(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=Hv(this.es),this.ml0=Jd(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function FT(t){var r=t.x,a=t.y,h=_e(r-this.long0),p,y,m,l=Math.sin(a),T=Math.cos(a);if(this.es){var k=T*h,P=Math.pow(k,2),L=this.ep2*Math.pow(T,2),K=Math.pow(L,2),tt=Math.abs(T)>pe?Math.tan(a):0,ot=Math.pow(tt,2),vt=Math.pow(ot,2);p=1-this.es*Math.pow(l,2),k=k/Math.sqrt(p);var yt=Jd(a,l,T,this.en);y=this.a*(this.k0*k*(1+P/6*(1-ot+L+P/20*(5-18*ot+vt+14*L-58*ot*L+P/42*(61+179*vt-vt*ot-479*ot)))))+this.x0,m=this.a*(this.k0*(yt-this.ml0+l*h*k/2*(1+P/12*(5-ot+9*L+4*K+P/30*(61+vt-58*ot+270*L-330*ot*L+P/56*(1385+543*vt-vt*ot-3111*ot))))))+this.y0}else{var I=T*Math.sin(h);if(Math.abs(Math.abs(I)-1)<pe)return 93;if(y=.5*this.a*this.k0*Math.log((1+I)/(1-I))+this.x0,m=T*Math.cos(h)/Math.sqrt(1-Math.pow(I,2)),I=Math.abs(m),I>=1){if(I-1>pe)return 93;m=0}else m=Math.acos(m);a<0&&(m=-m),m=this.a*this.k0*(m-this.lat0)+this.y0}return t.x=y,t.y=m,t}function BT(t){var r,a,h,p,y=(t.x-this.x0)*(1/this.a),m=(t.y-this.y0)*(1/this.a);if(this.es)if(r=this.ml0+m/this.k0,a=Wv(r,this.es,this.en),Math.abs(a)<Yt){var P=Math.sin(a),L=Math.cos(a),K=Math.abs(L)>pe?Math.tan(a):0,tt=this.ep2*Math.pow(L,2),ot=Math.pow(tt,2),vt=Math.pow(K,2),yt=Math.pow(vt,2);r=1-this.es*Math.pow(P,2);var At=y*Math.sqrt(r)/this.k0,ht=Math.pow(At,2);r=r*K,h=a-r*ht/(1-this.es)*.5*(1-ht/12*(5+3*vt-9*tt*vt+tt-4*ot-ht/30*(61+90*vt-252*tt*vt+45*yt+46*tt-ht/56*(1385+3633*vt+4095*yt+1574*yt*vt)))),p=_e(this.long0+At*(1-ht/6*(1+2*vt+tt-ht/20*(5+28*vt+24*yt+8*tt*vt+6*tt-ht/42*(61+662*vt+1320*yt+720*yt*vt))))/L)}else h=Yt*Rh(m),p=0;else{var l=Math.exp(y/this.k0),T=.5*(l-1/l),I=this.lat0+m/this.k0,k=Math.cos(I);r=Math.sqrt((1-Math.pow(k,2))/(1+Math.pow(T,2))),h=Math.asin(r),m<0&&(h=-h),T===0&&k===0?p=0:p=_e(Math.atan2(T,k)+this.long0)}return t.x=p,t.y=h,t}var NT=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const hd={init:OT,forward:FT,inverse:BT,names:NT};function Zv(t){var r=Math.exp(t);return r=(r-1/r)/2,r}function Zr(t,r){t=Math.abs(t),r=Math.abs(r);var a=Math.max(t,r),h=Math.min(t,r)/(a||1);return a*Math.sqrt(1+Math.pow(h,2))}function $T(t){var r=1+t,a=r-1;return a===0?t:t*Math.log(r)/a}function VT(t){var r=Math.abs(t);return r=$T(r*(1+r/(Zr(1,r)+1))),t<0?-r:r}function Rm(t,r){for(var a=2*Math.cos(2*r),h=t.length-1,p=t[h],y=0,m;--h>=0;)m=-y+a*p+t[h],y=p,p=m;return r+m*Math.sin(2*r)}function UT(t,r){for(var a=2*Math.cos(r),h=t.length-1,p=t[h],y=0,m;--h>=0;)m=-y+a*p+t[h],y=p,p=m;return Math.sin(r)*m}function qT(t){var r=Math.exp(t);return r=(r+1/r)/2,r}function Kv(t,r,a){for(var h=Math.sin(r),p=Math.cos(r),y=Zv(a),m=qT(a),l=2*p*m,T=-2*h*y,I=t.length-1,k=t[I],P=0,L=0,K=0,tt,ot;--I>=0;)tt=L,ot=P,L=k,P=K,k=-tt+l*L-T*P+t[I],K=-ot+T*L+l*P;return l=h*m,T=p*y,[l*k-T*K,l*K+T*k]}function jT(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(hd.init.apply(this),this.forward=hd.forward,this.inverse=hd.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var t=this.es/(1+Math.sqrt(1-this.es)),r=t/(2-t),a=r;this.cgb[0]=r*(2+r*(-2/3+r*(-2+r*(116/45+r*(26/45+r*(-2854/675)))))),this.cbg[0]=r*(-2+r*(2/3+r*(4/3+r*(-82/45+r*(32/45+r*(4642/4725)))))),a=a*r,this.cgb[1]=a*(7/3+r*(-8/5+r*(-227/45+r*(2704/315+r*(2323/945))))),this.cbg[1]=a*(5/3+r*(-16/15+r*(-13/9+r*(904/315+r*(-1522/945))))),a=a*r,this.cgb[2]=a*(56/15+r*(-136/35+r*(-1262/105+r*(73814/2835)))),this.cbg[2]=a*(-26/15+r*(34/21+r*(8/5+r*(-12686/2835)))),a=a*r,this.cgb[3]=a*(4279/630+r*(-332/35+r*(-399572/14175))),this.cbg[3]=a*(1237/630+r*(-12/5+r*(-24832/14175))),a=a*r,this.cgb[4]=a*(4174/315+r*(-144838/6237)),this.cbg[4]=a*(-734/315+r*(109598/31185)),a=a*r,this.cgb[5]=a*(601676/22275),this.cbg[5]=a*(444337/155925),a=Math.pow(r,2),this.Qn=this.k0/(1+r)*(1+a*(1/4+a*(1/64+a/256))),this.utg[0]=r*(-.5+r*(2/3+r*(-37/96+r*(1/360+r*(81/512+r*(-96199/604800)))))),this.gtu[0]=r*(.5+r*(-2/3+r*(5/16+r*(41/180+r*(-127/288+r*(7891/37800)))))),this.utg[1]=a*(-1/48+r*(-1/15+r*(437/1440+r*(-46/105+r*(1118711/3870720))))),this.gtu[1]=a*(13/48+r*(-3/5+r*(557/1440+r*(281/630+r*(-1983433/1935360))))),a=a*r,this.utg[2]=a*(-17/480+r*(37/840+r*(209/4480+r*(-5569/90720)))),this.gtu[2]=a*(61/240+r*(-103/140+r*(15061/26880+r*(167603/181440)))),a=a*r,this.utg[3]=a*(-4397/161280+r*(11/504+r*(830251/7257600))),this.gtu[3]=a*(49561/161280+r*(-179/168+r*(6601661/7257600))),a=a*r,this.utg[4]=a*(-4583/161280+r*(108847/3991680)),this.gtu[4]=a*(34729/80640+r*(-3418889/1995840)),a=a*r,this.utg[5]=a*(-20648693/638668800),this.gtu[5]=a*(212378941/319334400);var h=Rm(this.cbg,this.lat0);this.Zb=-this.Qn*(h+UT(this.gtu,2*h))}function GT(t){var r=_e(t.x-this.long0),a=t.y;a=Rm(this.cbg,a);var h=Math.sin(a),p=Math.cos(a),y=Math.sin(r),m=Math.cos(r);a=Math.atan2(h,m*p),r=Math.atan2(y*p,Zr(h,p*m)),r=VT(Math.tan(r));var l=Kv(this.gtu,2*a,2*r);a=a+l[0],r=r+l[1];var T,I;return Math.abs(r)<=2.623395162778?(T=this.a*(this.Qn*r)+this.x0,I=this.a*(this.Qn*a+this.Zb)+this.y0):(T=1/0,I=1/0),t.x=T,t.y=I,t}function HT(t){var r=(t.x-this.x0)*(1/this.a),a=(t.y-this.y0)*(1/this.a);a=(a-this.Zb)/this.Qn,r=r/this.Qn;var h,p;if(Math.abs(r)<=2.623395162778){var y=Kv(this.utg,2*a,2*r);a=a+y[0],r=r+y[1],r=Math.atan(Zv(r));var m=Math.sin(a),l=Math.cos(a),T=Math.sin(r),I=Math.cos(r);a=Math.atan2(m*I,Zr(T,I*l)),r=Math.atan2(T,I*l),h=_e(r+this.long0),p=Rm(this.cgb,a)}else h=1/0,p=1/0;return t.x=h,t.y=p,t}var WT=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const ud={init:jT,forward:GT,inverse:HT,names:WT};function ZT(t,r){if(t===void 0){if(t=Math.floor((_e(r)+Math.PI)*30/Math.PI)+1,t<0)return 0;if(t>60)return 60}return t}var KT="etmerc";function XT(){var t=ZT(this.zone,this.long0);if(t===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(t)-183)*Ns,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,ud.init.apply(this),this.forward=ud.forward,this.inverse=ud.inverse}var YT=["Universal Transverse Mercator System","utm"];const JT={init:XT,names:YT,dependsOn:KT};function zm(t,r){return Math.pow((1-t)/(1+t),r)}var QT=20;function tA(){var t=Math.sin(this.lat0),r=Math.cos(this.lat0);r*=r,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*r*r/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+bi)/(Math.pow(Math.tan(.5*this.lat0+bi),this.C)*zm(this.e*t,this.ratexp))}function eA(t){var r=t.x,a=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*a+bi),this.C)*zm(this.e*Math.sin(a),this.ratexp))-Yt,t.x=this.C*r,t}function iA(t){for(var r=1e-14,a=t.x/this.C,h=t.y,p=Math.pow(Math.tan(.5*h+bi)/this.K,1/this.C),y=QT;y>0&&(h=2*Math.atan(p*zm(this.e*Math.sin(t.y),-.5*this.e))-Yt,!(Math.abs(h-t.y)<r));--y)t.y=h;return y?(t.x=a,t.y=h,t):null}var sA=["gauss"];const Lm={init:tA,forward:eA,inverse:iA,names:sA};function rA(){Lm.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function nA(t){var r,a,h,p;return t.x=_e(t.x-this.long0),Lm.forward.apply(this,[t]),r=Math.sin(t.y),a=Math.cos(t.y),h=Math.cos(t.x),p=this.k0*this.R2/(1+this.sinc0*r+this.cosc0*a*h),t.x=p*a*Math.sin(t.x),t.y=p*(this.cosc0*r-this.sinc0*a*h),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t}function aA(t){var r,a,h,p,y;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,y=Zr(t.x,t.y)){var m=2*Math.atan2(y,this.R2);r=Math.sin(m),a=Math.cos(m),p=Math.asin(a*this.sinc0+t.y*r*this.cosc0/y),h=Math.atan2(t.x*r,y*this.cosc0*a-t.y*this.sinc0*r)}else p=this.phic0,h=0;return t.x=h,t.y=p,Lm.inverse.apply(this,[t]),t.x=_e(t.x+this.long0),t}var oA=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const lA={init:rA,forward:nA,inverse:aA,names:oA};function cA(t,r,a){return r*=a,Math.tan(.5*(Yt+t))*Math.pow((1-r)/(1+r),.5*a)}function hA(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=pe&&(this.k0=.5*(1+Rh(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=pe&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=pe&&Math.abs(Math.cos(this.lat_ts))>pe&&(this.k0=.5*this.cons*Dn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/an(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=Dn(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-Yt,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function uA(t){var r=t.x,a=t.y,h=Math.sin(a),p=Math.cos(a),y,m,l,T,I,k,P=_e(r-this.long0);return Math.abs(Math.abs(r-this.long0)-Math.PI)<=pe&&Math.abs(a+this.lat0)<=pe?(t.x=NaN,t.y=NaN,t):this.sphere?(y=2*this.k0/(1+this.sinlat0*h+this.coslat0*p*Math.cos(P)),t.x=this.a*y*p*Math.sin(P)+this.x0,t.y=this.a*y*(this.coslat0*h-this.sinlat0*p*Math.cos(P))+this.y0,t):(m=2*Math.atan(this.ssfn_(a,h,this.e))-Yt,T=Math.cos(m),l=Math.sin(m),Math.abs(this.coslat0)<=pe?(I=an(this.e,a*this.con,this.con*h),k=2*this.a*this.k0*I/this.cons,t.x=this.x0+k*Math.sin(r-this.long0),t.y=this.y0-this.con*k*Math.cos(r-this.long0),t):(Math.abs(this.sinlat0)<pe?(y=2*this.a*this.k0/(1+T*Math.cos(P)),t.y=y*l):(y=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*l+this.cosX0*T*Math.cos(P))),t.y=y*(this.cosX0*l-this.sinX0*T*Math.cos(P))+this.y0),t.x=y*T*Math.sin(P)+this.x0,t))}function dA(t){t.x-=this.x0,t.y-=this.y0;var r,a,h,p,y,m=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var l=2*Math.atan(m/(2*this.a*this.k0));return r=this.long0,a=this.lat0,m<=pe?(t.x=r,t.y=a,t):(a=Math.asin(Math.cos(l)*this.sinlat0+t.y*Math.sin(l)*this.coslat0/m),Math.abs(this.coslat0)<pe?this.lat0>0?r=_e(this.long0+Math.atan2(t.x,-1*t.y)):r=_e(this.long0+Math.atan2(t.x,t.y)):r=_e(this.long0+Math.atan2(t.x*Math.sin(l),m*this.coslat0*Math.cos(l)-t.y*this.sinlat0*Math.sin(l))),t.x=r,t.y=a,t)}else if(Math.abs(this.coslat0)<=pe){if(m<=pe)return a=this.lat0,r=this.long0,t.x=r,t.y=a,t;t.x*=this.con,t.y*=this.con,h=m*this.cons/(2*this.a*this.k0),a=this.con*Ih(this.e,h),r=this.con*_e(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else p=2*Math.atan(m*this.cosX0/(2*this.a*this.k0*this.ms1)),r=this.long0,m<=pe?y=this.X0:(y=Math.asin(Math.cos(p)*this.sinX0+t.y*Math.sin(p)*this.cosX0/m),r=_e(this.long0+Math.atan2(t.x*Math.sin(p),m*this.cosX0*Math.cos(p)-t.y*this.sinX0*Math.sin(p)))),a=-1*Ih(this.e,Math.tan(.5*(Yt+y)));return t.x=r,t.y=a,t}var fA=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"];const pA={init:hA,forward:uA,inverse:dA,names:fA,ssfn_:cA};function mA(){var t=this.lat0;this.lambda0=this.long0;var r=Math.sin(t),a=this.a,h=this.rf,p=1/h,y=2*p-Math.pow(p,2),m=this.e=Math.sqrt(y);this.R=this.k0*a*Math.sqrt(1-y)/(1-y*Math.pow(r,2)),this.alpha=Math.sqrt(1+y/(1-y)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(r/this.alpha);var l=Math.log(Math.tan(Math.PI/4+this.b0/2)),T=Math.log(Math.tan(Math.PI/4+t/2)),I=Math.log((1+m*r)/(1-m*r));this.K=l-this.alpha*T+this.alpha*m/2*I}function gA(t){var r=Math.log(Math.tan(Math.PI/4-t.y/2)),a=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),h=-this.alpha*(r+a)+this.K,p=2*(Math.atan(Math.exp(h))-Math.PI/4),y=this.alpha*(t.x-this.lambda0),m=Math.atan(Math.sin(y)/(Math.sin(this.b0)*Math.tan(p)+Math.cos(this.b0)*Math.cos(y))),l=Math.asin(Math.cos(this.b0)*Math.sin(p)-Math.sin(this.b0)*Math.cos(p)*Math.cos(y));return t.y=this.R/2*Math.log((1+Math.sin(l))/(1-Math.sin(l)))+this.y0,t.x=this.R*m+this.x0,t}function _A(t){for(var r=t.x-this.x0,a=t.y-this.y0,h=r/this.R,p=2*(Math.atan(Math.exp(a/this.R))-Math.PI/4),y=Math.asin(Math.cos(this.b0)*Math.sin(p)+Math.sin(this.b0)*Math.cos(p)*Math.cos(h)),m=Math.atan(Math.sin(h)/(Math.cos(this.b0)*Math.cos(h)-Math.sin(this.b0)*Math.tan(p))),l=this.lambda0+m/this.alpha,T=0,I=y,k=-1e3,P=0;Math.abs(I-k)>1e-7;){if(++P>20)return;T=1/this.alpha*(Math.log(Math.tan(Math.PI/4+y/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(I))/2)),k=I,I=2*Math.atan(Math.exp(T))-Math.PI/2}return t.x=l,t.y=I,t}var yA=["somerc"];const vA={init:mA,forward:gA,inverse:_A,names:yA};var Al=1e-7;function xA(t){var r=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],a=typeof t.PROJECTION=="object"?Object.keys(t.PROJECTION)[0]:t.PROJECTION;return"no_uoff"in t||"no_off"in t||r.indexOf(a)!==-1}function bA(){var t,r,a,h,p,y,m,l,T,I,k=0,P,L=0,K=0,tt=0,ot=0,vt=0,yt=0;this.no_off=xA(this),this.no_rot="no_rot"in this;var At=!1;"alpha"in this&&(At=!0);var ht=!1;if("rectified_grid_angle"in this&&(ht=!0),At&&(yt=this.alpha),ht&&(k=this.rectified_grid_angle*Ns),At||ht)L=this.longc;else if(K=this.long1,ot=this.lat1,tt=this.long2,vt=this.lat2,Math.abs(ot-vt)<=Al||(t=Math.abs(ot))<=Al||Math.abs(t-Yt)<=Al||Math.abs(Math.abs(this.lat0)-Yt)<=Al||Math.abs(Math.abs(vt)-Yt)<=Al)throw new Error;var Tt=1-this.es;r=Math.sqrt(Tt),Math.abs(this.lat0)>pe?(l=Math.sin(this.lat0),a=Math.cos(this.lat0),t=1-this.es*l*l,this.B=a*a,this.B=Math.sqrt(1+this.es*this.B*this.B/Tt),this.A=this.B*this.k0*r/t,h=this.B*r/(a*Math.sqrt(t)),p=h*h-1,p<=0?p=0:(p=Math.sqrt(p),this.lat0<0&&(p=-p)),this.E=p+=h,this.E*=Math.pow(an(this.e,this.lat0,l),this.B)):(this.B=1/r,this.A=this.k0,this.E=h=p=1),At||ht?(At?(P=Math.asin(Math.sin(yt)/h),ht||(k=yt)):(P=k,yt=Math.asin(h*Math.sin(P))),this.lam0=L-Math.asin(.5*(p-1/p)*Math.tan(P))/this.B):(y=Math.pow(an(this.e,ot,Math.sin(ot)),this.B),m=Math.pow(an(this.e,vt,Math.sin(vt)),this.B),p=this.E/y,T=(m-y)/(m+y),I=this.E*this.E,I=(I-m*y)/(I+m*y),t=K-tt,t<-Math.pi?tt-=Ah:t>Math.pi&&(tt+=Ah),this.lam0=_e(.5*(K+tt)-Math.atan(I*Math.tan(.5*this.B*(K-tt))/T)/this.B),P=Math.atan(2*Math.sin(this.B*_e(K-this.lam0))/(p-1/p)),k=yt=Math.asin(h*Math.sin(P))),this.singam=Math.sin(P),this.cosgam=Math.cos(P),this.sinrot=Math.sin(k),this.cosrot=Math.cos(k),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(h*h-1)/Math.cos(yt))),this.lat0<0&&(this.u_0=-this.u_0)),p=.5*P,this.v_pole_n=this.ArB*Math.log(Math.tan(bi-p)),this.v_pole_s=this.ArB*Math.log(Math.tan(bi+p))}function wA(t){var r={},a,h,p,y,m,l,T,I;if(t.x=t.x-this.lam0,Math.abs(Math.abs(t.y)-Yt)>pe){if(m=this.E/Math.pow(an(this.e,t.y,Math.sin(t.y)),this.B),l=1/m,a=.5*(m-l),h=.5*(m+l),y=Math.sin(this.B*t.x),p=(a*this.singam-y*this.cosgam)/h,Math.abs(Math.abs(p)-1)<pe)throw new Error;I=.5*this.ArB*Math.log((1-p)/(1+p)),l=Math.cos(this.B*t.x),Math.abs(l)<Al?T=this.A*t.x:T=this.ArB*Math.atan2(a*this.cosgam+y*this.singam,l)}else I=t.y>0?this.v_pole_n:this.v_pole_s,T=this.ArB*t.y;return this.no_rot?(r.x=T,r.y=I):(T-=this.u_0,r.x=I*this.cosrot+T*this.sinrot,r.y=T*this.cosrot-I*this.sinrot),r.x=this.a*r.x+this.x0,r.y=this.a*r.y+this.y0,r}function MA(t){var r,a,h,p,y,m,l,T={};if(t.x=(t.x-this.x0)*(1/this.a),t.y=(t.y-this.y0)*(1/this.a),this.no_rot?(a=t.y,r=t.x):(a=t.x*this.cosrot-t.y*this.sinrot,r=t.y*this.cosrot+t.x*this.sinrot+this.u_0),h=Math.exp(-this.BrA*a),p=.5*(h-1/h),y=.5*(h+1/h),m=Math.sin(this.BrA*r),l=(m*this.cosgam+p*this.singam)/y,Math.abs(Math.abs(l)-1)<pe)T.x=0,T.y=l<0?-Yt:Yt;else{if(T.y=this.E/Math.sqrt((1+l)/(1-l)),T.y=Ih(this.e,Math.pow(T.y,1/this.B)),T.y===1/0)throw new Error;T.x=-this.rB*Math.atan2(p*this.cosgam-m*this.singam,Math.cos(this.BrA*r))}return T.x+=this.lam0,T}var SA=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const TA={init:bA,forward:wA,inverse:MA,names:SA};function AA(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<pe)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var r=Math.sin(this.lat1),a=Math.cos(this.lat1),h=Dn(this.e,r,a),p=an(this.e,this.lat1,r),y=Math.sin(this.lat2),m=Math.cos(this.lat2),l=Dn(this.e,y,m),T=an(this.e,this.lat2,y),I=an(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>pe?this.ns=Math.log(h/l)/Math.log(p/T):this.ns=r,isNaN(this.ns)&&(this.ns=r),this.f0=h/(this.ns*Math.pow(p,this.ns)),this.rh=this.a*this.f0*Math.pow(I,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function EA(t){var r=t.x,a=t.y;Math.abs(2*Math.abs(a)-Math.PI)<=pe&&(a=Rh(a)*(Yt-2*pe));var h=Math.abs(Math.abs(a)-Yt),p,y;if(h>pe)p=an(this.e,a,Math.sin(a)),y=this.a*this.f0*Math.pow(p,this.ns);else{if(h=a*this.ns,h<=0)return null;y=0}var m=this.ns*_e(r-this.long0);return t.x=this.k0*(y*Math.sin(m))+this.x0,t.y=this.k0*(this.rh-y*Math.cos(m))+this.y0,t}function IA(t){var r,a,h,p,y,m=(t.x-this.x0)/this.k0,l=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(r=Math.sqrt(m*m+l*l),a=1):(r=-Math.sqrt(m*m+l*l),a=-1);var T=0;if(r!==0&&(T=Math.atan2(a*m,a*l)),r!==0||this.ns>0){if(a=1/this.ns,h=Math.pow(r/(this.a*this.f0),a),p=Ih(this.e,h),p===-9999)return null}else p=-Yt;return y=_e(T/this.ns+this.long0),t.x=y,t.y=p,t}var PA=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const CA={init:AA,forward:EA,inverse:IA,names:PA};function DA(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function kA(t){var r,a,h,p,y,m,l,T=t.x,I=t.y,k=_e(T-this.long0);return r=Math.pow((1+this.e*Math.sin(I))/(1-this.e*Math.sin(I)),this.alfa*this.e/2),a=2*(Math.atan(this.k*Math.pow(Math.tan(I/2+this.s45),this.alfa)/r)-this.s45),h=-k*this.alfa,p=Math.asin(Math.cos(this.ad)*Math.sin(a)+Math.sin(this.ad)*Math.cos(a)*Math.cos(h)),y=Math.asin(Math.cos(a)*Math.sin(h)/Math.cos(p)),m=this.n*y,l=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(p/2+this.s45),this.n),t.y=l*Math.cos(m)/1,t.x=l*Math.sin(m)/1,this.czech||(t.y*=-1,t.x*=-1),t}function RA(t){var r,a,h,p,y,m,l,T,I=t.x;t.x=t.y,t.y=I,this.czech||(t.y*=-1,t.x*=-1),m=Math.sqrt(t.x*t.x+t.y*t.y),y=Math.atan2(t.y,t.x),p=y/Math.sin(this.s0),h=2*(Math.atan(Math.pow(this.ro0/m,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),r=Math.asin(Math.cos(this.ad)*Math.sin(h)-Math.sin(this.ad)*Math.cos(h)*Math.cos(p)),a=Math.asin(Math.cos(h)*Math.sin(p)/Math.cos(r)),t.x=this.long0-a/this.alfa,l=r,T=0;var k=0;do t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(r/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(l))/(1-this.e*Math.sin(l)),this.e/2))-this.s45),Math.abs(l-t.y)<1e-10&&(T=1),l=t.y,k+=1;while(T===0&&k<15);return k>=15?null:t}var zA=["Krovak","krovak"];const LA={init:DA,forward:kA,inverse:RA,names:zA};function dr(t,r,a,h,p){return t*p-r*Math.sin(2*p)+a*Math.sin(4*p)-h*Math.sin(6*p)}function zh(t){return 1-.25*t*(1+t/16*(3+1.25*t))}function Lh(t){return .375*t*(1+.25*t*(1+.46875*t))}function Oh(t){return .05859375*t*t*(1+.75*t)}function Fh(t){return t*t*t*(35/3072)}function jl(t,r,a){var h=r*a;return t/Math.sqrt(1-h*h)}function Wl(t){return Math.abs(t)<Yt?t:t-Rh(t)*Math.PI}function Ad(t,r,a,h,p){var y,m;y=t/r;for(var l=0;l<15;l++)if(m=(t-(r*y-a*Math.sin(2*y)+h*Math.sin(4*y)-p*Math.sin(6*y)))/(r-2*a*Math.cos(2*y)+4*h*Math.cos(4*y)-6*p*Math.cos(6*y)),y+=m,Math.abs(m)<=1e-10)return y;return NaN}function OA(){this.sphere||(this.e0=zh(this.es),this.e1=Lh(this.es),this.e2=Oh(this.es),this.e3=Fh(this.es),this.ml0=this.a*dr(this.e0,this.e1,this.e2,this.e3,this.lat0))}function FA(t){var r,a,h=t.x,p=t.y;if(h=_e(h-this.long0),this.sphere)r=this.a*Math.asin(Math.cos(p)*Math.sin(h)),a=this.a*(Math.atan2(Math.tan(p),Math.cos(h))-this.lat0);else{var y=Math.sin(p),m=Math.cos(p),l=jl(this.a,this.e,y),T=Math.tan(p)*Math.tan(p),I=h*Math.cos(p),k=I*I,P=this.es*m*m/(1-this.es),L=this.a*dr(this.e0,this.e1,this.e2,this.e3,p);r=l*I*(1-k*T*(1/6-(8-T+8*P)*k/120)),a=L-this.ml0+l*y/m*k*(.5+(5-T+6*P)*k/24)}return t.x=r+this.x0,t.y=a+this.y0,t}function BA(t){t.x-=this.x0,t.y-=this.y0;var r=t.x/this.a,a=t.y/this.a,h,p;if(this.sphere){var y=a+this.lat0;h=Math.asin(Math.sin(y)*Math.cos(r)),p=Math.atan2(Math.tan(r),Math.cos(y))}else{var m=this.ml0/this.a+a,l=Ad(m,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(l)-Yt)<=pe)return t.x=this.long0,t.y=Yt,a<0&&(t.y*=-1),t;var T=jl(this.a,this.e,Math.sin(l)),I=T*T*T/this.a/this.a*(1-this.es),k=Math.pow(Math.tan(l),2),P=r*this.a/T,L=P*P;h=l-T*Math.tan(l)/I*P*P*(.5-(1+3*k)*P*P/24),p=P*(1-L*(k/3+(1+3*k)*k*L/15))/Math.cos(l)}return t.x=_e(p+this.long0),t.y=Wl(h),t}var NA=["Cassini","Cassini_Soldner","cass"];const $A={init:OA,forward:FA,inverse:BA,names:NA};function ka(t,r){var a;return t>1e-7?(a=t*r,(1-t*t)*(r/(1-a*a)-.5/t*Math.log((1-a)/(1+a)))):2*r}var VA=1,UA=2,qA=3,jA=4;function GA(){var t=Math.abs(this.lat0);if(Math.abs(t-Yt)<pe?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(t)<pe?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var r;switch(this.qp=ka(this.e,1),this.mmf=.5/(1-this.es),this.apa=tE(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),r=Math.sin(this.lat0),this.sinb1=ka(this.e,r)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*r*r)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function HA(t){var r,a,h,p,y,m,l,T,I,k,P=t.x,L=t.y;if(P=_e(P-this.long0),this.sphere){if(y=Math.sin(L),k=Math.cos(L),h=Math.cos(P),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(a=this.mode===this.EQUIT?1+k*h:1+this.sinph0*y+this.cosph0*k*h,a<=pe)return null;a=Math.sqrt(2/a),r=a*k*Math.sin(P),a*=this.mode===this.EQUIT?y:this.cosph0*y-this.sinph0*k*h}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(h=-h),Math.abs(L+this.lat0)<pe)return null;a=bi-L*.5,a=2*(this.mode===this.S_POLE?Math.cos(a):Math.sin(a)),r=a*Math.sin(P),a*=h}}else{switch(l=0,T=0,I=0,h=Math.cos(P),p=Math.sin(P),y=Math.sin(L),m=ka(this.e,y),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(l=m/this.qp,T=Math.sqrt(1-l*l)),this.mode){case this.OBLIQ:I=1+this.sinb1*l+this.cosb1*T*h;break;case this.EQUIT:I=1+T*h;break;case this.N_POLE:I=Yt+L,m=this.qp-m;break;case this.S_POLE:I=L-Yt,m=this.qp+m;break}if(Math.abs(I)<pe)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:I=Math.sqrt(2/I),this.mode===this.OBLIQ?a=this.ymf*I*(this.cosb1*l-this.sinb1*T*h):a=(I=Math.sqrt(2/(1+T*h)))*l*this.ymf,r=this.xmf*I*T*p;break;case this.N_POLE:case this.S_POLE:m>=0?(r=(I=Math.sqrt(m))*p,a=h*(this.mode===this.S_POLE?I:-I)):r=a=0;break}}return t.x=this.a*r+this.x0,t.y=this.a*a+this.y0,t}function WA(t){t.x-=this.x0,t.y-=this.y0;var r=t.x/this.a,a=t.y/this.a,h,p,y,m,l,T,I;if(this.sphere){var k=0,P,L=0;if(P=Math.sqrt(r*r+a*a),p=P*.5,p>1)return null;switch(p=2*Math.asin(p),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(L=Math.sin(p),k=Math.cos(p)),this.mode){case this.EQUIT:p=Math.abs(P)<=pe?0:Math.asin(a*L/P),r*=L,a=k*P;break;case this.OBLIQ:p=Math.abs(P)<=pe?this.lat0:Math.asin(k*this.sinph0+a*L*this.cosph0/P),r*=L*this.cosph0,a=(k-Math.sin(p)*this.sinph0)*P;break;case this.N_POLE:a=-a,p=Yt-p;break;case this.S_POLE:p-=Yt;break}h=a===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(r,a)}else{if(I=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(r/=this.dd,a*=this.dd,T=Math.sqrt(r*r+a*a),T<pe)return t.x=this.long0,t.y=this.lat0,t;m=2*Math.asin(.5*T/this.rq),y=Math.cos(m),r*=m=Math.sin(m),this.mode===this.OBLIQ?(I=y*this.sinb1+a*m*this.cosb1/T,l=this.qp*I,a=T*this.cosb1*y-a*this.sinb1*m):(I=a*m/T,l=this.qp*I,a=T*y)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(a=-a),l=r*r+a*a,!l)return t.x=this.long0,t.y=this.lat0,t;I=1-l/this.qp,this.mode===this.S_POLE&&(I=-I)}h=Math.atan2(r,a),p=eE(Math.asin(I),this.apa)}return t.x=_e(this.long0+h),t.y=p,t}var ZA=.3333333333333333,KA=.17222222222222222,XA=.10257936507936508,YA=.06388888888888888,JA=.0664021164021164,QA=.016415012942191543;function tE(t){var r,a=[];return a[0]=t*ZA,r=t*t,a[0]+=r*KA,a[1]=r*YA,r*=t,a[0]+=r*XA,a[1]+=r*JA,a[2]=r*QA,a}function eE(t,r){var a=t+t;return t+r[0]*Math.sin(a)+r[1]*Math.sin(a+a)+r[2]*Math.sin(a+a+a)}var iE=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const sE={init:GA,forward:HA,inverse:WA,names:iE,S_POLE:VA,N_POLE:UA,EQUIT:qA,OBLIQ:jA};function Oa(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)}function rE(){Math.abs(this.lat1+this.lat2)<pe||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=Dn(this.e3,this.sin_po,this.cos_po),this.qs1=ka(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=Dn(this.e3,this.sin_po,this.cos_po),this.qs2=ka(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=ka(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>pe?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function nE(t){var r=t.x,a=t.y;this.sin_phi=Math.sin(a),this.cos_phi=Math.cos(a);var h=ka(this.e3,this.sin_phi),p=this.a*Math.sqrt(this.c-this.ns0*h)/this.ns0,y=this.ns0*_e(r-this.long0),m=p*Math.sin(y)+this.x0,l=this.rh-p*Math.cos(y)+this.y0;return t.x=m,t.y=l,t}function aE(t){var r,a,h,p,y,m;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(r=Math.sqrt(t.x*t.x+t.y*t.y),h=1):(r=-Math.sqrt(t.x*t.x+t.y*t.y),h=-1),p=0,r!==0&&(p=Math.atan2(h*t.x,h*t.y)),h=r*this.ns0/this.a,this.sphere?m=Math.asin((this.c-h*h)/(2*this.ns0)):(a=(this.c-h*h)/this.ns0,m=this.phi1z(this.e3,a)),y=_e(p/this.ns0+this.long0),t.x=y,t.y=m,t}function oE(t,r){var a,h,p,y,m,l=Oa(.5*r);if(t<pe)return l;for(var T=t*t,I=1;I<=25;I++)if(a=Math.sin(l),h=Math.cos(l),p=t*a,y=1-p*p,m=.5*y*y/h*(r/(1-T)-a/y+.5/t*Math.log((1-p)/(1+p))),l=l+m,Math.abs(m)<=1e-7)return l;return null}var lE=["Albers_Conic_Equal_Area","Albers","aea"];const cE={init:rE,forward:nE,inverse:aE,names:lE,phi1z:oE};function hE(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function uE(t){var r,a,h,p,y,m,l,T,I=t.x,k=t.y;return h=_e(I-this.long0),r=Math.sin(k),a=Math.cos(k),p=Math.cos(h),m=this.sin_p14*r+this.cos_p14*a*p,y=1,m>0||Math.abs(m)<=pe?(l=this.x0+this.a*y*a*Math.sin(h)/m,T=this.y0+this.a*y*(this.cos_p14*r-this.sin_p14*a*p)/m):(l=this.x0+this.infinity_dist*a*Math.sin(h),T=this.y0+this.infinity_dist*(this.cos_p14*r-this.sin_p14*a*p)),t.x=l,t.y=T,t}function dE(t){var r,a,h,p,y,m;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(r=Math.sqrt(t.x*t.x+t.y*t.y))?(p=Math.atan2(r,this.rc),a=Math.sin(p),h=Math.cos(p),m=Oa(h*this.sin_p14+t.y*a*this.cos_p14/r),y=Math.atan2(t.x*a,r*this.cos_p14*h-t.y*this.sin_p14*a),y=_e(this.long0+y)):(m=this.phic0,y=0),t.x=y,t.y=m,t}var fE=["gnom"];const pE={init:hE,forward:uE,inverse:dE,names:fE};function mE(t,r){var a=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(r)-a)<1e-6)return r<0?-1*Yt:Yt;for(var h=Math.asin(.5*r),p,y,m,l,T=0;T<30;T++)if(y=Math.sin(h),m=Math.cos(h),l=t*y,p=Math.pow(1-l*l,2)/(2*m)*(r/(1-t*t)-y/(1-l*l)+.5/t*Math.log((1-l)/(1+l))),h+=p,Math.abs(p)<=1e-10)return h;return NaN}function gE(){this.sphere||(this.k0=Dn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function _E(t){var r=t.x,a=t.y,h,p,y=_e(r-this.long0);if(this.sphere)h=this.x0+this.a*y*Math.cos(this.lat_ts),p=this.y0+this.a*Math.sin(a)/Math.cos(this.lat_ts);else{var m=ka(this.e,Math.sin(a));h=this.x0+this.a*this.k0*y,p=this.y0+this.a*m*.5/this.k0}return t.x=h,t.y=p,t}function yE(t){t.x-=this.x0,t.y-=this.y0;var r,a;return this.sphere?(r=_e(this.long0+t.x/this.a/Math.cos(this.lat_ts)),a=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(a=mE(this.e,2*t.y*this.k0/this.a),r=_e(this.long0+t.x/(this.a*this.k0))),t.x=r,t.y=a,t}var vE=["cea"];const xE={init:gE,forward:_E,inverse:yE,names:vE};function bE(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function wE(t){var r=t.x,a=t.y,h=_e(r-this.long0),p=Wl(a-this.lat0);return t.x=this.x0+this.a*h*this.rc,t.y=this.y0+this.a*p,t}function ME(t){var r=t.x,a=t.y;return t.x=_e(this.long0+(r-this.x0)/(this.a*this.rc)),t.y=Wl(this.lat0+(a-this.y0)/this.a),t}var SE=["Equirectangular","Equidistant_Cylindrical","eqc"];const TE={init:bE,forward:wE,inverse:ME,names:SE};var Fy=20;function AE(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=zh(this.es),this.e1=Lh(this.es),this.e2=Oh(this.es),this.e3=Fh(this.es),this.ml0=this.a*dr(this.e0,this.e1,this.e2,this.e3,this.lat0)}function EE(t){var r=t.x,a=t.y,h,p,y,m=_e(r-this.long0);if(y=m*Math.sin(a),this.sphere)Math.abs(a)<=pe?(h=this.a*m,p=-1*this.a*this.lat0):(h=this.a*Math.sin(y)/Math.tan(a),p=this.a*(Wl(a-this.lat0)+(1-Math.cos(y))/Math.tan(a)));else if(Math.abs(a)<=pe)h=this.a*m,p=-1*this.ml0;else{var l=jl(this.a,this.e,Math.sin(a))/Math.tan(a);h=l*Math.sin(y),p=this.a*dr(this.e0,this.e1,this.e2,this.e3,a)-this.ml0+l*(1-Math.cos(y))}return t.x=h+this.x0,t.y=p+this.y0,t}function IE(t){var r,a,h,p,y,m,l,T,I;if(h=t.x-this.x0,p=t.y-this.y0,this.sphere)if(Math.abs(p+this.a*this.lat0)<=pe)r=_e(h/this.a+this.long0),a=0;else{m=this.lat0+p/this.a,l=h*h/this.a/this.a+m*m,T=m;var k;for(y=Fy;y;--y)if(k=Math.tan(T),I=-1*(m*(T*k+1)-T-.5*(T*T+l)*k)/((T-m)/k-1),T+=I,Math.abs(I)<=pe){a=T;break}r=_e(this.long0+Math.asin(h*Math.tan(T)/this.a)/Math.sin(a))}else if(Math.abs(p+this.ml0)<=pe)a=0,r=_e(this.long0+h/this.a);else{m=(this.ml0+p)/this.a,l=h*h/this.a/this.a+m*m,T=m;var P,L,K,tt,ot;for(y=Fy;y;--y)if(ot=this.e*Math.sin(T),P=Math.sqrt(1-ot*ot)*Math.tan(T),L=this.a*dr(this.e0,this.e1,this.e2,this.e3,T),K=this.e0-2*this.e1*Math.cos(2*T)+4*this.e2*Math.cos(4*T)-6*this.e3*Math.cos(6*T),tt=L/this.a,I=(m*(P*tt+1)-tt-.5*P*(tt*tt+l))/(this.es*Math.sin(2*T)*(tt*tt+l-2*m*tt)/(4*P)+(m-tt)*(P*K-2/Math.sin(2*T))-K),T-=I,Math.abs(I)<=pe){a=T;break}P=Math.sqrt(1-this.es*Math.pow(Math.sin(a),2))*Math.tan(a),r=_e(this.long0+Math.asin(h*P/this.a)/Math.sin(a))}return t.x=r,t.y=a,t}var PE=["Polyconic","poly"];const CE={init:AE,forward:EE,inverse:IE,names:PE};function DE(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function kE(t){var r,a=t.x,h=t.y,p=h-this.lat0,y=a-this.long0,m=p/mh*1e-5,l=y,T=1,I=0;for(r=1;r<=10;r++)T=T*m,I=I+this.A[r]*T;var k=I,P=l,L=1,K=0,tt,ot,vt=0,yt=0;for(r=1;r<=6;r++)tt=L*k-K*P,ot=K*k+L*P,L=tt,K=ot,vt=vt+this.B_re[r]*L-this.B_im[r]*K,yt=yt+this.B_im[r]*L+this.B_re[r]*K;return t.x=yt*this.a+this.x0,t.y=vt*this.a+this.y0,t}function RE(t){var r,a=t.x,h=t.y,p=a-this.x0,y=h-this.y0,m=y/this.a,l=p/this.a,T=1,I=0,k,P,L=0,K=0;for(r=1;r<=6;r++)k=T*m-I*l,P=I*m+T*l,T=k,I=P,L=L+this.C_re[r]*T-this.C_im[r]*I,K=K+this.C_im[r]*T+this.C_re[r]*I;for(var tt=0;tt<this.iterations;tt++){var ot=L,vt=K,yt,At,ht=m,Tt=l;for(r=2;r<=6;r++)yt=ot*L-vt*K,At=vt*L+ot*K,ot=yt,vt=At,ht=ht+(r-1)*(this.B_re[r]*ot-this.B_im[r]*vt),Tt=Tt+(r-1)*(this.B_im[r]*ot+this.B_re[r]*vt);ot=1,vt=0;var $t=this.B_re[1],qt=this.B_im[1];for(r=2;r<=6;r++)yt=ot*L-vt*K,At=vt*L+ot*K,ot=yt,vt=At,$t=$t+r*(this.B_re[r]*ot-this.B_im[r]*vt),qt=qt+r*(this.B_im[r]*ot+this.B_re[r]*vt);var oe=$t*$t+qt*qt;L=(ht*$t+Tt*qt)/oe,K=(Tt*$t-ht*qt)/oe}var ne=L,Vt=K,Gt=1,Dt=0;for(r=1;r<=9;r++)Gt=Gt*ne,Dt=Dt+this.D[r]*Gt;var de=this.lat0+Dt*mh*1e5,De=this.long0+Vt;return t.x=De,t.y=de,t}var zE=["New_Zealand_Map_Grid","nzmg"];const LE={init:DE,forward:kE,inverse:RE,names:zE};function OE(){}function FE(t){var r=t.x,a=t.y,h=_e(r-this.long0),p=this.x0+this.a*h,y=this.y0+this.a*Math.log(Math.tan(Math.PI/4+a/2.5))*1.25;return t.x=p,t.y=y,t}function BE(t){t.x-=this.x0,t.y-=this.y0;var r=_e(this.long0+t.x/this.a),a=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=r,t.y=a,t}var NE=["Miller_Cylindrical","mill"];const $E={init:OE,forward:FE,inverse:BE,names:NE};var VE=20;function UE(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=Hv(this.es)}function qE(t){var r,a,h=t.x,p=t.y;if(h=_e(h-this.long0),this.sphere){if(!this.m)p=this.n!==1?Math.asin(this.n*Math.sin(p)):p;else for(var y=this.n*Math.sin(p),m=VE;m;--m){var l=(this.m*p+Math.sin(p)-y)/(this.m+Math.cos(p));if(p-=l,Math.abs(l)<pe)break}r=this.a*this.C_x*h*(this.m+Math.cos(p)),a=this.a*this.C_y*p}else{var T=Math.sin(p),I=Math.cos(p);a=this.a*Jd(p,T,I,this.en),r=this.a*h*I/Math.sqrt(1-this.es*T*T)}return t.x=r,t.y=a,t}function jE(t){var r,a,h,p;return t.x-=this.x0,h=t.x/this.a,t.y-=this.y0,r=t.y/this.a,this.sphere?(r/=this.C_y,h=h/(this.C_x*(this.m+Math.cos(r))),this.m?r=Oa((this.m*r+Math.sin(r))/this.n):this.n!==1&&(r=Oa(Math.sin(r)/this.n)),h=_e(h+this.long0),r=Wl(r)):(r=Wv(t.y/this.a,this.es,this.en),p=Math.abs(r),p<Yt?(p=Math.sin(r),a=this.long0+t.x*Math.sqrt(1-this.es*p*p)/(this.a*Math.cos(r)),h=_e(a)):p-pe<Yt&&(h=this.long0)),t.x=h,t.y=r,t}var GE=["Sinusoidal","sinu"];const HE={init:UE,forward:qE,inverse:jE,names:GE};function WE(){}function ZE(t){for(var r=t.x,a=t.y,h=_e(r-this.long0),p=a,y=Math.PI*Math.sin(a);;){var m=-(p+Math.sin(p)-y)/(1+Math.cos(p));if(p+=m,Math.abs(m)<pe)break}p/=2,Math.PI/2-Math.abs(a)<pe&&(h=0);var l=.900316316158*this.a*h*Math.cos(p)+this.x0,T=1.4142135623731*this.a*Math.sin(p)+this.y0;return t.x=l,t.y=T,t}function KE(t){var r,a;t.x-=this.x0,t.y-=this.y0,a=t.y/(1.4142135623731*this.a),Math.abs(a)>.999999999999&&(a=.999999999999),r=Math.asin(a);var h=_e(this.long0+t.x/(.900316316158*this.a*Math.cos(r)));h<-Math.PI&&(h=-Math.PI),h>Math.PI&&(h=Math.PI),a=(2*r+Math.sin(2*r))/Math.PI,Math.abs(a)>1&&(a=1);var p=Math.asin(a);return t.x=h,t.y=p,t}var XE=["Mollweide","moll"];const YE={init:WE,forward:ZE,inverse:KE,names:XE};function JE(){Math.abs(this.lat1+this.lat2)<pe||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=zh(this.es),this.e1=Lh(this.es),this.e2=Oh(this.es),this.e3=Fh(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=Dn(this.e,this.sinphi,this.cosphi),this.ml1=dr(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<pe?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=Dn(this.e,this.sinphi,this.cosphi),this.ml2=dr(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=dr(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function QE(t){var r=t.x,a=t.y,h;if(this.sphere)h=this.a*(this.g-a);else{var p=dr(this.e0,this.e1,this.e2,this.e3,a);h=this.a*(this.g-p)}var y=this.ns*_e(r-this.long0),m=this.x0+h*Math.sin(y),l=this.y0+this.rh-h*Math.cos(y);return t.x=m,t.y=l,t}function tI(t){t.x-=this.x0,t.y=this.rh-t.y+this.y0;var r,a,h,p;this.ns>=0?(a=Math.sqrt(t.x*t.x+t.y*t.y),r=1):(a=-Math.sqrt(t.x*t.x+t.y*t.y),r=-1);var y=0;if(a!==0&&(y=Math.atan2(r*t.x,r*t.y)),this.sphere)return p=_e(this.long0+y/this.ns),h=Wl(this.g-a/this.a),t.x=p,t.y=h,t;var m=this.g-a/this.a;return h=Ad(m,this.e0,this.e1,this.e2,this.e3),p=_e(this.long0+y/this.ns),t.x=p,t.y=h,t}var eI=["Equidistant_Conic","eqdc"];const iI={init:JE,forward:QE,inverse:tI,names:eI};function sI(){this.R=this.a}function rI(t){var r=t.x,a=t.y,h=_e(r-this.long0),p,y;Math.abs(a)<=pe&&(p=this.x0+this.R*h,y=this.y0);var m=Oa(2*Math.abs(a/Math.PI));(Math.abs(h)<=pe||Math.abs(Math.abs(a)-Yt)<=pe)&&(p=this.x0,a>=0?y=this.y0+Math.PI*this.R*Math.tan(.5*m):y=this.y0+Math.PI*this.R*-Math.tan(.5*m));var l=.5*Math.abs(Math.PI/h-h/Math.PI),T=l*l,I=Math.sin(m),k=Math.cos(m),P=k/(I+k-1),L=P*P,K=P*(2/I-1),tt=K*K,ot=Math.PI*this.R*(l*(P-tt)+Math.sqrt(T*(P-tt)*(P-tt)-(tt+T)*(L-tt)))/(tt+T);h<0&&(ot=-ot),p=this.x0+ot;var vt=T+P;return ot=Math.PI*this.R*(K*vt-l*Math.sqrt((tt+T)*(T+1)-vt*vt))/(tt+T),a>=0?y=this.y0+ot:y=this.y0-ot,t.x=p,t.y=y,t}function nI(t){var r,a,h,p,y,m,l,T,I,k,P,L,K;return t.x-=this.x0,t.y-=this.y0,P=Math.PI*this.R,h=t.x/P,p=t.y/P,y=h*h+p*p,m=-Math.abs(p)*(1+y),l=m-2*p*p+h*h,T=-2*m+1+2*p*p+y*y,K=p*p/T+(2*l*l*l/T/T/T-9*m*l/T/T)/27,I=(m-l*l/3/T)/T,k=2*Math.sqrt(-I/3),P=3*K/I/k,Math.abs(P)>1&&(P>=0?P=1:P=-1),L=Math.acos(P)/3,t.y>=0?a=(-k*Math.cos(L+Math.PI/3)-l/3/T)*Math.PI:a=-(-k*Math.cos(L+Math.PI/3)-l/3/T)*Math.PI,Math.abs(h)<pe?r=this.long0:r=_e(this.long0+Math.PI*(y-1+Math.sqrt(1+2*(h*h-p*p)+y*y))/2/h),t.x=r,t.y=a,t}var aI=["Van_der_Grinten_I","VanDerGrinten","vandg"];const oI={init:sI,forward:rI,inverse:nI,names:aI};function lI(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function cI(t){var r=t.x,a=t.y,h=Math.sin(t.y),p=Math.cos(t.y),y=_e(r-this.long0),m,l,T,I,k,P,L,K,tt,ot,vt,yt,At,ht,Tt,$t,qt,oe,ne,Vt,Gt,Dt,de;return this.sphere?Math.abs(this.sin_p12-1)<=pe?(t.x=this.x0+this.a*(Yt-a)*Math.sin(y),t.y=this.y0-this.a*(Yt-a)*Math.cos(y),t):Math.abs(this.sin_p12+1)<=pe?(t.x=this.x0+this.a*(Yt+a)*Math.sin(y),t.y=this.y0+this.a*(Yt+a)*Math.cos(y),t):(oe=this.sin_p12*h+this.cos_p12*p*Math.cos(y),$t=Math.acos(oe),qt=$t?$t/Math.sin($t):1,t.x=this.x0+this.a*qt*p*Math.sin(y),t.y=this.y0+this.a*qt*(this.cos_p12*h-this.sin_p12*p*Math.cos(y)),t):(m=zh(this.es),l=Lh(this.es),T=Oh(this.es),I=Fh(this.es),Math.abs(this.sin_p12-1)<=pe?(k=this.a*dr(m,l,T,I,Yt),P=this.a*dr(m,l,T,I,a),t.x=this.x0+(k-P)*Math.sin(y),t.y=this.y0-(k-P)*Math.cos(y),t):Math.abs(this.sin_p12+1)<=pe?(k=this.a*dr(m,l,T,I,Yt),P=this.a*dr(m,l,T,I,a),t.x=this.x0+(k+P)*Math.sin(y),t.y=this.y0+(k+P)*Math.cos(y),t):(L=h/p,K=jl(this.a,this.e,this.sin_p12),tt=jl(this.a,this.e,h),ot=Math.atan((1-this.es)*L+this.es*K*this.sin_p12/(tt*p)),vt=Math.atan2(Math.sin(y),this.cos_p12*Math.tan(ot)-this.sin_p12*Math.cos(y)),vt===0?ne=Math.asin(this.cos_p12*Math.sin(ot)-this.sin_p12*Math.cos(ot)):Math.abs(Math.abs(vt)-Math.PI)<=pe?ne=-Math.asin(this.cos_p12*Math.sin(ot)-this.sin_p12*Math.cos(ot)):ne=Math.asin(Math.sin(y)*Math.cos(ot)/Math.sin(vt)),yt=this.e*this.sin_p12/Math.sqrt(1-this.es),At=this.e*this.cos_p12*Math.cos(vt)/Math.sqrt(1-this.es),ht=yt*At,Tt=At*At,Vt=ne*ne,Gt=Vt*ne,Dt=Gt*ne,de=Dt*ne,$t=K*ne*(1-Vt*Tt*(1-Tt)/6+Gt/8*ht*(1-2*Tt)+Dt/120*(Tt*(4-7*Tt)-3*yt*yt*(1-7*Tt))-de/48*ht),t.x=this.x0+$t*Math.sin(vt),t.y=this.y0+$t*Math.cos(vt),t))}function hI(t){t.x-=this.x0,t.y-=this.y0;var r,a,h,p,y,m,l,T,I,k,P,L,K,tt,ot,vt,yt,At,ht,Tt,$t,qt,oe,ne;return this.sphere?(r=Math.sqrt(t.x*t.x+t.y*t.y),r>2*Yt*this.a?void 0:(a=r/this.a,h=Math.sin(a),p=Math.cos(a),y=this.long0,Math.abs(r)<=pe?m=this.lat0:(m=Oa(p*this.sin_p12+t.y*h*this.cos_p12/r),l=Math.abs(this.lat0)-Yt,Math.abs(l)<=pe?this.lat0>=0?y=_e(this.long0+Math.atan2(t.x,-t.y)):y=_e(this.long0-Math.atan2(-t.x,t.y)):y=_e(this.long0+Math.atan2(t.x*h,r*this.cos_p12*p-t.y*this.sin_p12*h))),t.x=y,t.y=m,t)):(T=zh(this.es),I=Lh(this.es),k=Oh(this.es),P=Fh(this.es),Math.abs(this.sin_p12-1)<=pe?(L=this.a*dr(T,I,k,P,Yt),r=Math.sqrt(t.x*t.x+t.y*t.y),K=L-r,m=Ad(K/this.a,T,I,k,P),y=_e(this.long0+Math.atan2(t.x,-1*t.y)),t.x=y,t.y=m,t):Math.abs(this.sin_p12+1)<=pe?(L=this.a*dr(T,I,k,P,Yt),r=Math.sqrt(t.x*t.x+t.y*t.y),K=r-L,m=Ad(K/this.a,T,I,k,P),y=_e(this.long0+Math.atan2(t.x,t.y)),t.x=y,t.y=m,t):(r=Math.sqrt(t.x*t.x+t.y*t.y),vt=Math.atan2(t.x,t.y),tt=jl(this.a,this.e,this.sin_p12),yt=Math.cos(vt),At=this.e*this.cos_p12*yt,ht=-At*At/(1-this.es),Tt=3*this.es*(1-ht)*this.sin_p12*this.cos_p12*yt/(1-this.es),$t=r/tt,qt=$t-ht*(1+ht)*Math.pow($t,3)/6-Tt*(1+3*ht)*Math.pow($t,4)/24,oe=1-ht*qt*qt/2-$t*qt*qt*qt/6,ot=Math.asin(this.sin_p12*Math.cos(qt)+this.cos_p12*Math.sin(qt)*yt),y=_e(this.long0+Math.asin(Math.sin(vt)*Math.sin(qt)/Math.cos(ot))),ne=Math.sin(ot),m=Math.atan2((ne-this.es*oe*this.sin_p12)*Math.tan(ot),ne*(1-this.es)),t.x=y,t.y=m,t))}var uI=["Azimuthal_Equidistant","aeqd"];const dI={init:lI,forward:cI,inverse:hI,names:uI};function fI(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function pI(t){var r,a,h,p,y,m,l,T,I=t.x,k=t.y;return h=_e(I-this.long0),r=Math.sin(k),a=Math.cos(k),p=Math.cos(h),m=this.sin_p14*r+this.cos_p14*a*p,y=1,(m>0||Math.abs(m)<=pe)&&(l=this.a*y*a*Math.sin(h),T=this.y0+this.a*y*(this.cos_p14*r-this.sin_p14*a*p)),t.x=l,t.y=T,t}function mI(t){var r,a,h,p,y,m,l;return t.x-=this.x0,t.y-=this.y0,r=Math.sqrt(t.x*t.x+t.y*t.y),a=Oa(r/this.a),h=Math.sin(a),p=Math.cos(a),m=this.long0,Math.abs(r)<=pe?(l=this.lat0,t.x=m,t.y=l,t):(l=Oa(p*this.sin_p14+t.y*h*this.cos_p14/r),y=Math.abs(this.lat0)-Yt,Math.abs(y)<=pe?(this.lat0>=0?m=_e(this.long0+Math.atan2(t.x,-t.y)):m=_e(this.long0-Math.atan2(-t.x,t.y)),t.x=m,t.y=l,t):(m=_e(this.long0+Math.atan2(t.x*h,r*this.cos_p14*p-t.y*this.sin_p14*h)),t.x=m,t.y=l,t))}var gI=["ortho"];const _I={init:fI,forward:pI,inverse:mI,names:gI};var Ji={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},wi={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function yI(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=Yt-bi/2?this.face=Ji.TOP:this.lat0<=-(Yt-bi/2)?this.face=Ji.BOTTOM:Math.abs(this.long0)<=bi?this.face=Ji.FRONT:Math.abs(this.long0)<=Yt+bi?this.face=this.long0>0?Ji.RIGHT:Ji.LEFT:this.face=Ji.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function vI(t){var r={x:0,y:0},a,h,p,y,m,l,T={value:0};if(t.x-=this.long0,this.es!==0?a=Math.atan(this.one_minus_f_squared*Math.tan(t.y)):a=t.y,h=t.x,this.face===Ji.TOP)y=Yt-a,h>=bi&&h<=Yt+bi?(T.value=wi.AREA_0,p=h-Yt):h>Yt+bi||h<=-(Yt+bi)?(T.value=wi.AREA_1,p=h>0?h-_s:h+_s):h>-(Yt+bi)&&h<=-bi?(T.value=wi.AREA_2,p=h+Yt):(T.value=wi.AREA_3,p=h);else if(this.face===Ji.BOTTOM)y=Yt+a,h>=bi&&h<=Yt+bi?(T.value=wi.AREA_0,p=-h+Yt):h<bi&&h>=-bi?(T.value=wi.AREA_1,p=-h):h<-bi&&h>=-(Yt+bi)?(T.value=wi.AREA_2,p=-h-Yt):(T.value=wi.AREA_3,p=h>0?-h+_s:-h-_s);else{var I,k,P,L,K,tt,ot;this.face===Ji.RIGHT?h=Bl(h,+Yt):this.face===Ji.BACK?h=Bl(h,+_s):this.face===Ji.LEFT&&(h=Bl(h,-Yt)),L=Math.sin(a),K=Math.cos(a),tt=Math.sin(h),ot=Math.cos(h),I=K*ot,k=K*tt,P=L,this.face===Ji.FRONT?(y=Math.acos(I),p=td(y,P,k,T)):this.face===Ji.RIGHT?(y=Math.acos(k),p=td(y,P,-I,T)):this.face===Ji.BACK?(y=Math.acos(-I),p=td(y,P,-k,T)):this.face===Ji.LEFT?(y=Math.acos(-k),p=td(y,P,I,T)):(y=p=0,T.value=wi.AREA_0)}return l=Math.atan(12/_s*(p+Math.acos(Math.sin(p)*Math.cos(bi))-Yt)),m=Math.sqrt((1-Math.cos(y))/(Math.cos(l)*Math.cos(l))/(1-Math.cos(Math.atan(1/Math.cos(p))))),T.value===wi.AREA_1?l+=Yt:T.value===wi.AREA_2?l+=_s:T.value===wi.AREA_3&&(l+=1.5*_s),r.x=m*Math.cos(l),r.y=m*Math.sin(l),r.x=r.x*this.a+this.x0,r.y=r.y*this.a+this.y0,t.x=r.x,t.y=r.y,t}function xI(t){var r={lam:0,phi:0},a,h,p,y,m,l,T,I,k,P={value:0};if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,h=Math.atan(Math.sqrt(t.x*t.x+t.y*t.y)),a=Math.atan2(t.y,t.x),t.x>=0&&t.x>=Math.abs(t.y)?P.value=wi.AREA_0:t.y>=0&&t.y>=Math.abs(t.x)?(P.value=wi.AREA_1,a-=Yt):t.x<0&&-t.x>=Math.abs(t.y)?(P.value=wi.AREA_2,a=a<0?a+_s:a-_s):(P.value=wi.AREA_3,a+=Yt),k=_s/12*Math.tan(a),m=Math.sin(k)/(Math.cos(k)-1/Math.sqrt(2)),l=Math.atan(m),p=Math.cos(a),y=Math.tan(h),T=1-p*p*y*y*(1-Math.cos(Math.atan(1/Math.cos(l)))),T<-1?T=-1:T>1&&(T=1),this.face===Ji.TOP)I=Math.acos(T),r.phi=Yt-I,P.value===wi.AREA_0?r.lam=l+Yt:P.value===wi.AREA_1?r.lam=l<0?l+_s:l-_s:P.value===wi.AREA_2?r.lam=l-Yt:r.lam=l;else if(this.face===Ji.BOTTOM)I=Math.acos(T),r.phi=I-Yt,P.value===wi.AREA_0?r.lam=-l+Yt:P.value===wi.AREA_1?r.lam=-l:P.value===wi.AREA_2?r.lam=-l-Yt:r.lam=l<0?-l-_s:-l+_s;else{var L,K,tt;L=T,k=L*L,k>=1?tt=0:tt=Math.sqrt(1-k)*Math.sin(l),k+=tt*tt,k>=1?K=0:K=Math.sqrt(1-k),P.value===wi.AREA_1?(k=K,K=-tt,tt=k):P.value===wi.AREA_2?(K=-K,tt=-tt):P.value===wi.AREA_3&&(k=K,K=tt,tt=-k),this.face===Ji.RIGHT?(k=L,L=-K,K=k):this.face===Ji.BACK?(L=-L,K=-K):this.face===Ji.LEFT&&(k=L,L=K,K=-k),r.phi=Math.acos(-tt)-Yt,r.lam=Math.atan2(K,L),this.face===Ji.RIGHT?r.lam=Bl(r.lam,-Yt):this.face===Ji.BACK?r.lam=Bl(r.lam,-_s):this.face===Ji.LEFT&&(r.lam=Bl(r.lam,+Yt))}if(this.es!==0){var ot,vt,yt;ot=r.phi<0?1:0,vt=Math.tan(r.phi),yt=this.b/Math.sqrt(vt*vt+this.one_minus_f_squared),r.phi=Math.atan(Math.sqrt(this.a*this.a-yt*yt)/(this.one_minus_f*yt)),ot&&(r.phi=-r.phi)}return r.lam+=this.long0,t.x=r.lam,t.y=r.phi,t}function td(t,r,a,h){var p;return t<pe?(h.value=wi.AREA_0,p=0):(p=Math.atan2(r,a),Math.abs(p)<=bi?h.value=wi.AREA_0:p>bi&&p<=Yt+bi?(h.value=wi.AREA_1,p-=Yt):p>Yt+bi||p<=-(Yt+bi)?(h.value=wi.AREA_2,p=p>=0?p-_s:p+_s):(h.value=wi.AREA_3,p+=Yt)),p}function Bl(t,r){var a=t+r;return a<-_s?a+=Ah:a>+_s&&(a-=Ah),a}var bI=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const wI={init:yI,forward:vI,inverse:xI,names:bI};var Qp=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],ah=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],Xv=.8487,Yv=1.3523,Jv=En/5,MI=1/Jv,Dl=18,Ed=function(t,r){return t[0]+r*(t[1]+r*(t[2]+r*t[3]))},SI=function(t,r){return t[1]+r*(2*t[2]+r*3*t[3])};function TI(t,r,a,h){for(var p=r;h;--h){var y=t(p);if(p-=y,Math.abs(y)<a)break}return p}function AI(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function EI(t){var r=_e(t.x-this.long0),a=Math.abs(t.y),h=Math.floor(a*Jv);h<0?h=0:h>=Dl&&(h=Dl-1),a=En*(a-MI*h);var p={x:Ed(Qp[h],a)*r,y:Ed(ah[h],a)};return t.y<0&&(p.y=-p.y),p.x=p.x*this.a*Xv+this.x0,p.y=p.y*this.a*Yv+this.y0,p}function II(t){var r={x:(t.x-this.x0)/(this.a*Xv),y:Math.abs(t.y-this.y0)/(this.a*Yv)};if(r.y>=1)r.x/=Qp[Dl][0],r.y=t.y<0?-Yt:Yt;else{var a=Math.floor(r.y*Dl);for(a<0?a=0:a>=Dl&&(a=Dl-1);;)if(ah[a][0]>r.y)--a;else if(ah[a+1][0]<=r.y)++a;else break;var h=ah[a],p=5*(r.y-h[0])/(ah[a+1][0]-h[0]);p=TI(function(y){return(Ed(h,y)-r.y)/SI(h,y)},p,pe,100),r.x/=Ed(Qp[a],p),r.y=(5*a+p)*Ns,t.y<0&&(r.y=-r.y)}return r.x=_e(r.x+this.long0),r}var PI=["Robinson","robin"];const CI={init:AI,forward:EI,inverse:II,names:PI};function DI(){this.name="geocent"}function kI(t){var r=Fv(t,this.es,this.a);return r}function RI(t){var r=Bv(t,this.es,this.a,this.b);return r}var zI=["Geocentric","geocentric","geocent","Geocent"];const LI={init:DI,forward:kI,inverse:RI,names:zI};var Js={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},Jc={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function OI(){if(Object.keys(Jc).forEach((function(a){if(typeof this[a]>"u")this[a]=Jc[a].def;else{if(Jc[a].num&&isNaN(this[a]))throw new Error("Invalid parameter value, must be numeric "+a+" = "+this[a]);Jc[a].num&&(this[a]=parseFloat(this[a]))}Jc[a].degrees&&(this[a]=this[a]*Ns)}).bind(this)),Math.abs(Math.abs(this.lat0)-Yt)<pe?this.mode=this.lat0<0?Js.S_POLE:Js.N_POLE:Math.abs(this.lat0)<pe?this.mode=Js.EQUIT:(this.mode=Js.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var t=this.tilt,r=this.azi;this.cg=Math.cos(r),this.sg=Math.sin(r),this.cw=Math.cos(t),this.sw=Math.sin(t)}function FI(t){t.x-=this.long0;var r=Math.sin(t.y),a=Math.cos(t.y),h=Math.cos(t.x),p,y;switch(this.mode){case Js.OBLIQ:y=this.sinph0*r+this.cosph0*a*h;break;case Js.EQUIT:y=a*h;break;case Js.S_POLE:y=-r;break;case Js.N_POLE:y=r;break}switch(y=this.pn1/(this.p-y),p=y*a*Math.sin(t.x),this.mode){case Js.OBLIQ:y*=this.cosph0*r-this.sinph0*a*h;break;case Js.EQUIT:y*=r;break;case Js.N_POLE:y*=-(a*h);break;case Js.S_POLE:y*=a*h;break}var m,l;return m=y*this.cg+p*this.sg,l=1/(m*this.sw*this.h1+this.cw),p=(p*this.cg-y*this.sg)*this.cw*l,y=m*l,t.x=p*this.a,t.y=y*this.a,t}function BI(t){t.x/=this.a,t.y/=this.a;var r={x:t.x,y:t.y},a,h,p;p=1/(this.pn1-t.y*this.sw),a=this.pn1*t.x*p,h=this.pn1*t.y*this.cw*p,t.x=a*this.cg+h*this.sg,t.y=h*this.cg-a*this.sg;var y=Zr(t.x,t.y);if(Math.abs(y)<pe)r.x=0,r.y=t.y;else{var m,l;switch(l=1-y*y*this.pfact,l=(this.p-Math.sqrt(l))/(this.pn1/y+y/this.pn1),m=Math.sqrt(1-l*l),this.mode){case Js.OBLIQ:r.y=Math.asin(m*this.sinph0+t.y*l*this.cosph0/y),t.y=(m-this.sinph0*Math.sin(r.y))*y,t.x*=l*this.cosph0;break;case Js.EQUIT:r.y=Math.asin(t.y*l/y),t.y=m*y,t.x*=l;break;case Js.N_POLE:r.y=Math.asin(m),t.y=-t.y;break;case Js.S_POLE:r.y=-Math.asin(m);break}r.x=Math.atan2(t.x,t.y)}return t.x=r.x+this.long0,t.y=r.y,t}var NI=["Tilted_Perspective","tpers"];const $I={init:OI,forward:FI,inverse:BI,names:NI};function VI(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var t=1-this.es,r=1/t;this.radius_p=Math.sqrt(t),this.radius_p2=t,this.radius_p_inv2=r,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function UI(t){var r=t.x,a=t.y,h,p,y,m;if(r=r-this.long0,this.shape==="ellipse"){a=Math.atan(this.radius_p2*Math.tan(a));var l=this.radius_p/Zr(this.radius_p*Math.cos(a),Math.sin(a));if(p=l*Math.cos(r)*Math.cos(a),y=l*Math.sin(r)*Math.cos(a),m=l*Math.sin(a),(this.radius_g-p)*p-y*y-m*m*this.radius_p_inv2<0)return t.x=Number.NaN,t.y=Number.NaN,t;h=this.radius_g-p,this.flip_axis?(t.x=this.radius_g_1*Math.atan(y/Zr(m,h)),t.y=this.radius_g_1*Math.atan(m/h)):(t.x=this.radius_g_1*Math.atan(y/h),t.y=this.radius_g_1*Math.atan(m/Zr(y,h)))}else this.shape==="sphere"&&(h=Math.cos(a),p=Math.cos(r)*h,y=Math.sin(r)*h,m=Math.sin(a),h=this.radius_g-p,this.flip_axis?(t.x=this.radius_g_1*Math.atan(y/Zr(m,h)),t.y=this.radius_g_1*Math.atan(m/h)):(t.x=this.radius_g_1*Math.atan(y/h),t.y=this.radius_g_1*Math.atan(m/Zr(y,h))));return t.x=t.x*this.a,t.y=t.y*this.a,t}function qI(t){var r=-1,a=0,h=0,p,y,m,l;if(t.x=t.x/this.a,t.y=t.y/this.a,this.shape==="ellipse"){this.flip_axis?(h=Math.tan(t.y/this.radius_g_1),a=Math.tan(t.x/this.radius_g_1)*Zr(1,h)):(a=Math.tan(t.x/this.radius_g_1),h=Math.tan(t.y/this.radius_g_1)*Zr(1,a));var T=h/this.radius_p;if(p=a*a+T*T+r*r,y=2*this.radius_g*r,m=y*y-4*p*this.C,m<0)return t.x=Number.NaN,t.y=Number.NaN,t;l=(-y-Math.sqrt(m))/(2*p),r=this.radius_g+l*r,a*=l,h*=l,t.x=Math.atan2(a,r),t.y=Math.atan(h*Math.cos(t.x)/r),t.y=Math.atan(this.radius_p_inv2*Math.tan(t.y))}else if(this.shape==="sphere"){if(this.flip_axis?(h=Math.tan(t.y/this.radius_g_1),a=Math.tan(t.x/this.radius_g_1)*Math.sqrt(1+h*h)):(a=Math.tan(t.x/this.radius_g_1),h=Math.tan(t.y/this.radius_g_1)*Math.sqrt(1+a*a)),p=a*a+h*h+r*r,y=2*this.radius_g*r,m=y*y-4*p*this.C,m<0)return t.x=Number.NaN,t.y=Number.NaN,t;l=(-y-Math.sqrt(m))/(2*p),r=this.radius_g+l*r,a*=l,h*=l,t.x=Math.atan2(a,r),t.y=Math.atan(h*Math.cos(t.x)/r)}return t.x=t.x+this.long0,t}var jI=["Geostationary Satellite View","Geostationary_Satellite","geos"];const GI={init:VI,forward:UI,inverse:qI,names:jI};var gh=1.340264,_h=-.081106,yh=893e-6,vh=.003796,Id=Math.sqrt(3)/2;function HI(){this.es=0,this.long0=this.long0!==void 0?this.long0:0}function WI(t){var r=_e(t.x-this.long0),a=t.y,h=Math.asin(Id*Math.sin(a)),p=h*h,y=p*p*p;return t.x=r*Math.cos(h)/(Id*(gh+3*_h*p+y*(7*yh+9*vh*p))),t.y=h*(gh+_h*p+y*(yh+vh*p)),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t}function ZI(t){t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a;var r=1e-9,a=12,h=t.y,p,y,m,l,T,I;for(I=0;I<a&&(p=h*h,y=p*p*p,m=h*(gh+_h*p+y*(yh+vh*p))-t.y,l=gh+3*_h*p+y*(7*yh+9*vh*p),h-=T=m/l,!(Math.abs(T)<r));++I);return p=h*h,y=p*p*p,t.x=Id*t.x*(gh+3*_h*p+y*(7*yh+9*vh*p))/Math.cos(h),t.y=Math.asin(Math.sin(h)/Id),t.x=_e(t.x+this.long0),t}var KI=["eqearth","Equal Earth","Equal_Earth"];const XI={init:HI,forward:WI,inverse:ZI,names:KI};function YI(t){t.Proj.projections.add(hd),t.Proj.projections.add(ud),t.Proj.projections.add(JT),t.Proj.projections.add(lA),t.Proj.projections.add(pA),t.Proj.projections.add(vA),t.Proj.projections.add(TA),t.Proj.projections.add(CA),t.Proj.projections.add(LA),t.Proj.projections.add($A),t.Proj.projections.add(sE),t.Proj.projections.add(cE),t.Proj.projections.add(pE),t.Proj.projections.add(xE),t.Proj.projections.add(TE),t.Proj.projections.add(CE),t.Proj.projections.add(LE),t.Proj.projections.add($E),t.Proj.projections.add(HE),t.Proj.projections.add(YE),t.Proj.projections.add(iI),t.Proj.projections.add(oI),t.Proj.projections.add(dI),t.Proj.projections.add(_I),t.Proj.projections.add(wI),t.Proj.projections.add(CI),t.Proj.projections.add(LI),t.Proj.projections.add($I),t.Proj.projections.add(GI),t.Proj.projections.add(XI)}Fr.defaultDatum="WGS84";Fr.Proj=Pn;Fr.WGS84=new Fr.Proj("WGS84");Fr.Point=ql;Fr.toPoint=Nv;Fr.defs=ur;Fr.nadgrid=tT;Fr.transform=Td;Fr.mgrs=gT;Fr.version="__VERSION__";YI(Fr);function Qv(t,r){return function(){return t.apply(r,arguments)}}const{toString:JI}=Object.prototype,{getPrototypeOf:Om}=Object,Qd=(t=>r=>{const a=JI.call(r);return t[a]||(t[a]=a.slice(8,-1).toLowerCase())})(Object.create(null)),kn=t=>(t=t.toLowerCase(),r=>Qd(r)===t),tf=t=>r=>typeof r===t,{isArray:Zl}=Array,Ph=tf("undefined");function QI(t){return t!==null&&!Ph(t)&&t.constructor!==null&&!Ph(t.constructor)&&Xr(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const tx=kn("ArrayBuffer");function tP(t){let r;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?r=ArrayBuffer.isView(t):r=t&&t.buffer&&tx(t.buffer),r}const eP=tf("string"),Xr=tf("function"),ex=tf("number"),ef=t=>t!==null&&typeof t=="object",iP=t=>t===!0||t===!1,dd=t=>{if(Qd(t)!=="object")return!1;const r=Om(t);return(r===null||r===Object.prototype||Object.getPrototypeOf(r)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},sP=kn("Date"),rP=kn("File"),nP=kn("Blob"),aP=kn("FileList"),oP=t=>ef(t)&&Xr(t.pipe),lP=t=>{let r;return t&&(typeof FormData=="function"&&t instanceof FormData||Xr(t.append)&&((r=Qd(t))==="formdata"||r==="object"&&Xr(t.toString)&&t.toString()==="[object FormData]"))},cP=kn("URLSearchParams"),hP=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Bh(t,r,{allOwnKeys:a=!1}={}){if(t===null||typeof t>"u")return;let h,p;if(typeof t!="object"&&(t=[t]),Zl(t))for(h=0,p=t.length;h<p;h++)r.call(null,t[h],h,t);else{const y=a?Object.getOwnPropertyNames(t):Object.keys(t),m=y.length;let l;for(h=0;h<m;h++)l=y[h],r.call(null,t[l],l,t)}}function ix(t,r){r=r.toLowerCase();const a=Object.keys(t);let h=a.length,p;for(;h-- >0;)if(p=a[h],r===p.toLowerCase())return p;return null}const sx=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,rx=t=>!Ph(t)&&t!==sx;function tm(){const{caseless:t}=rx(this)&&this||{},r={},a=(h,p)=>{const y=t&&ix(r,p)||p;dd(r[y])&&dd(h)?r[y]=tm(r[y],h):dd(h)?r[y]=tm({},h):Zl(h)?r[y]=h.slice():r[y]=h};for(let h=0,p=arguments.length;h<p;h++)arguments[h]&&Bh(arguments[h],a);return r}const uP=(t,r,a,{allOwnKeys:h}={})=>(Bh(r,(p,y)=>{a&&Xr(p)?t[y]=Qv(p,a):t[y]=p},{allOwnKeys:h}),t),dP=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),fP=(t,r,a,h)=>{t.prototype=Object.create(r.prototype,h),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:r.prototype}),a&&Object.assign(t.prototype,a)},pP=(t,r,a,h)=>{let p,y,m;const l={};if(r=r||{},t==null)return r;do{for(p=Object.getOwnPropertyNames(t),y=p.length;y-- >0;)m=p[y],(!h||h(m,t,r))&&!l[m]&&(r[m]=t[m],l[m]=!0);t=a!==!1&&Om(t)}while(t&&(!a||a(t,r))&&t!==Object.prototype);return r},mP=(t,r,a)=>{t=String(t),(a===void 0||a>t.length)&&(a=t.length),a-=r.length;const h=t.indexOf(r,a);return h!==-1&&h===a},gP=t=>{if(!t)return null;if(Zl(t))return t;let r=t.length;if(!ex(r))return null;const a=new Array(r);for(;r-- >0;)a[r]=t[r];return a},_P=(t=>r=>t&&r instanceof t)(typeof Uint8Array<"u"&&Om(Uint8Array)),yP=(t,r)=>{const h=(t&&t[Symbol.iterator]).call(t);let p;for(;(p=h.next())&&!p.done;){const y=p.value;r.call(t,y[0],y[1])}},vP=(t,r)=>{let a;const h=[];for(;(a=t.exec(r))!==null;)h.push(a);return h},xP=kn("HTMLFormElement"),bP=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(a,h,p){return h.toUpperCase()+p}),By=(({hasOwnProperty:t})=>(r,a)=>t.call(r,a))(Object.prototype),wP=kn("RegExp"),nx=(t,r)=>{const a=Object.getOwnPropertyDescriptors(t),h={};Bh(a,(p,y)=>{let m;(m=r(p,y,t))!==!1&&(h[y]=m||p)}),Object.defineProperties(t,h)},MP=t=>{nx(t,(r,a)=>{if(Xr(t)&&["arguments","caller","callee"].indexOf(a)!==-1)return!1;const h=t[a];if(Xr(h)){if(r.enumerable=!1,"writable"in r){r.writable=!1;return}r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+a+"'")})}})},SP=(t,r)=>{const a={},h=p=>{p.forEach(y=>{a[y]=!0})};return Zl(t)?h(t):h(String(t).split(r)),a},TP=()=>{},AP=(t,r)=>(t=+t,Number.isFinite(t)?t:r),Ep="abcdefghijklmnopqrstuvwxyz",Ny="0123456789",ax={DIGIT:Ny,ALPHA:Ep,ALPHA_DIGIT:Ep+Ep.toUpperCase()+Ny},EP=(t=16,r=ax.ALPHA_DIGIT)=>{let a="";const{length:h}=r;for(;t--;)a+=r[Math.random()*h|0];return a};function IP(t){return!!(t&&Xr(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const PP=t=>{const r=new Array(10),a=(h,p)=>{if(ef(h)){if(r.indexOf(h)>=0)return;if(!("toJSON"in h)){r[p]=h;const y=Zl(h)?[]:{};return Bh(h,(m,l)=>{const T=a(m,p+1);!Ph(T)&&(y[l]=T)}),r[p]=void 0,y}}return h};return a(t,0)},CP=kn("AsyncFunction"),DP=t=>t&&(ef(t)||Xr(t))&&Xr(t.then)&&Xr(t.catch),Nt={isArray:Zl,isArrayBuffer:tx,isBuffer:QI,isFormData:lP,isArrayBufferView:tP,isString:eP,isNumber:ex,isBoolean:iP,isObject:ef,isPlainObject:dd,isUndefined:Ph,isDate:sP,isFile:rP,isBlob:nP,isRegExp:wP,isFunction:Xr,isStream:oP,isURLSearchParams:cP,isTypedArray:_P,isFileList:aP,forEach:Bh,merge:tm,extend:uP,trim:hP,stripBOM:dP,inherits:fP,toFlatObject:pP,kindOf:Qd,kindOfTest:kn,endsWith:mP,toArray:gP,forEachEntry:yP,matchAll:vP,isHTMLForm:xP,hasOwnProperty:By,hasOwnProp:By,reduceDescriptors:nx,freezeMethods:MP,toObjectSet:SP,toCamelCase:bP,noop:TP,toFiniteNumber:AP,findKey:ix,global:sx,isContextDefined:rx,ALPHABET:ax,generateString:EP,isSpecCompliantForm:IP,toJSONObject:PP,isAsyncFn:CP,isThenable:DP};function li(t,r,a,h,p){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",r&&(this.code=r),a&&(this.config=a),h&&(this.request=h),p&&(this.response=p)}Nt.inherits(li,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Nt.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const ox=li.prototype,lx={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{lx[t]={value:t}});Object.defineProperties(li,lx);Object.defineProperty(ox,"isAxiosError",{value:!0});li.from=(t,r,a,h,p,y)=>{const m=Object.create(ox);return Nt.toFlatObject(t,m,function(T){return T!==Error.prototype},l=>l!=="isAxiosError"),li.call(m,t.message,r,a,h,p),m.cause=t,m.name=t.name,y&&Object.assign(m,y),m};const kP=null;function em(t){return Nt.isPlainObject(t)||Nt.isArray(t)}function cx(t){return Nt.endsWith(t,"[]")?t.slice(0,-2):t}function $y(t,r,a){return t?t.concat(r).map(function(p,y){return p=cx(p),!a&&y?"["+p+"]":p}).join(a?".":""):r}function RP(t){return Nt.isArray(t)&&!t.some(em)}const zP=Nt.toFlatObject(Nt,{},null,function(r){return/^is[A-Z]/.test(r)});function sf(t,r,a){if(!Nt.isObject(t))throw new TypeError("target must be an object");r=r||new FormData,a=Nt.toFlatObject(a,{metaTokens:!0,dots:!1,indexes:!1},!1,function(ot,vt){return!Nt.isUndefined(vt[ot])});const h=a.metaTokens,p=a.visitor||k,y=a.dots,m=a.indexes,T=(a.Blob||typeof Blob<"u"&&Blob)&&Nt.isSpecCompliantForm(r);if(!Nt.isFunction(p))throw new TypeError("visitor must be a function");function I(tt){if(tt===null)return"";if(Nt.isDate(tt))return tt.toISOString();if(!T&&Nt.isBlob(tt))throw new li("Blob is not supported. Use a Buffer instead.");return Nt.isArrayBuffer(tt)||Nt.isTypedArray(tt)?T&&typeof Blob=="function"?new Blob([tt]):Buffer.from(tt):tt}function k(tt,ot,vt){let yt=tt;if(tt&&!vt&&typeof tt=="object"){if(Nt.endsWith(ot,"{}"))ot=h?ot:ot.slice(0,-2),tt=JSON.stringify(tt);else if(Nt.isArray(tt)&&RP(tt)||(Nt.isFileList(tt)||Nt.endsWith(ot,"[]"))&&(yt=Nt.toArray(tt)))return ot=cx(ot),yt.forEach(function(ht,Tt){!(Nt.isUndefined(ht)||ht===null)&&r.append(m===!0?$y([ot],Tt,y):m===null?ot:ot+"[]",I(ht))}),!1}return em(tt)?!0:(r.append($y(vt,ot,y),I(tt)),!1)}const P=[],L=Object.assign(zP,{defaultVisitor:k,convertValue:I,isVisitable:em});function K(tt,ot){if(!Nt.isUndefined(tt)){if(P.indexOf(tt)!==-1)throw Error("Circular reference detected in "+ot.join("."));P.push(tt),Nt.forEach(tt,function(yt,At){(!(Nt.isUndefined(yt)||yt===null)&&p.call(r,yt,Nt.isString(At)?At.trim():At,ot,L))===!0&&K(yt,ot?ot.concat(At):[At])}),P.pop()}}if(!Nt.isObject(t))throw new TypeError("data must be an object");return K(t),r}function Vy(t){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(h){return r[h]})}function Fm(t,r){this._pairs=[],t&&sf(t,this,r)}const hx=Fm.prototype;hx.append=function(r,a){this._pairs.push([r,a])};hx.toString=function(r){const a=r?function(h){return r.call(this,h,Vy)}:Vy;return this._pairs.map(function(p){return a(p[0])+"="+a(p[1])},"").join("&")};function LP(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function ux(t,r,a){if(!r)return t;const h=a&&a.encode||LP,p=a&&a.serialize;let y;if(p?y=p(r,a):y=Nt.isURLSearchParams(r)?r.toString():new Fm(r,a).toString(h),y){const m=t.indexOf("#");m!==-1&&(t=t.slice(0,m)),t+=(t.indexOf("?")===-1?"?":"&")+y}return t}class Uy{constructor(){this.handlers=[]}use(r,a,h){return this.handlers.push({fulfilled:r,rejected:a,synchronous:h?h.synchronous:!1,runWhen:h?h.runWhen:null}),this.handlers.length-1}eject(r){this.handlers[r]&&(this.handlers[r]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(r){Nt.forEach(this.handlers,function(h){h!==null&&r(h)})}}const dx={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},OP=typeof URLSearchParams<"u"?URLSearchParams:Fm,FP=typeof FormData<"u"?FormData:null,BP=typeof Blob<"u"?Blob:null,NP={isBrowser:!0,classes:{URLSearchParams:OP,FormData:FP,Blob:BP},protocols:["http","https","file","blob","url","data"]},fx=typeof window<"u"&&typeof document<"u",$P=(t=>fx&&["ReactNative","NativeScript","NS"].indexOf(t)<0)(typeof navigator<"u"&&navigator.product),VP=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",UP=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:fx,hasStandardBrowserEnv:$P,hasStandardBrowserWebWorkerEnv:VP},Symbol.toStringTag,{value:"Module"})),In={...UP,...NP};function qP(t,r){return sf(t,new In.classes.URLSearchParams,Object.assign({visitor:function(a,h,p,y){return In.isNode&&Nt.isBuffer(a)?(this.append(h,a.toString("base64")),!1):y.defaultVisitor.apply(this,arguments)}},r))}function jP(t){return Nt.matchAll(/\w+|\[(\w*)]/g,t).map(r=>r[0]==="[]"?"":r[1]||r[0])}function GP(t){const r={},a=Object.keys(t);let h;const p=a.length;let y;for(h=0;h<p;h++)y=a[h],r[y]=t[y];return r}function px(t){function r(a,h,p,y){let m=a[y++];if(m==="__proto__")return!0;const l=Number.isFinite(+m),T=y>=a.length;return m=!m&&Nt.isArray(p)?p.length:m,T?(Nt.hasOwnProp(p,m)?p[m]=[p[m],h]:p[m]=h,!l):((!p[m]||!Nt.isObject(p[m]))&&(p[m]=[]),r(a,h,p[m],y)&&Nt.isArray(p[m])&&(p[m]=GP(p[m])),!l)}if(Nt.isFormData(t)&&Nt.isFunction(t.entries)){const a={};return Nt.forEachEntry(t,(h,p)=>{r(jP(h),p,a,0)}),a}return null}function HP(t,r,a){if(Nt.isString(t))try{return(r||JSON.parse)(t),Nt.trim(t)}catch(h){if(h.name!=="SyntaxError")throw h}return(a||JSON.stringify)(t)}const Bm={transitional:dx,adapter:["xhr","http"],transformRequest:[function(r,a){const h=a.getContentType()||"",p=h.indexOf("application/json")>-1,y=Nt.isObject(r);if(y&&Nt.isHTMLForm(r)&&(r=new FormData(r)),Nt.isFormData(r))return p?JSON.stringify(px(r)):r;if(Nt.isArrayBuffer(r)||Nt.isBuffer(r)||Nt.isStream(r)||Nt.isFile(r)||Nt.isBlob(r))return r;if(Nt.isArrayBufferView(r))return r.buffer;if(Nt.isURLSearchParams(r))return a.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),r.toString();let l;if(y){if(h.indexOf("application/x-www-form-urlencoded")>-1)return qP(r,this.formSerializer).toString();if((l=Nt.isFileList(r))||h.indexOf("multipart/form-data")>-1){const T=this.env&&this.env.FormData;return sf(l?{"files[]":r}:r,T&&new T,this.formSerializer)}}return y||p?(a.setContentType("application/json",!1),HP(r)):r}],transformResponse:[function(r){const a=this.transitional||Bm.transitional,h=a&&a.forcedJSONParsing,p=this.responseType==="json";if(r&&Nt.isString(r)&&(h&&!this.responseType||p)){const m=!(a&&a.silentJSONParsing)&&p;try{return JSON.parse(r)}catch(l){if(m)throw l.name==="SyntaxError"?li.from(l,li.ERR_BAD_RESPONSE,this,null,this.response):l}}return r}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:In.classes.FormData,Blob:In.classes.Blob},validateStatus:function(r){return r>=200&&r<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Nt.forEach(["delete","get","head","post","put","patch"],t=>{Bm.headers[t]={}});const Nm=Bm,WP=Nt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ZP=t=>{const r={};let a,h,p;return t&&t.split(`
`).forEach(function(m){p=m.indexOf(":"),a=m.substring(0,p).trim().toLowerCase(),h=m.substring(p+1).trim(),!(!a||r[a]&&WP[a])&&(a==="set-cookie"?r[a]?r[a].push(h):r[a]=[h]:r[a]=r[a]?r[a]+", "+h:h)}),r},qy=Symbol("internals");function Qc(t){return t&&String(t).trim().toLowerCase()}function fd(t){return t===!1||t==null?t:Nt.isArray(t)?t.map(fd):String(t)}function KP(t){const r=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let h;for(;h=a.exec(t);)r[h[1]]=h[2];return r}const XP=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function Ip(t,r,a,h,p){if(Nt.isFunction(h))return h.call(this,r,a);if(p&&(r=a),!!Nt.isString(r)){if(Nt.isString(h))return r.indexOf(h)!==-1;if(Nt.isRegExp(h))return h.test(r)}}function YP(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(r,a,h)=>a.toUpperCase()+h)}function JP(t,r){const a=Nt.toCamelCase(" "+r);["get","set","has"].forEach(h=>{Object.defineProperty(t,h+a,{value:function(p,y,m){return this[h].call(this,r,p,y,m)},configurable:!0})})}class rf{constructor(r){r&&this.set(r)}set(r,a,h){const p=this;function y(l,T,I){const k=Qc(T);if(!k)throw new Error("header name must be a non-empty string");const P=Nt.findKey(p,k);(!P||p[P]===void 0||I===!0||I===void 0&&p[P]!==!1)&&(p[P||T]=fd(l))}const m=(l,T)=>Nt.forEach(l,(I,k)=>y(I,k,T));return Nt.isPlainObject(r)||r instanceof this.constructor?m(r,a):Nt.isString(r)&&(r=r.trim())&&!XP(r)?m(ZP(r),a):r!=null&&y(a,r,h),this}get(r,a){if(r=Qc(r),r){const h=Nt.findKey(this,r);if(h){const p=this[h];if(!a)return p;if(a===!0)return KP(p);if(Nt.isFunction(a))return a.call(this,p,h);if(Nt.isRegExp(a))return a.exec(p);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,a){if(r=Qc(r),r){const h=Nt.findKey(this,r);return!!(h&&this[h]!==void 0&&(!a||Ip(this,this[h],h,a)))}return!1}delete(r,a){const h=this;let p=!1;function y(m){if(m=Qc(m),m){const l=Nt.findKey(h,m);l&&(!a||Ip(h,h[l],l,a))&&(delete h[l],p=!0)}}return Nt.isArray(r)?r.forEach(y):y(r),p}clear(r){const a=Object.keys(this);let h=a.length,p=!1;for(;h--;){const y=a[h];(!r||Ip(this,this[y],y,r,!0))&&(delete this[y],p=!0)}return p}normalize(r){const a=this,h={};return Nt.forEach(this,(p,y)=>{const m=Nt.findKey(h,y);if(m){a[m]=fd(p),delete a[y];return}const l=r?YP(y):String(y).trim();l!==y&&delete a[y],a[l]=fd(p),h[l]=!0}),this}concat(...r){return this.constructor.concat(this,...r)}toJSON(r){const a=Object.create(null);return Nt.forEach(this,(h,p)=>{h!=null&&h!==!1&&(a[p]=r&&Nt.isArray(h)?h.join(", "):h)}),a}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([r,a])=>r+": "+a).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r,...a){const h=new this(r);return a.forEach(p=>h.set(p)),h}static accessor(r){const h=(this[qy]=this[qy]={accessors:{}}).accessors,p=this.prototype;function y(m){const l=Qc(m);h[l]||(JP(p,m),h[l]=!0)}return Nt.isArray(r)?r.forEach(y):y(r),this}}rf.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Nt.reduceDescriptors(rf.prototype,({value:t},r)=>{let a=r[0].toUpperCase()+r.slice(1);return{get:()=>t,set(h){this[a]=h}}});Nt.freezeMethods(rf);const Jn=rf;function Pp(t,r){const a=this||Nm,h=r||a,p=Jn.from(h.headers);let y=h.data;return Nt.forEach(t,function(l){y=l.call(a,y,p.normalize(),r?r.status:void 0)}),p.normalize(),y}function mx(t){return!!(t&&t.__CANCEL__)}function Nh(t,r,a){li.call(this,t??"canceled",li.ERR_CANCELED,r,a),this.name="CanceledError"}Nt.inherits(Nh,li,{__CANCEL__:!0});function QP(t,r,a){const h=a.config.validateStatus;!a.status||!h||h(a.status)?t(a):r(new li("Request failed with status code "+a.status,[li.ERR_BAD_REQUEST,li.ERR_BAD_RESPONSE][Math.floor(a.status/100)-4],a.config,a.request,a))}const tC=In.hasStandardBrowserEnv?{write(t,r,a,h,p,y){const m=[t+"="+encodeURIComponent(r)];Nt.isNumber(a)&&m.push("expires="+new Date(a).toGMTString()),Nt.isString(h)&&m.push("path="+h),Nt.isString(p)&&m.push("domain="+p),y===!0&&m.push("secure"),document.cookie=m.join("; ")},read(t){const r=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function eC(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function iC(t,r){return r?t.replace(/\/?\/$/,"")+"/"+r.replace(/^\/+/,""):t}function gx(t,r){return t&&!eC(r)?iC(t,r):r}const sC=In.hasStandardBrowserEnv?function(){const r=/(msie|trident)/i.test(navigator.userAgent),a=document.createElement("a");let h;function p(y){let m=y;return r&&(a.setAttribute("href",m),m=a.href),a.setAttribute("href",m),{href:a.href,protocol:a.protocol?a.protocol.replace(/:$/,""):"",host:a.host,search:a.search?a.search.replace(/^\?/,""):"",hash:a.hash?a.hash.replace(/^#/,""):"",hostname:a.hostname,port:a.port,pathname:a.pathname.charAt(0)==="/"?a.pathname:"/"+a.pathname}}return h=p(window.location.href),function(m){const l=Nt.isString(m)?p(m):m;return l.protocol===h.protocol&&l.host===h.host}}():function(){return function(){return!0}}();function rC(t){const r=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return r&&r[1]||""}function nC(t,r){t=t||10;const a=new Array(t),h=new Array(t);let p=0,y=0,m;return r=r!==void 0?r:1e3,function(T){const I=Date.now(),k=h[y];m||(m=I),a[p]=T,h[p]=I;let P=y,L=0;for(;P!==p;)L+=a[P++],P=P%t;if(p=(p+1)%t,p===y&&(y=(y+1)%t),I-m<r)return;const K=k&&I-k;return K?Math.round(L*1e3/K):void 0}}function jy(t,r){let a=0;const h=nC(50,250);return p=>{const y=p.loaded,m=p.lengthComputable?p.total:void 0,l=y-a,T=h(l),I=y<=m;a=y;const k={loaded:y,total:m,progress:m?y/m:void 0,bytes:l,rate:T||void 0,estimated:T&&m&&I?(m-y)/T:void 0,event:p};k[r?"download":"upload"]=!0,t(k)}}const aC=typeof XMLHttpRequest<"u",oC=aC&&function(t){return new Promise(function(a,h){let p=t.data;const y=Jn.from(t.headers).normalize();let{responseType:m,withXSRFToken:l}=t,T;function I(){t.cancelToken&&t.cancelToken.unsubscribe(T),t.signal&&t.signal.removeEventListener("abort",T)}let k;if(Nt.isFormData(p)){if(In.hasStandardBrowserEnv||In.hasStandardBrowserWebWorkerEnv)y.setContentType(!1);else if((k=y.getContentType())!==!1){const[ot,...vt]=k?k.split(";").map(yt=>yt.trim()).filter(Boolean):[];y.setContentType([ot||"multipart/form-data",...vt].join("; "))}}let P=new XMLHttpRequest;if(t.auth){const ot=t.auth.username||"",vt=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";y.set("Authorization","Basic "+btoa(ot+":"+vt))}const L=gx(t.baseURL,t.url);P.open(t.method.toUpperCase(),ux(L,t.params,t.paramsSerializer),!0),P.timeout=t.timeout;function K(){if(!P)return;const ot=Jn.from("getAllResponseHeaders"in P&&P.getAllResponseHeaders()),yt={data:!m||m==="text"||m==="json"?P.responseText:P.response,status:P.status,statusText:P.statusText,headers:ot,config:t,request:P};QP(function(ht){a(ht),I()},function(ht){h(ht),I()},yt),P=null}if("onloadend"in P?P.onloadend=K:P.onreadystatechange=function(){!P||P.readyState!==4||P.status===0&&!(P.responseURL&&P.responseURL.indexOf("file:")===0)||setTimeout(K)},P.onabort=function(){P&&(h(new li("Request aborted",li.ECONNABORTED,t,P)),P=null)},P.onerror=function(){h(new li("Network Error",li.ERR_NETWORK,t,P)),P=null},P.ontimeout=function(){let vt=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded";const yt=t.transitional||dx;t.timeoutErrorMessage&&(vt=t.timeoutErrorMessage),h(new li(vt,yt.clarifyTimeoutError?li.ETIMEDOUT:li.ECONNABORTED,t,P)),P=null},In.hasStandardBrowserEnv&&(l&&Nt.isFunction(l)&&(l=l(t)),l||l!==!1&&sC(L))){const ot=t.xsrfHeaderName&&t.xsrfCookieName&&tC.read(t.xsrfCookieName);ot&&y.set(t.xsrfHeaderName,ot)}p===void 0&&y.setContentType(null),"setRequestHeader"in P&&Nt.forEach(y.toJSON(),function(vt,yt){P.setRequestHeader(yt,vt)}),Nt.isUndefined(t.withCredentials)||(P.withCredentials=!!t.withCredentials),m&&m!=="json"&&(P.responseType=t.responseType),typeof t.onDownloadProgress=="function"&&P.addEventListener("progress",jy(t.onDownloadProgress,!0)),typeof t.onUploadProgress=="function"&&P.upload&&P.upload.addEventListener("progress",jy(t.onUploadProgress)),(t.cancelToken||t.signal)&&(T=ot=>{P&&(h(!ot||ot.type?new Nh(null,t,P):ot),P.abort(),P=null)},t.cancelToken&&t.cancelToken.subscribe(T),t.signal&&(t.signal.aborted?T():t.signal.addEventListener("abort",T)));const tt=rC(L);if(tt&&In.protocols.indexOf(tt)===-1){h(new li("Unsupported protocol "+tt+":",li.ERR_BAD_REQUEST,t));return}P.send(p||null)})},im={http:kP,xhr:oC};Nt.forEach(im,(t,r)=>{if(t){try{Object.defineProperty(t,"name",{value:r})}catch{}Object.defineProperty(t,"adapterName",{value:r})}});const Gy=t=>`- ${t}`,lC=t=>Nt.isFunction(t)||t===null||t===!1,_x={getAdapter:t=>{t=Nt.isArray(t)?t:[t];const{length:r}=t;let a,h;const p={};for(let y=0;y<r;y++){a=t[y];let m;if(h=a,!lC(a)&&(h=im[(m=String(a)).toLowerCase()],h===void 0))throw new li(`Unknown adapter '${m}'`);if(h)break;p[m||"#"+y]=h}if(!h){const y=Object.entries(p).map(([l,T])=>`adapter ${l} `+(T===!1?"is not supported by the environment":"is not available in the build"));let m=r?y.length>1?`since :
`+y.map(Gy).join(`
`):" "+Gy(y[0]):"as no adapter specified";throw new li("There is no suitable adapter to dispatch the request "+m,"ERR_NOT_SUPPORT")}return h},adapters:im};function Cp(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Nh(null,t)}function Hy(t){return Cp(t),t.headers=Jn.from(t.headers),t.data=Pp.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),_x.getAdapter(t.adapter||Nm.adapter)(t).then(function(h){return Cp(t),h.data=Pp.call(t,t.transformResponse,h),h.headers=Jn.from(h.headers),h},function(h){return mx(h)||(Cp(t),h&&h.response&&(h.response.data=Pp.call(t,t.transformResponse,h.response),h.response.headers=Jn.from(h.response.headers))),Promise.reject(h)})}const Wy=t=>t instanceof Jn?{...t}:t;function Gl(t,r){r=r||{};const a={};function h(I,k,P){return Nt.isPlainObject(I)&&Nt.isPlainObject(k)?Nt.merge.call({caseless:P},I,k):Nt.isPlainObject(k)?Nt.merge({},k):Nt.isArray(k)?k.slice():k}function p(I,k,P){if(Nt.isUndefined(k)){if(!Nt.isUndefined(I))return h(void 0,I,P)}else return h(I,k,P)}function y(I,k){if(!Nt.isUndefined(k))return h(void 0,k)}function m(I,k){if(Nt.isUndefined(k)){if(!Nt.isUndefined(I))return h(void 0,I)}else return h(void 0,k)}function l(I,k,P){if(P in r)return h(I,k);if(P in t)return h(void 0,I)}const T={url:y,method:y,data:y,baseURL:m,transformRequest:m,transformResponse:m,paramsSerializer:m,timeout:m,timeoutMessage:m,withCredentials:m,withXSRFToken:m,adapter:m,responseType:m,xsrfCookieName:m,xsrfHeaderName:m,onUploadProgress:m,onDownloadProgress:m,decompress:m,maxContentLength:m,maxBodyLength:m,beforeRedirect:m,transport:m,httpAgent:m,httpsAgent:m,cancelToken:m,socketPath:m,responseEncoding:m,validateStatus:l,headers:(I,k)=>p(Wy(I),Wy(k),!0)};return Nt.forEach(Object.keys(Object.assign({},t,r)),function(k){const P=T[k]||p,L=P(t[k],r[k],k);Nt.isUndefined(L)&&P!==l||(a[k]=L)}),a}const yx="1.6.8",$m={};["object","boolean","number","function","string","symbol"].forEach((t,r)=>{$m[t]=function(h){return typeof h===t||"a"+(r<1?"n ":" ")+t}});const Zy={};$m.transitional=function(r,a,h){function p(y,m){return"[Axios v"+yx+"] Transitional option '"+y+"'"+m+(h?". "+h:"")}return(y,m,l)=>{if(r===!1)throw new li(p(m," has been removed"+(a?" in "+a:"")),li.ERR_DEPRECATED);return a&&!Zy[m]&&(Zy[m]=!0,console.warn(p(m," has been deprecated since v"+a+" and will be removed in the near future"))),r?r(y,m,l):!0}};function cC(t,r,a){if(typeof t!="object")throw new li("options must be an object",li.ERR_BAD_OPTION_VALUE);const h=Object.keys(t);let p=h.length;for(;p-- >0;){const y=h[p],m=r[y];if(m){const l=t[y],T=l===void 0||m(l,y,t);if(T!==!0)throw new li("option "+y+" must be "+T,li.ERR_BAD_OPTION_VALUE);continue}if(a!==!0)throw new li("Unknown option "+y,li.ERR_BAD_OPTION)}}const sm={assertOptions:cC,validators:$m},Ma=sm.validators;class Pd{constructor(r){this.defaults=r,this.interceptors={request:new Uy,response:new Uy}}async request(r,a){try{return await this._request(r,a)}catch(h){if(h instanceof Error){let p;Error.captureStackTrace?Error.captureStackTrace(p={}):p=new Error;const y=p.stack?p.stack.replace(/^.+\n/,""):"";h.stack?y&&!String(h.stack).endsWith(y.replace(/^.+\n.+\n/,""))&&(h.stack+=`
`+y):h.stack=y}throw h}}_request(r,a){typeof r=="string"?(a=a||{},a.url=r):a=r||{},a=Gl(this.defaults,a);const{transitional:h,paramsSerializer:p,headers:y}=a;h!==void 0&&sm.assertOptions(h,{silentJSONParsing:Ma.transitional(Ma.boolean),forcedJSONParsing:Ma.transitional(Ma.boolean),clarifyTimeoutError:Ma.transitional(Ma.boolean)},!1),p!=null&&(Nt.isFunction(p)?a.paramsSerializer={serialize:p}:sm.assertOptions(p,{encode:Ma.function,serialize:Ma.function},!0)),a.method=(a.method||this.defaults.method||"get").toLowerCase();let m=y&&Nt.merge(y.common,y[a.method]);y&&Nt.forEach(["delete","get","head","post","put","patch","common"],tt=>{delete y[tt]}),a.headers=Jn.concat(m,y);const l=[];let T=!0;this.interceptors.request.forEach(function(ot){typeof ot.runWhen=="function"&&ot.runWhen(a)===!1||(T=T&&ot.synchronous,l.unshift(ot.fulfilled,ot.rejected))});const I=[];this.interceptors.response.forEach(function(ot){I.push(ot.fulfilled,ot.rejected)});let k,P=0,L;if(!T){const tt=[Hy.bind(this),void 0];for(tt.unshift.apply(tt,l),tt.push.apply(tt,I),L=tt.length,k=Promise.resolve(a);P<L;)k=k.then(tt[P++],tt[P++]);return k}L=l.length;let K=a;for(P=0;P<L;){const tt=l[P++],ot=l[P++];try{K=tt(K)}catch(vt){ot.call(this,vt);break}}try{k=Hy.call(this,K)}catch(tt){return Promise.reject(tt)}for(P=0,L=I.length;P<L;)k=k.then(I[P++],I[P++]);return k}getUri(r){r=Gl(this.defaults,r);const a=gx(r.baseURL,r.url);return ux(a,r.params,r.paramsSerializer)}}Nt.forEach(["delete","get","head","options"],function(r){Pd.prototype[r]=function(a,h){return this.request(Gl(h||{},{method:r,url:a,data:(h||{}).data}))}});Nt.forEach(["post","put","patch"],function(r){function a(h){return function(y,m,l){return this.request(Gl(l||{},{method:r,headers:h?{"Content-Type":"multipart/form-data"}:{},url:y,data:m}))}}Pd.prototype[r]=a(),Pd.prototype[r+"Form"]=a(!0)});const pd=Pd;class Vm{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let a;this.promise=new Promise(function(y){a=y});const h=this;this.promise.then(p=>{if(!h._listeners)return;let y=h._listeners.length;for(;y-- >0;)h._listeners[y](p);h._listeners=null}),this.promise.then=p=>{let y;const m=new Promise(l=>{h.subscribe(l),y=l}).then(p);return m.cancel=function(){h.unsubscribe(y)},m},r(function(y,m,l){h.reason||(h.reason=new Nh(y,m,l),a(h.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){if(this.reason){r(this.reason);return}this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const a=this._listeners.indexOf(r);a!==-1&&this._listeners.splice(a,1)}static source(){let r;return{token:new Vm(function(p){r=p}),cancel:r}}}const hC=Vm;function uC(t){return function(a){return t.apply(null,a)}}function dC(t){return Nt.isObject(t)&&t.isAxiosError===!0}const rm={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(rm).forEach(([t,r])=>{rm[r]=t});const fC=rm;function vx(t){const r=new pd(t),a=Qv(pd.prototype.request,r);return Nt.extend(a,pd.prototype,r,{allOwnKeys:!0}),Nt.extend(a,r,null,{allOwnKeys:!0}),a.create=function(p){return vx(Gl(t,p))},a}const zi=vx(Nm);zi.Axios=pd;zi.CanceledError=Nh;zi.CancelToken=hC;zi.isCancel=mx;zi.VERSION=yx;zi.toFormData=sf;zi.AxiosError=li;zi.Cancel=zi.CanceledError;zi.all=function(r){return Promise.all(r)};zi.spread=uC;zi.isAxiosError=dC;zi.mergeConfig=Gl;zi.AxiosHeaders=Jn;zi.formToJSON=t=>px(Nt.isHTMLForm(t)?new FormData(t):t);zi.getAdapter=_x.getAdapter;zi.HttpStatusCode=fC;zi.default=zi;const nf=ta("MapStore",{state:()=>({map:{},currentTopicMapStyle:{},bufferForAddress:{}}),actions:{async fillBufferForAddress(t,r){const y=Fr("+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs","+proj=lcc +lat_1=40.96666666666667 +lat_2=39.93333333333333 +lat_0=39.33333333333334 +lon_0=-77.75 +x_0=600000 +y_0=0 +ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 +no_defs",[t,r]);console.log("fillBufferForAddress is running, lng:",t,"lat:",r);const m="https://citygeo-geocoder-pub.databridge.phila.gov/arcgis/rest/services/Utilities/Geometry/GeometryServer/buffer",l={geometries:`${y.join(", ")}`,inSR:2272,outSR:4326,bufferSR:2272,distances:500,unionResults:!0,geodesic:!1,f:"json"};let T=await zi.get(m,{params:l});this.bufferForAddress=T.data}}}),af=ta("MainStore",{state:()=>({lastSearchMethod:"",currentAddress:""}),actions:{setCurrentAddress(t){this.currentAddress=t},setLastSearchMethod(t){this.lastSearchMethod=t}}}),Vs=ta("AddressStore",{state:()=>({addressData:{}}),actions:{async fillAddressData(t){try{const r=await fetch(`https://api.phila.gov/ais/v1/search/${t}?include_units=false`);if(r.ok)console.log("Address - await resolved and HTTP status is successful"),this.addressData=await r.json();else{console.log("Address - await resolved but HTTP status was not successful"),this.addressData={};const a=af();a.currentAddress=""}}catch{console.error("Address - await never resolved, failed to fetch address data")}}},getters:{getOpaOwners:t=>t.addressData.features[0].properties.opa_owners.join(", ")}}),$h=ta("CondosStore",{state:()=>({condosData:{}}),actions:{async fillCondoData(t){const a=Vs().addressData.features[0];let h={include_units:!0,opa_only:!0,page:1};const p=await zi(`//api.phila.gov/ais/v1/search/${t}`,{params:h});if(p.data.features.length>0){let y=[];for(let m of p.data.features)m.properties.address_low_frac!==a.properties.address_low_frac||m.properties.street_address===a.properties.street_address?p.data.total_size=p.data.total_size-1:y.push(m);this.condosData=y}}}}),of=ta("ParcelsStore",{state:()=>({PWD:{},DOR:{}}),actions:{async fillPwdParcelData(){const r=Vs().addressData.features[0],a=r.properties.pwd_parcel_id;if(!a){console.log("no PWD parcel in AIS"),await this.fillParcelDataByLngLat(r.geometry.coordinates[0],r.geometry.coordinates[1],"PWD");return}try{const h=await fetch(`https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/PWD_PARCELS/FeatureServer/0/query?where=PARCELID=%27${a}%27&outSR=4326&f=geojson&outFields=*&returnGeometry=true`);h.ok?this.PWD=await h.json():console.error("Failed to fetch PWD parcel data")}catch{console.error("Failed to fetch PWD parcel data")}},async fillDorParcelData(){const r=Vs().addressData.features[0],a=r.properties.dor_parcel_id;if(!a){console.log("no DOR parcel in AIS"),await this.fillParcelDataByLngLat(r.geometry.coordinates[0],r.geometry.coordinates[1],"DOR");return}try{const h=await fetch(`https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/DOR_Parcel/FeatureServer/0/query?where=MAPREG=%27${a}%27&outSR=4326&f=geojson&outFields=*&returnGeometry=true`);h.ok?this.DOR=await h.json():console.error("Failed to fetch DOR parcel data")}catch{console.error("Failed to fetch DOR parcel data")}},async fillParcelDataByLngLat(t,r,a){console.log("fillParcelDataByLngLat, lng:",t,"lat:",r,"parcelLayer:",a);let h=a==="PWD"?"PWD_PARCELS":"DOR_Parcel",p={where:"1=1",outSR:4326,f:"geojson",outFields:"*",returnGeometry:!0,geometry:`{ "x": ${t}, "y": ${r}, "spatialReference":{ "wkid":4326 }}`,geometryType:"esriGeometryPoint",spatialRel:"esriSpatialRelWithin"};const y=await zi(`https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/${h}/FeatureServer/0/query`,{params:p});console.log("response",y),y.data.features.length>0&&(this[a]=y.data)}}});function pC(){return{pwdDrawnMapStyle:{version:8,name:"pwdDrawnMap",sources:{pwd:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityBasemap/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},pwdLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityBasemap_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256}},layers:[{id:"pwd",source:"pwd",type:"raster"},{id:"pwdLabels",source:"pwdLabels",type:"raster"}]},dorDrawnMapStyle:{version:8,name:"dorDrawnMap",sources:{dor:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/DORBasemap/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},dorLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/DORBasemap_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256}},layers:[{id:"dor",source:"dor",type:"raster"},{id:"dorLabels",source:"dorLabels",type:"raster"}]},zoningDrawnMapStyle:{version:8,name:"dorDrawnMap",sources:{dor:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/DORBasemap/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},dorLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/DORBasemap_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},zoning:{tiles:["https://citygeo-geoserver.databridge.phila.gov/geoserver/wms?service=WMS&version=1.1.0&request=GetMap&layers=atlas_zoning_grouped&bbox={bbox-epsg-3857}&width=256&height=256&srs=EPSG%3A3857&styles=&format=image/png&transparent=true"],type:"raster",tileSize:256}},layers:[{id:"dor",source:"dor",type:"raster"},{id:"dorLabels",source:"dorLabels",type:"raster"},{id:"zoning",source:"zoning",type:"raster"}]},imageryMapStyle:{version:8,name:"imageryMap",sources:{imagery:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2022_2in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},imageryLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},stormwater:{tiles:["https://stormwater.phila.gov/arcgis/rest/services/parcel_viewer/pv_data/MapServer/export?dpi=110            &transparent=true            &format=png36            &bbox={bbox-epsg-3857}            &bboxSR=3857            &imageSR=3857            &size=512,512            &f=image          "],type:"raster",tileSize:256}},layers:[{id:"imagery",source:"imagery",type:"raster"},{id:"imageryLabels",source:"imageryLabels",type:"raster"}]}}}var nm={exports:{}};/*!
 * accounting.js v0.4.1
 * Copyright 2014 Open Exchange Rates
 *
 * Freely distributable under the MIT license.
 * Portions of accounting.js are inspired or borrowed from underscore.js
 *
 * Full details and documentation:
 * http://openexchangerates.github.io/accounting.js/
 */(function(t,r){(function(a,h){var p={};p.version="0.4.1",p.settings={currency:{symbol:"$",format:"%s%v",decimal:".",thousand:",",precision:2,grouping:3},number:{precision:0,grouping:3,thousand:",",decimal:"."}};var y=Array.prototype.map,m=Array.isArray,l=Object.prototype.toString;function T(ht){return!!(ht===""||ht&&ht.charCodeAt&&ht.substr)}function I(ht){return m?m(ht):l.call(ht)==="[object Array]"}function k(ht){return ht&&l.call(ht)==="[object Object]"}function P(ht,Tt){var $t;ht=ht||{},Tt=Tt||{};for($t in Tt)Tt.hasOwnProperty($t)&&ht[$t]==null&&(ht[$t]=Tt[$t]);return ht}function L(ht,Tt,$t){var qt=[],oe,ne;if(!ht)return qt;if(y&&ht.map===y)return ht.map(Tt,$t);for(oe=0,ne=ht.length;oe<ne;oe++)qt[oe]=Tt.call($t,ht[oe],oe,ht);return qt}function K(ht,Tt){return ht=Math.round(Math.abs(ht)),isNaN(ht)?Tt:ht}function tt(ht){var Tt=p.settings.currency.format;return typeof ht=="function"&&(ht=ht()),T(ht)&&ht.match("%v")?{pos:ht,neg:ht.replace("-","").replace("%v","-%v"),zero:ht}:!ht||!ht.pos||!ht.pos.match("%v")?T(Tt)?p.settings.currency.format={pos:Tt,neg:Tt.replace("%v","-%v"),zero:Tt}:Tt:ht}var ot=p.unformat=p.parse=function(ht,Tt){if(I(ht))return L(ht,function(oe){return ot(oe,Tt)});if(ht=ht||0,typeof ht=="number")return ht;Tt=Tt||p.settings.number.decimal;var $t=new RegExp("[^0-9-"+Tt+"]",["g"]),qt=parseFloat((""+ht).replace(/\((.*)\)/,"-$1").replace($t,"").replace(Tt,"."));return isNaN(qt)?0:qt},vt=p.toFixed=function(ht,Tt){Tt=K(Tt,p.settings.number.precision);var $t=Math.pow(10,Tt);return(Math.round(p.unformat(ht)*$t)/$t).toFixed(Tt)},yt=p.formatNumber=p.format=function(ht,Tt,$t,qt){if(I(ht))return L(ht,function(de){return yt(de,Tt,$t,qt)});ht=ot(ht);var oe=P(k(Tt)?Tt:{precision:Tt,thousand:$t,decimal:qt},p.settings.number),ne=K(oe.precision),Vt=ht<0?"-":"",Gt=parseInt(vt(Math.abs(ht||0),ne),10)+"",Dt=Gt.length>3?Gt.length%3:0;return Vt+(Dt?Gt.substr(0,Dt)+oe.thousand:"")+Gt.substr(Dt).replace(/(\d{3})(?=\d)/g,"$1"+oe.thousand)+(ne?oe.decimal+vt(Math.abs(ht),ne).split(".")[1]:"")},At=p.formatMoney=function(ht,Tt,$t,qt,oe,ne){if(I(ht))return L(ht,function(de){return At(de,Tt,$t,qt,oe,ne)});ht=ot(ht);var Vt=P(k(Tt)?Tt:{symbol:Tt,precision:$t,thousand:qt,decimal:oe,format:ne},p.settings.currency),Gt=tt(Vt.format),Dt=ht>0?Gt.pos:ht<0?Gt.neg:Gt.zero;return Dt.replace("%s",Vt.symbol).replace("%v",yt(Math.abs(ht),K(Vt.precision),Vt.thousand,Vt.decimal))};p.formatColumn=function(ht,Tt,$t,qt,oe,ne){if(!ht)return[];var Vt=P(k(Tt)?Tt:{symbol:Tt,precision:$t,thousand:qt,decimal:oe,format:ne},p.settings.currency),Gt=tt(Vt.format),Dt=Gt.pos.indexOf("%s")<Gt.pos.indexOf("%v"),de=0,De=L(ht,function(ke,gi){if(I(ke))return p.formatColumn(ke,Vt);ke=ot(ke);var Re=ke>0?Gt.pos:ke<0?Gt.neg:Gt.zero,Le=Re.replace("%s",Vt.symbol).replace("%v",yt(Math.abs(ke),K(Vt.precision),Vt.thousand,Vt.decimal));return Le.length>de&&(de=Le.length),Le});return L(De,function(ke,gi){return T(ke)&&ke.length<de?Dt?ke.replace(Vt.symbol,Vt.symbol+new Array(de-ke.length+1).join(" ")):new Array(de-ke.length+1).join(" ")+ke:ke})},t.exports&&(r=t.exports=p),r.accounting=p})()})(nm,nm.exports);var mC=nm.exports;const xx=Ev(mC);function Er(t){const r=Object.prototype.toString.call(t);return t instanceof Date||typeof t=="object"&&r==="[object Date]"?new t.constructor(+t):typeof t=="number"||r==="[object Number]"||typeof t=="string"||r==="[object String]"?new Date(t):new Date(NaN)}function ln(t,r){return t instanceof Date?new t.constructor(r):new Date(r)}function bx(t,r){const a=Er(t);return isNaN(r)?ln(t,NaN):(r&&a.setDate(a.getDate()+r),a)}function wx(t,r){const a=Er(t);if(isNaN(r))return ln(t,NaN);if(!r)return a;const h=a.getDate(),p=ln(t,a.getTime());p.setMonth(a.getMonth()+r+1,0);const y=p.getDate();return h>=y?p:(a.setFullYear(p.getFullYear(),p.getMonth(),h),a)}function gC(t,r){const a=+Er(t);return ln(t,a+r)}const Mx=6048e5,_C=864e5,Sx=6e4,Um=36e5;function yC(t,r){return gC(t,r*Um)}let vC={};function lf(){return vC}function Ch(t,r){var l,T,I,k;const a=lf(),h=(r==null?void 0:r.weekStartsOn)??((T=(l=r==null?void 0:r.locale)==null?void 0:l.options)==null?void 0:T.weekStartsOn)??a.weekStartsOn??((k=(I=a.locale)==null?void 0:I.options)==null?void 0:k.weekStartsOn)??0,p=Er(t),y=p.getDay(),m=(y<h?7:0)+y-h;return p.setDate(p.getDate()-m),p.setHours(0,0,0,0),p}function Cd(t){return Ch(t,{weekStartsOn:1})}function Tx(t){const r=Er(t),a=r.getFullYear(),h=ln(t,0);h.setFullYear(a+1,0,4),h.setHours(0,0,0,0);const p=Cd(h),y=ln(t,0);y.setFullYear(a,0,4),y.setHours(0,0,0,0);const m=Cd(y);return r.getTime()>=p.getTime()?a+1:r.getTime()>=m.getTime()?a:a-1}function Ky(t){const r=Er(t);return r.setHours(0,0,0,0),r}function Xy(t){const r=Er(t),a=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return a.setUTCFullYear(r.getFullYear()),+t-+a}function xC(t,r){const a=Ky(t),h=Ky(r),p=+a-Xy(a),y=+h-Xy(h);return Math.round((p-y)/_C)}function bC(t){const r=Tx(t),a=ln(t,0);return a.setFullYear(r,0,4),a.setHours(0,0,0,0),Cd(a)}function wC(t,r){const a=r*7;return bx(t,a)}function MC(t,r){return wx(t,r*12)}function SC(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function TC(t){if(!SC(t)&&typeof t!="number")return!1;const r=Er(t);return!isNaN(Number(r))}function AC(t){const r=Er(t),a=ln(t,0);return a.setFullYear(r.getFullYear(),0,1),a.setHours(0,0,0,0),a}const EC={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},IC=(t,r,a)=>{let h;const p=EC[t];return typeof p=="string"?h=p:r===1?h=p.one:h=p.other.replace("{{count}}",r.toString()),a!=null&&a.addSuffix?a.comparison&&a.comparison>0?"in "+h:h+" ago":h};function Dp(t){return(r={})=>{const a=r.width?String(r.width):t.defaultWidth;return t.formats[a]||t.formats[t.defaultWidth]}}const PC={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},CC={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},DC={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},kC={date:Dp({formats:PC,defaultWidth:"full"}),time:Dp({formats:CC,defaultWidth:"full"}),dateTime:Dp({formats:DC,defaultWidth:"full"})},RC={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},zC=(t,r,a,h)=>RC[t];function th(t){return(r,a)=>{const h=a!=null&&a.context?String(a.context):"standalone";let p;if(h==="formatting"&&t.formattingValues){const m=t.defaultFormattingWidth||t.defaultWidth,l=a!=null&&a.width?String(a.width):m;p=t.formattingValues[l]||t.formattingValues[m]}else{const m=t.defaultWidth,l=a!=null&&a.width?String(a.width):t.defaultWidth;p=t.values[l]||t.values[m]}const y=t.argumentCallback?t.argumentCallback(r):r;return p[y]}}const LC={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},OC={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},FC={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},BC={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},NC={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},$C={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},VC=(t,r)=>{const a=Number(t),h=a%100;if(h>20||h<10)switch(h%10){case 1:return a+"st";case 2:return a+"nd";case 3:return a+"rd"}return a+"th"},UC={ordinalNumber:VC,era:th({values:LC,defaultWidth:"wide"}),quarter:th({values:OC,defaultWidth:"wide",argumentCallback:t=>t-1}),month:th({values:FC,defaultWidth:"wide"}),day:th({values:BC,defaultWidth:"wide"}),dayPeriod:th({values:NC,defaultWidth:"wide",formattingValues:$C,defaultFormattingWidth:"wide"})};function eh(t){return(r,a={})=>{const h=a.width,p=h&&t.matchPatterns[h]||t.matchPatterns[t.defaultMatchWidth],y=r.match(p);if(!y)return null;const m=y[0],l=h&&t.parsePatterns[h]||t.parsePatterns[t.defaultParseWidth],T=Array.isArray(l)?jC(l,P=>P.test(m)):qC(l,P=>P.test(m));let I;I=t.valueCallback?t.valueCallback(T):T,I=a.valueCallback?a.valueCallback(I):I;const k=r.slice(m.length);return{value:I,rest:k}}}function qC(t,r){for(const a in t)if(Object.prototype.hasOwnProperty.call(t,a)&&r(t[a]))return a}function jC(t,r){for(let a=0;a<t.length;a++)if(r(t[a]))return a}function GC(t){return(r,a={})=>{const h=r.match(t.matchPattern);if(!h)return null;const p=h[0],y=r.match(t.parsePattern);if(!y)return null;let m=t.valueCallback?t.valueCallback(y[0]):y[0];m=a.valueCallback?a.valueCallback(m):m;const l=r.slice(p.length);return{value:m,rest:l}}}const HC=/^(\d+)(th|st|nd|rd)?/i,WC=/\d+/i,ZC={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},KC={any:[/^b/i,/^(a|c)/i]},XC={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},YC={any:[/1/i,/2/i,/3/i,/4/i]},JC={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},QC={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},tD={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},eD={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},iD={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},sD={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},rD={ordinalNumber:GC({matchPattern:HC,parsePattern:WC,valueCallback:t=>parseInt(t,10)}),era:eh({matchPatterns:ZC,defaultMatchWidth:"wide",parsePatterns:KC,defaultParseWidth:"any"}),quarter:eh({matchPatterns:XC,defaultMatchWidth:"wide",parsePatterns:YC,defaultParseWidth:"any",valueCallback:t=>t+1}),month:eh({matchPatterns:JC,defaultMatchWidth:"wide",parsePatterns:QC,defaultParseWidth:"any"}),day:eh({matchPatterns:tD,defaultMatchWidth:"wide",parsePatterns:eD,defaultParseWidth:"any"}),dayPeriod:eh({matchPatterns:iD,defaultMatchWidth:"any",parsePatterns:sD,defaultParseWidth:"any"})},nD={code:"en-US",formatDistance:IC,formatLong:kC,formatRelative:zC,localize:UC,match:rD,options:{weekStartsOn:0,firstWeekContainsDate:1}};function aD(t){const r=Er(t);return xC(r,AC(r))+1}function oD(t){const r=Er(t),a=+Cd(r)-+bC(r);return Math.round(a/Mx)+1}function Ax(t,r){var k,P,L,K;const a=Er(t),h=a.getFullYear(),p=lf(),y=(r==null?void 0:r.firstWeekContainsDate)??((P=(k=r==null?void 0:r.locale)==null?void 0:k.options)==null?void 0:P.firstWeekContainsDate)??p.firstWeekContainsDate??((K=(L=p.locale)==null?void 0:L.options)==null?void 0:K.firstWeekContainsDate)??1,m=ln(t,0);m.setFullYear(h+1,0,y),m.setHours(0,0,0,0);const l=Ch(m,r),T=ln(t,0);T.setFullYear(h,0,y),T.setHours(0,0,0,0);const I=Ch(T,r);return a.getTime()>=l.getTime()?h+1:a.getTime()>=I.getTime()?h:h-1}function lD(t,r){var l,T,I,k;const a=lf(),h=(r==null?void 0:r.firstWeekContainsDate)??((T=(l=r==null?void 0:r.locale)==null?void 0:l.options)==null?void 0:T.firstWeekContainsDate)??a.firstWeekContainsDate??((k=(I=a.locale)==null?void 0:I.options)==null?void 0:k.firstWeekContainsDate)??1,p=Ax(t,r),y=ln(t,0);return y.setFullYear(p,0,h),y.setHours(0,0,0,0),Ch(y,r)}function cD(t,r){const a=Er(t),h=+Ch(a,r)-+lD(a,r);return Math.round(h/Mx)+1}function Mi(t,r){const a=t<0?"-":"",h=Math.abs(t).toString().padStart(r,"0");return a+h}const Sa={y(t,r){const a=t.getFullYear(),h=a>0?a:1-a;return Mi(r==="yy"?h%100:h,r.length)},M(t,r){const a=t.getMonth();return r==="M"?String(a+1):Mi(a+1,2)},d(t,r){return Mi(t.getDate(),r.length)},a(t,r){const a=t.getHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return a.toUpperCase();case"aaa":return a;case"aaaaa":return a[0];case"aaaa":default:return a==="am"?"a.m.":"p.m."}},h(t,r){return Mi(t.getHours()%12||12,r.length)},H(t,r){return Mi(t.getHours(),r.length)},m(t,r){return Mi(t.getMinutes(),r.length)},s(t,r){return Mi(t.getSeconds(),r.length)},S(t,r){const a=r.length,h=t.getMilliseconds(),p=Math.trunc(h*Math.pow(10,a-3));return Mi(p,r.length)}},Ml={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Yy={G:function(t,r,a){const h=t.getFullYear()>0?1:0;switch(r){case"G":case"GG":case"GGG":return a.era(h,{width:"abbreviated"});case"GGGGG":return a.era(h,{width:"narrow"});case"GGGG":default:return a.era(h,{width:"wide"})}},y:function(t,r,a){if(r==="yo"){const h=t.getFullYear(),p=h>0?h:1-h;return a.ordinalNumber(p,{unit:"year"})}return Sa.y(t,r)},Y:function(t,r,a,h){const p=Ax(t,h),y=p>0?p:1-p;if(r==="YY"){const m=y%100;return Mi(m,2)}return r==="Yo"?a.ordinalNumber(y,{unit:"year"}):Mi(y,r.length)},R:function(t,r){const a=Tx(t);return Mi(a,r.length)},u:function(t,r){const a=t.getFullYear();return Mi(a,r.length)},Q:function(t,r,a){const h=Math.ceil((t.getMonth()+1)/3);switch(r){case"Q":return String(h);case"QQ":return Mi(h,2);case"Qo":return a.ordinalNumber(h,{unit:"quarter"});case"QQQ":return a.quarter(h,{width:"abbreviated",context:"formatting"});case"QQQQQ":return a.quarter(h,{width:"narrow",context:"formatting"});case"QQQQ":default:return a.quarter(h,{width:"wide",context:"formatting"})}},q:function(t,r,a){const h=Math.ceil((t.getMonth()+1)/3);switch(r){case"q":return String(h);case"qq":return Mi(h,2);case"qo":return a.ordinalNumber(h,{unit:"quarter"});case"qqq":return a.quarter(h,{width:"abbreviated",context:"standalone"});case"qqqqq":return a.quarter(h,{width:"narrow",context:"standalone"});case"qqqq":default:return a.quarter(h,{width:"wide",context:"standalone"})}},M:function(t,r,a){const h=t.getMonth();switch(r){case"M":case"MM":return Sa.M(t,r);case"Mo":return a.ordinalNumber(h+1,{unit:"month"});case"MMM":return a.month(h,{width:"abbreviated",context:"formatting"});case"MMMMM":return a.month(h,{width:"narrow",context:"formatting"});case"MMMM":default:return a.month(h,{width:"wide",context:"formatting"})}},L:function(t,r,a){const h=t.getMonth();switch(r){case"L":return String(h+1);case"LL":return Mi(h+1,2);case"Lo":return a.ordinalNumber(h+1,{unit:"month"});case"LLL":return a.month(h,{width:"abbreviated",context:"standalone"});case"LLLLL":return a.month(h,{width:"narrow",context:"standalone"});case"LLLL":default:return a.month(h,{width:"wide",context:"standalone"})}},w:function(t,r,a,h){const p=cD(t,h);return r==="wo"?a.ordinalNumber(p,{unit:"week"}):Mi(p,r.length)},I:function(t,r,a){const h=oD(t);return r==="Io"?a.ordinalNumber(h,{unit:"week"}):Mi(h,r.length)},d:function(t,r,a){return r==="do"?a.ordinalNumber(t.getDate(),{unit:"date"}):Sa.d(t,r)},D:function(t,r,a){const h=aD(t);return r==="Do"?a.ordinalNumber(h,{unit:"dayOfYear"}):Mi(h,r.length)},E:function(t,r,a){const h=t.getDay();switch(r){case"E":case"EE":case"EEE":return a.day(h,{width:"abbreviated",context:"formatting"});case"EEEEE":return a.day(h,{width:"narrow",context:"formatting"});case"EEEEEE":return a.day(h,{width:"short",context:"formatting"});case"EEEE":default:return a.day(h,{width:"wide",context:"formatting"})}},e:function(t,r,a,h){const p=t.getDay(),y=(p-h.weekStartsOn+8)%7||7;switch(r){case"e":return String(y);case"ee":return Mi(y,2);case"eo":return a.ordinalNumber(y,{unit:"day"});case"eee":return a.day(p,{width:"abbreviated",context:"formatting"});case"eeeee":return a.day(p,{width:"narrow",context:"formatting"});case"eeeeee":return a.day(p,{width:"short",context:"formatting"});case"eeee":default:return a.day(p,{width:"wide",context:"formatting"})}},c:function(t,r,a,h){const p=t.getDay(),y=(p-h.weekStartsOn+8)%7||7;switch(r){case"c":return String(y);case"cc":return Mi(y,r.length);case"co":return a.ordinalNumber(y,{unit:"day"});case"ccc":return a.day(p,{width:"abbreviated",context:"standalone"});case"ccccc":return a.day(p,{width:"narrow",context:"standalone"});case"cccccc":return a.day(p,{width:"short",context:"standalone"});case"cccc":default:return a.day(p,{width:"wide",context:"standalone"})}},i:function(t,r,a){const h=t.getDay(),p=h===0?7:h;switch(r){case"i":return String(p);case"ii":return Mi(p,r.length);case"io":return a.ordinalNumber(p,{unit:"day"});case"iii":return a.day(h,{width:"abbreviated",context:"formatting"});case"iiiii":return a.day(h,{width:"narrow",context:"formatting"});case"iiiiii":return a.day(h,{width:"short",context:"formatting"});case"iiii":default:return a.day(h,{width:"wide",context:"formatting"})}},a:function(t,r,a){const p=t.getHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return a.dayPeriod(p,{width:"abbreviated",context:"formatting"});case"aaa":return a.dayPeriod(p,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return a.dayPeriod(p,{width:"narrow",context:"formatting"});case"aaaa":default:return a.dayPeriod(p,{width:"wide",context:"formatting"})}},b:function(t,r,a){const h=t.getHours();let p;switch(h===12?p=Ml.noon:h===0?p=Ml.midnight:p=h/12>=1?"pm":"am",r){case"b":case"bb":return a.dayPeriod(p,{width:"abbreviated",context:"formatting"});case"bbb":return a.dayPeriod(p,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return a.dayPeriod(p,{width:"narrow",context:"formatting"});case"bbbb":default:return a.dayPeriod(p,{width:"wide",context:"formatting"})}},B:function(t,r,a){const h=t.getHours();let p;switch(h>=17?p=Ml.evening:h>=12?p=Ml.afternoon:h>=4?p=Ml.morning:p=Ml.night,r){case"B":case"BB":case"BBB":return a.dayPeriod(p,{width:"abbreviated",context:"formatting"});case"BBBBB":return a.dayPeriod(p,{width:"narrow",context:"formatting"});case"BBBB":default:return a.dayPeriod(p,{width:"wide",context:"formatting"})}},h:function(t,r,a){if(r==="ho"){let h=t.getHours()%12;return h===0&&(h=12),a.ordinalNumber(h,{unit:"hour"})}return Sa.h(t,r)},H:function(t,r,a){return r==="Ho"?a.ordinalNumber(t.getHours(),{unit:"hour"}):Sa.H(t,r)},K:function(t,r,a){const h=t.getHours()%12;return r==="Ko"?a.ordinalNumber(h,{unit:"hour"}):Mi(h,r.length)},k:function(t,r,a){let h=t.getHours();return h===0&&(h=24),r==="ko"?a.ordinalNumber(h,{unit:"hour"}):Mi(h,r.length)},m:function(t,r,a){return r==="mo"?a.ordinalNumber(t.getMinutes(),{unit:"minute"}):Sa.m(t,r)},s:function(t,r,a){return r==="so"?a.ordinalNumber(t.getSeconds(),{unit:"second"}):Sa.s(t,r)},S:function(t,r){return Sa.S(t,r)},X:function(t,r,a){const h=t.getTimezoneOffset();if(h===0)return"Z";switch(r){case"X":return Qy(h);case"XXXX":case"XX":return po(h);case"XXXXX":case"XXX":default:return po(h,":")}},x:function(t,r,a){const h=t.getTimezoneOffset();switch(r){case"x":return Qy(h);case"xxxx":case"xx":return po(h);case"xxxxx":case"xxx":default:return po(h,":")}},O:function(t,r,a){const h=t.getTimezoneOffset();switch(r){case"O":case"OO":case"OOO":return"GMT"+Jy(h,":");case"OOOO":default:return"GMT"+po(h,":")}},z:function(t,r,a){const h=t.getTimezoneOffset();switch(r){case"z":case"zz":case"zzz":return"GMT"+Jy(h,":");case"zzzz":default:return"GMT"+po(h,":")}},t:function(t,r,a){const h=Math.trunc(t.getTime()/1e3);return Mi(h,r.length)},T:function(t,r,a){const h=t.getTime();return Mi(h,r.length)}};function Jy(t,r=""){const a=t>0?"-":"+",h=Math.abs(t),p=Math.trunc(h/60),y=h%60;return y===0?a+String(p):a+String(p)+r+Mi(y,2)}function Qy(t,r){return t%60===0?(t>0?"-":"+")+Mi(Math.abs(t)/60,2):po(t,r)}function po(t,r=""){const a=t>0?"-":"+",h=Math.abs(t),p=Mi(Math.trunc(h/60),2),y=Mi(h%60,2);return a+p+r+y}const t0=(t,r)=>{switch(t){case"P":return r.date({width:"short"});case"PP":return r.date({width:"medium"});case"PPP":return r.date({width:"long"});case"PPPP":default:return r.date({width:"full"})}},Ex=(t,r)=>{switch(t){case"p":return r.time({width:"short"});case"pp":return r.time({width:"medium"});case"ppp":return r.time({width:"long"});case"pppp":default:return r.time({width:"full"})}},hD=(t,r)=>{const a=t.match(/(P+)(p+)?/)||[],h=a[1],p=a[2];if(!p)return t0(t,r);let y;switch(h){case"P":y=r.dateTime({width:"short"});break;case"PP":y=r.dateTime({width:"medium"});break;case"PPP":y=r.dateTime({width:"long"});break;case"PPPP":default:y=r.dateTime({width:"full"});break}return y.replace("{{date}}",t0(h,r)).replace("{{time}}",Ex(p,r))},uD={p:Ex,P:hD},dD=/^D+$/,fD=/^Y+$/,pD=["D","DD","YY","YYYY"];function mD(t){return dD.test(t)}function gD(t){return fD.test(t)}function _D(t,r,a){const h=yD(t,r,a);if(console.warn(h),pD.includes(t))throw new RangeError(h)}function yD(t,r,a){const h=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${r}\`) for formatting ${h} to the input \`${a}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const vD=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,xD=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,bD=/^'([^]*?)'?$/,wD=/''/g,MD=/[a-zA-Z]/;function am(t,r,a){var k,P,L,K,tt,ot,vt,yt;const h=lf(),p=(a==null?void 0:a.locale)??h.locale??nD,y=(a==null?void 0:a.firstWeekContainsDate)??((P=(k=a==null?void 0:a.locale)==null?void 0:k.options)==null?void 0:P.firstWeekContainsDate)??h.firstWeekContainsDate??((K=(L=h.locale)==null?void 0:L.options)==null?void 0:K.firstWeekContainsDate)??1,m=(a==null?void 0:a.weekStartsOn)??((ot=(tt=a==null?void 0:a.locale)==null?void 0:tt.options)==null?void 0:ot.weekStartsOn)??h.weekStartsOn??((yt=(vt=h.locale)==null?void 0:vt.options)==null?void 0:yt.weekStartsOn)??0,l=Er(t);if(!TC(l))throw new RangeError("Invalid time value");let T=r.match(xD).map(At=>{const ht=At[0];if(ht==="p"||ht==="P"){const Tt=uD[ht];return Tt(At,p.formatLong)}return At}).join("").match(vD).map(At=>{if(At==="''")return{isToken:!1,value:"'"};const ht=At[0];if(ht==="'")return{isToken:!1,value:SD(At)};if(Yy[ht])return{isToken:!0,value:At};if(ht.match(MD))throw new RangeError("Format string contains an unescaped latin alphabet character `"+ht+"`");return{isToken:!1,value:At}});p.localize.preprocessor&&(T=p.localize.preprocessor(l,T));const I={firstWeekContainsDate:y,weekStartsOn:m,locale:p};return T.map(At=>{if(!At.isToken)return At.value;const ht=At.value;(!(a!=null&&a.useAdditionalWeekYearTokens)&&gD(ht)||!(a!=null&&a.useAdditionalDayOfYearTokens)&&mD(ht))&&_D(ht,r,String(t));const Tt=Yy[ht[0]];return Tt(l,ht,p.localize,I)}).join("")}function SD(t){const r=t.match(bD);return r?r[1].replace(wD,"'"):t}function TD(t,r){return bx(t,-r)}function AD(t,r){const a=(r==null?void 0:r.additionalDigits)??2,h=CD(t);let p;if(h.date){const T=DD(h.date,a);p=kD(T.restDateString,T.year)}if(!p||isNaN(p.getTime()))return new Date(NaN);const y=p.getTime();let m=0,l;if(h.time&&(m=RD(h.time),isNaN(m)))return new Date(NaN);if(h.timezone){if(l=zD(h.timezone),isNaN(l))return new Date(NaN)}else{const T=new Date(y+m),I=new Date(0);return I.setFullYear(T.getUTCFullYear(),T.getUTCMonth(),T.getUTCDate()),I.setHours(T.getUTCHours(),T.getUTCMinutes(),T.getUTCSeconds(),T.getUTCMilliseconds()),I}return new Date(y+m+l)}const ed={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},ED=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,ID=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,PD=/^([+-])(\d{2})(?::?(\d{2}))?$/;function CD(t){const r={},a=t.split(ed.dateTimeDelimiter);let h;if(a.length>2)return r;if(/:/.test(a[0])?h=a[0]:(r.date=a[0],h=a[1],ed.timeZoneDelimiter.test(r.date)&&(r.date=t.split(ed.timeZoneDelimiter)[0],h=t.substr(r.date.length,t.length))),h){const p=ed.timezone.exec(h);p?(r.time=h.replace(p[1],""),r.timezone=p[1]):r.time=h}return r}function DD(t,r){const a=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+r)+"})|(\\d{2}|[+-]\\d{"+(2+r)+"})$)"),h=t.match(a);if(!h)return{year:NaN,restDateString:""};const p=h[1]?parseInt(h[1]):null,y=h[2]?parseInt(h[2]):null;return{year:y===null?p:y*100,restDateString:t.slice((h[1]||h[2]).length)}}function kD(t,r){if(r===null)return new Date(NaN);const a=t.match(ED);if(!a)return new Date(NaN);const h=!!a[4],p=ih(a[1]),y=ih(a[2])-1,m=ih(a[3]),l=ih(a[4]),T=ih(a[5])-1;if(h)return ND(r,l,T)?LD(r,l,T):new Date(NaN);{const I=new Date(0);return!FD(r,y,m)||!BD(r,p)?new Date(NaN):(I.setUTCFullYear(r,y,Math.max(p,m)),I)}}function ih(t){return t?parseInt(t):1}function RD(t){const r=t.match(ID);if(!r)return NaN;const a=kp(r[1]),h=kp(r[2]),p=kp(r[3]);return $D(a,h,p)?a*Um+h*Sx+p*1e3:NaN}function kp(t){return t&&parseFloat(t.replace(",","."))||0}function zD(t){if(t==="Z")return 0;const r=t.match(PD);if(!r)return 0;const a=r[1]==="+"?-1:1,h=parseInt(r[2]),p=r[3]&&parseInt(r[3])||0;return VD(h,p)?a*(h*Um+p*Sx):NaN}function LD(t,r,a){const h=new Date(0);h.setUTCFullYear(t,0,4);const p=h.getUTCDay()||7,y=(r-1)*7+a+1-p;return h.setUTCDate(h.getUTCDate()+y),h}const OD=[31,null,31,30,31,30,31,31,30,31,30,31];function Ix(t){return t%400===0||t%4===0&&t%100!==0}function FD(t,r,a){return r>=0&&r<=11&&a>=1&&a<=(OD[r]||(Ix(t)?29:28))}function BD(t,r){return r>=1&&r<=(Ix(t)?366:365)}function ND(t,r,a){return r>=1&&r<=53&&a>=0&&a<=6}function $D(t,r,a){return t===24?r===0&&a===0:a>=0&&a<60&&r>=0&&r<60&&t>=0&&t<25}function VD(t,r){return r>=0&&r<=59}function UD(t,r){return wx(t,-r)}function qD(t,r){return yC(t,-r)}function jD(t,r){return wC(t,-r)}function GD(t,r){return MC(t,-r)}xx.settings.currency.precision=0;function qm(){return{bold:h=>"<strong>"+h+"</strong>",currency:h=>xx.formatMoney(h),date:h=>{let p;return typeof h=="string"?p=am(AD(h),"MM/dd/yyyy"):p=am(h,"MM/dd/yyyy"),p}}}const{currency:e0,date:HD}=qm(),Px=ta("OpaStore",{state:()=>({opaData:{}}),actions:{async fillOpaData(){const r=Vs().addressData.features[0].properties.opa_account_num,a=await fetch(`https://phl.carto.com/api/v2/sql?q=select+*+from+opa_properties_public+where+parcel_number+%3D+%27${r}%27`);this.opaData=await a.json()}},getters:{getMarketValue:t=>e0(t.opaData.rows[0].market_value||null),getSaleDate:t=>HD(t.opaData.rows[0].sale_date),getSalePrice:t=>e0(t.opaData.rows[0].sale_price)}}),Cx=ta("LiStore",{state:()=>({liInspections:{},liPermits:{}}),actions:{async fillLiInspections(){const r=Vs().addressData.features[0];let a="https://phl.carto.com/api/v2/sql?q=";const h=r.properties.eclipse_location_id.replace(/\|/g,"', '"),p=r.properties.street_address,y=r.properties.opa_account_num?` AND opa_account_num IN ('${r.properties.opa_account_num}')`:"",m=r.properties.pwd_parcel_id,l=r.properties.li_address_key.replace(/\|/g,"', '"),T=a+=`SELECT * FROM case_investigations WHERE (address = '${p}' or addressobjectid IN ('${l}'))           AND systemofrecord IN ('HANSEN') ${y} UNION SELECT * FROM case_investigations WHERE           addressobjectid IN ('${h}') OR parcel_id_num IN ( '${m}' )           AND systemofrecord IN ('ECLIPSE') ${y}`,I=await fetch(T);this.liInspections=await I.json()},async fillLiPermits(){const r=Vs().addressData.features[0];let a="https://phl.carto.com/api/v2/sql?q=";const h=r.properties.eclipse_location_id.replace(/\|/g,"', '"),p=r.properties.street_address,y=r.properties.opa_account_num?` AND opa_account_num IN ('${r.properties.opa_account_num}')`:"",m=r.properties.pwd_parcel_id,l=r.properties.li_address_key.replace(/\|/g,"', '"),T=a+=`SELECT * FROM PERMITS WHERE address = '${p}' or addressobjectid IN ('${l}')       AND systemofrecord IN ('HANSEN') ${y}       UNION SELECT * FROM PERMITS WHERE addressobjectid IN ('${h}') OR parcel_id_num IN ( '${m}' )       AND systemofrecord IN ('ECLIPSE')${y}      ORDER BY permittype`,I=await fetch(T);this.liPermits=await I.json()}},getters:{}}),El=function(t){var r=t?String(t):"";return r=r.replace(/\s+/g,""),[null,"0"].indexOf(r)>-1?"":r},WD=function(t,r){console.log("concatDorAddress is running, parcel:",t),r=!!r;var a=["STDIR","STNAM","STDES","STDESSUF"],h=t.properties,p=El(h.HOUSE),y=El(h.STEX),m=El(h.SUF),l=p;l=l+(y?"-"+y:""),l=l+(m||"");var T=El(h.UNIT);T&&(T="# "+T);var I=a.map(function(k){return h[k]});return I=I.map(El),I=[l].concat(I),r&&(I=I.concat([T])),l=I.filter(Boolean).join(" "),l===""&&(l="Parcel has no address"),console.log("concatDorAddress address result:",l),l},Dx=ta("DorStore",{state:()=>({dorDocuments:{}}),actions:{async initializeDorDocuments(){this.dorDocuments={};const t=of(),r=Vs(),a="//services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/RTT_SUMMARY/FeatureServer/0/query",h=function(p){console.log("where function is running, feature:",p);var y=WD(p),m=r.addressData.features[0].properties,l;if(!y||y==="null")l="MATCHED_REGMAP = '"+t.DOR.features[0].properties.BASEREG+"'";else{var T=r.addressData.features[0].properties,I=T.address_low,k=Math.floor(I/100,1)*100,P=I-k,L=T.address_high,K=L||I;l="(((ADDRESS_LOW >= "+I+" AND ADDRESS_LOW <= "+K+") OR (ADDRESS_LOW >= "+k+" AND ADDRESS_LOW <= "+K+" AND ADDRESS_HIGH >= "+P+" )) AND STREET_NAME = '"+m.street_name+"' AND STREET_SUFFIX = '"+m.street_suffix+"' AND (MOD(ADDRESS_LOW,2) = MOD( "+I+",2))",m.street_predir!=""&&(l+=" AND STREET_PREDIR = '"+m.street_predir+"'"),m.address_low_suffix!=""&&(l+=" AND ADDRESS_LOW_SUFFIX = '"+m.address_low_suffix+"'"),m.address_low_suffix==""&&(l+=" AND ADDRESS_LOW_SUFFIX = ''"),m.address_low_frac==="1/2"&&(l+=" AND ADDRESS_LOW_SUFFIX = '2'"),m.street_postdir!=""&&(l+=" AND STREET_POSTDIR = '"+m.street_postdir+"'");var tt=El(p.properties.UNIT),ot=m.unit_num;tt?l+=" AND UNIT_NUM = '"+tt+"'":ot!==""&&(l+=" AND UNIT_NUM = '"+ot+"'"),l+=") or MATCHED_REGMAP = '"+t.DOR.features[0].properties.BASEREG+"'",l+=" or REG_MAP_ID = '"+t.DOR.features[0].properties.BASEREG+"'"}return l};for(let p of t.DOR.features){const m={where:h(p),outFields:"DOCUMENT_ID, DISPLAY_DATE, DOCUMENT_TYPE, GRANTORS, GRANTEES",returnDistinctValues:"true",returnGeometry:"false",f:"json",sqlFormat:"standard"};console.log("params:",m);const l=await zi(a,{params:m});this.dorDocuments[p.properties.OBJECTID]=l}}}});var xr=63710088e-1,ZD={centimeters:xr*100,centimetres:xr*100,degrees:xr/111325,feet:xr*3.28084,inches:xr*39.37,kilometers:xr/1e3,kilometres:xr/1e3,meters:xr,metres:xr,miles:xr/1609.344,millimeters:xr*1e3,millimetres:xr*1e3,nauticalmiles:xr/1852,radians:1,yards:xr*1.0936};function jm(t,r,a){a===void 0&&(a={});var h={type:"Feature"};return(a.id===0||a.id)&&(h.id=a.id),a.bbox&&(h.bbox=a.bbox),h.properties=r||{},h.geometry=t,h}function Dd(t,r,a){if(a===void 0&&(a={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!i0(t[0])||!i0(t[1]))throw new Error("coordinates must contain numbers");var h={type:"Point",coordinates:t};return jm(h,r,a)}function KD(t,r,a){a===void 0&&(a={});for(var h=0,p=t;h<p.length;h++){var y=p[h];if(y.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var m=0;m<y[y.length-1].length;m++)if(y[y.length-1][m]!==y[0][m])throw new Error("First and last Position are not equivalent.")}var l={type:"Polygon",coordinates:t};return jm(l,r,a)}function XD(t,r,a){if(a===void 0&&(a={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");var h={type:"LineString",coordinates:t};return jm(h,r,a)}function YD(t,r){r===void 0&&(r={});var a={type:"FeatureCollection"};return r.id&&(a.id=r.id),r.bbox&&(a.bbox=r.bbox),a.features=t,a}function JD(t,r){r===void 0&&(r="kilometers");var a=ZD[r];if(!a)throw new Error(r+" units is invalid");return t*a}function id(t){var r=t%360;return r*Math.PI/180}function i0(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function s0(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return t.geometry.coordinates;if(t.type==="Point")return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function om(t,r,a){a===void 0&&(a={});var h=s0(t),p=s0(r),y=id(p[1]-h[1]),m=id(p[0]-h[0]),l=id(h[1]),T=id(p[1]),I=Math.pow(Math.sin(y/2),2)+Math.pow(Math.sin(m/2),2)*Math.cos(l)*Math.cos(T);return JD(2*Math.atan2(Math.sqrt(I),Math.sqrt(1-I)),a.units)}function lm(t,r,a){if(t!==null)for(var h,p,y,m,l,T,I,k=0,P=0,L,K=t.type,tt=K==="FeatureCollection",ot=K==="Feature",vt=tt?t.features.length:1,yt=0;yt<vt;yt++){I=tt?t.features[yt].geometry:ot?t.geometry:t,L=I?I.type==="GeometryCollection":!1,l=L?I.geometries.length:1;for(var At=0;At<l;At++){var ht=0,Tt=0;if(m=L?I.geometries[At]:I,m!==null){T=m.coordinates;var $t=m.type;switch(k=a&&($t==="Polygon"||$t==="MultiPolygon")?1:0,$t){case null:break;case"Point":if(r(T,P,yt,ht,Tt)===!1)return!1;P++,ht++;break;case"LineString":case"MultiPoint":for(h=0;h<T.length;h++){if(r(T[h],P,yt,ht,Tt)===!1)return!1;P++,$t==="MultiPoint"&&ht++}$t==="LineString"&&ht++;break;case"Polygon":case"MultiLineString":for(h=0;h<T.length;h++){for(p=0;p<T[h].length-k;p++){if(r(T[h][p],P,yt,ht,Tt)===!1)return!1;P++}$t==="MultiLineString"&&ht++,$t==="Polygon"&&Tt++}$t==="Polygon"&&ht++;break;case"MultiPolygon":for(h=0;h<T.length;h++){for(Tt=0,p=0;p<T[h].length;p++){for(y=0;y<T[h][p].length-k;y++){if(r(T[h][p][y],P,yt,ht,Tt)===!1)return!1;P++}Tt++}ht++}break;case"GeometryCollection":for(h=0;h<m.geometries.length;h++)if(lm(m.geometries[h],r,a)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function kx(t,r){if(t.type==="Feature")r(t,0);else if(t.type==="FeatureCollection")for(var a=0;a<t.features.length&&r(t.features[a],a)!==!1;a++);}function QD(t){var r=[];return t.type==="FeatureCollection"?kx(t,function(a){lm(a,function(h){r.push(Dd(h,a.properties))})}):lm(t,function(a){r.push(Dd(a,t.properties))}),YD(r)}function tk(t){if(!t)throw new Error("geojson is required");switch(t.type){case"Feature":return Rx(t);case"FeatureCollection":return ek(t);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return Gm(t);default:throw new Error("unknown GeoJSON type")}}function Rx(t){var r={type:"Feature"};return Object.keys(t).forEach(function(a){switch(a){case"type":case"properties":case"geometry":return;default:r[a]=t[a]}}),r.properties=zx(t.properties),r.geometry=Gm(t.geometry),r}function zx(t){var r={};return t&&Object.keys(t).forEach(function(a){var h=t[a];typeof h=="object"?h===null?r[a]=null:Array.isArray(h)?r[a]=h.map(function(p){return p}):r[a]=zx(h):r[a]=h}),r}function ek(t){var r={type:"FeatureCollection"};return Object.keys(t).forEach(function(a){switch(a){case"type":case"features":return;default:r[a]=t[a]}}),r.features=t.features.map(function(a){return Rx(a)}),r}function Gm(t){var r={type:t.type};return t.bbox&&(r.bbox=t.bbox),t.type==="GeometryCollection"?(r.geometries=t.geometries.map(function(a){return Gm(a)}),r):(r.coordinates=Lx(t.coordinates),r)}function Lx(t){var r=t;return typeof r[0]!="object"?r.slice():r.map(function(a){return Lx(a)})}function ik(t,r){if(!t)throw new Error("targetPoint is required");if(!r)throw new Error("points is required");var a,h=1/0,p=0;return kx(r,function(y,m){var l=om(t,y);l<h&&(p=m,h=l)}),a=tk(r.features[p]),a.properties.featureIndex=p,a.properties.distanceToPoint=h,a}const sk=(t,r)=>{const a={};if(!r.options.params)return a;const h=Object.entries(r.options.params);(void 0).store.state;for(let[p,y]of h){let m;typeof y=="function"?m=y(t):m=y,a[p]=m}return a},Rp=(t,r)=>{const a=sk(t,r);r.url;const h=r.options,p=h.table,y=h.dateMinNum||null,m=h.dateMinType||null,l=h.dateField||null;h.success;const T=h.distances||250,I=h.groupby||null,k="ST_Distance(the_geom::geography, ST_SetSRID(ST_Point("+t.geometry.coordinates[0]+","+t.geometry.coordinates[1]+"),4326)::geography)",P="ST_Y(the_geom)",L="ST_X(the_geom)";let K;I?K=I+", the_geom":K="*",K=K+", "+k+"as distance,"+P+"as lat, "+L+"as lng",a.q="select "+K+" from "+p+" where "+k+" < "+T;let tt;if(y){switch(m){case"hour":tt=qD;break;case"day":tt=TD;break;case"week":tt=jD;break;case"month":tt=UD;break;case"year":tt=GD;break}a.q=a.q+" and "+l+" > '"+am(tt(new Date,y),"yyyy-MM-dd")+"'"}return I&&(a.q=a.q+" group by "+I+", the_geom"),a},Ox=ta("NearbyActivityStore",{state:()=>({loadingData:!1,nearby311:{},nearbyCrimeIncidents:null,nearbyZoningAppeals:null,nearbyVacantIndicatorPoints:null,nearbyConstructionPermits:null,nearbyDemolitionPermits:null,nearbyImminentlyDangerous:null}),actions:{setLoadingData(t){this.loadingData=t},async fetchData(t){console.log("fetchData is runnning, dataType:",t),t==="nearby311"?await this.fillNearby311():t==="nearbyCrimeIncidents"?await this.fillNearbyCrimeIncidents():t==="nearbyZoningAppeals"?await this.fillNearbyZoningAppeals():t==="nearbyVacantIndicatorPoints"&&await this.fillNearbyVacantIndicatorPoints()},async fillNearby311(){const t=Vs();this.setLoadingData(!0);const r=t.addressData.features[0];let a={url:"https://phl.carto.com/api/v2/sql?",options:{table:"public_cases_fc",dateMinNum:365,dateMinType:"day",dateField:"requested_datetime"}},h=Rp(r,a);const p=await zi.get(a.url,{params:h});this.nearby311=p,this.setLoadingData(!1)},async fillNearbyCrimeIncidents(){const t=Vs();this.setLoadingData(!0);const r=t.addressData.features[0];let a={url:"https://phl.carto.com/api/v2/sql?",options:{table:"incidents_part1_part2",dateMinNum:90,dateMinType:"day",dateField:"dispatch_date"}},h=Rp(r,a);const p=await zi.get(a.url,{params:h});this.nearbyCrimeIncidents=p,this.setLoadingData(!1)},async fillNearbyZoningAppeals(){const t=Vs();this.setLoadingData(!0);const r=t.addressData.features[0];let a={url:"https://phl.carto.com/api/v2/sql?",options:{table:"appeals",dateMinNum:1,dateMinType:"year",dateField:"scheduleddate"}},h=Rp(r,a);const p=await zi.get(a.url,{params:h});this.nearbyZoningAppeals=p,this.setLoadingData(!1)},async fillNearbyVacantIndicatorPoints(){this.setLoadingData(!0);const r=nf().bufferForAddress,a="https://services.arcgis.com/fLeGjb7u4uXqeF9q/arcgis/rest/services/Vacant_Indicators_Points/FeatureServer/0/query?",h=r.geometries[0].rings[0];let p=[[parseFloat(h[0][0].toFixed(6)),parseFloat(h[0][1].toFixed(6))]];var y;for(y=0;y<h.length;y++)if(y%3==0){let K=[parseFloat(h[y][0].toFixed(6)),parseFloat(h[y][1].toFixed(6))];p.push(K)}p.push([parseFloat(h[0][0].toFixed(6)),parseFloat(h[0][1].toFixed(6))]);const m={returnGeometry:!0,where:"1=1",outSR:4326,outFields:"*",inSr:4326,geometryType:"esriGeometryPolygon",spatialRel:"esriSpatialRelContains",f:"geojson",geometry:JSON.stringify({rings:[p],spatialReference:{wkid:4326}})};let I=(await(await zi.get(a,{params:m})).data||{}).features;const P=Vs().addressData.features[0],L=Dd(P.geometry.coordinates);I=I.map(K=>{const tt=K.geometry.coordinates;let ot;if(Array.isArray(tt[0])){let yt;K.geometry.type==="LineString"?yt=XD([tt[0],tt[1]],{name:"line 1"}):yt=KD([tt[0]]);const At=QD(yt),ht=ik(L,At);ot=om(L,ht,{units:"miles"})}else{const yt=Dd(tt);ot=om(L,yt,{units:"miles"})}const vt=parseInt(ot*5280);return K._distance=vt,K}),this.nearbyVacantIndicatorPoints=I,this.setLoadingData(!1)}}});function rk(){return{addressDataFetch:async p=>{console.log("addressDataFetch is running"),await Vs().fillAddressData(p)},parcelsDataFetch:async()=>{const p=of();await p.fillPwdParcelData(),await p.fillDorParcelData()},condosDataFetch:async p=>{console.log("condosDataFetch is running"),await $h().fillCondoData(p)},topicDataFetch:async p=>{if(console.log("topicDataFetch is running, topic:",p),p==="Property"&&await Px().fillOpaData(),p==="Licenses & Inspections"){const y=Cx();await y.fillLiInspections(),await y.fillLiPermits()}if(p==="Deeds"&&await Dx().initializeDorDocuments(),p==="Nearby Activity"){await Ox().fillNearby311();const l=Vs().addressData.features[0].geometry.coordinates;await nf().fillBufferForAddress(l[0],l[1])}}}}const Vh=(t,r)=>{const a=t.__vccOpts||t;for(const[h,p]of r)a[h]=p;return a},nk={class:"topic-name has-text-left"},ak={key:0,class:"topic-loading has-text-right"},ok={key:0},lk={class:"inside-topic"},ck={__name:"Topic",props:{topicName:String,loading:Boolean},setup(t){const r=af(),a=t,{currentAddress:h}=aM(r),p=Cm(),y=Av();p.params.topic;const m=ji(()=>p.params.topic==a.topicName),l=()=>{console.log("topic clicked:",a.topicName),p.params.topic==a.topicName?y.push({name:"address",params:{address:h.value}}):y.push({name:"address-and-topic",params:{address:h.value,topic:a.topicName}})};return(T,I)=>(Ie(),je("section",null,[ct("div",{class:"topic",onClick:l},[ct("span",nk,Fe(t.topicName),1),m.value&&t.loading?(Ie(),je("span",ak,"Loading...")):Wi("",!0)]),m.value?(Ie(),je("div",ok,[ct("div",lk,[Uw(T.$slots,"default",{},void 0,!0)])])):Wi("",!0)]))}},fo=Vh(ck,[["__scopeId","data-v-33aef821"]]),Fa=t=>(Vd("data-v-49281eb6"),t=t(),Ud(),t),hk={key:0,class:"box"},uk={key:1,class:"vert-table"},dk={class:"columns"},fk=Fa(()=>ct("div",{class:"column is-4"},"OPA Account #",-1)),pk={class:"column is-8"},mk={class:"columns"},gk=Fa(()=>ct("div",{class:"column is-4"},"OPA Address",-1)),_k={class:"column is-8"},yk={class:"columns"},vk=Fa(()=>ct("div",{class:"column is-4"},"Owners",-1)),xk={class:"column is-8"},bk={class:"columns"},wk=Fa(()=>ct("div",{class:"column is-4"},"Assessed Value",-1)),Mk={class:"column is-8"},Sk={class:"columns"},Tk=Fa(()=>ct("div",{class:"column is-4"},"Sale Date",-1)),Ak={class:"column is-8"},Ek={class:"columns"},Ik=Fa(()=>ct("div",{class:"column is-4"},"Sale Price",-1)),Pk={class:"column is-8"},Ck={key:2},Dk={class:"title is-5"},kk=Fa(()=>ct("p",null,"You can use the Condominiums tab below to see information for an individual unit.",-1)),Rk={key:3},zk=Fa(()=>ct("p",null,"There is no property assessment record for this address.",-1)),Lk=[zk],Ok={__name:"Property",setup(t){console.log("Property.vue setup");const r=Vs(),a=Px(),h=$h();return(p,y)=>(Ie(),je("section",null,[Xe(a).opaData.rows.length?(Ie(),je("div",hk," Property assessment and sale information for this address. Source: Office of Property Assessments (OPA). OPA was formerly a part of the Bureau of Revision of Taxes (BRT) and some City records may still use that name. ")):Wi("",!0),Xe(a).opaData.rows.length?(Ie(),je("div",uk,[ct("div",dk,[fk,ct("div",pk,Fe(Xe(r).addressData.features[0].properties.opa_account_num),1)]),ct("div",mk,[gk,ct("div",_k,Fe(Xe(r).addressData.features[0].properties.opa_address),1)]),ct("div",yk,[vk,ct("div",xk,Fe(Xe(r).getOpaOwners),1)]),ct("div",bk,[wk,ct("div",Mk,Fe(Xe(a).getMarketValue),1)]),ct("div",Sk,[Tk,ct("div",Ak,Fe(Xe(a).getSaleDate),1)]),ct("div",Ek,[Ik,ct("div",Pk,Fe(Xe(a).getSalePrice),1)])])):Wi("",!0),!Xe(a).opaData.rows.length&&Xe(h).condosData.length?(Ie(),je("div",Ck,[ct("h5",Dk,"There are "+Fe(Xe(h).condosData.length)+" condominium units at this address.",1),kk])):Xe(a).opaData.rows.length?Wi("",!0):(Ie(),je("div",Rk,Lk))]))}},Fk=Vh(Ok,[["__scopeId","data-v-49281eb6"]]),Bk=ct("div",{class:"box"}," Condominium units at your search address, as recorded for property assessment purposes. Click one of the addresses below to see information for that unit. Use the back button to return to this list. Source: Office of Property Assessment ",-1),Nk=ct("h5",{class:"subtitle is-5"},"Condominiums",-1),$k={class:"table is-fullwidth is-striped"},Vk=ct("thead",null,[ct("tr",null,[ct("th",null,"Address"),ct("th",null,"OPA Account #")])],-1),Uk={__name:"Condos",setup(t){console.log("Condos.vue setup");const r=$h(),a=ji(()=>r.condosData);return(h,p)=>(Ie(),je("section",null,[Bk,Nk,ct("table",$k,[Vk,ct("tbody",null,[(Ie(!0),je(ns,null,An(a.value,y=>(Ie(),je("tr",null,[ct("td",null,[Zi(Xe(Sv),{to:{name:"address-and-topic",params:{address:y.properties.opa_address,topic:"Property"}}},{default:Kn(()=>[nv(Fe(y.properties.opa_address),1)]),_:2},1032,["to"])]),ct("td",null,Fe(y.properties.opa_account_num),1)]))),256))])])]))}},cn=t=>(Vd("data-v-071ec60b"),t=t(),Ud(),t),qk=cn(()=>ct("div",{class:"box"},"Deed information and document transactions for this address. The map faithfully reflects property boundaries as described in recorded deeds including multiple types of easements. The property boundaries displayed on the map are for reference only and should not be used in place of the recorded deeds or land surveys. Source: Department of Records",-1)),jk={class:"columns is-multiline"},Gk=["onClick"],Hk=cn(()=>ct("h5",{class:"title is-5"},"Parcel Details",-1)),Wk={key:0,class:"vert-table"},Zk={class:"columns"},Kk=cn(()=>ct("div",{class:"column is-4"},"Map Registry #",-1)),Xk={class:"column is-8"},Yk={class:"columns"},Jk=cn(()=>ct("div",{class:"column is-4"},"Parcel Address",-1)),Qk={class:"column is-8"},t3={class:"columns"},e3=cn(()=>ct("div",{class:"column is-4"},"Status",-1)),i3={class:"column is-8"},s3={class:"columns"},r3=cn(()=>ct("div",{class:"column is-4"},"Origination Date",-1)),n3={class:"column is-8"},a3={class:"columns"},o3=cn(()=>ct("div",{class:"column is-4"},"Inactive Date",-1)),l3={class:"column is-8"},c3={class:"columns"},h3=cn(()=>ct("div",{class:"column is-4"},"Has Air Rights",-1)),u3={class:"column is-8"},d3={class:"columns"},f3=cn(()=>ct("div",{class:"column is-4"},"Is Condo",-1)),p3={class:"column is-8"},m3={class:"mt-6"},g3=cn(()=>ct("h5",{class:"subtitle is-5"},"Documents",-1)),_3={class:"table is-fullwidth is-striped"},y3=cn(()=>ct("thead",null,[ct("tr",null,[ct("th",null,"ID"),ct("th",null,"Date"),ct("th",null,"Type"),ct("th",null,"Grantor"),ct("th",null,"Grantee")])],-1)),v3={__name:"Deeds",setup(t){Vs();const r=of(),a=Dx(),h=Mr(""),p=ji(()=>r.DOR.features.filter(l=>l.id===h.value)[0]),y=ji(()=>a.dorDocuments[h.value].data.features);G0(()=>{console.log("Deeds.vue onBeforeMount"),h.value=r.DOR.features[0].properties.OBJECTID}),Sm(()=>{console.log("Deeds.vue onMounted")});const m={1:"Active",2:"Inactive",3:"Remainder"};return(l,T)=>(Ie(),je(ns,null,[qk,ct("div",jk,[(Ie(!0),je(ns,null,An(Xe(r).DOR.features,I=>(Ie(),je("div",{key:I.properties.OBJECTID,onClick:k=>h.value=I.properties.OBJECTID,class:_o(["column is-3 add-borders",{"is-selected":I.properties.OBJECTID===h.value}])},Fe(I.properties.MAPREG),11,Gk))),128))]),Hk,Xe(r).DOR.features.length?(Ie(),je("div",Wk,[ct("div",Zk,[Kk,ct("div",Xk,Fe(p.value.properties.MAPREG),1)]),ct("div",Yk,[Jk,ct("div",Qk,Fe(p.value.properties.ADDR_SOURCE),1)]),ct("div",t3,[e3,ct("div",i3,Fe(m[p.value.properties.STATUS]),1)]),ct("div",s3,[r3,ct("div",n3,Fe(p.value.properties.ORIG_DATE),1)]),ct("div",a3,[o3,ct("div",l3,Fe(p.value.properties.INACTDATE||"None"),1)]),ct("div",c3,[h3,ct("div",u3,Fe(p.value.properties.SUFFIX?"Yes":"No"),1)]),ct("div",d3,[f3,ct("div",p3,Fe(p.value.properties.CONDOFLAG?"Yes":"No"),1)])])):Wi("",!0),ct("div",m3,[g3,ct("table",_3,[y3,ct("tbody",null,[(Ie(!0),je(ns,null,An(y.value,I=>(Ie(),je("tr",null,[ct("td",null,Fe(I.attributes.DOCUMENT_ID),1),ct("td",null,Fe(I.attributes.DISPLAY_DATE),1),ct("td",null,Fe(I.attributes.DOCUMENT_TYPE),1),ct("td",null,Fe(I.attributes.GRANTORS),1),ct("td",null,Fe(I.attributes.GRANTEES),1)]))),256))])])])],64))}},x3=Vh(v3,[["__scopeId","data-v-071ec60b"]]),b3=ct("div",{class:"box"}," Licenses, inspections, permits, property maintenance violations, and zoning permit documents at your search address. Source: Department of Licenses & Inspections ",-1),w3=ct("h5",{class:"subtitle is-5"},"Permits",-1),M3={class:"table is-fullwidth is-striped"},S3=ct("thead",null,[ct("tr",null,[ct("th",null,"Date"),ct("th",null,"ID"),ct("th",null,"Description"),ct("th",null,"Status")])],-1),T3=ct("h5",{class:"subtitle is-5"},"Inspections",-1),A3={class:"table is-fullwidth is-striped"},E3=ct("thead",null,[ct("tr",null,[ct("th",null,"Date"),ct("th",null,"ID"),ct("th",null,"Description"),ct("th",null,"Status")])],-1),I3=["innerHTML"],P3={__name:"LI",setup(t){console.log("LI.vue setup");const r=Vs(),a=Cx(),{currency:h,date:p}=qm(),y=(k,P)=>new Date(P.permitissuedate)-new Date(k.permitissuedate),m=ji(()=>a.liPermits.rows.sort(y).slice(0,5)),l=(k,P)=>new Date(P.investigationcompleted)-new Date(k.investigationcompleted),T=ji(()=>a.liInspections.rows.sort(l).slice(0,5)),I=k=>{let P=r.addressData.features[0].properties.street_address;return k.unit_num&&k.unit_num!=null&&(P+=" Unit "+k.unit_num),"<a target='_blank' href='https://li.phila.gov/Property-History/search/Violation-Detail?address="+encodeURIComponent(P)+"&Id="+k.casenumber+"'>"+k.casenumber+" <i class='fa fa-external-link-alt'></i></a>"};return(k,P)=>(Ie(),je("section",null,[b3,w3,ct("table",M3,[S3,ct("tbody",null,[(Ie(!0),je(ns,null,An(m.value,L=>(Ie(),je("tr",null,[ct("td",null,Fe(Xe(p)(L.permitissuedate)),1),ct("td",null,Fe(L.permitnumber),1),ct("td",null,Fe(L.permitdescription),1),ct("td",null,Fe(L.status),1)]))),256))])]),T3,ct("table",A3,[E3,ct("tbody",null,[(Ie(!0),je(ns,null,An(T.value,L=>(Ie(),je("tr",null,[ct("td",null,Fe(Xe(p)(L.investigationcompleted)),1),ct("td",{innerHTML:I(L)},null,8,I3),ct("td",null,Fe(L.investigationtype),1),ct("td",null,Fe(L.investigationstatus),1)]))),256))])])]))}},C3=ct("h1",null,"Zoning Content",-1),D3=[C3],k3={__name:"Zoning",setup(t){return console.log("Zoning.vue setup"),(r,a)=>(Ie(),je("section",null,D3))}},R3=ct("h1",null,"Voting Content",-1),z3=[R3],L3={__name:"Voting",setup(t){return console.log("Voting.vue setup"),(r,a)=>(Ie(),je("section",null,z3))}},O3=ct("div",{class:"box"}," See recent activity near your search address including 311 service requests, crimes, zoning appeals, and more. Hover over a record below to highlight it on the map. ",-1),F3=ct("div",{class:"dropdown-trigger"},[ct("button",{class:"button","aria-haspopup":"true","aria-controls":"dropdown-menu"},[ct("span",null,"What nearby activity would you like to see?"),ct("span",{class:"icon is-small"},[ct("i",{class:"fas fa-angle-down","aria-hidden":"true"})])])],-1),B3={class:"dropdown-menu",id:"dropdown-menu",role:"menu"},N3={class:"dropdown-content"},$3=ct("br",null,null,-1),V3=ct("div",{class:"dropdown-trigger"},[ct("button",{class:"button","aria-haspopup":"true","aria-controls":"dropdown-menu"},[ct("span",null,"From"),ct("span",{class:"icon is-small"},[ct("i",{class:"fas fa-angle-down","aria-hidden":"true"})])])],-1),U3={class:"dropdown-menu",id:"dropdown-menu",role:"menu"},q3={class:"dropdown-content"},j3=["onClick"],G3=ct("div",{class:"dropdown-trigger"},[ct("button",{class:"button","aria-haspopup":"true","aria-controls":"dropdown-menu"},[ct("span",null,"Sort by"),ct("span",{class:"icon is-small"},[ct("i",{class:"fas fa-angle-down","aria-hidden":"true"})])])],-1),H3={class:"dropdown-menu",id:"dropdown-menu",role:"menu"},W3={class:"dropdown-content"},Z3=ct("br",null,null,-1),K3={key:0,class:"mt-5"},X3=ct("h5",{class:"subtitle is-5"},"311 Requests",-1),Y3={key:0},J3={class:"table is-fullwidth is-striped"},Q3=ct("thead",null,[ct("tr",null,[ct("th",null,"Date"),ct("th",null,"Location"),ct("th",null,"Type"),ct("th",null,"Distance")])],-1),tR={key:1,class:"mt-5"},eR=ct("h5",{class:"subtitle is-5"},"Crime Incidents",-1),iR={key:0},sR={class:"table is-fullwidth is-striped"},rR=ct("thead",null,[ct("tr",null,[ct("th",null,"Date"),ct("th",null,"Location"),ct("th",null,"Description"),ct("th",null,"Distance")])],-1),nR={key:2,class:"mt-5"},aR=ct("h5",{class:"subtitle is-5"},"Zoning Appeals",-1),oR={key:0},lR={class:"table is-fullwidth is-striped"},cR=ct("thead",null,[ct("tr",null,[ct("th",null,"Date"),ct("th",null,"Location"),ct("th",null,"Description"),ct("th",null,"Distance")])],-1),hR={key:3,class:"mt-5"},uR=ct("h5",{class:"subtitle is-5"},"Likely Vacant Properties",-1),dR={key:0},fR={class:"table is-fullwidth is-striped"},pR=ct("thead",null,[ct("tr",null,[ct("th",null,"Address"),ct("th",null,"Property Type"),ct("th",null,"Distance")])],-1),mR={__name:"NearbyActivity",setup(t){console.log("Nearby.vue setup");const r=Ox();nf();const{currency:a,date:h}=qm(),p=(Vt,Gt,Dt)=>new Date(Gt[Dt])-new Date(Vt[Dt]),y={nearby311:"311 Requests",nearbyCrimeIncidents:"Crime Incidents",nearbyZoningAppeals:"Zoning Appeals",nearbyVacantIndicatorPoints:"Vacant Properties",nearbyConstructionPermits:"Construction Permits",nearbyDemolitionPermits:"Demolition Permits",nearbyImminentlyDangerous:"Imminently Dangerous"},m=Mr(!1),l=()=>m.value=!m.value,T=Mr("nearby311"),I=ji(()=>r.loadingData),k=async Vt=>{T.value=Vt,r[Vt]===null&&(console.log("fetching new data"),await r.fetchData(Vt)),ht(Tt[Vt].values[0])},P=Mr(!1),L=()=>P.value=!P.value,K=Mr("distance"),tt=Vt=>{K.value=Vt},ot=Mr(!1),vt=()=>ot.value=!ot.value,yt=Mr(30),At=ji(()=>Tt[T.value].labels[Tt[T.value].values.indexOf(yt.value)]),ht=Vt=>{yt.value=Vt},Tt={nearby311:{labels:["the last 30 days","the last 90 days","1 year"],values:[30,90,365]},nearbyCrimeIncidents:{labels:["the last 30 days","the last 90 days"],values:[30,90]},nearbyZoningAppeals:{labels:["any time","the last 90 days","the next 90 days"],values:[0,-90,90]},nearbyVacantIndicatorPoints:{labels:[],values:[]},nearbyConstructionPermits:{labels:["the last 30 days","the last 90 days","1 year"],values:[30,90,365]},nearbyDemolitionPermits:{labels:["the last 30 days","the last 90 days","1 year"],values:[30,90,365]},nearbyImminentlyDangerous:{labels:["the last 30 days","the last 90 days","1 year"],values:[30,90,365]}},$t=ji(()=>{if(r.nearby311){let Vt=[...r.nearby311.data.rows].filter(Gt=>{let Dt=new Date(Gt.requested_datetime);return(new Date-Dt)/(1e3*60*60*24)<=yt.value});return K.value==="distance"?Vt.sort((Gt,Dt)=>Gt.distance-Dt.distance):K.value==="time"&&Vt.sort((Gt,Dt)=>p(Gt,Dt,"requested_datetime")),Vt}}),qt=ji(()=>{if(r.nearbyCrimeIncidents){let Vt=[...r.nearbyCrimeIncidents.data.rows].filter(Gt=>{let Dt=new Date(Gt.dispatch_date);return(new Date-Dt)/(1e3*60*60*24)<=yt.value});return K.value==="distance"?Vt.sort((Gt,Dt)=>Gt.distance-Dt.distance):K.value==="time"&&Vt.sort((Gt,Dt)=>p(Gt,Dt,"dispatch_date")),Vt}}),oe=ji(()=>{if(r.nearbyZoningAppeals){let Vt=[...r.nearbyZoningAppeals.data.rows];return console.log(new Date(Vt[0].scheduleddate)),yt.value<0?Vt=Vt.filter(Gt=>{let Dt=new Date(Gt.scheduleddate);return(new Date-Dt)/(1e3*60*60*24)>=yt.value}):yt.value>0&&(Vt=Vt.filter(Gt=>{let Dt=new Date(Gt.scheduleddate);return(new Date-Dt)/(1e3*60*60*24)<=yt.value})),K.value==="distance"?Vt.sort((Gt,Dt)=>Gt.distance-Dt.distance):K.value==="time"&&Vt.sort((Gt,Dt)=>p(Gt,Dt,"dispatch_date")),Vt}}),ne=ji(()=>{if(r.nearbyVacantIndicatorPoints){let Vt=[...r.nearbyVacantIndicatorPoints];return K.value==="distance"?Vt.sort((Gt,Dt)=>Gt._distance-Dt._distance):K.value==="type"&&Vt.sort((Gt,Dt)=>Gt.distance-Dt.distance),Vt}});return(Vt,Gt)=>(Ie(),je("section",null,[O3,ct("div",{class:_o(m.value?"dropdown is-active":"dropdown"),onClick:l},[F3,ct("div",B3,[ct("div",N3,[ct("a",{class:"dropdown-item",onClick:Gt[0]||(Gt[0]=Dt=>k("nearby311"))},"311 Requests"),ct("a",{class:"dropdown-item",onClick:Gt[1]||(Gt[1]=Dt=>k("nearbyCrimeIncidents"))},"Crime Incidents"),ct("a",{class:"dropdown-item",onClick:Gt[2]||(Gt[2]=Dt=>k("nearbyZoningAppeals"))},"Zoning Appeals"),ct("a",{class:"dropdown-item",onClick:Gt[3]||(Gt[3]=Dt=>k("nearbyVacantIndicatorPoints"))},"Vacant Properties"),ct("a",{class:"dropdown-item",onClick:Gt[4]||(Gt[4]=Dt=>k("nearbyConstructionPermits"))},"Construction Permits"),ct("a",{class:"dropdown-item",onClick:Gt[5]||(Gt[5]=Dt=>k("nearbyDemolitionPermits"))},"Demolition Permits"),ct("a",{class:"dropdown-item",onClick:Gt[6]||(Gt[6]=Dt=>k("nearbyImminentlyDangerous"))},"Imminently Dangerous")])])],2),ct("span",null,Fe(y[T.value]),1),$3,ct("div",{class:_o(ot.value?"dropdown is-active":"dropdown"),onClick:vt},[V3,ct("div",U3,[ct("div",q3,[(Ie(!0),je(ns,null,An(Tt[T.value].values,(Dt,de)=>(Ie(),je("a",{class:"dropdown-item",onClick:De=>ht(Dt)},Fe(Tt[T.value].labels[de]),9,j3))),256))])])],2),ct("span",null,Fe(At.value),1),ct("div",{class:_o(P.value?"dropdown is-active":"dropdown"),onClick:L},[G3,ct("div",H3,[ct("div",W3,[ct("a",{class:"dropdown-item",onClick:Gt[7]||(Gt[7]=Dt=>tt("distance"))},"distance"),ct("a",{class:"dropdown-item",onClick:Gt[8]||(Gt[8]=Dt=>tt("time"))},"time")])])],2),ct("span",null,Fe(K.value),1),Z3,T.value=="nearby311"?(Ie(),je("div",K3,[X3,I.value?(Ie(),je("div",Y3,"Loading...")):Wi("",!0),ct("table",J3,[Q3,ct("tbody",null,[(Ie(!0),je(ns,null,An($t.value,Dt=>(Ie(),je("tr",null,[ct("td",null,Fe(Xe(h)(Dt.requested_datetime)),1),ct("td",null,Fe(Dt.address),1),ct("td",null,Fe(Dt.service_name),1),ct("td",null,Fe((Dt.distance*3.28084).toFixed(0))+" ft",1)]))),256))])])])):Wi("",!0),T.value=="nearbyCrimeIncidents"?(Ie(),je("div",tR,[eR,I.value?(Ie(),je("div",iR,"Loading...")):Wi("",!0),ct("table",sR,[rR,ct("tbody",null,[(Ie(!0),je(ns,null,An(qt.value,Dt=>(Ie(),je("tr",null,[ct("td",null,Fe(Dt.dispatch_date),1),ct("td",null,Fe(Dt.location_block),1),ct("td",null,Fe(Dt.text_general_code),1),ct("td",null,Fe((Dt.distance*3.28084).toFixed(0))+" ft",1)]))),256))])])])):Wi("",!0),T.value=="nearbyZoningAppeals"?(Ie(),je("div",nR,[aR,I.value?(Ie(),je("div",oR,"Loading...")):Wi("",!0),ct("table",lR,[cR,ct("tbody",null,[(Ie(!0),je(ns,null,An(oe.value,Dt=>(Ie(),je("tr",null,[ct("td",null,Fe(Dt.scheduleddate),1),ct("td",null,Fe(Dt.address),1),ct("td",null,Fe(Dt.appeal_grounds),1),ct("td",null,Fe((Dt.distance*3.28084).toFixed(0))+" ft",1)]))),256))])])])):Wi("",!0),T.value=="nearbyVacantIndicatorPoints"?(Ie(),je("div",hR,[uR,I.value?(Ie(),je("div",dR,"Loading...")):Wi("",!0),ct("table",fR,[pR,ct("tbody",null,[(Ie(!0),je(ns,null,An(ne.value,Dt=>(Ie(),je("tr",null,[ct("td",null,Fe(Dt.properties.ADDRESS),1),ct("td",null,Fe(Dt.properties.VACANT_FLAG),1),ct("td",null,Fe((Dt._distance*3.28084).toFixed(0))+" ft",1)]))),256))])])])):Wi("",!0)]))}},gR=t=>(Vd("data-v-22fbd821"),t=t(),Ud(),t),_R={key:0,class:"columns"},yR=u2('<div class="column is-12" data-v-22fbd821><h3 class="subtitle is-3" data-v-22fbd821>Atlas is your front door to the City of Philadelphia.</h3><p class="subtitle is-5" data-v-22fbd821>Here are some things you can do with Atlas:</p><ul data-v-22fbd821><li data-v-22fbd821>Find your polling place</li><li data-v-22fbd821>Get the history of permits, licenses, and inspections at any address</li><li data-v-22fbd821>Research real estate information including property values, zoning, and document archives</li><li data-v-22fbd821>Get easy access to a variety of hard-to-find City resources</li><li data-v-22fbd821>View recent activity around your address, such as crimes, 311 service requests, and more</li><li data-v-22fbd821>Explore historical imagery and maps</li></ul><p data-v-22fbd821>To get started, click anywhere on the map, or type an address, intersection, property assessment account number, or Department of Records Map Registry number into the search box.</p></div>',1),vR=[yR],xR={key:1,class:"columns"},bR=gR(()=>ct("div",{class:"column is-12"},[ct("p",null,"We couldn't find that address. Are you sure everything was spelled correctly?"),ct("p",null,"Here are some examples of things you can search for:"),ct("ul",null,[ct("li",null,"1234 Market St"),ct("li",null,"1001 Pine Street #201"),ct("li",null,"12th & Market"),ct("li",null,"12th & Market"),ct("li",null,"883309050 (an OPA number with no hyphens or other characters)")])],-1)),wR=[bR],MR={key:2},SR={class:"columns"},TR={class:"column is-12"},AR={class:"subtitle is-3"},ER={__name:"TopicPanel",setup(t){const r=Sr("addressDataLoadedFlagKey"),a=Sr("dataSourcesLoadedArrayKey");console.log("addressDataLoadedFlag:",r,"dataSourcesLoadedArray:",a.value);const h=af(),p=$h(),y=Cm();console.log("TopicPanel setup, route.params:",y.params,"route:",y);const m=ji(()=>h.currentAddress);return(l,T)=>(Ie(),je("section",null,[Xe(y).name=="home"?(Ie(),je("div",_R,vR)):Wi("",!0),Xe(y).name=="not-found"?(Ie(),je("div",xR,wR)):Wi("",!0),Xe(y).params.address?(Ie(),je("div",MR,[ct("div",SR,[ct("div",TR,[ct("h3",AR,Fe(m.value),1)])]),Zi(fo,{"topic-name":"Property",loading:!Xe(a).includes("Property")},{default:Kn(()=>[Xe(a).includes("Property")?(Ie(),Mn(Fk,{key:0})):Wi("",!0)]),_:1},8,["loading"]),V0(Zi(fo,{"topic-name":"Condominiums",loading:!Xe(a).includes("Condominiums")},{default:Kn(()=>[Xe(a).includes("Condominiums")?(Ie(),Mn(Uk,{key:0})):Wi("",!0)]),_:1},8,["loading"]),[[I2,Xe(p).condosData.length>0]]),Zi(fo,{"topic-name":"Deeds",loading:!Xe(a).includes("Deeds")},{default:Kn(()=>[Xe(a).includes("Deeds")?(Ie(),Mn(x3,{key:0})):Wi("",!0)]),_:1},8,["loading"]),Zi(fo,{"topic-name":"Licenses & Inspections",loading:!Xe(a).includes("Licenses & Inspections")},{default:Kn(()=>[Xe(a).includes("Licenses & Inspections")?(Ie(),Mn(P3,{key:0})):Wi("",!0)]),_:1},8,["loading"]),Zi(fo,{"topic-name":"Zoning",loading:!Xe(a).includes("Zoning")},{default:Kn(()=>[Xe(a).includes("Zoning")?(Ie(),Mn(k3,{key:0})):Wi("",!0)]),_:1},8,["loading"]),Zi(fo,{"topic-name":"Voting",loading:!Xe(a).includes("Voting")},{default:Kn(()=>[Xe(a).includes("Voting")?(Ie(),Mn(L3,{key:0})):Wi("",!0)]),_:1},8,["loading"]),Zi(fo,{"topic-name":"Nearby Activity",loading:!Xe(a).includes("Nearby Activity")},{default:Kn(()=>[Xe(a).includes("Nearby Activity")?(Ie(),Mn(mR,{key:0})):Wi("",!0)]),_:1},8,["loading"])])):Wi("",!0)]))}},IR=Vh(ER,[["__scopeId","data-v-22fbd821"]]),Fx=t=>(Vd("data-v-e9b318c5"),t=t(),Ud(),t),PR=Fx(()=>ct("div",{class:"container"},[ct("h1",{class:"title is-1"},"Vue3 Atlas")],-1)),CR={class:"container"},DR={class:"columns"},kR={class:"column is-10"},RR={class:"small-container"},zR={class:"columns"},LR={class:"column is-6"},OR=Fx(()=>ct("div",{id:"map-panel",class:"column is-6"},[ct("div",{id:"map",class:"map-class"})],-1)),FR={__name:"Home",setup(t){const r=nf(),a=af(),h=Vs(),p=$h(),y=of(),m=Cm(),l=Av(),{noMapStyle:T,pwdDrawnMapStyle:I,dorDrawnMapStyle:k,zoningDrawnMapStyle:P,imageryMapStyle:L}=pC(),{addressDataFetch:K,parcelsDataFetch:tt,condosDataFetch:ot,topicDataFetch:vt}=rk(),yt=Mr(!1);Ol("addressDataLoadedFlagKey",yt);const At=Mr([]);Ol("dataSourcesLoadedArrayKey",At);const ht=Mr("");let Tt;const $t=[],qt={undefined:"PWD",Property:"PWD",Condos:"PWD",Deeds:"DOR","Licenses & Inspections":"PWD",Zoning:"DOR",Voting:"PWD","Nearby Activity":"PWD"},oe={Property:I,Condos:I,Deeds:k,"Licenses & Inspections":I,Zoning:P,Voting:I,"Nearby Activity":I},ne=()=>{console.log("toggleImagery, map.getStyle:",Tt.getStyle()),Tt.getStyle().name==="imageryMap"?Tt.setStyle(r.currentTopicMapStyle):Tt.setStyle(L)},Vt=de=>{console.log("routeToAddress is running, currentAddress:",de),a.currentAddress&&m.params.topic?l.push({name:"address-and-topic",params:{address:a.currentAddress,topic:m.params.topic}}):a.currentAddress&&l.push({name:"address-and-topic",params:{address:a.currentAddress,topic:"Property"}})};Sm(async()=>{m.name==="not-found"&&l.push({name:"home"}),m.params.address&&(ht.value=m.params.address,Dt());let de;m.params.topic?de=oe[m.params.topic]:de=I,r.currentTopicMapStyle=de;let De;m.params.address?De=17:De=12,Tt=new vy.Map({container:"map",style:de,center:[-75.163471,39.953338],zoom:De,minZoom:6,maxZoom:22}),Tt.on("click",async ke=>{console.log("map click event:",ke.lngLat,"route.params.topic:",m.params.topic);let gi;const Re=qt[m.params.topic];await y.fillParcelDataByLngLat(ke.lngLat.lng,ke.lngLat.lat,Re);const Le=Re==="PWD"?"ADDRESS":"ADDR_SOURCE";console.log("parcelLayer:",Re,"ParcelsStore[parcelLayer].features[0].properties[addressField]:",y[Re].features[0].properties[Le]),gi=y[Re].features[0].properties[Le],console.log("currentAddress:",gi),a.setCurrentAddress(gi),a.setLastSearchMethod("mapClick"),Vt(gi)})});const Gt=async de=>{if(console.log("getAddressAndPutInStore is running, address:",de),yt.value=!1,At.value=[],await K(de),!h.addressData.features){l.push({name:"not-found"});return}const De=h.addressData.features[0].properties.street_address;a.setCurrentAddress(De),yt.value=!0},Dt=async()=>{await Gt(ht.value),a.setLastSearchMethod("address");const de=a.currentAddress;console.log("currentAddress:",de),de&&Vt(de)};return l.afterEach(async(de,De)=>{if(console.log("router.afterEach to:",de,"from:",De,"to.name:",de.name),de.name==="not-found"){$t.forEach(gi=>gi.remove());return}const ke=Tt.getStyle();if(ke&&ke.name!=="imageryMap"&&(de.params.topic?(Tt.setStyle(oe[de.params.topic]),r.currentTopicMapStyle=oe[de.params.topic]):(Tt.setStyle(I),r.currentTopicMapStyle=I)),de.params.address!==De.params.address)await Gt(de.params.address);else if(At.value.includes(de.params.topic))return;if(de.params.topic==De.params.topic&&de.params.address||De.params.topic==null&&de.params.address){const gi=h.addressData.features[0].geometry.coordinates;$t.forEach(Le=>Le.remove());const Re=new vy.Marker().setLngLat(gi).addTo(Tt);$t.push(Re),a.lastSearchMethod==="address"&&(Tt.setCenter(gi),Tt.setZoom(17))}if(await tt(),await ot(de.params.address),de.params.topic=="Condominiums"&&!p.condosData.length){l.push({name:"address-and-topic",params:{address:de.params.address,topic:"Property"}});return}await vt(de.params.topic),At.value.push(de.params.topic)}),(de,De)=>(Ie(),je("main",null,[PR,ct("div",CR,[ct("div",DR,[ct("div",kR,[V0(ct("input",{class:"input",type:"text",placeholder:"Search an address","onUpdate:modelValue":De[0]||(De[0]=ke=>ht.value=ke),onKeydown:W2(Dt,["enter"])},null,544),[[G2,ht.value]])]),ct("button",{class:"button",onClick:Dt}," Search "),ct("button",{class:"button",onClick:ne},"Toggle Imagery")])]),ct("div",RR,[ct("div",zR,[ct("div",LR,[Zi(IR)]),OR])])]))}},sd=Vh(FR,[["__scopeId","data-v-e9b318c5"]]),BR=oS({history:BM("/vue3-atlas2"),routes:[{path:"/:pathMatch(.*)*",name:"NotFound",component:()=>dS(()=>import("./NotFound-_7SDALgk.js"),[])},{path:"/",name:"home",component:sd,props:!0,children:[]},{path:"/:address",name:"address",component:sd},{path:"/:address/:topic",name:"address-and-topic",component:sd},{path:"/not-found",name:"not-found",component:sd}]}),Hm=X2(cS);Hm.use(tM());Hm.use(BR);Hm.mount("#app");export{Vh as _,ct as a,nv as b,je as c,Zi as d,Ie as o,NR as r,Kn as w};
