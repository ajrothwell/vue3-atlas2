(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))u(d);new MutationObserver(d=>{for(const g of d)if(g.type==="childList")for(const m of g.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&u(m)}).observe(document,{childList:!0,subtree:!0});function a(d){const g={};return d.integrity&&(g.integrity=d.integrity),d.referrerPolicy&&(g.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?g.credentials="include":d.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function u(d){if(d.ep)return;d.ep=!0;const g=a(d);fetch(d.href,g)}})();/**
* @vue/shared v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Em(e,r){const a=new Set(e.split(","));return r?u=>a.has(u.toLowerCase()):u=>a.has(u)}const Fr={},eu=[],fa=()=>{},Zb=()=>!1,pp=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&(e.charCodeAt(2)>122||e.charCodeAt(2)<97),Tm=e=>e.startsWith("onUpdate:"),jn=Object.assign,Cm=(e,r)=>{const a=e.indexOf(r);a>-1&&e.splice(a,1)},Wb=Object.prototype.hasOwnProperty,Xi=(e,r)=>Wb.call(e,r),_i=Array.isArray,tu=e=>fp(e)==="[object Map]",T0=e=>fp(e)==="[object Set]",Ii=e=>typeof e=="function",In=e=>typeof e=="string",mu=e=>typeof e=="symbol",Ur=e=>e!==null&&typeof e=="object",C0=e=>(Ur(e)||Ii(e))&&Ii(e.then)&&Ii(e.catch),I0=Object.prototype.toString,fp=e=>I0.call(e),Xb=e=>fp(e).slice(8,-1),A0=e=>fp(e)==="[object Object]",Im=e=>In(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,ph=Em(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),mp=e=>{const r=Object.create(null);return a=>r[a]||(r[a]=e(a))},Kb=/-(\w)/g,so=mp(e=>e.replace(Kb,(r,a)=>a?a.toUpperCase():"")),Yb=/\B([A-Z])/g,hc=mp(e=>e.replace(Yb,"-$1").toLowerCase()),gp=mp(e=>e.charAt(0).toUpperCase()+e.slice(1)),Cf=mp(e=>e?`on${gp(e)}`:""),Ml=(e,r)=>!Object.is(e,r),Bd=(e,r)=>{for(let a=0;a<e.length;a++)e[a](r)},Kd=(e,r,a)=>{Object.defineProperty(e,r,{configurable:!0,enumerable:!1,value:a})},Kf=e=>{const r=parseFloat(e);return isNaN(r)?e:r};let $y;const P0=()=>$y||($y=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Am(e){if(_i(e)){const r={};for(let a=0;a<e.length;a++){const u=e[a],d=In(u)?tw(u):Am(u);if(d)for(const g in d)r[g]=d[g]}return r}else if(In(e)||Ur(e))return e}const Jb=/;(?![^(]*\))/g,Qb=/:([^]+)/,ew=/\/\*[^]*?\*\//g;function tw(e){const r={};return e.replace(ew,"").split(Jb).forEach(a=>{if(a){const u=a.split(Qb);u.length>1&&(r[u[0].trim()]=u[1].trim())}}),r}function is(e){let r="";if(In(e))r=e;else if(_i(e))for(let a=0;a<e.length;a++){const u=is(e[a]);u&&(r+=u+" ")}else if(Ur(e))for(const a in e)e[a]&&(r+=a+" ");return r.trim()}const iw="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",rw=Em(iw);function D0(e){return!!e||e===""}const qt=e=>In(e)?e:e==null?"":_i(e)||Ur(e)&&(e.toString===I0||!Ii(e.toString))?JSON.stringify(e,k0,2):String(e),k0=(e,r)=>r&&r.__v_isRef?k0(e,r.value):tu(r)?{[`Map(${r.size})`]:[...r.entries()].reduce((a,[u,d],g)=>(a[If(u,g)+" =>"]=d,a),{})}:T0(r)?{[`Set(${r.size})`]:[...r.values()].map(a=>If(a))}:mu(r)?If(r):Ur(r)&&!_i(r)&&!A0(r)?String(r):r,If=(e,r="")=>{var a;return mu(e)?`Symbol(${(a=e.description)!=null?a:r})`:e};/**
* @vue/reactivity v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Ks;class L0{constructor(r=!1){this.detached=r,this._active=!0,this.effects=[],this.cleanups=[],this.parent=Ks,!r&&Ks&&(this.index=(Ks.scopes||(Ks.scopes=[])).push(this)-1)}get active(){return this._active}run(r){if(this._active){const a=Ks;try{return Ks=this,r()}finally{Ks=a}}}on(){Ks=this}off(){Ks=this.parent}stop(r){if(this._active){let a,u;for(a=0,u=this.effects.length;a<u;a++)this.effects[a].stop();for(a=0,u=this.cleanups.length;a<u;a++)this.cleanups[a]();if(this.scopes)for(a=0,u=this.scopes.length;a<u;a++)this.scopes[a].stop(!0);if(!this.detached&&this.parent&&!r){const d=this.parent.scopes.pop();d&&d!==this&&(this.parent.scopes[this.index]=d,d.index=this.index)}this.parent=void 0,this._active=!1}}}function R0(e){return new L0(e)}function nw(e,r=Ks){r&&r.active&&r.effects.push(e)}function z0(){return Ks}function sw(e){Ks&&Ks.cleanups.push(e)}let oc;class Pm{constructor(r,a,u,d){this.fn=r,this.trigger=a,this.scheduler=u,this.active=!0,this.deps=[],this._dirtyLevel=4,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,nw(this,d)}get dirty(){if(this._dirtyLevel===2||this._dirtyLevel===3){this._dirtyLevel=1,dc();for(let r=0;r<this._depsLength;r++){const a=this.deps[r];if(a.computed&&(aw(a.computed),this._dirtyLevel>=4))break}this._dirtyLevel===1&&(this._dirtyLevel=0),pc()}return this._dirtyLevel>=4}set dirty(r){this._dirtyLevel=r?4:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let r=vl,a=oc;try{return vl=!0,oc=this,this._runnings++,Uy(this),this.fn()}finally{Vy(this),this._runnings--,oc=a,vl=r}}stop(){var r;this.active&&(Uy(this),Vy(this),(r=this.onStop)==null||r.call(this),this.active=!1)}}function aw(e){return e.value}function Uy(e){e._trackId++,e._depsLength=0}function Vy(e){if(e.deps.length>e._depsLength){for(let r=e._depsLength;r<e.deps.length;r++)O0(e.deps[r],e);e.deps.length=e._depsLength}}function O0(e,r){const a=e.get(r);a!==void 0&&r._trackId!==a&&(e.delete(r),e.size===0&&e.cleanup())}let vl=!0,Yf=0;const F0=[];function dc(){F0.push(vl),vl=!1}function pc(){const e=F0.pop();vl=e===void 0?!0:e}function Dm(){Yf++}function km(){for(Yf--;!Yf&&Jf.length;)Jf.shift()()}function B0(e,r,a){if(r.get(e)!==e._trackId){r.set(e,e._trackId);const u=e.deps[e._depsLength];u!==r?(u&&O0(u,e),e.deps[e._depsLength++]=r):e._depsLength++}}const Jf=[];function N0(e,r,a){Dm();for(const u of e.keys()){let d;u._dirtyLevel<r&&(d??(d=e.get(u)===u._trackId))&&(u._shouldSchedule||(u._shouldSchedule=u._dirtyLevel===0),u._dirtyLevel=r),u._shouldSchedule&&(d??(d=e.get(u)===u._trackId))&&(u.trigger(),(!u._runnings||u.allowRecurse)&&u._dirtyLevel!==2&&(u._shouldSchedule=!1,u.scheduler&&Jf.push(u.scheduler)))}km()}const $0=(e,r)=>{const a=new Map;return a.cleanup=e,a.computed=r,a},Yd=new WeakMap,lc=Symbol(""),Qf=Symbol("");function Rs(e,r,a){if(vl&&oc){let u=Yd.get(e);u||Yd.set(e,u=new Map);let d=u.get(a);d||u.set(a,d=$0(()=>u.delete(a))),B0(oc,d)}}function Po(e,r,a,u,d,g){const m=Yd.get(e);if(!m)return;let l=[];if(r==="clear")l=[...m.values()];else if(a==="length"&&_i(e)){const M=Number(u);m.forEach((P,R)=>{(R==="length"||!mu(R)&&R>=M)&&l.push(P)})}else switch(a!==void 0&&l.push(m.get(a)),r){case"add":_i(e)?Im(a)&&l.push(m.get("length")):(l.push(m.get(lc)),tu(e)&&l.push(m.get(Qf)));break;case"delete":_i(e)||(l.push(m.get(lc)),tu(e)&&l.push(m.get(Qf)));break;case"set":tu(e)&&l.push(m.get(lc));break}Dm();for(const M of l)M&&N0(M,4);km()}function ow(e,r){var a;return(a=Yd.get(e))==null?void 0:a.get(r)}const lw=Em("__proto__,__v_isRef,__isVue"),U0=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(mu)),jy=cw();function cw(){const e={};return["includes","indexOf","lastIndexOf"].forEach(r=>{e[r]=function(...a){const u=Ki(this);for(let g=0,m=this.length;g<m;g++)Rs(u,"get",g+"");const d=u[r](...a);return d===-1||d===!1?u[r](...a.map(Ki)):d}}),["push","pop","shift","unshift","splice"].forEach(r=>{e[r]=function(...a){dc(),Dm();const u=Ki(this)[r].apply(this,a);return km(),pc(),u}}),e}function uw(e){const r=Ki(this);return Rs(r,"has",e),r.hasOwnProperty(e)}class V0{constructor(r=!1,a=!1){this._isReadonly=r,this._isShallow=a}get(r,a,u){const d=this._isReadonly,g=this._isShallow;if(a==="__v_isReactive")return!d;if(a==="__v_isReadonly")return d;if(a==="__v_isShallow")return g;if(a==="__v_raw")return u===(d?g?Mw:H0:g?G0:q0).get(r)||Object.getPrototypeOf(r)===Object.getPrototypeOf(u)?r:void 0;const m=_i(r);if(!d){if(m&&Xi(jy,a))return Reflect.get(jy,a,u);if(a==="hasOwnProperty")return uw}const l=Reflect.get(r,a,u);return(mu(a)?U0.has(a):lw(a))||(d||Rs(r,"get",a),g)?l:An(l)?m&&Im(a)?l:l.value:Ur(l)?d?W0(l):Bh(l):l}}class j0 extends V0{constructor(r=!1){super(!1,r)}set(r,a,u,d){let g=r[a];if(!this._isShallow){const M=au(g);if(!Jd(u)&&!au(u)&&(g=Ki(g),u=Ki(u)),!_i(r)&&An(g)&&!An(u))return M?!1:(g.value=u,!0)}const m=_i(r)&&Im(a)?Number(a)<r.length:Xi(r,a),l=Reflect.set(r,a,u,d);return r===Ki(d)&&(m?Ml(u,g)&&Po(r,"set",a,u):Po(r,"add",a,u)),l}deleteProperty(r,a){const u=Xi(r,a);r[a];const d=Reflect.deleteProperty(r,a);return d&&u&&Po(r,"delete",a,void 0),d}has(r,a){const u=Reflect.has(r,a);return(!mu(a)||!U0.has(a))&&Rs(r,"has",a),u}ownKeys(r){return Rs(r,"iterate",_i(r)?"length":lc),Reflect.ownKeys(r)}}class hw extends V0{constructor(r=!1){super(!0,r)}set(r,a){return!0}deleteProperty(r,a){return!0}}const dw=new j0,pw=new hw,fw=new j0(!0),Lm=e=>e,yp=e=>Reflect.getPrototypeOf(e);function Id(e,r,a=!1,u=!1){e=e.__v_raw;const d=Ki(e),g=Ki(r);a||(Ml(r,g)&&Rs(d,"get",r),Rs(d,"get",g));const{has:m}=yp(d),l=u?Lm:a?Om:Eh;if(m.call(d,r))return l(e.get(r));if(m.call(d,g))return l(e.get(g));e!==d&&e.get(r)}function Ad(e,r=!1){const a=this.__v_raw,u=Ki(a),d=Ki(e);return r||(Ml(e,d)&&Rs(u,"has",e),Rs(u,"has",d)),e===d?a.has(e):a.has(e)||a.has(d)}function Pd(e,r=!1){return e=e.__v_raw,!r&&Rs(Ki(e),"iterate",lc),Reflect.get(e,"size",e)}function qy(e){e=Ki(e);const r=Ki(this);return yp(r).has.call(r,e)||(r.add(e),Po(r,"add",e,e)),this}function Gy(e,r){r=Ki(r);const a=Ki(this),{has:u,get:d}=yp(a);let g=u.call(a,e);g||(e=Ki(e),g=u.call(a,e));const m=d.call(a,e);return a.set(e,r),g?Ml(r,m)&&Po(a,"set",e,r):Po(a,"add",e,r),this}function Hy(e){const r=Ki(this),{has:a,get:u}=yp(r);let d=a.call(r,e);d||(e=Ki(e),d=a.call(r,e)),u&&u.call(r,e);const g=r.delete(e);return d&&Po(r,"delete",e,void 0),g}function Zy(){const e=Ki(this),r=e.size!==0,a=e.clear();return r&&Po(e,"clear",void 0,void 0),a}function Dd(e,r){return function(u,d){const g=this,m=g.__v_raw,l=Ki(m),M=r?Lm:e?Om:Eh;return!e&&Rs(l,"iterate",lc),m.forEach((P,R)=>u.call(d,M(P),M(R),g))}}function kd(e,r,a){return function(...u){const d=this.__v_raw,g=Ki(d),m=tu(g),l=e==="entries"||e===Symbol.iterator&&m,M=e==="keys"&&m,P=d[e](...u),R=a?Lm:r?Om:Eh;return!r&&Rs(g,"iterate",M?Qf:lc),{next(){const{value:D,done:z}=P.next();return z?{value:D,done:z}:{value:l?[R(D[0]),R(D[1])]:R(D),done:z}},[Symbol.iterator](){return this}}}}function ul(e){return function(...r){return e==="delete"?!1:e==="clear"?void 0:this}}function mw(){const e={get(g){return Id(this,g)},get size(){return Pd(this)},has:Ad,add:qy,set:Gy,delete:Hy,clear:Zy,forEach:Dd(!1,!1)},r={get(g){return Id(this,g,!1,!0)},get size(){return Pd(this)},has:Ad,add:qy,set:Gy,delete:Hy,clear:Zy,forEach:Dd(!1,!0)},a={get(g){return Id(this,g,!0)},get size(){return Pd(this,!0)},has(g){return Ad.call(this,g,!0)},add:ul("add"),set:ul("set"),delete:ul("delete"),clear:ul("clear"),forEach:Dd(!0,!1)},u={get(g){return Id(this,g,!0,!0)},get size(){return Pd(this,!0)},has(g){return Ad.call(this,g,!0)},add:ul("add"),set:ul("set"),delete:ul("delete"),clear:ul("clear"),forEach:Dd(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(g=>{e[g]=kd(g,!1,!1),a[g]=kd(g,!0,!1),r[g]=kd(g,!1,!0),u[g]=kd(g,!0,!0)}),[e,a,r,u]}const[gw,yw,_w,vw]=mw();function Rm(e,r){const a=r?e?vw:_w:e?yw:gw;return(u,d,g)=>d==="__v_isReactive"?!e:d==="__v_isReadonly"?e:d==="__v_raw"?u:Reflect.get(Xi(a,d)&&d in u?a:u,d,g)}const xw={get:Rm(!1,!1)},bw={get:Rm(!1,!0)},ww={get:Rm(!0,!1)},q0=new WeakMap,G0=new WeakMap,H0=new WeakMap,Mw=new WeakMap;function Sw(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Ew(e){return e.__v_skip||!Object.isExtensible(e)?0:Sw(Xb(e))}function Bh(e){return au(e)?e:zm(e,!1,dw,xw,q0)}function Z0(e){return zm(e,!1,fw,bw,G0)}function W0(e){return zm(e,!0,pw,ww,H0)}function zm(e,r,a,u,d){if(!Ur(e)||e.__v_raw&&!(r&&e.__v_isReactive))return e;const g=d.get(e);if(g)return g;const m=Ew(e);if(m===0)return e;const l=new Proxy(e,m===2?u:a);return d.set(e,l),l}function xl(e){return au(e)?xl(e.__v_raw):!!(e&&e.__v_isReactive)}function au(e){return!!(e&&e.__v_isReadonly)}function Jd(e){return!!(e&&e.__v_isShallow)}function X0(e){return xl(e)||au(e)}function Ki(e){const r=e&&e.__v_raw;return r?Ki(r):e}function _p(e){return Object.isExtensible(e)&&Kd(e,"__v_skip",!0),e}const Eh=e=>Ur(e)?Bh(e):e,Om=e=>Ur(e)?W0(e):e;class K0{constructor(r,a,u,d){this.getter=r,this._setter=a,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this.effect=new Pm(()=>r(this._value),()=>Nd(this,this.effect._dirtyLevel===2?2:3)),this.effect.computed=this,this.effect.active=this._cacheable=!d,this.__v_isReadonly=u}get value(){const r=Ki(this);return(!r._cacheable||r.effect.dirty)&&Ml(r._value,r._value=r.effect.run())&&Nd(r,4),Y0(r),r.effect._dirtyLevel>=2&&Nd(r,2),r._value}set value(r){this._setter(r)}get _dirty(){return this.effect.dirty}set _dirty(r){this.effect.dirty=r}}function Tw(e,r,a=!1){let u,d;const g=Ii(e);return g?(u=e,d=fa):(u=e.get,d=e.set),new K0(u,d,g||!d,a)}function Y0(e){var r;vl&&oc&&(e=Ki(e),B0(oc,(r=e.dep)!=null?r:e.dep=$0(()=>e.dep=void 0,e instanceof K0?e:void 0)))}function Nd(e,r=4,a){e=Ki(e);const u=e.dep;u&&N0(u,r)}function An(e){return!!(e&&e.__v_isRef===!0)}function ks(e){return J0(e,!1)}function Cw(e){return J0(e,!0)}function J0(e,r){return An(e)?e:new Iw(e,r)}class Iw{constructor(r,a){this.__v_isShallow=a,this.dep=void 0,this.__v_isRef=!0,this._rawValue=a?r:Ki(r),this._value=a?r:Eh(r)}get value(){return Y0(this),this._value}set value(r){const a=this.__v_isShallow||Jd(r)||au(r);r=a?r:Ki(r),Ml(r,this._rawValue)&&(this._rawValue=r,this._value=a?r:Eh(r),Nd(this,4))}}function Fi(e){return An(e)?e.value:e}const Aw={get:(e,r,a)=>Fi(Reflect.get(e,r,a)),set:(e,r,a,u)=>{const d=e[r];return An(d)&&!An(a)?(d.value=a,!0):Reflect.set(e,r,a,u)}};function Q0(e){return xl(e)?e:new Proxy(e,Aw)}function Pw(e){const r=_i(e)?new Array(e.length):{};for(const a in e)r[a]=kw(e,a);return r}class Dw{constructor(r,a,u){this._object=r,this._key=a,this._defaultValue=u,this.__v_isRef=!0}get value(){const r=this._object[this._key];return r===void 0?this._defaultValue:r}set value(r){this._object[this._key]=r}get dep(){return ow(Ki(this._object),this._key)}}function kw(e,r,a){const u=e[r];return An(u)?u:new Dw(e,r,a)}/**
* @vue/runtime-core v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function bl(e,r,a,u){try{return u?e(...u):e()}catch(d){vp(d,r,a)}}function za(e,r,a,u){if(Ii(e)){const g=bl(e,r,a,u);return g&&C0(g)&&g.catch(m=>{vp(m,r,a)}),g}const d=[];for(let g=0;g<e.length;g++)d.push(za(e[g],r,a,u));return d}function vp(e,r,a,u=!0){const d=r?r.vnode:null;if(r){let g=r.parent;const m=r.proxy,l=`https://vuejs.org/error-reference/#runtime-${a}`;for(;g;){const P=g.ec;if(P){for(let R=0;R<P.length;R++)if(P[R](e,m,l)===!1)return}g=g.parent}const M=r.appContext.config.errorHandler;if(M){bl(M,null,10,[e,m,l]);return}}Lw(e,a,d,u)}function Lw(e,r,a,u=!0){console.error(e)}let Th=!1,em=!1;const ns=[];let to=0;const iu=[];let ml=null,sc=0;const ev=Promise.resolve();let Fm=null;function Bm(e){const r=Fm||ev;return e?r.then(this?e.bind(this):e):r}function Rw(e){let r=to+1,a=ns.length;for(;r<a;){const u=r+a>>>1,d=ns[u],g=Ch(d);g<e||g===e&&d.pre?r=u+1:a=u}return r}function Nm(e){(!ns.length||!ns.includes(e,Th&&e.allowRecurse?to+1:to))&&(e.id==null?ns.push(e):ns.splice(Rw(e.id),0,e),tv())}function tv(){!Th&&!em&&(em=!0,Fm=ev.then(rv))}function zw(e){const r=ns.indexOf(e);r>to&&ns.splice(r,1)}function Ow(e){_i(e)?iu.push(...e):(!ml||!ml.includes(e,e.allowRecurse?sc+1:sc))&&iu.push(e),tv()}function Wy(e,r,a=Th?to+1:0){for(;a<ns.length;a++){const u=ns[a];if(u&&u.pre){if(e&&u.id!==e.uid)continue;ns.splice(a,1),a--,u()}}}function iv(e){if(iu.length){const r=[...new Set(iu)].sort((a,u)=>Ch(a)-Ch(u));if(iu.length=0,ml){ml.push(...r);return}for(ml=r,sc=0;sc<ml.length;sc++)ml[sc]();ml=null,sc=0}}const Ch=e=>e.id==null?1/0:e.id,Fw=(e,r)=>{const a=Ch(e)-Ch(r);if(a===0){if(e.pre&&!r.pre)return-1;if(r.pre&&!e.pre)return 1}return a};function rv(e){em=!1,Th=!0,ns.sort(Fw);try{for(to=0;to<ns.length;to++){const r=ns[to];r&&r.active!==!1&&bl(r,null,14)}}finally{to=0,ns.length=0,iv(),Th=!1,Fm=null,(ns.length||iu.length)&&rv()}}function Bw(e,r,...a){if(e.isUnmounted)return;const u=e.vnode.props||Fr;let d=a;const g=r.startsWith("update:"),m=g&&r.slice(7);if(m&&m in u){const R=`${m==="modelValue"?"model":m}Modifiers`,{number:D,trim:z}=u[R]||Fr;z&&(d=a.map(Z=>In(Z)?Z.trim():Z)),D&&(d=a.map(Kf))}let l,M=u[l=Cf(r)]||u[l=Cf(so(r))];!M&&g&&(M=u[l=Cf(hc(r))]),M&&za(M,e,6,d);const P=u[l+"Once"];if(P){if(!e.emitted)e.emitted={};else if(e.emitted[l])return;e.emitted[l]=!0,za(P,e,6,d)}}function nv(e,r,a=!1){const u=r.emitsCache,d=u.get(e);if(d!==void 0)return d;const g=e.emits;let m={},l=!1;if(!Ii(e)){const M=P=>{const R=nv(P,r,!0);R&&(l=!0,jn(m,R))};!a&&r.mixins.length&&r.mixins.forEach(M),e.extends&&M(e.extends),e.mixins&&e.mixins.forEach(M)}return!g&&!l?(Ur(e)&&u.set(e,null),null):(_i(g)?g.forEach(M=>m[M]=null):jn(m,g),Ur(e)&&u.set(e,m),m)}function xp(e,r){return!e||!pp(r)?!1:(r=r.slice(2).replace(/Once$/,""),Xi(e,r[0].toLowerCase()+r.slice(1))||Xi(e,hc(r))||Xi(e,r))}let Cn=null,bp=null;function Qd(e){const r=Cn;return Cn=e,bp=e&&e.type.__scopeId||null,r}function Nh(e){bp=e}function $h(){bp=null}function Ao(e,r=Cn,a){if(!r||e._n)return e;const u=(...d)=>{u._d&&s_(-1);const g=Qd(r);let m;try{m=e(...d)}finally{Qd(g),u._d&&s_(1)}return m};return u._n=!0,u._c=!0,u._d=!0,u}function Af(e){const{type:r,vnode:a,proxy:u,withProxy:d,props:g,propsOptions:[m],slots:l,attrs:M,emit:P,render:R,renderCache:D,data:z,setupState:Z,ctx:W,inheritAttrs:J}=e;let me,xe;const Pe=Qd(e);try{if(a.shapeFlag&4){const Le=d||u,Ze=Le;me=eo(R.call(Ze,Le,D,g,Z,z,W)),xe=M}else{const Le=r;me=eo(Le.length>1?Le(g,{attrs:M,slots:l,emit:P}):Le(g,null)),xe=r.props?M:Nw(M)}}catch(Le){gh.length=0,vp(Le,e,1),me=rr(Sl)}let oe=me;if(xe&&J!==!1){const Le=Object.keys(xe),{shapeFlag:Ze}=oe;Le.length&&Ze&7&&(m&&Le.some(Tm)&&(xe=$w(xe,m)),oe=ou(oe,xe))}return a.dirs&&(oe=ou(oe),oe.dirs=oe.dirs?oe.dirs.concat(a.dirs):a.dirs),a.transition&&(oe.transition=a.transition),me=oe,Qd(Pe),me}const Nw=e=>{let r;for(const a in e)(a==="class"||a==="style"||pp(a))&&((r||(r={}))[a]=e[a]);return r},$w=(e,r)=>{const a={};for(const u in e)(!Tm(u)||!(u.slice(9)in r))&&(a[u]=e[u]);return a};function Uw(e,r,a){const{props:u,children:d,component:g}=e,{props:m,children:l,patchFlag:M}=r,P=g.emitsOptions;if(r.dirs||r.transition)return!0;if(a&&M>=0){if(M&1024)return!0;if(M&16)return u?Xy(u,m,P):!!m;if(M&8){const R=r.dynamicProps;for(let D=0;D<R.length;D++){const z=R[D];if(m[z]!==u[z]&&!xp(P,z))return!0}}}else return(d||l)&&(!l||!l.$stable)?!0:u===m?!1:u?m?Xy(u,m,P):!0:!!m;return!1}function Xy(e,r,a){const u=Object.keys(r);if(u.length!==Object.keys(e).length)return!0;for(let d=0;d<u.length;d++){const g=u[d];if(r[g]!==e[g]&&!xp(a,g))return!0}return!1}function Vw({vnode:e,parent:r},a){for(;r;){const u=r.subTree;if(u.suspense&&u.suspense.activeBranch===e&&(u.el=e.el),u===e)(e=r.vnode).el=a,r=r.parent;else break}}const sv="components";function Vz(e,r){return qw(sv,e,!0,r)||e}const jw=Symbol.for("v-ndc");function qw(e,r,a=!0,u=!1){const d=Cn||Vn;if(d){const g=d.type;if(e===sv){const l=B2(g,!1);if(l&&(l===r||l===so(r)||l===gp(so(r))))return g}const m=Ky(d[e]||g[e],r)||Ky(d.appContext[e],r);return!m&&u?g:m}}function Ky(e,r){return e&&(e[r]||e[so(r)]||e[gp(so(r))])}const Gw=e=>e.__isSuspense;function Hw(e,r){r&&r.pendingBranch?_i(e)?r.effects.push(...e):r.effects.push(e):Ow(e)}const Zw=Symbol.for("v-scx"),Ww=()=>ma(Zw),Ld={};function rs(e,r,a){return av(e,r,a)}function av(e,r,{immediate:a,deep:u,flush:d,once:g,onTrack:m,onTrigger:l}=Fr){if(r&&g){const Ke=r;r=(...dt)=>{Ke(...dt),Ze()}}const M=Vn,P=Ke=>u===!0?Ke:ac(Ke,u===!1?1:void 0);let R,D=!1,z=!1;if(An(e)?(R=()=>e.value,D=Jd(e)):xl(e)?(R=()=>P(e),D=!0):_i(e)?(z=!0,D=e.some(Ke=>xl(Ke)||Jd(Ke)),R=()=>e.map(Ke=>{if(An(Ke))return Ke.value;if(xl(Ke))return P(Ke);if(Ii(Ke))return bl(Ke,M,2)})):Ii(e)?r?R=()=>bl(e,M,2):R=()=>(Z&&Z(),za(e,M,3,[W])):R=fa,r&&u){const Ke=R;R=()=>ac(Ke())}let Z,W=Ke=>{Z=oe.onStop=()=>{bl(Ke,M,4),Z=oe.onStop=void 0}},J;if(Ep)if(W=fa,r?a&&za(r,M,3,[R(),z?[]:void 0,W]):R(),d==="sync"){const Ke=Ww();J=Ke.__watcherHandles||(Ke.__watcherHandles=[])}else return fa;let me=z?new Array(e.length).fill(Ld):Ld;const xe=()=>{if(!(!oe.active||!oe.dirty))if(r){const Ke=oe.run();(u||D||(z?Ke.some((dt,bt)=>Ml(dt,me[bt])):Ml(Ke,me)))&&(Z&&Z(),za(r,M,3,[Ke,me===Ld?void 0:z&&me[0]===Ld?[]:me,W]),me=Ke)}else oe.run()};xe.allowRecurse=!!r;let Pe;d==="sync"?Pe=xe:d==="post"?Pe=()=>Ds(xe,M&&M.suspense):(xe.pre=!0,M&&(xe.id=M.uid),Pe=()=>Nm(xe));const oe=new Pm(R,fa,Pe),Le=z0(),Ze=()=>{oe.stop(),Le&&Cm(Le.effects,oe)};return r?a?xe():me=oe.run():d==="post"?Ds(oe.run.bind(oe),M&&M.suspense):oe.run(),J&&J.push(Ze),Ze}function Xw(e,r,a){const u=this.proxy,d=In(e)?e.includes(".")?ov(u,e):()=>u[e]:e.bind(u,u);let g;Ii(r)?g=r:(g=r.handler,a=r);const m=Vh(this),l=av(d,g.bind(u),a);return m(),l}function ov(e,r){const a=r.split(".");return()=>{let u=e;for(let d=0;d<a.length&&u;d++)u=u[a[d]];return u}}function ac(e,r,a=0,u){if(!Ur(e)||e.__v_skip)return e;if(r&&r>0){if(a>=r)return e;a++}if(u=u||new Set,u.has(e))return e;if(u.add(e),An(e))ac(e.value,r,a,u);else if(_i(e))for(let d=0;d<e.length;d++)ac(e[d],r,a,u);else if(T0(e)||tu(e))e.forEach(d=>{ac(d,r,a,u)});else if(A0(e))for(const d in e)ac(e[d],r,a,u);return e}function lv(e,r){if(Cn===null)return e;const a=Tp(Cn)||Cn.proxy,u=e.dirs||(e.dirs=[]);for(let d=0;d<r.length;d++){let[g,m,l,M=Fr]=r[d];g&&(Ii(g)&&(g={mounted:g,updated:g}),g.deep&&ac(m),u.push({dir:g,instance:a,value:m,oldValue:void 0,arg:l,modifiers:M}))}return e}function ec(e,r,a,u){const d=e.dirs,g=r&&r.dirs;for(let m=0;m<d.length;m++){const l=d[m];g&&(l.oldValue=g[m].value);let M=l.dir[u];M&&(dc(),za(M,a,8,[e.el,l,e,r]),pc())}}/*! #__NO_SIDE_EFFECTS__ */function cv(e,r){return Ii(e)?jn({name:e.name},r,{setup:e}):e}const fh=e=>!!e.type.__asyncLoader,uv=e=>e.type.__isKeepAlive;function Kw(e,r){hv(e,"a",r)}function Yw(e,r){hv(e,"da",r)}function hv(e,r,a=Vn){const u=e.__wdc||(e.__wdc=()=>{let d=a;for(;d;){if(d.isDeactivated)return;d=d.parent}return e()});if(wp(r,u,a),a){let d=a.parent;for(;d&&d.parent;)uv(d.parent.vnode)&&Jw(u,r,a,d),d=d.parent}}function Jw(e,r,a,u){const d=wp(r,e,u,!0);dv(()=>{Cm(u[r],d)},a)}function wp(e,r,a=Vn,u=!1){if(a){const d=a[e]||(a[e]=[]),g=r.__weh||(r.__weh=(...m)=>{if(a.isUnmounted)return;dc();const l=Vh(a),M=za(r,a,e,m);return l(),pc(),M});return u?d.unshift(g):d.push(g),g}}const ko=e=>(r,a=Vn)=>(!Ep||e==="sp")&&wp(e,(...u)=>r(...u),a),$m=ko("bm"),Uh=ko("m"),Qw=ko("bu"),e2=ko("u"),t2=ko("bum"),dv=ko("um"),i2=ko("sp"),r2=ko("rtg"),n2=ko("rtc");function s2(e,r=Vn){wp("ec",e,r)}function Ls(e,r,a,u){let d;const g=a&&a[u];if(_i(e)||In(e)){d=new Array(e.length);for(let m=0,l=e.length;m<l;m++)d[m]=r(e[m],m,void 0,g&&g[m])}else if(typeof e=="number"){d=new Array(e);for(let m=0;m<e;m++)d[m]=r(m+1,m,void 0,g&&g[m])}else if(Ur(e))if(e[Symbol.iterator])d=Array.from(e,(m,l)=>r(m,l,void 0,g&&g[l]));else{const m=Object.keys(e);d=new Array(m.length);for(let l=0,M=m.length;l<M;l++){const P=m[l];d[l]=r(e[P],P,l,g&&g[l])}}else d=[];return a&&(a[u]=d),d}function a2(e,r,a={},u,d){if(Cn.isCE||Cn.parent&&fh(Cn.parent)&&Cn.parent.isCE)return r!=="default"&&(a.name=r),rr("slot",a,u&&u());let g=e[r];g&&g._c&&(g._d=!1),It();const m=g&&pv(g(a)),l=da(Mr,{key:a.key||m&&m.key||`_${r}`},m||(u?u():[]),m&&e._===1?64:-2);return!d&&l.scopeId&&(l.slotScopeIds=[l.scopeId+"-s"]),g&&g._c&&(g._d=!0),l}function pv(e){return e.some(r=>tp(r)?!(r.type===Sl||r.type===Mr&&!pv(r.children)):!0)?e:null}const tm=e=>e?Ev(e)?Tp(e)||e.proxy:tm(e.parent):null,mh=jn(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>tm(e.parent),$root:e=>tm(e.root),$emit:e=>e.emit,$options:e=>Um(e),$forceUpdate:e=>e.f||(e.f=()=>{e.effect.dirty=!0,Nm(e.update)}),$nextTick:e=>e.n||(e.n=Bm.bind(e.proxy)),$watch:e=>Xw.bind(e)}),Pf=(e,r)=>e!==Fr&&!e.__isScriptSetup&&Xi(e,r),o2={get({_:e},r){const{ctx:a,setupState:u,data:d,props:g,accessCache:m,type:l,appContext:M}=e;let P;if(r[0]!=="$"){const Z=m[r];if(Z!==void 0)switch(Z){case 1:return u[r];case 2:return d[r];case 4:return a[r];case 3:return g[r]}else{if(Pf(u,r))return m[r]=1,u[r];if(d!==Fr&&Xi(d,r))return m[r]=2,d[r];if((P=e.propsOptions[0])&&Xi(P,r))return m[r]=3,g[r];if(a!==Fr&&Xi(a,r))return m[r]=4,a[r];im&&(m[r]=0)}}const R=mh[r];let D,z;if(R)return r==="$attrs"&&Rs(e,"get",r),R(e);if((D=l.__cssModules)&&(D=D[r]))return D;if(a!==Fr&&Xi(a,r))return m[r]=4,a[r];if(z=M.config.globalProperties,Xi(z,r))return z[r]},set({_:e},r,a){const{data:u,setupState:d,ctx:g}=e;return Pf(d,r)?(d[r]=a,!0):u!==Fr&&Xi(u,r)?(u[r]=a,!0):Xi(e.props,r)||r[0]==="$"&&r.slice(1)in e?!1:(g[r]=a,!0)},has({_:{data:e,setupState:r,accessCache:a,ctx:u,appContext:d,propsOptions:g}},m){let l;return!!a[m]||e!==Fr&&Xi(e,m)||Pf(r,m)||(l=g[0])&&Xi(l,m)||Xi(u,m)||Xi(mh,m)||Xi(d.config.globalProperties,m)},defineProperty(e,r,a){return a.get!=null?e._.accessCache[r]=0:Xi(a,"value")&&this.set(e,r,a.value,null),Reflect.defineProperty(e,r,a)}};function Yy(e){return _i(e)?e.reduce((r,a)=>(r[a]=null,r),{}):e}let im=!0;function l2(e){const r=Um(e),a=e.proxy,u=e.ctx;im=!1,r.beforeCreate&&Jy(r.beforeCreate,e,"bc");const{data:d,computed:g,methods:m,watch:l,provide:M,inject:P,created:R,beforeMount:D,mounted:z,beforeUpdate:Z,updated:W,activated:J,deactivated:me,beforeDestroy:xe,beforeUnmount:Pe,destroyed:oe,unmounted:Le,render:Ze,renderTracked:Ke,renderTriggered:dt,errorCaptured:bt,serverPrefetch:Pt,expose:Ht,inheritAttrs:Rt,components:li,directives:ct,filters:zt}=r;if(P&&c2(P,u,null),m)for(const ii in m){const hi=m[ii];Ii(hi)&&(u[ii]=hi.bind(a))}if(d){const ii=d.call(a,a);Ur(ii)&&(e.data=Bh(ii))}if(im=!0,g)for(const ii in g){const hi=g[ii],Mi=Ii(hi)?hi.bind(a,a):Ii(hi.get)?hi.get.bind(a,a):fa,yr=!Ii(hi)&&Ii(hi.set)?hi.set.bind(a):fa,at=gi({get:Mi,set:yr});Object.defineProperty(u,ii,{enumerable:!0,configurable:!0,get:()=>at.value,set:tt=>at.value=tt})}if(l)for(const ii in l)fv(l[ii],u,a,ii);if(M){const ii=Ii(M)?M.call(a):M;Reflect.ownKeys(ii).forEach(hi=>{$d(hi,ii[hi])})}R&&Jy(R,e,"c");function ti(ii,hi){_i(hi)?hi.forEach(Mi=>ii(Mi.bind(a))):hi&&ii(hi.bind(a))}if(ti($m,D),ti(Uh,z),ti(Qw,Z),ti(e2,W),ti(Kw,J),ti(Yw,me),ti(s2,bt),ti(n2,Ke),ti(r2,dt),ti(t2,Pe),ti(dv,Le),ti(i2,Pt),_i(Ht))if(Ht.length){const ii=e.exposed||(e.exposed={});Ht.forEach(hi=>{Object.defineProperty(ii,hi,{get:()=>a[hi],set:Mi=>a[hi]=Mi})})}else e.exposed||(e.exposed={});Ze&&e.render===fa&&(e.render=Ze),Rt!=null&&(e.inheritAttrs=Rt),li&&(e.components=li),ct&&(e.directives=ct)}function c2(e,r,a=fa){_i(e)&&(e=rm(e));for(const u in e){const d=e[u];let g;Ur(d)?"default"in d?g=ma(d.from||u,d.default,!0):g=ma(d.from||u):g=ma(d),An(g)?Object.defineProperty(r,u,{enumerable:!0,configurable:!0,get:()=>g.value,set:m=>g.value=m}):r[u]=g}}function Jy(e,r,a){za(_i(e)?e.map(u=>u.bind(r.proxy)):e.bind(r.proxy),r,a)}function fv(e,r,a,u){const d=u.includes(".")?ov(a,u):()=>a[u];if(In(e)){const g=r[e];Ii(g)&&rs(d,g)}else if(Ii(e))rs(d,e.bind(a));else if(Ur(e))if(_i(e))e.forEach(g=>fv(g,r,a,u));else{const g=Ii(e.handler)?e.handler.bind(a):r[e.handler];Ii(g)&&rs(d,g,e)}}function Um(e){const r=e.type,{mixins:a,extends:u}=r,{mixins:d,optionsCache:g,config:{optionMergeStrategies:m}}=e.appContext,l=g.get(r);let M;return l?M=l:!d.length&&!a&&!u?M=r:(M={},d.length&&d.forEach(P=>ep(M,P,m,!0)),ep(M,r,m)),Ur(r)&&g.set(r,M),M}function ep(e,r,a,u=!1){const{mixins:d,extends:g}=r;g&&ep(e,g,a,!0),d&&d.forEach(m=>ep(e,m,a,!0));for(const m in r)if(!(u&&m==="expose")){const l=u2[m]||a&&a[m];e[m]=l?l(e[m],r[m]):r[m]}return e}const u2={data:Qy,props:e_,emits:e_,methods:ch,computed:ch,beforeCreate:ms,created:ms,beforeMount:ms,mounted:ms,beforeUpdate:ms,updated:ms,beforeDestroy:ms,beforeUnmount:ms,destroyed:ms,unmounted:ms,activated:ms,deactivated:ms,errorCaptured:ms,serverPrefetch:ms,components:ch,directives:ch,watch:d2,provide:Qy,inject:h2};function Qy(e,r){return r?e?function(){return jn(Ii(e)?e.call(this,this):e,Ii(r)?r.call(this,this):r)}:r:e}function h2(e,r){return ch(rm(e),rm(r))}function rm(e){if(_i(e)){const r={};for(let a=0;a<e.length;a++)r[e[a]]=e[a];return r}return e}function ms(e,r){return e?[...new Set([].concat(e,r))]:r}function ch(e,r){return e?jn(Object.create(null),e,r):r}function e_(e,r){return e?_i(e)&&_i(r)?[...new Set([...e,...r])]:jn(Object.create(null),Yy(e),Yy(r??{})):r}function d2(e,r){if(!e)return r;if(!r)return e;const a=jn(Object.create(null),e);for(const u in r)a[u]=ms(e[u],r[u]);return a}function mv(){return{app:null,config:{isNativeTag:Zb,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let p2=0;function f2(e,r){return function(u,d=null){Ii(u)||(u=jn({},u)),d!=null&&!Ur(d)&&(d=null);const g=mv(),m=new WeakSet;let l=!1;const M=g.app={_uid:p2++,_component:u,_props:d,_container:null,_context:g,_instance:null,version:$2,get config(){return g.config},set config(P){},use(P,...R){return m.has(P)||(P&&Ii(P.install)?(m.add(P),P.install(M,...R)):Ii(P)&&(m.add(P),P(M,...R))),M},mixin(P){return g.mixins.includes(P)||g.mixins.push(P),M},component(P,R){return R?(g.components[P]=R,M):g.components[P]},directive(P,R){return R?(g.directives[P]=R,M):g.directives[P]},mount(P,R,D){if(!l){const z=rr(u,d);return z.appContext=g,D===!0?D="svg":D===!1&&(D=void 0),R&&r?r(z,P):e(z,P,D),l=!0,M._container=P,P.__vue_app__=M,Tp(z.component)||z.component.proxy}},unmount(){l&&(e(null,M._container),delete M._container.__vue_app__)},provide(P,R){return g.provides[P]=R,M},runWithContext(P){const R=ru;ru=M;try{return P()}finally{ru=R}}};return M}}let ru=null;function $d(e,r){if(Vn){let a=Vn.provides;const u=Vn.parent&&Vn.parent.provides;u===a&&(a=Vn.provides=Object.create(u)),a[e]=r}}function ma(e,r,a=!1){const u=Vn||Cn;if(u||ru){const d=u?u.parent==null?u.vnode.appContext&&u.vnode.appContext.provides:u.parent.provides:ru._context.provides;if(d&&e in d)return d[e];if(arguments.length>1)return a&&Ii(r)?r.call(u&&u.proxy):r}}function m2(){return!!(Vn||Cn||ru)}function g2(e,r,a,u=!1){const d={},g={};Kd(g,Sp,1),e.propsDefaults=Object.create(null),gv(e,r,d,g);for(const m in e.propsOptions[0])m in d||(d[m]=void 0);a?e.props=u?d:Z0(d):e.type.props?e.props=d:e.props=g,e.attrs=g}function y2(e,r,a,u){const{props:d,attrs:g,vnode:{patchFlag:m}}=e,l=Ki(d),[M]=e.propsOptions;let P=!1;if((u||m>0)&&!(m&16)){if(m&8){const R=e.vnode.dynamicProps;for(let D=0;D<R.length;D++){let z=R[D];if(xp(e.emitsOptions,z))continue;const Z=r[z];if(M)if(Xi(g,z))Z!==g[z]&&(g[z]=Z,P=!0);else{const W=so(z);d[W]=nm(M,l,W,Z,e,!1)}else Z!==g[z]&&(g[z]=Z,P=!0)}}}else{gv(e,r,d,g)&&(P=!0);let R;for(const D in l)(!r||!Xi(r,D)&&((R=hc(D))===D||!Xi(r,R)))&&(M?a&&(a[D]!==void 0||a[R]!==void 0)&&(d[D]=nm(M,l,D,void 0,e,!0)):delete d[D]);if(g!==l)for(const D in g)(!r||!Xi(r,D))&&(delete g[D],P=!0)}P&&Po(e,"set","$attrs")}function gv(e,r,a,u){const[d,g]=e.propsOptions;let m=!1,l;if(r)for(let M in r){if(ph(M))continue;const P=r[M];let R;d&&Xi(d,R=so(M))?!g||!g.includes(R)?a[R]=P:(l||(l={}))[R]=P:xp(e.emitsOptions,M)||(!(M in u)||P!==u[M])&&(u[M]=P,m=!0)}if(g){const M=Ki(a),P=l||Fr;for(let R=0;R<g.length;R++){const D=g[R];a[D]=nm(d,M,D,P[D],e,!Xi(P,D))}}return m}function nm(e,r,a,u,d,g){const m=e[a];if(m!=null){const l=Xi(m,"default");if(l&&u===void 0){const M=m.default;if(m.type!==Function&&!m.skipFactory&&Ii(M)){const{propsDefaults:P}=d;if(a in P)u=P[a];else{const R=Vh(d);u=P[a]=M.call(null,r),R()}}else u=M}m[0]&&(g&&!l?u=!1:m[1]&&(u===""||u===hc(a))&&(u=!0))}return u}function yv(e,r,a=!1){const u=r.propsCache,d=u.get(e);if(d)return d;const g=e.props,m={},l=[];let M=!1;if(!Ii(e)){const R=D=>{M=!0;const[z,Z]=yv(D,r,!0);jn(m,z),Z&&l.push(...Z)};!a&&r.mixins.length&&r.mixins.forEach(R),e.extends&&R(e.extends),e.mixins&&e.mixins.forEach(R)}if(!g&&!M)return Ur(e)&&u.set(e,eu),eu;if(_i(g))for(let R=0;R<g.length;R++){const D=so(g[R]);t_(D)&&(m[D]=Fr)}else if(g)for(const R in g){const D=so(R);if(t_(D)){const z=g[R],Z=m[D]=_i(z)||Ii(z)?{type:z}:jn({},z);if(Z){const W=n_(Boolean,Z.type),J=n_(String,Z.type);Z[0]=W>-1,Z[1]=J<0||W<J,(W>-1||Xi(Z,"default"))&&l.push(D)}}}const P=[m,l];return Ur(e)&&u.set(e,P),P}function t_(e){return e[0]!=="$"&&!ph(e)}function i_(e){return e===null?"null":typeof e=="function"?e.name||"":typeof e=="object"&&e.constructor&&e.constructor.name||""}function r_(e,r){return i_(e)===i_(r)}function n_(e,r){return _i(r)?r.findIndex(a=>r_(a,e)):Ii(r)&&r_(r,e)?0:-1}const _v=e=>e[0]==="_"||e==="$stable",Vm=e=>_i(e)?e.map(eo):[eo(e)],_2=(e,r,a)=>{if(r._n)return r;const u=Ao((...d)=>Vm(r(...d)),a);return u._c=!1,u},vv=(e,r,a)=>{const u=e._ctx;for(const d in e){if(_v(d))continue;const g=e[d];if(Ii(g))r[d]=_2(d,g,u);else if(g!=null){const m=Vm(g);r[d]=()=>m}}},xv=(e,r)=>{const a=Vm(r);e.slots.default=()=>a},v2=(e,r)=>{if(e.vnode.shapeFlag&32){const a=r._;a?(e.slots=Ki(r),Kd(r,"_",a)):vv(r,e.slots={})}else e.slots={},r&&xv(e,r);Kd(e.slots,Sp,1)},x2=(e,r,a)=>{const{vnode:u,slots:d}=e;let g=!0,m=Fr;if(u.shapeFlag&32){const l=r._;l?a&&l===1?g=!1:(jn(d,r),!a&&l===1&&delete d._):(g=!r.$stable,vv(r,d)),m=r}else r&&(xv(e,r),m={default:1});if(g)for(const l in d)!_v(l)&&m[l]==null&&delete d[l]};function sm(e,r,a,u,d=!1){if(_i(e)){e.forEach((z,Z)=>sm(z,r&&(_i(r)?r[Z]:r),a,u,d));return}if(fh(u)&&!d)return;const g=u.shapeFlag&4?Tp(u.component)||u.component.proxy:u.el,m=d?null:g,{i:l,r:M}=e,P=r&&r.r,R=l.refs===Fr?l.refs={}:l.refs,D=l.setupState;if(P!=null&&P!==M&&(In(P)?(R[P]=null,Xi(D,P)&&(D[P]=null)):An(P)&&(P.value=null)),Ii(M))bl(M,l,12,[m,R]);else{const z=In(M),Z=An(M);if(z||Z){const W=()=>{if(e.f){const J=z?Xi(D,M)?D[M]:R[M]:M.value;d?_i(J)&&Cm(J,g):_i(J)?J.includes(g)||J.push(g):z?(R[M]=[g],Xi(D,M)&&(D[M]=R[M])):(M.value=[g],e.k&&(R[e.k]=M.value))}else z?(R[M]=m,Xi(D,M)&&(D[M]=m)):Z&&(M.value=m,e.k&&(R[e.k]=m))};m?(W.id=-1,Ds(W,a)):W()}}}const Ds=Hw;function b2(e){return w2(e)}function w2(e,r){const a=P0();a.__VUE__=!0;const{insert:u,remove:d,patchProp:g,createElement:m,createText:l,createComment:M,setText:P,setElementText:R,parentNode:D,nextSibling:z,setScopeId:Z=fa,insertStaticContent:W}=e,J=(se,ue,De,Fe=null,ce=null,pt=null,At=void 0,Be=null,rt=!!ue.dynamicChildren)=>{if(se===ue)return;se&&!th(se,ue)&&(Fe=Ve(se),tt(se,ce,pt,!0),se=null),ue.patchFlag===-2&&(rt=!1,ue.dynamicChildren=null);const{type:it,ref:Dt,shapeFlag:Xt}=ue;switch(it){case Mp:me(se,ue,De,Fe);break;case Sl:xe(se,ue,De,Fe);break;case Ud:se==null&&Pe(ue,De,Fe,At);break;case Mr:li(se,ue,De,Fe,ce,pt,At,Be,rt);break;default:Xt&1?Ze(se,ue,De,Fe,ce,pt,At,Be,rt):Xt&6?ct(se,ue,De,Fe,ce,pt,At,Be,rt):(Xt&64||Xt&128)&&it.process(se,ue,De,Fe,ce,pt,At,Be,rt,Qe)}Dt!=null&&ce&&sm(Dt,se&&se.ref,pt,ue||se,!ue)},me=(se,ue,De,Fe)=>{if(se==null)u(ue.el=l(ue.children),De,Fe);else{const ce=ue.el=se.el;ue.children!==se.children&&P(ce,ue.children)}},xe=(se,ue,De,Fe)=>{se==null?u(ue.el=M(ue.children||""),De,Fe):ue.el=se.el},Pe=(se,ue,De,Fe)=>{[se.el,se.anchor]=W(se.children,ue,De,Fe,se.el,se.anchor)},oe=({el:se,anchor:ue},De,Fe)=>{let ce;for(;se&&se!==ue;)ce=z(se),u(se,De,Fe),se=ce;u(ue,De,Fe)},Le=({el:se,anchor:ue})=>{let De;for(;se&&se!==ue;)De=z(se),d(se),se=De;d(ue)},Ze=(se,ue,De,Fe,ce,pt,At,Be,rt)=>{ue.type==="svg"?At="svg":ue.type==="math"&&(At="mathml"),se==null?Ke(ue,De,Fe,ce,pt,At,Be,rt):Pt(se,ue,ce,pt,At,Be,rt)},Ke=(se,ue,De,Fe,ce,pt,At,Be)=>{let rt,it;const{props:Dt,shapeFlag:Xt,transition:Zt,dirs:Yt}=se;if(rt=se.el=m(se.type,pt,Dt&&Dt.is,Dt),Xt&8?R(rt,se.children):Xt&16&&bt(se.children,rt,null,Fe,ce,Df(se,pt),At,Be),Yt&&ec(se,null,Fe,"created"),dt(rt,se,se.scopeId,At,Fe),Dt){for(const Ti in Dt)Ti!=="value"&&!ph(Ti)&&g(rt,Ti,null,Dt[Ti],pt,se.children,Fe,ce,Si);"value"in Dt&&g(rt,"value",null,Dt.value,pt),(it=Dt.onVnodeBeforeMount)&&Ja(it,Fe,se)}Yt&&ec(se,null,Fe,"beforeMount");const yi=M2(ce,Zt);yi&&Zt.beforeEnter(rt),u(rt,ue,De),((it=Dt&&Dt.onVnodeMounted)||yi||Yt)&&Ds(()=>{it&&Ja(it,Fe,se),yi&&Zt.enter(rt),Yt&&ec(se,null,Fe,"mounted")},ce)},dt=(se,ue,De,Fe,ce)=>{if(De&&Z(se,De),Fe)for(let pt=0;pt<Fe.length;pt++)Z(se,Fe[pt]);if(ce){let pt=ce.subTree;if(ue===pt){const At=ce.vnode;dt(se,At,At.scopeId,At.slotScopeIds,ce.parent)}}},bt=(se,ue,De,Fe,ce,pt,At,Be,rt=0)=>{for(let it=rt;it<se.length;it++){const Dt=se[it]=Be?gl(se[it]):eo(se[it]);J(null,Dt,ue,De,Fe,ce,pt,At,Be)}},Pt=(se,ue,De,Fe,ce,pt,At)=>{const Be=ue.el=se.el;let{patchFlag:rt,dynamicChildren:it,dirs:Dt}=ue;rt|=se.patchFlag&16;const Xt=se.props||Fr,Zt=ue.props||Fr;let Yt;if(De&&tc(De,!1),(Yt=Zt.onVnodeBeforeUpdate)&&Ja(Yt,De,ue,se),Dt&&ec(ue,se,De,"beforeUpdate"),De&&tc(De,!0),it?Ht(se.dynamicChildren,it,Be,De,Fe,Df(ue,ce),pt):At||hi(se,ue,Be,null,De,Fe,Df(ue,ce),pt,!1),rt>0){if(rt&16)Rt(Be,ue,Xt,Zt,De,Fe,ce);else if(rt&2&&Xt.class!==Zt.class&&g(Be,"class",null,Zt.class,ce),rt&4&&g(Be,"style",Xt.style,Zt.style,ce),rt&8){const yi=ue.dynamicProps;for(let Ti=0;Ti<yi.length;Ti++){const Ue=yi[Ti],Ni=Xt[Ue],Yi=Zt[Ue];(Yi!==Ni||Ue==="value")&&g(Be,Ue,Ni,Yi,ce,se.children,De,Fe,Si)}}rt&1&&se.children!==ue.children&&R(Be,ue.children)}else!At&&it==null&&Rt(Be,ue,Xt,Zt,De,Fe,ce);((Yt=Zt.onVnodeUpdated)||Dt)&&Ds(()=>{Yt&&Ja(Yt,De,ue,se),Dt&&ec(ue,se,De,"updated")},Fe)},Ht=(se,ue,De,Fe,ce,pt,At)=>{for(let Be=0;Be<ue.length;Be++){const rt=se[Be],it=ue[Be],Dt=rt.el&&(rt.type===Mr||!th(rt,it)||rt.shapeFlag&70)?D(rt.el):De;J(rt,it,Dt,null,Fe,ce,pt,At,!0)}},Rt=(se,ue,De,Fe,ce,pt,At)=>{if(De!==Fe){if(De!==Fr)for(const Be in De)!ph(Be)&&!(Be in Fe)&&g(se,Be,De[Be],null,At,ue.children,ce,pt,Si);for(const Be in Fe){if(ph(Be))continue;const rt=Fe[Be],it=De[Be];rt!==it&&Be!=="value"&&g(se,Be,it,rt,At,ue.children,ce,pt,Si)}"value"in Fe&&g(se,"value",De.value,Fe.value,At)}},li=(se,ue,De,Fe,ce,pt,At,Be,rt)=>{const it=ue.el=se?se.el:l(""),Dt=ue.anchor=se?se.anchor:l("");let{patchFlag:Xt,dynamicChildren:Zt,slotScopeIds:Yt}=ue;Yt&&(Be=Be?Be.concat(Yt):Yt),se==null?(u(it,De,Fe),u(Dt,De,Fe),bt(ue.children||[],De,Dt,ce,pt,At,Be,rt)):Xt>0&&Xt&64&&Zt&&se.dynamicChildren?(Ht(se.dynamicChildren,Zt,De,ce,pt,At,Be),(ue.key!=null||ce&&ue===ce.subTree)&&bv(se,ue,!0)):hi(se,ue,De,Dt,ce,pt,At,Be,rt)},ct=(se,ue,De,Fe,ce,pt,At,Be,rt)=>{ue.slotScopeIds=Be,se==null?ue.shapeFlag&512?ce.ctx.activate(ue,De,Fe,At,rt):zt(ue,De,Fe,ce,pt,At,rt):Bi(se,ue,rt)},zt=(se,ue,De,Fe,ce,pt,At)=>{const Be=se.component=L2(se,Fe,ce);if(uv(se)&&(Be.ctx.renderer=Qe),R2(Be),Be.asyncDep){if(ce&&ce.registerDep(Be,ti),!se.el){const rt=Be.subTree=rr(Sl);xe(null,rt,ue,De)}}else ti(Be,se,ue,De,ce,pt,At)},Bi=(se,ue,De)=>{const Fe=ue.component=se.component;if(Uw(se,ue,De))if(Fe.asyncDep&&!Fe.asyncResolved){ii(Fe,ue,De);return}else Fe.next=ue,zw(Fe.update),Fe.effect.dirty=!0,Fe.update();else ue.el=se.el,Fe.vnode=ue},ti=(se,ue,De,Fe,ce,pt,At)=>{const Be=()=>{if(se.isMounted){let{next:Dt,bu:Xt,u:Zt,parent:Yt,vnode:yi}=se;{const gn=wv(se);if(gn){Dt&&(Dt.el=yi.el,ii(se,Dt,At)),gn.asyncDep.then(()=>{se.isUnmounted||Be()});return}}let Ti=Dt,Ue;tc(se,!1),Dt?(Dt.el=yi.el,ii(se,Dt,At)):Dt=yi,Xt&&Bd(Xt),(Ue=Dt.props&&Dt.props.onVnodeBeforeUpdate)&&Ja(Ue,Yt,Dt,yi),tc(se,!0);const Ni=Af(se),Yi=se.subTree;se.subTree=Ni,J(Yi,Ni,D(Yi.el),Ve(Yi),se,ce,pt),Dt.el=Ni.el,Ti===null&&Vw(se,Ni.el),Zt&&Ds(Zt,ce),(Ue=Dt.props&&Dt.props.onVnodeUpdated)&&Ds(()=>Ja(Ue,Yt,Dt,yi),ce)}else{let Dt;const{el:Xt,props:Zt}=ue,{bm:Yt,m:yi,parent:Ti}=se,Ue=fh(ue);if(tc(se,!1),Yt&&Bd(Yt),!Ue&&(Dt=Zt&&Zt.onVnodeBeforeMount)&&Ja(Dt,Ti,ue),tc(se,!0),Xt&&zi){const Ni=()=>{se.subTree=Af(se),zi(Xt,se.subTree,se,ce,null)};Ue?ue.type.__asyncLoader().then(()=>!se.isUnmounted&&Ni()):Ni()}else{const Ni=se.subTree=Af(se);J(null,Ni,De,Fe,se,ce,pt),ue.el=Ni.el}if(yi&&Ds(yi,ce),!Ue&&(Dt=Zt&&Zt.onVnodeMounted)){const Ni=ue;Ds(()=>Ja(Dt,Ti,Ni),ce)}(ue.shapeFlag&256||Ti&&fh(Ti.vnode)&&Ti.vnode.shapeFlag&256)&&se.a&&Ds(se.a,ce),se.isMounted=!0,ue=De=Fe=null}},rt=se.effect=new Pm(Be,fa,()=>Nm(it),se.scope),it=se.update=()=>{rt.dirty&&rt.run()};it.id=se.uid,tc(se,!0),it()},ii=(se,ue,De)=>{ue.component=se;const Fe=se.vnode.props;se.vnode=ue,se.next=null,y2(se,ue.props,Fe,De),x2(se,ue.children,De),dc(),Wy(se),pc()},hi=(se,ue,De,Fe,ce,pt,At,Be,rt=!1)=>{const it=se&&se.children,Dt=se?se.shapeFlag:0,Xt=ue.children,{patchFlag:Zt,shapeFlag:Yt}=ue;if(Zt>0){if(Zt&128){yr(it,Xt,De,Fe,ce,pt,At,Be,rt);return}else if(Zt&256){Mi(it,Xt,De,Fe,ce,pt,At,Be,rt);return}}Yt&8?(Dt&16&&Si(it,ce,pt),Xt!==it&&R(De,Xt)):Dt&16?Yt&16?yr(it,Xt,De,Fe,ce,pt,At,Be,rt):Si(it,ce,pt,!0):(Dt&8&&R(De,""),Yt&16&&bt(Xt,De,Fe,ce,pt,At,Be,rt))},Mi=(se,ue,De,Fe,ce,pt,At,Be,rt)=>{se=se||eu,ue=ue||eu;const it=se.length,Dt=ue.length,Xt=Math.min(it,Dt);let Zt;for(Zt=0;Zt<Xt;Zt++){const Yt=ue[Zt]=rt?gl(ue[Zt]):eo(ue[Zt]);J(se[Zt],Yt,De,null,ce,pt,At,Be,rt)}it>Dt?Si(se,ce,pt,!0,!1,Xt):bt(ue,De,Fe,ce,pt,At,Be,rt,Xt)},yr=(se,ue,De,Fe,ce,pt,At,Be,rt)=>{let it=0;const Dt=ue.length;let Xt=se.length-1,Zt=Dt-1;for(;it<=Xt&&it<=Zt;){const Yt=se[it],yi=ue[it]=rt?gl(ue[it]):eo(ue[it]);if(th(Yt,yi))J(Yt,yi,De,null,ce,pt,At,Be,rt);else break;it++}for(;it<=Xt&&it<=Zt;){const Yt=se[Xt],yi=ue[Zt]=rt?gl(ue[Zt]):eo(ue[Zt]);if(th(Yt,yi))J(Yt,yi,De,null,ce,pt,At,Be,rt);else break;Xt--,Zt--}if(it>Xt){if(it<=Zt){const Yt=Zt+1,yi=Yt<Dt?ue[Yt].el:Fe;for(;it<=Zt;)J(null,ue[it]=rt?gl(ue[it]):eo(ue[it]),De,yi,ce,pt,At,Be,rt),it++}}else if(it>Zt)for(;it<=Xt;)tt(se[it],ce,pt,!0),it++;else{const Yt=it,yi=it,Ti=new Map;for(it=yi;it<=Zt;it++){const Nt=ue[it]=rt?gl(ue[it]):eo(ue[it]);Nt.key!=null&&Ti.set(Nt.key,it)}let Ue,Ni=0;const Yi=Zt-yi+1;let gn=!1,Sr=0;const nt=new Array(Yi);for(it=0;it<Yi;it++)nt[it]=0;for(it=Yt;it<=Xt;it++){const Nt=se[it];if(Ni>=Yi){tt(Nt,ce,pt,!0);continue}let ji;if(Nt.key!=null)ji=Ti.get(Nt.key);else for(Ue=yi;Ue<=Zt;Ue++)if(nt[Ue-yi]===0&&th(Nt,ue[Ue])){ji=Ue;break}ji===void 0?tt(Nt,ce,pt,!0):(nt[ji-yi]=it+1,ji>=Sr?Sr=ji:gn=!0,J(Nt,ue[ji],De,null,ce,pt,At,Be,rt),Ni++)}const ci=gn?S2(nt):eu;for(Ue=ci.length-1,it=Yi-1;it>=0;it--){const Nt=yi+it,ji=ue[Nt],yn=Nt+1<Dt?ue[Nt+1].el:Fe;nt[it]===0?J(null,ji,De,yn,ce,pt,At,Be,rt):gn&&(Ue<0||it!==ci[Ue]?at(ji,De,yn,2):Ue--)}}},at=(se,ue,De,Fe,ce=null)=>{const{el:pt,type:At,transition:Be,children:rt,shapeFlag:it}=se;if(it&6){at(se.component.subTree,ue,De,Fe);return}if(it&128){se.suspense.move(ue,De,Fe);return}if(it&64){At.move(se,ue,De,Qe);return}if(At===Mr){u(pt,ue,De);for(let Xt=0;Xt<rt.length;Xt++)at(rt[Xt],ue,De,Fe);u(se.anchor,ue,De);return}if(At===Ud){oe(se,ue,De);return}if(Fe!==2&&it&1&&Be)if(Fe===0)Be.beforeEnter(pt),u(pt,ue,De),Ds(()=>Be.enter(pt),ce);else{const{leave:Xt,delayLeave:Zt,afterLeave:Yt}=Be,yi=()=>u(pt,ue,De),Ti=()=>{Xt(pt,()=>{yi(),Yt&&Yt()})};Zt?Zt(pt,yi,Ti):Ti()}else u(pt,ue,De)},tt=(se,ue,De,Fe=!1,ce=!1)=>{const{type:pt,props:At,ref:Be,children:rt,dynamicChildren:it,shapeFlag:Dt,patchFlag:Xt,dirs:Zt}=se;if(Be!=null&&sm(Be,null,De,se,!0),Dt&256){ue.ctx.deactivate(se);return}const Yt=Dt&1&&Zt,yi=!fh(se);let Ti;if(yi&&(Ti=At&&At.onVnodeBeforeUnmount)&&Ja(Ti,ue,se),Dt&6)Zi(se.component,De,Fe);else{if(Dt&128){se.suspense.unmount(De,Fe);return}Yt&&ec(se,null,ue,"beforeUnmount"),Dt&64?se.type.remove(se,ue,De,ce,Qe,Fe):it&&(pt!==Mr||Xt>0&&Xt&64)?Si(it,ue,De,!1,!0):(pt===Mr&&Xt&384||!ce&&Dt&16)&&Si(rt,ue,De),Fe&&Je(se)}(yi&&(Ti=At&&At.onVnodeUnmounted)||Yt)&&Ds(()=>{Ti&&Ja(Ti,ue,se),Yt&&ec(se,null,ue,"unmounted")},De)},Je=se=>{const{type:ue,el:De,anchor:Fe,transition:ce}=se;if(ue===Mr){nr(De,Fe);return}if(ue===Ud){Le(se);return}const pt=()=>{d(De),ce&&!ce.persisted&&ce.afterLeave&&ce.afterLeave()};if(se.shapeFlag&1&&ce&&!ce.persisted){const{leave:At,delayLeave:Be}=ce,rt=()=>At(De,pt);Be?Be(se.el,pt,rt):rt()}else pt()},nr=(se,ue)=>{let De;for(;se!==ue;)De=z(se),d(se),se=De;d(ue)},Zi=(se,ue,De)=>{const{bum:Fe,scope:ce,update:pt,subTree:At,um:Be}=se;Fe&&Bd(Fe),ce.stop(),pt&&(pt.active=!1,tt(At,se,ue,De)),Be&&Ds(Be,ue),Ds(()=>{se.isUnmounted=!0},ue),ue&&ue.pendingBranch&&!ue.isUnmounted&&se.asyncDep&&!se.asyncResolved&&se.suspenseId===ue.pendingId&&(ue.deps--,ue.deps===0&&ue.resolve())},Si=(se,ue,De,Fe=!1,ce=!1,pt=0)=>{for(let At=pt;At<se.length;At++)tt(se[At],ue,De,Fe,ce)},Ve=se=>se.shapeFlag&6?Ve(se.component.subTree):se.shapeFlag&128?se.suspense.next():z(se.anchor||se.el);let Et=!1;const ut=(se,ue,De)=>{se==null?ue._vnode&&tt(ue._vnode,null,null,!0):J(ue._vnode||null,se,ue,null,null,null,De),Et||(Et=!0,Wy(),iv(),Et=!1),ue._vnode=se},Qe={p:J,um:tt,m:at,r:Je,mt:zt,mc:bt,pc:hi,pbc:Ht,n:Ve,o:e};let Di,zi;return r&&([Di,zi]=r(Qe)),{render:ut,hydrate:Di,createApp:f2(ut,Di)}}function Df({type:e,props:r},a){return a==="svg"&&e==="foreignObject"||a==="mathml"&&e==="annotation-xml"&&r&&r.encoding&&r.encoding.includes("html")?void 0:a}function tc({effect:e,update:r},a){e.allowRecurse=r.allowRecurse=a}function M2(e,r){return(!e||e&&!e.pendingBranch)&&r&&!r.persisted}function bv(e,r,a=!1){const u=e.children,d=r.children;if(_i(u)&&_i(d))for(let g=0;g<u.length;g++){const m=u[g];let l=d[g];l.shapeFlag&1&&!l.dynamicChildren&&((l.patchFlag<=0||l.patchFlag===32)&&(l=d[g]=gl(d[g]),l.el=m.el),a||bv(m,l)),l.type===Mp&&(l.el=m.el)}}function S2(e){const r=e.slice(),a=[0];let u,d,g,m,l;const M=e.length;for(u=0;u<M;u++){const P=e[u];if(P!==0){if(d=a[a.length-1],e[d]<P){r[u]=d,a.push(u);continue}for(g=0,m=a.length-1;g<m;)l=g+m>>1,e[a[l]]<P?g=l+1:m=l;P<e[a[g]]&&(g>0&&(r[u]=a[g-1]),a[g]=u)}}for(g=a.length,m=a[g-1];g-- >0;)a[g]=m,m=r[m];return a}function wv(e){const r=e.subTree.component;if(r)return r.asyncDep&&!r.asyncResolved?r:wv(r)}const E2=e=>e.__isTeleport,Mr=Symbol.for("v-fgt"),Mp=Symbol.for("v-txt"),Sl=Symbol.for("v-cmt"),Ud=Symbol.for("v-stc"),gh=[];let La=null;function It(e=!1){gh.push(La=e?null:[])}function T2(){gh.pop(),La=gh[gh.length-1]||null}let Ih=1;function s_(e){Ih+=e}function Mv(e){return e.dynamicChildren=Ih>0?La||eu:null,T2(),Ih>0&&La&&La.push(e),e}function Ot(e,r,a,u,d,g){return Mv(Y(e,r,a,u,d,g,!0))}function da(e,r,a,u,d){return Mv(rr(e,r,a,u,d,!0))}function tp(e){return e?e.__v_isVNode===!0:!1}function th(e,r){return e.type===r.type&&e.key===r.key}const Sp="__vInternal",Sv=({key:e})=>e??null,Vd=({ref:e,ref_key:r,ref_for:a})=>(typeof e=="number"&&(e=""+e),e!=null?In(e)||An(e)||Ii(e)?{i:Cn,r:e,k:r,f:!!a}:e:null);function Y(e,r=null,a=null,u=0,d=null,g=e===Mr?0:1,m=!1,l=!1){const M={__v_isVNode:!0,__v_skip:!0,type:e,props:r,key:r&&Sv(r),ref:r&&Vd(r),scopeId:bp,slotScopeIds:null,children:a,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:g,patchFlag:u,dynamicProps:d,dynamicChildren:null,appContext:null,ctx:Cn};return l?(jm(M,a),g&128&&e.normalize(M)):a&&(M.shapeFlag|=In(a)?8:16),Ih>0&&!m&&La&&(M.patchFlag>0||g&6)&&M.patchFlag!==32&&La.push(M),M}const rr=C2;function C2(e,r=null,a=null,u=0,d=null,g=!1){if((!e||e===jw)&&(e=Sl),tp(e)){const l=ou(e,r,!0);return a&&jm(l,a),Ih>0&&!g&&La&&(l.shapeFlag&6?La[La.indexOf(e)]=l:La.push(l)),l.patchFlag|=-2,l}if(N2(e)&&(e=e.__vccOpts),r){r=I2(r);let{class:l,style:M}=r;l&&!In(l)&&(r.class=is(l)),Ur(M)&&(X0(M)&&!_i(M)&&(M=jn({},M)),r.style=Am(M))}const m=In(e)?1:Gw(e)?128:E2(e)?64:Ur(e)?4:Ii(e)?2:0;return Y(e,r,a,u,d,m,g,!0)}function I2(e){return e?X0(e)||Sp in e?jn({},e):e:null}function ou(e,r,a=!1){const{props:u,ref:d,patchFlag:g,children:m}=e,l=r?P2(u||{},r):u;return{__v_isVNode:!0,__v_skip:!0,type:e.type,props:l,key:l&&Sv(l),ref:r&&r.ref?a&&d?_i(d)?d.concat(Vd(r)):[d,Vd(r)]:Vd(r):d,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:m,target:e.target,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:r&&e.type!==Mr?g===-1?16:g|16:g,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:e.transition,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&ou(e.ssContent),ssFallback:e.ssFallback&&ou(e.ssFallback),el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce}}function ip(e=" ",r=0){return rr(Mp,null,e,r)}function A2(e,r){const a=rr(Ud,null,e);return a.staticCount=r,a}function Gi(e="",r=!1){return r?(It(),da(Sl,null,e)):rr(Sl,null,e)}function eo(e){return e==null||typeof e=="boolean"?rr(Sl):_i(e)?rr(Mr,null,e.slice()):typeof e=="object"?gl(e):rr(Mp,null,String(e))}function gl(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:ou(e)}function jm(e,r){let a=0;const{shapeFlag:u}=e;if(r==null)r=null;else if(_i(r))a=16;else if(typeof r=="object")if(u&65){const d=r.default;d&&(d._c&&(d._d=!1),jm(e,d()),d._c&&(d._d=!0));return}else{a=32;const d=r._;!d&&!(Sp in r)?r._ctx=Cn:d===3&&Cn&&(Cn.slots._===1?r._=1:(r._=2,e.patchFlag|=1024))}else Ii(r)?(r={default:r,_ctx:Cn},a=32):(r=String(r),u&64?(a=16,r=[ip(r)]):a=8);e.children=r,e.shapeFlag|=a}function P2(...e){const r={};for(let a=0;a<e.length;a++){const u=e[a];for(const d in u)if(d==="class")r.class!==u.class&&(r.class=is([r.class,u.class]));else if(d==="style")r.style=Am([r.style,u.style]);else if(pp(d)){const g=r[d],m=u[d];m&&g!==m&&!(_i(g)&&g.includes(m))&&(r[d]=g?[].concat(g,m):m)}else d!==""&&(r[d]=u[d])}return r}function Ja(e,r,a,u=null){za(e,r,7,[a,u])}const D2=mv();let k2=0;function L2(e,r,a){const u=e.type,d=(r?r.appContext:e.appContext)||D2,g={uid:k2++,vnode:e,type:u,parent:r,appContext:d,root:null,next:null,subTree:null,effect:null,update:null,scope:new L0(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:r?r.provides:Object.create(d.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:yv(u,d),emitsOptions:nv(u,d),emit:null,emitted:null,propsDefaults:Fr,inheritAttrs:u.inheritAttrs,ctx:Fr,data:Fr,props:Fr,attrs:Fr,slots:Fr,refs:Fr,setupState:Fr,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:a,suspenseId:a?a.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return g.ctx={_:g},g.root=r?r.root:g,g.emit=Bw.bind(null,g),e.ce&&e.ce(g),g}let Vn=null,rp,am;{const e=P0(),r=(a,u)=>{let d;return(d=e[a])||(d=e[a]=[]),d.push(u),g=>{d.length>1?d.forEach(m=>m(g)):d[0](g)}};rp=r("__VUE_INSTANCE_SETTERS__",a=>Vn=a),am=r("__VUE_SSR_SETTERS__",a=>Ep=a)}const Vh=e=>{const r=Vn;return rp(e),e.scope.on(),()=>{e.scope.off(),rp(r)}},a_=()=>{Vn&&Vn.scope.off(),rp(null)};function Ev(e){return e.vnode.shapeFlag&4}let Ep=!1;function R2(e,r=!1){r&&am(r);const{props:a,children:u}=e.vnode,d=Ev(e);g2(e,a,d,r),v2(e,u);const g=d?z2(e,r):void 0;return r&&am(!1),g}function z2(e,r){const a=e.type;e.accessCache=Object.create(null),e.proxy=_p(new Proxy(e.ctx,o2));const{setup:u}=a;if(u){const d=e.setupContext=u.length>1?F2(e):null,g=Vh(e);dc();const m=bl(u,e,0,[e.props,d]);if(pc(),g(),C0(m)){if(m.then(a_,a_),r)return m.then(l=>{o_(e,l,r)}).catch(l=>{vp(l,e,0)});e.asyncDep=m}else o_(e,m,r)}else Tv(e,r)}function o_(e,r,a){Ii(r)?e.type.__ssrInlineRender?e.ssrRender=r:e.render=r:Ur(r)&&(e.setupState=Q0(r)),Tv(e,a)}let l_;function Tv(e,r,a){const u=e.type;if(!e.render){if(!r&&l_&&!u.render){const d=u.template||Um(e).template;if(d){const{isCustomElement:g,compilerOptions:m}=e.appContext.config,{delimiters:l,compilerOptions:M}=u,P=jn(jn({isCustomElement:g,delimiters:l},m),M);u.render=l_(d,P)}}e.render=u.render||fa}{const d=Vh(e);dc();try{l2(e)}finally{pc(),d()}}}function O2(e){return e.attrsProxy||(e.attrsProxy=new Proxy(e.attrs,{get(r,a){return Rs(e,"get","$attrs"),r[a]}}))}function F2(e){const r=a=>{e.exposed=a||{}};return{get attrs(){return O2(e)},slots:e.slots,emit:e.emit,expose:r}}function Tp(e){if(e.exposed)return e.exposeProxy||(e.exposeProxy=new Proxy(Q0(_p(e.exposed)),{get(r,a){if(a in r)return r[a];if(a in mh)return mh[a](e)},has(r,a){return a in r||a in mh}}))}function B2(e,r=!0){return Ii(e)?e.displayName||e.name:e.name||r&&e.__name}function N2(e){return Ii(e)&&"__vccOpts"in e}const gi=(e,r)=>Tw(e,r,Ep);function Cv(e,r,a){const u=arguments.length;return u===2?Ur(r)&&!_i(r)?tp(r)?rr(e,null,[r]):rr(e,r):rr(e,null,r):(u>3?a=Array.prototype.slice.call(arguments,2):u===3&&tp(a)&&(a=[a]),rr(e,r,a))}const $2="3.4.21";/**
* @vue/runtime-dom v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const U2="http://www.w3.org/2000/svg",V2="http://www.w3.org/1998/Math/MathML",yl=typeof document<"u"?document:null,c_=yl&&yl.createElement("template"),j2={insert:(e,r,a)=>{r.insertBefore(e,a||null)},remove:e=>{const r=e.parentNode;r&&r.removeChild(e)},createElement:(e,r,a,u)=>{const d=r==="svg"?yl.createElementNS(U2,e):r==="mathml"?yl.createElementNS(V2,e):yl.createElement(e,a?{is:a}:void 0);return e==="select"&&u&&u.multiple!=null&&d.setAttribute("multiple",u.multiple),d},createText:e=>yl.createTextNode(e),createComment:e=>yl.createComment(e),setText:(e,r)=>{e.nodeValue=r},setElementText:(e,r)=>{e.textContent=r},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>yl.querySelector(e),setScopeId(e,r){e.setAttribute(r,"")},insertStaticContent(e,r,a,u,d,g){const m=a?a.previousSibling:r.lastChild;if(d&&(d===g||d.nextSibling))for(;r.insertBefore(d.cloneNode(!0),a),!(d===g||!(d=d.nextSibling)););else{c_.innerHTML=u==="svg"?`<svg>${e}</svg>`:u==="mathml"?`<math>${e}</math>`:e;const l=c_.content;if(u==="svg"||u==="mathml"){const M=l.firstChild;for(;M.firstChild;)l.appendChild(M.firstChild);l.removeChild(M)}r.insertBefore(l,a)}return[m?m.nextSibling:r.firstChild,a?a.previousSibling:r.lastChild]}},q2=Symbol("_vtc");function G2(e,r,a){const u=e[q2];u&&(r=(r?[r,...u]:[...u]).join(" ")),r==null?e.removeAttribute("class"):a?e.setAttribute("class",r):e.className=r}const np=Symbol("_vod"),Iv=Symbol("_vsh"),H2={beforeMount(e,{value:r},{transition:a}){e[np]=e.style.display==="none"?"":e.style.display,a&&r?a.beforeEnter(e):ih(e,r)},mounted(e,{value:r},{transition:a}){a&&r&&a.enter(e)},updated(e,{value:r,oldValue:a},{transition:u}){!r!=!a&&(u?r?(u.beforeEnter(e),ih(e,!0),u.enter(e)):u.leave(e,()=>{ih(e,!1)}):ih(e,r))},beforeUnmount(e,{value:r}){ih(e,r)}};function ih(e,r){e.style.display=r?e[np]:"none",e[Iv]=!r}const Z2=Symbol(""),W2=/(^|;)\s*display\s*:/;function X2(e,r,a){const u=e.style,d=In(a);let g=!1;if(a&&!d){if(r)if(In(r))for(const m of r.split(";")){const l=m.slice(0,m.indexOf(":")).trim();a[l]==null&&jd(u,l,"")}else for(const m in r)a[m]==null&&jd(u,m,"");for(const m in a)m==="display"&&(g=!0),jd(u,m,a[m])}else if(d){if(r!==a){const m=u[Z2];m&&(a+=";"+m),u.cssText=a,g=W2.test(a)}}else r&&e.removeAttribute("style");np in e&&(e[np]=g?u.display:"",e[Iv]&&(u.display="none"))}const u_=/\s*!important$/;function jd(e,r,a){if(_i(a))a.forEach(u=>jd(e,r,u));else if(a==null&&(a=""),r.startsWith("--"))e.setProperty(r,a);else{const u=K2(e,r);u_.test(a)?e.setProperty(hc(u),a.replace(u_,""),"important"):e[u]=a}}const h_=["Webkit","Moz","ms"],kf={};function K2(e,r){const a=kf[r];if(a)return a;let u=so(r);if(u!=="filter"&&u in e)return kf[r]=u;u=gp(u);for(let d=0;d<h_.length;d++){const g=h_[d]+u;if(g in e)return kf[r]=g}return r}const d_="http://www.w3.org/1999/xlink";function Y2(e,r,a,u,d){if(u&&r.startsWith("xlink:"))a==null?e.removeAttributeNS(d_,r.slice(6,r.length)):e.setAttributeNS(d_,r,a);else{const g=rw(r);a==null||g&&!D0(a)?e.removeAttribute(r):e.setAttribute(r,g?"":a)}}function J2(e,r,a,u,d,g,m){if(r==="innerHTML"||r==="textContent"){u&&m(u,d,g),e[r]=a??"";return}const l=e.tagName;if(r==="value"&&l!=="PROGRESS"&&!l.includes("-")){const P=l==="OPTION"?e.getAttribute("value")||"":e.value,R=a??"";(P!==R||!("_value"in e))&&(e.value=R),a==null&&e.removeAttribute(r),e._value=a;return}let M=!1;if(a===""||a==null){const P=typeof e[r];P==="boolean"?a=D0(a):a==null&&P==="string"?(a="",M=!0):P==="number"&&(a=0,M=!0)}try{e[r]=a}catch{}M&&e.removeAttribute(r)}function Gc(e,r,a,u){e.addEventListener(r,a,u)}function Q2(e,r,a,u){e.removeEventListener(r,a,u)}const p_=Symbol("_vei");function eM(e,r,a,u,d=null){const g=e[p_]||(e[p_]={}),m=g[r];if(u&&m)m.value=u;else{const[l,M]=tM(r);if(u){const P=g[r]=nM(u,d);Gc(e,l,P,M)}else m&&(Q2(e,l,m,M),g[r]=void 0)}}const f_=/(?:Once|Passive|Capture)$/;function tM(e){let r;if(f_.test(e)){r={};let u;for(;u=e.match(f_);)e=e.slice(0,e.length-u[0].length),r[u[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):hc(e.slice(2)),r]}let Lf=0;const iM=Promise.resolve(),rM=()=>Lf||(iM.then(()=>Lf=0),Lf=Date.now());function nM(e,r){const a=u=>{if(!u._vts)u._vts=Date.now();else if(u._vts<=a.attached)return;za(sM(u,a.value),r,5,[u])};return a.value=e,a.attached=rM(),a}function sM(e,r){if(_i(r)){const a=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{a.call(e),e._stopped=!0},r.map(u=>d=>!d._stopped&&u&&u(d))}else return r}const m_=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&e.charCodeAt(2)>96&&e.charCodeAt(2)<123,aM=(e,r,a,u,d,g,m,l,M)=>{const P=d==="svg";r==="class"?G2(e,u,P):r==="style"?X2(e,a,u):pp(r)?Tm(r)||eM(e,r,a,u,m):(r[0]==="."?(r=r.slice(1),!0):r[0]==="^"?(r=r.slice(1),!1):oM(e,r,u,P))?J2(e,r,u,g,m,l,M):(r==="true-value"?e._trueValue=u:r==="false-value"&&(e._falseValue=u),Y2(e,r,u,P))};function oM(e,r,a,u){if(u)return!!(r==="innerHTML"||r==="textContent"||r in e&&m_(r)&&Ii(a));if(r==="spellcheck"||r==="draggable"||r==="translate"||r==="form"||r==="list"&&e.tagName==="INPUT"||r==="type"&&e.tagName==="TEXTAREA")return!1;if(r==="width"||r==="height"){const d=e.tagName;if(d==="IMG"||d==="VIDEO"||d==="CANVAS"||d==="SOURCE")return!1}return m_(r)&&In(a)?!1:r in e}const g_=e=>{const r=e.props["onUpdate:modelValue"]||!1;return _i(r)?a=>Bd(r,a):r};function lM(e){e.target.composing=!0}function y_(e){const r=e.target;r.composing&&(r.composing=!1,r.dispatchEvent(new Event("input")))}const Rf=Symbol("_assign"),cM={created(e,{modifiers:{lazy:r,trim:a,number:u}},d){e[Rf]=g_(d);const g=u||d.props&&d.props.type==="number";Gc(e,r?"change":"input",m=>{if(m.target.composing)return;let l=e.value;a&&(l=l.trim()),g&&(l=Kf(l)),e[Rf](l)}),a&&Gc(e,"change",()=>{e.value=e.value.trim()}),r||(Gc(e,"compositionstart",lM),Gc(e,"compositionend",y_),Gc(e,"change",y_))},mounted(e,{value:r}){e.value=r??""},beforeUpdate(e,{value:r,modifiers:{lazy:a,trim:u,number:d}},g){if(e[Rf]=g_(g),e.composing)return;const m=d||e.type==="number"?Kf(e.value):e.value,l=r??"";m!==l&&(document.activeElement===e&&e.type!=="range"&&(a||u&&e.value.trim()===l)||(e.value=l))}},uM={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},hM=(e,r)=>{const a=e._withKeys||(e._withKeys={}),u=r.join(".");return a[u]||(a[u]=d=>{if(!("key"in d))return;const g=hc(d.key);if(r.some(m=>m===g||uM[m]===g))return e(d)})},dM=jn({patchProp:aM},j2);let __;function pM(){return __||(__=b2(dM))}const fM=(...e)=>{const r=pM().createApp(...e),{mount:a}=r;return r.mount=u=>{const d=gM(u);if(!d)return;const g=r._component;!Ii(g)&&!g.render&&!g.template&&(g.template=d.innerHTML),d.innerHTML="";const m=a(d,!1,mM(d));return d instanceof Element&&(d.removeAttribute("v-cloak"),d.setAttribute("data-v-app","")),m},r};function mM(e){if(e instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&e instanceof MathMLElement)return"mathml"}function gM(e){return In(e)?document.querySelector(e):e}var yM=!1;/*!
 * pinia v2.1.7
 * (c) 2023 Eduardo San Martin Morote
 * @license MIT
 */let Av;const Cp=e=>Av=e,Pv=Symbol();function om(e){return e&&typeof e=="object"&&Object.prototype.toString.call(e)==="[object Object]"&&typeof e.toJSON!="function"}var yh;(function(e){e.direct="direct",e.patchObject="patch object",e.patchFunction="patch function"})(yh||(yh={}));function _M(){const e=R0(!0),r=e.run(()=>ks({}));let a=[],u=[];const d=_p({install(g){Cp(d),d._a=g,g.provide(Pv,d),g.config.globalProperties.$pinia=d,u.forEach(m=>a.push(m)),u=[]},use(g){return!this._a&&!yM?u.push(g):a.push(g),this},_p:a,_a:null,_e:e,_s:new Map,state:r});return d}const Dv=()=>{};function v_(e,r,a,u=Dv){e.push(r);const d=()=>{const g=e.indexOf(r);g>-1&&(e.splice(g,1),u())};return!a&&z0()&&sw(d),d}function jc(e,...r){e.slice().forEach(a=>{a(...r)})}const vM=e=>e();function lm(e,r){e instanceof Map&&r instanceof Map&&r.forEach((a,u)=>e.set(u,a)),e instanceof Set&&r instanceof Set&&r.forEach(e.add,e);for(const a in r){if(!r.hasOwnProperty(a))continue;const u=r[a],d=e[a];om(d)&&om(u)&&e.hasOwnProperty(a)&&!An(u)&&!xl(u)?e[a]=lm(d,u):e[a]=u}return e}const xM=Symbol();function bM(e){return!om(e)||!e.hasOwnProperty(xM)}const{assign:fl}=Object;function wM(e){return!!(An(e)&&e.effect)}function MM(e,r,a,u){const{state:d,actions:g,getters:m}=r,l=a.state.value[e];let M;function P(){l||(a.state.value[e]=d?d():{});const R=Pw(a.state.value[e]);return fl(R,g,Object.keys(m||{}).reduce((D,z)=>(D[z]=_p(gi(()=>{Cp(a);const Z=a._s.get(e);return m[z].call(Z,Z)})),D),{}))}return M=kv(e,P,r,a,u,!0),M}function kv(e,r,a={},u,d,g){let m;const l=fl({actions:{}},a),M={deep:!0};let P,R,D=[],z=[],Z;const W=u.state.value[e];!g&&!W&&(u.state.value[e]={}),ks({});let J;function me(bt){let Pt;P=R=!1,typeof bt=="function"?(bt(u.state.value[e]),Pt={type:yh.patchFunction,storeId:e,events:Z}):(lm(u.state.value[e],bt),Pt={type:yh.patchObject,payload:bt,storeId:e,events:Z});const Ht=J=Symbol();Bm().then(()=>{J===Ht&&(P=!0)}),R=!0,jc(D,Pt,u.state.value[e])}const xe=g?function(){const{state:Pt}=a,Ht=Pt?Pt():{};this.$patch(Rt=>{fl(Rt,Ht)})}:Dv;function Pe(){m.stop(),D=[],z=[],u._s.delete(e)}function oe(bt,Pt){return function(){Cp(u);const Ht=Array.from(arguments),Rt=[],li=[];function ct(ti){Rt.push(ti)}function zt(ti){li.push(ti)}jc(z,{args:Ht,name:bt,store:Ze,after:ct,onError:zt});let Bi;try{Bi=Pt.apply(this&&this.$id===e?this:Ze,Ht)}catch(ti){throw jc(li,ti),ti}return Bi instanceof Promise?Bi.then(ti=>(jc(Rt,ti),ti)).catch(ti=>(jc(li,ti),Promise.reject(ti))):(jc(Rt,Bi),Bi)}}const Le={_p:u,$id:e,$onAction:v_.bind(null,z),$patch:me,$reset:xe,$subscribe(bt,Pt={}){const Ht=v_(D,bt,Pt.detached,()=>Rt()),Rt=m.run(()=>rs(()=>u.state.value[e],li=>{(Pt.flush==="sync"?R:P)&&bt({storeId:e,type:yh.direct,events:Z},li)},fl({},M,Pt)));return Ht},$dispose:Pe},Ze=Bh(Le);u._s.set(e,Ze);const dt=(u._a&&u._a.runWithContext||vM)(()=>u._e.run(()=>(m=R0()).run(r)));for(const bt in dt){const Pt=dt[bt];if(An(Pt)&&!wM(Pt)||xl(Pt))g||(W&&bM(Pt)&&(An(Pt)?Pt.value=W[bt]:lm(Pt,W[bt])),u.state.value[e][bt]=Pt);else if(typeof Pt=="function"){const Ht=oe(bt,Pt);dt[bt]=Ht,l.actions[bt]=Pt}}return fl(Ze,dt),fl(Ki(Ze),dt),Object.defineProperty(Ze,"$state",{get:()=>u.state.value[e],set:bt=>{me(Pt=>{fl(Pt,bt)})}}),u._p.forEach(bt=>{fl(Ze,m.run(()=>bt({store:Ze,app:u._a,pinia:u,options:l})))}),W&&g&&a.hydrate&&a.hydrate(Ze.$state,W),P=!0,R=!0,Ze}function Lo(e,r,a){let u,d;const g=typeof r=="function";typeof e=="string"?(u=e,d=g?a:r):(d=e,u=e.id);function m(l,M){const P=m2();return l=l||(P?ma(Pv,null):null),l&&Cp(l),l=Av,l._s.has(u)||(g?kv(u,r,d,l):MM(u,d,l)),l._s.get(u)}return m.$id=u,m}const Js=Lo("MainStore",{state:()=>({lastSearchMethod:"address",currentAddress:"",currentTopic:"Property",currentNearbyDataType:"nearby311",dataSourcesLoadedArray:[],hoveredStateId:null,selectedParcelId:null}),actions:{setCurrentAddress(e){this.currentAddress=e},setLastSearchMethod(e){this.lastSearchMethod=e},setCurrentNearbyDataType(e){this.currentNearbyDataType=e},clearDataSourcesLoadedArray(){this.dataSourcesLoadedArray=[]},addToDataSourcesLoadedArray(e){this.dataSourcesLoadedArray.push(e)}}});/*!
  * vue-router v4.3.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const Hc=typeof document<"u";function SM(e){return e.__esModule||e[Symbol.toStringTag]==="Module"}const hr=Object.assign;function zf(e,r){const a={};for(const u in r){const d=r[u];a[u]=Fa(d)?d.map(e):e(d)}return a}const _h=()=>{},Fa=Array.isArray,Lv=/#/g,EM=/&/g,TM=/\//g,CM=/=/g,IM=/\?/g,Rv=/\+/g,AM=/%5B/g,PM=/%5D/g,zv=/%5E/g,DM=/%60/g,Ov=/%7B/g,kM=/%7C/g,Fv=/%7D/g,LM=/%20/g;function qm(e){return encodeURI(""+e).replace(kM,"|").replace(AM,"[").replace(PM,"]")}function RM(e){return qm(e).replace(Ov,"{").replace(Fv,"}").replace(zv,"^")}function cm(e){return qm(e).replace(Rv,"%2B").replace(LM,"+").replace(Lv,"%23").replace(EM,"%26").replace(DM,"`").replace(Ov,"{").replace(Fv,"}").replace(zv,"^")}function zM(e){return cm(e).replace(CM,"%3D")}function OM(e){return qm(e).replace(Lv,"%23").replace(IM,"%3F")}function FM(e){return e==null?"":OM(e).replace(TM,"%2F")}function Ah(e){try{return decodeURIComponent(""+e)}catch{}return""+e}const BM=/\/$/,NM=e=>e.replace(BM,"");function Of(e,r,a="/"){let u,d={},g="",m="";const l=r.indexOf("#");let M=r.indexOf("?");return l<M&&l>=0&&(M=-1),M>-1&&(u=r.slice(0,M),g=r.slice(M+1,l>-1?l:r.length),d=e(g)),l>-1&&(u=u||r.slice(0,l),m=r.slice(l,r.length)),u=jM(u??r,a),{fullPath:u+(g&&"?")+g+m,path:u,query:d,hash:Ah(m)}}function $M(e,r){const a=r.query?e(r.query):"";return r.path+(a&&"?")+a+(r.hash||"")}function x_(e,r){return!r||!e.toLowerCase().startsWith(r.toLowerCase())?e:e.slice(r.length)||"/"}function UM(e,r,a){const u=r.matched.length-1,d=a.matched.length-1;return u>-1&&u===d&&lu(r.matched[u],a.matched[d])&&Bv(r.params,a.params)&&e(r.query)===e(a.query)&&r.hash===a.hash}function lu(e,r){return(e.aliasOf||e)===(r.aliasOf||r)}function Bv(e,r){if(Object.keys(e).length!==Object.keys(r).length)return!1;for(const a in e)if(!VM(e[a],r[a]))return!1;return!0}function VM(e,r){return Fa(e)?b_(e,r):Fa(r)?b_(r,e):e===r}function b_(e,r){return Fa(r)?e.length===r.length&&e.every((a,u)=>a===r[u]):e.length===1&&e[0]===r}function jM(e,r){if(e.startsWith("/"))return e;if(!e)return r;const a=r.split("/"),u=e.split("/"),d=u[u.length-1];(d===".."||d===".")&&u.push("");let g=a.length-1,m,l;for(m=0;m<u.length;m++)if(l=u[m],l!==".")if(l==="..")g>1&&g--;else break;return a.slice(0,g).join("/")+"/"+u.slice(m).join("/")}var Ph;(function(e){e.pop="pop",e.push="push"})(Ph||(Ph={}));var vh;(function(e){e.back="back",e.forward="forward",e.unknown=""})(vh||(vh={}));function qM(e){if(!e)if(Hc){const r=document.querySelector("base");e=r&&r.getAttribute("href")||"/",e=e.replace(/^\w+:\/\/[^\/]+/,"")}else e="/";return e[0]!=="/"&&e[0]!=="#"&&(e="/"+e),NM(e)}const GM=/^[^#]+#/;function HM(e,r){return e.replace(GM,"#")+r}function ZM(e,r){const a=document.documentElement.getBoundingClientRect(),u=e.getBoundingClientRect();return{behavior:r.behavior,left:u.left-a.left-(r.left||0),top:u.top-a.top-(r.top||0)}}const Ip=()=>({left:window.scrollX,top:window.scrollY});function WM(e){let r;if("el"in e){const a=e.el,u=typeof a=="string"&&a.startsWith("#"),d=typeof a=="string"?u?document.getElementById(a.slice(1)):document.querySelector(a):a;if(!d)return;r=ZM(d,e)}else r=e;"scrollBehavior"in document.documentElement.style?window.scrollTo(r):window.scrollTo(r.left!=null?r.left:window.scrollX,r.top!=null?r.top:window.scrollY)}function w_(e,r){return(history.state?history.state.position-r:-1)+e}const um=new Map;function XM(e,r){um.set(e,r)}function KM(e){const r=um.get(e);return um.delete(e),r}let YM=()=>location.protocol+"//"+location.host;function Nv(e,r){const{pathname:a,search:u,hash:d}=r,g=e.indexOf("#");if(g>-1){let l=d.includes(e.slice(g))?e.slice(g).length:1,M=d.slice(l);return M[0]!=="/"&&(M="/"+M),x_(M,"")}return x_(a,e)+u+d}function JM(e,r,a,u){let d=[],g=[],m=null;const l=({state:z})=>{const Z=Nv(e,location),W=a.value,J=r.value;let me=0;if(z){if(a.value=Z,r.value=z,m&&m===W){m=null;return}me=J?z.position-J.position:0}else u(Z);d.forEach(xe=>{xe(a.value,W,{delta:me,type:Ph.pop,direction:me?me>0?vh.forward:vh.back:vh.unknown})})};function M(){m=a.value}function P(z){d.push(z);const Z=()=>{const W=d.indexOf(z);W>-1&&d.splice(W,1)};return g.push(Z),Z}function R(){const{history:z}=window;z.state&&z.replaceState(hr({},z.state,{scroll:Ip()}),"")}function D(){for(const z of g)z();g=[],window.removeEventListener("popstate",l),window.removeEventListener("beforeunload",R)}return window.addEventListener("popstate",l),window.addEventListener("beforeunload",R,{passive:!0}),{pauseListeners:M,listen:P,destroy:D}}function M_(e,r,a,u=!1,d=!1){return{back:e,current:r,forward:a,replaced:u,position:window.history.length,scroll:d?Ip():null}}function QM(e){const{history:r,location:a}=window,u={value:Nv(e,a)},d={value:r.state};d.value||g(u.value,{back:null,current:u.value,forward:null,position:r.length-1,replaced:!0,scroll:null},!0);function g(M,P,R){const D=e.indexOf("#"),z=D>-1?(a.host&&document.querySelector("base")?e:e.slice(D))+M:YM()+e+M;try{r[R?"replaceState":"pushState"](P,"",z),d.value=P}catch(Z){console.error(Z),a[R?"replace":"assign"](z)}}function m(M,P){const R=hr({},r.state,M_(d.value.back,M,d.value.forward,!0),P,{position:d.value.position});g(M,R,!0),u.value=M}function l(M,P){const R=hr({},d.value,r.state,{forward:M,scroll:Ip()});g(R.current,R,!0);const D=hr({},M_(u.value,M,null),{position:R.position+1},P);g(M,D,!1),u.value=M}return{location:u,state:d,push:l,replace:m}}function eS(e){e=qM(e);const r=QM(e),a=JM(e,r.state,r.location,r.replace);function u(g,m=!0){m||a.pauseListeners(),history.go(g)}const d=hr({location:"",base:e,go:u,createHref:HM.bind(null,e)},r,a);return Object.defineProperty(d,"location",{enumerable:!0,get:()=>r.location.value}),Object.defineProperty(d,"state",{enumerable:!0,get:()=>r.state.value}),d}function tS(e){return e=location.host?e||location.pathname+location.search:"",e.includes("#")||(e+="#"),eS(e)}function iS(e){return typeof e=="string"||e&&typeof e=="object"}function $v(e){return typeof e=="string"||typeof e=="symbol"}const hl={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},Uv=Symbol("");var S_;(function(e){e[e.aborted=4]="aborted",e[e.cancelled=8]="cancelled",e[e.duplicated=16]="duplicated"})(S_||(S_={}));function cu(e,r){return hr(new Error,{type:e,[Uv]:!0},r)}function Io(e,r){return e instanceof Error&&Uv in e&&(r==null||!!(e.type&r))}const E_="[^/]+?",rS={sensitive:!1,strict:!1,start:!0,end:!0},nS=/[.+*?^${}()[\]/\\]/g;function sS(e,r){const a=hr({},rS,r),u=[];let d=a.start?"^":"";const g=[];for(const P of e){const R=P.length?[]:[90];a.strict&&!P.length&&(d+="/");for(let D=0;D<P.length;D++){const z=P[D];let Z=40+(a.sensitive?.25:0);if(z.type===0)D||(d+="/"),d+=z.value.replace(nS,"\\$&"),Z+=40;else if(z.type===1){const{value:W,repeatable:J,optional:me,regexp:xe}=z;g.push({name:W,repeatable:J,optional:me});const Pe=xe||E_;if(Pe!==E_){Z+=10;try{new RegExp(`(${Pe})`)}catch(Le){throw new Error(`Invalid custom RegExp for param "${W}" (${Pe}): `+Le.message)}}let oe=J?`((?:${Pe})(?:/(?:${Pe}))*)`:`(${Pe})`;D||(oe=me&&P.length<2?`(?:/${oe})`:"/"+oe),me&&(oe+="?"),d+=oe,Z+=20,me&&(Z+=-8),J&&(Z+=-20),Pe===".*"&&(Z+=-50)}R.push(Z)}u.push(R)}if(a.strict&&a.end){const P=u.length-1;u[P][u[P].length-1]+=.7000000000000001}a.strict||(d+="/?"),a.end?d+="$":a.strict&&(d+="(?:/|$)");const m=new RegExp(d,a.sensitive?"":"i");function l(P){const R=P.match(m),D={};if(!R)return null;for(let z=1;z<R.length;z++){const Z=R[z]||"",W=g[z-1];D[W.name]=Z&&W.repeatable?Z.split("/"):Z}return D}function M(P){let R="",D=!1;for(const z of e){(!D||!R.endsWith("/"))&&(R+="/"),D=!1;for(const Z of z)if(Z.type===0)R+=Z.value;else if(Z.type===1){const{value:W,repeatable:J,optional:me}=Z,xe=W in P?P[W]:"";if(Fa(xe)&&!J)throw new Error(`Provided param "${W}" is an array but it is not repeatable (* or + modifiers)`);const Pe=Fa(xe)?xe.join("/"):xe;if(!Pe)if(me)z.length<2&&(R.endsWith("/")?R=R.slice(0,-1):D=!0);else throw new Error(`Missing required param "${W}"`);R+=Pe}}return R||"/"}return{re:m,score:u,keys:g,parse:l,stringify:M}}function aS(e,r){let a=0;for(;a<e.length&&a<r.length;){const u=r[a]-e[a];if(u)return u;a++}return e.length<r.length?e.length===1&&e[0]===80?-1:1:e.length>r.length?r.length===1&&r[0]===80?1:-1:0}function oS(e,r){let a=0;const u=e.score,d=r.score;for(;a<u.length&&a<d.length;){const g=aS(u[a],d[a]);if(g)return g;a++}if(Math.abs(d.length-u.length)===1){if(T_(u))return 1;if(T_(d))return-1}return d.length-u.length}function T_(e){const r=e[e.length-1];return e.length>0&&r[r.length-1]<0}const lS={type:0,value:""},cS=/[a-zA-Z0-9_]/;function uS(e){if(!e)return[[]];if(e==="/")return[[lS]];if(!e.startsWith("/"))throw new Error(`Invalid path "${e}"`);function r(Z){throw new Error(`ERR (${a})/"${P}": ${Z}`)}let a=0,u=a;const d=[];let g;function m(){g&&d.push(g),g=[]}let l=0,M,P="",R="";function D(){P&&(a===0?g.push({type:0,value:P}):a===1||a===2||a===3?(g.length>1&&(M==="*"||M==="+")&&r(`A repeatable param (${P}) must be alone in its segment. eg: '/:ids+.`),g.push({type:1,value:P,regexp:R,repeatable:M==="*"||M==="+",optional:M==="*"||M==="?"})):r("Invalid state to consume buffer"),P="")}function z(){P+=M}for(;l<e.length;){if(M=e[l++],M==="\\"&&a!==2){u=a,a=4;continue}switch(a){case 0:M==="/"?(P&&D(),m()):M===":"?(D(),a=1):z();break;case 4:z(),a=u;break;case 1:M==="("?a=2:cS.test(M)?z():(D(),a=0,M!=="*"&&M!=="?"&&M!=="+"&&l--);break;case 2:M===")"?R[R.length-1]=="\\"?R=R.slice(0,-1)+M:a=3:R+=M;break;case 3:D(),a=0,M!=="*"&&M!=="?"&&M!=="+"&&l--,R="";break;default:r("Unknown state");break}}return a===2&&r(`Unfinished custom RegExp for param "${P}"`),D(),m(),d}function hS(e,r,a){const u=sS(uS(e.path),a),d=hr(u,{record:e,parent:r,children:[],alias:[]});return r&&!d.record.aliasOf==!r.record.aliasOf&&r.children.push(d),d}function dS(e,r){const a=[],u=new Map;r=A_({strict:!1,end:!0,sensitive:!1},r);function d(R){return u.get(R)}function g(R,D,z){const Z=!z,W=pS(R);W.aliasOf=z&&z.record;const J=A_(r,R),me=[W];if("alias"in R){const oe=typeof R.alias=="string"?[R.alias]:R.alias;for(const Le of oe)me.push(hr({},W,{components:z?z.record.components:W.components,path:Le,aliasOf:z?z.record:W}))}let xe,Pe;for(const oe of me){const{path:Le}=oe;if(D&&Le[0]!=="/"){const Ze=D.record.path,Ke=Ze[Ze.length-1]==="/"?"":"/";oe.path=D.record.path+(Le&&Ke+Le)}if(xe=hS(oe,D,J),z?z.alias.push(xe):(Pe=Pe||xe,Pe!==xe&&Pe.alias.push(xe),Z&&R.name&&!I_(xe)&&m(R.name)),W.children){const Ze=W.children;for(let Ke=0;Ke<Ze.length;Ke++)g(Ze[Ke],xe,z&&z.children[Ke])}z=z||xe,(xe.record.components&&Object.keys(xe.record.components).length||xe.record.name||xe.record.redirect)&&M(xe)}return Pe?()=>{m(Pe)}:_h}function m(R){if($v(R)){const D=u.get(R);D&&(u.delete(R),a.splice(a.indexOf(D),1),D.children.forEach(m),D.alias.forEach(m))}else{const D=a.indexOf(R);D>-1&&(a.splice(D,1),R.record.name&&u.delete(R.record.name),R.children.forEach(m),R.alias.forEach(m))}}function l(){return a}function M(R){let D=0;for(;D<a.length&&oS(R,a[D])>=0&&(R.record.path!==a[D].record.path||!Vv(R,a[D]));)D++;a.splice(D,0,R),R.record.name&&!I_(R)&&u.set(R.record.name,R)}function P(R,D){let z,Z={},W,J;if("name"in R&&R.name){if(z=u.get(R.name),!z)throw cu(1,{location:R});J=z.record.name,Z=hr(C_(D.params,z.keys.filter(Pe=>!Pe.optional).concat(z.parent?z.parent.keys.filter(Pe=>Pe.optional):[]).map(Pe=>Pe.name)),R.params&&C_(R.params,z.keys.map(Pe=>Pe.name))),W=z.stringify(Z)}else if(R.path!=null)W=R.path,z=a.find(Pe=>Pe.re.test(W)),z&&(Z=z.parse(W),J=z.record.name);else{if(z=D.name?u.get(D.name):a.find(Pe=>Pe.re.test(D.path)),!z)throw cu(1,{location:R,currentLocation:D});J=z.record.name,Z=hr({},D.params,R.params),W=z.stringify(Z)}const me=[];let xe=z;for(;xe;)me.unshift(xe.record),xe=xe.parent;return{name:J,path:W,params:Z,matched:me,meta:mS(me)}}return e.forEach(R=>g(R)),{addRoute:g,resolve:P,removeRoute:m,getRoutes:l,getRecordMatcher:d}}function C_(e,r){const a={};for(const u of r)u in e&&(a[u]=e[u]);return a}function pS(e){return{path:e.path,redirect:e.redirect,name:e.name,meta:e.meta||{},aliasOf:void 0,beforeEnter:e.beforeEnter,props:fS(e),children:e.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in e?e.components||null:e.component&&{default:e.component}}}function fS(e){const r={},a=e.props||!1;if("component"in e)r.default=a;else for(const u in e.components)r[u]=typeof a=="object"?a[u]:a;return r}function I_(e){for(;e;){if(e.record.aliasOf)return!0;e=e.parent}return!1}function mS(e){return e.reduce((r,a)=>hr(r,a.meta),{})}function A_(e,r){const a={};for(const u in e)a[u]=u in r?r[u]:e[u];return a}function Vv(e,r){return r.children.some(a=>a===e||Vv(e,a))}function gS(e){const r={};if(e===""||e==="?")return r;const u=(e[0]==="?"?e.slice(1):e).split("&");for(let d=0;d<u.length;++d){const g=u[d].replace(Rv," "),m=g.indexOf("="),l=Ah(m<0?g:g.slice(0,m)),M=m<0?null:Ah(g.slice(m+1));if(l in r){let P=r[l];Fa(P)||(P=r[l]=[P]),P.push(M)}else r[l]=M}return r}function P_(e){let r="";for(let a in e){const u=e[a];if(a=zM(a),u==null){u!==void 0&&(r+=(r.length?"&":"")+a);continue}(Fa(u)?u.map(g=>g&&cm(g)):[u&&cm(u)]).forEach(g=>{g!==void 0&&(r+=(r.length?"&":"")+a,g!=null&&(r+="="+g))})}return r}function yS(e){const r={};for(const a in e){const u=e[a];u!==void 0&&(r[a]=Fa(u)?u.map(d=>d==null?null:""+d):u==null?u:""+u)}return r}const _S=Symbol(""),D_=Symbol(""),Ap=Symbol(""),Gm=Symbol(""),hm=Symbol("");function rh(){let e=[];function r(u){return e.push(u),()=>{const d=e.indexOf(u);d>-1&&e.splice(d,1)}}function a(){e=[]}return{add:r,list:()=>e.slice(),reset:a}}function _l(e,r,a,u,d,g=m=>m()){const m=u&&(u.enterCallbacks[d]=u.enterCallbacks[d]||[]);return()=>new Promise((l,M)=>{const P=z=>{z===!1?M(cu(4,{from:a,to:r})):z instanceof Error?M(z):iS(z)?M(cu(2,{from:r,to:z})):(m&&u.enterCallbacks[d]===m&&typeof z=="function"&&m.push(z),l())},R=g(()=>e.call(u&&u.instances[d],r,a,P));let D=Promise.resolve(R);e.length<3&&(D=D.then(P)),D.catch(z=>M(z))})}function Ff(e,r,a,u,d=g=>g()){const g=[];for(const m of e)for(const l in m.components){let M=m.components[l];if(!(r!=="beforeRouteEnter"&&!m.instances[l]))if(vS(M)){const R=(M.__vccOpts||M)[r];R&&g.push(_l(R,a,u,m,l,d))}else{let P=M();g.push(()=>P.then(R=>{if(!R)return Promise.reject(new Error(`Couldn't resolve component "${l}" at "${m.path}"`));const D=SM(R)?R.default:R;m.components[l]=D;const Z=(D.__vccOpts||D)[r];return Z&&_l(Z,a,u,m,l,d)()}))}}return g}function vS(e){return typeof e=="object"||"displayName"in e||"props"in e||"__vccOpts"in e}function k_(e){const r=ma(Ap),a=ma(Gm),u=gi(()=>r.resolve(Fi(e.to))),d=gi(()=>{const{matched:M}=u.value,{length:P}=M,R=M[P-1],D=a.matched;if(!R||!D.length)return-1;const z=D.findIndex(lu.bind(null,R));if(z>-1)return z;const Z=L_(M[P-2]);return P>1&&L_(R)===Z&&D[D.length-1].path!==Z?D.findIndex(lu.bind(null,M[P-2])):z}),g=gi(()=>d.value>-1&&wS(a.params,u.value.params)),m=gi(()=>d.value>-1&&d.value===a.matched.length-1&&Bv(a.params,u.value.params));function l(M={}){return bS(M)?r[Fi(e.replace)?"replace":"push"](Fi(e.to)).catch(_h):Promise.resolve()}return{route:u,href:gi(()=>u.value.href),isActive:g,isExactActive:m,navigate:l}}const xS=cv({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:k_,setup(e,{slots:r}){const a=Bh(k_(e)),{options:u}=ma(Ap),d=gi(()=>({[R_(e.activeClass,u.linkActiveClass,"router-link-active")]:a.isActive,[R_(e.exactActiveClass,u.linkExactActiveClass,"router-link-exact-active")]:a.isExactActive}));return()=>{const g=r.default&&r.default(a);return e.custom?g:Cv("a",{"aria-current":a.isExactActive?e.ariaCurrentValue:null,href:a.href,onClick:a.navigate,class:d.value},g)}}}),jv=xS;function bS(e){if(!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)&&!e.defaultPrevented&&!(e.button!==void 0&&e.button!==0)){if(e.currentTarget&&e.currentTarget.getAttribute){const r=e.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(r))return}return e.preventDefault&&e.preventDefault(),!0}}function wS(e,r){for(const a in r){const u=r[a],d=e[a];if(typeof u=="string"){if(u!==d)return!1}else if(!Fa(d)||d.length!==u.length||u.some((g,m)=>g!==d[m]))return!1}return!0}function L_(e){return e?e.aliasOf?e.aliasOf.path:e.path:""}const R_=(e,r,a)=>e??r??a,MS=cv({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(e,{attrs:r,slots:a}){const u=ma(hm),d=gi(()=>e.route||u.value),g=ma(D_,0),m=gi(()=>{let P=Fi(g);const{matched:R}=d.value;let D;for(;(D=R[P])&&!D.components;)P++;return P}),l=gi(()=>d.value.matched[m.value]);$d(D_,gi(()=>m.value+1)),$d(_S,l),$d(hm,d);const M=ks();return rs(()=>[M.value,l.value,e.name],([P,R,D],[z,Z,W])=>{R&&(R.instances[D]=P,Z&&Z!==R&&P&&P===z&&(R.leaveGuards.size||(R.leaveGuards=Z.leaveGuards),R.updateGuards.size||(R.updateGuards=Z.updateGuards))),P&&R&&(!Z||!lu(R,Z)||!z)&&(R.enterCallbacks[D]||[]).forEach(J=>J(P))},{flush:"post"}),()=>{const P=d.value,R=e.name,D=l.value,z=D&&D.components[R];if(!z)return z_(a.default,{Component:z,route:P});const Z=D.props[R],W=Z?Z===!0?P.params:typeof Z=="function"?Z(P):Z:null,me=Cv(z,hr({},W,r,{onVnodeUnmounted:xe=>{xe.component.isUnmounted&&(D.instances[R]=null)},ref:M}));return z_(a.default,{Component:me,route:P})||me}}});function z_(e,r){if(!e)return null;const a=e(r);return a.length===1?a[0]:a}const SS=MS;function ES(e){const r=dS(e.routes,e),a=e.parseQuery||gS,u=e.stringifyQuery||P_,d=e.history,g=rh(),m=rh(),l=rh(),M=Cw(hl);let P=hl;Hc&&e.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const R=zf.bind(null,Ve=>""+Ve),D=zf.bind(null,FM),z=zf.bind(null,Ah);function Z(Ve,Et){let ut,Qe;return $v(Ve)?(ut=r.getRecordMatcher(Ve),Qe=Et):Qe=Ve,r.addRoute(Qe,ut)}function W(Ve){const Et=r.getRecordMatcher(Ve);Et&&r.removeRoute(Et)}function J(){return r.getRoutes().map(Ve=>Ve.record)}function me(Ve){return!!r.getRecordMatcher(Ve)}function xe(Ve,Et){if(Et=hr({},Et||M.value),typeof Ve=="string"){const ue=Of(a,Ve,Et.path),De=r.resolve({path:ue.path},Et),Fe=d.createHref(ue.fullPath);return hr(ue,De,{params:z(De.params),hash:Ah(ue.hash),redirectedFrom:void 0,href:Fe})}let ut;if(Ve.path!=null)ut=hr({},Ve,{path:Of(a,Ve.path,Et.path).path});else{const ue=hr({},Ve.params);for(const De in ue)ue[De]==null&&delete ue[De];ut=hr({},Ve,{params:D(ue)}),Et.params=D(Et.params)}const Qe=r.resolve(ut,Et),Di=Ve.hash||"";Qe.params=R(z(Qe.params));const zi=$M(u,hr({},Ve,{hash:RM(Di),path:Qe.path})),se=d.createHref(zi);return hr({fullPath:zi,hash:Di,query:u===P_?yS(Ve.query):Ve.query||{}},Qe,{redirectedFrom:void 0,href:se})}function Pe(Ve){return typeof Ve=="string"?Of(a,Ve,M.value.path):hr({},Ve)}function oe(Ve,Et){if(P!==Ve)return cu(8,{from:Et,to:Ve})}function Le(Ve){return dt(Ve)}function Ze(Ve){return Le(hr(Pe(Ve),{replace:!0}))}function Ke(Ve){const Et=Ve.matched[Ve.matched.length-1];if(Et&&Et.redirect){const{redirect:ut}=Et;let Qe=typeof ut=="function"?ut(Ve):ut;return typeof Qe=="string"&&(Qe=Qe.includes("?")||Qe.includes("#")?Qe=Pe(Qe):{path:Qe},Qe.params={}),hr({query:Ve.query,hash:Ve.hash,params:Qe.path!=null?{}:Ve.params},Qe)}}function dt(Ve,Et){const ut=P=xe(Ve),Qe=M.value,Di=Ve.state,zi=Ve.force,se=Ve.replace===!0,ue=Ke(ut);if(ue)return dt(hr(Pe(ue),{state:typeof ue=="object"?hr({},Di,ue.state):Di,force:zi,replace:se}),Et||ut);const De=ut;De.redirectedFrom=Et;let Fe;return!zi&&UM(u,Qe,ut)&&(Fe=cu(16,{to:De,from:Qe}),at(Qe,Qe,!0,!1)),(Fe?Promise.resolve(Fe):Ht(De,Qe)).catch(ce=>Io(ce)?Io(ce,2)?ce:yr(ce):hi(ce,De,Qe)).then(ce=>{if(ce){if(Io(ce,2))return dt(hr({replace:se},Pe(ce.to),{state:typeof ce.to=="object"?hr({},Di,ce.to.state):Di,force:zi}),Et||De)}else ce=li(De,Qe,!0,se,Di);return Rt(De,Qe,ce),ce})}function bt(Ve,Et){const ut=oe(Ve,Et);return ut?Promise.reject(ut):Promise.resolve()}function Pt(Ve){const Et=nr.values().next().value;return Et&&typeof Et.runWithContext=="function"?Et.runWithContext(Ve):Ve()}function Ht(Ve,Et){let ut;const[Qe,Di,zi]=TS(Ve,Et);ut=Ff(Qe.reverse(),"beforeRouteLeave",Ve,Et);for(const ue of Qe)ue.leaveGuards.forEach(De=>{ut.push(_l(De,Ve,Et))});const se=bt.bind(null,Ve,Et);return ut.push(se),Si(ut).then(()=>{ut=[];for(const ue of g.list())ut.push(_l(ue,Ve,Et));return ut.push(se),Si(ut)}).then(()=>{ut=Ff(Di,"beforeRouteUpdate",Ve,Et);for(const ue of Di)ue.updateGuards.forEach(De=>{ut.push(_l(De,Ve,Et))});return ut.push(se),Si(ut)}).then(()=>{ut=[];for(const ue of zi)if(ue.beforeEnter)if(Fa(ue.beforeEnter))for(const De of ue.beforeEnter)ut.push(_l(De,Ve,Et));else ut.push(_l(ue.beforeEnter,Ve,Et));return ut.push(se),Si(ut)}).then(()=>(Ve.matched.forEach(ue=>ue.enterCallbacks={}),ut=Ff(zi,"beforeRouteEnter",Ve,Et,Pt),ut.push(se),Si(ut))).then(()=>{ut=[];for(const ue of m.list())ut.push(_l(ue,Ve,Et));return ut.push(se),Si(ut)}).catch(ue=>Io(ue,8)?ue:Promise.reject(ue))}function Rt(Ve,Et,ut){l.list().forEach(Qe=>Pt(()=>Qe(Ve,Et,ut)))}function li(Ve,Et,ut,Qe,Di){const zi=oe(Ve,Et);if(zi)return zi;const se=Et===hl,ue=Hc?history.state:{};ut&&(Qe||se?d.replace(Ve.fullPath,hr({scroll:se&&ue&&ue.scroll},Di)):d.push(Ve.fullPath,Di)),M.value=Ve,at(Ve,Et,ut,se),yr()}let ct;function zt(){ct||(ct=d.listen((Ve,Et,ut)=>{if(!Zi.listening)return;const Qe=xe(Ve),Di=Ke(Qe);if(Di){dt(hr(Di,{replace:!0}),Qe).catch(_h);return}P=Qe;const zi=M.value;Hc&&XM(w_(zi.fullPath,ut.delta),Ip()),Ht(Qe,zi).catch(se=>Io(se,12)?se:Io(se,2)?(dt(se.to,Qe).then(ue=>{Io(ue,20)&&!ut.delta&&ut.type===Ph.pop&&d.go(-1,!1)}).catch(_h),Promise.reject()):(ut.delta&&d.go(-ut.delta,!1),hi(se,Qe,zi))).then(se=>{se=se||li(Qe,zi,!1),se&&(ut.delta&&!Io(se,8)?d.go(-ut.delta,!1):ut.type===Ph.pop&&Io(se,20)&&d.go(-1,!1)),Rt(Qe,zi,se)}).catch(_h)}))}let Bi=rh(),ti=rh(),ii;function hi(Ve,Et,ut){yr(Ve);const Qe=ti.list();return Qe.length?Qe.forEach(Di=>Di(Ve,Et,ut)):console.error(Ve),Promise.reject(Ve)}function Mi(){return ii&&M.value!==hl?Promise.resolve():new Promise((Ve,Et)=>{Bi.add([Ve,Et])})}function yr(Ve){return ii||(ii=!Ve,zt(),Bi.list().forEach(([Et,ut])=>Ve?ut(Ve):Et()),Bi.reset()),Ve}function at(Ve,Et,ut,Qe){const{scrollBehavior:Di}=e;if(!Hc||!Di)return Promise.resolve();const zi=!ut&&KM(w_(Ve.fullPath,0))||(Qe||!ut)&&history.state&&history.state.scroll||null;return Bm().then(()=>Di(Ve,Et,zi)).then(se=>se&&WM(se)).catch(se=>hi(se,Ve,Et))}const tt=Ve=>d.go(Ve);let Je;const nr=new Set,Zi={currentRoute:M,listening:!0,addRoute:Z,removeRoute:W,hasRoute:me,getRoutes:J,resolve:xe,options:e,push:Le,replace:Ze,go:tt,back:()=>tt(-1),forward:()=>tt(1),beforeEach:g.add,beforeResolve:m.add,afterEach:l.add,onError:ti.add,isReady:Mi,install(Ve){const Et=this;Ve.component("RouterLink",jv),Ve.component("RouterView",SS),Ve.config.globalProperties.$router=Et,Object.defineProperty(Ve.config.globalProperties,"$route",{enumerable:!0,get:()=>Fi(M)}),Hc&&!Je&&M.value===hl&&(Je=!0,Le(d.location).catch(Di=>{}));const ut={};for(const Di in hl)Object.defineProperty(ut,Di,{get:()=>M.value[Di],enumerable:!0});Ve.provide(Ap,Et),Ve.provide(Gm,Z0(ut)),Ve.provide(hm,M);const Qe=Ve.unmount;nr.add(Ve),Ve.unmount=function(){nr.delete(Ve),nr.size<1&&(P=hl,ct&&ct(),ct=null,M.value=hl,Je=!1,ii=!1),Qe()}}};function Si(Ve){return Ve.reduce((Et,ut)=>Et.then(()=>Pt(ut)),Promise.resolve())}return Zi}function TS(e,r){const a=[],u=[],d=[],g=Math.max(r.matched.length,e.matched.length);for(let m=0;m<g;m++){const l=r.matched[m];l&&(e.matched.find(P=>lu(P,l))?u.push(l):a.push(l));const M=e.matched[m];M&&(r.matched.find(P=>lu(P,M))||d.push(M))}return[a,u,d]}function jh(){return ma(Ap)}function qh(){return ma(Gm)}const dn=Lo("AddressStore",{state:()=>({addressData:{}}),actions:{async fillAddressData(e){try{console.log("Address - fillAddressData is running, address:",e);const r=await fetch(`https://api.phila.gov/ais/v1/search/${e}?include_units=false`);if(r.ok)console.log("Address - await resolved and HTTP status is successful"),this.addressData=await r.json();else{console.log("Address - await resolved but HTTP status was not successful"),this.addressData={};const a=Js();a.currentAddress=""}}catch{console.error("Address - await never resolved, failed to fetch address data")}}},getters:{getOpaOwners:e=>e.addressData.features[0].properties.opa_owners.join(", ")}});function qv(e,r){return function(){return e.apply(r,arguments)}}const{toString:CS}=Object.prototype,{getPrototypeOf:Hm}=Object,Pp=(e=>r=>{const a=CS.call(r);return e[a]||(e[a]=a.slice(8,-1).toLowerCase())})(Object.create(null)),oo=e=>(e=e.toLowerCase(),r=>Pp(r)===e),Dp=e=>r=>typeof r===e,{isArray:gu}=Array,Dh=Dp("undefined");function IS(e){return e!==null&&!Dh(e)&&e.constructor!==null&&!Dh(e.constructor)&&ga(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const Gv=oo("ArrayBuffer");function AS(e){let r;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?r=ArrayBuffer.isView(e):r=e&&e.buffer&&Gv(e.buffer),r}const PS=Dp("string"),ga=Dp("function"),Hv=Dp("number"),kp=e=>e!==null&&typeof e=="object",DS=e=>e===!0||e===!1,qd=e=>{if(Pp(e)!=="object")return!1;const r=Hm(e);return(r===null||r===Object.prototype||Object.getPrototypeOf(r)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},kS=oo("Date"),LS=oo("File"),RS=oo("Blob"),zS=oo("FileList"),OS=e=>kp(e)&&ga(e.pipe),FS=e=>{let r;return e&&(typeof FormData=="function"&&e instanceof FormData||ga(e.append)&&((r=Pp(e))==="formdata"||r==="object"&&ga(e.toString)&&e.toString()==="[object FormData]"))},BS=oo("URLSearchParams"),NS=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Gh(e,r,{allOwnKeys:a=!1}={}){if(e===null||typeof e>"u")return;let u,d;if(typeof e!="object"&&(e=[e]),gu(e))for(u=0,d=e.length;u<d;u++)r.call(null,e[u],u,e);else{const g=a?Object.getOwnPropertyNames(e):Object.keys(e),m=g.length;let l;for(u=0;u<m;u++)l=g[u],r.call(null,e[l],l,e)}}function Zv(e,r){r=r.toLowerCase();const a=Object.keys(e);let u=a.length,d;for(;u-- >0;)if(d=a[u],r===d.toLowerCase())return d;return null}const Wv=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Xv=e=>!Dh(e)&&e!==Wv;function dm(){const{caseless:e}=Xv(this)&&this||{},r={},a=(u,d)=>{const g=e&&Zv(r,d)||d;qd(r[g])&&qd(u)?r[g]=dm(r[g],u):qd(u)?r[g]=dm({},u):gu(u)?r[g]=u.slice():r[g]=u};for(let u=0,d=arguments.length;u<d;u++)arguments[u]&&Gh(arguments[u],a);return r}const $S=(e,r,a,{allOwnKeys:u}={})=>(Gh(r,(d,g)=>{a&&ga(d)?e[g]=qv(d,a):e[g]=d},{allOwnKeys:u}),e),US=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),VS=(e,r,a,u)=>{e.prototype=Object.create(r.prototype,u),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:r.prototype}),a&&Object.assign(e.prototype,a)},jS=(e,r,a,u)=>{let d,g,m;const l={};if(r=r||{},e==null)return r;do{for(d=Object.getOwnPropertyNames(e),g=d.length;g-- >0;)m=d[g],(!u||u(m,e,r))&&!l[m]&&(r[m]=e[m],l[m]=!0);e=a!==!1&&Hm(e)}while(e&&(!a||a(e,r))&&e!==Object.prototype);return r},qS=(e,r,a)=>{e=String(e),(a===void 0||a>e.length)&&(a=e.length),a-=r.length;const u=e.indexOf(r,a);return u!==-1&&u===a},GS=e=>{if(!e)return null;if(gu(e))return e;let r=e.length;if(!Hv(r))return null;const a=new Array(r);for(;r-- >0;)a[r]=e[r];return a},HS=(e=>r=>e&&r instanceof e)(typeof Uint8Array<"u"&&Hm(Uint8Array)),ZS=(e,r)=>{const u=(e&&e[Symbol.iterator]).call(e);let d;for(;(d=u.next())&&!d.done;){const g=d.value;r.call(e,g[0],g[1])}},WS=(e,r)=>{let a;const u=[];for(;(a=e.exec(r))!==null;)u.push(a);return u},XS=oo("HTMLFormElement"),KS=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(a,u,d){return u.toUpperCase()+d}),O_=(({hasOwnProperty:e})=>(r,a)=>e.call(r,a))(Object.prototype),YS=oo("RegExp"),Kv=(e,r)=>{const a=Object.getOwnPropertyDescriptors(e),u={};Gh(a,(d,g)=>{let m;(m=r(d,g,e))!==!1&&(u[g]=m||d)}),Object.defineProperties(e,u)},JS=e=>{Kv(e,(r,a)=>{if(ga(e)&&["arguments","caller","callee"].indexOf(a)!==-1)return!1;const u=e[a];if(ga(u)){if(r.enumerable=!1,"writable"in r){r.writable=!1;return}r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+a+"'")})}})},QS=(e,r)=>{const a={},u=d=>{d.forEach(g=>{a[g]=!0})};return gu(e)?u(e):u(String(e).split(r)),a},eE=()=>{},tE=(e,r)=>(e=+e,Number.isFinite(e)?e:r),Bf="abcdefghijklmnopqrstuvwxyz",F_="0123456789",Yv={DIGIT:F_,ALPHA:Bf,ALPHA_DIGIT:Bf+Bf.toUpperCase()+F_},iE=(e=16,r=Yv.ALPHA_DIGIT)=>{let a="";const{length:u}=r;for(;e--;)a+=r[Math.random()*u|0];return a};function rE(e){return!!(e&&ga(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])}const nE=e=>{const r=new Array(10),a=(u,d)=>{if(kp(u)){if(r.indexOf(u)>=0)return;if(!("toJSON"in u)){r[d]=u;const g=gu(u)?[]:{};return Gh(u,(m,l)=>{const M=a(m,d+1);!Dh(M)&&(g[l]=M)}),r[d]=void 0,g}}return u};return a(e,0)},sE=oo("AsyncFunction"),aE=e=>e&&(kp(e)||ga(e))&&ga(e.then)&&ga(e.catch),Xe={isArray:gu,isArrayBuffer:Gv,isBuffer:IS,isFormData:FS,isArrayBufferView:AS,isString:PS,isNumber:Hv,isBoolean:DS,isObject:kp,isPlainObject:qd,isUndefined:Dh,isDate:kS,isFile:LS,isBlob:RS,isRegExp:YS,isFunction:ga,isStream:OS,isURLSearchParams:BS,isTypedArray:HS,isFileList:zS,forEach:Gh,merge:dm,extend:$S,trim:NS,stripBOM:US,inherits:VS,toFlatObject:jS,kindOf:Pp,kindOfTest:oo,endsWith:qS,toArray:GS,forEachEntry:ZS,matchAll:WS,isHTMLForm:XS,hasOwnProperty:O_,hasOwnProp:O_,reduceDescriptors:Kv,freezeMethods:JS,toObjectSet:QS,toCamelCase:KS,noop:eE,toFiniteNumber:tE,findKey:Zv,global:Wv,isContextDefined:Xv,ALPHABET:Yv,generateString:iE,isSpecCompliantForm:rE,toJSONObject:nE,isAsyncFn:sE,isThenable:aE};function Hi(e,r,a,u,d){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",r&&(this.code=r),a&&(this.config=a),u&&(this.request=u),d&&(this.response=d)}Xe.inherits(Hi,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Xe.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const Jv=Hi.prototype,Qv={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{Qv[e]={value:e}});Object.defineProperties(Hi,Qv);Object.defineProperty(Jv,"isAxiosError",{value:!0});Hi.from=(e,r,a,u,d,g)=>{const m=Object.create(Jv);return Xe.toFlatObject(e,m,function(M){return M!==Error.prototype},l=>l!=="isAxiosError"),Hi.call(m,e.message,r,a,u,d),m.cause=e,m.name=e.name,g&&Object.assign(m,g),m};const oE=null;function pm(e){return Xe.isPlainObject(e)||Xe.isArray(e)}function ex(e){return Xe.endsWith(e,"[]")?e.slice(0,-2):e}function B_(e,r,a){return e?e.concat(r).map(function(d,g){return d=ex(d),!a&&g?"["+d+"]":d}).join(a?".":""):r}function lE(e){return Xe.isArray(e)&&!e.some(pm)}const cE=Xe.toFlatObject(Xe,{},null,function(r){return/^is[A-Z]/.test(r)});function Lp(e,r,a){if(!Xe.isObject(e))throw new TypeError("target must be an object");r=r||new FormData,a=Xe.toFlatObject(a,{metaTokens:!0,dots:!1,indexes:!1},!1,function(J,me){return!Xe.isUndefined(me[J])});const u=a.metaTokens,d=a.visitor||R,g=a.dots,m=a.indexes,M=(a.Blob||typeof Blob<"u"&&Blob)&&Xe.isSpecCompliantForm(r);if(!Xe.isFunction(d))throw new TypeError("visitor must be a function");function P(W){if(W===null)return"";if(Xe.isDate(W))return W.toISOString();if(!M&&Xe.isBlob(W))throw new Hi("Blob is not supported. Use a Buffer instead.");return Xe.isArrayBuffer(W)||Xe.isTypedArray(W)?M&&typeof Blob=="function"?new Blob([W]):Buffer.from(W):W}function R(W,J,me){let xe=W;if(W&&!me&&typeof W=="object"){if(Xe.endsWith(J,"{}"))J=u?J:J.slice(0,-2),W=JSON.stringify(W);else if(Xe.isArray(W)&&lE(W)||(Xe.isFileList(W)||Xe.endsWith(J,"[]"))&&(xe=Xe.toArray(W)))return J=ex(J),xe.forEach(function(oe,Le){!(Xe.isUndefined(oe)||oe===null)&&r.append(m===!0?B_([J],Le,g):m===null?J:J+"[]",P(oe))}),!1}return pm(W)?!0:(r.append(B_(me,J,g),P(W)),!1)}const D=[],z=Object.assign(cE,{defaultVisitor:R,convertValue:P,isVisitable:pm});function Z(W,J){if(!Xe.isUndefined(W)){if(D.indexOf(W)!==-1)throw Error("Circular reference detected in "+J.join("."));D.push(W),Xe.forEach(W,function(xe,Pe){(!(Xe.isUndefined(xe)||xe===null)&&d.call(r,xe,Xe.isString(Pe)?Pe.trim():Pe,J,z))===!0&&Z(xe,J?J.concat(Pe):[Pe])}),D.pop()}}if(!Xe.isObject(e))throw new TypeError("data must be an object");return Z(e),r}function N_(e){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(u){return r[u]})}function Zm(e,r){this._pairs=[],e&&Lp(e,this,r)}const tx=Zm.prototype;tx.append=function(r,a){this._pairs.push([r,a])};tx.toString=function(r){const a=r?function(u){return r.call(this,u,N_)}:N_;return this._pairs.map(function(d){return a(d[0])+"="+a(d[1])},"").join("&")};function uE(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function ix(e,r,a){if(!r)return e;const u=a&&a.encode||uE,d=a&&a.serialize;let g;if(d?g=d(r,a):g=Xe.isURLSearchParams(r)?r.toString():new Zm(r,a).toString(u),g){const m=e.indexOf("#");m!==-1&&(e=e.slice(0,m)),e+=(e.indexOf("?")===-1?"?":"&")+g}return e}class $_{constructor(){this.handlers=[]}use(r,a,u){return this.handlers.push({fulfilled:r,rejected:a,synchronous:u?u.synchronous:!1,runWhen:u?u.runWhen:null}),this.handlers.length-1}eject(r){this.handlers[r]&&(this.handlers[r]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(r){Xe.forEach(this.handlers,function(u){u!==null&&r(u)})}}const rx={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},hE=typeof URLSearchParams<"u"?URLSearchParams:Zm,dE=typeof FormData<"u"?FormData:null,pE=typeof Blob<"u"?Blob:null,fE={isBrowser:!0,classes:{URLSearchParams:hE,FormData:dE,Blob:pE},protocols:["http","https","file","blob","url","data"]},nx=typeof window<"u"&&typeof document<"u",mE=(e=>nx&&["ReactNative","NativeScript","NS"].indexOf(e)<0)(typeof navigator<"u"&&navigator.product),gE=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",yE=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:nx,hasStandardBrowserEnv:mE,hasStandardBrowserWebWorkerEnv:gE},Symbol.toStringTag,{value:"Module"})),io={...yE,...fE};function _E(e,r){return Lp(e,new io.classes.URLSearchParams,Object.assign({visitor:function(a,u,d,g){return io.isNode&&Xe.isBuffer(a)?(this.append(u,a.toString("base64")),!1):g.defaultVisitor.apply(this,arguments)}},r))}function vE(e){return Xe.matchAll(/\w+|\[(\w*)]/g,e).map(r=>r[0]==="[]"?"":r[1]||r[0])}function xE(e){const r={},a=Object.keys(e);let u;const d=a.length;let g;for(u=0;u<d;u++)g=a[u],r[g]=e[g];return r}function sx(e){function r(a,u,d,g){let m=a[g++];if(m==="__proto__")return!0;const l=Number.isFinite(+m),M=g>=a.length;return m=!m&&Xe.isArray(d)?d.length:m,M?(Xe.hasOwnProp(d,m)?d[m]=[d[m],u]:d[m]=u,!l):((!d[m]||!Xe.isObject(d[m]))&&(d[m]=[]),r(a,u,d[m],g)&&Xe.isArray(d[m])&&(d[m]=xE(d[m])),!l)}if(Xe.isFormData(e)&&Xe.isFunction(e.entries)){const a={};return Xe.forEachEntry(e,(u,d)=>{r(vE(u),d,a,0)}),a}return null}function bE(e,r,a){if(Xe.isString(e))try{return(r||JSON.parse)(e),Xe.trim(e)}catch(u){if(u.name!=="SyntaxError")throw u}return(a||JSON.stringify)(e)}const Wm={transitional:rx,adapter:["xhr","http"],transformRequest:[function(r,a){const u=a.getContentType()||"",d=u.indexOf("application/json")>-1,g=Xe.isObject(r);if(g&&Xe.isHTMLForm(r)&&(r=new FormData(r)),Xe.isFormData(r))return d?JSON.stringify(sx(r)):r;if(Xe.isArrayBuffer(r)||Xe.isBuffer(r)||Xe.isStream(r)||Xe.isFile(r)||Xe.isBlob(r))return r;if(Xe.isArrayBufferView(r))return r.buffer;if(Xe.isURLSearchParams(r))return a.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),r.toString();let l;if(g){if(u.indexOf("application/x-www-form-urlencoded")>-1)return _E(r,this.formSerializer).toString();if((l=Xe.isFileList(r))||u.indexOf("multipart/form-data")>-1){const M=this.env&&this.env.FormData;return Lp(l?{"files[]":r}:r,M&&new M,this.formSerializer)}}return g||d?(a.setContentType("application/json",!1),bE(r)):r}],transformResponse:[function(r){const a=this.transitional||Wm.transitional,u=a&&a.forcedJSONParsing,d=this.responseType==="json";if(r&&Xe.isString(r)&&(u&&!this.responseType||d)){const m=!(a&&a.silentJSONParsing)&&d;try{return JSON.parse(r)}catch(l){if(m)throw l.name==="SyntaxError"?Hi.from(l,Hi.ERR_BAD_RESPONSE,this,null,this.response):l}}return r}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:io.classes.FormData,Blob:io.classes.Blob},validateStatus:function(r){return r>=200&&r<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Xe.forEach(["delete","get","head","post","put","patch"],e=>{Wm.headers[e]={}});const Xm=Wm,wE=Xe.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ME=e=>{const r={};let a,u,d;return e&&e.split(`
`).forEach(function(m){d=m.indexOf(":"),a=m.substring(0,d).trim().toLowerCase(),u=m.substring(d+1).trim(),!(!a||r[a]&&wE[a])&&(a==="set-cookie"?r[a]?r[a].push(u):r[a]=[u]:r[a]=r[a]?r[a]+", "+u:u)}),r},U_=Symbol("internals");function nh(e){return e&&String(e).trim().toLowerCase()}function Gd(e){return e===!1||e==null?e:Xe.isArray(e)?e.map(Gd):String(e)}function SE(e){const r=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let u;for(;u=a.exec(e);)r[u[1]]=u[2];return r}const EE=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function Nf(e,r,a,u,d){if(Xe.isFunction(u))return u.call(this,r,a);if(d&&(r=a),!!Xe.isString(r)){if(Xe.isString(u))return r.indexOf(u)!==-1;if(Xe.isRegExp(u))return u.test(r)}}function TE(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(r,a,u)=>a.toUpperCase()+u)}function CE(e,r){const a=Xe.toCamelCase(" "+r);["get","set","has"].forEach(u=>{Object.defineProperty(e,u+a,{value:function(d,g,m){return this[u].call(this,r,d,g,m)},configurable:!0})})}class Rp{constructor(r){r&&this.set(r)}set(r,a,u){const d=this;function g(l,M,P){const R=nh(M);if(!R)throw new Error("header name must be a non-empty string");const D=Xe.findKey(d,R);(!D||d[D]===void 0||P===!0||P===void 0&&d[D]!==!1)&&(d[D||M]=Gd(l))}const m=(l,M)=>Xe.forEach(l,(P,R)=>g(P,R,M));return Xe.isPlainObject(r)||r instanceof this.constructor?m(r,a):Xe.isString(r)&&(r=r.trim())&&!EE(r)?m(ME(r),a):r!=null&&g(a,r,u),this}get(r,a){if(r=nh(r),r){const u=Xe.findKey(this,r);if(u){const d=this[u];if(!a)return d;if(a===!0)return SE(d);if(Xe.isFunction(a))return a.call(this,d,u);if(Xe.isRegExp(a))return a.exec(d);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,a){if(r=nh(r),r){const u=Xe.findKey(this,r);return!!(u&&this[u]!==void 0&&(!a||Nf(this,this[u],u,a)))}return!1}delete(r,a){const u=this;let d=!1;function g(m){if(m=nh(m),m){const l=Xe.findKey(u,m);l&&(!a||Nf(u,u[l],l,a))&&(delete u[l],d=!0)}}return Xe.isArray(r)?r.forEach(g):g(r),d}clear(r){const a=Object.keys(this);let u=a.length,d=!1;for(;u--;){const g=a[u];(!r||Nf(this,this[g],g,r,!0))&&(delete this[g],d=!0)}return d}normalize(r){const a=this,u={};return Xe.forEach(this,(d,g)=>{const m=Xe.findKey(u,g);if(m){a[m]=Gd(d),delete a[g];return}const l=r?TE(g):String(g).trim();l!==g&&delete a[g],a[l]=Gd(d),u[l]=!0}),this}concat(...r){return this.constructor.concat(this,...r)}toJSON(r){const a=Object.create(null);return Xe.forEach(this,(u,d)=>{u!=null&&u!==!1&&(a[d]=r&&Xe.isArray(u)?u.join(", "):u)}),a}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([r,a])=>r+": "+a).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r,...a){const u=new this(r);return a.forEach(d=>u.set(d)),u}static accessor(r){const u=(this[U_]=this[U_]={accessors:{}}).accessors,d=this.prototype;function g(m){const l=nh(m);u[l]||(CE(d,m),u[l]=!0)}return Xe.isArray(r)?r.forEach(g):g(r),this}}Rp.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Xe.reduceDescriptors(Rp.prototype,({value:e},r)=>{let a=r[0].toUpperCase()+r.slice(1);return{get:()=>e,set(u){this[a]=u}}});Xe.freezeMethods(Rp);const Do=Rp;function $f(e,r){const a=this||Xm,u=r||a,d=Do.from(u.headers);let g=u.data;return Xe.forEach(e,function(l){g=l.call(a,g,d.normalize(),r?r.status:void 0)}),d.normalize(),g}function ax(e){return!!(e&&e.__CANCEL__)}function Hh(e,r,a){Hi.call(this,e??"canceled",Hi.ERR_CANCELED,r,a),this.name="CanceledError"}Xe.inherits(Hh,Hi,{__CANCEL__:!0});function IE(e,r,a){const u=a.config.validateStatus;!a.status||!u||u(a.status)?e(a):r(new Hi("Request failed with status code "+a.status,[Hi.ERR_BAD_REQUEST,Hi.ERR_BAD_RESPONSE][Math.floor(a.status/100)-4],a.config,a.request,a))}const AE=io.hasStandardBrowserEnv?{write(e,r,a,u,d,g){const m=[e+"="+encodeURIComponent(r)];Xe.isNumber(a)&&m.push("expires="+new Date(a).toGMTString()),Xe.isString(u)&&m.push("path="+u),Xe.isString(d)&&m.push("domain="+d),g===!0&&m.push("secure"),document.cookie=m.join("; ")},read(e){const r=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function PE(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function DE(e,r){return r?e.replace(/\/?\/$/,"")+"/"+r.replace(/^\/+/,""):e}function ox(e,r){return e&&!PE(r)?DE(e,r):r}const kE=io.hasStandardBrowserEnv?function(){const r=/(msie|trident)/i.test(navigator.userAgent),a=document.createElement("a");let u;function d(g){let m=g;return r&&(a.setAttribute("href",m),m=a.href),a.setAttribute("href",m),{href:a.href,protocol:a.protocol?a.protocol.replace(/:$/,""):"",host:a.host,search:a.search?a.search.replace(/^\?/,""):"",hash:a.hash?a.hash.replace(/^#/,""):"",hostname:a.hostname,port:a.port,pathname:a.pathname.charAt(0)==="/"?a.pathname:"/"+a.pathname}}return u=d(window.location.href),function(m){const l=Xe.isString(m)?d(m):m;return l.protocol===u.protocol&&l.host===u.host}}():function(){return function(){return!0}}();function LE(e){const r=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return r&&r[1]||""}function RE(e,r){e=e||10;const a=new Array(e),u=new Array(e);let d=0,g=0,m;return r=r!==void 0?r:1e3,function(M){const P=Date.now(),R=u[g];m||(m=P),a[d]=M,u[d]=P;let D=g,z=0;for(;D!==d;)z+=a[D++],D=D%e;if(d=(d+1)%e,d===g&&(g=(g+1)%e),P-m<r)return;const Z=R&&P-R;return Z?Math.round(z*1e3/Z):void 0}}function V_(e,r){let a=0;const u=RE(50,250);return d=>{const g=d.loaded,m=d.lengthComputable?d.total:void 0,l=g-a,M=u(l),P=g<=m;a=g;const R={loaded:g,total:m,progress:m?g/m:void 0,bytes:l,rate:M||void 0,estimated:M&&m&&P?(m-g)/M:void 0,event:d};R[r?"download":"upload"]=!0,e(R)}}const zE=typeof XMLHttpRequest<"u",OE=zE&&function(e){return new Promise(function(a,u){let d=e.data;const g=Do.from(e.headers).normalize();let{responseType:m,withXSRFToken:l}=e,M;function P(){e.cancelToken&&e.cancelToken.unsubscribe(M),e.signal&&e.signal.removeEventListener("abort",M)}let R;if(Xe.isFormData(d)){if(io.hasStandardBrowserEnv||io.hasStandardBrowserWebWorkerEnv)g.setContentType(!1);else if((R=g.getContentType())!==!1){const[J,...me]=R?R.split(";").map(xe=>xe.trim()).filter(Boolean):[];g.setContentType([J||"multipart/form-data",...me].join("; "))}}let D=new XMLHttpRequest;if(e.auth){const J=e.auth.username||"",me=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";g.set("Authorization","Basic "+btoa(J+":"+me))}const z=ox(e.baseURL,e.url);D.open(e.method.toUpperCase(),ix(z,e.params,e.paramsSerializer),!0),D.timeout=e.timeout;function Z(){if(!D)return;const J=Do.from("getAllResponseHeaders"in D&&D.getAllResponseHeaders()),xe={data:!m||m==="text"||m==="json"?D.responseText:D.response,status:D.status,statusText:D.statusText,headers:J,config:e,request:D};IE(function(oe){a(oe),P()},function(oe){u(oe),P()},xe),D=null}if("onloadend"in D?D.onloadend=Z:D.onreadystatechange=function(){!D||D.readyState!==4||D.status===0&&!(D.responseURL&&D.responseURL.indexOf("file:")===0)||setTimeout(Z)},D.onabort=function(){D&&(u(new Hi("Request aborted",Hi.ECONNABORTED,e,D)),D=null)},D.onerror=function(){u(new Hi("Network Error",Hi.ERR_NETWORK,e,D)),D=null},D.ontimeout=function(){let me=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";const xe=e.transitional||rx;e.timeoutErrorMessage&&(me=e.timeoutErrorMessage),u(new Hi(me,xe.clarifyTimeoutError?Hi.ETIMEDOUT:Hi.ECONNABORTED,e,D)),D=null},io.hasStandardBrowserEnv&&(l&&Xe.isFunction(l)&&(l=l(e)),l||l!==!1&&kE(z))){const J=e.xsrfHeaderName&&e.xsrfCookieName&&AE.read(e.xsrfCookieName);J&&g.set(e.xsrfHeaderName,J)}d===void 0&&g.setContentType(null),"setRequestHeader"in D&&Xe.forEach(g.toJSON(),function(me,xe){D.setRequestHeader(xe,me)}),Xe.isUndefined(e.withCredentials)||(D.withCredentials=!!e.withCredentials),m&&m!=="json"&&(D.responseType=e.responseType),typeof e.onDownloadProgress=="function"&&D.addEventListener("progress",V_(e.onDownloadProgress,!0)),typeof e.onUploadProgress=="function"&&D.upload&&D.upload.addEventListener("progress",V_(e.onUploadProgress)),(e.cancelToken||e.signal)&&(M=J=>{D&&(u(!J||J.type?new Hh(null,e,D):J),D.abort(),D=null)},e.cancelToken&&e.cancelToken.subscribe(M),e.signal&&(e.signal.aborted?M():e.signal.addEventListener("abort",M)));const W=LE(z);if(W&&io.protocols.indexOf(W)===-1){u(new Hi("Unsupported protocol "+W+":",Hi.ERR_BAD_REQUEST,e));return}D.send(d||null)})},fm={http:oE,xhr:OE};Xe.forEach(fm,(e,r)=>{if(e){try{Object.defineProperty(e,"name",{value:r})}catch{}Object.defineProperty(e,"adapterName",{value:r})}});const j_=e=>`- ${e}`,FE=e=>Xe.isFunction(e)||e===null||e===!1,lx={getAdapter:e=>{e=Xe.isArray(e)?e:[e];const{length:r}=e;let a,u;const d={};for(let g=0;g<r;g++){a=e[g];let m;if(u=a,!FE(a)&&(u=fm[(m=String(a)).toLowerCase()],u===void 0))throw new Hi(`Unknown adapter '${m}'`);if(u)break;d[m||"#"+g]=u}if(!u){const g=Object.entries(d).map(([l,M])=>`adapter ${l} `+(M===!1?"is not supported by the environment":"is not available in the build"));let m=r?g.length>1?`since :
`+g.map(j_).join(`
`):" "+j_(g[0]):"as no adapter specified";throw new Hi("There is no suitable adapter to dispatch the request "+m,"ERR_NOT_SUPPORT")}return u},adapters:fm};function Uf(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Hh(null,e)}function q_(e){return Uf(e),e.headers=Do.from(e.headers),e.data=$f.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),lx.getAdapter(e.adapter||Xm.adapter)(e).then(function(u){return Uf(e),u.data=$f.call(e,e.transformResponse,u),u.headers=Do.from(u.headers),u},function(u){return ax(u)||(Uf(e),u&&u.response&&(u.response.data=$f.call(e,e.transformResponse,u.response),u.response.headers=Do.from(u.response.headers))),Promise.reject(u)})}const G_=e=>e instanceof Do?{...e}:e;function uu(e,r){r=r||{};const a={};function u(P,R,D){return Xe.isPlainObject(P)&&Xe.isPlainObject(R)?Xe.merge.call({caseless:D},P,R):Xe.isPlainObject(R)?Xe.merge({},R):Xe.isArray(R)?R.slice():R}function d(P,R,D){if(Xe.isUndefined(R)){if(!Xe.isUndefined(P))return u(void 0,P,D)}else return u(P,R,D)}function g(P,R){if(!Xe.isUndefined(R))return u(void 0,R)}function m(P,R){if(Xe.isUndefined(R)){if(!Xe.isUndefined(P))return u(void 0,P)}else return u(void 0,R)}function l(P,R,D){if(D in r)return u(P,R);if(D in e)return u(void 0,P)}const M={url:g,method:g,data:g,baseURL:m,transformRequest:m,transformResponse:m,paramsSerializer:m,timeout:m,timeoutMessage:m,withCredentials:m,withXSRFToken:m,adapter:m,responseType:m,xsrfCookieName:m,xsrfHeaderName:m,onUploadProgress:m,onDownloadProgress:m,decompress:m,maxContentLength:m,maxBodyLength:m,beforeRedirect:m,transport:m,httpAgent:m,httpsAgent:m,cancelToken:m,socketPath:m,responseEncoding:m,validateStatus:l,headers:(P,R)=>d(G_(P),G_(R),!0)};return Xe.forEach(Object.keys(Object.assign({},e,r)),function(R){const D=M[R]||d,z=D(e[R],r[R],R);Xe.isUndefined(z)&&D!==l||(a[R]=z)}),a}const cx="1.6.8",Km={};["object","boolean","number","function","string","symbol"].forEach((e,r)=>{Km[e]=function(u){return typeof u===e||"a"+(r<1?"n ":" ")+e}});const H_={};Km.transitional=function(r,a,u){function d(g,m){return"[Axios v"+cx+"] Transitional option '"+g+"'"+m+(u?". "+u:"")}return(g,m,l)=>{if(r===!1)throw new Hi(d(m," has been removed"+(a?" in "+a:"")),Hi.ERR_DEPRECATED);return a&&!H_[m]&&(H_[m]=!0,console.warn(d(m," has been deprecated since v"+a+" and will be removed in the near future"))),r?r(g,m,l):!0}};function BE(e,r,a){if(typeof e!="object")throw new Hi("options must be an object",Hi.ERR_BAD_OPTION_VALUE);const u=Object.keys(e);let d=u.length;for(;d-- >0;){const g=u[d],m=r[g];if(m){const l=e[g],M=l===void 0||m(l,g,e);if(M!==!0)throw new Hi("option "+g+" must be "+M,Hi.ERR_BAD_OPTION_VALUE);continue}if(a!==!0)throw new Hi("Unknown option "+g,Hi.ERR_BAD_OPTION)}}const mm={assertOptions:BE,validators:Km},dl=mm.validators;class sp{constructor(r){this.defaults=r,this.interceptors={request:new $_,response:new $_}}async request(r,a){try{return await this._request(r,a)}catch(u){if(u instanceof Error){let d;Error.captureStackTrace?Error.captureStackTrace(d={}):d=new Error;const g=d.stack?d.stack.replace(/^.+\n/,""):"";u.stack?g&&!String(u.stack).endsWith(g.replace(/^.+\n.+\n/,""))&&(u.stack+=`
`+g):u.stack=g}throw u}}_request(r,a){typeof r=="string"?(a=a||{},a.url=r):a=r||{},a=uu(this.defaults,a);const{transitional:u,paramsSerializer:d,headers:g}=a;u!==void 0&&mm.assertOptions(u,{silentJSONParsing:dl.transitional(dl.boolean),forcedJSONParsing:dl.transitional(dl.boolean),clarifyTimeoutError:dl.transitional(dl.boolean)},!1),d!=null&&(Xe.isFunction(d)?a.paramsSerializer={serialize:d}:mm.assertOptions(d,{encode:dl.function,serialize:dl.function},!0)),a.method=(a.method||this.defaults.method||"get").toLowerCase();let m=g&&Xe.merge(g.common,g[a.method]);g&&Xe.forEach(["delete","get","head","post","put","patch","common"],W=>{delete g[W]}),a.headers=Do.concat(m,g);const l=[];let M=!0;this.interceptors.request.forEach(function(J){typeof J.runWhen=="function"&&J.runWhen(a)===!1||(M=M&&J.synchronous,l.unshift(J.fulfilled,J.rejected))});const P=[];this.interceptors.response.forEach(function(J){P.push(J.fulfilled,J.rejected)});let R,D=0,z;if(!M){const W=[q_.bind(this),void 0];for(W.unshift.apply(W,l),W.push.apply(W,P),z=W.length,R=Promise.resolve(a);D<z;)R=R.then(W[D++],W[D++]);return R}z=l.length;let Z=a;for(D=0;D<z;){const W=l[D++],J=l[D++];try{Z=W(Z)}catch(me){J.call(this,me);break}}try{R=q_.call(this,Z)}catch(W){return Promise.reject(W)}for(D=0,z=P.length;D<z;)R=R.then(P[D++],P[D++]);return R}getUri(r){r=uu(this.defaults,r);const a=ox(r.baseURL,r.url);return ix(a,r.params,r.paramsSerializer)}}Xe.forEach(["delete","get","head","options"],function(r){sp.prototype[r]=function(a,u){return this.request(uu(u||{},{method:r,url:a,data:(u||{}).data}))}});Xe.forEach(["post","put","patch"],function(r){function a(u){return function(g,m,l){return this.request(uu(l||{},{method:r,headers:u?{"Content-Type":"multipart/form-data"}:{},url:g,data:m}))}}sp.prototype[r]=a(),sp.prototype[r+"Form"]=a(!0)});const Hd=sp;class Ym{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let a;this.promise=new Promise(function(g){a=g});const u=this;this.promise.then(d=>{if(!u._listeners)return;let g=u._listeners.length;for(;g-- >0;)u._listeners[g](d);u._listeners=null}),this.promise.then=d=>{let g;const m=new Promise(l=>{u.subscribe(l),g=l}).then(d);return m.cancel=function(){u.unsubscribe(g)},m},r(function(g,m,l){u.reason||(u.reason=new Hh(g,m,l),a(u.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){if(this.reason){r(this.reason);return}this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const a=this._listeners.indexOf(r);a!==-1&&this._listeners.splice(a,1)}static source(){let r;return{token:new Ym(function(d){r=d}),cancel:r}}}const NE=Ym;function $E(e){return function(a){return e.apply(null,a)}}function UE(e){return Xe.isObject(e)&&e.isAxiosError===!0}const gm={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(gm).forEach(([e,r])=>{gm[r]=e});const VE=gm;function ux(e){const r=new Hd(e),a=qv(Hd.prototype.request,r);return Xe.extend(a,Hd.prototype,r,{allOwnKeys:!0}),Xe.extend(a,r,null,{allOwnKeys:!0}),a.create=function(d){return ux(uu(e,d))},a}const or=ux(Xm);or.Axios=Hd;or.CanceledError=Hh;or.CancelToken=NE;or.isCancel=ax;or.VERSION=cx;or.toFormData=Lp;or.AxiosError=Hi;or.Cancel=or.CanceledError;or.all=function(r){return Promise.all(r)};or.spread=$E;or.isAxiosError=UE;or.mergeConfig=uu;or.AxiosHeaders=Do;or.formToJSON=e=>sx(Xe.isHTMLForm(e)?new FormData(e):e);or.getAdapter=lx.getAdapter;or.HttpStatusCode=VE;or.default=or;const zp=Lo("CondosStore",{state:()=>({condosData:{}}),actions:{async fillCondoData(e){const a=dn().addressData.features;if(!a)return;const u=a[0];let d={include_units:!0,opa_only:!0,page:1};const g=await or(`//api.phila.gov/ais/v1/search/${e}`,{params:d});if(g.data.features.length>0){let m=[];for(let l of g.data.features)l.properties.address_low_frac!==u.properties.address_low_frac||l.properties.street_address===u.properties.street_address?g.data.total_size=g.data.total_size-1:m.push(l);this.condosData=m}}}});function hx(){return{routeApp:r=>{const a=Js();a.currentAddress&&a.currentTopic=="Nearby Activity"?r.push({name:"address-topic-and-data",params:{address:a.currentAddress,topic:"Nearby Activity",data:a.currentNearbyDataType}}):a.currentAddress&&a.currentTopic?r.push({name:"address-and-topic",params:{address:a.currentAddress,topic:a.currentTopic}}):a.currentAddress&&r.push({name:"address",params:{address:a.currentAddress}})}}}const Qs=(e,r)=>{const a=e.__vccOpts||e;for(const[u,d]of r)a[u]=d;return a},jE={class:"topic-name has-text-left"},qE={key:0,class:"topic-loading has-text-right"},GE={key:0},HE={class:"inside-topic"},ZE={__name:"Topic",props:{topicName:String,loading:Boolean},setup(e){const r=Js(),a=e,u=qh(),d=jh(),{routeApp:g}=hx(),m=gi(()=>u.params.topic==a.topicName),l=()=>{a.topicName==u.params.topic?r.currentTopic="":r.currentTopic=a.topicName,console.log("topic clicked:",a.topicName),g(d)};return(M,P)=>(It(),Ot("section",null,[Y("div",{class:"topic",onClick:l},[Y("span",jE,qt(e.topicName),1),m.value&&e.loading?(It(),Ot("span",qE,"Loading...")):Gi("",!0)]),m.value?(It(),Ot("div",GE,[Y("div",HE,[a2(M.$slots,"default",{},void 0,!0)])])):Gi("",!0)]))}},ic=Qs(ZE,[["__scopeId","data-v-ed149146"]]);var Zc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Jm(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ym={exports:{}};/*!
 * accounting.js v0.4.1
 * Copyright 2014 Open Exchange Rates
 *
 * Freely distributable under the MIT license.
 * Portions of accounting.js are inspired or borrowed from underscore.js
 *
 * Full details and documentation:
 * http://openexchangerates.github.io/accounting.js/
 */(function(e,r){(function(a,u){var d={};d.version="0.4.1",d.settings={currency:{symbol:"$",format:"%s%v",decimal:".",thousand:",",precision:2,grouping:3},number:{precision:0,grouping:3,thousand:",",decimal:"."}};var g=Array.prototype.map,m=Array.isArray,l=Object.prototype.toString;function M(oe){return!!(oe===""||oe&&oe.charCodeAt&&oe.substr)}function P(oe){return m?m(oe):l.call(oe)==="[object Array]"}function R(oe){return oe&&l.call(oe)==="[object Object]"}function D(oe,Le){var Ze;oe=oe||{},Le=Le||{};for(Ze in Le)Le.hasOwnProperty(Ze)&&oe[Ze]==null&&(oe[Ze]=Le[Ze]);return oe}function z(oe,Le,Ze){var Ke=[],dt,bt;if(!oe)return Ke;if(g&&oe.map===g)return oe.map(Le,Ze);for(dt=0,bt=oe.length;dt<bt;dt++)Ke[dt]=Le.call(Ze,oe[dt],dt,oe);return Ke}function Z(oe,Le){return oe=Math.round(Math.abs(oe)),isNaN(oe)?Le:oe}function W(oe){var Le=d.settings.currency.format;return typeof oe=="function"&&(oe=oe()),M(oe)&&oe.match("%v")?{pos:oe,neg:oe.replace("-","").replace("%v","-%v"),zero:oe}:!oe||!oe.pos||!oe.pos.match("%v")?M(Le)?d.settings.currency.format={pos:Le,neg:Le.replace("%v","-%v"),zero:Le}:Le:oe}var J=d.unformat=d.parse=function(oe,Le){if(P(oe))return z(oe,function(dt){return J(dt,Le)});if(oe=oe||0,typeof oe=="number")return oe;Le=Le||d.settings.number.decimal;var Ze=new RegExp("[^0-9-"+Le+"]",["g"]),Ke=parseFloat((""+oe).replace(/\((.*)\)/,"-$1").replace(Ze,"").replace(Le,"."));return isNaN(Ke)?0:Ke},me=d.toFixed=function(oe,Le){Le=Z(Le,d.settings.number.precision);var Ze=Math.pow(10,Le);return(Math.round(d.unformat(oe)*Ze)/Ze).toFixed(Le)},xe=d.formatNumber=d.format=function(oe,Le,Ze,Ke){if(P(oe))return z(oe,function(li){return xe(li,Le,Ze,Ke)});oe=J(oe);var dt=D(R(Le)?Le:{precision:Le,thousand:Ze,decimal:Ke},d.settings.number),bt=Z(dt.precision),Pt=oe<0?"-":"",Ht=parseInt(me(Math.abs(oe||0),bt),10)+"",Rt=Ht.length>3?Ht.length%3:0;return Pt+(Rt?Ht.substr(0,Rt)+dt.thousand:"")+Ht.substr(Rt).replace(/(\d{3})(?=\d)/g,"$1"+dt.thousand)+(bt?dt.decimal+me(Math.abs(oe),bt).split(".")[1]:"")},Pe=d.formatMoney=function(oe,Le,Ze,Ke,dt,bt){if(P(oe))return z(oe,function(li){return Pe(li,Le,Ze,Ke,dt,bt)});oe=J(oe);var Pt=D(R(Le)?Le:{symbol:Le,precision:Ze,thousand:Ke,decimal:dt,format:bt},d.settings.currency),Ht=W(Pt.format),Rt=oe>0?Ht.pos:oe<0?Ht.neg:Ht.zero;return Rt.replace("%s",Pt.symbol).replace("%v",xe(Math.abs(oe),Z(Pt.precision),Pt.thousand,Pt.decimal))};d.formatColumn=function(oe,Le,Ze,Ke,dt,bt){if(!oe)return[];var Pt=D(R(Le)?Le:{symbol:Le,precision:Ze,thousand:Ke,decimal:dt,format:bt},d.settings.currency),Ht=W(Pt.format),Rt=Ht.pos.indexOf("%s")<Ht.pos.indexOf("%v"),li=0,ct=z(oe,function(zt,Bi){if(P(zt))return d.formatColumn(zt,Pt);zt=J(zt);var ti=zt>0?Ht.pos:zt<0?Ht.neg:Ht.zero,ii=ti.replace("%s",Pt.symbol).replace("%v",xe(Math.abs(zt),Z(Pt.precision),Pt.thousand,Pt.decimal));return ii.length>li&&(li=ii.length),ii});return z(ct,function(zt,Bi){return M(zt)&&zt.length<li?Rt?zt.replace(Pt.symbol,Pt.symbol+new Array(li-zt.length+1).join(" ")):new Array(li-zt.length+1).join(" ")+zt:zt})},e.exports&&(r=e.exports=d),r.accounting=d})()})(ym,ym.exports);var WE=ym.exports;const dx=Jm(WE);function zs(e){const r=Object.prototype.toString.call(e);return e instanceof Date||typeof e=="object"&&r==="[object Date]"?new e.constructor(+e):typeof e=="number"||r==="[object Number]"||typeof e=="string"||r==="[object String]"?new Date(e):new Date(NaN)}function Ba(e,r){return e instanceof Date?new e.constructor(r):new Date(r)}function px(e,r){const a=zs(e);return isNaN(r)?Ba(e,NaN):(r&&a.setDate(a.getDate()+r),a)}function fx(e,r){const a=zs(e);if(isNaN(r))return Ba(e,NaN);if(!r)return a;const u=a.getDate(),d=Ba(e,a.getTime());d.setMonth(a.getMonth()+r+1,0);const g=d.getDate();return u>=g?d:(a.setFullYear(d.getFullYear(),d.getMonth(),u),a)}function XE(e,r){const a=+zs(e);return Ba(e,a+r)}const mx=6048e5,KE=864e5,gx=6e4,Qm=36e5;function YE(e,r){return XE(e,r*Qm)}let JE={};function Op(){return JE}function kh(e,r){var l,M,P,R;const a=Op(),u=(r==null?void 0:r.weekStartsOn)??((M=(l=r==null?void 0:r.locale)==null?void 0:l.options)==null?void 0:M.weekStartsOn)??a.weekStartsOn??((R=(P=a.locale)==null?void 0:P.options)==null?void 0:R.weekStartsOn)??0,d=zs(e),g=d.getDay(),m=(g<u?7:0)+g-u;return d.setDate(d.getDate()-m),d.setHours(0,0,0,0),d}function ap(e){return kh(e,{weekStartsOn:1})}function yx(e){const r=zs(e),a=r.getFullYear(),u=Ba(e,0);u.setFullYear(a+1,0,4),u.setHours(0,0,0,0);const d=ap(u),g=Ba(e,0);g.setFullYear(a,0,4),g.setHours(0,0,0,0);const m=ap(g);return r.getTime()>=d.getTime()?a+1:r.getTime()>=m.getTime()?a:a-1}function Z_(e){const r=zs(e);return r.setHours(0,0,0,0),r}function W_(e){const r=zs(e),a=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return a.setUTCFullYear(r.getFullYear()),+e-+a}function QE(e,r){const a=Z_(e),u=Z_(r),d=+a-W_(a),g=+u-W_(u);return Math.round((d-g)/KE)}function eT(e){const r=yx(e),a=Ba(e,0);return a.setFullYear(r,0,4),a.setHours(0,0,0,0),ap(a)}function tT(e,r){const a=r*7;return px(e,a)}function iT(e,r){return fx(e,r*12)}function rT(e){return e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}function nT(e){if(!rT(e)&&typeof e!="number")return!1;const r=zs(e);return!isNaN(Number(r))}function sT(e){const r=zs(e),a=Ba(e,0);return a.setFullYear(r.getFullYear(),0,1),a.setHours(0,0,0,0),a}const aT={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},oT=(e,r,a)=>{let u;const d=aT[e];return typeof d=="string"?u=d:r===1?u=d.one:u=d.other.replace("{{count}}",r.toString()),a!=null&&a.addSuffix?a.comparison&&a.comparison>0?"in "+u:u+" ago":u};function Vf(e){return(r={})=>{const a=r.width?String(r.width):e.defaultWidth;return e.formats[a]||e.formats[e.defaultWidth]}}const lT={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},cT={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},uT={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},hT={date:Vf({formats:lT,defaultWidth:"full"}),time:Vf({formats:cT,defaultWidth:"full"}),dateTime:Vf({formats:uT,defaultWidth:"full"})},dT={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},pT=(e,r,a,u)=>dT[e];function sh(e){return(r,a)=>{const u=a!=null&&a.context?String(a.context):"standalone";let d;if(u==="formatting"&&e.formattingValues){const m=e.defaultFormattingWidth||e.defaultWidth,l=a!=null&&a.width?String(a.width):m;d=e.formattingValues[l]||e.formattingValues[m]}else{const m=e.defaultWidth,l=a!=null&&a.width?String(a.width):e.defaultWidth;d=e.values[l]||e.values[m]}const g=e.argumentCallback?e.argumentCallback(r):r;return d[g]}}const fT={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},mT={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},gT={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},yT={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},_T={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},vT={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},xT=(e,r)=>{const a=Number(e),u=a%100;if(u>20||u<10)switch(u%10){case 1:return a+"st";case 2:return a+"nd";case 3:return a+"rd"}return a+"th"},bT={ordinalNumber:xT,era:sh({values:fT,defaultWidth:"wide"}),quarter:sh({values:mT,defaultWidth:"wide",argumentCallback:e=>e-1}),month:sh({values:gT,defaultWidth:"wide"}),day:sh({values:yT,defaultWidth:"wide"}),dayPeriod:sh({values:_T,defaultWidth:"wide",formattingValues:vT,defaultFormattingWidth:"wide"})};function ah(e){return(r,a={})=>{const u=a.width,d=u&&e.matchPatterns[u]||e.matchPatterns[e.defaultMatchWidth],g=r.match(d);if(!g)return null;const m=g[0],l=u&&e.parsePatterns[u]||e.parsePatterns[e.defaultParseWidth],M=Array.isArray(l)?MT(l,D=>D.test(m)):wT(l,D=>D.test(m));let P;P=e.valueCallback?e.valueCallback(M):M,P=a.valueCallback?a.valueCallback(P):P;const R=r.slice(m.length);return{value:P,rest:R}}}function wT(e,r){for(const a in e)if(Object.prototype.hasOwnProperty.call(e,a)&&r(e[a]))return a}function MT(e,r){for(let a=0;a<e.length;a++)if(r(e[a]))return a}function ST(e){return(r,a={})=>{const u=r.match(e.matchPattern);if(!u)return null;const d=u[0],g=r.match(e.parsePattern);if(!g)return null;let m=e.valueCallback?e.valueCallback(g[0]):g[0];m=a.valueCallback?a.valueCallback(m):m;const l=r.slice(d.length);return{value:m,rest:l}}}const ET=/^(\d+)(th|st|nd|rd)?/i,TT=/\d+/i,CT={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},IT={any:[/^b/i,/^(a|c)/i]},AT={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},PT={any:[/1/i,/2/i,/3/i,/4/i]},DT={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},kT={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},LT={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},RT={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},zT={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},OT={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},FT={ordinalNumber:ST({matchPattern:ET,parsePattern:TT,valueCallback:e=>parseInt(e,10)}),era:ah({matchPatterns:CT,defaultMatchWidth:"wide",parsePatterns:IT,defaultParseWidth:"any"}),quarter:ah({matchPatterns:AT,defaultMatchWidth:"wide",parsePatterns:PT,defaultParseWidth:"any",valueCallback:e=>e+1}),month:ah({matchPatterns:DT,defaultMatchWidth:"wide",parsePatterns:kT,defaultParseWidth:"any"}),day:ah({matchPatterns:LT,defaultMatchWidth:"wide",parsePatterns:RT,defaultParseWidth:"any"}),dayPeriod:ah({matchPatterns:zT,defaultMatchWidth:"any",parsePatterns:OT,defaultParseWidth:"any"})},BT={code:"en-US",formatDistance:oT,formatLong:hT,formatRelative:pT,localize:bT,match:FT,options:{weekStartsOn:0,firstWeekContainsDate:1}};function NT(e){const r=zs(e);return QE(r,sT(r))+1}function $T(e){const r=zs(e),a=+ap(r)-+eT(r);return Math.round(a/mx)+1}function _x(e,r){var R,D,z,Z;const a=zs(e),u=a.getFullYear(),d=Op(),g=(r==null?void 0:r.firstWeekContainsDate)??((D=(R=r==null?void 0:r.locale)==null?void 0:R.options)==null?void 0:D.firstWeekContainsDate)??d.firstWeekContainsDate??((Z=(z=d.locale)==null?void 0:z.options)==null?void 0:Z.firstWeekContainsDate)??1,m=Ba(e,0);m.setFullYear(u+1,0,g),m.setHours(0,0,0,0);const l=kh(m,r),M=Ba(e,0);M.setFullYear(u,0,g),M.setHours(0,0,0,0);const P=kh(M,r);return a.getTime()>=l.getTime()?u+1:a.getTime()>=P.getTime()?u:u-1}function UT(e,r){var l,M,P,R;const a=Op(),u=(r==null?void 0:r.firstWeekContainsDate)??((M=(l=r==null?void 0:r.locale)==null?void 0:l.options)==null?void 0:M.firstWeekContainsDate)??a.firstWeekContainsDate??((R=(P=a.locale)==null?void 0:P.options)==null?void 0:R.firstWeekContainsDate)??1,d=_x(e,r),g=Ba(e,0);return g.setFullYear(d,0,u),g.setHours(0,0,0,0),kh(g,r)}function VT(e,r){const a=zs(e),u=+kh(a,r)-+UT(a,r);return Math.round(u/mx)+1}function ur(e,r){const a=e<0?"-":"",u=Math.abs(e).toString().padStart(r,"0");return a+u}const pl={y(e,r){const a=e.getFullYear(),u=a>0?a:1-a;return ur(r==="yy"?u%100:u,r.length)},M(e,r){const a=e.getMonth();return r==="M"?String(a+1):ur(a+1,2)},d(e,r){return ur(e.getDate(),r.length)},a(e,r){const a=e.getHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return a.toUpperCase();case"aaa":return a;case"aaaaa":return a[0];case"aaaa":default:return a==="am"?"a.m.":"p.m."}},h(e,r){return ur(e.getHours()%12||12,r.length)},H(e,r){return ur(e.getHours(),r.length)},m(e,r){return ur(e.getMinutes(),r.length)},s(e,r){return ur(e.getSeconds(),r.length)},S(e,r){const a=r.length,u=e.getMilliseconds(),d=Math.trunc(u*Math.pow(10,a-3));return ur(d,r.length)}},qc={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},X_={G:function(e,r,a){const u=e.getFullYear()>0?1:0;switch(r){case"G":case"GG":case"GGG":return a.era(u,{width:"abbreviated"});case"GGGGG":return a.era(u,{width:"narrow"});case"GGGG":default:return a.era(u,{width:"wide"})}},y:function(e,r,a){if(r==="yo"){const u=e.getFullYear(),d=u>0?u:1-u;return a.ordinalNumber(d,{unit:"year"})}return pl.y(e,r)},Y:function(e,r,a,u){const d=_x(e,u),g=d>0?d:1-d;if(r==="YY"){const m=g%100;return ur(m,2)}return r==="Yo"?a.ordinalNumber(g,{unit:"year"}):ur(g,r.length)},R:function(e,r){const a=yx(e);return ur(a,r.length)},u:function(e,r){const a=e.getFullYear();return ur(a,r.length)},Q:function(e,r,a){const u=Math.ceil((e.getMonth()+1)/3);switch(r){case"Q":return String(u);case"QQ":return ur(u,2);case"Qo":return a.ordinalNumber(u,{unit:"quarter"});case"QQQ":return a.quarter(u,{width:"abbreviated",context:"formatting"});case"QQQQQ":return a.quarter(u,{width:"narrow",context:"formatting"});case"QQQQ":default:return a.quarter(u,{width:"wide",context:"formatting"})}},q:function(e,r,a){const u=Math.ceil((e.getMonth()+1)/3);switch(r){case"q":return String(u);case"qq":return ur(u,2);case"qo":return a.ordinalNumber(u,{unit:"quarter"});case"qqq":return a.quarter(u,{width:"abbreviated",context:"standalone"});case"qqqqq":return a.quarter(u,{width:"narrow",context:"standalone"});case"qqqq":default:return a.quarter(u,{width:"wide",context:"standalone"})}},M:function(e,r,a){const u=e.getMonth();switch(r){case"M":case"MM":return pl.M(e,r);case"Mo":return a.ordinalNumber(u+1,{unit:"month"});case"MMM":return a.month(u,{width:"abbreviated",context:"formatting"});case"MMMMM":return a.month(u,{width:"narrow",context:"formatting"});case"MMMM":default:return a.month(u,{width:"wide",context:"formatting"})}},L:function(e,r,a){const u=e.getMonth();switch(r){case"L":return String(u+1);case"LL":return ur(u+1,2);case"Lo":return a.ordinalNumber(u+1,{unit:"month"});case"LLL":return a.month(u,{width:"abbreviated",context:"standalone"});case"LLLLL":return a.month(u,{width:"narrow",context:"standalone"});case"LLLL":default:return a.month(u,{width:"wide",context:"standalone"})}},w:function(e,r,a,u){const d=VT(e,u);return r==="wo"?a.ordinalNumber(d,{unit:"week"}):ur(d,r.length)},I:function(e,r,a){const u=$T(e);return r==="Io"?a.ordinalNumber(u,{unit:"week"}):ur(u,r.length)},d:function(e,r,a){return r==="do"?a.ordinalNumber(e.getDate(),{unit:"date"}):pl.d(e,r)},D:function(e,r,a){const u=NT(e);return r==="Do"?a.ordinalNumber(u,{unit:"dayOfYear"}):ur(u,r.length)},E:function(e,r,a){const u=e.getDay();switch(r){case"E":case"EE":case"EEE":return a.day(u,{width:"abbreviated",context:"formatting"});case"EEEEE":return a.day(u,{width:"narrow",context:"formatting"});case"EEEEEE":return a.day(u,{width:"short",context:"formatting"});case"EEEE":default:return a.day(u,{width:"wide",context:"formatting"})}},e:function(e,r,a,u){const d=e.getDay(),g=(d-u.weekStartsOn+8)%7||7;switch(r){case"e":return String(g);case"ee":return ur(g,2);case"eo":return a.ordinalNumber(g,{unit:"day"});case"eee":return a.day(d,{width:"abbreviated",context:"formatting"});case"eeeee":return a.day(d,{width:"narrow",context:"formatting"});case"eeeeee":return a.day(d,{width:"short",context:"formatting"});case"eeee":default:return a.day(d,{width:"wide",context:"formatting"})}},c:function(e,r,a,u){const d=e.getDay(),g=(d-u.weekStartsOn+8)%7||7;switch(r){case"c":return String(g);case"cc":return ur(g,r.length);case"co":return a.ordinalNumber(g,{unit:"day"});case"ccc":return a.day(d,{width:"abbreviated",context:"standalone"});case"ccccc":return a.day(d,{width:"narrow",context:"standalone"});case"cccccc":return a.day(d,{width:"short",context:"standalone"});case"cccc":default:return a.day(d,{width:"wide",context:"standalone"})}},i:function(e,r,a){const u=e.getDay(),d=u===0?7:u;switch(r){case"i":return String(d);case"ii":return ur(d,r.length);case"io":return a.ordinalNumber(d,{unit:"day"});case"iii":return a.day(u,{width:"abbreviated",context:"formatting"});case"iiiii":return a.day(u,{width:"narrow",context:"formatting"});case"iiiiii":return a.day(u,{width:"short",context:"formatting"});case"iiii":default:return a.day(u,{width:"wide",context:"formatting"})}},a:function(e,r,a){const d=e.getHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return a.dayPeriod(d,{width:"abbreviated",context:"formatting"});case"aaa":return a.dayPeriod(d,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return a.dayPeriod(d,{width:"narrow",context:"formatting"});case"aaaa":default:return a.dayPeriod(d,{width:"wide",context:"formatting"})}},b:function(e,r,a){const u=e.getHours();let d;switch(u===12?d=qc.noon:u===0?d=qc.midnight:d=u/12>=1?"pm":"am",r){case"b":case"bb":return a.dayPeriod(d,{width:"abbreviated",context:"formatting"});case"bbb":return a.dayPeriod(d,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return a.dayPeriod(d,{width:"narrow",context:"formatting"});case"bbbb":default:return a.dayPeriod(d,{width:"wide",context:"formatting"})}},B:function(e,r,a){const u=e.getHours();let d;switch(u>=17?d=qc.evening:u>=12?d=qc.afternoon:u>=4?d=qc.morning:d=qc.night,r){case"B":case"BB":case"BBB":return a.dayPeriod(d,{width:"abbreviated",context:"formatting"});case"BBBBB":return a.dayPeriod(d,{width:"narrow",context:"formatting"});case"BBBB":default:return a.dayPeriod(d,{width:"wide",context:"formatting"})}},h:function(e,r,a){if(r==="ho"){let u=e.getHours()%12;return u===0&&(u=12),a.ordinalNumber(u,{unit:"hour"})}return pl.h(e,r)},H:function(e,r,a){return r==="Ho"?a.ordinalNumber(e.getHours(),{unit:"hour"}):pl.H(e,r)},K:function(e,r,a){const u=e.getHours()%12;return r==="Ko"?a.ordinalNumber(u,{unit:"hour"}):ur(u,r.length)},k:function(e,r,a){let u=e.getHours();return u===0&&(u=24),r==="ko"?a.ordinalNumber(u,{unit:"hour"}):ur(u,r.length)},m:function(e,r,a){return r==="mo"?a.ordinalNumber(e.getMinutes(),{unit:"minute"}):pl.m(e,r)},s:function(e,r,a){return r==="so"?a.ordinalNumber(e.getSeconds(),{unit:"second"}):pl.s(e,r)},S:function(e,r){return pl.S(e,r)},X:function(e,r,a){const u=e.getTimezoneOffset();if(u===0)return"Z";switch(r){case"X":return Y_(u);case"XXXX":case"XX":return rc(u);case"XXXXX":case"XXX":default:return rc(u,":")}},x:function(e,r,a){const u=e.getTimezoneOffset();switch(r){case"x":return Y_(u);case"xxxx":case"xx":return rc(u);case"xxxxx":case"xxx":default:return rc(u,":")}},O:function(e,r,a){const u=e.getTimezoneOffset();switch(r){case"O":case"OO":case"OOO":return"GMT"+K_(u,":");case"OOOO":default:return"GMT"+rc(u,":")}},z:function(e,r,a){const u=e.getTimezoneOffset();switch(r){case"z":case"zz":case"zzz":return"GMT"+K_(u,":");case"zzzz":default:return"GMT"+rc(u,":")}},t:function(e,r,a){const u=Math.trunc(e.getTime()/1e3);return ur(u,r.length)},T:function(e,r,a){const u=e.getTime();return ur(u,r.length)}};function K_(e,r=""){const a=e>0?"-":"+",u=Math.abs(e),d=Math.trunc(u/60),g=u%60;return g===0?a+String(d):a+String(d)+r+ur(g,2)}function Y_(e,r){return e%60===0?(e>0?"-":"+")+ur(Math.abs(e)/60,2):rc(e,r)}function rc(e,r=""){const a=e>0?"-":"+",u=Math.abs(e),d=ur(Math.trunc(u/60),2),g=ur(u%60,2);return a+d+r+g}const J_=(e,r)=>{switch(e){case"P":return r.date({width:"short"});case"PP":return r.date({width:"medium"});case"PPP":return r.date({width:"long"});case"PPPP":default:return r.date({width:"full"})}},vx=(e,r)=>{switch(e){case"p":return r.time({width:"short"});case"pp":return r.time({width:"medium"});case"ppp":return r.time({width:"long"});case"pppp":default:return r.time({width:"full"})}},jT=(e,r)=>{const a=e.match(/(P+)(p+)?/)||[],u=a[1],d=a[2];if(!d)return J_(e,r);let g;switch(u){case"P":g=r.dateTime({width:"short"});break;case"PP":g=r.dateTime({width:"medium"});break;case"PPP":g=r.dateTime({width:"long"});break;case"PPPP":default:g=r.dateTime({width:"full"});break}return g.replace("{{date}}",J_(u,r)).replace("{{time}}",vx(d,r))},qT={p:vx,P:jT},GT=/^D+$/,HT=/^Y+$/,ZT=["D","DD","YY","YYYY"];function WT(e){return GT.test(e)}function XT(e){return HT.test(e)}function KT(e,r,a){const u=YT(e,r,a);if(console.warn(u),ZT.includes(e))throw new RangeError(u)}function YT(e,r,a){const u=e[0]==="Y"?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${r}\`) for formatting ${u} to the input \`${a}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const JT=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,QT=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,eC=/^'([^]*?)'?$/,tC=/''/g,iC=/[a-zA-Z]/;function _m(e,r,a){var R,D,z,Z,W,J,me,xe;const u=Op(),d=(a==null?void 0:a.locale)??u.locale??BT,g=(a==null?void 0:a.firstWeekContainsDate)??((D=(R=a==null?void 0:a.locale)==null?void 0:R.options)==null?void 0:D.firstWeekContainsDate)??u.firstWeekContainsDate??((Z=(z=u.locale)==null?void 0:z.options)==null?void 0:Z.firstWeekContainsDate)??1,m=(a==null?void 0:a.weekStartsOn)??((J=(W=a==null?void 0:a.locale)==null?void 0:W.options)==null?void 0:J.weekStartsOn)??u.weekStartsOn??((xe=(me=u.locale)==null?void 0:me.options)==null?void 0:xe.weekStartsOn)??0,l=zs(e);if(!nT(l))throw new RangeError("Invalid time value");let M=r.match(QT).map(Pe=>{const oe=Pe[0];if(oe==="p"||oe==="P"){const Le=qT[oe];return Le(Pe,d.formatLong)}return Pe}).join("").match(JT).map(Pe=>{if(Pe==="''")return{isToken:!1,value:"'"};const oe=Pe[0];if(oe==="'")return{isToken:!1,value:rC(Pe)};if(X_[oe])return{isToken:!0,value:Pe};if(oe.match(iC))throw new RangeError("Format string contains an unescaped latin alphabet character `"+oe+"`");return{isToken:!1,value:Pe}});d.localize.preprocessor&&(M=d.localize.preprocessor(l,M));const P={firstWeekContainsDate:g,weekStartsOn:m,locale:d};return M.map(Pe=>{if(!Pe.isToken)return Pe.value;const oe=Pe.value;(!(a!=null&&a.useAdditionalWeekYearTokens)&&XT(oe)||!(a!=null&&a.useAdditionalDayOfYearTokens)&&WT(oe))&&KT(oe,r,String(e));const Le=X_[oe[0]];return Le(l,oe,d.localize,P)}).join("")}function rC(e){const r=e.match(eC);return r?r[1].replace(tC,"'"):e}function nC(e,r){return px(e,-r)}function sC(e,r){const a=(r==null?void 0:r.additionalDigits)??2,u=cC(e);let d;if(u.date){const M=uC(u.date,a);d=hC(M.restDateString,M.year)}if(!d||isNaN(d.getTime()))return new Date(NaN);const g=d.getTime();let m=0,l;if(u.time&&(m=dC(u.time),isNaN(m)))return new Date(NaN);if(u.timezone){if(l=pC(u.timezone),isNaN(l))return new Date(NaN)}else{const M=new Date(g+m),P=new Date(0);return P.setFullYear(M.getUTCFullYear(),M.getUTCMonth(),M.getUTCDate()),P.setHours(M.getUTCHours(),M.getUTCMinutes(),M.getUTCSeconds(),M.getUTCMilliseconds()),P}return new Date(g+m+l)}const Rd={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},aC=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,oC=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,lC=/^([+-])(\d{2})(?::?(\d{2}))?$/;function cC(e){const r={},a=e.split(Rd.dateTimeDelimiter);let u;if(a.length>2)return r;if(/:/.test(a[0])?u=a[0]:(r.date=a[0],u=a[1],Rd.timeZoneDelimiter.test(r.date)&&(r.date=e.split(Rd.timeZoneDelimiter)[0],u=e.substr(r.date.length,e.length))),u){const d=Rd.timezone.exec(u);d?(r.time=u.replace(d[1],""),r.timezone=d[1]):r.time=u}return r}function uC(e,r){const a=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+r)+"})|(\\d{2}|[+-]\\d{"+(2+r)+"})$)"),u=e.match(a);if(!u)return{year:NaN,restDateString:""};const d=u[1]?parseInt(u[1]):null,g=u[2]?parseInt(u[2]):null;return{year:g===null?d:g*100,restDateString:e.slice((u[1]||u[2]).length)}}function hC(e,r){if(r===null)return new Date(NaN);const a=e.match(aC);if(!a)return new Date(NaN);const u=!!a[4],d=oh(a[1]),g=oh(a[2])-1,m=oh(a[3]),l=oh(a[4]),M=oh(a[5])-1;if(u)return _C(r,l,M)?fC(r,l,M):new Date(NaN);{const P=new Date(0);return!gC(r,g,m)||!yC(r,d)?new Date(NaN):(P.setUTCFullYear(r,g,Math.max(d,m)),P)}}function oh(e){return e?parseInt(e):1}function dC(e){const r=e.match(oC);if(!r)return NaN;const a=jf(r[1]),u=jf(r[2]),d=jf(r[3]);return vC(a,u,d)?a*Qm+u*gx+d*1e3:NaN}function jf(e){return e&&parseFloat(e.replace(",","."))||0}function pC(e){if(e==="Z")return 0;const r=e.match(lC);if(!r)return 0;const a=r[1]==="+"?-1:1,u=parseInt(r[2]),d=r[3]&&parseInt(r[3])||0;return xC(u,d)?a*(u*Qm+d*gx):NaN}function fC(e,r,a){const u=new Date(0);u.setUTCFullYear(e,0,4);const d=u.getUTCDay()||7,g=(r-1)*7+a+1-d;return u.setUTCDate(u.getUTCDate()+g),u}const mC=[31,null,31,30,31,30,31,31,30,31,30,31];function xx(e){return e%400===0||e%4===0&&e%100!==0}function gC(e,r,a){return r>=0&&r<=11&&a>=1&&a<=(mC[r]||(xx(e)?29:28))}function yC(e,r){return r>=1&&r<=(xx(e)?366:365)}function _C(e,r,a){return r>=1&&r<=53&&a>=0&&a<=6}function vC(e,r,a){return e===24?r===0&&a===0:a>=0&&a<60&&r>=0&&r<60&&e>=0&&e<25}function xC(e,r){return r>=0&&r<=59}function bC(e,r){return fx(e,-r)}function wC(e,r){return YE(e,-r)}function MC(e,r){return tT(e,-r)}function SC(e,r){return iT(e,-r)}dx.settings.currency.precision=0;function eg(){return{bold:u=>"<strong>"+u+"</strong>",currency:u=>dx.formatMoney(u),date:u=>{let d;return typeof u=="string"?d=_m(sC(u),"MM/dd/yyyy"):d=_m(u,"MM/dd/yyyy"),d}}}const{currency:Q_,date:EC}=eg(),bx=Lo("OpaStore",{state:()=>({opaData:{}}),actions:{async fillOpaData(){const r=dn().addressData.features[0].properties.opa_account_num,a=await fetch(`https://phl.carto.com/api/v2/sql?q=select+*+from+opa_properties_public+where+parcel_number+%3D+%27${r}%27`);this.opaData=await a.json()}},getters:{getMarketValue:e=>Q_(e.opaData.rows[0].market_value||null),getSaleDate:e=>EC(e.opaData.rows[0].sale_date),getSalePrice:e=>Q_(e.opaData.rows[0].sale_price)}}),Cl=e=>(Nh("data-v-c822a1b7"),e=e(),$h(),e),TC={key:0,class:"box"},CC={key:1,class:"vert-table"},IC={class:"columns"},AC=Cl(()=>Y("div",{class:"column is-4"},"OPA Account #",-1)),PC={class:"column is-8"},DC={class:"columns"},kC=Cl(()=>Y("div",{class:"column is-4"},"OPA Address",-1)),LC={class:"column is-8"},RC={class:"columns"},zC=Cl(()=>Y("div",{class:"column is-4"},"Owners",-1)),OC={class:"column is-8"},FC={class:"columns"},BC=Cl(()=>Y("div",{class:"column is-4"},"Assessed Value",-1)),NC={class:"column is-8"},$C={class:"columns"},UC=Cl(()=>Y("div",{class:"column is-4"},"Sale Date",-1)),VC={class:"column is-8"},jC={class:"columns"},qC=Cl(()=>Y("div",{class:"column is-4"},"Sale Price",-1)),GC={class:"column is-8"},HC={key:2},ZC={class:"title is-5"},WC=Cl(()=>Y("p",null,"You can use the Condominiums tab below to see information for an individual unit.",-1)),XC={key:3},KC=Cl(()=>Y("p",null,"There is no property assessment record for this address.",-1)),YC=[KC],JC={__name:"Property",setup(e){console.log("Property.vue setup");const r=dn(),a=bx(),u=zp();return(d,g)=>(It(),Ot("section",null,[Fi(a).opaData.rows.length?(It(),Ot("div",TC," Property assessment and sale information for this address. Source: Office of Property Assessments (OPA). OPA was formerly a part of the Bureau of Revision of Taxes (BRT) and some City records may still use that name. ")):Gi("",!0),Fi(a).opaData.rows.length?(It(),Ot("div",CC,[Y("div",IC,[AC,Y("div",PC,qt(Fi(r).addressData.features[0].properties.opa_account_num),1)]),Y("div",DC,[kC,Y("div",LC,qt(Fi(r).addressData.features[0].properties.opa_address),1)]),Y("div",RC,[zC,Y("div",OC,qt(Fi(r).getOpaOwners),1)]),Y("div",FC,[BC,Y("div",NC,qt(Fi(a).getMarketValue),1)]),Y("div",$C,[UC,Y("div",VC,qt(Fi(a).getSaleDate),1)]),Y("div",jC,[qC,Y("div",GC,qt(Fi(a).getSalePrice),1)])])):Gi("",!0),!Fi(a).opaData.rows.length&&Fi(u).condosData.length?(It(),Ot("div",HC,[Y("h5",ZC,"There are "+qt(Fi(u).condosData.length)+" condominium units at this address.",1),WC])):Fi(a).opaData.rows.length?Gi("",!0):(It(),Ot("div",XC,YC))]))}},QC=Qs(JC,[["__scopeId","data-v-c822a1b7"]]),eI=Y("div",{class:"box"}," Condominium units at your search address, as recorded for property assessment purposes. Click one of the addresses below to see information for that unit. Use the back button to return to this list. Source: Office of Property Assessment ",-1),tI=Y("h5",{class:"subtitle is-5"},"Condominiums",-1),iI={class:"table is-fullwidth is-striped"},rI=Y("thead",null,[Y("tr",null,[Y("th",null,"Address"),Y("th",null,"OPA Account #")])],-1),nI={__name:"Condos",setup(e){console.log("Condos.vue setup");const r=zp(),a=gi(()=>r.condosData);return(u,d)=>(It(),Ot("section",null,[eI,tI,Y("table",iI,[rI,Y("tbody",null,[(It(!0),Ot(Mr,null,Ls(a.value,g=>(It(),Ot("tr",null,[Y("td",null,[rr(Fi(jv),{to:{name:"address-and-topic",params:{address:g.properties.opa_address,topic:"Property"}}},{default:Ao(()=>[ip(qt(g.properties.opa_address),1)]),_:2},1032,["to"])]),Y("td",null,qt(g.properties.opa_account_num),1)]))),256))])])]))}};function qf(e){return e&&typeof e=="object"&&!Array.isArray(e)&&e!==null}function yu(e,r){let a=Object.assign({},e);return qf(e)&&qf(r)&&Object.keys(r).forEach(u=>{qf(r[u])?u in e?a[u]=yu(e[u],r[u]):Object.assign(a,{[u]:r[u]}):Object.assign(a,{[u]:r[u]})}),a}const Zh={sources:{imageryLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2023:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2023/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2022:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2022_2in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2020:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2020_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2019:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2019_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2018:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2018_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2017:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2017_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2016:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2016_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2015:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2015_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2012:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2012_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2010:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2010_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2008:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2008_3in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},2004:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_2004_6in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},1996:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityImagery_1996_6in/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},1962:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/HistoricLandUse_1962/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},1942:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/HistoricLandUse_1942/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},1910:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/HistoricBromleyAtlas_1910/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},1895:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/HistoricBromleyAtlas_1895/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},1875:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/HistoricGMHopkinsAtlas_1875/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},1860:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/HistoricHexamerLocherAtlas_1860/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256}}},sI=yu(Zh,{version:8,name:"pwdDrawnMap",sources:{pwd:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityBasemap/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},pwdLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityBasemap_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},addressMarker:{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[]}}},dorParcel:{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[]]]}}}},layers:[{id:"pwd",source:"pwd",type:"raster"},{id:"pwdLabels",source:"pwdLabels",type:"raster"},{id:"addressMarker",source:"addressMarker",type:"symbol",layout:{"icon-image":"marker-blue","icon-anchor":"bottom","icon-size":.05},paint:{"icon-color":"#ff0000","icon-opacity":1}}]}),aI=yu(Zh,{version:8,name:"liDrawnMap",sources:{pwd:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityBasemap/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},pwdLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityBasemap_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},liBuildingFootprints:{type:"geojson",data:{type:"FeatureCollection",features:[]}},addressMarker:{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[]}}},dorParcel:{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[]]]}}}},layers:[{id:"pwd",source:"pwd",type:"raster"},{id:"pwdLabels",source:"pwdLabels",type:"raster"},{id:"liBuildingFootprints",type:"fill",source:"liBuildingFootprints",layout:{},paint:{"fill-color":["match",["get","type"],"nearby311","#FF0000","#C2B7FF"],"fill-opacity":.5}},{id:"addressMarker",source:"addressMarker",type:"symbol",layout:{"icon-image":"marker-blue","icon-anchor":"bottom","icon-size":.05},paint:{"icon-color":"#ff0000","icon-opacity":1}}]}),oI=yu(Zh,{version:8,name:"dorDrawnMap",sources:{dor:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/DORBasemap/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},dorLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/DORBasemap_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},addressMarker:{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[]}}},dorParcel:{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[]]]}}}},layers:[{id:"dor",source:"dor",type:"raster"},{id:"dorLabels",source:"dorLabels",type:"raster"},{id:"dorParcel",type:"fill",source:"dorParcel",layout:{},paint:{"fill-color":"#088","fill-opacity":.4}}]}),lI=yu(Zh,{version:8,name:"dorDrawnMap",sources:{dor:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/DORBasemap/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},dorLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/DORBasemap_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},zoning:{tiles:["https://citygeo-geoserver.databridge.phila.gov/geoserver/wms?service=WMS&version=1.1.0&request=GetMap&layers=atlas_zoning_grouped&bbox={bbox-epsg-3857}&width=256&height=256&srs=EPSG%3A3857&styles=&format=image/png&transparent=true"],type:"raster",tileSize:256},addressMarker:{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[]}}},dorParcel:{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[]]]}}}},layers:[{id:"dor",source:"dor",type:"raster"},{id:"dorLabels",source:"dorLabels",type:"raster"},{id:"zoning",source:"zoning",type:"raster",paint:{"raster-opacity":1}},{id:"dorParcel",type:"fill",source:"dorParcel",layout:{},paint:{"fill-color":"#088","fill-opacity":.4}}]}),cI=yu(Zh,{version:8,name:"pwdDrawnMap",sources:{pwd:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityBasemap/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},pwdLabels:{tiles:["https://tiles.arcgis.com/tiles/fLeGjb7u4uXqeF9q/arcgis/rest/services/CityBasemap_Labels/MapServer/tile/{z}/{y}/{x}"],type:"raster",tileSize:256},addressMarker:{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[]}}},dorParcel:{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[]]]}}},nearby:{type:"geojson",data:{type:"FeatureCollection",features:[]}}},layers:[{id:"pwd",source:"pwd",type:"raster"},{id:"pwdLabels",source:"pwdLabels",type:"raster"},{id:"nearby",source:"nearby",type:"circle",paint:{"circle-radius":7,"circle-color":["match",["get","type"],"nearby311","#FF0000","nearbyCrimeIncidents","#0096FF","#000000"],"circle-stroke-width":1,"circle-stroke-color":"white"}},{id:"addressMarker",source:"addressMarker",type:"symbol",layout:{"icon-image":"marker-blue","icon-anchor":"bottom","icon-size":.05}}]}),mn={topicStyles:{Property:"pwdDrawnMapStyle",Condos:"pwdDrawnMapStyle",Deeds:"dorDrawnMapStyle","Licenses & Inspections":"liDrawnMapStyle",Zoning:"zoningDrawnMapStyle",Voting:"pwdDrawnMapStyle","Nearby Activity":"nearbyDrawnMapStyle"},parcelLayerForTopic:{undefined:"pwd",Property:"pwd",Condos:"pwd",Deeds:"dor","Licenses & Inspections":"pwd",Zoning:"dor",Voting:"pwd","Nearby Activity":"pwd"},mapLayers:{pwdBasemap:{id:"pwdBasemap",source:"pwdBasemap",type:"raster"},pwdLabels:{id:"pwdLabels",source:"pwdLabels",type:"raster"},dorBasemap:{id:"dorBasemap",source:"dorBasemap",type:"raster"},dorLabels:{id:"dorLabels",source:"dorLabels",type:"raster"},zoning:{id:"zoning",source:"zoning",type:"raster"},addressMarker:{id:"addressMarker",source:"addressMarker",type:"circle"},dorParcel:{id:"dorParcel",type:"fill",source:"dorParcel",layout:{},paint:{"fill-color":"#088","fill-opacity":.4}},imageryLabels:{id:"imageryLabels",source:"imageryLabels",type:"raster"},2023:{id:"2023",source:"2023",type:"raster"},2022:{id:"2022",source:"2022",type:"raster"},2020:{id:"2020",source:"2020",type:"raster"},2019:{id:"2019",source:"2019",type:"raster"},2018:{id:"2018",source:"2018",type:"raster"},2017:{id:"2017",source:"2017",type:"raster"},2016:{id:"2016",source:"2016",type:"raster"},2015:{id:"2015",source:"2015",type:"raster"},2012:{id:"2012",source:"2012",type:"raster"},2010:{id:"2010",source:"2010",type:"raster"},2008:{id:"2008",source:"2008",type:"raster"},2004:{id:"2004",source:"2004",type:"raster"},1996:{id:"1996",source:"1996",type:"raster"},1962:{id:"1962",source:"1962",type:"raster"},1942:{id:"1942",source:"1942",type:"raster"},1910:{id:"1910",source:"1910",type:"raster"},1895:{id:"1895",source:"1895",type:"raster"},1875:{id:"1875",source:"1875",type:"raster"},1860:{id:"1860",source:"1860",type:"raster"}}};mn.pwdDrawnMapStyle=sI;mn.dorDrawnMapStyle=oI;mn.liDrawnMapStyle=aI;mn.zoningDrawnMapStyle=lI;mn.nearbyDrawnMapStyle=cI;const hu=Lo("ParcelsStore",{state:()=>({pwd:{},dor:{}}),actions:{async fillPwdParcelData(){const r=dn().addressData.features;if(!r)return;const a=r[0],u=a.properties.pwd_parcel_id;if(!u){console.log("no pwd parcel in AIS"),await this.fillParcelDataByLngLat(a.geometry.coordinates[0],a.geometry.coordinates[1],"pwd");return}try{const d=await fetch(`https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/PWD_PARCELS/FeatureServer/0/query?where=PARCELID=%27${u}%27&outSR=4326&f=geojson&outFields=*&returnGeometry=true`);d.ok?this.pwd=await d.json():console.error("Failed to fetch pwd parcel data")}catch{console.error("Failed to fetch pwd parcel data")}},async fillDorParcelData(){const r=dn().addressData.features;if(!r)return;const a=r[0],u=a.properties.dor_parcel_id;if(!u){console.log("no dor parcel in AIS"),await this.fillParcelDataByLngLat(a.geometry.coordinates[0],a.geometry.coordinates[1],"dor");return}const d="https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/DOR_Parcel/FeatureServer/0/query";let g;if(u.includes("|")){const l=u.split("|");let M="MAPREG = '",P;for(P=0;P<l.length;P++)M=M+l[P]+"'",P<l.length-1&&(M=M+" or MAPREG = '");g=d+"?where="+M}else Array.isArray(u)?g=d+"?where=MAPREG IN ("+u+")":g=d+"?where=MAPREG='"+u+"'";let m={outSR:4326,f:"geojson",outFields:"*",returnGeometry:!0};try{const l=await or(g,{params:m});if(l.status===200){console.log("response",l);const M=await l.data,P=M.features.filter(z=>z.properties.STATUS===1),R=M.features.filter(z=>z.properties.STATUS===2),D=M.features.filter(z=>z.properties.STATUS===3);M.features=P.concat(R).concat(D),this.dor=M}else console.error("Failed to fetch dor parcel data 1")}catch{console.error("Failed to fetch dor parcel data 2")}},async fillParcelDataByLngLat(e,r,a){console.log("fillParcelDataByLngLat, lng:",e,"lat:",r,"parcelLayer:",a);let u=a==="pwd"?"PWD_PARCELS":"DOR_Parcel",d={where:"1=1",outSR:4326,f:"geojson",outFields:"*",returnGeometry:!0,geometry:`{ "x": ${e}, "y": ${r}, "spatialReference":{ "wkid":4326 }}`,geometryType:"esriGeometryPoint",spatialRel:"esriSpatialRelWithin"};const g=await or(`https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/${u}/FeatureServer/0/query`,{params:d});console.log("response",g),g.data.features.length>0&&(this[a]=await g.data)}}});var As=63710088e-1,wx={centimeters:As*100,centimetres:As*100,degrees:As/111325,feet:As*3.28084,inches:As*39.37,kilometers:As/1e3,kilometres:As/1e3,meters:As,metres:As,miles:As/1609.344,millimeters:As*1e3,millimetres:As*1e3,nauticalmiles:As/1852,radians:1,yards:As*1.0936},e0={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function tg(e,r,a){a===void 0&&(a={});var u={type:"Feature"};return(a.id===0||a.id)&&(u.id=a.id),a.bbox&&(u.bbox=a.bbox),u.properties=r||{},u.geometry=e,u}function Lh(e,r,a){if(a===void 0&&(a={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!t0(e[0])||!t0(e[1]))throw new Error("coordinates must contain numbers");var u={type:"Point",coordinates:e};return tg(u,r,a)}function ig(e,r,a){a===void 0&&(a={});for(var u=0,d=e;u<d.length;u++){var g=d[u];if(g.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var m=0;m<g[g.length-1].length;m++)if(g[g.length-1][m]!==g[0][m])throw new Error("First and last Position are not equivalent.")}var l={type:"Polygon",coordinates:e};return tg(l,r,a)}function uI(e,r,a){if(a===void 0&&(a={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var u={type:"LineString",coordinates:e};return tg(u,r,a)}function hI(e,r){r===void 0&&(r={});var a={type:"FeatureCollection"};return r.id&&(a.id=r.id),r.bbox&&(a.bbox=r.bbox),a.features=e,a}function dI(e,r){r===void 0&&(r="kilometers");var a=wx[r];if(!a)throw new Error(r+" units is invalid");return e*a}function pI(e,r){r===void 0&&(r="kilometers");var a=wx[r];if(!a)throw new Error(r+" units is invalid");return e/a}function vm(e){var r=e%(2*Math.PI);return r*180/Math.PI}function Ra(e){var r=e%360;return r*Math.PI/180}function fI(e,r,a){if(r===void 0&&(r="meters"),a===void 0&&(a="kilometers"),!(e>=0))throw new Error("area must be a positive number");var u=e0[r];if(!u)throw new Error("invalid original units");var d=e0[a];if(!d)throw new Error("invalid final units");return e/u*d}function t0(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function mI(e,r){r===void 0&&(r={});var a=Number(e[0]),u=Number(e[1]),d=Number(e[2]),g=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var m=[a,u],l=[a,g],M=[d,g],P=[d,u];return ig([[m,P,M,l,m]],r.properties,{bbox:e,id:r.id})}const Wc=function(e){var r=e?String(e):"";return r=r.replace(/\s+/g,""),[null,"0"].indexOf(r)>-1?"":r},gI=function(e,r){console.log("concatDorAddress is running, parcel:",e),r=!!r;var a=["STDIR","STNAM","STDES","STDESSUF"],u=e.properties,d=Wc(u.HOUSE),g=Wc(u.STEX),m=Wc(u.SUF),l=d;l=l+(g?"-"+g:""),l=l+(m||"");var M=Wc(u.UNIT);M&&(M="# "+M);var P=a.map(function(R){return u[R]});return P=P.map(Wc),P=[l].concat(P),r&&(P=P.concat([M])),l=P.filter(Boolean).join(" "),l===""&&(l="Parcel has no address"),console.log("concatDorAddress address result:",l),l},Mx=Lo("DorStore",{state:()=>({dorDocuments:{},regmaps:{}}),actions:{async fillRegmaps(){console.log("fillRegmaps is running");const r=hu().dor.features;var a=[],u=[];r.forEach(function(W){var J=W.geometry,me=J.coordinates;me.forEach(function(xe){xe.forEach(function(Pe){var oe=Array.isArray(Pe[0]);if(oe)Pe.forEach(function(Ke){var dt=Ke[0],bt=Ke[1];a.push(dt),u.push(bt)});else{var Le=Pe[0],Ze=Pe[1];a.push(Le),u.push(Ze)}})})});var d=Math.min.apply(null,a),g=Math.max.apply(null,a),m=Math.min.apply(null,u),l=Math.max.apply(null,u),M=[d,g,m,l].every(function(W){return W});if(!M)return null;var P=[d,m,g,l],R=mI(P).geometry;console.log("regmaps.js, bounds:",R);let D="//services.arcgis.com/fLeGjb7u4uXqeF9q/arcgis/rest/services/MASTERMAPINDEX/FeatureServer/0/query",z={returnGeometry:!0,where:"1=1",outSR:4326,outFields:"*",inSr:4326,geometryType:"esriGeometryEnvelope",spatialRel:"esriSpatialRelIntersects",f:"geojson",geometry:`{ "xmin": ${R.coordinates[0][0][0]}, "ymin": ${R.coordinates[0][0][1]}, "xmax": ${R.coordinates[0][2][0]}, "ymax": ${R.coordinates[0][2][1]}, "spatialReference": { "wkid":4326 }}`};const Z=await or.get(D,{params:z});this.regmaps=Z},async fillDorDocuments(){console.log("fillDorDocuments is running"),this.dorDocuments={};const e=hu(),r=dn(),a="//services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/RTT_SUMMARY/FeatureServer/0/query",u=function(d){console.log("where function is running, feature:",d);var g=gI(d),m=r.addressData.features[0].properties,l;if(!g||g==="null")l="MATCHED_REGMAP = '"+e.dor.features[0].properties.BASEREG+"'";else{var M=r.addressData.features[0].properties,P=M.address_low,R=Math.floor(P/100,1)*100,D=P-R,z=M.address_high,Z=z||P;l="(((ADDRESS_LOW >= "+P+" AND ADDRESS_LOW <= "+Z+") OR (ADDRESS_LOW >= "+R+" AND ADDRESS_LOW <= "+Z+" AND ADDRESS_HIGH >= "+D+" )) AND STREET_NAME = '"+m.street_name+"' AND STREET_SUFFIX = '"+m.street_suffix+"' AND (MOD(ADDRESS_LOW,2) = MOD( "+P+",2))",m.street_predir!=""&&(l+=" AND STREET_PREDIR = '"+m.street_predir+"'"),m.address_low_suffix!=""&&(l+=" AND ADDRESS_LOW_SUFFIX = '"+m.address_low_suffix+"'"),m.address_low_suffix==""&&(l+=" AND ADDRESS_LOW_SUFFIX = ''"),m.address_low_frac==="1/2"&&(l+=" AND ADDRESS_LOW_SUFFIX = '2'"),m.street_postdir!=""&&(l+=" AND STREET_POSTDIR = '"+m.street_postdir+"'");var W=Wc(d.properties.UNIT),J=m.unit_num;W?l+=" AND UNIT_NUM = '"+W+"'":J!==""&&(l+=" AND UNIT_NUM = '"+J+"'"),l+=") or MATCHED_REGMAP = '"+e.dor.features[0].properties.BASEREG+"'",l+=" or REG_MAP_ID = '"+e.dor.features[0].properties.BASEREG+"'"}return l};for(let d of e.dor.features){const m={where:u(d),outFields:"DOCUMENT_ID, DISPLAY_DATE, DOCUMENT_TYPE, GRANTORS, GRANTEES",returnDistinctValues:"true",returnGeometry:"false",f:"json",sqlFormat:"standard"};console.log("params:",m);const l=await or(a,{params:m});this.dorDocuments[d.properties.OBJECTID]=l}}}});function yI(e){e("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),e("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),e("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),e.WGS84=e["EPSG:4326"],e["EPSG:3785"]=e["EPSG:3857"],e.GOOGLE=e["EPSG:3857"],e["EPSG:900913"]=e["EPSG:3857"],e["EPSG:102113"]=e["EPSG:3857"]}var cc=1,uc=2,nu=3,_I=4,xm=5,i0=6378137,vI=6356752314e-3,r0=.0066943799901413165,xh=484813681109536e-20,gt=Math.PI/2,xI=.16666666666666666,bI=.04722222222222222,wI=.022156084656084655,Lt=1e-10,Un=.017453292519943295,ro=57.29577951308232,sr=Math.PI/4,Rh=Math.PI*2,hn=3.14159265359,Os={};Os.greenwich=0;Os.lisbon=-9.131906111111;Os.paris=2.337229166667;Os.bogota=-74.080916666667;Os.madrid=-3.687938888889;Os.rome=12.452333333333;Os.bern=7.439583333333;Os.jakarta=106.807719444444;Os.ferro=-17.666666666667;Os.brussels=4.367975;Os.stockholm=18.058277777778;Os.athens=23.7163375;Os.oslo=10.722916666667;const MI={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var n0=/[\s_\-\/\(\)]/g;function El(e,r){if(e[r])return e[r];for(var a=Object.keys(e),u=r.toLowerCase().replace(n0,""),d=-1,g,m;++d<a.length;)if(g=a[d],m=g.toLowerCase().replace(n0,""),m===u)return e[g]}function bm(e){var r={},a=e.split("+").map(function(l){return l.trim()}).filter(function(l){return l}).reduce(function(l,M){var P=M.split("=");return P.push(!0),l[P[0].toLowerCase()]=P[1],l},{}),u,d,g,m={proj:"projName",datum:"datumCode",rf:function(l){r.rf=parseFloat(l)},lat_0:function(l){r.lat0=l*Un},lat_1:function(l){r.lat1=l*Un},lat_2:function(l){r.lat2=l*Un},lat_ts:function(l){r.lat_ts=l*Un},lon_0:function(l){r.long0=l*Un},lon_1:function(l){r.long1=l*Un},lon_2:function(l){r.long2=l*Un},alpha:function(l){r.alpha=parseFloat(l)*Un},gamma:function(l){r.rectified_grid_angle=parseFloat(l)},lonc:function(l){r.longc=l*Un},x_0:function(l){r.x0=parseFloat(l)},y_0:function(l){r.y0=parseFloat(l)},k_0:function(l){r.k0=parseFloat(l)},k:function(l){r.k0=parseFloat(l)},a:function(l){r.a=parseFloat(l)},b:function(l){r.b=parseFloat(l)},r:function(l){r.a=r.b=parseFloat(l)},r_a:function(){r.R_A=!0},zone:function(l){r.zone=parseInt(l,10)},south:function(){r.utmSouth=!0},towgs84:function(l){r.datum_params=l.split(",").map(function(M){return parseFloat(M)})},to_meter:function(l){r.to_meter=parseFloat(l)},units:function(l){r.units=l;var M=El(MI,l);M&&(r.to_meter=M.to_meter)},from_greenwich:function(l){r.from_greenwich=l*Un},pm:function(l){var M=El(Os,l);r.from_greenwich=(M||parseFloat(l))*Un},nadgrids:function(l){l==="@null"?r.datumCode="none":r.nadgrids=l},axis:function(l){var M="ewnsud";l.length===3&&M.indexOf(l.substr(0,1))!==-1&&M.indexOf(l.substr(1,1))!==-1&&M.indexOf(l.substr(2,1))!==-1&&(r.axis=l)},approx:function(){r.approx=!0}};for(u in a)d=a[u],u in m?(g=m[u],typeof g=="function"?g(d):r[g]=d):r[u]=d;return typeof r.datumCode=="string"&&r.datumCode!=="WGS84"&&(r.datumCode=r.datumCode.toLowerCase()),r}var zh=1,Sx=2,Ex=3,op=4,Tx=5,rg=-1,SI=/\s/,EI=/[A-Za-z]/,TI=/[A-Za-z84_]/,Fp=/[,\]]/,Cx=/[\d\.E\-\+]/;function Ro(e){if(typeof e!="string")throw new Error("not a string");this.text=e.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=zh}Ro.prototype.readCharicter=function(){var e=this.text[this.place++];if(this.state!==op)for(;SI.test(e);){if(this.place>=this.text.length)return;e=this.text[this.place++]}switch(this.state){case zh:return this.neutral(e);case Sx:return this.keyword(e);case op:return this.quoted(e);case Tx:return this.afterquote(e);case Ex:return this.number(e);case rg:return}};Ro.prototype.afterquote=function(e){if(e==='"'){this.word+='"',this.state=op;return}if(Fp.test(e)){this.word=this.word.trim(),this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in afterquote yet, index '+this.place)};Ro.prototype.afterItem=function(e){if(e===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=zh;return}if(e==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=zh,this.currentObject=this.stack.pop(),this.currentObject||(this.state=rg);return}};Ro.prototype.number=function(e){if(Cx.test(e)){this.word+=e;return}if(Fp.test(e)){this.word=parseFloat(this.word),this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in number yet, index '+this.place)};Ro.prototype.quoted=function(e){if(e==='"'){this.state=Tx;return}this.word+=e};Ro.prototype.keyword=function(e){if(TI.test(e)){this.word+=e;return}if(e==="["){var r=[];r.push(this.word),this.level++,this.root===null?this.root=r:this.currentObject.push(r),this.stack.push(this.currentObject),this.currentObject=r,this.state=zh;return}if(Fp.test(e)){this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in keyword yet, index '+this.place)};Ro.prototype.neutral=function(e){if(EI.test(e)){this.word=e,this.state=Sx;return}if(e==='"'){this.word="",this.state=op;return}if(Cx.test(e)){this.word=e,this.state=Ex;return}if(Fp.test(e)){this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in neutral yet, index '+this.place)};Ro.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===rg)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function CI(e){var r=new Ro(e);return r.output()}function s0(e,r,a){Array.isArray(r)&&(a.unshift(r),r=null);var u=r?{}:e,d=a.reduce(function(g,m){return Kc(m,g),g},u);r&&(e[r]=d)}function Kc(e,r){if(!Array.isArray(e)){r[e]=!0;return}var a=e.shift();if(a==="PARAMETER"&&(a=e.shift()),e.length===1){if(Array.isArray(e[0])){r[a]={},Kc(e[0],r[a]);return}r[a]=e[0];return}if(!e.length){r[a]=!0;return}if(a==="TOWGS84"){r[a]=e;return}if(a==="AXIS"){a in r||(r[a]=[]),r[a].push(e);return}Array.isArray(a)||(r[a]={});var u;switch(a){case"UNIT":case"PRIMEM":case"VERT_DATUM":r[a]={name:e[0].toLowerCase(),convert:e[1]},e.length===3&&Kc(e[2],r[a]);return;case"SPHEROID":case"ELLIPSOID":r[a]={name:e[0],a:e[1],rf:e[2]},e.length===4&&Kc(e[3],r[a]);return;case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":e[0]=["name",e[0]],s0(r,a,e);return;default:for(u=-1;++u<e.length;)if(!Array.isArray(e[u]))return Kc(e,r[a]);return s0(r,a,e)}}var II=.017453292519943295;function AI(e,r){var a=r[0],u=r[1];!(a in e)&&u in e&&(e[a]=e[u],r.length===3&&(e[a]=r[2](e[a])))}function Qa(e){return e*II}function PI(e){if(e.type==="GEOGCS"?e.projName="longlat":e.type==="LOCAL_CS"?(e.projName="identity",e.local=!0):typeof e.PROJECTION=="object"?e.projName=Object.keys(e.PROJECTION)[0]:e.projName=e.PROJECTION,e.AXIS){for(var r="",a=0,u=e.AXIS.length;a<u;++a){var d=[e.AXIS[a][0].toLowerCase(),e.AXIS[a][1].toLowerCase()];d[0].indexOf("north")!==-1||(d[0]==="y"||d[0]==="lat")&&d[1]==="north"?r+="n":d[0].indexOf("south")!==-1||(d[0]==="y"||d[0]==="lat")&&d[1]==="south"?r+="s":d[0].indexOf("east")!==-1||(d[0]==="x"||d[0]==="lon")&&d[1]==="east"?r+="e":(d[0].indexOf("west")!==-1||(d[0]==="x"||d[0]==="lon")&&d[1]==="west")&&(r+="w")}r.length===2&&(r+="u"),r.length===3&&(e.axis=r)}e.UNIT&&(e.units=e.UNIT.name.toLowerCase(),e.units==="metre"&&(e.units="meter"),e.UNIT.convert&&(e.type==="GEOGCS"?e.DATUM&&e.DATUM.SPHEROID&&(e.to_meter=e.UNIT.convert*e.DATUM.SPHEROID.a):e.to_meter=e.UNIT.convert));var g=e.GEOGCS;e.type==="GEOGCS"&&(g=e),g&&(g.DATUM?e.datumCode=g.DATUM.name.toLowerCase():e.datumCode=g.name.toLowerCase(),e.datumCode.slice(0,2)==="d_"&&(e.datumCode=e.datumCode.slice(2)),(e.datumCode==="new_zealand_geodetic_datum_1949"||e.datumCode==="new_zealand_1949")&&(e.datumCode="nzgd49"),(e.datumCode==="wgs_1984"||e.datumCode==="world_geodetic_system_1984")&&(e.PROJECTION==="Mercator_Auxiliary_Sphere"&&(e.sphere=!0),e.datumCode="wgs84"),e.datumCode.slice(-6)==="_ferro"&&(e.datumCode=e.datumCode.slice(0,-6)),e.datumCode.slice(-8)==="_jakarta"&&(e.datumCode=e.datumCode.slice(0,-8)),~e.datumCode.indexOf("belge")&&(e.datumCode="rnb72"),g.DATUM&&g.DATUM.SPHEROID&&(e.ellps=g.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),e.ellps.toLowerCase().slice(0,13)==="international"&&(e.ellps="intl"),e.a=g.DATUM.SPHEROID.a,e.rf=parseFloat(g.DATUM.SPHEROID.rf,10)),g.DATUM&&g.DATUM.TOWGS84&&(e.datum_params=g.DATUM.TOWGS84),~e.datumCode.indexOf("osgb_1936")&&(e.datumCode="osgb36"),~e.datumCode.indexOf("osni_1952")&&(e.datumCode="osni52"),(~e.datumCode.indexOf("tm65")||~e.datumCode.indexOf("geodetic_datum_of_1965"))&&(e.datumCode="ire65"),e.datumCode==="ch1903+"&&(e.datumCode="ch1903"),~e.datumCode.indexOf("israel")&&(e.datumCode="isr93")),e.b&&!isFinite(e.b)&&(e.b=e.a);function m(P){var R=e.to_meter||1;return P*R}var l=function(P){return AI(e,P)},M=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Qa],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Qa],["x0","false_easting",m],["y0","false_northing",m],["long0","central_meridian",Qa],["lat0","latitude_of_origin",Qa],["lat0","standard_parallel_1",Qa],["lat1","standard_parallel_1",Qa],["lat2","standard_parallel_2",Qa],["azimuth","Azimuth"],["alpha","azimuth",Qa],["srsCode","name"]];M.forEach(l),!e.long0&&e.longc&&(e.projName==="Albers_Conic_Equal_Area"||e.projName==="Lambert_Azimuthal_Equal_Area")&&(e.long0=e.longc),!e.lat_ts&&e.lat1&&(e.projName==="Stereographic_South_Pole"||e.projName==="Polar Stereographic (variant B)")?(e.lat0=Qa(e.lat1>0?90:-90),e.lat_ts=e.lat1):!e.lat_ts&&e.lat0&&e.projName==="Polar_Stereographic"&&(e.lat_ts=e.lat0,e.lat0=Qa(e.lat0>0?90:-90))}function Ix(e){var r=CI(e),a=r.shift(),u=r.shift();r.unshift(["name",u]),r.unshift(["type",a]);var d={};return Kc(r,d),PI(d),d}function gs(e){var r=this;if(arguments.length===2){var a=arguments[1];typeof a=="string"?a.charAt(0)==="+"?gs[e]=bm(arguments[1]):gs[e]=Ix(arguments[1]):gs[e]=a}else if(arguments.length===1){if(Array.isArray(e))return e.map(function(u){Array.isArray(u)?gs.apply(r,u):gs(u)});if(typeof e=="string"){if(e in gs)return gs[e]}else"EPSG"in e?gs["EPSG:"+e.EPSG]=e:"ESRI"in e?gs["ESRI:"+e.ESRI]=e:"IAU2000"in e?gs["IAU2000:"+e.IAU2000]=e:console.log(e);return}}yI(gs);function DI(e){return typeof e=="string"}function kI(e){return e in gs}var LI=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function RI(e){return LI.some(function(r){return e.indexOf(r)>-1})}var zI=["3857","900913","3785","102113"];function OI(e){var r=El(e,"authority");if(r){var a=El(r,"epsg");return a&&zI.indexOf(a)>-1}}function FI(e){var r=El(e,"extension");if(r)return El(r,"proj4")}function BI(e){return e[0]==="+"}function NI(e){if(DI(e)){if(kI(e))return gs[e];if(RI(e)){var r=Ix(e);if(OI(r))return gs["EPSG:3857"];var a=FI(r);return a?bm(a):r}if(BI(e))return bm(e)}else return e}function a0(e,r){e=e||{};var a,u;if(!r)return e;for(u in r)a=r[u],a!==void 0&&(e[u]=a);return e}function ao(e,r,a){var u=e*r;return a/Math.sqrt(1-u*u)}function Wh(e){return e<0?-1:1}function Vt(e){return Math.abs(e)<=hn?e:e-Wh(e)*Rh}function Oa(e,r,a){var u=e*a,d=.5*e;return u=Math.pow((1-u)/(1+u),d),Math.tan(.5*(gt-r))/u}function Oh(e,r){for(var a=.5*e,u,d,g=gt-2*Math.atan(r),m=0;m<=15;m++)if(u=e*Math.sin(g),d=gt-2*Math.atan(r*Math.pow((1-u)/(1+u),a))-g,g+=d,Math.abs(d)<=1e-10)return g;return-9999}function $I(){var e=this.b/this.a;this.es=1-e*e,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=ao(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function UI(e){var r=e.x,a=e.y;if(a*ro>90&&a*ro<-90&&r*ro>180&&r*ro<-180)return null;var u,d;if(Math.abs(Math.abs(a)-gt)<=Lt)return null;if(this.sphere)u=this.x0+this.a*this.k0*Vt(r-this.long0),d=this.y0+this.a*this.k0*Math.log(Math.tan(sr+.5*a));else{var g=Math.sin(a),m=Oa(this.e,a,g);u=this.x0+this.a*this.k0*Vt(r-this.long0),d=this.y0-this.a*this.k0*Math.log(m)}return e.x=u,e.y=d,e}function VI(e){var r=e.x-this.x0,a=e.y-this.y0,u,d;if(this.sphere)d=gt-2*Math.atan(Math.exp(-a/(this.a*this.k0)));else{var g=Math.exp(-a/(this.a*this.k0));if(d=Oh(this.e,g),d===-9999)return null}return u=Vt(this.long0+r/(this.a*this.k0)),e.x=u,e.y=d,e}var jI=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];const qI={init:$I,forward:UI,inverse:VI,names:jI};function GI(){}function o0(e){return e}var HI=["longlat","identity"];const ZI={init:GI,forward:o0,inverse:o0,names:HI};var WI=[qI,ZI],Zd={},lp=[];function Ax(e,r){var a=lp.length;return e.names?(lp[a]=e,e.names.forEach(function(u){Zd[u.toLowerCase()]=a}),this):(console.log(r),!0)}function XI(e){if(!e)return!1;var r=e.toLowerCase();if(typeof Zd[r]<"u"&&lp[Zd[r]])return lp[Zd[r]]}function KI(){WI.forEach(Ax)}const YI={start:KI,add:Ax,get:XI};var wi={};wi.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};wi.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};wi.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};wi.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};wi.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"};wi.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};wi.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};wi.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"};wi.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};wi.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};wi.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};wi.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"};wi.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};wi.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"};wi.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."};wi.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"};wi.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"};wi.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};wi.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};wi.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"};wi.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"};wi.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"};wi.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"};wi.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"};wi.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};wi.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};wi.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};wi.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};wi.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};wi.hough={a:6378270,rf:297,ellipseName:"Hough"};wi.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};wi.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};wi.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};wi.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};wi.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"};wi.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};wi.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};wi.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"};wi.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"};wi.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};wi.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};wi.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var JI=wi.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};wi.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function QI(e,r,a,u){var d=e*e,g=r*r,m=(d-g)/d,l=0;u?(e*=1-m*(xI+m*(bI+m*wI)),d=e*e,m=0):l=Math.sqrt(m);var M=(d-g)/g;return{es:m,e:l,ep2:M}}function eA(e,r,a,u,d){if(!e){var g=El(wi,u);g||(g=JI),e=g.a,r=g.b,a=g.rf}return a&&!r&&(r=(1-1/a)*e),(a===0||Math.abs(e-r)<Lt)&&(d=!0,r=e),{a:e,b:r,rf:a,sphere:d}}var Pn={};Pn.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"};Pn.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"};Pn.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"};Pn.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"};Pn.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"};Pn.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"};Pn.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"};Pn.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"};Pn.militargeographische_institut={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"};Pn.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"};Pn.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"};Pn.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"};Pn.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"};Pn.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"};Pn.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"};Pn.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"};Pn.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"};Pn.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};function tA(e,r,a,u,d,g,m){var l={};return e===void 0||e==="none"?l.datum_type=xm:l.datum_type=_I,r&&(l.datum_params=r.map(parseFloat),(l.datum_params[0]!==0||l.datum_params[1]!==0||l.datum_params[2]!==0)&&(l.datum_type=cc),l.datum_params.length>3&&(l.datum_params[3]!==0||l.datum_params[4]!==0||l.datum_params[5]!==0||l.datum_params[6]!==0)&&(l.datum_type=uc,l.datum_params[3]*=xh,l.datum_params[4]*=xh,l.datum_params[5]*=xh,l.datum_params[6]=l.datum_params[6]/1e6+1)),m&&(l.datum_type=nu,l.grids=m),l.a=a,l.b=u,l.es=d,l.ep2=g,l}var Px={};function iA(e,r){var a=new DataView(r),u=sA(a),d=aA(a,u),g=oA(a,d,u),m={header:d,subgrids:g};return Px[e]=m,m}function rA(e){if(e===void 0)return null;var r=e.split(",");return r.map(nA)}function nA(e){if(e.length===0)return null;var r=e[0]==="@";return r&&(e=e.slice(1)),e==="null"?{name:"null",mandatory:!r,grid:null,isNull:!0}:{name:e,mandatory:!r,grid:Px[e]||null,isNull:!1}}function Yc(e){return e/3600*Math.PI/180}function sA(e){var r=e.getInt32(8,!1);return r===11?!1:(r=e.getInt32(8,!0),r!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function aA(e,r){return{nFields:e.getInt32(8,r),nSubgridFields:e.getInt32(24,r),nSubgrids:e.getInt32(40,r),shiftType:wm(e,56,64).trim(),fromSemiMajorAxis:e.getFloat64(120,r),fromSemiMinorAxis:e.getFloat64(136,r),toSemiMajorAxis:e.getFloat64(152,r),toSemiMinorAxis:e.getFloat64(168,r)}}function wm(e,r,a){return String.fromCharCode.apply(null,new Uint8Array(e.buffer.slice(r,a)))}function oA(e,r,a){for(var u=176,d=[],g=0;g<r.nSubgrids;g++){var m=cA(e,u,a),l=uA(e,u,m,a),M=Math.round(1+(m.upperLongitude-m.lowerLongitude)/m.longitudeInterval),P=Math.round(1+(m.upperLatitude-m.lowerLatitude)/m.latitudeInterval);d.push({ll:[Yc(m.lowerLongitude),Yc(m.lowerLatitude)],del:[Yc(m.longitudeInterval),Yc(m.latitudeInterval)],lim:[M,P],count:m.gridNodeCount,cvs:lA(l)}),u+=176+m.gridNodeCount*16}return d}function lA(e){return e.map(function(r){return[Yc(r.longitudeShift),Yc(r.latitudeShift)]})}function cA(e,r,a){return{name:wm(e,r+8,r+16).trim(),parent:wm(e,r+24,r+24+8).trim(),lowerLatitude:e.getFloat64(r+72,a),upperLatitude:e.getFloat64(r+88,a),lowerLongitude:e.getFloat64(r+104,a),upperLongitude:e.getFloat64(r+120,a),latitudeInterval:e.getFloat64(r+136,a),longitudeInterval:e.getFloat64(r+152,a),gridNodeCount:e.getInt32(r+168,a)}}function uA(e,r,a,u){for(var d=r+176,g=16,m=[],l=0;l<a.gridNodeCount;l++){var M={latitudeShift:e.getFloat32(d+l*g,u),longitudeShift:e.getFloat32(d+l*g+4,u),latitudeAccuracy:e.getFloat32(d+l*g+8,u),longitudeAccuracy:e.getFloat32(d+l*g+12,u)};m.push(M)}return m}function no(e,r){if(!(this instanceof no))return new no(e);r=r||function(P){if(P)throw P};var a=NI(e);if(typeof a!="object"){r(e);return}var u=no.projections.get(a.projName);if(!u){r(e);return}if(a.datumCode&&a.datumCode!=="none"){var d=El(Pn,a.datumCode);d&&(a.datum_params=a.datum_params||(d.towgs84?d.towgs84.split(","):null),a.ellps=d.ellipse,a.datumName=d.datumName?d.datumName:a.datumCode)}a.k0=a.k0||1,a.axis=a.axis||"enu",a.ellps=a.ellps||"wgs84",a.lat1=a.lat1||a.lat0;var g=eA(a.a,a.b,a.rf,a.ellps,a.sphere),m=QI(g.a,g.b,g.rf,a.R_A),l=rA(a.nadgrids),M=a.datum||tA(a.datumCode,a.datum_params,g.a,g.b,m.es,m.ep2,l);a0(this,a),a0(this,u),this.a=g.a,this.b=g.b,this.rf=g.rf,this.sphere=g.sphere,this.es=m.es,this.e=m.e,this.ep2=m.ep2,this.datum=M,this.init(),r(null,this)}no.projections=YI;no.projections.start();function hA(e,r){return e.datum_type!==r.datum_type||e.a!==r.a||Math.abs(e.es-r.es)>5e-11?!1:e.datum_type===cc?e.datum_params[0]===r.datum_params[0]&&e.datum_params[1]===r.datum_params[1]&&e.datum_params[2]===r.datum_params[2]:e.datum_type===uc?e.datum_params[0]===r.datum_params[0]&&e.datum_params[1]===r.datum_params[1]&&e.datum_params[2]===r.datum_params[2]&&e.datum_params[3]===r.datum_params[3]&&e.datum_params[4]===r.datum_params[4]&&e.datum_params[5]===r.datum_params[5]&&e.datum_params[6]===r.datum_params[6]:!0}function Dx(e,r,a){var u=e.x,d=e.y,g=e.z?e.z:0,m,l,M,P;if(d<-gt&&d>-1.001*gt)d=-gt;else if(d>gt&&d<1.001*gt)d=gt;else{if(d<-gt)return{x:-1/0,y:-1/0,z:e.z};if(d>gt)return{x:1/0,y:1/0,z:e.z}}return u>Math.PI&&(u-=2*Math.PI),l=Math.sin(d),P=Math.cos(d),M=l*l,m=a/Math.sqrt(1-r*M),{x:(m+g)*P*Math.cos(u),y:(m+g)*P*Math.sin(u),z:(m*(1-r)+g)*l}}function kx(e,r,a,u){var d=1e-12,g=d*d,m=30,l,M,P,R,D,z,Z,W,J,me,xe,Pe,oe,Le=e.x,Ze=e.y,Ke=e.z?e.z:0,dt,bt,Pt;if(l=Math.sqrt(Le*Le+Ze*Ze),M=Math.sqrt(Le*Le+Ze*Ze+Ke*Ke),l/a<d){if(dt=0,M/a<d)return bt=gt,Pt=-u,{x:e.x,y:e.y,z:e.z}}else dt=Math.atan2(Ze,Le);P=Ke/M,R=l/M,D=1/Math.sqrt(1-r*(2-r)*R*R),W=R*(1-r)*D,J=P*D,oe=0;do oe++,Z=a/Math.sqrt(1-r*J*J),Pt=l*W+Ke*J-Z*(1-r*J*J),z=r*Z/(Z+Pt),D=1/Math.sqrt(1-z*(2-z)*R*R),me=R*(1-z)*D,xe=P*D,Pe=xe*W-me*J,W=me,J=xe;while(Pe*Pe>g&&oe<m);return bt=Math.atan(xe/Math.abs(me)),{x:dt,y:bt,z:Pt}}function dA(e,r,a){if(r===cc)return{x:e.x+a[0],y:e.y+a[1],z:e.z+a[2]};if(r===uc){var u=a[0],d=a[1],g=a[2],m=a[3],l=a[4],M=a[5],P=a[6];return{x:P*(e.x-M*e.y+l*e.z)+u,y:P*(M*e.x+e.y-m*e.z)+d,z:P*(-l*e.x+m*e.y+e.z)+g}}}function pA(e,r,a){if(r===cc)return{x:e.x-a[0],y:e.y-a[1],z:e.z-a[2]};if(r===uc){var u=a[0],d=a[1],g=a[2],m=a[3],l=a[4],M=a[5],P=a[6],R=(e.x-u)/P,D=(e.y-d)/P,z=(e.z-g)/P;return{x:R+M*D-l*z,y:-M*R+D+m*z,z:l*R-m*D+z}}}function zd(e){return e===cc||e===uc}function fA(e,r,a){if(hA(e,r)||e.datum_type===xm||r.datum_type===xm)return a;var u=e.a,d=e.es;if(e.datum_type===nu){var g=l0(e,!1,a);if(g!==0)return;u=i0,d=r0}var m=r.a,l=r.b,M=r.es;if(r.datum_type===nu&&(m=i0,l=vI,M=r0),d===M&&u===m&&!zd(e.datum_type)&&!zd(r.datum_type))return a;if(a=Dx(a,d,u),zd(e.datum_type)&&(a=dA(a,e.datum_type,e.datum_params)),zd(r.datum_type)&&(a=pA(a,r.datum_type,r.datum_params)),a=kx(a,M,m,l),r.datum_type===nu){var P=l0(r,!0,a);if(P!==0)return}return a}function l0(e,r,a){if(e.grids===null||e.grids.length===0)return console.log("Grid shift grids not found"),-1;var u={x:-a.x,y:a.y},d={x:Number.NaN,y:Number.NaN},g=[];e:for(var m=0;m<e.grids.length;m++){var l=e.grids[m];if(g.push(l.name),l.isNull){d=u;break}if(l.mandatory,l.grid===null){if(l.mandatory)return console.log("Unable to find mandatory grid '"+l.name+"'"),-1;continue}for(var M=l.grid.subgrids,P=0,R=M.length;P<R;P++){var D=M[P],z=(Math.abs(D.del[1])+Math.abs(D.del[0]))/1e4,Z=D.ll[0]-z,W=D.ll[1]-z,J=D.ll[0]+(D.lim[0]-1)*D.del[0]+z,me=D.ll[1]+(D.lim[1]-1)*D.del[1]+z;if(!(W>u.y||Z>u.x||me<u.y||J<u.x)&&(d=mA(u,r,D),!isNaN(d.x)))break e}}return isNaN(d.x)?(console.log("Failed to find a grid shift table for location '"+-u.x*ro+" "+u.y*ro+" tried: '"+g+"'"),-1):(a.x=-d.x,a.y=d.y,0)}function mA(e,r,a){var u={x:Number.NaN,y:Number.NaN};if(isNaN(e.x))return u;var d={x:e.x,y:e.y};d.x-=a.ll[0],d.y-=a.ll[1],d.x=Vt(d.x-Math.PI)+Math.PI;var g=c0(d,a);if(r){if(isNaN(g.x))return u;g.x=d.x-g.x,g.y=d.y-g.y;var m=9,l=1e-12,M,P;do{if(P=c0(g,a),isNaN(P.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}M={x:d.x-(P.x+g.x),y:d.y-(P.y+g.y)},g.x+=M.x,g.y+=M.y}while(m--&&Math.abs(M.x)>l&&Math.abs(M.y)>l);if(m<0)return console.log("Inverse grid shift iterator failed to converge."),u;u.x=Vt(g.x+a.ll[0]),u.y=g.y+a.ll[1]}else isNaN(g.x)||(u.x=e.x+g.x,u.y=e.y+g.y);return u}function c0(e,r){var a={x:e.x/r.del[0],y:e.y/r.del[1]},u={x:Math.floor(a.x),y:Math.floor(a.y)},d={x:a.x-1*u.x,y:a.y-1*u.y},g={x:Number.NaN,y:Number.NaN},m;if(u.x<0||u.x>=r.lim[0]||u.y<0||u.y>=r.lim[1])return g;m=u.y*r.lim[0]+u.x;var l={x:r.cvs[m][0],y:r.cvs[m][1]};m++;var M={x:r.cvs[m][0],y:r.cvs[m][1]};m+=r.lim[0];var P={x:r.cvs[m][0],y:r.cvs[m][1]};m--;var R={x:r.cvs[m][0],y:r.cvs[m][1]},D=d.x*d.y,z=d.x*(1-d.y),Z=(1-d.x)*(1-d.y),W=(1-d.x)*d.y;return g.x=Z*l.x+z*M.x+W*R.x+D*P.x,g.y=Z*l.y+z*M.y+W*R.y+D*P.y,g}function u0(e,r,a){var u=a.x,d=a.y,g=a.z||0,m,l,M,P={};for(M=0;M<3;M++)if(!(r&&M===2&&a.z===void 0))switch(M===0?(m=u,"ew".indexOf(e.axis[M])!==-1?l="x":l="y"):M===1?(m=d,"ns".indexOf(e.axis[M])!==-1?l="y":l="x"):(m=g,l="z"),e.axis[M]){case"e":P[l]=m;break;case"w":P[l]=-m;break;case"n":P[l]=m;break;case"s":P[l]=-m;break;case"u":a[l]!==void 0&&(P.z=m);break;case"d":a[l]!==void 0&&(P.z=-m);break;default:return null}return P}function Lx(e){var r={x:e[0],y:e[1]};return e.length>2&&(r.z=e[2]),e.length>3&&(r.m=e[3]),r}function gA(e){h0(e.x),h0(e.y)}function h0(e){if(typeof Number.isFinite=="function"){if(Number.isFinite(e))return;throw new TypeError("coordinates must be finite numbers")}if(typeof e!="number"||e!==e||!isFinite(e))throw new TypeError("coordinates must be finite numbers")}function yA(e,r){return(e.datum.datum_type===cc||e.datum.datum_type===uc||e.datum.datum_type===nu)&&r.datumCode!=="WGS84"||(r.datum.datum_type===cc||r.datum.datum_type===uc||r.datum.datum_type===nu)&&e.datumCode!=="WGS84"}function cp(e,r,a,u){var d;Array.isArray(a)?a=Lx(a):a={x:a.x,y:a.y,z:a.z,m:a.m};var g=a.z!==void 0;if(gA(a),e.datum&&r.datum&&yA(e,r)&&(d=new no("WGS84"),a=cp(e,d,a,u),e=d),u&&e.axis!=="enu"&&(a=u0(e,!1,a)),e.projName==="longlat")a={x:a.x*Un,y:a.y*Un,z:a.z||0};else if(e.to_meter&&(a={x:a.x*e.to_meter,y:a.y*e.to_meter,z:a.z||0}),a=e.inverse(a),!a)return;if(e.from_greenwich&&(a.x+=e.from_greenwich),a=fA(e.datum,r.datum,a),!!a)return r.from_greenwich&&(a={x:a.x-r.from_greenwich,y:a.y,z:a.z||0}),r.projName==="longlat"?a={x:a.x*ro,y:a.y*ro,z:a.z||0}:(a=r.forward(a),r.to_meter&&(a={x:a.x/r.to_meter,y:a.y/r.to_meter,z:a.z||0})),u&&r.axis!=="enu"?u0(r,!0,a):(a&&!g&&delete a.z,a)}var d0=no("WGS84");function Gf(e,r,a,u){var d,g,m;return Array.isArray(a)?(d=cp(e,r,a,u)||{x:NaN,y:NaN},a.length>2?typeof e.name<"u"&&e.name==="geocent"||typeof r.name<"u"&&r.name==="geocent"?typeof d.z=="number"?[d.x,d.y,d.z].concat(a.splice(3)):[d.x,d.y,a[2]].concat(a.splice(3)):[d.x,d.y].concat(a.splice(2)):[d.x,d.y]):(g=cp(e,r,a,u),m=Object.keys(a),m.length===2||m.forEach(function(l){if(typeof e.name<"u"&&e.name==="geocent"||typeof r.name<"u"&&r.name==="geocent"){if(l==="x"||l==="y"||l==="z")return}else if(l==="x"||l==="y")return;g[l]=a[l]}),g)}function p0(e){return e instanceof no?e:e.oProj?e.oProj:no(e)}function Ys(e,r,a){e=p0(e);var u=!1,d;return typeof r>"u"?(r=e,e=d0,u=!0):(typeof r.x<"u"||Array.isArray(r))&&(a=r,r=e,e=d0,u=!0),r=p0(r),a?Gf(e,r,a):(d={forward:function(g,m){return Gf(e,r,g,m)},inverse:function(g,m){return Gf(r,e,g,m)}},u&&(d.oProj=r),d)}var f0=6,Rx="AJSAJS",zx="AFAFAF",Jc=65,Ps=73,ha=79,uh=86,hh=90;const _A={forward:Ox,inverse:vA,toPoint:Fx};function Ox(e,r){return r=r||5,wA(xA({lat:e[1],lon:e[0]}),r)}function vA(e){var r=ng(Nx(e.toUpperCase()));return r.lat&&r.lon?[r.lon,r.lat,r.lon,r.lat]:[r.left,r.bottom,r.right,r.top]}function Fx(e){var r=ng(Nx(e.toUpperCase()));return r.lat&&r.lon?[r.lon,r.lat]:[(r.left+r.right)/2,(r.top+r.bottom)/2]}function Hf(e){return e*(Math.PI/180)}function m0(e){return 180*(e/Math.PI)}function xA(e){var r=e.lat,a=e.lon,u=6378137,d=.00669438,g=.9996,m,l,M,P,R,D,z,Z=Hf(r),W=Hf(a),J,me;me=Math.floor((a+180)/6)+1,a===180&&(me=60),r>=56&&r<64&&a>=3&&a<12&&(me=32),r>=72&&r<84&&(a>=0&&a<9?me=31:a>=9&&a<21?me=33:a>=21&&a<33?me=35:a>=33&&a<42&&(me=37)),m=(me-1)*6-180+3,J=Hf(m),l=d/(1-d),M=u/Math.sqrt(1-d*Math.sin(Z)*Math.sin(Z)),P=Math.tan(Z)*Math.tan(Z),R=l*Math.cos(Z)*Math.cos(Z),D=Math.cos(Z)*(W-J),z=u*((1-d/4-3*d*d/64-5*d*d*d/256)*Z-(3*d/8+3*d*d/32+45*d*d*d/1024)*Math.sin(2*Z)+(15*d*d/256+45*d*d*d/1024)*Math.sin(4*Z)-35*d*d*d/3072*Math.sin(6*Z));var xe=g*M*(D+(1-P+R)*D*D*D/6+(5-18*P+P*P+72*R-58*l)*D*D*D*D*D/120)+5e5,Pe=g*(z+M*Math.tan(Z)*(D*D/2+(5-P+9*R+4*R*R)*D*D*D*D/24+(61-58*P+P*P+600*R-330*l)*D*D*D*D*D*D/720));return r<0&&(Pe+=1e7),{northing:Math.round(Pe),easting:Math.round(xe),zoneNumber:me,zoneLetter:bA(r)}}function ng(e){var r=e.northing,a=e.easting,u=e.zoneLetter,d=e.zoneNumber;if(d<0||d>60)return null;var g=.9996,m=6378137,l=.00669438,M,P=(1-Math.sqrt(1-l))/(1+Math.sqrt(1-l)),R,D,z,Z,W,J,me,xe,Pe,oe=a-5e5,Le=r;u<"N"&&(Le-=1e7),me=(d-1)*6-180+3,M=l/(1-l),J=Le/g,xe=J/(m*(1-l/4-3*l*l/64-5*l*l*l/256)),Pe=xe+(3*P/2-27*P*P*P/32)*Math.sin(2*xe)+(21*P*P/16-55*P*P*P*P/32)*Math.sin(4*xe)+151*P*P*P/96*Math.sin(6*xe),R=m/Math.sqrt(1-l*Math.sin(Pe)*Math.sin(Pe)),D=Math.tan(Pe)*Math.tan(Pe),z=M*Math.cos(Pe)*Math.cos(Pe),Z=m*(1-l)/Math.pow(1-l*Math.sin(Pe)*Math.sin(Pe),1.5),W=oe/(R*g);var Ze=Pe-R*Math.tan(Pe)/Z*(W*W/2-(5+3*D+10*z-4*z*z-9*M)*W*W*W*W/24+(61+90*D+298*z+45*D*D-252*M-3*z*z)*W*W*W*W*W*W/720);Ze=m0(Ze);var Ke=(W-(1+2*D+z)*W*W*W/6+(5-2*z+28*D-3*z*z+8*M+24*D*D)*W*W*W*W*W/120)/Math.cos(Pe);Ke=me+m0(Ke);var dt;if(e.accuracy){var bt=ng({northing:e.northing+e.accuracy,easting:e.easting+e.accuracy,zoneLetter:e.zoneLetter,zoneNumber:e.zoneNumber});dt={top:bt.lat,right:bt.lon,bottom:Ze,left:Ke}}else dt={lat:Ze,lon:Ke};return dt}function bA(e){var r="Z";return 84>=e&&e>=72?r="X":72>e&&e>=64?r="W":64>e&&e>=56?r="V":56>e&&e>=48?r="U":48>e&&e>=40?r="T":40>e&&e>=32?r="S":32>e&&e>=24?r="R":24>e&&e>=16?r="Q":16>e&&e>=8?r="P":8>e&&e>=0?r="N":0>e&&e>=-8?r="M":-8>e&&e>=-16?r="L":-16>e&&e>=-24?r="K":-24>e&&e>=-32?r="J":-32>e&&e>=-40?r="H":-40>e&&e>=-48?r="G":-48>e&&e>=-56?r="F":-56>e&&e>=-64?r="E":-64>e&&e>=-72?r="D":-72>e&&e>=-80&&(r="C"),r}function wA(e,r){var a="00000"+e.easting,u="00000"+e.northing;return e.zoneNumber+e.zoneLetter+MA(e.easting,e.northing,e.zoneNumber)+a.substr(a.length-5,r)+u.substr(u.length-5,r)}function MA(e,r,a){var u=Bx(a),d=Math.floor(e/1e5),g=Math.floor(r/1e5)%20;return SA(d,g,u)}function Bx(e){var r=e%f0;return r===0&&(r=f0),r}function SA(e,r,a){var u=a-1,d=Rx.charCodeAt(u),g=zx.charCodeAt(u),m=d+e-1,l=g+r,M=!1;m>hh&&(m=m-hh+Jc-1,M=!0),(m===Ps||d<Ps&&m>Ps||(m>Ps||d<Ps)&&M)&&m++,(m===ha||d<ha&&m>ha||(m>ha||d<ha)&&M)&&(m++,m===Ps&&m++),m>hh&&(m=m-hh+Jc-1),l>uh?(l=l-uh+Jc-1,M=!0):M=!1,(l===Ps||g<Ps&&l>Ps||(l>Ps||g<Ps)&&M)&&l++,(l===ha||g<ha&&l>ha||(l>ha||g<ha)&&M)&&(l++,l===Ps&&l++),l>uh&&(l=l-uh+Jc-1);var P=String.fromCharCode(m)+String.fromCharCode(l);return P}function Nx(e){if(e&&e.length===0)throw"MGRSPoint coverting from nothing";for(var r=e.length,a=null,u="",d,g=0;!/[A-Z]/.test(d=e.charAt(g));){if(g>=2)throw"MGRSPoint bad conversion from: "+e;u+=d,g++}var m=parseInt(u,10);if(g===0||g+3>r)throw"MGRSPoint bad conversion from: "+e;var l=e.charAt(g++);if(l<="A"||l==="B"||l==="Y"||l>="Z"||l==="I"||l==="O")throw"MGRSPoint zone letter "+l+" not handled: "+e;a=e.substring(g,g+=2);for(var M=Bx(m),P=EA(a.charAt(0),M),R=TA(a.charAt(1),M);R<CA(l);)R+=2e6;var D=r-g;if(D%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+e;var z=D/2,Z=0,W=0,J,me,xe,Pe,oe;return z>0&&(J=1e5/Math.pow(10,z),me=e.substring(g,g+z),Z=parseFloat(me)*J,xe=e.substring(g+z),W=parseFloat(xe)*J),Pe=Z+P,oe=W+R,{easting:Pe,northing:oe,zoneLetter:l,zoneNumber:m,accuracy:J}}function EA(e,r){for(var a=Rx.charCodeAt(r-1),u=1e5,d=!1;a!==e.charCodeAt(0);){if(a++,a===Ps&&a++,a===ha&&a++,a>hh){if(d)throw"Bad character: "+e;a=Jc,d=!0}u+=1e5}return u}function TA(e,r){if(e>"V")throw"MGRSPoint given invalid Northing "+e;for(var a=zx.charCodeAt(r-1),u=0,d=!1;a!==e.charCodeAt(0);){if(a++,a===Ps&&a++,a===ha&&a++,a>uh){if(d)throw"Bad character: "+e;a=Jc,d=!0}u+=1e5}return u}function CA(e){var r;switch(e){case"C":r=11e5;break;case"D":r=2e6;break;case"E":r=28e5;break;case"F":r=37e5;break;case"G":r=46e5;break;case"H":r=55e5;break;case"J":r=64e5;break;case"K":r=73e5;break;case"L":r=82e5;break;case"M":r=91e5;break;case"N":r=0;break;case"P":r=8e5;break;case"Q":r=17e5;break;case"R":r=26e5;break;case"S":r=35e5;break;case"T":r=44e5;break;case"U":r=53e5;break;case"V":r=62e5;break;case"W":r=7e6;break;case"X":r=79e5;break;default:r=-1}if(r>=0)return r;throw"Invalid zone letter: "+e}function du(e,r,a){if(!(this instanceof du))return new du(e,r,a);if(Array.isArray(e))this.x=e[0],this.y=e[1],this.z=e[2]||0;else if(typeof e=="object")this.x=e.x,this.y=e.y,this.z=e.z||0;else if(typeof e=="string"&&typeof r>"u"){var u=e.split(",");this.x=parseFloat(u[0],10),this.y=parseFloat(u[1],10),this.z=parseFloat(u[2],10)||0}else this.x=e,this.y=r,this.z=a||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}du.fromMGRS=function(e){return new du(Fx(e))};du.prototype.toMGRS=function(e){return Ox([this.x,this.y],e)};var IA=1,AA=.25,g0=.046875,y0=.01953125,_0=.01068115234375,PA=.75,DA=.46875,kA=.013020833333333334,LA=.007120768229166667,RA=.3645833333333333,zA=.005696614583333333,OA=.3076171875;function $x(e){var r=[];r[0]=IA-e*(AA+e*(g0+e*(y0+e*_0))),r[1]=e*(PA-e*(g0+e*(y0+e*_0)));var a=e*e;return r[2]=a*(DA-e*(kA+e*LA)),a*=e,r[3]=a*(RA-e*zA),r[4]=a*e*OA,r}function Bp(e,r,a,u){return a*=r,r*=r,u[0]*e-a*(u[1]+r*(u[2]+r*(u[3]+r*u[4])))}var FA=20;function Ux(e,r,a){for(var u=1/(1-r),d=e,g=FA;g;--g){var m=Math.sin(d),l=1-r*m*m;if(l=(Bp(d,m,Math.cos(d),a)-e)*(l*Math.sqrt(l))*u,d-=l,Math.abs(l)<Lt)return d}return d}function BA(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=$x(this.es),this.ml0=Bp(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function NA(e){var r=e.x,a=e.y,u=Vt(r-this.long0),d,g,m,l=Math.sin(a),M=Math.cos(a);if(this.es){var R=M*u,D=Math.pow(R,2),z=this.ep2*Math.pow(M,2),Z=Math.pow(z,2),W=Math.abs(M)>Lt?Math.tan(a):0,J=Math.pow(W,2),me=Math.pow(J,2);d=1-this.es*Math.pow(l,2),R=R/Math.sqrt(d);var xe=Bp(a,l,M,this.en);g=this.a*(this.k0*R*(1+D/6*(1-J+z+D/20*(5-18*J+me+14*z-58*J*z+D/42*(61+179*me-me*J-479*J)))))+this.x0,m=this.a*(this.k0*(xe-this.ml0+l*u*R/2*(1+D/12*(5-J+9*z+4*Z+D/30*(61+me-58*J+270*z-330*J*z+D/56*(1385+543*me-me*J-3111*J))))))+this.y0}else{var P=M*Math.sin(u);if(Math.abs(Math.abs(P)-1)<Lt)return 93;if(g=.5*this.a*this.k0*Math.log((1+P)/(1-P))+this.x0,m=M*Math.cos(u)/Math.sqrt(1-Math.pow(P,2)),P=Math.abs(m),P>=1){if(P-1>Lt)return 93;m=0}else m=Math.acos(m);a<0&&(m=-m),m=this.a*this.k0*(m-this.lat0)+this.y0}return e.x=g,e.y=m,e}function $A(e){var r,a,u,d,g=(e.x-this.x0)*(1/this.a),m=(e.y-this.y0)*(1/this.a);if(this.es)if(r=this.ml0+m/this.k0,a=Ux(r,this.es,this.en),Math.abs(a)<gt){var D=Math.sin(a),z=Math.cos(a),Z=Math.abs(z)>Lt?Math.tan(a):0,W=this.ep2*Math.pow(z,2),J=Math.pow(W,2),me=Math.pow(Z,2),xe=Math.pow(me,2);r=1-this.es*Math.pow(D,2);var Pe=g*Math.sqrt(r)/this.k0,oe=Math.pow(Pe,2);r=r*Z,u=a-r*oe/(1-this.es)*.5*(1-oe/12*(5+3*me-9*W*me+W-4*J-oe/30*(61+90*me-252*W*me+45*xe+46*W-oe/56*(1385+3633*me+4095*xe+1574*xe*me)))),d=Vt(this.long0+Pe*(1-oe/6*(1+2*me+W-oe/20*(5+28*me+24*xe+8*W*me+6*W-oe/42*(61+662*me+1320*xe+720*xe*me))))/z)}else u=gt*Wh(m),d=0;else{var l=Math.exp(g/this.k0),M=.5*(l-1/l),P=this.lat0+m/this.k0,R=Math.cos(P);r=Math.sqrt((1-Math.pow(R,2))/(1+Math.pow(M,2))),u=Math.asin(r),m<0&&(u=-u),M===0&&R===0?d=0:d=Vt(Math.atan2(M,R)+this.long0)}return e.x=d,e.y=u,e}var UA=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const Wd={init:BA,forward:NA,inverse:$A,names:UA};function Vx(e){var r=Math.exp(e);return r=(r-1/r)/2,r}function pa(e,r){e=Math.abs(e),r=Math.abs(r);var a=Math.max(e,r),u=Math.min(e,r)/(a||1);return a*Math.sqrt(1+Math.pow(u,2))}function VA(e){var r=1+e,a=r-1;return a===0?e:e*Math.log(r)/a}function jA(e){var r=Math.abs(e);return r=VA(r*(1+r/(pa(1,r)+1))),e<0?-r:r}function sg(e,r){for(var a=2*Math.cos(2*r),u=e.length-1,d=e[u],g=0,m;--u>=0;)m=-g+a*d+e[u],g=d,d=m;return r+m*Math.sin(2*r)}function qA(e,r){for(var a=2*Math.cos(r),u=e.length-1,d=e[u],g=0,m;--u>=0;)m=-g+a*d+e[u],g=d,d=m;return Math.sin(r)*m}function GA(e){var r=Math.exp(e);return r=(r+1/r)/2,r}function jx(e,r,a){for(var u=Math.sin(r),d=Math.cos(r),g=Vx(a),m=GA(a),l=2*d*m,M=-2*u*g,P=e.length-1,R=e[P],D=0,z=0,Z=0,W,J;--P>=0;)W=z,J=D,z=R,D=Z,R=-W+l*z-M*D+e[P],Z=-J+M*z+l*D;return l=u*m,M=d*g,[l*R-M*Z,l*Z+M*R]}function HA(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(Wd.init.apply(this),this.forward=Wd.forward,this.inverse=Wd.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var e=this.es/(1+Math.sqrt(1-this.es)),r=e/(2-e),a=r;this.cgb[0]=r*(2+r*(-2/3+r*(-2+r*(116/45+r*(26/45+r*(-2854/675)))))),this.cbg[0]=r*(-2+r*(2/3+r*(4/3+r*(-82/45+r*(32/45+r*(4642/4725)))))),a=a*r,this.cgb[1]=a*(7/3+r*(-8/5+r*(-227/45+r*(2704/315+r*(2323/945))))),this.cbg[1]=a*(5/3+r*(-16/15+r*(-13/9+r*(904/315+r*(-1522/945))))),a=a*r,this.cgb[2]=a*(56/15+r*(-136/35+r*(-1262/105+r*(73814/2835)))),this.cbg[2]=a*(-26/15+r*(34/21+r*(8/5+r*(-12686/2835)))),a=a*r,this.cgb[3]=a*(4279/630+r*(-332/35+r*(-399572/14175))),this.cbg[3]=a*(1237/630+r*(-12/5+r*(-24832/14175))),a=a*r,this.cgb[4]=a*(4174/315+r*(-144838/6237)),this.cbg[4]=a*(-734/315+r*(109598/31185)),a=a*r,this.cgb[5]=a*(601676/22275),this.cbg[5]=a*(444337/155925),a=Math.pow(r,2),this.Qn=this.k0/(1+r)*(1+a*(1/4+a*(1/64+a/256))),this.utg[0]=r*(-.5+r*(2/3+r*(-37/96+r*(1/360+r*(81/512+r*(-96199/604800)))))),this.gtu[0]=r*(.5+r*(-2/3+r*(5/16+r*(41/180+r*(-127/288+r*(7891/37800)))))),this.utg[1]=a*(-1/48+r*(-1/15+r*(437/1440+r*(-46/105+r*(1118711/3870720))))),this.gtu[1]=a*(13/48+r*(-3/5+r*(557/1440+r*(281/630+r*(-1983433/1935360))))),a=a*r,this.utg[2]=a*(-17/480+r*(37/840+r*(209/4480+r*(-5569/90720)))),this.gtu[2]=a*(61/240+r*(-103/140+r*(15061/26880+r*(167603/181440)))),a=a*r,this.utg[3]=a*(-4397/161280+r*(11/504+r*(830251/7257600))),this.gtu[3]=a*(49561/161280+r*(-179/168+r*(6601661/7257600))),a=a*r,this.utg[4]=a*(-4583/161280+r*(108847/3991680)),this.gtu[4]=a*(34729/80640+r*(-3418889/1995840)),a=a*r,this.utg[5]=a*(-20648693/638668800),this.gtu[5]=a*(212378941/319334400);var u=sg(this.cbg,this.lat0);this.Zb=-this.Qn*(u+qA(this.gtu,2*u))}function ZA(e){var r=Vt(e.x-this.long0),a=e.y;a=sg(this.cbg,a);var u=Math.sin(a),d=Math.cos(a),g=Math.sin(r),m=Math.cos(r);a=Math.atan2(u,m*d),r=Math.atan2(g*d,pa(u,d*m)),r=jA(Math.tan(r));var l=jx(this.gtu,2*a,2*r);a=a+l[0],r=r+l[1];var M,P;return Math.abs(r)<=2.623395162778?(M=this.a*(this.Qn*r)+this.x0,P=this.a*(this.Qn*a+this.Zb)+this.y0):(M=1/0,P=1/0),e.x=M,e.y=P,e}function WA(e){var r=(e.x-this.x0)*(1/this.a),a=(e.y-this.y0)*(1/this.a);a=(a-this.Zb)/this.Qn,r=r/this.Qn;var u,d;if(Math.abs(r)<=2.623395162778){var g=jx(this.utg,2*a,2*r);a=a+g[0],r=r+g[1],r=Math.atan(Vx(r));var m=Math.sin(a),l=Math.cos(a),M=Math.sin(r),P=Math.cos(r);a=Math.atan2(m*P,pa(M,P*l)),r=Math.atan2(M,P*l),u=Vt(r+this.long0),d=sg(this.cgb,a)}else u=1/0,d=1/0;return e.x=u,e.y=d,e}var XA=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const Xd={init:HA,forward:ZA,inverse:WA,names:XA};function KA(e,r){if(e===void 0){if(e=Math.floor((Vt(r)+Math.PI)*30/Math.PI)+1,e<0)return 0;if(e>60)return 60}return e}var YA="etmerc";function JA(){var e=KA(this.zone,this.long0);if(e===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(e)-183)*Un,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Xd.init.apply(this),this.forward=Xd.forward,this.inverse=Xd.inverse}var QA=["Universal Transverse Mercator System","utm"];const eP={init:JA,names:QA,dependsOn:YA};function ag(e,r){return Math.pow((1-e)/(1+e),r)}var tP=20;function iP(){var e=Math.sin(this.lat0),r=Math.cos(this.lat0);r*=r,this.rc=Math.sqrt(1-this.es)/(1-this.es*e*e),this.C=Math.sqrt(1+this.es*r*r/(1-this.es)),this.phic0=Math.asin(e/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+sr)/(Math.pow(Math.tan(.5*this.lat0+sr),this.C)*ag(this.e*e,this.ratexp))}function rP(e){var r=e.x,a=e.y;return e.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*a+sr),this.C)*ag(this.e*Math.sin(a),this.ratexp))-gt,e.x=this.C*r,e}function nP(e){for(var r=1e-14,a=e.x/this.C,u=e.y,d=Math.pow(Math.tan(.5*u+sr)/this.K,1/this.C),g=tP;g>0&&(u=2*Math.atan(d*ag(this.e*Math.sin(e.y),-.5*this.e))-gt,!(Math.abs(u-e.y)<r));--g)e.y=u;return g?(e.x=a,e.y=u,e):null}var sP=["gauss"];const og={init:iP,forward:rP,inverse:nP,names:sP};function aP(){og.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function oP(e){var r,a,u,d;return e.x=Vt(e.x-this.long0),og.forward.apply(this,[e]),r=Math.sin(e.y),a=Math.cos(e.y),u=Math.cos(e.x),d=this.k0*this.R2/(1+this.sinc0*r+this.cosc0*a*u),e.x=d*a*Math.sin(e.x),e.y=d*(this.cosc0*r-this.sinc0*a*u),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function lP(e){var r,a,u,d,g;if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,g=pa(e.x,e.y)){var m=2*Math.atan2(g,this.R2);r=Math.sin(m),a=Math.cos(m),d=Math.asin(a*this.sinc0+e.y*r*this.cosc0/g),u=Math.atan2(e.x*r,g*this.cosc0*a-e.y*this.sinc0*r)}else d=this.phic0,u=0;return e.x=u,e.y=d,og.inverse.apply(this,[e]),e.x=Vt(e.x+this.long0),e}var cP=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const uP={init:aP,forward:oP,inverse:lP,names:cP};function hP(e,r,a){return r*=a,Math.tan(.5*(gt+e))*Math.pow((1-r)/(1+r),.5*a)}function dP(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Lt&&(this.k0=.5*(1+Wh(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=Lt&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Lt&&Math.abs(Math.cos(this.lat_ts))>Lt&&(this.k0=.5*this.cons*ao(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Oa(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=ao(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-gt,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function pP(e){var r=e.x,a=e.y,u=Math.sin(a),d=Math.cos(a),g,m,l,M,P,R,D=Vt(r-this.long0);return Math.abs(Math.abs(r-this.long0)-Math.PI)<=Lt&&Math.abs(a+this.lat0)<=Lt?(e.x=NaN,e.y=NaN,e):this.sphere?(g=2*this.k0/(1+this.sinlat0*u+this.coslat0*d*Math.cos(D)),e.x=this.a*g*d*Math.sin(D)+this.x0,e.y=this.a*g*(this.coslat0*u-this.sinlat0*d*Math.cos(D))+this.y0,e):(m=2*Math.atan(this.ssfn_(a,u,this.e))-gt,M=Math.cos(m),l=Math.sin(m),Math.abs(this.coslat0)<=Lt?(P=Oa(this.e,a*this.con,this.con*u),R=2*this.a*this.k0*P/this.cons,e.x=this.x0+R*Math.sin(r-this.long0),e.y=this.y0-this.con*R*Math.cos(r-this.long0),e):(Math.abs(this.sinlat0)<Lt?(g=2*this.a*this.k0/(1+M*Math.cos(D)),e.y=g*l):(g=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*l+this.cosX0*M*Math.cos(D))),e.y=g*(this.cosX0*l-this.sinX0*M*Math.cos(D))+this.y0),e.x=g*M*Math.sin(D)+this.x0,e))}function fP(e){e.x-=this.x0,e.y-=this.y0;var r,a,u,d,g,m=Math.sqrt(e.x*e.x+e.y*e.y);if(this.sphere){var l=2*Math.atan(m/(2*this.a*this.k0));return r=this.long0,a=this.lat0,m<=Lt?(e.x=r,e.y=a,e):(a=Math.asin(Math.cos(l)*this.sinlat0+e.y*Math.sin(l)*this.coslat0/m),Math.abs(this.coslat0)<Lt?this.lat0>0?r=Vt(this.long0+Math.atan2(e.x,-1*e.y)):r=Vt(this.long0+Math.atan2(e.x,e.y)):r=Vt(this.long0+Math.atan2(e.x*Math.sin(l),m*this.coslat0*Math.cos(l)-e.y*this.sinlat0*Math.sin(l))),e.x=r,e.y=a,e)}else if(Math.abs(this.coslat0)<=Lt){if(m<=Lt)return a=this.lat0,r=this.long0,e.x=r,e.y=a,e;e.x*=this.con,e.y*=this.con,u=m*this.cons/(2*this.a*this.k0),a=this.con*Oh(this.e,u),r=this.con*Vt(this.con*this.long0+Math.atan2(e.x,-1*e.y))}else d=2*Math.atan(m*this.cosX0/(2*this.a*this.k0*this.ms1)),r=this.long0,m<=Lt?g=this.X0:(g=Math.asin(Math.cos(d)*this.sinX0+e.y*Math.sin(d)*this.cosX0/m),r=Vt(this.long0+Math.atan2(e.x*Math.sin(d),m*this.cosX0*Math.cos(d)-e.y*this.sinX0*Math.sin(d)))),a=-1*Oh(this.e,Math.tan(.5*(gt+g)));return e.x=r,e.y=a,e}var mP=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"];const gP={init:dP,forward:pP,inverse:fP,names:mP,ssfn_:hP};function yP(){var e=this.lat0;this.lambda0=this.long0;var r=Math.sin(e),a=this.a,u=this.rf,d=1/u,g=2*d-Math.pow(d,2),m=this.e=Math.sqrt(g);this.R=this.k0*a*Math.sqrt(1-g)/(1-g*Math.pow(r,2)),this.alpha=Math.sqrt(1+g/(1-g)*Math.pow(Math.cos(e),4)),this.b0=Math.asin(r/this.alpha);var l=Math.log(Math.tan(Math.PI/4+this.b0/2)),M=Math.log(Math.tan(Math.PI/4+e/2)),P=Math.log((1+m*r)/(1-m*r));this.K=l-this.alpha*M+this.alpha*m/2*P}function _P(e){var r=Math.log(Math.tan(Math.PI/4-e.y/2)),a=this.e/2*Math.log((1+this.e*Math.sin(e.y))/(1-this.e*Math.sin(e.y))),u=-this.alpha*(r+a)+this.K,d=2*(Math.atan(Math.exp(u))-Math.PI/4),g=this.alpha*(e.x-this.lambda0),m=Math.atan(Math.sin(g)/(Math.sin(this.b0)*Math.tan(d)+Math.cos(this.b0)*Math.cos(g))),l=Math.asin(Math.cos(this.b0)*Math.sin(d)-Math.sin(this.b0)*Math.cos(d)*Math.cos(g));return e.y=this.R/2*Math.log((1+Math.sin(l))/(1-Math.sin(l)))+this.y0,e.x=this.R*m+this.x0,e}function vP(e){for(var r=e.x-this.x0,a=e.y-this.y0,u=r/this.R,d=2*(Math.atan(Math.exp(a/this.R))-Math.PI/4),g=Math.asin(Math.cos(this.b0)*Math.sin(d)+Math.sin(this.b0)*Math.cos(d)*Math.cos(u)),m=Math.atan(Math.sin(u)/(Math.cos(this.b0)*Math.cos(u)-Math.sin(this.b0)*Math.tan(d))),l=this.lambda0+m/this.alpha,M=0,P=g,R=-1e3,D=0;Math.abs(P-R)>1e-7;){if(++D>20)return;M=1/this.alpha*(Math.log(Math.tan(Math.PI/4+g/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(P))/2)),R=P,P=2*Math.atan(Math.exp(M))-Math.PI/2}return e.x=l,e.y=P,e}var xP=["somerc"];const bP={init:yP,forward:_P,inverse:vP,names:xP};var Xc=1e-7;function wP(e){var r=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],a=typeof e.PROJECTION=="object"?Object.keys(e.PROJECTION)[0]:e.PROJECTION;return"no_uoff"in e||"no_off"in e||r.indexOf(a)!==-1}function MP(){var e,r,a,u,d,g,m,l,M,P,R=0,D,z=0,Z=0,W=0,J=0,me=0,xe=0;this.no_off=wP(this),this.no_rot="no_rot"in this;var Pe=!1;"alpha"in this&&(Pe=!0);var oe=!1;if("rectified_grid_angle"in this&&(oe=!0),Pe&&(xe=this.alpha),oe&&(R=this.rectified_grid_angle*Un),Pe||oe)z=this.longc;else if(Z=this.long1,J=this.lat1,W=this.long2,me=this.lat2,Math.abs(J-me)<=Xc||(e=Math.abs(J))<=Xc||Math.abs(e-gt)<=Xc||Math.abs(Math.abs(this.lat0)-gt)<=Xc||Math.abs(Math.abs(me)-gt)<=Xc)throw new Error;var Le=1-this.es;r=Math.sqrt(Le),Math.abs(this.lat0)>Lt?(l=Math.sin(this.lat0),a=Math.cos(this.lat0),e=1-this.es*l*l,this.B=a*a,this.B=Math.sqrt(1+this.es*this.B*this.B/Le),this.A=this.B*this.k0*r/e,u=this.B*r/(a*Math.sqrt(e)),d=u*u-1,d<=0?d=0:(d=Math.sqrt(d),this.lat0<0&&(d=-d)),this.E=d+=u,this.E*=Math.pow(Oa(this.e,this.lat0,l),this.B)):(this.B=1/r,this.A=this.k0,this.E=u=d=1),Pe||oe?(Pe?(D=Math.asin(Math.sin(xe)/u),oe||(R=xe)):(D=R,xe=Math.asin(u*Math.sin(D))),this.lam0=z-Math.asin(.5*(d-1/d)*Math.tan(D))/this.B):(g=Math.pow(Oa(this.e,J,Math.sin(J)),this.B),m=Math.pow(Oa(this.e,me,Math.sin(me)),this.B),d=this.E/g,M=(m-g)/(m+g),P=this.E*this.E,P=(P-m*g)/(P+m*g),e=Z-W,e<-Math.pi?W-=Rh:e>Math.pi&&(W+=Rh),this.lam0=Vt(.5*(Z+W)-Math.atan(P*Math.tan(.5*this.B*(Z-W))/M)/this.B),D=Math.atan(2*Math.sin(this.B*Vt(Z-this.lam0))/(d-1/d)),R=xe=Math.asin(u*Math.sin(D))),this.singam=Math.sin(D),this.cosgam=Math.cos(D),this.sinrot=Math.sin(R),this.cosrot=Math.cos(R),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(u*u-1)/Math.cos(xe))),this.lat0<0&&(this.u_0=-this.u_0)),d=.5*D,this.v_pole_n=this.ArB*Math.log(Math.tan(sr-d)),this.v_pole_s=this.ArB*Math.log(Math.tan(sr+d))}function SP(e){var r={},a,u,d,g,m,l,M,P;if(e.x=e.x-this.lam0,Math.abs(Math.abs(e.y)-gt)>Lt){if(m=this.E/Math.pow(Oa(this.e,e.y,Math.sin(e.y)),this.B),l=1/m,a=.5*(m-l),u=.5*(m+l),g=Math.sin(this.B*e.x),d=(a*this.singam-g*this.cosgam)/u,Math.abs(Math.abs(d)-1)<Lt)throw new Error;P=.5*this.ArB*Math.log((1-d)/(1+d)),l=Math.cos(this.B*e.x),Math.abs(l)<Xc?M=this.A*e.x:M=this.ArB*Math.atan2(a*this.cosgam+g*this.singam,l)}else P=e.y>0?this.v_pole_n:this.v_pole_s,M=this.ArB*e.y;return this.no_rot?(r.x=M,r.y=P):(M-=this.u_0,r.x=P*this.cosrot+M*this.sinrot,r.y=M*this.cosrot-P*this.sinrot),r.x=this.a*r.x+this.x0,r.y=this.a*r.y+this.y0,r}function EP(e){var r,a,u,d,g,m,l,M={};if(e.x=(e.x-this.x0)*(1/this.a),e.y=(e.y-this.y0)*(1/this.a),this.no_rot?(a=e.y,r=e.x):(a=e.x*this.cosrot-e.y*this.sinrot,r=e.y*this.cosrot+e.x*this.sinrot+this.u_0),u=Math.exp(-this.BrA*a),d=.5*(u-1/u),g=.5*(u+1/u),m=Math.sin(this.BrA*r),l=(m*this.cosgam+d*this.singam)/g,Math.abs(Math.abs(l)-1)<Lt)M.x=0,M.y=l<0?-gt:gt;else{if(M.y=this.E/Math.sqrt((1+l)/(1-l)),M.y=Oh(this.e,Math.pow(M.y,1/this.B)),M.y===1/0)throw new Error;M.x=-this.rB*Math.atan2(d*this.cosgam-m*this.singam,Math.cos(this.BrA*r))}return M.x+=this.lam0,M}var TP=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const CP={init:MP,forward:SP,inverse:EP,names:TP};function IP(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<Lt)){var e=this.b/this.a;this.e=Math.sqrt(1-e*e);var r=Math.sin(this.lat1),a=Math.cos(this.lat1),u=ao(this.e,r,a),d=Oa(this.e,this.lat1,r),g=Math.sin(this.lat2),m=Math.cos(this.lat2),l=ao(this.e,g,m),M=Oa(this.e,this.lat2,g),P=Oa(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>Lt?this.ns=Math.log(u/l)/Math.log(d/M):this.ns=r,isNaN(this.ns)&&(this.ns=r),this.f0=u/(this.ns*Math.pow(d,this.ns)),this.rh=this.a*this.f0*Math.pow(P,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function AP(e){var r=e.x,a=e.y;Math.abs(2*Math.abs(a)-Math.PI)<=Lt&&(a=Wh(a)*(gt-2*Lt));var u=Math.abs(Math.abs(a)-gt),d,g;if(u>Lt)d=Oa(this.e,a,Math.sin(a)),g=this.a*this.f0*Math.pow(d,this.ns);else{if(u=a*this.ns,u<=0)return null;g=0}var m=this.ns*Vt(r-this.long0);return e.x=this.k0*(g*Math.sin(m))+this.x0,e.y=this.k0*(this.rh-g*Math.cos(m))+this.y0,e}function PP(e){var r,a,u,d,g,m=(e.x-this.x0)/this.k0,l=this.rh-(e.y-this.y0)/this.k0;this.ns>0?(r=Math.sqrt(m*m+l*l),a=1):(r=-Math.sqrt(m*m+l*l),a=-1);var M=0;if(r!==0&&(M=Math.atan2(a*m,a*l)),r!==0||this.ns>0){if(a=1/this.ns,u=Math.pow(r/(this.a*this.f0),a),d=Oh(this.e,u),d===-9999)return null}else d=-gt;return g=Vt(M/this.ns+this.long0),e.x=g,e.y=d,e}var DP=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const kP={init:IP,forward:AP,inverse:PP,names:DP};function LP(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function RP(e){var r,a,u,d,g,m,l,M=e.x,P=e.y,R=Vt(M-this.long0);return r=Math.pow((1+this.e*Math.sin(P))/(1-this.e*Math.sin(P)),this.alfa*this.e/2),a=2*(Math.atan(this.k*Math.pow(Math.tan(P/2+this.s45),this.alfa)/r)-this.s45),u=-R*this.alfa,d=Math.asin(Math.cos(this.ad)*Math.sin(a)+Math.sin(this.ad)*Math.cos(a)*Math.cos(u)),g=Math.asin(Math.cos(a)*Math.sin(u)/Math.cos(d)),m=this.n*g,l=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(d/2+this.s45),this.n),e.y=l*Math.cos(m)/1,e.x=l*Math.sin(m)/1,this.czech||(e.y*=-1,e.x*=-1),e}function zP(e){var r,a,u,d,g,m,l,M,P=e.x;e.x=e.y,e.y=P,this.czech||(e.y*=-1,e.x*=-1),m=Math.sqrt(e.x*e.x+e.y*e.y),g=Math.atan2(e.y,e.x),d=g/Math.sin(this.s0),u=2*(Math.atan(Math.pow(this.ro0/m,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),r=Math.asin(Math.cos(this.ad)*Math.sin(u)-Math.sin(this.ad)*Math.cos(u)*Math.cos(d)),a=Math.asin(Math.cos(u)*Math.sin(d)/Math.cos(r)),e.x=this.long0-a/this.alfa,l=r,M=0;var R=0;do e.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(r/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(l))/(1-this.e*Math.sin(l)),this.e/2))-this.s45),Math.abs(l-e.y)<1e-10&&(M=1),l=e.y,R+=1;while(M===0&&R<15);return R>=15?null:e}var OP=["Krovak","krovak"];const FP={init:LP,forward:RP,inverse:zP,names:OP};function _s(e,r,a,u,d){return e*d-r*Math.sin(2*d)+a*Math.sin(4*d)-u*Math.sin(6*d)}function Xh(e){return 1-.25*e*(1+e/16*(3+1.25*e))}function Kh(e){return .375*e*(1+.25*e*(1+.46875*e))}function Yh(e){return .05859375*e*e*(1+.75*e)}function Jh(e){return e*e*e*(35/3072)}function pu(e,r,a){var u=r*a;return e/Math.sqrt(1-u*u)}function _u(e){return Math.abs(e)<gt?e:e-Wh(e)*Math.PI}function up(e,r,a,u,d){var g,m;g=e/r;for(var l=0;l<15;l++)if(m=(e-(r*g-a*Math.sin(2*g)+u*Math.sin(4*g)-d*Math.sin(6*g)))/(r-2*a*Math.cos(2*g)+4*u*Math.cos(4*g)-6*d*Math.cos(6*g)),g+=m,Math.abs(m)<=1e-10)return g;return NaN}function BP(){this.sphere||(this.e0=Xh(this.es),this.e1=Kh(this.es),this.e2=Yh(this.es),this.e3=Jh(this.es),this.ml0=this.a*_s(this.e0,this.e1,this.e2,this.e3,this.lat0))}function NP(e){var r,a,u=e.x,d=e.y;if(u=Vt(u-this.long0),this.sphere)r=this.a*Math.asin(Math.cos(d)*Math.sin(u)),a=this.a*(Math.atan2(Math.tan(d),Math.cos(u))-this.lat0);else{var g=Math.sin(d),m=Math.cos(d),l=pu(this.a,this.e,g),M=Math.tan(d)*Math.tan(d),P=u*Math.cos(d),R=P*P,D=this.es*m*m/(1-this.es),z=this.a*_s(this.e0,this.e1,this.e2,this.e3,d);r=l*P*(1-R*M*(1/6-(8-M+8*D)*R/120)),a=z-this.ml0+l*g/m*R*(.5+(5-M+6*D)*R/24)}return e.x=r+this.x0,e.y=a+this.y0,e}function $P(e){e.x-=this.x0,e.y-=this.y0;var r=e.x/this.a,a=e.y/this.a,u,d;if(this.sphere){var g=a+this.lat0;u=Math.asin(Math.sin(g)*Math.cos(r)),d=Math.atan2(Math.tan(r),Math.cos(g))}else{var m=this.ml0/this.a+a,l=up(m,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(l)-gt)<=Lt)return e.x=this.long0,e.y=gt,a<0&&(e.y*=-1),e;var M=pu(this.a,this.e,Math.sin(l)),P=M*M*M/this.a/this.a*(1-this.es),R=Math.pow(Math.tan(l),2),D=r*this.a/M,z=D*D;u=l-M*Math.tan(l)/P*D*D*(.5-(1+3*R)*D*D/24),d=D*(1-z*(R/3+(1+3*R)*R*z/15))/Math.cos(l)}return e.x=Vt(d+this.long0),e.y=_u(u),e}var UP=["Cassini","Cassini_Soldner","cass"];const VP={init:BP,forward:NP,inverse:$P,names:UP};function wl(e,r){var a;return e>1e-7?(a=e*r,(1-e*e)*(r/(1-a*a)-.5/e*Math.log((1-a)/(1+a)))):2*r}var jP=1,qP=2,GP=3,HP=4;function ZP(){var e=Math.abs(this.lat0);if(Math.abs(e-gt)<Lt?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<Lt?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var r;switch(this.qp=wl(this.e,1),this.mmf=.5/(1-this.es),this.apa=iD(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),r=Math.sin(this.lat0),this.sinb1=wl(this.e,r)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*r*r)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function WP(e){var r,a,u,d,g,m,l,M,P,R,D=e.x,z=e.y;if(D=Vt(D-this.long0),this.sphere){if(g=Math.sin(z),R=Math.cos(z),u=Math.cos(D),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(a=this.mode===this.EQUIT?1+R*u:1+this.sinph0*g+this.cosph0*R*u,a<=Lt)return null;a=Math.sqrt(2/a),r=a*R*Math.sin(D),a*=this.mode===this.EQUIT?g:this.cosph0*g-this.sinph0*R*u}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(u=-u),Math.abs(z+this.lat0)<Lt)return null;a=sr-z*.5,a=2*(this.mode===this.S_POLE?Math.cos(a):Math.sin(a)),r=a*Math.sin(D),a*=u}}else{switch(l=0,M=0,P=0,u=Math.cos(D),d=Math.sin(D),g=Math.sin(z),m=wl(this.e,g),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(l=m/this.qp,M=Math.sqrt(1-l*l)),this.mode){case this.OBLIQ:P=1+this.sinb1*l+this.cosb1*M*u;break;case this.EQUIT:P=1+M*u;break;case this.N_POLE:P=gt+z,m=this.qp-m;break;case this.S_POLE:P=z-gt,m=this.qp+m;break}if(Math.abs(P)<Lt)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:P=Math.sqrt(2/P),this.mode===this.OBLIQ?a=this.ymf*P*(this.cosb1*l-this.sinb1*M*u):a=(P=Math.sqrt(2/(1+M*u)))*l*this.ymf,r=this.xmf*P*M*d;break;case this.N_POLE:case this.S_POLE:m>=0?(r=(P=Math.sqrt(m))*d,a=u*(this.mode===this.S_POLE?P:-P)):r=a=0;break}}return e.x=this.a*r+this.x0,e.y=this.a*a+this.y0,e}function XP(e){e.x-=this.x0,e.y-=this.y0;var r=e.x/this.a,a=e.y/this.a,u,d,g,m,l,M,P;if(this.sphere){var R=0,D,z=0;if(D=Math.sqrt(r*r+a*a),d=D*.5,d>1)return null;switch(d=2*Math.asin(d),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(z=Math.sin(d),R=Math.cos(d)),this.mode){case this.EQUIT:d=Math.abs(D)<=Lt?0:Math.asin(a*z/D),r*=z,a=R*D;break;case this.OBLIQ:d=Math.abs(D)<=Lt?this.lat0:Math.asin(R*this.sinph0+a*z*this.cosph0/D),r*=z*this.cosph0,a=(R-Math.sin(d)*this.sinph0)*D;break;case this.N_POLE:a=-a,d=gt-d;break;case this.S_POLE:d-=gt;break}u=a===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(r,a)}else{if(P=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(r/=this.dd,a*=this.dd,M=Math.sqrt(r*r+a*a),M<Lt)return e.x=this.long0,e.y=this.lat0,e;m=2*Math.asin(.5*M/this.rq),g=Math.cos(m),r*=m=Math.sin(m),this.mode===this.OBLIQ?(P=g*this.sinb1+a*m*this.cosb1/M,l=this.qp*P,a=M*this.cosb1*g-a*this.sinb1*m):(P=a*m/M,l=this.qp*P,a=M*g)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(a=-a),l=r*r+a*a,!l)return e.x=this.long0,e.y=this.lat0,e;P=1-l/this.qp,this.mode===this.S_POLE&&(P=-P)}u=Math.atan2(r,a),d=rD(Math.asin(P),this.apa)}return e.x=Vt(this.long0+u),e.y=d,e}var KP=.3333333333333333,YP=.17222222222222222,JP=.10257936507936508,QP=.06388888888888888,eD=.0664021164021164,tD=.016415012942191543;function iD(e){var r,a=[];return a[0]=e*KP,r=e*e,a[0]+=r*YP,a[1]=r*QP,r*=e,a[0]+=r*JP,a[1]+=r*eD,a[2]=r*tD,a}function rD(e,r){var a=e+e;return e+r[0]*Math.sin(a)+r[1]*Math.sin(a+a)+r[2]*Math.sin(a+a+a)}var nD=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const sD={init:ZP,forward:WP,inverse:XP,names:nD,S_POLE:jP,N_POLE:qP,EQUIT:GP,OBLIQ:HP};function Tl(e){return Math.abs(e)>1&&(e=e>1?1:-1),Math.asin(e)}function aD(){Math.abs(this.lat1+this.lat2)<Lt||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=ao(this.e3,this.sin_po,this.cos_po),this.qs1=wl(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=ao(this.e3,this.sin_po,this.cos_po),this.qs2=wl(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=wl(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>Lt?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function oD(e){var r=e.x,a=e.y;this.sin_phi=Math.sin(a),this.cos_phi=Math.cos(a);var u=wl(this.e3,this.sin_phi),d=this.a*Math.sqrt(this.c-this.ns0*u)/this.ns0,g=this.ns0*Vt(r-this.long0),m=d*Math.sin(g)+this.x0,l=this.rh-d*Math.cos(g)+this.y0;return e.x=m,e.y=l,e}function lD(e){var r,a,u,d,g,m;return e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns0>=0?(r=Math.sqrt(e.x*e.x+e.y*e.y),u=1):(r=-Math.sqrt(e.x*e.x+e.y*e.y),u=-1),d=0,r!==0&&(d=Math.atan2(u*e.x,u*e.y)),u=r*this.ns0/this.a,this.sphere?m=Math.asin((this.c-u*u)/(2*this.ns0)):(a=(this.c-u*u)/this.ns0,m=this.phi1z(this.e3,a)),g=Vt(d/this.ns0+this.long0),e.x=g,e.y=m,e}function cD(e,r){var a,u,d,g,m,l=Tl(.5*r);if(e<Lt)return l;for(var M=e*e,P=1;P<=25;P++)if(a=Math.sin(l),u=Math.cos(l),d=e*a,g=1-d*d,m=.5*g*g/u*(r/(1-M)-a/g+.5/e*Math.log((1-d)/(1+d))),l=l+m,Math.abs(m)<=1e-7)return l;return null}var uD=["Albers_Conic_Equal_Area","Albers","aea"];const hD={init:aD,forward:oD,inverse:lD,names:uD,phi1z:cD};function dD(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function pD(e){var r,a,u,d,g,m,l,M,P=e.x,R=e.y;return u=Vt(P-this.long0),r=Math.sin(R),a=Math.cos(R),d=Math.cos(u),m=this.sin_p14*r+this.cos_p14*a*d,g=1,m>0||Math.abs(m)<=Lt?(l=this.x0+this.a*g*a*Math.sin(u)/m,M=this.y0+this.a*g*(this.cos_p14*r-this.sin_p14*a*d)/m):(l=this.x0+this.infinity_dist*a*Math.sin(u),M=this.y0+this.infinity_dist*(this.cos_p14*r-this.sin_p14*a*d)),e.x=l,e.y=M,e}function fD(e){var r,a,u,d,g,m;return e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,(r=Math.sqrt(e.x*e.x+e.y*e.y))?(d=Math.atan2(r,this.rc),a=Math.sin(d),u=Math.cos(d),m=Tl(u*this.sin_p14+e.y*a*this.cos_p14/r),g=Math.atan2(e.x*a,r*this.cos_p14*u-e.y*this.sin_p14*a),g=Vt(this.long0+g)):(m=this.phic0,g=0),e.x=g,e.y=m,e}var mD=["gnom"];const gD={init:dD,forward:pD,inverse:fD,names:mD};function yD(e,r){var a=1-(1-e*e)/(2*e)*Math.log((1-e)/(1+e));if(Math.abs(Math.abs(r)-a)<1e-6)return r<0?-1*gt:gt;for(var u=Math.asin(.5*r),d,g,m,l,M=0;M<30;M++)if(g=Math.sin(u),m=Math.cos(u),l=e*g,d=Math.pow(1-l*l,2)/(2*m)*(r/(1-e*e)-g/(1-l*l)+.5/e*Math.log((1-l)/(1+l))),u+=d,Math.abs(d)<=1e-10)return u;return NaN}function _D(){this.sphere||(this.k0=ao(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function vD(e){var r=e.x,a=e.y,u,d,g=Vt(r-this.long0);if(this.sphere)u=this.x0+this.a*g*Math.cos(this.lat_ts),d=this.y0+this.a*Math.sin(a)/Math.cos(this.lat_ts);else{var m=wl(this.e,Math.sin(a));u=this.x0+this.a*this.k0*g,d=this.y0+this.a*m*.5/this.k0}return e.x=u,e.y=d,e}function xD(e){e.x-=this.x0,e.y-=this.y0;var r,a;return this.sphere?(r=Vt(this.long0+e.x/this.a/Math.cos(this.lat_ts)),a=Math.asin(e.y/this.a*Math.cos(this.lat_ts))):(a=yD(this.e,2*e.y*this.k0/this.a),r=Vt(this.long0+e.x/(this.a*this.k0))),e.x=r,e.y=a,e}var bD=["cea"];const wD={init:_D,forward:vD,inverse:xD,names:bD};function MD(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function SD(e){var r=e.x,a=e.y,u=Vt(r-this.long0),d=_u(a-this.lat0);return e.x=this.x0+this.a*u*this.rc,e.y=this.y0+this.a*d,e}function ED(e){var r=e.x,a=e.y;return e.x=Vt(this.long0+(r-this.x0)/(this.a*this.rc)),e.y=_u(this.lat0+(a-this.y0)/this.a),e}var TD=["Equirectangular","Equidistant_Cylindrical","eqc"];const CD={init:MD,forward:SD,inverse:ED,names:TD};var v0=20;function ID(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Xh(this.es),this.e1=Kh(this.es),this.e2=Yh(this.es),this.e3=Jh(this.es),this.ml0=this.a*_s(this.e0,this.e1,this.e2,this.e3,this.lat0)}function AD(e){var r=e.x,a=e.y,u,d,g,m=Vt(r-this.long0);if(g=m*Math.sin(a),this.sphere)Math.abs(a)<=Lt?(u=this.a*m,d=-1*this.a*this.lat0):(u=this.a*Math.sin(g)/Math.tan(a),d=this.a*(_u(a-this.lat0)+(1-Math.cos(g))/Math.tan(a)));else if(Math.abs(a)<=Lt)u=this.a*m,d=-1*this.ml0;else{var l=pu(this.a,this.e,Math.sin(a))/Math.tan(a);u=l*Math.sin(g),d=this.a*_s(this.e0,this.e1,this.e2,this.e3,a)-this.ml0+l*(1-Math.cos(g))}return e.x=u+this.x0,e.y=d+this.y0,e}function PD(e){var r,a,u,d,g,m,l,M,P;if(u=e.x-this.x0,d=e.y-this.y0,this.sphere)if(Math.abs(d+this.a*this.lat0)<=Lt)r=Vt(u/this.a+this.long0),a=0;else{m=this.lat0+d/this.a,l=u*u/this.a/this.a+m*m,M=m;var R;for(g=v0;g;--g)if(R=Math.tan(M),P=-1*(m*(M*R+1)-M-.5*(M*M+l)*R)/((M-m)/R-1),M+=P,Math.abs(P)<=Lt){a=M;break}r=Vt(this.long0+Math.asin(u*Math.tan(M)/this.a)/Math.sin(a))}else if(Math.abs(d+this.ml0)<=Lt)a=0,r=Vt(this.long0+u/this.a);else{m=(this.ml0+d)/this.a,l=u*u/this.a/this.a+m*m,M=m;var D,z,Z,W,J;for(g=v0;g;--g)if(J=this.e*Math.sin(M),D=Math.sqrt(1-J*J)*Math.tan(M),z=this.a*_s(this.e0,this.e1,this.e2,this.e3,M),Z=this.e0-2*this.e1*Math.cos(2*M)+4*this.e2*Math.cos(4*M)-6*this.e3*Math.cos(6*M),W=z/this.a,P=(m*(D*W+1)-W-.5*D*(W*W+l))/(this.es*Math.sin(2*M)*(W*W+l-2*m*W)/(4*D)+(m-W)*(D*Z-2/Math.sin(2*M))-Z),M-=P,Math.abs(P)<=Lt){a=M;break}D=Math.sqrt(1-this.es*Math.pow(Math.sin(a),2))*Math.tan(a),r=Vt(this.long0+Math.asin(u*D/this.a)/Math.sin(a))}return e.x=r,e.y=a,e}var DD=["Polyconic","poly"];const kD={init:ID,forward:AD,inverse:PD,names:DD};function LD(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function RD(e){var r,a=e.x,u=e.y,d=u-this.lat0,g=a-this.long0,m=d/xh*1e-5,l=g,M=1,P=0;for(r=1;r<=10;r++)M=M*m,P=P+this.A[r]*M;var R=P,D=l,z=1,Z=0,W,J,me=0,xe=0;for(r=1;r<=6;r++)W=z*R-Z*D,J=Z*R+z*D,z=W,Z=J,me=me+this.B_re[r]*z-this.B_im[r]*Z,xe=xe+this.B_im[r]*z+this.B_re[r]*Z;return e.x=xe*this.a+this.x0,e.y=me*this.a+this.y0,e}function zD(e){var r,a=e.x,u=e.y,d=a-this.x0,g=u-this.y0,m=g/this.a,l=d/this.a,M=1,P=0,R,D,z=0,Z=0;for(r=1;r<=6;r++)R=M*m-P*l,D=P*m+M*l,M=R,P=D,z=z+this.C_re[r]*M-this.C_im[r]*P,Z=Z+this.C_im[r]*M+this.C_re[r]*P;for(var W=0;W<this.iterations;W++){var J=z,me=Z,xe,Pe,oe=m,Le=l;for(r=2;r<=6;r++)xe=J*z-me*Z,Pe=me*z+J*Z,J=xe,me=Pe,oe=oe+(r-1)*(this.B_re[r]*J-this.B_im[r]*me),Le=Le+(r-1)*(this.B_im[r]*J+this.B_re[r]*me);J=1,me=0;var Ze=this.B_re[1],Ke=this.B_im[1];for(r=2;r<=6;r++)xe=J*z-me*Z,Pe=me*z+J*Z,J=xe,me=Pe,Ze=Ze+r*(this.B_re[r]*J-this.B_im[r]*me),Ke=Ke+r*(this.B_im[r]*J+this.B_re[r]*me);var dt=Ze*Ze+Ke*Ke;z=(oe*Ze+Le*Ke)/dt,Z=(Le*Ze-oe*Ke)/dt}var bt=z,Pt=Z,Ht=1,Rt=0;for(r=1;r<=9;r++)Ht=Ht*bt,Rt=Rt+this.D[r]*Ht;var li=this.lat0+Rt*xh*1e5,ct=this.long0+Pt;return e.x=ct,e.y=li,e}var OD=["New_Zealand_Map_Grid","nzmg"];const FD={init:LD,forward:RD,inverse:zD,names:OD};function BD(){}function ND(e){var r=e.x,a=e.y,u=Vt(r-this.long0),d=this.x0+this.a*u,g=this.y0+this.a*Math.log(Math.tan(Math.PI/4+a/2.5))*1.25;return e.x=d,e.y=g,e}function $D(e){e.x-=this.x0,e.y-=this.y0;var r=Vt(this.long0+e.x/this.a),a=2.5*(Math.atan(Math.exp(.8*e.y/this.a))-Math.PI/4);return e.x=r,e.y=a,e}var UD=["Miller_Cylindrical","mill"];const VD={init:BD,forward:ND,inverse:$D,names:UD};var jD=20;function qD(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=$x(this.es)}function GD(e){var r,a,u=e.x,d=e.y;if(u=Vt(u-this.long0),this.sphere){if(!this.m)d=this.n!==1?Math.asin(this.n*Math.sin(d)):d;else for(var g=this.n*Math.sin(d),m=jD;m;--m){var l=(this.m*d+Math.sin(d)-g)/(this.m+Math.cos(d));if(d-=l,Math.abs(l)<Lt)break}r=this.a*this.C_x*u*(this.m+Math.cos(d)),a=this.a*this.C_y*d}else{var M=Math.sin(d),P=Math.cos(d);a=this.a*Bp(d,M,P,this.en),r=this.a*u*P/Math.sqrt(1-this.es*M*M)}return e.x=r,e.y=a,e}function HD(e){var r,a,u,d;return e.x-=this.x0,u=e.x/this.a,e.y-=this.y0,r=e.y/this.a,this.sphere?(r/=this.C_y,u=u/(this.C_x*(this.m+Math.cos(r))),this.m?r=Tl((this.m*r+Math.sin(r))/this.n):this.n!==1&&(r=Tl(Math.sin(r)/this.n)),u=Vt(u+this.long0),r=_u(r)):(r=Ux(e.y/this.a,this.es,this.en),d=Math.abs(r),d<gt?(d=Math.sin(r),a=this.long0+e.x*Math.sqrt(1-this.es*d*d)/(this.a*Math.cos(r)),u=Vt(a)):d-Lt<gt&&(u=this.long0)),e.x=u,e.y=r,e}var ZD=["Sinusoidal","sinu"];const WD={init:qD,forward:GD,inverse:HD,names:ZD};function XD(){}function KD(e){for(var r=e.x,a=e.y,u=Vt(r-this.long0),d=a,g=Math.PI*Math.sin(a);;){var m=-(d+Math.sin(d)-g)/(1+Math.cos(d));if(d+=m,Math.abs(m)<Lt)break}d/=2,Math.PI/2-Math.abs(a)<Lt&&(u=0);var l=.900316316158*this.a*u*Math.cos(d)+this.x0,M=1.4142135623731*this.a*Math.sin(d)+this.y0;return e.x=l,e.y=M,e}function YD(e){var r,a;e.x-=this.x0,e.y-=this.y0,a=e.y/(1.4142135623731*this.a),Math.abs(a)>.999999999999&&(a=.999999999999),r=Math.asin(a);var u=Vt(this.long0+e.x/(.900316316158*this.a*Math.cos(r)));u<-Math.PI&&(u=-Math.PI),u>Math.PI&&(u=Math.PI),a=(2*r+Math.sin(2*r))/Math.PI,Math.abs(a)>1&&(a=1);var d=Math.asin(a);return e.x=u,e.y=d,e}var JD=["Mollweide","moll"];const QD={init:XD,forward:KD,inverse:YD,names:JD};function ek(){Math.abs(this.lat1+this.lat2)<Lt||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Xh(this.es),this.e1=Kh(this.es),this.e2=Yh(this.es),this.e3=Jh(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=ao(this.e,this.sinphi,this.cosphi),this.ml1=_s(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<Lt?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=ao(this.e,this.sinphi,this.cosphi),this.ml2=_s(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=_s(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function tk(e){var r=e.x,a=e.y,u;if(this.sphere)u=this.a*(this.g-a);else{var d=_s(this.e0,this.e1,this.e2,this.e3,a);u=this.a*(this.g-d)}var g=this.ns*Vt(r-this.long0),m=this.x0+u*Math.sin(g),l=this.y0+this.rh-u*Math.cos(g);return e.x=m,e.y=l,e}function ik(e){e.x-=this.x0,e.y=this.rh-e.y+this.y0;var r,a,u,d;this.ns>=0?(a=Math.sqrt(e.x*e.x+e.y*e.y),r=1):(a=-Math.sqrt(e.x*e.x+e.y*e.y),r=-1);var g=0;if(a!==0&&(g=Math.atan2(r*e.x,r*e.y)),this.sphere)return d=Vt(this.long0+g/this.ns),u=_u(this.g-a/this.a),e.x=d,e.y=u,e;var m=this.g-a/this.a;return u=up(m,this.e0,this.e1,this.e2,this.e3),d=Vt(this.long0+g/this.ns),e.x=d,e.y=u,e}var rk=["Equidistant_Conic","eqdc"];const nk={init:ek,forward:tk,inverse:ik,names:rk};function sk(){this.R=this.a}function ak(e){var r=e.x,a=e.y,u=Vt(r-this.long0),d,g;Math.abs(a)<=Lt&&(d=this.x0+this.R*u,g=this.y0);var m=Tl(2*Math.abs(a/Math.PI));(Math.abs(u)<=Lt||Math.abs(Math.abs(a)-gt)<=Lt)&&(d=this.x0,a>=0?g=this.y0+Math.PI*this.R*Math.tan(.5*m):g=this.y0+Math.PI*this.R*-Math.tan(.5*m));var l=.5*Math.abs(Math.PI/u-u/Math.PI),M=l*l,P=Math.sin(m),R=Math.cos(m),D=R/(P+R-1),z=D*D,Z=D*(2/P-1),W=Z*Z,J=Math.PI*this.R*(l*(D-W)+Math.sqrt(M*(D-W)*(D-W)-(W+M)*(z-W)))/(W+M);u<0&&(J=-J),d=this.x0+J;var me=M+D;return J=Math.PI*this.R*(Z*me-l*Math.sqrt((W+M)*(M+1)-me*me))/(W+M),a>=0?g=this.y0+J:g=this.y0-J,e.x=d,e.y=g,e}function ok(e){var r,a,u,d,g,m,l,M,P,R,D,z,Z;return e.x-=this.x0,e.y-=this.y0,D=Math.PI*this.R,u=e.x/D,d=e.y/D,g=u*u+d*d,m=-Math.abs(d)*(1+g),l=m-2*d*d+u*u,M=-2*m+1+2*d*d+g*g,Z=d*d/M+(2*l*l*l/M/M/M-9*m*l/M/M)/27,P=(m-l*l/3/M)/M,R=2*Math.sqrt(-P/3),D=3*Z/P/R,Math.abs(D)>1&&(D>=0?D=1:D=-1),z=Math.acos(D)/3,e.y>=0?a=(-R*Math.cos(z+Math.PI/3)-l/3/M)*Math.PI:a=-(-R*Math.cos(z+Math.PI/3)-l/3/M)*Math.PI,Math.abs(u)<Lt?r=this.long0:r=Vt(this.long0+Math.PI*(g-1+Math.sqrt(1+2*(u*u-d*d)+g*g))/2/u),e.x=r,e.y=a,e}var lk=["Van_der_Grinten_I","VanDerGrinten","vandg"];const ck={init:sk,forward:ak,inverse:ok,names:lk};function uk(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function hk(e){var r=e.x,a=e.y,u=Math.sin(e.y),d=Math.cos(e.y),g=Vt(r-this.long0),m,l,M,P,R,D,z,Z,W,J,me,xe,Pe,oe,Le,Ze,Ke,dt,bt,Pt,Ht,Rt,li;return this.sphere?Math.abs(this.sin_p12-1)<=Lt?(e.x=this.x0+this.a*(gt-a)*Math.sin(g),e.y=this.y0-this.a*(gt-a)*Math.cos(g),e):Math.abs(this.sin_p12+1)<=Lt?(e.x=this.x0+this.a*(gt+a)*Math.sin(g),e.y=this.y0+this.a*(gt+a)*Math.cos(g),e):(dt=this.sin_p12*u+this.cos_p12*d*Math.cos(g),Ze=Math.acos(dt),Ke=Ze?Ze/Math.sin(Ze):1,e.x=this.x0+this.a*Ke*d*Math.sin(g),e.y=this.y0+this.a*Ke*(this.cos_p12*u-this.sin_p12*d*Math.cos(g)),e):(m=Xh(this.es),l=Kh(this.es),M=Yh(this.es),P=Jh(this.es),Math.abs(this.sin_p12-1)<=Lt?(R=this.a*_s(m,l,M,P,gt),D=this.a*_s(m,l,M,P,a),e.x=this.x0+(R-D)*Math.sin(g),e.y=this.y0-(R-D)*Math.cos(g),e):Math.abs(this.sin_p12+1)<=Lt?(R=this.a*_s(m,l,M,P,gt),D=this.a*_s(m,l,M,P,a),e.x=this.x0+(R+D)*Math.sin(g),e.y=this.y0+(R+D)*Math.cos(g),e):(z=u/d,Z=pu(this.a,this.e,this.sin_p12),W=pu(this.a,this.e,u),J=Math.atan((1-this.es)*z+this.es*Z*this.sin_p12/(W*d)),me=Math.atan2(Math.sin(g),this.cos_p12*Math.tan(J)-this.sin_p12*Math.cos(g)),me===0?bt=Math.asin(this.cos_p12*Math.sin(J)-this.sin_p12*Math.cos(J)):Math.abs(Math.abs(me)-Math.PI)<=Lt?bt=-Math.asin(this.cos_p12*Math.sin(J)-this.sin_p12*Math.cos(J)):bt=Math.asin(Math.sin(g)*Math.cos(J)/Math.sin(me)),xe=this.e*this.sin_p12/Math.sqrt(1-this.es),Pe=this.e*this.cos_p12*Math.cos(me)/Math.sqrt(1-this.es),oe=xe*Pe,Le=Pe*Pe,Pt=bt*bt,Ht=Pt*bt,Rt=Ht*bt,li=Rt*bt,Ze=Z*bt*(1-Pt*Le*(1-Le)/6+Ht/8*oe*(1-2*Le)+Rt/120*(Le*(4-7*Le)-3*xe*xe*(1-7*Le))-li/48*oe),e.x=this.x0+Ze*Math.sin(me),e.y=this.y0+Ze*Math.cos(me),e))}function dk(e){e.x-=this.x0,e.y-=this.y0;var r,a,u,d,g,m,l,M,P,R,D,z,Z,W,J,me,xe,Pe,oe,Le,Ze,Ke,dt,bt;return this.sphere?(r=Math.sqrt(e.x*e.x+e.y*e.y),r>2*gt*this.a?void 0:(a=r/this.a,u=Math.sin(a),d=Math.cos(a),g=this.long0,Math.abs(r)<=Lt?m=this.lat0:(m=Tl(d*this.sin_p12+e.y*u*this.cos_p12/r),l=Math.abs(this.lat0)-gt,Math.abs(l)<=Lt?this.lat0>=0?g=Vt(this.long0+Math.atan2(e.x,-e.y)):g=Vt(this.long0-Math.atan2(-e.x,e.y)):g=Vt(this.long0+Math.atan2(e.x*u,r*this.cos_p12*d-e.y*this.sin_p12*u))),e.x=g,e.y=m,e)):(M=Xh(this.es),P=Kh(this.es),R=Yh(this.es),D=Jh(this.es),Math.abs(this.sin_p12-1)<=Lt?(z=this.a*_s(M,P,R,D,gt),r=Math.sqrt(e.x*e.x+e.y*e.y),Z=z-r,m=up(Z/this.a,M,P,R,D),g=Vt(this.long0+Math.atan2(e.x,-1*e.y)),e.x=g,e.y=m,e):Math.abs(this.sin_p12+1)<=Lt?(z=this.a*_s(M,P,R,D,gt),r=Math.sqrt(e.x*e.x+e.y*e.y),Z=r-z,m=up(Z/this.a,M,P,R,D),g=Vt(this.long0+Math.atan2(e.x,e.y)),e.x=g,e.y=m,e):(r=Math.sqrt(e.x*e.x+e.y*e.y),me=Math.atan2(e.x,e.y),W=pu(this.a,this.e,this.sin_p12),xe=Math.cos(me),Pe=this.e*this.cos_p12*xe,oe=-Pe*Pe/(1-this.es),Le=3*this.es*(1-oe)*this.sin_p12*this.cos_p12*xe/(1-this.es),Ze=r/W,Ke=Ze-oe*(1+oe)*Math.pow(Ze,3)/6-Le*(1+3*oe)*Math.pow(Ze,4)/24,dt=1-oe*Ke*Ke/2-Ze*Ke*Ke*Ke/6,J=Math.asin(this.sin_p12*Math.cos(Ke)+this.cos_p12*Math.sin(Ke)*xe),g=Vt(this.long0+Math.asin(Math.sin(me)*Math.sin(Ke)/Math.cos(J))),bt=Math.sin(J),m=Math.atan2((bt-this.es*dt*this.sin_p12)*Math.tan(J),bt*(1-this.es)),e.x=g,e.y=m,e))}var pk=["Azimuthal_Equidistant","aeqd"];const fk={init:uk,forward:hk,inverse:dk,names:pk};function mk(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function gk(e){var r,a,u,d,g,m,l,M,P=e.x,R=e.y;return u=Vt(P-this.long0),r=Math.sin(R),a=Math.cos(R),d=Math.cos(u),m=this.sin_p14*r+this.cos_p14*a*d,g=1,(m>0||Math.abs(m)<=Lt)&&(l=this.a*g*a*Math.sin(u),M=this.y0+this.a*g*(this.cos_p14*r-this.sin_p14*a*d)),e.x=l,e.y=M,e}function yk(e){var r,a,u,d,g,m,l;return e.x-=this.x0,e.y-=this.y0,r=Math.sqrt(e.x*e.x+e.y*e.y),a=Tl(r/this.a),u=Math.sin(a),d=Math.cos(a),m=this.long0,Math.abs(r)<=Lt?(l=this.lat0,e.x=m,e.y=l,e):(l=Tl(d*this.sin_p14+e.y*u*this.cos_p14/r),g=Math.abs(this.lat0)-gt,Math.abs(g)<=Lt?(this.lat0>=0?m=Vt(this.long0+Math.atan2(e.x,-e.y)):m=Vt(this.long0-Math.atan2(-e.x,e.y)),e.x=m,e.y=l,e):(m=Vt(this.long0+Math.atan2(e.x*u,r*this.cos_p14*d-e.y*this.sin_p14*u)),e.x=m,e.y=l,e))}var _k=["ortho"];const vk={init:mk,forward:gk,inverse:yk,names:_k};var Hr={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},ar={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function xk(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=gt-sr/2?this.face=Hr.TOP:this.lat0<=-(gt-sr/2)?this.face=Hr.BOTTOM:Math.abs(this.long0)<=sr?this.face=Hr.FRONT:Math.abs(this.long0)<=gt+sr?this.face=this.long0>0?Hr.RIGHT:Hr.LEFT:this.face=Hr.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function bk(e){var r={x:0,y:0},a,u,d,g,m,l,M={value:0};if(e.x-=this.long0,this.es!==0?a=Math.atan(this.one_minus_f_squared*Math.tan(e.y)):a=e.y,u=e.x,this.face===Hr.TOP)g=gt-a,u>=sr&&u<=gt+sr?(M.value=ar.AREA_0,d=u-gt):u>gt+sr||u<=-(gt+sr)?(M.value=ar.AREA_1,d=u>0?u-hn:u+hn):u>-(gt+sr)&&u<=-sr?(M.value=ar.AREA_2,d=u+gt):(M.value=ar.AREA_3,d=u);else if(this.face===Hr.BOTTOM)g=gt+a,u>=sr&&u<=gt+sr?(M.value=ar.AREA_0,d=-u+gt):u<sr&&u>=-sr?(M.value=ar.AREA_1,d=-u):u<-sr&&u>=-(gt+sr)?(M.value=ar.AREA_2,d=-u-gt):(M.value=ar.AREA_3,d=u>0?-u+hn:-u-hn);else{var P,R,D,z,Z,W,J;this.face===Hr.RIGHT?u=su(u,+gt):this.face===Hr.BACK?u=su(u,+hn):this.face===Hr.LEFT&&(u=su(u,-gt)),z=Math.sin(a),Z=Math.cos(a),W=Math.sin(u),J=Math.cos(u),P=Z*J,R=Z*W,D=z,this.face===Hr.FRONT?(g=Math.acos(P),d=Od(g,D,R,M)):this.face===Hr.RIGHT?(g=Math.acos(R),d=Od(g,D,-P,M)):this.face===Hr.BACK?(g=Math.acos(-P),d=Od(g,D,-R,M)):this.face===Hr.LEFT?(g=Math.acos(-R),d=Od(g,D,P,M)):(g=d=0,M.value=ar.AREA_0)}return l=Math.atan(12/hn*(d+Math.acos(Math.sin(d)*Math.cos(sr))-gt)),m=Math.sqrt((1-Math.cos(g))/(Math.cos(l)*Math.cos(l))/(1-Math.cos(Math.atan(1/Math.cos(d))))),M.value===ar.AREA_1?l+=gt:M.value===ar.AREA_2?l+=hn:M.value===ar.AREA_3&&(l+=1.5*hn),r.x=m*Math.cos(l),r.y=m*Math.sin(l),r.x=r.x*this.a+this.x0,r.y=r.y*this.a+this.y0,e.x=r.x,e.y=r.y,e}function wk(e){var r={lam:0,phi:0},a,u,d,g,m,l,M,P,R,D={value:0};if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,u=Math.atan(Math.sqrt(e.x*e.x+e.y*e.y)),a=Math.atan2(e.y,e.x),e.x>=0&&e.x>=Math.abs(e.y)?D.value=ar.AREA_0:e.y>=0&&e.y>=Math.abs(e.x)?(D.value=ar.AREA_1,a-=gt):e.x<0&&-e.x>=Math.abs(e.y)?(D.value=ar.AREA_2,a=a<0?a+hn:a-hn):(D.value=ar.AREA_3,a+=gt),R=hn/12*Math.tan(a),m=Math.sin(R)/(Math.cos(R)-1/Math.sqrt(2)),l=Math.atan(m),d=Math.cos(a),g=Math.tan(u),M=1-d*d*g*g*(1-Math.cos(Math.atan(1/Math.cos(l)))),M<-1?M=-1:M>1&&(M=1),this.face===Hr.TOP)P=Math.acos(M),r.phi=gt-P,D.value===ar.AREA_0?r.lam=l+gt:D.value===ar.AREA_1?r.lam=l<0?l+hn:l-hn:D.value===ar.AREA_2?r.lam=l-gt:r.lam=l;else if(this.face===Hr.BOTTOM)P=Math.acos(M),r.phi=P-gt,D.value===ar.AREA_0?r.lam=-l+gt:D.value===ar.AREA_1?r.lam=-l:D.value===ar.AREA_2?r.lam=-l-gt:r.lam=l<0?-l-hn:-l+hn;else{var z,Z,W;z=M,R=z*z,R>=1?W=0:W=Math.sqrt(1-R)*Math.sin(l),R+=W*W,R>=1?Z=0:Z=Math.sqrt(1-R),D.value===ar.AREA_1?(R=Z,Z=-W,W=R):D.value===ar.AREA_2?(Z=-Z,W=-W):D.value===ar.AREA_3&&(R=Z,Z=W,W=-R),this.face===Hr.RIGHT?(R=z,z=-Z,Z=R):this.face===Hr.BACK?(z=-z,Z=-Z):this.face===Hr.LEFT&&(R=z,z=Z,Z=-R),r.phi=Math.acos(-W)-gt,r.lam=Math.atan2(Z,z),this.face===Hr.RIGHT?r.lam=su(r.lam,-gt):this.face===Hr.BACK?r.lam=su(r.lam,-hn):this.face===Hr.LEFT&&(r.lam=su(r.lam,+gt))}if(this.es!==0){var J,me,xe;J=r.phi<0?1:0,me=Math.tan(r.phi),xe=this.b/Math.sqrt(me*me+this.one_minus_f_squared),r.phi=Math.atan(Math.sqrt(this.a*this.a-xe*xe)/(this.one_minus_f*xe)),J&&(r.phi=-r.phi)}return r.lam+=this.long0,e.x=r.lam,e.y=r.phi,e}function Od(e,r,a,u){var d;return e<Lt?(u.value=ar.AREA_0,d=0):(d=Math.atan2(r,a),Math.abs(d)<=sr?u.value=ar.AREA_0:d>sr&&d<=gt+sr?(u.value=ar.AREA_1,d-=gt):d>gt+sr||d<=-(gt+sr)?(u.value=ar.AREA_2,d=d>=0?d-hn:d+hn):(u.value=ar.AREA_3,d+=gt)),d}function su(e,r){var a=e+r;return a<-hn?a+=Rh:a>+hn&&(a-=Rh),a}var Mk=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const Sk={init:xk,forward:bk,inverse:wk,names:Mk};var Mm=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],dh=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],qx=.8487,Gx=1.3523,Hx=ro/5,Ek=1/Hx,Qc=18,hp=function(e,r){return e[0]+r*(e[1]+r*(e[2]+r*e[3]))},Tk=function(e,r){return e[1]+r*(2*e[2]+r*3*e[3])};function Ck(e,r,a,u){for(var d=r;u;--u){var g=e(d);if(d-=g,Math.abs(g)<a)break}return d}function Ik(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function Ak(e){var r=Vt(e.x-this.long0),a=Math.abs(e.y),u=Math.floor(a*Hx);u<0?u=0:u>=Qc&&(u=Qc-1),a=ro*(a-Ek*u);var d={x:hp(Mm[u],a)*r,y:hp(dh[u],a)};return e.y<0&&(d.y=-d.y),d.x=d.x*this.a*qx+this.x0,d.y=d.y*this.a*Gx+this.y0,d}function Pk(e){var r={x:(e.x-this.x0)/(this.a*qx),y:Math.abs(e.y-this.y0)/(this.a*Gx)};if(r.y>=1)r.x/=Mm[Qc][0],r.y=e.y<0?-gt:gt;else{var a=Math.floor(r.y*Qc);for(a<0?a=0:a>=Qc&&(a=Qc-1);;)if(dh[a][0]>r.y)--a;else if(dh[a+1][0]<=r.y)++a;else break;var u=dh[a],d=5*(r.y-u[0])/(dh[a+1][0]-u[0]);d=Ck(function(g){return(hp(u,g)-r.y)/Tk(u,g)},d,Lt,100),r.x/=hp(Mm[a],d),r.y=(5*a+d)*Un,e.y<0&&(r.y=-r.y)}return r.x=Vt(r.x+this.long0),r}var Dk=["Robinson","robin"];const kk={init:Ik,forward:Ak,inverse:Pk,names:Dk};function Lk(){this.name="geocent"}function Rk(e){var r=Dx(e,this.es,this.a);return r}function zk(e){var r=kx(e,this.es,this.a,this.b);return r}var Ok=["Geocentric","geocentric","geocent","Geocent"];const Fk={init:Lk,forward:Rk,inverse:zk,names:Ok};var ts={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},lh={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function Bk(){if(Object.keys(lh).forEach((function(a){if(typeof this[a]>"u")this[a]=lh[a].def;else{if(lh[a].num&&isNaN(this[a]))throw new Error("Invalid parameter value, must be numeric "+a+" = "+this[a]);lh[a].num&&(this[a]=parseFloat(this[a]))}lh[a].degrees&&(this[a]=this[a]*Un)}).bind(this)),Math.abs(Math.abs(this.lat0)-gt)<Lt?this.mode=this.lat0<0?ts.S_POLE:ts.N_POLE:Math.abs(this.lat0)<Lt?this.mode=ts.EQUIT:(this.mode=ts.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var e=this.tilt,r=this.azi;this.cg=Math.cos(r),this.sg=Math.sin(r),this.cw=Math.cos(e),this.sw=Math.sin(e)}function Nk(e){e.x-=this.long0;var r=Math.sin(e.y),a=Math.cos(e.y),u=Math.cos(e.x),d,g;switch(this.mode){case ts.OBLIQ:g=this.sinph0*r+this.cosph0*a*u;break;case ts.EQUIT:g=a*u;break;case ts.S_POLE:g=-r;break;case ts.N_POLE:g=r;break}switch(g=this.pn1/(this.p-g),d=g*a*Math.sin(e.x),this.mode){case ts.OBLIQ:g*=this.cosph0*r-this.sinph0*a*u;break;case ts.EQUIT:g*=r;break;case ts.N_POLE:g*=-(a*u);break;case ts.S_POLE:g*=a*u;break}var m,l;return m=g*this.cg+d*this.sg,l=1/(m*this.sw*this.h1+this.cw),d=(d*this.cg-g*this.sg)*this.cw*l,g=m*l,e.x=d*this.a,e.y=g*this.a,e}function $k(e){e.x/=this.a,e.y/=this.a;var r={x:e.x,y:e.y},a,u,d;d=1/(this.pn1-e.y*this.sw),a=this.pn1*e.x*d,u=this.pn1*e.y*this.cw*d,e.x=a*this.cg+u*this.sg,e.y=u*this.cg-a*this.sg;var g=pa(e.x,e.y);if(Math.abs(g)<Lt)r.x=0,r.y=e.y;else{var m,l;switch(l=1-g*g*this.pfact,l=(this.p-Math.sqrt(l))/(this.pn1/g+g/this.pn1),m=Math.sqrt(1-l*l),this.mode){case ts.OBLIQ:r.y=Math.asin(m*this.sinph0+e.y*l*this.cosph0/g),e.y=(m-this.sinph0*Math.sin(r.y))*g,e.x*=l*this.cosph0;break;case ts.EQUIT:r.y=Math.asin(e.y*l/g),e.y=m*g,e.x*=l;break;case ts.N_POLE:r.y=Math.asin(m),e.y=-e.y;break;case ts.S_POLE:r.y=-Math.asin(m);break}r.x=Math.atan2(e.x,e.y)}return e.x=r.x+this.long0,e.y=r.y,e}var Uk=["Tilted_Perspective","tpers"];const Vk={init:Bk,forward:Nk,inverse:$k,names:Uk};function jk(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var e=1-this.es,r=1/e;this.radius_p=Math.sqrt(e),this.radius_p2=e,this.radius_p_inv2=r,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function qk(e){var r=e.x,a=e.y,u,d,g,m;if(r=r-this.long0,this.shape==="ellipse"){a=Math.atan(this.radius_p2*Math.tan(a));var l=this.radius_p/pa(this.radius_p*Math.cos(a),Math.sin(a));if(d=l*Math.cos(r)*Math.cos(a),g=l*Math.sin(r)*Math.cos(a),m=l*Math.sin(a),(this.radius_g-d)*d-g*g-m*m*this.radius_p_inv2<0)return e.x=Number.NaN,e.y=Number.NaN,e;u=this.radius_g-d,this.flip_axis?(e.x=this.radius_g_1*Math.atan(g/pa(m,u)),e.y=this.radius_g_1*Math.atan(m/u)):(e.x=this.radius_g_1*Math.atan(g/u),e.y=this.radius_g_1*Math.atan(m/pa(g,u)))}else this.shape==="sphere"&&(u=Math.cos(a),d=Math.cos(r)*u,g=Math.sin(r)*u,m=Math.sin(a),u=this.radius_g-d,this.flip_axis?(e.x=this.radius_g_1*Math.atan(g/pa(m,u)),e.y=this.radius_g_1*Math.atan(m/u)):(e.x=this.radius_g_1*Math.atan(g/u),e.y=this.radius_g_1*Math.atan(m/pa(g,u))));return e.x=e.x*this.a,e.y=e.y*this.a,e}function Gk(e){var r=-1,a=0,u=0,d,g,m,l;if(e.x=e.x/this.a,e.y=e.y/this.a,this.shape==="ellipse"){this.flip_axis?(u=Math.tan(e.y/this.radius_g_1),a=Math.tan(e.x/this.radius_g_1)*pa(1,u)):(a=Math.tan(e.x/this.radius_g_1),u=Math.tan(e.y/this.radius_g_1)*pa(1,a));var M=u/this.radius_p;if(d=a*a+M*M+r*r,g=2*this.radius_g*r,m=g*g-4*d*this.C,m<0)return e.x=Number.NaN,e.y=Number.NaN,e;l=(-g-Math.sqrt(m))/(2*d),r=this.radius_g+l*r,a*=l,u*=l,e.x=Math.atan2(a,r),e.y=Math.atan(u*Math.cos(e.x)/r),e.y=Math.atan(this.radius_p_inv2*Math.tan(e.y))}else if(this.shape==="sphere"){if(this.flip_axis?(u=Math.tan(e.y/this.radius_g_1),a=Math.tan(e.x/this.radius_g_1)*Math.sqrt(1+u*u)):(a=Math.tan(e.x/this.radius_g_1),u=Math.tan(e.y/this.radius_g_1)*Math.sqrt(1+a*a)),d=a*a+u*u+r*r,g=2*this.radius_g*r,m=g*g-4*d*this.C,m<0)return e.x=Number.NaN,e.y=Number.NaN,e;l=(-g-Math.sqrt(m))/(2*d),r=this.radius_g+l*r,a*=l,u*=l,e.x=Math.atan2(a,r),e.y=Math.atan(u*Math.cos(e.x)/r)}return e.x=e.x+this.long0,e}var Hk=["Geostationary Satellite View","Geostationary_Satellite","geos"];const Zk={init:jk,forward:qk,inverse:Gk,names:Hk};var bh=1.340264,wh=-.081106,Mh=893e-6,Sh=.003796,dp=Math.sqrt(3)/2;function Wk(){this.es=0,this.long0=this.long0!==void 0?this.long0:0}function Xk(e){var r=Vt(e.x-this.long0),a=e.y,u=Math.asin(dp*Math.sin(a)),d=u*u,g=d*d*d;return e.x=r*Math.cos(u)/(dp*(bh+3*wh*d+g*(7*Mh+9*Sh*d))),e.y=u*(bh+wh*d+g*(Mh+Sh*d)),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function Kk(e){e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a;var r=1e-9,a=12,u=e.y,d,g,m,l,M,P;for(P=0;P<a&&(d=u*u,g=d*d*d,m=u*(bh+wh*d+g*(Mh+Sh*d))-e.y,l=bh+3*wh*d+g*(7*Mh+9*Sh*d),u-=M=m/l,!(Math.abs(M)<r));++P);return d=u*u,g=d*d*d,e.x=dp*e.x*(bh+3*wh*d+g*(7*Mh+9*Sh*d))/Math.cos(u),e.y=Math.asin(Math.sin(u)/dp),e.x=Vt(e.x+this.long0),e}var Yk=["eqearth","Equal Earth","Equal_Earth"];const Jk={init:Wk,forward:Xk,inverse:Kk,names:Yk};function Qk(e){e.Proj.projections.add(Wd),e.Proj.projections.add(Xd),e.Proj.projections.add(eP),e.Proj.projections.add(uP),e.Proj.projections.add(gP),e.Proj.projections.add(bP),e.Proj.projections.add(CP),e.Proj.projections.add(kP),e.Proj.projections.add(FP),e.Proj.projections.add(VP),e.Proj.projections.add(sD),e.Proj.projections.add(hD),e.Proj.projections.add(gD),e.Proj.projections.add(wD),e.Proj.projections.add(CD),e.Proj.projections.add(kD),e.Proj.projections.add(FD),e.Proj.projections.add(VD),e.Proj.projections.add(WD),e.Proj.projections.add(QD),e.Proj.projections.add(nk),e.Proj.projections.add(ck),e.Proj.projections.add(fk),e.Proj.projections.add(vk),e.Proj.projections.add(Sk),e.Proj.projections.add(kk),e.Proj.projections.add(Fk),e.Proj.projections.add(Vk),e.Proj.projections.add(Zk),e.Proj.projections.add(Jk)}Ys.defaultDatum="WGS84";Ys.Proj=no;Ys.WGS84=new Ys.Proj("WGS84");Ys.Point=du;Ys.toPoint=Lx;Ys.defs=gs;Ys.nadgrid=iA;Ys.transform=cp;Ys.mgrs=_A;Ys.version="__VERSION__";Qk(Ys);const ys=Lo("MapStore",{state:()=>({map:{},currentMapStyle:"pwdDrawnMapStyle",bufferForAddress:{},currentMarkersForTopic:[],addressMarker:null,addressParcel:null,initialized:!1,draw:null,imageryOn:!1,imagerySelected:"2023",cyclomediaOn:!1,pictometryOn:!1,selectedRegmap:null,regmapOpacity:.5,zoningOpacity:1}),actions:{setMap(e){this.map=e},setMapStyle(e){this.currentMapStyle=e},async fillBufferForAddress(e,r){const g=Ys("+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs","+proj=lcc +lat_1=40.96666666666667 +lat_2=39.93333333333333 +lat_0=39.33333333333334 +lon_0=-77.75 +x_0=600000 +y_0=0 +ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 +no_defs",[e,r]);console.log("fillBufferForAddress is running, lng:",e,"lat:",r);const m="https://citygeo-geocoder-pub.databridge.phila.gov/arcgis/rest/services/Utilities/Geometry/GeometryServer/buffer",l={geometries:`${g.join(", ")}`,inSR:2272,outSR:4326,bufferSR:2272,distances:500,unionResults:!0,geodesic:!1,f:"json"};let M=await or.get(m,{params:l});this.bufferForAddress=M.data}}}),ya=e=>(Nh("data-v-0d351ac8"),e=e(),$h(),e),e3=ya(()=>Y("div",{class:"box"},"Deed information and document transactions for this address. The map faithfully reflects property boundaries as described in recorded deeds including multiple types of easements. The property boundaries displayed on the map are for reference only and should not be used in place of the recorded deeds or land surveys. Source: Department of Records",-1)),t3={class:"columns is-multiline"},i3=["onClick"],r3=ya(()=>Y("h5",{class:"title is-5"},"Parcel Details",-1)),n3={key:0,class:"vert-table"},s3={class:"columns"},a3=ya(()=>Y("div",{class:"column is-4"},"Map Registry #",-1)),o3={class:"column is-8"},l3={class:"columns"},c3=ya(()=>Y("div",{class:"column is-4"},"Parcel Address",-1)),u3={class:"column is-8"},h3={class:"columns"},d3=ya(()=>Y("div",{class:"column is-4"},"Status",-1)),p3={class:"column is-8"},f3={class:"columns"},m3=ya(()=>Y("div",{class:"column is-4"},"Origination Date",-1)),g3={class:"column is-8"},y3={class:"columns"},_3=ya(()=>Y("div",{class:"column is-4"},"Inactive Date",-1)),v3={class:"column is-8"},x3={class:"columns"},b3=ya(()=>Y("div",{class:"column is-4"},"Has Air Rights",-1)),w3={class:"column is-8"},M3={class:"columns"},S3=ya(()=>Y("div",{class:"column is-4"},"Is Condo",-1)),E3={class:"column is-8"},T3={class:"mt-6"},C3=ya(()=>Y("h5",{class:"subtitle is-5"},"Documents",-1)),I3={class:"table is-fullwidth is-striped"},A3=ya(()=>Y("thead",null,[Y("tr",null,[Y("th",null,"ID"),Y("th",null,"Date"),Y("th",null,"Type"),Y("th",null,"Grantor"),Y("th",null,"Grantee")])],-1)),P3={class:"mt-6"},D3=ya(()=>Y("h5",{class:"subtitle is-5"},"Registry Maps",-1)),k3={class:"columns is-multiline"},L3=["onClick"],R3={__name:"Deeds",setup(e){dn();const r=hu(),a=Mx(),u=Js(),d=ys();d.map;let g=gi(()=>u.selectedParcelId);const m=gi(()=>r.dor.features.filter(z=>z.id===g.value)[0]),l=gi(()=>g.value?(console.log("selected.value:",g.value),a.dorDocuments[g.value].data.features):null),M=gi(()=>a.regmaps.data.features);$m(()=>{console.log("Deeds.vue onBeforeMount"),r.dor.features.length>0&&(u.selectedParcelId=r.dor.features[0].properties.OBJECTID)});const P={1:"Active",2:"Inactive",3:"Remainder"},R=z=>{d.selectedRegmap===z?d.selectedRegmap=null:d.selectedRegmap=z},D=gi(()=>d.selectedRegmap);return(z,Z)=>(It(),Ot(Mr,null,[e3,Y("div",t3,[(It(!0),Ot(Mr,null,Ls(Fi(r).dor.features,W=>(It(),Ot("div",{key:W.properties.OBJECTID,onClick:J=>Fi(u).selectedParcelId=W.properties.OBJECTID,class:is(["column is-2 add-borders has-text-centered",{"is-selected":W.properties.OBJECTID===Fi(g)}])},qt(W.properties.MAPREG),11,i3))),128))]),r3,m.value?(It(),Ot("div",n3,[Y("div",s3,[a3,Y("div",o3,qt(m.value.properties.MAPREG),1)]),Y("div",l3,[c3,Y("div",u3,qt(m.value.properties.ADDR_SOURCE),1)]),Y("div",h3,[d3,Y("div",p3,qt(P[m.value.properties.STATUS]),1)]),Y("div",f3,[m3,Y("div",g3,qt(m.value.properties.ORIG_DATE),1)]),Y("div",y3,[_3,Y("div",v3,qt(m.value.properties.INACTDATE||"None"),1)]),Y("div",x3,[b3,Y("div",w3,qt(m.value.properties.SUFFIX?"Yes":"No"),1)]),Y("div",M3,[S3,Y("div",E3,qt(m.value.properties.CONDOFLAG?"Yes":"No"),1)])])):Gi("",!0),Y("div",T3,[C3,Y("table",I3,[A3,Y("tbody",null,[(It(!0),Ot(Mr,null,Ls(l.value,W=>(It(),Ot("tr",null,[Y("td",null,qt(W.attributes.DOCUMENT_ID),1),Y("td",null,qt(W.attributes.DISPLAY_DATE),1),Y("td",null,qt(W.attributes.DOCUMENT_TYPE),1),Y("td",null,qt(W.attributes.GRANTORS),1),Y("td",null,qt(W.attributes.GRANTEES),1)]))),256))])])]),Y("div",P3,[D3,Y("div",k3,[(It(!0),Ot(Mr,null,Ls(M.value,W=>(It(),Ot("div",{class:is(["column is-2 add-borders has-text-centered regmap-div",{"is-selected":W.properties.RECMAP===D.value}]),onClick:J=>R(W.properties.RECMAP)},qt(W.properties.RECMAP),11,L3))),256))])])],64))}},z3=Qs(R3,[["__scopeId","data-v-0d351ac8"]]),lg=Lo("LiStore",{state:()=>({selectedLiBuildingNumber:null,liInspections:{},liPermits:{},liBuildingFootprints:{},liBuildingCertSummary:{},liBuildingCerts:{}}),actions:{async fillLiBuildingFootprints(){console.log("fillLiBuildingFootprints is running");const r=dn().addressData.features[0].properties.bin.split("|"),a="https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/LI_BUILDING_FOOTPRINTS/FeatureServer/0/query";let u,d,g="";if(r.length){for(let M=0;M<r.length;M++)g+=r[M],M<r.length-1&&(g+="', '");d="BIN IN ('"+g+"')"}else u=r.properties.li_parcel_id,d="PARCEL_ID_NUM = '"+u+"'";console.log("where:",d);const m={where:d,outFields:"*",outSR:4326,f:"pjson"},l=await or.get(a,{params:m});this.liBuildingFootprints=await l.data},async fillLiBuildingCertSummary(){console.log("fillLiBuildingCertSummary is running");const r=dn().addressData.features[0].properties.bin.split("|");let a="https://phl.carto.com/api/v2/sql?q=",u="";if(r.length)for(let m=0;m<r.length;m++)u+=r[m],m<r.length-1&&(u+="', '");else this.liBuildingFootprints.data.features.length?u=this.liBuildingFootprints.data.features[0].attributes.BIN:u="";const d=a+=`SELECT * FROM building_cert_summary WHERE structure_id IN ('${u}')`,g=await fetch(d);this.liBuildingCertSummary=await g.json()},async fillLiBuildingCerts(){console.log("fillLiBuildingCerts is running");const r=dn().addressData.features[0].properties.bin.split("|");let a="https://phl.carto.com/api/v2/sql?q=",u="";if(r.length)for(let m=0;m<r.length;m++)u+=r[m],m<r.length-1&&(u+="', '");else this.liBuildingFootprints.data.features.length?u=this.liBuildingFootprints.data.features[0].attributes.BIN:u="";const d=a+=`SELECT * FROM building_certs WHERE bin IN ('${u}')`,g=await fetch(d);this.liBuildingCerts=await g.json()},async fillLiInspections(){const r=dn().addressData.features[0];let a="https://phl.carto.com/api/v2/sql?q=";const u=r.properties.eclipse_location_id.replace(/\|/g,"', '"),d=r.properties.street_address,g=r.properties.opa_account_num?` AND opa_account_num IN ('${r.properties.opa_account_num}')`:"",m=r.properties.pwd_parcel_id,l=r.properties.li_address_key.replace(/\|/g,"', '"),M=a+=`SELECT * FROM case_investigations WHERE (address = '${d}' or addressobjectid IN ('${l}'))           AND systemofrecord IN ('HANSEN') ${g} UNION SELECT * FROM case_investigations WHERE           addressobjectid IN ('${u}') OR parcel_id_num IN ( '${m}' )           AND systemofrecord IN ('ECLIPSE') ${g}`,P=await fetch(M);this.liInspections=await P.json()},async fillLiPermits(){const r=dn().addressData.features[0];let a="https://phl.carto.com/api/v2/sql?q=";const u=r.properties.eclipse_location_id.replace(/\|/g,"', '"),d=r.properties.street_address,g=r.properties.opa_account_num?` AND opa_account_num IN ('${r.properties.opa_account_num}')`:"",m=r.properties.pwd_parcel_id,l=r.properties.li_address_key.replace(/\|/g,"', '"),M=a+=`SELECT * FROM PERMITS WHERE address = '${d}' or addressobjectid IN ('${l}')       AND systemofrecord IN ('HANSEN') ${g}       UNION SELECT * FROM PERMITS WHERE addressobjectid IN ('${u}') OR parcel_id_num IN ( '${m}' )       AND systemofrecord IN ('ECLIPSE')${g}      ORDER BY permittype`,P=await fetch(M);this.liPermits=await P.json()}},getters:{}}),O3=Y("div",{class:"box"}," Licenses, inspections, permits, property maintenance violations, and zoning permit documents at your search address. Source: Department of Licenses & Inspections ",-1),F3={class:"subtitle is-5"},B3={class:"columns is-multiline"},N3=["onClick"],$3={class:"vert-table"},U3={class:"columns"},V3=Y("div",{class:"column is-4"},"Building ID",-1),j3={class:"column is-8"},q3={class:"columns"},G3=Y("div",{class:"column is-4"},"Building Name",-1),H3={class:"column is-8"},Z3={class:"columns"},W3=Y("div",{class:"column is-4"},"Parcel Address",-1),X3={class:"column is-8"},K3={class:"columns"},Y3=Y("div",{class:"column is-4"},"Building Height (approx)",-1),J3={class:"column is-8"},Q3={class:"columns"},eL=Y("div",{class:"column is-4"},"Building Footprint (approx)",-1),tL={class:"column is-8"},iL=Y("h5",{class:"subtitle is-5"},"Building Certifications",-1),rL={class:"table is-fullwidth is-striped"},nL=Y("thead",null,[Y("tr",null,[Y("th",null,"InspectionType"),Y("th",null,"Date Inspected"),Y("th",null,"Inspection Result"),Y("th",null,"Expiration Date")])],-1),sL=Y("h5",{class:"subtitle is-5"},"Permits",-1),aL={class:"table is-fullwidth is-striped"},oL=Y("thead",null,[Y("tr",null,[Y("th",null,"Date"),Y("th",null,"ID"),Y("th",null,"Description"),Y("th",null,"Status")])],-1),lL=Y("h5",{class:"subtitle is-5"},"Inspections",-1),cL={class:"table is-fullwidth is-striped"},uL=Y("thead",null,[Y("tr",null,[Y("th",null,"Date"),Y("th",null,"ID"),Y("th",null,"Description"),Y("th",null,"Status")])],-1),hL=["innerHTML"],dL={__name:"LI",setup(e){console.log("LI.vue setup");const r=dn(),a=lg(),d=ys().map,{currency:g,date:m}=eg(),l=(xe,Pe)=>new Date(Pe.expirationdate)-new Date(xe.expirationdate),M=gi(()=>a.liBuildingCerts.rows.filter(xe=>xe.bin==W.value).sort(l).slice(0,5)),P=(xe,Pe)=>new Date(Pe.permitissuedate)-new Date(xe.permitissuedate),R=gi(()=>a.liPermits.rows.sort(P).slice(0,5)),D=(xe,Pe)=>new Date(Pe.investigationcompleted)-new Date(xe.investigationcompleted),z=gi(()=>a.liInspections.rows.sort(D).slice(0,5)),Z=xe=>{let Pe=r.addressData.features[0].properties.street_address;return xe.unit_num&&xe.unit_num!=null&&(Pe+=" Unit "+xe.unit_num),"<a target='_blank' href='https://li.phila.gov/Property-History/search/Violation-Detail?address="+encodeURIComponent(Pe)+"&Id="+xe.casenumber+"'>"+xe.casenumber+" <i class='fa fa-external-link-alt'></i></a>"};$m(async()=>{a.selectedLiBuildingNumber=a.liBuildingFootprints.features[0].attributes.BIN}),Uh(async()=>{let xe=[];if(!a.liBuildingFootprints.features)return xe;for(let oe of a.liBuildingFootprints.features)xe.push({type:"Feature",geometry:{type:"Polygon",coordinates:[oe.geometry.rings[0]]},properties:{id:oe.attributes.BIN,type:"liBuildingFootprints"}});let Pe={type:"FeatureCollection",features:xe};console.log("geojson:",Pe,'map.getSource("liBuildingFootprints"):',d.getSource("liBuildingFootprints"),'map.getLayer("liBuildingFootprints"):',d.getLayer("liBuildingFootprints")),await d.getSource("liBuildingFootprints").setData(Pe)});const W=gi(()=>a.selectedLiBuildingNumber),J=gi(()=>a.liBuildingFootprints.features.filter(xe=>xe.attributes.BIN===W.value)[0]),me=xe=>{a.selectedLiBuildingNumber=xe};return(xe,Pe)=>(It(),Ot("section",null,[O3,Y("h5",F3,"There are "+qt(Fi(a).liBuildingFootprints.features.length)+" buildings at this address",1),Y("div",B3,[(It(!0),Ot(Mr,null,Ls(Fi(a).liBuildingFootprints.features,oe=>(It(),Ot("div",{key:oe.attributes.BIN,onClick:Le=>me(oe.attributes.BIN),class:is(["column is-2 add-borders has-text-centered",{"is-selected":oe.attributes.BIN===W.value}])},qt(oe.attributes.BIN),11,N3))),128))]),Y("div",$3,[Y("div",U3,[V3,Y("div",j3,qt(J.value.attributes.BIN||"N/A"),1)]),Y("div",q3,[G3,Y("div",H3,qt(J.value.attributes.BUILDING_NAME||"N/A"),1)]),Y("div",Z3,[W3,Y("div",X3,qt(J.value.attributes.ADDRESS||"N/A"),1)]),Y("div",K3,[Y3,Y("div",J3,qt(J.value.attributes.APPROX_HEIGHT||"N/A")+" ft",1)]),Y("div",Q3,[eL,Y("div",tL,qt((J.value.attributes.Shape__Area*6.3225).toFixed(0)||"N/A")+" sq ft",1)])]),iL,Y("table",rL,[nL,Y("tbody",null,[(It(!0),Ot(Mr,null,Ls(M.value,oe=>(It(),Ot("tr",null,[Y("td",null,qt(oe.buildingcerttype),1),Y("td",null,qt(Fi(m)(oe.inspectiondate)),1),Y("td",null,qt(oe.inspectionresult),1),Y("td",null,qt(Fi(m)(oe.expirationdate)),1)]))),256))])]),sL,Y("table",aL,[oL,Y("tbody",null,[(It(!0),Ot(Mr,null,Ls(R.value,oe=>(It(),Ot("tr",null,[Y("td",null,qt(Fi(m)(oe.permitissuedate)),1),Y("td",null,qt(oe.permitnumber),1),Y("td",null,qt(oe.permitdescription),1),Y("td",null,qt(oe.status),1)]))),256))])]),lL,Y("table",cL,[uL,Y("tbody",null,[(It(!0),Ot(Mr,null,Ls(z.value,oe=>(It(),Ot("tr",null,[Y("td",null,qt(Fi(m)(oe.investigationcompleted)),1),Y("td",{innerHTML:Z(oe)},null,8,hL),Y("td",null,qt(oe.investigationtype),1),Y("td",null,qt(oe.investigationstatus),1)]))),256))])])]))}},pL=Y("h1",null,"Zoning Content",-1),fL=[pL],mL={__name:"Zoning",setup(e){return console.log("Zoning.vue setup"),(r,a)=>(It(),Ot("section",null,fL))}},gL=Y("h1",null,"Voting Content",-1),yL=[gL],_L={__name:"Voting",setup(e){return console.log("Voting.vue setup"),(r,a)=>(It(),Ot("section",null,yL))}};function Fh(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function fu(e,r,a){a===void 0&&(a={});var u=Fh(e),d=Fh(r),g=Ra(d[1]-u[1]),m=Ra(d[0]-u[0]),l=Ra(u[1]),M=Ra(d[1]),P=Math.pow(Math.sin(g/2),2)+Math.pow(Math.sin(m/2),2)*Math.cos(l)*Math.cos(M);return dI(2*Math.atan2(Math.sqrt(P),Math.sqrt(1-P)),a.units)}function Sm(e,r,a){if(e!==null)for(var u,d,g,m,l,M,P,R=0,D=0,z,Z=e.type,W=Z==="FeatureCollection",J=Z==="Feature",me=W?e.features.length:1,xe=0;xe<me;xe++){P=W?e.features[xe].geometry:J?e.geometry:e,z=P?P.type==="GeometryCollection":!1,l=z?P.geometries.length:1;for(var Pe=0;Pe<l;Pe++){var oe=0,Le=0;if(m=z?P.geometries[Pe]:P,m!==null){M=m.coordinates;var Ze=m.type;switch(R=a&&(Ze==="Polygon"||Ze==="MultiPolygon")?1:0,Ze){case null:break;case"Point":if(r(M,D,xe,oe,Le)===!1)return!1;D++,oe++;break;case"LineString":case"MultiPoint":for(u=0;u<M.length;u++){if(r(M[u],D,xe,oe,Le)===!1)return!1;D++,Ze==="MultiPoint"&&oe++}Ze==="LineString"&&oe++;break;case"Polygon":case"MultiLineString":for(u=0;u<M.length;u++){for(d=0;d<M[u].length-R;d++){if(r(M[u][d],D,xe,oe,Le)===!1)return!1;D++}Ze==="MultiLineString"&&oe++,Ze==="Polygon"&&Le++}Ze==="Polygon"&&oe++;break;case"MultiPolygon":for(u=0;u<M.length;u++){for(Le=0,d=0;d<M[u].length;d++){for(g=0;g<M[u][d].length-R;g++){if(r(M[u][d][g],D,xe,oe,Le)===!1)return!1;D++}Le++}oe++}break;case"GeometryCollection":for(u=0;u<m.geometries.length;u++)if(Sm(m.geometries[u],r,a)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Zx(e,r){if(e.type==="Feature")r(e,0);else if(e.type==="FeatureCollection")for(var a=0;a<e.features.length&&r(e.features[a],a)!==!1;a++);}function vL(e,r){var a,u,d,g,m,l,M,P,R,D,z=0,Z=e.type==="FeatureCollection",W=e.type==="Feature",J=Z?e.features.length:1;for(a=0;a<J;a++){for(l=Z?e.features[a].geometry:W?e.geometry:e,P=Z?e.features[a].properties:W?e.properties:{},R=Z?e.features[a].bbox:W?e.bbox:void 0,D=Z?e.features[a].id:W?e.id:void 0,M=l?l.type==="GeometryCollection":!1,m=M?l.geometries.length:1,d=0;d<m;d++){if(g=M?l.geometries[d]:l,g===null){if(r(null,z,P,R,D)===!1)return!1;continue}switch(g.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(r(g,z,P,R,D)===!1)return!1;break}case"GeometryCollection":{for(u=0;u<g.geometries.length;u++)if(r(g.geometries[u],z,P,R,D)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}z++}}function xL(e,r,a){var u=a;return vL(e,function(d,g,m,l,M){g===0&&a===void 0?u=d:u=r(u,d,g,m,l,M)}),u}function bL(e){var r=[];return e.type==="FeatureCollection"?Zx(e,function(a){Sm(a,function(u){r.push(Lh(u,a.properties))})}):Sm(e,function(a){r.push(Lh(a,e.properties))}),hI(r)}function wL(e){if(!e)throw new Error("geojson is required");switch(e.type){case"Feature":return Wx(e);case"FeatureCollection":return ML(e);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return cg(e);default:throw new Error("unknown GeoJSON type")}}function Wx(e){var r={type:"Feature"};return Object.keys(e).forEach(function(a){switch(a){case"type":case"properties":case"geometry":return;default:r[a]=e[a]}}),r.properties=Xx(e.properties),r.geometry=cg(e.geometry),r}function Xx(e){var r={};return e&&Object.keys(e).forEach(function(a){var u=e[a];typeof u=="object"?u===null?r[a]=null:Array.isArray(u)?r[a]=u.map(function(d){return d}):r[a]=Xx(u):r[a]=u}),r}function ML(e){var r={type:"FeatureCollection"};return Object.keys(e).forEach(function(a){switch(a){case"type":case"features":return;default:r[a]=e[a]}}),r.features=e.features.map(function(a){return Wx(a)}),r}function cg(e){var r={type:e.type};return e.bbox&&(r.bbox=e.bbox),e.type==="GeometryCollection"?(r.geometries=e.geometries.map(function(a){return cg(a)}),r):(r.coordinates=Kx(e.coordinates),r)}function Kx(e){var r=e;return typeof r[0]!="object"?r.slice():r.map(function(a){return Kx(a)})}function SL(e,r){if(!e)throw new Error("targetPoint is required");if(!r)throw new Error("points is required");var a,u=1/0,d=0;return Zx(r,function(g,m){var l=fu(e,g);l<u&&(d=m,u=l)}),a=wL(r.features[d]),a.properties.featureIndex=d,a.properties.distanceToPoint=u,a}const EL=(e,r)=>{const a={};if(!r.options.params)return a;const u=Object.entries(r.options.params);(void 0).store.state;for(let[d,g]of u){let m;typeof g=="function"?m=g(e):m=g,a[d]=m}return a},Zf=(e,r)=>{const a=EL(e,r);r.url;const u=r.options,d=u.table,g=u.dateMinNum||null,m=u.dateMinType||null,l=u.dateField||null;u.success;const M=u.distances||250,P=u.groupby||null,R="ST_Distance(the_geom::geography, ST_SetSRID(ST_Point("+e.geometry.coordinates[0]+","+e.geometry.coordinates[1]+"),4326)::geography)",D="ST_Y(the_geom)",z="ST_X(the_geom)";let Z;P?Z=P+", the_geom":Z="*",Z=Z+", "+R+"as distance,"+D+"as lat, "+z+"as lng",a.q="select "+Z+" from "+d+" where "+R+" < "+M;let W;if(g){switch(m){case"hour":W=wC;break;case"day":W=nC;break;case"week":W=MC;break;case"month":W=bC;break;case"year":W=SC;break}a.q=a.q+" and "+l+" > '"+_m(W(new Date,g),"yyyy-MM-dd")+"'"}return P&&(a.q=a.q+" group by "+P+", the_geom"),a},Yx=Lo("NearbyActivityStore",{state:()=>({loadingData:!1,nearby311:{},nearbyCrimeIncidents:null,nearbyZoningAppeals:null,nearbyVacantIndicatorPoints:null,nearbyConstructionPermits:null,nearbyDemolitionPermits:null,nearbyImminentlyDangerous:null}),actions:{setLoadingData(e){this.loadingData=e},async fetchData(e){console.log("fetchData is runnning, dataType:",e),e==="nearby311"?await this.fillNearby311():e==="nearbyCrimeIncidents"?await this.fillNearbyCrimeIncidents():e==="nearbyZoningAppeals"?await this.fillNearbyZoningAppeals():e==="nearbyVacantIndicatorPoints"&&await this.fillNearbyVacantIndicatorPoints()},async fillNearby311(){const e=dn();this.setLoadingData(!0);const r=e.addressData.features[0];let a={url:"https://phl.carto.com/api/v2/sql?",options:{table:"public_cases_fc",dateMinNum:365,dateMinType:"day",dateField:"requested_datetime"}},u=Zf(r,a);const d=await or.get(a.url,{params:u});this.nearby311=d,this.setLoadingData(!1)},async fillNearbyCrimeIncidents(){const e=dn();this.setLoadingData(!0);const r=e.addressData.features[0];let a={url:"https://phl.carto.com/api/v2/sql?",options:{table:"incidents_part1_part2",dateMinNum:90,dateMinType:"day",dateField:"dispatch_date"}},u=Zf(r,a);const d=await or.get(a.url,{params:u});this.nearbyCrimeIncidents=d,this.setLoadingData(!1)},async fillNearbyZoningAppeals(){const e=dn();this.setLoadingData(!0);const r=e.addressData.features[0];let a={url:"https://phl.carto.com/api/v2/sql?",options:{table:"appeals",dateMinNum:1,dateMinType:"year",dateField:"scheduleddate"}},u=Zf(r,a);const d=await or.get(a.url,{params:u});this.nearbyZoningAppeals=d,this.setLoadingData(!1)},async fillNearbyVacantIndicatorPoints(){this.setLoadingData(!0);const r=ys().bufferForAddress,a="https://services.arcgis.com/fLeGjb7u4uXqeF9q/arcgis/rest/services/Vacant_Indicators_Points/FeatureServer/0/query?",u=r.geometries[0].rings[0];let d=[[parseFloat(u[0][0].toFixed(6)),parseFloat(u[0][1].toFixed(6))]];var g;for(g=0;g<u.length;g++)if(g%3==0){let Z=[parseFloat(u[g][0].toFixed(6)),parseFloat(u[g][1].toFixed(6))];d.push(Z)}d.push([parseFloat(u[0][0].toFixed(6)),parseFloat(u[0][1].toFixed(6))]);const m={returnGeometry:!0,where:"1=1",outSR:4326,outFields:"*",inSr:4326,geometryType:"esriGeometryPolygon",spatialRel:"esriSpatialRelContains",f:"geojson",geometry:JSON.stringify({rings:[d],spatialReference:{wkid:4326}})};let P=(await(await or.get(a,{params:m})).data||{}).features;const D=dn().addressData.features[0],z=Lh(D.geometry.coordinates);P=P.map(Z=>{const W=Z.geometry.coordinates;let J;if(Array.isArray(W[0])){let xe;Z.geometry.type==="LineString"?xe=uI([W[0],W[1]],{name:"line 1"}):xe=ig([W[0]]);const Pe=bL(xe),oe=SL(z,Pe);J=fu(z,oe,{units:"miles"})}else{const xe=Lh(W);J=fu(z,xe,{units:"miles"})}const me=parseInt(J*5280);return Z._distance=me,Z}),this.nearbyVacantIndicatorPoints=P,this.setLoadingData(!1)}}}),Fs=e=>(Nh("data-v-660430e9"),e=e(),$h(),e),TL=Fs(()=>Y("div",{class:"box"}," See recent activity near your search address including 311 service requests, crimes, zoning appeals, and more. Hover over a record below to highlight it on the map. ",-1)),CL=Fs(()=>Y("div",{class:"dropdown-trigger"},[Y("button",{class:"button","aria-haspopup":"true","aria-controls":"dropdown-menu"},[Y("span",null,"What nearby activity would you like to see?"),Y("span",{class:"icon is-small"},[Y("i",{class:"fas fa-angle-down","aria-hidden":"true"})])])],-1)),IL={class:"dropdown-menu",id:"dropdown-menu",role:"menu"},AL={class:"dropdown-content"},PL=Fs(()=>Y("br",null,null,-1)),DL=Fs(()=>Y("div",{class:"dropdown-trigger"},[Y("button",{class:"button","aria-haspopup":"true","aria-controls":"dropdown-menu"},[Y("span",null,"From"),Y("span",{class:"icon is-small"},[Y("i",{class:"fas fa-angle-down","aria-hidden":"true"})])])],-1)),kL={class:"dropdown-menu",id:"dropdown-menu",role:"menu"},LL={class:"dropdown-content"},RL=["onClick"],zL=Fs(()=>Y("div",{class:"dropdown-trigger"},[Y("button",{class:"button","aria-haspopup":"true","aria-controls":"dropdown-menu"},[Y("span",null,"Sort by"),Y("span",{class:"icon is-small"},[Y("i",{class:"fas fa-angle-down","aria-hidden":"true"})])])],-1)),OL={class:"dropdown-menu",id:"dropdown-menu",role:"menu"},FL={class:"dropdown-content"},BL=Fs(()=>Y("br",null,null,-1)),NL={key:0,class:"mt-5"},$L=Fs(()=>Y("h5",{class:"subtitle is-5"},"311 Requests",-1)),UL={key:0},VL={class:"table is-fullwidth is-striped"},jL=Fs(()=>Y("thead",null,[Y("tr",null,[Y("th",null,"Date"),Y("th",null,"Location"),Y("th",null,"Type"),Y("th",null,"Distance")])],-1)),qL=["id"],GL={key:1,class:"mt-5"},HL=Fs(()=>Y("h5",{class:"subtitle is-5"},"Crime Incidents",-1)),ZL={key:0},WL={class:"table is-fullwidth is-striped"},XL=Fs(()=>Y("thead",null,[Y("tr",null,[Y("th",null,"Date"),Y("th",null,"Location"),Y("th",null,"Description"),Y("th",null,"Distance")])],-1)),KL=["id"],YL={key:2,class:"mt-5"},JL=Fs(()=>Y("h5",{class:"subtitle is-5"},"Zoning Appeals",-1)),QL={key:0},eR={class:"table is-fullwidth is-striped"},tR=Fs(()=>Y("thead",null,[Y("tr",null,[Y("th",null,"Date"),Y("th",null,"Location"),Y("th",null,"Description"),Y("th",null,"Distance")])],-1)),iR=["id"],rR={key:3,class:"mt-5"},nR=Fs(()=>Y("h5",{class:"subtitle is-5"},"Likely Vacant Properties",-1)),sR={key:0},aR={class:"table is-fullwidth is-striped"},oR=Fs(()=>Y("thead",null,[Y("tr",null,[Y("th",null,"Address"),Y("th",null,"Property Type"),Y("th",null,"Distance")])],-1)),lR=["id"],cR={__name:"NearbyActivity",setup(e){console.log("Nearby.vue setup");const r=Yx(),a=Js(),d=ys().map,{currency:g,date:m}=eg(),l=qh(),M=jh(),P=(at,tt,Je)=>new Date(tt[Je])-new Date(at[Je]),R={nearby311:"311 Requests",nearbyCrimeIncidents:"Crime Incidents",nearbyZoningAppeals:"Zoning Appeals",nearbyVacantIndicatorPoints:"Vacant Properties",nearbyConstructionPermits:"Construction Permits",nearbyDemolitionPermits:"Demolition Permits",nearbyImminentlyDangerous:"Imminently Dangerous"},D=ks(!1),z=()=>D.value=!D.value,Z=gi(()=>a.currentNearbyDataType),W=gi(()=>r.loadingData),J=at=>{M.push({name:"address-topic-and-data",params:{address:a.currentAddress,topic:l.params.topic,data:at}})};rs(()=>l.params.data,async at=>{at&&(a.setCurrentNearbyDataType(at),await me(at))});const me=async at=>{r[at]===null&&(console.log("fetching new data"),await r.fetchData(at)),Pt(Ht[at].values[0])},xe=ks(!1),Pe=()=>xe.value=!xe.value,oe=ks("distance"),Le=at=>{oe.value=at},Ze=ks(!1),Ke=()=>Ze.value=!Ze.value,dt=ks(null);Uh(()=>{dt.value=Ht[Z.value].values[0]});const bt=gi(()=>Ht[Z.value].labels[Ht[Z.value].values.indexOf(dt.value)]),Pt=at=>{dt.value=at},Ht={nearby311:{labels:["the last 30 days","the last 90 days","1 year"],values:[30,90,365]},nearbyCrimeIncidents:{labels:["the last 30 days","the last 90 days"],values:[30,90]},nearbyZoningAppeals:{labels:["any time","the last 90 days","the next 90 days"],values:[0,-90,90]},nearbyVacantIndicatorPoints:{labels:[],values:[]},nearbyConstructionPermits:{labels:["the last 30 days","the last 90 days","1 year"],values:[30,90,365]},nearbyDemolitionPermits:{labels:["the last 30 days","the last 90 days","1 year"],values:[30,90,365]},nearbyImminentlyDangerous:{labels:["the last 30 days","the last 90 days","1 year"],values:[30,90,365]}},Rt=gi(()=>{if(r.nearby311){let at=[...r.nearby311.data.rows].filter(tt=>{let Je=new Date(tt.requested_datetime);return(new Date-Je)/(1e3*60*60*24)<=dt.value});return oe.value==="distance"?at.sort((tt,Je)=>tt.distance-Je.distance):oe.value==="time"&&at.sort((tt,Je)=>P(tt,Je,"requested_datetime")),at}}),li=gi(()=>{let at=[];if(!Rt.value)return at;for(let tt of Rt.value)at.push({type:"Feature",geometry:{type:"Point",coordinates:[tt.lng,tt.lat]},properties:{id:tt.service_request_id,type:"nearby311"}});return at});rs(()=>li.value,at=>{if(console.log("nearby311Geojson watch, newGeojson:",at),at.length>0){console.log("$config:",mn,"map.getStyle().sources:",d.getStyle().sources,"map.getStyle().layers:",d.getStyle().layers);let tt={type:"FeatureCollection",features:at};console.log("geojson:",tt,"map.getSource(nearby):",d.getSource("nearby")),d.getSource("nearby").setData(tt)}});const ct=gi(()=>{if(r.nearbyCrimeIncidents){let at=[...r.nearbyCrimeIncidents.data.rows].filter(tt=>{let Je=new Date(tt.dispatch_date);return(new Date-Je)/(1e3*60*60*24)<=dt.value});return oe.value==="distance"?at.sort((tt,Je)=>tt.distance-Je.distance):oe.value==="time"&&at.sort((tt,Je)=>P(tt,Je,"dispatch_date")),at}}),zt=gi(()=>{let at=[];if(!ct.value)return at;for(let tt of ct.value)at.push({type:"Feature",geometry:{type:"Point",coordinates:[tt.lng,tt.lat]},properties:{id:tt.objectid,type:"nearbyCrimeIncidents"}});return at});rs(()=>zt.value,async at=>{if(console.log("nearbyCrimeIncidents watch, newGeojson:",at),at.length>0){console.log("$config:",mn,"map.getStyle().sources:",d.getStyle().sources,"map.getStyle().layers:",d.getStyle().layers);let tt={type:"FeatureCollection",features:at};await d.getSource("nearby").setData(tt)}});const Bi=gi(()=>{if(r.nearbyZoningAppeals){let at=[...r.nearbyZoningAppeals.data.rows];return console.log(new Date(at[0].scheduleddate)),dt.value<0?at=at.filter(tt=>{let Je=new Date(tt.scheduleddate);return(new Date-Je)/(1e3*60*60*24)>=dt.value}):dt.value>0&&(at=at.filter(tt=>{let Je=new Date(tt.scheduleddate);return(new Date-Je)/(1e3*60*60*24)<=dt.value})),oe.value==="distance"?at.sort((tt,Je)=>tt.distance-Je.distance):oe.value==="time"&&at.sort((tt,Je)=>P(tt,Je,"dispatch_date")),at}}),ti=gi(()=>{if(r.nearbyVacantIndicatorPoints){let at=[...r.nearbyVacantIndicatorPoints];return oe.value==="distance"?at.sort((tt,Je)=>tt._distance-Je._distance):oe.value==="type"&&at.sort((tt,Je)=>tt.distance-Je.distance),at}}),ii=gi(()=>a.hoveredStateId),hi=at=>{const tt=at.getBoundingClientRect(),Je={top:tt.top>=108,left:tt.left>=0,bottom:tt.bottom<=(window.innerHeight||document.documentElement.clientHeight),right:tt.right<=(window.innerWidth||document.documentElement.clientWidth)};return Object.values(Je).every(nr=>nr)};rs(()=>ii.value,at=>{if(console.log("hoveredStateId watch, newHoveredStateId:",at),at){const tt=document.getElementById(at);hi(tt)||tt.scrollIntoView({block:"center"})}});const Mi=at=>{console.log("handleRowMouseover, e.target.parentElement.id:",at.target.parentElement.id),a.hoveredStateId=parseInt(at.target.parentElement.id)},yr=at=>{console.log("handleRowMouseleave, e.target.id:",at.target.id),a.hoveredStateId=""};return(at,tt)=>(It(),Ot("section",null,[TL,Y("div",{class:is(D.value?"dropdown is-active":"dropdown"),onClick:z},[CL,Y("div",IL,[Y("div",AL,[Y("a",{class:"dropdown-item",onClick:tt[0]||(tt[0]=Je=>J("nearby311"))},"311 Requests"),Y("a",{class:"dropdown-item",onClick:tt[1]||(tt[1]=Je=>J("nearbyCrimeIncidents"))},"Crime Incidents"),Y("a",{class:"dropdown-item",onClick:tt[2]||(tt[2]=Je=>J("nearbyZoningAppeals"))},"Zoning Appeals"),Y("a",{class:"dropdown-item",onClick:tt[3]||(tt[3]=Je=>J("nearbyVacantIndicatorPoints"))},"Vacant Properties"),Y("a",{class:"dropdown-item",onClick:tt[4]||(tt[4]=Je=>J("nearbyConstructionPermits"))},"Construction Permits"),Y("a",{class:"dropdown-item",onClick:tt[5]||(tt[5]=Je=>J("nearbyDemolitionPermits"))},"Demolition Permits"),Y("a",{class:"dropdown-item",onClick:tt[6]||(tt[6]=Je=>J("nearbyImminentlyDangerous"))},"Imminently Dangerous")])])],2),Y("span",null,qt(R[Z.value]),1),PL,Y("div",{class:is(Ze.value?"dropdown is-active":"dropdown"),onClick:Ke},[DL,Y("div",kL,[Y("div",LL,[(It(!0),Ot(Mr,null,Ls(Ht[Z.value].values,(Je,nr)=>(It(),Ot("a",{class:"dropdown-item",onClick:Zi=>Pt(Je)},qt(Ht[Z.value].labels[nr]),9,RL))),256))])])],2),Y("span",null,qt(bt.value),1),Y("div",{class:is(xe.value?"dropdown is-active":"dropdown"),onClick:Pe},[zL,Y("div",OL,[Y("div",FL,[Y("a",{class:"dropdown-item",onClick:tt[7]||(tt[7]=Je=>Le("distance"))},"distance"),Y("a",{class:"dropdown-item",onClick:tt[8]||(tt[8]=Je=>Le("time"))},"time")])])],2),Y("span",null,qt(oe.value),1),BL,Z.value=="nearby311"?(It(),Ot("div",NL,[$L,W.value?(It(),Ot("div",UL,"Loading...")):Gi("",!0),Y("table",VL,[jL,Y("tbody",null,[(It(!0),Ot(Mr,null,Ls(Rt.value,Je=>(It(),Ot("tr",{key:Je.service_request_id,id:Je.service_request_id,onMouseover:Mi,onMouseleave:yr,class:is(ii.value==Je.service_request_id?"active":"inactive")},[Y("td",null,qt(Fi(m)(Je.requested_datetime)),1),Y("td",null,qt(Je.address),1),Y("td",null,qt(Je.service_name),1),Y("td",null,qt((Je.distance*3.28084).toFixed(0))+" ft",1)],42,qL))),128))])])])):Gi("",!0),Z.value=="nearbyCrimeIncidents"?(It(),Ot("div",GL,[HL,W.value?(It(),Ot("div",ZL,"Loading...")):Gi("",!0),Y("table",WL,[XL,Y("tbody",null,[(It(!0),Ot(Mr,null,Ls(ct.value,Je=>(It(),Ot("tr",{key:Je.objectid,id:Je.objectid,onMouseover:Mi,onMouseleave:yr,class:is(ii.value==Je.objectid?"active":"inactive")},[Y("td",null,qt(Je.dispatch_date),1),Y("td",null,qt(Je.location_block),1),Y("td",null,qt(Je.text_general_code),1),Y("td",null,qt((Je.distance*3.28084).toFixed(0))+" ft",1)],42,KL))),128))])])])):Gi("",!0),Z.value=="nearbyZoningAppeals"?(It(),Ot("div",YL,[JL,W.value?(It(),Ot("div",QL,"Loading...")):Gi("",!0),Y("table",eR,[tR,Y("tbody",null,[(It(!0),Ot(Mr,null,Ls(Bi.value,Je=>(It(),Ot("tr",{key:Je.objectid,id:Je.objectid,onMouseover:Mi,onMouseleave:yr,class:is(ii.value==Je.objectid?"active":"inactive")},[Y("td",null,qt(Je.scheduleddate),1),Y("td",null,qt(Je.address),1),Y("td",null,qt(Je.appeal_grounds),1),Y("td",null,qt((Je.distance*3.28084).toFixed(0))+" ft",1)],42,iR))),128))])])])):Gi("",!0),Z.value=="nearbyVacantIndicatorPoints"?(It(),Ot("div",rR,[nR,W.value?(It(),Ot("div",sR,"Loading...")):Gi("",!0),Y("table",aR,[oR,Y("tbody",null,[(It(!0),Ot(Mr,null,Ls(ti.value,Je=>(It(),Ot("tr",{key:Je.OBJECTID,id:Je.OBJECTID,onMouseover:Mi,onMouseleave:yr,class:is(ii.value==Je.OBJECTID?"active":"inactive")},[Y("td",null,qt(Je.properties.ADDRESS),1),Y("td",null,qt(Je.properties.VACANT_FLAG),1),Y("td",null,qt((Je._distance*3.28084).toFixed(0))+" ft",1)],42,lR))),128))])])])):Gi("",!0)]))}},uR=Qs(cR,[["__scopeId","data-v-660430e9"]]),hR=e=>(Nh("data-v-8b6a956f"),e=e(),$h(),e),dR={key:0,class:"columns"},pR=A2('<div class="column is-12" data-v-8b6a956f><h3 class="subtitle is-3" data-v-8b6a956f>Atlas is your front door to the City of Philadelphia.</h3><p class="subtitle is-5" data-v-8b6a956f>Here are some things you can do with Atlas:</p><ul data-v-8b6a956f><li data-v-8b6a956f>Find your polling place</li><li data-v-8b6a956f>Get the history of permits, licenses, and inspections at any address</li><li data-v-8b6a956f>Research real estate information including property values, zoning, and document archives</li><li data-v-8b6a956f>Get easy access to a variety of hard-to-find City resources</li><li data-v-8b6a956f>View recent activity around your address, such as crimes, 311 service requests, and more</li><li data-v-8b6a956f>Explore historical imagery and maps</li></ul><p data-v-8b6a956f>To get started, click anywhere on the map, or type an address, intersection, property assessment account number, or Department of Records Map Registry number into the search box.</p></div>',1),fR=[pR],mR={key:1,class:"columns"},gR=hR(()=>Y("div",{class:"column is-12"},[Y("p",null,"We couldn't find that address. Are you sure everything was spelled correctly?"),Y("p",null,"Here are some examples of things you can search for:"),Y("ul",null,[Y("li",null,"1234 Market St"),Y("li",null,"1001 Pine Street #201"),Y("li",null,"12th & Market"),Y("li",null,"12th & Market"),Y("li",null,"883309050 (an OPA number with no hyphens or other characters)")])],-1)),yR=[gR],_R={key:2},vR={class:"columns"},xR={class:"column is-12"},bR={class:"subtitle is-3"},wR={class:"topics pr-4"},MR={__name:"TopicPanel",setup(e){const r=Js(),a=zp(),u=qh(),d=gi(()=>r.currentAddress),g=gi(()=>r.dataSourcesLoadedArray);return(m,l)=>(It(),Ot("section",null,[Fi(u).name=="home"?(It(),Ot("div",dR,fR)):Gi("",!0),Fi(u).name=="not-found"?(It(),Ot("div",mR,yR)):Gi("",!0),d.value?(It(),Ot("div",_R,[Y("div",vR,[Y("div",xR,[Y("h3",bR,qt(d.value),1)])]),Y("div",wR,[rr(ic,{"topic-name":"Property",loading:!g.value.includes("Property")},{default:Ao(()=>[g.value.includes("Property")?(It(),da(QC,{key:0})):Gi("",!0)]),_:1},8,["loading"]),lv(rr(ic,{"topic-name":"Condominiums",loading:!g.value.includes("Condominiums")},{default:Ao(()=>[g.value.includes("Condominiums")?(It(),da(nI,{key:0})):Gi("",!0)]),_:1},8,["loading"]),[[H2,Fi(a).condosData.length>0]]),rr(ic,{"topic-name":"Deeds",loading:!g.value.includes("Deeds")},{default:Ao(()=>[g.value.includes("Deeds")?(It(),da(z3,{key:0})):Gi("",!0)]),_:1},8,["loading"]),rr(ic,{"topic-name":"Licenses & Inspections",loading:!g.value.includes("Licenses & Inspections")},{default:Ao(()=>[g.value.includes("Licenses & Inspections")?(It(),da(dL,{key:0})):Gi("",!0)]),_:1},8,["loading"]),rr(ic,{"topic-name":"Zoning",loading:!g.value.includes("Zoning")},{default:Ao(()=>[g.value.includes("Zoning")?(It(),da(mL,{key:0})):Gi("",!0)]),_:1},8,["loading"]),rr(ic,{"topic-name":"Voting",loading:!g.value.includes("Voting")},{default:Ao(()=>[g.value.includes("Voting")?(It(),da(_L,{key:0})):Gi("",!0)]),_:1},8,["loading"]),rr(ic,{"topic-name":"Nearby Activity",loading:!g.value.includes("Nearby Activity")},{default:Ao(()=>[g.value.includes("Nearby Activity")?(It(),da(uR,{key:0})):Gi("",!0)]),_:1},8,["loading"])])])):Gi("",!0)]))}},SR=Qs(MR,[["__scopeId","data-v-8b6a956f"]]);var Jx={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.3/LICENSE.txt
 */(function(e,r){(function(a,u){e.exports=u()})(Zc,function(){var a={},u={};function d(m,l,M){if(u[m]=M,m==="index"){var P="var sharedModule = {}; ("+u.shared+")(sharedModule); ("+u.worker+")(sharedModule);",R={};return u.shared(R),u.index(a,R),typeof window<"u"&&a.setWorkerUrl(window.URL.createObjectURL(new Blob([P],{type:"text/javascript"}))),a}}d("shared",["exports"],function(m){function l(n,t,s,c){return new(s||(s=Promise))(function(f,v){function x(I){try{T(c.next(I))}catch(L){v(L)}}function w(I){try{T(c.throw(I))}catch(L){v(L)}}function T(I){var L;I.done?f(I.value):(L=I.value,L instanceof s?L:new s(function(O){O(L)})).then(x,w)}T((c=c.apply(n,t||[])).next())})}function M(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}typeof SuppressedError=="function"&&SuppressedError;var P=R;function R(n,t){this.x=n,this.y=t}R.prototype={clone:function(){return new R(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,t){return this.clone()._rotateAround(n,t)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var t=n.x-this.x,s=n.y-this.y;return t*t+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,t){return Math.atan2(this.x*t-this.y*n,this.x*n+this.y*t)},_matMult:function(n){var t=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=t,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var t=Math.cos(n),s=Math.sin(n),c=s*this.x+t*this.y;return this.x=t*this.x-s*this.y,this.y=c,this},_rotateAround:function(n,t){var s=Math.cos(n),c=Math.sin(n),f=t.y+c*(this.x-t.x)+s*(this.y-t.y);return this.x=t.x+s*(this.x-t.x)-c*(this.y-t.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},R.convert=function(n){return n instanceof R?n:Array.isArray(n)?new R(n[0],n[1]):n};var D=M(P),z=Z;function Z(n,t,s,c){this.cx=3*n,this.bx=3*(s-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(c-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=t,this.p2x=s,this.p2y=c}Z.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,t){if(t===void 0&&(t=1e-6),n<0)return 0;if(n>1)return 1;for(var s=n,c=0;c<8;c++){var f=this.sampleCurveX(s)-n;if(Math.abs(f)<t)return s;var v=this.sampleCurveDerivativeX(s);if(Math.abs(v)<1e-6)break;s-=f/v}var x=0,w=1;for(s=n,c=0;c<20&&(f=this.sampleCurveX(s),!(Math.abs(f-n)<t));c++)n>f?x=s:w=s,s=.5*(w-x)+x;return s},solve:function(n,t){return this.sampleCurveY(this.solveCurveX(n,t))}};var W=M(z);let J,me;function xe(){return J==null&&(J=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),J}function Pe(){if(me==null&&(me=!1,xe())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let c=0;c<5*5;c++){const f=4*c;t.fillStyle=`rgb(${f},${f+1},${f+2})`,t.fillRect(c%5,Math.floor(c/5),1,1)}const s=t.getImageData(0,0,5,5).data;for(let c=0;c<5*5*4;c++)if(c%4!=3&&s[c]!==c){me=!0;break}}}return me||!1}function oe(n,t,s,c){const f=new W(n,t,s,c);return function(v){return f.solve(v)}}const Le=oe(.25,.1,.25,1);function Ze(n,t,s){return Math.min(s,Math.max(t,n))}function Ke(n,t,s){const c=s-t,f=((n-t)%c+c)%c+t;return f===t?s:f}function dt(n,...t){for(const s of t)for(const c in s)n[c]=s[c];return n}let bt=1;function Pt(n,t,s){const c={};for(const f in n)c[f]=t.call(s||this,n[f],f,n);return c}function Ht(n,t,s){const c={};for(const f in n)t.call(s||this,n[f],f,n)&&(c[f]=n[f]);return c}function Rt(n){return Array.isArray(n)?n.map(Rt):typeof n=="object"&&n?Pt(n,Rt):n}const li={};function ct(n){li[n]||(typeof console<"u"&&console.warn(n),li[n]=!0)}function zt(n,t,s){return(s.y-n.y)*(t.x-n.x)>(t.y-n.y)*(s.x-n.x)}function Bi(n){let t=0;for(let s,c,f=0,v=n.length,x=v-1;f<v;x=f++)s=n[f],c=n[x],t+=(c.x-s.x)*(s.y+c.y);return t}function ti(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let ii=null;function hi(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const Mi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function yr(n,t,s,c,f){return l(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const v=new VideoFrame(n,{timestamp:0});try{const x=v==null?void 0:v.format;if(!x||!x.startsWith("BGR")&&!x.startsWith("RGB"))throw new Error(`Unrecognized format ${x}`);const w=x.startsWith("BGR"),T=new Uint8ClampedArray(c*f*4);if(yield v.copyTo(T,function(I,L,O,$,j){const G=4*Math.max(-L,0),K=(Math.max(0,O)-O)*$*4+G,re=4*$,he=Math.max(0,L),Te=Math.max(0,O);return{rect:{x:he,y:Te,width:Math.min(I.width,L+$)-he,height:Math.min(I.height,O+j)-Te},layout:[{offset:K,stride:re}]}}(n,t,s,c,f)),w)for(let I=0;I<T.length;I+=4){const L=T[I];T[I]=T[I+2],T[I+2]=L}return T}finally{v.close()}})}let at,tt;const Je="AbortError";function nr(){return new Error(Je)}const Zi={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Si(n){return Zi.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const Ve="global-dispatcher";class Et extends Error{constructor(t,s,c,f){super(`AJAXError: ${s} (${t}): ${c}`),this.status=t,this.statusText=s,this.url=c,this.body=f}}const ut=()=>ti(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Qe=function(n,t){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const c=Si(n.url);if(c)return c(n,t);if(ti(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:Ve},t)}if(!(/^file:/.test(s=n.url)||/^file:/.test(ut())&&!/^\w+:/.test(s))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(c,f){return l(this,void 0,void 0,function*(){const v=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,cache:c.cache,referrer:ut(),signal:f.signal});c.type==="json"&&v.headers.set("Accept","application/json");const x=yield fetch(v);if(!x.ok){const I=yield x.blob();throw new Et(x.status,x.statusText,c.url,I)}let w;w=c.type==="arrayBuffer"||c.type==="image"?x.arrayBuffer():c.type==="json"?x.json():x.text();const T=yield w;if(f.signal.aborted)throw nr();return{data:T,cacheControl:x.headers.get("Cache-Control"),expires:x.headers.get("Expires")}})}(n,t);if(ti(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:Ve},t)}var s;return function(c,f){return new Promise((v,x)=>{const w=new XMLHttpRequest;w.open(c.method||"GET",c.url,!0),c.type!=="arrayBuffer"&&c.type!=="image"||(w.responseType="arraybuffer");for(const T in c.headers)w.setRequestHeader(T,c.headers[T]);c.type==="json"&&(w.responseType="text",w.setRequestHeader("Accept","application/json")),w.withCredentials=c.credentials==="include",w.onerror=()=>{x(new Error(w.statusText))},w.onload=()=>{if(!f.signal.aborted)if((w.status>=200&&w.status<300||w.status===0)&&w.response!==null){let T=w.response;if(c.type==="json")try{T=JSON.parse(w.response)}catch(I){return void x(I)}v({data:T,cacheControl:w.getResponseHeader("Cache-Control"),expires:w.getResponseHeader("Expires")})}else{const T=new Blob([w.response],{type:w.getResponseHeader("Content-Type")});x(new Et(w.status,w.statusText,c.url,T))}},f.signal.addEventListener("abort",()=>{w.abort(),x(nr())}),w.send(c.body)})}(n,t)};function Di(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const t=new URL(n),s=window.location;return t.protocol===s.protocol&&t.host===s.host}function zi(n,t,s){s[n]&&s[n].indexOf(t)!==-1||(s[n]=s[n]||[],s[n].push(t))}function se(n,t,s){if(s&&s[n]){const c=s[n].indexOf(t);c!==-1&&s[n].splice(c,1)}}class ue{constructor(t,s={}){dt(this,s),this.type=t}}class De extends ue{constructor(t,s={}){super("error",dt({error:t},s))}}class Fe{on(t,s){return this._listeners=this._listeners||{},zi(t,s,this._listeners),this}off(t,s){return se(t,s,this._listeners),se(t,s,this._oneTimeListeners),this}once(t,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},zi(t,s,this._oneTimeListeners),this):new Promise(c=>this.once(t,c))}fire(t,s){typeof t=="string"&&(t=new ue(t,s||{}));const c=t.type;if(this.listens(c)){t.target=this;const f=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const w of f)w.call(this,t);const v=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const w of v)se(c,w,this._oneTimeListeners),w.call(this,t);const x=this._eventedParent;x&&(dt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(t))}else t instanceof De&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,s){return this._eventedParent=t,this._eventedParentData=s,this}}var ce={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const pt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function At(n,t){const s={};for(const c in n)c!=="ref"&&(s[c]=n[c]);return pt.forEach(c=>{c in t&&(s[c]=t[c])}),s}function Be(n,t){if(Array.isArray(n)){if(!Array.isArray(t)||n.length!==t.length)return!1;for(let s=0;s<n.length;s++)if(!Be(n[s],t[s]))return!1;return!0}if(typeof n=="object"&&n!==null&&t!==null){if(typeof t!="object"||Object.keys(n).length!==Object.keys(t).length)return!1;for(const s in n)if(!Be(n[s],t[s]))return!1;return!0}return n===t}function rt(n,t){n.push(t)}function it(n,t,s){rt(s,{command:"addSource",args:[n,t[n]]})}function Dt(n,t,s){rt(t,{command:"removeSource",args:[n]}),s[n]=!0}function Xt(n,t,s,c){Dt(n,s,c),it(n,t,s)}function Zt(n,t,s){let c;for(c in n[s])if(Object.prototype.hasOwnProperty.call(n[s],c)&&c!=="data"&&!Be(n[s][c],t[s][c]))return!1;for(c in t[s])if(Object.prototype.hasOwnProperty.call(t[s],c)&&c!=="data"&&!Be(n[s][c],t[s][c]))return!1;return!0}function Yt(n,t,s,c,f,v){n=n||{},t=t||{};for(const x in n)Object.prototype.hasOwnProperty.call(n,x)&&(Be(n[x],t[x])||s.push({command:v,args:[c,x,t[x],f]}));for(const x in t)Object.prototype.hasOwnProperty.call(t,x)&&!Object.prototype.hasOwnProperty.call(n,x)&&(Be(n[x],t[x])||s.push({command:v,args:[c,x,t[x],f]}))}function yi(n){return n.id}function Ti(n,t){return n[t.id]=t,n}class Ue{constructor(t,s,c,f){this.message=(t?`${t}: `:"")+c,f&&(this.identifier=f),s!=null&&s.__line__&&(this.line=s.__line__)}}function Ni(n,...t){for(const s of t)for(const c in s)n[c]=s[c];return n}class Yi extends Error{constructor(t,s){super(s),this.message=s,this.key=t}}class gn{constructor(t,s=[]){this.parent=t,this.bindings={};for(const[c,f]of s)this.bindings[c]=f}concat(t){return new gn(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Sr={kind:"null"},nt={kind:"number"},ci={kind:"string"},Nt={kind:"boolean"},ji={kind:"color"},yn={kind:"object"},ri={kind:"value"},ea={kind:"collator"},Er={kind:"formatted"},te={kind:"padding"},N={kind:"resolvedImage"},U={kind:"variableAnchorOffsetCollection"};function H(n,t){return{kind:"array",itemType:n,N:t}}function Q(n){if(n.kind==="array"){const t=Q(n.itemType);return typeof n.N=="number"?`array<${t}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${t}>`}return n.kind}const _e=[Sr,nt,ci,Nt,ji,Er,yn,H(ri),te,N,U];function ve(n,t){if(t.kind==="error")return null;if(n.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!ve(n.itemType,t.itemType))&&(typeof n.N!="number"||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if(n.kind==="value"){for(const s of _e)if(!ve(s,t))return null}}return`Expected ${Q(n)} but found ${Q(t)} instead.`}function Me(n,t){return t.some(s=>s.kind===n.kind)}function de(n,t){return t.some(s=>s==="null"?n===null:s==="array"?Array.isArray(n):s==="object"?n&&!Array.isArray(n)&&typeof n=="object":s===typeof n)}function Ce(n,t){return n.kind==="array"&&t.kind==="array"?n.itemType.kind===t.itemType.kind&&typeof n.N=="number":n.kind===t.kind}const qe=.96422,ze=.82521,Ne=4/29,$t=6/29,Gt=3*$t*$t,ni=$t*$t*$t,si=Math.PI/180,vi=180/Math.PI;function Ui(n){return(n%=360)<0&&(n+=360),n}function lr([n,t,s,c]){let f,v;const x=Kt((.2225045*(n=Br(n))+.7168786*(t=Br(t))+.0606169*(s=Br(s)))/1);n===t&&t===s?f=v=x:(f=Kt((.4360747*n+.3850649*t+.1430804*s)/qe),v=Kt((.0139322*n+.0971045*t+.7141733*s)/ze));const w=116*x-16;return[w<0?0:w,500*(f-x),200*(x-v),c]}function Br(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Kt(n){return n>ni?Math.pow(n,1/3):n/Gt+Ne}function _r([n,t,s,c]){let f=(n+16)/116,v=isNaN(t)?f:f+t/500,x=isNaN(s)?f:f-s/200;return f=1*_n(f),v=qe*_n(v),x=ze*_n(x),[Vr(3.1338561*v-1.6168667*f-.4906146*x),Vr(-.9787684*v+1.9161415*f+.033454*x),Vr(.0719453*v-.2289914*f+1.4052427*x),c]}function Vr(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function _n(n){return n>$t?n*n*n:Gt*(n-Ne)}function vn(n){return parseInt(n.padEnd(2,n),16)/255}function Zr(n,t){return qn(t?n/100:n,0,1)}function qn(n,t,s){return Math.min(Math.max(t,n),s)}function fc(n){return!n.some(Number.isNaN)}const zo={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Vi{constructor(t,s,c,f=1,v=!0){this.r=t,this.g=s,this.b=c,this.a=f,v||(this.r*=f,this.g*=f,this.b*=f,f||this.overwriteGetter("rgb",[t,s,c,f]))}static parse(t){if(t instanceof Vi)return t;if(typeof t!="string")return;const s=function(c){if((c=c.toLowerCase().trim())==="transparent")return[0,0,0,0];const f=zo[c];if(f){const[x,w,T]=f;return[x/255,w/255,T/255,1]}if(c.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(c)){const x=c.length<6?1:2;let w=1;return[vn(c.slice(w,w+=x)),vn(c.slice(w,w+=x)),vn(c.slice(w,w+=x)),vn(c.slice(w,w+x)||"ff")]}if(c.startsWith("rgb")){const x=c.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[w,T,I,L,O,$,j,G,K,re,he,Te]=x,pe=[L||" ",j||" ",re].join("");if(pe==="  "||pe==="  /"||pe===",,"||pe===",,,"){const be=[I,$,K].join(""),$e=be==="%%%"?100:be===""?255:0;if($e){const Ge=[qn(+T/$e,0,1),qn(+O/$e,0,1),qn(+G/$e,0,1),he?Zr(+he,Te):1];if(fc(Ge))return Ge}}return}}const v=c.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[x,w,T,I,L,O,$,j,G]=v,K=[T||" ",L||" ",$].join("");if(K==="  "||K==="  /"||K===",,"||K===",,,"){const re=[+w,qn(+I,0,100),qn(+O,0,100),j?Zr(+j,G):1];if(fc(re))return function([he,Te,pe,be]){function $e(Ge){const Ct=(Ge+he/30)%12,Bt=Te*Math.min(pe,1-pe);return pe-Bt*Math.max(-1,Math.min(Ct-3,9-Ct,1))}return he=Ui(he),Te/=100,pe/=100,[$e(0),$e(8),$e(4),be]}(re)}}}(t);return s?new Vi(...s,!1):void 0}get rgb(){const{r:t,g:s,b:c,a:f}=this,v=f||1/0;return this.overwriteGetter("rgb",[t/v,s/v,c/v,f])}get hcl(){return this.overwriteGetter("hcl",function(t){const[s,c,f,v]=lr(t),x=Math.sqrt(c*c+f*f);return[Math.round(1e4*x)?Ui(Math.atan2(f,c)*vi):NaN,x,s,v]}(this.rgb))}get lab(){return this.overwriteGetter("lab",lr(this.rgb))}overwriteGetter(t,s){return Object.defineProperty(this,t,{value:s}),s}toString(){const[t,s,c,f]=this.rgb;return`rgba(${[t,s,c].map(v=>Math.round(255*v)).join(",")},${f})`}}Vi.black=new Vi(0,0,0,1),Vi.white=new Vi(1,1,1,1),Vi.transparent=new Vi(0,0,0,0),Vi.red=new Vi(1,0,0,1);class lo{constructor(t,s,c){this.sensitivity=t?s?"variant":"case":s?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,s){return this.collator.compare(t,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Dr{constructor(t,s,c,f,v){this.text=t,this.image=s,this.scale=c,this.fontStack=f,this.textColor=v}}class Dn{constructor(t){this.sections=t}static fromString(t){return new Dn([new Dr(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Dn?t:Dn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class xn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof xn)return t;if(typeof t=="number")return new xn([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const s of t)if(typeof s!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new xn(t)}}toString(){return JSON.stringify(this.values)}}const Gn=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class kr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof kr)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let s=0;s<t.length;s+=2){const c=t[s],f=t[s+1];if(typeof c!="string"||!Gn.has(c)||!Array.isArray(f)||f.length!==2||typeof f[0]!="number"||typeof f[1]!="number")return}return new kr(t)}}toString(){return JSON.stringify(this.values)}}class bn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new bn({name:t,available:!1}):null}}function Hn(n,t,s,c){return typeof n=="number"&&n>=0&&n<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof s=="number"&&s>=0&&s<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[n,t,s,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[n,t,s,c]:[n,t,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function vs(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Vi||n instanceof lo||n instanceof Dn||n instanceof xn||n instanceof kr||n instanceof bn)return!0;if(Array.isArray(n)){for(const t of n)if(!vs(t))return!1;return!0}if(typeof n=="object"){for(const t in n)if(!vs(n[t]))return!1;return!0}return!1}function Lr(n){if(n===null)return Sr;if(typeof n=="string")return ci;if(typeof n=="boolean")return Nt;if(typeof n=="number")return nt;if(n instanceof Vi)return ji;if(n instanceof lo)return ea;if(n instanceof Dn)return Er;if(n instanceof xn)return te;if(n instanceof kr)return U;if(n instanceof bn)return N;if(Array.isArray(n)){const t=n.length;let s;for(const c of n){const f=Lr(c);if(s){if(s===f)continue;s=ri;break}s=f}return H(s||ri,t)}return yn}function co(n){const t=typeof n;return n===null?"":t==="string"||t==="number"||t==="boolean"?String(n):n instanceof Vi||n instanceof Dn||n instanceof xn||n instanceof kr||n instanceof bn?n.toString():JSON.stringify(n)}class ta{constructor(t,s){this.type=t,this.value=s}static parse(t,s){if(t.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!vs(t[1]))return s.error("invalid value");const c=t[1];let f=Lr(c);const v=s.expectedType;return f.kind!=="array"||f.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(f=v),new ta(f,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class dr{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const uo={string:ci,number:nt,boolean:Nt,object:yn};class wn{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");let c,f=1;const v=t[0];if(v==="array"){let w,T;if(t.length>2){const I=t[1];if(typeof I!="string"||!(I in uo)||I==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);w=uo[I],f++}else w=ri;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return s.error('The length argument to "array" must be a positive integer literal',2);T=t[2],f++}c=H(w,T)}else{if(!uo[v])throw new Error(`Types doesn't contain name = ${v}`);c=uo[v]}const x=[];for(;f<t.length;f++){const w=s.parse(t[f],f,ri);if(!w)return null;x.push(w)}return new wn(c,x)}evaluate(t){for(let s=0;s<this.args.length;s++){const c=this.args[s].evaluate(t);if(!ve(this.type,Lr(c)))return c;if(s===this.args.length-1)throw new dr(`Expected value to be of type ${Q(this.type)}, but found ${Q(Lr(c))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const ho={"to-boolean":Nt,"to-color":ji,"to-number":nt,"to-string":ci};class ss{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const c=t[0];if(!ho[c])throw new Error(`Can't parse ${c} as it is not part of the known types`);if((c==="to-boolean"||c==="to-string")&&t.length!==2)return s.error("Expected one argument.");const f=ho[c],v=[];for(let x=1;x<t.length;x++){const w=s.parse(t[x],x,ri);if(!w)return null;v.push(w)}return new ss(f,v)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let s,c;for(const f of this.args){if(s=f.evaluate(t),c=null,s instanceof Vi)return s;if(typeof s=="string"){const v=t.parseColor(s);if(v)return v}else if(Array.isArray(s)&&(c=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Hn(s[0],s[1],s[2],s[3]),!c))return new Vi(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new dr(c||`Could not parse color from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"padding":{let s;for(const c of this.args){s=c.evaluate(t);const f=xn.parse(s);if(f)return f}throw new dr(`Could not parse padding from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"variableAnchorOffsetCollection":{let s;for(const c of this.args){s=c.evaluate(t);const f=kr.parse(s);if(f)return f}throw new dr(`Could not parse variableAnchorOffsetCollection from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"number":{let s=null;for(const c of this.args){if(s=c.evaluate(t),s===null)return 0;const f=Number(s);if(!isNaN(f))return f}throw new dr(`Could not convert ${JSON.stringify(s)} to number.`)}case"formatted":return Dn.fromString(co(this.args[0].evaluate(t)));case"resolvedImage":return bn.fromString(co(this.args[0].evaluate(t)));default:return co(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const po=["Unknown","Point","LineString","Polygon"];class qi{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?po[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let s=this._parseColorCache[t];return s||(s=this._parseColorCache[t]=Vi.parse(t)),s}}class Oo{constructor(t,s,c=[],f,v=new gn,x=[]){this.registry=t,this.path=c,this.key=c.map(w=>`[${w}]`).join(""),this.scope=v,this.errors=x,this.expectedType=f,this._isConstant=s}parse(t,s,c,f,v={}){return s?this.concat(s,c,f)._parse(t,v):this._parse(t,v)}_parse(t,s){function c(f,v,x){return x==="assert"?new wn(v,[f]):x==="coerce"?new ss(v,[f]):f}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=t[0];if(typeof f!="string")return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[f];if(v){let x=v.parse(t,this);if(!x)return null;if(this.expectedType){const w=this.expectedType,T=x.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||T.kind!=="value")if(w.kind!=="color"&&w.kind!=="formatted"&&w.kind!=="resolvedImage"||T.kind!=="value"&&T.kind!=="string")if(w.kind!=="padding"||T.kind!=="value"&&T.kind!=="number"&&T.kind!=="array")if(w.kind!=="variableAnchorOffsetCollection"||T.kind!=="value"&&T.kind!=="array"){if(this.checkSubtype(w,T))return null}else x=c(x,w,s.typeAnnotation||"coerce");else x=c(x,w,s.typeAnnotation||"coerce");else x=c(x,w,s.typeAnnotation||"coerce");else x=c(x,w,s.typeAnnotation||"assert")}if(!(x instanceof ta)&&x.type.kind!=="resolvedImage"&&this._isConstant(x)){const w=new qi;try{x=new ta(x.type,x.evaluate(w))}catch(T){return this.error(T.message),null}}return x}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,s,c){const f=typeof t=="number"?this.path.concat(t):this.path,v=c?this.scope.concat(c):this.scope;return new Oo(this.registry,this._isConstant,f,s||null,v,this.errors)}error(t,...s){const c=`${this.key}${s.map(f=>`[${f}]`).join("")}`;this.errors.push(new Yi(c,t))}checkSubtype(t,s){const c=ve(t,s);return c&&this.error(c),c}}class Bs{constructor(t,s,c){this.type=ea,this.locale=c,this.caseSensitive=t,this.diacriticSensitive=s}static parse(t,s){if(t.length!==2)return s.error("Expected one argument.");const c=t[1];if(typeof c!="object"||Array.isArray(c))return s.error("Collator options argument must be an object.");const f=s.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,Nt);if(!f)return null;const v=s.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,Nt);if(!v)return null;let x=null;return c.locale&&(x=s.parse(c.locale,1,ci),!x)?null:new Bs(f,v,x)}evaluate(t){return new lo(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}const b=8192;function A(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function V(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function ae(n,t){const s=(180+n[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,f=Math.pow(2,t.z);return[Math.round(s*f*b),Math.round(c*f*b)]}function ge(n,t,s){const c=n[0]-t[0],f=n[1]-t[1],v=n[0]-s[0],x=n[1]-s[1];return c*x-v*f==0&&c*v<=0&&f*x<=0}function ye(n,t){let s=!1;for(let x=0,w=t.length;x<w;x++){const T=t[x];for(let I=0,L=T.length;I<L-1;I++){if(ge(n,T[I],T[I+1]))return!1;(f=T[I])[1]>(c=n)[1]!=(v=T[I+1])[1]>c[1]&&c[0]<(v[0]-f[0])*(c[1]-f[1])/(v[1]-f[1])+f[0]&&(s=!s)}}var c,f,v;return s}function Se(n,t){for(let s=0;s<t.length;s++)if(ye(n,t[s]))return!0;return!1}function Ye(n,t,s,c){const f=c[0]-s[0],v=c[1]-s[1],x=(n[0]-s[0])*v-f*(n[1]-s[1]),w=(t[0]-s[0])*v-f*(t[1]-s[1]);return x>0&&w<0||x<0&&w>0}function ot(n,t,s){for(const I of s)for(let L=0;L<I.length-1;++L)if((w=[(x=I[L+1])[0]-(v=I[L])[0],x[1]-v[1]])[0]*(T=[(f=t)[0]-(c=n)[0],f[1]-c[1]])[1]-w[1]*T[0]!=0&&Ye(c,f,v,x)&&Ye(v,x,c,f))return!0;var c,f,v,x,w,T;return!1}function wt(n,t){for(let s=0;s<n.length;++s)if(!ye(n[s],t))return!1;for(let s=0;s<n.length-1;++s)if(ot(n[s],n[s+1],t))return!1;return!0}function Mt(n,t){for(let s=0;s<t.length;s++)if(wt(n,t[s]))return!0;return!1}function ft(n,t,s){const c=[];for(let f=0;f<n.length;f++){const v=[];for(let x=0;x<n[f].length;x++){const w=ae(n[f][x],s);A(t,w),v.push(w)}c.push(v)}return c}function oi(n,t,s){const c=[];for(let f=0;f<n.length;f++){const v=ft(n[f],t,s);c.push(v)}return c}function pr(n,t,s,c){if(n[0]<s[0]||n[0]>s[2]){const f=.5*c;let v=n[0]-s[0]>f?-c:s[0]-n[0]>f?c:0;v===0&&(v=n[0]-s[2]>f?-c:s[2]-n[0]>f?c:0),n[0]+=v}A(t,n)}function ui(n,t,s,c){const f=Math.pow(2,c.z)*b,v=[c.x*b,c.y*b],x=[];for(const w of n)for(const T of w){const I=[T.x+v[0],T.y+v[1]];pr(I,t,s,f),x.push(I)}return x}function Rr(n,t,s,c){const f=Math.pow(2,c.z)*b,v=[c.x*b,c.y*b],x=[];for(const T of n){const I=[];for(const L of T){const O=[L.x+v[0],L.y+v[1]];A(t,O),I.push(O)}x.push(I)}if(t[2]-t[0]<=f/2){(w=t)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const T of x)for(const I of T)pr(I,t,s,f)}var w;return x}class je{constructor(t,s){this.type=Nt,this.geojson=t,this.geometries=s}static parse(t,s){if(t.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(vs(t[1])){const c=t[1];if(c.type==="FeatureCollection"){const f=[];for(const v of c.features){const{type:x,coordinates:w}=v.geometry;x==="Polygon"&&f.push(w),x==="MultiPolygon"&&f.push(...w)}if(f.length)return new je(c,{type:"MultiPolygon",coordinates:f})}else if(c.type==="Feature"){const f=c.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new je(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new je(c,c)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(s,c){const f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=s.canonicalID();if(c.type==="Polygon"){const w=ft(c.coordinates,v,x),T=ui(s.geometry(),f,v,x);if(!V(f,v))return!1;for(const I of T)if(!ye(I,w))return!1}if(c.type==="MultiPolygon"){const w=oi(c.coordinates,v,x),T=ui(s.geometry(),f,v,x);if(!V(f,v))return!1;for(const I of T)if(!Se(I,w))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(s,c){const f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=s.canonicalID();if(c.type==="Polygon"){const w=ft(c.coordinates,v,x),T=Rr(s.geometry(),f,v,x);if(!V(f,v))return!1;for(const I of T)if(!wt(I,w))return!1}if(c.type==="MultiPolygon"){const w=oi(c.coordinates,v,x),T=Rr(s.geometry(),f,v,x);if(!V(f,v))return!1;for(const I of T)if(!Mt(I,w))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Ft{constructor(t,s){this.type=s.type,this.name=t,this.boundExpression=s}static parse(t,s){if(t.length!==2||typeof t[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const c=t[1];return s.scope.has(c)?new Ft(c,s.scope.get(c)):s.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class xi{constructor(t,s,c,f){this.name=t,this.type=s,this._evaluate=c,this.args=f}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,s){const c=t[0],f=xi.definitions[c];if(!f)return s.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(f)?f[0]:f.type,x=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,w=x.filter(([I])=>!Array.isArray(I)||I.length===t.length-1);let T=null;for(const[I,L]of w){T=new Oo(s.registry,Tr,s.path,null,s.scope);const O=[];let $=!1;for(let j=1;j<t.length;j++){const G=t[j],K=Array.isArray(I)?I[j-1]:I.type,re=T.parse(G,1+O.length,K);if(!re){$=!0;break}O.push(re)}if(!$)if(Array.isArray(I)&&I.length!==O.length)T.error(`Expected ${I.length} arguments, but found ${O.length} instead.`);else{for(let j=0;j<O.length;j++){const G=Array.isArray(I)?I[j]:I.type,K=O[j];T.concat(j+1).checkSubtype(G,K.type)}if(T.errors.length===0)return new xi(c,v,L,O)}}if(w.length===1)s.errors.push(...T.errors);else{const I=(w.length?w:x).map(([O])=>{return $=O,Array.isArray($)?`(${$.map(Q).join(", ")})`:`(${Q($.type)}...)`;var $}).join(" | "),L=[];for(let O=1;O<t.length;O++){const $=s.parse(t[O],1+L.length);if(!$)return null;L.push(Q($.type))}s.error(`Expected arguments of type ${I}, but found (${L.join(", ")}) instead.`)}return null}static register(t,s){xi.definitions=s;for(const c in s)t[c]=xi}}function Tr(n){if(n instanceof Ft)return Tr(n.boundExpression);if(n instanceof xi&&n.name==="error"||n instanceof Bs||n instanceof je)return!1;const t=n instanceof ss||n instanceof wn;let s=!0;return n.eachChild(c=>{s=t?s&&Tr(c):s&&c instanceof ta}),!!s&&vr(n)&&fo(n,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function vr(n){if(n instanceof xi&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof je)return!1;let t=!0;return n.eachChild(s=>{t&&!vr(s)&&(t=!1)}),t}function _a(n){if(n instanceof xi&&n.name==="feature-state")return!1;let t=!0;return n.eachChild(s=>{t&&!_a(s)&&(t=!1)}),t}function fo(n,t){if(n instanceof xi&&t.indexOf(n.name)>=0)return!1;let s=!0;return n.eachChild(c=>{s&&!fo(c,t)&&(s=!1)}),s}function Wi(n,t){const s=n.length-1;let c,f,v=0,x=s,w=0;for(;v<=x;)if(w=Math.floor((v+x)/2),c=n[w],f=n[w+1],c<=t){if(w===s||t<f)return w;v=w+1}else{if(!(c>t))throw new dr("Input is not a number.");x=w-1}return 0}class Na{constructor(t,s,c){this.type=t,this.input=s,this.labels=[],this.outputs=[];for(const[f,v]of c)this.labels.push(f),this.outputs.push(v)}static parse(t,s){if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");const c=s.parse(t[1],1,nt);if(!c)return null;const f=[];let v=null;s.expectedType&&s.expectedType.kind!=="value"&&(v=s.expectedType);for(let x=1;x<t.length;x+=2){const w=x===1?-1/0:t[x],T=t[x+1],I=x,L=x+1;if(typeof w!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(f.length&&f[f.length-1][0]>=w)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const O=s.parse(T,L,v);if(!O)return null;v=v||O.type,f.push([w,O])}return new Na(v,c,f)}evaluate(t){const s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(t);const f=this.input.evaluate(t);if(f<=s[0])return c[0].evaluate(t);const v=s.length;return f>=s[v-1]?c[v-1].evaluate(t):c[Wi(s,f)].evaluate(t)}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function xu(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ns=Il;function Il(n,t,s,c){this.cx=3*n,this.bx=3*(s-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(c-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=t,this.p2x=s,this.p2y=c}Il.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,t){if(t===void 0&&(t=1e-6),n<0)return 0;if(n>1)return 1;for(var s=n,c=0;c<8;c++){var f=this.sampleCurveX(s)-n;if(Math.abs(f)<t)return s;var v=this.sampleCurveDerivativeX(s);if(Math.abs(v)<1e-6)break;s-=f/v}var x=0,w=1;for(s=n,c=0;c<20&&(f=this.sampleCurveX(s),!(Math.abs(f-n)<t));c++)n>f?x=s:w=s,s=.5*(w-x)+x;return s},solve:function(n,t){return this.sampleCurveY(this.solveCurveX(n,t))}};var mc=xu(Ns);function ia(n,t,s){return n+s*(t-n)}function $a(n,t,s){return n.map((c,f)=>ia(c,t[f],s))}const pn={number:ia,color:function(n,t,s,c="rgb"){switch(c){case"rgb":{const[f,v,x,w]=$a(n.rgb,t.rgb,s);return new Vi(f,v,x,w,!1)}case"hcl":{const[f,v,x,w]=n.hcl,[T,I,L,O]=t.hcl;let $,j;if(isNaN(f)||isNaN(T))isNaN(f)?isNaN(T)?$=NaN:($=T,x!==1&&x!==0||(j=I)):($=f,L!==1&&L!==0||(j=v));else{let Te=T-f;T>f&&Te>180?Te-=360:T<f&&f-T>180&&(Te+=360),$=f+s*Te}const[G,K,re,he]=function([Te,pe,be,$e]){return Te=isNaN(Te)?0:Te*si,_r([be,Math.cos(Te)*pe,Math.sin(Te)*pe,$e])}([$,j??ia(v,I,s),ia(x,L,s),ia(w,O,s)]);return new Vi(G,K,re,he,!1)}case"lab":{const[f,v,x,w]=_r($a(n.lab,t.lab,s));return new Vi(f,v,x,w,!1)}}},array:$a,padding:function(n,t,s){return new xn($a(n.values,t.values,s))},variableAnchorOffsetCollection:function(n,t,s){const c=n.values,f=t.values;if(c.length!==f.length)throw new dr(`Cannot interpolate values of different length. from: ${n.toString()}, to: ${t.toString()}`);const v=[];for(let x=0;x<c.length;x+=2){if(c[x]!==f[x])throw new dr(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${c[x]}, to[${x}]: ${f[x]}`);v.push(c[x]);const[w,T]=c[x+1],[I,L]=f[x+1];v.push([ia(w,I,s),ia(T,L,s)])}return new kr(v)}};class Jr{constructor(t,s,c,f,v){this.type=t,this.operator=s,this.interpolation=c,this.input=f,this.labels=[],this.outputs=[];for(const[x,w]of v)this.labels.push(x),this.outputs.push(w)}static interpolationFactor(t,s,c,f){let v=0;if(t.name==="exponential")v=Oi(s,t.base,c,f);else if(t.name==="linear")v=Oi(s,1,c,f);else if(t.name==="cubic-bezier"){const x=t.controlPoints;v=new mc(x[0],x[1],x[2],x[3]).solve(Oi(s,1,c,f))}return v}static parse(t,s){let[c,f,v,...x]=t;if(!Array.isArray(f)||f.length===0)return s.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){const I=f[1];if(typeof I!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:I}}else{if(f[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const I=f.slice(1);if(I.length!==4||I.some(L=>typeof L!="number"||L<0||L>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:I}}}if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(v=s.parse(v,2,nt),!v)return null;const w=[];let T=null;c==="interpolate-hcl"||c==="interpolate-lab"?T=ji:s.expectedType&&s.expectedType.kind!=="value"&&(T=s.expectedType);for(let I=0;I<x.length;I+=2){const L=x[I],O=x[I+1],$=I+3,j=I+4;if(typeof L!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',$);if(w.length&&w[w.length-1][0]>=L)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',$);const G=s.parse(O,j,T);if(!G)return null;T=T||G.type,w.push([L,G])}return Ce(T,nt)||Ce(T,ji)||Ce(T,te)||Ce(T,U)||Ce(T,H(nt))?new Jr(T,c,f,v,w):s.error(`Type ${Q(T)} is not interpolatable.`)}evaluate(t){const s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(t);const f=this.input.evaluate(t);if(f<=s[0])return c[0].evaluate(t);const v=s.length;if(f>=s[v-1])return c[v-1].evaluate(t);const x=Wi(s,f),w=Jr.interpolationFactor(this.interpolation,f,s[x],s[x+1]),T=c[x].evaluate(t),I=c[x+1].evaluate(t);switch(this.operator){case"interpolate":return pn[this.type.kind](T,I,w);case"interpolate-hcl":return pn.color(T,I,w,"hcl");case"interpolate-lab":return pn.color(T,I,w,"lab")}}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Oi(n,t,s,c){const f=c-s,v=n-s;return f===0?0:t===1?v/f:(Math.pow(t,v)-1)/(Math.pow(t,f)-1)}class Fo{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expectected at least one argument.");let c=null;const f=s.expectedType;f&&f.kind!=="value"&&(c=f);const v=[];for(const w of t.slice(1)){const T=s.parse(w,1+v.length,c,void 0,{typeAnnotation:"omit"});if(!T)return null;c=c||T.type,v.push(T)}if(!c)throw new Error("No output type");const x=f&&v.some(w=>ve(f,w.type));return new Fo(x?ri:c,v)}evaluate(t){let s,c=null,f=0;for(const v of this.args)if(f++,c=v.evaluate(t),c&&c instanceof bn&&!c.available&&(s||(s=c.name),c=null,f===this.args.length&&(c=s)),c!==null)break;return c}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}class Bo{constructor(t,s){this.type=s.type,this.bindings=[].concat(t),this.result=s}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const s of this.bindings)t(s[1]);t(this.result)}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const c=[];for(let v=1;v<t.length-1;v+=2){const x=t[v];if(typeof x!="string")return s.error(`Expected string, but found ${typeof x} instead.`,v);if(/[^a-zA-Z0-9_]/.test(x))return s.error("Variable names must contain only alphanumeric characters or '_'.",v);const w=s.parse(t[v+1],v+1);if(!w)return null;c.push([x,w])}const f=s.parse(t[t.length-1],t.length-1,s.expectedType,c);return f?new Bo(c,f):null}outputDefined(){return this.result.outputDefined()}}class No{constructor(t,s,c){this.type=t,this.index=s,this.input=c}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,nt),f=s.parse(t[2],2,H(s.expectedType||ri));return c&&f?new No(f.type.itemType,c,f):null}evaluate(t){const s=this.index.evaluate(t),c=this.input.evaluate(t);if(s<0)throw new dr(`Array index out of bounds: ${s} < 0.`);if(s>=c.length)throw new dr(`Array index out of bounds: ${s} > ${c.length-1}.`);if(s!==Math.floor(s))throw new dr(`Array index must be an integer, but found ${s} instead.`);return c[s]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class $o{constructor(t,s){this.type=Nt,this.needle=t,this.haystack=s}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,ri),f=s.parse(t[2],2,ri);return c&&f?Me(c.type,[Nt,ci,nt,Sr,ri])?new $o(c,f):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Q(c.type)} instead`):null}evaluate(t){const s=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(!c)return!1;if(!de(s,["boolean","string","number","null"]))throw new dr(`Expected first argument to be of type boolean, string, number or null, but found ${Q(Lr(s))} instead.`);if(!de(c,["string","array"]))throw new dr(`Expected second argument to be of type array or string, but found ${Q(Lr(c))} instead.`);return c.indexOf(s)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class mo{constructor(t,s,c){this.type=nt,this.needle=t,this.haystack=s,this.fromIndex=c}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,ri),f=s.parse(t[2],2,ri);if(!c||!f)return null;if(!Me(c.type,[Nt,ci,nt,Sr,ri]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Q(c.type)} instead`);if(t.length===4){const v=s.parse(t[3],3,nt);return v?new mo(c,f,v):null}return new mo(c,f)}evaluate(t){const s=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(!de(s,["boolean","string","number","null"]))throw new dr(`Expected first argument to be of type boolean, string, number or null, but found ${Q(Lr(s))} instead.`);if(!de(c,["string","array"]))throw new dr(`Expected second argument to be of type array or string, but found ${Q(Lr(c))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(t);return c.indexOf(s,f)}return c.indexOf(s)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Al{constructor(t,s,c,f,v,x){this.inputType=t,this.type=s,this.input=c,this.cases=f,this.outputs=v,this.otherwise=x}static parse(t,s){if(t.length<5)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return s.error("Expected an even number of arguments.");let c,f;s.expectedType&&s.expectedType.kind!=="value"&&(f=s.expectedType);const v={},x=[];for(let I=2;I<t.length-1;I+=2){let L=t[I];const O=t[I+1];Array.isArray(L)||(L=[L]);const $=s.concat(I);if(L.length===0)return $.error("Expected at least one branch label.");for(const G of L){if(typeof G!="number"&&typeof G!="string")return $.error("Branch labels must be numbers or strings.");if(typeof G=="number"&&Math.abs(G)>Number.MAX_SAFE_INTEGER)return $.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof G=="number"&&Math.floor(G)!==G)return $.error("Numeric branch labels must be integer values.");if(c){if($.checkSubtype(c,Lr(G)))return null}else c=Lr(G);if(v[String(G)]!==void 0)return $.error("Branch labels must be unique.");v[String(G)]=x.length}const j=s.parse(O,I,f);if(!j)return null;f=f||j.type,x.push(j)}const w=s.parse(t[1],1,ri);if(!w)return null;const T=s.parse(t[t.length-1],t.length-1,f);return T?w.type.kind!=="value"&&s.concat(1).checkSubtype(c,w.type)?null:new Al(c,f,w,v,x,T):null}evaluate(t){const s=this.input.evaluate(t);return(Lr(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Pl{constructor(t,s,c){this.type=t,this.branches=s,this.otherwise=c}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return s.error("Expected an odd number of arguments.");let c;s.expectedType&&s.expectedType.kind!=="value"&&(c=s.expectedType);const f=[];for(let x=1;x<t.length-1;x+=2){const w=s.parse(t[x],x,Nt);if(!w)return null;const T=s.parse(t[x+1],x+1,c);if(!T)return null;f.push([w,T]),c=c||T.type}const v=s.parse(t[t.length-1],t.length-1,c);if(!v)return null;if(!c)throw new Error("Can't infer output type");return new Pl(c,f,v)}evaluate(t){for(const[s,c]of this.branches)if(s.evaluate(t))return c.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[s,c]of this.branches)t(s),t(c);t(this.otherwise)}outputDefined(){return this.branches.every(([t,s])=>s.outputDefined())&&this.otherwise.outputDefined()}}class va{constructor(t,s,c,f){this.type=t,this.input=s,this.beginIndex=c,this.endIndex=f}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,ri),f=s.parse(t[2],2,nt);if(!c||!f)return null;if(!Me(c.type,[H(ri),ci,ri]))return s.error(`Expected first argument to be of type array or string, but found ${Q(c.type)} instead`);if(t.length===4){const v=s.parse(t[3],3,nt);return v?new va(c.type,c,f,v):null}return new va(c.type,c,f)}evaluate(t){const s=this.input.evaluate(t),c=this.beginIndex.evaluate(t);if(!de(s,["string","array"]))throw new dr(`Expected first argument to be of type array or string, but found ${Q(Lr(s))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(t);return s.slice(c,f)}return s.slice(c)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Uo(n,t){return n==="=="||n==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Dl(n,t,s,c){return c.compare(t,s)===0}function Mn(n,t,s){const c=n!=="=="&&n!=="!=";return class Qx{constructor(v,x,w){this.type=Nt,this.lhs=v,this.rhs=x,this.collator=w,this.hasUntypedArgument=v.type.kind==="value"||x.type.kind==="value"}static parse(v,x){if(v.length!==3&&v.length!==4)return x.error("Expected two or three arguments.");const w=v[0];let T=x.parse(v[1],1,ri);if(!T)return null;if(!Uo(w,T.type))return x.concat(1).error(`"${w}" comparisons are not supported for type '${Q(T.type)}'.`);let I=x.parse(v[2],2,ri);if(!I)return null;if(!Uo(w,I.type))return x.concat(2).error(`"${w}" comparisons are not supported for type '${Q(I.type)}'.`);if(T.type.kind!==I.type.kind&&T.type.kind!=="value"&&I.type.kind!=="value")return x.error(`Cannot compare types '${Q(T.type)}' and '${Q(I.type)}'.`);c&&(T.type.kind==="value"&&I.type.kind!=="value"?T=new wn(I.type,[T]):T.type.kind!=="value"&&I.type.kind==="value"&&(I=new wn(T.type,[I])));let L=null;if(v.length===4){if(T.type.kind!=="string"&&I.type.kind!=="string"&&T.type.kind!=="value"&&I.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(L=x.parse(v[3],3,ea),!L)return null}return new Qx(T,I,L)}evaluate(v){const x=this.lhs.evaluate(v),w=this.rhs.evaluate(v);if(c&&this.hasUntypedArgument){const T=Lr(x),I=Lr(w);if(T.kind!==I.kind||T.kind!=="string"&&T.kind!=="number")throw new dr(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${T.kind}, ${I.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const T=Lr(x),I=Lr(w);if(T.kind!=="string"||I.kind!=="string")return t(v,x,w)}return this.collator?s(v,x,w,this.collator.evaluate(v)):t(v,x,w)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}}}const gc=Mn("==",function(n,t,s){return t===s},Dl),yc=Mn("!=",function(n,t,s){return t!==s},function(n,t,s,c){return!Dl(0,t,s,c)}),bu=Mn("<",function(n,t,s){return t<s},function(n,t,s,c){return c.compare(t,s)<0}),_c=Mn(">",function(n,t,s){return t>s},function(n,t,s,c){return c.compare(t,s)>0}),Vo=Mn("<=",function(n,t,s){return t<=s},function(n,t,s,c){return c.compare(t,s)<=0}),vc=Mn(">=",function(n,t,s){return t>=s},function(n,t,s,c){return c.compare(t,s)>=0});class jo{constructor(t,s,c,f,v){this.type=ci,this.number=t,this.locale=s,this.currency=c,this.minFractionDigits=f,this.maxFractionDigits=v}static parse(t,s){if(t.length!==3)return s.error("Expected two arguments.");const c=s.parse(t[1],1,nt);if(!c)return null;const f=t[2];if(typeof f!="object"||Array.isArray(f))return s.error("NumberFormat options argument must be an object.");let v=null;if(f.locale&&(v=s.parse(f.locale,1,ci),!v))return null;let x=null;if(f.currency&&(x=s.parse(f.currency,1,ci),!x))return null;let w=null;if(f["min-fraction-digits"]&&(w=s.parse(f["min-fraction-digits"],1,nt),!w))return null;let T=null;return f["max-fraction-digits"]&&(T=s.parse(f["max-fraction-digits"],1,nt),!T)?null:new jo(c,v,x,w,T)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class qo{constructor(t){this.type=Er,this.sections=t}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const c=t[1];if(!Array.isArray(c)&&typeof c=="object")return s.error("First argument must be an image or text section.");const f=[];let v=!1;for(let x=1;x<=t.length-1;++x){const w=t[x];if(v&&typeof w=="object"&&!Array.isArray(w)){v=!1;let T=null;if(w["font-scale"]&&(T=s.parse(w["font-scale"],1,nt),!T))return null;let I=null;if(w["text-font"]&&(I=s.parse(w["text-font"],1,H(ci)),!I))return null;let L=null;if(w["text-color"]&&(L=s.parse(w["text-color"],1,ji),!L))return null;const O=f[f.length-1];O.scale=T,O.font=I,O.textColor=L}else{const T=s.parse(t[x],1,ri);if(!T)return null;const I=T.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,f.push({content:T,scale:null,font:null,textColor:null})}}return new qo(f)}evaluate(t){return new Dn(this.sections.map(s=>{const c=s.content.evaluate(t);return Lr(c)===N?new Dr("",c,null,null,null):new Dr(co(c),null,s.scale?s.scale.evaluate(t):null,s.font?s.font.evaluate(t).join(","):null,s.textColor?s.textColor.evaluate(t):null)}))}eachChild(t){for(const s of this.sections)t(s.content),s.scale&&t(s.scale),s.font&&t(s.font),s.textColor&&t(s.textColor)}outputDefined(){return!1}}class $s{constructor(t){this.type=N,this.input=t}static parse(t,s){if(t.length!==2)return s.error("Expected two arguments.");const c=s.parse(t[1],1,ci);return c?new $s(c):s.error("No image name provided.")}evaluate(t){const s=this.input.evaluate(t),c=bn.fromString(s);return c&&t.availableImages&&(c.available=t.availableImages.indexOf(s)>-1),c}eachChild(t){t(this.input)}outputDefined(){return!1}}class Go{constructor(t){this.type=nt,this.input=t}static parse(t,s){if(t.length!==2)return s.error(`Expected 1 argument, but found ${t.length-1} instead.`);const c=s.parse(t[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${Q(c.type)} instead.`):new Go(c):null}evaluate(t){const s=this.input.evaluate(t);if(typeof s=="string"||Array.isArray(s))return s.length;throw new dr(`Expected value to be of type string or array, but found ${Q(Lr(s))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Ua={"==":gc,"!=":yc,">":_c,"<":bu,">=":vc,"<=":Vo,array:wn,at:No,boolean:wn,case:Pl,coalesce:Fo,collator:Bs,format:qo,image:$s,in:$o,"index-of":mo,interpolate:Jr,"interpolate-hcl":Jr,"interpolate-lab":Jr,length:Go,let:Bo,literal:ta,match:Al,number:wn,"number-format":jo,object:wn,slice:va,step:Na,string:wn,"to-boolean":ss,"to-color":ss,"to-number":ss,"to-string":ss,var:Ft,within:je};function xc(n,[t,s,c,f]){t=t.evaluate(n),s=s.evaluate(n),c=c.evaluate(n);const v=f?f.evaluate(n):1,x=Hn(t,s,c,v);if(x)throw new dr(x);return new Vi(t/255,s/255,c/255,v,!1)}function Ho(n,t){return n in t}function xa(n,t){const s=t[n];return s===void 0?null:s}function Us(n){return{type:n}}function Zo(n){return{result:"success",value:n}}function ra(n){return{result:"error",value:n}}function xs(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function bc(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function kl(n){return!!n.expression&&n.expression.interpolated}function ki(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function Wo(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function wu(n){return n}function Ll(n,t){const s=t.type==="color",c=n.stops&&typeof n.stops[0][0]=="object",f=c||!(c||n.property!==void 0),v=n.type||(kl(t)?"exponential":"interval");if(s||t.type==="padding"){const L=s?Vi.parse:xn.parse;(n=Ni({},n)).stops&&(n.stops=n.stops.map(O=>[O[0],L(O[1])])),n.default=L(n.default?n.default:t.default)}if(n.colorSpace&&(x=n.colorSpace)!=="rgb"&&x!=="hcl"&&x!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var x;let w,T,I;if(v==="exponential")w=fi;else if(v==="interval")w=Vs;else if(v==="categorical"){w=er,T=Object.create(null);for(const L of n.stops)T[L[0]]=L[1];I=typeof n.stops[0][0]}else{if(v!=="identity")throw new Error(`Unknown function type "${v}"`);w=Va}if(c){const L={},O=[];for(let G=0;G<n.stops.length;G++){const K=n.stops[G],re=K[0].zoom;L[re]===void 0&&(L[re]={zoom:re,type:n.type,property:n.property,default:n.default,stops:[]},O.push(re)),L[re].stops.push([K[0].value,K[1]])}const $=[];for(const G of O)$.push([L[G].zoom,Ll(L[G],t)]);const j={name:"linear"};return{kind:"composite",interpolationType:j,interpolationFactor:Jr.interpolationFactor.bind(void 0,j),zoomStops:$.map(G=>G[0]),evaluate:({zoom:G},K)=>fi({stops:$,base:n.base},t,G).evaluate(G,K)}}if(f){const L=v==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:L,interpolationFactor:Jr.interpolationFactor.bind(void 0,L),zoomStops:n.stops.map(O=>O[0]),evaluate:({zoom:O})=>w(n,t,O,T,I)}}return{kind:"source",evaluate(L,O){const $=O&&O.properties?O.properties[n.property]:void 0;return $===void 0?ba(n.default,t.default):w(n,t,$,T,I)}}}function ba(n,t,s){return n!==void 0?n:t!==void 0?t:s!==void 0?s:void 0}function er(n,t,s,c,f){return ba(typeof s===f?c[s]:void 0,n.default,t.default)}function Vs(n,t,s){if(ki(s)!=="number")return ba(n.default,t.default);const c=n.stops.length;if(c===1||s<=n.stops[0][0])return n.stops[0][1];if(s>=n.stops[c-1][0])return n.stops[c-1][1];const f=Wi(n.stops.map(v=>v[0]),s);return n.stops[f][1]}function fi(n,t,s){const c=n.base!==void 0?n.base:1;if(ki(s)!=="number")return ba(n.default,t.default);const f=n.stops.length;if(f===1||s<=n.stops[0][0])return n.stops[0][1];if(s>=n.stops[f-1][0])return n.stops[f-1][1];const v=Wi(n.stops.map(L=>L[0]),s),x=function(L,O,$,j){const G=j-$,K=L-$;return G===0?0:O===1?K/G:(Math.pow(O,K)-1)/(Math.pow(O,G)-1)}(s,c,n.stops[v][0],n.stops[v+1][0]),w=n.stops[v][1],T=n.stops[v+1][1],I=pn[t.type]||wu;return typeof w.evaluate=="function"?{evaluate(...L){const O=w.evaluate.apply(void 0,L),$=T.evaluate.apply(void 0,L);if(O!==void 0&&$!==void 0)return I(O,$,x,n.colorSpace)}}:I(w,T,x,n.colorSpace)}function Va(n,t,s){switch(t.type){case"color":s=Vi.parse(s);break;case"formatted":s=Dn.fromString(s.toString());break;case"resolvedImage":s=bn.fromString(s.toString());break;case"padding":s=xn.parse(s);break;default:ki(s)===t.type||t.type==="enum"&&t.values[s]||(s=void 0)}return ba(s,n.default,t.default)}xi.register(Ua,{error:[{kind:"error"},[ci],(n,[t])=>{throw new dr(t.evaluate(n))}],typeof:[ci,[ri],(n,[t])=>Q(Lr(t.evaluate(n)))],"to-rgba":[H(nt,4),[ji],(n,[t])=>{const[s,c,f,v]=t.evaluate(n).rgb;return[255*s,255*c,255*f,v]}],rgb:[ji,[nt,nt,nt],xc],rgba:[ji,[nt,nt,nt,nt],xc],has:{type:Nt,overloads:[[[ci],(n,[t])=>Ho(t.evaluate(n),n.properties())],[[ci,yn],(n,[t,s])=>Ho(t.evaluate(n),s.evaluate(n))]]},get:{type:ri,overloads:[[[ci],(n,[t])=>xa(t.evaluate(n),n.properties())],[[ci,yn],(n,[t,s])=>xa(t.evaluate(n),s.evaluate(n))]]},"feature-state":[ri,[ci],(n,[t])=>xa(t.evaluate(n),n.featureState||{})],properties:[yn,[],n=>n.properties()],"geometry-type":[ci,[],n=>n.geometryType()],id:[ri,[],n=>n.id()],zoom:[nt,[],n=>n.globals.zoom],"heatmap-density":[nt,[],n=>n.globals.heatmapDensity||0],"line-progress":[nt,[],n=>n.globals.lineProgress||0],accumulated:[ri,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[nt,Us(nt),(n,t)=>{let s=0;for(const c of t)s+=c.evaluate(n);return s}],"*":[nt,Us(nt),(n,t)=>{let s=1;for(const c of t)s*=c.evaluate(n);return s}],"-":{type:nt,overloads:[[[nt,nt],(n,[t,s])=>t.evaluate(n)-s.evaluate(n)],[[nt],(n,[t])=>-t.evaluate(n)]]},"/":[nt,[nt,nt],(n,[t,s])=>t.evaluate(n)/s.evaluate(n)],"%":[nt,[nt,nt],(n,[t,s])=>t.evaluate(n)%s.evaluate(n)],ln2:[nt,[],()=>Math.LN2],pi:[nt,[],()=>Math.PI],e:[nt,[],()=>Math.E],"^":[nt,[nt,nt],(n,[t,s])=>Math.pow(t.evaluate(n),s.evaluate(n))],sqrt:[nt,[nt],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[nt,[nt],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[nt,[nt],(n,[t])=>Math.log(t.evaluate(n))],log2:[nt,[nt],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[nt,[nt],(n,[t])=>Math.sin(t.evaluate(n))],cos:[nt,[nt],(n,[t])=>Math.cos(t.evaluate(n))],tan:[nt,[nt],(n,[t])=>Math.tan(t.evaluate(n))],asin:[nt,[nt],(n,[t])=>Math.asin(t.evaluate(n))],acos:[nt,[nt],(n,[t])=>Math.acos(t.evaluate(n))],atan:[nt,[nt],(n,[t])=>Math.atan(t.evaluate(n))],min:[nt,Us(nt),(n,t)=>Math.min(...t.map(s=>s.evaluate(n)))],max:[nt,Us(nt),(n,t)=>Math.max(...t.map(s=>s.evaluate(n)))],abs:[nt,[nt],(n,[t])=>Math.abs(t.evaluate(n))],round:[nt,[nt],(n,[t])=>{const s=t.evaluate(n);return s<0?-Math.round(-s):Math.round(s)}],floor:[nt,[nt],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[nt,[nt],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[Nt,[ci,ri],(n,[t,s])=>n.properties()[t.value]===s.value],"filter-id-==":[Nt,[ri],(n,[t])=>n.id()===t.value],"filter-type-==":[Nt,[ci],(n,[t])=>n.geometryType()===t.value],"filter-<":[Nt,[ci,ri],(n,[t,s])=>{const c=n.properties()[t.value],f=s.value;return typeof c==typeof f&&c<f}],"filter-id-<":[Nt,[ri],(n,[t])=>{const s=n.id(),c=t.value;return typeof s==typeof c&&s<c}],"filter->":[Nt,[ci,ri],(n,[t,s])=>{const c=n.properties()[t.value],f=s.value;return typeof c==typeof f&&c>f}],"filter-id->":[Nt,[ri],(n,[t])=>{const s=n.id(),c=t.value;return typeof s==typeof c&&s>c}],"filter-<=":[Nt,[ci,ri],(n,[t,s])=>{const c=n.properties()[t.value],f=s.value;return typeof c==typeof f&&c<=f}],"filter-id-<=":[Nt,[ri],(n,[t])=>{const s=n.id(),c=t.value;return typeof s==typeof c&&s<=c}],"filter->=":[Nt,[ci,ri],(n,[t,s])=>{const c=n.properties()[t.value],f=s.value;return typeof c==typeof f&&c>=f}],"filter-id->=":[Nt,[ri],(n,[t])=>{const s=n.id(),c=t.value;return typeof s==typeof c&&s>=c}],"filter-has":[Nt,[ri],(n,[t])=>t.value in n.properties()],"filter-has-id":[Nt,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Nt,[H(ci)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[Nt,[H(ri)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[Nt,[ci,H(ri)],(n,[t,s])=>s.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[Nt,[ci,H(ri)],(n,[t,s])=>function(c,f,v,x){for(;v<=x;){const w=v+x>>1;if(f[w]===c)return!0;f[w]>c?x=w-1:v=w+1}return!1}(n.properties()[t.value],s.value,0,s.value.length-1)],all:{type:Nt,overloads:[[[Nt,Nt],(n,[t,s])=>t.evaluate(n)&&s.evaluate(n)],[Us(Nt),(n,t)=>{for(const s of t)if(!s.evaluate(n))return!1;return!0}]]},any:{type:Nt,overloads:[[[Nt,Nt],(n,[t,s])=>t.evaluate(n)||s.evaluate(n)],[Us(Nt),(n,t)=>{for(const s of t)if(s.evaluate(n))return!0;return!1}]]},"!":[Nt,[Nt],(n,[t])=>!t.evaluate(n)],"is-supported-script":[Nt,[ci],(n,[t])=>{const s=n.globals&&n.globals.isSupportedScript;return!s||s(t.evaluate(n))}],upcase:[ci,[ci],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[ci,[ci],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[ci,Us(ri),(n,t)=>t.map(s=>co(s.evaluate(n))).join("")],"resolved-locale":[ci,[ea],(n,[t])=>t.evaluate(n).resolvedLocale()]});class $i{constructor(t,s){var c;this.expression=t,this._warningHistory={},this._evaluator=new qi,this._defaultValue=s?(c=s).type==="color"&&Wo(c.default)?new Vi(0,0,0,0):c.type==="color"?Vi.parse(c.default)||null:c.type==="padding"?xn.parse(c.default)||null:c.type==="variableAnchorOffsetCollection"?kr.parse(c.default)||null:c.default===void 0?null:c.default:null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(t,s,c,f,v,x){return this._evaluator.globals=t,this._evaluator.feature=s,this._evaluator.featureState=c,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(t,s,c,f,v,x){this._evaluator.globals=t,this._evaluator.feature=s||null,this._evaluator.featureState=c||null,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new dr(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function Ji(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Ua}function bs(n,t){const s=new Oo(Ua,Tr,[],t?function(f){const v={color:ji,string:ci,number:nt,enum:ci,boolean:Nt,formatted:Er,padding:te,resolvedImage:N,variableAnchorOffsetCollection:U};return f.type==="array"?H(v[f.value]||ri,f.length):v[f.type]}(t):void 0),c=s.parse(n,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?Zo(new $i(c,t)):ra(s.errors)}class na{constructor(t,s){this.kind=t,this._styleExpression=s,this.isStateDependent=t!=="constant"&&!_a(s.expression)}evaluateWithoutErrorHandling(t,s,c,f,v,x){return this._styleExpression.evaluateWithoutErrorHandling(t,s,c,f,v,x)}evaluate(t,s,c,f,v,x){return this._styleExpression.evaluate(t,s,c,f,v,x)}}class Xo{constructor(t,s,c,f){this.kind=t,this.zoomStops=c,this._styleExpression=s,this.isStateDependent=t!=="camera"&&!_a(s.expression),this.interpolationType=f}evaluateWithoutErrorHandling(t,s,c,f,v,x){return this._styleExpression.evaluateWithoutErrorHandling(t,s,c,f,v,x)}evaluate(t,s,c,f,v,x){return this._styleExpression.evaluate(t,s,c,f,v,x)}interpolationFactor(t,s,c){return this.interpolationType?Jr.interpolationFactor(this.interpolationType,t,s,c):0}}function Rl(n,t){const s=bs(n,t);if(s.result==="error")return s;const c=s.value.expression,f=vr(c);if(!f&&!xs(t))return ra([new Yi("","data expressions not supported")]);const v=fo(c,["zoom"]);if(!v&&!bc(t))return ra([new Yi("","zoom expressions not supported")]);const x=Yo(c);return x||v?x instanceof Yi?ra([x]):x instanceof Jr&&!kl(t)?ra([new Yi("",'"interpolate" expressions cannot be used with this property')]):Zo(x?new Xo(f?"camera":"composite",s.value,x.labels,x instanceof Jr?x.interpolation:void 0):new na(f?"constant":"source",s.value)):ra([new Yi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ko{constructor(t,s){this._parameters=t,this._specification=s,Ni(this,Ll(this._parameters,this._specification))}static deserialize(t){return new Ko(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Yo(n){let t=null;if(n instanceof Bo)t=Yo(n.result);else if(n instanceof Fo){for(const s of n.args)if(t=Yo(s),t)break}else(n instanceof Na||n instanceof Jr)&&n.input instanceof xi&&n.input.name==="zoom"&&(t=n);return t instanceof Yi||n.eachChild(s=>{const c=Yo(s);c instanceof Yi?t=c:!t&&c?t=new Yi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&c&&t!==c&&(t=new Yi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function go(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const t of n.slice(1))if(!go(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const zl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function wa(n){if(n==null)return{filter:()=>!0,needGeometry:!1};go(n)||(n=as(n));const t=bs(n,zl);if(t.result==="error")throw new Error(t.value.map(s=>`${s.key}: ${s.message}`).join(", "));return{filter:(s,c,f)=>t.value.evaluate(s,c,{},f),needGeometry:Jo(n)}}function Ma(n,t){return n<t?-1:n>t?1:0}function Jo(n){if(!Array.isArray(n))return!1;if(n[0]==="within")return!0;for(let t=1;t<n.length;t++)if(Jo(n[t]))return!0;return!1}function as(n){if(!n)return!0;const t=n[0];return n.length<=1?t!=="any":t==="=="?Ol(n[1],n[2],"=="):t==="!="?Qo(Ol(n[1],n[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Ol(n[1],n[2],t):t==="any"?(s=n.slice(1),["any"].concat(s.map(as))):t==="all"?["all"].concat(n.slice(1).map(as)):t==="none"?["all"].concat(n.slice(1).map(as).map(Qo)):t==="in"?sa(n[1],n.slice(2)):t==="!in"?Qo(sa(n[1],n.slice(2))):t==="has"?Fl(n[1]):t==="!has"?Qo(Fl(n[1])):t!=="within"||n;var s}function Ol(n,t,s){switch(n){case"$type":return[`filter-type-${s}`,t];case"$id":return[`filter-id-${s}`,t];default:return[`filter-${s}`,n,t]}}function sa(n,t){if(t.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(s=>typeof s!=typeof t[0])?["filter-in-large",n,["literal",t.sort(Ma)]]:["filter-in-small",n,["literal",t]]}}function Fl(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Qo(n){return["!",n]}function ja(n){const t=typeof n;if(t==="number"||t==="boolean"||t==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let f="[";for(const v of n)f+=`${ja(v)},`;return`${f}]`}const s=Object.keys(n).sort();let c="{";for(let f=0;f<s.length;f++)c+=`${JSON.stringify(s[f])}:${ja(n[s[f]])},`;return`${c}}`}function Bl(n){let t="";for(const s of pt)t+=`/${ja(n[s])}`;return t}function Nl(n){const t=n.value;return t?[new Ue(n.key,t,"constants have been deprecated as of v8")]:[]}function fr(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function js(n){if(Array.isArray(n))return n.map(js);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const t={};for(const s in n)t[s]=js(n[s]);return t}return fr(n)}function jr(n){const t=n.key,s=n.value,c=n.valueSpec||{},f=n.objectElementValidators||{},v=n.style,x=n.styleSpec,w=n.validateSpec;let T=[];const I=ki(s);if(I!=="object")return[new Ue(t,s,`object expected, ${I} found`)];for(const L in s){const O=L.split(".")[0],$=c[O]||c["*"];let j;if(f[O])j=f[O];else if(c[O])j=w;else if(f["*"])j=f["*"];else{if(!c["*"]){T.push(new Ue(t,s[L],`unknown property "${L}"`));continue}j=w}T=T.concat(j({key:(t&&`${t}.`)+L,value:s[L],valueSpec:$,style:v,styleSpec:x,object:s,objectKey:L,validateSpec:w},s))}for(const L in c)f[L]||c[L].required&&c[L].default===void 0&&s[L]===void 0&&T.push(new Ue(t,s,`missing required property "${L}"`));return T}function el(n){const t=n.value,s=n.valueSpec,c=n.style,f=n.styleSpec,v=n.key,x=n.arrayElementValidator||n.validateSpec;if(ki(t)!=="array")return[new Ue(v,t,`array expected, ${ki(t)} found`)];if(s.length&&t.length!==s.length)return[new Ue(v,t,`array length ${s.length} expected, length ${t.length} found`)];if(s["min-length"]&&t.length<s["min-length"])return[new Ue(v,t,`array length at least ${s["min-length"]} expected, length ${t.length} found`)];let w={type:s.value,values:s.values};f.$version<7&&(w.function=s.function),ki(s.value)==="object"&&(w=s.value);let T=[];for(let I=0;I<t.length;I++)T=T.concat(x({array:t,arrayIndex:I,value:t[I],valueSpec:w,validateSpec:n.validateSpec,style:c,styleSpec:f,key:`${v}[${I}]`}));return T}function tl(n){const t=n.key,s=n.value,c=n.valueSpec;let f=ki(s);return f==="number"&&s!=s&&(f="NaN"),f!=="number"?[new Ue(t,s,`number expected, ${f} found`)]:"minimum"in c&&s<c.minimum?[new Ue(t,s,`${s} is less than the minimum value ${c.minimum}`)]:"maximum"in c&&s>c.maximum?[new Ue(t,s,`${s} is greater than the maximum value ${c.maximum}`)]:[]}function Ee(n){const t=n.valueSpec,s=fr(n.value.type);let c,f,v,x={};const w=s!=="categorical"&&n.value.property===void 0,T=!w,I=ki(n.value.stops)==="array"&&ki(n.value.stops[0])==="array"&&ki(n.value.stops[0][0])==="object",L=jr({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(j){if(s==="identity")return[new Ue(j.key,j.value,'identity function may not have a "stops" property')];let G=[];const K=j.value;return G=G.concat(el({key:j.key,value:K,valueSpec:j.valueSpec,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:O})),ki(K)==="array"&&K.length===0&&G.push(new Ue(j.key,K,"array must have at least one stop")),G},default:function(j){return j.validateSpec({key:j.key,value:j.value,valueSpec:t,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec})}}});return s==="identity"&&w&&L.push(new Ue(n.key,n.value,'missing required property "property"')),s==="identity"||n.value.stops||L.push(new Ue(n.key,n.value,'missing required property "stops"')),s==="exponential"&&n.valueSpec.expression&&!kl(n.valueSpec)&&L.push(new Ue(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(T&&!xs(n.valueSpec)?L.push(new Ue(n.key,n.value,"property functions not supported")):w&&!bc(n.valueSpec)&&L.push(new Ue(n.key,n.value,"zoom functions not supported"))),s!=="categorical"&&!I||n.value.property!==void 0||L.push(new Ue(n.key,n.value,'"property" property is required')),L;function O(j){let G=[];const K=j.value,re=j.key;if(ki(K)!=="array")return[new Ue(re,K,`array expected, ${ki(K)} found`)];if(K.length!==2)return[new Ue(re,K,`array length 2 expected, length ${K.length} found`)];if(I){if(ki(K[0])!=="object")return[new Ue(re,K,`object expected, ${ki(K[0])} found`)];if(K[0].zoom===void 0)return[new Ue(re,K,"object stop key must have zoom")];if(K[0].value===void 0)return[new Ue(re,K,"object stop key must have value")];if(v&&v>fr(K[0].zoom))return[new Ue(re,K[0].zoom,"stop zoom values must appear in ascending order")];fr(K[0].zoom)!==v&&(v=fr(K[0].zoom),f=void 0,x={}),G=G.concat(jr({key:`${re}[0]`,value:K[0],valueSpec:{zoom:{}},validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:tl,value:$}}))}else G=G.concat($({key:`${re}[0]`,value:K[0],valueSpec:{},validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec},K));return Ji(js(K[1]))?G.concat([new Ue(`${re}[1]`,K[1],"expressions are not allowed in function stops.")]):G.concat(j.validateSpec({key:`${re}[1]`,value:K[1],valueSpec:t,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec}))}function $(j,G){const K=ki(j.value),re=fr(j.value),he=j.value!==null?j.value:G;if(c){if(K!==c)return[new Ue(j.key,he,`${K} stop domain type must match previous stop domain type ${c}`)]}else c=K;if(K!=="number"&&K!=="string"&&K!=="boolean")return[new Ue(j.key,he,"stop domain value must be a number, string, or boolean")];if(K!=="number"&&s!=="categorical"){let Te=`number expected, ${K} found`;return xs(t)&&s===void 0&&(Te+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ue(j.key,he,Te)]}return s!=="categorical"||K!=="number"||isFinite(re)&&Math.floor(re)===re?s!=="categorical"&&K==="number"&&f!==void 0&&re<f?[new Ue(j.key,he,"stop domain values must appear in ascending order")]:(f=re,s==="categorical"&&re in x?[new Ue(j.key,he,"stop domain values must be unique")]:(x[re]=!0,[])):[new Ue(j.key,he,`integer expected, found ${re}`)]}}function Re(n){const t=(n.expressionContext==="property"?Rl:bs)(js(n.value),n.valueSpec);if(t.result==="error")return t.value.map(c=>new Ue(`${n.key}${c.key}`,n.value,c.message));const s=t.value.expression||t.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!s.outputDefined())return[new Ue(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!_a(s))return[new Ue(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!_a(s))return[new Ue(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!fo(s,["zoom","feature-state"]))return[new Ue(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!vr(s))return[new Ue(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function mt(n){const t=n.key,s=n.value,c=n.valueSpec,f=[];return Array.isArray(c.values)?c.values.indexOf(fr(s))===-1&&f.push(new Ue(t,s,`expected one of [${c.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(c.values).indexOf(fr(s))===-1&&f.push(new Ue(t,s,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(s)} found`)),f}function Wt(n){return go(js(n.value))?Re(Ni({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):tr(n)}function tr(n){const t=n.value,s=n.key;if(ki(t)!=="array")return[new Ue(s,t,`array expected, ${ki(t)} found`)];const c=n.styleSpec;let f,v=[];if(t.length<1)return[new Ue(s,t,"filter array must have at least 1 element")];switch(v=v.concat(mt({key:`${s}[0]`,value:t[0],valueSpec:c.filter_operator,style:n.style,styleSpec:n.styleSpec})),fr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&fr(t[1])==="$type"&&v.push(new Ue(s,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&v.push(new Ue(s,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(f=ki(t[1]),f!=="string"&&v.push(new Ue(`${s}[1]`,t[1],`string expected, ${f} found`)));for(let x=2;x<t.length;x++)f=ki(t[x]),fr(t[1])==="$type"?v=v.concat(mt({key:`${s}[${x}]`,value:t[x],valueSpec:c.geometry_type,style:n.style,styleSpec:n.styleSpec})):f!=="string"&&f!=="number"&&f!=="boolean"&&v.push(new Ue(`${s}[${x}]`,t[x],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let x=1;x<t.length;x++)v=v.concat(tr({key:`${s}[${x}]`,value:t[x],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":f=ki(t[1]),t.length!==2?v.push(new Ue(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):f!=="string"&&v.push(new Ue(`${s}[1]`,t[1],`string expected, ${f} found`));break;case"within":f=ki(t[1]),t.length!==2?v.push(new Ue(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):f!=="object"&&v.push(new Ue(`${s}[1]`,t[1],`object expected, ${f} found`))}return v}function Ci(n,t){const s=n.key,c=n.validateSpec,f=n.style,v=n.styleSpec,x=n.value,w=n.objectKey,T=v[`${t}_${n.layerType}`];if(!T)return[];const I=w.match(/^(.*)-transition$/);if(t==="paint"&&I&&T[I[1]]&&T[I[1]].transition)return c({key:s,value:x,valueSpec:v.transition,style:f,styleSpec:v});const L=n.valueSpec||T[w];if(!L)return[new Ue(s,x,`unknown property "${w}"`)];let O;if(ki(x)==="string"&&xs(L)&&!L.tokens&&(O=/^{([^}]+)}$/.exec(x)))return[new Ue(s,x,`"${w}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(O[1])} }\`.`)];const $=[];return n.layerType==="symbol"&&(w==="text-field"&&f&&!f.glyphs&&$.push(new Ue(s,x,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&Wo(js(x))&&fr(x.type)==="identity"&&$.push(new Ue(s,x,'"text-font" does not support identity functions'))),$.concat(c({key:n.key,value:x,valueSpec:L,style:f,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:w}))}function mr(n){return Ci(n,"paint")}function Cr(n){return Ci(n,"layout")}function Sn(n){let t=[];const s=n.value,c=n.key,f=n.style,v=n.styleSpec;s.type||s.ref||t.push(new Ue(c,s,'either "type" or "ref" is required'));let x=fr(s.type);const w=fr(s.ref);if(s.id){const T=fr(s.id);for(let I=0;I<n.arrayIndex;I++){const L=f.layers[I];fr(L.id)===T&&t.push(new Ue(c,s.id,`duplicate layer id "${s.id}", previously used at line ${L.id.__line__}`))}}if("ref"in s){let T;["type","source","source-layer","filter","layout"].forEach(I=>{I in s&&t.push(new Ue(c,s[I],`"${I}" is prohibited for ref layers`))}),f.layers.forEach(I=>{fr(I.id)===w&&(T=I)}),T?T.ref?t.push(new Ue(c,s.ref,"ref cannot reference another ref layer")):x=fr(T.type):t.push(new Ue(c,s.ref,`ref layer "${w}" not found`))}else if(x!=="background")if(s.source){const T=f.sources&&f.sources[s.source],I=T&&fr(T.type);T?I==="vector"&&x==="raster"?t.push(new Ue(c,s.source,`layer "${s.id}" requires a raster source`)):I!=="raster-dem"&&x==="hillshade"?t.push(new Ue(c,s.source,`layer "${s.id}" requires a raster-dem source`)):I==="raster"&&x!=="raster"?t.push(new Ue(c,s.source,`layer "${s.id}" requires a vector source`)):I!=="vector"||s["source-layer"]?I==="raster-dem"&&x!=="hillshade"?t.push(new Ue(c,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!s.paint||!s.paint["line-gradient"]||I==="geojson"&&T.lineMetrics||t.push(new Ue(c,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Ue(c,s,`layer "${s.id}" must specify a "source-layer"`)):t.push(new Ue(c,s.source,`source "${s.source}" not found`))}else t.push(new Ue(c,s,'missing required property "source"'));return t=t.concat(jr({key:c,value:s,valueSpec:v.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${c}.type`,value:s.type,valueSpec:v.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:s,objectKey:"type"}),filter:Wt,layout:T=>jr({layer:s,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":I=>Cr(Ni({layerType:x},I))}}),paint:T=>jr({layer:s,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":I=>mr(Ni({layerType:x},I))}})}})),t}function cr(n){const t=n.value,s=n.key,c=ki(t);return c!=="string"?[new Ue(s,t,`string expected, ${c} found`)]:[]}const Nr={promoteId:function({key:n,value:t}){if(ki(t)==="string")return cr({key:n,value:t});{const s=[];for(const c in t)s.push(...cr({key:`${n}.${c}`,value:t[c]}));return s}}};function os(n){const t=n.value,s=n.key,c=n.styleSpec,f=n.style,v=n.validateSpec;if(!t.type)return[new Ue(s,t,'"type" is required')];const x=fr(t.type);let w;switch(x){case"vector":case"raster":return w=jr({key:s,value:t,valueSpec:c[`source_${x.replace("-","_")}`],style:n.style,styleSpec:c,objectElementValidators:Nr,validateSpec:v}),w;case"raster-dem":return w=function(T){var I;const L=(I=T.sourceName)!==null&&I!==void 0?I:"",O=T.value,$=T.styleSpec,j=$.source_raster_dem,G=T.style;let K=[];const re=ki(O);if(O===void 0)return K;if(re!=="object")return K.push(new Ue("source_raster_dem",O,`object expected, ${re} found`)),K;const he=fr(O.encoding)==="custom",Te=["redFactor","greenFactor","blueFactor","baseShift"],pe=T.value.encoding?`"${T.value.encoding}"`:"Default";for(const be in O)!he&&Te.includes(be)?K.push(new Ue(be,O[be],`In "${L}": "${be}" is only valid when "encoding" is set to "custom". ${pe} encoding found`)):j[be]?K=K.concat(T.validateSpec({key:be,value:O[be],valueSpec:j[be],validateSpec:T.validateSpec,style:G,styleSpec:$})):K.push(new Ue(be,O[be],`unknown property "${be}"`));return K}({sourceName:s,value:t,style:n.style,styleSpec:c,validateSpec:v}),w;case"geojson":if(w=jr({key:s,value:t,valueSpec:c.source_geojson,style:f,styleSpec:c,validateSpec:v,objectElementValidators:Nr}),t.cluster)for(const T in t.clusterProperties){const[I,L]=t.clusterProperties[T],O=typeof I=="string"?[I,["accumulated"],["get",T]]:I;w.push(...Re({key:`${s}.${T}.map`,value:L,validateSpec:v,expressionContext:"cluster-map"})),w.push(...Re({key:`${s}.${T}.reduce`,value:O,validateSpec:v,expressionContext:"cluster-reduce"}))}return w;case"video":return jr({key:s,value:t,valueSpec:c.source_video,style:f,validateSpec:v,styleSpec:c});case"image":return jr({key:s,value:t,valueSpec:c.source_image,style:f,validateSpec:v,styleSpec:c});case"canvas":return[new Ue(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return mt({key:`${s}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:f,validateSpec:v,styleSpec:c})}}function ws(n){const t=n.value,s=n.styleSpec,c=s.light,f=n.style;let v=[];const x=ki(t);if(t===void 0)return v;if(x!=="object")return v=v.concat([new Ue("light",t,`object expected, ${x} found`)]),v;for(const w in t){const T=w.match(/^(.*)-transition$/);v=v.concat(T&&c[T[1]]&&c[T[1]].transition?n.validateSpec({key:w,value:t[w],valueSpec:s.transition,validateSpec:n.validateSpec,style:f,styleSpec:s}):c[w]?n.validateSpec({key:w,value:t[w],valueSpec:c[w],validateSpec:n.validateSpec,style:f,styleSpec:s}):[new Ue(w,t[w],`unknown property "${w}"`)])}return v}function fn(n){const t=n.value,s=n.styleSpec,c=s.sky,f=n.style,v=ki(t);if(t===void 0)return[];if(v!=="object")return[new Ue("sky",t,`object expected, ${v} found`)];let x=[];for(const w in t)x=x.concat(c[w]?En({key:w,value:t[w],valueSpec:c[w],style:f,styleSpec:s}):[new Ue(w,t[w],`unknown property "${w}"`)]);return x}function zn(n){const t=n.value,s=n.styleSpec,c=s.terrain,f=n.style;let v=[];const x=ki(t);if(t===void 0)return v;if(x!=="object")return v=v.concat([new Ue("terrain",t,`object expected, ${x} found`)]),v;for(const w in t)v=v.concat(c[w]?n.validateSpec({key:w,value:t[w],valueSpec:c[w],validateSpec:n.validateSpec,style:f,styleSpec:s}):[new Ue(w,t[w],`unknown property "${w}"`)]);return v}function Ms(n){let t=[];const s=n.value,c=n.key;if(Array.isArray(s)){const f=[],v=[];for(const x in s)s[x].id&&f.includes(s[x].id)&&t.push(new Ue(c,s,`all the sprites' ids must be unique, but ${s[x].id} is duplicated`)),f.push(s[x].id),s[x].url&&v.includes(s[x].url)&&t.push(new Ue(c,s,`all the sprites' URLs must be unique, but ${s[x].url} is duplicated`)),v.push(s[x].url),t=t.concat(jr({key:`${c}[${x}]`,value:s[x],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return t}return cr({key:c,value:s})}const Qr={"*":()=>[],array:el,boolean:function(n){const t=n.value,s=n.key,c=ki(t);return c!=="boolean"?[new Ue(s,t,`boolean expected, ${c} found`)]:[]},number:tl,color:function(n){const t=n.key,s=n.value,c=ki(s);return c!=="string"?[new Ue(t,s,`color expected, ${c} found`)]:Vi.parse(String(s))?[]:[new Ue(t,s,`color expected, "${s}" found`)]},constants:Nl,enum:mt,filter:Wt,function:Ee,layer:Sn,object:jr,source:os,light:ws,sky:fn,terrain:zn,string:cr,formatted:function(n){return cr(n).length===0?[]:Re(n)},resolvedImage:function(n){return cr(n).length===0?[]:Re(n)},padding:function(n){const t=n.key,s=n.value;if(ki(s)==="array"){if(s.length<1||s.length>4)return[new Ue(t,s,`padding requires 1 to 4 values; ${s.length} values found`)];const c={type:"number"};let f=[];for(let v=0;v<s.length;v++)f=f.concat(n.validateSpec({key:`${t}[${v}]`,value:s[v],validateSpec:n.validateSpec,valueSpec:c}));return f}return tl({key:t,value:s,valueSpec:{}})},variableAnchorOffsetCollection:function(n){const t=n.key,s=n.value,c=ki(s),f=n.styleSpec;if(c!=="array"||s.length<1||s.length%2!=0)return[new Ue(t,s,"variableAnchorOffsetCollection requires a non-empty array of even length")];let v=[];for(let x=0;x<s.length;x+=2)v=v.concat(mt({key:`${t}[${x}]`,value:s[x],valueSpec:f.layout_symbol["text-anchor"]})),v=v.concat(el({key:`${t}[${x+1}]`,value:s[x+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:f}));return v},sprite:Ms};function En(n){const t=n.value,s=n.valueSpec,c=n.styleSpec;return n.validateSpec=En,s.expression&&Wo(fr(t))?Ee(n):s.expression&&Ji(js(t))?Re(n):s.type&&Qr[s.type]?Qr[s.type](n):jr(Ni({},n,{valueSpec:s.type?c[s.type]:s}))}function Sa(n){const t=n.value,s=n.key,c=cr(n);return c.length||(t.indexOf("{fontstack}")===-1&&c.push(new Ue(s,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&c.push(new Ue(s,t,'"glyphs" url must include a "{range}" token'))),c}function Zn(n,t=ce){let s=[];return s=s.concat(En({key:"",value:n,valueSpec:t.$root,styleSpec:t,style:n,validateSpec:En,objectElementValidators:{glyphs:Sa,"*":()=>[]}})),n.constants&&(s=s.concat(Nl({key:"constants",value:n.constants,style:n,styleSpec:t,validateSpec:En}))),qa(s)}function Ss(n){return function(t){return n({...t,validateSpec:En})}}function qa(n){return[].concat(n).sort((t,s)=>t.line-s.line)}function Ai(n){return function(...t){return qa(n.apply(this,t))}}Zn.source=Ai(Ss(os)),Zn.sprite=Ai(Ss(Ms)),Zn.glyphs=Ai(Ss(Sa)),Zn.light=Ai(Ss(ws)),Zn.sky=Ai(Ss(fn)),Zn.terrain=Ai(Ss(zn)),Zn.layer=Ai(Ss(Sn)),Zn.filter=Ai(Ss(Wt)),Zn.paintProperty=Ai(Ss(mr)),Zn.layoutProperty=Ai(Ss(Cr));const Ri=Zn,il=Ri.light,Es=Ri.paintProperty,$l=Ri.layoutProperty;function en(n,t){let s=!1;if(t&&t.length)for(const c of t)n.fire(new De(new Error(c.message))),s=!0;return s}class On{constructor(t,s,c){const f=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const x=new Int32Array(this.arrayBuffer);t=x[0],this.d=(s=x[1])+2*(c=x[2]);for(let T=0;T<this.d*this.d;T++){const I=x[3+T],L=x[3+T+1];f.push(I===L?null:x.subarray(I,L))}const w=x[3+f.length+1];this.keys=x.subarray(x[3+f.length],w),this.bboxes=x.subarray(w),this.insert=this._insertReadonly}else{this.d=s+2*c;for(let x=0;x<this.d*this.d;x++)f.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=t,this.padding=c,this.scale=s/t,this.uid=0;const v=c/s*t;this.min=-v,this.max=t+v}insert(t,s,c,f,v){this._forEachCell(s,c,f,v,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(v)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,s,c,f,v,x){this.cells[v].push(x)}query(t,s,c,f,v){const x=this.min,w=this.max;if(t<=x&&s<=x&&w<=c&&w<=f&&!v)return Array.prototype.slice.call(this.keys);{const T=[];return this._forEachCell(t,s,c,f,this._queryCell,T,{},v),T}}_queryCell(t,s,c,f,v,x,w,T){const I=this.cells[v];if(I!==null){const L=this.keys,O=this.bboxes;for(let $=0;$<I.length;$++){const j=I[$];if(w[j]===void 0){const G=4*j;(T?T(O[G+0],O[G+1],O[G+2],O[G+3]):t<=O[G+2]&&s<=O[G+3]&&c>=O[G+0]&&f>=O[G+1])?(w[j]=!0,x.push(L[j])):w[j]=!1}}}}_forEachCell(t,s,c,f,v,x,w,T){const I=this._convertToCellCoord(t),L=this._convertToCellCoord(s),O=this._convertToCellCoord(c),$=this._convertToCellCoord(f);for(let j=I;j<=O;j++)for(let G=L;G<=$;G++){const K=this.d*G+j;if((!T||T(this._convertFromCellCoord(j),this._convertFromCellCoord(G),this._convertFromCellCoord(j+1),this._convertFromCellCoord(G+1)))&&v.call(this,t,s,c,f,K,x,w,T))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,s=3+this.cells.length+1+1;let c=0;for(let x=0;x<this.cells.length;x++)c+=this.cells[x].length;const f=new Int32Array(s+c+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;let v=s;for(let x=0;x<t.length;x++){const w=t[x];f[3+x]=v,f.set(w,v),v+=w.length}return f[3+t.length]=v,f.set(this.keys,v),v+=this.keys.length,f[3+t.length+1]=v,f.set(this.bboxes,v),v+=this.bboxes.length,f.buffer}static serialize(t,s){const c=t.toArrayBuffer();return s&&s.push(c),{buffer:c}}static deserialize(t){return new On(t.buffer)}}const tn={};function Tt(n,t,s={}){if(tn[n])throw new Error(`${n} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:n,writeable:!1}),tn[n]={klass:t,omit:s.omit||[],shallow:s.shallow||[]}}Tt("Object",Object),Tt("TransferableGridIndex",On),Tt("Color",Vi),Tt("Error",Error),Tt("AJAXError",Et),Tt("ResolvedImage",bn),Tt("StylePropertyFunction",Ko),Tt("StyleExpression",$i,{omit:["_evaluator"]}),Tt("ZoomDependentExpression",Xo),Tt("ZoomConstantExpression",na),Tt("CompoundExpression",xi,{omit:["_evaluate"]});for(const n in Ua)Ua[n]._classRegistryKey||Tt(`Expression_${n}`,Ua[n]);function Ea(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function ls(n,t){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error)return n;if(Ea(n)||hi(n))return t&&t.push(n),n;if(ArrayBuffer.isView(n)){const s=n;return t&&t.push(s.buffer),s}if(n instanceof ImageData)return t&&t.push(n.data.buffer),n;if(Array.isArray(n)){const s=[];for(const c of n)s.push(ls(c,t));return s}if(typeof n=="object"){const s=n.constructor,c=s._classRegistryKey;if(!c)throw new Error(`can't serialize object of unregistered class ${s.name}`);if(!tn[c])throw new Error(`${c} is not registered.`);const f=s.serialize?s.serialize(n,t):{};if(s.serialize){if(t&&f===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const v in n){if(!n.hasOwnProperty(v)||tn[c].omit.indexOf(v)>=0)continue;const x=n[v];f[v]=tn[c].shallow.indexOf(v)>=0?x:ls(x,t)}n instanceof Error&&(f.message=n.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(f.$name=c),f}throw new Error("can't serialize object of type "+typeof n)}function Wn(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||Ea(n)||hi(n)||ArrayBuffer.isView(n)||n instanceof ImageData)return n;if(Array.isArray(n))return n.map(Wn);if(typeof n=="object"){const t=n.$name||"Object";if(!tn[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:s}=tn[t];if(!s)throw new Error(`can't deserialize unregistered class ${t}`);if(s.deserialize)return s.deserialize(n);const c=Object.create(s.prototype);for(const f of Object.keys(n)){if(f==="$name")continue;const v=n[f];c[f]=tn[t].shallow.indexOf(f)>=0?v:Wn(v)}return c}throw new Error("can't deserialize object of type "+typeof n)}class Ul{constructor(){this.first=!0}update(t,s){const c=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=s),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=c,!0))}}const vt={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function aa(n){for(const t of n)if(vo(t.charCodeAt(0)))return!0;return!1}function yo(n){for(const t of n)if(!_o(t.charCodeAt(0)))return!1;return!0}function _o(n){return!(vt.Arabic(n)||vt["Arabic Supplement"](n)||vt["Arabic Extended-A"](n)||vt["Arabic Presentation Forms-A"](n)||vt["Arabic Presentation Forms-B"](n))}function vo(n){return!(n!==746&&n!==747&&(n<4352||!(vt["Bopomofo Extended"](n)||vt.Bopomofo(n)||vt["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||vt["CJK Compatibility Ideographs"](n)||vt["CJK Compatibility"](n)||vt["CJK Radicals Supplement"](n)||vt["CJK Strokes"](n)||!(!vt["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||vt["CJK Unified Ideographs Extension A"](n)||vt["CJK Unified Ideographs"](n)||vt["Enclosed CJK Letters and Months"](n)||vt["Hangul Compatibility Jamo"](n)||vt["Hangul Jamo Extended-A"](n)||vt["Hangul Jamo Extended-B"](n)||vt["Hangul Jamo"](n)||vt["Hangul Syllables"](n)||vt.Hiragana(n)||vt["Ideographic Description Characters"](n)||vt.Kanbun(n)||vt["Kangxi Radicals"](n)||vt["Katakana Phonetic Extensions"](n)||vt.Katakana(n)&&n!==12540||!(!vt["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!vt["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||vt["Unified Canadian Aboriginal Syllabics"](n)||vt["Unified Canadian Aboriginal Syllabics Extended"](n)||vt["Vertical Forms"](n)||vt["Yijing Hexagram Symbols"](n)||vt["Yi Syllables"](n)||vt["Yi Radicals"](n))))}function Ga(n){return!(vo(n)||function(t){return!!(vt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||vt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||vt["Letterlike Symbols"](t)||vt["Number Forms"](t)||vt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||vt["Control Pictures"](t)&&t!==9251||vt["Optical Character Recognition"](t)||vt["Enclosed Alphanumerics"](t)||vt["Geometric Shapes"](t)||vt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||vt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||vt["CJK Symbols and Punctuation"](t)||vt.Katakana(t)||vt["Private Use Area"](t)||vt["CJK Compatibility Forms"](t)||vt["Small Form Variants"](t)||vt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(n))}function Ta(n){return n>=1424&&n<=2303||vt["Arabic Presentation Forms-A"](n)||vt["Arabic Presentation Forms-B"](n)}function Qh(n,t){return!(!t&&Ta(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||vt.Khmer(n))}function Np(n){for(const t of n)if(Ta(t.charCodeAt(0)))return!0;return!1}const Ha=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class xr{constructor(t,s){this.zoom=t,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ul,this.transition={})}isSupportedScript(t){return function(s,c){for(const f of s)if(!Qh(f.charCodeAt(0),c))return!1;return!0}(t,Ha.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,s=t-Math.floor(t),c=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*s}}}class Vl{constructor(t,s){this.property=t,this.value=s,this.expression=function(c,f){if(Wo(c))return new Ko(c,f);if(Ji(c)){const v=Rl(c,f);if(v.result==="error")throw new Error(v.value.map(x=>`${x.key}: ${x.message}`).join(", "));return v.value}{let v=c;return f.type==="color"&&typeof c=="string"?v=Vi.parse(c):f.type!=="padding"||typeof c!="number"&&!Array.isArray(c)?f.type==="variableAnchorOffsetCollection"&&Array.isArray(c)&&(v=kr.parse(c)):v=xn.parse(c),{kind:"constant",evaluate:()=>v}}}(s===void 0?t.specification.default:s,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,s,c){return this.property.possiblyEvaluate(this,t,s,c)}}class wc{constructor(t){this.property=t,this.value=new Vl(t,void 0)}transitioned(t,s){return new ed(this.property,this.value,s,dt({},t.transition,this.transition),t.now)}untransitioned(){return new ed(this.property,this.value,null,{},0)}}class Mu{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Rt(this._values[t].value.value)}setValue(t,s){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new wc(this._values[t].property)),this._values[t].value=new Vl(this._values[t].property,s===null?void 0:Rt(s))}getTransition(t){return Rt(this._values[t].transition)}setTransition(t,s){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new wc(this._values[t].property)),this._values[t].transition=Rt(s)||void 0}serialize(){const t={};for(const s of Object.keys(this._values)){const c=this.getValue(s);c!==void 0&&(t[s]=c);const f=this.getTransition(s);f!==void 0&&(t[`${s}-transition`]=f)}return t}transitioned(t,s){const c=new td(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].transitioned(t,s._values[f]);return c}untransitioned(){const t=new td(this._properties);for(const s of Object.keys(this._values))t._values[s]=this._values[s].untransitioned();return t}}class ed{constructor(t,s,c,f,v){this.property=t,this.value=s,this.begin=v+f.delay||0,this.end=this.begin+f.duration||0,t.specification.transition&&(f.delay||f.duration)&&(this.prior=c)}possiblyEvaluate(t,s,c){const f=t.now||0,v=this.value.possiblyEvaluate(t,s,c),x=this.prior;if(x){if(f>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(f<this.begin)return x.possiblyEvaluate(t,s,c);{const w=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(t,s,c),v,function(T){if(T<=0)return 0;if(T>=1)return 1;const I=T*T,L=I*T;return 4*(T<.5?L:3*(T-I)+L-.75)}(w))}}return v}}class td{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,s,c){const f=new jl(this._properties);for(const v of Object.keys(this._values))f._values[v]=this._values[v].possiblyEvaluate(t,s,c);return f}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class id{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Rt(this._values[t].value)}setValue(t,s){this._values[t]=new Vl(this._values[t].property,s===null?void 0:Rt(s))}serialize(){const t={};for(const s of Object.keys(this._values)){const c=this.getValue(s);c!==void 0&&(t[s]=c)}return t}possiblyEvaluate(t,s,c){const f=new jl(this._properties);for(const v of Object.keys(this._values))f._values[v]=this._values[v].possiblyEvaluate(t,s,c);return f}}class qs{constructor(t,s,c){this.property=t,this.value=s,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,s,c,f){return this.property.evaluate(this.value,this.parameters,t,s,c,f)}}class jl{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class jt{constructor(t){this.specification=t}possiblyEvaluate(t,s){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(s)}interpolate(t,s,c){const f=pn[this.specification.type];return f?f(t,s,c):t}}class Qt{constructor(t,s){this.specification=t,this.overrides=s}possiblyEvaluate(t,s,c,f){return new qs(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(s,null,{},c,f)}:t.expression,s)}interpolate(t,s,c){if(t.value.kind!=="constant"||s.value.kind!=="constant")return t;if(t.value.value===void 0||s.value.value===void 0)return new qs(this,{kind:"constant",value:void 0},t.parameters);const f=pn[this.specification.type];if(f){const v=f(t.value.value,s.value.value,c);return new qs(this,{kind:"constant",value:v},t.parameters)}return t}evaluate(t,s,c,f,v,x){return t.kind==="constant"?t.value:t.evaluate(s,c,f,v,x)}}class Mc extends Qt{possiblyEvaluate(t,s,c,f){if(t.value===void 0)return new qs(this,{kind:"constant",value:void 0},s);if(t.expression.kind==="constant"){const v=t.expression.evaluate(s,null,{},c,f),x=t.property.specification.type==="resolvedImage"&&typeof v!="string"?v.name:v,w=this._calculate(x,x,x,s);return new qs(this,{kind:"constant",value:w},s)}if(t.expression.kind==="camera"){const v=this._calculate(t.expression.evaluate({zoom:s.zoom-1}),t.expression.evaluate({zoom:s.zoom}),t.expression.evaluate({zoom:s.zoom+1}),s);return new qs(this,{kind:"constant",value:v},s)}return new qs(this,t.expression,s)}evaluate(t,s,c,f,v,x){if(t.kind==="source"){const w=t.evaluate(s,c,f,v,x);return this._calculate(w,w,w,s)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(s.zoom)-1},c,f),t.evaluate({zoom:Math.floor(s.zoom)},c,f),t.evaluate({zoom:Math.floor(s.zoom)+1},c,f),s):t.value}_calculate(t,s,c,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:c,to:s}}interpolate(t){return t}}class ql{constructor(t){this.specification=t}possiblyEvaluate(t,s,c,f){if(t.value!==void 0){if(t.expression.kind==="constant"){const v=t.expression.evaluate(s,null,{},c,f);return this._calculate(v,v,v,s)}return this._calculate(t.expression.evaluate(new xr(Math.floor(s.zoom-1),s)),t.expression.evaluate(new xr(Math.floor(s.zoom),s)),t.expression.evaluate(new xr(Math.floor(s.zoom+1),s)),s)}}_calculate(t,s,c,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:c,to:s}}interpolate(t){return t}}class Su{constructor(t){this.specification=t}possiblyEvaluate(t,s,c,f){return!!t.expression.evaluate(s,null,{},c,f)}interpolate(){return!1}}class Xn{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in t){const c=t[s];c.specification.overridable&&this.overridableProperties.push(s);const f=this.defaultPropertyValues[s]=new Vl(c,void 0),v=this.defaultTransitionablePropertyValues[s]=new wc(c);this.defaultTransitioningPropertyValues[s]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=f.possiblyEvaluate({})}}}Tt("DataDrivenProperty",Qt),Tt("DataConstantProperty",jt),Tt("CrossFadedDataDrivenProperty",Mc),Tt("CrossFadedProperty",ql),Tt("ColorRampProperty",Su);const Eu="-transition";class Gs extends Fe{constructor(t,s){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),s.layout&&(this._unevaluatedLayout=new id(s.layout)),s.paint)){this._transitionablePaint=new Mu(s.paint);for(const c in t.paint)this.setPaintProperty(c,t.paint[c],{validate:!1});for(const c in t.layout)this.setLayoutProperty(c,t.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new jl(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,s,c={}){s!=null&&this._validate($l,`layers.${this.id}.layout.${t}`,t,s,c)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,s):this.visibility=s)}getPaintProperty(t){return t.endsWith(Eu)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,s,c={}){if(s!=null&&this._validate(Es,`layers.${this.id}.paint.${t}`,t,s,c))return!1;if(t.endsWith(Eu))return this._transitionablePaint.setTransition(t.slice(0,-11),s||void 0),!1;{const f=this._transitionablePaint._values[t],v=f.property.specification["property-type"]==="cross-faded-data-driven",x=f.value.isDataDriven(),w=f.value;this._transitionablePaint.setValue(t,s),this._handleSpecialPaintPropertyUpdate(t);const T=this._transitionablePaint._values[t].value;return T.isDataDriven()||x||v||this._handleOverridablePaintPropertyUpdate(t,w,T)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,s,c){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,s){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,s)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Ht(t,(s,c)=>!(s===void 0||c==="layout"&&!Object.keys(s).length||c==="paint"&&!Object.keys(s).length))}_validate(t,s,c,f,v={}){return(!v||v.validate!==!1)&&en(this,t.call(Ri,{key:s,layerType:this.type,objectKey:c,value:f,styleSpec:ce,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const s=this.paint.get(t);if(s instanceof qs&&xs(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}}const rd={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Gl{constructor(t,s){this._structArray=t,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class zr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,s){return t._trim(),s&&(t.isTransferred=!0,s.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const s=Object.create(this.prototype);return s.arrayBuffer=t.arrayBuffer,s.length=t.length,s.capacity=t.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function qr(n,t=1){let s=0,c=0;return{members:n.map(f=>{const v=rd[f.type].BYTES_PER_ELEMENT,x=s=nd(s,Math.max(t,v)),w=f.components||1;return c=Math.max(c,v),s+=v*w,{name:f.name,type:f.type,components:w,offset:x}}),size:nd(s,Math.max(c,t)),alignment:t}}function nd(n,t){return Math.ceil(n/t)*t}class Hl extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,s)}emplace(t,s,c){const f=2*t;return this.int16[f+0]=s,this.int16[f+1]=c,t}}Hl.prototype.bytesPerElement=4,Tt("StructArrayLayout2i4",Hl);class Ca extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,t,s,c)}emplace(t,s,c,f){const v=3*t;return this.int16[v+0]=s,this.int16[v+1]=c,this.int16[v+2]=f,t}}Ca.prototype.bytesPerElement=6,Tt("StructArrayLayout3i6",Ca);class Tu extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,f){const v=this.length;return this.resize(v+1),this.emplace(v,t,s,c,f)}emplace(t,s,c,f,v){const x=4*t;return this.int16[x+0]=s,this.int16[x+1]=c,this.int16[x+2]=f,this.int16[x+3]=v,t}}Tu.prototype.bytesPerElement=8,Tt("StructArrayLayout4i8",Tu);class Cu extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,f,v,x){const w=this.length;return this.resize(w+1),this.emplace(w,t,s,c,f,v,x)}emplace(t,s,c,f,v,x,w){const T=6*t;return this.int16[T+0]=s,this.int16[T+1]=c,this.int16[T+2]=f,this.int16[T+3]=v,this.int16[T+4]=x,this.int16[T+5]=w,t}}Cu.prototype.bytesPerElement=12,Tt("StructArrayLayout2i4i12",Cu);class Iu extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,f,v,x){const w=this.length;return this.resize(w+1),this.emplace(w,t,s,c,f,v,x)}emplace(t,s,c,f,v,x,w){const T=4*t,I=8*t;return this.int16[T+0]=s,this.int16[T+1]=c,this.uint8[I+4]=f,this.uint8[I+5]=v,this.uint8[I+6]=x,this.uint8[I+7]=w,t}}Iu.prototype.bytesPerElement=8,Tt("StructArrayLayout2i4ub8",Iu);class Zl extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,s)}emplace(t,s,c){const f=2*t;return this.float32[f+0]=s,this.float32[f+1]=c,t}}Zl.prototype.bytesPerElement=8,Tt("StructArrayLayout2f8",Zl);class Sc extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,f,v,x,w,T,I,L){const O=this.length;return this.resize(O+1),this.emplace(O,t,s,c,f,v,x,w,T,I,L)}emplace(t,s,c,f,v,x,w,T,I,L,O){const $=10*t;return this.uint16[$+0]=s,this.uint16[$+1]=c,this.uint16[$+2]=f,this.uint16[$+3]=v,this.uint16[$+4]=x,this.uint16[$+5]=w,this.uint16[$+6]=T,this.uint16[$+7]=I,this.uint16[$+8]=L,this.uint16[$+9]=O,t}}Sc.prototype.bytesPerElement=20,Tt("StructArrayLayout10ui20",Sc);class Au extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,f,v,x,w,T,I,L,O,$){const j=this.length;return this.resize(j+1),this.emplace(j,t,s,c,f,v,x,w,T,I,L,O,$)}emplace(t,s,c,f,v,x,w,T,I,L,O,$,j){const G=12*t;return this.int16[G+0]=s,this.int16[G+1]=c,this.int16[G+2]=f,this.int16[G+3]=v,this.uint16[G+4]=x,this.uint16[G+5]=w,this.uint16[G+6]=T,this.uint16[G+7]=I,this.int16[G+8]=L,this.int16[G+9]=O,this.int16[G+10]=$,this.int16[G+11]=j,t}}Au.prototype.bytesPerElement=24,Tt("StructArrayLayout4i4ui4i24",Au);class Pu extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,t,s,c)}emplace(t,s,c,f){const v=3*t;return this.float32[v+0]=s,this.float32[v+1]=c,this.float32[v+2]=f,t}}Pu.prototype.bytesPerElement=12,Tt("StructArrayLayout3f12",Pu);class Ia extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint32[1*t+0]=s,t}}Ia.prototype.bytesPerElement=4,Tt("StructArrayLayout1ul4",Ia);class Ec extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,f,v,x,w,T,I){const L=this.length;return this.resize(L+1),this.emplace(L,t,s,c,f,v,x,w,T,I)}emplace(t,s,c,f,v,x,w,T,I,L){const O=10*t,$=5*t;return this.int16[O+0]=s,this.int16[O+1]=c,this.int16[O+2]=f,this.int16[O+3]=v,this.int16[O+4]=x,this.int16[O+5]=w,this.uint32[$+3]=T,this.uint16[O+8]=I,this.uint16[O+9]=L,t}}Ec.prototype.bytesPerElement=20,Tt("StructArrayLayout6i1ul2ui20",Ec);class Wl extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,f,v,x){const w=this.length;return this.resize(w+1),this.emplace(w,t,s,c,f,v,x)}emplace(t,s,c,f,v,x,w){const T=6*t;return this.int16[T+0]=s,this.int16[T+1]=c,this.int16[T+2]=f,this.int16[T+3]=v,this.int16[T+4]=x,this.int16[T+5]=w,t}}Wl.prototype.bytesPerElement=12,Tt("StructArrayLayout2i2i2i12",Wl);class Tc extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,f,v){const x=this.length;return this.resize(x+1),this.emplace(x,t,s,c,f,v)}emplace(t,s,c,f,v,x){const w=4*t,T=8*t;return this.float32[w+0]=s,this.float32[w+1]=c,this.float32[w+2]=f,this.int16[T+6]=v,this.int16[T+7]=x,t}}Tc.prototype.bytesPerElement=16,Tt("StructArrayLayout2f1f2i16",Tc);class Xl extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,f){const v=this.length;return this.resize(v+1),this.emplace(v,t,s,c,f)}emplace(t,s,c,f,v){const x=12*t,w=3*t;return this.uint8[x+0]=s,this.uint8[x+1]=c,this.float32[w+1]=f,this.float32[w+2]=v,t}}Xl.prototype.bytesPerElement=12,Tt("StructArrayLayout2ub2f12",Xl);class Cc extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,t,s,c)}emplace(t,s,c,f){const v=3*t;return this.uint16[v+0]=s,this.uint16[v+1]=c,this.uint16[v+2]=f,t}}Cc.prototype.bytesPerElement=6,Tt("StructArrayLayout3ui6",Cc);class rl extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,f,v,x,w,T,I,L,O,$,j,G,K,re,he){const Te=this.length;return this.resize(Te+1),this.emplace(Te,t,s,c,f,v,x,w,T,I,L,O,$,j,G,K,re,he)}emplace(t,s,c,f,v,x,w,T,I,L,O,$,j,G,K,re,he,Te){const pe=24*t,be=12*t,$e=48*t;return this.int16[pe+0]=s,this.int16[pe+1]=c,this.uint16[pe+2]=f,this.uint16[pe+3]=v,this.uint32[be+2]=x,this.uint32[be+3]=w,this.uint32[be+4]=T,this.uint16[pe+10]=I,this.uint16[pe+11]=L,this.uint16[pe+12]=O,this.float32[be+7]=$,this.float32[be+8]=j,this.uint8[$e+36]=G,this.uint8[$e+37]=K,this.uint8[$e+38]=re,this.uint32[be+10]=he,this.int16[pe+22]=Te,t}}rl.prototype.bytesPerElement=48,Tt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",rl);class xo extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,f,v,x,w,T,I,L,O,$,j,G,K,re,he,Te,pe,be,$e,Ge,Ct,Bt,St,xt,lt,kt){const _t=this.length;return this.resize(_t+1),this.emplace(_t,t,s,c,f,v,x,w,T,I,L,O,$,j,G,K,re,he,Te,pe,be,$e,Ge,Ct,Bt,St,xt,lt,kt)}emplace(t,s,c,f,v,x,w,T,I,L,O,$,j,G,K,re,he,Te,pe,be,$e,Ge,Ct,Bt,St,xt,lt,kt,_t){const et=32*t,Jt=16*t;return this.int16[et+0]=s,this.int16[et+1]=c,this.int16[et+2]=f,this.int16[et+3]=v,this.int16[et+4]=x,this.int16[et+5]=w,this.int16[et+6]=T,this.int16[et+7]=I,this.uint16[et+8]=L,this.uint16[et+9]=O,this.uint16[et+10]=$,this.uint16[et+11]=j,this.uint16[et+12]=G,this.uint16[et+13]=K,this.uint16[et+14]=re,this.uint16[et+15]=he,this.uint16[et+16]=Te,this.uint16[et+17]=pe,this.uint16[et+18]=be,this.uint16[et+19]=$e,this.uint16[et+20]=Ge,this.uint16[et+21]=Ct,this.uint16[et+22]=Bt,this.uint32[Jt+12]=St,this.float32[Jt+13]=xt,this.float32[Jt+14]=lt,this.uint16[et+30]=kt,this.uint16[et+31]=_t,t}}xo.prototype.bytesPerElement=64,Tt("StructArrayLayout8i15ui1ul2f2ui64",xo);class Ic extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.float32[1*t+0]=s,t}}Ic.prototype.bytesPerElement=4,Tt("StructArrayLayout1f4",Ic);class Ac extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,t,s,c)}emplace(t,s,c,f){const v=3*t;return this.uint16[6*t+0]=s,this.float32[v+1]=c,this.float32[v+2]=f,t}}Ac.prototype.bytesPerElement=12,Tt("StructArrayLayout1ui2f12",Ac);class bo extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,t,s,c)}emplace(t,s,c,f){const v=4*t;return this.uint32[2*t+0]=s,this.uint16[v+2]=c,this.uint16[v+3]=f,t}}bo.prototype.bytesPerElement=8,Tt("StructArrayLayout1ul2ui8",bo);class Du extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,s)}emplace(t,s,c){const f=2*t;return this.uint16[f+0]=s,this.uint16[f+1]=c,t}}Du.prototype.bytesPerElement=4,Tt("StructArrayLayout2ui4",Du);class ku extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint16[1*t+0]=s,t}}ku.prototype.bytesPerElement=2,Tt("StructArrayLayout1ui2",ku);class Pc extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,f){const v=this.length;return this.resize(v+1),this.emplace(v,t,s,c,f)}emplace(t,s,c,f,v){const x=4*t;return this.float32[x+0]=s,this.float32[x+1]=c,this.float32[x+2]=f,this.float32[x+3]=v,t}}Pc.prototype.bytesPerElement=16,Tt("StructArrayLayout4f16",Pc);class sd extends Gl{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new D(this.anchorPointX,this.anchorPointY)}}sd.prototype.size=20;class y extends Ec{get(t){return new sd(this,t)}}Tt("CollisionBoxArray",y);class i extends Gl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}i.prototype.size=48;class o extends rl{get(t){return new i(this,t)}}Tt("PlacedSymbolArray",o);class h extends Gl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}h.prototype.size=64;class p extends xo{get(t){return new h(this,t)}}Tt("SymbolInstanceArray",p);class _ extends Ic{getoffsetX(t){return this.float32[1*t+0]}}Tt("GlyphOffsetArray",_);class S extends Ca{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Tt("SymbolLineVertexArray",S);class E extends Gl{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}E.prototype.size=12;class C extends Ac{get(t){return new E(this,t)}}Tt("TextAnchorOffsetArray",C);class k extends Gl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}k.prototype.size=8;class F extends bo{get(t){return new k(this,t)}}Tt("FeatureIndexArray",F);class B extends Hl{}class q extends Hl{}class ie extends Hl{}class ee extends Cu{}class ne extends Iu{}class X extends Zl{}class fe extends Sc{}class Ie extends Au{}class le extends Pu{}class we extends Ia{}class Ae extends Wl{}class ke extends Xl{}class Oe extends Cc{}class We extends Du{}const He=qr([{name:"a_pos",components:2,type:"Int16"}],4),{members:st}=He;class ht{constructor(t=[]){this.segments=t}prepareSegment(t,s,c,f){let v=this.segments[this.segments.length-1];return t>ht.MAX_VERTEX_ARRAY_LENGTH&&ct(`Max vertices per segment is ${ht.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!v||v.vertexLength+t>ht.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==f)&&(v={vertexOffset:s.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},f!==void 0&&(v.sortKey=f),this.segments.push(v)),v}get(){return this.segments}destroy(){for(const t of this.segments)for(const s in t.vaos)t.vaos[s].destroy()}static simpleSegment(t,s,c,f){return new ht([{vertexOffset:t,primitiveOffset:s,vertexLength:c,primitiveLength:f,vaos:{},sortKey:0}])}}function di(n,t){return 256*(n=Ze(Math.floor(n),0,255))+Ze(Math.floor(t),0,255)}ht.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Tt("SegmentVector",ht);const yt=qr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ei={exports:{}},pi={exports:{}};pi.exports=function(n,t){var s,c,f,v,x,w,T,I;for(c=n.length-(s=3&n.length),f=t,x=3432918353,w=461845907,I=0;I<c;)T=255&n.charCodeAt(I)|(255&n.charCodeAt(++I))<<8|(255&n.charCodeAt(++I))<<16|(255&n.charCodeAt(++I))<<24,++I,f=27492+(65535&(v=5*(65535&(f=(f^=T=(65535&(T=(T=(65535&T)*x+(((T>>>16)*x&65535)<<16)&4294967295)<<15|T>>>17))*w+(((T>>>16)*w&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(T=0,s){case 3:T^=(255&n.charCodeAt(I+2))<<16;case 2:T^=(255&n.charCodeAt(I+1))<<8;case 1:f^=T=(65535&(T=(T=(65535&(T^=255&n.charCodeAt(I)))*x+(((T>>>16)*x&65535)<<16)&4294967295)<<15|T>>>17))*w+(((T>>>16)*w&65535)<<16)&4294967295}return f^=n.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0};var Li=pi.exports,ai={exports:{}};ai.exports=function(n,t){for(var s,c=n.length,f=t^c,v=0;c>=4;)s=1540483477*(65535&(s=255&n.charCodeAt(v)|(255&n.charCodeAt(++v))<<8|(255&n.charCodeAt(++v))<<16|(255&n.charCodeAt(++v))<<24))+((1540483477*(s>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),c-=4,++v;switch(c){case 3:f^=(255&n.charCodeAt(v+2))<<16;case 2:f^=(255&n.charCodeAt(v+1))<<8;case 1:f=1540483477*(65535&(f^=255&n.charCodeAt(v)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0};var mi=Li,bi=ai.exports;ei.exports=mi,ei.exports.murmur3=mi,ei.exports.murmur2=bi;var Or=M(ei.exports);class Qi{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,s,c,f){this.ids.push(cs(t)),this.positions.push(s,c,f)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const s=cs(t);let c=0,f=this.ids.length-1;for(;c<f;){const x=c+f>>1;this.ids[x]>=s?f=x:c=x+1}const v=[];for(;this.ids[c]===s;)v.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return v}static serialize(t,s){const c=new Float64Array(t.ids),f=new Uint32Array(t.positions);return rn(c,f,0,c.length-1),s&&s.push(c.buffer,f.buffer),{ids:c,positions:f}}static deserialize(t){const s=new Qi;return s.ids=t.ids,s.positions=t.positions,s.indexed=!0,s}}function cs(n){const t=+n;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Or(String(n))}function rn(n,t,s,c){for(;s<c;){const f=n[s+c>>1];let v=s-1,x=c+1;for(;;){do v++;while(n[v]<f);do x--;while(n[x]>f);if(v>=x)break;Ir(n,v,x),Ir(t,3*v,3*x),Ir(t,3*v+1,3*x+1),Ir(t,3*v+2,3*x+2)}x-s<c-x?(rn(n,t,s,x),s=x+1):(rn(n,t,x+1,c),c=x)}}function Ir(n,t,s){const c=n[t];n[t]=n[s],n[s]=c}Tt("FeaturePositionMap",Qi);class nn{constructor(t,s){this.gl=t.gl,this.location=s}}class us extends nn{constructor(t,s){super(t,s),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class oa extends nn{constructor(t,s){super(t,s),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Za extends nn{constructor(t,s){super(t,s),this.current=Vi.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Kl=new Float32Array(16);function Wa(n){return[di(255*n.r,255*n.g),di(255*n.b,255*n.a)]}class la{constructor(t,s,c){this.value=t,this.uniformNames=s.map(f=>`u_${f}`),this.type=c}setUniform(t,s,c){t.set(c.constantOr(this.value))}getBinding(t,s,c){return this.type==="color"?new Za(t,s):new us(t,s)}}class Wr{constructor(t,s){this.uniformNames=s.map(c=>`u_${c}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=t.tlbr}setUniform(t,s,c,f){const v=f==="u_pattern_to"?this.patternTo:f==="u_pattern_from"?this.patternFrom:f==="u_pixel_ratio_to"?this.pixelRatioTo:f==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&t.set(v)}getBinding(t,s,c){return c.substr(0,9)==="u_pattern"?new oa(t,s):new us(t,s)}}class Ar{constructor(t,s,c,f){this.expression=t,this.type=c,this.maxValue=0,this.paintVertexAttributes=s.map(v=>({name:`a_${v}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(t,s,c,f,v){const x=this.paintVertexArray.length,w=this.expression.evaluate(new xr(0),s,{},f,[],v);this.paintVertexArray.resize(t),this._setPaintValue(x,t,w)}updatePaintArray(t,s,c,f){const v=this.expression.evaluate({zoom:0},c,f);this._setPaintValue(t,s,v)}_setPaintValue(t,s,c){if(this.type==="color"){const f=Wa(c);for(let v=t;v<s;v++)this.paintVertexArray.emplace(v,f[0],f[1])}else{for(let f=t;f<s;f++)this.paintVertexArray.emplace(f,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class br{constructor(t,s,c,f,v,x){this.expression=t,this.uniformNames=s.map(w=>`u_${w}_t`),this.type=c,this.useIntegerZoom=f,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=s.map(w=>({name:`a_${w}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(t,s,c,f,v){const x=this.expression.evaluate(new xr(this.zoom),s,{},f,[],v),w=this.expression.evaluate(new xr(this.zoom+1),s,{},f,[],v),T=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(T,t,x,w)}updatePaintArray(t,s,c,f){const v=this.expression.evaluate({zoom:this.zoom},c,f),x=this.expression.evaluate({zoom:this.zoom+1},c,f);this._setPaintValue(t,s,v,x)}_setPaintValue(t,s,c,f){if(this.type==="color"){const v=Wa(c),x=Wa(f);for(let w=t;w<s;w++)this.paintVertexArray.emplace(w,v[0],v[1],x[0],x[1])}else{for(let v=t;v<s;v++)this.paintVertexArray.emplace(v,c,f);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(f))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,s){const c=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,f=Ze(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);t.set(f)}getBinding(t,s,c){return new us(t,s)}}class Ts{constructor(t,s,c,f,v,x){this.expression=t,this.type=s,this.useIntegerZoom=c,this.zoom=f,this.layerId=x,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v}populatePaintArray(t,s,c){const f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(f,t,s.patterns&&s.patterns[this.layerId],c)}updatePaintArray(t,s,c,f,v){this._setPaintValues(t,s,c.patterns&&c.patterns[this.layerId],v)}_setPaintValues(t,s,c,f){if(!f||!c)return;const{min:v,mid:x,max:w}=c,T=f[v],I=f[x],L=f[w];if(T&&I&&L)for(let O=t;O<s;O++)this.zoomInPaintVertexArray.emplace(O,I.tl[0],I.tl[1],I.br[0],I.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],I.pixelRatio,T.pixelRatio),this.zoomOutPaintVertexArray.emplace(O,I.tl[0],I.tl[1],I.br[0],I.br[1],L.tl[0],L.tl[1],L.br[0],L.br[1],I.pixelRatio,L.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,yt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,yt.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Xr{constructor(t,s,c){this.binders={},this._buffers=[];const f=[];for(const v in t.paint._values){if(!c(v))continue;const x=t.paint.get(v);if(!(x instanceof qs&&xs(x.property.specification)))continue;const w=Cs(v,t.type),T=x.value,I=x.property.specification.type,L=x.property.useIntegerZoom,O=x.property.specification["property-type"],$=O==="cross-faded"||O==="cross-faded-data-driven";if(T.kind==="constant")this.binders[v]=$?new Wr(T.value,w):new la(T.value,w,I),f.push(`/u_${v}`);else if(T.kind==="source"||$){const j=Kr(v,I,"source");this.binders[v]=$?new Ts(T,I,L,s,j,t.id):new Ar(T,w,I,j),f.push(`/a_${v}`)}else{const j=Kr(v,I,"composite");this.binders[v]=new br(T,w,I,L,s,j),f.push(`/z_${v}`)}}this.cacheKey=f.sort().join("")}getMaxValue(t){const s=this.binders[t];return s instanceof Ar||s instanceof br?s.maxValue:0}populatePaintArrays(t,s,c,f,v){for(const x in this.binders){const w=this.binders[x];(w instanceof Ar||w instanceof br||w instanceof Ts)&&w.populatePaintArray(t,s,c,f,v)}}setConstantPatternPositions(t,s){for(const c in this.binders){const f=this.binders[c];f instanceof Wr&&f.setConstantPatternPositions(t,s)}}updatePaintArrays(t,s,c,f,v){let x=!1;for(const w in t){const T=s.getPositions(w);for(const I of T){const L=c.feature(I.index);for(const O in this.binders){const $=this.binders[O];if(($ instanceof Ar||$ instanceof br||$ instanceof Ts)&&$.expression.isStateDependent===!0){const j=f.paint.get(O);$.expression=j.value,$.updatePaintArray(I.start,I.end,L,t[w],v),x=!0}}}}return x}defines(){const t=[];for(const s in this.binders){const c=this.binders[s];(c instanceof la||c instanceof Wr)&&t.push(...c.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return t}getBinderAttributes(){const t=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof Ar||c instanceof br)for(let f=0;f<c.paintVertexAttributes.length;f++)t.push(c.paintVertexAttributes[f].name);else if(c instanceof Ts)for(let f=0;f<yt.members.length;f++)t.push(yt.members[f].name)}return t}getBinderUniforms(){const t=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof la||c instanceof Wr||c instanceof br)for(const f of c.uniformNames)t.push(f)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,s){const c=[];for(const f in this.binders){const v=this.binders[f];if(v instanceof la||v instanceof Wr||v instanceof br){for(const x of v.uniformNames)if(s[x]){const w=v.getBinding(t,s[x],x);c.push({name:x,property:f,binding:w})}}}return c}setUniforms(t,s,c,f){for(const{name:v,property:x,binding:w}of s)this.binders[x].setUniform(w,f,c.get(x),v)}updatePaintBuffers(t){this._buffers=[];for(const s in this.binders){const c=this.binders[s];if(t&&c instanceof Ts){const f=t.fromScale===2?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(c instanceof Ar||c instanceof br)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}}upload(t){for(const s in this.binders){const c=this.binders[s];(c instanceof Ar||c instanceof br||c instanceof Ts)&&c.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const s=this.binders[t];(s instanceof Ar||s instanceof br||s instanceof Ts)&&s.destroy()}}}class Pr{constructor(t,s,c=()=>!0){this.programConfigurations={};for(const f of t)this.programConfigurations[f.id]=new Xr(f,s,c);this.needsUpload=!1,this._featureMap=new Qi,this._bufferOffset=0}populatePaintArrays(t,s,c,f,v,x){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(t,s,f,v,x);s.id!==void 0&&this._featureMap.add(s.id,c,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,s,c,f){for(const v of c)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(t,this._featureMap,s,v,f)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Cs(n,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}function Kr(n,t,s){const c={color:{source:Zl,composite:Pc},number:{source:Ic,composite:Zl}},f=function(v){return{"line-pattern":{source:fe,composite:fe},"fill-pattern":{source:fe,composite:fe},"fill-extrusion-pattern":{source:fe,composite:fe}}[v]}(n);return f&&f[s]||c[t][s]}Tt("ConstantBinder",la),Tt("CrossFadedConstantBinder",Wr),Tt("SourceExpressionBinder",Ar),Tt("CrossFadedCompositeBinder",Ts),Tt("CompositeExpressionBinder",br),Tt("ProgramConfiguration",Xr,{omit:["_buffers"]}),Tt("ProgramConfigurationSet",Pr);const $r=8192,Lu=Math.pow(2,14)-1,ad=-Lu-1;function wo(n){const t=$r/n.extent,s=n.loadGeometry();for(let c=0;c<s.length;c++){const f=s[c];for(let v=0;v<f.length;v++){const x=f[v],w=Math.round(x.x*t),T=Math.round(x.y*t);x.x=Ze(w,ad,Lu),x.y=Ze(T,ad,Lu),(w<x.x||w>x.x+1||T<x.y||T>x.y+1)&&ct("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return s}function Mo(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?wo(n):[]}}function Dc(n,t,s,c,f){n.emplaceBack(2*t+(c+1)/2,2*s+(f+1)/2)}class Xa{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new q,this.indexArray=new Oe,this.segments=new ht,this.programConfigurations=new Pr(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,c){const f=this.layers[0],v=[];let x=null,w=!1;f.type==="circle"&&(x=f.layout.get("circle-sort-key"),w=!x.isConstant());for(const{feature:T,id:I,index:L,sourceLayerIndex:O}of t){const $=this.layers[0]._featureFilter.needGeometry,j=Mo(T,$);if(!this.layers[0]._featureFilter.filter(new xr(this.zoom),j,c))continue;const G=w?x.evaluate(j,{},c):void 0,K={id:I,properties:T.properties,type:T.type,sourceLayerIndex:O,index:L,geometry:$?j.geometry:wo(T),patterns:{},sortKey:G};v.push(K)}w&&v.sort((T,I)=>T.sortKey-I.sortKey);for(const T of v){const{geometry:I,index:L,sourceLayerIndex:O}=T,$=t[L].feature;this.addFeature(T,I,L,c),s.featureIndex.insert($,I,L,O,this.index)}}update(t,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,st),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,s,c,f){for(const v of s)for(const x of v){const w=x.x,T=x.y;if(w<0||w>=$r||T<0||T>=$r)continue;const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),L=I.vertexLength;Dc(this.layoutVertexArray,w,T,-1,-1),Dc(this.layoutVertexArray,w,T,1,-1),Dc(this.layoutVertexArray,w,T,1,1),Dc(this.layoutVertexArray,w,T,-1,1),this.indexArray.emplaceBack(L,L+1,L+2),this.indexArray.emplaceBack(L,L+3,L+2),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,{},f)}}function Ru(n,t){for(let s=0;s<n.length;s++)if(Lc(t,n[s]))return!0;for(let s=0;s<t.length;s++)if(Lc(n,t[s]))return!0;return!!kc(n,t)}function od(n,t,s){return!!Lc(n,t)||!!$p(t,n,s)}function zu(n,t){if(n.length===1)return dg(t,n[0]);for(let s=0;s<t.length;s++){const c=t[s];for(let f=0;f<c.length;f++)if(Lc(n,c[f]))return!0}for(let s=0;s<n.length;s++)if(dg(t,n[s]))return!0;for(let s=0;s<t.length;s++)if(kc(n,t[s]))return!0;return!1}function Ou(n,t,s){if(n.length>1){if(kc(n,t))return!0;for(let c=0;c<t.length;c++)if($p(t[c],n,s))return!0}for(let c=0;c<n.length;c++)if($p(n[c],t,s))return!0;return!1}function kc(n,t){if(n.length===0||t.length===0)return!1;for(let s=0;s<n.length-1;s++){const c=n[s],f=n[s+1];for(let v=0;v<t.length-1;v++)if(Fu(c,f,t[v],t[v+1]))return!0}return!1}function Fu(n,t,s,c){return zt(n,s,c)!==zt(t,s,c)&&zt(n,t,s)!==zt(n,t,c)}function $p(n,t,s){const c=s*s;if(t.length===1)return n.distSqr(t[0])<c;for(let f=1;f<t.length;f++)if(hg(n,t[f-1],t[f])<c)return!0;return!1}function hg(n,t,s){const c=t.distSqr(s);if(c===0)return n.distSqr(t);const f=((n.x-t.x)*(s.x-t.x)+(n.y-t.y)*(s.y-t.y))/c;return n.distSqr(f<0?t:f>1?s:s.sub(t)._mult(f)._add(t))}function dg(n,t){let s,c,f,v=!1;for(let x=0;x<n.length;x++){s=n[x];for(let w=0,T=s.length-1;w<s.length;T=w++)c=s[w],f=s[T],c.y>t.y!=f.y>t.y&&t.x<(f.x-c.x)*(t.y-c.y)/(f.y-c.y)+c.x&&(v=!v)}return v}function Lc(n,t){let s=!1;for(let c=0,f=n.length-1;c<n.length;f=c++){const v=n[c],x=n[f];v.y>t.y!=x.y>t.y&&t.x<(x.x-v.x)*(t.y-v.y)/(x.y-v.y)+v.x&&(s=!s)}return s}function r1(n,t,s){const c=s[0],f=s[2];if(n.x<c.x&&t.x<c.x||n.x>f.x&&t.x>f.x||n.y<c.y&&t.y<c.y||n.y>f.y&&t.y>f.y)return!1;const v=zt(n,t,s[0]);return v!==zt(n,t,s[1])||v!==zt(n,t,s[2])||v!==zt(n,t,s[3])}function Bu(n,t,s){const c=t.paint.get(n).value;return c.kind==="constant"?c.value:s.programConfigurations.get(t.id).getMaxValue(n)}function ld(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function cd(n,t,s,c,f){if(!t[0]&&!t[1])return n;const v=D.convert(t)._mult(f);s==="viewport"&&v._rotate(-c);const x=[];for(let w=0;w<n.length;w++)x.push(n[w].sub(v));return x}let pg,fg;Tt("CircleBucket",Xa,{omit:["layers"]});var n1={get paint(){return fg=fg||new Xn({"circle-radius":new Qt(ce.paint_circle["circle-radius"]),"circle-color":new Qt(ce.paint_circle["circle-color"]),"circle-blur":new Qt(ce.paint_circle["circle-blur"]),"circle-opacity":new Qt(ce.paint_circle["circle-opacity"]),"circle-translate":new jt(ce.paint_circle["circle-translate"]),"circle-translate-anchor":new jt(ce.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new jt(ce.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new jt(ce.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Qt(ce.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Qt(ce.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Qt(ce.paint_circle["circle-stroke-opacity"])})},get layout(){return pg=pg||new Xn({"circle-sort-key":new Qt(ce.layout_circle["circle-sort-key"])})}},Kn=1e-6,Rc=typeof Float32Array<"u"?Float32Array:Array;function Up(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function mg(n,t,s){var c=t[0],f=t[1],v=t[2],x=t[3],w=t[4],T=t[5],I=t[6],L=t[7],O=t[8],$=t[9],j=t[10],G=t[11],K=t[12],re=t[13],he=t[14],Te=t[15],pe=s[0],be=s[1],$e=s[2],Ge=s[3];return n[0]=pe*c+be*w+$e*O+Ge*K,n[1]=pe*f+be*T+$e*$+Ge*re,n[2]=pe*v+be*I+$e*j+Ge*he,n[3]=pe*x+be*L+$e*G+Ge*Te,n[4]=(pe=s[4])*c+(be=s[5])*w+($e=s[6])*O+(Ge=s[7])*K,n[5]=pe*f+be*T+$e*$+Ge*re,n[6]=pe*v+be*I+$e*j+Ge*he,n[7]=pe*x+be*L+$e*G+Ge*Te,n[8]=(pe=s[8])*c+(be=s[9])*w+($e=s[10])*O+(Ge=s[11])*K,n[9]=pe*f+be*T+$e*$+Ge*re,n[10]=pe*v+be*I+$e*j+Ge*he,n[11]=pe*x+be*L+$e*G+Ge*Te,n[12]=(pe=s[12])*c+(be=s[13])*w+($e=s[14])*O+(Ge=s[15])*K,n[13]=pe*f+be*T+$e*$+Ge*re,n[14]=pe*v+be*I+$e*j+Ge*he,n[15]=pe*x+be*L+$e*G+Ge*Te,n}Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var Nu,s1=mg;function ud(n,t,s){var c=t[0],f=t[1],v=t[2],x=t[3];return n[0]=s[0]*c+s[4]*f+s[8]*v+s[12]*x,n[1]=s[1]*c+s[5]*f+s[9]*v+s[13]*x,n[2]=s[2]*c+s[6]*f+s[10]*v+s[14]*x,n[3]=s[3]*c+s[7]*f+s[11]*v+s[15]*x,n}Nu=new Rc(4),Rc!=Float32Array&&(Nu[0]=0,Nu[1]=0,Nu[2]=0,Nu[3]=0);class a1 extends Gs{constructor(t){super(t,n1)}createBucket(t){return new Xa(t)}queryRadius(t){const s=t;return Bu("circle-radius",this,s)+Bu("circle-stroke-width",this,s)+ld(this.paint.get("circle-translate"))}queryIntersectsFeature(t,s,c,f,v,x,w,T){const I=cd(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,w),L=this.paint.get("circle-radius").evaluate(s,c)+this.paint.get("circle-stroke-width").evaluate(s,c),O=this.paint.get("circle-pitch-alignment")==="map",$=O?I:function(G,K){return G.map(re=>gg(re,K))}(I,T),j=O?L*w:L;for(const G of f)for(const K of G){const re=O?K:gg(K,T);let he=j;const Te=ud([],[K.x,K.y,0,1],T);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?he*=Te[3]/x.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(he*=x.cameraToCenterDistance/Te[3]),od($,re,he))return!0}return!1}}function gg(n,t){const s=ud([],[n.x,n.y,0,1],t);return new D(s[0]/s[3],s[1]/s[3])}class yg extends Xa{}let _g;Tt("HeatmapBucket",yg,{omit:["layers"]});var o1={get paint(){return _g=_g||new Xn({"heatmap-radius":new Qt(ce.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Qt(ce.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new jt(ce.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Su(ce.paint_heatmap["heatmap-color"]),"heatmap-opacity":new jt(ce.paint_heatmap["heatmap-opacity"])})}};function Vp(n,{width:t,height:s},c,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==t*s*c)throw new RangeError(`mismatched image size. expected: ${f.length} but got: ${t*s*c}`)}else f=new Uint8Array(t*s*c);return n.width=t,n.height=s,n.data=f,n}function vg(n,{width:t,height:s},c){if(t===n.width&&s===n.height)return;const f=Vp({},{width:t,height:s},c);jp(n,f,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,t),height:Math.min(n.height,s)},c),n.width=t,n.height=s,n.data=f.data}function jp(n,t,s,c,f,v){if(f.width===0||f.height===0)return t;if(f.width>n.width||f.height>n.height||s.x>n.width-f.width||s.y>n.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>t.width||f.height>t.height||c.x>t.width-f.width||c.y>t.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const x=n.data,w=t.data;if(x===w)throw new Error("srcData equals dstData, so image is already copied");for(let T=0;T<f.height;T++){const I=((s.y+T)*n.width+s.x)*v,L=((c.y+T)*t.width+c.x)*v;for(let O=0;O<f.width*v;O++)w[L+O]=x[I+O]}return t}class $u{constructor(t,s){Vp(this,t,1,s)}resize(t){vg(this,t,1)}clone(){return new $u({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,c,f,v){jp(t,s,c,f,v,1)}}class Hs{constructor(t,s){Vp(this,t,4,s)}resize(t){vg(this,t,4)}replace(t,s){s?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Hs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,c,f,v){jp(t,s,c,f,v,4)}}function xg(n){const t={},s=n.resolution||256,c=n.clips?n.clips.length:1,f=n.image||new Hs({width:s,height:c});if(Math.log(s)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${s}`);const v=(x,w,T)=>{t[n.evaluationKey]=T;const I=n.expression.evaluate(t);f.data[x+w+0]=Math.floor(255*I.r/I.a),f.data[x+w+1]=Math.floor(255*I.g/I.a),f.data[x+w+2]=Math.floor(255*I.b/I.a),f.data[x+w+3]=Math.floor(255*I.a)};if(n.clips)for(let x=0,w=0;x<c;++x,w+=4*s)for(let T=0,I=0;T<s;T++,I+=4){const L=T/(s-1),{start:O,end:$}=n.clips[x];v(w,I,O*(1-L)+$*L)}else for(let x=0,w=0;x<s;x++,w+=4)v(0,w,x/(s-1));return f}Tt("AlphaImage",$u),Tt("RGBAImage",Hs);class l1 extends Gs{createBucket(t){return new yg(t)}constructor(t){super(t,o1),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=xg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let bg;var c1={get paint(){return bg=bg||new Xn({"hillshade-illumination-direction":new jt(ce.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new jt(ce.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new jt(ce.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new jt(ce.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new jt(ce.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new jt(ce.paint_hillshade["hillshade-accent-color"])})}};class u1 extends Gs{constructor(t){super(t,c1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const h1=qr([{name:"a_pos",components:2,type:"Int16"}],4),{members:d1}=h1;var qp={exports:{}};function hd(n,t,s){s=s||2;var c,f,v,x,w,T,I,L=t&&t.length,O=L?t[0]*s:n.length,$=wg(n,0,O,s,!0),j=[];if(!$||$.next===$.prev)return j;if(L&&($=function(K,re,he,Te){var pe,be,$e,Ge=[];for(pe=0,be=re.length;pe<be;pe++)($e=wg(K,re[pe]*Te,pe<be-1?re[pe+1]*Te:K.length,Te,!1))===$e.next&&($e.steiner=!0),Ge.push(x1($e));for(Ge.sort(y1),pe=0;pe<Ge.length;pe++)he=_1(Ge[pe],he);return he}(n,t,$,s)),n.length>80*s){c=v=n[0],f=x=n[1];for(var G=s;G<O;G+=s)(w=n[G])<c&&(c=w),(T=n[G+1])<f&&(f=T),w>v&&(v=w),T>x&&(x=T);I=(I=Math.max(v-c,x-f))!==0?32767/I:0}return Uu($,j,s,c,f,I,0),j}function wg(n,t,s,c,f){var v,x;if(f===Zp(n,t,s,c)>0)for(v=t;v<s;v+=c)x=Eg(v,n[v],n[v+1],x);else for(v=s-c;v>=t;v-=c)x=Eg(v,n[v],n[v+1],x);return x&&dd(x,x.next)&&(ju(x),x=x.next),x}function Yl(n,t){if(!n)return n;t||(t=n);var s,c=n;do if(s=!1,c.steiner||!dd(c,c.next)&&Gr(c.prev,c,c.next)!==0)c=c.next;else{if(ju(c),(c=t=c.prev)===c.next)break;s=!0}while(s||c!==t);return t}function Uu(n,t,s,c,f,v,x){if(n){!x&&v&&function(L,O,$,j){var G=L;do G.z===0&&(G.z=Gp(G.x,G.y,O,$,j)),G.prevZ=G.prev,G.nextZ=G.next,G=G.next;while(G!==L);G.prevZ.nextZ=null,G.prevZ=null,function(K){var re,he,Te,pe,be,$e,Ge,Ct,Bt=1;do{for(he=K,K=null,be=null,$e=0;he;){for($e++,Te=he,Ge=0,re=0;re<Bt&&(Ge++,Te=Te.nextZ);re++);for(Ct=Bt;Ge>0||Ct>0&&Te;)Ge!==0&&(Ct===0||!Te||he.z<=Te.z)?(pe=he,he=he.nextZ,Ge--):(pe=Te,Te=Te.nextZ,Ct--),be?be.nextZ=pe:K=pe,pe.prevZ=be,be=pe;he=Te}be.nextZ=null,Bt*=2}while($e>1)}(G)}(n,c,f,v);for(var w,T,I=n;n.prev!==n.next;)if(w=n.prev,T=n.next,v?f1(n,c,f,v):p1(n))t.push(w.i/s|0),t.push(n.i/s|0),t.push(T.i/s|0),ju(n),n=T.next,I=T.next;else if((n=T)===I){x?x===1?Uu(n=m1(Yl(n),t,s),t,s,c,f,v,2):x===2&&g1(n,t,s,c,f,v):Uu(Yl(n),t,s,c,f,v,1);break}}}function p1(n){var t=n.prev,s=n,c=n.next;if(Gr(t,s,c)>=0)return!1;for(var f=t.x,v=s.x,x=c.x,w=t.y,T=s.y,I=c.y,L=f<v?f<x?f:x:v<x?v:x,O=w<T?w<I?w:I:T<I?T:I,$=f>v?f>x?f:x:v>x?v:x,j=w>T?w>I?w:I:T>I?T:I,G=c.next;G!==t;){if(G.x>=L&&G.x<=$&&G.y>=O&&G.y<=j&&zc(f,w,v,T,x,I,G.x,G.y)&&Gr(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function f1(n,t,s,c){var f=n.prev,v=n,x=n.next;if(Gr(f,v,x)>=0)return!1;for(var w=f.x,T=v.x,I=x.x,L=f.y,O=v.y,$=x.y,j=w<T?w<I?w:I:T<I?T:I,G=L<O?L<$?L:$:O<$?O:$,K=w>T?w>I?w:I:T>I?T:I,re=L>O?L>$?L:$:O>$?O:$,he=Gp(j,G,t,s,c),Te=Gp(K,re,t,s,c),pe=n.prevZ,be=n.nextZ;pe&&pe.z>=he&&be&&be.z<=Te;){if(pe.x>=j&&pe.x<=K&&pe.y>=G&&pe.y<=re&&pe!==f&&pe!==x&&zc(w,L,T,O,I,$,pe.x,pe.y)&&Gr(pe.prev,pe,pe.next)>=0||(pe=pe.prevZ,be.x>=j&&be.x<=K&&be.y>=G&&be.y<=re&&be!==f&&be!==x&&zc(w,L,T,O,I,$,be.x,be.y)&&Gr(be.prev,be,be.next)>=0))return!1;be=be.nextZ}for(;pe&&pe.z>=he;){if(pe.x>=j&&pe.x<=K&&pe.y>=G&&pe.y<=re&&pe!==f&&pe!==x&&zc(w,L,T,O,I,$,pe.x,pe.y)&&Gr(pe.prev,pe,pe.next)>=0)return!1;pe=pe.prevZ}for(;be&&be.z<=Te;){if(be.x>=j&&be.x<=K&&be.y>=G&&be.y<=re&&be!==f&&be!==x&&zc(w,L,T,O,I,$,be.x,be.y)&&Gr(be.prev,be,be.next)>=0)return!1;be=be.nextZ}return!0}function m1(n,t,s){var c=n;do{var f=c.prev,v=c.next.next;!dd(f,v)&&Mg(f,c,c.next,v)&&Vu(f,v)&&Vu(v,f)&&(t.push(f.i/s|0),t.push(c.i/s|0),t.push(v.i/s|0),ju(c),ju(c.next),c=n=v),c=c.next}while(c!==n);return Yl(c)}function g1(n,t,s,c,f,v){var x=n;do{for(var w=x.next.next;w!==x.prev;){if(x.i!==w.i&&b1(x,w)){var T=Sg(x,w);return x=Yl(x,x.next),T=Yl(T,T.next),Uu(x,t,s,c,f,v,0),void Uu(T,t,s,c,f,v,0)}w=w.next}x=x.next}while(x!==n)}function y1(n,t){return n.x-t.x}function _1(n,t){var s=function(f,v){var x,w=v,T=f.x,I=f.y,L=-1/0;do{if(I<=w.y&&I>=w.next.y&&w.next.y!==w.y){var O=w.x+(I-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(O<=T&&O>L&&(L=O,x=w.x<w.next.x?w:w.next,O===T))return x}w=w.next}while(w!==v);if(!x)return null;var $,j=x,G=x.x,K=x.y,re=1/0;w=x;do T>=w.x&&w.x>=G&&T!==w.x&&zc(I<K?T:L,I,G,K,I<K?L:T,I,w.x,w.y)&&($=Math.abs(I-w.y)/(T-w.x),Vu(w,f)&&($<re||$===re&&(w.x>x.x||w.x===x.x&&v1(x,w)))&&(x=w,re=$)),w=w.next;while(w!==j);return x}(n,t);if(!s)return t;var c=Sg(s,n);return Yl(c,c.next),Yl(s,s.next)}function v1(n,t){return Gr(n.prev,n,t.prev)<0&&Gr(t.next,n,n.next)<0}function Gp(n,t,s,c,f){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-s)*f|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-c)*f|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function x1(n){var t=n,s=n;do(t.x<s.x||t.x===s.x&&t.y<s.y)&&(s=t),t=t.next;while(t!==n);return s}function zc(n,t,s,c,f,v,x,w){return(f-x)*(t-w)>=(n-x)*(v-w)&&(n-x)*(c-w)>=(s-x)*(t-w)&&(s-x)*(v-w)>=(f-x)*(c-w)}function b1(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!function(s,c){var f=s;do{if(f.i!==s.i&&f.next.i!==s.i&&f.i!==c.i&&f.next.i!==c.i&&Mg(f,f.next,s,c))return!0;f=f.next}while(f!==s);return!1}(n,t)&&(Vu(n,t)&&Vu(t,n)&&function(s,c){var f=s,v=!1,x=(s.x+c.x)/2,w=(s.y+c.y)/2;do f.y>w!=f.next.y>w&&f.next.y!==f.y&&x<(f.next.x-f.x)*(w-f.y)/(f.next.y-f.y)+f.x&&(v=!v),f=f.next;while(f!==s);return v}(n,t)&&(Gr(n.prev,n,t.prev)||Gr(n,t.prev,t))||dd(n,t)&&Gr(n.prev,n,n.next)>0&&Gr(t.prev,t,t.next)>0)}function Gr(n,t,s){return(t.y-n.y)*(s.x-t.x)-(t.x-n.x)*(s.y-t.y)}function dd(n,t){return n.x===t.x&&n.y===t.y}function Mg(n,t,s,c){var f=fd(Gr(n,t,s)),v=fd(Gr(n,t,c)),x=fd(Gr(s,c,n)),w=fd(Gr(s,c,t));return f!==v&&x!==w||!(f!==0||!pd(n,s,t))||!(v!==0||!pd(n,c,t))||!(x!==0||!pd(s,n,c))||!(w!==0||!pd(s,t,c))}function pd(n,t,s){return t.x<=Math.max(n.x,s.x)&&t.x>=Math.min(n.x,s.x)&&t.y<=Math.max(n.y,s.y)&&t.y>=Math.min(n.y,s.y)}function fd(n){return n>0?1:n<0?-1:0}function Vu(n,t){return Gr(n.prev,n,n.next)<0?Gr(n,t,n.next)>=0&&Gr(n,n.prev,t)>=0:Gr(n,t,n.prev)<0||Gr(n,n.next,t)<0}function Sg(n,t){var s=new Hp(n.i,n.x,n.y),c=new Hp(t.i,t.x,t.y),f=n.next,v=t.prev;return n.next=t,t.prev=n,s.next=f,f.prev=s,c.next=s,s.prev=c,v.next=c,c.prev=v,c}function Eg(n,t,s,c){var f=new Hp(n,t,s);return c?(f.next=c.next,f.prev=c,c.next.prev=f,c.next=f):(f.prev=f,f.next=f),f}function ju(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Hp(n,t,s){this.i=n,this.x=t,this.y=s,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Zp(n,t,s,c){for(var f=0,v=t,x=s-c;v<s;v+=c)f+=(n[x]-n[v])*(n[v+1]+n[x+1]),x=v;return f}qp.exports=hd,qp.exports.default=hd,hd.deviation=function(n,t,s,c){var f=t&&t.length,v=Math.abs(Zp(n,0,f?t[0]*s:n.length,s));if(f)for(var x=0,w=t.length;x<w;x++)v-=Math.abs(Zp(n,t[x]*s,x<w-1?t[x+1]*s:n.length,s));var T=0;for(x=0;x<c.length;x+=3){var I=c[x]*s,L=c[x+1]*s,O=c[x+2]*s;T+=Math.abs((n[I]-n[O])*(n[L+1]-n[I+1])-(n[I]-n[L])*(n[O+1]-n[I+1]))}return v===0&&T===0?0:Math.abs((T-v)/v)},hd.flatten=function(n){for(var t=n[0][0].length,s={vertices:[],holes:[],dimensions:t},c=0,f=0;f<n.length;f++){for(var v=0;v<n[f].length;v++)for(var x=0;x<t;x++)s.vertices.push(n[f][v][x]);f>0&&s.holes.push(c+=n[f-1].length)}return s};var Tg=M(qp.exports);function w1(n,t,s,c,f){Cg(n,t,s||0,c||n.length-1,f||M1)}function Cg(n,t,s,c,f){for(;c>s;){if(c-s>600){var v=c-s+1,x=t-s+1,w=Math.log(v),T=.5*Math.exp(2*w/3),I=.5*Math.sqrt(w*T*(v-T)/v)*(x-v/2<0?-1:1);Cg(n,t,Math.max(s,Math.floor(t-x*T/v+I)),Math.min(c,Math.floor(t+(v-x)*T/v+I)),f)}var L=n[t],O=s,$=c;for(qu(n,s,t),f(n[c],L)>0&&qu(n,s,c);O<$;){for(qu(n,O,$),O++,$--;f(n[O],L)<0;)O++;for(;f(n[$],L)>0;)$--}f(n[s],L)===0?qu(n,s,$):qu(n,++$,c),$<=t&&(s=$+1),t<=$&&(c=$-1)}}function qu(n,t,s){var c=n[t];n[t]=n[s],n[s]=c}function M1(n,t){return n<t?-1:n>t?1:0}function Wp(n,t){const s=n.length;if(s<=1)return[n];const c=[];let f,v;for(let x=0;x<s;x++){const w=Bi(n[x]);w!==0&&(n[x].area=Math.abs(w),v===void 0&&(v=w<0),v===w<0?(f&&c.push(f),f=[n[x]]):f.push(n[x]))}if(f&&c.push(f),t>1)for(let x=0;x<c.length;x++)c[x].length<=t||(w1(c[x],t,1,c[x].length-1,S1),c[x]=c[x].slice(0,t));return c}function S1(n,t){return t.area-n.area}function Xp(n,t,s){const c=s.patternDependencies;let f=!1;for(const v of t){const x=v.paint.get(`${n}-pattern`);x.isConstant()||(f=!0);const w=x.constantOr(null);w&&(f=!0,c[w.to]=!0,c[w.from]=!0)}return f}function Kp(n,t,s,c,f){const v=f.patternDependencies;for(const x of t){const w=x.paint.get(`${n}-pattern`).value;if(w.kind!=="constant"){let T=w.evaluate({zoom:c-1},s,{},f.availableImages),I=w.evaluate({zoom:c},s,{},f.availableImages),L=w.evaluate({zoom:c+1},s,{},f.availableImages);T=T&&T.name?T.name:T,I=I&&I.name?I.name:I,L=L&&L.name?L.name:L,v[T]=!0,v[I]=!0,v[L]=!0,s.patterns[x.id]={min:T,mid:I,max:L}}}return s}class Yp{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ie,this.indexArray=new Oe,this.indexArray2=new We,this.programConfigurations=new Pr(t.layers,t.zoom),this.segments=new ht,this.segments2=new ht,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,c){this.hasPattern=Xp("fill",this.layers,s);const f=this.layers[0].layout.get("fill-sort-key"),v=!f.isConstant(),x=[];for(const{feature:w,id:T,index:I,sourceLayerIndex:L}of t){const O=this.layers[0]._featureFilter.needGeometry,$=Mo(w,O);if(!this.layers[0]._featureFilter.filter(new xr(this.zoom),$,c))continue;const j=v?f.evaluate($,{},c,s.availableImages):void 0,G={id:T,properties:w.properties,type:w.type,sourceLayerIndex:L,index:I,geometry:O?$.geometry:wo(w),patterns:{},sortKey:j};x.push(G)}v&&x.sort((w,T)=>w.sortKey-T.sortKey);for(const w of x){const{geometry:T,index:I,sourceLayerIndex:L}=w;if(this.hasPattern){const O=Kp("fill",this.layers,w,this.zoom,s);this.patternFeatures.push(O)}else this.addFeature(w,T,I,c,{});s.featureIndex.insert(t[I].feature,T,I,L,this.index)}}update(t,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,c)}addFeatures(t,s,c){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,s,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,d1),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,s,c,f,v){for(const x of Wp(s,500)){let w=0;for(const j of x)w+=j.length;const T=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),I=T.vertexLength,L=[],O=[];for(const j of x){if(j.length===0)continue;j!==x[0]&&O.push(L.length/2);const G=this.segments2.prepareSegment(j.length,this.layoutVertexArray,this.indexArray2),K=G.vertexLength;this.layoutVertexArray.emplaceBack(j[0].x,j[0].y),this.indexArray2.emplaceBack(K+j.length-1,K),L.push(j[0].x),L.push(j[0].y);for(let re=1;re<j.length;re++)this.layoutVertexArray.emplaceBack(j[re].x,j[re].y),this.indexArray2.emplaceBack(K+re-1,K+re),L.push(j[re].x),L.push(j[re].y);G.vertexLength+=j.length,G.primitiveLength+=j.length}const $=Tg(L,O);for(let j=0;j<$.length;j+=3)this.indexArray.emplaceBack(I+$[j],I+$[j+1],I+$[j+2]);T.vertexLength+=w,T.primitiveLength+=$.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,v,f)}}let Ig,Ag;Tt("FillBucket",Yp,{omit:["layers","patternFeatures"]});var E1={get paint(){return Ag=Ag||new Xn({"fill-antialias":new jt(ce.paint_fill["fill-antialias"]),"fill-opacity":new Qt(ce.paint_fill["fill-opacity"]),"fill-color":new Qt(ce.paint_fill["fill-color"]),"fill-outline-color":new Qt(ce.paint_fill["fill-outline-color"]),"fill-translate":new jt(ce.paint_fill["fill-translate"]),"fill-translate-anchor":new jt(ce.paint_fill["fill-translate-anchor"]),"fill-pattern":new Mc(ce.paint_fill["fill-pattern"])})},get layout(){return Ig=Ig||new Xn({"fill-sort-key":new Qt(ce.layout_fill["fill-sort-key"])})}};class T1 extends Gs{constructor(t){super(t,E1)}recalculate(t,s){super.recalculate(t,s);const c=this.paint._values["fill-outline-color"];c.value.kind==="constant"&&c.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Yp(t)}queryRadius(){return ld(this.paint.get("fill-translate"))}queryIntersectsFeature(t,s,c,f,v,x,w){return zu(cd(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,w),f)}isTileClipped(){return!0}}const C1=qr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),I1=qr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:A1}=C1;var nl={},P1=P,Pg=Oc;function Oc(n,t,s,c,f){this.properties={},this.extent=s,this.type=0,this._pbf=n,this._geometry=-1,this._keys=c,this._values=f,n.readFields(D1,this,t)}function D1(n,t,s){n==1?t.id=s.readVarint():n==2?function(c,f){for(var v=c.readVarint()+c.pos;c.pos<v;){var x=f._keys[c.readVarint()],w=f._values[c.readVarint()];f.properties[x]=w}}(s,t):n==3?t.type=s.readVarint():n==4&&(t._geometry=s.pos)}function k1(n){for(var t,s,c=0,f=0,v=n.length,x=v-1;f<v;x=f++)c+=((s=n[x]).x-(t=n[f]).x)*(t.y+s.y);return c}Oc.types=["Unknown","Point","LineString","Polygon"],Oc.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var t,s=n.readVarint()+n.pos,c=1,f=0,v=0,x=0,w=[];n.pos<s;){if(f<=0){var T=n.readVarint();c=7&T,f=T>>3}if(f--,c===1||c===2)v+=n.readSVarint(),x+=n.readSVarint(),c===1&&(t&&w.push(t),t=[]),t.push(new P1(v,x));else{if(c!==7)throw new Error("unknown command "+c);t&&t.push(t[0].clone())}}return t&&w.push(t),w},Oc.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var t=n.readVarint()+n.pos,s=1,c=0,f=0,v=0,x=1/0,w=-1/0,T=1/0,I=-1/0;n.pos<t;){if(c<=0){var L=n.readVarint();s=7&L,c=L>>3}if(c--,s===1||s===2)(f+=n.readSVarint())<x&&(x=f),f>w&&(w=f),(v+=n.readSVarint())<T&&(T=v),v>I&&(I=v);else if(s!==7)throw new Error("unknown command "+s)}return[x,T,w,I]},Oc.prototype.toGeoJSON=function(n,t,s){var c,f,v=this.extent*Math.pow(2,s),x=this.extent*n,w=this.extent*t,T=this.loadGeometry(),I=Oc.types[this.type];function L(j){for(var G=0;G<j.length;G++){var K=j[G];j[G]=[360*(K.x+x)/v-180,360/Math.PI*Math.atan(Math.exp((180-360*(K.y+w)/v)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(c=0;c<T.length;c++)O[c]=T[c][0];L(T=O);break;case 2:for(c=0;c<T.length;c++)L(T[c]);break;case 3:for(T=function(j){var G=j.length;if(G<=1)return[j];for(var K,re,he=[],Te=0;Te<G;Te++){var pe=k1(j[Te]);pe!==0&&(re===void 0&&(re=pe<0),re===pe<0?(K&&he.push(K),K=[j[Te]]):K.push(j[Te]))}return K&&he.push(K),he}(T),c=0;c<T.length;c++)for(f=0;f<T[c].length;f++)L(T[c][f])}T.length===1?T=T[0]:I="Multi"+I;var $={type:"Feature",geometry:{type:I,coordinates:T},properties:this.properties};return"id"in this&&($.id=this.id),$};var L1=Pg,Dg=kg;function kg(n,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(R1,this,t),this.length=this._features.length}function R1(n,t,s){n===15?t.version=s.readVarint():n===1?t.name=s.readString():n===5?t.extent=s.readVarint():n===2?t._features.push(s.pos):n===3?t._keys.push(s.readString()):n===4&&t._values.push(function(c){for(var f=null,v=c.readVarint()+c.pos;c.pos<v;){var x=c.readVarint()>>3;f=x===1?c.readString():x===2?c.readFloat():x===3?c.readDouble():x===4?c.readVarint64():x===5?c.readVarint():x===6?c.readSVarint():x===7?c.readBoolean():null}return f}(s))}kg.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var t=this._pbf.readVarint()+this._pbf.pos;return new L1(this._pbf,t,this.extent,this._keys,this._values)};var z1=Dg;function O1(n,t,s){if(n===3){var c=new z1(s,s.readVarint()+s.pos);c.length&&(t[c.name]=c)}}nl.VectorTile=function(n,t){this.layers=n.readFields(O1,{},t)},nl.VectorTileFeature=Pg,nl.VectorTileLayer=Dg;const F1=nl.VectorTileFeature.types,Jp=Math.pow(2,13);function Gu(n,t,s,c,f,v,x,w){n.emplaceBack(t,s,2*Math.floor(c*Jp)+x,f*Jp*2,v*Jp*2,Math.round(w))}class Qp{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ee,this.centroidVertexArray=new B,this.indexArray=new Oe,this.programConfigurations=new Pr(t.layers,t.zoom),this.segments=new ht,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,c){this.features=[],this.hasPattern=Xp("fill-extrusion",this.layers,s);for(const{feature:f,id:v,index:x,sourceLayerIndex:w}of t){const T=this.layers[0]._featureFilter.needGeometry,I=Mo(f,T);if(!this.layers[0]._featureFilter.filter(new xr(this.zoom),I,c))continue;const L={id:v,sourceLayerIndex:w,index:x,geometry:T?I.geometry:wo(f),properties:f.properties,type:f.type,patterns:{}};this.hasPattern?this.features.push(Kp("fill-extrusion",this.layers,L,this.zoom,s)):this.addFeature(L,L.geometry,x,c,{}),s.featureIndex.insert(f,L.geometry,x,w,this.index,!0)}}addFeatures(t,s,c){for(const f of this.features){const{geometry:v}=f;this.addFeature(f,v,f.index,s,c)}}update(t,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,c)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,A1),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,I1.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,s,c,f,v){const x={x:0,y:0,vertexCount:0};for(const w of Wp(s,500)){let T=0;for(const G of w)T+=G.length;let I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const G of w){if(G.length===0||N1(G))continue;let K=0;for(let re=0;re<G.length;re++){const he=G[re];if(re>=1){const Te=G[re-1];if(!B1(he,Te)){I.vertexLength+4>ht.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const pe=he.sub(Te)._perp()._unit(),be=Te.dist(he);K+be>32768&&(K=0),Gu(this.layoutVertexArray,he.x,he.y,pe.x,pe.y,0,0,K),Gu(this.layoutVertexArray,he.x,he.y,pe.x,pe.y,0,1,K),x.x+=2*he.x,x.y+=2*he.y,x.vertexCount+=2,K+=be,Gu(this.layoutVertexArray,Te.x,Te.y,pe.x,pe.y,0,0,K),Gu(this.layoutVertexArray,Te.x,Te.y,pe.x,pe.y,0,1,K),x.x+=2*Te.x,x.y+=2*Te.y,x.vertexCount+=2;const $e=I.vertexLength;this.indexArray.emplaceBack($e,$e+2,$e+1),this.indexArray.emplaceBack($e+1,$e+2,$e+3),I.vertexLength+=4,I.primitiveLength+=2}}}}if(I.vertexLength+T>ht.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray)),F1[t.type]!=="Polygon")continue;const L=[],O=[],$=I.vertexLength;for(const G of w)if(G.length!==0){G!==w[0]&&O.push(L.length/2);for(let K=0;K<G.length;K++){const re=G[K];Gu(this.layoutVertexArray,re.x,re.y,0,0,1,1,0),x.x+=re.x,x.y+=re.y,x.vertexCount+=1,L.push(re.x),L.push(re.y)}}const j=Tg(L,O);for(let G=0;G<j.length;G+=3)this.indexArray.emplaceBack($+j[G],$+j[G+2],$+j[G+1]);I.primitiveLength+=j.length/3,I.vertexLength+=T}for(let w=0;w<x.vertexCount;w++)this.centroidVertexArray.emplaceBack(Math.floor(x.x/x.vertexCount),Math.floor(x.y/x.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,v,f)}}function B1(n,t){return n.x===t.x&&(n.x<0||n.x>$r)||n.y===t.y&&(n.y<0||n.y>$r)}function N1(n){return n.every(t=>t.x<0)||n.every(t=>t.x>$r)||n.every(t=>t.y<0)||n.every(t=>t.y>$r)}let Lg;Tt("FillExtrusionBucket",Qp,{omit:["layers","features"]});var $1={get paint(){return Lg=Lg||new Xn({"fill-extrusion-opacity":new jt(ce["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Qt(ce["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new jt(ce["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new jt(ce["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Mc(ce["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Qt(ce["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Qt(ce["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new jt(ce["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class U1 extends Gs{constructor(t){super(t,$1)}createBucket(t){return new Qp(t)}queryRadius(){return ld(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,s,c,f,v,x,w,T){const I=cd(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,w),L=this.paint.get("fill-extrusion-height").evaluate(s,c),O=this.paint.get("fill-extrusion-base").evaluate(s,c),$=function(G,K,re,he){const Te=[];for(const pe of G){const be=[pe.x,pe.y,0,1];ud(be,be,K),Te.push(new D(be[0]/be[3],be[1]/be[3]))}return Te}(I,T),j=function(G,K,re,he){const Te=[],pe=[],be=he[8]*K,$e=he[9]*K,Ge=he[10]*K,Ct=he[11]*K,Bt=he[8]*re,St=he[9]*re,xt=he[10]*re,lt=he[11]*re;for(const kt of G){const _t=[],et=[];for(const Jt of kt){const Ut=Jt.x,Ei=Jt.y,gr=he[0]*Ut+he[4]*Ei+he[12],wr=he[1]*Ut+he[5]*Ei+he[13],an=he[2]*Ut+he[6]*Ei+he[14],Is=he[3]*Ut+he[7]*Ei+he[15],Yn=an+Ge,Yr=Is+Ct,Tn=gr+Bt,Ln=wr+St,Jn=an+xt,Qn=Is+lt,on=new D((gr+be)/Yr,(wr+$e)/Yr);on.z=Yn/Yr,_t.push(on);const ln=new D(Tn/Qn,Ln/Qn);ln.z=Jn/Qn,et.push(ln)}Te.push(_t),pe.push(et)}return[Te,pe]}(f,O,L,T);return function(G,K,re){let he=1/0;zu(re,K)&&(he=Rg(re,K[0]));for(let Te=0;Te<K.length;Te++){const pe=K[Te],be=G[Te];for(let $e=0;$e<pe.length-1;$e++){const Ge=pe[$e],Ct=[Ge,pe[$e+1],be[$e+1],be[$e],Ge];Ru(re,Ct)&&(he=Math.min(he,Rg(re,Ct)))}}return he!==1/0&&he}(j[0],j[1],$)}}function Hu(n,t){return n.x*t.x+n.y*t.y}function Rg(n,t){if(n.length===1){let s=0;const c=t[s++];let f;for(;!f||c.equals(f);)if(f=t[s++],!f)return 1/0;for(;s<t.length;s++){const v=t[s],x=n[0],w=f.sub(c),T=v.sub(c),I=x.sub(c),L=Hu(w,w),O=Hu(w,T),$=Hu(T,T),j=Hu(I,w),G=Hu(I,T),K=L*$-O*O,re=($*j-O*G)/K,he=(L*G-O*j)/K,Te=c.z*(1-re-he)+f.z*re+v.z*he;if(isFinite(Te))return Te}return 1/0}{let s=1/0;for(const c of t)s=Math.min(s,c.z);return s}}const V1=qr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:j1}=V1,q1=qr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:G1}=q1,H1=nl.VectorTileFeature.types,Z1=Math.cos(Math.PI/180*37.5),zg=Math.pow(2,14)/.5;class ef{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new ne,this.layoutVertexArray2=new X,this.indexArray=new Oe,this.programConfigurations=new Pr(t.layers,t.zoom),this.segments=new ht,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,c){this.hasPattern=Xp("line",this.layers,s);const f=this.layers[0].layout.get("line-sort-key"),v=!f.isConstant(),x=[];for(const{feature:w,id:T,index:I,sourceLayerIndex:L}of t){const O=this.layers[0]._featureFilter.needGeometry,$=Mo(w,O);if(!this.layers[0]._featureFilter.filter(new xr(this.zoom),$,c))continue;const j=v?f.evaluate($,{},c):void 0,G={id:T,properties:w.properties,type:w.type,sourceLayerIndex:L,index:I,geometry:O?$.geometry:wo(w),patterns:{},sortKey:j};x.push(G)}v&&x.sort((w,T)=>w.sortKey-T.sortKey);for(const w of x){const{geometry:T,index:I,sourceLayerIndex:L}=w;if(this.hasPattern){const O=Kp("line",this.layers,w,this.zoom,s);this.patternFeatures.push(O)}else this.addFeature(w,T,I,c,{});s.featureIndex.insert(t[I].feature,T,I,L,this.index)}}update(t,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,c)}addFeatures(t,s,c){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,s,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,G1)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,j1),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,s,c,f,v){const x=this.layers[0].layout,w=x.get("line-join").evaluate(t,{}),T=x.get("line-cap"),I=x.get("line-miter-limit"),L=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const O of s)this.addLine(O,t,w,T,I,L);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,v,f)}addLine(t,s,c,f,v,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let he=0;he<t.length-1;he++)this.totalDistance+=t[he].dist(t[he+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w=H1[s.type]==="Polygon";let T=t.length;for(;T>=2&&t[T-1].equals(t[T-2]);)T--;let I=0;for(;I<T-1&&t[I].equals(t[I+1]);)I++;if(T<(w?3:2))return;c==="bevel"&&(v=1.05);const L=this.overscaling<=16?15*$r/(512*this.overscaling):0,O=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let $,j,G,K,re;this.e1=this.e2=-1,w&&($=t[T-2],re=t[I].sub($)._unit()._perp());for(let he=I;he<T;he++){if(G=he===T-1?w?t[I+1]:void 0:t[he+1],G&&t[he].equals(G))continue;re&&(K=re),$&&(j=$),$=t[he],re=G?G.sub($)._unit()._perp():K,K=K||re;let Te=K.add(re);Te.x===0&&Te.y===0||Te._unit();const pe=K.x*re.x+K.y*re.y,be=Te.x*re.x+Te.y*re.y,$e=be!==0?1/be:1/0,Ge=2*Math.sqrt(2-2*be),Ct=be<Z1&&j&&G,Bt=K.x*re.y-K.y*re.x>0;if(Ct&&he>I){const lt=$.dist(j);if(lt>2*L){const kt=$.sub($.sub(j)._mult(L/lt)._round());this.updateDistance(j,kt),this.addCurrentVertex(kt,K,0,0,O),j=kt}}const St=j&&G;let xt=St?c:w?"butt":f;if(St&&xt==="round"&&($e<x?xt="miter":$e<=2&&(xt="fakeround")),xt==="miter"&&$e>v&&(xt="bevel"),xt==="bevel"&&($e>2&&(xt="flipbevel"),$e<v&&(xt="miter")),j&&this.updateDistance(j,$),xt==="miter")Te._mult($e),this.addCurrentVertex($,Te,0,0,O);else if(xt==="flipbevel"){if($e>100)Te=re.mult(-1);else{const lt=$e*K.add(re).mag()/K.sub(re).mag();Te._perp()._mult(lt*(Bt?-1:1))}this.addCurrentVertex($,Te,0,0,O),this.addCurrentVertex($,Te.mult(-1),0,0,O)}else if(xt==="bevel"||xt==="fakeround"){const lt=-Math.sqrt($e*$e-1),kt=Bt?lt:0,_t=Bt?0:lt;if(j&&this.addCurrentVertex($,K,kt,_t,O),xt==="fakeround"){const et=Math.round(180*Ge/Math.PI/20);for(let Jt=1;Jt<et;Jt++){let Ut=Jt/et;if(Ut!==.5){const gr=Ut-.5;Ut+=Ut*gr*(Ut-1)*((1.0904+pe*(pe*(3.55645-1.43519*pe)-3.2452))*gr*gr+(.848013+pe*(.215638*pe-1.06021)))}const Ei=re.sub(K)._mult(Ut)._add(K)._unit()._mult(Bt?-1:1);this.addHalfVertex($,Ei.x,Ei.y,!1,Bt,0,O)}}G&&this.addCurrentVertex($,re,-kt,-_t,O)}else if(xt==="butt")this.addCurrentVertex($,Te,0,0,O);else if(xt==="square"){const lt=j?1:-1;this.addCurrentVertex($,Te,lt,lt,O)}else xt==="round"&&(j&&(this.addCurrentVertex($,K,0,0,O),this.addCurrentVertex($,K,1,1,O,!0)),G&&(this.addCurrentVertex($,re,-1,-1,O,!0),this.addCurrentVertex($,re,0,0,O)));if(Ct&&he<T-1){const lt=$.dist(G);if(lt>2*L){const kt=$.add(G.sub($)._mult(L/lt)._round());this.updateDistance($,kt),this.addCurrentVertex(kt,re,0,0,O),$=kt}}}}addCurrentVertex(t,s,c,f,v,x=!1){const w=s.y*f-s.x,T=-s.y-s.x*f;this.addHalfVertex(t,s.x+s.y*c,s.y-s.x*c,x,!1,c,v),this.addHalfVertex(t,w,T,x,!0,-f,v),this.distance>zg/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,s,c,f,v,x))}addHalfVertex({x:t,y:s},c,f,v,x,w,T){const I=.5*(this.lineClips?this.scaledDistance*(zg-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(v?1:0),(s<<1)+(x?1:0),Math.round(63*c)+128,Math.round(63*f)+128,1+(w===0?0:w<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const L=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,L),T.primitiveLength++),x?this.e2=L:this.e1=L}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,s){this.distance+=t.dist(s),this.updateScaledDistance()}}let Og,Fg;Tt("LineBucket",ef,{omit:["layers","patternFeatures"]});var Bg={get paint(){return Fg=Fg||new Xn({"line-opacity":new Qt(ce.paint_line["line-opacity"]),"line-color":new Qt(ce.paint_line["line-color"]),"line-translate":new jt(ce.paint_line["line-translate"]),"line-translate-anchor":new jt(ce.paint_line["line-translate-anchor"]),"line-width":new Qt(ce.paint_line["line-width"]),"line-gap-width":new Qt(ce.paint_line["line-gap-width"]),"line-offset":new Qt(ce.paint_line["line-offset"]),"line-blur":new Qt(ce.paint_line["line-blur"]),"line-dasharray":new ql(ce.paint_line["line-dasharray"]),"line-pattern":new Mc(ce.paint_line["line-pattern"]),"line-gradient":new Su(ce.paint_line["line-gradient"])})},get layout(){return Og=Og||new Xn({"line-cap":new jt(ce.layout_line["line-cap"]),"line-join":new Qt(ce.layout_line["line-join"]),"line-miter-limit":new jt(ce.layout_line["line-miter-limit"]),"line-round-limit":new jt(ce.layout_line["line-round-limit"]),"line-sort-key":new Qt(ce.layout_line["line-sort-key"])})}};class W1 extends Qt{possiblyEvaluate(t,s){return s=new xr(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,zoomHistory:s.zoomHistory,transition:s.transition}),super.possiblyEvaluate(t,s)}evaluate(t,s,c,f){return s=dt({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(t,s,c,f)}}let md;class X1 extends Gs{constructor(t){super(t,Bg),this.gradientVersion=0,md||(md=new W1(Bg.paint.properties["line-width"].specification),md.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const s=this.gradientExpression();this.stepInterpolant=!!function(c){return c._styleExpression!==void 0}(s)&&s._styleExpression.expression instanceof Na,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,s){super.recalculate(t,s),this.paint._values["line-floorwidth"]=md.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new ef(t)}queryRadius(t){const s=t,c=Ng(Bu("line-width",this,s),Bu("line-gap-width",this,s)),f=Bu("line-offset",this,s);return c/2+Math.abs(f)+ld(this.paint.get("line-translate"))}queryIntersectsFeature(t,s,c,f,v,x,w){const T=cd(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,w),I=w/2*Ng(this.paint.get("line-width").evaluate(s,c),this.paint.get("line-gap-width").evaluate(s,c)),L=this.paint.get("line-offset").evaluate(s,c);return L&&(f=function(O,$){const j=[];for(let G=0;G<O.length;G++){const K=O[G],re=[];for(let he=0;he<K.length;he++){const Te=K[he-1],pe=K[he],be=K[he+1],$e=he===0?new D(0,0):pe.sub(Te)._unit()._perp(),Ge=he===K.length-1?new D(0,0):be.sub(pe)._unit()._perp(),Ct=$e._add(Ge)._unit(),Bt=Ct.x*Ge.x+Ct.y*Ge.y;Bt!==0&&Ct._mult(1/Bt),re.push(Ct._mult($)._add(pe))}j.push(re)}return j}(f,L*w)),function(O,$,j){for(let G=0;G<$.length;G++){const K=$[G];if(O.length>=3){for(let re=0;re<K.length;re++)if(Lc(O,K[re]))return!0}if(Ou(O,K,j))return!0}return!1}(T,f,I)}isTileClipped(){return!0}}function Ng(n,t){return t>0?t+2*n:n}const K1=qr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Y1=qr([{name:"a_projected_pos",components:3,type:"Float32"}],4);qr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const J1=qr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);qr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const $g=qr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Q1=qr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function eb(n,t,s){return n.sections.forEach(c=>{c.text=function(f,v,x){const w=v.layout.get("text-transform").evaluate(x,{});return w==="uppercase"?f=f.toLocaleUpperCase():w==="lowercase"&&(f=f.toLocaleLowerCase()),Ha.applyArabicShaping&&(f=Ha.applyArabicShaping(f)),f}(c.text,t,s)}),n}qr([{name:"triangle",components:3,type:"Uint16"}]),qr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),qr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),qr([{type:"Float32",name:"offsetX"}]),qr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),qr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Zu={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var sn=24,Ug=ir,Vg=function(n,t,s,c,f){var v,x,w=8*f-c-1,T=(1<<w)-1,I=T>>1,L=-7,O=s?f-1:0,$=s?-1:1,j=n[t+O];for(O+=$,v=j&(1<<-L)-1,j>>=-L,L+=w;L>0;v=256*v+n[t+O],O+=$,L-=8);for(x=v&(1<<-L)-1,v>>=-L,L+=c;L>0;x=256*x+n[t+O],O+=$,L-=8);if(v===0)v=1-I;else{if(v===T)return x?NaN:1/0*(j?-1:1);x+=Math.pow(2,c),v-=I}return(j?-1:1)*x*Math.pow(2,v-c)},jg=function(n,t,s,c,f,v){var x,w,T,I=8*v-f-1,L=(1<<I)-1,O=L>>1,$=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,j=c?0:v-1,G=c?1:-1,K=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(w=isNaN(t)?1:0,x=L):(x=Math.floor(Math.log(t)/Math.LN2),t*(T=Math.pow(2,-x))<1&&(x--,T*=2),(t+=x+O>=1?$/T:$*Math.pow(2,1-O))*T>=2&&(x++,T/=2),x+O>=L?(w=0,x=L):x+O>=1?(w=(t*T-1)*Math.pow(2,f),x+=O):(w=t*Math.pow(2,O-1)*Math.pow(2,f),x=0));f>=8;n[s+j]=255&w,j+=G,w/=256,f-=8);for(x=x<<f|w,I+=f;I>0;n[s+j]=255&x,j+=G,x/=256,I-=8);n[s+j-G]|=128*K};function ir(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}ir.Varint=0,ir.Fixed64=1,ir.Bytes=2,ir.Fixed32=5;var tf=4294967296,qg=1/tf,Gg=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function So(n){return n.type===ir.Bytes?n.readVarint()+n.pos:n.pos+1}function Fc(n,t,s){return s?4294967296*t+(n>>>0):4294967296*(t>>>0)+(n>>>0)}function Hg(n,t,s){var c=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));s.realloc(c);for(var f=s.pos-1;f>=n;f--)s.buf[f+c]=s.buf[f]}function tb(n,t){for(var s=0;s<n.length;s++)t.writeVarint(n[s])}function ib(n,t){for(var s=0;s<n.length;s++)t.writeSVarint(n[s])}function rb(n,t){for(var s=0;s<n.length;s++)t.writeFloat(n[s])}function nb(n,t){for(var s=0;s<n.length;s++)t.writeDouble(n[s])}function sb(n,t){for(var s=0;s<n.length;s++)t.writeBoolean(n[s])}function ab(n,t){for(var s=0;s<n.length;s++)t.writeFixed32(n[s])}function ob(n,t){for(var s=0;s<n.length;s++)t.writeSFixed32(n[s])}function lb(n,t){for(var s=0;s<n.length;s++)t.writeFixed64(n[s])}function cb(n,t){for(var s=0;s<n.length;s++)t.writeSFixed64(n[s])}function gd(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+16777216*n[t+3]}function Bc(n,t,s){n[s]=t,n[s+1]=t>>>8,n[s+2]=t>>>16,n[s+3]=t>>>24}function Zg(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+(n[t+3]<<24)}ir.prototype={destroy:function(){this.buf=null},readFields:function(n,t,s){for(s=s||this.length;this.pos<s;){var c=this.readVarint(),f=c>>3,v=this.pos;this.type=7&c,n(f,t,this),this.pos===v&&this.skip(c)}return t},readMessage:function(n,t){return this.readFields(n,t,this.readVarint()+this.pos)},readFixed32:function(){var n=gd(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=Zg(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=gd(this.buf,this.pos)+gd(this.buf,this.pos+4)*tf;return this.pos+=8,n},readSFixed64:function(){var n=gd(this.buf,this.pos)+Zg(this.buf,this.pos+4)*tf;return this.pos+=8,n},readFloat:function(){var n=Vg(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=Vg(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var t,s,c=this.buf;return t=127&(s=c[this.pos++]),s<128?t:(t|=(127&(s=c[this.pos++]))<<7,s<128?t:(t|=(127&(s=c[this.pos++]))<<14,s<128?t:(t|=(127&(s=c[this.pos++]))<<21,s<128?t:function(f,v,x){var w,T,I=x.buf;if(w=(112&(T=I[x.pos++]))>>4,T<128||(w|=(127&(T=I[x.pos++]))<<3,T<128)||(w|=(127&(T=I[x.pos++]))<<10,T<128)||(w|=(127&(T=I[x.pos++]))<<17,T<128)||(w|=(127&(T=I[x.pos++]))<<24,T<128)||(w|=(1&(T=I[x.pos++]))<<31,T<128))return Fc(f,w,v);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(s=c[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,t=this.pos;return this.pos=n,n-t>=12&&Gg?function(s,c,f){return Gg.decode(s.subarray(c,f))}(this.buf,t,n):function(s,c,f){for(var v="",x=c;x<f;){var w,T,I,L=s[x],O=null,$=L>239?4:L>223?3:L>191?2:1;if(x+$>f)break;$===1?L<128&&(O=L):$===2?(192&(w=s[x+1]))==128&&(O=(31&L)<<6|63&w)<=127&&(O=null):$===3?(T=s[x+2],(192&(w=s[x+1]))==128&&(192&T)==128&&((O=(15&L)<<12|(63&w)<<6|63&T)<=2047||O>=55296&&O<=57343)&&(O=null)):$===4&&(T=s[x+2],I=s[x+3],(192&(w=s[x+1]))==128&&(192&T)==128&&(192&I)==128&&((O=(15&L)<<18|(63&w)<<12|(63&T)<<6|63&I)<=65535||O>=1114112)&&(O=null)),O===null?(O=65533,$=1):O>65535&&(O-=65536,v+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),v+=String.fromCharCode(O),x+=$}return v}(this.buf,t,n)},readBytes:function(){var n=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,n);return this.pos=n,t},readPackedVarint:function(n,t){if(this.type!==ir.Bytes)return n.push(this.readVarint(t));var s=So(this);for(n=n||[];this.pos<s;)n.push(this.readVarint(t));return n},readPackedSVarint:function(n){if(this.type!==ir.Bytes)return n.push(this.readSVarint());var t=So(this);for(n=n||[];this.pos<t;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==ir.Bytes)return n.push(this.readBoolean());var t=So(this);for(n=n||[];this.pos<t;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==ir.Bytes)return n.push(this.readFloat());var t=So(this);for(n=n||[];this.pos<t;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==ir.Bytes)return n.push(this.readDouble());var t=So(this);for(n=n||[];this.pos<t;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==ir.Bytes)return n.push(this.readFixed32());var t=So(this);for(n=n||[];this.pos<t;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==ir.Bytes)return n.push(this.readSFixed32());var t=So(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==ir.Bytes)return n.push(this.readFixed64());var t=So(this);for(n=n||[];this.pos<t;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==ir.Bytes)return n.push(this.readSFixed64());var t=So(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed64());return n},skip:function(n){var t=7&n;if(t===ir.Varint)for(;this.buf[this.pos++]>127;);else if(t===ir.Bytes)this.pos=this.readVarint()+this.pos;else if(t===ir.Fixed32)this.pos+=4;else{if(t!==ir.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(n,t){this.writeVarint(n<<3|t)},realloc:function(n){for(var t=this.length||16;t<this.pos+n;)t*=2;if(t!==this.length){var s=new Uint8Array(t);s.set(this.buf),this.buf=s,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),Bc(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),Bc(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),Bc(this.buf,-1&n,this.pos),Bc(this.buf,Math.floor(n*qg),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),Bc(this.buf,-1&n,this.pos),Bc(this.buf,Math.floor(n*qg),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(t,s){var c,f;if(t>=0?(c=t%4294967296|0,f=t/4294967296|0):(f=~(-t/4294967296),4294967295^(c=~(-t%4294967296))?c=c+1|0:(c=0,f=f+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(v,x,w){w.buf[w.pos++]=127&v|128,v>>>=7,w.buf[w.pos++]=127&v|128,v>>>=7,w.buf[w.pos++]=127&v|128,v>>>=7,w.buf[w.pos++]=127&v|128,w.buf[w.pos]=127&(v>>>=7)}(c,0,s),function(v,x){var w=(7&v)<<4;x.buf[x.pos++]|=w|((v>>>=3)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v)))))}(f,s)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var t=this.pos;this.pos=function(c,f,v){for(var x,w,T=0;T<f.length;T++){if((x=f.charCodeAt(T))>55295&&x<57344){if(!w){x>56319||T+1===f.length?(c[v++]=239,c[v++]=191,c[v++]=189):w=x;continue}if(x<56320){c[v++]=239,c[v++]=191,c[v++]=189,w=x;continue}x=w-55296<<10|x-56320|65536,w=null}else w&&(c[v++]=239,c[v++]=191,c[v++]=189,w=null);x<128?c[v++]=x:(x<2048?c[v++]=x>>6|192:(x<65536?c[v++]=x>>12|224:(c[v++]=x>>18|240,c[v++]=x>>12&63|128),c[v++]=x>>6&63|128),c[v++]=63&x|128)}return v}(this.buf,n,this.pos);var s=this.pos-t;s>=128&&Hg(t,s,this),this.pos=t-1,this.writeVarint(s),this.pos+=s},writeFloat:function(n){this.realloc(4),jg(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),jg(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var t=n.length;this.writeVarint(t),this.realloc(t);for(var s=0;s<t;s++)this.buf[this.pos++]=n[s]},writeRawMessage:function(n,t){this.pos++;var s=this.pos;n(t,this);var c=this.pos-s;c>=128&&Hg(s,c,this),this.pos=s-1,this.writeVarint(c),this.pos+=c},writeMessage:function(n,t,s){this.writeTag(n,ir.Bytes),this.writeRawMessage(t,s)},writePackedVarint:function(n,t){t.length&&this.writeMessage(n,tb,t)},writePackedSVarint:function(n,t){t.length&&this.writeMessage(n,ib,t)},writePackedBoolean:function(n,t){t.length&&this.writeMessage(n,sb,t)},writePackedFloat:function(n,t){t.length&&this.writeMessage(n,rb,t)},writePackedDouble:function(n,t){t.length&&this.writeMessage(n,nb,t)},writePackedFixed32:function(n,t){t.length&&this.writeMessage(n,ab,t)},writePackedSFixed32:function(n,t){t.length&&this.writeMessage(n,ob,t)},writePackedFixed64:function(n,t){t.length&&this.writeMessage(n,lb,t)},writePackedSFixed64:function(n,t){t.length&&this.writeMessage(n,cb,t)},writeBytesField:function(n,t){this.writeTag(n,ir.Bytes),this.writeBytes(t)},writeFixed32Field:function(n,t){this.writeTag(n,ir.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(n,t){this.writeTag(n,ir.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(n,t){this.writeTag(n,ir.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(n,t){this.writeTag(n,ir.Fixed64),this.writeSFixed64(t)},writeVarintField:function(n,t){this.writeTag(n,ir.Varint),this.writeVarint(t)},writeSVarintField:function(n,t){this.writeTag(n,ir.Varint),this.writeSVarint(t)},writeStringField:function(n,t){this.writeTag(n,ir.Bytes),this.writeString(t)},writeFloatField:function(n,t){this.writeTag(n,ir.Fixed32),this.writeFloat(t)},writeDoubleField:function(n,t){this.writeTag(n,ir.Fixed64),this.writeDouble(t)},writeBooleanField:function(n,t){this.writeVarintField(n,!!t)}};var rf=M(Ug);const nf=3;function ub(n,t,s){n===1&&s.readMessage(hb,t)}function hb(n,t,s){if(n===3){const{id:c,bitmap:f,width:v,height:x,left:w,top:T,advance:I}=s.readMessage(db,{});t.push({id:c,bitmap:new $u({width:v+2*nf,height:x+2*nf},f),metrics:{width:v,height:x,left:w,top:T,advance:I}})}}function db(n,t,s){n===1?t.id=s.readVarint():n===2?t.bitmap=s.readBytes():n===3?t.width=s.readVarint():n===4?t.height=s.readVarint():n===5?t.left=s.readSVarint():n===6?t.top=s.readSVarint():n===7&&(t.advance=s.readVarint())}const Wg=nf;function Xg(n){let t=0,s=0;for(const x of n)t+=x.w*x.h,s=Math.max(s,x.w);n.sort((x,w)=>w.h-x.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),s),h:1/0}];let f=0,v=0;for(const x of n)for(let w=c.length-1;w>=0;w--){const T=c[w];if(!(x.w>T.w||x.h>T.h)){if(x.x=T.x,x.y=T.y,v=Math.max(v,x.y+x.h),f=Math.max(f,x.x+x.w),x.w===T.w&&x.h===T.h){const I=c.pop();w<c.length&&(c[w]=I)}else x.h===T.h?(T.x+=x.w,T.w-=x.w):x.w===T.w?(T.y+=x.h,T.h-=x.h):(c.push({x:T.x+x.w,y:T.y,w:T.w-x.w,h:x.h}),T.y+=x.h,T.h-=x.h);break}}return{w:f,h:v,fill:t/(f*v)||0}}const hs=1;class sf{constructor(t,{pixelRatio:s,version:c,stretchX:f,stretchY:v,content:x}){this.paddedRect=t,this.pixelRatio=s,this.stretchX=f,this.stretchY=v,this.content=x,this.version=c}get tl(){return[this.paddedRect.x+hs,this.paddedRect.y+hs]}get br(){return[this.paddedRect.x+this.paddedRect.w-hs,this.paddedRect.y+this.paddedRect.h-hs]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*hs)/this.pixelRatio,(this.paddedRect.h-2*hs)/this.pixelRatio]}}class Kg{constructor(t,s){const c={},f={};this.haveRenderCallbacks=[];const v=[];this.addImages(t,c,v),this.addImages(s,f,v);const{w:x,h:w}=Xg(v),T=new Hs({width:x||1,height:w||1});for(const I in t){const L=t[I],O=c[I].paddedRect;Hs.copy(L.data,T,{x:0,y:0},{x:O.x+hs,y:O.y+hs},L.data)}for(const I in s){const L=s[I],O=f[I].paddedRect,$=O.x+hs,j=O.y+hs,G=L.data.width,K=L.data.height;Hs.copy(L.data,T,{x:0,y:0},{x:$,y:j},L.data),Hs.copy(L.data,T,{x:0,y:K-1},{x:$,y:j-1},{width:G,height:1}),Hs.copy(L.data,T,{x:0,y:0},{x:$,y:j+K},{width:G,height:1}),Hs.copy(L.data,T,{x:G-1,y:0},{x:$-1,y:j},{width:1,height:K}),Hs.copy(L.data,T,{x:0,y:0},{x:$+G,y:j},{width:1,height:K})}this.image=T,this.iconPositions=c,this.patternPositions=f}addImages(t,s,c){for(const f in t){const v=t[f],x={x:0,y:0,w:v.data.width+2*hs,h:v.data.height+2*hs};c.push(x),s[f]=new sf(x,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(t,s){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in t.updatedImages)this.patchUpdatedImage(this.iconPositions[c],t.getImage(c),s),this.patchUpdatedImage(this.patternPositions[c],t.getImage(c),s)}patchUpdatedImage(t,s,c){if(!t||!s||t.version===s.version)return;t.version=s.version;const[f,v]=t.tl;c.update(s.data,void 0,{x:f,y:v})}}var sl;Tt("ImagePosition",sf),Tt("ImageAtlas",Kg),m.ah=void 0,(sl=m.ah||(m.ah={}))[sl.none=0]="none",sl[sl.horizontal=1]="horizontal",sl[sl.vertical=2]="vertical",sl[sl.horizontalOnly=3]="horizontalOnly";const Wu=-17;class Xu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,s){const c=new Xu;return c.scale=t||1,c.fontStack=s,c}static forImage(t){const s=new Xu;return s.imageName=t,s}}class Nc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,s){const c=new Nc;for(let f=0;f<t.sections.length;f++){const v=t.sections[f];v.image?c.addImageSection(v):c.addTextSection(v,s)}return c}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let s="";for(let c=0;c<t.length;c++){const f=t.charCodeAt(c+1)||null,v=t.charCodeAt(c-1)||null;s+=f&&Ga(f)&&!Zu[t[c+1]]||v&&Ga(v)&&!Zu[t[c-1]]||!Zu[t[c]]?t[c]:Zu[t[c]]}return s}(this.text)}trim(){let t=0;for(let c=0;c<this.text.length&&_d[this.text.charCodeAt(c)];c++)t++;let s=this.text.length;for(let c=this.text.length-1;c>=0&&c>=t&&_d[this.text.charCodeAt(c)];c--)s--;this.text=this.text.substring(t,s),this.sectionIndex=this.sectionIndex.slice(t,s)}substring(t,s){const c=new Nc;return c.text=this.text.substring(t,s),c.sectionIndex=this.sectionIndex.slice(t,s),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,s)=>Math.max(t,this.sections[s].scale),0)}addTextSection(t,s){this.text+=t.text,this.sections.push(Xu.forText(t.scale,t.fontStack||s));const c=this.sections.length-1;for(let f=0;f<t.text.length;++f)this.sectionIndex.push(c)}addImageSection(t){const s=t.image?t.image.name:"";if(s.length===0)return void ct("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Xu.forImage(s)),this.sectionIndex.push(this.sections.length-1)):ct("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function yd(n,t,s,c,f,v,x,w,T,I,L,O,$,j,G,K){const re=Nc.fromFeature(n,f);let he;O===m.ah.vertical&&re.verticalizePunctuation();const{processBidirectionalText:Te,processStyledBidirectionalText:pe}=Ha;if(Te&&re.sections.length===1){he=[];const Ge=Te(re.toString(),af(re,I,v,t,c,j,G));for(const Ct of Ge){const Bt=new Nc;Bt.text=Ct,Bt.sections=re.sections;for(let St=0;St<Ct.length;St++)Bt.sectionIndex.push(0);he.push(Bt)}}else if(pe){he=[];const Ge=pe(re.text,re.sectionIndex,af(re,I,v,t,c,j,G));for(const Ct of Ge){const Bt=new Nc;Bt.text=Ct[0],Bt.sectionIndex=Ct[1],Bt.sections=re.sections,he.push(Bt)}}else he=function(Ge,Ct){const Bt=[],St=Ge.text;let xt=0;for(const lt of Ct)Bt.push(Ge.substring(xt,lt)),xt=lt;return xt<St.length&&Bt.push(Ge.substring(xt,St.length)),Bt}(re,af(re,I,v,t,c,j,G));const be=[],$e={positionedLines:be,text:re.toString(),top:L[1],bottom:L[1],left:L[0],right:L[0],writingMode:O,iconsInText:!1,verticalizable:!1};return function(Ge,Ct,Bt,St,xt,lt,kt,_t,et,Jt,Ut,Ei){let gr=0,wr=Wu,an=0,Is=0;const Yn=_t==="right"?1:_t==="left"?0:.5;let Yr=0;for(const on of xt){on.trim();const ln=on.getMaxScale(),Fn=(ln-1)*sn,es={positionedGlyphs:[],lineOffset:0};Ge.positionedLines[Yr]=es;const Bn=es.positionedGlyphs;let ds=0;if(!on.length()){wr+=lt,++Yr;continue}for(let cn=0;cn<on.length();cn++){const Pi=on.getSection(cn),Nn=on.getSectionIndex(cn),Rn=on.getCharCode(cn);let un=0,ca=null,Aa=null,Pa=null,Eo=sn;const ua=!(et===m.ah.horizontal||!Ut&&!vo(Rn)||Ut&&(_d[Rn]||(Tn=Rn,vt.Arabic(Tn)||vt["Arabic Supplement"](Tn)||vt["Arabic Extended-A"](Tn)||vt["Arabic Presentation Forms-A"](Tn)||vt["Arabic Presentation Forms-B"](Tn))));if(Pi.imageName){const Ws=St[Pi.imageName];if(!Ws)continue;Pa=Pi.imageName,Ge.iconsInText=Ge.iconsInText||!0,Aa=Ws.paddedRect;const fs=Ws.displaySize;Pi.scale=Pi.scale*sn/Ei,ca={width:fs[0],height:fs[1],left:hs,top:-Wg,advance:ua?fs[1]:fs[0]},un=Fn+(sn-fs[1]*Pi.scale),Eo=ca.advance;const To=ua?fs[0]*Pi.scale-sn*ln:fs[1]*Pi.scale-sn*ln;To>0&&To>ds&&(ds=To)}else{const Ws=Bt[Pi.fontStack],fs=Ws&&Ws[Rn];if(fs&&fs.rect)Aa=fs.rect,ca=fs.metrics;else{const To=Ct[Pi.fontStack],eh=To&&To[Rn];if(!eh)continue;ca=eh.metrics}un=(ln-Pi.scale)*sn}ua?(Ge.verticalizable=!0,Bn.push({glyph:Rn,imageName:Pa,x:gr,y:wr+un,vertical:ua,scale:Pi.scale,fontStack:Pi.fontStack,sectionIndex:Nn,metrics:ca,rect:Aa}),gr+=Eo*Pi.scale+Jt):(Bn.push({glyph:Rn,imageName:Pa,x:gr,y:wr+un,vertical:ua,scale:Pi.scale,fontStack:Pi.fontStack,sectionIndex:Nn,metrics:ca,rect:Aa}),gr+=ca.advance*Pi.scale+Jt)}Bn.length!==0&&(an=Math.max(gr-Jt,an),mb(Bn,0,Bn.length-1,Yn,ds)),gr=0;const ps=lt*ln+ds;es.lineOffset=Math.max(ds,Fn),wr+=ps,Is=Math.max(ps,Is),++Yr}var Tn;const Ln=wr-Wu,{horizontalAlign:Jn,verticalAlign:Qn}=of(kt);(function(on,ln,Fn,es,Bn,ds,ps,cn,Pi){const Nn=(ln-Fn)*Bn;let Rn=0;Rn=ds!==ps?-cn*es-Wu:(-es*Pi+.5)*ps;for(const un of on)for(const ca of un.positionedGlyphs)ca.x+=Nn,ca.y+=Rn})(Ge.positionedLines,Yn,Jn,Qn,an,Is,lt,Ln,xt.length),Ge.top+=-Qn*Ln,Ge.bottom=Ge.top+Ln,Ge.left+=-Jn*an,Ge.right=Ge.left+an}($e,t,s,c,he,x,w,T,O,I,$,K),!function(Ge){for(const Ct of Ge)if(Ct.positionedGlyphs.length!==0)return!1;return!0}(be)&&$e}const _d={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},pb={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Yg(n,t,s,c,f,v){if(t.imageName){const x=c[t.imageName];return x?x.displaySize[0]*t.scale*sn/v+f:0}{const x=s[t.fontStack],w=x&&x[n];return w?w.metrics.advance*t.scale+f:0}}function Jg(n,t,s,c){const f=Math.pow(n-t,2);return c?n<t?f/2:2*f:f+Math.abs(s)*s}function fb(n,t,s){let c=0;return n===10&&(c-=1e4),s&&(c+=150),n!==40&&n!==65288||(c+=50),t!==41&&t!==65289||(c+=50),c}function Qg(n,t,s,c,f,v){let x=null,w=Jg(t,s,f,v);for(const T of c){const I=Jg(t-T.x,s,f,v)+T.badness;I<=w&&(x=T,w=I)}return{index:n,x:t,priorBreak:x,badness:w}}function ey(n){return n?ey(n.priorBreak).concat(n.index):[]}function af(n,t,s,c,f,v,x){if(v!=="point")return[];if(!n)return[];const w=[],T=function($,j,G,K,re,he){let Te=0;for(let pe=0;pe<$.length();pe++){const be=$.getSection(pe);Te+=Yg($.getCharCode(pe),be,K,re,j,he)}return Te/Math.max(1,Math.ceil(Te/G))}(n,t,s,c,f,x),I=n.text.indexOf("")>=0;let L=0;for(let $=0;$<n.length();$++){const j=n.getSection($),G=n.getCharCode($);if(_d[G]||(L+=Yg(G,j,c,f,t,x)),$<n.length()-1){const K=!((O=G)<11904||!(vt["Bopomofo Extended"](O)||vt.Bopomofo(O)||vt["CJK Compatibility Forms"](O)||vt["CJK Compatibility Ideographs"](O)||vt["CJK Compatibility"](O)||vt["CJK Radicals Supplement"](O)||vt["CJK Strokes"](O)||vt["CJK Symbols and Punctuation"](O)||vt["CJK Unified Ideographs Extension A"](O)||vt["CJK Unified Ideographs"](O)||vt["Enclosed CJK Letters and Months"](O)||vt["Halfwidth and Fullwidth Forms"](O)||vt.Hiragana(O)||vt["Ideographic Description Characters"](O)||vt["Kangxi Radicals"](O)||vt["Katakana Phonetic Extensions"](O)||vt.Katakana(O)||vt["Vertical Forms"](O)||vt["Yi Radicals"](O)||vt["Yi Syllables"](O)));(pb[G]||K||j.imageName)&&w.push(Qg($+1,L,T,w,fb(G,n.getCharCode($+1),K&&I),!1))}}var O;return ey(Qg(n.length(),L,T,w,0,!0))}function of(n){let t=.5,s=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:t,verticalAlign:s}}function mb(n,t,s,c,f){if(!c&&!f)return;const v=n[s],x=(n[s].x+v.metrics.advance*v.scale)*c;for(let w=t;w<=s;w++)n[w].x-=x,n[w].y+=f}function gb(n,t,s){const{horizontalAlign:c,verticalAlign:f}=of(s),v=t[0]-n.displaySize[0]*c,x=t[1]-n.displaySize[1]*f;return{image:n,top:x,bottom:x+n.displaySize[1],left:v,right:v+n.displaySize[0]}}function ty(n,t,s,c,f,v){const x=n.image;let w;if(x.content){const re=x.content,he=x.pixelRatio||1;w=[re[0]/he,re[1]/he,x.displaySize[0]-re[2]/he,x.displaySize[1]-re[3]/he]}const T=t.left*v,I=t.right*v;let L,O,$,j;s==="width"||s==="both"?(j=f[0]+T-c[3],O=f[0]+I+c[1]):(j=f[0]+(T+I-x.displaySize[0])/2,O=j+x.displaySize[0]);const G=t.top*v,K=t.bottom*v;return s==="height"||s==="both"?(L=f[1]+G-c[0],$=f[1]+K+c[2]):(L=f[1]+(G+K-x.displaySize[1])/2,$=L+x.displaySize[1]),{image:x,top:L,right:O,bottom:$,left:j,collisionPadding:w}}const Ku=255,Ka=128,al=Ku*Ka;function iy(n,t){const{expression:s}=t;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new xr(n+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:f}=s;let v=0;for(;v<c.length&&c[v]<=n;)v++;v=Math.max(0,v-1);let x=v;for(;x<c.length&&c[x]<n+1;)x++;x=Math.min(c.length-1,x);const w=c[v],T=c[x];return s.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:T,interpolationType:f}:{kind:"camera",minZoom:w,maxZoom:T,minSize:s.evaluate(new xr(w)),maxSize:s.evaluate(new xr(T)),interpolationType:f}}}function lf(n,t,s){let c="never";const f=n.get(t);return f?c=f:n.get(s)&&(c="always"),c}const yb=nl.VectorTileFeature.types,_b=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function vd(n,t,s,c,f,v,x,w,T,I,L,O,$){const j=w?Math.min(al,Math.round(w[0])):0,G=w?Math.min(al,Math.round(w[1])):0;n.emplaceBack(t,s,Math.round(32*c),Math.round(32*f),v,x,(j<<1)+(T?1:0),G,16*I,16*L,256*O,256*$)}function cf(n,t,s){n.emplaceBack(t.x,t.y,s),n.emplaceBack(t.x,t.y,s),n.emplaceBack(t.x,t.y,s),n.emplaceBack(t.x,t.y,s)}function vb(n){for(const t of n.sections)if(Np(t.text))return!0;return!1}class uf{constructor(t){this.layoutVertexArray=new Ie,this.indexArray=new Oe,this.programConfigurations=t,this.segments=new ht,this.dynamicLayoutVertexArray=new le,this.opacityVertexArray=new we,this.hasVisibleVertices=!1,this.placedSymbolArray=new o}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,s,c,f){this.isEmpty()||(c&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,K1.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Y1.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,_b,!0),this.opacityVertexBuffer.itemSize=1),(c||f)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Tt("SymbolBuffers",uf);class hf{constructor(t,s,c){this.layoutVertexArray=new t,this.layoutAttributes=s,this.indexArray=new c,this.segments=new ht,this.collisionVertexArray=new ke}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,J1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Tt("CollisionBuffers",hf);class $c{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(x=>x.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Up([]),this.placementViewportMatrix=Up([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=iy(this.zoom,s["text-size"]),this.iconSizeData=iy(this.zoom,s["icon-size"]);const c=this.layers[0].layout,f=c.get("symbol-sort-key"),v=c.get("symbol-z-order");this.canOverlap=lf(c,"text-overlap","text-allow-overlap")!=="never"||lf(c,"icon-overlap","icon-allow-overlap")!=="never"||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&!f.isConstant(),this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,c.get("symbol-placement")==="point"&&(this.writingModes=c.get("text-writing-mode").map(x=>m.ah[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=t.sourceID}createArrays(){this.text=new uf(new Pr(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new uf(new Pr(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new _,this.lineVertexArray=new S,this.symbolInstances=new p,this.textAnchorOffsets=new C}calculateGlyphDependencies(t,s,c,f,v){for(let x=0;x<t.length;x++)if(s[t.charCodeAt(x)]=!0,(c||f)&&v){const w=Zu[t.charAt(x)];w&&(s[w.charCodeAt(0)]=!0)}}populate(t,s,c){const f=this.layers[0],v=f.layout,x=v.get("text-font"),w=v.get("text-field"),T=v.get("icon-image"),I=(w.value.kind!=="constant"||w.value.value instanceof Dn&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),L=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,O=v.get("symbol-sort-key");if(this.features=[],!I&&!L)return;const $=s.iconDependencies,j=s.glyphDependencies,G=s.availableImages,K=new xr(this.zoom);for(const{feature:re,id:he,index:Te,sourceLayerIndex:pe}of t){const be=f._featureFilter.needGeometry,$e=Mo(re,be);if(!f._featureFilter.filter(K,$e,c))continue;let Ge,Ct;if(be||($e.geometry=wo(re)),I){const St=f.getValueAndResolveTokens("text-field",$e,c,G),xt=Dn.factory(St),lt=this.hasRTLText=this.hasRTLText||vb(xt);(!lt||Ha.getRTLTextPluginStatus()==="unavailable"||lt&&Ha.isParsed())&&(Ge=eb(xt,f,$e))}if(L){const St=f.getValueAndResolveTokens("icon-image",$e,c,G);Ct=St instanceof bn?St:bn.fromString(St)}if(!Ge&&!Ct)continue;const Bt=this.sortFeaturesByKey?O.evaluate($e,{},c):void 0;if(this.features.push({id:he,text:Ge,icon:Ct,index:Te,sourceLayerIndex:pe,geometry:$e.geometry,properties:re.properties,type:yb[re.type],sortKey:Bt}),Ct&&($[Ct.name]=!0),Ge){const St=x.evaluate($e,{},c).join(","),xt=v.get("text-rotation-alignment")!=="viewport"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(m.ah.vertical)>=0;for(const lt of Ge.sections)if(lt.image)$[lt.image.name]=!0;else{const kt=aa(Ge.toString()),_t=lt.fontStack||St,et=j[_t]=j[_t]||{};this.calculateGlyphDependencies(lt.text,et,xt,this.allowVerticalPlacement,kt)}}}v.get("symbol-placement")==="line"&&(this.features=function(re){const he={},Te={},pe=[];let be=0;function $e(St){pe.push(re[St]),be++}function Ge(St,xt,lt){const kt=Te[St];return delete Te[St],Te[xt]=kt,pe[kt].geometry[0].pop(),pe[kt].geometry[0]=pe[kt].geometry[0].concat(lt[0]),kt}function Ct(St,xt,lt){const kt=he[xt];return delete he[xt],he[St]=kt,pe[kt].geometry[0].shift(),pe[kt].geometry[0]=lt[0].concat(pe[kt].geometry[0]),kt}function Bt(St,xt,lt){const kt=lt?xt[0][xt[0].length-1]:xt[0][0];return`${St}:${kt.x}:${kt.y}`}for(let St=0;St<re.length;St++){const xt=re[St],lt=xt.geometry,kt=xt.text?xt.text.toString():null;if(!kt){$e(St);continue}const _t=Bt(kt,lt),et=Bt(kt,lt,!0);if(_t in Te&&et in he&&Te[_t]!==he[et]){const Jt=Ct(_t,et,lt),Ut=Ge(_t,et,pe[Jt].geometry);delete he[_t],delete Te[et],Te[Bt(kt,pe[Ut].geometry,!0)]=Ut,pe[Jt].geometry=null}else _t in Te?Ge(_t,et,lt):et in he?Ct(_t,et,lt):($e(St),he[_t]=be-1,Te[et]=be-1)}return pe.filter(St=>St.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((re,he)=>re.sortKey-he.sortKey)}update(t,s,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,s,this.layers,c),this.icon.programConfigurations.updatePaintArrays(t,s,this.layers,c))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,s){const c=this.lineVertexArray.length;if(t.segment!==void 0){let f=t.dist(s[t.segment+1]),v=t.dist(s[t.segment]);const x={};for(let w=t.segment+1;w<s.length;w++)x[w]={x:s[w].x,y:s[w].y,tileUnitDistanceFromAnchor:f},w<s.length-1&&(f+=s[w+1].dist(s[w]));for(let w=t.segment||0;w>=0;w--)x[w]={x:s[w].x,y:s[w].y,tileUnitDistanceFromAnchor:v},w>0&&(v+=s[w-1].dist(s[w]));for(let w=0;w<s.length;w++){const T=x[w];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(t,s,c,f,v,x,w,T,I,L,O,$){const j=t.indexArray,G=t.layoutVertexArray,K=t.segments.prepareSegment(4*s.length,G,j,this.canOverlap?x.sortKey:void 0),re=this.glyphOffsetArray.length,he=K.vertexLength,Te=this.allowVerticalPlacement&&w===m.ah.vertical?Math.PI/2:0,pe=x.text&&x.text.sections;for(let be=0;be<s.length;be++){const{tl:$e,tr:Ge,bl:Ct,br:Bt,tex:St,pixelOffsetTL:xt,pixelOffsetBR:lt,minFontScaleX:kt,minFontScaleY:_t,glyphOffset:et,isSDF:Jt,sectionIndex:Ut}=s[be],Ei=K.vertexLength,gr=et[1];vd(G,T.x,T.y,$e.x,gr+$e.y,St.x,St.y,c,Jt,xt.x,xt.y,kt,_t),vd(G,T.x,T.y,Ge.x,gr+Ge.y,St.x+St.w,St.y,c,Jt,lt.x,xt.y,kt,_t),vd(G,T.x,T.y,Ct.x,gr+Ct.y,St.x,St.y+St.h,c,Jt,xt.x,lt.y,kt,_t),vd(G,T.x,T.y,Bt.x,gr+Bt.y,St.x+St.w,St.y+St.h,c,Jt,lt.x,lt.y,kt,_t),cf(t.dynamicLayoutVertexArray,T,Te),j.emplaceBack(Ei,Ei+1,Ei+2),j.emplaceBack(Ei+1,Ei+2,Ei+3),K.vertexLength+=4,K.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(et[0]),be!==s.length-1&&Ut===s[be+1].sectionIndex||t.programConfigurations.populatePaintArrays(G.length,x,x.index,{},$,pe&&pe[Ut])}t.placedSymbolArray.emplaceBack(T.x,T.y,re,this.glyphOffsetArray.length-re,he,I,L,T.segment,c?c[0]:0,c?c[1]:0,f[0],f[1],w,0,!1,0,O)}_addCollisionDebugVertex(t,s,c,f,v,x){return s.emplaceBack(0,0),t.emplaceBack(c.x,c.y,f,v,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(t,s,c,f,v,x,w){const T=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),I=T.vertexLength,L=v.layoutVertexArray,O=v.collisionVertexArray,$=w.anchorX,j=w.anchorY;this._addCollisionDebugVertex(L,O,x,$,j,new D(t,s)),this._addCollisionDebugVertex(L,O,x,$,j,new D(c,s)),this._addCollisionDebugVertex(L,O,x,$,j,new D(c,f)),this._addCollisionDebugVertex(L,O,x,$,j,new D(t,f)),T.vertexLength+=4;const G=v.indexArray;G.emplaceBack(I,I+1),G.emplaceBack(I+1,I+2),G.emplaceBack(I+2,I+3),G.emplaceBack(I+3,I),T.primitiveLength+=4}addDebugCollisionBoxes(t,s,c,f){for(let v=t;v<s;v++){const x=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,f?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,c)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new hf(Ae,$g.members,We),this.iconCollisionBox=new hf(Ae,$g.members,We);for(let t=0;t<this.symbolInstances.length;t++){const s=this.symbolInstances.get(t);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}}_deserializeCollisionBoxesForSymbol(t,s,c,f,v,x,w,T,I){const L={};for(let O=s;O<c;O++){const $=t.get(O);L.textBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},L.textFeatureIndex=$.featureIndex;break}for(let O=f;O<v;O++){const $=t.get(O);L.verticalTextBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},L.verticalTextFeatureIndex=$.featureIndex;break}for(let O=x;O<w;O++){const $=t.get(O);L.iconBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},L.iconFeatureIndex=$.featureIndex;break}for(let O=T;O<I;O++){const $=t.get(O);L.verticalIconBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},L.verticalIconFeatureIndex=$.featureIndex;break}return L}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const c=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,s){const c=t.placedSymbolArray.get(s),f=c.vertexStartIndex+4*c.numGlyphs;for(let v=c.vertexStartIndex;v<f;v+=4)t.indexArray.emplaceBack(v,v+1,v+2),t.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(t),c=Math.cos(t),f=[],v=[],x=[];for(let w=0;w<this.symbolInstances.length;++w){x.push(w);const T=this.symbolInstances.get(w);f.push(0|Math.round(s*T.anchorX+c*T.anchorY)),v.push(T.featureIndex)}return x.sort((w,T)=>f[w]-f[T]||v[T]-v[w]),x}addToSortKeyRanges(t,s){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===s?c.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const c=this.symbolInstances.get(s);this.featureSortOrder.push(c.featureIndex),[c.rightJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.leftJustifiedTextSymbolIndex].forEach((f,v,x)=>{f>=0&&x.indexOf(f)===v&&this.addIndicesForPlacedSymbol(this.text,f)}),c.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,c.verticalPlacedTextSymbolIndex),c.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.placedIconSymbolIndex),c.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let ry,ny;Tt("SymbolBucket",$c,{omit:["layers","collisionBoxArray","features","compareText"]}),$c.MAX_GLYPHS=65535,$c.addDynamicAttributes=cf;var df={get paint(){return ny=ny||new Xn({"icon-opacity":new Qt(ce.paint_symbol["icon-opacity"]),"icon-color":new Qt(ce.paint_symbol["icon-color"]),"icon-halo-color":new Qt(ce.paint_symbol["icon-halo-color"]),"icon-halo-width":new Qt(ce.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Qt(ce.paint_symbol["icon-halo-blur"]),"icon-translate":new jt(ce.paint_symbol["icon-translate"]),"icon-translate-anchor":new jt(ce.paint_symbol["icon-translate-anchor"]),"text-opacity":new Qt(ce.paint_symbol["text-opacity"]),"text-color":new Qt(ce.paint_symbol["text-color"],{runtimeType:ji,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new Qt(ce.paint_symbol["text-halo-color"]),"text-halo-width":new Qt(ce.paint_symbol["text-halo-width"]),"text-halo-blur":new Qt(ce.paint_symbol["text-halo-blur"]),"text-translate":new jt(ce.paint_symbol["text-translate"]),"text-translate-anchor":new jt(ce.paint_symbol["text-translate-anchor"])})},get layout(){return ry=ry||new Xn({"symbol-placement":new jt(ce.layout_symbol["symbol-placement"]),"symbol-spacing":new jt(ce.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new jt(ce.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Qt(ce.layout_symbol["symbol-sort-key"]),"symbol-z-order":new jt(ce.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new jt(ce.layout_symbol["icon-allow-overlap"]),"icon-overlap":new jt(ce.layout_symbol["icon-overlap"]),"icon-ignore-placement":new jt(ce.layout_symbol["icon-ignore-placement"]),"icon-optional":new jt(ce.layout_symbol["icon-optional"]),"icon-rotation-alignment":new jt(ce.layout_symbol["icon-rotation-alignment"]),"icon-size":new Qt(ce.layout_symbol["icon-size"]),"icon-text-fit":new jt(ce.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new jt(ce.layout_symbol["icon-text-fit-padding"]),"icon-image":new Qt(ce.layout_symbol["icon-image"]),"icon-rotate":new Qt(ce.layout_symbol["icon-rotate"]),"icon-padding":new Qt(ce.layout_symbol["icon-padding"]),"icon-keep-upright":new jt(ce.layout_symbol["icon-keep-upright"]),"icon-offset":new Qt(ce.layout_symbol["icon-offset"]),"icon-anchor":new Qt(ce.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new jt(ce.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new jt(ce.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new jt(ce.layout_symbol["text-rotation-alignment"]),"text-field":new Qt(ce.layout_symbol["text-field"]),"text-font":new Qt(ce.layout_symbol["text-font"]),"text-size":new Qt(ce.layout_symbol["text-size"]),"text-max-width":new Qt(ce.layout_symbol["text-max-width"]),"text-line-height":new jt(ce.layout_symbol["text-line-height"]),"text-letter-spacing":new Qt(ce.layout_symbol["text-letter-spacing"]),"text-justify":new Qt(ce.layout_symbol["text-justify"]),"text-radial-offset":new Qt(ce.layout_symbol["text-radial-offset"]),"text-variable-anchor":new jt(ce.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Qt(ce.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Qt(ce.layout_symbol["text-anchor"]),"text-max-angle":new jt(ce.layout_symbol["text-max-angle"]),"text-writing-mode":new jt(ce.layout_symbol["text-writing-mode"]),"text-rotate":new Qt(ce.layout_symbol["text-rotate"]),"text-padding":new jt(ce.layout_symbol["text-padding"]),"text-keep-upright":new jt(ce.layout_symbol["text-keep-upright"]),"text-transform":new Qt(ce.layout_symbol["text-transform"]),"text-offset":new Qt(ce.layout_symbol["text-offset"]),"text-allow-overlap":new jt(ce.layout_symbol["text-allow-overlap"]),"text-overlap":new jt(ce.layout_symbol["text-overlap"]),"text-ignore-placement":new jt(ce.layout_symbol["text-ignore-placement"]),"text-optional":new jt(ce.layout_symbol["text-optional"])})}};class sy{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Sr,this.defaultValue=t}evaluate(t){if(t.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(t.formattedSection))return s.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Tt("FormatSectionOverride",sy,{omit:["defaultValue"]});class xd extends Gs{constructor(t){super(t,df)}recalculate(t,s){if(super.recalculate(t,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const c=this.layout.get("text-writing-mode");if(c){const f=[];for(const v of c)f.indexOf(v)<0&&f.push(v);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,s,c,f){const v=this.layout.get(t).evaluate(s,{},c,f),x=this._unevaluatedLayout._values[t];return x.isDataDriven()||Ji(x.value)||!v?v:function(w,T){return T.replace(/{([^{}]+)}/g,(I,L)=>w&&L in w?String(w[L]):"")}(s.properties,v)}createBucket(t){return new $c(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of df.paint.overridableProperties){if(!xd.hasPaintOverride(this.layout,t))continue;const s=this.paint.get(t),c=new sy(s),f=new $i(c,s.property.specification);let v=null;v=s.value.kind==="constant"||s.value.kind==="source"?new na("source",f):new Xo("composite",f,s.value.zoomStops),this.paint._values[t]=new qs(s.property,v,s.parameters)}}_handleOverridablePaintPropertyUpdate(t,s,c){return!(!this.layout||s.isDataDriven()||c.isDataDriven())&&xd.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,s){const c=t.get("text-field"),f=df.paint.properties[s];let v=!1;const x=w=>{for(const T of w)if(f.overrides&&f.overrides.hasOverride(T))return void(v=!0)};if(c.value.kind==="constant"&&c.value.value instanceof Dn)x(c.value.value.sections);else if(c.value.kind==="source"){const w=I=>{v||(I instanceof ta&&Lr(I.value)===Er?x(I.value.sections):I instanceof qo?x(I.sections):I.eachChild(w))},T=c.value;T._styleExpression&&w(T._styleExpression.expression)}return v}}let ay;var xb={get paint(){return ay=ay||new Xn({"background-color":new jt(ce.paint_background["background-color"]),"background-pattern":new ql(ce.paint_background["background-pattern"]),"background-opacity":new jt(ce.paint_background["background-opacity"])})}};class bb extends Gs{constructor(t){super(t,xb)}}let oy;var wb={get paint(){return oy=oy||new Xn({"raster-opacity":new jt(ce.paint_raster["raster-opacity"]),"raster-hue-rotate":new jt(ce.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new jt(ce.paint_raster["raster-brightness-min"]),"raster-brightness-max":new jt(ce.paint_raster["raster-brightness-max"]),"raster-saturation":new jt(ce.paint_raster["raster-saturation"]),"raster-contrast":new jt(ce.paint_raster["raster-contrast"]),"raster-resampling":new jt(ce.paint_raster["raster-resampling"]),"raster-fade-duration":new jt(ce.paint_raster["raster-fade-duration"])})}};class Mb extends Gs{constructor(t){super(t,wb)}}class Sb extends Gs{constructor(t){super(t,{}),this.onAdd=s=>{this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},this.onRemove=s=>{this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Eb{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const pf=63710088e-1;class ol{constructor(t,s){if(isNaN(t)||isNaN(s))throw new Error(`Invalid LngLat object: (${t}, ${s})`);if(this.lng=+t,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ol(Ke(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const s=Math.PI/180,c=this.lat*s,f=t.lat*s,v=Math.sin(c)*Math.sin(f)+Math.cos(c)*Math.cos(f)*Math.cos((t.lng-this.lng)*s);return pf*Math.acos(Math.min(v,1))}static convert(t){if(t instanceof ol)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new ol(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new ol(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const ly=2*Math.PI*pf;function cy(n){return ly*Math.cos(n*Math.PI/180)}function uy(n){return(180+n)/360}function hy(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function dy(n,t){return n/cy(t)}function ff(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}class bd{constructor(t,s,c=0){this.x=+t,this.y=+s,this.z=+c}static fromLngLat(t,s=0){const c=ol.convert(t);return new bd(uy(c.lng),hy(c.lat),dy(s,c.lat))}toLngLat(){return new ol(360*this.x-180,ff(this.y))}toAltitude(){return this.z*cy(ff(this.y))}meterInMercatorCoordinateUnits(){return 1/ly*(t=ff(this.y),1/Math.cos(t*Math.PI/180));var t}}function py(n,t,s){var c=2*Math.PI*6378137/256/Math.pow(2,s);return[n*c-2*Math.PI*6378137/2,t*c-2*Math.PI*6378137/2]}class mf{constructor(t,s,c){if(t<0||t>25||c<0||c>=Math.pow(2,t)||s<0||s>=Math.pow(2,t))throw new Error(`x=${s}, y=${c}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=s,this.y=c,this.key=Yu(0,t,t,s,c)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,s,c){const f=(x=this.y,w=this.z,T=py(256*(v=this.x),256*(x=Math.pow(2,w)-x-1),w),I=py(256*(v+1),256*(x+1),w),T[0]+","+T[1]+","+I[0]+","+I[1]);var v,x,w,T,I;const L=function(O,$,j){let G,K="";for(let re=O;re>0;re--)G=1<<re-1,K+=($&G?1:0)+(j&G?2:0);return K}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(c==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,s>1?"@2x":"").replace(/{quadkey}/g,L).replace(/{bbox-epsg-3857}/g,f)}isChildOf(t){const s=this.z-t.z;return s>0&&t.x===this.x>>s&&t.y===this.y>>s}getTilePoint(t){const s=Math.pow(2,this.z);return new D((t.x*s-this.x)*$r,(t.y*s-this.y)*$r)}toString(){return`${this.z}/${this.x}/${this.y}`}}class fy{constructor(t,s){this.wrap=t,this.canonical=s,this.key=Yu(t,s.z,s.z,s.x,s.y)}}class Zs{constructor(t,s,c,f,v){if(t<c)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${c}`);this.overscaledZ=t,this.wrap=s,this.canonical=new mf(c,+f,+v),this.key=Yu(s,t,c,f,v)}clone(){return new Zs(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-t;return t>this.canonical.z?new Zs(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Zs(t,this.wrap,t,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(t,s){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-t;return t>this.canonical.z?Yu(this.wrap*+s,t,this.canonical.z,this.canonical.x,this.canonical.y):Yu(this.wrap*+s,t,t,this.canonical.x>>c,this.canonical.y>>c)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const s=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>s&&t.canonical.y===this.canonical.y>>s}children(t){if(this.overscaledZ>=t)return[new Zs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,c=2*this.canonical.x,f=2*this.canonical.y;return[new Zs(s,this.wrap,s,c,f),new Zs(s,this.wrap,s,c+1,f),new Zs(s,this.wrap,s,c,f+1),new Zs(s,this.wrap,s,c+1,f+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Zs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Zs(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new fy(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new bd(t.x-this.wrap,t.y))}}function Yu(n,t,s,c,f){(n*=2)<0&&(n=-1*n-1);const v=1<<s;return(v*v*n+v*f+c).toString(36)+s.toString(36)+t.toString(36)}Tt("CanonicalTileID",mf),Tt("OverscaledTileID",Zs,{omit:["posMatrix"]});class my{constructor(t,s,c,f=1,v=1,x=1,w=0){if(this.uid=t,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(c&&!["mapbox","terrarium","custom"].includes(c))return void ct(`"${c}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=s.height;const T=this.dim=s.height-2;switch(this.data=new Uint32Array(s.data.buffer),c){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=f,this.greenFactor=v,this.blueFactor=x,this.baseShift=w;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let I=0;I<T;I++)this.data[this._idx(-1,I)]=this.data[this._idx(0,I)],this.data[this._idx(T,I)]=this.data[this._idx(T-1,I)],this.data[this._idx(I,-1)]=this.data[this._idx(I,0)],this.data[this._idx(I,T)]=this.data[this._idx(I,T-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(T,-1)]=this.data[this._idx(T-1,0)],this.data[this._idx(-1,T)]=this.data[this._idx(0,T-1)],this.data[this._idx(T,T)]=this.data[this._idx(T-1,T-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let I=0;I<T;I++)for(let L=0;L<T;L++){const O=this.get(I,L);O>this.max&&(this.max=O),O<this.min&&(this.min=O)}}get(t,s){const c=new Uint8Array(this.data.buffer),f=4*this._idx(t,s);return this.unpack(c[f],c[f+1],c[f+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,s){if(t<-1||t>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(t+1)}unpack(t,s,c){return t*this.redFactor+s*this.greenFactor+c*this.blueFactor-this.baseShift}getPixels(){return new Hs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,s,c){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let f=s*this.dim,v=s*this.dim+this.dim,x=c*this.dim,w=c*this.dim+this.dim;switch(s){case-1:f=v-1;break;case 1:v=f+1}switch(c){case-1:x=w-1;break;case 1:w=x+1}const T=-s*this.dim,I=-c*this.dim;for(let L=x;L<w;L++)for(let O=f;O<v;O++)this.data[this._idx(O,L)]=t.data[this._idx(O+T,L+I)]}}Tt("DEMData",my);class gy{constructor(t){this._stringToNumber={},this._numberToString=[];for(let s=0;s<t.length;s++){const c=t[s];this._stringToNumber[c]=s,this._numberToString[s]=c}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class yy{constructor(t,s,c,f,v){this.type="Feature",this._vectorTileFeature=t,t._z=s,t._x=c,t._y=f,this.properties=t.properties,this.id=v}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(t[s]=this[s]);return t}}class _y{constructor(t,s){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new On($r,16,0),this.grid3D=new On($r,16,0),this.featureIndexArray=new F,this.promoteId=s}insert(t,s,c,f,v,x){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,f,v);const T=x?this.grid3D:this.grid;for(let I=0;I<s.length;I++){const L=s[I],O=[1/0,1/0,-1/0,-1/0];for(let $=0;$<L.length;$++){const j=L[$];O[0]=Math.min(O[0],j.x),O[1]=Math.min(O[1],j.y),O[2]=Math.max(O[2],j.x),O[3]=Math.max(O[3],j.y)}O[0]<$r&&O[1]<$r&&O[2]>=0&&O[3]>=0&&T.insert(w,O[0],O[1],O[2],O[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new nl.VectorTile(new rf(this.rawTileData)).layers,this.sourceLayerCoder=new gy(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,s,c,f){this.loadVTLayers();const v=t.params||{},x=$r/t.tileSize/t.scale,w=wa(v.filter),T=t.queryGeometry,I=t.queryPadding*x,L=xy(T),O=this.grid.query(L.minX-I,L.minY-I,L.maxX+I,L.maxY+I),$=xy(t.cameraQueryGeometry),j=this.grid3D.query($.minX-I,$.minY-I,$.maxX+I,$.maxY+I,(re,he,Te,pe)=>function(be,$e,Ge,Ct,Bt){for(const xt of be)if($e<=xt.x&&Ge<=xt.y&&Ct>=xt.x&&Bt>=xt.y)return!0;const St=[new D($e,Ge),new D($e,Bt),new D(Ct,Bt),new D(Ct,Ge)];if(be.length>2){for(const xt of St)if(Lc(be,xt))return!0}for(let xt=0;xt<be.length-1;xt++)if(r1(be[xt],be[xt+1],St))return!0;return!1}(t.cameraQueryGeometry,re-I,he-I,Te+I,pe+I));for(const re of j)O.push(re);O.sort(Tb);const G={};let K;for(let re=0;re<O.length;re++){const he=O[re];if(he===K)continue;K=he;const Te=this.featureIndexArray.get(he);let pe=null;this.loadMatchingFeature(G,Te.bucketIndex,Te.sourceLayerIndex,Te.featureIndex,w,v.layers,v.availableImages,s,c,f,(be,$e,Ge)=>(pe||(pe=wo(be)),$e.queryIntersectsFeature(T,be,Ge,pe,this.z,t.transform,x,t.pixelPosMatrix)))}return G}loadMatchingFeature(t,s,c,f,v,x,w,T,I,L,O){const $=this.bucketLayerIDs[s];if(x&&!function(re,he){for(let Te=0;Te<re.length;Te++)if(he.indexOf(re[Te])>=0)return!0;return!1}(x,$))return;const j=this.sourceLayerCoder.decode(c),G=this.vtLayers[j].feature(f);if(v.needGeometry){const re=Mo(G,!0);if(!v.filter(new xr(this.tileID.overscaledZ),re,this.tileID.canonical))return}else if(!v.filter(new xr(this.tileID.overscaledZ),G))return;const K=this.getId(G,j);for(let re=0;re<$.length;re++){const he=$[re];if(x&&x.indexOf(he)<0)continue;const Te=T[he];if(!Te)continue;let pe={};K&&L&&(pe=L.getState(Te.sourceLayer||"_geojsonTileLayer",K));const be=dt({},I[he]);be.paint=vy(be.paint,Te.paint,G,pe,w),be.layout=vy(be.layout,Te.layout,G,pe,w);const $e=!O||O(G,Te,pe);if(!$e)continue;const Ge=new yy(G,this.z,this.x,this.y,K);Ge.layer=be;let Ct=t[he];Ct===void 0&&(Ct=t[he]=[]),Ct.push({featureIndex:f,feature:Ge,intersectionZ:$e})}}lookupSymbolFeatures(t,s,c,f,v,x,w,T){const I={};this.loadVTLayers();const L=wa(v);for(const O of t)this.loadMatchingFeature(I,c,f,O,L,x,w,T,s);return I}hasLayer(t){for(const s of this.bucketLayerIDs)for(const c of s)if(t===c)return!0;return!1}getId(t,s){let c=t.id;return this.promoteId&&(c=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]],typeof c=="boolean"&&(c=Number(c))),c}}function vy(n,t,s,c,f){return Pt(n,(v,x)=>{const w=t instanceof jl?t.get(x):null;return w&&w.evaluate?w.evaluate(s,c,f):w})}function xy(n){let t=1/0,s=1/0,c=-1/0,f=-1/0;for(const v of n)t=Math.min(t,v.x),s=Math.min(s,v.y),c=Math.max(c,v.x),f=Math.max(f,v.y);return{minX:t,minY:s,maxX:c,maxY:f}}function Tb(n,t){return t-n}function by(n,t,s,c,f){const v=[];for(let x=0;x<n.length;x++){const w=n[x];let T;for(let I=0;I<w.length-1;I++){let L=w[I],O=w[I+1];L.x<t&&O.x<t||(L.x<t?L=new D(t,L.y+(t-L.x)/(O.x-L.x)*(O.y-L.y))._round():O.x<t&&(O=new D(t,L.y+(t-L.x)/(O.x-L.x)*(O.y-L.y))._round()),L.y<s&&O.y<s||(L.y<s?L=new D(L.x+(s-L.y)/(O.y-L.y)*(O.x-L.x),s)._round():O.y<s&&(O=new D(L.x+(s-L.y)/(O.y-L.y)*(O.x-L.x),s)._round()),L.x>=c&&O.x>=c||(L.x>=c?L=new D(c,L.y+(c-L.x)/(O.x-L.x)*(O.y-L.y))._round():O.x>=c&&(O=new D(c,L.y+(c-L.x)/(O.x-L.x)*(O.y-L.y))._round()),L.y>=f&&O.y>=f||(L.y>=f?L=new D(L.x+(f-L.y)/(O.y-L.y)*(O.x-L.x),f)._round():O.y>=f&&(O=new D(L.x+(f-L.y)/(O.y-L.y)*(O.x-L.x),f)._round()),T&&L.equals(T[T.length-1])||(T=[L],v.push(T)),T.push(O)))))}}return v}Tt("FeatureIndex",_y,{omit:["rawTileData","sourceLayerCoder"]});class ll extends D{constructor(t,s,c,f){super(t,s),this.angle=c,f!==void 0&&(this.segment=f)}clone(){return new ll(this.x,this.y,this.angle,this.segment)}}function wy(n,t,s,c,f){if(t.segment===void 0||s===0)return!0;let v=t,x=t.segment+1,w=0;for(;w>-s/2;){if(x--,x<0)return!1;w-=n[x].dist(v),v=n[x]}w+=n[x].dist(n[x+1]),x++;const T=[];let I=0;for(;w<s/2;){const L=n[x],O=n[x+1];if(!O)return!1;let $=n[x-1].angleTo(L)-L.angleTo(O);for($=Math.abs(($+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:w,angleDelta:$}),I+=$;w-T[0].distance>c;)I-=T.shift().angleDelta;if(I>f)return!1;x++,w+=L.dist(O)}return!0}function My(n){let t=0;for(let s=0;s<n.length-1;s++)t+=n[s].dist(n[s+1]);return t}function Sy(n,t,s){return n?.6*t*s:0}function Ey(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function Cb(n,t,s,c,f,v){const x=Sy(s,f,v),w=Ey(s,c)*v;let T=0;const I=My(n)/2;for(let L=0;L<n.length-1;L++){const O=n[L],$=n[L+1],j=O.dist($);if(T+j>I){const G=(I-T)/j,K=pn.number(O.x,$.x,G),re=pn.number(O.y,$.y,G),he=new ll(K,re,$.angleTo(O),L);return he._round(),!x||wy(n,he,w,x,t)?he:void 0}T+=j}}function Ib(n,t,s,c,f,v,x,w,T){const I=Sy(c,v,x),L=Ey(c,f),O=L*x,$=n[0].x===0||n[0].x===T||n[0].y===0||n[0].y===T;return t-O<t/4&&(t=O+t/4),Ty(n,$?t/2*w%t:(L/2+2*v)*x*w%t,t,I,s,O,$,!1,T)}function Ty(n,t,s,c,f,v,x,w,T){const I=v/2,L=My(n);let O=0,$=t-s,j=[];for(let G=0;G<n.length-1;G++){const K=n[G],re=n[G+1],he=K.dist(re),Te=re.angleTo(K);for(;$+s<O+he;){$+=s;const pe=($-O)/he,be=pn.number(K.x,re.x,pe),$e=pn.number(K.y,re.y,pe);if(be>=0&&be<T&&$e>=0&&$e<T&&$-I>=0&&$+I<=L){const Ge=new ll(be,$e,Te,G);Ge._round(),c&&!wy(n,Ge,v,c,f)||j.push(Ge)}}O+=he}return w||j.length||x||(j=Ty(n,O/2,s,c,f,v,x,!0,T)),j}Tt("Anchor",ll);const Uc=hs;function Cy(n,t,s,c){const f=[],v=n.image,x=v.pixelRatio,w=v.paddedRect.w-2*Uc,T=v.paddedRect.h-2*Uc,I=n.right-n.left,L=n.bottom-n.top,O=v.stretchX||[[0,w]],$=v.stretchY||[[0,T]],j=(lt,kt)=>lt+kt[1]-kt[0],G=O.reduce(j,0),K=$.reduce(j,0),re=w-G,he=T-K;let Te=0,pe=G,be=0,$e=K,Ge=0,Ct=re,Bt=0,St=he;if(v.content&&c){const lt=v.content;Te=wd(O,0,lt[0]),be=wd($,0,lt[1]),pe=wd(O,lt[0],lt[2]),$e=wd($,lt[1],lt[3]),Ge=lt[0]-Te,Bt=lt[1]-be,Ct=lt[2]-lt[0]-pe,St=lt[3]-lt[1]-$e}const xt=(lt,kt,_t,et)=>{const Jt=Md(lt.stretch-Te,pe,I,n.left),Ut=Sd(lt.fixed-Ge,Ct,lt.stretch,G),Ei=Md(kt.stretch-be,$e,L,n.top),gr=Sd(kt.fixed-Bt,St,kt.stretch,K),wr=Md(_t.stretch-Te,pe,I,n.left),an=Sd(_t.fixed-Ge,Ct,_t.stretch,G),Is=Md(et.stretch-be,$e,L,n.top),Yn=Sd(et.fixed-Bt,St,et.stretch,K),Yr=new D(Jt,Ei),Tn=new D(wr,Ei),Ln=new D(wr,Is),Jn=new D(Jt,Is),Qn=new D(Ut/x,gr/x),on=new D(an/x,Yn/x),ln=t*Math.PI/180;if(ln){const Bn=Math.sin(ln),ds=Math.cos(ln),ps=[ds,-Bn,Bn,ds];Yr._matMult(ps),Tn._matMult(ps),Jn._matMult(ps),Ln._matMult(ps)}const Fn=lt.stretch+lt.fixed,es=kt.stretch+kt.fixed;return{tl:Yr,tr:Tn,bl:Jn,br:Ln,tex:{x:v.paddedRect.x+Uc+Fn,y:v.paddedRect.y+Uc+es,w:_t.stretch+_t.fixed-Fn,h:et.stretch+et.fixed-es},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Qn,pixelOffsetBR:on,minFontScaleX:Ct/x/I,minFontScaleY:St/x/L,isSDF:s}};if(c&&(v.stretchX||v.stretchY)){const lt=Iy(O,re,G),kt=Iy($,he,K);for(let _t=0;_t<lt.length-1;_t++){const et=lt[_t],Jt=lt[_t+1];for(let Ut=0;Ut<kt.length-1;Ut++)f.push(xt(et,kt[Ut],Jt,kt[Ut+1]))}}else f.push(xt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:T+1}));return f}function wd(n,t,s){let c=0;for(const f of n)c+=Math.max(t,Math.min(s,f[1]))-Math.max(t,Math.min(s,f[0]));return c}function Iy(n,t,s){const c=[{fixed:-Uc,stretch:0}];for(const[f,v]of n){const x=c[c.length-1];c.push({fixed:f-x.stretch,stretch:x.stretch}),c.push({fixed:f-x.stretch,stretch:x.stretch+(v-f)})}return c.push({fixed:t+Uc,stretch:s}),c}function Md(n,t,s,c){return n/t*s+c}function Sd(n,t,s,c){return n-t*s/c}class Ed{constructor(t,s,c,f,v,x,w,T,I,L){if(this.boxStartIndex=t.length,I){let O=x.top,$=x.bottom;const j=x.collisionPadding;j&&(O-=j[1],$+=j[3]);let G=$-O;G>0&&(G=Math.max(10,G),this.circleDiameter=G)}else{let O=x.top*w-T[0],$=x.bottom*w+T[2],j=x.left*w-T[3],G=x.right*w+T[1];const K=x.collisionPadding;if(K&&(j-=K[0]*w,O-=K[1]*w,G+=K[2]*w,$+=K[3]*w),L){const re=new D(j,O),he=new D(G,O),Te=new D(j,$),pe=new D(G,$),be=L*Math.PI/180;re._rotate(be),he._rotate(be),Te._rotate(be),pe._rotate(be),j=Math.min(re.x,he.x,Te.x,pe.x),G=Math.max(re.x,he.x,Te.x,pe.x),O=Math.min(re.y,he.y,Te.y,pe.y),$=Math.max(re.y,he.y,Te.y,pe.y)}t.emplaceBack(s.x,s.y,j,O,G,$,c,f,v)}this.boxEndIndex=t.length}}class Ab{constructor(t=[],s=Pb){if(this.data=t,this.length=this.data.length,this.compare=s,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:s,compare:c}=this,f=s[t];for(;t>0;){const v=t-1>>1,x=s[v];if(c(f,x)>=0)break;s[t]=x,t=v}s[t]=f}_down(t){const{data:s,compare:c}=this,f=this.length>>1,v=s[t];for(;t<f;){let x=1+(t<<1),w=s[x];const T=x+1;if(T<this.length&&c(s[T],w)<0&&(x=T,w=s[T]),c(w,v)>=0)break;s[t]=w,t=x}s[t]=v}}function Pb(n,t){return n<t?-1:n>t?1:0}function Db(n,t=1,s=!1){let c=1/0,f=1/0,v=-1/0,x=-1/0;const w=n[0];for(let j=0;j<w.length;j++){const G=w[j];(!j||G.x<c)&&(c=G.x),(!j||G.y<f)&&(f=G.y),(!j||G.x>v)&&(v=G.x),(!j||G.y>x)&&(x=G.y)}const T=Math.min(v-c,x-f);let I=T/2;const L=new Ab([],kb);if(T===0)return new D(c,f);for(let j=c;j<v;j+=T)for(let G=f;G<x;G+=T)L.push(new Vc(j+I,G+I,I,n));let O=function(j){let G=0,K=0,re=0;const he=j[0];for(let Te=0,pe=he.length,be=pe-1;Te<pe;be=Te++){const $e=he[Te],Ge=he[be],Ct=$e.x*Ge.y-Ge.x*$e.y;K+=($e.x+Ge.x)*Ct,re+=($e.y+Ge.y)*Ct,G+=3*Ct}return new Vc(K/G,re/G,0,j)}(n),$=L.length;for(;L.length;){const j=L.pop();(j.d>O.d||!O.d)&&(O=j,s&&console.log("found best %d after %d probes",Math.round(1e4*j.d)/1e4,$)),j.max-O.d<=t||(I=j.h/2,L.push(new Vc(j.p.x-I,j.p.y-I,I,n)),L.push(new Vc(j.p.x+I,j.p.y-I,I,n)),L.push(new Vc(j.p.x-I,j.p.y+I,I,n)),L.push(new Vc(j.p.x+I,j.p.y+I,I,n)),$+=4)}return s&&(console.log(`num probes: ${$}`),console.log(`best distance: ${O.d}`)),O.p}function kb(n,t){return t.max-n.max}function Vc(n,t,s,c){this.p=new D(n,t),this.h=s,this.d=function(f,v){let x=!1,w=1/0;for(let T=0;T<v.length;T++){const I=v[T];for(let L=0,O=I.length,$=O-1;L<O;$=L++){const j=I[L],G=I[$];j.y>f.y!=G.y>f.y&&f.x<(G.x-j.x)*(f.y-j.y)/(G.y-j.y)+j.x&&(x=!x),w=Math.min(w,hg(f,j,G))}}return(x?1:-1)*Math.sqrt(w)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}var kn;m.ap=void 0,(kn=m.ap||(m.ap={}))[kn.center=1]="center",kn[kn.left=2]="left",kn[kn.right=3]="right",kn[kn.top=4]="top",kn[kn.bottom=5]="bottom",kn[kn["top-left"]=6]="top-left",kn[kn["top-right"]=7]="top-right",kn[kn["bottom-left"]=8]="bottom-left",kn[kn["bottom-right"]=9]="bottom-right";const cl=7,gf=Number.POSITIVE_INFINITY;function Ay(n,t){return t[1]!==gf?function(s,c,f){let v=0,x=0;switch(c=Math.abs(c),f=Math.abs(f),s){case"top-right":case"top-left":case"top":x=f-cl;break;case"bottom-right":case"bottom-left":case"bottom":x=-f+cl}switch(s){case"top-right":case"bottom-right":case"right":v=-c;break;case"top-left":case"bottom-left":case"left":v=c}return[v,x]}(n,t[0],t[1]):function(s,c){let f=0,v=0;c<0&&(c=0);const x=c/Math.SQRT2;switch(s){case"top-right":case"top-left":v=x-cl;break;case"bottom-right":case"bottom-left":v=-x+cl;break;case"bottom":v=-c+cl;break;case"top":v=c-cl}switch(s){case"top-right":case"bottom-right":f=-x;break;case"top-left":case"bottom-left":f=x;break;case"left":f=c;break;case"right":f=-c}return[f,v]}(n,t[0])}function Py(n,t,s){var c;const f=n.layout,v=(c=f.get("text-variable-anchor-offset"))===null||c===void 0?void 0:c.evaluate(t,{},s);if(v){const w=v.values,T=[];for(let I=0;I<w.length;I+=2){const L=T[I]=w[I],O=w[I+1].map($=>$*sn);L.startsWith("top")?O[1]-=cl:L.startsWith("bottom")&&(O[1]+=cl),T[I+1]=O}return new kr(T)}const x=f.get("text-variable-anchor");if(x){let w;w=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[f.get("text-radial-offset").evaluate(t,{},s)*sn,gf]:f.get("text-offset").evaluate(t,{},s).map(I=>I*sn);const T=[];for(const I of x)T.push(I,Ay(I,w));return new kr(T)}return null}function yf(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Lb(n,t,s,c,f,v,x,w,T,I,L){let O=v.textMaxSize.evaluate(t,{});O===void 0&&(O=x);const $=n.layers[0].layout,j=$.get("icon-offset").evaluate(t,{},L),G=ky(s.horizontal),K=x/24,re=n.tilePixelRatio*K,he=n.tilePixelRatio*O/24,Te=n.tilePixelRatio*w,pe=n.tilePixelRatio*$.get("symbol-spacing"),be=$.get("text-padding")*n.tilePixelRatio,$e=function(et,Jt,Ut,Ei=1){const gr=et.get("icon-padding").evaluate(Jt,{},Ut),wr=gr&&gr.values;return[wr[0]*Ei,wr[1]*Ei,wr[2]*Ei,wr[3]*Ei]}($,t,L,n.tilePixelRatio),Ge=$.get("text-max-angle")/180*Math.PI,Ct=$.get("text-rotation-alignment")!=="viewport"&&$.get("symbol-placement")!=="point",Bt=$.get("icon-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",St=$.get("symbol-placement"),xt=pe/2,lt=$.get("icon-text-fit");let kt;c&&lt!=="none"&&(n.allowVerticalPlacement&&s.vertical&&(kt=ty(c,s.vertical,lt,$.get("icon-text-fit-padding"),j,K)),G&&(c=ty(c,G,lt,$.get("icon-text-fit-padding"),j,K)));const _t=(et,Jt)=>{Jt.x<0||Jt.x>=$r||Jt.y<0||Jt.y>=$r||function(Ut,Ei,gr,wr,an,Is,Yn,Yr,Tn,Ln,Jn,Qn,on,ln,Fn,es,Bn,ds,ps,cn,Pi,Nn,Rn,un,ca){const Aa=Ut.addToLineVertexArray(Ei,gr);let Pa,Eo,ua,Ws,fs=0,To=0,eh=0,Oy=0,Ef=-1,Tf=-1;const Co={};let Fy=Or("");if(Ut.allowVerticalPlacement&&wr.vertical){const $n=Yr.layout.get("text-rotate").evaluate(Pi,{},un)+90;ua=new Ed(Tn,Ei,Ln,Jn,Qn,wr.vertical,on,ln,Fn,$n),Yn&&(Ws=new Ed(Tn,Ei,Ln,Jn,Qn,Yn,Bn,ds,Fn,$n))}if(an){const $n=Yr.layout.get("icon-rotate").evaluate(Pi,{}),Xs=Yr.layout.get("icon-text-fit")!=="none",Jl=Cy(an,$n,Rn,Xs),ka=Yn?Cy(Yn,$n,Rn,Xs):void 0;Eo=new Ed(Tn,Ei,Ln,Jn,Qn,an,Bn,ds,!1,$n),fs=4*Jl.length;const Ql=Ut.iconSizeData;let Ya=null;Ql.kind==="source"?(Ya=[Ka*Yr.layout.get("icon-size").evaluate(Pi,{})],Ya[0]>al&&ct(`${Ut.layerIds[0]}: Value for "icon-size" is >= ${Ku}. Reduce your "icon-size".`)):Ql.kind==="composite"&&(Ya=[Ka*Nn.compositeIconSizes[0].evaluate(Pi,{},un),Ka*Nn.compositeIconSizes[1].evaluate(Pi,{},un)],(Ya[0]>al||Ya[1]>al)&&ct(`${Ut.layerIds[0]}: Value for "icon-size" is >= ${Ku}. Reduce your "icon-size".`)),Ut.addSymbols(Ut.icon,Jl,Ya,cn,ps,Pi,m.ah.none,Ei,Aa.lineStartIndex,Aa.lineLength,-1,un),Ef=Ut.icon.placedSymbolArray.length-1,ka&&(To=4*ka.length,Ut.addSymbols(Ut.icon,ka,Ya,cn,ps,Pi,m.ah.vertical,Ei,Aa.lineStartIndex,Aa.lineLength,-1,un),Tf=Ut.icon.placedSymbolArray.length-1)}const By=Object.keys(wr.horizontal);for(const $n of By){const Xs=wr.horizontal[$n];if(!Pa){Fy=Or(Xs.text);const ka=Yr.layout.get("text-rotate").evaluate(Pi,{},un);Pa=new Ed(Tn,Ei,Ln,Jn,Qn,Xs,on,ln,Fn,ka)}const Jl=Xs.positionedLines.length===1;if(eh+=Dy(Ut,Ei,Xs,Is,Yr,Fn,Pi,es,Aa,wr.vertical?m.ah.horizontal:m.ah.horizontalOnly,Jl?By:[$n],Co,Ef,Nn,un),Jl)break}wr.vertical&&(Oy+=Dy(Ut,Ei,wr.vertical,Is,Yr,Fn,Pi,es,Aa,m.ah.vertical,["vertical"],Co,Tf,Nn,un));const Ob=Pa?Pa.boxStartIndex:Ut.collisionBoxArray.length,Fb=Pa?Pa.boxEndIndex:Ut.collisionBoxArray.length,Bb=ua?ua.boxStartIndex:Ut.collisionBoxArray.length,Nb=ua?ua.boxEndIndex:Ut.collisionBoxArray.length,$b=Eo?Eo.boxStartIndex:Ut.collisionBoxArray.length,Ub=Eo?Eo.boxEndIndex:Ut.collisionBoxArray.length,Vb=Ws?Ws.boxStartIndex:Ut.collisionBoxArray.length,jb=Ws?Ws.boxEndIndex:Ut.collisionBoxArray.length;let Da=-1;const Cd=($n,Xs)=>$n&&$n.circleDiameter?Math.max($n.circleDiameter,Xs):Xs;Da=Cd(Pa,Da),Da=Cd(ua,Da),Da=Cd(Eo,Da),Da=Cd(Ws,Da);const Ny=Da>-1?1:0;Ny&&(Da*=ca/sn),Ut.glyphOffsetArray.length>=$c.MAX_GLYPHS&&ct("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Pi.sortKey!==void 0&&Ut.addToSortKeyRanges(Ut.symbolInstances.length,Pi.sortKey);const qb=Py(Yr,Pi,un),[Gb,Hb]=function($n,Xs){const Jl=$n.length,ka=Xs==null?void 0:Xs.values;if((ka==null?void 0:ka.length)>0)for(let Ql=0;Ql<ka.length;Ql+=2){const Ya=ka[Ql+1];$n.emplaceBack(m.ap[ka[Ql]],Ya[0],Ya[1])}return[Jl,$n.length]}(Ut.textAnchorOffsets,qb);Ut.symbolInstances.emplaceBack(Ei.x,Ei.y,Co.right>=0?Co.right:-1,Co.center>=0?Co.center:-1,Co.left>=0?Co.left:-1,Co.vertical||-1,Ef,Tf,Fy,Ob,Fb,Bb,Nb,$b,Ub,Vb,jb,Ln,eh,Oy,fs,To,Ny,0,on,Da,Gb,Hb)}(n,Jt,et,s,c,f,kt,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,re,[be,be,be,be],Ct,T,Te,$e,Bt,j,t,v,I,L,x)};if(St==="line")for(const et of by(t.geometry,0,0,$r,$r)){const Jt=Ib(et,pe,Ge,s.vertical||G,c,24,he,n.overscaling,$r);for(const Ut of Jt)G&&Rb(n,G.text,xt,Ut)||_t(et,Ut)}else if(St==="line-center"){for(const et of t.geometry)if(et.length>1){const Jt=Cb(et,Ge,s.vertical||G,c,24,he);Jt&&_t(et,Jt)}}else if(t.type==="Polygon")for(const et of Wp(t.geometry,0)){const Jt=Db(et,16);_t(et[0],new ll(Jt.x,Jt.y,0))}else if(t.type==="LineString")for(const et of t.geometry)_t(et,new ll(et[0].x,et[0].y,0));else if(t.type==="Point")for(const et of t.geometry)for(const Jt of et)_t([Jt],new ll(Jt.x,Jt.y,0))}function Dy(n,t,s,c,f,v,x,w,T,I,L,O,$,j,G){const K=function(Te,pe,be,$e,Ge,Ct,Bt,St){const xt=$e.layout.get("text-rotate").evaluate(Ct,{})*Math.PI/180,lt=[];for(const kt of pe.positionedLines)for(const _t of kt.positionedGlyphs){if(!_t.rect)continue;const et=_t.rect||{};let Jt=Wg+1,Ut=!0,Ei=1,gr=0;const wr=(Ge||St)&&_t.vertical,an=_t.metrics.advance*_t.scale/2;if(St&&pe.verticalizable&&(gr=kt.lineOffset/2-(_t.imageName?-(sn-_t.metrics.width*_t.scale)/2:(_t.scale-1)*sn)),_t.imageName){const cn=Bt[_t.imageName];Ut=cn.sdf,Ei=cn.pixelRatio,Jt=hs/Ei}const Is=Ge?[_t.x+an,_t.y]:[0,0];let Yn=Ge?[0,0]:[_t.x+an+be[0],_t.y+be[1]-gr],Yr=[0,0];wr&&(Yr=Yn,Yn=[0,0]);const Tn=_t.metrics.isDoubleResolution?2:1,Ln=(_t.metrics.left-Jt)*_t.scale-an+Yn[0],Jn=(-_t.metrics.top-Jt)*_t.scale+Yn[1],Qn=Ln+et.w/Tn*_t.scale/Ei,on=Jn+et.h/Tn*_t.scale/Ei,ln=new D(Ln,Jn),Fn=new D(Qn,Jn),es=new D(Ln,on),Bn=new D(Qn,on);if(wr){const cn=new D(-an,an-Wu),Pi=-Math.PI/2,Nn=sn/2-an,Rn=new D(5-Wu-Nn,-(_t.imageName?Nn:0)),un=new D(...Yr);ln._rotateAround(Pi,cn)._add(Rn)._add(un),Fn._rotateAround(Pi,cn)._add(Rn)._add(un),es._rotateAround(Pi,cn)._add(Rn)._add(un),Bn._rotateAround(Pi,cn)._add(Rn)._add(un)}if(xt){const cn=Math.sin(xt),Pi=Math.cos(xt),Nn=[Pi,-cn,cn,Pi];ln._matMult(Nn),Fn._matMult(Nn),es._matMult(Nn),Bn._matMult(Nn)}const ds=new D(0,0),ps=new D(0,0);lt.push({tl:ln,tr:Fn,bl:es,br:Bn,tex:et,writingMode:pe.writingMode,glyphOffset:Is,sectionIndex:_t.sectionIndex,isSDF:Ut,pixelOffsetTL:ds,pixelOffsetBR:ps,minFontScaleX:0,minFontScaleY:0})}return lt}(0,s,w,f,v,x,c,n.allowVerticalPlacement),re=n.textSizeData;let he=null;re.kind==="source"?(he=[Ka*f.layout.get("text-size").evaluate(x,{})],he[0]>al&&ct(`${n.layerIds[0]}: Value for "text-size" is >= ${Ku}. Reduce your "text-size".`)):re.kind==="composite"&&(he=[Ka*j.compositeTextSizes[0].evaluate(x,{},G),Ka*j.compositeTextSizes[1].evaluate(x,{},G)],(he[0]>al||he[1]>al)&&ct(`${n.layerIds[0]}: Value for "text-size" is >= ${Ku}. Reduce your "text-size".`)),n.addSymbols(n.text,K,he,w,v,x,I,t,T.lineStartIndex,T.lineLength,$,G);for(const Te of L)O[Te]=n.text.placedSymbolArray.length-1;return 4*K.length}function ky(n){for(const t in n)return n[t];return null}function Rb(n,t,s,c){const f=n.compareText;if(t in f){const v=f[t];for(let x=v.length-1;x>=0;x--)if(c.dist(v[x])<s)return!0}else f[t]=[];return f[t].push(c),!1}const Ly=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class _f{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,c]=new Uint8Array(t,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const f=c>>4;if(f!==1)throw new Error(`Got v${f} data when expected v1.`);const v=Ly[15&c];if(!v)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(t,2,1),[w]=new Uint32Array(t,4,1);return new _f(w,x,v,t)}constructor(t,s=64,c=Float64Array,f){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=c,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const v=Ly.indexOf(this.ArrayType),x=2*t*this.ArrayType.BYTES_PER_ELEMENT,w=t*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-w%8)%8;if(v<0)throw new Error(`Unexpected typed array class: ${c}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+w+T,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+x+w+T),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+w+T,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+v]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=t)}add(t,s){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=t,this.coords[this._pos++]=s,c}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return vf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,s,c,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:x,nodeSize:w}=this,T=[0,v.length-1,0],I=[];for(;T.length;){const L=T.pop()||0,O=T.pop()||0,$=T.pop()||0;if(O-$<=w){for(let re=$;re<=O;re++){const he=x[2*re],Te=x[2*re+1];he>=t&&he<=c&&Te>=s&&Te<=f&&I.push(v[re])}continue}const j=$+O>>1,G=x[2*j],K=x[2*j+1];G>=t&&G<=c&&K>=s&&K<=f&&I.push(v[j]),(L===0?t<=G:s<=K)&&(T.push($),T.push(j-1),T.push(1-L)),(L===0?c>=G:f>=K)&&(T.push(j+1),T.push(O),T.push(1-L))}return I}within(t,s,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:v,nodeSize:x}=this,w=[0,f.length-1,0],T=[],I=c*c;for(;w.length;){const L=w.pop()||0,O=w.pop()||0,$=w.pop()||0;if(O-$<=x){for(let re=$;re<=O;re++)zy(v[2*re],v[2*re+1],t,s)<=I&&T.push(f[re]);continue}const j=$+O>>1,G=v[2*j],K=v[2*j+1];zy(G,K,t,s)<=I&&T.push(f[j]),(L===0?t-c<=G:s-c<=K)&&(w.push($),w.push(j-1),w.push(1-L)),(L===0?t+c>=G:s+c>=K)&&(w.push(j+1),w.push(O),w.push(1-L))}return T}}function vf(n,t,s,c,f,v){if(f-c<=s)return;const x=c+f>>1;Ry(n,t,x,c,f,v),vf(n,t,s,c,x-1,1-v),vf(n,t,s,x+1,f,1-v)}function Ry(n,t,s,c,f,v){for(;f>c;){if(f-c>600){const I=f-c+1,L=s-c+1,O=Math.log(I),$=.5*Math.exp(2*O/3),j=.5*Math.sqrt(O*$*(I-$)/I)*(L-I/2<0?-1:1);Ry(n,t,s,Math.max(c,Math.floor(s-L*$/I+j)),Math.min(f,Math.floor(s+(I-L)*$/I+j)),v)}const x=t[2*s+v];let w=c,T=f;for(Ju(n,t,c,s),t[2*f+v]>x&&Ju(n,t,c,f);w<T;){for(Ju(n,t,w,T),w++,T--;t[2*w+v]<x;)w++;for(;t[2*T+v]>x;)T--}t[2*c+v]===x?Ju(n,t,c,T):(T++,Ju(n,t,T,f)),T<=s&&(c=T+1),s<=T&&(f=T-1)}}function Ju(n,t,s,c){xf(n,s,c),xf(t,2*s,2*c),xf(t,2*s+1,2*c+1)}function xf(n,t,s){const c=n[t];n[t]=n[s],n[s]=c}function zy(n,t,s,c){const f=n-s,v=t-c;return f*f+v*v}var bf;m.bd=void 0,(bf=m.bd||(m.bd={})).create="create",bf.load="load",bf.fullLoad="fullLoad";let Td=null,Qu=[];const wf=1e3/60,Mf="loadTime",Sf="fullLoadTime",zb={mark(n){performance.mark(n)},frame(n){const t=n;Td!=null&&Qu.push(t-Td),Td=t},clearMetrics(){Td=null,Qu=[],performance.clearMeasures(Mf),performance.clearMeasures(Sf);for(const n in m.bd)performance.clearMarks(m.bd[n])},getPerformanceMetrics(){performance.measure(Mf,m.bd.create,m.bd.load),performance.measure(Sf,m.bd.create,m.bd.fullLoad);const n=performance.getEntriesByName(Mf)[0].duration,t=performance.getEntriesByName(Sf)[0].duration,s=Qu.length,c=1/(Qu.reduce((v,x)=>v+x,0)/s/1e3),f=Qu.filter(v=>v>wf).reduce((v,x)=>v+(x-wf)/wf,0);return{loadTime:n,fullLoadTime:t,fps:c,percentDroppedFrames:f/(s+f)*100,totalFrames:s}}};m.$=ht,m.A=Rc,m.B=function(n){if(ii==null){const t=n.navigator?n.navigator.userAgent:null;ii=!!n.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return ii},m.C=class{constructor(n,t){this.target=n,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Eb(()=>this.process()),this.subscription=function(s,c,f,v){return s.addEventListener(c,f,!1),{unsubscribe:()=>{s.removeEventListener(c,f,!1)}}}(this.target,"message",s=>this.receive(s)),this.globalScope=ti(self)?n:window}registerMessageHandler(n,t){this.messageHandlers[n]=t}sendAsync(n,t){return new Promise((s,c)=>{const f=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[f]={resolve:s,reject:c},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[f];const w={id:f,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(w)},{once:!0});const v=[],x=Object.assign(Object.assign({},n),{id:f,sourceMapId:this.mapId,origin:location.origin,data:ls(n.data,v)});this.target.postMessage(x,{transfer:v})})}receive(n){const t=n.data,s=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[s];const c=this.abortControllers[s];return delete this.abortControllers[s],void(c&&c.abort())}if(ti(self)||t.mustQueue)return this.tasks[s]=t,this.taskQueue.push(s),void this.invoker.trigger();this.processTask(s,t)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),t=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(n,t)}processTask(n,t){return l(this,void 0,void 0,function*(){if(t.type==="<response>"){const f=this.resolveRejects[n];return delete this.resolveRejects[n],f?void(t.error?f.reject(Wn(t.error)):f.resolve(Wn(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const s=Wn(t.data),c=new AbortController;this.abortControllers[n]=c;try{const f=yield this.messageHandlers[t.type](t.sourceMapId,s,c);this.completeTask(n,null,f)}catch(f){this.completeTask(n,f)}})}completeTask(n,t,s){const c=[];delete this.abortControllers[n];const f={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?ls(t):null,data:ls(s,c)};this.target.postMessage(f,{transfer:c})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},m.D=jt,m.E=Fe,m.F=function(){var n=new Rc(16);return Rc!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},m.G=Ve,m.H=function(n,t,s){var c,f,v,x,w,T,I,L,O,$,j,G,K=s[0],re=s[1],he=s[2];return t===n?(n[12]=t[0]*K+t[4]*re+t[8]*he+t[12],n[13]=t[1]*K+t[5]*re+t[9]*he+t[13],n[14]=t[2]*K+t[6]*re+t[10]*he+t[14],n[15]=t[3]*K+t[7]*re+t[11]*he+t[15]):(f=t[1],v=t[2],x=t[3],w=t[4],T=t[5],I=t[6],L=t[7],O=t[8],$=t[9],j=t[10],G=t[11],n[0]=c=t[0],n[1]=f,n[2]=v,n[3]=x,n[4]=w,n[5]=T,n[6]=I,n[7]=L,n[8]=O,n[9]=$,n[10]=j,n[11]=G,n[12]=c*K+w*re+O*he+t[12],n[13]=f*K+T*re+$*he+t[13],n[14]=v*K+I*re+j*he+t[14],n[15]=x*K+L*re+G*he+t[15]),n},m.I=sf,m.J=function(n,t,s){var c=s[0],f=s[1],v=s[2];return n[0]=t[0]*c,n[1]=t[1]*c,n[2]=t[2]*c,n[3]=t[3]*c,n[4]=t[4]*f,n[5]=t[5]*f,n[6]=t[6]*f,n[7]=t[7]*f,n[8]=t[8]*v,n[9]=t[9]*v,n[10]=t[10]*v,n[11]=t[11]*v,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},m.K=mg,m.L=function(n,t){const s={};for(let c=0;c<t.length;c++){const f=t[c];f in n&&(s[f]=n[f])}return s},m.M=ol,m.N=uy,m.O=hy,m.P=D,m.Q=Zs,m.R=Hs,m.S=xe,m.T=Mu,m.U=Pe,m.V=yr,m.W=$r,m.X=qr,m.Y=bd,m.Z=class extends Tu{},m._=l,m.a=Zi,m.a$=function(n,t,s){return n[0]=t[0]*s[0],n[1]=t[1]*s[1],n[2]=t[2]*s[2],n[3]=t[3]*s[3],n},m.a0=mf,m.a1=Ue,m.a2=n=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(s=>{t.onloadstart=()=>{s(t)};for(const c of n){const f=window.document.createElement("source");Di(c)||(t.crossOrigin="Anonymous"),f.src=c,t.appendChild(f)}})},m.a3=function(){return bt++},m.a4=y,m.a5=$c,m.a6=wa,m.a7=Mo,m.a8=xr,m.a9=yy,m.aA=Rt,m.aB=function(n,t){if(!n)return[{command:"setStyle",args:[t]}];let s=[];try{if(!Be(n.version,t.version))return[{command:"setStyle",args:[t]}];Be(n.center,t.center)||s.push({command:"setCenter",args:[t.center]}),Be(n.zoom,t.zoom)||s.push({command:"setZoom",args:[t.zoom]}),Be(n.bearing,t.bearing)||s.push({command:"setBearing",args:[t.bearing]}),Be(n.pitch,t.pitch)||s.push({command:"setPitch",args:[t.pitch]}),Be(n.sprite,t.sprite)||s.push({command:"setSprite",args:[t.sprite]}),Be(n.glyphs,t.glyphs)||s.push({command:"setGlyphs",args:[t.glyphs]}),Be(n.transition,t.transition)||s.push({command:"setTransition",args:[t.transition]}),Be(n.light,t.light)||s.push({command:"setLight",args:[t.light]}),Be(n.terrain,t.terrain)||s.push({command:"setTerrain",args:[t.terrain]}),Be(n.sky,t.sky)||s.push({command:"setSky",args:[t.sky]});const c={},f=[];(function(x,w,T,I){let L;for(L in w=w||{},x=x||{})Object.prototype.hasOwnProperty.call(x,L)&&(Object.prototype.hasOwnProperty.call(w,L)||Dt(L,T,I));for(L in w)Object.prototype.hasOwnProperty.call(w,L)&&(Object.prototype.hasOwnProperty.call(x,L)?Be(x[L],w[L])||(x[L].type==="geojson"&&w[L].type==="geojson"&&Zt(x,w,L)?rt(T,{command:"setGeoJSONSourceData",args:[L,w[L].data]}):Xt(L,w,T,I)):it(L,w,T))})(n.sources,t.sources,f,c);const v=[];n.layers&&n.layers.forEach(x=>{"source"in x&&c[x.source]?s.push({command:"removeLayer",args:[x.id]}):v.push(x)}),s=s.concat(f),function(x,w,T){w=w||[];const I=(x=x||[]).map(yi),L=w.map(yi),O=x.reduce(Ti,{}),$=w.reduce(Ti,{}),j=I.slice(),G=Object.create(null);let K,re,he,Te,pe;for(let be=0,$e=0;be<I.length;be++)K=I[be],Object.prototype.hasOwnProperty.call($,K)?$e++:(rt(T,{command:"removeLayer",args:[K]}),j.splice(j.indexOf(K,$e),1));for(let be=0,$e=0;be<L.length;be++)K=L[L.length-1-be],j[j.length-1-be]!==K&&(Object.prototype.hasOwnProperty.call(O,K)?(rt(T,{command:"removeLayer",args:[K]}),j.splice(j.lastIndexOf(K,j.length-$e),1)):$e++,Te=j[j.length-be],rt(T,{command:"addLayer",args:[$[K],Te]}),j.splice(j.length-be,0,K),G[K]=!0);for(let be=0;be<L.length;be++)if(K=L[be],re=O[K],he=$[K],!G[K]&&!Be(re,he))if(Be(re.source,he.source)&&Be(re["source-layer"],he["source-layer"])&&Be(re.type,he.type)){for(pe in Yt(re.layout,he.layout,T,K,null,"setLayoutProperty"),Yt(re.paint,he.paint,T,K,null,"setPaintProperty"),Be(re.filter,he.filter)||rt(T,{command:"setFilter",args:[K,he.filter]}),Be(re.minzoom,he.minzoom)&&Be(re.maxzoom,he.maxzoom)||rt(T,{command:"setLayerZoomRange",args:[K,he.minzoom,he.maxzoom]}),re)Object.prototype.hasOwnProperty.call(re,pe)&&pe!=="layout"&&pe!=="paint"&&pe!=="filter"&&pe!=="metadata"&&pe!=="minzoom"&&pe!=="maxzoom"&&(pe.indexOf("paint.")===0?Yt(re[pe],he[pe],T,K,pe.slice(6),"setPaintProperty"):Be(re[pe],he[pe])||rt(T,{command:"setLayerProperty",args:[K,pe,he[pe]]}));for(pe in he)Object.prototype.hasOwnProperty.call(he,pe)&&!Object.prototype.hasOwnProperty.call(re,pe)&&pe!=="layout"&&pe!=="paint"&&pe!=="filter"&&pe!=="metadata"&&pe!=="minzoom"&&pe!=="maxzoom"&&(pe.indexOf("paint.")===0?Yt(re[pe],he[pe],T,K,pe.slice(6),"setPaintProperty"):Be(re[pe],he[pe])||rt(T,{command:"setLayerProperty",args:[K,pe,he[pe]]}))}else rt(T,{command:"removeLayer",args:[K]}),Te=j[j.lastIndexOf(K)+1],rt(T,{command:"addLayer",args:[he,Te]})}(v,t.layers,s)}catch(c){console.warn("Unable to compute style diff:",c),s=[{command:"setStyle",args:[t]}]}return s},m.aC=function(n){const t=[],s=n.id;return s===void 0&&t.push({message:`layers.${s}: missing required property "id"`}),n.render===void 0&&t.push({message:`layers.${s}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&t.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),t},m.aD=function n(t,s){if(Array.isArray(t)){if(!Array.isArray(s)||t.length!==s.length)return!1;for(let c=0;c<t.length;c++)if(!n(t[c],s[c]))return!1;return!0}if(typeof t=="object"&&t!==null&&s!==null){if(typeof s!="object"||Object.keys(t).length!==Object.keys(s).length)return!1;for(const c in t)if(!n(t[c],s[c]))return!1;return!0}return t===s},m.aE=Pt,m.aF=Ht,m.aG=class extends nn{constructor(n,t){super(n,t),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},m.aH=us,m.aI=class extends nn{constructor(n,t){super(n,t),this.current=Kl}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let t=1;t<16;t++)if(n[t]!==this.current[t]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},m.aJ=oa,m.aK=class extends nn{constructor(n,t){super(n,t),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},m.aL=class extends nn{constructor(n,t){super(n,t),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},m.aM=Za,m.aN=function(n,t,s,c,f,v,x){var w=1/(t-s),T=1/(c-f),I=1/(v-x);return n[0]=-2*w,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*T,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*I,n[11]=0,n[12]=(t+s)*w,n[13]=(f+c)*T,n[14]=(x+v)*I,n[15]=1,n},m.aO=Vi,m.aP=s1,m.aQ=class extends Tc{},m.aR=Q1,m.aS=class extends Cc{},m.aT=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},m.aU=xg,m.aV=B,m.aW=class extends ku{},m.aX=Oe,m.aY=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]&&n[9]===t[9]&&n[10]===t[10]&&n[11]===t[11]&&n[12]===t[12]&&n[13]===t[13]&&n[14]===t[14]&&n[15]===t[15]},m.aZ=function(n,t){var s=n[0],c=n[1],f=n[2],v=n[3],x=n[4],w=n[5],T=n[6],I=n[7],L=n[8],O=n[9],$=n[10],j=n[11],G=n[12],K=n[13],re=n[14],he=n[15],Te=t[0],pe=t[1],be=t[2],$e=t[3],Ge=t[4],Ct=t[5],Bt=t[6],St=t[7],xt=t[8],lt=t[9],kt=t[10],_t=t[11],et=t[12],Jt=t[13],Ut=t[14],Ei=t[15];return Math.abs(s-Te)<=Kn*Math.max(1,Math.abs(s),Math.abs(Te))&&Math.abs(c-pe)<=Kn*Math.max(1,Math.abs(c),Math.abs(pe))&&Math.abs(f-be)<=Kn*Math.max(1,Math.abs(f),Math.abs(be))&&Math.abs(v-$e)<=Kn*Math.max(1,Math.abs(v),Math.abs($e))&&Math.abs(x-Ge)<=Kn*Math.max(1,Math.abs(x),Math.abs(Ge))&&Math.abs(w-Ct)<=Kn*Math.max(1,Math.abs(w),Math.abs(Ct))&&Math.abs(T-Bt)<=Kn*Math.max(1,Math.abs(T),Math.abs(Bt))&&Math.abs(I-St)<=Kn*Math.max(1,Math.abs(I),Math.abs(St))&&Math.abs(L-xt)<=Kn*Math.max(1,Math.abs(L),Math.abs(xt))&&Math.abs(O-lt)<=Kn*Math.max(1,Math.abs(O),Math.abs(lt))&&Math.abs($-kt)<=Kn*Math.max(1,Math.abs($),Math.abs(kt))&&Math.abs(j-_t)<=Kn*Math.max(1,Math.abs(j),Math.abs(_t))&&Math.abs(G-et)<=Kn*Math.max(1,Math.abs(G),Math.abs(et))&&Math.abs(K-Jt)<=Kn*Math.max(1,Math.abs(K),Math.abs(Jt))&&Math.abs(re-Ut)<=Kn*Math.max(1,Math.abs(re),Math.abs(Ut))&&Math.abs(he-Ei)<=Kn*Math.max(1,Math.abs(he),Math.abs(Ei))},m.a_=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},m.aa=function(n){const t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,c,f,v)=>{const x=f||v;return t[c]=!x||x.toLowerCase(),""}),t["max-age"]){const s=parseInt(t["max-age"],10);isNaN(s)?delete t["max-age"]:t["max-age"]=s}return t},m.ab=function(n,t){const s=[];for(const c in n)c in t||s.push(c);return s},m.ac=Ze,m.ad=function(n,t,s){var c=Math.sin(s),f=Math.cos(s),v=t[0],x=t[1],w=t[2],T=t[3],I=t[4],L=t[5],O=t[6],$=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=v*f+I*c,n[1]=x*f+L*c,n[2]=w*f+O*c,n[3]=T*f+$*c,n[4]=I*f-v*c,n[5]=L*f-x*c,n[6]=O*f-w*c,n[7]=$*f-T*c,n},m.ae=function(n){var t=new Rc(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},m.af=ud,m.ag=function(n,t){let s=0,c=0;if(n.kind==="constant")c=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:f,minZoom:v,maxZoom:x}=n,w=f?Ze(Jr.interpolationFactor(f,t,v,x),0,1):0;n.kind==="camera"?c=pn.number(n.minSize,n.maxSize,w):s=w}return{uSizeT:s,uSize:c}},m.ai=function(n,{uSize:t,uSizeT:s},{lowerSize:c,upperSize:f}){return n.kind==="source"?c/Ka:n.kind==="composite"?pn.number(c/Ka,f/Ka,s):t},m.aj=cf,m.ak=function(n,t,s,c){const f=t.y-n.y,v=t.x-n.x,x=c.y-s.y,w=c.x-s.x,T=x*v-w*f;if(T===0)return null;const I=(w*(n.y-s.y)-x*(n.x-s.x))/T;return new D(n.x+I*v,n.y+I*f)},m.al=by,m.am=Ru,m.an=Up,m.ao=sn,m.aq=lf,m.ar=function(n,t){var s=t[0],c=t[1],f=t[2],v=t[3],x=t[4],w=t[5],T=t[6],I=t[7],L=t[8],O=t[9],$=t[10],j=t[11],G=t[12],K=t[13],re=t[14],he=t[15],Te=s*w-c*x,pe=s*T-f*x,be=s*I-v*x,$e=c*T-f*w,Ge=c*I-v*w,Ct=f*I-v*T,Bt=L*K-O*G,St=L*re-$*G,xt=L*he-j*G,lt=O*re-$*K,kt=O*he-j*K,_t=$*he-j*re,et=Te*_t-pe*kt+be*lt+$e*xt-Ge*St+Ct*Bt;return et?(n[0]=(w*_t-T*kt+I*lt)*(et=1/et),n[1]=(f*kt-c*_t-v*lt)*et,n[2]=(K*Ct-re*Ge+he*$e)*et,n[3]=($*Ge-O*Ct-j*$e)*et,n[4]=(T*xt-x*_t-I*St)*et,n[5]=(s*_t-f*xt+v*St)*et,n[6]=(re*be-G*Ct-he*pe)*et,n[7]=(L*Ct-$*be+j*pe)*et,n[8]=(x*kt-w*xt+I*Bt)*et,n[9]=(c*xt-s*kt-v*Bt)*et,n[10]=(G*Ge-K*be+he*Te)*et,n[11]=(O*be-L*Ge-j*Te)*et,n[12]=(w*St-x*lt-T*Bt)*et,n[13]=(s*lt-c*St+f*Bt)*et,n[14]=(K*pe-G*$e-re*Te)*et,n[15]=(L*$e-O*pe+$*Te)*et,n):null},m.as=yf,m.at=of,m.au=_f,m.av=function(){const n={},t=ce.$version;for(const s in ce.$root){const c=ce.$root[s];if(c.required){let f=null;f=s==="version"?t:c.type==="array"?[]:{},f!=null&&(n[s]=f)}}return n},m.aw=Ul,m.ax=ut,m.ay=function(n){n=n.slice();const t=Object.create(null);for(let s=0;s<n.length;s++)t[n[s].id]=n[s];for(let s=0;s<n.length;s++)"ref"in n[s]&&(n[s]=At(n[s],t[n[s].ref]));return n},m.az=function(n){if(n.type==="custom")return new Sb(n);switch(n.type){case"background":return new bb(n);case"circle":return new a1(n);case"fill":return new T1(n);case"fill-extrusion":return new U1(n);case"heatmap":return new l1(n);case"hillshade":return new u1(n);case"line":return new X1(n);case"raster":return new Mb(n);case"symbol":return new xd(n)}},m.b=hi,m.b0=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]},m.b1=Ke,m.b2=fy,m.b3=dy,m.b4=function(n,t,s,c,f){var v,x=1/Math.tan(t/2);return n[0]=x/s,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=x,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,f!=null&&f!==1/0?(n[10]=(f+c)*(v=1/(c-f)),n[14]=2*f*c*v):(n[10]=-1,n[14]=-2*c),n},m.b5=function(n,t,s){var c=Math.sin(s),f=Math.cos(s),v=t[4],x=t[5],w=t[6],T=t[7],I=t[8],L=t[9],O=t[10],$=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=v*f+I*c,n[5]=x*f+L*c,n[6]=w*f+O*c,n[7]=T*f+$*c,n[8]=I*f-v*c,n[9]=L*f-x*c,n[10]=O*f-w*c,n[11]=$*f-T*c,n},m.b6=oe,m.b7=Le,m.b8=function(n){return n*Math.PI/180},m.b9=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},m.bA=Ha,m.ba=class extends Ca{},m.bb=pf,m.bc=zb,m.be=Et,m.bf=function(n,t){Zi.REGISTERED_PROTOCOLS[n]=t},m.bg=function(n){delete Zi.REGISTERED_PROTOCOLS[n]},m.bh=function(n,t){const s={};for(let f=0;f<n.length;f++){const v=t&&t[n[f].id]||Bl(n[f]);t&&(t[n[f].id]=v);let x=s[v];x||(x=s[v]=[]),x.push(n[f])}const c=[];for(const f in s)c.push(s[f]);return c},m.bi=Tt,m.bj=gy,m.bk=_y,m.bl=Kg,m.bm=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=$r/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const t=n.bucket.layers[0],s=t.layout,c=t._unevaluatedLayout._values,f={layoutIconSize:c["icon-size"].possiblyEvaluate(new xr(n.bucket.zoom+1),n.canonical),layoutTextSize:c["text-size"].possiblyEvaluate(new xr(n.bucket.zoom+1),n.canonical),textMaxSize:c["text-size"].possiblyEvaluate(new xr(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:I,maxZoom:L}=n.bucket.textSizeData;f.compositeTextSizes=[c["text-size"].possiblyEvaluate(new xr(I),n.canonical),c["text-size"].possiblyEvaluate(new xr(L),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:I,maxZoom:L}=n.bucket.iconSizeData;f.compositeIconSizes=[c["icon-size"].possiblyEvaluate(new xr(I),n.canonical),c["icon-size"].possiblyEvaluate(new xr(L),n.canonical)]}const v=s.get("text-line-height")*sn,x=s.get("text-rotation-alignment")!=="viewport"&&s.get("symbol-placement")!=="point",w=s.get("text-keep-upright"),T=s.get("text-size");for(const I of n.bucket.features){const L=s.get("text-font").evaluate(I,{},n.canonical).join(","),O=T.evaluate(I,{},n.canonical),$=f.layoutTextSize.evaluate(I,{},n.canonical),j=f.layoutIconSize.evaluate(I,{},n.canonical),G={horizontal:{},vertical:void 0},K=I.text;let re,he=[0,0];if(K){const be=K.toString(),$e=s.get("text-letter-spacing").evaluate(I,{},n.canonical)*sn,Ge=yo(be)?$e:0,Ct=s.get("text-anchor").evaluate(I,{},n.canonical),Bt=Py(t,I,n.canonical);if(!Bt){const _t=s.get("text-radial-offset").evaluate(I,{},n.canonical);he=_t?Ay(Ct,[_t*sn,gf]):s.get("text-offset").evaluate(I,{},n.canonical).map(et=>et*sn)}let St=x?"center":s.get("text-justify").evaluate(I,{},n.canonical);const xt=s.get("symbol-placement"),lt=xt==="point"?s.get("text-max-width").evaluate(I,{},n.canonical)*sn:0,kt=()=>{n.bucket.allowVerticalPlacement&&aa(be)&&(G.vertical=yd(K,n.glyphMap,n.glyphPositions,n.imagePositions,L,lt,v,Ct,"left",Ge,he,m.ah.vertical,!0,xt,$,O))};if(!x&&Bt){const _t=new Set;if(St==="auto")for(let Jt=0;Jt<Bt.values.length;Jt+=2)_t.add(yf(Bt.values[Jt]));else _t.add(St);let et=!1;for(const Jt of _t)if(!G.horizontal[Jt])if(et)G.horizontal[Jt]=G.horizontal[0];else{const Ut=yd(K,n.glyphMap,n.glyphPositions,n.imagePositions,L,lt,v,"center",Jt,Ge,he,m.ah.horizontal,!1,xt,$,O);Ut&&(G.horizontal[Jt]=Ut,et=Ut.positionedLines.length===1)}kt()}else{St==="auto"&&(St=yf(Ct));const _t=yd(K,n.glyphMap,n.glyphPositions,n.imagePositions,L,lt,v,Ct,St,Ge,he,m.ah.horizontal,!1,xt,$,O);_t&&(G.horizontal[St]=_t),kt(),aa(be)&&x&&w&&(G.vertical=yd(K,n.glyphMap,n.glyphPositions,n.imagePositions,L,lt,v,Ct,St,Ge,he,m.ah.vertical,!1,xt,$,O))}}let Te=!1;if(I.icon&&I.icon.name){const be=n.imageMap[I.icon.name];be&&(re=gb(n.imagePositions[I.icon.name],s.get("icon-offset").evaluate(I,{},n.canonical),s.get("icon-anchor").evaluate(I,{},n.canonical)),Te=!!be.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=Te:n.bucket.sdfIcons!==Te&&ct("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(be.pixelRatio!==n.bucket.pixelRatio||s.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const pe=ky(G.horizontal)||G.vertical;n.bucket.iconsInText=!!pe&&pe.iconsInText,(pe||re)&&Lb(n.bucket,I,G,re,n.imageMap,f,$,j,he,Te,n.canonical)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},m.bn=ef,m.bo=Yp,m.bp=Qp,m.bq=nl,m.br=rf,m.bs=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},m.bt=function(n,t,s,c,f){return l(this,void 0,void 0,function*(){if(Pe())try{return yield yr(n,t,s,c,f)}catch{}return function(v,x,w,T,I){const L=v.width,O=v.height;at&&tt||(at=new OffscreenCanvas(L,O),tt=at.getContext("2d",{willReadFrequently:!0})),at.width=L,at.height=O,tt.drawImage(v,0,0,L,O);const $=tt.getImageData(x,w,T,I);return tt.clearRect(0,0,L,O),$.data}(n,t,s,c,f)})},m.bu=my,m.bv=M,m.bw=P,m.bx=Ug,m.by=bs,m.bz=function(n){return n.message===Je},m.c=nr,m.d=n=>l(void 0,void 0,void 0,function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(t)}catch(s){throw new Error(`Could not load image because of ${s.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),m.e=dt,m.f=n=>new Promise((t,s)=>{const c=new Image;c.onload=()=>{t(c),URL.revokeObjectURL(c.src),c.onload=null,window.requestAnimationFrame(()=>{c.src=Mi})},c.onerror=()=>s(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const f=new Blob([new Uint8Array(n)],{type:"image/png"});c.src=n.byteLength?URL.createObjectURL(f):Mi}),m.g=Si,m.h=(n,t)=>Qe(dt(n,{type:"json"}),t),m.i=ti,m.j=De,m.k=ue,m.l=(n,t)=>Qe(dt(n,{type:"arrayBuffer"}),t),m.m=Qe,m.n=function(n){return new rf(n).readFields(ub,[])},m.o=$u,m.p=Xg,m.q=Xn,m.r=il,m.s=Di,m.t=en,m.u=vt,m.v=ce,m.w=ct,m.x=Ri,m.y=function([n,t,s]){return t+=90,t*=Math.PI/180,s*=Math.PI/180,{x:n*Math.cos(t)*Math.sin(s),y:n*Math.sin(t)*Math.sin(s),z:n*Math.cos(s)}},m.z=pn}),d("worker",["./shared"],function(m){class l{constructor(N){this.keyCache={},N&&this.replace(N)}replace(N){this._layerConfigs={},this._layers={},this.update(N,[])}update(N,U){for(const Q of N){this._layerConfigs[Q.id]=Q;const _e=this._layers[Q.id]=m.az(Q);_e._featureFilter=m.a6(_e.filter),this.keyCache[Q.id]&&delete this.keyCache[Q.id]}for(const Q of U)delete this.keyCache[Q],delete this._layerConfigs[Q],delete this._layers[Q];this.familiesBySource={};const H=m.bh(Object.values(this._layerConfigs),this.keyCache);for(const Q of H){const _e=Q.map(ze=>this._layers[ze.id]),ve=_e[0];if(ve.visibility==="none")continue;const Me=ve.source||"";let de=this.familiesBySource[Me];de||(de=this.familiesBySource[Me]={});const Ce=ve.sourceLayer||"_geojsonTileLayer";let qe=de[Ce];qe||(qe=de[Ce]=[]),qe.push(_e)}}}class M{constructor(N){const U={},H=[];for(const Me in N){const de=N[Me],Ce=U[Me]={};for(const qe in de){const ze=de[+qe];if(!ze||ze.bitmap.width===0||ze.bitmap.height===0)continue;const Ne={x:0,y:0,w:ze.bitmap.width+2,h:ze.bitmap.height+2};H.push(Ne),Ce[qe]={rect:Ne,metrics:ze.metrics}}}const{w:Q,h:_e}=m.p(H),ve=new m.o({width:Q||1,height:_e||1});for(const Me in N){const de=N[Me];for(const Ce in de){const qe=de[+Ce];if(!qe||qe.bitmap.width===0||qe.bitmap.height===0)continue;const ze=U[Me][Ce].rect;m.o.copy(qe.bitmap,ve,{x:0,y:0},{x:ze.x+1,y:ze.y+1},qe.bitmap)}}this.image=ve,this.positions=U}}m.bi("GlyphAtlas",M);class P{constructor(N){this.tileID=new m.Q(N.tileID.overscaledZ,N.tileID.wrap,N.tileID.canonical.z,N.tileID.canonical.x,N.tileID.canonical.y),this.uid=N.uid,this.zoom=N.zoom,this.pixelRatio=N.pixelRatio,this.tileSize=N.tileSize,this.source=N.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=N.showCollisionBoxes,this.collectResourceTiming=!!N.collectResourceTiming,this.returnDependencies=!!N.returnDependencies,this.promoteId=N.promoteId,this.inFlightDependencies=[]}parse(N,U,H,Q){return m._(this,void 0,void 0,function*(){this.status="parsing",this.data=N,this.collisionBoxArray=new m.a4;const _e=new m.bj(Object.keys(N.layers).sort()),ve=new m.bk(this.tileID,this.promoteId);ve.bucketLayerIDs=[];const Me={},de={featureIndex:ve,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:H},Ce=U.familiesBySource[this.source];for(const Kt in Ce){const _r=N.layers[Kt];if(!_r)continue;_r.version===1&&m.w(`Vector tile source "${this.source}" layer "${Kt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Vr=_e.encode(Kt),_n=[];for(let vn=0;vn<_r.length;vn++){const Zr=_r.feature(vn),qn=ve.getId(Zr,Kt);_n.push({feature:Zr,id:qn,index:vn,sourceLayerIndex:Vr})}for(const vn of Ce[Kt]){const Zr=vn[0];Zr.source!==this.source&&m.w(`layer.source = ${Zr.source} does not equal this.source = ${this.source}`),Zr.minzoom&&this.zoom<Math.floor(Zr.minzoom)||Zr.maxzoom&&this.zoom>=Zr.maxzoom||Zr.visibility!=="none"&&(R(vn,this.zoom,H),(Me[Zr.id]=Zr.createBucket({index:ve.bucketLayerIDs.length,layers:vn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Vr,sourceID:this.source})).populate(_n,de,this.tileID.canonical),ve.bucketLayerIDs.push(vn.map(qn=>qn.id)))}}const qe=m.aE(de.glyphDependencies,Kt=>Object.keys(Kt).map(Number));this.inFlightDependencies.forEach(Kt=>Kt==null?void 0:Kt.abort()),this.inFlightDependencies=[];let ze=Promise.resolve({});if(Object.keys(qe).length){const Kt=new AbortController;this.inFlightDependencies.push(Kt),ze=Q.sendAsync({type:"GG",data:{stacks:qe,source:this.source,tileID:this.tileID,type:"glyphs"}},Kt)}const Ne=Object.keys(de.iconDependencies);let $t=Promise.resolve({});if(Ne.length){const Kt=new AbortController;this.inFlightDependencies.push(Kt),$t=Q.sendAsync({type:"GI",data:{icons:Ne,source:this.source,tileID:this.tileID,type:"icons"}},Kt)}const Gt=Object.keys(de.patternDependencies);let ni=Promise.resolve({});if(Gt.length){const Kt=new AbortController;this.inFlightDependencies.push(Kt),ni=Q.sendAsync({type:"GI",data:{icons:Gt,source:this.source,tileID:this.tileID,type:"patterns"}},Kt)}const[si,vi,Ui]=yield Promise.all([ze,$t,ni]),lr=new M(si),Br=new m.bl(vi,Ui);for(const Kt in Me){const _r=Me[Kt];_r instanceof m.a5?(R(_r.layers,this.zoom,H),m.bm({bucket:_r,glyphMap:si,glyphPositions:lr.positions,imageMap:vi,imagePositions:Br.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):_r.hasPattern&&(_r instanceof m.bn||_r instanceof m.bo||_r instanceof m.bp)&&(R(_r.layers,this.zoom,H),_r.addFeatures(de,this.tileID.canonical,Br.patternPositions))}return this.status="done",{buckets:Object.values(Me).filter(Kt=>!Kt.isEmpty()),featureIndex:ve,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:lr.image,imageAtlas:Br,glyphMap:this.returnDependencies?si:null,iconMap:this.returnDependencies?vi:null,glyphPositions:this.returnDependencies?lr.positions:null}})}}function R(te,N,U){const H=new m.a8(N);for(const Q of te)Q.recalculate(H,U)}class D{constructor(N,U,H){this.actor=N,this.layerIndex=U,this.availableImages=H,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(N,U){return m._(this,void 0,void 0,function*(){const H=yield m.l(N.request,U);try{return{vectorTile:new m.bq.VectorTile(new m.br(H.data)),rawData:H.data,cacheControl:H.cacheControl,expires:H.expires}}catch(Q){const _e=new Uint8Array(H.data);let ve=`Unable to parse the tile at ${N.request.url}, `;throw ve+=_e[0]===31&&_e[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Q.messge}`,new Error(ve)}})}loadTile(N){return m._(this,void 0,void 0,function*(){const U=N.uid,H=!!(N&&N.request&&N.request.collectResourceTiming)&&new m.bs(N.request),Q=new P(N);this.loading[U]=Q;const _e=new AbortController;Q.abort=_e;try{const ve=yield this.loadVectorTile(N,_e);if(delete this.loading[U],!ve)return null;const Me=ve.rawData,de={};ve.expires&&(de.expires=ve.expires),ve.cacheControl&&(de.cacheControl=ve.cacheControl);const Ce={};if(H){const ze=H.finish();ze&&(Ce.resourceTiming=JSON.parse(JSON.stringify(ze)))}Q.vectorTile=ve.vectorTile;const qe=Q.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[U]=Q,this.fetching[U]={rawTileData:Me,cacheControl:de,resourceTiming:Ce};try{const ze=yield qe;return m.e({rawTileData:Me.slice(0)},ze,de,Ce)}finally{delete this.fetching[U]}}catch(ve){throw delete this.loading[U],Q.status="done",this.loaded[U]=Q,ve}})}reloadTile(N){return m._(this,void 0,void 0,function*(){const U=N.uid;if(!this.loaded||!this.loaded[U])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const H=this.loaded[U];if(H.showCollisionBoxes=N.showCollisionBoxes,H.status==="parsing"){const Q=yield H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor);let _e;if(this.fetching[U]){const{rawTileData:ve,cacheControl:Me,resourceTiming:de}=this.fetching[U];delete this.fetching[U],_e=m.e({rawTileData:ve.slice(0)},Q,Me,de)}else _e=Q;return _e}if(H.status==="done"&&H.vectorTile)return H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(N){return m._(this,void 0,void 0,function*(){const U=this.loading,H=N.uid;U&&U[H]&&U[H].abort&&(U[H].abort.abort(),delete U[H])})}removeTile(N){return m._(this,void 0,void 0,function*(){this.loaded&&this.loaded[N.uid]&&delete this.loaded[N.uid]})}}class z{constructor(){this.loaded={}}loadTile(N){return m._(this,void 0,void 0,function*(){const{uid:U,encoding:H,rawImageData:Q,redFactor:_e,greenFactor:ve,blueFactor:Me,baseShift:de}=N,Ce=Q.width+2,qe=Q.height+2,ze=m.b(Q)?new m.R({width:Ce,height:qe},yield m.bt(Q,-1,-1,Ce,qe)):Q,Ne=new m.bu(U,ze,H,_e,ve,Me,de);return this.loaded=this.loaded||{},this.loaded[U]=Ne,Ne})}removeTile(N){const U=this.loaded,H=N.uid;U&&U[H]&&delete U[H]}}function Z(te,N){if(te.length!==0){W(te[0],N);for(var U=1;U<te.length;U++)W(te[U],!N)}}function W(te,N){for(var U=0,H=0,Q=0,_e=te.length,ve=_e-1;Q<_e;ve=Q++){var Me=(te[Q][0]-te[ve][0])*(te[ve][1]+te[Q][1]),de=U+Me;H+=Math.abs(U)>=Math.abs(Me)?U-de+Me:Me-de+U,U=de}U+H>=0!=!!N&&te.reverse()}var J=m.bv(function te(N,U){var H,Q=N&&N.type;if(Q==="FeatureCollection")for(H=0;H<N.features.length;H++)te(N.features[H],U);else if(Q==="GeometryCollection")for(H=0;H<N.geometries.length;H++)te(N.geometries[H],U);else if(Q==="Feature")te(N.geometry,U);else if(Q==="Polygon")Z(N.coordinates,U);else if(Q==="MultiPolygon")for(H=0;H<N.coordinates.length;H++)Z(N.coordinates[H],U);return N});const me=m.bq.VectorTileFeature.prototype.toGeoJSON;var xe={exports:{}},Pe=m.bw,oe=m.bq.VectorTileFeature,Le=Ze;function Ze(te,N){this.options=N||{},this.features=te,this.length=te.length}function Ke(te,N){this.id=typeof te.id=="number"?te.id:void 0,this.type=te.type,this.rawGeometry=te.type===1?[te.geometry]:te.geometry,this.properties=te.tags,this.extent=N||4096}Ze.prototype.feature=function(te){return new Ke(this.features[te],this.options.extent)},Ke.prototype.loadGeometry=function(){var te=this.rawGeometry;this.geometry=[];for(var N=0;N<te.length;N++){for(var U=te[N],H=[],Q=0;Q<U.length;Q++)H.push(new Pe(U[Q][0],U[Q][1]));this.geometry.push(H)}return this.geometry},Ke.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var te=this.geometry,N=1/0,U=-1/0,H=1/0,Q=-1/0,_e=0;_e<te.length;_e++)for(var ve=te[_e],Me=0;Me<ve.length;Me++){var de=ve[Me];N=Math.min(N,de.x),U=Math.max(U,de.x),H=Math.min(H,de.y),Q=Math.max(Q,de.y)}return[N,H,U,Q]},Ke.prototype.toGeoJSON=oe.prototype.toGeoJSON;var dt=m.bx,bt=Le;function Pt(te){var N=new dt;return function(U,H){for(var Q in U.layers)H.writeMessage(3,Ht,U.layers[Q])}(te,N),N.finish()}function Ht(te,N){var U;N.writeVarintField(15,te.version||1),N.writeStringField(1,te.name||""),N.writeVarintField(5,te.extent||4096);var H={keys:[],values:[],keycache:{},valuecache:{}};for(U=0;U<te.length;U++)H.feature=te.feature(U),N.writeMessage(2,Rt,H);var Q=H.keys;for(U=0;U<Q.length;U++)N.writeStringField(3,Q[U]);var _e=H.values;for(U=0;U<_e.length;U++)N.writeMessage(4,ti,_e[U])}function Rt(te,N){var U=te.feature;U.id!==void 0&&N.writeVarintField(1,U.id),N.writeMessage(2,li,te),N.writeVarintField(3,U.type),N.writeMessage(4,Bi,U)}function li(te,N){var U=te.feature,H=te.keys,Q=te.values,_e=te.keycache,ve=te.valuecache;for(var Me in U.properties){var de=U.properties[Me],Ce=_e[Me];if(de!==null){Ce===void 0&&(H.push(Me),_e[Me]=Ce=H.length-1),N.writeVarint(Ce);var qe=typeof de;qe!=="string"&&qe!=="boolean"&&qe!=="number"&&(de=JSON.stringify(de));var ze=qe+":"+de,Ne=ve[ze];Ne===void 0&&(Q.push(de),ve[ze]=Ne=Q.length-1),N.writeVarint(Ne)}}}function ct(te,N){return(N<<3)+(7&te)}function zt(te){return te<<1^te>>31}function Bi(te,N){for(var U=te.loadGeometry(),H=te.type,Q=0,_e=0,ve=U.length,Me=0;Me<ve;Me++){var de=U[Me],Ce=1;H===1&&(Ce=de.length),N.writeVarint(ct(1,Ce));for(var qe=H===3?de.length-1:de.length,ze=0;ze<qe;ze++){ze===1&&H!==1&&N.writeVarint(ct(2,qe-1));var Ne=de[ze].x-Q,$t=de[ze].y-_e;N.writeVarint(zt(Ne)),N.writeVarint(zt($t)),Q+=Ne,_e+=$t}H===3&&N.writeVarint(ct(7,1))}}function ti(te,N){var U=typeof te;U==="string"?N.writeStringField(1,te):U==="boolean"?N.writeBooleanField(7,te):U==="number"&&(te%1!=0?N.writeDoubleField(3,te):te<0?N.writeSVarintField(6,te):N.writeVarintField(5,te))}xe.exports=Pt,xe.exports.fromVectorTileJs=Pt,xe.exports.fromGeojsonVt=function(te,N){N=N||{};var U={};for(var H in te)U[H]=new bt(te[H].features,N),U[H].name=H,U[H].version=N.version,U[H].extent=N.extent;return Pt({layers:U})},xe.exports.GeoJSONWrapper=bt;var ii=m.bv(xe.exports);const hi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:te=>te},Mi=Math.fround||(yr=new Float32Array(1),te=>(yr[0]=+te,yr[0]));var yr;const at=3,tt=5,Je=6;class nr{constructor(N){this.options=Object.assign(Object.create(hi),N),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(N){const{log:U,minZoom:H,maxZoom:Q}=this.options;U&&console.time("total time");const _e=`prepare ${N.length} points`;U&&console.time(_e),this.points=N;const ve=[];for(let de=0;de<N.length;de++){const Ce=N[de];if(!Ce.geometry)continue;const[qe,ze]=Ce.geometry.coordinates,Ne=Mi(Ve(qe)),$t=Mi(Et(ze));ve.push(Ne,$t,1/0,de,-1,1),this.options.reduce&&ve.push(0)}let Me=this.trees[Q+1]=this._createTree(ve);U&&console.timeEnd(_e);for(let de=Q;de>=H;de--){const Ce=+Date.now();Me=this.trees[de]=this._createTree(this._cluster(Me,de)),U&&console.log("z%d: %d clusters in %dms",de,Me.numItems,+Date.now()-Ce)}return U&&console.timeEnd("total time"),this}getClusters(N,U){let H=((N[0]+180)%360+360)%360-180;const Q=Math.max(-90,Math.min(90,N[1]));let _e=N[2]===180?180:((N[2]+180)%360+360)%360-180;const ve=Math.max(-90,Math.min(90,N[3]));if(N[2]-N[0]>=360)H=-180,_e=180;else if(H>_e){const ze=this.getClusters([H,Q,180,ve],U),Ne=this.getClusters([-180,Q,_e,ve],U);return ze.concat(Ne)}const Me=this.trees[this._limitZoom(U)],de=Me.range(Ve(H),Et(ve),Ve(_e),Et(Q)),Ce=Me.data,qe=[];for(const ze of de){const Ne=this.stride*ze;qe.push(Ce[Ne+tt]>1?Zi(Ce,Ne,this.clusterProps):this.points[Ce[Ne+at]])}return qe}getChildren(N){const U=this._getOriginId(N),H=this._getOriginZoom(N),Q="No cluster with the specified id.",_e=this.trees[H];if(!_e)throw new Error(Q);const ve=_e.data;if(U*this.stride>=ve.length)throw new Error(Q);const Me=this.options.radius/(this.options.extent*Math.pow(2,H-1)),de=_e.within(ve[U*this.stride],ve[U*this.stride+1],Me),Ce=[];for(const qe of de){const ze=qe*this.stride;ve[ze+4]===N&&Ce.push(ve[ze+tt]>1?Zi(ve,ze,this.clusterProps):this.points[ve[ze+at]])}if(Ce.length===0)throw new Error(Q);return Ce}getLeaves(N,U,H){const Q=[];return this._appendLeaves(Q,N,U=U||10,H=H||0,0),Q}getTile(N,U,H){const Q=this.trees[this._limitZoom(N)],_e=Math.pow(2,N),{extent:ve,radius:Me}=this.options,de=Me/ve,Ce=(H-de)/_e,qe=(H+1+de)/_e,ze={features:[]};return this._addTileFeatures(Q.range((U-de)/_e,Ce,(U+1+de)/_e,qe),Q.data,U,H,_e,ze),U===0&&this._addTileFeatures(Q.range(1-de/_e,Ce,1,qe),Q.data,_e,H,_e,ze),U===_e-1&&this._addTileFeatures(Q.range(0,Ce,de/_e,qe),Q.data,-1,H,_e,ze),ze.features.length?ze:null}getClusterExpansionZoom(N){let U=this._getOriginZoom(N)-1;for(;U<=this.options.maxZoom;){const H=this.getChildren(N);if(U++,H.length!==1)break;N=H[0].properties.cluster_id}return U}_appendLeaves(N,U,H,Q,_e){const ve=this.getChildren(U);for(const Me of ve){const de=Me.properties;if(de&&de.cluster?_e+de.point_count<=Q?_e+=de.point_count:_e=this._appendLeaves(N,de.cluster_id,H,Q,_e):_e<Q?_e++:N.push(Me),N.length===H)break}return _e}_createTree(N){const U=new m.au(N.length/this.stride|0,this.options.nodeSize,Float32Array);for(let H=0;H<N.length;H+=this.stride)U.add(N[H],N[H+1]);return U.finish(),U.data=N,U}_addTileFeatures(N,U,H,Q,_e,ve){for(const Me of N){const de=Me*this.stride,Ce=U[de+tt]>1;let qe,ze,Ne;if(Ce)qe=Si(U,de,this.clusterProps),ze=U[de],Ne=U[de+1];else{const ni=this.points[U[de+at]];qe=ni.properties;const[si,vi]=ni.geometry.coordinates;ze=Ve(si),Ne=Et(vi)}const $t={type:1,geometry:[[Math.round(this.options.extent*(ze*_e-H)),Math.round(this.options.extent*(Ne*_e-Q))]],tags:qe};let Gt;Gt=Ce||this.options.generateId?U[de+at]:this.points[U[de+at]].id,Gt!==void 0&&($t.id=Gt),ve.features.push($t)}}_limitZoom(N){return Math.max(this.options.minZoom,Math.min(Math.floor(+N),this.options.maxZoom+1))}_cluster(N,U){const{radius:H,extent:Q,reduce:_e,minPoints:ve}=this.options,Me=H/(Q*Math.pow(2,U)),de=N.data,Ce=[],qe=this.stride;for(let ze=0;ze<de.length;ze+=qe){if(de[ze+2]<=U)continue;de[ze+2]=U;const Ne=de[ze],$t=de[ze+1],Gt=N.within(de[ze],de[ze+1],Me),ni=de[ze+tt];let si=ni;for(const vi of Gt){const Ui=vi*qe;de[Ui+2]>U&&(si+=de[Ui+tt])}if(si>ni&&si>=ve){let vi,Ui=Ne*ni,lr=$t*ni,Br=-1;const Kt=((ze/qe|0)<<5)+(U+1)+this.points.length;for(const _r of Gt){const Vr=_r*qe;if(de[Vr+2]<=U)continue;de[Vr+2]=U;const _n=de[Vr+tt];Ui+=de[Vr]*_n,lr+=de[Vr+1]*_n,de[Vr+4]=Kt,_e&&(vi||(vi=this._map(de,ze,!0),Br=this.clusterProps.length,this.clusterProps.push(vi)),_e(vi,this._map(de,Vr)))}de[ze+4]=Kt,Ce.push(Ui/si,lr/si,1/0,Kt,-1,si),_e&&Ce.push(Br)}else{for(let vi=0;vi<qe;vi++)Ce.push(de[ze+vi]);if(si>1)for(const vi of Gt){const Ui=vi*qe;if(!(de[Ui+2]<=U)){de[Ui+2]=U;for(let lr=0;lr<qe;lr++)Ce.push(de[Ui+lr])}}}}return Ce}_getOriginId(N){return N-this.points.length>>5}_getOriginZoom(N){return(N-this.points.length)%32}_map(N,U,H){if(N[U+tt]>1){const ve=this.clusterProps[N[U+Je]];return H?Object.assign({},ve):ve}const Q=this.points[N[U+at]].properties,_e=this.options.map(Q);return H&&_e===Q?Object.assign({},_e):_e}}function Zi(te,N,U){return{type:"Feature",id:te[N+at],properties:Si(te,N,U),geometry:{type:"Point",coordinates:[(H=te[N],360*(H-.5)),ut(te[N+1])]}};var H}function Si(te,N,U){const H=te[N+tt],Q=H>=1e4?`${Math.round(H/1e3)}k`:H>=1e3?Math.round(H/100)/10+"k":H,_e=te[N+Je],ve=_e===-1?{}:Object.assign({},U[_e]);return Object.assign(ve,{cluster:!0,cluster_id:te[N+at],point_count:H,point_count_abbreviated:Q})}function Ve(te){return te/360+.5}function Et(te){const N=Math.sin(te*Math.PI/180),U=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return U<0?0:U>1?1:U}function ut(te){const N=(180-360*te)*Math.PI/180;return 360*Math.atan(Math.exp(N))/Math.PI-90}function Qe(te,N,U,H){for(var Q,_e=H,ve=U-N>>1,Me=U-N,de=te[N],Ce=te[N+1],qe=te[U],ze=te[U+1],Ne=N+3;Ne<U;Ne+=3){var $t=Di(te[Ne],te[Ne+1],de,Ce,qe,ze);if($t>_e)Q=Ne,_e=$t;else if($t===_e){var Gt=Math.abs(Ne-ve);Gt<Me&&(Q=Ne,Me=Gt)}}_e>H&&(Q-N>3&&Qe(te,N,Q,H),te[Q+2]=_e,U-Q>3&&Qe(te,Q,U,H))}function Di(te,N,U,H,Q,_e){var ve=Q-U,Me=_e-H;if(ve!==0||Me!==0){var de=((te-U)*ve+(N-H)*Me)/(ve*ve+Me*Me);de>1?(U=Q,H=_e):de>0&&(U+=ve*de,H+=Me*de)}return(ve=te-U)*ve+(Me=N-H)*Me}function zi(te,N,U,H){var Q={id:te===void 0?null:te,type:N,geometry:U,tags:H,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(_e){var ve=_e.geometry,Me=_e.type;if(Me==="Point"||Me==="MultiPoint"||Me==="LineString")se(_e,ve);else if(Me==="Polygon"||Me==="MultiLineString")for(var de=0;de<ve.length;de++)se(_e,ve[de]);else if(Me==="MultiPolygon")for(de=0;de<ve.length;de++)for(var Ce=0;Ce<ve[de].length;Ce++)se(_e,ve[de][Ce])}(Q),Q}function se(te,N){for(var U=0;U<N.length;U+=3)te.minX=Math.min(te.minX,N[U]),te.minY=Math.min(te.minY,N[U+1]),te.maxX=Math.max(te.maxX,N[U]),te.maxY=Math.max(te.maxY,N[U+1])}function ue(te,N,U,H){if(N.geometry){var Q=N.geometry.coordinates,_e=N.geometry.type,ve=Math.pow(U.tolerance/((1<<U.maxZoom)*U.extent),2),Me=[],de=N.id;if(U.promoteId?de=N.properties[U.promoteId]:U.generateId&&(de=H||0),_e==="Point")De(Q,Me);else if(_e==="MultiPoint")for(var Ce=0;Ce<Q.length;Ce++)De(Q[Ce],Me);else if(_e==="LineString")Fe(Q,Me,ve,!1);else if(_e==="MultiLineString"){if(U.lineMetrics){for(Ce=0;Ce<Q.length;Ce++)Fe(Q[Ce],Me=[],ve,!1),te.push(zi(de,"LineString",Me,N.properties));return}ce(Q,Me,ve,!1)}else if(_e==="Polygon")ce(Q,Me,ve,!0);else{if(_e!=="MultiPolygon"){if(_e==="GeometryCollection"){for(Ce=0;Ce<N.geometry.geometries.length;Ce++)ue(te,{id:de,geometry:N.geometry.geometries[Ce],properties:N.properties},U,H);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ce=0;Ce<Q.length;Ce++){var qe=[];ce(Q[Ce],qe,ve,!0),Me.push(qe)}}te.push(zi(de,_e,Me,N.properties))}}function De(te,N){N.push(pt(te[0])),N.push(At(te[1])),N.push(0)}function Fe(te,N,U,H){for(var Q,_e,ve=0,Me=0;Me<te.length;Me++){var de=pt(te[Me][0]),Ce=At(te[Me][1]);N.push(de),N.push(Ce),N.push(0),Me>0&&(ve+=H?(Q*Ce-de*_e)/2:Math.sqrt(Math.pow(de-Q,2)+Math.pow(Ce-_e,2))),Q=de,_e=Ce}var qe=N.length-3;N[2]=1,Qe(N,0,qe,U),N[qe+2]=1,N.size=Math.abs(ve),N.start=0,N.end=N.size}function ce(te,N,U,H){for(var Q=0;Q<te.length;Q++){var _e=[];Fe(te[Q],_e,U,H),N.push(_e)}}function pt(te){return te/360+.5}function At(te){var N=Math.sin(te*Math.PI/180),U=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return U<0?0:U>1?1:U}function Be(te,N,U,H,Q,_e,ve,Me){if(H/=N,_e>=(U/=N)&&ve<H)return te;if(ve<U||_e>=H)return null;for(var de=[],Ce=0;Ce<te.length;Ce++){var qe=te[Ce],ze=qe.geometry,Ne=qe.type,$t=Q===0?qe.minX:qe.minY,Gt=Q===0?qe.maxX:qe.maxY;if($t>=U&&Gt<H)de.push(qe);else if(!(Gt<U||$t>=H)){var ni=[];if(Ne==="Point"||Ne==="MultiPoint")rt(ze,ni,U,H,Q);else if(Ne==="LineString")it(ze,ni,U,H,Q,!1,Me.lineMetrics);else if(Ne==="MultiLineString")Xt(ze,ni,U,H,Q,!1);else if(Ne==="Polygon")Xt(ze,ni,U,H,Q,!0);else if(Ne==="MultiPolygon")for(var si=0;si<ze.length;si++){var vi=[];Xt(ze[si],vi,U,H,Q,!0),vi.length&&ni.push(vi)}if(ni.length){if(Me.lineMetrics&&Ne==="LineString"){for(si=0;si<ni.length;si++)de.push(zi(qe.id,Ne,ni[si],qe.tags));continue}Ne!=="LineString"&&Ne!=="MultiLineString"||(ni.length===1?(Ne="LineString",ni=ni[0]):Ne="MultiLineString"),Ne!=="Point"&&Ne!=="MultiPoint"||(Ne=ni.length===3?"Point":"MultiPoint"),de.push(zi(qe.id,Ne,ni,qe.tags))}}}return de.length?de:null}function rt(te,N,U,H,Q){for(var _e=0;_e<te.length;_e+=3){var ve=te[_e+Q];ve>=U&&ve<=H&&(N.push(te[_e]),N.push(te[_e+1]),N.push(te[_e+2]))}}function it(te,N,U,H,Q,_e,ve){for(var Me,de,Ce=Dt(te),qe=Q===0?Yt:yi,ze=te.start,Ne=0;Ne<te.length-3;Ne+=3){var $t=te[Ne],Gt=te[Ne+1],ni=te[Ne+2],si=te[Ne+3],vi=te[Ne+4],Ui=Q===0?$t:Gt,lr=Q===0?si:vi,Br=!1;ve&&(Me=Math.sqrt(Math.pow($t-si,2)+Math.pow(Gt-vi,2))),Ui<U?lr>U&&(de=qe(Ce,$t,Gt,si,vi,U),ve&&(Ce.start=ze+Me*de)):Ui>H?lr<H&&(de=qe(Ce,$t,Gt,si,vi,H),ve&&(Ce.start=ze+Me*de)):Zt(Ce,$t,Gt,ni),lr<U&&Ui>=U&&(de=qe(Ce,$t,Gt,si,vi,U),Br=!0),lr>H&&Ui<=H&&(de=qe(Ce,$t,Gt,si,vi,H),Br=!0),!_e&&Br&&(ve&&(Ce.end=ze+Me*de),N.push(Ce),Ce=Dt(te)),ve&&(ze+=Me)}var Kt=te.length-3;$t=te[Kt],Gt=te[Kt+1],ni=te[Kt+2],(Ui=Q===0?$t:Gt)>=U&&Ui<=H&&Zt(Ce,$t,Gt,ni),Kt=Ce.length-3,_e&&Kt>=3&&(Ce[Kt]!==Ce[0]||Ce[Kt+1]!==Ce[1])&&Zt(Ce,Ce[0],Ce[1],Ce[2]),Ce.length&&N.push(Ce)}function Dt(te){var N=[];return N.size=te.size,N.start=te.start,N.end=te.end,N}function Xt(te,N,U,H,Q,_e){for(var ve=0;ve<te.length;ve++)it(te[ve],N,U,H,Q,_e,!1)}function Zt(te,N,U,H){te.push(N),te.push(U),te.push(H)}function Yt(te,N,U,H,Q,_e){var ve=(_e-N)/(H-N);return te.push(_e),te.push(U+(Q-U)*ve),te.push(1),ve}function yi(te,N,U,H,Q,_e){var ve=(_e-U)/(Q-U);return te.push(N+(H-N)*ve),te.push(_e),te.push(1),ve}function Ti(te,N){for(var U=[],H=0;H<te.length;H++){var Q,_e=te[H],ve=_e.type;if(ve==="Point"||ve==="MultiPoint"||ve==="LineString")Q=Ue(_e.geometry,N);else if(ve==="MultiLineString"||ve==="Polygon"){Q=[];for(var Me=0;Me<_e.geometry.length;Me++)Q.push(Ue(_e.geometry[Me],N))}else if(ve==="MultiPolygon")for(Q=[],Me=0;Me<_e.geometry.length;Me++){for(var de=[],Ce=0;Ce<_e.geometry[Me].length;Ce++)de.push(Ue(_e.geometry[Me][Ce],N));Q.push(de)}U.push(zi(_e.id,ve,Q,_e.tags))}return U}function Ue(te,N){var U=[];U.size=te.size,te.start!==void 0&&(U.start=te.start,U.end=te.end);for(var H=0;H<te.length;H+=3)U.push(te[H]+N,te[H+1],te[H+2]);return U}function Ni(te,N){if(te.transformed)return te;var U,H,Q,_e=1<<te.z,ve=te.x,Me=te.y;for(U=0;U<te.features.length;U++){var de=te.features[U],Ce=de.geometry,qe=de.type;if(de.geometry=[],qe===1)for(H=0;H<Ce.length;H+=2)de.geometry.push(Yi(Ce[H],Ce[H+1],N,_e,ve,Me));else for(H=0;H<Ce.length;H++){var ze=[];for(Q=0;Q<Ce[H].length;Q+=2)ze.push(Yi(Ce[H][Q],Ce[H][Q+1],N,_e,ve,Me));de.geometry.push(ze)}}return te.transformed=!0,te}function Yi(te,N,U,H,Q,_e){return[Math.round(U*(te*H-Q)),Math.round(U*(N*H-_e))]}function gn(te,N,U,H,Q){for(var _e=N===Q.maxZoom?0:Q.tolerance/((1<<N)*Q.extent),ve={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:U,y:H,z:N,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Me=0;Me<te.length;Me++){ve.numFeatures++,Sr(ve,te[Me],_e,Q);var de=te[Me].minX,Ce=te[Me].minY,qe=te[Me].maxX,ze=te[Me].maxY;de<ve.minX&&(ve.minX=de),Ce<ve.minY&&(ve.minY=Ce),qe>ve.maxX&&(ve.maxX=qe),ze>ve.maxY&&(ve.maxY=ze)}return ve}function Sr(te,N,U,H){var Q=N.geometry,_e=N.type,ve=[];if(_e==="Point"||_e==="MultiPoint")for(var Me=0;Me<Q.length;Me+=3)ve.push(Q[Me]),ve.push(Q[Me+1]),te.numPoints++,te.numSimplified++;else if(_e==="LineString")nt(ve,Q,te,U,!1,!1);else if(_e==="MultiLineString"||_e==="Polygon")for(Me=0;Me<Q.length;Me++)nt(ve,Q[Me],te,U,_e==="Polygon",Me===0);else if(_e==="MultiPolygon")for(var de=0;de<Q.length;de++){var Ce=Q[de];for(Me=0;Me<Ce.length;Me++)nt(ve,Ce[Me],te,U,!0,Me===0)}if(ve.length){var qe=N.tags||null;if(_e==="LineString"&&H.lineMetrics){for(var ze in qe={},N.tags)qe[ze]=N.tags[ze];qe.mapbox_clip_start=Q.start/Q.size,qe.mapbox_clip_end=Q.end/Q.size}var Ne={geometry:ve,type:_e==="Polygon"||_e==="MultiPolygon"?3:_e==="LineString"||_e==="MultiLineString"?2:1,tags:qe};N.id!==null&&(Ne.id=N.id),te.features.push(Ne)}}function nt(te,N,U,H,Q,_e){var ve=H*H;if(H>0&&N.size<(Q?ve:H))U.numPoints+=N.length/3;else{for(var Me=[],de=0;de<N.length;de+=3)(H===0||N[de+2]>ve)&&(U.numSimplified++,Me.push(N[de]),Me.push(N[de+1])),U.numPoints++;Q&&function(Ce,qe){for(var ze=0,Ne=0,$t=Ce.length,Gt=$t-2;Ne<$t;Gt=Ne,Ne+=2)ze+=(Ce[Ne]-Ce[Gt])*(Ce[Ne+1]+Ce[Gt+1]);if(ze>0===qe)for(Ne=0,$t=Ce.length;Ne<$t/2;Ne+=2){var ni=Ce[Ne],si=Ce[Ne+1];Ce[Ne]=Ce[$t-2-Ne],Ce[Ne+1]=Ce[$t-1-Ne],Ce[$t-2-Ne]=ni,Ce[$t-1-Ne]=si}}(Me,_e),te.push(Me)}}function ci(te,N){var U=(N=this.options=function(Q,_e){for(var ve in _e)Q[ve]=_e[ve];return Q}(Object.create(this.options),N)).debug;if(U&&console.time("preprocess data"),N.maxZoom<0||N.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(N.promoteId&&N.generateId)throw new Error("promoteId and generateId cannot be used together.");var H=function(Q,_e){var ve=[];if(Q.type==="FeatureCollection")for(var Me=0;Me<Q.features.length;Me++)ue(ve,Q.features[Me],_e,Me);else ue(ve,Q.type==="Feature"?Q:{geometry:Q},_e);return ve}(te,N);this.tiles={},this.tileCoords=[],U&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",N.indexMaxZoom,N.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),H=function(Q,_e){var ve=_e.buffer/_e.extent,Me=Q,de=Be(Q,1,-1-ve,ve,0,-1,2,_e),Ce=Be(Q,1,1-ve,2+ve,0,-1,2,_e);return(de||Ce)&&(Me=Be(Q,1,-ve,1+ve,0,-1,2,_e)||[],de&&(Me=Ti(de,1).concat(Me)),Ce&&(Me=Me.concat(Ti(Ce,-1)))),Me}(H,N),H.length&&this.splitTile(H,0,0,0),U&&(H.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Nt(te,N,U){return 32*((1<<te)*U+N)+te}function ji(te,N){return N?te.properties[N]:te.id}function yn(te,N){if(te==null)return!0;if(te.type==="Feature")return ji(te,N)!=null;if(te.type==="FeatureCollection"){const U=new Set;for(const H of te.features){const Q=ji(H,N);if(Q==null||U.has(Q))return!1;U.add(Q)}return!0}return!1}function ri(te,N){const U=new Map;if(te!=null)if(te.type==="Feature")U.set(ji(te,N),te);else for(const H of te.features)U.set(ji(H,N),H);return U}ci.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ci.prototype.splitTile=function(te,N,U,H,Q,_e,ve){for(var Me=[te,N,U,H],de=this.options,Ce=de.debug;Me.length;){H=Me.pop(),U=Me.pop(),N=Me.pop(),te=Me.pop();var qe=1<<N,ze=Nt(N,U,H),Ne=this.tiles[ze];if(!Ne&&(Ce>1&&console.time("creation"),Ne=this.tiles[ze]=gn(te,N,U,H,de),this.tileCoords.push({z:N,x:U,y:H}),Ce)){Ce>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",N,U,H,Ne.numFeatures,Ne.numPoints,Ne.numSimplified),console.timeEnd("creation"));var $t="z"+N;this.stats[$t]=(this.stats[$t]||0)+1,this.total++}if(Ne.source=te,Q){if(N===de.maxZoom||N===Q)continue;var Gt=1<<Q-N;if(U!==Math.floor(_e/Gt)||H!==Math.floor(ve/Gt))continue}else if(N===de.indexMaxZoom||Ne.numPoints<=de.indexMaxPoints)continue;if(Ne.source=null,te.length!==0){Ce>1&&console.time("clipping");var ni,si,vi,Ui,lr,Br,Kt=.5*de.buffer/de.extent,_r=.5-Kt,Vr=.5+Kt,_n=1+Kt;ni=si=vi=Ui=null,lr=Be(te,qe,U-Kt,U+Vr,0,Ne.minX,Ne.maxX,de),Br=Be(te,qe,U+_r,U+_n,0,Ne.minX,Ne.maxX,de),te=null,lr&&(ni=Be(lr,qe,H-Kt,H+Vr,1,Ne.minY,Ne.maxY,de),si=Be(lr,qe,H+_r,H+_n,1,Ne.minY,Ne.maxY,de),lr=null),Br&&(vi=Be(Br,qe,H-Kt,H+Vr,1,Ne.minY,Ne.maxY,de),Ui=Be(Br,qe,H+_r,H+_n,1,Ne.minY,Ne.maxY,de),Br=null),Ce>1&&console.timeEnd("clipping"),Me.push(ni||[],N+1,2*U,2*H),Me.push(si||[],N+1,2*U,2*H+1),Me.push(vi||[],N+1,2*U+1,2*H),Me.push(Ui||[],N+1,2*U+1,2*H+1)}}},ci.prototype.getTile=function(te,N,U){var H=this.options,Q=H.extent,_e=H.debug;if(te<0||te>24)return null;var ve=1<<te,Me=Nt(te,N=(N%ve+ve)%ve,U);if(this.tiles[Me])return Ni(this.tiles[Me],Q);_e>1&&console.log("drilling down to z%d-%d-%d",te,N,U);for(var de,Ce=te,qe=N,ze=U;!de&&Ce>0;)Ce--,qe=Math.floor(qe/2),ze=Math.floor(ze/2),de=this.tiles[Nt(Ce,qe,ze)];return de&&de.source?(_e>1&&console.log("found parent tile z%d-%d-%d",Ce,qe,ze),_e>1&&console.time("drilling down"),this.splitTile(de.source,Ce,qe,ze,te,N,U),_e>1&&console.timeEnd("drilling down"),this.tiles[Me]?Ni(this.tiles[Me],Q):null):null};class ea extends D{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(N,U){return m._(this,void 0,void 0,function*(){const H=N.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Q=this._geoJSONIndex.getTile(H.z,H.x,H.y);if(!Q)return null;const _e=new class{constructor(Me){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.W,this.length=Me.length,this._features=Me}feature(Me){return new class{constructor(de){this._feature=de,this.extent=m.W,this.type=de.type,this.properties=de.tags,"id"in de&&!isNaN(de.id)&&(this.id=parseInt(de.id,10))}loadGeometry(){if(this._feature.type===1){const de=[];for(const Ce of this._feature.geometry)de.push([new m.P(Ce[0],Ce[1])]);return de}{const de=[];for(const Ce of this._feature.geometry){const qe=[];for(const ze of Ce)qe.push(new m.P(ze[0],ze[1]));de.push(qe)}return de}}toGeoJSON(de,Ce,qe){return me.call(this,de,Ce,qe)}}(this._features[Me])}}(Q.features);let ve=ii(_e);return ve.byteOffset===0&&ve.byteLength===ve.buffer.byteLength||(ve=new Uint8Array(ve)),{vectorTile:_e,rawData:ve.buffer}})}loadData(N){return m._(this,void 0,void 0,function*(){var U;(U=this._pendingRequest)===null||U===void 0||U.abort();const H=!!(N&&N.request&&N.request.collectResourceTiming)&&new m.bs(N.request);this._pendingRequest=new AbortController;try{let Q=yield this.loadGeoJSON(N,this._pendingRequest);if(delete this._pendingRequest,typeof Q!="object")throw new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`);if(J(Q,!0),N.filter){const ve=m.by(N.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ve.result==="error")throw new Error(ve.value.map(de=>`${de.key}: ${de.message}`).join(", "));Q={type:"FeatureCollection",features:Q.features.filter(de=>ve.value.evaluate({zoom:0},de))}}this._geoJSONIndex=N.cluster?new nr(function({superclusterOptions:ve,clusterProperties:Me}){if(!Me||!ve)return ve;const de={},Ce={},qe={accumulated:null,zoom:0},ze={properties:null},Ne=Object.keys(Me);for(const $t of Ne){const[Gt,ni]=Me[$t],si=m.by(ni),vi=m.by(typeof Gt=="string"?[Gt,["accumulated"],["get",$t]]:Gt);de[$t]=si.value,Ce[$t]=vi.value}return ve.map=$t=>{ze.properties=$t;const Gt={};for(const ni of Ne)Gt[ni]=de[ni].evaluate(qe,ze);return Gt},ve.reduce=($t,Gt)=>{ze.properties=Gt;for(const ni of Ne)qe.accumulated=$t[ni],$t[ni]=Ce[ni].evaluate(qe,ze)},ve}(N)).load(Q.features):function(ve,Me){return new ci(ve,Me)}(Q,N.geojsonVtOptions),this.loaded={};const _e={};if(H){const ve=H.finish();ve&&(_e.resourceTiming={},_e.resourceTiming[N.source]=JSON.parse(JSON.stringify(ve)))}return _e}catch(Q){if(delete this._pendingRequest,m.bz(Q))return{abandoned:!0};throw Q}})}reloadTile(N){const U=this.loaded;return U&&U[N.uid]?super.reloadTile(N):this.loadTile(N)}loadGeoJSON(N,U){return m._(this,void 0,void 0,function*(){const{promoteId:H}=N;if(N.request){const Q=yield m.h(N.request,U);return this._dataUpdateable=yn(Q.data,H)?ri(Q.data,H):void 0,Q.data}if(typeof N.data=="string")try{const Q=JSON.parse(N.data);return this._dataUpdateable=yn(Q,H)?ri(Q,H):void 0,Q}catch{throw new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`)}if(!N.dataDiff)throw new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${N.source}`);return function(Q,_e,ve){var Me,de,Ce,qe;if(_e.removeAll&&Q.clear(),_e.remove)for(const ze of _e.remove)Q.delete(ze);if(_e.add)for(const ze of _e.add){const Ne=ji(ze,ve);Ne!=null&&Q.set(Ne,ze)}if(_e.update)for(const ze of _e.update){let Ne=Q.get(ze.id);if(Ne==null)continue;const $t=!ze.removeAllProperties&&(((Me=ze.removeProperties)===null||Me===void 0?void 0:Me.length)>0||((de=ze.addOrUpdateProperties)===null||de===void 0?void 0:de.length)>0);if((ze.newGeometry||ze.removeAllProperties||$t)&&(Ne=Object.assign({},Ne),Q.set(ze.id,Ne),$t&&(Ne.properties=Object.assign({},Ne.properties))),ze.newGeometry&&(Ne.geometry=ze.newGeometry),ze.removeAllProperties)Ne.properties={};else if(((Ce=ze.removeProperties)===null||Ce===void 0?void 0:Ce.length)>0)for(const Gt of ze.removeProperties)Object.prototype.hasOwnProperty.call(Ne.properties,Gt)&&delete Ne.properties[Gt];if(((qe=ze.addOrUpdateProperties)===null||qe===void 0?void 0:qe.length)>0)for(const{key:Gt,value:ni}of ze.addOrUpdateProperties)Ne.properties[Gt]=ni}}(this._dataUpdateable,N.dataDiff,H),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(N){return m._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(N){return this._geoJSONIndex.getClusterExpansionZoom(N.clusterId)}getClusterChildren(N){return this._geoJSONIndex.getChildren(N.clusterId)}getClusterLeaves(N){return this._geoJSONIndex.getLeaves(N.clusterId,N.limit,N.offset)}}class Er{constructor(N){this.self=N,this.actor=new m.C(N),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(U,H)=>{if(this.externalWorkerSourceTypes[U])throw new Error(`Worker source with name "${U}" already registered.`);this.externalWorkerSourceTypes[U]=H},this.self.addProtocol=m.bf,this.self.removeProtocol=m.bg,this.self.registerRTLTextPlugin=U=>{if(m.bA.isParsed())throw new Error("RTL text plugin already registered.");m.bA.setMethods(U)},this.actor.registerMessageHandler("LDT",(U,H)=>this._getDEMWorkerSource(U,H.source).loadTile(H)),this.actor.registerMessageHandler("RDT",(U,H)=>m._(this,void 0,void 0,function*(){this._getDEMWorkerSource(U,H.source).removeTile(H)})),this.actor.registerMessageHandler("GCEZ",(U,H)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(U,H.type,H.source).getClusterExpansionZoom(H)})),this.actor.registerMessageHandler("GCC",(U,H)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(U,H.type,H.source).getClusterChildren(H)})),this.actor.registerMessageHandler("GCL",(U,H)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(U,H.type,H.source).getClusterLeaves(H)})),this.actor.registerMessageHandler("LD",(U,H)=>this._getWorkerSource(U,H.type,H.source).loadData(H)),this.actor.registerMessageHandler("LT",(U,H)=>this._getWorkerSource(U,H.type,H.source).loadTile(H)),this.actor.registerMessageHandler("RT",(U,H)=>this._getWorkerSource(U,H.type,H.source).reloadTile(H)),this.actor.registerMessageHandler("AT",(U,H)=>this._getWorkerSource(U,H.type,H.source).abortTile(H)),this.actor.registerMessageHandler("RMT",(U,H)=>this._getWorkerSource(U,H.type,H.source).removeTile(H)),this.actor.registerMessageHandler("RS",(U,H)=>m._(this,void 0,void 0,function*(){if(!this.workerSources[U]||!this.workerSources[U][H.type]||!this.workerSources[U][H.type][H.source])return;const Q=this.workerSources[U][H.type][H.source];delete this.workerSources[U][H.type][H.source],Q.removeSource!==void 0&&Q.removeSource(H)})),this.actor.registerMessageHandler("RM",U=>m._(this,void 0,void 0,function*(){delete this.layerIndexes[U],delete this.availableImages[U],delete this.workerSources[U],delete this.demWorkerSources[U]})),this.actor.registerMessageHandler("SR",(U,H)=>m._(this,void 0,void 0,function*(){this.referrer=H})),this.actor.registerMessageHandler("SRPS",(U,H)=>this._syncRTLPluginState(U,H)),this.actor.registerMessageHandler("IS",(U,H)=>m._(this,void 0,void 0,function*(){this.self.importScripts(H)})),this.actor.registerMessageHandler("SI",(U,H)=>this._setImages(U,H)),this.actor.registerMessageHandler("UL",(U,H)=>m._(this,void 0,void 0,function*(){this._getLayerIndex(U).update(H.layers,H.removedIds)})),this.actor.registerMessageHandler("SL",(U,H)=>m._(this,void 0,void 0,function*(){this._getLayerIndex(U).replace(H)}))}_setImages(N,U){return m._(this,void 0,void 0,function*(){this.availableImages[N]=U;for(const H in this.workerSources[N]){const Q=this.workerSources[N][H];for(const _e in Q)Q[_e].availableImages=U}})}_syncRTLPluginState(N,U){return m._(this,void 0,void 0,function*(){if(m.bA.isParsed())return m.bA.getState();if(U.pluginStatus!=="loading")return m.bA.setState(U),U;const H=U.pluginURL;if(this.self.importScripts(H),m.bA.isParsed()){const Q={pluginStatus:"loaded",pluginURL:H};return m.bA.setState(Q),Q}throw m.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${H}`)})}_getAvailableImages(N){let U=this.availableImages[N];return U||(U=[]),U}_getLayerIndex(N){let U=this.layerIndexes[N];return U||(U=this.layerIndexes[N]=new l),U}_getWorkerSource(N,U,H){if(this.workerSources[N]||(this.workerSources[N]={}),this.workerSources[N][U]||(this.workerSources[N][U]={}),!this.workerSources[N][U][H]){const Q={sendAsync:(_e,ve)=>(_e.targetMapId=N,this.actor.sendAsync(_e,ve))};switch(U){case"vector":this.workerSources[N][U][H]=new D(Q,this._getLayerIndex(N),this._getAvailableImages(N));break;case"geojson":this.workerSources[N][U][H]=new ea(Q,this._getLayerIndex(N),this._getAvailableImages(N));break;default:this.workerSources[N][U][H]=new this.externalWorkerSourceTypes[U](Q,this._getLayerIndex(N),this._getAvailableImages(N))}}return this.workerSources[N][U][H]}_getDEMWorkerSource(N,U){return this.demWorkerSources[N]||(this.demWorkerSources[N]={}),this.demWorkerSources[N][U]||(this.demWorkerSources[N][U]=new z),this.demWorkerSources[N][U]}}return m.i(self)&&(self.worker=new Er(self)),Er}),d("index",["exports","./shared"],function(m,l){var M="4.1.3";let P,R;const D={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:y=>new Promise((i,o)=>{const h=requestAnimationFrame(i);y.signal.addEventListener("abort",()=>{cancelAnimationFrame(h),o(l.c())})}),getImageData(y,i=0){return this.getImageCanvasContext(y).getImageData(-i,-i,y.width+2*i,y.height+2*i)},getImageCanvasContext(y){const i=window.document.createElement("canvas"),o=i.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return i.width=y.width,i.height=y.height,o.drawImage(y,0,0,y.width,y.height),o},resolveURL:y=>(P||(P=document.createElement("a")),P.href=y,P.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(R==null&&(R=matchMedia("(prefers-reduced-motion: reduce)")),R.matches)}};class z{static testProp(i){if(!z.docStyle)return i[0];for(let o=0;o<i.length;o++)if(i[o]in z.docStyle)return i[o];return i[0]}static create(i,o,h){const p=window.document.createElement(i);return o!==void 0&&(p.className=o),h&&h.appendChild(p),p}static createNS(i,o){return window.document.createElementNS(i,o)}static disableDrag(){z.docStyle&&z.selectProp&&(z.userSelect=z.docStyle[z.selectProp],z.docStyle[z.selectProp]="none")}static enableDrag(){z.docStyle&&z.selectProp&&(z.docStyle[z.selectProp]=z.userSelect)}static setTransform(i,o){i.style[z.transformProp]=o}static addEventListener(i,o,h,p={}){i.addEventListener(o,h,"passive"in p?p:p.capture)}static removeEventListener(i,o,h,p={}){i.removeEventListener(o,h,"passive"in p?p:p.capture)}static suppressClickInternal(i){i.preventDefault(),i.stopPropagation(),window.removeEventListener("click",z.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",z.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",z.suppressClickInternal,!0)},0)}static getScale(i){const o=i.getBoundingClientRect();return{x:o.width/i.offsetWidth||1,y:o.height/i.offsetHeight||1,boundingClientRect:o}}static getPoint(i,o,h){const p=o.boundingClientRect;return new l.P((h.clientX-p.left)/o.x-i.clientLeft,(h.clientY-p.top)/o.y-i.clientTop)}static mousePos(i,o){const h=z.getScale(i);return z.getPoint(i,h,o)}static touchPos(i,o){const h=[],p=z.getScale(i);for(let _=0;_<o.length;_++)h.push(z.getPoint(i,p,o[_]));return h}static mouseButton(i){return i.button}static remove(i){i.parentNode&&i.parentNode.removeChild(i)}}z.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,z.selectProp=z.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),z.transformProp=z.testProp(["transform","WebkitTransform"]);const Z={supported:!1,testSupport:function(y){!me&&J&&(xe?Pe(y):W=y)}};let W,J,me=!1,xe=!1;function Pe(y){const i=y.createTexture();y.bindTexture(y.TEXTURE_2D,i);try{if(y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,J),y.isContextLost())return;Z.supported=!0}catch{}y.deleteTexture(i),me=!0}var oe;typeof document<"u"&&(J=document.createElement("img"),J.onload=function(){W&&Pe(W),W=null,xe=!0},J.onerror=function(){me=!0,W=null},J.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(y){let i,o,h,p;y.resetRequestQueue=()=>{i=[],o=0,h=0,p={}},y.addThrottleControl=C=>{const k=h++;return p[k]=C,k},y.removeThrottleControl=C=>{delete p[C],S()},y.getImage=(C,k,F=!0)=>new Promise((B,q)=>{Z.supported&&(C.headers||(C.headers={}),C.headers.accept="image/webp,*/*"),l.e(C,{type:"image"}),i.push({abortController:k,requestParameters:C,supportImageRefresh:F,state:"queued",onError:ie=>{q(ie)},onSuccess:ie=>{B(ie)}}),S()});const _=C=>l._(this,void 0,void 0,function*(){C.state="running";const{requestParameters:k,supportImageRefresh:F,onError:B,onSuccess:q,abortController:ie}=C,ee=F===!1&&!l.i(self)&&!l.g(k.url)&&(!k.headers||Object.keys(k.headers).reduce((fe,Ie)=>fe&&Ie==="accept",!0));o++;const ne=ee?E(k,ie):l.m(k,ie);try{const fe=yield ne;delete C.abortController,C.state="completed",fe.data instanceof HTMLImageElement||l.b(fe.data)?q(fe):fe.data&&q({data:yield(X=fe.data,typeof createImageBitmap=="function"?l.d(X):l.f(X)),cacheControl:fe.cacheControl,expires:fe.expires})}catch(fe){delete C.abortController,B(fe)}finally{o--,S()}var X}),S=()=>{const C=(()=>{for(const k of Object.keys(p))if(p[k]())return!0;return!1})()?l.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let k=o;k<C&&i.length>0;k++){const F=i.shift();F.abortController.signal.aborted?k--:_(F)}},E=(C,k)=>new Promise((F,B)=>{const q=new Image,ie=C.url,ee=C.credentials;ee&&ee==="include"?q.crossOrigin="use-credentials":(ee&&ee==="same-origin"||!l.s(ie))&&(q.crossOrigin="anonymous"),k.signal.addEventListener("abort",()=>{q.src="",B(l.c())}),q.fetchPriority="high",q.onload=()=>{q.onerror=q.onload=null,F({data:q})},q.onerror=()=>{q.onerror=q.onload=null,k.signal.aborted||B(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},q.src=ie})}(oe||(oe={})),oe.resetRequestQueue();class Le{constructor(i){this._transformRequestFn=i}transformRequest(i,o){return this._transformRequestFn&&this._transformRequestFn(i,o)||{url:i}}normalizeSpriteURL(i,o,h){const p=function(_){const S=_.match(Ze);if(!S)throw new Error(`Unable to parse URL "${_}"`);return{protocol:S[1],authority:S[2],path:S[3]||"/",params:S[4]?S[4].split("&"):[]}}(i);return p.path+=`${o}${h}`,function(_){const S=_.params.length?`?${_.params.join("&")}`:"";return`${_.protocol}://${_.authority}${_.path}${S}`}(p)}setTransformRequest(i){this._transformRequestFn=i}}const Ze=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ke(y){var i=new l.A(3);return i[0]=y[0],i[1]=y[1],i[2]=y[2],i}var dt,bt=function(y,i,o){return y[0]=i[0]-o[0],y[1]=i[1]-o[1],y[2]=i[2]-o[2],y};dt=new l.A(3),l.A!=Float32Array&&(dt[0]=0,dt[1]=0,dt[2]=0);var Pt=function(y){var i=y[0],o=y[1];return i*i+o*o};function Ht(y){const i=[];if(typeof y=="string")i.push({id:"default",url:y});else if(y&&y.length>0){const o=[];for(const{id:h,url:p}of y){const _=`${h}${p}`;o.indexOf(_)===-1&&(o.push(_),i.push({id:h,url:p}))}}return i}(function(){var y=new l.A(2);l.A!=Float32Array&&(y[0]=0,y[1]=0)})();class Rt{constructor(i,o,h,p){this.context=i,this.format=h,this.texture=i.gl.createTexture(),this.update(o,p)}update(i,o,h){const{width:p,height:_}=i,S=!(this.size&&this.size[0]===p&&this.size[1]===_||h),{context:E}=this,{gl:C}=E;if(this.useMipmap=!!(o&&o.useMipmap),C.bindTexture(C.TEXTURE_2D,this.texture),E.pixelStoreUnpackFlipY.set(!1),E.pixelStoreUnpack.set(1),E.pixelStoreUnpackPremultiplyAlpha.set(this.format===C.RGBA&&(!o||o.premultiply!==!1)),S)this.size=[p,_],i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||l.b(i)?C.texImage2D(C.TEXTURE_2D,0,this.format,this.format,C.UNSIGNED_BYTE,i):C.texImage2D(C.TEXTURE_2D,0,this.format,p,_,0,this.format,C.UNSIGNED_BYTE,i.data);else{const{x:k,y:F}=h||{x:0,y:0};i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||l.b(i)?C.texSubImage2D(C.TEXTURE_2D,0,k,F,C.RGBA,C.UNSIGNED_BYTE,i):C.texSubImage2D(C.TEXTURE_2D,0,k,F,p,_,C.RGBA,C.UNSIGNED_BYTE,i.data)}this.useMipmap&&this.isSizePowerOfTwo()&&C.generateMipmap(C.TEXTURE_2D)}bind(i,o,h){const{context:p}=this,{gl:_}=p;_.bindTexture(_.TEXTURE_2D,this.texture),h!==_.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(h=_.LINEAR),i!==this.filter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,i),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,h||i),this.filter=i),o!==this.wrap&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,o),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}function li(y){const{userImage:i}=y;return!!(i&&i.render&&i.render())&&(y.data.replace(new Uint8Array(i.data.buffer)),!0)}class ct extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:o,promiseResolve:h}of this.requestors)h(this._getImagesForIds(o));this.requestors=[]}}getImage(i){const o=this.images[i];if(o&&!o.data&&o.spriteData){const h=o.spriteData;o.data=new l.R({width:h.width,height:h.height},h.context.getImageData(h.x,h.y,h.width,h.height).data),o.spriteData=null}return o}addImage(i,o){if(this.images[i])throw new Error(`Image id ${i} already exist, use updateImage instead`);this._validate(i,o)&&(this.images[i]=o)}_validate(i,o){let h=!0;const p=o.data||o.spriteData;return this._validateStretch(o.stretchX,p&&p.width)||(this.fire(new l.j(new Error(`Image "${i}" has invalid "stretchX" value`))),h=!1),this._validateStretch(o.stretchY,p&&p.height)||(this.fire(new l.j(new Error(`Image "${i}" has invalid "stretchY" value`))),h=!1),this._validateContent(o.content,o)||(this.fire(new l.j(new Error(`Image "${i}" has invalid "content" value`))),h=!1),h}_validateStretch(i,o){if(!i)return!0;let h=0;for(const p of i){if(p[0]<h||p[1]<p[0]||o<p[1])return!1;h=p[1]}return!0}_validateContent(i,o){if(!i)return!0;if(i.length!==4)return!1;const h=o.spriteData,p=h&&h.width||o.data.width,_=h&&h.height||o.data.height;return!(i[0]<0||p<i[0]||i[1]<0||_<i[1]||i[2]<0||p<i[2]||i[3]<0||_<i[3]||i[2]<i[0]||i[3]<i[1])}updateImage(i,o,h=!0){const p=this.getImage(i);if(h&&(p.data.width!==o.data.width||p.data.height!==o.data.height))throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${o.data.width}x${o.data.height}).`);o.version=p.version+1,this.images[i]=o,this.updatedImages[i]=!0}removeImage(i){const o=this.images[i];delete this.images[i],delete this.patterns[i],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i){return new Promise((o,h)=>{let p=!0;if(!this.isLoaded())for(const _ of i)this.images[_]||(p=!1);this.isLoaded()||p?o(this._getImagesForIds(i)):this.requestors.push({ids:i,promiseResolve:o})})}_getImagesForIds(i){const o={};for(const h of i){let p=this.getImage(h);p||(this.fire(new l.k("styleimagemissing",{id:h})),p=this.getImage(h)),p?o[h]={data:p.data.clone(),pixelRatio:p.pixelRatio,sdf:p.sdf,version:p.version,stretchX:p.stretchX,stretchY:p.stretchY,content:p.content,hasRenderCallback:!!(p.userImage&&p.userImage.render)}:l.w(`Image "${h}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return o}getPixelSize(){const{width:i,height:o}=this.atlasImage;return{width:i,height:o}}getPattern(i){const o=this.patterns[i],h=this.getImage(i);if(!h)return null;if(o&&o.position.version===h.version)return o.position;if(o)o.position.version=h.version;else{const p={w:h.data.width+2,h:h.data.height+2,x:0,y:0},_=new l.I(p,h);this.patterns[i]={bin:p,position:_}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const o=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Rt(i,this.atlasImage,o.RGBA),this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const _ in this.patterns)i.push(this.patterns[_].bin);const{w:o,h}=l.p(i),p=this.atlasImage;p.resize({width:o||1,height:h||1});for(const _ in this.patterns){const{bin:S}=this.patterns[_],E=S.x+1,C=S.y+1,k=this.getImage(_).data,F=k.width,B=k.height;l.R.copy(k,p,{x:0,y:0},{x:E,y:C},{width:F,height:B}),l.R.copy(k,p,{x:0,y:B-1},{x:E,y:C-1},{width:F,height:1}),l.R.copy(k,p,{x:0,y:0},{x:E,y:C+B},{width:F,height:1}),l.R.copy(k,p,{x:F-1,y:0},{x:E-1,y:C},{width:1,height:B}),l.R.copy(k,p,{x:0,y:0},{x:E+F,y:C},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const o of i){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;const h=this.getImage(o);h||l.w(`Image with ID: "${o}" was not found`),li(h)&&this.updateImage(o,h)}}}const zt=1e20;function Bi(y,i,o,h,p,_,S,E,C){for(let k=i;k<i+h;k++)ti(y,o*_+k,_,p,S,E,C);for(let k=o;k<o+p;k++)ti(y,k*_+i,1,h,S,E,C)}function ti(y,i,o,h,p,_,S){_[0]=0,S[0]=-zt,S[1]=zt,p[0]=y[i];for(let E=1,C=0,k=0;E<h;E++){p[E]=y[i+E*o];const F=E*E;do{const B=_[C];k=(p[E]-p[B]+F-B*B)/(E-B)/2}while(k<=S[C]&&--C>-1);C++,_[C]=E,S[C]=k,S[C+1]=zt}for(let E=0,C=0;E<h;E++){for(;S[C+1]<E;)C++;const k=_[C],F=E-k;y[i+E*o]=p[k]+F*F}}class ii{constructor(i,o){this.requestManager=i,this.localIdeographFontFamily=o,this.entries={}}setURL(i){this.url=i}getGlyphs(i){return l._(this,void 0,void 0,function*(){const o=[];for(const _ in i)for(const S of i[_])o.push(this._getAndCacheGlyphsPromise(_,S));const h=yield Promise.all(o),p={};for(const{stack:_,id:S,glyph:E}of h)p[_]||(p[_]={}),p[_][S]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics};return p})}_getAndCacheGlyphsPromise(i,o){return l._(this,void 0,void 0,function*(){let h=this.entries[i];h||(h=this.entries[i]={glyphs:{},requests:{},ranges:{}});let p=h.glyphs[o];if(p!==void 0)return{stack:i,id:o,glyph:p};if(p=this._tinySDF(h,i,o),p)return h.glyphs[o]=p,{stack:i,id:o,glyph:p};const _=Math.floor(o/256);if(256*_>65535)throw new Error("glyphs > 65535 not supported");if(h.ranges[_])return{stack:i,id:o,glyph:p};if(!this.url)throw new Error("glyphsUrl is not set");if(!h.requests[_]){const E=ii.loadGlyphRange(i,_,this.url,this.requestManager);h.requests[_]=E}const S=yield h.requests[_];for(const E in S)this._doesCharSupportLocalGlyph(+E)||(h.glyphs[+E]=S[+E]);return h.ranges[_]=!0,{stack:i,id:o,glyph:S[o]||null}})}_doesCharSupportLocalGlyph(i){return!!this.localIdeographFontFamily&&(l.u["CJK Unified Ideographs"](i)||l.u["Hangul Syllables"](i)||l.u.Hiragana(i)||l.u.Katakana(i))}_tinySDF(i,o,h){const p=this.localIdeographFontFamily;if(!p||!this._doesCharSupportLocalGlyph(h))return;let _=i.tinySDF;if(!_){let E="400";/bold/i.test(o)?E="900":/medium/i.test(o)?E="500":/light/i.test(o)&&(E="200"),_=i.tinySDF=new ii.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:p,fontWeight:E})}const S=_.draw(String.fromCharCode(h));return{id:h,bitmap:new l.o({width:S.width||60,height:S.height||60},S.data),metrics:{width:S.glyphWidth/2||24,height:S.glyphHeight/2||24,left:S.glyphLeft/2+.5||0,top:S.glyphTop/2-27.5||-8,advance:S.glyphAdvance/2||24,isDoubleResolution:!0}}}}ii.loadGlyphRange=function(y,i,o,h){return l._(this,void 0,void 0,function*(){const p=256*i,_=p+255,S=h.transformRequest(o.replace("{fontstack}",y).replace("{range}",`${p}-${_}`),"Glyphs"),E=yield l.l(S,new AbortController);if(!E||!E.data)throw new Error(`Could not load glyph range. range: ${i}, ${p}-${_}`);const C={};for(const k of l.n(E.data))C[k.id]=k;return C})},ii.TinySDF=class{constructor({fontSize:y=24,buffer:i=3,radius:o=8,cutoff:h=.25,fontFamily:p="sans-serif",fontWeight:_="normal",fontStyle:S="normal"}={}){this.buffer=i,this.cutoff=h,this.radius=o;const E=this.size=y+4*i,C=this._createCanvas(E),k=this.ctx=C.getContext("2d",{willReadFrequently:!0});k.font=`${S} ${_} ${y}px ${p}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}_createCanvas(y){const i=document.createElement("canvas");return i.width=i.height=y,i}draw(y){const{width:i,actualBoundingBoxAscent:o,actualBoundingBoxDescent:h,actualBoundingBoxLeft:p,actualBoundingBoxRight:_}=this.ctx.measureText(y),S=Math.ceil(o),E=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-p))),C=Math.min(this.size-this.buffer,S+Math.ceil(h)),k=E+2*this.buffer,F=C+2*this.buffer,B=Math.max(k*F,0),q=new Uint8ClampedArray(B),ie={data:q,width:k,height:F,glyphWidth:E,glyphHeight:C,glyphTop:S,glyphLeft:0,glyphAdvance:i};if(E===0||C===0)return ie;const{ctx:ee,buffer:ne,gridInner:X,gridOuter:fe}=this;ee.clearRect(ne,ne,E,C),ee.fillText(y,ne,ne+S);const Ie=ee.getImageData(ne,ne,E,C);fe.fill(zt,0,B),X.fill(0,0,B);for(let le=0;le<C;le++)for(let we=0;we<E;we++){const Ae=Ie.data[4*(le*E+we)+3]/255;if(Ae===0)continue;const ke=(le+ne)*k+we+ne;if(Ae===1)fe[ke]=0,X[ke]=zt;else{const Oe=.5-Ae;fe[ke]=Oe>0?Oe*Oe:0,X[ke]=Oe<0?Oe*Oe:0}}Bi(fe,0,0,k,F,k,this.f,this.v,this.z),Bi(X,ne,ne,E,C,k,this.f,this.v,this.z);for(let le=0;le<B;le++){const we=Math.sqrt(fe[le])-Math.sqrt(X[le]);q[le]=Math.round(255-255*(we/this.radius+this.cutoff))}return ie}};class hi{constructor(){this.specification=l.v.light.position}possiblyEvaluate(i,o){return l.y(i.expression.evaluate(o))}interpolate(i,o,h){return{x:l.z.number(i.x,o.x,h),y:l.z.number(i.y,o.y,h),z:l.z.number(i.z,o.z,h)}}}let Mi;class yr extends l.E{constructor(i){super(),Mi=Mi||new l.q({anchor:new l.D(l.v.light.anchor),position:new hi,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.T(Mi),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,o={}){if(!this._validate(l.r,i,o))for(const h in i){const p=i[h];h.endsWith("-transition")?this._transitionable.setTransition(h.slice(0,-11),p):this._transitionable.setValue(h,p)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,o,h){return(!h||h.validate!==!1)&&l.t(this,i.call(l.x,{value:o,style:{glyphs:!0,sprite:!0},styleSpec:l.v}))}}class at{constructor(i,o){this.width=i,this.height=o,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(i,o){const h=i.join(",")+String(o);return this.dashEntry[h]||(this.dashEntry[h]=this.addDash(i,o)),this.dashEntry[h]}getDashRanges(i,o,h){const p=[];let _=i.length%2==1?-i[i.length-1]*h:0,S=i[0]*h,E=!0;p.push({left:_,right:S,isDash:E,zeroLength:i[0]===0});let C=i[0];for(let k=1;k<i.length;k++){E=!E;const F=i[k];_=C*h,C+=F,S=C*h,p.push({left:_,right:S,isDash:E,zeroLength:F===0})}return p}addRoundDash(i,o,h){const p=o/2;for(let _=-h;_<=h;_++){const S=this.width*(this.nextRow+h+_);let E=0,C=i[E];for(let k=0;k<this.width;k++){k/C.right>1&&(C=i[++E]);const F=Math.abs(k-C.left),B=Math.abs(k-C.right),q=Math.min(F,B);let ie;const ee=_/h*(p+1);if(C.isDash){const ne=p-Math.abs(ee);ie=Math.sqrt(q*q+ne*ne)}else ie=p-Math.sqrt(q*q+ee*ee);this.data[S+k]=Math.max(0,Math.min(255,ie+128))}}}addRegularDash(i){for(let E=i.length-1;E>=0;--E){const C=i[E],k=i[E+1];C.zeroLength?i.splice(E,1):k&&k.isDash===C.isDash&&(k.left=C.left,i.splice(E,1))}const o=i[0],h=i[i.length-1];o.isDash===h.isDash&&(o.left=h.left-this.width,h.right=o.right+this.width);const p=this.width*this.nextRow;let _=0,S=i[_];for(let E=0;E<this.width;E++){E/S.right>1&&(S=i[++_]);const C=Math.abs(E-S.left),k=Math.abs(E-S.right),F=Math.min(C,k);this.data[p+E]=Math.max(0,Math.min(255,(S.isDash?F:-F)+128))}}addDash(i,o){const h=o?7:0,p=2*h+1;if(this.nextRow+p>this.height)return l.w("LineAtlas out of space"),null;let _=0;for(let E=0;E<i.length;E++)_+=i[E];if(_!==0){const E=this.width/_,C=this.getDashRanges(i,this.width,E);o?this.addRoundDash(C,E,h):this.addRegularDash(C)}const S={y:(this.nextRow+h+.5)/this.height,height:2*h/this.height,width:_};return this.nextRow+=p,this.dirty=!0,S}bind(i){const o=i.gl;this.texture?(o.bindTexture(o.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,o.texSubImage2D(o.TEXTURE_2D,0,0,0,this.width,this.height,o.ALPHA,o.UNSIGNED_BYTE,this.data))):(this.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.ALPHA,this.width,this.height,0,o.ALPHA,o.UNSIGNED_BYTE,this.data))}}const tt="maplibre_preloaded_worker_pool";class Je{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<Je.workerCount;)this.workers.push(new Worker(l.a.WORKER_URL));return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[tt]}numActive(){return Object.keys(this.active).length}}const nr=Math.floor(D.hardwareConcurrency/2);let Zi,Si;function Ve(){return Zi||(Zi=new Je),Zi}Je.workerCount=l.B(globalThis)?Math.max(Math.min(nr,3),1):1;class Et{constructor(i,o){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=o;const h=this.workerPool.acquire(o);for(let p=0;p<h.length;p++){const _=new l.C(h[p],o);_.name=`Worker ${p}`,this.actors.push(_)}if(!this.actors.length)throw new Error("No actors found")}broadcast(i,o){const h=[];for(const p of this.actors)h.push(p.sendAsync({type:i,data:o}));return Promise.all(h)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(i=!0){this.actors.forEach(o=>{o.remove()}),this.actors=[],i&&this.workerPool.release(this.id)}registerMessageHandler(i,o){for(const h of this.actors)h.registerMessageHandler(i,o)}}function ut(){return Si||(Si=new Et(Ve(),l.G),Si.registerMessageHandler("GR",(y,i,o)=>l.m(i,o))),Si}function Qe(y,i){const o=l.F();return l.H(o,o,[1,1,0]),l.J(o,o,[.5*y.width,.5*y.height,1]),l.K(o,o,y.calculatePosMatrix(i.toUnwrapped()))}function Di(y,i,o,h,p,_){const S=function(B,q,ie){if(B)for(const ee of B){const ne=q[ee];if(ne&&ne.source===ie&&ne.type==="fill-extrusion")return!0}else for(const ee in q){const ne=q[ee];if(ne.source===ie&&ne.type==="fill-extrusion")return!0}return!1}(p&&p.layers,i,y.id),E=_.maxPitchScaleFactor(),C=y.tilesIn(h,E,S);C.sort(zi);const k=[];for(const B of C)k.push({wrappedTileID:B.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(i,o,y._state,B.queryGeometry,B.cameraQueryGeometry,B.scale,p,_,E,Qe(y.transform,B.tileID))});const F=function(B){const q={},ie={};for(const ee of B){const ne=ee.queryResults,X=ee.wrappedTileID,fe=ie[X]=ie[X]||{};for(const Ie in ne){const le=ne[Ie],we=fe[Ie]=fe[Ie]||{},Ae=q[Ie]=q[Ie]||[];for(const ke of le)we[ke.featureIndex]||(we[ke.featureIndex]=!0,Ae.push(ke))}}return q}(k);for(const B in F)F[B].forEach(q=>{const ie=q.feature,ee=y.getFeatureState(ie.layer["source-layer"],ie.id);ie.source=ie.layer.source,ie.layer["source-layer"]&&(ie.sourceLayer=ie.layer["source-layer"]),ie.state=ee});return F}function zi(y,i){const o=y.tileID,h=i.tileID;return o.overscaledZ-h.overscaledZ||o.canonical.y-h.canonical.y||o.wrap-h.wrap||o.canonical.x-h.canonical.x}function se(y,i,o){return l._(this,void 0,void 0,function*(){let h=y;if(y.url?h=(yield l.h(i.transformRequest(y.url,"Source"),o)).data:yield D.frameAsync(o),!h)return null;const p=l.L(l.e(h,y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in h&&h.vector_layers&&(p.vectorLayerIds=h.vector_layers.map(_=>_.id)),p})}class ue{constructor(i,o){i&&(o?this.setSouthWest(i).setNorthEast(o):Array.isArray(i)&&(i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1])))}setNorthEast(i){return this._ne=i instanceof l.M?new l.M(i.lng,i.lat):l.M.convert(i),this}setSouthWest(i){return this._sw=i instanceof l.M?new l.M(i.lng,i.lat):l.M.convert(i),this}extend(i){const o=this._sw,h=this._ne;let p,_;if(i instanceof l.M)p=i,_=i;else{if(!(i instanceof ue))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(ue.convert(i)):this.extend(l.M.convert(i)):i&&("lng"in i||"lon"in i)&&"lat"in i?this.extend(l.M.convert(i)):this;if(p=i._sw,_=i._ne,!p||!_)return this}return o||h?(o.lng=Math.min(p.lng,o.lng),o.lat=Math.min(p.lat,o.lat),h.lng=Math.max(_.lng,h.lng),h.lat=Math.max(_.lat,h.lat)):(this._sw=new l.M(p.lng,p.lat),this._ne=new l.M(_.lng,_.lat)),this}getCenter(){return new l.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.M(this.getWest(),this.getNorth())}getSouthEast(){return new l.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:o,lat:h}=l.M.convert(i);let p=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&p}static convert(i){return i instanceof ue?i:i&&new ue(i)}static fromLngLat(i,o=0){const h=360*o/40075017,p=h/Math.cos(Math.PI/180*i.lat);return new ue(new l.M(i.lng-p,i.lat-h),new l.M(i.lng+p,i.lat+h))}}class De{constructor(i,o,h){this.bounds=ue.convert(this.validateBounds(i)),this.minzoom=o||0,this.maxzoom=h||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const o=Math.pow(2,i.z),h=Math.floor(l.N(this.bounds.getWest())*o),p=Math.floor(l.O(this.bounds.getNorth())*o),_=Math.ceil(l.N(this.bounds.getEast())*o),S=Math.ceil(l.O(this.bounds.getSouth())*o);return i.x>=h&&i.x<_&&i.y>=p&&i.y<S}}class Fe extends l.E{constructor(i,o,h,p){if(super(),this.id=i,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.L(o,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p)}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield se(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),i&&(l.e(this,i),i.bounds&&(this.tileBounds=new De(i.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(i){this._tileJSONRequest=null,this.fire(new l.j(i))}})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}setSourceProperty(i){this._tileJSONRequest&&this._tileJSONRequest.abort(),i(),this.load()}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}setUrl(i){return this.setSourceProperty(()=>{this.url=i,this._options.url=i}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(i){return l._(this,void 0,void 0,function*(){const o=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),h={request:this.map._requestManager.transformRequest(o,"Tile"),uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};h.request.collectResourceTiming=this._collectResourceTiming;let p="RT";if(i.actor&&i.state!=="expired"){if(i.state==="loading")return new Promise((_,S)=>{i.reloadPromise={resolve:_,reject:S}})}else i.actor=this.dispatcher.getActor(),p="LT";i.abortController=new AbortController;try{const _=yield i.actor.sendAsync({type:p,data:h},i.abortController);if(delete i.abortController,i.aborted)return;this._afterTileLoadWorkerResponse(i,_)}catch(_){if(delete i.abortController,i.aborted)return;if(_&&_.status!==404)throw _;this._afterTileLoadWorkerResponse(i,null)}})}_afterTileLoadWorkerResponse(i,o){if(o&&o.resourceTiming&&(i.resourceTiming=o.resourceTiming),o&&this.map._refreshExpiredTiles&&i.setExpiryData(o),i.loadVectorData(o,this.map.painter),i.reloadPromise){const h=i.reloadPromise;i.reloadPromise=null,this.loadTile(i).then(h.resolve).catch(h.reject)}}abortTile(i){return l._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.actor&&(yield i.actor.sendAsync({type:"AT",data:{uid:i.uid,type:this.type,source:this.id}}))})}unloadTile(i){return l._(this,void 0,void 0,function*(){i.unloadVectorData(),i.actor&&(yield i.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ce extends l.E{constructor(i,o,h,p){super(),this.id=i,this.dispatcher=h,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},o),l.e(this,l.L(o,["url","scheme","tileSize"]))}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield se(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,i&&(l.e(this,i),i.bounds&&(this.tileBounds=new De(i.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(i){this._tileJSONRequest=null,this.fire(new l.j(i))}})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(i){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),i(),this.load()}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}setUrl(i){return this.setSourceProperty(()=>{this.url=i,this._options.url=i}),this}serialize(){return l.e({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i){return l._(this,void 0,void 0,function*(){const o=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);i.abortController=new AbortController;try{const h=yield oe.getImage(this.map._requestManager.transformRequest(o,"Tile"),i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(h&&h.data){this.map._refreshExpiredTiles&&h.cacheControl&&h.expires&&i.setExpiryData({cacheControl:h.cacheControl,expires:h.expires});const p=this.map.painter.context,_=p.gl,S=h.data;i.texture=this.map.painter.getTileTexture(S.width),i.texture?i.texture.update(S,{useMipmap:!0}):(i.texture=new Rt(p,S,_.RGBA,{useMipmap:!0}),i.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST),p.extTextureFilterAnisotropic&&_.texParameterf(_.TEXTURE_2D,p.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,p.extTextureFilterAnisotropicMax)),i.state="loaded"}}catch(h){if(delete i.abortController,i.aborted)i.state="unloaded";else if(h)throw i.state="errored",h}})}abortTile(i){return l._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController)})}unloadTile(i){return l._(this,void 0,void 0,function*(){i.texture&&this.map.painter.saveTileTexture(i.texture)})}hasTransition(){return!1}}class pt extends ce{constructor(i,o,h,p){super(i,o,h,p),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox",this.redFactor=o.redFactor,this.greenFactor=o.greenFactor,this.blueFactor=o.blueFactor,this.baseShift=o.baseShift}loadTile(i){return l._(this,void 0,void 0,function*(){const o=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),h=this.map._requestManager.transformRequest(o,"Tile");i.neighboringTiles=this._getNeighboringTiles(i.tileID),i.abortController=new AbortController;try{const p=yield oe.getImage(h,i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(p&&p.data){const _=p.data;this.map._refreshExpiredTiles&&p.cacheControl&&p.expires&&i.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const S=l.b(_)&&l.S()?_:yield this.readImageNow(_),E={type:this.type,uid:i.uid,source:this.id,rawImageData:S,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!i.actor||i.state==="expired"){i.actor=this.dispatcher.getActor();const C=yield i.actor.sendAsync({type:"LDT",data:E});i.dem=C,i.needsHillshadePrepare=!0,i.needsTerrainPrepare=!0,i.state="loaded"}}}catch(p){if(delete i.abortController,i.aborted)i.state="unloaded";else if(p)throw i.state="errored",p}})}readImageNow(i){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.U()){const o=i.width+2,h=i.height+2;try{return new l.R({width:o,height:h},yield l.V(i,-1,-1,o,h))}catch{}}return D.getImageData(i,1)})}_getNeighboringTiles(i){const o=i.canonical,h=Math.pow(2,o.z),p=(o.x-1+h)%h,_=o.x===0?i.wrap-1:i.wrap,S=(o.x+1+h)%h,E=o.x+1===h?i.wrap+1:i.wrap,C={};return C[new l.Q(i.overscaledZ,_,o.z,p,o.y).key]={backfilled:!1},C[new l.Q(i.overscaledZ,E,o.z,S,o.y).key]={backfilled:!1},o.y>0&&(C[new l.Q(i.overscaledZ,_,o.z,p,o.y-1).key]={backfilled:!1},C[new l.Q(i.overscaledZ,i.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},C[new l.Q(i.overscaledZ,E,o.z,S,o.y-1).key]={backfilled:!1}),o.y+1<h&&(C[new l.Q(i.overscaledZ,_,o.z,p,o.y+1).key]={backfilled:!1},C[new l.Q(i.overscaledZ,i.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},C[new l.Q(i.overscaledZ,E,o.z,S,o.y+1).key]={backfilled:!1}),C}unloadTile(i){return l._(this,void 0,void 0,function*(){i.demTexture&&this.map.painter.saveTileTexture(i.demTexture),i.fbo&&(i.fbo.destroy(),delete i.fbo),i.dem&&delete i.dem,delete i.neighboringTiles,i.state="unloaded",i.actor&&(yield i.actor.sendAsync({type:"RDT",data:{type:this.type,uid:i.uid,source:this.id}}))})}}class At extends l.E{constructor(i,o,h,p){super(),this.id=i,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=h.getActor(),this.setEventedParent(p),this._data=o.data,this._options=l.e({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const _=l.W/this.tileSize;this.workerOptions=l.e({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*_,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*_,extent:l.W,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:l.W,radius:(o.clusterRadius||50)*_,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return l._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(i){this.map=i,this.load()}setData(i){return this._data=i,this._updateWorkerData(),this}updateData(i){return this._updateWorkerData(i),this}setClusterOptions(i){return this.workerOptions.cluster=i.cluster,i&&(i.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=i.clusterRadius),i.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=i.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(i){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:i,source:this.id}})}getClusterChildren(i){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:i,source:this.id}})}getClusterLeaves(i,o,h){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:i,limit:o,offset:h}})}_updateWorkerData(i){return l._(this,void 0,void 0,function*(){const o=l.e({type:this.type},this.workerOptions);i?o.dataDiff=i:typeof this._data=="string"?(o.request=this.map._requestManager.transformRequest(D.resolveURL(this._data),"Source"),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.k("dataloading",{dataType:"source"}));try{const h=yield this.actor.sendAsync({type:"LD",data:o});if(this._pendingLoads--,this._removed||h.abandoned)return void this.fire(new l.k("dataabort",{dataType:"source"}));let p=null;h.resourceTiming&&h.resourceTiming[this.id]&&(p=h.resourceTiming[this.id].slice(0));const _={dataType:"source"};this._collectResourceTiming&&p&&p.length>0&&l.e(_,{resourceTiming:p}),this.fire(new l.k("data",Object.assign(Object.assign({},_),{sourceDataType:"metadata"}))),this.fire(new l.k("data",Object.assign(Object.assign({},_),{sourceDataType:"content"})))}catch(h){if(this._pendingLoads--,this._removed)return void this.fire(new l.k("dataabort",{dataType:"source"}));this.fire(new l.j(h))}})}loaded(){return this._pendingLoads===0}loadTile(i){return l._(this,void 0,void 0,function*(){const o=i.actor?"RT":"LT";i.actor=this.actor;const h={type:this.type,uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};i.abortController=new AbortController;const p=yield this.actor.sendAsync({type:o,data:h},i.abortController);delete i.abortController,i.unloadVectorData(),i.aborted||i.loadVectorData(p,this.map.painter,o==="RT")})}abortTile(i){return l._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.aborted=!0})}unloadTile(i){return l._(this,void 0,void 0,function*(){i.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Be=l.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class rt extends l.E{constructor(i,o,h,p){super(),this.id=i,this.dispatcher=h,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=o}load(i){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const o=yield oe.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,o&&o.data&&(this.image=o.data,i&&(this.coordinates=i),this._finishLoading())}catch(o){this._request=null,this._loaded=!0,this.fire(new l.j(o))}})}loaded(){return this._loaded}updateImage(i){return i.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=i.url,this.load(i.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(i){this.coordinates=i;const o=i.map(l.Y.fromLngLat);this.tileID=function(p){let _=1/0,S=1/0,E=-1/0,C=-1/0;for(const q of p)_=Math.min(_,q.x),S=Math.min(S,q.y),E=Math.max(E,q.x),C=Math.max(C,q.y);const k=Math.max(E-_,C-S),F=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),B=Math.pow(2,F);return new l.a0(F,Math.floor((_+E)/2*B),Math.floor((S+C)/2*B))}(o),this.minzoom=this.maxzoom=this.tileID.z;const h=o.map(p=>this.tileID.getTilePoint(p)._round());return this._boundsArray=new l.Z,this._boundsArray.emplaceBack(h[0].x,h[0].y,0,0),this._boundsArray.emplaceBack(h[1].x,h[1].y,l.W,0),this._boundsArray.emplaceBack(h[3].x,h[3].y,0,l.W),this._boundsArray.emplaceBack(h[2].x,h[2].y,l.W,l.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const i=this.map.painter.context,o=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,Be.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Rt(i,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let h=!1;for(const p in this.tiles){const _=this.tiles[p];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,h=!0)}h&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(i){return l._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={}):i.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class it extends rt{constructor(i,o,h,p){super(i,o,h,p),this.roundZoom=!0,this.type="video",this.options=o}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1;const i=this.options;this.urls=[];for(const o of i.urls)this.urls.push(this.map._requestManager.transformRequest(o,"Source").url);try{const o=yield l.a2(this.urls);if(this._loaded=!0,!o)return;this.video=o,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(o){this.fire(new l.j(o))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(i){if(this.video){const o=this.video.seekable;i<o.start(0)||i>o.end(0)?this.fire(new l.j(new l.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=i}}getVideo(){return this.video}onAdd(i){this.map||(this.map=i,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const i=this.map.painter.context,o=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,Be.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new Rt(i,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let h=!1;for(const p in this.tiles){const _=this.tiles[p];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,h=!0)}h&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Dt extends rt{constructor(i,o,h,p){super(i,o,h,p),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(S=>typeof S!="number"))||this.fire(new l.j(new l.a1(`sources.${i}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.j(new l.a1(`sources.${i}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new l.j(new l.a1(`sources.${i}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new l.j(new l.a1(`sources.${i}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.j(new l.a1(`sources.${i}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){return l._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(i){this.map=i,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let i=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,i=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,i=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context,h=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Be.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture?(i||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Rt(o,this.canvas,h.RGBA,{premultiply:!0});let p=!1;for(const _ in this.tiles){const S=this.tiles[_];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,p=!0)}p&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const i of[this.canvas.width,this.canvas.height])if(isNaN(i)||i<=0)return!0;return!1}}const Xt={},Zt=y=>{switch(y){case"geojson":return At;case"image":return rt;case"raster":return ce;case"raster-dem":return pt;case"vector":return Fe;case"video":return it;case"canvas":return Dt}return Xt[y]},Yt="RTLPluginLoaded";class yi extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=ut()}_syncState(i){return this.status=i,this.dispatcher.broadcast("SRPS",{pluginStatus:i,pluginURL:this.url}).catch(o=>{throw this.status="error",o})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(i){return l._(this,arguments,void 0,function*(o,h=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=D.resolveURL(o),!this.url)throw new Error(`requested url ${o} is invalid`);if(this.status==="unavailable"){if(!h)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return l._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.k(Yt))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Ti=null;function Ue(){return Ti||(Ti=new yi),Ti}class Ni{constructor(i,o){this.timeAdded=0,this.fadeEndTime=0,this.tileID=i,this.uid=l.a3(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(i){const o=i+this.timeAdded;o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(i){this.demTexture&&i.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(i,o,h){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(p,_){const S={};if(!_)return S;for(const E of p){const C=E.layerIds.map(k=>_.getLayer(k)).filter(Boolean);if(C.length!==0){E.layers=C,E.stateDependentLayerIds&&(E.stateDependentLayers=E.stateDependentLayerIds.map(k=>C.filter(F=>F.id===k)[0]));for(const k of C)S[k.id]=E}}return S}(i.buckets,o.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const _=this.buckets[p];if(_ instanceof l.a5){if(this.hasSymbolBuckets=!0,!h)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const _=this.buckets[p];if(_ instanceof l.a5&&_.hasRTLText){this.hasRTLText=!0,Ue().lazyLoad();break}}this.queryPadding=0;for(const p in this.buckets){const _=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(p).queryRadius(_))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage)}else this.collisionBoxArray=new l.a4}unloadVectorData(){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(i){return this.buckets[i.id]}upload(i){for(const h in this.buckets){const p=this.buckets[h];p.uploadPending()&&p.upload(i)}const o=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Rt(i,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Rt(i,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,o,h,p,_,S,E,C,k,F){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:_,scale:S,tileSize:this.tileSize,pixelPosMatrix:F,transform:C,params:E,queryPadding:this.queryPadding*k},i,o,h):{}}querySourceFeatures(i,o){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const p=h.loadVTLayers(),_=o&&o.sourceLayer?o.sourceLayer:"",S=p._geojsonTileLayer||p[_];if(!S)return;const E=l.a6(o&&o.filter),{z:C,x:k,y:F}=this.tileID.canonical,B={z:C,x:k,y:F};for(let q=0;q<S.length;q++){const ie=S.feature(q);if(E.needGeometry){const X=l.a7(ie,!0);if(!E.filter(new l.a8(this.tileID.overscaledZ),X,this.tileID.canonical))continue}else if(!E.filter(new l.a8(this.tileID.overscaledZ),ie))continue;const ee=h.getId(ie,_),ne=new l.a9(ie,C,k,F,ee);ne.tile=B,i.push(ne)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const o=this.expirationTime;if(i.cacheControl){const h=l.aa(i.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const h=Date.now();let p=!1;if(this.expirationTime>h)p=!1;else if(o)if(this.expirationTime<o)p=!0;else{const _=this.expirationTime-o;_?this.expirationTime=h+Math.max(_,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(i,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(i).length===0)return;const h=this.latestFeatureIndex.loadVTLayers();for(const p in this.buckets){if(!o.style.hasLayer(p))continue;const _=this.buckets[p],S=_.layers[0].sourceLayer||"_geojsonTileLayer",E=h[S],C=i[S];if(!E||!C||Object.keys(C).length===0)continue;_.update(C,E,this.imageAtlas&&this.imageAtlas.patternPositions||{});const k=o&&o.style&&o.style.getLayer(p);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<D.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=D.now()+i}setDependencies(i,o){const h={};for(const p of o)h[p]=!0;this.dependencies[i]=h}hasDependency(i,o){for(const h of i){const p=this.dependencies[h];if(p){for(const _ of o)if(p[_])return!0}}return!1}}class Yi{constructor(i,o){this.max=i,this.onRemove=o,this.reset()}reset(){for(const i in this.data)for(const o of this.data[i])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(i,o,h){const p=i.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const _={value:o,timeout:void 0};if(h!==void 0&&(_.timeout=setTimeout(()=>{this.remove(i,_)},h)),this.data[p].push(_),this.order.push(p),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const o=this.data[i].shift();return o.timeout&&clearTimeout(o.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),o.value}getByKey(i){const o=this.data[i];return o?o[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,o){if(!this.has(i))return this;const h=i.wrapped().key,p=o===void 0?0:this.data[h].indexOf(o),_=this.data[h][p];return this.data[h].splice(p,1),_.timeout&&clearTimeout(_.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(_.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(i){const o=[];for(const h in this.data)for(const p of this.data[h])i(p.value)||o.push(p);for(const h of o)this.remove(h.value.tileID,h)}}class gn{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,o,h){const p=String(o);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][p]=this.stateChanges[i][p]||{},l.e(this.stateChanges[i][p],h),this.deletedStates[i]===null){this.deletedStates[i]={};for(const _ in this.state[i])_!==p&&(this.deletedStates[i][_]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][p]===null){this.deletedStates[i][p]={};for(const _ in this.state[i][p])h[_]||(this.deletedStates[i][p][_]=null)}else for(const _ in h)this.deletedStates[i]&&this.deletedStates[i][p]&&this.deletedStates[i][p][_]===null&&delete this.deletedStates[i][p][_]}removeFeatureState(i,o,h){if(this.deletedStates[i]===null)return;const p=String(o);if(this.deletedStates[i]=this.deletedStates[i]||{},h&&o!==void 0)this.deletedStates[i][p]!==null&&(this.deletedStates[i][p]=this.deletedStates[i][p]||{},this.deletedStates[i][p][h]=null);else if(o!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][p])for(h in this.deletedStates[i][p]={},this.stateChanges[i][p])this.deletedStates[i][p][h]=null;else this.deletedStates[i][p]=null;else this.deletedStates[i]=null}getState(i,o){const h=String(o),p=l.e({},(this.state[i]||{})[h],(this.stateChanges[i]||{})[h]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){const _=this.deletedStates[i][o];if(_===null)return{};for(const S in _)delete p[S]}return p}initializeTileState(i,o){i.setFeatureState(this.state,o)}coalesceChanges(i,o){const h={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const _={};for(const S in this.stateChanges[p])this.state[p][S]||(this.state[p][S]={}),l.e(this.state[p][S],this.stateChanges[p][S]),_[S]=this.state[p][S];h[p]=_}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const _={};if(this.deletedStates[p]===null)for(const S in this.state[p])_[S]={},this.state[p][S]={};else for(const S in this.deletedStates[p]){if(this.deletedStates[p][S]===null)this.state[p][S]={};else for(const E of Object.keys(this.deletedStates[p][S]))delete this.state[p][S][E];_[S]=this.state[p][S]}h[p]=h[p]||{},l.e(h[p],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(const p in i)i[p].setFeatureState(h,o)}}class Sr extends l.E{constructor(i,o,h){super(),this.id=i,this.dispatcher=h,this.on("data",p=>this._dataHandler(p)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((p,_,S,E)=>{const C=new(Zt(_.type))(p,_,S,E);if(C.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${C.id}`);return C})(i,o,h,this),this._tiles={},this._cache=new Yi(0,p=>this._unloadTile(p)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new gn,this._didEmitContent=!1,this._updated=!1}onAdd(i){this.map=i,this._maxTileCacheSize=i?i._maxTileCacheSize:null,this._maxTileCacheZoomLevels=i?i._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(i)}onRemove(i){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(i)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const i in this._tiles){const o=this._tiles[i];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(i,o,h){return l._(this,void 0,void 0,function*(){try{yield this._source.loadTile(i),this._tileLoaded(i,o,h)}catch(p){i.state="errored",p.status!==404?this._source.fire(new l.j(p,{tile:i})):this.update(this.transform,this.terrain)}})}_unloadTile(i){this._source.unloadTile&&this._source.unloadTile(i)}_abortTile(i){this._source.abortTile&&this._source.abortTile(i),this._source.fire(new l.k("dataabort",{tile:i,coord:i.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const h=this._tiles[o];h.upload(i),h.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(i=>i.tileID).sort(nt).map(i=>i.key)}getRenderableIds(i){const o=[];for(const h in this._tiles)this._isIdRenderable(h,i)&&o.push(this._tiles[h]);return i?o.sort((h,p)=>{const _=h.tileID,S=p.tileID,E=new l.P(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),C=new l.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-S.overscaledZ||C.y-E.y||C.x-E.x}).map(h=>h.tileID.key):o.map(h=>h.tileID).sort(nt).map(h=>h.key)}hasRenderableParent(i){const o=this.findLoadedParent(i,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(i,o){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(o||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(i,"reloading")}}_reloadTile(i,o){return l._(this,void 0,void 0,function*(){const h=this._tiles[i];h&&(h.state!=="loading"&&(h.state=o),yield this._loadTile(h,i,o))})}_tileLoaded(i,o,h){i.timeAdded=D.now(),h==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(o,i),this.getSource().type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),i.aborted||this._source.fire(new l.k("data",{dataType:"source",tile:i,coord:i.tileID}))}_backfillDEM(i){const o=this.getRenderableIds();for(let p=0;p<o.length;p++){const _=o[p];if(i.neighboringTiles&&i.neighboringTiles[_]){const S=this.getTileByID(_);h(i,S),h(S,i)}}function h(p,_){p.needsHillshadePrepare=!0,p.needsTerrainPrepare=!0;let S=_.tileID.canonical.x-p.tileID.canonical.x;const E=_.tileID.canonical.y-p.tileID.canonical.y,C=Math.pow(2,p.tileID.canonical.z),k=_.tileID.key;S===0&&E===0||Math.abs(E)>1||(Math.abs(S)>1&&(Math.abs(S+C)===1?S+=C:Math.abs(S-C)===1&&(S-=C)),_.dem&&p.dem&&(p.dem.backfillBorder(_.dem,S,E),p.neighboringTiles&&p.neighboringTiles[k]&&(p.neighboringTiles[k].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,o,h,p){for(const _ in this._tiles){let S=this._tiles[_];if(p[_]||!S.hasData()||S.tileID.overscaledZ<=o||S.tileID.overscaledZ>h)continue;let E=S.tileID;for(;S&&S.tileID.overscaledZ>o+1;){const k=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[k.key],S&&S.hasData()&&(E=k)}let C=E;for(;C.overscaledZ>o;)if(C=C.scaledTo(C.overscaledZ-1),i[C.key]){p[E.key]=E;break}}}findLoadedParent(i,o){if(i.key in this._loadedParentTiles){const h=this._loadedParentTiles[i.key];return h&&h.tileID.overscaledZ>=o?h:null}for(let h=i.overscaledZ-1;h>=o;h--){const p=i.scaledTo(h),_=this._getLoadedTile(p);if(_)return _}}_getLoadedTile(i){const o=this._tiles[i.key];return o&&o.hasData()?o:this._cache.getByKey(i.wrapped().key)}updateCacheSize(i){const o=Math.ceil(i.width/this._source.tileSize)+1,h=Math.ceil(i.height/this._source.tileSize)+1,p=Math.floor(o*h*(this._maxTileCacheZoomLevels===null?l.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(_)}handleWrapJump(i){const o=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,o){const h={};for(const p in this._tiles){const _=this._tiles[p];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+o),h[_.tileID.key]=_}this._tiles=h;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(p,this._tiles[p])}}update(i,o){if(!this._sourceLoaded||this._paused)return;let h;this.transform=i,this.terrain=o,this.updateCacheSize(i),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(F=>new l.Q(F.canonical.z,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y)):(h=i.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:o}),this._source.hasTile&&(h=h.filter(F=>this._source.hasTile(F)))):h=[];const p=i.coveringZoomLevel(this._source),_=Math.max(p-Sr.maxOverzooming,this._source.minzoom),S=Math.max(p+Sr.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const F={};for(const B of h)if(B.canonical.z>this._source.minzoom){const q=B.scaledTo(B.canonical.z-1);F[q.key]=q;const ie=B.scaledTo(Math.max(this._source.minzoom,Math.min(B.canonical.z,5)));F[ie.key]=ie}h=h.concat(Object.values(F))}const E=h.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,E&&this.fire(new l.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const C=this._updateRetainedTiles(h,p);if(ci(this._source.type)){const F={},B={},q=Object.keys(C),ie=D.now();for(const ee of q){const ne=C[ee],X=this._tiles[ee];if(!X||X.fadeEndTime!==0&&X.fadeEndTime<=ie)continue;const fe=this.findLoadedParent(ne,_);fe&&(this._addTile(fe.tileID),F[fe.tileID.key]=fe.tileID),B[ee]=ne}this._retainLoadedChildren(B,p,S,C);for(const ee in F)C[ee]||(this._coveredTiles[ee]=!0,C[ee]=F[ee]);if(o){const ee={},ne={};for(const X of h)this._tiles[X.key].hasData()?ee[X.key]=X:ne[X.key]=X;for(const X in ne){const fe=ne[X].children(this._source.maxzoom);this._tiles[fe[0].key]&&this._tiles[fe[1].key]&&this._tiles[fe[2].key]&&this._tiles[fe[3].key]&&(ee[fe[0].key]=C[fe[0].key]=fe[0],ee[fe[1].key]=C[fe[1].key]=fe[1],ee[fe[2].key]=C[fe[2].key]=fe[2],ee[fe[3].key]=C[fe[3].key]=fe[3],delete ne[X])}for(const X in ne){const fe=this.findLoadedParent(ne[X],this._source.minzoom);if(fe){ee[fe.tileID.key]=C[fe.tileID.key]=fe.tileID;for(const Ie in ee)ee[Ie].isChildOf(fe.tileID)&&delete ee[Ie]}}for(const X in this._tiles)ee[X]||(this._coveredTiles[X]=!0)}}for(const F in C)this._tiles[F].clearFadeHold();const k=l.ab(this._tiles,C);for(const F of k){const B=this._tiles[F];B.hasSymbolBuckets&&!B.holdingForFade()?B.setHoldDuration(this.map._fadeDuration):B.hasSymbolBuckets&&!B.symbolFadeFinished()||this._removeTile(F)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(i)}_updateRetainedTiles(i,o){const h={},p={},_=Math.max(o-Sr.maxOverzooming,this._source.minzoom),S=Math.max(o+Sr.maxUnderzooming,this._source.minzoom),E={};for(const C of i){const k=this._addTile(C);h[C.key]=C,k.hasData()||o<this._source.maxzoom&&(E[C.key]=C)}this._retainLoadedChildren(E,o,S,h);for(const C of i){let k=this._tiles[C.key];if(k.hasData())continue;if(o+1>this._source.maxzoom){const B=C.children(this._source.maxzoom)[0],q=this.getTile(B);if(q&&q.hasData()){h[B.key]=B;continue}}else{const B=C.children(this._source.maxzoom);if(h[B[0].key]&&h[B[1].key]&&h[B[2].key]&&h[B[3].key])continue}let F=k.wasRequested();for(let B=C.overscaledZ-1;B>=_;--B){const q=C.scaledTo(B);if(p[q.key])break;if(p[q.key]=!0,k=this.getTile(q),!k&&F&&(k=this._addTile(q)),k){const ie=k.hasData();if((F||ie)&&(h[q.key]=q),F=k.wasRequested(),ie)break}}}return h}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const o=[];let h,p=this._tiles[i].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){h=this._loadedParentTiles[p.key];break}o.push(p.key);const _=p.scaledTo(p.overscaledZ-1);if(h=this._getLoadedTile(_),h)break;p=_}for(const _ of o)this._loadedParentTiles[_]=h}}_addTile(i){let o=this._tiles[i.key];if(o)return o;o=this._cache.getAndRemove(i),o&&(this._setTileReloadTimer(i.key,o),o.tileID=i,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,o)));const h=o;return o||(o=new Ni(i,this._source.tileSize*i.overscaleFactor()),this._loadTile(o,i.key,o.state)),o.uses++,this._tiles[i.key]=o,h||this._source.fire(new l.k("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o}_setTileReloadTimer(i,o){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const h=o.getExpiryTimeout();h&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},h))}_removeTile(i){const o=this._tiles[i];o&&(o.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),o.uses>0||(o.hasData()&&o.state!=="reloading"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}_dataHandler(i){const o=i.sourceDataType;i.dataType==="source"&&o==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&i.dataType==="source"&&o==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(i);this._cache.reset()}tilesIn(i,o,h){const p=[],_=this.transform;if(!_)return p;const S=h?_.getCameraQueryGeometry(i):i,E=i.map(ee=>_.pointCoordinate(ee,this.terrain)),C=S.map(ee=>_.pointCoordinate(ee,this.terrain)),k=this.getIds();let F=1/0,B=1/0,q=-1/0,ie=-1/0;for(const ee of C)F=Math.min(F,ee.x),B=Math.min(B,ee.y),q=Math.max(q,ee.x),ie=Math.max(ie,ee.y);for(let ee=0;ee<k.length;ee++){const ne=this._tiles[k[ee]];if(ne.holdingForFade())continue;const X=ne.tileID,fe=Math.pow(2,_.zoom-ne.tileID.overscaledZ),Ie=o*ne.queryPadding*l.W/ne.tileSize/fe,le=[X.getTilePoint(new l.Y(F,B)),X.getTilePoint(new l.Y(q,ie))];if(le[0].x-Ie<l.W&&le[0].y-Ie<l.W&&le[1].x+Ie>=0&&le[1].y+Ie>=0){const we=E.map(ke=>X.getTilePoint(ke)),Ae=C.map(ke=>X.getTilePoint(ke));p.push({tile:ne,tileID:X,queryGeometry:we,cameraQueryGeometry:Ae,scale:fe})}}return p}getVisibleCoordinates(i){const o=this.getRenderableIds(i).map(h=>this._tiles[h].tileID);for(const h of o)h.posMatrix=this.transform.calculatePosMatrix(h.toUnwrapped());return o}hasTransition(){if(this._source.hasTransition())return!0;if(ci(this._source.type)){const i=D.now();for(const o in this._tiles)if(this._tiles[o].fadeEndTime>=i)return!0}return!1}setFeatureState(i,o,h){this._state.updateState(i=i||"_geojsonTileLayer",o,h)}removeFeatureState(i,o,h){this._state.removeFeatureState(i=i||"_geojsonTileLayer",o,h)}getFeatureState(i,o){return this._state.getState(i=i||"_geojsonTileLayer",o)}setDependencies(i,o,h){const p=this._tiles[i];p&&p.setDependencies(o,h)}reloadTilesForDependencies(i,o){for(const h in this._tiles)this._tiles[h].hasDependency(i,o)&&this._reloadTile(h,"reloading");this._cache.filter(h=>!h.hasDependency(i,o))}}function nt(y,i){const o=Math.abs(2*y.wrap)-+(y.wrap<0),h=Math.abs(2*i.wrap)-+(i.wrap<0);return y.overscaledZ-i.overscaledZ||h-o||i.canonical.y-y.canonical.y||i.canonical.x-y.canonical.x}function ci(y){return y==="raster"||y==="image"||y==="video"}Sr.maxOverzooming=10,Sr.maxUnderzooming=3;class Nt{constructor(i,o){this.reset(i,o)}reset(i,o){this.points=i||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=l.ac(i,0,1);let o=1,h=this._distances[o];const p=i*this.paddedLength+this.padding;for(;h<p&&o<this._distances.length;)h=this._distances[++o];const _=o-1,S=this._distances[_],E=h-S,C=E>0?(p-S)/E:0;return this.points[_].mult(1-C).add(this.points[o].mult(C))}}function ji(y,i){let o=!0;return y==="always"||y!=="never"&&i!=="never"||(o=!1),o}class yn{constructor(i,o,h){const p=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(i/h),this.yCellCount=Math.ceil(o/h);for(let S=0;S<this.xCellCount*this.yCellCount;S++)p.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=o,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,o,h,p,_){this._forEachCell(o,h,p,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(_)}insertCircle(i,o,h,p){this._forEachCell(o-p,h-p,o+p,h+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(o),this.circles.push(h),this.circles.push(p)}_insertBoxCell(i,o,h,p,_,S){this.boxCells[_].push(S)}_insertCircleCell(i,o,h,p,_,S){this.circleCells[_].push(S)}_query(i,o,h,p,_,S,E){if(h<0||i>this.width||p<0||o>this.height)return[];const C=[];if(i<=0&&o<=0&&this.width<=h&&this.height<=p){if(_)return[{key:null,x1:i,y1:o,x2:h,y2:p}];for(let k=0;k<this.boxKeys.length;k++)C.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const F=this.circles[3*k],B=this.circles[3*k+1],q=this.circles[3*k+2];C.push({key:this.circleKeys[k],x1:F-q,y1:B-q,x2:F+q,y2:B+q})}}else this._forEachCell(i,o,h,p,this._queryCell,C,{hitTest:_,overlapMode:S,seenUids:{box:{},circle:{}}},E);return C}query(i,o,h,p){return this._query(i,o,h,p,!1,null)}hitTest(i,o,h,p,_,S){return this._query(i,o,h,p,!0,_,S).length>0}hitTestCircle(i,o,h,p,_){const S=i-h,E=i+h,C=o-h,k=o+h;if(E<0||S>this.width||k<0||C>this.height)return!1;const F=[];return this._forEachCell(S,C,E,k,this._queryCellCircle,F,{hitTest:!0,overlapMode:p,circle:{x:i,y:o,radius:h},seenUids:{box:{},circle:{}}},_),F.length>0}_queryCell(i,o,h,p,_,S,E,C){const{seenUids:k,hitTest:F,overlapMode:B}=E,q=this.boxCells[_];if(q!==null){const ee=this.bboxes;for(const ne of q)if(!k.box[ne]){k.box[ne]=!0;const X=4*ne,fe=this.boxKeys[ne];if(i<=ee[X+2]&&o<=ee[X+3]&&h>=ee[X+0]&&p>=ee[X+1]&&(!C||C(fe))&&(!F||!ji(B,fe.overlapMode))&&(S.push({key:fe,x1:ee[X],y1:ee[X+1],x2:ee[X+2],y2:ee[X+3]}),F))return!0}}const ie=this.circleCells[_];if(ie!==null){const ee=this.circles;for(const ne of ie)if(!k.circle[ne]){k.circle[ne]=!0;const X=3*ne,fe=this.circleKeys[ne];if(this._circleAndRectCollide(ee[X],ee[X+1],ee[X+2],i,o,h,p)&&(!C||C(fe))&&(!F||!ji(B,fe.overlapMode))){const Ie=ee[X],le=ee[X+1],we=ee[X+2];if(S.push({key:fe,x1:Ie-we,y1:le-we,x2:Ie+we,y2:le+we}),F)return!0}}}return!1}_queryCellCircle(i,o,h,p,_,S,E,C){const{circle:k,seenUids:F,overlapMode:B}=E,q=this.boxCells[_];if(q!==null){const ee=this.bboxes;for(const ne of q)if(!F.box[ne]){F.box[ne]=!0;const X=4*ne,fe=this.boxKeys[ne];if(this._circleAndRectCollide(k.x,k.y,k.radius,ee[X+0],ee[X+1],ee[X+2],ee[X+3])&&(!C||C(fe))&&!ji(B,fe.overlapMode))return S.push(!0),!0}}const ie=this.circleCells[_];if(ie!==null){const ee=this.circles;for(const ne of ie)if(!F.circle[ne]){F.circle[ne]=!0;const X=3*ne,fe=this.circleKeys[ne];if(this._circlesCollide(ee[X],ee[X+1],ee[X+2],k.x,k.y,k.radius)&&(!C||C(fe))&&!ji(B,fe.overlapMode))return S.push(!0),!0}}}_forEachCell(i,o,h,p,_,S,E,C){const k=this._convertToXCellCoord(i),F=this._convertToYCellCoord(o),B=this._convertToXCellCoord(h),q=this._convertToYCellCoord(p);for(let ie=k;ie<=B;ie++)for(let ee=F;ee<=q;ee++)if(_.call(this,i,o,h,p,this.xCellCount*ee+ie,S,E,C))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,o,h,p,_,S){const E=p-i,C=_-o,k=h+S;return k*k>E*E+C*C}_circleAndRectCollide(i,o,h,p,_,S,E){const C=(S-p)/2,k=Math.abs(i-(p+C));if(k>C+h)return!1;const F=(E-_)/2,B=Math.abs(o-(_+F));if(B>F+h)return!1;if(k<=C||B<=F)return!0;const q=k-C,ie=B-F;return q*q+ie*ie<=h*h}}function ri(y,i,o,h,p){const _=l.F();return i?(l.J(_,_,[1/p,1/p,1]),o||l.ad(_,_,h.angle)):l.K(_,h.labelPlaneMatrix,y),_}function ea(y,i,o,h,p){if(i){const _=l.ae(y);return l.J(_,_,[p,p,1]),o||l.ad(_,_,-h.angle),_}return h.glCoordMatrix}function Er(y,i,o){let h;o?(h=[y.x,y.y,o(y.x,y.y),1],l.af(h,h,i)):(h=[y.x,y.y,0,1],$t(h,h,i));const p=h[3];return{point:new l.P(h[0]/p,h[1]/p),signedDistanceFromCamera:p}}function te(y,i){return .5+y/i*.5}function N(y,i){const o=y[0]/y[3],h=y[1]/y[3];return o>=-i[0]&&o<=i[0]&&h>=-i[1]&&h<=i[1]}function U(y,i,o,h,p,_,S,E,C,k){const F=h?y.textSizeData:y.iconSizeData,B=l.ag(F,o.transform.zoom),q=[256/o.width*2+1,256/o.height*2+1],ie=h?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;ie.clear();const ee=y.lineVertexArray,ne=h?y.text.placedSymbolArray:y.icon.placedSymbolArray,X=o.transform.width/o.transform.height;let fe=!1;for(let Ie=0;Ie<ne.length;Ie++){const le=ne.get(Ie);if(le.hidden||le.writingMode===l.ah.vertical&&!fe){Ne(le.numGlyphs,ie);continue}let we;if(fe=!1,k?(we=[le.anchorX,le.anchorY,k(le.anchorX,le.anchorY),1],l.af(we,we,i)):(we=[le.anchorX,le.anchorY,0,1],$t(we,we,i)),!N(we,q)){Ne(le.numGlyphs,ie);continue}const Ae=te(o.transform.cameraToCenterDistance,we[3]),ke=l.ai(F,B,le),Oe=S?ke/Ae:ke*Ae,We=new l.P(le.anchorX,le.anchorY),He=Er(We,p,k).point,st={projections:{},offsets:{}},ht=_e(le,Oe,!1,E,i,p,_,y.glyphOffsetArray,ee,ie,He,We,st,X,C,k);fe=ht.useVertical,(ht.notEnoughRoom||fe||ht.needsFlipping&&_e(le,Oe,!0,E,i,p,_,y.glyphOffsetArray,ee,ie,He,We,st,X,C,k).notEnoughRoom)&&Ne(le.numGlyphs,ie)}h?y.text.dynamicLayoutVertexBuffer.updateData(ie):y.icon.dynamicLayoutVertexBuffer.updateData(ie)}function H(y,i,o,h,p,_,S,E,C,k,F,B,q){const ie=E.glyphStartIndex+E.numGlyphs,ee=E.lineStartIndex,ne=E.lineStartIndex+E.lineLength,X=i.getoffsetX(E.glyphStartIndex),fe=i.getoffsetX(ie-1),Ie=qe(y*X,o,h,p,_,S,E.segment,ee,ne,C,k,F,B,q);if(!Ie)return null;const le=qe(y*fe,o,h,p,_,S,E.segment,ee,ne,C,k,F,B,q);return le?{first:Ie,last:le}:null}function Q(y,i,o,h){return y===l.ah.horizontal&&Math.abs(o.y-i.y)>Math.abs(o.x-i.x)*h?{useVertical:!0}:(y===l.ah.vertical?i.y<o.y:i.x>o.x)?{needsFlipping:!0}:null}function _e(y,i,o,h,p,_,S,E,C,k,F,B,q,ie,ee,ne){const X=i/24,fe=y.lineOffsetX*X,Ie=y.lineOffsetY*X;let le;if(y.numGlyphs>1){const we=y.glyphStartIndex+y.numGlyphs,Ae=y.lineStartIndex,ke=y.lineStartIndex+y.lineLength,Oe=H(X,E,fe,Ie,o,F,B,y,C,_,q,ee,ne);if(!Oe)return{notEnoughRoom:!0};const We=Er(Oe.first.point,S,ne).point,He=Er(Oe.last.point,S,ne).point;if(h&&!o){const st=Q(y.writingMode,We,He,ie);if(st)return st}le=[Oe.first];for(let st=y.glyphStartIndex+1;st<we-1;st++)le.push(qe(X*E.getoffsetX(st),fe,Ie,o,F,B,y.segment,Ae,ke,C,_,q,ee,ne));le.push(Oe.last)}else{if(h&&!o){const Ae=Er(B,p,ne).point,ke=y.lineStartIndex+y.segment+1,Oe=new l.P(C.getx(ke),C.gety(ke)),We=Er(Oe,p,ne),He=We.signedDistanceFromCamera>0?We.point:ve(B,Oe,Ae,1,p,ne),st=Q(y.writingMode,Ae,He,ie);if(st)return st}const we=qe(X*E.getoffsetX(y.glyphStartIndex),fe,Ie,o,F,B,y.segment,y.lineStartIndex,y.lineStartIndex+y.lineLength,C,_,q,ee,ne);if(!we)return{notEnoughRoom:!0};le=[we]}for(const we of le)l.aj(k,we.point,we.angle);return{}}function ve(y,i,o,h,p,_){const S=Er(y.add(y.sub(i)._unit()),p,_).point,E=o.sub(S);return o.add(E._mult(h/E.mag()))}function Me(y,i){const{projectionCache:o,lineVertexArray:h,labelPlaneMatrix:p,tileAnchorPoint:_,distanceFromAnchor:S,getElevation:E,previousVertex:C,direction:k,absOffsetX:F}=i;if(o.projections[y])return o.projections[y];const B=new l.P(h.getx(y),h.gety(y)),q=Er(B,p,E);if(q.signedDistanceFromCamera>0)return o.projections[y]=q.point,q.point;const ie=y-k;return ve(S===0?_:new l.P(h.getx(ie),h.gety(ie)),B,C,F-S+1,p,E)}function de(y,i,o){return y._unit()._perp()._mult(i*o)}function Ce(y,i,o,h,p,_,S,E){const{projectionCache:C,direction:k}=E;if(C.offsets[y])return C.offsets[y];const F=o.add(i);if(y+k<h||y+k>=p)return C.offsets[y]=F,F;const B=Me(y+k,E),q=de(B.sub(o),S,k),ie=o.add(q),ee=B.add(q);return C.offsets[y]=l.ak(_,F,ie,ee)||F,C.offsets[y]}function qe(y,i,o,h,p,_,S,E,C,k,F,B,q,ie){const ee=h?y-i:y+i;let ne=ee>0?1:-1,X=0;h&&(ne*=-1,X=Math.PI),ne<0&&(X+=Math.PI);let fe,Ie,le=ne>0?E+S:E+S+1,we=p,Ae=p,ke=0,Oe=0;const We=Math.abs(ee),He=[];let st;for(;ke+Oe<=We;){if(le+=ne,le<E||le>=C)return null;ke+=Oe,Ae=we,Ie=fe;const yt={projectionCache:B,lineVertexArray:k,labelPlaneMatrix:F,tileAnchorPoint:_,distanceFromAnchor:ke,getElevation:ie,previousVertex:Ae,direction:ne,absOffsetX:We};if(we=Me(le,yt),o===0)He.push(Ae),st=we.sub(Ae);else{let ei;const pi=we.sub(Ae);ei=pi.mag()===0?de(Me(le+ne,yt).sub(we),o,ne):de(pi,o,ne),Ie||(Ie=Ae.add(ei)),fe=Ce(le,ei,we,E,C,Ie,o,yt),He.push(Ie),st=fe.sub(Ie)}Oe=st.mag()}const ht=st._mult((We-ke)/Oe)._add(Ie||Ae),di=X+Math.atan2(we.y-Ae.y,we.x-Ae.x);return He.push(ht),{point:ht,angle:q?di:0,path:He}}const ze=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ne(y,i){for(let o=0;o<y;o++){const h=i.length;i.resize(h+4),i.float32.set(ze,3*h)}}function $t(y,i,o){const h=i[0],p=i[1];return y[0]=o[0]*h+o[4]*p+o[12],y[1]=o[1]*h+o[5]*p+o[13],y[3]=o[3]*h+o[7]*p+o[15],y}const Gt=100;class ni{constructor(i,o=new yn(i.width+200,i.height+200,25),h=new yn(i.width+200,i.height+200,25)){this.transform=i,this.grid=o,this.ignoredGrid=h,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Gt,this.screenBottomBoundary=i.height+Gt,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(i,o,h,p,_,S){const E=this.projectAndGetPerspectiveRatio(p,i.anchorPointX,i.anchorPointY,S),C=h*E.perspectiveRatio,k=i.x1*C+E.point.x,F=i.y1*C+E.point.y,B=i.x2*C+E.point.x,q=i.y2*C+E.point.y;return!this.isInsideGrid(k,F,B,q)||o!=="always"&&this.grid.hitTest(k,F,B,q,o,_)||E.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[k,F,B,q],offscreen:this.isOffscreen(k,F,B,q)}}placeCollisionCircles(i,o,h,p,_,S,E,C,k,F,B,q,ie,ee){const ne=[],X=new l.P(o.anchorX,o.anchorY),fe=Er(X,S,ee),Ie=te(this.transform.cameraToCenterDistance,fe.signedDistanceFromCamera),le=(F?_/Ie:_*Ie)/l.ao,we=Er(X,E,ee).point,Ae=H(le,p,o.lineOffsetX*le,o.lineOffsetY*le,!1,we,X,o,h,E,{projections:{},offsets:{}},!1,ee);let ke=!1,Oe=!1,We=!0;if(Ae){const He=.5*q*Ie+ie,st=new l.P(-100,-100),ht=new l.P(this.screenRightBoundary,this.screenBottomBoundary),di=new Nt,yt=Ae.first,ei=Ae.last;let pi=[];for(let mi=yt.path.length-1;mi>=1;mi--)pi.push(yt.path[mi]);for(let mi=1;mi<ei.path.length;mi++)pi.push(ei.path[mi]);const Li=2.5*He;if(C){const mi=pi.map(bi=>Er(bi,C,ee));pi=mi.some(bi=>bi.signedDistanceFromCamera<=0)?[]:mi.map(bi=>bi.point)}let ai=[];if(pi.length>0){const mi=pi[0].clone(),bi=pi[0].clone();for(let Or=1;Or<pi.length;Or++)mi.x=Math.min(mi.x,pi[Or].x),mi.y=Math.min(mi.y,pi[Or].y),bi.x=Math.max(bi.x,pi[Or].x),bi.y=Math.max(bi.y,pi[Or].y);ai=mi.x>=st.x&&bi.x<=ht.x&&mi.y>=st.y&&bi.y<=ht.y?[pi]:bi.x<st.x||mi.x>ht.x||bi.y<st.y||mi.y>ht.y?[]:l.al([pi],st.x,st.y,ht.x,ht.y)}for(const mi of ai){di.reset(mi,.25*He);let bi=0;bi=di.length<=.5*He?1:Math.ceil(di.paddedLength/Li)+1;for(let Or=0;Or<bi;Or++){const Qi=Or/Math.max(bi-1,1),cs=di.lerp(Qi),rn=cs.x+Gt,Ir=cs.y+Gt;ne.push(rn,Ir,He,0);const nn=rn-He,us=Ir-He,oa=rn+He,Za=Ir+He;if(We=We&&this.isOffscreen(nn,us,oa,Za),Oe=Oe||this.isInsideGrid(nn,us,oa,Za),i!=="always"&&this.grid.hitTestCircle(rn,Ir,He,i,B)&&(ke=!0,!k))return{circles:[],offscreen:!1,collisionDetected:ke}}}}return{circles:!k&&ke||!Oe||Ie<this.perspectiveRatioCutoff?[]:ne,offscreen:We,collisionDetected:ke}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let h=1/0,p=1/0,_=-1/0,S=-1/0;for(const F of i){const B=new l.P(F.x+Gt,F.y+Gt);h=Math.min(h,B.x),p=Math.min(p,B.y),_=Math.max(_,B.x),S=Math.max(S,B.y),o.push(B)}const E=this.grid.query(h,p,_,S).concat(this.ignoredGrid.query(h,p,_,S)),C={},k={};for(const F of E){const B=F.key;if(C[B.bucketInstanceId]===void 0&&(C[B.bucketInstanceId]={}),C[B.bucketInstanceId][B.featureIndex])continue;const q=[new l.P(F.x1,F.y1),new l.P(F.x2,F.y1),new l.P(F.x2,F.y2),new l.P(F.x1,F.y2)];l.am(o,q)&&(C[B.bucketInstanceId][B.featureIndex]=!0,k[B.bucketInstanceId]===void 0&&(k[B.bucketInstanceId]=[]),k[B.bucketInstanceId].push(B.featureIndex))}return k}insertCollisionBox(i,o,h,p,_,S){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:_,collisionGroupID:S,overlapMode:o},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,o,h,p,_,S){const E=h?this.ignoredGrid:this.grid,C={bucketInstanceId:p,featureIndex:_,collisionGroupID:S,overlapMode:o};for(let k=0;k<i.length;k+=4)E.insertCircle(C,i[k],i[k+1],i[k+2])}projectAndGetPerspectiveRatio(i,o,h,p){let _;return p?(_=[o,h,p(o,h),1],l.af(_,_,i)):(_=[o,h,0,1],$t(_,_,i)),{point:new l.P((_[0]/_[3]+1)/2*this.transform.width+Gt,(-_[1]/_[3]+1)/2*this.transform.height+Gt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/_[3]*.5}}isOffscreen(i,o,h,p){return h<Gt||i>=this.screenRightBoundary||p<Gt||o>this.screenBottomBoundary}isInsideGrid(i,o,h,p){return h>=0&&i<this.gridRightBoundary&&p>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const i=l.an([]);return l.H(i,i,[-100,-100,0]),i}}function si(y,i,o){return i*(l.W/(y.tileSize*Math.pow(2,o-y.tileID.overscaledZ)))}class vi{constructor(i,o,h,p){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?o:-o))):p&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class Ui{constructor(i,o,h,p,_){this.text=new vi(i?i.text:null,o,h,_),this.icon=new vi(i?i.icon:null,o,p,_)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class lr{constructor(i,o,h){this.text=i,this.icon=o,this.skipFade=h}}class Br{constructor(){this.invProjMatrix=l.F(),this.viewportMatrix=l.F(),this.circles=[]}}class Kt{constructor(i,o,h,p,_){this.bucketInstanceId=i,this.featureIndex=o,this.sourceLayerIndex=h,this.bucketIndex=p,this.tileID=_}}class _r{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const o=++this.maxGroupID;this.collisionGroups[i]={ID:o,predicate:h=>h.collisionGroupID===o}}return this.collisionGroups[i]}}function Vr(y,i,o,h,p){const{horizontalAlign:_,verticalAlign:S}=l.at(y);return new l.P(-(_-.5)*i+h[0]*p,-(S-.5)*o+h[1]*p)}function _n(y,i,o,h,p,_){const{x1:S,x2:E,y1:C,y2:k,anchorPointX:F,anchorPointY:B}=y,q=new l.P(i,o);return h&&q._rotate(p?_:-_),{x1:S+q.x,y1:C+q.y,x2:E+q.x,y2:k+q.y,anchorPointX:F,anchorPointY:B}}class vn{constructor(i,o,h,p,_){this.transform=i.clone(),this.terrain=o,this.collisionIndex=new ni(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new _r(p),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,o,h,p){const _=h.getBucket(o),S=h.latestFeatureIndex;if(!_||!S||o.id!==_.layerIds[0])return;const E=h.collisionBoxArray,C=_.layers[0].layout,k=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),F=h.tileSize/l.W,B=this.transform.calculatePosMatrix(h.tileID.toUnwrapped()),q=C.get("text-pitch-alignment")==="map",ie=C.get("text-rotation-alignment")==="map",ee=si(h,1,this.transform.zoom),ne=ri(B,q,ie,this.transform,ee);let X=null;if(q){const Ie=ea(B,q,ie,this.transform,ee);X=l.K([],this.transform.labelPlaneMatrix,Ie)}this.retainedQueryData[_.bucketInstanceId]=new Kt(_.bucketInstanceId,S,_.sourceLayerIndex,_.index,h.tileID);const fe={bucket:_,layout:C,posMatrix:B,textLabelPlaneMatrix:ne,labelToScreenMatrix:X,scale:k,textPixelRatio:F,holdingForFade:h.holdingForFade(),collisionBoxArray:E,partiallyEvaluatedTextSize:l.ag(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(p)for(const Ie of _.sortKeyRanges){const{sortKey:le,symbolInstanceStart:we,symbolInstanceEnd:Ae}=Ie;i.push({sortKey:le,symbolInstanceStart:we,symbolInstanceEnd:Ae,parameters:fe})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:fe})}attemptAnchorPlacement(i,o,h,p,_,S,E,C,k,F,B,q,ie,ee,ne,X){const fe=l.ap[i.textAnchor],Ie=[i.textOffset0,i.textOffset1],le=Vr(fe,h,p,Ie,_),we=this.collisionIndex.placeCollisionBox(_n(o,le.x,le.y,S,E,this.transform.angle),B,C,k,F.predicate,X);if((!ne||this.collisionIndex.placeCollisionBox(_n(ne,le.x,le.y,S,E,this.transform.angle),B,C,k,F.predicate,X).box.length!==0)&&we.box.length>0){let Ae;if(this.prevPlacement&&this.prevPlacement.variableOffsets[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID].text&&(Ae=this.prevPlacement.variableOffsets[q.crossTileID].anchor),q.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[q.crossTileID]={textOffset:Ie,width:h,height:p,anchor:fe,textBoxScale:_,prevAnchor:Ae},this.markUsedJustification(ie,fe,q,ee),ie.allowVerticalPlacement&&(this.markUsedOrientation(ie,ee,q),this.placedOrientations[q.crossTileID]=ee),{shift:le,placedGlyphBoxes:we}}}placeLayerBucketPart(i,o,h){const{bucket:p,layout:_,posMatrix:S,textLabelPlaneMatrix:E,labelToScreenMatrix:C,textPixelRatio:k,holdingForFade:F,collisionBoxArray:B,partiallyEvaluatedTextSize:q,collisionGroup:ie}=i.parameters,ee=_.get("text-optional"),ne=_.get("icon-optional"),X=l.aq(_,"text-overlap","text-allow-overlap"),fe=X==="always",Ie=l.aq(_,"icon-overlap","icon-allow-overlap"),le=Ie==="always",we=_.get("text-rotation-alignment")==="map",Ae=_.get("text-pitch-alignment")==="map",ke=_.get("icon-text-fit")!=="none",Oe=_.get("symbol-z-order")==="viewport-y",We=fe&&(le||!p.hasIconData()||ne),He=le&&(fe||!p.hasTextData()||ee);!p.collisionArrays&&B&&p.deserializeCollisionBoxes(B);const st=this.retainedQueryData[p.bucketInstanceId].tileID,ht=this.terrain?(yt,ei)=>this.terrain.getElevation(st,yt,ei):null,di=(yt,ei)=>{var pi,Li;if(o[yt.crossTileID])return;if(F)return void(this.placements[yt.crossTileID]=new lr(!1,!1,!1));let ai=!1,mi=!1,bi=!0,Or=null,Qi={box:null,offscreen:null},cs={box:null,offscreen:null},rn=null,Ir=null,nn=null,us=0,oa=0,Za=0;ei.textFeatureIndex?us=ei.textFeatureIndex:yt.useRuntimeCollisionCircles&&(us=yt.featureIndex),ei.verticalTextFeatureIndex&&(oa=ei.verticalTextFeatureIndex);const Kl=ei.textBox;if(Kl){const Wr=Xr=>{let Pr=l.ah.horizontal;if(p.allowVerticalPlacement&&!Xr&&this.prevPlacement){const Cs=this.prevPlacement.placedOrientations[yt.crossTileID];Cs&&(this.placedOrientations[yt.crossTileID]=Cs,Pr=Cs,this.markUsedOrientation(p,Pr,yt))}return Pr},Ar=(Xr,Pr)=>{if(p.allowVerticalPlacement&&yt.numVerticalGlyphVertices>0&&ei.verticalTextBox){for(const Cs of p.writingModes)if(Cs===l.ah.vertical?(Qi=Pr(),cs=Qi):Qi=Xr(),Qi&&Qi.box&&Qi.box.length)break}else Qi=Xr()},br=yt.textAnchorOffsetStartIndex,Ts=yt.textAnchorOffsetEndIndex;if(Ts===br){const Xr=(Pr,Cs)=>{const Kr=this.collisionIndex.placeCollisionBox(Pr,X,k,S,ie.predicate,ht);return Kr&&Kr.box&&Kr.box.length&&(this.markUsedOrientation(p,Cs,yt),this.placedOrientations[yt.crossTileID]=Cs),Kr};Ar(()=>Xr(Kl,l.ah.horizontal),()=>{const Pr=ei.verticalTextBox;return p.allowVerticalPlacement&&yt.numVerticalGlyphVertices>0&&Pr?Xr(Pr,l.ah.vertical):{box:null,offscreen:null}}),Wr(Qi&&Qi.box&&Qi.box.length)}else{let Xr=l.ap[(Li=(pi=this.prevPlacement)===null||pi===void 0?void 0:pi.variableOffsets[yt.crossTileID])===null||Li===void 0?void 0:Li.anchor];const Pr=(Kr,$r,Lu)=>{const ad=Kr.x2-Kr.x1,wo=Kr.y2-Kr.y1,Mo=yt.textBoxScale,Dc=ke&&Ie==="never"?$r:null;let Xa={box:[],offscreen:!1},Ru=X==="never"?1:2,od="never";Xr&&Ru++;for(let zu=0;zu<Ru;zu++){for(let Ou=br;Ou<Ts;Ou++){const kc=p.textAnchorOffsets.get(Ou);if(Xr&&kc.textAnchor!==Xr)continue;const Fu=this.attemptAnchorPlacement(kc,Kr,ad,wo,Mo,we,Ae,k,S,ie,od,yt,p,Lu,Dc,ht);if(Fu&&(Xa=Fu.placedGlyphBoxes,Xa&&Xa.box&&Xa.box.length))return ai=!0,Or=Fu.shift,Xa}Xr?Xr=null:od=X}return Xa};Ar(()=>Pr(Kl,ei.iconBox,l.ah.horizontal),()=>{const Kr=ei.verticalTextBox;return p.allowVerticalPlacement&&!(Qi&&Qi.box&&Qi.box.length)&&yt.numVerticalGlyphVertices>0&&Kr?Pr(Kr,ei.verticalIconBox,l.ah.vertical):{box:null,offscreen:null}}),Qi&&(ai=Qi.box,bi=Qi.offscreen);const Cs=Wr(Qi&&Qi.box);if(!ai&&this.prevPlacement){const Kr=this.prevPlacement.variableOffsets[yt.crossTileID];Kr&&(this.variableOffsets[yt.crossTileID]=Kr,this.markUsedJustification(p,Kr.anchor,yt,Cs))}}}if(rn=Qi,ai=rn&&rn.box&&rn.box.length>0,bi=rn&&rn.offscreen,yt.useRuntimeCollisionCircles){const Wr=p.text.placedSymbolArray.get(yt.centerJustifiedTextSymbolIndex),Ar=l.ai(p.textSizeData,q,Wr),br=_.get("text-padding");Ir=this.collisionIndex.placeCollisionCircles(X,Wr,p.lineVertexArray,p.glyphOffsetArray,Ar,S,E,C,h,Ae,ie.predicate,yt.collisionCircleDiameter,br,ht),Ir.circles.length&&Ir.collisionDetected&&!h&&l.w("Collisions detected, but collision boxes are not shown"),ai=fe||Ir.circles.length>0&&!Ir.collisionDetected,bi=bi&&Ir.offscreen}if(ei.iconFeatureIndex&&(Za=ei.iconFeatureIndex),ei.iconBox){const Wr=Ar=>{const br=ke&&Or?_n(Ar,Or.x,Or.y,we,Ae,this.transform.angle):Ar;return this.collisionIndex.placeCollisionBox(br,Ie,k,S,ie.predicate,ht)};cs&&cs.box&&cs.box.length&&ei.verticalIconBox?(nn=Wr(ei.verticalIconBox),mi=nn.box.length>0):(nn=Wr(ei.iconBox),mi=nn.box.length>0),bi=bi&&nn.offscreen}const Wa=ee||yt.numHorizontalGlyphVertices===0&&yt.numVerticalGlyphVertices===0,la=ne||yt.numIconVertices===0;if(Wa||la?la?Wa||(mi=mi&&ai):ai=mi&&ai:mi=ai=mi&&ai,ai&&rn&&rn.box&&this.collisionIndex.insertCollisionBox(rn.box,X,_.get("text-ignore-placement"),p.bucketInstanceId,cs&&cs.box&&oa?oa:us,ie.ID),mi&&nn&&this.collisionIndex.insertCollisionBox(nn.box,Ie,_.get("icon-ignore-placement"),p.bucketInstanceId,Za,ie.ID),Ir&&(ai&&this.collisionIndex.insertCollisionCircles(Ir.circles,X,_.get("text-ignore-placement"),p.bucketInstanceId,us,ie.ID),h)){const Wr=p.bucketInstanceId;let Ar=this.collisionCircleArrays[Wr];Ar===void 0&&(Ar=this.collisionCircleArrays[Wr]=new Br);for(let br=0;br<Ir.circles.length;br+=4)Ar.circles.push(Ir.circles[br+0]),Ar.circles.push(Ir.circles[br+1]),Ar.circles.push(Ir.circles[br+2]),Ar.circles.push(Ir.collisionDetected?1:0)}if(yt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(p.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[yt.crossTileID]=new lr(ai||We,mi||He,bi||p.justReloaded),o[yt.crossTileID]=!0};if(Oe){if(i.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const yt=p.getSortedSymbolIndexes(this.transform.angle);for(let ei=yt.length-1;ei>=0;--ei){const pi=yt[ei];di(p.symbolInstances.get(pi),p.collisionArrays[pi])}}else for(let yt=i.symbolInstanceStart;yt<i.symbolInstanceEnd;yt++)di(p.symbolInstances.get(yt),p.collisionArrays[yt]);if(h&&p.bucketInstanceId in this.collisionCircleArrays){const yt=this.collisionCircleArrays[p.bucketInstanceId];l.ar(yt.invProjMatrix,S),yt.viewportMatrix=this.collisionIndex.getViewportMatrix()}p.justReloaded=!1}markUsedJustification(i,o,h,p){let _;_=p===l.ah.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[l.as(o)];const S=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];for(const E of S)E>=0&&(i.text.placedSymbolArray.get(E).crossTileID=_>=0&&E!==_?0:h.crossTileID)}markUsedOrientation(i,o,h){const p=o===l.ah.horizontal||o===l.ah.horizontalOnly?o:0,_=o===l.ah.vertical?o:0,S=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];for(const E of S)i.text.placedSymbolArray.get(E).placedOrientation=p;h.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let h=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const p=o?o.symbolFadeChange(i):1,_=o?o.opacities:{},S=o?o.variableOffsets:{},E=o?o.placedOrientations:{};for(const C in this.placements){const k=this.placements[C],F=_[C];F?(this.opacities[C]=new Ui(F,p,k.text,k.icon),h=h||k.text!==F.text.placed||k.icon!==F.icon.placed):(this.opacities[C]=new Ui(null,p,k.text,k.icon,k.skipFade),h=h||k.text||k.icon)}for(const C in _){const k=_[C];if(!this.opacities[C]){const F=new Ui(k,p,!1,!1);F.isHidden()||(this.opacities[C]=F,h=h||k.text.placed||k.icon.placed)}}for(const C in S)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=S[C]);for(const C in E)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=E[C]);if(o&&o.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");h?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:i)}updateLayerOpacities(i,o){const h={};for(const p of o){const _=p.getBucket(i);_&&p.latestFeatureIndex&&i.id===_.layerIds[0]&&this.updateBucketOpacities(_,h,p.collisionBoxArray)}}updateBucketOpacities(i,o,h){i.hasTextData()&&(i.text.opacityVertexArray.clear(),i.text.hasVisibleVertices=!1),i.hasIconData()&&(i.icon.opacityVertexArray.clear(),i.icon.hasVisibleVertices=!1),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const p=i.layers[0],_=p.layout,S=new Ui(null,0,!1,!1,!0),E=_.get("text-allow-overlap"),C=_.get("icon-allow-overlap"),k=p._unevaluatedLayout.hasValue("text-variable-anchor")||p._unevaluatedLayout.hasValue("text-variable-anchor-offset"),F=_.get("text-rotation-alignment")==="map",B=_.get("text-pitch-alignment")==="map",q=_.get("icon-text-fit")!=="none",ie=new Ui(null,0,E&&(C||!i.hasIconData()||_.get("icon-optional")),C&&(E||!i.hasTextData()||_.get("text-optional")),!0);!i.collisionArrays&&h&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(h);const ee=(ne,X,fe)=>{for(let Ie=0;Ie<X/4;Ie++)ne.opacityVertexArray.emplaceBack(fe);ne.hasVisibleVertices=ne.hasVisibleVertices||fe!==Gn};for(let ne=0;ne<i.symbolInstances.length;ne++){const X=i.symbolInstances.get(ne),{numHorizontalGlyphVertices:fe,numVerticalGlyphVertices:Ie,crossTileID:le}=X;let we=this.opacities[le];o[le]?we=S:we||(we=ie,this.opacities[le]=we),o[le]=!0;const Ae=X.numIconVertices>0,ke=this.placedOrientations[X.crossTileID],Oe=ke===l.ah.vertical,We=ke===l.ah.horizontal||ke===l.ah.horizontalOnly;if(fe>0||Ie>0){const He=xn(we.text);ee(i.text,fe,Oe?Gn:He),ee(i.text,Ie,We?Gn:He);const st=we.text.isHidden();[X.rightJustifiedTextSymbolIndex,X.centerJustifiedTextSymbolIndex,X.leftJustifiedTextSymbolIndex].forEach(yt=>{yt>=0&&(i.text.placedSymbolArray.get(yt).hidden=st||Oe?1:0)}),X.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(X.verticalPlacedTextSymbolIndex).hidden=st||We?1:0);const ht=this.variableOffsets[X.crossTileID];ht&&this.markUsedJustification(i,ht.anchor,X,ke);const di=this.placedOrientations[X.crossTileID];di&&(this.markUsedJustification(i,"left",X,di),this.markUsedOrientation(i,di,X))}if(Ae){const He=xn(we.icon),st=!(q&&X.verticalPlacedIconSymbolIndex&&Oe);X.placedIconSymbolIndex>=0&&(ee(i.icon,X.numIconVertices,st?He:Gn),i.icon.placedSymbolArray.get(X.placedIconSymbolIndex).hidden=we.icon.isHidden()),X.verticalPlacedIconSymbolIndex>=0&&(ee(i.icon,X.numVerticalIconVertices,st?Gn:He),i.icon.placedSymbolArray.get(X.verticalPlacedIconSymbolIndex).hidden=we.icon.isHidden())}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const He=i.collisionArrays[ne];if(He){let st=new l.P(0,0);if(He.textBox||He.verticalTextBox){let di=!0;if(k){const yt=this.variableOffsets[le];yt?(st=Vr(yt.anchor,yt.width,yt.height,yt.textOffset,yt.textBoxScale),F&&st._rotate(B?this.transform.angle:-this.transform.angle)):di=!1}He.textBox&&Zr(i.textCollisionBox.collisionVertexArray,we.text.placed,!di||Oe,st.x,st.y),He.verticalTextBox&&Zr(i.textCollisionBox.collisionVertexArray,we.text.placed,!di||We,st.x,st.y)}const ht=!!(!We&&He.verticalIconBox);He.iconBox&&Zr(i.iconCollisionBox.collisionVertexArray,we.icon.placed,ht,q?st.x:0,q?st.y:0),He.verticalIconBox&&Zr(i.iconCollisionBox.collisionVertexArray,we.icon.placed,!ht,q?st.x:0,q?st.y:0)}}}if(i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.text.opacityVertexArray.length!==i.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${i.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${i.text.layoutVertexArray.length}) / 4`);if(i.icon.opacityVertexArray.length!==i.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${i.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${i.icon.layoutVertexArray.length}) / 4`);if(i.bucketInstanceId in this.collisionCircleArrays){const ne=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=ne.invProjMatrix,i.placementViewportMatrix=ne.viewportMatrix,i.collisionCircleArray=ne.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,o){const h=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*h>i}setStale(){this.stale=!0}}function Zr(y,i,o,h,p){y.emplaceBack(i?1:0,o?1:0,h||0,p||0),y.emplaceBack(i?1:0,o?1:0,h||0,p||0),y.emplaceBack(i?1:0,o?1:0,h||0,p||0),y.emplaceBack(i?1:0,o?1:0,h||0,p||0)}const qn=Math.pow(2,25),fc=Math.pow(2,24),zo=Math.pow(2,17),Vi=Math.pow(2,16),lo=Math.pow(2,9),Dr=Math.pow(2,8),Dn=Math.pow(2,1);function xn(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const i=y.placed?1:0,o=Math.floor(127*y.opacity);return o*qn+i*fc+o*zo+i*Vi+o*lo+i*Dr+o*Dn+i}const Gn=0;class kr{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&!i.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,o,h,p,_){const S=this._bucketParts;for(;this._currentTileIndex<i.length;)if(o.getBucketParts(S,p,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((E,C)=>E.sortKey-C.sortKey));this._currentPartIndex<S.length;)if(o.placeLayerBucketPart(S[this._currentPartIndex],this._seenCrossTileIDs,h),this._currentPartIndex++,_())return!0;return!1}}class bn{constructor(i,o,h,p,_,S,E,C){this.placement=new vn(i,o,S,E,C),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(i,o,h){const p=D.now(),_=()=>!this._forceFullPlacement&&D.now()-p>2;for(;this._currentPlacementIndex>=0;){const S=o[i[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&(!S.minzoom||S.minzoom<=E)&&(!S.maxzoom||S.maxzoom>E)){if(this._inProgressLayer||(this._inProgressLayer=new kr(S)),this._inProgressLayer.continuePlacement(h[S.source],this.placement,this._showCollisionBoxes,S,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const Hn=512/l.W/2;class vs{constructor(i,o,h){this.tileID=i,this.bucketInstanceId=h,this._symbolsByKey={};const p=new Map;for(let _=0;_<o.length;_++){const S=o.get(_),E=S.key,C=p.get(E);C?C.push(S):p.set(E,[S])}for(const[_,S]of p){const E={positions:S.map(C=>({x:Math.floor(C.anchorX*Hn),y:Math.floor(C.anchorY*Hn)})),crossTileIDs:S.map(C=>C.crossTileID)};if(E.positions.length>128){const C=new l.au(E.positions.length,16,Uint16Array);for(const{x:k,y:F}of E.positions)C.add(k,F);C.finish(),delete E.positions,E.index=C}this._symbolsByKey[_]=E}}getScaledCoordinates(i,o){const{x:h,y:p,z:_}=this.tileID.canonical,{x:S,y:E,z:C}=o.canonical,k=Hn/Math.pow(2,C-_),F=(E*l.W+i.anchorY)*k,B=p*l.W*Hn;return{x:Math.floor((S*l.W+i.anchorX)*k-h*l.W*Hn),y:Math.floor(F-B)}}findMatches(i,o,h){const p=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z);for(let _=0;_<i.length;_++){const S=i.get(_);if(S.crossTileID)continue;const E=this._symbolsByKey[S.key];if(!E)continue;const C=this.getScaledCoordinates(S,o);if(E.index){const k=E.index.range(C.x-p,C.y-p,C.x+p,C.y+p).sort();for(const F of k){const B=E.crossTileIDs[F];if(!h[B]){h[B]=!0,S.crossTileID=B;break}}}else if(E.positions)for(let k=0;k<E.positions.length;k++){const F=E.positions[k],B=E.crossTileIDs[k];if(Math.abs(F.x-C.x)<=p&&Math.abs(F.y-C.y)<=p&&!h[B]){h[B]=!0,S.crossTileID=B;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:i})=>i)}}class Lr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class co{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const o=Math.round((i-this.lng)/360);if(o!==0)for(const h in this.indexes){const p=this.indexes[h],_={};for(const S in p){const E=p[S];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+o),_[E.tileID.key]=E}this.indexes[h]=_}this.lng=i}addBucket(i,o,h){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let _=0;_<o.symbolInstances.length;_++)o.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const p=this.usedCrossTileIDs[i.overscaledZ];for(const _ in this.indexes){const S=this.indexes[_];if(Number(_)>i.overscaledZ)for(const E in S){const C=S[E];C.tileID.isChildOf(i)&&C.findMatches(o.symbolInstances,i,p)}else{const E=S[i.scaledTo(Number(_)).key];E&&E.findMatches(o.symbolInstances,i,p)}}for(let _=0;_<o.symbolInstances.length;_++){const S=o.symbolInstances.get(_);S.crossTileID||(S.crossTileID=h.generate(),p[S.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new vs(i,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(i,o){for(const h of o.getCrossTileIDsLists())for(const p of h)delete this.usedCrossTileIDs[i][p]}removeStaleBuckets(i){let o=!1;for(const h in this.indexes){const p=this.indexes[h];for(const _ in p)i[p[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,p[_]),delete p[_],o=!0)}return o}}class ta{constructor(){this.layerIndexes={},this.crossTileIDs=new Lr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,o,h){let p=this.layerIndexes[i.id];p===void 0&&(p=this.layerIndexes[i.id]=new co);let _=!1;const S={};p.handleWrapJump(h);for(const E of o){const C=E.getBucket(i);C&&i.id===C.layerIds[0]&&(C.bucketInstanceId||(C.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(E.tileID,C,this.crossTileIDs)&&(_=!0),S[C.bucketInstanceId]=!0)}return p.removeStaleBuckets(S)&&(_=!0),_}pruneUnusedLayers(i){const o={};i.forEach(h=>{o[h]=!0});for(const h in this.layerIndexes)o[h]||delete this.layerIndexes[h]}}const dr=(y,i)=>l.t(y,i&&i.filter(o=>o.identifier!=="source.canvas")),uo=l.av();class wn extends l.E{constructor(i,o={}){super(),this._rtlPluginLoaded=()=>{for(const h in this.sourceCaches){const p=this.sourceCaches[h].getSource().type;p!=="vector"&&p!=="geojson"||this.sourceCaches[h].reload()}},this.map=i,this.dispatcher=new Et(Ve(),i._getMapId()),this.dispatcher.registerMessageHandler("GG",(h,p)=>this.getGlyphs(h,p)),this.dispatcher.registerMessageHandler("GI",(h,p)=>this.getImages(h,p)),this.imageManager=new ct,this.imageManager.setEventedParent(this),this.glyphManager=new ii(i._requestManager,o.localIdeographFontFamily),this.lineAtlas=new at(256,512),this.crossTileSymbolIndex=new ta,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",l.ax()),Ue().on(Yt,this._rtlPluginLoaded),this.on("data",h=>{if(h.dataType!=="source"||h.sourceDataType!=="metadata")return;const p=this.sourceCaches[h.sourceId];if(!p)return;const _=p.getSource();if(_&&_.vectorLayerIds)for(const S in this._layers){const E=this._layers[S];E.source===_.id&&this._validateLayer(E)}})}loadURL(i,o={},h){this.fire(new l.k("dataloading",{dataType:"style"})),o.validate=typeof o.validate!="boolean"||o.validate;const p=this.map._requestManager.transformRequest(i,"Style");this._loadStyleRequest=new AbortController,l.h(p,this._loadStyleRequest).then(_=>{this._loadStyleRequest=null,this._load(_.data,o,h)}).catch(_=>{this._loadStyleRequest=null,_&&this.fire(new l.j(_))})}loadJSON(i,o={},h){this.fire(new l.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,D.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,o.validate=o.validate!==!1,this._load(i,o,h)}).catch(()=>{})}loadEmpty(){this.fire(new l.k("dataloading",{dataType:"style"})),this._load(uo,{validate:!1})}_load(i,o,h){var p;const _=o.transformStyle?o.transformStyle(h,i):i;if(!o.validate||!dr(this,l.x(_))){this._loaded=!0,this.stylesheet=_;for(const S in _.sources)this.addSource(S,_.sources[S],{validate:!1});_.sprite?this._loadSprite(_.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(_.glyphs),this._createLayers(),this.light=new yr(this.stylesheet.light),this.map.setTerrain((p=this.stylesheet.terrain)!==null&&p!==void 0?p:null),this.fire(new l.k("data",{dataType:"style"})),this.fire(new l.k("style.load"))}}_createLayers(){const i=l.ay(this.stylesheet.layers);this.dispatcher.broadcast("SL",i),this._order=i.map(o=>o.id),this._layers={},this._serializedLayers=null;for(const o of i){const h=l.az(o);h.setEventedParent(this,{layer:{id:o.id}}),this._layers[o.id]=h}}_loadSprite(i,o=!1,h=void 0){let p;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(_,S,E,C){return l._(this,void 0,void 0,function*(){const k=Ht(_),F=E>1?"@2x":"",B={},q={};for(const{id:ie,url:ee}of k){const ne=S.transformRequest(S.normalizeSpriteURL(ee,F,".json"),"SpriteJSON");B[ie]=l.h(ne,C);const X=S.transformRequest(S.normalizeSpriteURL(ee,F,".png"),"SpriteImage");q[ie]=oe.getImage(X,C)}return yield Promise.all([...Object.values(B),...Object.values(q)]),function(ie,ee){return l._(this,void 0,void 0,function*(){const ne={};for(const X in ie){ne[X]={};const fe=D.getImageCanvasContext((yield ee[X]).data),Ie=(yield ie[X]).data;for(const le in Ie){const{width:we,height:Ae,x:ke,y:Oe,sdf:We,pixelRatio:He,stretchX:st,stretchY:ht,content:di}=Ie[le];ne[X][le]={data:null,pixelRatio:He,sdf:We,stretchX:st,stretchY:ht,content:di,spriteData:{width:we,height:Ae,x:ke,y:Oe,context:fe}}}}return ne})}(B,q)})}(i,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(_=>{if(this._spriteRequest=null,_)for(const S in _){this._spritesImagesIds[S]=[];const E=this._spritesImagesIds[S]?this._spritesImagesIds[S].filter(C=>!(C in _)):[];for(const C of E)this.imageManager.removeImage(C),this._changedImages[C]=!0;for(const C in _[S]){const k=S==="default"?C:`${S}:${C}`;this._spritesImagesIds[S].push(k),k in this.imageManager.images?this.imageManager.updateImage(k,_[S][C],!1):this.imageManager.addImage(k,_[S][C]),o&&(this._changedImages[k]=!0)}}}).catch(_=>{this._spriteRequest=null,p=_,this.fire(new l.j(p))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),o&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"})),h&&h(p)})}_unloadSprite(){for(const i of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(i),this._changedImages[i]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}_validateLayer(i){const o=this.sourceCaches[i.source];if(!o)return;const h=i.sourceLayer;if(!h)return;const p=o.getSource();(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(h)===-1)&&this.fire(new l.j(new Error(`Source layer "${h}" does not exist on source "${p.id}" as specified by style layer "${i.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this.sourceCaches)if(!this.sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(i){const o=this._serializedAllLayers();if(!i||i.length===0)return Object.values(o);const h=[];for(const p of i)o[p]&&h.push(o[p]);return h}_serializedAllLayers(){let i=this._serializedLayers;if(i)return i;i=this._serializedLayers={};const o=Object.keys(this._layers);for(const h of o){const p=this._layers[h];p.type!=="custom"&&(i[h]=p.serialize())}return i}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const i in this.sourceCaches)if(this.sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(i){if(!this._loaded)return;const o=this._changed;if(o){const p=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(p.length||_.length)&&this._updateWorkerLayers(p,_);for(const S in this._updatedSources){const E=this._updatedSources[S];if(E==="reload")this._reloadSource(S);else{if(E!=="clear")throw new Error(`Invalid action ${E}`);this._clearSource(S)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const S in this._updatedPaintProps)this._layers[S].updateTransitions(i);this.light.updateTransitions(i),this._resetUpdates()}const h={};for(const p in this.sourceCaches){const _=this.sourceCaches[p];h[p]=_.used,_.used=!1}for(const p of this._order){const _=this._layers[p];_.recalculate(i,this._availableImages),!_.isHidden(i.zoom)&&_.source&&(this.sourceCaches[_.source].used=!0)}for(const p in h){const _=this.sourceCaches[p];!!h[p]!=!!_.used&&_.fire(new l.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:p}))}this.light.recalculate(i),this.z=i.zoom,o&&this.fire(new l.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const i in this.sourceCaches)this.sourceCaches[i].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(i,o){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(i),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(i,o={}){var h;this._checkLoaded();const p=this.serialize();if(i=o.transformStyle?o.transformStyle(p,i):i,((h=o.validate)===null||h===void 0||h)&&dr(this,l.x(i)))return!1;(i=l.aA(i)).layers=l.ay(i.layers);const _=l.aB(p,i),S=this._getOperationsToPerform(_);if(S.unimplemented.length>0)throw new Error(`Unimplemented: ${S.unimplemented.join(", ")}.`);if(S.operations.length===0)return!1;for(const E of S.operations)E();return this.stylesheet=i,this._serializedLayers=null,!0}_getOperationsToPerform(i){const o=[],h=[];for(const p of i)switch(p.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":o.push(()=>this.addLayer.apply(this,p.args));break;case"removeLayer":o.push(()=>this.removeLayer.apply(this,p.args));break;case"setPaintProperty":o.push(()=>this.setPaintProperty.apply(this,p.args));break;case"setLayoutProperty":o.push(()=>this.setLayoutProperty.apply(this,p.args));break;case"setFilter":o.push(()=>this.setFilter.apply(this,p.args));break;case"addSource":o.push(()=>this.addSource.apply(this,p.args));break;case"removeSource":o.push(()=>this.removeSource.apply(this,p.args));break;case"setLayerZoomRange":o.push(()=>this.setLayerZoomRange.apply(this,p.args));break;case"setLight":o.push(()=>this.setLight.apply(this,p.args));break;case"setGeoJSONSourceData":o.push(()=>this.setGeoJSONSourceData.apply(this,p.args));break;case"setGlyphs":o.push(()=>this.setGlyphs.apply(this,p.args));break;case"setSprite":o.push(()=>this.setSprite.apply(this,p.args));break;case"setTerrain":o.push(()=>this.map.setTerrain.apply(this,p.args));break;case"setTransition":o.push(()=>{});break;default:h.push(p.command)}return{operations:o,unimplemented:h}}addImage(i,o){if(this.getImage(i))return this.fire(new l.j(new Error(`An image named "${i}" already exists.`)));this.imageManager.addImage(i,o),this._afterImageUpdated(i)}updateImage(i,o){this.imageManager.updateImage(i,o)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){if(!this.getImage(i))return this.fire(new l.j(new Error(`An image named "${i}" does not exist.`)));this.imageManager.removeImage(i),this._afterImageUpdated(i)}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(i,o,h={}){if(this._checkLoaded(),this.sourceCaches[i]!==void 0)throw new Error(`Source "${i}" already exists.`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(l.x.source,`sources.${i}`,o,null,h))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const p=this.sourceCaches[i]=new Sr(i,o,this.dispatcher);p.style=this,p.setEventedParent(this,()=>({isSourceLoaded:p.loaded(),source:p.serialize(),sourceId:i})),p.onAdd(this.map),this._changed=!0}removeSource(i){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error("There is no source with this ID");for(const h in this._layers)if(this._layers[h].source===i)return this.fire(new l.j(new Error(`Source "${i}" cannot be removed while layer "${h}" is using it.`)));const o=this.sourceCaches[i];delete this.sourceCaches[i],delete this._updatedSources[i],o.fire(new l.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:i})),o.setEventedParent(null),o.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(i,o){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error(`There is no source with this ID=${i}`);const h=this.sourceCaches[i].getSource();if(h.type!=="geojson")throw new Error(`geojsonSource.type is ${h.type}, which is !== 'geojson`);h.setData(o),this._changed=!0}getSource(i){return this.sourceCaches[i]&&this.sourceCaches[i].getSource()}addLayer(i,o,h={}){this._checkLoaded();const p=i.id;if(this.getLayer(p))return void this.fire(new l.j(new Error(`Layer "${p}" already exists on this map.`)));let _;if(i.type==="custom"){if(dr(this,l.aC(i)))return;_=l.az(i)}else{if("source"in i&&typeof i.source=="object"&&(this.addSource(p,i.source),i=l.aA(i),i=l.e(i,{source:p})),this._validate(l.x.layer,`layers.${p}`,i,{arrayIndex:-1},h))return;_=l.az(i),this._validateLayer(_),_.setEventedParent(this,{layer:{id:p}})}const S=o?this._order.indexOf(o):this._order.length;if(o&&S===-1)this.fire(new l.j(new Error(`Cannot add layer "${p}" before non-existing layer "${o}".`)));else{if(this._order.splice(S,0,p),this._layerOrderChanged=!0,this._layers[p]=_,this._removedLayers[p]&&_.source&&_.type!=="custom"){const E=this._removedLayers[p];delete this._removedLayers[p],E.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",this.sourceCaches[_.source].pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map)}}moveLayer(i,o){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new l.j(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===o)return;const h=this._order.indexOf(i);this._order.splice(h,1);const p=o?this._order.indexOf(o):this._order.length;o&&p===-1?this.fire(new l.j(new Error(`Cannot move layer "${i}" before non-existing layer "${o}".`))):(this._order.splice(p,0,i),this._layerOrderChanged=!0)}removeLayer(i){this._checkLoaded();const o=this._layers[i];if(!o)return void this.fire(new l.j(new Error(`Cannot remove non-existing layer "${i}".`)));o.setEventedParent(null);const h=this._order.indexOf(i);this._order.splice(h,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=o,delete this._layers[i],this._serializedLayers&&delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],o.onRemove&&o.onRemove(this.map)}getLayer(i){return this._layers[i]}getLayersOrder(){return[...this._order]}hasLayer(i){return i in this._layers}setLayerZoomRange(i,o,h){this._checkLoaded();const p=this.getLayer(i);p?p.minzoom===o&&p.maxzoom===h||(o!=null&&(p.minzoom=o),h!=null&&(p.maxzoom=h),this._updateLayer(p)):this.fire(new l.j(new Error(`Cannot set the zoom range of non-existing layer "${i}".`)))}setFilter(i,o,h={}){this._checkLoaded();const p=this.getLayer(i);if(p){if(!l.aD(p.filter,o))return o==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(l.x.filter,`layers.${p.id}.filter`,o,null,h)||(p.filter=l.aA(o),this._updateLayer(p)))}else this.fire(new l.j(new Error(`Cannot filter non-existing layer "${i}".`)))}getFilter(i){return l.aA(this.getLayer(i).filter)}setLayoutProperty(i,o,h,p={}){this._checkLoaded();const _=this.getLayer(i);_?l.aD(_.getLayoutProperty(o),h)||(_.setLayoutProperty(o,h,p),this._updateLayer(_)):this.fire(new l.j(new Error(`Cannot style non-existing layer "${i}".`)))}getLayoutProperty(i,o){const h=this.getLayer(i);if(h)return h.getLayoutProperty(o);this.fire(new l.j(new Error(`Cannot get style of non-existing layer "${i}".`)))}setPaintProperty(i,o,h,p={}){this._checkLoaded();const _=this.getLayer(i);_?l.aD(_.getPaintProperty(o),h)||(_.setPaintProperty(o,h,p)&&this._updateLayer(_),this._changed=!0,this._updatedPaintProps[i]=!0,this._serializedLayers=null):this.fire(new l.j(new Error(`Cannot style non-existing layer "${i}".`)))}getPaintProperty(i,o){return this.getLayer(i).getPaintProperty(o)}setFeatureState(i,o){this._checkLoaded();const h=i.source,p=i.sourceLayer,_=this.sourceCaches[h];if(_===void 0)return void this.fire(new l.j(new Error(`The source '${h}' does not exist in the map's style.`)));const S=_.getSource().type;S==="geojson"&&p?this.fire(new l.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):S!=="vector"||p?(i.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),_.setFeatureState(p,i.id,o)):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(i,o){this._checkLoaded();const h=i.source,p=this.sourceCaches[h];if(p===void 0)return void this.fire(new l.j(new Error(`The source '${h}' does not exist in the map's style.`)));const _=p.getSource().type,S=_==="vector"?i.sourceLayer:void 0;_!=="vector"||S?o&&typeof i.id!="string"&&typeof i.id!="number"?this.fire(new l.j(new Error("A feature id is required to remove its specific state property."))):p.removeFeatureState(S,i.id,o):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(i){this._checkLoaded();const o=i.source,h=i.sourceLayer,p=this.sourceCaches[o];if(p!==void 0)return p.getSource().type!=="vector"||h?(i.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),p.getFeatureState(h,i.id)):void this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.j(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const i=l.aE(this.sourceCaches,_=>_.serialize()),o=this._serializeByIds(this._order),h=this.map.getTerrain()||void 0,p=this.stylesheet;return l.aF({version:p.version,name:p.name,metadata:p.metadata,light:p.light,center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,sprite:p.sprite,glyphs:p.glyphs,transition:p.transition,sources:i,layers:o,terrain:h},_=>_!==void 0)}_updateLayer(i){this._updatedLayers[i.id]=!0,i.source&&!this._updatedSources[i.source]&&this.sourceCaches[i.source].getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",this.sourceCaches[i.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(i){const o=S=>this._layers[S].type==="fill-extrusion",h={},p=[];for(let S=this._order.length-1;S>=0;S--){const E=this._order[S];if(o(E)){h[E]=S;for(const C of i){const k=C[E];if(k)for(const F of k)p.push(F)}}}p.sort((S,E)=>E.intersectionZ-S.intersectionZ);const _=[];for(let S=this._order.length-1;S>=0;S--){const E=this._order[S];if(o(E))for(let C=p.length-1;C>=0;C--){const k=p[C].feature;if(h[k.layer.id]<S)break;_.push(k),p.pop()}else for(const C of i){const k=C[E];if(k)for(const F of k)_.push(F.feature)}}return _}queryRenderedFeatures(i,o,h){o&&o.filter&&this._validate(l.x.filter,"queryRenderedFeatures.filter",o.filter,null,o);const p={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new l.j(new Error("parameters.layers must be an Array."))),[];for(const E of o.layers){const C=this._layers[E];if(!C)return this.fire(new l.j(new Error(`The layer '${E}' does not exist in the map's style and cannot be queried for features.`))),[];p[C.source]=!0}}const _=[];o.availableImages=this._availableImages;const S=this._serializedAllLayers();for(const E in this.sourceCaches)o.layers&&!p[E]||_.push(Di(this.sourceCaches[E],this._layers,S,i,o,h));return this.placement&&_.push(function(E,C,k,F,B,q,ie){const ee={},ne=q.queryRenderedSymbols(F),X=[];for(const fe of Object.keys(ne).map(Number))X.push(ie[fe]);X.sort(zi);for(const fe of X){const Ie=fe.featureIndex.lookupSymbolFeatures(ne[fe.bucketInstanceId],C,fe.bucketIndex,fe.sourceLayerIndex,B.filter,B.layers,B.availableImages,E);for(const le in Ie){const we=ee[le]=ee[le]||[],Ae=Ie[le];Ae.sort((ke,Oe)=>{const We=fe.featureSortOrder;if(We){const He=We.indexOf(ke.featureIndex);return We.indexOf(Oe.featureIndex)-He}return Oe.featureIndex-ke.featureIndex});for(const ke of Ae)we.push(ke)}}for(const fe in ee)ee[fe].forEach(Ie=>{const le=Ie.feature,we=k[E[fe].source].getFeatureState(le.layer["source-layer"],le.id);le.source=le.layer.source,le.layer["source-layer"]&&(le.sourceLayer=le.layer["source-layer"]),le.state=we});return ee}(this._layers,S,this.sourceCaches,i,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(i,o){o&&o.filter&&this._validate(l.x.filter,"querySourceFeatures.filter",o.filter,null,o);const h=this.sourceCaches[i];return h?function(p,_){const S=p.getRenderableIds().map(k=>p.getTileByID(k)),E=[],C={};for(let k=0;k<S.length;k++){const F=S[k],B=F.tileID.canonical.key;C[B]||(C[B]=!0,F.querySourceFeatures(E,_))}return E}(h,o):[]}getLight(){return this.light.getLight()}setLight(i,o={}){this._checkLoaded();const h=this.light.getLight();let p=!1;for(const S in i)if(!l.aD(i[S],h[S])){p=!0;break}if(!p)return;const _={now:D.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,o),this.light.updateTransitions(_)}_validate(i,o,h,p,_={}){return(!_||_.validate!==!1)&&dr(this,i.call(l.x,l.e({key:o,style:this.serialize(),value:h,styleSpec:l.v},p)))}_remove(i=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Ue().off(Yt,this._rtlPluginLoaded);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this.sourceCaches){const h=this.sourceCaches[o];h.setEventedParent(null),h.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),i&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(i)}_clearSource(i){this.sourceCaches[i].clearTiles()}_reloadSource(i){this.sourceCaches[i].resume(),this.sourceCaches[i].reload()}_updateSources(i){for(const o in this.sourceCaches)this.sourceCaches[o].update(i,this.map.terrain)}_generateCollisionBoxes(){for(const i in this.sourceCaches)this._reloadSource(i)}_updatePlacement(i,o,h,p,_=!1){let S=!1,E=!1;const C={};for(const k of this._order){const F=this._layers[k];if(F.type!=="symbol")continue;if(!C[F.source]){const q=this.sourceCaches[F.source];C[F.source]=q.getRenderableIds(!0).map(ie=>q.getTileByID(ie)).sort((ie,ee)=>ee.tileID.overscaledZ-ie.tileID.overscaledZ||(ie.tileID.isLessThan(ee.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(F,C[F.source],i.center.lng);S=S||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((_=_||this._layerOrderChanged||h===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(D.now(),i.zoom))&&(this.pauseablePlacement=new bn(i,this.map.terrain,this._order,_,o,h,p,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,C),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(D.now()),E=!0),S&&this.pauseablePlacement.placement.setStale()),E||S)for(const k of this._order){const F=this._layers[k];F.type==="symbol"&&this.placement.updateLayerOpacities(F,C[F.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(D.now())}_releaseSymbolFadeTiles(){for(const i in this.sourceCaches)this.sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,o){return l._(this,void 0,void 0,function*(){const h=yield this.imageManager.getImages(o.icons);this._updateTilesForChangedImages();const p=this.sourceCaches[o.source];return p&&p.setDependencies(o.tileID.key,o.type,o.icons),h})}getGlyphs(i,o){return l._(this,void 0,void 0,function*(){const h=yield this.glyphManager.getGlyphs(o.stacks),p=this.sourceCaches[o.source];return p&&p.setDependencies(o.tileID.key,o.type,[""]),h})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(i,o={}){this._checkLoaded(),i&&this._validate(l.x.glyphs,"glyphs",i,null,o)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=i,this.glyphManager.entries={},this.glyphManager.setURL(i))}addSprite(i,o,h={},p){this._checkLoaded();const _=[{id:i,url:o}],S=[...Ht(this.stylesheet.sprite),..._];this._validate(l.x.sprite,"sprite",S,null,h)||(this.stylesheet.sprite=S,this._loadSprite(_,!0,p))}removeSprite(i){this._checkLoaded();const o=Ht(this.stylesheet.sprite);if(o.find(h=>h.id===i)){if(this._spritesImagesIds[i])for(const h of this._spritesImagesIds[i])this.imageManager.removeImage(h),this._changedImages[h]=!0;o.splice(o.findIndex(h=>h.id===i),1),this.stylesheet.sprite=o.length>0?o:void 0,delete this._spritesImagesIds[i],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}else this.fire(new l.j(new Error(`Sprite "${i}" doesn't exists on this map.`)))}getSprite(){return Ht(this.stylesheet.sprite)}setSprite(i,o={},h){this._checkLoaded(),i&&this._validate(l.x.sprite,"sprite",i,null,o)||(this.stylesheet.sprite=i,i?this._loadSprite(i,!0,h):(this._unloadSprite(),h&&h(null)))}}var ho=l.X([{name:"a_pos",type:"Int16",components:2}]),ss="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const po={prelude:qi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:qi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:qi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:qi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:qi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:qi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:qi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:qi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:qi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:qi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:qi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:qi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:qi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:qi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:qi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:qi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:qi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:qi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:qi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:qi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:qi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:qi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:qi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:qi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:qi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:qi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:qi("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",ss),terrainDepth:qi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",ss),terrainCoords:qi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",ss)};function qi(y,i){const o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=i.match(/attribute ([\w]+) ([\w]+)/g),p=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=i.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=_?_.concat(p):p,E={};return{fragmentSource:y=y.replace(o,(C,k,F,B,q)=>(E[q]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${q}
varying ${F} ${B} ${q};
#else
uniform ${F} ${B} u_${q};
#endif
`:`
#ifdef HAS_UNIFORM_u_${q}
    ${F} ${B} ${q} = u_${q};
#endif
`)),vertexSource:i=i.replace(o,(C,k,F,B,q)=>{const ie=B==="float"?"vec2":"vec4",ee=q.match(/color/)?"color":ie;return E[q]?k==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
attribute ${F} ${ie} a_${q};
varying ${F} ${B} ${q};
#else
uniform ${F} ${B} u_${q};
#endif
`:ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = a_${q};
#else
    ${F} ${B} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = unpack_mix_${ee}(a_${q}, u_${q}_t);
#else
    ${F} ${B} ${q} = u_${q};
#endif
`:k==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
attribute ${F} ${ie} a_${q};
#else
uniform ${F} ${B} u_${q};
#endif
`:ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${F} ${B} ${q} = a_${q};
#else
    ${F} ${B} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${F} ${B} ${q} = unpack_mix_${ee}(a_${q}, u_${q}_t);
#else
    ${F} ${B} ${q} = u_${q};
#endif
`}),staticAttributes:h,staticUniforms:S}}class Oo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(i,o,h,p,_,S,E,C,k){this.context=i;let F=this.boundPaintVertexBuffers.length!==p.length;for(let B=0;!F&&B<p.length;B++)this.boundPaintVertexBuffers[B]!==p[B]&&(F=!0);!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==h||F||this.boundIndexBuffer!==_||this.boundVertexOffset!==S||this.boundDynamicVertexBuffer!==E||this.boundDynamicVertexBuffer2!==C||this.boundDynamicVertexBuffer3!==k?this.freshBind(o,h,p,_,S,E,C,k):(i.bindVertexArray.set(this.vao),E&&E.bind(),_&&_.dynamicDraw&&_.bind(),C&&C.bind(),k&&k.bind())}freshBind(i,o,h,p,_,S,E,C){const k=i.numAttributes,F=this.context,B=F.gl;this.vao&&this.destroy(),this.vao=F.createVertexArray(),F.bindVertexArray.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=p,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=S,this.boundDynamicVertexBuffer2=E,this.boundDynamicVertexBuffer3=C,o.enableAttributes(B,i);for(const q of h)q.enableAttributes(B,i);S&&S.enableAttributes(B,i),E&&E.enableAttributes(B,i),C&&C.enableAttributes(B,i),o.bind(),o.setVertexAttribPointers(B,i,_);for(const q of h)q.bind(),q.setVertexAttribPointers(B,i,_);S&&(S.bind(),S.setVertexAttribPointers(B,i,_)),p&&p.bind(),E&&(E.bind(),E.setVertexAttribPointers(B,i,_)),C&&(C.bind(),C.setVertexAttribPointers(B,i,_)),F.currentNumAttributes=k}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Bs(y){const i=[];for(let o=0;o<y.length;o++){if(y[o]===null)continue;const h=y[o].split(" ");i.push(h.pop())}return i}class b{constructor(i,o,h,p,_,S){const E=i.gl;this.program=E.createProgram();const C=Bs(o.staticAttributes),k=h?h.getBinderAttributes():[],F=C.concat(k),B=po.prelude.staticUniforms?Bs(po.prelude.staticUniforms):[],q=o.staticUniforms?Bs(o.staticUniforms):[],ie=h?h.getBinderUniforms():[],ee=B.concat(q).concat(ie),ne=[];for(const ke of ee)ne.indexOf(ke)<0&&ne.push(ke);const X=h?h.defines():[];_&&X.push("#define OVERDRAW_INSPECTOR;"),S&&X.push("#define TERRAIN3D;");const fe=X.concat(po.prelude.fragmentSource,o.fragmentSource).join(`
`),Ie=X.concat(po.prelude.vertexSource,o.vertexSource).join(`
`),le=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);if(E.shaderSource(le,fe),E.compileShader(le),!E.getShaderParameter(le,E.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${E.getShaderInfoLog(le)}`);E.attachShader(this.program,le);const we=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);if(E.shaderSource(we,Ie),E.compileShader(we),!E.getShaderParameter(we,E.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${E.getShaderInfoLog(we)}`);E.attachShader(this.program,we),this.attributes={};const Ae={};this.numAttributes=F.length;for(let ke=0;ke<this.numAttributes;ke++)F[ke]&&(E.bindAttribLocation(this.program,ke,F[ke]),this.attributes[F[ke]]=ke);if(E.linkProgram(this.program),!E.getProgramParameter(this.program,E.LINK_STATUS))throw new Error(`Program failed to link: ${E.getProgramInfoLog(this.program)}`);E.deleteShader(we),E.deleteShader(le);for(let ke=0;ke<ne.length;ke++){const Oe=ne[ke];if(Oe&&!Ae[Oe]){const We=E.getUniformLocation(this.program,Oe);We&&(Ae[Oe]=We)}}this.fixedUniforms=p(i,Ae),this.terrainUniforms=((ke,Oe)=>({u_depth:new l.aG(ke,Oe.u_depth),u_terrain:new l.aG(ke,Oe.u_terrain),u_terrain_dim:new l.aH(ke,Oe.u_terrain_dim),u_terrain_matrix:new l.aI(ke,Oe.u_terrain_matrix),u_terrain_unpack:new l.aJ(ke,Oe.u_terrain_unpack),u_terrain_exaggeration:new l.aH(ke,Oe.u_terrain_exaggeration)}))(i,Ae),this.binderUniforms=h?h.getUniforms(i,Ae):[]}draw(i,o,h,p,_,S,E,C,k,F,B,q,ie,ee,ne,X,fe,Ie){const le=i.gl;if(this.failedToCreate)return;if(i.program.set(this.program),i.setDepthMode(h),i.setStencilMode(p),i.setColorMode(_),i.setCullFace(S),C){i.activeTexture.set(le.TEXTURE2),le.bindTexture(le.TEXTURE_2D,C.depthTexture),i.activeTexture.set(le.TEXTURE3),le.bindTexture(le.TEXTURE_2D,C.texture);for(const Ae in this.terrainUniforms)this.terrainUniforms[Ae].set(C[Ae])}for(const Ae in this.fixedUniforms)this.fixedUniforms[Ae].set(E[Ae]);ne&&ne.setUniforms(i,this.binderUniforms,ie,{zoom:ee});let we=0;switch(o){case le.LINES:we=2;break;case le.TRIANGLES:we=3;break;case le.LINE_STRIP:we=1}for(const Ae of q.get()){const ke=Ae.vaos||(Ae.vaos={});(ke[k]||(ke[k]=new Oo)).bind(i,this,F,ne?ne.getPaintVertexBuffers():[],B,Ae.vertexOffset,X,fe,Ie),le.drawElements(o,Ae.primitiveLength*we,le.UNSIGNED_SHORT,Ae.primitiveOffset*we*2)}}}function A(y,i,o){const h=1/si(o,1,i.transform.tileZoom),p=Math.pow(2,o.tileID.overscaledZ),_=o.tileSize*Math.pow(2,i.transform.tileZoom)/p,S=_*(o.tileID.canonical.x+o.tileID.wrap*p),E=_*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[h,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[S>>16,E>>16],u_pixel_coord_lower:[65535&S,65535&E]}}const V=(y,i,o,h)=>{const p=i.style.light,_=p.properties.get("position"),S=[_.x,_.y,_.z],E=function(){var k=new l.A(9);return l.A!=Float32Array&&(k[1]=0,k[2]=0,k[3]=0,k[5]=0,k[6]=0,k[7]=0),k[0]=1,k[4]=1,k[8]=1,k}();p.properties.get("anchor")==="viewport"&&function(k,F){var B=Math.sin(F),q=Math.cos(F);k[0]=q,k[1]=B,k[2]=0,k[3]=-B,k[4]=q,k[5]=0,k[6]=0,k[7]=0,k[8]=1}(E,-i.transform.angle),function(k,F,B){var q=F[0],ie=F[1],ee=F[2];k[0]=q*B[0]+ie*B[3]+ee*B[6],k[1]=q*B[1]+ie*B[4]+ee*B[7],k[2]=q*B[2]+ie*B[5]+ee*B[8]}(S,S,E);const C=p.properties.get("color");return{u_matrix:y,u_lightpos:S,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[C.r,C.g,C.b],u_vertical_gradient:+o,u_opacity:h}},ae=(y,i,o,h,p,_,S)=>l.e(V(y,i,o,h),A(_,i,S),{u_height_factor:-Math.pow(2,p.overscaledZ)/S.tileSize/8}),ge=y=>({u_matrix:y}),ye=(y,i,o,h)=>l.e(ge(y),A(o,i,h)),Se=(y,i)=>({u_matrix:y,u_world:i}),Ye=(y,i,o,h,p)=>l.e(ye(y,i,o,h),{u_world:p}),ot=(y,i,o,h)=>{const p=y.transform;let _,S;if(h.paint.get("circle-pitch-alignment")==="map"){const E=si(o,1,p.zoom);_=!0,S=[E,E]}else _=!1,S=p.pixelsToGLUnits;return{u_camera_to_center_distance:p.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_matrix:y.translatePosMatrix(i.posMatrix,o,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_pitch_with_map:+_,u_device_pixel_ratio:y.pixelRatio,u_extrude_scale:S}},wt=(y,i,o)=>{const h=si(o,1,i.zoom),p=Math.pow(2,i.zoom-o.tileID.overscaledZ),_=o.tileID.overscaleFactor();return{u_matrix:y,u_camera_to_center_distance:i.cameraToCenterDistance,u_pixels_to_tile_units:h,u_extrude_scale:[i.pixelsToGLUnits[0]/(h*p),i.pixelsToGLUnits[1]/(h*p)],u_overscale_factor:_}},Mt=(y,i,o=1)=>({u_matrix:y,u_color:i,u_overlay:0,u_overlay_scale:o}),ft=y=>({u_matrix:y}),oi=(y,i,o,h)=>({u_matrix:y,u_extrude_scale:si(i,1,o),u_intensity:h});function pr(y,i){const o=Math.pow(2,i.canonical.z),h=i.canonical.y;return[new l.Y(0,h/o).toLngLat().lat,new l.Y(0,(h+1)/o).toLngLat().lat]}const ui=(y,i,o,h)=>{const p=y.transform;return{u_matrix:Tr(y,i,o,h),u_ratio:1/si(i,1,p.zoom),u_device_pixel_ratio:y.pixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Rr=(y,i,o,h,p)=>l.e(ui(y,i,o,p),{u_image:0,u_image_height:h}),je=(y,i,o,h,p)=>{const _=y.transform,S=xi(i,_);return{u_matrix:Tr(y,i,o,p),u_texsize:i.imageAtlasTexture.size,u_ratio:1/si(i,1,_.zoom),u_device_pixel_ratio:y.pixelRatio,u_image:0,u_scale:[S,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},Ft=(y,i,o,h,p,_)=>{const S=y.lineAtlas,E=xi(i,y.transform),C=o.layout.get("line-cap")==="round",k=S.getDash(h.from,C),F=S.getDash(h.to,C),B=k.width*p.fromScale,q=F.width*p.toScale;return l.e(ui(y,i,o,_),{u_patternscale_a:[E/B,-k.height/2],u_patternscale_b:[E/q,-F.height/2],u_sdfgamma:S.width/(256*Math.min(B,q)*y.pixelRatio)/2,u_image:0,u_tex_y_a:k.y,u_tex_y_b:F.y,u_mix:p.t})};function xi(y,i){return 1/si(y,1,i.tileZoom)}function Tr(y,i,o,h){return y.translatePosMatrix(h?h.posMatrix:i.tileID.posMatrix,i,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const vr=(y,i,o,h,p)=>{return{u_matrix:y,u_tl_parent:i,u_scale_parent:o,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*p.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:p.paint.get("raster-brightness-min"),u_brightness_high:p.paint.get("raster-brightness-max"),u_saturation_factor:(S=p.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(_=p.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:_a(p.paint.get("raster-hue-rotate"))};var _,S};function _a(y){y*=Math.PI/180;const i=Math.sin(y),o=Math.cos(y);return[(2*o+1)/3,(-Math.sqrt(3)*i-o+1)/3,(Math.sqrt(3)*i-o+1)/3]}const fo=(y,i,o,h,p,_,S,E,C,k)=>{const F=p.transform;return{u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:F.cameraToCenterDistance,u_pitch:F.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:F.width/F.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:S,u_coord_matrix:E,u_is_text:+C,u_pitch_with_map:+h,u_texsize:k,u_texture:0}},Wi=(y,i,o,h,p,_,S,E,C,k,F)=>{const B=p.transform;return l.e(fo(y,i,o,h,p,_,S,E,C,k),{u_gamma_scale:h?Math.cos(B._pitch)*B.cameraToCenterDistance:1,u_device_pixel_ratio:p.pixelRatio,u_is_halo:+F})},Na=(y,i,o,h,p,_,S,E,C,k)=>l.e(Wi(y,i,o,h,p,_,S,E,!0,C,!0),{u_texsize_icon:k,u_texture_icon:1}),xu=(y,i,o)=>({u_matrix:y,u_opacity:i,u_color:o}),Ns=(y,i,o,h,p,_)=>l.e(function(S,E,C,k){const F=C.imageManager.getPattern(S.from.toString()),B=C.imageManager.getPattern(S.to.toString()),{width:q,height:ie}=C.imageManager.getPixelSize(),ee=Math.pow(2,k.tileID.overscaledZ),ne=k.tileSize*Math.pow(2,C.transform.tileZoom)/ee,X=ne*(k.tileID.canonical.x+k.tileID.wrap*ee),fe=ne*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:F.tl,u_pattern_br_a:F.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[q,ie],u_mix:E.t,u_pattern_size_a:F.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:E.fromScale,u_scale_b:E.toScale,u_tile_units_to_pixels:1/si(k,1,C.transform.tileZoom),u_pixel_coord_upper:[X>>16,fe>>16],u_pixel_coord_lower:[65535&X,65535&fe]}}(h,_,o,p),{u_matrix:y,u_opacity:i}),Il={fillExtrusion:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_lightpos:new l.aK(y,i.u_lightpos),u_lightintensity:new l.aH(y,i.u_lightintensity),u_lightcolor:new l.aK(y,i.u_lightcolor),u_vertical_gradient:new l.aH(y,i.u_vertical_gradient),u_opacity:new l.aH(y,i.u_opacity)}),fillExtrusionPattern:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_lightpos:new l.aK(y,i.u_lightpos),u_lightintensity:new l.aH(y,i.u_lightintensity),u_lightcolor:new l.aK(y,i.u_lightcolor),u_vertical_gradient:new l.aH(y,i.u_vertical_gradient),u_height_factor:new l.aH(y,i.u_height_factor),u_image:new l.aG(y,i.u_image),u_texsize:new l.aL(y,i.u_texsize),u_pixel_coord_upper:new l.aL(y,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(y,i.u_pixel_coord_lower),u_scale:new l.aK(y,i.u_scale),u_fade:new l.aH(y,i.u_fade),u_opacity:new l.aH(y,i.u_opacity)}),fill:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix)}),fillPattern:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_image:new l.aG(y,i.u_image),u_texsize:new l.aL(y,i.u_texsize),u_pixel_coord_upper:new l.aL(y,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(y,i.u_pixel_coord_lower),u_scale:new l.aK(y,i.u_scale),u_fade:new l.aH(y,i.u_fade)}),fillOutline:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_world:new l.aL(y,i.u_world)}),fillOutlinePattern:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_world:new l.aL(y,i.u_world),u_image:new l.aG(y,i.u_image),u_texsize:new l.aL(y,i.u_texsize),u_pixel_coord_upper:new l.aL(y,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(y,i.u_pixel_coord_lower),u_scale:new l.aK(y,i.u_scale),u_fade:new l.aH(y,i.u_fade)}),circle:(y,i)=>({u_camera_to_center_distance:new l.aH(y,i.u_camera_to_center_distance),u_scale_with_map:new l.aG(y,i.u_scale_with_map),u_pitch_with_map:new l.aG(y,i.u_pitch_with_map),u_extrude_scale:new l.aL(y,i.u_extrude_scale),u_device_pixel_ratio:new l.aH(y,i.u_device_pixel_ratio),u_matrix:new l.aI(y,i.u_matrix)}),collisionBox:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_camera_to_center_distance:new l.aH(y,i.u_camera_to_center_distance),u_pixels_to_tile_units:new l.aH(y,i.u_pixels_to_tile_units),u_extrude_scale:new l.aL(y,i.u_extrude_scale),u_overscale_factor:new l.aH(y,i.u_overscale_factor)}),collisionCircle:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_inv_matrix:new l.aI(y,i.u_inv_matrix),u_camera_to_center_distance:new l.aH(y,i.u_camera_to_center_distance),u_viewport_size:new l.aL(y,i.u_viewport_size)}),debug:(y,i)=>({u_color:new l.aM(y,i.u_color),u_matrix:new l.aI(y,i.u_matrix),u_overlay:new l.aG(y,i.u_overlay),u_overlay_scale:new l.aH(y,i.u_overlay_scale)}),clippingMask:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix)}),heatmap:(y,i)=>({u_extrude_scale:new l.aH(y,i.u_extrude_scale),u_intensity:new l.aH(y,i.u_intensity),u_matrix:new l.aI(y,i.u_matrix)}),heatmapTexture:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_world:new l.aL(y,i.u_world),u_image:new l.aG(y,i.u_image),u_color_ramp:new l.aG(y,i.u_color_ramp),u_opacity:new l.aH(y,i.u_opacity)}),hillshade:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_image:new l.aG(y,i.u_image),u_latrange:new l.aL(y,i.u_latrange),u_light:new l.aL(y,i.u_light),u_shadow:new l.aM(y,i.u_shadow),u_highlight:new l.aM(y,i.u_highlight),u_accent:new l.aM(y,i.u_accent)}),hillshadePrepare:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_image:new l.aG(y,i.u_image),u_dimension:new l.aL(y,i.u_dimension),u_zoom:new l.aH(y,i.u_zoom),u_unpack:new l.aJ(y,i.u_unpack)}),line:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_ratio:new l.aH(y,i.u_ratio),u_device_pixel_ratio:new l.aH(y,i.u_device_pixel_ratio),u_units_to_pixels:new l.aL(y,i.u_units_to_pixels)}),lineGradient:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_ratio:new l.aH(y,i.u_ratio),u_device_pixel_ratio:new l.aH(y,i.u_device_pixel_ratio),u_units_to_pixels:new l.aL(y,i.u_units_to_pixels),u_image:new l.aG(y,i.u_image),u_image_height:new l.aH(y,i.u_image_height)}),linePattern:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_texsize:new l.aL(y,i.u_texsize),u_ratio:new l.aH(y,i.u_ratio),u_device_pixel_ratio:new l.aH(y,i.u_device_pixel_ratio),u_image:new l.aG(y,i.u_image),u_units_to_pixels:new l.aL(y,i.u_units_to_pixels),u_scale:new l.aK(y,i.u_scale),u_fade:new l.aH(y,i.u_fade)}),lineSDF:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_ratio:new l.aH(y,i.u_ratio),u_device_pixel_ratio:new l.aH(y,i.u_device_pixel_ratio),u_units_to_pixels:new l.aL(y,i.u_units_to_pixels),u_patternscale_a:new l.aL(y,i.u_patternscale_a),u_patternscale_b:new l.aL(y,i.u_patternscale_b),u_sdfgamma:new l.aH(y,i.u_sdfgamma),u_image:new l.aG(y,i.u_image),u_tex_y_a:new l.aH(y,i.u_tex_y_a),u_tex_y_b:new l.aH(y,i.u_tex_y_b),u_mix:new l.aH(y,i.u_mix)}),raster:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_tl_parent:new l.aL(y,i.u_tl_parent),u_scale_parent:new l.aH(y,i.u_scale_parent),u_buffer_scale:new l.aH(y,i.u_buffer_scale),u_fade_t:new l.aH(y,i.u_fade_t),u_opacity:new l.aH(y,i.u_opacity),u_image0:new l.aG(y,i.u_image0),u_image1:new l.aG(y,i.u_image1),u_brightness_low:new l.aH(y,i.u_brightness_low),u_brightness_high:new l.aH(y,i.u_brightness_high),u_saturation_factor:new l.aH(y,i.u_saturation_factor),u_contrast_factor:new l.aH(y,i.u_contrast_factor),u_spin_weights:new l.aK(y,i.u_spin_weights)}),symbolIcon:(y,i)=>({u_is_size_zoom_constant:new l.aG(y,i.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(y,i.u_is_size_feature_constant),u_size_t:new l.aH(y,i.u_size_t),u_size:new l.aH(y,i.u_size),u_camera_to_center_distance:new l.aH(y,i.u_camera_to_center_distance),u_pitch:new l.aH(y,i.u_pitch),u_rotate_symbol:new l.aG(y,i.u_rotate_symbol),u_aspect_ratio:new l.aH(y,i.u_aspect_ratio),u_fade_change:new l.aH(y,i.u_fade_change),u_matrix:new l.aI(y,i.u_matrix),u_label_plane_matrix:new l.aI(y,i.u_label_plane_matrix),u_coord_matrix:new l.aI(y,i.u_coord_matrix),u_is_text:new l.aG(y,i.u_is_text),u_pitch_with_map:new l.aG(y,i.u_pitch_with_map),u_texsize:new l.aL(y,i.u_texsize),u_texture:new l.aG(y,i.u_texture)}),symbolSDF:(y,i)=>({u_is_size_zoom_constant:new l.aG(y,i.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(y,i.u_is_size_feature_constant),u_size_t:new l.aH(y,i.u_size_t),u_size:new l.aH(y,i.u_size),u_camera_to_center_distance:new l.aH(y,i.u_camera_to_center_distance),u_pitch:new l.aH(y,i.u_pitch),u_rotate_symbol:new l.aG(y,i.u_rotate_symbol),u_aspect_ratio:new l.aH(y,i.u_aspect_ratio),u_fade_change:new l.aH(y,i.u_fade_change),u_matrix:new l.aI(y,i.u_matrix),u_label_plane_matrix:new l.aI(y,i.u_label_plane_matrix),u_coord_matrix:new l.aI(y,i.u_coord_matrix),u_is_text:new l.aG(y,i.u_is_text),u_pitch_with_map:new l.aG(y,i.u_pitch_with_map),u_texsize:new l.aL(y,i.u_texsize),u_texture:new l.aG(y,i.u_texture),u_gamma_scale:new l.aH(y,i.u_gamma_scale),u_device_pixel_ratio:new l.aH(y,i.u_device_pixel_ratio),u_is_halo:new l.aG(y,i.u_is_halo)}),symbolTextAndIcon:(y,i)=>({u_is_size_zoom_constant:new l.aG(y,i.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(y,i.u_is_size_feature_constant),u_size_t:new l.aH(y,i.u_size_t),u_size:new l.aH(y,i.u_size),u_camera_to_center_distance:new l.aH(y,i.u_camera_to_center_distance),u_pitch:new l.aH(y,i.u_pitch),u_rotate_symbol:new l.aG(y,i.u_rotate_symbol),u_aspect_ratio:new l.aH(y,i.u_aspect_ratio),u_fade_change:new l.aH(y,i.u_fade_change),u_matrix:new l.aI(y,i.u_matrix),u_label_plane_matrix:new l.aI(y,i.u_label_plane_matrix),u_coord_matrix:new l.aI(y,i.u_coord_matrix),u_is_text:new l.aG(y,i.u_is_text),u_pitch_with_map:new l.aG(y,i.u_pitch_with_map),u_texsize:new l.aL(y,i.u_texsize),u_texsize_icon:new l.aL(y,i.u_texsize_icon),u_texture:new l.aG(y,i.u_texture),u_texture_icon:new l.aG(y,i.u_texture_icon),u_gamma_scale:new l.aH(y,i.u_gamma_scale),u_device_pixel_ratio:new l.aH(y,i.u_device_pixel_ratio),u_is_halo:new l.aG(y,i.u_is_halo)}),background:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_opacity:new l.aH(y,i.u_opacity),u_color:new l.aM(y,i.u_color)}),backgroundPattern:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_opacity:new l.aH(y,i.u_opacity),u_image:new l.aG(y,i.u_image),u_pattern_tl_a:new l.aL(y,i.u_pattern_tl_a),u_pattern_br_a:new l.aL(y,i.u_pattern_br_a),u_pattern_tl_b:new l.aL(y,i.u_pattern_tl_b),u_pattern_br_b:new l.aL(y,i.u_pattern_br_b),u_texsize:new l.aL(y,i.u_texsize),u_mix:new l.aH(y,i.u_mix),u_pattern_size_a:new l.aL(y,i.u_pattern_size_a),u_pattern_size_b:new l.aL(y,i.u_pattern_size_b),u_scale_a:new l.aH(y,i.u_scale_a),u_scale_b:new l.aH(y,i.u_scale_b),u_pixel_coord_upper:new l.aL(y,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(y,i.u_pixel_coord_lower),u_tile_units_to_pixels:new l.aH(y,i.u_tile_units_to_pixels)}),terrain:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_texture:new l.aG(y,i.u_texture),u_ele_delta:new l.aH(y,i.u_ele_delta)}),terrainDepth:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_ele_delta:new l.aH(y,i.u_ele_delta)}),terrainCoords:(y,i)=>({u_matrix:new l.aI(y,i.u_matrix),u_texture:new l.aG(y,i.u_texture),u_terrain_coords_id:new l.aH(y,i.u_terrain_coords_id),u_ele_delta:new l.aH(y,i.u_ele_delta)})};class mc{constructor(i,o,h){this.context=i;const p=i.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const o=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ia={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class $a{constructor(i,o,h,p){this.length=o.length,this.attributes=h,this.itemSize=o.bytesPerElement,this.dynamicDraw=p,this.context=i;const _=i.gl;this.buffer=_.createBuffer(),i.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){if(i.length!==this.length)throw new Error(`Length of new data is ${i.length}, which doesn't match current length of ${this.length}`);const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,o){for(let h=0;h<this.attributes.length;h++){const p=o.attributes[this.attributes[h].name];p!==void 0&&i.enableVertexAttribArray(p)}}setVertexAttribPointers(i,o,h){for(let p=0;p<this.attributes.length;p++){const _=this.attributes[p],S=o.attributes[_.name];S!==void 0&&i.vertexAttribPointer(S,_.components,i[ia[_.type]],!1,this.itemSize,_.offset+this.itemSize*(h||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const pn=new WeakMap;function Jr(y){var i;if(pn.has(y))return pn.get(y);{const o=(i=y.getParameter(y.VERSION))===null||i===void 0?void 0:i.startsWith("WebGL 2.0");return pn.set(y,o),o}}class Oi{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Fo extends Oi{getDefault(){return l.aO.transparent}set(i){const o=this.current;(i.r!==o.r||i.g!==o.g||i.b!==o.b||i.a!==o.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Bo extends Oi{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class No extends Oi{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class $o extends Oi{getDefault(){return[!0,!0,!0,!0]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class mo extends Oi{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class Al extends Oi{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class Pl extends Oi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const o=this.current;(i.func!==o.func||i.ref!==o.ref||i.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class va extends Oi{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Uo extends Oi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=i,this.dirty=!1}}class Dl extends Oi{getDefault(){return[0,1]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class Mn extends Oi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=i,this.dirty=!1}}class gc extends Oi{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class yc extends Oi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.BLEND):o.disable(o.BLEND),this.current=i,this.dirty=!1}}class bu extends Oi{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class _c extends Oi{getDefault(){return l.aO.transparent}set(i){const o=this.current;(i.r!==o.r||i.g!==o.g||i.b!==o.b||i.a!==o.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Vo extends Oi{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class vc extends Oi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=i,this.dirty=!1}}class jo extends Oi{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class qo extends Oi{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class $s extends Oi{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class Go extends Oi{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class Ua extends Oi{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class xc extends Oi{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class Ho extends Oi{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class xa extends Oi{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class Us extends Oi{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Zo extends Oi{getDefault(){return null}set(i){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class ra extends Oi{getDefault(){return null}set(i){var o;if(i===this.current&&!this.dirty)return;const h=this.gl;Jr(h)?h.bindVertexArray(i):(o=h.getExtension("OES_vertex_array_object"))===null||o===void 0||o.bindVertexArrayOES(i),this.current=i,this.dirty=!1}}class xs extends Oi{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class bc extends Oi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class kl extends Oi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class ki extends Oi{constructor(i,o){super(i),this.context=i,this.parent=o}getDefault(){return null}}class Wo extends ki{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class wu extends ki{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Ll extends ki{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class ba{constructor(i,o,h,p,_){this.context=i,this.width=o,this.height=h;const S=i.gl,E=this.framebuffer=S.createFramebuffer();if(this.colorAttachment=new Wo(i,E),p)this.depthAttachment=_?new Ll(i,E):new wu(i,E);else if(_)throw new Error("Stencil cannot be set without depth");if(S.checkFramebufferStatus(S.FRAMEBUFFER)!==S.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const i=this.context.gl,o=this.colorAttachment.get();if(o&&i.deleteTexture(o),this.depthAttachment){const h=this.depthAttachment.get();h&&i.deleteRenderbuffer(h)}i.deleteFramebuffer(this.framebuffer)}}class er{constructor(i,o,h){this.blendFunction=i,this.blendColor=o,this.mask=h}}er.Replace=[1,0],er.disabled=new er(er.Replace,l.aO.transparent,[!1,!1,!1,!1]),er.unblended=new er(er.Replace,l.aO.transparent,[!0,!0,!0,!0]),er.alphaBlended=new er([1,771],l.aO.transparent,[!0,!0,!0,!0]);class Vs{constructor(i){var o,h;if(this.gl=i,this.clearColor=new Fo(this),this.clearDepth=new Bo(this),this.clearStencil=new No(this),this.colorMask=new $o(this),this.depthMask=new mo(this),this.stencilMask=new Al(this),this.stencilFunc=new Pl(this),this.stencilOp=new va(this),this.stencilTest=new Uo(this),this.depthRange=new Dl(this),this.depthTest=new Mn(this),this.depthFunc=new gc(this),this.blend=new yc(this),this.blendFunc=new bu(this),this.blendColor=new _c(this),this.blendEquation=new Vo(this),this.cullFace=new vc(this),this.cullFaceSide=new jo(this),this.frontFace=new qo(this),this.program=new $s(this),this.activeTexture=new Go(this),this.viewport=new Ua(this),this.bindFramebuffer=new xc(this),this.bindRenderbuffer=new Ho(this),this.bindTexture=new xa(this),this.bindVertexBuffer=new Us(this),this.bindElementBuffer=new Zo(this),this.bindVertexArray=new ra(this),this.pixelStoreUnpack=new xs(this),this.pixelStoreUnpackPremultiplyAlpha=new bc(this),this.pixelStoreUnpackFlipY=new kl(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),Jr(i)){this.HALF_FLOAT=i.HALF_FLOAT;const p=i.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(o=i.RGBA16F)!==null&&o!==void 0?o:p==null?void 0:p.RGBA16F_EXT,this.RGB16F=(h=i.RGB16F)!==null&&h!==void 0?h:p==null?void 0:p.RGB16F_EXT,i.getExtension("EXT_color_buffer_float")}else{i.getExtension("EXT_color_buffer_half_float"),i.getExtension("OES_texture_half_float_linear");const p=i.getExtension("OES_texture_half_float");this.HALF_FLOAT=p==null?void 0:p.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,o){return new mc(this,i,o)}createVertexBuffer(i,o,h){return new $a(this,i,o,h)}createRenderbuffer(i,o,h){const p=this.gl,_=p.createRenderbuffer();return this.bindRenderbuffer.set(_),p.renderbufferStorage(p.RENDERBUFFER,i,o,h),this.bindRenderbuffer.set(null),_}createFramebuffer(i,o,h,p){return new ba(this,i,o,h,p)}clear({color:i,depth:o,stencil:h}){const p=this.gl;let _=0;i&&(_|=p.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(_|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),h!==void 0&&(_|=p.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),p.clear(_)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){l.aD(i.blendFunction,er.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}createVertexArray(){var i;return Jr(this.gl)?this.gl.createVertexArray():(i=this.gl.getExtension("OES_vertex_array_object"))===null||i===void 0?void 0:i.createVertexArrayOES()}deleteVertexArray(i){var o;return Jr(this.gl)?this.gl.deleteVertexArray(i):(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.deleteVertexArrayOES(i)}unbindVAO(){this.bindVertexArray.set(null)}}class fi{constructor(i,o,h){this.func=i,this.mask=o,this.range=h}}fi.ReadOnly=!1,fi.ReadWrite=!0,fi.disabled=new fi(519,fi.ReadOnly,[0,1]);const Va=7680;class $i{constructor(i,o,h,p,_,S){this.test=i,this.ref=o,this.mask=h,this.fail=p,this.depthFail=_,this.pass=S}}$i.disabled=new $i({func:519,mask:0},0,0,Va,Va,Va);class Ji{constructor(i,o,h){this.enable=i,this.mode=o,this.frontFace=h}}let bs;function na(y,i,o,h,p,_,S){const E=y.context,C=E.gl,k=y.useProgram("collisionBox"),F=[];let B=0,q=0;for(let le=0;le<h.length;le++){const we=h[le],Ae=i.getTile(we),ke=Ae.getBucket(o);if(!ke)continue;let Oe=we.posMatrix;p[0]===0&&p[1]===0||(Oe=y.translatePosMatrix(we.posMatrix,Ae,p,_));const We=S?ke.textCollisionBox:ke.iconCollisionBox,He=ke.collisionCircleArray;if(He.length>0){const st=l.F(),ht=Oe;l.aP(st,ke.placementInvProjMatrix,y.transform.glCoordMatrix),l.aP(st,st,ke.placementViewportMatrix),F.push({circleArray:He,circleOffset:q,transform:ht,invTransform:st,coord:we}),B+=He.length/4,q=B}We&&k.draw(E,C.LINES,fi.disabled,$i.disabled,y.colorModeForRenderPass(),Ji.disabled,wt(Oe,y.transform,Ae),y.style.map.terrain&&y.style.map.terrain.getTerrainData(we),o.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,null,y.transform.zoom,null,null,We.collisionVertexBuffer)}if(!S||!F.length)return;const ie=y.useProgram("collisionCircle"),ee=new l.aQ;ee.resize(4*B),ee._trim();let ne=0;for(const le of F)for(let we=0;we<le.circleArray.length/4;we++){const Ae=4*we,ke=le.circleArray[Ae+0],Oe=le.circleArray[Ae+1],We=le.circleArray[Ae+2],He=le.circleArray[Ae+3];ee.emplace(ne++,ke,Oe,We,He,0),ee.emplace(ne++,ke,Oe,We,He,1),ee.emplace(ne++,ke,Oe,We,He,2),ee.emplace(ne++,ke,Oe,We,He,3)}(!bs||bs.length<2*B)&&(bs=function(le){const we=2*le,Ae=new l.aS;Ae.resize(we),Ae._trim();for(let ke=0;ke<we;ke++){const Oe=6*ke;Ae.uint16[Oe+0]=4*ke+0,Ae.uint16[Oe+1]=4*ke+1,Ae.uint16[Oe+2]=4*ke+2,Ae.uint16[Oe+3]=4*ke+2,Ae.uint16[Oe+4]=4*ke+3,Ae.uint16[Oe+5]=4*ke+0}return Ae}(B));const X=E.createIndexBuffer(bs,!0),fe=E.createVertexBuffer(ee,l.aR.members,!0);for(const le of F){const we={u_matrix:le.transform,u_inv_matrix:le.invTransform,u_camera_to_center_distance:(Ie=y.transform).cameraToCenterDistance,u_viewport_size:[Ie.width,Ie.height]};ie.draw(E,C.TRIANGLES,fi.disabled,$i.disabled,y.colorModeForRenderPass(),Ji.disabled,we,y.style.map.terrain&&y.style.map.terrain.getTerrainData(le.coord),o.id,fe,X,l.$.simpleSegment(0,2*le.circleOffset,le.circleArray.length,le.circleArray.length/2),null,y.transform.zoom,null,null,null)}var Ie;fe.destroy(),X.destroy()}Ji.disabled=new Ji(!1,1029,2305),Ji.backCCW=new Ji(!0,1029,2305);const Xo=l.an(new Float32Array(16));function Rl(y,i,o,h,p,_){const{horizontalAlign:S,verticalAlign:E}=l.at(y);return new l.P((-(S-.5)*i/p+h[0])*_,(-(E-.5)*o/p+h[1])*_)}function Ko(y,i,o,h,p,_,S,E,C,k,F){const B=y.text.placedSymbolArray,q=y.text.dynamicLayoutVertexArray,ie=y.icon.dynamicLayoutVertexArray,ee={};q.clear();for(let ne=0;ne<B.length;ne++){const X=B.get(ne),fe=X.hidden||!X.crossTileID||y.allowVerticalPlacement&&!X.placedOrientation?null:h[X.crossTileID];if(fe){const Ie=new l.P(X.anchorX,X.anchorY),le=Er(Ie,o?S:_,F),we=te(p.cameraToCenterDistance,le.signedDistanceFromCamera);let Ae=l.ai(y.textSizeData,C,X)*we/l.ao;o&&(Ae*=y.tilePixelRatio/E);const{width:ke,height:Oe,anchor:We,textOffset:He,textBoxScale:st}=fe,ht=Rl(We,ke,Oe,He,st,Ae),di=o?Er(Ie.add(ht),_,F).point:le.point.add(i?ht.rotate(-p.angle):ht),yt=y.allowVerticalPlacement&&X.placedOrientation===l.ah.vertical?Math.PI/2:0;for(let ei=0;ei<X.numGlyphs;ei++)l.aj(q,di,yt);k&&X.associatedIconIndex>=0&&(ee[X.associatedIconIndex]={shiftedAnchor:di,angle:yt})}else Ne(X.numGlyphs,q)}if(k){ie.clear();const ne=y.icon.placedSymbolArray;for(let X=0;X<ne.length;X++){const fe=ne.get(X);if(fe.hidden)Ne(fe.numGlyphs,ie);else{const Ie=ee[X];if(Ie)for(let le=0;le<fe.numGlyphs;le++)l.aj(ie,Ie.shiftedAnchor,Ie.angle);else Ne(fe.numGlyphs,ie)}}y.icon.dynamicLayoutVertexBuffer.updateData(ie)}y.text.dynamicLayoutVertexBuffer.updateData(q)}function Yo(y,i,o){return o.iconsInText&&i?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function go(y,i,o,h,p,_,S,E,C,k,F,B){const q=y.context,ie=q.gl,ee=y.transform,ne=E==="map",X=C==="map",fe=E!=="viewport"&&o.layout.get("symbol-placement")!=="point",Ie=ne&&!X&&!fe,le=!o.layout.get("symbol-sort-key").isConstant();let we=!1;const Ae=y.depthModeForSublayer(0,fi.ReadOnly),ke=o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Oe=[];for(const We of h){const He=i.getTile(We),st=He.getBucket(o);if(!st)continue;const ht=p?st.text:st.icon;if(!ht||!ht.segments.get().length||!ht.hasVisibleVertices)continue;const di=ht.programConfigurations.get(o.id),yt=p||st.sdfIcons,ei=p?st.textSizeData:st.iconSizeData,pi=X||ee.pitch!==0,Li=y.useProgram(Yo(yt,p,st),di),ai=l.ag(ei,ee.zoom),mi=y.style.map.terrain&&y.style.map.terrain.getTerrainData(We);let bi,Or,Qi,cs,rn=[0,0],Ir=null;if(p)Or=He.glyphAtlasTexture,Qi=ie.LINEAR,bi=He.glyphAtlasTexture.size,st.iconsInText&&(rn=He.imageAtlasTexture.size,Ir=He.imageAtlasTexture,cs=pi||y.options.rotating||y.options.zooming||ei.kind==="composite"||ei.kind==="camera"?ie.LINEAR:ie.NEAREST);else{const Xr=o.layout.get("icon-size").constantOr(0)!==1||st.iconsNeedLinear;Or=He.imageAtlasTexture,Qi=yt||y.options.rotating||y.options.zooming||Xr||pi?ie.LINEAR:ie.NEAREST,bi=He.imageAtlasTexture.size}const nn=si(He,1,y.transform.zoom),us=ri(We.posMatrix,X,ne,y.transform,nn),oa=ea(We.posMatrix,X,ne,y.transform,nn),Za=ke&&st.hasTextData(),Kl=o.layout.get("icon-text-fit")!=="none"&&Za&&st.hasIconData();if(fe){const Xr=y.style.map.terrain?(Cs,Kr)=>y.style.map.terrain.getElevation(We,Cs,Kr):null,Pr=o.layout.get("text-rotation-alignment")==="map";U(st,We.posMatrix,y,p,us,oa,X,k,Pr,Xr)}const Wa=y.translatePosMatrix(We.posMatrix,He,_,S),la=fe||p&&ke||Kl?Xo:us,Wr=y.translatePosMatrix(oa,He,_,S,!0),Ar=yt&&o.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let br;br=yt?st.iconsInText?Na(ei.kind,ai,Ie,X,y,Wa,la,Wr,bi,rn):Wi(ei.kind,ai,Ie,X,y,Wa,la,Wr,p,bi,!0):fo(ei.kind,ai,Ie,X,y,Wa,la,Wr,p,bi);const Ts={program:Li,buffers:ht,uniformValues:br,atlasTexture:Or,atlasTextureIcon:Ir,atlasInterpolation:Qi,atlasInterpolationIcon:cs,isSDF:yt,hasHalo:Ar};if(le&&st.canOverlap){we=!0;const Xr=ht.segments.get();for(const Pr of Xr)Oe.push({segments:new l.$([Pr]),sortKey:Pr.sortKey,state:Ts,terrainData:mi})}else Oe.push({segments:ht.segments,sortKey:0,state:Ts,terrainData:mi})}we&&Oe.sort((We,He)=>We.sortKey-He.sortKey);for(const We of Oe){const He=We.state;if(q.activeTexture.set(ie.TEXTURE0),He.atlasTexture.bind(He.atlasInterpolation,ie.CLAMP_TO_EDGE),He.atlasTextureIcon&&(q.activeTexture.set(ie.TEXTURE1),He.atlasTextureIcon&&He.atlasTextureIcon.bind(He.atlasInterpolationIcon,ie.CLAMP_TO_EDGE)),He.isSDF){const st=He.uniformValues;He.hasHalo&&(st.u_is_halo=1,zl(He.buffers,We.segments,o,y,He.program,Ae,F,B,st,We.terrainData)),st.u_is_halo=0}zl(He.buffers,We.segments,o,y,He.program,Ae,F,B,He.uniformValues,We.terrainData)}}function zl(y,i,o,h,p,_,S,E,C,k){const F=h.context;p.draw(F,F.gl.TRIANGLES,_,S,E,Ji.disabled,C,k,o.id,y.layoutVertexBuffer,y.indexBuffer,i,o.paint,h.transform.zoom,y.programConfigurations.get(o.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function wa(y,i,o,h,p){if(!o||!h||!h.imageAtlas)return;const _=h.imageAtlas.patternPositions;let S=_[o.to.toString()],E=_[o.from.toString()];if(!S&&E&&(S=E),!E&&S&&(E=S),!S||!E){const C=p.getPaintProperty(i);S=_[C],E=_[C]}S&&E&&y.setConstantPatternPositions(S,E)}function Ma(y,i,o,h,p,_,S){const E=y.context.gl,C="fill-pattern",k=o.paint.get(C),F=k&&k.constantOr(1),B=o.getCrossfadeParameters();let q,ie,ee,ne,X;S?(ie=F&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",q=E.LINES):(ie=F?"fillPattern":"fill",q=E.TRIANGLES);const fe=k.constantOr(null);for(const Ie of h){const le=i.getTile(Ie);if(F&&!le.patternsLoaded())continue;const we=le.getBucket(o);if(!we)continue;const Ae=we.programConfigurations.get(o.id),ke=y.useProgram(ie,Ae),Oe=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ie);F&&(y.context.activeTexture.set(E.TEXTURE0),le.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),Ae.updatePaintBuffers(B)),wa(Ae,C,fe,le,o);const We=Oe?Ie:null,He=y.translatePosMatrix(We?We.posMatrix:Ie.posMatrix,le,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(S){ne=we.indexBuffer2,X=we.segments2;const st=[E.drawingBufferWidth,E.drawingBufferHeight];ee=ie==="fillOutlinePattern"&&F?Ye(He,y,B,le,st):Se(He,st)}else ne=we.indexBuffer,X=we.segments,ee=F?ye(He,y,B,le):ge(He);ke.draw(y.context,q,p,y.stencilModeForClipping(Ie),_,Ji.disabled,ee,Oe,o.id,we.layoutVertexBuffer,ne,X,o.paint,y.transform.zoom,Ae)}}function Jo(y,i,o,h,p,_,S){const E=y.context,C=E.gl,k="fill-extrusion-pattern",F=o.paint.get(k),B=F.constantOr(1),q=o.getCrossfadeParameters(),ie=o.paint.get("fill-extrusion-opacity"),ee=F.constantOr(null);for(const ne of h){const X=i.getTile(ne),fe=X.getBucket(o);if(!fe)continue;const Ie=y.style.map.terrain&&y.style.map.terrain.getTerrainData(ne),le=fe.programConfigurations.get(o.id),we=y.useProgram(B?"fillExtrusionPattern":"fillExtrusion",le);B&&(y.context.activeTexture.set(C.TEXTURE0),X.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),le.updatePaintBuffers(q)),wa(le,k,ee,X,o);const Ae=y.translatePosMatrix(ne.posMatrix,X,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),ke=o.paint.get("fill-extrusion-vertical-gradient"),Oe=B?ae(Ae,y,ke,ie,ne,q,X):V(Ae,y,ke,ie);we.draw(E,E.gl.TRIANGLES,p,_,S,Ji.backCCW,Oe,Ie,o.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,o.paint,y.transform.zoom,le,y.style.map.terrain&&fe.centroidVertexBuffer)}}function as(y,i,o,h,p,_,S){const E=y.context,C=E.gl,k=o.fbo;if(!k)return;const F=y.useProgram("hillshade"),B=y.style.map.terrain&&y.style.map.terrain.getTerrainData(i);E.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,k.colorAttachment.get()),F.draw(E,C.TRIANGLES,p,_,S,Ji.disabled,((q,ie,ee,ne)=>{const X=ee.paint.get("hillshade-shadow-color"),fe=ee.paint.get("hillshade-highlight-color"),Ie=ee.paint.get("hillshade-accent-color");let le=ee.paint.get("hillshade-illumination-direction")*(Math.PI/180);ee.paint.get("hillshade-illumination-anchor")==="viewport"&&(le-=q.transform.angle);const we=!q.options.moving;return{u_matrix:ne?ne.posMatrix:q.transform.calculatePosMatrix(ie.tileID.toUnwrapped(),we),u_image:0,u_latrange:pr(0,ie.tileID),u_light:[ee.paint.get("hillshade-exaggeration"),le],u_shadow:X,u_highlight:fe,u_accent:Ie}})(y,o,h,B?i:null),B,h.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}function Ol(y,i,o,h,p,_){const S=y.context,E=S.gl,C=i.dem;if(C&&C.data){const k=C.dim,F=C.stride,B=C.getPixels();if(S.activeTexture.set(E.TEXTURE1),S.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||y.getTileTexture(F),i.demTexture){const ie=i.demTexture;ie.update(B,{premultiply:!1}),ie.bind(E.NEAREST,E.CLAMP_TO_EDGE)}else i.demTexture=new Rt(S,B,E.RGBA,{premultiply:!1}),i.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE);S.activeTexture.set(E.TEXTURE0);let q=i.fbo;if(!q){const ie=new Rt(S,{width:k,height:k,data:null},E.RGBA);ie.bind(E.LINEAR,E.CLAMP_TO_EDGE),q=i.fbo=S.createFramebuffer(k,k,!0,!1),q.colorAttachment.set(ie.texture)}S.bindFramebuffer.set(q.framebuffer),S.viewport.set([0,0,k,k]),y.useProgram("hillshadePrepare").draw(S,E.TRIANGLES,h,p,_,Ji.disabled,((ie,ee)=>{const ne=ee.stride,X=l.F();return l.aN(X,0,l.W,-l.W,0,0,1),l.H(X,X,[0,-l.W,0]),{u_matrix:X,u_image:1,u_dimension:[ne,ne],u_zoom:ie.overscaledZ,u_unpack:ee.getUnpackVector()}})(i.tileID,C),null,o.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments),i.needsHillshadePrepare=!1}}function sa(y,i,o,h,p,_){const S=h.paint.get("raster-fade-duration");if(!_&&S>0){const E=D.now(),C=(E-y.timeAdded)/S,k=i?(E-i.timeAdded)/S:-1,F=o.getSource(),B=p.coveringZoomLevel({tileSize:F.tileSize,roundZoom:F.roundZoom}),q=!i||Math.abs(i.tileID.overscaledZ-B)>Math.abs(y.tileID.overscaledZ-B),ie=q&&y.refreshedUponExpiration?1:l.ac(q?C:1-k,0,1);return y.refreshedUponExpiration&&C>=1&&(y.refreshedUponExpiration=!1),i?{opacity:1,mix:1-ie}:{opacity:ie,mix:0}}return{opacity:1,mix:0}}const Fl=new l.aO(1,0,0,1),Qo=new l.aO(0,1,0,1),ja=new l.aO(0,0,1,1),Bl=new l.aO(1,0,1,1),Nl=new l.aO(0,1,1,1);function fr(y,i,o,h){jr(y,0,i+o/2,y.transform.width,o,h)}function js(y,i,o,h){jr(y,i-o/2,0,o,y.transform.height,h)}function jr(y,i,o,h,p,_){const S=y.context,E=S.gl;E.enable(E.SCISSOR_TEST),E.scissor(i*y.pixelRatio,o*y.pixelRatio,h*y.pixelRatio,p*y.pixelRatio),S.clear({color:_}),E.disable(E.SCISSOR_TEST)}function el(y,i,o){const h=y.context,p=h.gl,_=o.posMatrix,S=y.useProgram("debug"),E=fi.disabled,C=$i.disabled,k=y.colorModeForRenderPass(),F="$debug",B=y.style.map.terrain&&y.style.map.terrain.getTerrainData(o);h.activeTexture.set(p.TEXTURE0);const q=i.getTileByID(o.key).latestRawTileData,ie=Math.floor((q&&q.byteLength||0)/1024),ee=i.getTile(o).tileSize,ne=512/Math.min(ee,512)*(o.overscaledZ/y.transform.zoom)*.5;let X=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(X+=` => ${o.overscaledZ}`),function(fe,Ie){fe.initDebugOverlayCanvas();const le=fe.debugOverlayCanvas,we=fe.context.gl,Ae=fe.debugOverlayCanvas.getContext("2d");Ae.clearRect(0,0,le.width,le.height),Ae.shadowColor="white",Ae.shadowBlur=2,Ae.lineWidth=1.5,Ae.strokeStyle="white",Ae.textBaseline="top",Ae.font="bold 36px Open Sans, sans-serif",Ae.fillText(Ie,5,5),Ae.strokeText(Ie,5,5),fe.debugOverlayTexture.update(le),fe.debugOverlayTexture.bind(we.LINEAR,we.CLAMP_TO_EDGE)}(y,`${X} ${ie}kB`),S.draw(h,p.TRIANGLES,E,C,er.alphaBlended,Ji.disabled,Mt(_,l.aO.transparent,ne),null,F,y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),S.draw(h,p.LINE_STRIP,E,C,k,Ji.disabled,Mt(_,l.aO.red),B,F,y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}function tl(y,i,o){const h=y.context,p=h.gl,_=y.colorModeForRenderPass(),S=new fi(p.LEQUAL,fi.ReadWrite,y.depthRangeFor3D),E=y.useProgram("terrain"),C=i.getTerrainMesh();h.bindFramebuffer.set(null),h.viewport.set([0,0,y.width,y.height]);for(const k of o){const F=y.renderToTexture.getTexture(k),B=i.getTerrainData(k.tileID);h.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,F.texture);const q={u_matrix:y.transform.calculatePosMatrix(k.tileID.toUnwrapped()),u_texture:0,u_ele_delta:i.getMeshFrameDelta(y.transform.zoom)};E.draw(h,p.TRIANGLES,S,$i.disabled,_,Ji.backCCW,q,B,"terrain",C.vertexBuffer,C.indexBuffer,C.segments)}}class Ee{constructor(i,o){this.context=new Vs(i),this.transform=o,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Sr.maxUnderzooming+Sr.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ta}resize(i,o,h){if(this.width=Math.floor(i*h),this.height=Math.floor(o*h),this.pixelRatio=h,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style._order)this.style._layers[p].resize()}setup(){const i=this.context,o=new l.aV;o.emplaceBack(0,0),o.emplaceBack(l.W,0),o.emplaceBack(0,l.W),o.emplaceBack(l.W,l.W),this.tileExtentBuffer=i.createVertexBuffer(o,ho.members),this.tileExtentSegments=l.$.simpleSegment(0,0,4,2);const h=new l.aV;h.emplaceBack(0,0),h.emplaceBack(l.W,0),h.emplaceBack(0,l.W),h.emplaceBack(l.W,l.W),this.debugBuffer=i.createVertexBuffer(h,ho.members),this.debugSegments=l.$.simpleSegment(0,0,4,5);const p=new l.Z;p.emplaceBack(0,0,0,0),p.emplaceBack(l.W,0,l.W,0),p.emplaceBack(0,l.W,0,l.W),p.emplaceBack(l.W,l.W,l.W,l.W),this.rasterBoundsBuffer=i.createVertexBuffer(p,Be.members),this.rasterBoundsSegments=l.$.simpleSegment(0,0,4,2);const _=new l.aV;_.emplaceBack(0,0),_.emplaceBack(1,0),_.emplaceBack(0,1),_.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(_,ho.members),this.viewportSegments=l.$.simpleSegment(0,0,4,2);const S=new l.aW;S.emplaceBack(0),S.emplaceBack(1),S.emplaceBack(3),S.emplaceBack(2),S.emplaceBack(0),this.tileBorderIndexBuffer=i.createIndexBuffer(S);const E=new l.aX;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(E);const C=this.context.gl;this.stencilClearMode=new $i({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO)}clearStencil(){const i=this.context,o=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const h=l.F();l.aN(h,0,this.width,this.height,0,0,1),l.J(h,h,[o.drawingBufferWidth,o.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(i,o.TRIANGLES,fi.disabled,this.stencilClearMode,er.disabled,Ji.disabled,ft(h),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(i,o){if(this.currentStencilSource===i.source||!i.isTileClipped()||!o||!o.length)return;this.currentStencilSource=i.source;const h=this.context,p=h.gl;this.nextStencilID+o.length>256&&this.clearStencil(),h.setColorMode(er.disabled),h.setDepthMode(fi.disabled);const _=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of o){const E=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,C=this.style.map.terrain&&this.style.map.terrain.getTerrainData(S);_.draw(h,p.TRIANGLES,fi.disabled,new $i({func:p.ALWAYS,mask:0},E,255,p.KEEP,p.KEEP,p.REPLACE),er.disabled,Ji.disabled,ft(S.posMatrix),C,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,o=this.context.gl;return new $i({func:o.NOTEQUAL,mask:255},i,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(i){const o=this.context.gl;return new $i({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(i){const o=this.context.gl,h=i.sort((S,E)=>E.overscaledZ-S.overscaledZ),p=h[h.length-1].overscaledZ,_=h[0].overscaledZ-p+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const S={};for(let E=0;E<_;E++)S[E+p]=new $i({func:o.GEQUAL,mask:255},E+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=_,[S,h]}return[{[p]:$i.disabled},h]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new er([i.CONSTANT_COLOR,i.ONE],new l.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?er.unblended:er.alphaBlended}depthModeForSublayer(i,o,h){if(!this.opaquePassEnabledForLayer())return fi.disabled;const p=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new fi(h||this.context.gl.LEQUAL,o,[p,p])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,o){this.style=i,this.options=o,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(D.now()),this.imageManager.beginFrame();const h=this.style._order,p=this.style.sourceCaches,_={},S={},E={};for(const C in p){const k=p[C];k.used&&k.prepare(this.context),_[C]=k.getVisibleCoordinates(),S[C]=_[C].slice().reverse(),E[C]=k.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let C=0;C<h.length;C++)if(this.style._layers[h[C]].is3D()){this.opaquePassCutoff=C;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const C of h){const k=this.style._layers[C];if(!k.hasOffscreenPass()||k.isHidden(this.transform.zoom))continue;const F=S[k.source];(k.type==="custom"||F.length)&&this.renderLayer(this,p[k.source],k,F)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:o.showOverdrawInspector?l.aO.black:l.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.depthRangeFor3D=[0,1-(i._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){const C=this.style._layers[h[this.currentLayer]],k=p[C.source],F=_[C.source];this._renderTileClippingMasks(C,F),this.renderLayer(this,k,C,F)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){const C=this.style._layers[h[this.currentLayer]],k=p[C.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(C))continue;const F=(C.type==="symbol"?E:S)[C.source];this._renderTileClippingMasks(C,_[C.source]),this.renderLayer(this,k,C,F)}if(this.options.showTileBoundaries){const C=function(k,F){let B=null;const q=Object.values(k._layers).flatMap(X=>X.source&&!X.isHidden(F)?[k.sourceCaches[X.source]]:[]),ie=q.filter(X=>X.getSource().type==="vector"),ee=q.filter(X=>X.getSource().type!=="vector"),ne=X=>{(!B||B.getSource().maxzoom<X.getSource().maxzoom)&&(B=X)};return ie.forEach(X=>ne(X)),B||ee.forEach(X=>ne(X)),B}(this.style,this.transform.zoom);C&&function(k,F,B){for(let q=0;q<B.length;q++)el(k,F,B[q])}(this,C,C.getVisibleCoordinates())}this.options.showPadding&&function(C){const k=C.transform.padding;fr(C,C.transform.height-(k.top||0),3,Fl),fr(C,k.bottom||0,3,Qo),js(C,k.left||0,3,ja),js(C,C.transform.width-(k.right||0),3,Bl);const F=C.transform.centerPoint;(function(B,q,ie,ee){jr(B,q-1,ie-10,2,20,ee),jr(B,q-10,ie-1,20,2,ee)})(C,F.x,C.transform.height-F.y,Nl)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(i){if(!this.style||!this.style.map||!this.style.map.terrain)return;const o=this.terrainFacilitator.matrix,h=this.transform.projMatrix;let p=this.terrainFacilitator.dirty;p||(p=i?!l.aY(o,h):!l.aZ(o,h)),p||(p=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),p&&(l.a_(o,h),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(_,S){const E=_.context,C=E.gl,k=er.unblended,F=new fi(C.LEQUAL,fi.ReadWrite,[0,1]),B=S.getTerrainMesh(),q=S.sourceCache.getRenderableTiles(),ie=_.useProgram("terrainDepth");E.bindFramebuffer.set(S.getFramebuffer("depth").framebuffer),E.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),E.clear({color:l.aO.transparent,depth:1});for(const ee of q){const ne=S.getTerrainData(ee.tileID),X={u_matrix:_.transform.calculatePosMatrix(ee.tileID.toUnwrapped()),u_ele_delta:S.getMeshFrameDelta(_.transform.zoom)};ie.draw(E,C.TRIANGLES,F,$i.disabled,k,Ji.backCCW,X,ne,"terrain",B.vertexBuffer,B.indexBuffer,B.segments)}E.bindFramebuffer.set(null),E.viewport.set([0,0,_.width,_.height])}(this,this.style.map.terrain),function(_,S){const E=_.context,C=E.gl,k=er.unblended,F=new fi(C.LEQUAL,fi.ReadWrite,[0,1]),B=S.getTerrainMesh(),q=S.getCoordsTexture(),ie=S.sourceCache.getRenderableTiles(),ee=_.useProgram("terrainCoords");E.bindFramebuffer.set(S.getFramebuffer("coords").framebuffer),E.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),E.clear({color:l.aO.transparent,depth:1}),S.coordsIndex=[];for(const ne of ie){const X=S.getTerrainData(ne.tileID);E.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,q.texture);const fe={u_matrix:_.transform.calculatePosMatrix(ne.tileID.toUnwrapped()),u_terrain_coords_id:(255-S.coordsIndex.length)/255,u_texture:0,u_ele_delta:S.getMeshFrameDelta(_.transform.zoom)};ee.draw(E,C.TRIANGLES,F,$i.disabled,k,Ji.backCCW,fe,X,"terrain",B.vertexBuffer,B.indexBuffer,B.segments),S.coordsIndex.push(ne.tileID.key)}E.bindFramebuffer.set(null),E.viewport.set([0,0,_.width,_.height])}(this,this.style.map.terrain))}renderLayer(i,o,h,p){if(!h.isHidden(this.transform.zoom)&&(h.type==="background"||h.type==="custom"||(p||[]).length))switch(this.id=h.id,h.type){case"symbol":(function(_,S,E,C,k){if(_.renderPass!=="translucent")return;const F=$i.disabled,B=_.colorModeForRenderPass();(E._unevaluatedLayout.hasValue("text-variable-anchor")||E._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(q,ie,ee,ne,X,fe,Ie){const le=ie.transform,we=X==="map",Ae=fe==="map";for(const ke of q){const Oe=ne.getTile(ke),We=Oe.getBucket(ee);if(!We||!We.text||!We.text.segments.get().length)continue;const He=l.ag(We.textSizeData,le.zoom),st=si(Oe,1,ie.transform.zoom),ht=ri(ke.posMatrix,Ae,we,ie.transform,st),di=ee.layout.get("icon-text-fit")!=="none"&&We.hasIconData();if(He){const yt=Math.pow(2,le.zoom-Oe.tileID.overscaledZ);Ko(We,we,Ae,Ie,le,ht,ke.posMatrix,yt,He,di,ie.style.map.terrain?(ei,pi)=>ie.style.map.terrain.getElevation(ke,ei,pi):null)}}}(C,_,E,S,E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),k),E.paint.get("icon-opacity").constantOr(1)!==0&&go(_,S,E,C,!1,E.paint.get("icon-translate"),E.paint.get("icon-translate-anchor"),E.layout.get("icon-rotation-alignment"),E.layout.get("icon-pitch-alignment"),E.layout.get("icon-keep-upright"),F,B),E.paint.get("text-opacity").constantOr(1)!==0&&go(_,S,E,C,!0,E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),E.layout.get("text-keep-upright"),F,B),S.map.showCollisionBoxes&&(na(_,S,E,C,E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),!0),na(_,S,E,C,E.paint.get("icon-translate"),E.paint.get("icon-translate-anchor"),!1))})(i,o,h,p,this.style.placement.variableOffsets);break;case"circle":(function(_,S,E,C){if(_.renderPass!=="translucent")return;const k=E.paint.get("circle-opacity"),F=E.paint.get("circle-stroke-width"),B=E.paint.get("circle-stroke-opacity"),q=!E.layout.get("circle-sort-key").isConstant();if(k.constantOr(1)===0&&(F.constantOr(1)===0||B.constantOr(1)===0))return;const ie=_.context,ee=ie.gl,ne=_.depthModeForSublayer(0,fi.ReadOnly),X=$i.disabled,fe=_.colorModeForRenderPass(),Ie=[];for(let le=0;le<C.length;le++){const we=C[le],Ae=S.getTile(we),ke=Ae.getBucket(E);if(!ke)continue;const Oe=ke.programConfigurations.get(E.id),We=_.useProgram("circle",Oe),He=ke.layoutVertexBuffer,st=ke.indexBuffer,ht=_.style.map.terrain&&_.style.map.terrain.getTerrainData(we),di={programConfiguration:Oe,program:We,layoutVertexBuffer:He,indexBuffer:st,uniformValues:ot(_,we,Ae,E),terrainData:ht};if(q){const yt=ke.segments.get();for(const ei of yt)Ie.push({segments:new l.$([ei]),sortKey:ei.sortKey,state:di})}else Ie.push({segments:ke.segments,sortKey:0,state:di})}q&&Ie.sort((le,we)=>le.sortKey-we.sortKey);for(const le of Ie){const{programConfiguration:we,program:Ae,layoutVertexBuffer:ke,indexBuffer:Oe,uniformValues:We,terrainData:He}=le.state;Ae.draw(ie,ee.TRIANGLES,ne,X,fe,Ji.disabled,We,He,E.id,ke,Oe,le.segments,E.paint,_.transform.zoom,we)}})(i,o,h,p);break;case"heatmap":(function(_,S,E,C){if(E.paint.get("heatmap-opacity")!==0)if(_.renderPass==="offscreen"){const k=_.context,F=k.gl,B=$i.disabled,q=new er([F.ONE,F.ONE],l.aO.transparent,[!0,!0,!0,!0]);(function(ie,ee,ne){const X=ie.gl;ie.activeTexture.set(X.TEXTURE1),ie.viewport.set([0,0,ee.width/4,ee.height/4]);let fe=ne.heatmapFbo;if(fe)X.bindTexture(X.TEXTURE_2D,fe.colorAttachment.get()),ie.bindFramebuffer.set(fe.framebuffer);else{const Ie=X.createTexture();X.bindTexture(X.TEXTURE_2D,Ie),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MAG_FILTER,X.LINEAR),fe=ne.heatmapFbo=ie.createFramebuffer(ee.width/4,ee.height/4,!1,!1),function(le,we,Ae,ke){var Oe,We;const He=le.gl,st=(Oe=le.HALF_FLOAT)!==null&&Oe!==void 0?Oe:He.UNSIGNED_BYTE,ht=(We=le.RGBA16F)!==null&&We!==void 0?We:He.RGBA;He.texImage2D(He.TEXTURE_2D,0,ht,we.width/4,we.height/4,0,He.RGBA,st,null),ke.colorAttachment.set(Ae)}(ie,ee,Ie,fe)}})(k,_,E),k.clear({color:l.aO.transparent});for(let ie=0;ie<C.length;ie++){const ee=C[ie];if(S.hasRenderableParent(ee))continue;const ne=S.getTile(ee),X=ne.getBucket(E);if(!X)continue;const fe=X.programConfigurations.get(E.id),Ie=_.useProgram("heatmap",fe),{zoom:le}=_.transform;Ie.draw(k,F.TRIANGLES,fi.disabled,B,q,Ji.disabled,oi(ee.posMatrix,ne,le,E.paint.get("heatmap-intensity")),null,E.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,E.paint,_.transform.zoom,fe)}k.viewport.set([0,0,_.width,_.height])}else _.renderPass==="translucent"&&(_.context.setColorMode(_.colorModeForRenderPass()),function(k,F){const B=k.context,q=B.gl,ie=F.heatmapFbo;if(!ie)return;B.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_2D,ie.colorAttachment.get()),B.activeTexture.set(q.TEXTURE1);let ee=F.colorRampTexture;ee||(ee=F.colorRampTexture=new Rt(B,F.colorRamp,q.RGBA)),ee.bind(q.LINEAR,q.CLAMP_TO_EDGE),k.useProgram("heatmapTexture").draw(B,q.TRIANGLES,fi.disabled,$i.disabled,k.colorModeForRenderPass(),Ji.disabled,((ne,X,fe,Ie)=>{const le=l.F();l.aN(le,0,ne.width,ne.height,0,0,1);const we=ne.context.gl;return{u_matrix:le,u_world:[we.drawingBufferWidth,we.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:X.paint.get("heatmap-opacity")}})(k,F),null,F.id,k.viewportBuffer,k.quadTriangleIndexBuffer,k.viewportSegments,F.paint,k.transform.zoom)}(_,E))})(i,o,h,p);break;case"line":(function(_,S,E,C){if(_.renderPass!=="translucent")return;const k=E.paint.get("line-opacity"),F=E.paint.get("line-width");if(k.constantOr(1)===0||F.constantOr(1)===0)return;const B=_.depthModeForSublayer(0,fi.ReadOnly),q=_.colorModeForRenderPass(),ie=E.paint.get("line-dasharray"),ee=E.paint.get("line-pattern"),ne=ee.constantOr(1),X=E.paint.get("line-gradient"),fe=E.getCrossfadeParameters(),Ie=ne?"linePattern":ie?"lineSDF":X?"lineGradient":"line",le=_.context,we=le.gl;let Ae=!0;for(const ke of C){const Oe=S.getTile(ke);if(ne&&!Oe.patternsLoaded())continue;const We=Oe.getBucket(E);if(!We)continue;const He=We.programConfigurations.get(E.id),st=_.context.program.get(),ht=_.useProgram(Ie,He),di=Ae||ht.program!==st,yt=_.style.map.terrain&&_.style.map.terrain.getTerrainData(ke),ei=ee.constantOr(null);if(ei&&Oe.imageAtlas){const ai=Oe.imageAtlas,mi=ai.patternPositions[ei.to.toString()],bi=ai.patternPositions[ei.from.toString()];mi&&bi&&He.setConstantPatternPositions(mi,bi)}const pi=yt?ke:null,Li=ne?je(_,Oe,E,fe,pi):ie?Ft(_,Oe,E,ie,fe,pi):X?Rr(_,Oe,E,We.lineClipsArray.length,pi):ui(_,Oe,E,pi);if(ne)le.activeTexture.set(we.TEXTURE0),Oe.imageAtlasTexture.bind(we.LINEAR,we.CLAMP_TO_EDGE),He.updatePaintBuffers(fe);else if(ie&&(di||_.lineAtlas.dirty))le.activeTexture.set(we.TEXTURE0),_.lineAtlas.bind(le);else if(X){const ai=We.gradients[E.id];let mi=ai.texture;if(E.gradientVersion!==ai.version){let bi=256;if(E.stepInterpolant){const Or=S.getSource().maxzoom,Qi=ke.canonical.z===Or?Math.ceil(1<<_.transform.maxZoom-ke.canonical.z):1;bi=l.ac(l.aT(We.maxLineLength/l.W*1024*Qi),256,le.maxTextureSize)}ai.gradient=l.aU({expression:E.gradientExpression(),evaluationKey:"lineProgress",resolution:bi,image:ai.gradient||void 0,clips:We.lineClipsArray}),ai.texture?ai.texture.update(ai.gradient):ai.texture=new Rt(le,ai.gradient,we.RGBA),ai.version=E.gradientVersion,mi=ai.texture}le.activeTexture.set(we.TEXTURE0),mi.bind(E.stepInterpolant?we.NEAREST:we.LINEAR,we.CLAMP_TO_EDGE)}ht.draw(le,we.TRIANGLES,B,_.stencilModeForClipping(ke),q,Ji.disabled,Li,yt,E.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,E.paint,_.transform.zoom,He,We.layoutVertexBuffer2),Ae=!1}})(i,o,h,p);break;case"fill":(function(_,S,E,C){const k=E.paint.get("fill-color"),F=E.paint.get("fill-opacity");if(F.constantOr(1)===0)return;const B=_.colorModeForRenderPass(),q=E.paint.get("fill-pattern"),ie=_.opaquePassEnabledForLayer()&&!q.constantOr(1)&&k.constantOr(l.aO.transparent).a===1&&F.constantOr(0)===1?"opaque":"translucent";if(_.renderPass===ie){const ee=_.depthModeForSublayer(1,_.renderPass==="opaque"?fi.ReadWrite:fi.ReadOnly);Ma(_,S,E,C,ee,B,!1)}if(_.renderPass==="translucent"&&E.paint.get("fill-antialias")){const ee=_.depthModeForSublayer(E.getPaintProperty("fill-outline-color")?2:0,fi.ReadOnly);Ma(_,S,E,C,ee,B,!0)}})(i,o,h,p);break;case"fill-extrusion":(function(_,S,E,C){const k=E.paint.get("fill-extrusion-opacity");if(k!==0&&_.renderPass==="translucent"){const F=new fi(_.context.gl.LEQUAL,fi.ReadWrite,_.depthRangeFor3D);if(k!==1||E.paint.get("fill-extrusion-pattern").constantOr(1))Jo(_,S,E,C,F,$i.disabled,er.disabled),Jo(_,S,E,C,F,_.stencilModeFor3D(),_.colorModeForRenderPass());else{const B=_.colorModeForRenderPass();Jo(_,S,E,C,F,$i.disabled,B)}}})(i,o,h,p);break;case"hillshade":(function(_,S,E,C){if(_.renderPass!=="offscreen"&&_.renderPass!=="translucent")return;const k=_.context,F=_.depthModeForSublayer(0,fi.ReadOnly),B=_.colorModeForRenderPass(),[q,ie]=_.renderPass==="translucent"?_.stencilConfigForOverlap(C):[{},C];for(const ee of ie){const ne=S.getTile(ee);ne.needsHillshadePrepare!==void 0&&ne.needsHillshadePrepare&&_.renderPass==="offscreen"?Ol(_,ne,E,F,$i.disabled,B):_.renderPass==="translucent"&&as(_,ee,ne,E,F,q[ee.overscaledZ],B)}k.viewport.set([0,0,_.width,_.height])})(i,o,h,p);break;case"raster":(function(_,S,E,C){if(_.renderPass!=="translucent"||E.paint.get("raster-opacity")===0||!C.length)return;const k=_.context,F=k.gl,B=S.getSource(),q=_.useProgram("raster"),ie=_.colorModeForRenderPass(),[ee,ne]=B instanceof rt?[{},C]:_.stencilConfigForOverlap(C),X=ne[ne.length-1].overscaledZ,fe=!_.options.moving;for(const Ie of ne){const le=_.depthModeForSublayer(Ie.overscaledZ-X,E.paint.get("raster-opacity")===1?fi.ReadWrite:fi.ReadOnly,F.LESS),we=S.getTile(Ie);we.registerFadeDuration(E.paint.get("raster-fade-duration"));const Ae=S.findLoadedParent(Ie,0),ke=sa(we,Ae,S,E,_.transform,_.style.map.terrain);let Oe,We;const He=E.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;k.activeTexture.set(F.TEXTURE0),we.texture.bind(He,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),k.activeTexture.set(F.TEXTURE1),Ae?(Ae.texture.bind(He,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),Oe=Math.pow(2,Ae.tileID.overscaledZ-we.tileID.overscaledZ),We=[we.tileID.canonical.x*Oe%1,we.tileID.canonical.y*Oe%1]):we.texture.bind(He,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST);const st=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Ie),ht=st?Ie:null,di=ht?ht.posMatrix:_.transform.calculatePosMatrix(Ie.toUnwrapped(),fe),yt=vr(di,We||[0,0],Oe||1,ke,E);B instanceof rt?q.draw(k,F.TRIANGLES,le,$i.disabled,ie,Ji.disabled,yt,st,E.id,B.boundsBuffer,_.quadTriangleIndexBuffer,B.boundsSegments):q.draw(k,F.TRIANGLES,le,ee[Ie.overscaledZ],ie,Ji.disabled,yt,st,E.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments)}})(i,o,h,p);break;case"background":(function(_,S,E,C){const k=E.paint.get("background-color"),F=E.paint.get("background-opacity");if(F===0)return;const B=_.context,q=B.gl,ie=_.transform,ee=ie.tileSize,ne=E.paint.get("background-pattern");if(_.isPatternMissing(ne))return;const X=!ne&&k.a===1&&F===1&&_.opaquePassEnabledForLayer()?"opaque":"translucent";if(_.renderPass!==X)return;const fe=$i.disabled,Ie=_.depthModeForSublayer(0,X==="opaque"?fi.ReadWrite:fi.ReadOnly),le=_.colorModeForRenderPass(),we=_.useProgram(ne?"backgroundPattern":"background"),Ae=C||ie.coveringTiles({tileSize:ee,terrain:_.style.map.terrain});ne&&(B.activeTexture.set(q.TEXTURE0),_.imageManager.bind(_.context));const ke=E.getCrossfadeParameters();for(const Oe of Ae){const We=C?Oe.posMatrix:_.transform.calculatePosMatrix(Oe.toUnwrapped()),He=ne?Ns(We,F,_,ne,{tileID:Oe,tileSize:ee},ke):xu(We,F,k),st=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Oe);we.draw(B,q.TRIANGLES,Ie,fe,le,Ji.disabled,He,st,E.id,_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}})(i,0,h,p);break;case"custom":(function(_,S,E){const C=_.context,k=E.implementation;if(_.renderPass==="offscreen"){const F=k.prerender;F&&(_.setCustomLayerDefaults(),C.setColorMode(_.colorModeForRenderPass()),F.call(k,C.gl,_.transform.customLayerMatrix()),C.setDirty(),_.setBaseState())}else if(_.renderPass==="translucent"){_.setCustomLayerDefaults(),C.setColorMode(_.colorModeForRenderPass()),C.setStencilMode($i.disabled);const F=k.renderingMode==="3d"?new fi(_.context.gl.LEQUAL,fi.ReadWrite,_.depthRangeFor3D):_.depthModeForSublayer(0,fi.ReadOnly);C.setDepthMode(F),k.render(C.gl,_.transform.customLayerMatrix()),C.setDirty(),_.setBaseState(),C.bindFramebuffer.set(null)}})(i,0,h)}}translatePosMatrix(i,o,h,p,_){if(!h[0]&&!h[1])return i;const S=_?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(S){const k=Math.sin(S),F=Math.cos(S);h=[h[0]*F-h[1]*k,h[0]*k+h[1]*F]}const E=[_?h[0]:si(o,h[0],this.transform.zoom),_?h[1]:si(o,h[1],this.transform.zoom),0],C=new Float32Array(16);return l.H(C,i,E),C}saveTileTexture(i){const o=this._tileTextures[i.size[0]];o?o.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const o=this._tileTextures[i];return o&&o.length>0?o.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const o=this.imageManager.getPattern(i.from.toString()),h=this.imageManager.getPattern(i.to.toString());return!o||!h}useProgram(i,o){this.cache=this.cache||{};const h=i+(o?o.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[h]||(this.cache[h]=new b(this.context,po[i],o,Il[i],this._showOverdrawInspector,this.style.map.terrain)),this.cache[h]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Rt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:i,drawingBufferHeight:o}=this.context.gl;return this.width!==i||this.height!==o}}class Re{constructor(i,o){this.points=i,this.planes=o}static fromInvProjectionMatrix(i,o,h){const p=Math.pow(2,h),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const C=1/(E=l.af([],E,i))[3]/o*p;return l.a$(E,E,[C,C,1/E[3],C])}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const C=function(q,ie){var ee=ie[0],ne=ie[1],X=ie[2],fe=ee*ee+ne*ne+X*X;return fe>0&&(fe=1/Math.sqrt(fe)),q[0]=ie[0]*fe,q[1]=ie[1]*fe,q[2]=ie[2]*fe,q}([],function(q,ie,ee){var ne=ie[0],X=ie[1],fe=ie[2],Ie=ee[0],le=ee[1],we=ee[2];return q[0]=X*we-fe*le,q[1]=fe*Ie-ne*we,q[2]=ne*le-X*Ie,q}([],bt([],_[E[0]],_[E[1]]),bt([],_[E[2]],_[E[1]]))),k=-((F=C)[0]*(B=_[E[1]])[0]+F[1]*B[1]+F[2]*B[2]);var F,B;return C.concat(k)});return new Re(_,S)}}class mt{constructor(i,o){this.min=i,this.max=o,this.center=function(h,p,_){return h[0]=.5*p[0],h[1]=.5*p[1],h[2]=.5*p[2],h}([],function(h,p,_){return h[0]=p[0]+_[0],h[1]=p[1]+_[1],h[2]=p[2]+_[2],h}([],this.min,this.max))}quadrant(i){const o=[i%2==0,i<2],h=Ke(this.min),p=Ke(this.max);for(let _=0;_<o.length;_++)h[_]=o[_]?this.min[_]:this.center[_],p[_]=o[_]?this.center[_]:this.max[_];return p[2]=this.max[2],new mt(h,p)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}intersects(i){const o=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let h=!0;for(let p=0;p<i.planes.length;p++){const _=i.planes[p];let S=0;for(let E=0;E<o.length;E++)l.b0(_,o[E])>=0&&S++;if(S===0)return 0;S!==o.length&&(h=!1)}if(h)return 2;for(let p=0;p<3;p++){let _=Number.MAX_VALUE,S=-Number.MAX_VALUE;for(let E=0;E<i.points.length;E++){const C=i.points[E][p]-this.min[p];_=Math.min(_,C),S=Math.max(S,C)}if(S<0||_>this.max[p]-this.min[p])return 0}return 1}}class Wt{constructor(i=0,o=0,h=0,p=0){if(isNaN(i)||i<0||isNaN(o)||o<0||isNaN(h)||h<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=o,this.left=h,this.right=p}interpolate(i,o,h){return o.top!=null&&i.top!=null&&(this.top=l.z.number(i.top,o.top,h)),o.bottom!=null&&i.bottom!=null&&(this.bottom=l.z.number(i.bottom,o.bottom,h)),o.left!=null&&i.left!=null&&(this.left=l.z.number(i.left,o.left,h)),o.right!=null&&i.right!=null&&(this.right=l.z.number(i.right,o.right,h)),this}getCenter(i,o){const h=l.ac((this.left+i-this.right)/2,0,i),p=l.ac((this.top+o-this.bottom)/2,0,o);return new l.P(h,p)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new Wt(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const tr=85.051129;class Ci{constructor(i,o,h,p,_){this.tileSize=512,this._renderWorldCopies=_===void 0||!!_,this._minZoom=i||0,this._maxZoom=o||22,this._minPitch=h??0,this._maxPitch=p??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Wt,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const i=new Ci(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return i.apply(this),i}apply(i){this.tileSize=i.tileSize,this.latRange=i.latRange,this.width=i.width,this.height=i.height,this._center=i._center,this._elevation=i._elevation,this.minElevationForCurrentTile=i.minElevationForCurrentTile,this.zoom=i.zoom,this.angle=i.angle,this._fov=i._fov,this._pitch=i._pitch,this._unmodified=i._unmodified,this._edgeInsets=i._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(i){const o=-l.b1(i,-180,180)*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=function(){var h=new l.A(4);return l.A!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h}(),function(h,p,_){var S=p[0],E=p[1],C=p[2],k=p[3],F=Math.sin(_),B=Math.cos(_);h[0]=S*B+C*F,h[1]=E*B+k*F,h[2]=S*-F+C*B,h[3]=E*-F+k*B}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const o=l.ac(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(i){const o=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._zoom=o,this.tileZoom=Math.max(0,Math.floor(o)),this.scale=this.zoomScale(o),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(i){i!==this._elevation&&(this._elevation=i,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,o,h){this._unmodified=!1,this._edgeInsets.interpolate(i,o,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const o=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(i){const o=[new l.b2(0,i)];if(this._renderWorldCopies){const h=this.pointCoordinate(new l.P(0,0)),p=this.pointCoordinate(new l.P(this.width,0)),_=this.pointCoordinate(new l.P(this.width,this.height)),S=this.pointCoordinate(new l.P(0,this.height)),E=Math.floor(Math.min(h.x,p.x,_.x,S.x)),C=Math.floor(Math.max(h.x,p.x,_.x,S.x)),k=1;for(let F=E-k;F<=C+k;F++)F!==0&&o.push(new l.b2(F,i))}return o}coveringTiles(i){var o,h;let p=this.coveringZoomLevel(i);const _=p;if(i.minzoom!==void 0&&p<i.minzoom)return[];i.maxzoom!==void 0&&p>i.maxzoom&&(p=i.maxzoom);const S=this.pointCoordinate(this.getCameraPoint()),E=l.Y.fromLngLat(this.center),C=Math.pow(2,p),k=[C*S.x,C*S.y,0],F=[C*E.x,C*E.y,0],B=Re.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,p);let q=i.minzoom||0;!i.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(q=p);const ie=i.terrain?2/Math.min(this.tileSize,i.tileSize)*this.tileSize:3,ee=le=>({aabb:new mt([le*C,0,0],[(le+1)*C,C,0]),zoom:0,x:0,y:0,wrap:le,fullyVisible:!1}),ne=[],X=[],fe=p,Ie=i.reparseOverscaled?_:p;if(this._renderWorldCopies)for(let le=1;le<=3;le++)ne.push(ee(-le)),ne.push(ee(le));for(ne.push(ee(0));ne.length>0;){const le=ne.pop(),we=le.x,Ae=le.y;let ke=le.fullyVisible;if(!ke){const ht=le.aabb.intersects(B);if(ht===0)continue;ke=ht===2}const Oe=i.terrain?k:F,We=le.aabb.distanceX(Oe),He=le.aabb.distanceY(Oe),st=Math.max(Math.abs(We),Math.abs(He));if(le.zoom===fe||st>ie+(1<<fe-le.zoom)-2&&le.zoom>=q){const ht=fe-le.zoom,di=k[0]-.5-(we<<ht),yt=k[1]-.5-(Ae<<ht);X.push({tileID:new l.Q(le.zoom===fe?Ie:le.zoom,le.wrap,le.zoom,we,Ae),distanceSq:Pt([F[0]-.5-we,F[1]-.5-Ae]),tileDistanceToCamera:Math.sqrt(di*di+yt*yt)})}else for(let ht=0;ht<4;ht++){const di=(we<<1)+ht%2,yt=(Ae<<1)+(ht>>1),ei=le.zoom+1;let pi=le.aabb.quadrant(ht);if(i.terrain){const Li=new l.Q(ei,le.wrap,ei,di,yt),ai=i.terrain.getMinMaxElevation(Li),mi=(o=ai.minElevation)!==null&&o!==void 0?o:this.elevation,bi=(h=ai.maxElevation)!==null&&h!==void 0?h:this.elevation;pi=new mt([pi.min[0],pi.min[1],mi],[pi.max[0],pi.max[1],bi])}ne.push({aabb:pi,zoom:ei,x:di,y:yt,wrap:le.wrap,fullyVisible:ke})}}return X.sort((le,we)=>le.distanceSq-we.distanceSq).map(le=>le.tileID)}resize(i,o){this.width=i,this.height=o,this.pixelsToGLUnits=[2/i,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const o=l.ac(i.lat,-85.051129,tr);return new l.P(l.N(i.lng)*this.worldSize,l.O(o)*this.worldSize)}unproject(i){return new l.Y(i.x/this.worldSize,i.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(i){const o=this.elevation,h=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,p=this.pointLocation(this.centerPoint,i),_=i.getElevationForLngLatZoom(p,this.tileZoom);if(!(this.elevation-_))return;const S=h+o-_,E=Math.cos(this._pitch)*this.cameraToCenterDistance/S/l.b3(1,p.lat),C=this.scaleZoom(E/this.tileSize);this._elevation=_,this._center=p,this.zoom=C}setLocationAtPoint(i,o){const h=this.pointCoordinate(o),p=this.pointCoordinate(this.centerPoint),_=this.locationCoordinate(i),S=new l.Y(_.x-(h.x-p.x),_.y-(h.y-p.y));this.center=this.coordinateLocation(S),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(i,o){return o?this.coordinatePoint(this.locationCoordinate(i),o.getElevationForLngLatZoom(i,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(i))}pointLocation(i,o){return this.coordinateLocation(this.pointCoordinate(i,o))}locationCoordinate(i){return l.Y.fromLngLat(i)}coordinateLocation(i){return i&&i.toLngLat()}pointCoordinate(i,o){if(o){const q=o.pointCoordinate(i);if(q!=null)return q}const h=[i.x,i.y,0,1],p=[i.x,i.y,1,1];l.af(h,h,this.pixelMatrixInverse),l.af(p,p,this.pixelMatrixInverse);const _=h[3],S=p[3],E=h[1]/_,C=p[1]/S,k=h[2]/_,F=p[2]/S,B=k===F?0:(0-k)/(F-k);return new l.Y(l.z.number(h[0]/_,p[0]/S,B)/this.worldSize,l.z.number(E,C,B)/this.worldSize)}coordinatePoint(i,o=0,h=this.pixelMatrix){const p=[i.x*this.worldSize,i.y*this.worldSize,o,1];return l.af(p,p,h),new l.P(p[0]/p[3],p[1]/p[3])}getBounds(){const i=Math.max(0,this.height/2-this.getHorizon());return new ue().extend(this.pointLocation(new l.P(0,i))).extend(this.pointLocation(new l.P(this.width,i))).extend(this.pointLocation(new l.P(this.width,this.height))).extend(this.pointLocation(new l.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new ue([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(i){i?(this.lngRange=[i.getWest(),i.getEast()],this.latRange=[i.getSouth(),i.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,tr])}calculatePosMatrix(i,o=!1){const h=i.key,p=o?this._alignedPosMatrixCache:this._posMatrixCache;if(p[h])return p[h];const _=i.canonical,S=this.worldSize/this.zoomScale(_.z),E=_.x+Math.pow(2,_.z)*i.wrap,C=l.an(new Float64Array(16));return l.H(C,C,[E*S,_.y*S,0]),l.J(C,C,[S/l.W,S/l.W,1]),l.K(C,o?this.alignedProjMatrix:this.projMatrix,C),p[h]=new Float32Array(C),p[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(i,o){o=l.ac(+o,this.minZoom,this.maxZoom);const h={center:new l.M(i.lng,i.lat),zoom:o};let p=this.lngRange;if(!this._renderWorldCopies&&p===null){const le=179.9999999999;p=[-le,le]}const _=this.tileSize*this.zoomScale(h.zoom);let S=0,E=_,C=0,k=_,F=0,B=0;const{x:q,y:ie}=this.size;if(this.latRange){const le=this.latRange;S=l.O(le[1])*_,E=l.O(le[0])*_,E-S<ie&&(F=ie/(E-S))}p&&(C=l.b1(l.N(p[0])*_,0,_),k=l.b1(l.N(p[1])*_,0,_),k<C&&(k+=_),k-C<q&&(B=q/(k-C)));const{x:ee,y:ne}=this.project.call({worldSize:_},i);let X,fe;const Ie=Math.max(B||0,F||0);if(Ie){const le=new l.P(B?(k+C)/2:ee,F?(E+S)/2:ne);return h.center=this.unproject.call({worldSize:_},le).wrap(),h.zoom+=this.scaleZoom(Ie),h}if(this.latRange){const le=ie/2;ne-le<S&&(fe=S+le),ne+le>E&&(fe=E-le)}if(p){const le=(C+k)/2;let we=ee;this._renderWorldCopies&&(we=l.b1(ee,le-_/2,le+_/2));const Ae=q/2;we-Ae<C&&(X=C+Ae),we+Ae>k&&(X=k-Ae)}if(X!==void 0||fe!==void 0){const le=new l.P(X??ee,fe??ne);h.center=this.unproject.call({worldSize:_},le).wrap()}return h}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this._unmodified,{center:o,zoom:h}=this.getConstrained(this.center,this.zoom);this.center=o,this.zoom=h,this._unmodified=i,this._constraining=!1}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,o=this.point.x,h=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.b3(1,this.center.lat)*this.worldSize;let p=l.an(new Float64Array(16));l.J(p,p,[this.width/2,-this.height/2,1]),l.H(p,p,[1,-1,0]),this.labelPlaneMatrix=p,p=l.an(new Float64Array(16)),l.J(p,p,[1,-1,1]),l.H(p,p,[-1,-1,0]),l.J(p,p,[2/this.width,2/this.height,1]),this.glCoordMatrix=p;const _=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),S=Math.min(this.elevation,this.minElevationForCurrentTile),E=_-S*this._pixelPerMeter/Math.cos(this._pitch),C=S<0?E:_,k=Math.PI/2+this._pitch,F=this._fov*(.5+i.y/this.height),B=Math.sin(F)*C/Math.sin(l.ac(Math.PI-k-F,.01,Math.PI-.01)),q=this.getHorizon(),ie=2*Math.atan(q/this.cameraToCenterDistance)*(.5+i.y/(2*q)),ee=Math.sin(ie)*C/Math.sin(l.ac(Math.PI-k-ie,.01,Math.PI-.01)),ne=Math.min(B,ee),X=1.01*(Math.cos(Math.PI/2-this._pitch)*ne+C),fe=this.height/50;p=new Float64Array(16),l.b4(p,this._fov,this.width/this.height,fe,X),p[8]=2*-i.x/this.width,p[9]=2*i.y/this.height,l.J(p,p,[1,-1,1]),l.H(p,p,[0,0,-this.cameraToCenterDistance]),l.b5(p,p,this._pitch),l.ad(p,p,this.angle),l.H(p,p,[-o,-h,0]),this.mercatorMatrix=l.J([],p,[this.worldSize,this.worldSize,this.worldSize]),l.J(p,p,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.K(new Float64Array(16),this.labelPlaneMatrix,p),l.H(p,p,[0,0,-this.elevation]),this.projMatrix=p,this.invProjMatrix=l.ar([],p),this.pixelMatrix3D=l.K(new Float64Array(16),this.labelPlaneMatrix,p);const Ie=this.width%2/2,le=this.height%2/2,we=Math.cos(this.angle),Ae=Math.sin(this.angle),ke=o-Math.round(o)+we*Ie+Ae*le,Oe=h-Math.round(h)+we*le+Ae*Ie,We=new Float64Array(p);if(l.H(We,We,[ke>.5?ke-1:ke,Oe>.5?Oe-1:Oe,0]),this.alignedProjMatrix=We,p=l.ar(new Float64Array(16),this.pixelMatrix),!p)throw new Error("failed to invert matrix");this.pixelMatrixInverse=p,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const i=this.pointCoordinate(new l.P(0,0)),o=[i.x*this.worldSize,i.y*this.worldSize,0,1];return l.af(o,o,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(0,i))}getCameraQueryGeometry(i){const o=this.getCameraPoint();if(i.length===1)return[i[0],o];{let h=o.x,p=o.y,_=o.x,S=o.y;for(const E of i)h=Math.min(h,E.x),p=Math.min(p,E.y),_=Math.max(_,E.x),S=Math.max(S,E.y);return[new l.P(h,p),new l.P(_,p),new l.P(_,S),new l.P(h,S),new l.P(h,p)]}}lngLatToCameraDepth(i,o){const h=this.locationCoordinate(i),p=[h.x*this.worldSize,h.y*this.worldSize,o,1];return l.af(p,p,this.projMatrix),p[2]/p[3]}}function mr(y,i){let o,h=!1,p=null,_=null;const S=()=>{p=null,h&&(y.apply(_,o),p=setTimeout(S,i),h=!1)};return(...E)=>(h=!0,_=this,o=E,p||S(),p)}class Cr{constructor(i){this._getCurrentHash=()=>{const o=window.location.hash.replace("#","");if(this._hashName){let h;return o.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(h=p)}),(h&&h[1]||"").split("/")}return o.split("/")},this._onHashChange=()=>{const o=this._getCurrentHash();if(o.length>=3&&!o.some(h=>isNaN(h))){const h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:h,pitch:+(o[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const o=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,o)}catch{}},this._updateHash=mr(this._updateHashUnthrottled,300),this._hashName=i&&encodeURIComponent(i)}addTo(i){return this._map=i,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(i){const o=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,p=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,p),S=Math.round(o.lng*_)/_,E=Math.round(o.lat*_)/_,C=this._map.getBearing(),k=this._map.getPitch();let F="";if(F+=i?`/${S}/${E}/${h}`:`${h}/${E}/${S}`,(C||k)&&(F+="/"+Math.round(10*C)/10),k&&(F+=`/${Math.round(k)}`),this._hashName){const B=this._hashName;let q=!1;const ie=window.location.hash.slice(1).split("&").map(ee=>{const ne=ee.split("=")[0];return ne===B?(q=!0,`${ne}=${F}`):ee}).filter(ee=>ee);return q||ie.push(`${B}=${F}`),`#${ie.join("&")}`}return`#${F}`}}const Sn={linearity:.3,easing:l.b6(0,0,.3,1)},cr=l.e({deceleration:2500,maxSpeed:1400},Sn),Nr=l.e({deceleration:20,maxSpeed:1400},Sn),os=l.e({deceleration:1e3,maxSpeed:360},Sn),ws=l.e({deceleration:1e3,maxSpeed:90},Sn);class fn{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:D.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,o=D.now();for(;i.length>0&&o-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const o={zoom:0,bearing:0,pitch:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)o.zoom+=_.zoomDelta||0,o.bearing+=_.bearingDelta||0,o.pitch+=_.pitchDelta||0,_.panDelta&&o.pan._add(_.panDelta),_.around&&(o.around=_.around),_.pinchAround&&(o.pinchAround=_.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(o.pan.mag()){const _=Ms(o.pan.mag(),h,l.e({},cr,i||{}));p.offset=o.pan.mult(_.amount/o.pan.mag()),p.center=this._map.transform.center,zn(p,_)}if(o.zoom){const _=Ms(o.zoom,h,Nr);p.zoom=this._map.transform.zoom+_.amount,zn(p,_)}if(o.bearing){const _=Ms(o.bearing,h,os);p.bearing=this._map.transform.bearing+l.ac(_.amount,-179,179),zn(p,_)}if(o.pitch){const _=Ms(o.pitch,h,ws);p.pitch=this._map.transform.pitch+_.amount,zn(p,_)}if(p.zoom||p.bearing){const _=o.pinchAround===void 0?o.around:o.pinchAround;p.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),l.e(p,{noMoveStart:!0})}}function zn(y,i){(!y.duration||y.duration<i.duration)&&(y.duration=i.duration,y.easing=i.easing)}function Ms(y,i,o){const{maxSpeed:h,linearity:p,deceleration:_}=o,S=l.ac(y*p/(i/1e3),-h,h),E=Math.abs(S)/(_*p);return{easing:o.easing,duration:1e3*E,amount:S*(E/2)}}class Qr extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,h,p={}){const _=z.mousePos(o.getCanvas(),h),S=o.unproject(_);super(i,l.e({point:_,lngLat:S,originalEvent:h},p)),this._defaultPrevented=!1,this.target=o}}class En extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,h){const p=i==="touchend"?h.changedTouches:h.touches,_=z.touchPos(o.getCanvasContainer(),p),S=_.map(C=>o.unproject(C)),E=_.reduce((C,k,F,B)=>C.add(k.div(B.length)),new l.P(0,0));super(i,{points:_,point:E,lngLats:S,lngLat:o.unproject(E),originalEvent:h}),this._defaultPrevented=!1}}class Sa extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,h){super(i,{originalEvent:h}),this._defaultPrevented=!1}}class Zn{constructor(i,o){this._map=i,this._clickTolerance=o.clickTolerance}reset(){delete this._mousedownPos}wheel(i){return this._firePreventable(new Sa(i.type,this._map,i))}mousedown(i,o){return this._mousedownPos=o,this._firePreventable(new Qr(i.type,this._map,i))}mouseup(i){this._map.fire(new Qr(i.type,this._map,i))}click(i,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||this._map.fire(new Qr(i.type,this._map,i))}dblclick(i){return this._firePreventable(new Qr(i.type,this._map,i))}mouseover(i){this._map.fire(new Qr(i.type,this._map,i))}mouseout(i){this._map.fire(new Qr(i.type,this._map,i))}touchstart(i){return this._firePreventable(new En(i.type,this._map,i))}touchmove(i){this._map.fire(new En(i.type,this._map,i))}touchend(i){this._map.fire(new En(i.type,this._map,i))}touchcancel(i){this._map.fire(new En(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ss{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(i){this._map.fire(new Qr(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Qr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._ignoreContextMenu||this._map.fire(new Qr(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class qa{constructor(i){this._map=i}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(i){return this.transform.pointLocation(l.P.convert(i),this._map.terrain)}}class Ai{constructor(i,o){this._map=i,this._tr=new qa(i),this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,o){this.isEnabled()&&i.shiftKey&&i.button===0&&(z.disableDrag(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(i,o){if(!this._active)return;const h=o;if(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)return;const p=this._startPos;this._lastPos=h,this._box||(this._box=z.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",i));const _=Math.min(p.x,h.x),S=Math.max(p.x,h.x),E=Math.min(p.y,h.y),C=Math.max(p.y,h.y);z.setTransform(this._box,`translate(${_}px,${E}px)`),this._box.style.width=S-_+"px",this._box.style.height=C-E+"px"}mouseupWindow(i,o){if(!this._active||i.button!==0)return;const h=this._startPos,p=o;if(this.reset(),z.suppressClick(),h.x!==p.x||h.y!==p.y)return this._map.fire(new l.k("boxzoomend",{originalEvent:i})),{cameraAnimation:_=>_.fitScreenCoordinates(h,p,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",i)}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(z.remove(this._box),this._box=null),z.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(i,o){return this._map.fire(new l.k(i,{originalEvent:o}))}}function Ri(y,i){if(y.length!==i.length)throw new Error(`The number of touches and points are not equal - touches ${y.length}, points ${i.length}`);const o={};for(let h=0;h<y.length;h++)o[y[h].identifier]=i[h];return o}class il{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(i,o,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),h.length===this.numTouches&&(this.centroid=function(p){const _=new l.P(0,0);for(const S of p)_._add(S);return _.div(p.length)}(o),this.touches=Ri(h,o)))}touchmove(i,o,h){if(this.aborted||!this.centroid)return;const p=Ri(h,o);for(const _ in this.touches){const S=p[_];(!S||S.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(i,o,h){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class Es{constructor(i){this.singleTap=new il(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(i,o,h){this.singleTap.touchstart(i,o,h)}touchmove(i,o,h){this.singleTap.touchmove(i,o,h)}touchend(i,o,h){const p=this.singleTap.touchend(i,o,h);if(p){const _=i.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(p)<30;if(_&&S||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class $l{constructor(i){this._tr=new qa(i),this._zoomIn=new Es({numTouches:1,numTaps:2}),this._zoomOut=new Es({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,o,h){this._zoomIn.touchstart(i,o,h),this._zoomOut.touchstart(i,o,h)}touchmove(i,o,h){this._zoomIn.touchmove(i,o,h),this._zoomOut.touchmove(i,o,h)}touchend(i,o,h){const p=this._zoomIn.touchend(i,o,h),_=this._zoomOut.touchend(i,o,h),S=this._tr;return p?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:S.zoom+1,around:S.unproject(p)},{originalEvent:i})}):_?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:S.zoom-1,around:S.unproject(_)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class en{constructor(i){this._enabled=!!i.enable,this._moveStateManager=i.moveStateManager,this._clickTolerance=i.clickTolerance||1,this._moveFunction=i.move,this._activateOnStart=!!i.activateOnStart,i.assignEvents(this),this.reset()}reset(i){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(i)}_move(...i){const o=this._moveFunction(...i);if(o.bearingDelta||o.pitchDelta||o.around||o.panDelta)return this._active=!0,o}dragStart(i,o){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(i)&&(this._moveStateManager.startMove(i),this._lastPoint=o.length?o[0]:o,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(i,o){if(!this.isEnabled())return;const h=this._lastPoint;if(!h)return;if(i.preventDefault(),!this._moveStateManager.isValidMoveEvent(i))return void this.reset(i);const p=o.length?o[0]:o;return!this._moved&&p.dist(h)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=p,this._move(h,p))}dragEnd(i){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(i)&&(this._moved&&z.suppressClick(),this.reset(i))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const On={0:1,2:2};class tn{constructor(i){this._correctEvent=i.checkCorrectEvent}startMove(i){const o=z.mouseButton(i);this._eventButton=o}endMove(i){delete this._eventButton}isValidStartEvent(i){return this._correctEvent(i)}isValidMoveEvent(i){return!function(o,h){const p=On[h];return o.buttons===void 0||(o.buttons&p)!==p}(i,this._eventButton)}isValidEndEvent(i){return z.mouseButton(i)===this._eventButton}}class Tt{constructor(){this._firstTouch=void 0}_isOneFingerTouch(i){return i.targetTouches.length===1}_isSameTouchEvent(i){return i.targetTouches[0].identifier===this._firstTouch}startMove(i){this._firstTouch=i.targetTouches[0].identifier}endMove(i){delete this._firstTouch}isValidStartEvent(i){return this._isOneFingerTouch(i)}isValidMoveEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}isValidEndEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}}const Ea=y=>{y.mousedown=y.dragStart,y.mousemoveWindow=y.dragMove,y.mouseup=y.dragEnd,y.contextmenu=function(i){i.preventDefault()}},ls=({enable:y,clickTolerance:i,bearingDegreesPerPixelMoved:o=.8})=>{const h=new tn({checkCorrectEvent:p=>z.mouseButton(p)===0&&p.ctrlKey||z.mouseButton(p)===2});return new en({clickTolerance:i,move:(p,_)=>({bearingDelta:(_.x-p.x)*o}),moveStateManager:h,enable:y,assignEvents:Ea})},Wn=({enable:y,clickTolerance:i,pitchDegreesPerPixelMoved:o=-.5})=>{const h=new tn({checkCorrectEvent:p=>z.mouseButton(p)===0&&p.ctrlKey||z.mouseButton(p)===2});return new en({clickTolerance:i,move:(p,_)=>({pitchDelta:(_.y-p.y)*o}),moveStateManager:h,enable:y,assignEvents:Ea})};class Ul{constructor(i,o){this._clickTolerance=i.clickTolerance||1,this._map=o,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(i,o,h){return this._calculateTransform(i,o,h)}touchmove(i,o,h){if(this._active&&!(h.length<this.minTouchs()))return i.preventDefault(),this._calculateTransform(i,o,h)}touchend(i,o,h){this._calculateTransform(i,o,h),this._active&&h.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,o,h){h.length>0&&(this._active=!0);const p=Ri(h,o),_=new l.P(0,0),S=new l.P(0,0);let E=0;for(const k in p){const F=p[k],B=this._touches[k];B&&(_._add(F),S._add(F.sub(B)),E++,p[k]=F)}if(this._touches=p,E<this.minTouchs()||!S.mag())return;const C=S.div(E);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(E),panDelta:C}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vt{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(i,o,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([o[0],o[1]]))}touchmove(i,o,h){if(!this._firstTwoTouches)return;i.preventDefault();const[p,_]=this._firstTwoTouches,S=aa(h,o,p),E=aa(h,o,_);if(!S||!E)return;const C=this._aroundCenter?null:S.add(E).div(2);return this._move([S,E],C,i)}touchend(i,o,h){if(!this._firstTwoTouches)return;const[p,_]=this._firstTwoTouches,S=aa(h,o,p),E=aa(h,o,_);S&&E||(this._active&&z.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function aa(y,i,o){for(let h=0;h<y.length;h++)if(y[h].identifier===o)return i[h]}function yo(y,i){return Math.log(y/i)/Math.LN2}class _o extends vt{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,o){const h=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(yo(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:yo(this._distance,h),pinchAround:o}}}function vo(y,i){return 180*y.angleWith(i)/Math.PI}class Ga extends vt{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,o,h){const p=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:vo(this._vector,p),pinchAround:o}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const o=25/(Math.PI*this._minDiameter)*360,h=vo(i,this._startVector);return Math.abs(h)<o}}function Ta(y){return Math.abs(y.y)>Math.abs(y.x)}class Qh extends vt{constructor(i){super(),this._currentTouchCount=0,this._map=i}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(i,o,h){super.touchstart(i,o,h),this._currentTouchCount=h.length}_start(i){this._lastPoints=i,Ta(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,o,h){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const p=i[0].sub(this._lastPoints[0]),_=i[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(p,_,h.timeStamp),this._valid?(this._lastPoints=i,this._active=!0,{pitchDelta:(p.y+_.y)/2*-.5}):void 0}gestureBeginsVertically(i,o,h){if(this._valid!==void 0)return this._valid;const p=i.mag()>=2,_=o.mag()>=2;if(!p&&!_)return;if(!p||!_)return this._firstMove===void 0&&(this._firstMove=h),h-this._firstMove<100&&void 0;const S=i.y>0==o.y>0;return Ta(i)&&Ta(o)&&S}}const Np={panStep:100,bearingStep:15,pitchStep:10};class Ha{constructor(i){this._tr=new qa(i);const o=Np;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let o=0,h=0,p=0,_=0,S=0;switch(i.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:i.shiftKey?h=-1:(i.preventDefault(),_=-1);break;case 39:i.shiftKey?h=1:(i.preventDefault(),_=1);break;case 38:i.shiftKey?p=1:(i.preventDefault(),S=-1);break;case 40:i.shiftKey?p=-1:(i.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(h=0,p=0),{cameraAnimation:E=>{const C=this._tr;E.easeTo({duration:300,easeId:"keyboardHandler",easing:xr,zoom:o?Math.round(C.zoom)+o*(i.shiftKey?2:1):C.zoom,bearing:C.bearing+h*this._bearingStep,pitch:C.pitch+p*this._pitchStep,offset:[-_*this._panStep,-S*this._panStep],center:C.center},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function xr(y){return y*(2-y)}const Vl=4.000244140625;class wc{constructor(i,o){this._onTimeout=h=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(h)},this._map=i,this._tr=new qa(i),this._triggerRenderFrame=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(i){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!i[this._map.cooperativeGestures._bypassKey])return;let o=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const h=D.now(),p=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,o!==0&&o%Vl==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(p*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),i.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=i,this._delta-=o,this._active||this._start(i)),i.preventDefault()}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=z.mousePos(this._map.getCanvas(),i),h=this._tr;this._around=o.y>h.transform.height/2-h.transform.getHorizon()?l.M.convert(this._aroundCenter?h.center:h.unproject(o)):l.M.convert(h.center),this._aroundPoint=h.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._tr.transform;if(this._delta!==0){const E=this._type==="wheel"&&Math.abs(this._delta)>Vl?this._wheelZoomRate:this._defaultZoomRate;let C=2/(1+Math.exp(-Math.abs(this._delta*E)));this._delta<0&&C!==0&&(C=1/C);const k=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):i.scale;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(k*C))),this._type==="wheel"&&(this._startZoom=i.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const o=typeof this._targetZoom=="number"?this._targetZoom:i.zoom,h=this._startZoom,p=this._easing;let _,S=!1;if(this._type==="wheel"&&h&&p){const E=Math.min((D.now()-this._lastWheelEventTime)/200,1),C=p(E);_=l.z.number(h,o,C),E<1?this._frameId||(this._frameId=!0):S=!0}else _=o,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:_-i.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let o=l.b7;if(this._prevEase){const h=this._prevEase,p=(D.now()-h.start)/h.duration,_=h.easing(p+.01)-h.easing(p),S=.27/Math.sqrt(_*_+1e-4)*.01,E=Math.sqrt(.0729-S*S);o=l.b6(S,E,.25,1)}return this._prevEase={start:D.now(),duration:i,easing:o},o}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Mu{constructor(i,o){this._clickZoom=i,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ed{constructor(i){this._tr=new qa(i),this.reset()}reset(){this._active=!1}dblclick(i,o){return i.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:this._tr.zoom+(i.shiftKey?-1:1),around:this._tr.unproject(o)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class td{constructor(){this._tap=new Es({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(i,o,h){if(!this._swipePoint)if(this._tapTime){const p=o[0],_=i.timeStamp-this._tapTime<500,S=this._tapPoint.dist(p)<30;_&&S?h.length>0&&(this._swipePoint=p,this._swipeTouch=h[0].identifier):this.reset()}else this._tap.touchstart(i,o,h)}touchmove(i,o,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const p=o[0],_=p.y-this._swipePoint.y;return this._swipePoint=p,i.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(i,o,h)}touchend(i,o,h){if(this._tapTime)this._swipePoint&&h.length===0&&this.reset();else{const p=this._tap.touchend(i,o,h);p&&(this._tapTime=i.timeStamp,this._tapPoint=p)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class id{constructor(i,o,h){this._el=i,this._mousePan=o,this._touchPan=h}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class qs{constructor(i,o,h){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=o,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class jl{constructor(i,o,h,p){this._el=i,this._touchZoom=o,this._touchRotate=h,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class jt{constructor(i,o){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=i,this._options=o,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const i=this._map.getCanvasContainer();i.classList.add("maplibregl-cooperative-gestures"),this._container=z.create("div","maplibregl-cooperative-gesture-screen",i);let o=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(o=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const h=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),p=document.createElement("div");p.className="maplibregl-desktop-message",p.textContent=o,this._container.appendChild(p);const _=document.createElement("div");_.className="maplibregl-mobile-message",_.textContent=h,this._container.appendChild(_),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(z.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(i){this._onCooperativeGesture(i.touches.length===1)}wheel(i){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!i[this._bypassKey])}_onCooperativeGesture(i){this._enabled&&i&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Qt=y=>y.zoom||y.drag||y.pitch||y.rotate;class Mc extends l.k{}function ql(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class Su{constructor(i,o){this.handleWindowEvent=p=>{this.handleEvent(p,`${p.type}Window`)},this.handleEvent=(p,_)=>{if(p.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const S=p.type==="renderFrame"?void 0:p,E={needsRenderFrame:!1},C={},k={},F=p.touches,B=F?this._getMapTouches(F):void 0,q=B?z.touchPos(this._map.getCanvas(),B):z.mousePos(this._map.getCanvas(),p);for(const{handlerName:ne,handler:X,allowed:fe}of this._handlers){if(!X.isEnabled())continue;let Ie;this._blockedByActive(k,fe,ne)?X.reset():X[_||p.type]&&(Ie=X[_||p.type](p,q,B),this.mergeHandlerResult(E,C,Ie,ne,S),Ie&&Ie.needsRenderFrame&&this._triggerRenderFrame()),(Ie||X.isActive())&&(k[ne]=X)}const ie={};for(const ne in this._previousActiveHandlers)k[ne]||(ie[ne]=S);this._previousActiveHandlers=k,(Object.keys(ie).length||ql(E))&&(this._changes.push([E,C,ie]),this._triggerRenderFrame()),(Object.keys(k).length||ql(E))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ee}=E;ee&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ee(this._map))},this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new fn(i),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(o);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,_,S]of this._listeners)z.addEventListener(p,_,p===document?this.handleWindowEvent:this.handleEvent,S)}destroy(){for(const[i,o,h]of this._listeners)z.removeEventListener(i,o,i===document?this.handleWindowEvent:this.handleEvent,h)}_addDefaultHandlers(i){const o=this._map,h=o.getCanvasContainer();this._add("mapEvent",new Zn(o,i));const p=o.boxZoom=new Ai(o,i);this._add("boxZoom",p),i.interactive&&i.boxZoom&&p.enable();const _=o.cooperativeGestures=new jt(o,i.cooperativeGestures);this._add("cooperativeGestures",_),i.cooperativeGestures&&_.enable();const S=new $l(o),E=new ed(o);o.doubleClickZoom=new Mu(E,S),this._add("tapZoom",S),this._add("clickZoom",E),i.interactive&&i.doubleClickZoom&&o.doubleClickZoom.enable();const C=new td;this._add("tapDragZoom",C);const k=o.touchPitch=new Qh(o);this._add("touchPitch",k),i.interactive&&i.touchPitch&&o.touchPitch.enable(i.touchPitch);const F=ls(i),B=Wn(i);o.dragRotate=new qs(i,F,B),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",B,["mouseRotate"]),i.interactive&&i.dragRotate&&o.dragRotate.enable();const q=(({enable:Ie,clickTolerance:le})=>{const we=new tn({checkCorrectEvent:Ae=>z.mouseButton(Ae)===0&&!Ae.ctrlKey});return new en({clickTolerance:le,move:(Ae,ke)=>({around:ke,panDelta:ke.sub(Ae)}),activateOnStart:!0,moveStateManager:we,enable:Ie,assignEvents:Ea})})(i),ie=new Ul(i,o);o.dragPan=new id(h,q,ie),this._add("mousePan",q),this._add("touchPan",ie,["touchZoom","touchRotate"]),i.interactive&&i.dragPan&&o.dragPan.enable(i.dragPan);const ee=new Ga,ne=new _o;o.touchZoomRotate=new jl(h,ne,ee,C),this._add("touchRotate",ee,["touchPan","touchZoom"]),this._add("touchZoom",ne,["touchPan","touchRotate"]),i.interactive&&i.touchZoomRotate&&o.touchZoomRotate.enable(i.touchZoomRotate);const X=o.scrollZoom=new wc(o,()=>this._triggerRenderFrame());this._add("scrollZoom",X,["mousePan"]),i.interactive&&i.scrollZoom&&o.scrollZoom.enable(i.scrollZoom);const fe=o.keyboard=new Ha(o);this._add("keyboard",fe),i.interactive&&i.keyboard&&o.keyboard.enable(),this._add("blockableMapEvent",new Ss(o))}_add(i,o,h){this._handlers.push({handlerName:i,handler:o,allowed:h}),this._handlersById[i]=o}stop(i){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Qt(this._eventsInProgress)||this.isZooming()}_blockedByActive(i,o,h){for(const p in i)if(p!==h&&(!o||o.indexOf(p)<0))return!0;return!1}_getMapTouches(i){const o=[];for(const h of i)this._el.contains(h.target)&&o.push(h);return o}mergeHandlerResult(i,o,h,p,_){if(!h)return;l.e(i,h);const S={handlerName:p,originalEvent:h.originalEvent||_};h.zoomDelta!==void 0&&(o.zoom=S),h.panDelta!==void 0&&(o.drag=S),h.pitchDelta!==void 0&&(o.pitch=S),h.bearingDelta!==void 0&&(o.rotate=S)}_applyChanges(){const i={},o={},h={};for(const[p,_,S]of this._changes)p.panDelta&&(i.panDelta=(i.panDelta||new l.P(0,0))._add(p.panDelta)),p.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(i.around=p.around),p.pinchAround!==void 0&&(i.pinchAround=p.pinchAround),p.noInertia&&(i.noInertia=p.noInertia),l.e(o,_),l.e(h,S);this._updateMapTransform(i,o,h),this._changes=[]}_updateMapTransform(i,o,h){const p=this._map,_=p._getTransformForUpdate(),S=p.terrain;if(!(ql(i)||S&&this._terrainMovement))return this._fireEvents(o,h,!0);let{panDelta:E,zoomDelta:C,bearingDelta:k,pitchDelta:F,around:B,pinchAround:q}=i;q!==void 0&&(B=q),p._stop(!0),B=B||p.transform.centerPoint;const ie=_.pointLocation(E?B.sub(E):B);k&&(_.bearing+=k),F&&(_.pitch+=F),C&&(_.zoom+=C),S?this._terrainMovement||!o.drag&&!o.zoom?o.drag&&this._terrainMovement?_.center=_.pointLocation(_.centerPoint.sub(E)):_.setLocationAtPoint(ie,B):(this._terrainMovement=!0,this._map._elevationFreeze=!0,_.setLocationAtPoint(ie,B),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,_.recalculateZoom(p.terrain)})):_.setLocationAtPoint(ie,B),p._applyUpdatedTransform(_),this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(o,h,!0)}_fireEvents(i,o,h){const p=Qt(this._eventsInProgress),_=Qt(i),S={};for(const F in i){const{originalEvent:B}=i[F];this._eventsInProgress[F]||(S[`${F}start`]=B),this._eventsInProgress[F]=i[F]}!p&&_&&this._fireEvent("movestart",_.originalEvent);for(const F in S)this._fireEvent(F,S[F]);_&&this._fireEvent("move",_.originalEvent);for(const F in i){const{originalEvent:B}=i[F];this._fireEvent(F,B)}const E={};let C;for(const F in this._eventsInProgress){const{handlerName:B,originalEvent:q}=this._eventsInProgress[F];this._handlersById[B].isActive()||(delete this._eventsInProgress[F],C=o[B]||q,E[`${F}end`]=C)}for(const F in E)this._fireEvent(F,E[F]);const k=Qt(this._eventsInProgress);if(h&&(p||_)&&!k){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=q=>q!==0&&-this._bearingSnap<q&&q<this._bearingSnap;!F||!F.essential&&D.prefersReducedMotion?(this._map.fire(new l.k("moveend",{originalEvent:C})),B(this._map.getBearing())&&this._map.resetNorth()):(B(F.bearing||this._map.getBearing())&&(F.bearing=0),F.freezeElevation=!0,this._map.easeTo(F,{originalEvent:C})),this._updatingCamera=!1}}_fireEvent(i,o){this._map.fire(new l.k(i,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{delete this._frameId,this.handleEvent(new Mc("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Xn extends l.E{constructor(i,o){super(),this._renderFrameCallback=()=>{const h=Math.min((D.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=o.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new l.M(this.transform.center.lng,this.transform.center.lat)}setCenter(i,o){return this.jumpTo({center:i},o)}panBy(i,o,h){return i=l.P.convert(i).mult(-1),this.panTo(this.transform.center,l.e({offset:i},o),h)}panTo(i,o,h){return this.easeTo(l.e({center:i},o),h)}getZoom(){return this.transform.zoom}setZoom(i,o){return this.jumpTo({zoom:i},o),this}zoomTo(i,o,h){return this.easeTo(l.e({zoom:i},o),h)}zoomIn(i,o){return this.zoomTo(this.getZoom()+1,i,o),this}zoomOut(i,o){return this.zoomTo(this.getZoom()-1,i,o),this}getBearing(){return this.transform.bearing}setBearing(i,o){return this.jumpTo({bearing:i},o),this}getPadding(){return this.transform.padding}setPadding(i,o){return this.jumpTo({padding:i},o),this}rotateTo(i,o,h){return this.easeTo(l.e({bearing:i},o),h)}resetNorth(i,o){return this.rotateTo(0,l.e({duration:1e3},i),o),this}resetNorthPitch(i,o){return this.easeTo(l.e({bearing:0,pitch:0,duration:1e3},i),o),this}snapToNorth(i,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,o):this}getPitch(){return this.transform.pitch}setPitch(i,o){return this.jumpTo({pitch:i},o),this}cameraForBounds(i,o){i=ue.convert(i);const h=o&&o.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),h,o)}_cameraForBoxAndBearing(i,o,h,p){const _={top:0,bottom:0,right:0,left:0};if(typeof(p=l.e({padding:_,offset:[0,0],maxZoom:this.transform.maxZoom},p)).padding=="number"){const ht=p.padding;p.padding={top:ht,bottom:ht,right:ht,left:ht}}p.padding=l.e(_,p.padding);const S=this.transform,E=S.padding,C=new ue(i,o),k=S.project(C.getNorthWest()),F=S.project(C.getNorthEast()),B=S.project(C.getSouthEast()),q=S.project(C.getSouthWest()),ie=l.b8(-h),ee=k.rotate(ie),ne=F.rotate(ie),X=B.rotate(ie),fe=q.rotate(ie),Ie=new l.P(Math.max(ee.x,ne.x,fe.x,X.x),Math.max(ee.y,ne.y,fe.y,X.y)),le=new l.P(Math.min(ee.x,ne.x,fe.x,X.x),Math.min(ee.y,ne.y,fe.y,X.y)),we=Ie.sub(le),Ae=(S.width-(E.left+E.right+p.padding.left+p.padding.right))/we.x,ke=(S.height-(E.top+E.bottom+p.padding.top+p.padding.bottom))/we.y;if(ke<0||Ae<0)return void l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Oe=Math.min(S.scaleZoom(S.scale*Math.min(Ae,ke)),p.maxZoom),We=l.P.convert(p.offset),He=new l.P((p.padding.left-p.padding.right)/2,(p.padding.top-p.padding.bottom)/2).rotate(l.b8(h)),st=We.add(He).mult(S.scale/S.zoomScale(Oe));return{center:S.unproject(k.add(B).div(2).sub(st)),zoom:Oe,bearing:h}}fitBounds(i,o,h){return this._fitInternal(this.cameraForBounds(i,o),o,h)}fitScreenCoordinates(i,o,h,p,_){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.P.convert(i)),this.transform.pointLocation(l.P.convert(o)),h,p),p,_)}_fitInternal(i,o,h){return i?(delete(o=l.e(i,o)).padding,o.linear?this.easeTo(o,h):this.flyTo(o,h)):this}jumpTo(i,o){this.stop();const h=this._getTransformForUpdate();let p=!1,_=!1,S=!1;return"zoom"in i&&h.zoom!==+i.zoom&&(p=!0,h.zoom=+i.zoom),i.center!==void 0&&(h.center=l.M.convert(i.center)),"bearing"in i&&h.bearing!==+i.bearing&&(_=!0,h.bearing=+i.bearing),"pitch"in i&&h.pitch!==+i.pitch&&(S=!0,h.pitch=+i.pitch),i.padding==null||h.isPaddingEqual(i.padding)||(h.padding=i.padding),this._applyUpdatedTransform(h),this.fire(new l.k("movestart",o)).fire(new l.k("move",o)),p&&this.fire(new l.k("zoomstart",o)).fire(new l.k("zoom",o)).fire(new l.k("zoomend",o)),_&&this.fire(new l.k("rotatestart",o)).fire(new l.k("rotate",o)).fire(new l.k("rotateend",o)),S&&this.fire(new l.k("pitchstart",o)).fire(new l.k("pitch",o)).fire(new l.k("pitchend",o)),this.fire(new l.k("moveend",o))}calculateCameraOptionsFromTo(i,o,h,p=0){const _=l.Y.fromLngLat(i,o),S=l.Y.fromLngLat(h,p),E=S.x-_.x,C=S.y-_.y,k=S.z-_.z,F=Math.hypot(E,C,k);if(F===0)throw new Error("Can't calculate camera options with same From and To");const B=Math.hypot(E,C),q=this.transform.scaleZoom(this.transform.cameraToCenterDistance/F/this.transform.tileSize),ie=180*Math.atan2(E,-C)/Math.PI;let ee=180*Math.acos(B/F)/Math.PI;return ee=k<0?90-ee:90+ee,{center:S.toLngLat(),zoom:q,pitch:ee,bearing:ie}}easeTo(i,o){var h;this._stop(!1,i.easeId),((i=l.e({offset:[0,0],duration:500,easing:l.b7},i)).animate===!1||!i.essential&&D.prefersReducedMotion)&&(i.duration=0);const p=this._getTransformForUpdate(),_=this.getZoom(),S=this.getBearing(),E=this.getPitch(),C=this.getPadding(),k="bearing"in i?this._normalizeBearing(i.bearing,S):S,F="pitch"in i?+i.pitch:E,B="padding"in i?i.padding:p.padding,q=l.P.convert(i.offset);let ie=p.centerPoint.add(q);const ee=p.pointLocation(ie),{center:ne,zoom:X}=p.getConstrained(l.M.convert(i.center||ee),(h=i.zoom)!==null&&h!==void 0?h:_);this._normalizeCenter(ne);const fe=p.project(ee),Ie=p.project(ne).sub(fe),le=p.zoomScale(X-_);let we,Ae;i.around&&(we=l.M.convert(i.around),Ae=p.locationPoint(we));const ke={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||X!==_,this._rotating=this._rotating||S!==k,this._pitching=this._pitching||F!==E,this._padding=!p.isPaddingEqual(B),this._easeId=i.easeId,this._prepareEase(o,i.noMoveStart,ke),this.terrain&&this._prepareElevation(ne),this._ease(Oe=>{if(this._zooming&&(p.zoom=l.z.number(_,X,Oe)),this._rotating&&(p.bearing=l.z.number(S,k,Oe)),this._pitching&&(p.pitch=l.z.number(E,F,Oe)),this._padding&&(p.interpolatePadding(C,B,Oe),ie=p.centerPoint.add(q)),this.terrain&&!i.freezeElevation&&this._updateElevation(Oe),we)p.setLocationAtPoint(we,Ae);else{const We=p.zoomScale(p.zoom-_),He=X>_?Math.min(2,le):Math.max(.5,le),st=Math.pow(He,1-Oe),ht=p.unproject(fe.add(Ie.mult(Oe*st)).mult(We));p.setLocationAtPoint(p.renderWorldCopies?ht.wrap():ht,ie)}this._applyUpdatedTransform(p),this._fireMoveEvents(o)},Oe=>{this.terrain&&this._finalizeElevation(),this._afterEase(o,Oe)},i),this}_prepareEase(i,o,h={}){this._moving=!0,o||h.moving||this.fire(new l.k("movestart",i)),this._zooming&&!h.zooming&&this.fire(new l.k("zoomstart",i)),this._rotating&&!h.rotating&&this.fire(new l.k("rotatestart",i)),this._pitching&&!h.pitching&&this.fire(new l.k("pitchstart",i))}_prepareElevation(i){this._elevationCenter=i,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(i){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const o=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(i<1&&o!==this._elevationTarget){const h=this._elevationTarget-this._elevationStart;this._elevationStart+=i*(h-(o-(h*i+this._elevationStart))/(1-i)),this._elevationTarget=o}this.transform.elevation=l.z.number(this._elevationStart,this._elevationTarget,i)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(i){if(!this.transformCameraUpdate)return;const o=i.clone(),{center:h,zoom:p,pitch:_,bearing:S,elevation:E}=this.transformCameraUpdate(o);h&&(o.center=h),p!==void 0&&(o.zoom=p),_!==void 0&&(o.pitch=_),S!==void 0&&(o.bearing=S),E!==void 0&&(o.elevation=E),this.transform.apply(o)}_fireMoveEvents(i){this.fire(new l.k("move",i)),this._zooming&&this.fire(new l.k("zoom",i)),this._rotating&&this.fire(new l.k("rotate",i)),this._pitching&&this.fire(new l.k("pitch",i))}_afterEase(i,o){if(this._easeId&&o&&this._easeId===o)return;delete this._easeId;const h=this._zooming,p=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,h&&this.fire(new l.k("zoomend",i)),p&&this.fire(new l.k("rotateend",i)),_&&this.fire(new l.k("pitchend",i)),this.fire(new l.k("moveend",i))}flyTo(i,o){var h;if(!i.essential&&D.prefersReducedMotion){const Li=l.L(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Li,o)}this.stop(),i=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.b7},i);const p=this._getTransformForUpdate(),_=this.getZoom(),S=this.getBearing(),E=this.getPitch(),C=this.getPadding(),k="bearing"in i?this._normalizeBearing(i.bearing,S):S,F="pitch"in i?+i.pitch:E,B="padding"in i?i.padding:p.padding,q=l.P.convert(i.offset);let ie=p.centerPoint.add(q);const ee=p.pointLocation(ie),{center:ne,zoom:X}=p.getConstrained(l.M.convert(i.center||ee),(h=i.zoom)!==null&&h!==void 0?h:_);this._normalizeCenter(ne);const fe=p.zoomScale(X-_),Ie=p.project(ee),le=p.project(ne).sub(Ie);let we=i.curve;const Ae=Math.max(p.width,p.height),ke=Ae/fe,Oe=le.mag();if("minZoom"in i){const Li=l.ac(Math.min(i.minZoom,_,X),p.minZoom,p.maxZoom),ai=Ae/p.zoomScale(Li-_);we=Math.sqrt(ai/Oe*2)}const We=we*we;function He(Li){const ai=(ke*ke-Ae*Ae+(Li?-1:1)*We*We*Oe*Oe)/(2*(Li?ke:Ae)*We*Oe);return Math.log(Math.sqrt(ai*ai+1)-ai)}function st(Li){return(Math.exp(Li)-Math.exp(-Li))/2}function ht(Li){return(Math.exp(Li)+Math.exp(-Li))/2}const di=He(!1);let yt=function(Li){return ht(di)/ht(di+we*Li)},ei=function(Li){return Ae*((ht(di)*(st(ai=di+we*Li)/ht(ai))-st(di))/We)/Oe;var ai},pi=(He(!0)-di)/we;if(Math.abs(Oe)<1e-6||!isFinite(pi)){if(Math.abs(Ae-ke)<1e-6)return this.easeTo(i,o);const Li=ke<Ae?-1:1;pi=Math.abs(Math.log(ke/Ae))/we,ei=function(){return 0},yt=function(ai){return Math.exp(Li*we*ai)}}return i.duration="duration"in i?+i.duration:1e3*pi/("screenSpeed"in i?+i.screenSpeed/we:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0),this._zooming=!0,this._rotating=S!==k,this._pitching=F!==E,this._padding=!p.isPaddingEqual(B),this._prepareEase(o,!1),this.terrain&&this._prepareElevation(ne),this._ease(Li=>{const ai=Li*pi,mi=1/yt(ai);p.zoom=Li===1?X:_+p.scaleZoom(mi),this._rotating&&(p.bearing=l.z.number(S,k,Li)),this._pitching&&(p.pitch=l.z.number(E,F,Li)),this._padding&&(p.interpolatePadding(C,B,Li),ie=p.centerPoint.add(q)),this.terrain&&!i.freezeElevation&&this._updateElevation(Li);const bi=Li===1?ne:p.unproject(Ie.add(le.mult(ei(ai))).mult(mi));p.setLocationAtPoint(p.renderWorldCopies?bi.wrap():bi,ie),this._applyUpdatedTransform(p),this._fireMoveEvents(o)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(o)},i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const h=this._onEaseEnd;delete this._onEaseEnd,h.call(this,o)}if(!i){const h=this.handlers;h&&h.stop(!1)}return this}_ease(i,o,h){h.animate===!1||h.duration===0?(i(1),o()):(this._easeStart=D.now(),this._easeOptions=h,this._onEaseFrame=i,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(i,o){i=l.b1(i,-180,180);const h=Math.abs(i-o);return Math.abs(i-360-o)<h&&(i-=360),Math.abs(i+360-o)<h&&(i+=360),i}_normalizeCenter(i){const o=this.transform;if(!o.renderWorldCopies||o.lngRange)return;const h=i.lng-o.center.lng;i.lng+=h>180?-360:h<-180?360:0}queryTerrainElevation(i){return this.terrain?this.terrain.getElevationForLngLatZoom(l.M.convert(i),this.transform.tileZoom)-this.transform.elevation:null}}const Eu={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Gs{constructor(i=Eu){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=o=>{!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"&&o.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=i}getDefaultPosition(){return"bottom-right"}onAdd(i){return this._map=i,this._compact=this.options.compact,this._container=z.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=z.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=z.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){z.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(i,o){const h=this._map._getUIString(`AttributionControl.${o}`);i.title=h,i.setAttribute("aria-label",h)}_updateAttributions(){if(!this._map.style)return;let i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map(p=>typeof p!="string"?"":p)):typeof this.options.customAttribution=="string"&&i.push(this.options.customAttribution)),this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const o=this._map.style.sourceCaches;for(const p in o){const _=o[p];if(_.used||_.usedForTerrain){const S=_.getSource();S.attribution&&i.indexOf(S.attribution)<0&&i.push(S.attribution)}}i=i.filter(p=>String(p).trim()),i.sort((p,_)=>p.length-_.length),i=i.filter((p,_)=>{for(let S=_+1;S<i.length;S++)if(i[S].indexOf(p)>=0)return!1;return!0});const h=i.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,i.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class rd{constructor(i={}){this._updateCompact=()=>{const o=this._container.children;if(o.length){const h=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&h.classList.add("maplibregl-compact"):h.classList.remove("maplibregl-compact")}},this.options=i}getDefaultPosition(){return"bottom-left"}onAdd(i){this._map=i,this._compact=this.options&&this.options.compact,this._container=z.create("div","maplibregl-ctrl");const o=z.create("a","maplibregl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://maplibre.org/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){z.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Gl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const o=++this._id;return this._queue.push({callback:i,id:o,cancelled:!1}),o}remove(i){const o=this._currentlyRunning,h=o?this._queue.concat(o):this._queue;for(const p of h)if(p.id===i)return void(p.cancelled=!0)}run(i=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const o=this._currentlyRunning=this._queue;this._queue=[];for(const h of o)if(!h.cancelled&&(h.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var zr=l.X([{name:"a_pos3d",type:"Int16",components:3}]);class qr extends l.E{constructor(i){super(),this.sourceCache=i,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,i.usedForTerrain=!0,i.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(i,o){this.sourceCache.update(i,o),this._renderableTilesKeys=[];const h={};for(const p of i.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:o}))h[p.key]=!0,this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.posMatrix=new Float64Array(16),l.aN(p.posMatrix,0,l.W,0,l.W,0,1),this._tiles[p.key]=new Ni(p,this.tileSize));for(const p in this._tiles)h[p]||delete this._tiles[p]}freeRtt(i){for(const o in this._tiles){const h=this._tiles[o];(!i||h.tileID.equals(i)||h.tileID.isChildOf(i)||i.isChildOf(h.tileID))&&(h.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(i=>this.getTileByID(i))}getTileByID(i){return this._tiles[i]}getTerrainCoords(i){const o={};for(const h of this._renderableTilesKeys){const p=this._tiles[h].tileID;if(p.canonical.equals(i.canonical)){const _=i.clone();_.posMatrix=new Float64Array(16),l.aN(_.posMatrix,0,l.W,0,l.W,0,1),o[h]=_}else if(p.canonical.isChildOf(i.canonical)){const _=i.clone();_.posMatrix=new Float64Array(16);const S=p.canonical.z-i.canonical.z,E=p.canonical.x-(p.canonical.x>>S<<S),C=p.canonical.y-(p.canonical.y>>S<<S),k=l.W>>S;l.aN(_.posMatrix,0,k,0,k,0,1),l.H(_.posMatrix,_.posMatrix,[-E*k,-C*k,0]),o[h]=_}else if(i.canonical.isChildOf(p.canonical)){const _=i.clone();_.posMatrix=new Float64Array(16);const S=i.canonical.z-p.canonical.z,E=i.canonical.x-(i.canonical.x>>S<<S),C=i.canonical.y-(i.canonical.y>>S<<S),k=l.W>>S;l.aN(_.posMatrix,0,l.W,0,l.W,0,1),l.H(_.posMatrix,_.posMatrix,[E*k,C*k,0]),l.J(_.posMatrix,_.posMatrix,[1/2**S,1/2**S,0]),o[h]=_}}return o}getSourceTile(i,o){const h=this.sourceCache._source;let p=i.overscaledZ-this.deltaZoom;if(p>h.maxzoom&&(p=h.maxzoom),p<h.minzoom)return null;this._sourceTileCache[i.key]||(this._sourceTileCache[i.key]=i.scaledTo(p).key);let _=this.sourceCache.getTileByID(this._sourceTileCache[i.key]);if((!_||!_.dem)&&o)for(;p>=h.minzoom&&(!_||!_.dem);)_=this.sourceCache.getTileByID(i.scaledTo(p--).key);return _}tilesAfterTime(i=Date.now()){return Object.values(this._tiles).filter(o=>o.timeAdded>=i)}}class nd{constructor(i,o,h){this.painter=i,this.sourceCache=new qr(o),this.options=h,this.exaggeration=typeof h.exaggeration=="number"?h.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(i,o,h,p=l.W){var _;if(!(o>=0&&o<p&&h>=0&&h<p))return 0;const S=this.getTerrainData(i),E=(_=S.tile)===null||_===void 0?void 0:_.dem;if(!E)return 0;const C=function(ee,ne,X){var fe=ne[0],Ie=ne[1];return ee[0]=X[0]*fe+X[4]*Ie+X[12],ee[1]=X[1]*fe+X[5]*Ie+X[13],ee}([],[o/p*l.W,h/p*l.W],S.u_terrain_matrix),k=[C[0]*E.dim,C[1]*E.dim],F=Math.floor(k[0]),B=Math.floor(k[1]),q=k[0]-F,ie=k[1]-B;return E.get(F,B)*(1-q)*(1-ie)+E.get(F+1,B)*q*(1-ie)+E.get(F,B+1)*(1-q)*ie+E.get(F+1,B+1)*q*ie}getElevationForLngLatZoom(i,o){const{tileID:h,mercatorX:p,mercatorY:_}=this._getOverscaledTileIDFromLngLatZoom(i,o);return this.getElevation(h,p%l.W,_%l.W,l.W)}getElevation(i,o,h,p=l.W){return this.getDEMElevation(i,o,h,p)*this.exaggeration}getTerrainData(i){if(!this._emptyDemTexture){const p=this.painter.context,_=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Rt(p,_,p.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Rt(p,new l.R({width:1,height:1}),p.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.an([])}const o=this.sourceCache.getSourceTile(i,!0);if(o&&o.dem&&(!o.demTexture||o.needsTerrainPrepare)){const p=this.painter.context;o.demTexture=this.painter.getTileTexture(o.dem.stride),o.demTexture?o.demTexture.update(o.dem.getPixels(),{premultiply:!1}):o.demTexture=new Rt(p,o.dem.getPixels(),p.gl.RGBA,{premultiply:!1}),o.demTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),o.needsTerrainPrepare=!1}const h=o&&o+o.tileID.key+i.key;if(h&&!this._demMatrixCache[h]){const p=this.sourceCache.sourceCache._source.maxzoom;let _=i.canonical.z-o.tileID.canonical.z;i.overscaledZ>i.canonical.z&&(i.canonical.z>=p?_=i.canonical.z-p:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const S=i.canonical.x-(i.canonical.x>>_<<_),E=i.canonical.y-(i.canonical.y>>_<<_),C=l.b9(new Float64Array(16),[1/(l.W<<_),1/(l.W<<_),0]);l.H(C,C,[S*l.W,E*l.W,0]),this._demMatrixCache[i.key]={matrix:C,coord:i}}return{u_depth:2,u_terrain:3,u_terrain_dim:o&&o.dem&&o.dem.dim||1,u_terrain_matrix:h?this._demMatrixCache[i.key].matrix:this._emptyDemMatrix,u_terrain_unpack:o&&o.dem&&o.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(o&&o.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:o}}getFramebuffer(i){const o=this.painter,h=o.width/devicePixelRatio,p=o.height/devicePixelRatio;return!this._fbo||this._fbo.width===h&&this._fbo.height===p||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Rt(o.context,{width:h,height:p,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Rt(o.context,{width:h,height:p,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=o.context.createFramebuffer(h,p,!0,!1),this._fbo.depthAttachment.set(o.context.createRenderbuffer(o.context.gl.DEPTH_COMPONENT16,h,p))),this._fbo.colorAttachment.set(i==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const i=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const o=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let _=0,S=0;_<this._coordsTextureSize;_++)for(let E=0;E<this._coordsTextureSize;E++,S+=4)o[S+0]=255&E,o[S+1]=255&_,o[S+2]=E>>8<<4|_>>8,o[S+3]=0;const h=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(o.buffer)),p=new Rt(i,h,i.gl.RGBA,{premultiply:!1});return p.bind(i.gl.NEAREST,i.gl.CLAMP_TO_EDGE),this._coordsTexture=p,p}pointCoordinate(i){this.painter.maybeDrawDepthAndCoords(!0);const o=new Uint8Array(4),h=this.painter.context,p=h.gl,_=Math.round(i.x*this.painter.pixelRatio/devicePixelRatio),S=Math.round(i.y*this.painter.pixelRatio/devicePixelRatio),E=Math.round(this.painter.height/devicePixelRatio);h.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),p.readPixels(_,E-S-1,1,1,p.RGBA,p.UNSIGNED_BYTE,o),h.bindFramebuffer.set(null);const C=o[0]+(o[2]>>4<<8),k=o[1]+((15&o[2])<<8),F=this.coordsIndex[255-o[3]],B=F&&this.sourceCache.getTileByID(F);if(!B)return null;const q=this._coordsTextureSize,ie=(1<<B.tileID.canonical.z)*q;return new l.Y((B.tileID.canonical.x*q+C)/ie+B.tileID.wrap,(B.tileID.canonical.y*q+k)/ie,this.getElevation(B.tileID,C,k,q))}depthAtPoint(i){const o=new Uint8Array(4),h=this.painter.context,p=h.gl;return h.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),p.readPixels(i.x,this.painter.height/devicePixelRatio-i.y-1,1,1,p.RGBA,p.UNSIGNED_BYTE,o),h.bindFramebuffer.set(null),(o[0]/16777216+o[1]/65536+o[2]/256+o[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const i=this.painter.context,o=new l.ba,h=new l.aX,p=this.meshSize,_=l.W/p,S=p*p;for(let B=0;B<=p;B++)for(let q=0;q<=p;q++)o.emplaceBack(q*_,B*_,0);for(let B=0;B<S;B+=p+1)for(let q=0;q<p;q++)h.emplaceBack(q+B,p+q+B+1,p+q+B+2),h.emplaceBack(q+B,p+q+B+2,q+B+1);const E=o.length,C=E+2*(p+1);for(const B of[0,1])for(let q=0;q<=p;q++)for(const ie of[0,1])o.emplaceBack(q*_,B*l.W,ie);for(let B=0;B<2*p;B+=2)h.emplaceBack(C+B,C+B+1,C+B+3),h.emplaceBack(C+B,C+B+3,C+B+2),h.emplaceBack(E+B,E+B+3,E+B+1),h.emplaceBack(E+B,E+B+2,E+B+3);const k=o.length,F=k+2*(p+1);for(const B of[0,1])for(let q=0;q<=p;q++)for(const ie of[0,1])o.emplaceBack(B*l.W,q*_,ie);for(let B=0;B<2*p;B+=2)h.emplaceBack(k+B,k+B+1,k+B+3),h.emplaceBack(k+B,k+B+3,k+B+2),h.emplaceBack(F+B,F+B+3,F+B+1),h.emplaceBack(F+B,F+B+2,F+B+3);return this._mesh={indexBuffer:i.createIndexBuffer(h),vertexBuffer:i.createVertexBuffer(o,zr.members),segments:l.$.simpleSegment(0,0,o.length,h.length)},this._mesh}getMeshFrameDelta(i){return 2*Math.PI*l.bb/Math.pow(2,i)/5}getMinTileElevationForLngLatZoom(i,o){var h;const{tileID:p}=this._getOverscaledTileIDFromLngLatZoom(i,o);return(h=this.getMinMaxElevation(p).minElevation)!==null&&h!==void 0?h:0}getMinMaxElevation(i){const o=this.getTerrainData(i).tile,h={minElevation:null,maxElevation:null};return o&&o.dem&&(h.minElevation=o.dem.min*this.exaggeration,h.maxElevation=o.dem.max*this.exaggeration),h}_getOverscaledTileIDFromLngLatZoom(i,o){const h=l.Y.fromLngLat(i.wrap()),p=(1<<o)*l.W,_=h.x*p,S=h.y*p,E=Math.floor(_/l.W),C=Math.floor(S/l.W);return{tileID:new l.Q(o,0,o,E,C),mercatorX:_,mercatorY:S}}}class Hl{constructor(i,o,h){this._context=i,this._size=o,this._tileSize=h,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const i of this._objects)i.texture.destroy(),i.fbo.destroy()}_createObject(i){const o=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),h=new Rt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return h.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),o.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),o.colorAttachment.set(h.texture),{id:i,fbo:o,texture:h,stamp:-1,inUse:!1}}getObjectForId(i){return this._objects[i]}useObject(i){i.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(o=>i.id!==o),this._recentlyUsed.push(i.id)}stampObject(i){i.stamp=++this._stamp}getOrCreateFreeObject(){for(const o of this._recentlyUsed)if(!this._objects[o].inUse)return this._objects[o];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const i=this._createObject(this._objects.length);return this._objects.push(i),i}freeObject(i){i.inUse=!1}freeAllObjects(){for(const i of this._objects)this.freeObject(i)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(i=>!i.inUse)===!1}}const Ca={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Tu{constructor(i,o){this.painter=i,this.terrain=o,this.pool=new Hl(i.context,30,o.sourceCache.tileSize*o.qualityFactor)}destruct(){this.pool.destruct()}getTexture(i){return this.pool.getObjectForId(i.rtt[this._stacks.length-1].id).texture}prepareForRender(i,o){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=i._order.filter(h=>!i._layers[h].isHidden(o)),this._coordsDescendingInv={};for(const h in i.sourceCaches){this._coordsDescendingInv[h]={};const p=i.sourceCaches[h].getVisibleCoordinates();for(const _ of p){const S=this.terrain.sourceCache.getTerrainCoords(_);for(const E in S)this._coordsDescendingInv[h][E]||(this._coordsDescendingInv[h][E]=[]),this._coordsDescendingInv[h][E].push(S[E])}}this._coordsDescendingInvStr={};for(const h of i._order){const p=i._layers[h],_=p.source;if(Ca[p.type]&&!this._coordsDescendingInvStr[_]){this._coordsDescendingInvStr[_]={};for(const S in this._coordsDescendingInv[_])this._coordsDescendingInvStr[_][S]=this._coordsDescendingInv[_][S].map(E=>E.key).sort().join()}}for(const h of this._renderableTiles)for(const p in this._coordsDescendingInvStr){const _=this._coordsDescendingInvStr[p][h.tileID.key];_&&_!==h.rttCoords[p]&&(h.rtt=[])}}renderLayer(i){if(i.isHidden(this.painter.transform.zoom))return!1;const o=i.type,h=this.painter,p=this._renderableLayerIds[this._renderableLayerIds.length-1]===i.id;if(Ca[o]&&(this._prevType&&Ca[this._prevType]||this._stacks.push([]),this._prevType=o,this._stacks[this._stacks.length-1].push(i.id),!p))return!0;if(Ca[this._prevType]||Ca[o]&&p){this._prevType=o;const _=this._stacks.length-1,S=this._stacks[_]||[];for(const E of this._renderableTiles){if(this.pool.isFull()&&(tl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(E),E.rtt[_]){const k=this.pool.getObjectForId(E.rtt[_].id);if(k.stamp===E.rtt[_].stamp){this.pool.useObject(k);continue}}const C=this.pool.getOrCreateFreeObject();this.pool.useObject(C),this.pool.stampObject(C),E.rtt[_]={id:C.id,stamp:C.stamp},h.context.bindFramebuffer.set(C.fbo.framebuffer),h.context.clear({color:l.aO.transparent,stencil:0}),h.currentStencilSource=void 0;for(let k=0;k<S.length;k++){const F=h.style._layers[S[k]],B=F.source?this._coordsDescendingInv[F.source][E.tileID.key]:[E.tileID];h.context.viewport.set([0,0,C.fbo.width,C.fbo.height]),h._renderTileClippingMasks(F,B),h.renderLayer(h,h.style.sourceCaches[F.source],F,B),F.source&&(E.rttCoords[F.source]=this._coordsDescendingInvStr[F.source][E.tileID.key])}}return tl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Ca[o]}return!1}}const Cu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Iu=M,Zl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Eu,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Sc=y=>{y.touchstart=y.dragStart,y.touchmoveWindow=y.dragMove,y.touchend=y.dragEnd},Au={showCompass:!0,showZoom:!0,visualizePitch:!1};class Pu{constructor(i,o,h=!1){this.mousedown=S=>{this.startMouse(l.e({},S,{ctrlKey:!0,preventDefault:()=>S.preventDefault()}),z.mousePos(this.element,S)),z.addEventListener(window,"mousemove",this.mousemove),z.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=S=>{this.moveMouse(S,z.mousePos(this.element,S))},this.mouseup=S=>{this.mouseRotate.dragEnd(S),this.mousePitch&&this.mousePitch.dragEnd(S),this.offTemp()},this.touchstart=S=>{S.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=z.touchPos(this.element,S.targetTouches)[0],this.startTouch(S,this._startPos),z.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),z.addEventListener(window,"touchend",this.touchend))},this.touchmove=S=>{S.targetTouches.length!==1?this.reset():(this._lastPos=z.touchPos(this.element,S.targetTouches)[0],this.moveTouch(S,this._lastPos))},this.touchend=S=>{S.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const p=i.dragRotate._mouseRotate.getClickTolerance(),_=i.dragRotate._mousePitch.getClickTolerance();this.element=o,this.mouseRotate=ls({clickTolerance:p,enable:!0}),this.touchRotate=(({enable:S,clickTolerance:E,bearingDegreesPerPixelMoved:C=.8})=>{const k=new Tt;return new en({clickTolerance:E,move:(F,B)=>({bearingDelta:(B.x-F.x)*C}),moveStateManager:k,enable:S,assignEvents:Sc})})({clickTolerance:p,enable:!0}),this.map=i,h&&(this.mousePitch=Wn({clickTolerance:_,enable:!0}),this.touchPitch=(({enable:S,clickTolerance:E,pitchDegreesPerPixelMoved:C=-.5})=>{const k=new Tt;return new en({clickTolerance:E,move:(F,B)=>({pitchDelta:(B.y-F.y)*C}),moveStateManager:k,enable:S,assignEvents:Sc})})({clickTolerance:_,enable:!0})),z.addEventListener(o,"mousedown",this.mousedown),z.addEventListener(o,"touchstart",this.touchstart,{passive:!1}),z.addEventListener(o,"touchcancel",this.reset)}startMouse(i,o){this.mouseRotate.dragStart(i,o),this.mousePitch&&this.mousePitch.dragStart(i,o),z.disableDrag()}startTouch(i,o){this.touchRotate.dragStart(i,o),this.touchPitch&&this.touchPitch.dragStart(i,o),z.disableDrag()}moveMouse(i,o){const h=this.map,{bearingDelta:p}=this.mouseRotate.dragMove(i,o)||{};if(p&&h.setBearing(h.getBearing()+p),this.mousePitch){const{pitchDelta:_}=this.mousePitch.dragMove(i,o)||{};_&&h.setPitch(h.getPitch()+_)}}moveTouch(i,o){const h=this.map,{bearingDelta:p}=this.touchRotate.dragMove(i,o)||{};if(p&&h.setBearing(h.getBearing()+p),this.touchPitch){const{pitchDelta:_}=this.touchPitch.dragMove(i,o)||{};_&&h.setPitch(h.getPitch()+_)}}off(){const i=this.element;z.removeEventListener(i,"mousedown",this.mousedown),z.removeEventListener(i,"touchstart",this.touchstart,{passive:!1}),z.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),z.removeEventListener(window,"touchend",this.touchend),z.removeEventListener(i,"touchcancel",this.reset),this.offTemp()}offTemp(){z.enableDrag(),z.removeEventListener(window,"mousemove",this.mousemove),z.removeEventListener(window,"mouseup",this.mouseup),z.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),z.removeEventListener(window,"touchend",this.touchend)}}let Ia;function Ec(y,i,o){const h=new l.M(y.lng,y.lat);if(y=new l.M(y.lng,y.lat),i){const p=new l.M(y.lng-360,y.lat),_=new l.M(y.lng+360,y.lat),S=o.locationPoint(y).distSqr(i);o.locationPoint(p).distSqr(i)<S?y=p:o.locationPoint(_).distSqr(i)<S&&(y=_)}for(;Math.abs(y.lng-o.center.lng)>180;){const p=o.locationPoint(y);if(p.x>=0&&p.y>=0&&p.x<=o.width&&p.y<=o.height)break;y.lng>o.center.lng?y.lng-=360:y.lng+=360}return y.lng!==h.lng&&o.locationPoint(y).y>o.height/2-o.getHorizon()?y:h}const Wl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Tc(y,i,o){const h=y.classList;for(const p in Wl)h.remove(`maplibregl-${o}-anchor-${p}`);h.add(`maplibregl-${o}-anchor-${i}`)}class Xl extends l.E{constructor(i){if(super(),this._onKeyPress=o=>{const h=o.code,p=o.charCode||o.keyCode;h!=="Space"&&h!=="Enter"&&p!==32&&p!==13||this.togglePopup()},this._onMapClick=o=>{const h=o.originalEvent.target,p=this._element;this._popup&&(h===p||p.contains(h))&&this.togglePopup()},this._update=o=>{var h;if(!this._map)return;const p=this._map.loaded()&&!this._map.isMoving();((o==null?void 0:o.type)==="terrain"||(o==null?void 0:o.type)==="render"&&!p)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Ec(this._lngLat,this._flatPos,this._map.transform):(h=this._lngLat)===null||h===void 0?void 0:h.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let _="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?_=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(_=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S=`rotateX(${this._map.getPitch()}deg)`),o&&o.type!=="moveend"||(this._pos=this._pos.round()),z.setTransform(this._element,`${Wl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${S} ${_}`),D.frameAsync(new AbortController).then(()=>{this._updateOpacity(o&&o.type==="moveend")}).catch(()=>{})},this._onMove=o=>{if(!this._isDragging){const h=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.k("dragstart"))),this.fire(new l.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.k("dragend")),this._state="inactive"},this._addDragHandler=o=>{this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment!=="auto"?i.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(i==null?void 0:i.opacity,i==null?void 0:i.opacityWhenCovered),i&&i.element)this._element=i.element,this._offset=l.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=z.create("div"),this._element.setAttribute("aria-label","Map marker");const o=z.createNS("http://www.w3.org/2000/svg","svg"),h=41,p=27;o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height",`${h}px`),o.setAttributeNS(null,"width",`${p}px`),o.setAttributeNS(null,"viewBox",`0 0 ${p} ${h}`);const _=z.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"stroke","none"),_.setAttributeNS(null,"stroke-width","1"),_.setAttributeNS(null,"fill","none"),_.setAttributeNS(null,"fill-rule","evenodd");const S=z.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"fill-rule","nonzero");const E=z.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"transform","translate(3.0, 29.0)"),E.setAttributeNS(null,"fill","#000000");const C=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const fe of C){const Ie=z.createNS("http://www.w3.org/2000/svg","ellipse");Ie.setAttributeNS(null,"opacity","0.04"),Ie.setAttributeNS(null,"cx","10.5"),Ie.setAttributeNS(null,"cy","5.80029008"),Ie.setAttributeNS(null,"rx",fe.rx),Ie.setAttributeNS(null,"ry",fe.ry),E.appendChild(Ie)}const k=z.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"fill",this._color);const F=z.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),k.appendChild(F);const B=z.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"opacity","0.25"),B.setAttributeNS(null,"fill","#000000");const q=z.createNS("http://www.w3.org/2000/svg","path");q.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),B.appendChild(q);const ie=z.createNS("http://www.w3.org/2000/svg","g");ie.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ie.setAttributeNS(null,"fill","#FFFFFF");const ee=z.createNS("http://www.w3.org/2000/svg","g");ee.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ne=z.createNS("http://www.w3.org/2000/svg","circle");ne.setAttributeNS(null,"fill","#000000"),ne.setAttributeNS(null,"opacity","0.25"),ne.setAttributeNS(null,"cx","5.5"),ne.setAttributeNS(null,"cy","5.5"),ne.setAttributeNS(null,"r","5.4999962");const X=z.createNS("http://www.w3.org/2000/svg","circle");X.setAttributeNS(null,"fill","#FFFFFF"),X.setAttributeNS(null,"cx","5.5"),X.setAttributeNS(null,"cy","5.5"),X.setAttributeNS(null,"r","5.4999962"),ee.appendChild(ne),ee.appendChild(X),S.appendChild(E),S.appendChild(k),S.appendChild(B),S.appendChild(ie),S.appendChild(ee),o.appendChild(S),o.setAttributeNS(null,"height",h*this._scale+"px"),o.setAttributeNS(null,"width",p*this._scale+"px"),this._element.appendChild(o),this._offset=l.P.convert(i&&i.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",o=>{o.preventDefault()}),this._element.addEventListener("mousedown",o=>{o.preventDefault()}),Tc(this._element,this._anchor,"marker"),i&&i.className)for(const o of i.className.split(" "))this._element.classList.add(o);this._popup=null}addTo(i){return this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._update),i.on("moveend",this._update),i.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),z.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=l.M.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const p=Math.abs(13.5)/Math.SQRT2;i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const i=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:i?(i.isOpen()?i.remove():(i.setLngLat(this._lngLat),i.addTo(this._map)),this):this}_updateOpacity(i=!1){var o,h;if(!(!((o=this._map)===null||o===void 0)&&o.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(i)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const p=this._map,_=p.terrain.depthAtPoint(this._pos),S=p.terrain.getElevationForLngLatZoom(this._lngLat,p.transform.tileZoom);if(p.transform.lngLatToCameraDepth(this._lngLat,S)-_<.006)return void(this._element.style.opacity=this._opacity);const E=-this._offset.y/p.transform._pixelPerMeter,C=Math.sin(p.getPitch()*Math.PI/180)*E,k=p.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),F=p.transform.lngLatToCameraDepth(this._lngLat,S+C)-k>.006;!((h=this._popup)===null||h===void 0)&&h.isOpen()&&F&&this._popup.remove(),this._element.style.opacity=F?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(i){return this._offset=l.P.convert(i),this._update(),this}addClassName(i){this._element.classList.add(i)}removeClassName(i){this._element.classList.remove(i)}toggleClassName(i){return this._element.classList.toggle(i)}setDraggable(i){return this._draggable=!!i,this._map&&(i?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i&&i!=="auto"?i:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(i,o){return i===void 0&&o===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),i!==void 0&&(this._opacity=i),o!==void 0&&(this._opacityWhenCovered=o),this._map&&this._updateOpacity(!0),this}}const Cc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let rl=0,xo=!1;const Ic={maxWidth:100,unit:"metric"};function Ac(y,i,o){const h=o&&o.maxWidth||100,p=y._container.clientHeight/2,_=y.unproject([0,p]),S=y.unproject([h,p]),E=_.distanceTo(S);if(o&&o.unit==="imperial"){const C=3.2808*E;C>5280?bo(i,h,C/5280,y._getUIString("ScaleControl.Miles")):bo(i,h,C,y._getUIString("ScaleControl.Feet"))}else o&&o.unit==="nautical"?bo(i,h,E/1852,y._getUIString("ScaleControl.NauticalMiles")):E>=1e3?bo(i,h,E/1e3,y._getUIString("ScaleControl.Kilometers")):bo(i,h,E,y._getUIString("ScaleControl.Meters"))}function bo(y,i,o,h){const p=function(_){const S=Math.pow(10,`${Math.floor(_)}`.length-1);let E=_/S;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:function(C){const k=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*k)/k}(E),S*E}(o);y.style.width=i*(p/o)+"px",y.innerHTML=`${p}&nbsp;${h}`}const Du={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},ku=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Pc(y){if(y){if(typeof y=="number"){const i=Math.round(Math.abs(y)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,y),"top-left":new l.P(i,i),"top-right":new l.P(-i,i),bottom:new l.P(0,-y),"bottom-left":new l.P(i,-i),"bottom-right":new l.P(-i,-i),left:new l.P(y,0),right:new l.P(-y,0)}}if(y instanceof l.P||Array.isArray(y)){const i=l.P.convert(y);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:l.P.convert(y.center||[0,0]),top:l.P.convert(y.top||[0,0]),"top-left":l.P.convert(y["top-left"]||[0,0]),"top-right":l.P.convert(y["top-right"]||[0,0]),bottom:l.P.convert(y.bottom||[0,0]),"bottom-left":l.P.convert(y["bottom-left"]||[0,0]),"bottom-right":l.P.convert(y["bottom-right"]||[0,0]),left:l.P.convert(y.left||[0,0]),right:l.P.convert(y.right||[0,0])}}return Pc(new l.P(0,0))}const sd=M;m.AJAXError=l.be,m.Evented=l.E,m.LngLat=l.M,m.MercatorCoordinate=l.Y,m.Point=l.P,m.addProtocol=l.bf,m.config=l.a,m.removeProtocol=l.bg,m.AttributionControl=Gs,m.BoxZoomHandler=Ai,m.CanvasSource=Dt,m.CooperativeGesturesHandler=jt,m.DoubleClickZoomHandler=Mu,m.DragPanHandler=id,m.DragRotateHandler=qs,m.EdgeInsets=Wt,m.FullscreenControl=class extends l.E{constructor(y={}){super(),this._onFullscreenChange=()=>{var i;let o=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((i=o==null?void 0:o.shadowRoot)===null||i===void 0)&&i.fullscreenElement;)o=o.shadowRoot.fullscreenElement;o===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){z.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const y=this._fullscreenButton=z.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);z.create("span","maplibregl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},m.GeoJSONSource=At,m.GeolocateControl=class extends l.E{constructor(y){super(),this._onSuccess=i=>{if(this._map){if(this._isOutOfMapMaxBounds(i))return this._setErrorState(),this.fire(new l.k("outofmaxbounds",i)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=i,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(i),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(i),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.k("geolocate",i)),this._finish()}},this._updateCamera=i=>{const o=new l.M(i.coords.longitude,i.coords.latitude),h=i.coords.accuracy,p=this._map.getBearing(),_=l.e({bearing:p},this.options.fitBoundsOptions),S=ue.fromLngLat(o,h);this._map.fitBounds(S,_,{geolocateSource:!0})},this._updateMarker=i=>{if(i){const o=new l.M(i.coords.longitude,i.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=i.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=i=>{if(this._map){if(this.options.trackUserLocation)if(i.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(i.code===3&&xo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.k("error",i)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=i=>{if(this._map){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=z.create("button","maplibregl-ctrl-geolocate",this._container),z.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",i===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=z.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Xl({element:this._dotElement}),this._circleElement=z.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Xl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.k("trackuserlocationend")))})}},this.options=l.e({},Cc,y)}onAdd(y){return this._map=y,this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return l._(this,arguments,void 0,function*(i=!1){if(Ia!==void 0&&!i)return Ia;if(window.navigator.permissions===void 0)return Ia=!!window.navigator.geolocation,Ia;try{Ia=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Ia=!!window.navigator.geolocation}return Ia})}().then(i=>this._setupUI(i)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),z.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,rl=0,xo=!1}_isOutOfMapMaxBounds(y){const i=this._map.getMaxBounds(),o=y.coords;return i&&(o.longitude<i.getWest()||o.longitude>i.getEast()||o.latitude<i.getSouth()||o.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const y=this._map.getBounds(),i=y.getSouthEast(),o=y.getNorthEast(),h=i.distanceTo(o),p=Math.ceil(this._accuracy/(h/this._map._container.clientHeight)*2);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":rl--,xo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),rl++,rl>1?(y={maximumAge:6e5,timeout:0},xo=!0):(y=this.options.positionOptions,xo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},m.Hash=Cr,m.ImageSource=rt,m.KeyboardHandler=Ha,m.LngLatBounds=ue,m.LogoControl=rd,m.Map=class extends Xn{constructor(y){if(l.bc.mark(l.bd.create),(y=l.e({},Zl,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Ci(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies),{bearingSnap:y.bearingSnap}),this._contextLost=i=>{i.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new l.k("webglcontextlost",{originalEvent:i}))},this._contextRestored=i=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.k("webglcontextrestored",{originalEvent:i}))},this._onMapScroll=i=>{if(i.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=y.interactive,this._maxTileCacheSize=y.maxTileCacheSize,this._maxTileCacheZoomLevels=y.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._crossSourceCollisions=y.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=y.collectResourceTiming,this._renderTaskQueue=new Gl,this._controls=[],this._mapId=l.a3(),this._locale=l.e({},Cu,y.locale),this._clickTolerance=y.clickTolerance,this._overridePixelRatio=y.pixelRatio,this._maxCanvasSize=y.maxCanvasSize,this.transformCameraUpdate=y.transformCameraUpdate,this._imageQueueHandle=oe.addThrottleControl(()=>this.isMoving()),this._requestManager=new Le(y.transformRequest),typeof y.container=="string"){if(this._container=document.getElementById(y.container),!this._container)throw new Error(`Container '${y.container}' not found.`)}else{if(!(y.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(y.maxBounds&&this.setMaxBounds(y.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let i=!1;const o=mr(h=>{this._trackResize&&!this._removed&&this.resize(h)._update()},50);this._resizeObserver=new ResizeObserver(h=>{i?o(h):i=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Su(this,y),this._hash=y.hash&&new Cr(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,l.e({},y.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=y.localIdeographFontFamily,this._validateStyle=y.validateStyle,y.style&&this.setStyle(y.style,{localIdeographFontFamily:y.localIdeographFontFamily}),y.attributionControl&&this.addControl(new Gs(typeof y.attributionControl=="boolean"?void 0:y.attributionControl)),y.maplibreLogo&&this.addControl(new rd,y.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update(i.dataType==="style"),this.fire(new l.k(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new l.k(`${i.dataType}dataloading`,i))}),this.on("dataabort",i=>{this.fire(new l.k("sourcedataabort",i))})}_getMapId(){return this._mapId}addControl(y,i){if(i===void 0&&(i=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new l.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=y.onAdd(this);this._controls.push(y);const h=this._controlPositions[i];return i.indexOf("bottom")!==-1?h.insertBefore(o,h.firstChild):h.appendChild(o),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new l.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(y);return i>-1&&this._controls.splice(i,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}calculateCameraOptionsFromTo(y,i,o,h){return h==null&&this.terrain&&(h=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(y,i,o,h)}resize(y){var i;const o=this._containerDimensions(),h=o[0],p=o[1],_=this._getClampedPixelRatio(h,p);if(this._resizeCanvas(h,p,_),this.painter.resize(h,p,_),this.painter.overLimit()){const E=this.painter.context.gl;this._maxCanvasSize=[E.drawingBufferWidth,E.drawingBufferHeight];const C=this._getClampedPixelRatio(h,p);this._resizeCanvas(h,p,C),this.painter.resize(h,p,C)}this.transform.resize(h,p),(i=this._requestedCameraState)===null||i===void 0||i.resize(h,p);const S=!this._moving;return S&&(this.stop(),this.fire(new l.k("movestart",y)).fire(new l.k("move",y))),this.fire(new l.k("resize",y)),S&&this.fire(new l.k("moveend",y)),this}_getClampedPixelRatio(y,i){const{0:o,1:h}=this._maxCanvasSize,p=this.getPixelRatio(),_=y*p,S=i*p;return Math.min(_>o?o/_:1,S>h?h/S:1)*p}getPixelRatio(){var y;return(y=this._overridePixelRatio)!==null&&y!==void 0?y:devicePixelRatio}setPixelRatio(y){this._overridePixelRatio=y,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(y){return this.transform.setMaxBounds(ue.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y&&this.setZoom(y),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y&&this.setZoom(y),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this._update()}project(y){return this.transform.locationPoint(l.M.convert(y),this.style&&this.terrain)}unproject(y){return this.transform.pointLocation(l.P.convert(y),this.terrain)}isMoving(){var y;return this._moving||((y=this.handlers)===null||y===void 0?void 0:y.isMoving())}isZooming(){var y;return this._zooming||((y=this.handlers)===null||y===void 0?void 0:y.isZooming())}isRotating(){var y;return this._rotating||((y=this.handlers)===null||y===void 0?void 0:y.isRotating())}_createDelegatedListener(y,i,o){if(y==="mouseenter"||y==="mouseover"){let h=!1;return{layer:i,listener:o,delegates:{mousemove:_=>{const S=this.getLayer(i)?this.queryRenderedFeatures(_.point,{layers:[i]}):[];S.length?h||(h=!0,o.call(this,new Qr(y,this,_.originalEvent,{features:S}))):h=!1},mouseout:()=>{h=!1}}}}if(y==="mouseleave"||y==="mouseout"){let h=!1;return{layer:i,listener:o,delegates:{mousemove:S=>{(this.getLayer(i)?this.queryRenderedFeatures(S.point,{layers:[i]}):[]).length?h=!0:h&&(h=!1,o.call(this,new Qr(y,this,S.originalEvent)))},mouseout:S=>{h&&(h=!1,o.call(this,new Qr(y,this,S.originalEvent)))}}}}{const h=p=>{const _=this.getLayer(i)?this.queryRenderedFeatures(p.point,{layers:[i]}):[];_.length&&(p.features=_,o.call(this,p),delete p.features)};return{layer:i,listener:o,delegates:{[y]:h}}}}on(y,i,o){if(o===void 0)return super.on(y,i);const h=this._createDelegatedListener(y,i,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(h);for(const p in h.delegates)this.on(p,h.delegates[p]);return this}once(y,i,o){if(o===void 0)return super.once(y,i);const h=this._createDelegatedListener(y,i,o);for(const p in h.delegates)this.once(p,h.delegates[p]);return this}off(y,i,o){return o===void 0?super.off(y,i):(this._delegatedListeners&&this._delegatedListeners[y]&&(h=>{const p=this._delegatedListeners[y];for(let _=0;_<p.length;_++){const S=p[_];if(S.layer===i&&S.listener===o){for(const E in S.delegates)this.off(E,S.delegates[E]);return p.splice(_,1),this}}})(),this)}queryRenderedFeatures(y,i){if(!this.style)return[];let o;const h=y instanceof l.P||Array.isArray(y),p=h?y:[[0,0],[this.transform.width,this.transform.height]];if(i=i||(h?{}:y)||{},p instanceof l.P||typeof p[0]=="number")o=[l.P.convert(p)];else{const _=l.P.convert(p[0]),S=l.P.convert(p[1]);o=[_,new l.P(S.x,_.y),S,new l.P(_.x,S.y),_]}return this.style.queryRenderedFeatures(o,i,this.transform)}querySourceFeatures(y,i){return this.style.querySourceFeatures(y,i)}setStyle(y,i){return(i=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},i)).diff!==!1&&i.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._updateStyle(y,i))}setTransformRequest(y){return this._requestManager.setTransformRequest(y),this}_getUIString(y){const i=this._locale[y];if(i==null)throw new Error(`Missing UI string '${y}'`);return i}_updateStyle(y,i){if(i.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(y,i));const o=this.style&&i.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!y)),y?(this.style=new wn(this,i||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y,i,o):this.style.loadJSON(y,i,o),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new wn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,i){if(typeof y=="string"){const o=this._requestManager.transformRequest(y,"Style");l.h(o,new AbortController).then(h=>{this._updateDiff(h.data,i)}).catch(h=>{h&&this.fire(new l.j(h))})}else typeof y=="object"&&this._updateDiff(y,i)}_updateDiff(y,i){try{this.style.setState(y,i)&&this._update(!0)}catch(o){l.w(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(y,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(y,i){return this._lazyInitEmptyStyle(),this.style.addSource(y,i),this._update(!0)}isSourceLoaded(y){const i=this.style&&this.style.sourceCaches[y];if(i!==void 0)return i.loaded();this.fire(new l.j(new Error(`There is no source with ID '${y}'`)))}setTerrain(y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),y){const i=this.style.sourceCaches[y.source];if(!i)throw new Error(`cannot load terrain, because there exists no source with ID: ${y.source}`);this.terrain===null&&i.reload();for(const o in this.style._layers){const h=this.style._layers[o];h.type==="hillshade"&&h.source===y.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new nd(this.painter,i,y),this.painter.renderToTexture=new Tu(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=o=>{o.dataType==="style"?this.terrain.sourceCache.freeRtt():o.dataType==="source"&&o.tile&&(o.sourceId!==y.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(o.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new l.k("terrain",{terrain:y})),this}getTerrain(){var y,i;return(i=(y=this.terrain)===null||y===void 0?void 0:y.options)!==null&&i!==void 0?i:null}areTilesLoaded(){const y=this.style&&this.style.sourceCaches;for(const i in y){const o=y[i]._tiles;for(const h in o){const p=o[h];if(p.state!=="loaded"&&p.state!=="errored")return!1}}return!0}removeSource(y){return this.style.removeSource(y),this._update(!0)}getSource(y){return this.style.getSource(y)}addImage(y,i,o={}){const{pixelRatio:h=1,sdf:p=!1,stretchX:_,stretchY:S,content:E}=o;if(this._lazyInitEmptyStyle(),!(i instanceof HTMLImageElement||l.b(i))){if(i.width===void 0||i.height===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:C,height:k,data:F}=i,B=i;return this.style.addImage(y,{data:new l.R({width:C,height:k},new Uint8Array(F)),pixelRatio:h,stretchX:_,stretchY:S,content:E,sdf:p,version:0,userImage:B}),B.onAdd&&B.onAdd(this,y),this}}{const{width:C,height:k,data:F}=D.getImageData(i);this.style.addImage(y,{data:new l.R({width:C,height:k},F),pixelRatio:h,stretchX:_,stretchY:S,content:E,sdf:p,version:0})}}updateImage(y,i){const o=this.style.getImage(y);if(!o)return this.fire(new l.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const h=i instanceof HTMLImageElement||l.b(i)?D.getImageData(i):i,{width:p,height:_,data:S}=h;if(p===void 0||_===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==o.data.width||_!==o.data.height)return this.fire(new l.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const E=!(i instanceof HTMLImageElement||l.b(i));return o.data.replace(S,E),this.style.updateImage(y,o),this}getImage(y){return this.style.getImage(y)}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new l.j(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y){return oe.getImage(this._requestManager.transformRequest(y,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(y,i){return this._lazyInitEmptyStyle(),this.style.addLayer(y,i),this._update(!0)}moveLayer(y,i){return this.style.moveLayer(y,i),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(y,i,o){return this.style.setLayerZoomRange(y,i,o),this._update(!0)}setFilter(y,i,o={}){return this.style.setFilter(y,i,o),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,i,o,h={}){return this.style.setPaintProperty(y,i,o,h),this._update(!0)}getPaintProperty(y,i){return this.style.getPaintProperty(y,i)}setLayoutProperty(y,i,o,h={}){return this.style.setLayoutProperty(y,i,o,h),this._update(!0)}getLayoutProperty(y,i){return this.style.getLayoutProperty(y,i)}setGlyphs(y,i={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(y,i),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(y,i,o={}){return this._lazyInitEmptyStyle(),this.style.addSprite(y,i,o,h=>{h||this._update(!0)}),this}removeSprite(y){return this._lazyInitEmptyStyle(),this.style.removeSprite(y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(y,i={}){return this._lazyInitEmptyStyle(),this.style.setSprite(y,i,o=>{o||this._update(!0)}),this}setLight(y,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,i),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(y,i){return this.style.setFeatureState(y,i),this._update()}removeFeatureState(y,i){return this.style.removeFeatureState(y,i),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let y=0,i=0;return this._container&&(y=this._container.clientWidth||400,i=this._container.clientHeight||300),[y,i]}_setupContainer(){const y=this._container;y.classList.add("maplibregl-map");const i=this._canvasContainer=z.create("div","maplibregl-canvas-container",y);this._interactive&&i.classList.add("maplibregl-interactive"),this._canvas=z.create("canvas","maplibregl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const o=this._containerDimensions(),h=this._getClampedPixelRatio(o[0],o[1]);this._resizeCanvas(o[0],o[1],h);const p=this._controlContainer=z.create("div","maplibregl-control-container",y),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(S=>{_[S]=z.create("div",`maplibregl-ctrl-${S} `,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,i,o){this._canvas.width=Math.floor(o*y),this._canvas.height=Math.floor(o*i),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${i}px`}_setupPainter(){const y={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let i=null;this._canvas.addEventListener("webglcontextcreationerror",h=>{i={requestedAttributes:y},h&&(i.statusMessage=h.statusMessage,i.type=h.type)},{once:!0});const o=this._canvas.getContext("webgl2",y)||this._canvas.getContext("webgl",y);if(!o){const h="Failed to initialize WebGL";throw i?(i.message=h,new Error(JSON.stringify(i))):new Error(h)}this.painter=new Ee(o,this.transform),Z.testSupport(o)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_render(y){const i=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),this._removed)return;let o=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const p=this.transform.zoom,_=D.now();this.style.zoomHistory.update(p,_);const S=new l.a8(p,{now:_,fadeDuration:i,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),E=S.crossFadingFactor();E===1&&E===this._crossFadingFactor||(o=!0,this._crossFadingFactor=E),this.style.update(S)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,i,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:i,showPadding:this.showPadding}),this.fire(new l.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.bc.mark(l.bd.load),this.fire(new l.k("load"))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const h=this._sourcesDirty||this._styleDirty||this._placementDirty;return h||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.k("idle")),!this._loaded||this._fullyLoaded||h||(this._fullyLoaded=!0,l.bc.mark(l.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var y;this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),oe.removeThrottleControl(this._imageQueueHandle),(y=this._resizeObserver)===null||y===void 0||y.disconnect();const i=this.painter.context.gl.getExtension("WEBGL_lose_context");i&&i.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),z.remove(this._canvasContainer),z.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),l.bc.clearMetrics(),this._removed=!0,this.fire(new l.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,D.frameAsync(this._frameRequest).then(y=>{l.bc.frame(y),this._frameRequest=null,this._render(y)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get version(){return Iu}getCameraTargetElevation(){return this.transform.elevation}},m.MapMouseEvent=Qr,m.MapTouchEvent=En,m.MapWheelEvent=Sa,m.Marker=Xl,m.NavigationControl=class{constructor(y){this._updateZoomButtons=()=>{const i=this._map.getZoom(),o=i===this._map.getMaxZoom(),h=i===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())},this._rotateCompassArrow=()=>{const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=i},this._setButtonTitle=(i,o)=>{const h=this._map._getUIString(`NavigationControl.${o}`);i.title=h,i.setAttribute("aria-label",h)},this.options=l.e({},Au,y),this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",i=>this._map.zoomIn({},{originalEvent:i})),z.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",i=>this._map.zoomOut({},{originalEvent:i})),z.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",i=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:i}):this._map.resetNorth({},{originalEvent:i})}),this._compassIcon=z.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Pu(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){z.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(y,i){const o=z.create("button",y,this._container);return o.type="button",o.addEventListener("click",i),o}},m.Popup=class extends l.E{constructor(y){super(),this.remove=()=>(this._content&&z.remove(this._content),this._container&&(z.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.k("close"))),this),this._onMouseUp=i=>{this._update(i.point)},this._onMouseMove=i=>{this._update(i.point)},this._onDrag=i=>{this._update(i.point)},this._update=i=>{var o;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=z.create("div","maplibregl-popup",this._map.getContainer()),this._tip=z.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const E of this.options.className.split(" "))this._container.classList.add(E);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Ec(this._lngLat,this._flatPos,this._map.transform):(o=this._lngLat)===null||o===void 0?void 0:o.wrap(),this._trackPointer&&!i)return;const h=this._flatPos=this._pos=this._trackPointer&&i?i:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&i?i:this._map.transform.locationPoint(this._lngLat));let p=this.options.anchor;const _=Pc(this.options.offset);if(!p){const E=this._container.offsetWidth,C=this._container.offsetHeight;let k;k=h.y+_.bottom.y<C?["top"]:h.y>this._map.transform.height-C?["bottom"]:[],h.x<E/2?k.push("left"):h.x>this._map.transform.width-E/2&&k.push("right"),p=k.length===0?"bottom":k.join("-")}let S=h.add(_[p]);this.options.subpixelPositioning||(S=S.round()),z.setTransform(this._container,`${Wl[p]} translate(${S.x}px,${S.y}px)`),Tc(this._container,p,"popup")},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(Du),y)}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=l.M.convert(y),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const i=document.createDocumentFragment(),o=document.createElement("body");let h;for(o.innerHTML=y;h=o.firstChild,h;)i.appendChild(h);return this.setDOMContent(i)}getMaxWidth(){var y;return(y=this._container)===null||y===void 0?void 0:y.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=z.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(y){this._container&&this._container.classList.add(y)}removeClassName(y){this._container&&this._container.classList.remove(y)}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){if(this._container)return this._container.classList.toggle(y)}setSubpixelPositioning(y){this.options.subpixelPositioning=y}_createCloseButton(){this.options.closeButton&&(this._closeButton=z.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(ku);y&&y.focus()}},m.RasterDEMTileSource=pt,m.RasterTileSource=ce,m.ScaleControl=class{constructor(y){this._onMove=()=>{Ac(this._map,this._container,this.options)},this.setUnit=i=>{this.options.unit=i,Ac(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Ic),y)}getDefaultPosition(){return"bottom-left"}onAdd(y){return this._map=y,this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){z.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},m.ScrollZoomHandler=wc,m.Style=wn,m.TerrainControl=class{constructor(y){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=y}onAdd(y){return this._map=y,this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=z.create("button","maplibregl-ctrl-terrain",this._container),z.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){z.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},m.TwoFingersTouchPitchHandler=Qh,m.TwoFingersTouchRotateHandler=Ga,m.TwoFingersTouchZoomHandler=_o,m.TwoFingersTouchZoomRotateHandler=jl,m.VectorTileSource=Fe,m.VideoSource=it,m.addSourceType=(y,i)=>l._(void 0,void 0,void 0,function*(){if(Zt(y))throw new Error(`A source type called "${y}" already exists.`);((o,h)=>{Xt[o]=h})(y,i)}),m.clearPrewarmedResources=function(){const y=Zi;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(tt),Zi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},m.getMaxParallelImageRequests=function(){return l.a.MAX_PARALLEL_IMAGE_REQUESTS},m.getRTLTextPluginStatus=function(){return Ue().getRTLTextPluginStatus()},m.getVersion=function(){return sd},m.getWorkerCount=function(){return Je.workerCount},m.getWorkerUrl=function(){return l.a.WORKER_URL},m.importScriptInWorkers=function(y){return ut().broadcast("IS",y)},m.prewarm=function(){Ve().acquire(tt)},m.setMaxParallelImageRequests=function(y){l.a.MAX_PARALLEL_IMAGE_REQUESTS=y},m.setRTLTextPlugin=function(y,i){return Ue().setRTLTextPlugin(y,i)},m.setWorkerCount=function(y){Je.workerCount=y},m.setWorkerUrl=function(y){l.a.WORKER_URL=y}});var g=a;return g})})(Jx);var ER=Jx.exports;const Wf=Jm(ER);var e1={exports:{}};(function(e,r){(function(a,u){e.exports=u()})(Zc,function(){var a=function(b,A){var V={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},ae={on:function(ye,Se,Ye){if(V[ye]===void 0)throw new Error("Invalid event type: "+ye);V[ye].push({selector:Se,fn:Ye})},render:function(ye){A.store.featureChanged(ye)}},ge=function(ye,Se){for(var Ye=V[ye],ot=Ye.length;ot--;){var wt=Ye[ot];if(wt.selector(Se)){wt.fn.call(ae,Se)||A.store.render(),A.ui.updateMapClasses();break}}};return b.start.call(ae),{render:b.render,stop:function(){b.stop&&b.stop()},trash:function(){b.trash&&(b.trash(),A.store.render())},combineFeatures:function(){b.combineFeatures&&b.combineFeatures()},uncombineFeatures:function(){b.uncombineFeatures&&b.uncombineFeatures()},drag:function(ye){ge("drag",ye)},click:function(ye){ge("click",ye)},mousemove:function(ye){ge("mousemove",ye)},mousedown:function(ye){ge("mousedown",ye)},mouseup:function(ye){ge("mouseup",ye)},mouseout:function(ye){ge("mouseout",ye)},keydown:function(ye){ge("keydown",ye)},keyup:function(ye){ge("keyup",ye)},touchstart:function(ye){ge("touchstart",ye)},touchmove:function(ye){ge("touchmove",ye)},touchend:function(ye){ge("touchend",ye)},tap:function(ye){ge("tap",ye)}}};function u(b){return b&&b.__esModule&&Object.prototype.hasOwnProperty.call(b,"default")?b.default:b}function d(b){if(b.__esModule)return b;var A=b.default;if(typeof A=="function"){var V=function ae(){if(this instanceof ae){var ge=[null];ge.push.apply(ge,arguments);var ye=Function.bind.apply(A,ge);return new ye}return A.apply(this,arguments)};V.prototype=A.prototype}else V={};return Object.defineProperty(V,"__esModule",{value:!0}),Object.keys(b).forEach(function(ae){var ge=Object.getOwnPropertyDescriptor(b,ae);Object.defineProperty(V,ae,ge.get?ge:{enumerable:!0,get:function(){return b[ae]}})}),V}var g={},m={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:63567523142e-4},l=m;function M(b){var A=0;if(b&&b.length>0){A+=Math.abs(P(b[0]));for(var V=1;V<b.length;V++)A-=Math.abs(P(b[V]))}return A}function P(b){var A,V,ae,ge,ye,Se,Ye=0,ot=b.length;if(ot>2){for(Se=0;Se<ot;Se++)Se===ot-2?(ae=ot-2,ge=ot-1,ye=0):Se===ot-1?(ae=ot-1,ge=0,ye=1):(ae=Se,ge=Se+1,ye=Se+2),A=b[ae],V=b[ge],Ye+=(R(b[ye][0])-R(A[0]))*Math.sin(R(V[1]));Ye=Ye*l.RADIUS*l.RADIUS/2}return Ye}function R(b){return b*Math.PI/180}g.geometry=function b(A){var V,ae=0;switch(A.type){case"Polygon":return M(A.coordinates);case"MultiPolygon":for(V=0;V<A.coordinates.length;V++)ae+=M(A.coordinates[V]);return ae;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(V=0;V<A.geometries.length;V++)ae+=b(A.geometries[V]);return ae}},g.ring=P;var D={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},z={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},Z={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},W={POLYGON:"polygon",LINE:"line_string",POINT:"point"},J={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},me={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},xe={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},Pe={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},oe={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},Le={ACTIVE:"true",INACTIVE:"false"},Ze=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],Ke=-85,dt=Object.freeze({__proto__:null,classes:D,sources:z,cursors:Z,types:W,geojsonTypes:J,modes:me,events:xe,updateActions:Pe,meta:oe,activeStates:Le,interactions:Ze,LAT_MIN:-90,LAT_RENDERED_MIN:Ke,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),bt={Point:0,LineString:1,MultiLineString:1,Polygon:2};function Pt(b,A){var V=bt[b.geometry.type]-bt[A.geometry.type];return V===0&&b.geometry.type===J.POLYGON?b.area-A.area:V}function Ht(b){return b.map(function(A){return A.geometry.type===J.POLYGON&&(A.area=g.geometry({type:J.FEATURE,property:{},geometry:A.geometry})),A}).sort(Pt).map(function(A){return delete A.area,A})}function Rt(b,A){return A===void 0&&(A=0),[[b.point.x-A,b.point.y-A],[b.point.x+A,b.point.y+A]]}function li(b){if(this._items={},this._nums={},this._length=b?b.length:0,b)for(var A=0,V=b.length;A<V;A++)this.add(b[A]),b[A]!==void 0&&(typeof b[A]=="string"?this._items[b[A]]=A:this._nums[b[A]]=A)}li.prototype.add=function(b){return this.has(b)||(this._length++,typeof b=="string"?this._items[b]=this._length:this._nums[b]=this._length),this},li.prototype.delete=function(b){return this.has(b)===!1||(this._length--,delete this._items[b],delete this._nums[b]),this},li.prototype.has=function(b){return(typeof b=="string"||typeof b=="number")&&(this._items[b]!==void 0||this._nums[b]!==void 0)},li.prototype.values=function(){var b=this,A=[];return Object.keys(this._items).forEach(function(V){A.push({k:V,v:b._items[V]})}),Object.keys(this._nums).forEach(function(V){A.push({k:JSON.parse(V),v:b._nums[V]})}),A.sort(function(V,ae){return V.v-ae.v}).map(function(V){return V.k})},li.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var ct=[oe.FEATURE,oe.MIDPOINT,oe.VERTEX],zt={click:function(b,A,V){return Bi(b,A,V,V.options.clickBuffer)},touch:function(b,A,V){return Bi(b,A,V,V.options.touchBuffer)}};function Bi(b,A,V,ae){if(V.map===null)return[];var ge=b?Rt(b,ae):A,ye={};V.options.styles&&(ye.layers=V.options.styles.map(function(wt){return wt.id}).filter(function(wt){return V.map.getLayer(wt)!=null}));var Se=V.map.queryRenderedFeatures(ge,ye).filter(function(wt){return ct.indexOf(wt.properties.meta)!==-1}),Ye=new li,ot=[];return Se.forEach(function(wt){var Mt=wt.properties.id;Ye.has(Mt)||(Ye.add(Mt),ot.push(wt))}),Ht(ot)}function ti(b,A){var V=zt.click(b,null,A),ae={mouse:Z.NONE};return V[0]&&(ae.mouse=V[0].properties.active===Le.ACTIVE?Z.MOVE:Z.POINTER,ae.feature=V[0].properties.meta),A.events.currentModeName().indexOf("draw")!==-1&&(ae.mouse=Z.ADD),A.ui.queueMapClasses(ae),A.ui.updateMapClasses(),V[0]}function ii(b,A){var V=b.x-A.x,ae=b.y-A.y;return Math.sqrt(V*V+ae*ae)}function hi(b,A,V){V===void 0&&(V={});var ae=V.fineTolerance!=null?V.fineTolerance:4,ge=V.grossTolerance!=null?V.grossTolerance:12,ye=V.interval!=null?V.interval:500;b.point=b.point||A.point,b.time=b.time||A.time;var Se=ii(b.point,A.point);return Se<ae||Se<ge&&A.time-b.time<ye}function Mi(b,A,V){V===void 0&&(V={});var ae=V.tolerance!=null?V.tolerance:25,ge=V.interval!=null?V.interval:250;return b.point=b.point||A.point,b.time=b.time||A.time,ii(b.point,A.point)<ae&&A.time-b.time<ge}var yr={exports:{}},at=yr.exports=function(b,A){if(A||(A=16),b===void 0&&(b=128),b<=0)return"0";for(var V=Math.log(Math.pow(2,b))/Math.log(A),ae=2;V===1/0;ae*=2)V=Math.log(Math.pow(2,b/ae))/Math.log(A)*ae;var ge=V-Math.floor(V),ye="";for(ae=0;ae<Math.floor(V);ae++)ye=Math.floor(Math.random()*A).toString(A)+ye;if(ge){var Se=Math.pow(A,ge);ye=Math.floor(Math.random()*Se).toString(A)+ye}var Ye=parseInt(ye,A);return Ye!==1/0&&Ye>=Math.pow(2,b)?at(b,A):ye};at.rack=function(b,A,V){var ae=function(ye){var Se=0;do{if(Se++>10){if(!V)throw new Error("too many ID collisions, use more bits");b+=V}var Ye=at(b,A)}while(Object.hasOwnProperty.call(ge,Ye));return ge[Ye]=ye,Ye},ge=ae.hats={};return ae.get=function(ye){return ae.hats[ye]},ae.set=function(ye,Se){return ae.hats[ye]=Se,ae},ae.bits=b||128,ae.base=A||16,ae};var tt=u(yr.exports),Je=function(b,A){this.ctx=b,this.properties=A.properties||{},this.coordinates=A.geometry.coordinates,this.id=A.id||tt(),this.type=A.geometry.type};Je.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},Je.prototype.incomingCoords=function(b){this.setCoordinates(b)},Je.prototype.setCoordinates=function(b){this.coordinates=b,this.changed()},Je.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},Je.prototype.setProperty=function(b,A){this.properties[b]=A},Je.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:J.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},Je.prototype.internal=function(b){var A={id:this.id,meta:oe.FEATURE,"meta:type":this.type,active:Le.INACTIVE,mode:b};if(this.ctx.options.userProperties)for(var V in this.properties)A["user_"+V]=this.properties[V];return{type:J.FEATURE,properties:A,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var nr=function(b,A){Je.call(this,b,A)};(nr.prototype=Object.create(Je.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},nr.prototype.updateCoordinate=function(b,A,V){this.coordinates=arguments.length===3?[A,V]:[b,A],this.changed()},nr.prototype.getCoordinate=function(){return this.getCoordinates()};var Zi=function(b,A){Je.call(this,b,A)};(Zi.prototype=Object.create(Je.prototype)).isValid=function(){return this.coordinates.length>1},Zi.prototype.addCoordinate=function(b,A,V){this.changed();var ae=parseInt(b,10);this.coordinates.splice(ae,0,[A,V])},Zi.prototype.getCoordinate=function(b){var A=parseInt(b,10);return JSON.parse(JSON.stringify(this.coordinates[A]))},Zi.prototype.removeCoordinate=function(b){this.changed(),this.coordinates.splice(parseInt(b,10),1)},Zi.prototype.updateCoordinate=function(b,A,V){var ae=parseInt(b,10);this.coordinates[ae]=[A,V],this.changed()};var Si=function(b,A){Je.call(this,b,A),this.coordinates=this.coordinates.map(function(V){return V.slice(0,-1)})};(Si.prototype=Object.create(Je.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(b){return b.length>2})},Si.prototype.incomingCoords=function(b){this.coordinates=b.map(function(A){return A.slice(0,-1)}),this.changed()},Si.prototype.setCoordinates=function(b){this.coordinates=b,this.changed()},Si.prototype.addCoordinate=function(b,A,V){this.changed();var ae=b.split(".").map(function(ge){return parseInt(ge,10)});this.coordinates[ae[0]].splice(ae[1],0,[A,V])},Si.prototype.removeCoordinate=function(b){this.changed();var A=b.split(".").map(function(ae){return parseInt(ae,10)}),V=this.coordinates[A[0]];V&&(V.splice(A[1],1),V.length<3&&this.coordinates.splice(A[0],1))},Si.prototype.getCoordinate=function(b){var A=b.split(".").map(function(ae){return parseInt(ae,10)}),V=this.coordinates[A[0]];return JSON.parse(JSON.stringify(V[A[1]]))},Si.prototype.getCoordinates=function(){return this.coordinates.map(function(b){return b.concat([b[0]])})},Si.prototype.updateCoordinate=function(b,A,V){this.changed();var ae=b.split("."),ge=parseInt(ae[0],10),ye=parseInt(ae[1],10);this.coordinates[ge]===void 0&&(this.coordinates[ge]=[]),this.coordinates[ge][ye]=[A,V]};var Ve={MultiPoint:nr,MultiLineString:Zi,MultiPolygon:Si},Et=function(b,A,V,ae,ge){var ye=V.split("."),Se=parseInt(ye[0],10),Ye=ye[1]?ye.slice(1).join("."):null;return b[Se][A](Ye,ae,ge)},ut=function(b,A){if(Je.call(this,b,A),delete this.coordinates,this.model=Ve[A.geometry.type],this.model===void 0)throw new TypeError(A.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(A.geometry.coordinates)};function Qe(b){this.map=b.map,this.drawConfig=JSON.parse(JSON.stringify(b.options||{})),this._ctx=b}(ut.prototype=Object.create(Je.prototype))._coordinatesToFeatures=function(b){var A=this,V=this.model.bind(this);return b.map(function(ae){return new V(A.ctx,{id:tt(),type:J.FEATURE,properties:{},geometry:{coordinates:ae,type:A.type.replace("Multi","")}})})},ut.prototype.isValid=function(){return this.features.every(function(b){return b.isValid()})},ut.prototype.setCoordinates=function(b){this.features=this._coordinatesToFeatures(b),this.changed()},ut.prototype.getCoordinate=function(b){return Et(this.features,"getCoordinate",b)},ut.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(b){return b.type===J.POLYGON?b.getCoordinates():b.coordinates})))},ut.prototype.updateCoordinate=function(b,A,V){Et(this.features,"updateCoordinate",b,A,V),this.changed()},ut.prototype.addCoordinate=function(b,A,V){Et(this.features,"addCoordinate",b,A,V),this.changed()},ut.prototype.removeCoordinate=function(b){Et(this.features,"removeCoordinate",b),this.changed()},ut.prototype.getFeatures=function(){return this.features},Qe.prototype.setSelected=function(b){return this._ctx.store.setSelected(b)},Qe.prototype.setSelectedCoordinates=function(b){var A=this;this._ctx.store.setSelectedCoordinates(b),b.reduce(function(V,ae){return V[ae.feature_id]===void 0&&(V[ae.feature_id]=!0,A._ctx.store.get(ae.feature_id).changed()),V},{})},Qe.prototype.getSelected=function(){return this._ctx.store.getSelected()},Qe.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},Qe.prototype.isSelected=function(b){return this._ctx.store.isSelected(b)},Qe.prototype.getFeature=function(b){return this._ctx.store.get(b)},Qe.prototype.select=function(b){return this._ctx.store.select(b)},Qe.prototype.deselect=function(b){return this._ctx.store.deselect(b)},Qe.prototype.deleteFeature=function(b,A){return A===void 0&&(A={}),this._ctx.store.delete(b,A)},Qe.prototype.addFeature=function(b){return this._ctx.store.add(b)},Qe.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},Qe.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},Qe.prototype.setActionableState=function(b){b===void 0&&(b={});var A={trash:b.trash||!1,combineFeatures:b.combineFeatures||!1,uncombineFeatures:b.uncombineFeatures||!1};return this._ctx.events.actionable(A)},Qe.prototype.changeMode=function(b,A,V){return A===void 0&&(A={}),V===void 0&&(V={}),this._ctx.events.changeMode(b,A,V)},Qe.prototype.updateUIClasses=function(b){return this._ctx.ui.queueMapClasses(b)},Qe.prototype.activateUIButton=function(b){return this._ctx.ui.setActiveButton(b)},Qe.prototype.featuresAt=function(b,A,V){if(V===void 0&&(V="click"),V!=="click"&&V!=="touch")throw new Error("invalid buffer type");return zt[V](b,A,this._ctx)},Qe.prototype.newFeature=function(b){var A=b.geometry.type;return A===J.POINT?new nr(this._ctx,b):A===J.LINE_STRING?new Zi(this._ctx,b):A===J.POLYGON?new Si(this._ctx,b):new ut(this._ctx,b)},Qe.prototype.isInstanceOf=function(b,A){if(b===J.POINT)return A instanceof nr;if(b===J.LINE_STRING)return A instanceof Zi;if(b===J.POLYGON)return A instanceof Si;if(b==="MultiFeature")return A instanceof ut;throw new Error("Unknown feature class: "+b)},Qe.prototype.doRender=function(b){return this._ctx.store.featureChanged(b)},Qe.prototype.onSetup=function(){},Qe.prototype.onDrag=function(){},Qe.prototype.onClick=function(){},Qe.prototype.onMouseMove=function(){},Qe.prototype.onMouseDown=function(){},Qe.prototype.onMouseUp=function(){},Qe.prototype.onMouseOut=function(){},Qe.prototype.onKeyUp=function(){},Qe.prototype.onKeyDown=function(){},Qe.prototype.onTouchStart=function(){},Qe.prototype.onTouchMove=function(){},Qe.prototype.onTouchEnd=function(){},Qe.prototype.onTap=function(){},Qe.prototype.onStop=function(){},Qe.prototype.onTrash=function(){},Qe.prototype.onCombineFeature=function(){},Qe.prototype.onUncombineFeature=function(){},Qe.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var Di={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},zi=Object.keys(Di);function se(b){var A=Object.keys(b);return function(V,ae){ae===void 0&&(ae={});var ge={},ye=A.reduce(function(Se,Ye){return Se[Ye]=b[Ye],Se},new Qe(V));return{start:function(){var Se=this;ge=ye.onSetup(ae),zi.forEach(function(Ye){var ot,wt=Di[Ye],Mt=function(){return!1};b[wt]&&(Mt=function(){return!0}),Se.on(Ye,Mt,(ot=wt,function(ft){return ye[ot](ge,ft)}))})},stop:function(){ye.onStop(ge)},trash:function(){ye.onTrash(ge)},combineFeatures:function(){ye.onCombineFeatures(ge)},uncombineFeatures:function(){ye.onUncombineFeatures(ge)},render:function(Se,Ye){ye.toDisplayFeatures(ge,Se,Ye)}}}}function ue(b){return[].concat(b).filter(function(A){return A!==void 0})}function De(){var b=this;if(!(b.ctx.map&&b.ctx.map.getSource(z.HOT)!==void 0))return ot();var A=b.ctx.events.currentModeName();b.ctx.ui.queueMapClasses({mode:A});var V=[],ae=[];b.isDirty?ae=b.getAllIds():(V=b.getChangedIds().filter(function(wt){return b.get(wt)!==void 0}),ae=b.sources.hot.filter(function(wt){return wt.properties.id&&V.indexOf(wt.properties.id)===-1&&b.get(wt.properties.id)!==void 0}).map(function(wt){return wt.properties.id})),b.sources.hot=[];var ge=b.sources.cold.length;b.sources.cold=b.isDirty?[]:b.sources.cold.filter(function(wt){var Mt=wt.properties.id||wt.properties.parent;return V.indexOf(Mt)===-1});var ye=ge!==b.sources.cold.length||ae.length>0;function Se(wt,Mt){var ft=b.get(wt).internal(A);b.ctx.events.currentModeRender(ft,function(oi){b.sources[Mt].push(oi)})}if(V.forEach(function(wt){return Se(wt,"hot")}),ae.forEach(function(wt){return Se(wt,"cold")}),ye&&b.ctx.map.getSource(z.COLD).setData({type:J.FEATURE_COLLECTION,features:b.sources.cold}),b.ctx.map.getSource(z.HOT).setData({type:J.FEATURE_COLLECTION,features:b.sources.hot}),b._emitSelectionChange&&(b.ctx.map.fire(xe.SELECTION_CHANGE,{features:b.getSelected().map(function(wt){return wt.toGeoJSON()}),points:b.getSelectedCoordinates().map(function(wt){return{type:J.FEATURE,properties:{},geometry:{type:J.POINT,coordinates:wt.coordinates}}})}),b._emitSelectionChange=!1),b._deletedFeaturesToEmit.length){var Ye=b._deletedFeaturesToEmit.map(function(wt){return wt.toGeoJSON()});b._deletedFeaturesToEmit=[],b.ctx.map.fire(xe.DELETE,{features:Ye})}function ot(){b.isDirty=!1,b.clearChangedIds()}ot(),b.ctx.map.fire(xe.RENDER,{})}function Fe(b){var A,V=this;this._features={},this._featureIds=new li,this._selectedFeatureIds=new li,this._selectedCoordinates=[],this._changedFeatureIds=new li,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=b,this.sources={hot:[],cold:[]},this.render=function(){A||(A=requestAnimationFrame(function(){A=null,De.call(V)}))},this.isDirty=!1}function ce(b,A){var V=b._selectedCoordinates.filter(function(ae){return b._selectedFeatureIds.has(ae.feature_id)});b._selectedCoordinates.length===V.length||A.silent||(b._emitSelectionChange=!0),b._selectedCoordinates=V}Fe.prototype.createRenderBatch=function(){var b=this,A=this.render,V=0;return this.render=function(){V++},function(){b.render=A,V>0&&b.render()}},Fe.prototype.setDirty=function(){return this.isDirty=!0,this},Fe.prototype.featureChanged=function(b){return this._changedFeatureIds.add(b),this},Fe.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},Fe.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},Fe.prototype.getAllIds=function(){return this._featureIds.values()},Fe.prototype.add=function(b){return this.featureChanged(b.id),this._features[b.id]=b,this._featureIds.add(b.id),this},Fe.prototype.delete=function(b,A){var V=this;return A===void 0&&(A={}),ue(b).forEach(function(ae){V._featureIds.has(ae)&&(V._featureIds.delete(ae),V._selectedFeatureIds.delete(ae),A.silent||V._deletedFeaturesToEmit.indexOf(V._features[ae])===-1&&V._deletedFeaturesToEmit.push(V._features[ae]),delete V._features[ae],V.isDirty=!0)}),ce(this,A),this},Fe.prototype.get=function(b){return this._features[b]},Fe.prototype.getAll=function(){var b=this;return Object.keys(this._features).map(function(A){return b._features[A]})},Fe.prototype.select=function(b,A){var V=this;return A===void 0&&(A={}),ue(b).forEach(function(ae){V._selectedFeatureIds.has(ae)||(V._selectedFeatureIds.add(ae),V._changedFeatureIds.add(ae),A.silent||(V._emitSelectionChange=!0))}),this},Fe.prototype.deselect=function(b,A){var V=this;return A===void 0&&(A={}),ue(b).forEach(function(ae){V._selectedFeatureIds.has(ae)&&(V._selectedFeatureIds.delete(ae),V._changedFeatureIds.add(ae),A.silent||(V._emitSelectionChange=!0))}),ce(this,A),this},Fe.prototype.clearSelected=function(b){return b===void 0&&(b={}),this.deselect(this._selectedFeatureIds.values(),{silent:b.silent}),this},Fe.prototype.setSelected=function(b,A){var V=this;return A===void 0&&(A={}),b=ue(b),this.deselect(this._selectedFeatureIds.values().filter(function(ae){return b.indexOf(ae)===-1}),{silent:A.silent}),this.select(b.filter(function(ae){return!V._selectedFeatureIds.has(ae)}),{silent:A.silent}),this},Fe.prototype.setSelectedCoordinates=function(b){return this._selectedCoordinates=b,this._emitSelectionChange=!0,this},Fe.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},Fe.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},Fe.prototype.getSelected=function(){var b=this;return this._selectedFeatureIds.values().map(function(A){return b.get(A)})},Fe.prototype.getSelectedCoordinates=function(){var b=this;return this._selectedCoordinates.map(function(A){return{coordinates:b.get(A.feature_id).getCoordinate(A.coord_path)}})},Fe.prototype.isSelected=function(b){return this._selectedFeatureIds.has(b)},Fe.prototype.setFeatureProperty=function(b,A,V){this.get(b).setProperty(A,V),this.featureChanged(b)},Fe.prototype.storeMapConfig=function(){var b=this;Ze.forEach(function(A){b.ctx.map[A]&&(b._mapInitialConfig[A]=b.ctx.map[A].isEnabled())})},Fe.prototype.restoreMapConfig=function(){var b=this;Object.keys(this._mapInitialConfig).forEach(function(A){b._mapInitialConfig[A]?b.ctx.map[A].enable():b.ctx.map[A].disable()})},Fe.prototype.getInitialConfigValue=function(b){return this._mapInitialConfig[b]===void 0||this._mapInitialConfig[b]};var pt=function(){for(var b=arguments,A={},V=0;V<arguments.length;V++){var ae=b[V];for(var ge in ae)At.call(ae,ge)&&(A[ge]=ae[ge])}return A},At=Object.prototype.hasOwnProperty,Be=u(pt),rt=["mode","feature","mouse"];function it(b){var A=null,V=null,ae={onRemove:function(){return b.map.off("load",ae.connect),clearInterval(V),ae.removeLayers(),b.store.restoreMapConfig(),b.ui.removeButtons(),b.events.removeEventListeners(),b.ui.clearMapClasses(),b.boxZoomInitial&&b.map.boxZoom.enable(),b.map=null,b.container=null,b.store=null,A&&A.parentNode&&A.parentNode.removeChild(A),A=null,this},connect:function(){b.map.off("load",ae.connect),clearInterval(V),ae.addLayers(),b.store.storeMapConfig(),b.events.addEventListeners()},onAdd:function(ge){var ye=ge.fire;return ge.fire=function(Se,Ye){var ot=arguments;return ye.length===1&&arguments.length!==1&&(ot=[Be({},{type:Se},Ye)]),ye.apply(ge,ot)},b.map=ge,b.events=function(Se){var Ye=Object.keys(Se.options.modes).reduce(function(je,Ft){return je[Ft]=se(Se.options.modes[Ft]),je},{}),ot={},wt={},Mt={},ft=null,oi=null;Mt.drag=function(je,Ft){Ft({point:je.point,time:new Date().getTime()})?(Se.ui.queueMapClasses({mouse:Z.DRAG}),oi.drag(je)):je.originalEvent.stopPropagation()},Mt.mousedrag=function(je){Mt.drag(je,function(Ft){return!hi(ot,Ft)})},Mt.touchdrag=function(je){Mt.drag(je,function(Ft){return!Mi(wt,Ft)})},Mt.mousemove=function(je){if((je.originalEvent.buttons!==void 0?je.originalEvent.buttons:je.originalEvent.which)===1)return Mt.mousedrag(je);var Ft=ti(je,Se);je.featureTarget=Ft,oi.mousemove(je)},Mt.mousedown=function(je){ot={time:new Date().getTime(),point:je.point};var Ft=ti(je,Se);je.featureTarget=Ft,oi.mousedown(je)},Mt.mouseup=function(je){var Ft=ti(je,Se);je.featureTarget=Ft,hi(ot,{point:je.point,time:new Date().getTime()})?oi.click(je):oi.mouseup(je)},Mt.mouseout=function(je){oi.mouseout(je)},Mt.touchstart=function(je){if(Se.options.touchEnabled){wt={time:new Date().getTime(),point:je.point};var Ft=zt.touch(je,null,Se)[0];je.featureTarget=Ft,oi.touchstart(je)}},Mt.touchmove=function(je){if(Se.options.touchEnabled)return oi.touchmove(je),Mt.touchdrag(je)},Mt.touchend=function(je){if(je.originalEvent.preventDefault(),Se.options.touchEnabled){var Ft=zt.touch(je,null,Se)[0];je.featureTarget=Ft,Mi(wt,{time:new Date().getTime(),point:je.point})?oi.tap(je):oi.touchend(je)}};var pr=function(je){return!(je===8||je===46||je>=48&&je<=57)};function ui(je,Ft,xi){xi===void 0&&(xi={}),oi.stop();var Tr=Ye[je];if(Tr===void 0)throw new Error(je+" is not valid");ft=je;var vr=Tr(Se,Ft);oi=a(vr,Se),xi.silent||Se.map.fire(xe.MODE_CHANGE,{mode:je}),Se.store.setDirty(),Se.store.render()}Mt.keydown=function(je){(je.srcElement||je.target).classList.contains("mapboxgl-canvas")&&(je.keyCode!==8&&je.keyCode!==46||!Se.options.controls.trash?pr(je.keyCode)?oi.keydown(je):je.keyCode===49&&Se.options.controls.point?ui(me.DRAW_POINT):je.keyCode===50&&Se.options.controls.line_string?ui(me.DRAW_LINE_STRING):je.keyCode===51&&Se.options.controls.polygon&&ui(me.DRAW_POLYGON):(je.preventDefault(),oi.trash()))},Mt.keyup=function(je){pr(je.keyCode)&&oi.keyup(je)},Mt.zoomend=function(){Se.store.changeZoom()},Mt.data=function(je){if(je.dataType==="style"){var Ft=Se.setup,xi=Se.map,Tr=Se.options,vr=Se.store;Tr.styles.some(function(_a){return xi.getLayer(_a.id)})||(Ft.addLayers(),vr.setDirty(),vr.render())}};var Rr={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){ft=Se.options.defaultMode,oi=a(Ye[ft](Se),Se)},changeMode:ui,actionable:function(je){var Ft=!1;Object.keys(je).forEach(function(xi){if(Rr[xi]===void 0)throw new Error("Invalid action type");Rr[xi]!==je[xi]&&(Ft=!0),Rr[xi]=je[xi]}),Ft&&Se.map.fire(xe.ACTIONABLE,{actions:Rr})},currentModeName:function(){return ft},currentModeRender:function(je,Ft){return oi.render(je,Ft)},fire:function(je,Ft){Mt[je]&&Mt[je](Ft)},addEventListeners:function(){Se.map.on("mousemove",Mt.mousemove),Se.map.on("mousedown",Mt.mousedown),Se.map.on("mouseup",Mt.mouseup),Se.map.on("data",Mt.data),Se.map.on("touchmove",Mt.touchmove),Se.map.on("touchstart",Mt.touchstart),Se.map.on("touchend",Mt.touchend),Se.container.addEventListener("mouseout",Mt.mouseout),Se.options.keybindings&&(Se.container.addEventListener("keydown",Mt.keydown),Se.container.addEventListener("keyup",Mt.keyup))},removeEventListeners:function(){Se.map.off("mousemove",Mt.mousemove),Se.map.off("mousedown",Mt.mousedown),Se.map.off("mouseup",Mt.mouseup),Se.map.off("data",Mt.data),Se.map.off("touchmove",Mt.touchmove),Se.map.off("touchstart",Mt.touchstart),Se.map.off("touchend",Mt.touchend),Se.container.removeEventListener("mouseout",Mt.mouseout),Se.options.keybindings&&(Se.container.removeEventListener("keydown",Mt.keydown),Se.container.removeEventListener("keyup",Mt.keyup))},trash:function(je){oi.trash(je)},combineFeatures:function(){oi.combineFeatures()},uncombineFeatures:function(){oi.uncombineFeatures()},getMode:function(){return ft}}}(b),b.ui=function(Se){var Ye={},ot=null,wt={mode:null,feature:null,mouse:null},Mt={mode:null,feature:null,mouse:null};function ft(je){Mt=Be(Mt,je)}function oi(){var je,Ft;if(Se.container){var xi=[],Tr=[];rt.forEach(function(vr){Mt[vr]!==wt[vr]&&(xi.push(vr+"-"+wt[vr]),Mt[vr]!==null&&Tr.push(vr+"-"+Mt[vr]))}),xi.length>0&&(je=Se.container.classList).remove.apply(je,xi),Tr.length>0&&(Ft=Se.container.classList).add.apply(Ft,Tr),wt=Be(wt,Mt)}}function pr(je,Ft){Ft===void 0&&(Ft={});var xi=document.createElement("button");return xi.className=D.CONTROL_BUTTON+" "+Ft.className,xi.setAttribute("title",Ft.title),Ft.container.appendChild(xi),xi.addEventListener("click",function(Tr){if(Tr.preventDefault(),Tr.stopPropagation(),Tr.target===ot)return ui(),void Ft.onDeactivate();Rr(je),Ft.onActivate()},!0),xi}function ui(){ot&&(ot.classList.remove(D.ACTIVE_BUTTON),ot=null)}function Rr(je){ui();var Ft=Ye[je];Ft&&Ft&&je!=="trash"&&(Ft.classList.add(D.ACTIVE_BUTTON),ot=Ft)}return{setActiveButton:Rr,queueMapClasses:ft,updateMapClasses:oi,clearMapClasses:function(){ft({mode:null,feature:null,mouse:null}),oi()},addButtons:function(){var je=Se.options.controls,Ft=document.createElement("div");return Ft.className=D.CONTROL_GROUP+" "+D.CONTROL_BASE,je&&(je[W.LINE]&&(Ye[W.LINE]=pr(W.LINE,{container:Ft,className:D.CONTROL_BUTTON_LINE,title:"LineString tool "+(Se.options.keybindings?"(l)":""),onActivate:function(){return Se.events.changeMode(me.DRAW_LINE_STRING)},onDeactivate:function(){return Se.events.trash()}})),je[W.POLYGON]&&(Ye[W.POLYGON]=pr(W.POLYGON,{container:Ft,className:D.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(Se.options.keybindings?"(p)":""),onActivate:function(){return Se.events.changeMode(me.DRAW_POLYGON)},onDeactivate:function(){return Se.events.trash()}})),je[W.POINT]&&(Ye[W.POINT]=pr(W.POINT,{container:Ft,className:D.CONTROL_BUTTON_POINT,title:"Marker tool "+(Se.options.keybindings?"(m)":""),onActivate:function(){return Se.events.changeMode(me.DRAW_POINT)},onDeactivate:function(){return Se.events.trash()}})),je.trash&&(Ye.trash=pr("trash",{container:Ft,className:D.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){Se.events.trash()}})),je.combine_features&&(Ye.combine_features=pr("combineFeatures",{container:Ft,className:D.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){Se.events.combineFeatures()}})),je.uncombine_features&&(Ye.uncombine_features=pr("uncombineFeatures",{container:Ft,className:D.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){Se.events.uncombineFeatures()}}))),Ft},removeButtons:function(){Object.keys(Ye).forEach(function(je){var Ft=Ye[je];Ft.parentNode&&Ft.parentNode.removeChild(Ft),delete Ye[je]})}}}(b),b.container=ge.getContainer(),b.store=new Fe(b),A=b.ui.addButtons(),b.options.boxSelect&&(b.boxZoomInitial=ge.boxZoom.isEnabled(),ge.boxZoom.disable(),ge.dragPan.disable(),ge.dragPan.enable()),ge.loaded()?ae.connect():(ge.on("load",ae.connect),V=setInterval(function(){ge.loaded()&&ae.connect()},16)),b.events.start(),A},addLayers:function(){b.map.addSource(z.COLD,{data:{type:J.FEATURE_COLLECTION,features:[]},type:"geojson"}),b.map.addSource(z.HOT,{data:{type:J.FEATURE_COLLECTION,features:[]},type:"geojson"}),b.options.styles.forEach(function(ge){b.map.addLayer(ge)}),b.store.setDirty(!0),b.store.render()},removeLayers:function(){b.options.styles.forEach(function(ge){b.map.getLayer(ge.id)&&b.map.removeLayer(ge.id)}),b.map.getSource(z.COLD)&&b.map.removeSource(z.COLD),b.map.getSource(z.HOT)&&b.map.removeSource(z.HOT)}};return b.setup=ae,ae}var Dt=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function Xt(b){return function(A){var V=A.featureTarget;return!!V&&!!V.properties&&V.properties.meta===b}}function Zt(b){return!!b.originalEvent&&!!b.originalEvent.shiftKey&&b.originalEvent.button===0}function Yt(b){return!!b.featureTarget&&!!b.featureTarget.properties&&b.featureTarget.properties.active===Le.ACTIVE&&b.featureTarget.properties.meta===oe.FEATURE}function yi(b){return!!b.featureTarget&&!!b.featureTarget.properties&&b.featureTarget.properties.active===Le.INACTIVE&&b.featureTarget.properties.meta===oe.FEATURE}function Ti(b){return b.featureTarget===void 0}function Ue(b){return!!b.featureTarget&&!!b.featureTarget.properties&&b.featureTarget.properties.meta===oe.FEATURE}function Ni(b){var A=b.featureTarget;return!!A&&!!A.properties&&A.properties.meta===oe.VERTEX}function Yi(b){return!!b.originalEvent&&b.originalEvent.shiftKey===!0}function gn(b){return b.keyCode===27}function Sr(b){return b.keyCode===13}var nt=Object.freeze({__proto__:null,isOfMetaType:Xt,isShiftMousedown:Zt,isActiveFeature:Yt,isInactiveFeature:yi,noTarget:Ti,isFeature:Ue,isVertex:Ni,isShiftDown:Yi,isEscapeKey:gn,isEnterKey:Sr,isTrue:function(){return!0}}),ci=Nt;function Nt(b,A){this.x=b,this.y=A}Nt.prototype={clone:function(){return new Nt(this.x,this.y)},add:function(b){return this.clone()._add(b)},sub:function(b){return this.clone()._sub(b)},multByPoint:function(b){return this.clone()._multByPoint(b)},divByPoint:function(b){return this.clone()._divByPoint(b)},mult:function(b){return this.clone()._mult(b)},div:function(b){return this.clone()._div(b)},rotate:function(b){return this.clone()._rotate(b)},rotateAround:function(b,A){return this.clone()._rotateAround(b,A)},matMult:function(b){return this.clone()._matMult(b)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(b){return this.x===b.x&&this.y===b.y},dist:function(b){return Math.sqrt(this.distSqr(b))},distSqr:function(b){var A=b.x-this.x,V=b.y-this.y;return A*A+V*V},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(b){return Math.atan2(this.y-b.y,this.x-b.x)},angleWith:function(b){return this.angleWithSep(b.x,b.y)},angleWithSep:function(b,A){return Math.atan2(this.x*A-this.y*b,this.x*b+this.y*A)},_matMult:function(b){var A=b[0]*this.x+b[1]*this.y,V=b[2]*this.x+b[3]*this.y;return this.x=A,this.y=V,this},_add:function(b){return this.x+=b.x,this.y+=b.y,this},_sub:function(b){return this.x-=b.x,this.y-=b.y,this},_mult:function(b){return this.x*=b,this.y*=b,this},_div:function(b){return this.x/=b,this.y/=b,this},_multByPoint:function(b){return this.x*=b.x,this.y*=b.y,this},_divByPoint:function(b){return this.x/=b.x,this.y/=b.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var b=this.y;return this.y=this.x,this.x=-b,this},_rotate:function(b){var A=Math.cos(b),V=Math.sin(b),ae=A*this.x-V*this.y,ge=V*this.x+A*this.y;return this.x=ae,this.y=ge,this},_rotateAround:function(b,A){var V=Math.cos(b),ae=Math.sin(b),ge=A.x+V*(this.x-A.x)-ae*(this.y-A.y),ye=A.y+ae*(this.x-A.x)+V*(this.y-A.y);return this.x=ge,this.y=ye,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Nt.convert=function(b){return b instanceof Nt?b:Array.isArray(b)?new Nt(b[0],b[1]):b};var ji=u(ci);function yn(b,A){var V=A.getBoundingClientRect();return new ji(b.clientX-V.left-(A.clientLeft||0),b.clientY-V.top-(A.clientTop||0))}function ri(b,A,V,ae){return{type:J.FEATURE,properties:{meta:oe.VERTEX,parent:b,coord_path:V,active:ae?Le.ACTIVE:Le.INACTIVE},geometry:{type:J.POINT,coordinates:A}}}function ea(b,A,V){var ae=A.geometry.coordinates,ge=V.geometry.coordinates;if(ae[1]>85||ae[1]<Ke||ge[1]>85||ge[1]<Ke)return null;var ye={lng:(ae[0]+ge[0])/2,lat:(ae[1]+ge[1])/2};return{type:J.FEATURE,properties:{meta:oe.MIDPOINT,parent:b,lng:ye.lng,lat:ye.lat,coord_path:V.properties.coord_path},geometry:{type:J.POINT,coordinates:[ye.lng,ye.lat]}}}function Er(b,A,V){A===void 0&&(A={}),V===void 0&&(V=null);var ae,ge=b.geometry,ye=ge.type,Se=ge.coordinates,Ye=b.properties&&b.properties.id,ot=[];function wt(ft,oi){var pr="",ui=null;ft.forEach(function(Rr,je){var Ft=oi!=null?oi+"."+je:String(je),xi=ri(Ye,Rr,Ft,Mt(Ft));if(A.midpoints&&ui){var Tr=ea(Ye,ui,xi);Tr&&ot.push(Tr)}ui=xi;var vr=JSON.stringify(Rr);pr!==vr&&ot.push(xi),je===0&&(pr=vr)})}function Mt(ft){return!!A.selectedPaths&&A.selectedPaths.indexOf(ft)!==-1}return ye===J.POINT?ot.push(ri(Ye,Se,V,Mt(V))):ye===J.POLYGON?Se.forEach(function(ft,oi){wt(ft,V!==null?V+"."+oi:String(oi))}):ye===J.LINE_STRING?wt(Se,V):ye.indexOf(J.MULTI_PREFIX)===0&&(ae=ye.replace(J.MULTI_PREFIX,""),Se.forEach(function(ft,oi){var pr={type:J.FEATURE,properties:b.properties,geometry:{type:ae,coordinates:ft}};ot=ot.concat(Er(pr,A,oi))})),ot}var te={enable:function(b){setTimeout(function(){b.map&&b.map.doubleClickZoom&&b._ctx&&b._ctx.store&&b._ctx.store.getInitialConfigValue&&b._ctx.store.getInitialConfigValue("doubleClickZoom")&&b.map.doubleClickZoom.enable()},0)},disable:function(b){setTimeout(function(){b.map&&b.map.doubleClickZoom&&b.map.doubleClickZoom.disable()},0)}},N={exports:{}},U=function(b){if(!b||!b.type)return null;var A=H[b.type];if(!A)return null;if(A==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:b}]};if(A==="feature")return{type:"FeatureCollection",features:[b]};if(A==="featurecollection")return b},H={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},Q=u(U),_e=Object.freeze({__proto__:null,default:function b(A){switch(A&&A.type||null){case"FeatureCollection":return A.features=A.features.reduce(function(V,ae){return V.concat(b(ae))},[]),A;case"Feature":return A.geometry?b(A.geometry).map(function(V){var ae={type:"Feature",properties:JSON.parse(JSON.stringify(A.properties)),geometry:V};return A.id!==void 0&&(ae.id=A.id),ae}):[A];case"MultiPoint":return A.coordinates.map(function(V){return{type:"Point",coordinates:V}});case"MultiPolygon":return A.coordinates.map(function(V){return{type:"Polygon",coordinates:V}});case"MultiLineString":return A.coordinates.map(function(V){return{type:"LineString",coordinates:V}});case"GeometryCollection":return A.geometries.map(b).reduce(function(V,ae){return V.concat(ae)},[]);case"Point":case"Polygon":case"LineString":return[A]}}}),ve=U,Me=d(_e),de=function(b){return function A(V){return Array.isArray(V)&&V.length&&typeof V[0]=="number"?[V]:V.reduce(function(ae,ge){return Array.isArray(ge)&&Array.isArray(ge[0])?ae.concat(A(ge)):(ae.push(ge),ae)},[])}(b)};Me instanceof Function||(Me=Me.default);var Ce={exports:{}},qe=Ce.exports=function(b){return new ze(b)};function ze(b){this.value=b}function Ne(b,A,V){var ae=[],ge=[],ye=!0;return function Se(Ye){var ot=V?$t(Ye):Ye,wt={},Mt=!0,ft={node:ot,node_:Ye,path:[].concat(ae),parent:ge[ge.length-1],parents:ge,key:ae.slice(-1)[0],isRoot:ae.length===0,level:ae.length,circular:null,update:function(ui,Rr){ft.isRoot||(ft.parent.node[ft.key]=ui),ft.node=ui,Rr&&(Mt=!1)},delete:function(ui){delete ft.parent.node[ft.key],ui&&(Mt=!1)},remove:function(ui){si(ft.parent.node)?ft.parent.node.splice(ft.key,1):delete ft.parent.node[ft.key],ui&&(Mt=!1)},keys:null,before:function(ui){wt.before=ui},after:function(ui){wt.after=ui},pre:function(ui){wt.pre=ui},post:function(ui){wt.post=ui},stop:function(){ye=!1},block:function(){Mt=!1}};if(!ye)return ft;function oi(){if(typeof ft.node=="object"&&ft.node!==null){ft.keys&&ft.node_===ft.node||(ft.keys=Gt(ft.node)),ft.isLeaf=ft.keys.length==0;for(var ui=0;ui<ge.length;ui++)if(ge[ui].node_===Ye){ft.circular=ge[ui];break}}else ft.isLeaf=!0,ft.keys=null;ft.notLeaf=!ft.isLeaf,ft.notRoot=!ft.isRoot}oi();var pr=A.call(ft,ft.node);return pr!==void 0&&ft.update&&ft.update(pr),wt.before&&wt.before.call(ft,ft.node),Mt&&(typeof ft.node!="object"||ft.node===null||ft.circular||(ge.push(ft),oi(),vi(ft.keys,function(ui,Rr){ae.push(ui),wt.pre&&wt.pre.call(ft,ft.node[ui],ui);var je=Se(ft.node[ui]);V&&Ui.call(ft.node,ui)&&(ft.node[ui]=je.node),je.isLast=Rr==ft.keys.length-1,je.isFirst=Rr==0,wt.post&&wt.post.call(ft,je),ae.pop()}),ge.pop()),wt.after&&wt.after.call(ft,ft.node)),ft}(b).node}function $t(b){if(typeof b=="object"&&b!==null){var A;if(si(b))A=[];else if(ni(b)==="[object Date]")A=new Date(b.getTime?b.getTime():b);else if(function(ge){return ni(ge)==="[object RegExp]"}(b))A=new RegExp(b);else if(function(ge){return ni(ge)==="[object Error]"}(b))A={message:b.message};else if(function(ge){return ni(ge)==="[object Boolean]"}(b))A=new Boolean(b);else if(function(ge){return ni(ge)==="[object Number]"}(b))A=new Number(b);else if(function(ge){return ni(ge)==="[object String]"}(b))A=new String(b);else if(Object.create&&Object.getPrototypeOf)A=Object.create(Object.getPrototypeOf(b));else if(b.constructor===Object)A={};else{var V=b.constructor&&b.constructor.prototype||b.__proto__||{},ae=function(){};ae.prototype=V,A=new ae}return vi(Gt(b),function(ge){A[ge]=b[ge]}),A}return b}ze.prototype.get=function(b){for(var A=this.value,V=0;V<b.length;V++){var ae=b[V];if(!A||!Ui.call(A,ae)){A=void 0;break}A=A[ae]}return A},ze.prototype.has=function(b){for(var A=this.value,V=0;V<b.length;V++){var ae=b[V];if(!A||!Ui.call(A,ae))return!1;A=A[ae]}return!0},ze.prototype.set=function(b,A){for(var V=this.value,ae=0;ae<b.length-1;ae++){var ge=b[ae];Ui.call(V,ge)||(V[ge]={}),V=V[ge]}return V[b[ae]]=A,A},ze.prototype.map=function(b){return Ne(this.value,b,!0)},ze.prototype.forEach=function(b){return this.value=Ne(this.value,b,!1),this.value},ze.prototype.reduce=function(b,A){var V=arguments.length===1,ae=V?this.value:A;return this.forEach(function(ge){this.isRoot&&V||(ae=b.call(this,ae,ge))}),ae},ze.prototype.paths=function(){var b=[];return this.forEach(function(A){b.push(this.path)}),b},ze.prototype.nodes=function(){var b=[];return this.forEach(function(A){b.push(this.node)}),b},ze.prototype.clone=function(){var b=[],A=[];return function V(ae){for(var ge=0;ge<b.length;ge++)if(b[ge]===ae)return A[ge];if(typeof ae=="object"&&ae!==null){var ye=$t(ae);return b.push(ae),A.push(ye),vi(Gt(ae),function(Se){ye[Se]=V(ae[Se])}),b.pop(),A.pop(),ye}return ae}(this.value)};var Gt=Object.keys||function(b){var A=[];for(var V in b)A.push(V);return A};function ni(b){return Object.prototype.toString.call(b)}var si=Array.isArray||function(b){return Object.prototype.toString.call(b)==="[object Array]"},vi=function(b,A){if(b.forEach)return b.forEach(A);for(var V=0;V<b.length;V++)A(b[V],V,b)};vi(Gt(ze.prototype),function(b){qe[b]=function(A){var V=[].slice.call(arguments,1),ae=new ze(A);return ae[b].apply(ae,V)}});var Ui=Object.hasOwnProperty||function(b,A){return A in b},lr=Ce.exports,Br=Kt;function Kt(b){if(!(this instanceof Kt))return new Kt(b);this._bbox=b||[1/0,1/0,-1/0,-1/0],this._valid=!!b}Kt.prototype.include=function(b){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],b[0]),this._bbox[1]=Math.min(this._bbox[1],b[1]),this._bbox[2]=Math.max(this._bbox[2],b[0]),this._bbox[3]=Math.max(this._bbox[3],b[1]),this},Kt.prototype.equals=function(b){var A;return A=b instanceof Kt?b.bbox():b,this._bbox[0]==A[0]&&this._bbox[1]==A[1]&&this._bbox[2]==A[2]&&this._bbox[3]==A[3]},Kt.prototype.center=function(b){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},Kt.prototype.union=function(b){var A;return this._valid=!0,A=b instanceof Kt?b.bbox():b,this._bbox[0]=Math.min(this._bbox[0],A[0]),this._bbox[1]=Math.min(this._bbox[1],A[1]),this._bbox[2]=Math.max(this._bbox[2],A[2]),this._bbox[3]=Math.max(this._bbox[3],A[3]),this},Kt.prototype.bbox=function(){return this._valid?this._bbox:null},Kt.prototype.contains=function(b){if(!b)return this._fastContains();if(!this._valid)return null;var A=b[0],V=b[1];return this._bbox[0]<=A&&this._bbox[1]<=V&&this._bbox[2]>=A&&this._bbox[3]>=V},Kt.prototype.intersect=function(b){return this._valid?(A=b instanceof Kt?b.bbox():b,!(this._bbox[0]>A[2]||this._bbox[2]<A[0]||this._bbox[3]<A[1]||this._bbox[1]>A[3])):null;var A},Kt.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var b="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",b)},Kt.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var _r=function(b){if(!b)return[];var A=Me(ve(b)),V=[];return A.features.forEach(function(ae){ae.geometry&&(V=V.concat(de(ae.geometry.coordinates)))}),V},Vr=lr,_n=Br,vn={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},Zr=Object.keys(vn);function qn(b){for(var A=_n(),V=_r(b),ae=0;ae<V.length;ae++)A.include(V[ae]);return A}N.exports=function(b){return qn(b).bbox()},N.exports.polygon=function(b){return qn(b).polygon()},N.exports.bboxify=function(b){return Vr(b).map(function(A){A&&Zr.some(function(V){return!!A[V]&&vn[V].indexOf(A.type)!==-1})&&(A.bbox=qn(A).bbox(),this.update(A))})};var fc=u(N.exports),zo=-90;function Vi(b,A){var V=zo,ae=90,ge=zo,ye=90,Se=270,Ye=-270;b.forEach(function(wt){var Mt=fc(wt),ft=Mt[1],oi=Mt[3],pr=Mt[0],ui=Mt[2];ft>V&&(V=ft),oi<ae&&(ae=oi),oi>ge&&(ge=oi),ft<ye&&(ye=ft),pr<Se&&(Se=pr),ui>Ye&&(Ye=ui)});var ot=A;return V+ot.lat>85&&(ot.lat=85-V),ge+ot.lat>90&&(ot.lat=90-ge),ae+ot.lat<-85&&(ot.lat=-85-ae),ye+ot.lat<zo&&(ot.lat=zo-ye),Se+ot.lng<=-270&&(ot.lng+=360*Math.ceil(Math.abs(ot.lng)/360)),Ye+ot.lng>=270&&(ot.lng-=360*Math.ceil(Math.abs(ot.lng)/360)),ot}function lo(b,A){var V=Vi(b.map(function(ae){return ae.toGeoJSON()}),A);b.forEach(function(ae){var ge,ye=ae.getCoordinates(),Se=function(ot){var wt={lng:ot[0]+V.lng,lat:ot[1]+V.lat};return[wt.lng,wt.lat]},Ye=function(ot){return ot.map(function(wt){return Se(wt)})};ae.type===J.POINT?ge=Se(ye):ae.type===J.LINE_STRING||ae.type===J.MULTI_POINT?ge=ye.map(Se):ae.type===J.POLYGON||ae.type===J.MULTI_LINE_STRING?ge=ye.map(Ye):ae.type===J.MULTI_POLYGON&&(ge=ye.map(function(ot){return ot.map(function(wt){return Ye(wt)})})),ae.incomingCoords(ge)})}var Dr={onSetup:function(b){var A=this,V={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:b.featureIds||[]};return this.setSelected(V.initiallySelectedFeatureIds.filter(function(ae){return A.getFeature(ae)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),V},fireUpdate:function(){this.map.fire(xe.UPDATE,{action:Pe.MOVE,features:this.getSelected().map(function(b){return b.toGeoJSON()})})},fireActionable:function(){var b=this,A=this.getSelected(),V=A.filter(function(Ye){return b.isInstanceOf("MultiFeature",Ye)}),ae=!1;if(A.length>1){ae=!0;var ge=A[0].type.replace("Multi","");A.forEach(function(Ye){Ye.type.replace("Multi","")!==ge&&(ae=!1)})}var ye=V.length>0,Se=A.length>0;this.setActionableState({combineFeatures:ae,uncombineFeatures:ye,trash:Se})},getUniqueIds:function(b){return b.length?b.map(function(A){return A.properties.id}).filter(function(A){return A!==void 0}).reduce(function(A,V){return A.add(V),A},new li).values():[]},stopExtendedInteractions:function(b){b.boxSelectElement&&(b.boxSelectElement.parentNode&&b.boxSelectElement.parentNode.removeChild(b.boxSelectElement),b.boxSelectElement=null),this.map.dragPan.enable(),b.boxSelecting=!1,b.canBoxSelect=!1,b.dragMoving=!1,b.canDragMove=!1},onStop:function(){te.enable(this)},onMouseMove:function(b,A){return Ue(A)&&b.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(b),!0},onMouseOut:function(b){return!b.dragMoving||this.fireUpdate()}};Dr.onTap=Dr.onClick=function(b,A){return Ti(A)?this.clickAnywhere(b,A):Xt(oe.VERTEX)(A)?this.clickOnVertex(b,A):Ue(A)?this.clickOnFeature(b,A):void 0},Dr.clickAnywhere=function(b){var A=this,V=this.getSelectedIds();V.length&&(this.clearSelectedFeatures(),V.forEach(function(ae){return A.doRender(ae)})),te.enable(this),this.stopExtendedInteractions(b)},Dr.clickOnVertex=function(b,A){this.changeMode(me.DIRECT_SELECT,{featureId:A.featureTarget.properties.parent,coordPath:A.featureTarget.properties.coord_path,startPos:A.lngLat}),this.updateUIClasses({mouse:Z.MOVE})},Dr.startOnActiveFeature=function(b,A){this.stopExtendedInteractions(b),this.map.dragPan.disable(),this.doRender(A.featureTarget.properties.id),b.canDragMove=!0,b.dragMoveLocation=A.lngLat},Dr.clickOnFeature=function(b,A){var V=this;te.disable(this),this.stopExtendedInteractions(b);var ae=Yi(A),ge=this.getSelectedIds(),ye=A.featureTarget.properties.id,Se=this.isSelected(ye);if(!ae&&Se&&this.getFeature(ye).type!==J.POINT)return this.changeMode(me.DIRECT_SELECT,{featureId:ye});Se&&ae?(this.deselect(ye),this.updateUIClasses({mouse:Z.POINTER}),ge.length===1&&te.enable(this)):!Se&&ae?(this.select(ye),this.updateUIClasses({mouse:Z.MOVE})):Se||ae||(ge.forEach(function(Ye){return V.doRender(Ye)}),this.setSelected(ye),this.updateUIClasses({mouse:Z.MOVE})),this.doRender(ye)},Dr.onMouseDown=function(b,A){return Yt(A)?this.startOnActiveFeature(b,A):this.drawConfig.boxSelect&&Zt(A)?this.startBoxSelect(b,A):void 0},Dr.startBoxSelect=function(b,A){this.stopExtendedInteractions(b),this.map.dragPan.disable(),b.boxSelectStartLocation=yn(A.originalEvent,this.map.getContainer()),b.canBoxSelect=!0},Dr.onTouchStart=function(b,A){if(Yt(A))return this.startOnActiveFeature(b,A)},Dr.onDrag=function(b,A){return b.canDragMove?this.dragMove(b,A):this.drawConfig.boxSelect&&b.canBoxSelect?this.whileBoxSelect(b,A):void 0},Dr.whileBoxSelect=function(b,A){b.boxSelecting=!0,this.updateUIClasses({mouse:Z.ADD}),b.boxSelectElement||(b.boxSelectElement=document.createElement("div"),b.boxSelectElement.classList.add(D.BOX_SELECT),this.map.getContainer().appendChild(b.boxSelectElement));var V=yn(A.originalEvent,this.map.getContainer()),ae=Math.min(b.boxSelectStartLocation.x,V.x),ge=Math.max(b.boxSelectStartLocation.x,V.x),ye=Math.min(b.boxSelectStartLocation.y,V.y),Se=Math.max(b.boxSelectStartLocation.y,V.y),Ye="translate("+ae+"px, "+ye+"px)";b.boxSelectElement.style.transform=Ye,b.boxSelectElement.style.WebkitTransform=Ye,b.boxSelectElement.style.width=ge-ae+"px",b.boxSelectElement.style.height=Se-ye+"px"},Dr.dragMove=function(b,A){b.dragMoving=!0,A.originalEvent.stopPropagation();var V={lng:A.lngLat.lng-b.dragMoveLocation.lng,lat:A.lngLat.lat-b.dragMoveLocation.lat};lo(this.getSelected(),V),b.dragMoveLocation=A.lngLat},Dr.onTouchEnd=Dr.onMouseUp=function(b,A){var V=this;if(b.dragMoving)this.fireUpdate();else if(b.boxSelecting){var ae=[b.boxSelectStartLocation,yn(A.originalEvent,this.map.getContainer())],ge=this.featuresAt(null,ae,"click"),ye=this.getUniqueIds(ge).filter(function(Se){return!V.isSelected(Se)});ye.length&&(this.select(ye),ye.forEach(function(Se){return V.doRender(Se)}),this.updateUIClasses({mouse:Z.MOVE}))}this.stopExtendedInteractions(b)},Dr.toDisplayFeatures=function(b,A,V){A.properties.active=this.isSelected(A.properties.id)?Le.ACTIVE:Le.INACTIVE,V(A),this.fireActionable(),A.properties.active===Le.ACTIVE&&A.geometry.type!==J.POINT&&Er(A).forEach(V)},Dr.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},Dr.onCombineFeatures=function(){var b=this.getSelected();if(!(b.length===0||b.length<2)){for(var A=[],V=[],ae=b[0].type.replace("Multi",""),ge=0;ge<b.length;ge++){var ye=b[ge];if(ye.type.replace("Multi","")!==ae)return;ye.type.includes("Multi")?ye.getCoordinates().forEach(function(Ye){A.push(Ye)}):A.push(ye.getCoordinates()),V.push(ye.toGeoJSON())}if(V.length>1){var Se=this.newFeature({type:J.FEATURE,properties:V[0].properties,geometry:{type:"Multi"+ae,coordinates:A}});this.addFeature(Se),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([Se.id]),this.map.fire(xe.COMBINE_FEATURES,{createdFeatures:[Se.toGeoJSON()],deletedFeatures:V})}this.fireActionable()}},Dr.onUncombineFeatures=function(){var b=this,A=this.getSelected();if(A.length!==0){for(var V=[],ae=[],ge=function(Se){var Ye=A[Se];b.isInstanceOf("MultiFeature",Ye)&&(Ye.getFeatures().forEach(function(ot){b.addFeature(ot),ot.properties=Ye.properties,V.push(ot.toGeoJSON()),b.select([ot.id])}),b.deleteFeature(Ye.id,{silent:!0}),ae.push(Ye.toGeoJSON()))},ye=0;ye<A.length;ye++)ge(ye);V.length>1&&this.map.fire(xe.UNCOMBINE_FEATURES,{createdFeatures:V,deletedFeatures:ae}),this.fireActionable()}};var Dn=Xt(oe.VERTEX),xn=Xt(oe.MIDPOINT),Gn={fireUpdate:function(){this.map.fire(xe.UPDATE,{action:Pe.CHANGE_COORDINATES,features:this.getSelected().map(function(b){return b.toGeoJSON()})})},fireActionable:function(b){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:b.selectedCoordPaths.length>0})},startDragging:function(b,A){this.map.dragPan.disable(),b.canDragMove=!0,b.dragMoveLocation=A.lngLat},stopDragging:function(b){this.map.dragPan.enable(),b.dragMoving=!1,b.canDragMove=!1,b.dragMoveLocation=null},onVertex:function(b,A){this.startDragging(b,A);var V=A.featureTarget.properties,ae=b.selectedCoordPaths.indexOf(V.coord_path);Yi(A)||ae!==-1?Yi(A)&&ae===-1&&b.selectedCoordPaths.push(V.coord_path):b.selectedCoordPaths=[V.coord_path];var ge=this.pathsToCoordinates(b.featureId,b.selectedCoordPaths);this.setSelectedCoordinates(ge)},onMidpoint:function(b,A){this.startDragging(b,A);var V=A.featureTarget.properties;b.feature.addCoordinate(V.coord_path,V.lng,V.lat),this.fireUpdate(),b.selectedCoordPaths=[V.coord_path]},pathsToCoordinates:function(b,A){return A.map(function(V){return{feature_id:b,coord_path:V}})},onFeature:function(b,A){b.selectedCoordPaths.length===0?this.startDragging(b,A):this.stopDragging(b)},dragFeature:function(b,A,V){lo(this.getSelected(),V),b.dragMoveLocation=A.lngLat},dragVertex:function(b,A,V){for(var ae=b.selectedCoordPaths.map(function(Ye){return b.feature.getCoordinate(Ye)}),ge=Vi(ae.map(function(Ye){return{type:J.FEATURE,properties:{},geometry:{type:J.POINT,coordinates:Ye}}}),V),ye=0;ye<ae.length;ye++){var Se=ae[ye];b.feature.updateCoordinate(b.selectedCoordPaths[ye],Se[0]+ge.lng,Se[1]+ge.lat)}},clickNoTarget:function(){this.changeMode(me.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(me.SIMPLE_SELECT)},clickActiveFeature:function(b){b.selectedCoordPaths=[],this.clearSelectedCoordinates(),b.feature.changed()},onSetup:function(b){var A=b.featureId,V=this.getFeature(A);if(!V)throw new Error("You must provide a featureId to enter direct_select mode");if(V.type===J.POINT)throw new TypeError("direct_select mode doesn't handle point features");var ae={featureId:A,feature:V,dragMoveLocation:b.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:b.coordPath?[b.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(A,ae.selectedCoordPaths)),this.setSelected(A),te.disable(this),this.setActionableState({trash:!0}),ae},onStop:function(){te.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(b,A,V){b.featureId===A.properties.id?(A.properties.active=Le.ACTIVE,V(A),Er(A,{map:this.map,midpoints:!0,selectedPaths:b.selectedCoordPaths}).forEach(V)):(A.properties.active=Le.INACTIVE,V(A)),this.fireActionable(b)},onTrash:function(b){b.selectedCoordPaths.sort(function(A,V){return V.localeCompare(A,"en",{numeric:!0})}).forEach(function(A){return b.feature.removeCoordinate(A)}),this.fireUpdate(),b.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(b),b.feature.isValid()===!1&&(this.deleteFeature([b.featureId]),this.changeMode(me.SIMPLE_SELECT,{}))},onMouseMove:function(b,A){var V=Yt(A),ae=Dn(A),ge=xn(A),ye=b.selectedCoordPaths.length===0;return V&&ye||ae&&!ye?this.updateUIClasses({mouse:Z.MOVE}):this.updateUIClasses({mouse:Z.NONE}),(ae||V||ge)&&b.dragMoving&&this.fireUpdate(),this.stopDragging(b),!0},onMouseOut:function(b){return b.dragMoving&&this.fireUpdate(),!0}};Gn.onTouchStart=Gn.onMouseDown=function(b,A){return Dn(A)?this.onVertex(b,A):Yt(A)?this.onFeature(b,A):xn(A)?this.onMidpoint(b,A):void 0},Gn.onDrag=function(b,A){if(b.canDragMove===!0){b.dragMoving=!0,A.originalEvent.stopPropagation();var V={lng:A.lngLat.lng-b.dragMoveLocation.lng,lat:A.lngLat.lat-b.dragMoveLocation.lat};b.selectedCoordPaths.length>0?this.dragVertex(b,A,V):this.dragFeature(b,A,V),b.dragMoveLocation=A.lngLat}},Gn.onClick=function(b,A){return Ti(A)?this.clickNoTarget(b,A):Yt(A)?this.clickActiveFeature(b,A):yi(A)?this.clickInactive(b,A):void this.stopDragging(b)},Gn.onTap=function(b,A){return Ti(A)?this.clickNoTarget(b,A):Yt(A)?this.clickActiveFeature(b,A):yi(A)?this.clickInactive(b,A):void 0},Gn.onTouchEnd=Gn.onMouseUp=function(b){b.dragMoving&&this.fireUpdate(),this.stopDragging(b)};var kr={};function bn(b,A){return!!b.lngLat&&b.lngLat.lng===A[0]&&b.lngLat.lat===A[1]}kr.onSetup=function(){var b=this.newFeature({type:J.FEATURE,properties:{},geometry:{type:J.POINT,coordinates:[]}});return this.addFeature(b),this.clearSelectedFeatures(),this.updateUIClasses({mouse:Z.ADD}),this.activateUIButton(W.POINT),this.setActionableState({trash:!0}),{point:b}},kr.stopDrawingAndRemove=function(b){this.deleteFeature([b.point.id],{silent:!0}),this.changeMode(me.SIMPLE_SELECT)},kr.onTap=kr.onClick=function(b,A){this.updateUIClasses({mouse:Z.MOVE}),b.point.updateCoordinate("",A.lngLat.lng,A.lngLat.lat),this.map.fire(xe.CREATE,{features:[b.point.toGeoJSON()]}),this.changeMode(me.SIMPLE_SELECT,{featureIds:[b.point.id]})},kr.onStop=function(b){this.activateUIButton(),b.point.getCoordinate().length||this.deleteFeature([b.point.id],{silent:!0})},kr.toDisplayFeatures=function(b,A,V){var ae=A.properties.id===b.point.id;if(A.properties.active=ae?Le.ACTIVE:Le.INACTIVE,!ae)return V(A)},kr.onTrash=kr.stopDrawingAndRemove,kr.onKeyUp=function(b,A){if(gn(A)||Sr(A))return this.stopDrawingAndRemove(b,A)};var Hn={onSetup:function(){var b=this.newFeature({type:J.FEATURE,properties:{},geometry:{type:J.POLYGON,coordinates:[[]]}});return this.addFeature(b),this.clearSelectedFeatures(),te.disable(this),this.updateUIClasses({mouse:Z.ADD}),this.activateUIButton(W.POLYGON),this.setActionableState({trash:!0}),{polygon:b,currentVertexPosition:0}},clickAnywhere:function(b,A){if(b.currentVertexPosition>0&&bn(A,b.polygon.coordinates[0][b.currentVertexPosition-1]))return this.changeMode(me.SIMPLE_SELECT,{featureIds:[b.polygon.id]});this.updateUIClasses({mouse:Z.ADD}),b.polygon.updateCoordinate("0."+b.currentVertexPosition,A.lngLat.lng,A.lngLat.lat),b.currentVertexPosition++,b.polygon.updateCoordinate("0."+b.currentVertexPosition,A.lngLat.lng,A.lngLat.lat)},clickOnVertex:function(b){return this.changeMode(me.SIMPLE_SELECT,{featureIds:[b.polygon.id]})},onMouseMove:function(b,A){b.polygon.updateCoordinate("0."+b.currentVertexPosition,A.lngLat.lng,A.lngLat.lat),Ni(A)&&this.updateUIClasses({mouse:Z.POINTER})}};Hn.onTap=Hn.onClick=function(b,A){return Ni(A)?this.clickOnVertex(b,A):this.clickAnywhere(b,A)},Hn.onKeyUp=function(b,A){gn(A)?(this.deleteFeature([b.polygon.id],{silent:!0}),this.changeMode(me.SIMPLE_SELECT)):Sr(A)&&this.changeMode(me.SIMPLE_SELECT,{featureIds:[b.polygon.id]})},Hn.onStop=function(b){this.updateUIClasses({mouse:Z.NONE}),te.enable(this),this.activateUIButton(),this.getFeature(b.polygon.id)!==void 0&&(b.polygon.removeCoordinate("0."+b.currentVertexPosition),b.polygon.isValid()?this.map.fire(xe.CREATE,{features:[b.polygon.toGeoJSON()]}):(this.deleteFeature([b.polygon.id],{silent:!0}),this.changeMode(me.SIMPLE_SELECT,{},{silent:!0})))},Hn.toDisplayFeatures=function(b,A,V){var ae=A.properties.id===b.polygon.id;if(A.properties.active=ae?Le.ACTIVE:Le.INACTIVE,!ae)return V(A);if(A.geometry.coordinates.length!==0){var ge=A.geometry.coordinates[0].length;if(!(ge<3)){if(A.properties.meta=oe.FEATURE,V(ri(b.polygon.id,A.geometry.coordinates[0][0],"0.0",!1)),ge>3){var ye=A.geometry.coordinates[0].length-3;V(ri(b.polygon.id,A.geometry.coordinates[0][ye],"0."+ye,!1))}if(ge<=4){var Se=[[A.geometry.coordinates[0][0][0],A.geometry.coordinates[0][0][1]],[A.geometry.coordinates[0][1][0],A.geometry.coordinates[0][1][1]]];if(V({type:J.FEATURE,properties:A.properties,geometry:{coordinates:Se,type:J.LINE_STRING}}),ge===3)return}return V(A)}}},Hn.onTrash=function(b){this.deleteFeature([b.polygon.id],{silent:!0}),this.changeMode(me.SIMPLE_SELECT)};var vs={onSetup:function(b){var A,V,ae=(b=b||{}).featureId,ge="forward";if(ae){if(!(A=this.getFeature(ae)))throw new Error("Could not find a feature with the provided featureId");var ye=b.from;if(ye&&ye.type==="Feature"&&ye.geometry&&ye.geometry.type==="Point"&&(ye=ye.geometry),ye&&ye.type==="Point"&&ye.coordinates&&ye.coordinates.length===2&&(ye=ye.coordinates),!ye||!Array.isArray(ye))throw new Error("Please use the `from` property to indicate which point to continue the line from");var Se=A.coordinates.length-1;if(A.coordinates[Se][0]===ye[0]&&A.coordinates[Se][1]===ye[1])V=Se+1,A.addCoordinate.apply(A,[V].concat(A.coordinates[Se]));else{if(A.coordinates[0][0]!==ye[0]||A.coordinates[0][1]!==ye[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");ge="backwards",V=0,A.addCoordinate.apply(A,[V].concat(A.coordinates[0]))}}else A=this.newFeature({type:J.FEATURE,properties:{},geometry:{type:J.LINE_STRING,coordinates:[]}}),V=0,this.addFeature(A);return this.clearSelectedFeatures(),te.disable(this),this.updateUIClasses({mouse:Z.ADD}),this.activateUIButton(W.LINE),this.setActionableState({trash:!0}),{line:A,currentVertexPosition:V,direction:ge}},clickAnywhere:function(b,A){if(b.currentVertexPosition>0&&bn(A,b.line.coordinates[b.currentVertexPosition-1])||b.direction==="backwards"&&bn(A,b.line.coordinates[b.currentVertexPosition+1]))return this.changeMode(me.SIMPLE_SELECT,{featureIds:[b.line.id]});this.updateUIClasses({mouse:Z.ADD}),b.line.updateCoordinate(b.currentVertexPosition,A.lngLat.lng,A.lngLat.lat),b.direction==="forward"?(b.currentVertexPosition++,b.line.updateCoordinate(b.currentVertexPosition,A.lngLat.lng,A.lngLat.lat)):b.line.addCoordinate(0,A.lngLat.lng,A.lngLat.lat)},clickOnVertex:function(b){return this.changeMode(me.SIMPLE_SELECT,{featureIds:[b.line.id]})},onMouseMove:function(b,A){b.line.updateCoordinate(b.currentVertexPosition,A.lngLat.lng,A.lngLat.lat),Ni(A)&&this.updateUIClasses({mouse:Z.POINTER})}};vs.onTap=vs.onClick=function(b,A){if(Ni(A))return this.clickOnVertex(b,A);this.clickAnywhere(b,A)},vs.onKeyUp=function(b,A){Sr(A)?this.changeMode(me.SIMPLE_SELECT,{featureIds:[b.line.id]}):gn(A)&&(this.deleteFeature([b.line.id],{silent:!0}),this.changeMode(me.SIMPLE_SELECT))},vs.onStop=function(b){te.enable(this),this.activateUIButton(),this.getFeature(b.line.id)!==void 0&&(b.line.removeCoordinate(""+b.currentVertexPosition),b.line.isValid()?this.map.fire(xe.CREATE,{features:[b.line.toGeoJSON()]}):(this.deleteFeature([b.line.id],{silent:!0}),this.changeMode(me.SIMPLE_SELECT,{},{silent:!0})))},vs.onTrash=function(b){this.deleteFeature([b.line.id],{silent:!0}),this.changeMode(me.SIMPLE_SELECT)},vs.toDisplayFeatures=function(b,A,V){var ae=A.properties.id===b.line.id;if(A.properties.active=ae?Le.ACTIVE:Le.INACTIVE,!ae)return V(A);A.geometry.coordinates.length<2||(A.properties.meta=oe.FEATURE,V(ri(b.line.id,A.geometry.coordinates[b.direction==="forward"?A.geometry.coordinates.length-2:1],""+(b.direction==="forward"?A.geometry.coordinates.length-2:1),!1)),V(A))};var Lr={simple_select:Dr,direct_select:Gn,draw_point:kr,draw_polygon:Hn,draw_line_string:vs},co={defaultMode:me.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:Dt,modes:Lr,controls:{},userProperties:!1},ta={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},dr={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function uo(b,A){return b.map(function(V){return V.source?V:Be(V,{id:V.id+"."+A,source:A==="hot"?z.HOT:z.COLD})})}var wn={exports:{}};(function(b,A){var V="__lodash_hash_undefined__",ae=9007199254740991,ge="[object Arguments]",ye="[object Array]",Se="[object Boolean]",Ye="[object Date]",ot="[object Error]",wt="[object Function]",Mt="[object Map]",ft="[object Number]",oi="[object Object]",pr="[object Promise]",ui="[object RegExp]",Rr="[object Set]",je="[object String]",Ft="[object Symbol]",xi="[object WeakMap]",Tr="[object ArrayBuffer]",vr="[object DataView]",_a=/^\[object .+?Constructor\]$/,fo=/^(?:0|[1-9]\d*)$/,Wi={};Wi["[object Float32Array]"]=Wi["[object Float64Array]"]=Wi["[object Int8Array]"]=Wi["[object Int16Array]"]=Wi["[object Int32Array]"]=Wi["[object Uint8Array]"]=Wi["[object Uint8ClampedArray]"]=Wi["[object Uint16Array]"]=Wi["[object Uint32Array]"]=!0,Wi[ge]=Wi[ye]=Wi[Tr]=Wi[Se]=Wi[vr]=Wi[Ye]=Wi[ot]=Wi[wt]=Wi[Mt]=Wi[ft]=Wi[oi]=Wi[ui]=Wi[Rr]=Wi[je]=Wi[xi]=!1;var Na=typeof Zc=="object"&&Zc&&Zc.Object===Object&&Zc,xu=typeof self=="object"&&self&&self.Object===Object&&self,Ns=Na||xu||Function("return this")(),Il=A&&!A.nodeType&&A,mc=Il&&b&&!b.nodeType&&b,ia=mc&&mc.exports===Il,$a=ia&&Na.process,pn=function(){try{return $a&&$a.binding&&$a.binding("util")}catch{}}(),Jr=pn&&pn.isTypedArray;function Oi(Ee,Re){for(var mt=-1,Wt=Ee==null?0:Ee.length;++mt<Wt;)if(Re(Ee[mt],mt,Ee))return!0;return!1}function Fo(Ee){var Re=-1,mt=Array(Ee.size);return Ee.forEach(function(Wt,tr){mt[++Re]=[tr,Wt]}),mt}function Bo(Ee){var Re=-1,mt=Array(Ee.size);return Ee.forEach(function(Wt){mt[++Re]=Wt}),mt}var No,$o,mo,Al=Array.prototype,Pl=Function.prototype,va=Object.prototype,Uo=Ns["__core-js_shared__"],Dl=Pl.toString,Mn=va.hasOwnProperty,gc=(No=/[^.]+$/.exec(Uo&&Uo.keys&&Uo.keys.IE_PROTO||""))?"Symbol(src)_1."+No:"",yc=va.toString,bu=RegExp("^"+Dl.call(Mn).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),_c=ia?Ns.Buffer:void 0,Vo=Ns.Symbol,vc=Ns.Uint8Array,jo=va.propertyIsEnumerable,qo=Al.splice,$s=Vo?Vo.toStringTag:void 0,Go=Object.getOwnPropertySymbols,Ua=_c?_c.isBuffer:void 0,xc=($o=Object.keys,mo=Object,function(Ee){return $o(mo(Ee))}),Ho=Ma(Ns,"DataView"),xa=Ma(Ns,"Map"),Us=Ma(Ns,"Promise"),Zo=Ma(Ns,"Set"),ra=Ma(Ns,"WeakMap"),xs=Ma(Object,"create"),bc=sa(Ho),kl=sa(xa),ki=sa(Us),Wo=sa(Zo),wu=sa(ra),Ll=Vo?Vo.prototype:void 0,ba=Ll?Ll.valueOf:void 0;function er(Ee){var Re=-1,mt=Ee==null?0:Ee.length;for(this.clear();++Re<mt;){var Wt=Ee[Re];this.set(Wt[0],Wt[1])}}function Vs(Ee){var Re=-1,mt=Ee==null?0:Ee.length;for(this.clear();++Re<mt;){var Wt=Ee[Re];this.set(Wt[0],Wt[1])}}function fi(Ee){var Re=-1,mt=Ee==null?0:Ee.length;for(this.clear();++Re<mt;){var Wt=Ee[Re];this.set(Wt[0],Wt[1])}}function Va(Ee){var Re=-1,mt=Ee==null?0:Ee.length;for(this.__data__=new fi;++Re<mt;)this.add(Ee[Re])}function $i(Ee){var Re=this.__data__=new Vs(Ee);this.size=Re.size}function Ji(Ee,Re){var mt=ja(Ee),Wt=!mt&&Qo(Ee),tr=!mt&&!Wt&&Bl(Ee),Ci=!mt&&!Wt&&!tr&&el(Ee),mr=mt||Wt||tr||Ci,Cr=mr?function(Nr,os){for(var ws=-1,fn=Array(Nr);++ws<Nr;)fn[ws]=os(ws);return fn}(Ee.length,String):[],Sn=Cr.length;for(var cr in Ee)!Re&&!Mn.call(Ee,cr)||mr&&(cr=="length"||tr&&(cr=="offset"||cr=="parent")||Ci&&(cr=="buffer"||cr=="byteLength"||cr=="byteOffset")||Ol(cr,Sn))||Cr.push(cr);return Cr}function bs(Ee,Re){for(var mt=Ee.length;mt--;)if(Fl(Ee[mt][0],Re))return mt;return-1}function na(Ee){return Ee==null?Ee===void 0?"[object Undefined]":"[object Null]":$s&&$s in Object(Ee)?function(Re){var mt=Mn.call(Re,$s),Wt=Re[$s];try{Re[$s]=void 0;var tr=!0}catch{}var Ci=yc.call(Re);return tr&&(mt?Re[$s]=Wt:delete Re[$s]),Ci}(Ee):function(Re){return yc.call(Re)}(Ee)}function Xo(Ee){return jr(Ee)&&na(Ee)==ge}function Rl(Ee,Re,mt,Wt,tr){return Ee===Re||(Ee==null||Re==null||!jr(Ee)&&!jr(Re)?Ee!=Ee&&Re!=Re:function(Ci,mr,Cr,Sn,cr,Nr){var os=ja(Ci),ws=ja(mr),fn=os?ye:as(Ci),zn=ws?ye:as(mr),Ms=(fn=fn==ge?oi:fn)==oi,Qr=(zn=zn==ge?oi:zn)==oi,En=fn==zn;if(En&&Bl(Ci)){if(!Bl(mr))return!1;os=!0,Ms=!1}if(En&&!Ms)return Nr||(Nr=new $i),os||el(Ci)?go(Ci,mr,Cr,Sn,cr,Nr):function(Ai,Ri,il,Es,$l,en,On){switch(il){case vr:if(Ai.byteLength!=Ri.byteLength||Ai.byteOffset!=Ri.byteOffset)return!1;Ai=Ai.buffer,Ri=Ri.buffer;case Tr:return!(Ai.byteLength!=Ri.byteLength||!en(new vc(Ai),new vc(Ri)));case Se:case Ye:case ft:return Fl(+Ai,+Ri);case ot:return Ai.name==Ri.name&&Ai.message==Ri.message;case ui:case je:return Ai==Ri+"";case Mt:var tn=Fo;case Rr:var Tt=1&Es;if(tn||(tn=Bo),Ai.size!=Ri.size&&!Tt)return!1;var Ea=On.get(Ai);if(Ea)return Ea==Ri;Es|=2,On.set(Ai,Ri);var ls=go(tn(Ai),tn(Ri),Es,$l,en,On);return On.delete(Ai),ls;case Ft:if(ba)return ba.call(Ai)==ba.call(Ri)}return!1}(Ci,mr,fn,Cr,Sn,cr,Nr);if(!(1&Cr)){var Sa=Ms&&Mn.call(Ci,"__wrapped__"),Zn=Qr&&Mn.call(mr,"__wrapped__");if(Sa||Zn){var Ss=Sa?Ci.value():Ci,qa=Zn?mr.value():mr;return Nr||(Nr=new $i),cr(Ss,qa,Cr,Sn,Nr)}}return En?(Nr||(Nr=new $i),function(Ai,Ri,il,Es,$l,en){var On=1&il,tn=zl(Ai),Tt=tn.length,Ea=zl(Ri).length;if(Tt!=Ea&&!On)return!1;for(var ls=Tt;ls--;){var Wn=tn[ls];if(!(On?Wn in Ri:Mn.call(Ri,Wn)))return!1}var Ul=en.get(Ai);if(Ul&&en.get(Ri))return Ul==Ri;var vt=!0;en.set(Ai,Ri),en.set(Ri,Ai);for(var aa=On;++ls<Tt;){var yo=Ai[Wn=tn[ls]],_o=Ri[Wn];if(Es)var vo=On?Es(_o,yo,Wn,Ri,Ai,en):Es(yo,_o,Wn,Ai,Ri,en);if(!(vo===void 0?yo===_o||$l(yo,_o,il,Es,en):vo)){vt=!1;break}aa||(aa=Wn=="constructor")}if(vt&&!aa){var Ga=Ai.constructor,Ta=Ri.constructor;Ga==Ta||!("constructor"in Ai)||!("constructor"in Ri)||typeof Ga=="function"&&Ga instanceof Ga&&typeof Ta=="function"&&Ta instanceof Ta||(vt=!1)}return en.delete(Ai),en.delete(Ri),vt}(Ci,mr,Cr,Sn,cr,Nr)):!1}(Ee,Re,mt,Wt,Rl,tr))}function Ko(Ee){return!(!js(Ee)||function(Re){return!!gc&&gc in Re}(Ee))&&(Nl(Ee)?bu:_a).test(sa(Ee))}function Yo(Ee){if(mt=(Re=Ee)&&Re.constructor,Wt=typeof mt=="function"&&mt.prototype||va,Re!==Wt)return xc(Ee);var Re,mt,Wt,tr=[];for(var Ci in Object(Ee))Mn.call(Ee,Ci)&&Ci!="constructor"&&tr.push(Ci);return tr}function go(Ee,Re,mt,Wt,tr,Ci){var mr=1&mt,Cr=Ee.length,Sn=Re.length;if(Cr!=Sn&&!(mr&&Sn>Cr))return!1;var cr=Ci.get(Ee);if(cr&&Ci.get(Re))return cr==Re;var Nr=-1,os=!0,ws=2&mt?new Va:void 0;for(Ci.set(Ee,Re),Ci.set(Re,Ee);++Nr<Cr;){var fn=Ee[Nr],zn=Re[Nr];if(Wt)var Ms=mr?Wt(zn,fn,Nr,Re,Ee,Ci):Wt(fn,zn,Nr,Ee,Re,Ci);if(Ms!==void 0){if(Ms)continue;os=!1;break}if(ws){if(!Oi(Re,function(Qr,En){if(Sa=En,!ws.has(Sa)&&(fn===Qr||tr(fn,Qr,mt,Wt,Ci)))return ws.push(En);var Sa})){os=!1;break}}else if(fn!==zn&&!tr(fn,zn,mt,Wt,Ci)){os=!1;break}}return Ci.delete(Ee),Ci.delete(Re),os}function zl(Ee){return function(Re,mt,Wt){var tr=mt(Re);return ja(Re)?tr:function(Ci,mr){for(var Cr=-1,Sn=mr.length,cr=Ci.length;++Cr<Sn;)Ci[cr+Cr]=mr[Cr];return Ci}(tr,Wt(Re))}(Ee,tl,Jo)}function wa(Ee,Re){var mt,Wt,tr=Ee.__data__;return((Wt=typeof(mt=Re))=="string"||Wt=="number"||Wt=="symbol"||Wt=="boolean"?mt!=="__proto__":mt===null)?tr[typeof Re=="string"?"string":"hash"]:tr.map}function Ma(Ee,Re){var mt=function(Wt,tr){return Wt==null?void 0:Wt[tr]}(Ee,Re);return Ko(mt)?mt:void 0}er.prototype.clear=function(){this.__data__=xs?xs(null):{},this.size=0},er.prototype.delete=function(Ee){var Re=this.has(Ee)&&delete this.__data__[Ee];return this.size-=Re?1:0,Re},er.prototype.get=function(Ee){var Re=this.__data__;if(xs){var mt=Re[Ee];return mt===V?void 0:mt}return Mn.call(Re,Ee)?Re[Ee]:void 0},er.prototype.has=function(Ee){var Re=this.__data__;return xs?Re[Ee]!==void 0:Mn.call(Re,Ee)},er.prototype.set=function(Ee,Re){var mt=this.__data__;return this.size+=this.has(Ee)?0:1,mt[Ee]=xs&&Re===void 0?V:Re,this},Vs.prototype.clear=function(){this.__data__=[],this.size=0},Vs.prototype.delete=function(Ee){var Re=this.__data__,mt=bs(Re,Ee);return!(mt<0)&&(mt==Re.length-1?Re.pop():qo.call(Re,mt,1),--this.size,!0)},Vs.prototype.get=function(Ee){var Re=this.__data__,mt=bs(Re,Ee);return mt<0?void 0:Re[mt][1]},Vs.prototype.has=function(Ee){return bs(this.__data__,Ee)>-1},Vs.prototype.set=function(Ee,Re){var mt=this.__data__,Wt=bs(mt,Ee);return Wt<0?(++this.size,mt.push([Ee,Re])):mt[Wt][1]=Re,this},fi.prototype.clear=function(){this.size=0,this.__data__={hash:new er,map:new(xa||Vs),string:new er}},fi.prototype.delete=function(Ee){var Re=wa(this,Ee).delete(Ee);return this.size-=Re?1:0,Re},fi.prototype.get=function(Ee){return wa(this,Ee).get(Ee)},fi.prototype.has=function(Ee){return wa(this,Ee).has(Ee)},fi.prototype.set=function(Ee,Re){var mt=wa(this,Ee),Wt=mt.size;return mt.set(Ee,Re),this.size+=mt.size==Wt?0:1,this},Va.prototype.add=Va.prototype.push=function(Ee){return this.__data__.set(Ee,V),this},Va.prototype.has=function(Ee){return this.__data__.has(Ee)},$i.prototype.clear=function(){this.__data__=new Vs,this.size=0},$i.prototype.delete=function(Ee){var Re=this.__data__,mt=Re.delete(Ee);return this.size=Re.size,mt},$i.prototype.get=function(Ee){return this.__data__.get(Ee)},$i.prototype.has=function(Ee){return this.__data__.has(Ee)},$i.prototype.set=function(Ee,Re){var mt=this.__data__;if(mt instanceof Vs){var Wt=mt.__data__;if(!xa||Wt.length<199)return Wt.push([Ee,Re]),this.size=++mt.size,this;mt=this.__data__=new fi(Wt)}return mt.set(Ee,Re),this.size=mt.size,this};var Jo=Go?function(Ee){return Ee==null?[]:(Ee=Object(Ee),function(Re,mt){for(var Wt=-1,tr=Re==null?0:Re.length,Ci=0,mr=[];++Wt<tr;){var Cr=Re[Wt];mt(Cr,Wt,Re)&&(mr[Ci++]=Cr)}return mr}(Go(Ee),function(Re){return jo.call(Ee,Re)}))}:function(){return[]},as=na;function Ol(Ee,Re){return!!(Re=Re??ae)&&(typeof Ee=="number"||fo.test(Ee))&&Ee>-1&&Ee%1==0&&Ee<Re}function sa(Ee){if(Ee!=null){try{return Dl.call(Ee)}catch{}try{return Ee+""}catch{}}return""}function Fl(Ee,Re){return Ee===Re||Ee!=Ee&&Re!=Re}(Ho&&as(new Ho(new ArrayBuffer(1)))!=vr||xa&&as(new xa)!=Mt||Us&&as(Us.resolve())!=pr||Zo&&as(new Zo)!=Rr||ra&&as(new ra)!=xi)&&(as=function(Ee){var Re=na(Ee),mt=Re==oi?Ee.constructor:void 0,Wt=mt?sa(mt):"";if(Wt)switch(Wt){case bc:return vr;case kl:return Mt;case ki:return pr;case Wo:return Rr;case wu:return xi}return Re});var Qo=Xo(function(){return arguments}())?Xo:function(Ee){return jr(Ee)&&Mn.call(Ee,"callee")&&!jo.call(Ee,"callee")},ja=Array.isArray,Bl=Ua||function(){return!1};function Nl(Ee){if(!js(Ee))return!1;var Re=na(Ee);return Re==wt||Re=="[object GeneratorFunction]"||Re=="[object AsyncFunction]"||Re=="[object Proxy]"}function fr(Ee){return typeof Ee=="number"&&Ee>-1&&Ee%1==0&&Ee<=ae}function js(Ee){var Re=typeof Ee;return Ee!=null&&(Re=="object"||Re=="function")}function jr(Ee){return Ee!=null&&typeof Ee=="object"}var el=Jr?function(Ee){return function(Re){return Ee(Re)}}(Jr):function(Ee){return jr(Ee)&&fr(Ee.length)&&!!Wi[na(Ee)]};function tl(Ee){return(Re=Ee)!=null&&fr(Re.length)&&!Nl(Re)?Ji(Ee):Yo(Ee);var Re}b.exports=function(Ee,Re){return Rl(Ee,Re)}})(wn,wn.exports);var ho=u(wn.exports);function ss(b,A){return b.length===A.length&&JSON.stringify(b.map(function(V){return V}).sort())===JSON.stringify(A.map(function(V){return V}).sort())}var po={Polygon:Si,LineString:Zi,Point:nr,MultiPolygon:ut,MultiLineString:ut,MultiPoint:ut},qi=Object.freeze({__proto__:null,CommonSelectors:nt,constrainFeatureMovement:Vi,createMidPoint:ea,createSupplementaryPoints:Er,createVertex:ri,doubleClickZoom:te,euclideanDistance:ii,featuresAt:zt,getFeatureAtAndSetCursors:ti,isClick:hi,isEventAtCoordinates:bn,isTap:Mi,mapEventToBoundingBox:Rt,ModeHandler:a,moveFeatures:lo,sortFeatures:Ht,stringSetsAreEqual:ss,StringSet:li,theme:Dt,toDenseArray:ue}),Oo=function(b,A){var V={options:b=function(ge){ge===void 0&&(ge={});var ye=Be(ge);return ge.controls||(ye.controls={}),ge.displayControlsDefault===!1?ye.controls=Be(dr,ge.controls):ye.controls=Be(ta,ge.controls),(ye=Be(co,ye)).styles=uo(ye.styles,"cold").concat(uo(ye.styles,"hot")),ye}(b)};A=function(ge,ye){return ye.modes=me,ye.getFeatureIdsAt=function(Se){return zt.click({point:Se},null,ge).map(function(Ye){return Ye.properties.id})},ye.getSelectedIds=function(){return ge.store.getSelectedIds()},ye.getSelected=function(){return{type:J.FEATURE_COLLECTION,features:ge.store.getSelectedIds().map(function(Se){return ge.store.get(Se)}).map(function(Se){return Se.toGeoJSON()})}},ye.getSelectedPoints=function(){return{type:J.FEATURE_COLLECTION,features:ge.store.getSelectedCoordinates().map(function(Se){return{type:J.FEATURE,properties:{},geometry:{type:J.POINT,coordinates:Se.coordinates}}})}},ye.set=function(Se){if(Se.type===void 0||Se.type!==J.FEATURE_COLLECTION||!Array.isArray(Se.features))throw new Error("Invalid FeatureCollection");var Ye=ge.store.createRenderBatch(),ot=ge.store.getAllIds().slice(),wt=ye.add(Se),Mt=new li(wt);return(ot=ot.filter(function(ft){return!Mt.has(ft)})).length&&ye.delete(ot),Ye(),wt},ye.add=function(Se){var Ye=JSON.parse(JSON.stringify(Q(Se))).features.map(function(ot){if(ot.id=ot.id||tt(),ot.geometry===null)throw new Error("Invalid geometry: null");if(ge.store.get(ot.id)===void 0||ge.store.get(ot.id).type!==ot.geometry.type){var wt=po[ot.geometry.type];if(wt===void 0)throw new Error("Invalid geometry type: "+ot.geometry.type+".");var Mt=new wt(ge,ot);ge.store.add(Mt)}else{var ft=ge.store.get(ot.id);ft.properties=ot.properties,ho(ft.properties,ot.properties)||ge.store.featureChanged(ft.id),ho(ft.getCoordinates(),ot.geometry.coordinates)||ft.incomingCoords(ot.geometry.coordinates)}return ot.id});return ge.store.render(),Ye},ye.get=function(Se){var Ye=ge.store.get(Se);if(Ye)return Ye.toGeoJSON()},ye.getAll=function(){return{type:J.FEATURE_COLLECTION,features:ge.store.getAll().map(function(Se){return Se.toGeoJSON()})}},ye.delete=function(Se){return ge.store.delete(Se,{silent:!0}),ye.getMode()!==me.DIRECT_SELECT||ge.store.getSelectedIds().length?ge.store.render():ge.events.changeMode(me.SIMPLE_SELECT,void 0,{silent:!0}),ye},ye.deleteAll=function(){return ge.store.delete(ge.store.getAllIds(),{silent:!0}),ye.getMode()===me.DIRECT_SELECT?ge.events.changeMode(me.SIMPLE_SELECT,void 0,{silent:!0}):ge.store.render(),ye},ye.changeMode=function(Se,Ye){return Ye===void 0&&(Ye={}),Se===me.SIMPLE_SELECT&&ye.getMode()===me.SIMPLE_SELECT?(ss(Ye.featureIds||[],ge.store.getSelectedIds())||(ge.store.setSelected(Ye.featureIds,{silent:!0}),ge.store.render()),ye):(Se===me.DIRECT_SELECT&&ye.getMode()===me.DIRECT_SELECT&&Ye.featureId===ge.store.getSelectedIds()[0]||ge.events.changeMode(Se,Ye,{silent:!0}),ye)},ye.getMode=function(){return ge.events.getMode()},ye.trash=function(){return ge.events.trash({silent:!0}),ye},ye.combineFeatures=function(){return ge.events.combineFeatures({silent:!0}),ye},ye.uncombineFeatures=function(){return ge.events.uncombineFeatures({silent:!0}),ye},ye.setFeatureProperty=function(Se,Ye,ot){return ge.store.setFeatureProperty(Se,Ye,ot),ye},ye}(V,A),V.api=A;var ae=it(V);return A.onAdd=ae.onAdd,A.onRemove=ae.onRemove,A.types=W,A.options=b,A};function Bs(b){Oo(b,this)}return Bs.modes=Lr,Bs.constants=dt,Bs.lib=qi,Bs})})(e1);var TR=e1.exports;const Fd=Jm(TR),CR=e=>(Nh("data-v-acefdfcb"),e=e(),$h(),e),IR=CR(()=>Y("input",null,null,-1)),AR={__name:"AddressSearchControl",setup(e){const r=jh(),a=ks("");return(u,d)=>(It(),Ot(Mr,null,[lv(Y("input",{class:"input address-input",type:"text",placeholder:"Search an address","onUpdate:modelValue":d[0]||(d[0]=g=>a.value=g),onKeydown:d[1]||(d[1]=hM(g=>Fi(r).replace({name:"search",query:{address:a.value}}),["enter"]))},null,544),[[cM,a.value]]),IR,Y("button",{class:"button",onClick:d[2]||(d[2]=g=>Fi(r).replace({name:"search",query:{address:a.value}}))}," Search ")],64))}},PR=Qs(AR,[["__scopeId","data-v-acefdfcb"]]);function DR(e,r,a,u){u===void 0&&(u={});var d=Fh(e),g=Ra(d[0]),m=Ra(d[1]),l=Ra(a),M=pI(r,u.units),P=Math.asin(Math.sin(m)*Math.cos(M)+Math.cos(m)*Math.sin(M)*Math.cos(l)),R=g+Math.atan2(Math.sin(l)*Math.sin(M)*Math.cos(m),Math.cos(M)-Math.sin(m)*Math.sin(P)),D=vm(R),z=vm(P);return Lh([D,z],u.properties)}function t1(e,r,a){if(a===void 0&&(a={}),a.final===!0)return kR(e,r);var u=Fh(e),d=Fh(r),g=Ra(u[0]),m=Ra(d[0]),l=Ra(u[1]),M=Ra(d[1]),P=Math.sin(m-g)*Math.cos(M),R=Math.cos(l)*Math.sin(M)-Math.sin(l)*Math.cos(M)*Math.cos(m-g);return vm(Math.atan2(P,R))}function kR(e,r){var a=t1(r,e);return a=(a+180)%360,a}function x0(e,r){var a=fu(e,r),u=t1(e,r),d=DR(e,a/2,u);return d}var b0=6378137;function LR(e){return xL(e,function(r,a){return r+RR(a)},0)}function RR(e){var r=0,a;switch(e.type){case"Polygon":return w0(e.coordinates);case"MultiPolygon":for(a=0;a<e.coordinates.length;a++)r+=w0(e.coordinates[a]);return r;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function w0(e){var r=0;if(e&&e.length>0){r+=Math.abs(M0(e[0]));for(var a=1;a<e.length;a++)r-=Math.abs(M0(e[a]))}return r}function M0(e){var r,a,u,d,g,m,l,M=0,P=e.length;if(P>2){for(l=0;l<P;l++)l===P-2?(d=P-2,g=P-1,m=0):l===P-1?(d=P-1,g=0,m=1):(d=l,g=l+1,m=l+2),r=e[d],a=e[g],u=e[m],M+=(Xf(u[0])-Xf(r[0]))*Math.sin(Xf(a[1]));M=M*b0*b0/2}return M}function Xf(e){return e*Math.PI/180}const zR={name:"DistanceMeasureControl",props:{position:{type:String,default:"bottom-left"}},data(){return{mode:"simple_select",selected:null,toggledOn:!1,currentShape:null,currentArea:null,labelLayers:[]}},computed:{publicPath(){return"/vue3-atlas2/"},currentOrSelectedShape(){let e;return this.$data.selected?e=this.$data.selected:this.currentShape&&(e=this.currentShape),e},newArea(){let e=this.$data.labelLayers.filter(a=>a.id===this.currentOrSelectedShape);console.log("newArea is recalculating, shape:",e,"this.currentOrSelectedShape:",this.currentOrSelectedShape);let r;return e[0]&&(r=e[0].area),r},currentDistances(){console.log("currentDistances is recalculating");let e=this.$data.labelLayers.filter(a=>a.id===this.currentOrSelectedShape),r;return e[0]&&(r=e[0].distances),r},currentTotalLength(){let e=0;for(let r of this.currentDistances)e=e+r.distance;return e.toFixed(2)+" Ft"},shouldShowDistanceBox(){let e=this.$data.mode!=="simple_select",r=this.$data.selected!==null,a=this.$data.toggledOn,u;return e&&a||r&&a?u=!0:u=!1,u}},methods:{handleDeleteClick(e){const r=ys();let a=this.labelLayers.indexOf(this.labelLayers.filter(u=>u.id===this.currentShape)[0]);this.labelLayers.splice(a,1),r.draw.delete(this.$data.selected),this.$data.selected=null},deleteDrawDistances(e){let r=this.currentShape.indexOf(this.currentShape.filter(a=>a.id===e)[0]);this.currentShape.splice(r,1),this.$data.selected=null},getDrawDistances(e){console.log("start of getDrawDistances, e:",e);let a=ys().draw,u=a.getAll(),d,g,m;e&&e.point?(g=e.point,m=a.getFeatureIdsAt(g)[0],m||(m=u.features[u.features.length-1].id)):e&&e.features&&e.features.length&&(m=e.features[0].id),this.currentShape=m;let l,M;if(console.log("shapeId:",m,"draw.getSelectedIds():",a.getSelectedIds()),m?(l=u.features.filter(z=>z.id===m)[0],console.log("if shapeId:",m,"feature:",l,"feature,geometry.coordinates.length:",l.geometry.coordinates.length),l.geometry.type==="LineString"?(d=l.geometry.coordinates,console.log("its a linestring, coordinates.length:",d.length)):(console.log("its not a linestring"),d=l.geometry.coordinates[0])):(l=u.features[u.features.length-1],l&&l.geometry&&l.geometry.type==="LineString"?(console.log("its a linestring"),d=l.geometry.coordinates):l&&l.geometry&&(console.log("its not a linestring"),d=l.geometry.coordinates[0])),console.log("middle of getDrawDistances, draw:",a,"shapeId:",m,"e:",e,"mode is draw_polygon, data:",u,"coordinates:",d),e&&e.point&&(console.log("if e.point is running"),d.splice(d.length-2,1)),l&&l.geometry&&l.geometry.type==="LineString"&&(console.log("if feature.geometry.type === LineString is running"),d.splice(0,1)),d&&d.length>=4){const z=ig([d]),Z=fI(LR(z),"meters","feet");console.log("calculating the area:",Z),M=Z.toFixed(2)+" Sq Feet"}let P,R=[],D=[];if(d)for(P=0;P<d.length;P++){let z=0,Z=null,W=[],J=[],me;if(d[P+1]?me=d[P+1]:me=d[0],z=parseFloat((fu(d[P],me,{units:"miles"})*5280).toFixed(2)),d[P-1]&&(Z=parseFloat((fu(d[P-1],d[P],{units:"miles"})*5280).toFixed(2))),J={firstPoint:[parseFloat(d[P][0].toFixed(5)),parseFloat(d[P][1].toFixed(5))],midPoint:W,distance:Z},R.push(J),e.point&&d[P][0]!==me[0]&&P<d.length-2&&(W=x0(d[P],me).geometry.coordinates,D.push({type:"Feature",properties:{description:z},geometry:{type:"Point",coordinates:W}})),!e.point&&d[P][0]!==me[0]&&P<d.length-1&&(W=x0(d[P],me).geometry.coordinates,D.push({type:"Feature",properties:{description:z},geometry:{type:"Point",coordinates:W}})),e.point&&P===d.length-2)break}if(console.log("near end of getDrawDistances, currentArea:",M,"distancesArray.length:",R.length,"distancesArray:",R,"features:",D),R.length){let z={};if(m){console.log("if inside if is running, currentArea:",M,"distancesArray[distancesArray.length-1].distance:",R[R.length-1].distance,"distancesArray:",R),z={id:m,area:M,distances:R,source:{type:"geojson",data:{type:"FeatureCollection",features:[]}},layer:{id:m,type:"symbol",source:m,paint:{"text-color":"red"},layout:{"text-size":12,"text-font":["Open Sans Regular"],"text-field":["get","description"],"text-variable-anchor":["center"],"text-radial-offset":.5,"text-justify":"center"}}};let Z=this.labelLayers.filter(W=>W.id===m)[0];Z||(this.labelLayers.push(z),Z=this.labelLayers.filter(W=>W.id===m)[0]),Z.area=M,Z.distances=R,Z.source.data.features=D}}},handleDrawModeChange(e){console.log("handleDrawModeChange is running, e:",e,"e.mode:",e.mode),this.$data.mode=e.mode,e.mode==="draw_polygon"&&(this.$data.toggledOn=!0),this.currentShape},handleDrawCancel(e){console.log("handleDrawCancel is running, e:",e,"this.currentShape:",this.$data.currentShape);const r=ys();let a=this.currentShape;if(console.log("handleDrawCancel is running, shapeId:",a),a){let u=this.$data.labelLayers.indexOf(this.$data.labelLayers.filter(d=>d.id===a)[0]);this.$data.labelLayers.splice(u,1),r.draw.delete(this.currentShape),this.$data.currentShape=null}r.draw.changeMode("simple_select"),this.$data.toggledOn=!1},handleDrawFinish(e){const r=ys();let a=this.$data.currentShape,u=this.$data.labelLayers.filter(g=>g.id===this.currentShape)[0].distances;console.log("MapPanel.vue handleDrawFinish 1 is running, MapStore.draw.getMode():",r.draw.getMode(),"currentShape:",a,"fetchedPoints:",u);let d=[];for(let g of u)d.push(g.firstPoint);if(d.length>1&&d.push(u[0].firstPoint),u.length>2)r.draw.changeMode("simple_select"),this.$data.mode="simple_select";else if(u.length===2){r.draw.delete(this.currentShape),r.draw.changeMode("draw_line_string");let g={type:"Feature",geometry:{type:"LineString",coordinates:d},id:this.currentShape,properties:{}};r.draw.add(g),r.draw.changeMode("simple_select"),this.$data.mode="simple_select"}else if(u.length===1){r.draw.delete(this.currentShape),r.draw.changeMode("draw_point");let g={type:"Feature",geometry:{type:"Point",coordinates:d[0]},id:this.currentShape,properties:{}};r.draw.add(g),r.draw.changeMode("simple_select"),this.$data.mode="simple_select"}else r.draw.trash(),this.handleDrawCancel();console.log("MapPanel.vue handleDrawFinish 2 is running, MapStore.draw.getMode():",r.draw.getMode(),"currentShape:",a,"fetchedPoints:",u)},handleDrawSelectionChange(e){let u=ys().draw.getSelectedIds();console.log("handleDrawSelectionChange, e:",e,"val:",u),e.features[0]?(console.log("there are features"),this.$data.selected=u[0]):(console.log("there are no features"),this.$data.selected=null)}}},OR={key:0,class:is("measure-tool-popup-bottom-right")},FR={key:0},BR=Y("div",{class:"measure-tool-header"}," Measure distances and areas ",-1),NR=Y("div",{class:"measure-tool-description"}," Start creating a measurement by adding points to the map. ",-1),$R=Y("hr",{class:"popup-line"},null,-1),UR=["src"],VR={key:1},jR=Y("tr",null,[Y("th",null,"lat"),Y("th",null,"lng"),Y("th",null,"distance (ft)")],-1),qR=Y("hr",{class:"popup-line"},null,-1),GR={key:0},HR=Y("hr",{class:"popup-line"},null,-1),ZR={key:1},WR=Y("hr",{class:"popup-line"},null,-1),XR={key:2,class:"drawn-shape-actions"},KR=["src"],YR={key:3,class:"draw-actions"},JR=["src"],QR=["src"];function ez(e,r,a,u,d,g){return It(),Ot("div",null,[g.shouldShowDistanceBox?(It(),Ot("div",OR,[g.currentDistances?Gi("",!0):(It(),Ot("div",FR,[BR,NR,$R,Y("div",null,[Y("img",{src:g.publicPath+"images/cancel.png",class:"img-class",alt:"cancel",onClick:r[0]||(r[0]=(...m)=>g.handleDrawCancel&&g.handleDrawCancel(...m))},null,8,UR),Y("div",{class:"inline-block-div",onClick:r[1]||(r[1]=(...m)=>g.handleDrawCancel&&g.handleDrawCancel(...m))}," Cancel ")])])),g.currentDistances?(It(),Ot("div",VR,[Y("table",null,[jR,(It(!0),Ot(Mr,null,Ls(g.currentDistances,(m,l)=>(It(),Ot("tr",{key:l},[Y("td",null,qt(m.firstPoint[1]),1),Y("td",null,qt(m.firstPoint[0]),1),Y("td",null,qt(m.distance),1)]))),128))]),qR,g.currentDistances.length>=2?(It(),Ot("div",GR,[ip(" Total Length: "+qt(g.currentTotalLength)+" ",1),HR])):Gi("",!0),g.currentDistances.length>=3?(It(),Ot("div",ZR,[ip(" Total Area: "+qt(g.newArea)+" ",1),WR])):Gi("",!0),e.mode==="simple_select"?(It(),Ot("div",XR,[Y("img",{src:g.publicPath+"images/trash.png",class:"img-class",alt:"trash",onClick:r[2]||(r[2]=(...m)=>g.handleDeleteClick&&g.handleDeleteClick(...m))},null,8,KR),Y("div",{class:"inline-block-div",onClick:r[3]||(r[3]=(...m)=>g.handleDeleteClick&&g.handleDeleteClick(...m))}," Delete ")])):Gi("",!0),e.mode!=="simple_select"?(It(),Ot("div",YR,[Y("img",{src:g.publicPath+"images/cancel.png",class:"img-class",alt:"cancel",onClick:r[4]||(r[4]=(...m)=>g.handleDrawCancel&&g.handleDrawCancel(...m))},null,8,JR),Y("div",{class:"inline-block-div",onClick:r[5]||(r[5]=(...m)=>g.handleDrawCancel&&g.handleDrawCancel(...m))}," Cancel "),Y("img",{src:g.publicPath+"images/check.png",class:"img-class",alt:"finish",onClick:r[6]||(r[6]=(...m)=>g.handleDrawFinish&&g.handleDrawFinish(...m))},null,8,QR),Y("div",{class:"inline-block-div",onClick:r[7]||(r[7]=(...m)=>g.handleDrawFinish&&g.handleDrawFinish(...m))}," Finish Measurement ")])):Gi("",!0)])):Gi("",!0)])):Gi("",!0)])}const tz=Qs(zR,[["render",ez]]),iz={class:"imagery-toggle"},rz=["src"],nz={__name:"ImageryToggleControl",emits:["toggleImagery"],setup(e){const r=ys(),a=gi(()=>r.imageryOn?"/vue3-atlas2/images/basemap_small.png":"/vue3-atlas2/images/imagery_small.png");return(u,d)=>(It(),Ot("div",iz,[Y("button",{type:"button",onClick:d[0]||(d[0]=g=>u.$emit("toggleImagery"))},[Y("img",{class:"img-src",src:a.value},null,8,rz)])]))}},sz=Qs(nz,[["__scopeId","data-v-0a98ea4d"]]),az={class:"dropdown-trigger"},oz={class:"button","aria-haspopup":"true","aria-controls":"dropdown-menu"},lz=Y("span",{class:"icon is-small"},[Y("i",{class:"fas fa-angle-down","aria-hidden":"true"})],-1),cz={class:"dropdown-menu",id:"dropdown-menu",role:"menu"},uz={class:"dropdown-content"},hz={__name:"ImageryDropdownControl",emits:["setImagery"],setup(e,{emit:r}){ys();const a=r,u=ks("2023"),d=ks(!1),g=()=>d.value=!d.value,m=l=>{u.value=l,a("setImagery",l),d.value=!1};return(l,M)=>(It(),Ot("div",{class:is([d.value?"is-active":"","imagery-dropdown dropdown"]),onClick:g},[Y("div",az,[Y("button",oz,[Y("span",null,qt(u.value),1),lz])]),Y("div",cz,[Y("div",uz,[Y("a",{class:"dropdown-item",onClick:M[0]||(M[0]=P=>m("2023"))},"2023"),Y("a",{class:"dropdown-item",onClick:M[1]||(M[1]=P=>m("2022"))},"2022"),Y("a",{class:"dropdown-item",onClick:M[2]||(M[2]=P=>m("2020"))},"2020"),Y("a",{class:"dropdown-item",onClick:M[3]||(M[3]=P=>m("2019"))},"2019"),Y("a",{class:"dropdown-item",onClick:M[4]||(M[4]=P=>m("2018"))},"2018"),Y("a",{class:"dropdown-item",onClick:M[5]||(M[5]=P=>m("2017"))},"2017"),Y("a",{class:"dropdown-item",onClick:M[6]||(M[6]=P=>m("2016"))},"2016"),Y("a",{class:"dropdown-item",onClick:M[7]||(M[7]=P=>m("2015"))},"2015"),Y("a",{class:"dropdown-item",onClick:M[8]||(M[8]=P=>m("2012"))},"2012"),Y("a",{class:"dropdown-item",onClick:M[9]||(M[9]=P=>m("2010"))},"2010"),Y("a",{class:"dropdown-item",onClick:M[10]||(M[10]=P=>m("2008"))},"2008"),Y("a",{class:"dropdown-item",onClick:M[11]||(M[11]=P=>m("2004"))},"2004"),Y("a",{class:"dropdown-item",onClick:M[12]||(M[12]=P=>m("1996"))},"1996"),Y("a",{class:"dropdown-item",onClick:M[13]||(M[13]=P=>m("1962"))},"1962"),Y("a",{class:"dropdown-item",onClick:M[14]||(M[14]=P=>m("1942"))},"1942"),Y("a",{class:"dropdown-item",onClick:M[15]||(M[15]=P=>m("1910"))},"1910"),Y("a",{class:"dropdown-item",onClick:M[16]||(M[16]=P=>m("1895"))},"1895"),Y("a",{class:"dropdown-item",onClick:M[17]||(M[17]=P=>m("1875"))},"1875"),Y("a",{class:"dropdown-item",onClick:M[18]||(M[18]=P=>m("1860"))},"1860")])])],2))}},dz={class:"cyclomedia-toggle"},pz=["src"],fz={__name:"CyclomediaControl",emits:["toggleCyclomedia"],setup(e){const r=gi(()=>"/vue3-atlas2/images/cyclomedia.png");return(a,u)=>(It(),Ot("div",dz,[Y("button",{type:"button",onClick:u[0]||(u[0]=d=>a.$emit("toggleCyclomedia"))},[Y("img",{class:"img-src",src:r.value},null,8,pz)])]))}},mz=Qs(fz,[["__scopeId","data-v-4c09b360"]]),gz={class:"pictometry-toggle"},yz=["src"],_z={__name:"PictometryControl",emits:["togglePictometry"],setup(e){const r=gi(()=>"/vue3-atlas2/images/pictometry.png");return(a,u)=>(It(),Ot("div",gz,[Y("button",{type:"button",onClick:u[0]||(u[0]=d=>a.$emit("togglePictometry"))},[Y("img",{class:"img-src",src:r.value},null,8,yz)])]))}},vz=Qs(_z,[["__scopeId","data-v-321bbe13"]]),xz={name:"OpacitySlider",props:["position","initialOpacity"],data(){return{value:100}},mounted(){ys(),this.$data.value=this.$props.initialOpacity*100},methods:{handleSliderValueChange(e){this.$data.value=e.target.value,this.$emit("opacityChange",e.target.value)}}},bz={class:"map-overlay top"},wz={class:"map-overlay-inner"},Mz=["value"];function Sz(e,r,a,u,d,g){return It(),Ot("div",bz,[Y("div",wz,[Y("input",{id:"slider",class:"opacity-slider",type:"range",min:"0",max:"100",step:"0",value:e.value,onInput:r[0]||(r[0]=(...m)=>g.handleSliderValueChange&&g.handleSliderValueChange(...m)),onChange:r[1]||(r[1]=(...m)=>g.handleSliderValueChange&&g.handleSliderValueChange(...m))},null,40,Mz)])])}const S0=Qs(xz,[["render",Sz]]),Ez={id:"map",class:"map-class"},Tz={__name:"Map",setup(e){console.log("Map.vue $config:",mn);const r=ys(),a=Js(),u=dn(),d=hu(),g=lg(),m=qh(),l=jh();let M;const P=gi(()=>u.addressData.features?u.addressData.features[0].geometry.coordinates:[]),R=gi(()=>a.selectedParcelId),D=gi(()=>R.value&&d.dor.features?(console.log("selectedParcelId.value:",R.value,"ParcelsStore.dor.features.filter(parcel => parcel.id === selectedParcelId.value)[0]:",d.dor.features.filter(ct=>ct.id===R.value)[0]),d.dor.features.filter(ct=>ct.id===R.value)[0].geometry.coordinates[0]):[]);rs(()=>P.value,ct=>{console.log("Map pwdCoordinates watch, newCoords:",ct,"MapStore.addressMarker:",r.addressMarker);const zt={type:"Feature",geometry:{type:"Point",coordinates:ct}};M.getSource("addressMarker").setData(zt)}),rs(()=>D.value,ct=>{console.log("Map dorCoordinates watch, newCoords:",ct);const zt={type:"Feature",geometry:{type:"Polygon",coordinates:[ct]}};M.getSource("dorParcel").setData(zt)}),rs(()=>m.params.topic,async ct=>{if(console.log("Map route.params.topic watch, newTopic:",ct),ct){M.setStyle(mn[mn.topicStyles[ct]]);const zt=M.getSource("addressMarker"),Bi=M.getSource("dorParcel");zt&&Bi&&(zt.setData({type:"Feature",geometry:{type:"Point",coordinates:P.value}}),Bi.setData({type:"Feature",geometry:{type:"Polygon",coordinates:[D.value]}})),r.selectedRegmap=null}}),rs(()=>u.addressData,async ct=>{console.log("MapStore route.params.address watch, newAddress:",ct);const zt=ct.features[0].geometry.coordinates;a.lastSearchMethod==="address"&&(M.setCenter(zt),M.setZoom(17))});const z=gi(()=>r.selectedRegmap);rs(()=>z.value,(ct,zt)=>{if(console.log("addRegmapLayer, newRegmap:",ct,"oldRegmap:",zt),ct==null)console.log("remove old regmap"),M.getLayer("regmap")&&(M.removeLayer("regmap"),M.removeSource("regmap")),r.selectedRegmap=null;else if(zt==null){M.getSource("regmap")&&M.removeSource("regmap"),console.log("add newRegmap:",ct);const Bi=`https://ags-regmaps.phila.gov/arcgis/rest/services/RegMaps/MapServer/export?dpi=96&layerDefs=0:NAME='g${ct.toLowerCase()}.tif'&transparent=true&format=png24&bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=700,700&f=image&layers=show%3A0`;mn.dorDrawnMapStyle.sources.regmap={type:"raster",tiles:[Bi],tileSize:256},M.addLayer({id:"regmap",type:"raster",source:mn.dorDrawnMapStyle.sources.regmap,paint:{"raster-opacity":r.regmapOpacity}},"dorParcel")}else{M.removeLayer("regmap"),M.removeSource("regmap");const Bi=`https://ags-regmaps.phila.gov/arcgis/rest/services/RegMaps/MapServer/export?dpi=96&layerDefs=0:NAME='g${ct.toLowerCase()}.tif'&transparent=true&format=png24&bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=700,700&f=image&layers=show%3A0`;mn.dorDrawnMapStyle.sources.regmap={type:"raster",tiles:[Bi],tileSize:256},M.addLayer({id:"regmap",type:"raster",source:mn.dorDrawnMapStyle.sources.regmap,paint:{"raster-opacity":r.regmapOpacity}},"dorParcel")}});const Z=ct=>{r.regmapOpacity=ct/100,M.setPaintProperty("regmap","raster-opacity",parseFloat(ct/100))},W=gi(()=>g.selectedLiBuildingNumber);rs(()=>W.value,ct=>{console.log("Map.vue watch selectedLiBuildingNumber.value:",W.value),M.setPaintProperty("liBuildingFootprints","fill-color",["match",["get","id"],ct,"#FFFA80","#C2B7FF"])});const J=gi(()=>a.hoveredStateId);rs(()=>J.value,ct=>{if(console.log("Map.vue hoveredStateId watch, newHoveredStateId:",ct),ct){const zt=M.getStyle().sources.nearby.data.features.filter(ti=>ti.properties.id===ct)[0],Bi=M.getStyle().sources.nearby.data.features.indexOf(zt);console.log("index:",Bi,"map.getStyle().sources.nearby.data.features:",M.getStyle().sources.nearby.data.features.filter(ti=>ti.properties.id===ct)[0]),M.getStyle().sources.nearby.data.features.splice(Bi,1),M.getStyle().sources.nearby.data.features.push(zt),M.getSource("nearby").setData(M.getStyle().sources.nearby.data),console.log("there is a new hoveredStateId, setting paint property"),M.setPaintProperty("nearby","circle-color",["match",["get","id"],ct,"#FFFF00",["match",["get","type"],"nearby311","#FF0000","nearbyCrimeIncidents","#0096FF","#000000"]])}else M.setPaintProperty("nearby","circle-color",["match",["get","type"],"nearby311","#FF0000","nearbyCrimeIncidents","#0096FF","#000000"])});const me=ks({mode:null,selection:null,currentShape:null,labelLayers:[],currentArea:null}),xe=ks(null),Pe=gi(()=>"/vue3-atlas2/images/marker_blue.png");Uh(async()=>{console.log("Map.vue onMounted route.params.topic:",m.params.topic,"route.params.address:",m.params.address);let ct;m.params.topic?ct=mn.topicStyles[m.params.topic]:ct="pwdDrawnMapStyle";let zt;m.params.address?zt=17:zt=12,M=new Wf.Map({container:"map",style:mn[ct],center:[-75.163471,39.953338],zoom:zt,minZoom:6,maxZoom:22,attributionControl:!1}),M.addControl(new Wf.NavigationControl,"bottom-left"),M.addControl(new Wf.GeolocateControl,"bottom-left");const ti=await M.loadImage("https://docs.mapbox.com/mapbox-gl-js/assets/custom_marker.png");M.addImage("custom-marker",ti.data);const ii=await M.loadImage(Pe.value);M.addImage("marker-blue",ii.data),M.on("click","liBuildingFootprints",Mi=>{console.log("liBuildingFootprints click, e:",Mi),Mi.clickOnLayer=!0,g.selectedLiBuildingNumber=Mi.features[0].properties.id}),M.on("click",(Mi,yr)=>{if(Mi.clickOnLayer)return;console.log("e:",Mi,"data:",yr,"drawInfo.mode:",me.mode,hi.getMode());let at=me.mode,tt=r.map.queryRenderedFeatures(Mi.point).filter(Je=>["mapbox-gl-draw-cold","mapbox-gl-draw-hot"].includes(Je.source));console.log("Map.vue handleMapClick, e:",Mi,"drawLayers:",tt,"drawMode:",at,"e:",Mi,"MapStore.map.getStyle():",r.map.getStyle(),"MapStore.drawStart:",r.drawStart),!tt.length&&hi.getMode()!=="draw_polygon"&&l.push({name:"search",query:{lng:Mi.lngLat.lng,lat:Mi.lngLat.lat}}),hi.getMode()==="draw_polygon"&&xe.value.getDrawDistances(Mi)}),M.on("mouseenter","nearby",Mi=>{Mi.features.length>0&&(console.log("map.getSource(nearby):",M.getSource("nearby"),"map.getStyle().sources:",M.getStyle().sources),a.hoveredStateId=Mi.features[0].properties.id)}),M.on("mouseleave","nearby",()=>{J&&(a.hoveredStateId=null)}),Fd.constants.classes.CONTROL_BASE="maplibregl-ctrl",Fd.constants.classes.CONTROL_PREFIX="maplibregl-ctrl-",Fd.constants.classes.CONTROL_GROUP="maplibregl-ctrl-group";const hi=new Fd({displayControlsDefault:!1,controls:{polygon:!0}});r.draw=hi,M.addControl(hi,"bottom-right"),M.on("draw.create",oe),M.on("draw.selectionchange",Le),M.on("draw.finish",Ze),M.on("draw.modechange",Ke),r.setMap(M)});const oe=ct=>{console.log("drawCreate is running, e",ct),xe.value.getDrawDistances(ct)},Le=ct=>{console.log("drawSelectionChange is running, e:",ct),xe.value.handleDrawSelectionChange(ct)},Ze=()=>{console.log("drawFinish is running"),me.mode="simple_select"},Ke=ct=>{console.log("drawModeChange is running, e",ct),me.mode=ct.mode,xe.value.handleDrawModeChange(ct)},dt=gi(()=>r.imagerySelected),bt=()=>{console.log("toggleImagery, map.getStyle:",M.getStyle()),M.getStyle(),r.imageryOn?(console.log("map.getStyle().layers:",M.getStyle().layers),r.imageryOn=!1,M.removeLayer(dt.value),M.removeLayer("imageryLabels")):(r.imageryOn=!0,M.addLayer(mn.mapLayers[dt.value],"addressMarker"),M.addLayer(mn.mapLayers.imageryLabels,"addressMarker"))},Pt=async ct=>{const zt=dt.value;console.log("setImagery, newImagery:",ct,"oldLayer:",zt,"imagerySelected.value:",dt.value),r.imagerySelected=ct,await M.addLayer(mn.mapLayers[dt.value],"addressMarker"),M.removeLayer(zt)},Ht=()=>{console.log("toggleCyclomedia"),r.cyclomediaOn=!r.cyclomediaOn},Rt=()=>{console.log("togglePictometry"),r.pictometryOn=!r.pictometryOn},li=ct=>{r.zoningOpacity=ct/100,M.setPaintProperty("zoning","raster-opacity",ct/100)};return(ct,zt)=>(It(),Ot("div",Ez,[rr(PR),rr(sz,{onToggleImagery:bt}),Fi(r).imageryOn?(It(),da(hz,{key:0,onSetImagery:Pt})):Gi("",!0),rr(mz,{onToggleCyclomedia:Ht}),rr(vz,{onTogglePictometry:Rt}),rr(tz,{ref_key:"distanceMeasureControlRef",ref:xe},null,512),z.value?(It(),da(S0,{key:1,initialOpacity:Fi(r).regmapOpacity,onOpacityChange:Z},null,8,["initialOpacity"])):Gi("",!0),Fi(a).currentTopic=="Zoning"?(It(),da(S0,{key:2,initialOpacity:Fi(r).zoningOpacity,onOpacityChange:li},null,8,["initialOpacity"])):Gi("",!0)]))}},Cz=Qs(Tz,[["__scopeId","data-v-9e146abe"]]),Iz={__name:"MapPanel",setup(e){const r=ys(),a=gi(()=>r.cyclomediaOn||r.pictometryOn?"map-panel cyclomedia-pictometry":"map-panel");return(u,d)=>(It(),Ot("div",{id:"map-panel",class:is(a.value)},[rr(Cz)],2))}},Az=Qs(Iz,[["__scopeId","data-v-82cdbafd"]]),Pz=Y("div",{class:"container"},[Y("h1",{class:"title is-1"},"Vue3 Atlas")],-1),Dz={class:"small-container"},kz={class:"columns"},Lz={class:"column is-6 pr-0 pb-0"},Rz={class:"column is-6 p-0 p-0"},nc={__name:"App",setup(e){console.log("import.meta.env.VITE_PUBLICPATH:","/vue3-atlas2/");const r=Js(),a=qh(),u=jh();return ks(""),Uh(async()=>{await u.isReady(),console.log("App onMounted, route.params.topic:",a.params.topic,"route.params.address:",a.params.address),a.name==="not-found"&&u.push({name:"home"}),a.params.topic&&(r.currentTopic=a.params.topic)}),(d,g)=>(It(),Ot("main",null,[Pz,Y("div",Dz,[Y("div",kz,[Y("div",Lz,[rr(SR)]),Y("div",Rz,[rr(Az)])])])]))}},zz="modulepreload",Oz=function(e){return"/vue3-atlas2/"+e},E0={},Fz=function(r,a,u){let d=Promise.resolve();if(a&&a.length>0){const g=document.getElementsByTagName("link"),m=document.querySelector("meta[property=csp-nonce]"),l=(m==null?void 0:m.nonce)||(m==null?void 0:m.getAttribute("nonce"));d=Promise.all(a.map(M=>{if(M=Oz(M),M in E0)return;E0[M]=!0;const P=M.endsWith(".css"),R=P?'[rel="stylesheet"]':"";if(!!u)for(let Z=g.length-1;Z>=0;Z--){const W=g[Z];if(W.href===M&&(!P||W.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${M}"]${R}`))return;const z=document.createElement("link");if(z.rel=P?"stylesheet":zz,P||(z.as="script",z.crossOrigin=""),z.href=M,l&&z.setAttribute("nonce",l),document.head.appendChild(z),P)return new Promise((Z,W)=>{z.addEventListener("load",Z),z.addEventListener("error",()=>W(new Error(`Unable to preload CSS for ${M}`)))})}))}return d.then(()=>r()).catch(g=>{const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=g,window.dispatchEvent(m),!m.defaultPrevented)throw g})},{routeApp:Bz}=hx(),i1=async e=>{console.log("getAddressAndPutInStore is running, address:",e);const r=Js();r.clearDataSourcesLoadedArray();const a=dn();if(await a.fillAddressData(e),!a.addressData.features){vu.push({name:"not-found"});return}const u=a.addressData.features[0].properties.street_address;r.setCurrentAddress(u)},Nz=async(e,r)=>{let a;const u=Js();u.selectedParcelId=null;let d=u.currentTopic;const g=mn.parcelLayerForTopic[d],m=hu();if(await m.fillParcelDataByLngLat(e,r,g),!m[g].features[0]){vu.push({name:"not-found"});return}const l=g==="pwd"?"ADDRESS":"ADDR_SOURCE";a=m[g].features[0].properties[l],console.log("getParcelAndPutInStore, currentAddress:",a,"parcelLayer:",g,"addressField",l,"ParcelsStore[parcelLayer].features[0].properties:",m[g].features[0].properties,"ParcelsStore[parcelLayer].features[0].properties[addressField]:",m[g].features[0].properties[l]),u.setCurrentAddress(a)},$z=async(e,r)=>{const a=Js(),u=dn(),d=a.dataSourcesLoadedArray;if(e.name==="not-found")return;let g,m;if(e.params.address?g=e.params.address:e.query.address&&(g=e.query.address),e.params.topic&&(m=e.params.topic),g!==u.addressData.normalized)await i1(g);else if(d.includes(m))return;const l=hu();await l.fillPwdParcelData(),await l.fillDorParcelData();const M=zp();if(await M.fillCondoData(g),e.params.topic=="Condominiums"&&!M.condosData.length){a.currentTopic="Property",vu.push({name:"address-and-topic",params:{address:e.params.address,topic:"Property"}});return}await Uz(e.params.topic),a.addToDataSourcesLoadedArray(e.params.topic)},Uz=async e=>{if(console.log("topicDataFetch is running, topic:",e),e==="Property"&&await bx().fillOpaData(),e==="Licenses & Inspections"){const r=lg();await r.fillLiBuildingFootprints(),await r.fillLiBuildingCertSummary(),await r.fillLiBuildingCerts(),await r.fillLiInspections(),await r.fillLiPermits()}if(e==="Deeds"){const r=Mx();await r.fillDorDocuments(),await r.fillRegmaps()}if(e==="Nearby Activity"){const a=Js().currentNearbyDataType;await Yx().fetchData(a);const g=dn().addressData.features[0].geometry.coordinates;await ys().fillBufferForAddress(g[0],g[1])}},vu=ES({history:tS("/vue3-atlas2"),routes:[{path:"/:pathMatch(.*)*",name:"NotFound",component:()=>Fz(()=>import("./NotFound-XYYVmHs3.js"),[])},{path:"/",name:"home",component:nc,props:!0},{path:"/:address",name:"address",component:nc},{path:"/:address/:topic",name:"address-and-topic",component:nc},{path:"/:address/:topic/:data",name:"address-topic-and-data",component:nc},{path:"/not-found",name:"not-found",component:nc},{path:"/search",name:"search",component:nc,beforeEnter:async(e,r)=>{console.log("search route beforeEnter, to.query:",e.query,"from:",r);const{address:a,lat:u,lng:d}=e.query,g=Js();a?(g.setLastSearchMethod("address"),await i1(a)):u&&d&&(g.setLastSearchMethod("mapClick"),await Nz(d,u)),Bz(vu)}}]});vu.afterEach(async(e,r)=>{console.log("router afterEach to:",e,"from:",r),e.name!=="not-found"&&e.name!=="search"&&await $z(e)});const ug=fM(nc);ug.use(_M());ug.use(vu);ug.mount("#app");export{Qs as _,Y as a,ip as b,Ot as c,rr as d,It as o,Vz as r,Ao as w};
